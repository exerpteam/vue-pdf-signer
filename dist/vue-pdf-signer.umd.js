(function(Q,z){typeof exports=="object"&&typeof module<"u"?z(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],z):(Q=typeof globalThis<"u"?globalThis:Q||self,z(Q.VuePdfSigner={},Q.Vue))})(this,(function(Q,z){"use strict";var DA=Q=>{throw TypeError(Q)};var eC=(Q,z,AI)=>z.has(Q)||DA("Cannot "+AI);var x=(Q,z,AI)=>(eC(Q,z,"read from private field"),AI?AI.call(Q):z.get(Q)),tI=(Q,z,AI)=>z.has(Q)?DA("Cannot add the same private member more than once"):z instanceof WeakSet?z.add(Q):z.set(Q,AI),oI=(Q,z,AI,_)=>(eC(Q,z,"write to private field"),_?_.call(Q,AI):z.set(Q,AI),AI),eI=(Q,z,AI)=>(eC(Q,z,"access private method"),AI);var KA=(Q,z,AI,_)=>({set _(ig){oI(Q,z,ig,AI)},get _(){return x(Q,z,_)}});var kI,RI,SI,vI,xg,rI,EI,bI,vg,SA,pA,ng,lg,rg;var AI=typeof document<"u"?document.currentScript:null;const _=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),ig=[.001,0,0,.001,0,0],Eg=1.35,wI={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},FI={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},DC="pdfjs_internal_editor_",p={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101,COMMENT:102},k={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},FA={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},sI={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},yg={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},q={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},fI={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Hg={ERRORS:0,WARNINGS:1,INFOS:5},Mg={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},ug={moveTo:0,lineTo:1,curveTo:2,closePath:3},zA={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let tg=Hg.WARNINGS;function JA(c){Number.isInteger(c)&&(tg=c)}function kA(){return tg}function eg(c){tg>=Hg.INFOS&&console.log(`Info: ${c}`)}function F(c){tg>=Hg.WARNINGS&&console.log(`Warning: ${c}`)}function j(c){throw new Error(c)}function $(c,I){c||j(I)}function LA(c){switch(c?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function KC(c,I=null,g=null){if(!c)return null;if(g&&typeof c=="string"&&(g.addDefaultProtocol&&c.startsWith("www.")&&c.match(/\./g)?.length>=2&&(c=`http://${c}`),g.tryConvertEncoding))try{c=UA(c)}catch{}const C=I?URL.parse(c,I):URL.parse(c);return LA(C)?C:null}function SC(c,I,g=!1){const C=URL.parse(c);return C?(C.hash=I,C.href):g&&KC(c,"http://example.com")?c.split("#",1)[0]+`${I?`#${I}`:""}`:""}function J(c,I,g,C=!1){return Object.defineProperty(c,I,{value:g,enumerable:!C,configurable:!0,writable:!1}),g}const QI=(function(){function I(g,C){this.message=g,this.name=C}return I.prototype=new Error,I.constructor=I,I})();class pC extends QI{constructor(I,g){super(I,"PasswordException"),this.code=g}}class Pg extends QI{constructor(I,g){super(I,"UnknownErrorException"),this.details=g}}class fg extends QI{constructor(I){super(I,"InvalidPDFException")}}class Dg extends QI{constructor(I,g,C){super(I,"ResponseException"),this.status=g,this.missing=C}}class TA extends QI{constructor(I){super(I,"FormatError")}}class zI extends QI{constructor(I){super(I,"AbortException")}}function FC(c){(typeof c!="object"||c?.length===void 0)&&j("Invalid argument for bytesToString");const I=c.length,g=8192;if(I<g)return String.fromCharCode.apply(null,c);const C=[];for(let A=0;A<I;A+=g){const l=Math.min(A+g,I),Z=c.subarray(A,l);C.push(String.fromCharCode.apply(null,Z))}return C.join("")}function dg(c){typeof c!="string"&&j("Invalid argument for stringToBytes");const I=c.length,g=new Uint8Array(I);for(let C=0;C<I;++C)g[C]=c.charCodeAt(C)&255;return g}function QA(c){return String.fromCharCode(c>>24&255,c>>16&255,c>>8&255,c&255)}function jA(){const c=new Uint8Array(4);return c[0]=1,new Uint32Array(c.buffer,0,1)[0]===1}function OA(){try{return new Function(""),!0}catch{return!1}}class ZI{static get isLittleEndian(){return J(this,"isLittleEndian",jA())}static get isEvalSupported(){return J(this,"isEvalSupported",OA())}static get isOffscreenCanvasSupported(){return J(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return J(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:I,userAgent:g}=navigator;return J(this,"platform",{isAndroid:g.includes("Android"),isLinux:I.includes("Linux"),isMac:I.includes("Mac"),isWindows:I.includes("Win"),isFirefox:g.includes("Firefox")})}static get isCSSRoundSupported(){return J(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const _g=Array.from(Array(256).keys(),c=>c.toString(16).padStart(2,"0"));class t{static makeHexColor(I,g,C){return`#${_g[I]}${_g[g]}${_g[C]}`}static scaleMinMax(I,g){let C;I[0]?(I[0]<0&&(C=g[0],g[0]=g[2],g[2]=C),g[0]*=I[0],g[2]*=I[0],I[3]<0&&(C=g[1],g[1]=g[3],g[3]=C),g[1]*=I[3],g[3]*=I[3]):(C=g[0],g[0]=g[1],g[1]=C,C=g[2],g[2]=g[3],g[3]=C,I[1]<0&&(C=g[1],g[1]=g[3],g[3]=C),g[1]*=I[1],g[3]*=I[1],I[2]<0&&(C=g[0],g[0]=g[2],g[2]=C),g[0]*=I[2],g[2]*=I[2]),g[0]+=I[4],g[1]+=I[5],g[2]+=I[4],g[3]+=I[5]}static transform(I,g){return[I[0]*g[0]+I[2]*g[1],I[1]*g[0]+I[3]*g[1],I[0]*g[2]+I[2]*g[3],I[1]*g[2]+I[3]*g[3],I[0]*g[4]+I[2]*g[5]+I[4],I[1]*g[4]+I[3]*g[5]+I[5]]}static applyTransform(I,g,C=0){const A=I[C],l=I[C+1];I[C]=A*g[0]+l*g[2]+g[4],I[C+1]=A*g[1]+l*g[3]+g[5]}static applyTransformToBezier(I,g,C=0){const A=g[0],l=g[1],Z=g[2],i=g[3],d=g[4],s=g[5];for(let G=0;G<6;G+=2){const b=I[C+G],m=I[C+G+1];I[C+G]=b*A+m*Z+d,I[C+G+1]=b*l+m*i+s}}static applyInverseTransform(I,g){const C=I[0],A=I[1],l=g[0]*g[3]-g[1]*g[2];I[0]=(C*g[3]-A*g[2]+g[2]*g[5]-g[4]*g[3])/l,I[1]=(-C*g[1]+A*g[0]+g[4]*g[1]-g[5]*g[0])/l}static axialAlignedBoundingBox(I,g,C){const A=g[0],l=g[1],Z=g[2],i=g[3],d=g[4],s=g[5],G=I[0],b=I[1],m=I[2],B=I[3];let o=A*G+d,W=o,Y=A*m+d,w=Y,a=i*b+s,h=a,N=i*B+s,V=N;if(l!==0||Z!==0){const R=l*G,X=l*m,n=Z*b,y=Z*B;o+=n,w+=n,Y+=y,W+=y,a+=R,V+=R,N+=X,h+=X}C[0]=Math.min(C[0],o,Y,W,w),C[1]=Math.min(C[1],a,N,h,V),C[2]=Math.max(C[2],o,Y,W,w),C[3]=Math.max(C[3],a,N,h,V)}static inverseTransform(I){const g=I[0]*I[3]-I[1]*I[2];return[I[3]/g,-I[1]/g,-I[2]/g,I[0]/g,(I[2]*I[5]-I[4]*I[3])/g,(I[4]*I[1]-I[5]*I[0])/g]}static singularValueDecompose2dScale(I,g){const C=I[0],A=I[1],l=I[2],Z=I[3],i=C**2+A**2,d=C*l+A*Z,s=l**2+Z**2,G=(i+s)/2,b=Math.sqrt(G**2-(i*s-d**2));g[0]=Math.sqrt(G+b||1),g[1]=Math.sqrt(G-b||1)}static normalizeRect(I){const g=I.slice(0);return I[0]>I[2]&&(g[0]=I[2],g[2]=I[0]),I[1]>I[3]&&(g[1]=I[3],g[3]=I[1]),g}static intersect(I,g){const C=Math.max(Math.min(I[0],I[2]),Math.min(g[0],g[2])),A=Math.min(Math.max(I[0],I[2]),Math.max(g[0],g[2]));if(C>A)return null;const l=Math.max(Math.min(I[1],I[3]),Math.min(g[1],g[3])),Z=Math.min(Math.max(I[1],I[3]),Math.max(g[1],g[3]));return l>Z?null:[C,l,A,Z]}static pointBoundingBox(I,g,C){C[0]=Math.min(C[0],I),C[1]=Math.min(C[1],g),C[2]=Math.max(C[2],I),C[3]=Math.max(C[3],g)}static rectBoundingBox(I,g,C,A,l){l[0]=Math.min(l[0],I,C),l[1]=Math.min(l[1],g,A),l[2]=Math.max(l[2],I,C),l[3]=Math.max(l[3],g,A)}static#I(I,g,C,A,l,Z,i,d,s,G){if(s<=0||s>=1)return;const b=1-s,m=s*s,B=m*s,o=b*(b*(b*I+3*s*g)+3*m*C)+B*A,W=b*(b*(b*l+3*s*Z)+3*m*i)+B*d;G[0]=Math.min(G[0],o),G[1]=Math.min(G[1],W),G[2]=Math.max(G[2],o),G[3]=Math.max(G[3],W)}static#g(I,g,C,A,l,Z,i,d,s,G,b,m){if(Math.abs(s)<1e-12){Math.abs(G)>=1e-12&&this.#I(I,g,C,A,l,Z,i,d,-b/G,m);return}const B=G**2-4*b*s;if(B<0)return;const o=Math.sqrt(B),W=2*s;this.#I(I,g,C,A,l,Z,i,d,(-G+o)/W,m),this.#I(I,g,C,A,l,Z,i,d,(-G-o)/W,m)}static bezierBoundingBox(I,g,C,A,l,Z,i,d,s){s[0]=Math.min(s[0],I,i),s[1]=Math.min(s[1],g,d),s[2]=Math.max(s[2],I,i),s[3]=Math.max(s[3],g,d),this.#g(I,C,l,i,g,A,Z,d,3*(-I+3*(C-l)+i),6*(I-2*C+l),3*(C-I),s),this.#g(I,C,l,i,g,A,Z,d,3*(-g+3*(A-Z)+d),6*(g-2*A+Z),3*(A-g),s)}}function UA(c){return decodeURIComponent(escape(c))}let qg=null,zC=null;function xA(c){return qg||(qg=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,zC=new Map([["ﬅ","ſt"]])),c.replaceAll(qg,(I,g,C)=>g?g.normalize("NFKC"):zC.get(C))}function JC(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const c=new Uint8Array(32);return crypto.getRandomValues(c),FC(c)}const $g="pdfjs_internal_id_";function vA(c,I,g){if(!Array.isArray(g)||g.length<2)return!1;const[C,A,...l]=g;if(!c(C)&&!Number.isInteger(C)||!I(A))return!1;const Z=l.length;let i=!0;switch(A.name){case"XYZ":if(Z<2||Z>3)return!1;break;case"Fit":case"FitB":return Z===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(Z>1)return!1;break;case"FitR":if(Z!==4)return!1;i=!1;break;default:return!1}for(const d of l)if(!(typeof d=="number"||i&&d===null))return!1;return!0}function GI(c,I,g){return Math.min(Math.max(c,I),g)}function kC(c){return Uint8Array.prototype.toBase64?c.toBase64():btoa(FC(c))}function rA(c){return Uint8Array.fromBase64?Uint8Array.fromBase64(c):dg(atob(c))}typeof Promise.try!="function"&&(Promise.try=function(c,...I){return new Promise(g=>{g(c(...I))})}),typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(c){return c.reduce((I,g)=>I+g,0)});const DI="http://www.w3.org/2000/svg";class _I{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function sg(c,I="text"){if(cg(c,document.baseURI)){const g=await fetch(c);if(!g.ok)throw new Error(g.statusText);switch(I){case"arraybuffer":return g.arrayBuffer();case"blob":return g.blob();case"json":return g.json()}return g.text()}return new Promise((g,C)=>{const A=new XMLHttpRequest;A.open("GET",c,!0),A.responseType=I,A.onreadystatechange=()=>{if(A.readyState===XMLHttpRequest.DONE){if(A.status===200||A.status===0){switch(I){case"arraybuffer":case"blob":case"json":g(A.response);return}g(A.responseText);return}C(new Error(A.statusText))}},A.send(null)})}class Gg{constructor({viewBox:I,userUnit:g,scale:C,rotation:A,offsetX:l=0,offsetY:Z=0,dontFlip:i=!1}){this.viewBox=I,this.userUnit=g,this.scale=C,this.rotation=A,this.offsetX=l,this.offsetY=Z,C*=g;const d=(I[2]+I[0])/2,s=(I[3]+I[1])/2;let G,b,m,B;switch(A%=360,A<0&&(A+=360),A){case 180:G=-1,b=0,m=0,B=1;break;case 90:G=0,b=1,m=1,B=0;break;case 270:G=0,b=-1,m=-1,B=0;break;case 0:G=1,b=0,m=0,B=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}i&&(m=-m,B=-B);let o,W,Y,w;G===0?(o=Math.abs(s-I[1])*C+l,W=Math.abs(d-I[0])*C+Z,Y=(I[3]-I[1])*C,w=(I[2]-I[0])*C):(o=Math.abs(d-I[0])*C+l,W=Math.abs(s-I[1])*C+Z,Y=(I[2]-I[0])*C,w=(I[3]-I[1])*C),this.transform=[G*C,b*C,m*C,B*C,o-G*C*d-m*C*s,W-b*C*d-B*C*s],this.width=Y,this.height=w}get rawDims(){const I=this.viewBox;return J(this,"rawDims",{pageWidth:I[2]-I[0],pageHeight:I[3]-I[1],pageX:I[0],pageY:I[1]})}clone({scale:I=this.scale,rotation:g=this.rotation,offsetX:C=this.offsetX,offsetY:A=this.offsetY,dontFlip:l=!1}={}){return new Gg({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:I,rotation:g,offsetX:C,offsetY:A,dontFlip:l})}convertToViewportPoint(I,g){const C=[I,g];return t.applyTransform(C,this.transform),C}convertToViewportRectangle(I){const g=[I[0],I[1]];t.applyTransform(g,this.transform);const C=[I[2],I[3]];return t.applyTransform(C,this.transform),[g[0],g[1],C[0],C[1]]}convertToPdfPoint(I,g){const C=[I,g];return t.applyInverseTransform(C,this.transform),C}}class IC extends QI{constructor(I,g=0){super(I,"RenderingCancelledException"),this.extraDelay=g}}function Kg(c){const I=c.length;let g=0;for(;g<I&&c[g].trim()==="";)g++;return c.substring(g,g+5).toLowerCase()==="data:"}function gC(c){return typeof c=="string"&&/\.pdf$/i.test(c)}function EA(c){return[c]=c.split(/[#?]/,1),c.substring(c.lastIndexOf("/")+1)}function PA(c,I="document.pdf"){if(typeof c!="string")return I;if(Kg(c))return F('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),I;const C=(i=>{try{return new URL(i)}catch{try{return new URL(decodeURIComponent(i))}catch{try{return new URL(i,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(i),"https://foo.bar")}catch{return null}}}}})(c);if(!C)return I;const A=i=>{try{let d=decodeURIComponent(i);return d.includes("/")?(d=d.split("/").at(-1),d.test(/^\.pdf$/i)?d:i):d}catch{return i}},l=/\.pdf$/i,Z=C.pathname.split("/").at(-1);if(l.test(Z))return A(Z);if(C.searchParams.size>0){const i=Array.from(C.searchParams.values()).reverse();for(const s of i)if(l.test(s))return A(s);const d=Array.from(C.searchParams.keys()).reverse();for(const s of d)if(l.test(s))return A(s)}if(C.hash){const d=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(C.hash);if(d)return A(d[0])}return I}class LC{started=Object.create(null);times=[];time(I){I in this.started&&F(`Timer is already running for ${I}`),this.started[I]=Date.now()}timeEnd(I){I in this.started||F(`Timer has not been started for ${I}`),this.times.push({name:I,start:this.started[I],end:Date.now()}),delete this.started[I]}toString(){const I=[];let g=0;for(const{name:C}of this.times)g=Math.max(C.length,g);for(const{name:C,start:A,end:l}of this.times)I.push(`${C.padEnd(g)} ${l-A}ms
`);return I.join("")}}function cg(c,I){const g=I?URL.parse(c,I):URL.parse(c);return g?.protocol==="http:"||g?.protocol==="https:"}function hI(c){c.preventDefault()}function II(c){c.preventDefault(),c.stopPropagation()}function fA(c){console.log("Deprecated API usage: "+c)}class CC{static#I;static toDateObject(I){if(I instanceof Date)return I;if(!I||typeof I!="string")return null;this.#I||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const g=this.#I.exec(I);if(!g)return null;const C=parseInt(g[1],10);let A=parseInt(g[2],10);A=A>=1&&A<=12?A-1:0;let l=parseInt(g[3],10);l=l>=1&&l<=31?l:1;let Z=parseInt(g[4],10);Z=Z>=0&&Z<=23?Z:0;let i=parseInt(g[5],10);i=i>=0&&i<=59?i:0;let d=parseInt(g[6],10);d=d>=0&&d<=59?d:0;const s=g[7]||"Z";let G=parseInt(g[8],10);G=G>=0&&G<=23?G:0;let b=parseInt(g[9],10)||0;return b=b>=0&&b<=59?b:0,s==="-"?(Z+=G,i+=b):s==="+"&&(Z-=G,i-=b),new Date(Date.UTC(C,A,l,Z,i,d))}}function _A(c,{scale:I=1,rotation:g=0}){const{width:C,height:A}=c.attributes.style,l=[0,0,parseInt(C),parseInt(A)];return new Gg({viewBox:l,userUnit:1,scale:I,rotation:g})}function Sg(c){if(c.startsWith("#")){const I=parseInt(c.slice(1),16);return[(I&16711680)>>16,(I&65280)>>8,I&255]}return c.startsWith("rgb(")?c.slice(4,-1).split(",").map(I=>parseInt(I)):c.startsWith("rgba(")?c.slice(5,-1).split(",").map(I=>parseInt(I)).slice(0,3):(F(`Not a valid color format: "${c}"`),[0,0,0])}function qA(c){const I=document.createElement("span");I.style.visibility="hidden",I.style.colorScheme="only light",document.body.append(I);for(const g of c.keys()){I.style.color=g;const C=window.getComputedStyle(I).color;c.set(g,Sg(C))}I.remove()}function v(c){const{a:I,b:g,c:C,d:A,e:l,f:Z}=c.getTransform();return[I,g,C,A,l,Z]}function XI(c){const{a:I,b:g,c:C,d:A,e:l,f:Z}=c.getTransform().invertSelf();return[I,g,C,A,l,Z]}function jI(c,I,g=!1,C=!0){if(I instanceof Gg){const{pageWidth:A,pageHeight:l}=I.rawDims,{style:Z}=c,i=ZI.isCSSRoundSupported,d=`var(--total-scale-factor) * ${A}px`,s=`var(--total-scale-factor) * ${l}px`,G=i?`round(down, ${d}, var(--scale-round-x))`:`calc(${d})`,b=i?`round(down, ${s}, var(--scale-round-y))`:`calc(${s})`;!g||I.rotation%180===0?(Z.width=G,Z.height=b):(Z.width=b,Z.height=G)}C&&c.setAttribute("data-main-rotation",I.rotation)}class nI{constructor(){const{pixelRatio:I}=nI;this.sx=I,this.sy=I}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(I,g,C,A,l=-1){let Z=1/0,i=1/0,d=1/0;C=nI.capPixels(C,l),C>0&&(Z=Math.sqrt(C/(I*g))),A!==-1&&(i=A/I,d=A/g);const s=Math.min(Z,i,d);return this.sx>s||this.sy>s?(this.sx=s,this.sy=s,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(I,g){if(g>=0){const C=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+g/100));return I>0?Math.min(I,C):C}return I}}const AC=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class bg{#I=null;#g=null;#C;#A=null;#Z=null;#l=null;#i=null;static#d=null;constructor(I){this.#C=I,bg.#d||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const I=this.#I=document.createElement("div");I.classList.add("editToolbar","hidden"),I.setAttribute("role","toolbar");const g=this.#C._uiManager._signal;I.addEventListener("contextmenu",hI,{signal:g}),I.addEventListener("pointerdown",bg.#c,{signal:g});const C=this.#A=document.createElement("div");C.className="buttons",I.append(C);const A=this.#C.toolbarPosition;if(A){const{style:l}=I,Z=this.#C._uiManager.direction==="ltr"?1-A[0]:A[0];l.insetInlineEnd=`${100*Z}%`,l.top=`calc(${100*A[1]}% + var(--editor-toolbar-vert-offset))`}return I}get div(){return this.#I}static#c(I){I.stopPropagation()}#G(I){this.#C._focusEventsAllowed=!1,II(I)}#m(I){this.#C._focusEventsAllowed=!0,II(I)}#s(I){const g=this.#C._uiManager._signal;I.addEventListener("focusin",this.#G.bind(this),{capture:!0,signal:g}),I.addEventListener("focusout",this.#m.bind(this),{capture:!0,signal:g}),I.addEventListener("contextmenu",hI,{signal:g})}hide(){this.#I.classList.add("hidden"),this.#g?.hideDropdown()}show(){this.#I.classList.remove("hidden"),this.#Z?.shown(),this.#l?.shown()}addDeleteButton(){const{editorType:I,_uiManager:g}=this.#C,C=document.createElement("button");C.className="delete",C.tabIndex=0,C.setAttribute("data-l10n-id",bg.#d[I]),this.#s(C),C.addEventListener("click",A=>{g.delete()},{signal:g._signal}),this.#A.append(C)}get#W(){const I=document.createElement("div");return I.className="divider",I}async addAltText(I){const g=await I.render();this.#s(g),this.#A.append(g,this.#W),this.#Z=I}addComment(I){if(this.#l)return;const g=I.render();g&&(this.#s(g),this.#A.prepend(g,this.#W),this.#l=I,I.toolbar=this)}addColorPicker(I){if(this.#g)return;this.#g=I;const g=I.renderButton();this.#s(g),this.#A.append(g,this.#W)}async addEditSignatureButton(I){const g=this.#i=await I.renderEditButton(this.#C);this.#s(g),this.#A.append(g,this.#W)}async addButton(I,g){switch(I){case"colorPicker":this.addColorPicker(g);break;case"altText":await this.addAltText(g);break;case"editSignature":await this.addEditSignatureButton(g);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(g);break}}updateEditSignatureButton(I){this.#i&&(this.#i.title=I)}remove(){this.#I.remove(),this.#g?.destroy(),this.#g=null}}class $A{#I=null;#g=null;#C;constructor(I){this.#C=I}#A(){const I=this.#g=document.createElement("div");I.className="editToolbar",I.setAttribute("role","toolbar"),I.addEventListener("contextmenu",hI,{signal:this.#C._signal});const g=this.#I=document.createElement("div");return g.className="buttons",I.append(g),this.#l(),I}#Z(I,g){let C=0,A=0;for(const l of I){const Z=l.y+l.height;if(Z<C)continue;const i=l.x+(g?l.width:0);if(Z>C){A=i,C=Z;continue}g?i>A&&(A=i):i<A&&(A=i)}return[g?1-A:A,C]}show(I,g,C){const[A,l]=this.#Z(g,C),{style:Z}=this.#g||=this.#A();I.append(this.#g),Z.insetInlineEnd=`${100*A}%`,Z.top=`calc(${100*l}% + var(--editor-toolbar-vert-offset))`}hide(){this.#g.remove()}#l(){const I=document.createElement("button");I.className="highlightButton",I.tabIndex=0,I.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const g=document.createElement("span");I.append(g),g.className="visuallyHidden",g.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const C=this.#C._signal;I.addEventListener("contextmenu",hI,{signal:C}),I.addEventListener("click",()=>{this.#C.highlightSelection("floating_button")},{signal:C}),this.#I.append(I)}}function TC(c,I,g){for(const C of g)I.addEventListener(C,c[C].bind(c))}class Il{#I=0;get id(){return`${DC}${this.#I++}`}}class lC{#I=JC();#g=0;#C=null;static get _isSVGFittingCanvas(){const I='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',C=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),A=new Image;A.src=I;const l=A.decode().then(()=>(C.drawImage(A,0,0,1,1,0,0,1,3),new Uint32Array(C.getImageData(0,0,1,1).data.buffer)[0]===0));return J(this,"_isSVGFittingCanvas",l)}async#A(I,g){this.#C||=new Map;let C=this.#C.get(I);if(C===null)return null;if(C?.bitmap)return C.refCounter+=1,C;try{C||={bitmap:null,id:`image_${this.#I}_${this.#g++}`,refCounter:0,isSvg:!1};let A;if(typeof g=="string"?(C.url=g,A=await sg(g,"blob")):g instanceof File?A=C.file=g:g instanceof Blob&&(A=g),A.type==="image/svg+xml"){const l=lC._isSVGFittingCanvas,Z=new FileReader,i=new Image,d=new Promise((s,G)=>{i.onload=()=>{C.bitmap=i,C.isSvg=!0,s()},Z.onload=async()=>{const b=C.svgUrl=Z.result;i.src=await l?`${b}#svgView(preserveAspectRatio(none))`:b},i.onerror=Z.onerror=G});Z.readAsDataURL(A),await d}else C.bitmap=await createImageBitmap(A);C.refCounter=1}catch(A){F(A),C=null}return this.#C.set(I,C),C&&this.#C.set(C.id,C),C}async getFromFile(I){const{lastModified:g,name:C,size:A,type:l}=I;return this.#A(`${g}_${C}_${A}_${l}`,I)}async getFromUrl(I){return this.#A(I,I)}async getFromBlob(I,g){const C=await g;return this.#A(I,C)}async getFromId(I){this.#C||=new Map;const g=this.#C.get(I);if(!g)return null;if(g.bitmap)return g.refCounter+=1,g;if(g.file)return this.getFromFile(g.file);if(g.blobPromise){const{blobPromise:C}=g;return delete g.blobPromise,this.getFromBlob(g.id,C)}return this.getFromUrl(g.url)}getFromCanvas(I,g){this.#C||=new Map;let C=this.#C.get(I);if(C?.bitmap)return C.refCounter+=1,C;const A=new OffscreenCanvas(g.width,g.height);return A.getContext("2d").drawImage(g,0,0),C={bitmap:A.transferToImageBitmap(),id:`image_${this.#I}_${this.#g++}`,refCounter:1,isSvg:!1},this.#C.set(I,C),this.#C.set(C.id,C),C}getSvgUrl(I){const g=this.#C.get(I);return g?.isSvg?g.svgUrl:null}deleteId(I){this.#C||=new Map;const g=this.#C.get(I);if(!g||(g.refCounter-=1,g.refCounter!==0))return;const{bitmap:C}=g;if(!g.url&&!g.file){const A=new OffscreenCanvas(C.width,C.height);A.getContext("bitmaprenderer").transferFromImageBitmap(C),g.blobPromise=A.convertToBlob()}C.close?.(),g.bitmap=null}isValidId(I){return I.startsWith(`image_${this.#I}_`)}}class gl{#I=[];#g=!1;#C;#A=-1;constructor(I=128){this.#C=I}add({cmd:I,undo:g,post:C,mustExec:A,type:l=NaN,overwriteIfSameType:Z=!1,keepUndo:i=!1}){if(A&&I(),this.#g)return;const d={cmd:I,undo:g,post:C,type:l};if(this.#A===-1){this.#I.length>0&&(this.#I.length=0),this.#A=0,this.#I.push(d);return}if(Z&&this.#I[this.#A].type===l){i&&(d.undo=this.#I[this.#A].undo),this.#I[this.#A]=d;return}const s=this.#A+1;s===this.#C?this.#I.splice(0,1):(this.#A=s,s<this.#I.length&&this.#I.splice(s)),this.#I.push(d)}undo(){if(this.#A===-1)return;this.#g=!0;const{undo:I,post:g}=this.#I[this.#A];I(),g?.(),this.#g=!1,this.#A-=1}redo(){if(this.#A<this.#I.length-1){this.#A+=1,this.#g=!0;const{cmd:I,post:g}=this.#I[this.#A];I(),g?.(),this.#g=!1}}hasSomethingToUndo(){return this.#A!==-1}hasSomethingToRedo(){return this.#A<this.#I.length-1}cleanType(I){if(this.#A!==-1){for(let g=this.#A;g>=0;g--)if(this.#I[g].type!==I){this.#I.splice(g+1,this.#A-g),this.#A=g;return}this.#I.length=0,this.#A=-1}}destroy(){this.#I=null}}class mg{constructor(I){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:g}=ZI.platform;for(const[C,A,l={}]of I)for(const Z of C){const i=Z.startsWith("mac+");g&&i?(this.callbacks.set(Z.slice(4),{callback:A,options:l}),this.allKeys.add(Z.split("+").at(-1))):!g&&!i&&(this.callbacks.set(Z,{callback:A,options:l}),this.allKeys.add(Z.split("+").at(-1)))}}#I(I){I.altKey&&this.buffer.push("alt"),I.ctrlKey&&this.buffer.push("ctrl"),I.metaKey&&this.buffer.push("meta"),I.shiftKey&&this.buffer.push("shift"),this.buffer.push(I.key);const g=this.buffer.join("+");return this.buffer.length=0,g}exec(I,g){if(!this.allKeys.has(g.key))return;const C=this.callbacks.get(this.#I(g));if(!C)return;const{callback:A,options:{bubbles:l=!1,args:Z=[],checker:i=null}}=C;i&&!i(I,g)||(A.bind(I,...Z,g)(),l||II(g))}}class ZC{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const I=new Map([["CanvasText",null],["Canvas",null]]);return qA(I),J(this,"_colors",I)}convert(I){const g=Sg(I);if(!window.matchMedia("(forced-colors: active)").matches)return g;for(const[C,A]of this._colors)if(A.every((l,Z)=>l===g[Z]))return ZC._colorsMapping.get(C);return g}getHexCode(I){const g=this._colors.get(I);return g?t.makeHexColor(...g):I}}class JI{#I=new AbortController;#g=null;#C=new Map;#A=new Map;#Z=null;#l=null;#i=null;#d=new gl;#c=null;#G=null;#m=null;#s=0;#W=new Set;#w=null;#B=null;#b=new Set;_editorUndoBar=null;#o=!1;#a=!1;#Y=!1;#N=null;#R=null;#h=null;#n=null;#t=!1;#X=null;#e=new Il;#u=!1;#M=!1;#H=null;#K=null;#J=null;#S=null;#Q=null;#y=p.NONE;#V=new Set;#k=null;#L=null;#j=null;#x=null;#v={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#O=[0,0];#p=null;#F=null;#U=null;#f=null;#z=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const I=JI.prototype,g=Z=>Z.#F.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&Z.hasSomethingToControl(),C=(Z,{target:i})=>{if(i instanceof HTMLInputElement){const{type:d}=i;return d!=="text"&&d!=="number"}return!0},A=this.TRANSLATE_SMALL,l=this.TRANSLATE_BIG;return J(this,"_keyboardManager",new mg([[["ctrl+a","mac+meta+a"],I.selectAll,{checker:C}],[["ctrl+z","mac+meta+z"],I.undo,{checker:C}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],I.redo,{checker:C}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],I.delete,{checker:C}],[["Enter","mac+Enter"],I.addNewEditorFromKeyboard,{checker:(Z,{target:i})=>!(i instanceof HTMLButtonElement)&&Z.#F.contains(i)&&!Z.isEnterHandled}],[[" ","mac+ "],I.addNewEditorFromKeyboard,{checker:(Z,{target:i})=>!(i instanceof HTMLButtonElement)&&Z.#F.contains(document.activeElement)}],[["Escape","mac+Escape"],I.unselectAll],[["ArrowLeft","mac+ArrowLeft"],I.translateSelectedEditors,{args:[-A,0],checker:g}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],I.translateSelectedEditors,{args:[-l,0],checker:g}],[["ArrowRight","mac+ArrowRight"],I.translateSelectedEditors,{args:[A,0],checker:g}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],I.translateSelectedEditors,{args:[l,0],checker:g}],[["ArrowUp","mac+ArrowUp"],I.translateSelectedEditors,{args:[0,-A],checker:g}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],I.translateSelectedEditors,{args:[0,-l],checker:g}],[["ArrowDown","mac+ArrowDown"],I.translateSelectedEditors,{args:[0,A],checker:g}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],I.translateSelectedEditors,{args:[0,l],checker:g}]]))}constructor(I,g,C,A,l,Z,i,d,s,G,b,m,B,o,W,Y){const w=this._signal=this.#I.signal;this.#F=I,this.#U=g,this.#f=C,this.#Z=A,this.#c=l,this.#L=Z,this._eventBus=i,i._on("editingaction",this.onEditingAction.bind(this),{signal:w}),i._on("pagechanging",this.onPageChanging.bind(this),{signal:w}),i._on("scalechanging",this.onScaleChanging.bind(this),{signal:w}),i._on("rotationchanging",this.onRotationChanging.bind(this),{signal:w}),i._on("setpreference",this.onSetPreference.bind(this),{signal:w}),i._on("switchannotationeditorparams",a=>this.updateParams(a.type,a.value),{signal:w}),this.#ZI(),this.#GI(),this.#q(),this.#l=d.annotationStorage,this.#N=d.filterFactory,this.#j=s,this.#n=G||null,this.#o=b,this.#a=m,this.#Y=B,this.#Q=o||null,this.viewParameters={realScale:_I.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=W||null,this._supportsPinchToZoom=Y!==!1}destroy(){this.#z?.resolve(),this.#z=null,this.#I?.abort(),this.#I=null,this._signal=null;for(const I of this.#A.values())I.destroy();this.#A.clear(),this.#C.clear(),this.#b.clear(),this.#S?.clear(),this.#g=null,this.#V.clear(),this.#d.destroy(),this.#Z?.destroy(),this.#c?.destroy(),this.#L?.destroy(),this.#X?.hide(),this.#X=null,this.#J?.destroy(),this.#J=null,this.#R&&(clearTimeout(this.#R),this.#R=null),this.#p&&(clearTimeout(this.#p),this.#p=null),this._editorUndoBar?.destroy()}combinedSignal(I){return AbortSignal.any([this._signal,I.signal])}get mlManager(){return this.#Q}get useNewAltTextFlow(){return this.#a}get useNewAltTextWhenAddingImage(){return this.#Y}get hcmFilter(){return J(this,"hcmFilter",this.#j?this.#N.addHCMFilter(this.#j.foreground,this.#j.background):"none")}get direction(){return J(this,"direction",getComputedStyle(this.#F).direction)}get _highlightColors(){return J(this,"_highlightColors",this.#n?new Map(this.#n.split(",").map(I=>(I=I.split("=").map(g=>g.trim()),I[1]=I[1].toUpperCase(),I))):null)}get highlightColors(){const{_highlightColors:I}=this;if(!I)return J(this,"highlightColors",null);const g=new Map,C=!!this.#j;for(const[A,l]of I){const Z=A.endsWith("_HCM");if(C&&Z){g.set(A.replace("_HCM",""),l);continue}!C&&!Z&&g.set(A,l)}return J(this,"highlightColors",g)}get highlightColorNames(){return J(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,I=>I.reverse())):null)}getNonHCMColor(I){if(!this._highlightColors)return I;const g=this.highlightColorNames.get(I);return this._highlightColors.get(g)||I}getNonHCMColorName(I){return this.highlightColorNames.get(I)||I}setCurrentDrawingSession(I){I?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#m=I}setMainHighlightColorPicker(I){this.#J=I}editAltText(I,g=!1){this.#Z?.editAltText(this,I,g)}hasCommentManager(){return!!this.#c}editComment(I,g){this.#c?.open(this,I,g)}getSignature(I){this.#L?.getSignature({uiManager:this,editor:I})}get signatureManager(){return this.#L}switchToMode(I,g){this._eventBus.on("annotationeditormodechanged",g,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:I})}setPreference(I,g){this._eventBus.dispatch("setpreference",{source:this,name:I,value:g})}onSetPreference({name:I,value:g}){switch(I){case"enableNewAltTextWhenAddingImage":this.#Y=g;break}}onPageChanging({pageNumber:I}){this.#s=I-1}focusMainContainer(){this.#F.focus()}findParent(I,g){for(const C of this.#A.values()){const{x:A,y:l,width:Z,height:i}=C.div.getBoundingClientRect();if(I>=A&&I<=A+Z&&g>=l&&g<=l+i)return C}return null}disableUserSelect(I=!1){this.#U.classList.toggle("noUserSelect",I)}addShouldRescale(I){this.#b.add(I)}removeShouldRescale(I){this.#b.delete(I)}onScaleChanging({scale:I}){this.commitOrRemove(),this.viewParameters.realScale=I*_I.PDF_TO_CSS_UNITS;for(const g of this.#b)g.onScaleChanging();this.#m?.onScaleChanging()}onRotationChanging({pagesRotation:I}){this.commitOrRemove(),this.viewParameters.rotation=I}#E({anchorNode:I}){return I.nodeType===Node.TEXT_NODE?I.parentElement:I}#_(I){const{currentLayer:g}=this;if(g.hasTextLayer(I))return g;for(const C of this.#A.values())if(C.hasTextLayer(I))return C;return null}highlightSelection(I=""){const g=document.getSelection();if(!g||g.isCollapsed)return;const{anchorNode:C,anchorOffset:A,focusNode:l,focusOffset:Z}=g,i=g.toString(),s=this.#E(g).closest(".textLayer"),G=this.getSelectionBoxes(s);if(!G)return;g.empty();const b=this.#_(s),m=this.#y===p.NONE,B=()=>{b?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:I,boxes:G,anchorNode:C,anchorOffset:A,focusNode:l,focusOffset:Z,text:i}),m&&this.showAllEditors("highlight",!0,!0)};if(m){this.switchToMode(p.HIGHLIGHT,B);return}B()}#AI(){const I=document.getSelection();if(!I||I.isCollapsed)return;const C=this.#E(I).closest(".textLayer"),A=this.getSelectionBoxes(C);A&&(this.#X||=new $A(this),this.#X.show(C,A,this.direction==="ltr"))}addToAnnotationStorage(I){!I.isEmpty()&&this.#l&&!this.#l.has(I.id)&&this.#l.setValue(I.id,I)}a11yAlert(I,g=null){const C=this.#f;C&&(C.setAttribute("data-l10n-id",I),g?C.setAttribute("data-l10n-args",JSON.stringify(g)):C.removeAttribute("data-l10n-args"))}#lI(){const I=document.getSelection();if(!I||I.isCollapsed){this.#k&&(this.#X?.hide(),this.#k=null,this.#D({hasSelectedText:!1}));return}const{anchorNode:g}=I;if(g===this.#k)return;const A=this.#E(I).closest(".textLayer");if(!A){this.#k&&(this.#X?.hide(),this.#k=null,this.#D({hasSelectedText:!1}));return}if(this.#X?.hide(),this.#k=g,this.#D({hasSelectedText:!0}),!(this.#y!==p.HIGHLIGHT&&this.#y!==p.NONE)&&(this.#y===p.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#t=this.isShiftKeyDown,!this.isShiftKeyDown)){const l=this.#y===p.HIGHLIGHT?this.#_(A):null;l?.toggleDrawing();const Z=new AbortController,i=this.combinedSignal(Z),d=s=>{s.type==="pointerup"&&s.button!==0||(Z.abort(),l?.toggleDrawing(!0),s.type==="pointerup"&&this.#P("main_toolbar"))};window.addEventListener("pointerup",d,{signal:i}),window.addEventListener("blur",d,{signal:i})}}#P(I=""){this.#y===p.HIGHLIGHT?this.highlightSelection(I):this.#o&&this.#AI()}#ZI(){document.addEventListener("selectionchange",this.#lI.bind(this),{signal:this._signal})}#iI(){if(this.#h)return;this.#h=new AbortController;const I=this.combinedSignal(this.#h);window.addEventListener("focus",this.focus.bind(this),{signal:I}),window.addEventListener("blur",this.blur.bind(this),{signal:I})}#dI(){this.#h?.abort(),this.#h=null}blur(){if(this.isShiftKeyDown=!1,this.#t&&(this.#t=!1,this.#P("main_toolbar")),!this.hasSelection)return;const{activeElement:I}=document;for(const g of this.#V)if(g.div.contains(I)){this.#K=[g,I],g._focusEventsAllowed=!1;break}}focus(){if(!this.#K)return;const[I,g]=this.#K;this.#K=null,g.addEventListener("focusin",()=>{I._focusEventsAllowed=!0},{once:!0,signal:this._signal}),g.focus()}#q(){if(this.#H)return;this.#H=new AbortController;const I=this.combinedSignal(this.#H);window.addEventListener("keydown",this.keydown.bind(this),{signal:I}),window.addEventListener("keyup",this.keyup.bind(this),{signal:I})}#sI(){this.#H?.abort(),this.#H=null}#$(){if(this.#G)return;this.#G=new AbortController;const I=this.combinedSignal(this.#G);document.addEventListener("copy",this.copy.bind(this),{signal:I}),document.addEventListener("cut",this.cut.bind(this),{signal:I}),document.addEventListener("paste",this.paste.bind(this),{signal:I})}#II(){this.#G?.abort(),this.#G=null}#GI(){const I=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:I}),document.addEventListener("drop",this.drop.bind(this),{signal:I})}addEditListeners(){this.#q(),this.#$()}removeEditListeners(){this.#sI(),this.#II()}dragOver(I){for(const{type:g}of I.dataTransfer.items)for(const C of this.#B)if(C.isHandlingMimeForPasting(g)){I.dataTransfer.dropEffect="copy",I.preventDefault();return}}drop(I){for(const g of I.dataTransfer.items)for(const C of this.#B)if(C.isHandlingMimeForPasting(g.type)){C.paste(g,this.currentLayer),I.preventDefault();return}}copy(I){if(I.preventDefault(),this.#g?.commitOrRemove(),!this.hasSelection)return;const g=[];for(const C of this.#V){const A=C.serialize(!0);A&&g.push(A)}g.length!==0&&I.clipboardData.setData("application/pdfjs",JSON.stringify(g))}cut(I){this.copy(I),this.delete()}async paste(I){I.preventDefault();const{clipboardData:g}=I;for(const l of g.items)for(const Z of this.#B)if(Z.isHandlingMimeForPasting(l.type)){Z.paste(l,this.currentLayer);return}let C=g.getData("application/pdfjs");if(!C)return;try{C=JSON.parse(C)}catch(l){F(`paste: "${l.message}".`);return}if(!Array.isArray(C))return;this.unselectAll();const A=this.currentLayer;try{const l=[];for(const d of C){const s=await A.deserialize(d);if(!s)return;l.push(s)}const Z=()=>{for(const d of l)this.#gI(d);this.#CI(l)},i=()=>{for(const d of l)d.remove()};this.addCommands({cmd:Z,undo:i,mustExec:!0})}catch(l){F(`paste: "${l.message}".`)}}keydown(I){!this.isShiftKeyDown&&I.key==="Shift"&&(this.isShiftKeyDown=!0),this.#y!==p.NONE&&!this.isEditorHandlingKeyboard&&JI._keyboardManager.exec(this,I)}keyup(I){this.isShiftKeyDown&&I.key==="Shift"&&(this.isShiftKeyDown=!1,this.#t&&(this.#t=!1,this.#P("main_toolbar")))}onEditingAction({name:I}){switch(I){case"undo":case"redo":case"delete":case"selectAll":this[I]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#D(I){Object.entries(I).some(([C,A])=>this.#v[C]!==A)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#v,I)}),this.#y===p.HIGHLIGHT&&I.hasSelectedEditor===!1&&this.#T([[k.HIGHLIGHT_FREE,!0]]))}#T(I){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:I})}setEditingState(I){I?(this.#iI(),this.#$(),this.#D({isEditing:this.#y!==p.NONE,isEmpty:this.#r(),hasSomethingToUndo:this.#d.hasSomethingToUndo(),hasSomethingToRedo:this.#d.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#dI(),this.#II(),this.#D({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(I){if(!this.#B){this.#B=I;for(const g of this.#B)this.#T(g.defaultPropertiesToUpdate)}}getId(){return this.#e.id}get currentLayer(){return this.#A.get(this.#s)}getLayer(I){return this.#A.get(I)}get currentPageIndex(){return this.#s}addLayer(I){this.#A.set(I.pageIndex,I),this.#u?I.enable():I.disable()}removeLayer(I){this.#A.delete(I.pageIndex)}async updateMode(I,g=null,C=!1,A=!1,l=!1){if(this.#y!==I&&!(this.#z&&(await this.#z.promise,!this.#z))){if(this.#z=Promise.withResolvers(),this.#m?.commitOrRemove(),this.#y=I,I===p.NONE){this.setEditingState(!1),this.#bI(),this._editorUndoBar?.hide(),this.#z.resolve();return}I===p.SIGNATURE&&await this.#L?.loadSignatures(),this.setEditingState(!0),await this.#cI(),this.unselectAll();for(const Z of this.#A.values())Z.updateMode(I);if(!g){C&&this.addNewEditorFromKeyboard(),this.#z.resolve();return}for(const Z of this.#C.values())Z.annotationElementId===g||Z.id===g?(this.setSelected(Z),l?Z.editComment():A&&Z.enterInEditMode()):Z.unselect();this.#z.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(I){I.mode!==this.#y&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...I})}updateParams(I,g){if(this.#B){switch(I){case k.CREATE:this.currentLayer.addNewEditor(g);return;case k.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#x||=new Map).set(I,g),this.showAllEditors("highlight",g);break}if(this.hasSelection)for(const C of this.#V)C.updateParams(I,g);else for(const C of this.#B)C.updateDefaultParams(I,g)}}showAllEditors(I,g,C=!1){for(const l of this.#C.values())l.editorType===I&&l.show(g);(this.#x?.get(k.HIGHLIGHT_SHOW_ALL)??!0)!==g&&this.#T([[k.HIGHLIGHT_SHOW_ALL,g]])}enableWaiting(I=!1){if(this.#M!==I){this.#M=I;for(const g of this.#A.values())I?g.disableClick():g.enableClick(),g.div.classList.toggle("waiting",I)}}async#cI(){if(!this.#u){this.#u=!0;const I=[];for(const g of this.#A.values())I.push(g.enable());await Promise.all(I);for(const g of this.#C.values())g.enable()}}#bI(){if(this.unselectAll(),this.#u){this.#u=!1;for(const I of this.#A.values())I.disable();for(const I of this.#C.values())I.disable()}}getEditors(I){const g=[];for(const C of this.#C.values())C.pageIndex===I&&g.push(C);return g}getEditor(I){return this.#C.get(I)}addEditor(I){this.#C.set(I.id,I)}removeEditor(I){I.div.contains(document.activeElement)&&(this.#R&&clearTimeout(this.#R),this.#R=setTimeout(()=>{this.focusMainContainer(),this.#R=null},0)),this.#C.delete(I.id),I.annotationElementId&&this.#S?.delete(I.annotationElementId),this.unselect(I),(!I.annotationElementId||!this.#W.has(I.annotationElementId))&&this.#l?.remove(I.id)}addDeletedAnnotationElement(I){this.#W.add(I.annotationElementId),this.addChangedExistingAnnotation(I),I.deleted=!0}isDeletedAnnotationElement(I){return this.#W.has(I)}removeDeletedAnnotationElement(I){this.#W.delete(I.annotationElementId),this.removeChangedExistingAnnotation(I),I.deleted=!1}#gI(I){const g=this.#A.get(I.pageIndex);g?g.addOrRebuild(I):(this.addEditor(I),this.addToAnnotationStorage(I))}setActiveEditor(I){this.#g!==I&&(this.#g=I,I&&this.#T(I.propertiesToUpdate))}get#mI(){let I=null;for(I of this.#V);return I}updateUI(I){this.#mI===I&&this.#T(I.propertiesToUpdate)}updateUIForDefaultProperties(I){this.#T(I.defaultPropertiesToUpdate)}toggleSelected(I){if(this.#V.has(I)){this.#V.delete(I),I.unselect(),this.#D({hasSelectedEditor:this.hasSelection});return}this.#V.add(I),I.select(),this.#T(I.propertiesToUpdate),this.#D({hasSelectedEditor:!0})}setSelected(I){this.updateToolbar({mode:I.mode,editId:I.id}),this.#m?.commitOrRemove();for(const g of this.#V)g!==I&&g.unselect();this.#V.clear(),this.#V.add(I),I.select(),this.#T(I.propertiesToUpdate),this.#D({hasSelectedEditor:!0})}isSelected(I){return this.#V.has(I)}get firstSelectedEditor(){return this.#V.values().next().value}unselect(I){I.unselect(),this.#V.delete(I),this.#D({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#V.size!==0}get isEnterHandled(){return this.#V.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#d.undo(),this.#D({hasSomethingToUndo:this.#d.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#r()}),this._editorUndoBar?.hide()}redo(){this.#d.redo(),this.#D({hasSomethingToUndo:!0,hasSomethingToRedo:this.#d.hasSomethingToRedo(),isEmpty:this.#r()})}addCommands(I){this.#d.add(I),this.#D({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#r()})}cleanUndoStack(I){this.#d.cleanType(I)}#r(){if(this.#C.size===0)return!0;if(this.#C.size===1)for(const I of this.#C.values())return I.isEmpty();return!1}delete(){this.commitOrRemove();const I=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!I)return;const g=I?[I]:[...this.#V],C=()=>{this._editorUndoBar?.show(A,g.length===1?g[0].editorType:g.length);for(const l of g)l.remove()},A=()=>{for(const l of g)this.#gI(l)};this.addCommands({cmd:C,undo:A,mustExec:!0})}commitOrRemove(){this.#g?.commitOrRemove()}hasSomethingToControl(){return this.#g||this.hasSelection}#CI(I){for(const g of this.#V)g.unselect();this.#V.clear();for(const g of I)g.isEmpty()||(this.#V.add(g),g.select());this.#D({hasSelectedEditor:this.hasSelection})}selectAll(){for(const I of this.#V)I.commit();this.#CI(this.#C.values())}unselectAll(){if(!(this.#g&&(this.#g.commitOrRemove(),this.#y!==p.NONE))&&!this.#m?.commitOrRemove()&&this.hasSelection){for(const I of this.#V)I.unselect();this.#V.clear(),this.#D({hasSelectedEditor:!1})}}translateSelectedEditors(I,g,C=!1){if(C||this.commitOrRemove(),!this.hasSelection)return;this.#O[0]+=I,this.#O[1]+=g;const[A,l]=this.#O,Z=[...this.#V],i=1e3;this.#p&&clearTimeout(this.#p),this.#p=setTimeout(()=>{this.#p=null,this.#O[0]=this.#O[1]=0,this.addCommands({cmd:()=>{for(const d of Z)this.#C.has(d.id)&&(d.translateInPage(A,l),d.translationDone())},undo:()=>{for(const d of Z)this.#C.has(d.id)&&(d.translateInPage(-A,-l),d.translationDone())},mustExec:!1})},i);for(const d of Z)d.translateInPage(I,g),d.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#w=new Map;for(const I of this.#V)this.#w.set(I,{savedX:I.x,savedY:I.y,savedPageIndex:I.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#w)return!1;this.disableUserSelect(!1);const I=this.#w;this.#w=null;let g=!1;for(const[{x:A,y:l,pageIndex:Z},i]of I)i.newX=A,i.newY=l,i.newPageIndex=Z,g||=A!==i.savedX||l!==i.savedY||Z!==i.savedPageIndex;if(!g)return!1;const C=(A,l,Z,i)=>{if(this.#C.has(A.id)){const d=this.#A.get(i);d?A._setParentAndPosition(d,l,Z):(A.pageIndex=i,A.x=l,A.y=Z)}};return this.addCommands({cmd:()=>{for(const[A,{newX:l,newY:Z,newPageIndex:i}]of I)C(A,l,Z,i)},undo:()=>{for(const[A,{savedX:l,savedY:Z,savedPageIndex:i}]of I)C(A,l,Z,i)},mustExec:!0}),!0}dragSelectedEditors(I,g){if(this.#w)for(const C of this.#w.keys())C.drag(I,g)}rebuild(I){if(I.parent===null){const g=this.getLayer(I.pageIndex);g?(g.changeParent(I),g.addOrRebuild(I)):(this.addEditor(I),this.addToAnnotationStorage(I),I.rebuild())}else I.parent.addOrRebuild(I)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#V.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(I){return this.#g===I}getActive(){return this.#g}getMode(){return this.#y}get imageManager(){return J(this,"imageManager",new lC)}getSelectionBoxes(I){if(!I)return null;const g=document.getSelection();for(let s=0,G=g.rangeCount;s<G;s++)if(!I.contains(g.getRangeAt(s).commonAncestorContainer))return null;const{x:C,y:A,width:l,height:Z}=I.getBoundingClientRect();let i;switch(I.getAttribute("data-main-rotation")){case"90":i=(s,G,b,m)=>({x:(G-A)/Z,y:1-(s+b-C)/l,width:m/Z,height:b/l});break;case"180":i=(s,G,b,m)=>({x:1-(s+b-C)/l,y:1-(G+m-A)/Z,width:b/l,height:m/Z});break;case"270":i=(s,G,b,m)=>({x:1-(G+m-A)/Z,y:(s-C)/l,width:m/Z,height:b/l});break;default:i=(s,G,b,m)=>({x:(s-C)/l,y:(G-A)/Z,width:b/l,height:m/Z});break}const d=[];for(let s=0,G=g.rangeCount;s<G;s++){const b=g.getRangeAt(s);if(!b.collapsed)for(const{x:m,y:B,width:o,height:W}of b.getClientRects())o===0||W===0||d.push(i(m,B,o,W))}return d.length===0?null:d}addChangedExistingAnnotation({annotationElementId:I,id:g}){(this.#i||=new Map).set(I,g)}removeChangedExistingAnnotation({annotationElementId:I}){this.#i?.delete(I)}renderAnnotationElement(I){const g=this.#i?.get(I.data.id);if(!g)return;const C=this.#l.getRawValue(g);C&&(this.#y===p.NONE&&!C.hasBeenModified||C.renderAnnotationElement(I))}setMissingCanvas(I,g,C){const A=this.#S?.get(I);A&&(A.setCanvas(g,C),this.#S.delete(I))}addMissingCanvas(I,g){(this.#S||=new Map).set(I,g)}}class yI{#I=null;#g=!1;#C=null;#A=null;#Z=null;#l=null;#i=!1;#d=null;#c=null;#G=null;#m=null;#s=!1;static#W=null;static _l10n=null;constructor(I){this.#c=I,this.#s=I._uiManager.useNewAltTextFlow,yI.#W||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(I){yI._l10n??=I}async render(){const I=this.#C=document.createElement("button");I.className="altText",I.tabIndex="0";const g=this.#A=document.createElement("span");I.append(g),this.#s?(I.classList.add("new"),I.setAttribute("data-l10n-id",yI.#W.missing),g.setAttribute("data-l10n-id",yI.#W["missing-label"])):(I.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),g.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const C=this.#c._uiManager._signal;I.addEventListener("contextmenu",hI,{signal:C}),I.addEventListener("pointerdown",l=>l.stopPropagation(),{signal:C});const A=l=>{l.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#s&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#w}})};return I.addEventListener("click",A,{capture:!0,signal:C}),I.addEventListener("keydown",l=>{l.target===I&&l.key==="Enter"&&(this.#i=!0,A(l))},{signal:C}),await this.#B(),I}get#w(){return this.#I&&"added"||this.#I===null&&this.guessedText&&"review"||"missing"}finish(){this.#C&&(this.#C.focus({focusVisible:this.#i}),this.#i=!1)}isEmpty(){return this.#s?this.#I===null:!this.#I&&!this.#g}hasData(){return this.#s?this.#I!==null||!!this.#G:this.isEmpty()}get guessedText(){return this.#G}async setGuessedText(I){this.#I===null&&(this.#G=I,this.#m=await yI._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:I}),this.#B())}toggleAltTextBadge(I=!1){if(!this.#s||this.#I){this.#d?.remove(),this.#d=null;return}if(!this.#d){const g=this.#d=document.createElement("div");g.className="noAltTextBadge",this.#c.div.append(g)}this.#d.classList.toggle("hidden",!I)}serialize(I){let g=this.#I;return!I&&this.#G===g&&(g=this.#m),{altText:g,decorative:this.#g,guessedText:this.#G,textWithDisclaimer:this.#m}}get data(){return{altText:this.#I,decorative:this.#g}}set data({altText:I,decorative:g,guessedText:C,textWithDisclaimer:A,cancel:l=!1}){C&&(this.#G=C,this.#m=A),!(this.#I===I&&this.#g===g)&&(l||(this.#I=I,this.#g=g),this.#B())}toggle(I=!1){this.#C&&(!I&&this.#l&&(clearTimeout(this.#l),this.#l=null),this.#C.disabled=!I)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#w}})}destroy(){this.#C?.remove(),this.#C=null,this.#A=null,this.#Z=null,this.#d?.remove(),this.#d=null}async#B(){const I=this.#C;if(!I)return;if(this.#s){if(I.classList.toggle("done",!!this.#I),I.setAttribute("data-l10n-id",yI.#W[this.#w]),this.#A?.setAttribute("data-l10n-id",yI.#W[`${this.#w}-label`]),!this.#I){this.#Z?.remove();return}}else{if(!this.#I&&!this.#g){I.classList.remove("done"),this.#Z?.remove();return}I.classList.add("done"),I.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let g=this.#Z;if(!g){this.#Z=g=document.createElement("span"),g.className="tooltip",g.setAttribute("role","tooltip"),g.id=`alt-text-tooltip-${this.#c.id}`;const A=100,l=this.#c._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(this.#l),this.#l=null},{once:!0}),I.addEventListener("mouseenter",()=>{this.#l=setTimeout(()=>{this.#l=null,this.#Z.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},A)},{signal:l}),I.addEventListener("mouseleave",()=>{this.#l&&(clearTimeout(this.#l),this.#l=null),this.#Z?.classList.remove("show")},{signal:l})}this.#g?g.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(g.removeAttribute("data-l10n-id"),g.textContent=this.#I),g.parentNode||I.append(g),this.#c.getElementForAltText()?.setAttribute("aria-describedby",g.id)}}class pg{#I=null;#g=!1;#C=null;#A=null;#Z=null;#l=null;#i=!1;constructor(I){this.#C=I,this.toolbar=null}render(){if(!this.#C._uiManager.hasCommentManager())return null;const I=this.#I=document.createElement("button");I.className="comment",I.tabIndex="0",I.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button");const g=this.#C._uiManager._signal;I.addEventListener("contextmenu",hI,{signal:g}),I.addEventListener("pointerdown",A=>A.stopPropagation(),{signal:g});const C=A=>{A.preventDefault(),this.edit()};return I.addEventListener("click",C,{capture:!0,signal:g}),I.addEventListener("keydown",A=>{A.target===I&&A.key==="Enter"&&(this.#g=!0,C(A))},{signal:g}),I}edit(){const{bottom:I,left:g,right:C}=this.#C.getClientDimensions(),A={top:I};this.#C._uiManager.direction==="ltr"?A.right=C:A.left=g,this.#C._uiManager.editComment(this.#C,A)}finish(){this.#I&&(this.#I.focus({focusVisible:this.#g}),this.#g=!1)}isDeleted(){return this.#i||this.#Z===""}hasBeenEdited(){return this.isDeleted()||this.#Z!==this.#A}serialize(){return this.data}get data(){return{text:this.#Z,date:this.#l,deleted:this.#i}}set data(I){if(I===null){this.#Z="",this.#i=!0;return}this.#Z=I,this.#l=new Date,this.#i=!1}setInitialText(I){this.#A=I,this.data=I}toggle(I=!1){this.#I&&(this.#I.disabled=!I)}shown(){}destroy(){this.#I?.remove(),this.#I=null,this.#Z="",this.#l=null,this.#C=null,this.#g=!1,this.#i=!1}}class Fg{#I;#g=!1;#C=null;#A;#Z;#l;#i;#d=null;#c;#G=null;#m;#s=null;constructor({container:I,isPinchingDisabled:g=null,isPinchingStopped:C=null,onPinchStart:A=null,onPinching:l=null,onPinchEnd:Z=null,signal:i}){this.#I=I,this.#C=C,this.#A=g,this.#Z=A,this.#l=l,this.#i=Z,this.#m=new AbortController,this.#c=AbortSignal.any([i,this.#m.signal]),I.addEventListener("touchstart",this.#W.bind(this),{passive:!1,signal:this.#c})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/nI.pixelRatio}#W(I){if(this.#A?.())return;if(I.touches.length===1){if(this.#d)return;const A=this.#d=new AbortController,l=AbortSignal.any([this.#c,A.signal]),Z=this.#I,i={capture:!0,signal:l,passive:!1},d=s=>{s.pointerType==="touch"&&(this.#d?.abort(),this.#d=null)};Z.addEventListener("pointerdown",s=>{s.pointerType==="touch"&&(II(s),d(s))},i),Z.addEventListener("pointerup",d,i),Z.addEventListener("pointercancel",d,i);return}if(!this.#s){this.#s=new AbortController;const A=AbortSignal.any([this.#c,this.#s.signal]),l=this.#I,Z={signal:A,capture:!1,passive:!1};l.addEventListener("touchmove",this.#w.bind(this),Z);const i=this.#B.bind(this);l.addEventListener("touchend",i,Z),l.addEventListener("touchcancel",i,Z),Z.capture=!0,l.addEventListener("pointerdown",II,Z),l.addEventListener("pointermove",II,Z),l.addEventListener("pointercancel",II,Z),l.addEventListener("pointerup",II,Z),this.#Z?.()}if(II(I),I.touches.length!==2||this.#C?.()){this.#G=null;return}let[g,C]=I.touches;g.identifier>C.identifier&&([g,C]=[C,g]),this.#G={touch0X:g.screenX,touch0Y:g.screenY,touch1X:C.screenX,touch1Y:C.screenY}}#w(I){if(!this.#G||I.touches.length!==2)return;II(I);let[g,C]=I.touches;g.identifier>C.identifier&&([g,C]=[C,g]);const{screenX:A,screenY:l}=g,{screenX:Z,screenY:i}=C,d=this.#G,{touch0X:s,touch0Y:G,touch1X:b,touch1Y:m}=d,B=b-s,o=m-G,W=Z-A,Y=i-l,w=Math.hypot(W,Y)||1,a=Math.hypot(B,o)||1;if(!this.#g&&Math.abs(a-w)<=Fg.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(d.touch0X=A,d.touch0Y=l,d.touch1X=Z,d.touch1Y=i,!this.#g){this.#g=!0;return}const h=[(A+Z)/2,(l+i)/2];this.#l?.(h,a,w)}#B(I){I.touches.length>=2||(this.#s&&(this.#s.abort(),this.#s=null,this.#i?.()),this.#G&&(II(I),this.#G=null,this.#g=!1))}destroy(){this.#m?.abort(),this.#m=null,this.#d?.abort(),this.#d=null}}class D{#I=null;#g=null;#C=null;#A=null;#Z=!1;#l=null;#i="";#d=!1;#c=null;#G=null;#m=null;#s=null;#W="";#w=!1;#B=null;#b=!1;#o=!1;#a=!1;#Y=null;#N=0;#R=0;#h=null;#n=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#t=!1;#X=D._zIndex++;static _borderLineWidth=-1;static _colorManager=new ZC;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const I=D.prototype._resizeWithKeyboard,g=JI.TRANSLATE_SMALL,C=JI.TRANSLATE_BIG;return J(this,"_resizerKeyboardManager",new mg([[["ArrowLeft","mac+ArrowLeft"],I,{args:[-g,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],I,{args:[-C,0]}],[["ArrowRight","mac+ArrowRight"],I,{args:[g,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],I,{args:[C,0]}],[["ArrowUp","mac+ArrowUp"],I,{args:[0,-g]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],I,{args:[0,-C]}],[["ArrowDown","mac+ArrowDown"],I,{args:[0,g]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],I,{args:[0,C]}],[["Escape","mac+Escape"],D.prototype._stopResizingWithKeyboard]]))}constructor(I){this.parent=I.parent,this.id=I.id,this.width=this.height=null,this.pageIndex=I.parent.pageIndex,this.name=I.name,this.div=null,this._uiManager=I.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=I.isCentered,this._structTreeParentId=null,this.annotationElementId=I.annotationElementId||null;const{rotation:g,rawDims:{pageWidth:C,pageHeight:A,pageX:l,pageY:Z}}=this.parent.viewport;this.rotation=g,this.pageRotation=(360+g-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[C,A],this.pageTranslation=[l,Z];const[i,d]=this.parentDimensions;this.x=I.x/i,this.y=I.y/d,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return J(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(I){const g=new Cl({id:I.parent.getNextId(),parent:I.parent,uiManager:I._uiManager});g.annotationElementId=I.annotationElementId,g.deleted=!0,g._uiManager.addToAnnotationStorage(g)}static initialize(I,g){if(D._l10n??=I,D._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),D._borderLineWidth!==-1)return;const C=getComputedStyle(document.documentElement);D._borderLineWidth=parseFloat(C.getPropertyValue("--outline-width"))||0}static updateDefaultParams(I,g){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(I){return!1}static paste(I,g){j("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#t}set _isDraggable(I){this.#t=I,this.div?.classList.toggle("draggable",I)}get isEnterHandled(){return!0}center(){const[I,g]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*g/(I*2),this.y+=this.width*I/(g*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*g/(I*2),this.y-=this.width*I/(g*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(I){this._uiManager.addCommands(I)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#X}setParent(I){I!==null?(this.pageIndex=I.pageIndex,this.pageDimensions=I.pageDimensions):this.#U(),this.parent=I}focusin(I){this._focusEventsAllowed&&(this.#w?this.#w=!1:this.parent.setSelected(this))}focusout(I){!this._focusEventsAllowed||!this.isAttachedToDOM||I.relatedTarget?.closest(`#${this.id}`)||(I.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(I,g,C,A){const[l,Z]=this.parentDimensions;[C,A]=this.screenToPageTranslation(C,A),this.x=(I+C)/l,this.y=(g+A)/Z,this.fixAndSetPosition()}_moveAfterPaste(I,g){const[C,A]=this.parentDimensions;this.setAt(I*C,g*A,this.width*C,this.height*A),this._onTranslated()}#e([I,g],C,A){[C,A]=this.screenToPageTranslation(C,A),this.x+=C/I,this.y+=A/g,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(I,g){this.#e(this.parentDimensions,I,g)}translateInPage(I,g){this.#B||=[this.x,this.y,this.width,this.height],this.#e(this.pageDimensions,I,g),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(I,g){this.#B||=[this.x,this.y,this.width,this.height];const{div:C,parentDimensions:[A,l]}=this;if(this.x+=I/A,this.y+=g/l,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:b,y:m}=this.div.getBoundingClientRect();this.parent.findNewParent(this,b,m)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:Z,y:i}=this;const[d,s]=this.getBaseTranslation();Z+=d,i+=s;const{style:G}=C;G.left=`${(100*Z).toFixed(2)}%`,G.top=`${(100*i).toFixed(2)}%`,this._onTranslating(Z,i),C.scrollIntoView({block:"nearest"})}_onTranslating(I,g){}_onTranslated(I,g){}get _hasBeenMoved(){return!!this.#B&&(this.#B[0]!==this.x||this.#B[1]!==this.y)}get _hasBeenResized(){return!!this.#B&&(this.#B[2]!==this.width||this.#B[3]!==this.height)}getBaseTranslation(){const[I,g]=this.parentDimensions,{_borderLineWidth:C}=D,A=C/I,l=C/g;switch(this.rotation){case 90:return[-A,l];case 180:return[A,l];case 270:return[A,-l];default:return[-A,-l]}}get _mustFixPosition(){return!0}fixAndSetPosition(I=this.rotation){const{div:{style:g},pageDimensions:[C,A]}=this;let{x:l,y:Z,width:i,height:d}=this;if(i*=C,d*=A,l*=C,Z*=A,this._mustFixPosition)switch(I){case 0:l=GI(l,0,C-i),Z=GI(Z,0,A-d);break;case 90:l=GI(l,0,C-d),Z=GI(Z,i,A);break;case 180:l=GI(l,i,C),Z=GI(Z,d,A);break;case 270:l=GI(l,d,C),Z=GI(Z,0,A-i);break}this.x=l/=C,this.y=Z/=A;const[s,G]=this.getBaseTranslation();l+=s,Z+=G,g.left=`${(100*l).toFixed(2)}%`,g.top=`${(100*Z).toFixed(2)}%`,this.moveInDOM()}static#u(I,g,C){switch(C){case 90:return[g,-I];case 180:return[-I,-g];case 270:return[-g,I];default:return[I,g]}}screenToPageTranslation(I,g){return D.#u(I,g,this.parentRotation)}pageTranslationToScreen(I,g){return D.#u(I,g,360-this.parentRotation)}#M(I){switch(I){case 90:{const[g,C]=this.pageDimensions;return[0,-g/C,C/g,0]}case 180:return[-1,0,0,-1];case 270:{const[g,C]=this.pageDimensions;return[0,g/C,-C/g,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:I,pageDimensions:[g,C]}=this;return[g*I,C*I]}setDims(I,g){const[C,A]=this.parentDimensions,{style:l}=this.div;l.width=`${(100*I/C).toFixed(2)}%`,this.#d||(l.height=`${(100*g/A).toFixed(2)}%`)}fixDims(){const{style:I}=this.div,{height:g,width:C}=I,A=C.endsWith("%"),l=!this.#d&&g.endsWith("%");if(A&&l)return;const[Z,i]=this.parentDimensions;A||(I.width=`${(100*parseFloat(C)/Z).toFixed(2)}%`),!this.#d&&!l&&(I.height=`${(100*parseFloat(g)/i).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#H(){if(this.#c)return;this.#c=document.createElement("div"),this.#c.classList.add("resizers");const I=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],g=this._uiManager._signal;for(const C of I){const A=document.createElement("div");this.#c.append(A),A.classList.add("resizer",C),A.setAttribute("data-resizer-name",C),A.addEventListener("pointerdown",this.#K.bind(this,C),{signal:g}),A.addEventListener("contextmenu",hI,{signal:g}),A.tabIndex=-1}this.div.prepend(this.#c)}#K(I,g){g.preventDefault();const{isMac:C}=ZI.platform;if(g.button!==0||g.ctrlKey&&C)return;this.#C?.toggle(!1);const A=this._isDraggable;this._isDraggable=!1,this.#G=[g.screenX,g.screenY];const l=new AbortController,Z=this._uiManager.combinedSignal(l);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#Q.bind(this,I),{passive:!0,capture:!0,signal:Z}),window.addEventListener("touchmove",II,{passive:!1,signal:Z}),window.addEventListener("contextmenu",hI,{signal:Z}),this.#m={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const i=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(g.target).cursor;const s=()=>{l.abort(),this.parent.togglePointerEvents(!0),this.#C?.toggle(!0),this._isDraggable=A,this.parent.div.style.cursor=i,this.div.style.cursor=d,this.#S()};window.addEventListener("pointerup",s,{signal:Z}),window.addEventListener("blur",s,{signal:Z})}#J(I,g,C,A){this.width=C,this.height=A,this.x=I,this.y=g;const[l,Z]=this.parentDimensions;this.setDims(l*C,Z*A),this.fixAndSetPosition(),this._onResized()}_onResized(){}#S(){if(!this.#m)return;const{savedX:I,savedY:g,savedWidth:C,savedHeight:A}=this.#m;this.#m=null;const l=this.x,Z=this.y,i=this.width,d=this.height;l===I&&Z===g&&i===C&&d===A||this.addCommands({cmd:this.#J.bind(this,l,Z,i,d),undo:this.#J.bind(this,I,g,C,A),mustExec:!0})}static _round(I){return Math.round(I*1e4)/1e4}#Q(I,g){const[C,A]=this.parentDimensions,l=this.x,Z=this.y,i=this.width,d=this.height,s=D.MIN_SIZE/C,G=D.MIN_SIZE/A,b=this.#M(this.rotation),m=(M,u)=>[b[0]*M+b[2]*u,b[1]*M+b[3]*u],B=this.#M(360-this.rotation),o=(M,u)=>[B[0]*M+B[2]*u,B[1]*M+B[3]*u];let W,Y,w=!1,a=!1;switch(I){case"topLeft":w=!0,W=(M,u)=>[0,0],Y=(M,u)=>[M,u];break;case"topMiddle":W=(M,u)=>[M/2,0],Y=(M,u)=>[M/2,u];break;case"topRight":w=!0,W=(M,u)=>[M,0],Y=(M,u)=>[0,u];break;case"middleRight":a=!0,W=(M,u)=>[M,u/2],Y=(M,u)=>[0,u/2];break;case"bottomRight":w=!0,W=(M,u)=>[M,u],Y=(M,u)=>[0,0];break;case"bottomMiddle":W=(M,u)=>[M/2,u],Y=(M,u)=>[M/2,0];break;case"bottomLeft":w=!0,W=(M,u)=>[0,u],Y=(M,u)=>[M,0];break;case"middleLeft":a=!0,W=(M,u)=>[0,u/2],Y=(M,u)=>[M,u/2];break}const h=W(i,d),N=Y(i,d);let V=m(...N);const R=D._round(l+V[0]),X=D._round(Z+V[1]);let n=1,y=1,K,e;if(g.fromKeyboard)({deltaX:K,deltaY:e}=g);else{const{screenX:M,screenY:u}=g,[NI,pI]=this.#G;[K,e]=this.screenToPageTranslation(M-NI,u-pI),this.#G[0]=M,this.#G[1]=u}if([K,e]=o(K/C,e/A),w){const M=Math.hypot(i,d);n=y=Math.max(Math.min(Math.hypot(N[0]-h[0]-K,N[1]-h[1]-e)/M,1/i,1/d),s/i,G/d)}else a?n=GI(Math.abs(N[0]-h[0]-K),s,1)/i:y=GI(Math.abs(N[1]-h[1]-e),G,1)/d;const T=D._round(i*n),O=D._round(d*y);V=m(...Y(T,O));const L=R-V[0],mI=X-V[1];this.#B||=[this.x,this.y,this.width,this.height],this.width=T,this.height=O,this.x=L,this.y=mI,this.setDims(C*T,A*O),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#C?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#o)return this._editToolbar;this._editToolbar=new bg(this),this.div.append(this._editToolbar.render()),this._editToolbar.addButton("comment",this.addCommentButton());const{toolbarButtons:I}=this;if(I)for(const[g,C]of I)await this._editToolbar.addButton(g,C);return this._editToolbar.addButton("delete"),this._editToolbar}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#C?.destroy())}addContainer(I){const g=this._editToolbar?.div;g?g.before(I):this.div.append(I)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#C||(yI.initialize(D._l10n),this.#C=new yI(this),this.#I&&(this.#C.data=this.#I,this.#I=null)),this.#C}get altTextData(){return this.#C?.data}set altTextData(I){this.#C&&(this.#C.data=I)}get guessedAltText(){return this.#C?.guessedText}async setGuessedAltText(I){await this.#C?.setGuessedText(I)}serializeAltText(I){return this.#C?.serialize(I)}hasAltText(){return!!this.#C&&!this.#C.isEmpty()}hasAltTextData(){return this.#C?.hasData()??!1}addCommentButton(){return this.#A?this.#A:this.#A=new pg(this)}get commentColor(){return null}get comment(){const I=this.#A;return{text:I.data.text,date:I.data.date,deleted:I.isDeleted(),color:this.commentColor}}set comment(I){this.#A||(this.#A=new pg(this)),this.#A.data=I}setCommentData(I){this.#A||(this.#A=new pg(this)),this.#A.setInitialText(I)}get hasEditedComment(){return this.#A?.hasBeenEdited()}async editComment(){this.#A||(this.#A=new pg(this)),this.#A.edit()}addComment(I){this.hasEditedComment&&(I.popup={contents:this.comment.text,deleted:this.comment.deleted})}render(){const I=this.div=document.createElement("div");I.setAttribute("data-editor-rotation",(360-this.rotation)%360),I.className=this.name,I.setAttribute("id",this.id),I.tabIndex=this.#Z?-1:0,I.setAttribute("role","application"),this.defaultL10nId&&I.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||I.classList.add("hidden"),this.setInForeground(),this.#x();const[g,C]=this.parentDimensions;this.parentRotation%180!==0&&(I.style.maxWidth=`${(100*C/g).toFixed(2)}%`,I.style.maxHeight=`${(100*g/C).toFixed(2)}%`);const[A,l]=this.getInitialTranslation();return this.translate(A,l),TC(this,I,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#n||=new Fg({container:I,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#y.bind(this),onPinching:this.#V.bind(this),onPinchEnd:this.#k.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),I}#y(){this.#m={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#C?.toggle(!1),this.parent.togglePointerEvents(!1)}#V(I,g,C){let l=.7*(C/g)+1-.7;if(l===1)return;const Z=this.#M(this.rotation),i=(R,X)=>[Z[0]*R+Z[2]*X,Z[1]*R+Z[3]*X],[d,s]=this.parentDimensions,G=this.x,b=this.y,m=this.width,B=this.height,o=D.MIN_SIZE/d,W=D.MIN_SIZE/s;l=Math.max(Math.min(l,1/m,1/B),o/m,W/B);const Y=D._round(m*l),w=D._round(B*l);if(Y===m&&w===B)return;this.#B||=[G,b,m,B];const a=i(m/2,B/2),h=D._round(G+a[0]),N=D._round(b+a[1]),V=i(Y/2,w/2);this.x=h-V[0],this.y=N-V[1],this.width=Y,this.height=w,this.setDims(d*Y,s*w),this.fixAndSetPosition(),this._onResizing()}#k(){this.#C?.toggle(!0),this.parent.togglePointerEvents(!0),this.#S()}pointerdown(I){const{isMac:g}=ZI.platform;if(I.button!==0||I.ctrlKey&&g){I.preventDefault();return}if(this.#w=!0,this._isDraggable){this.#j(I);return}this.#L(I)}#L(I){const{isMac:g}=ZI.platform;I.ctrlKey&&!g||I.shiftKey||I.metaKey&&g?this.parent.toggleSelected(this):this.parent.setSelected(this)}#j(I){const{isSelected:g}=this;this._uiManager.setUpDragSession();let C=!1;const A=new AbortController,l=this._uiManager.combinedSignal(A),Z={capture:!0,passive:!1,signal:l},i=s=>{A.abort(),this.#l=null,this.#w=!1,this._uiManager.endDragSession()||this.#L(s),C&&this._onStopDragging()};g&&(this.#N=I.clientX,this.#R=I.clientY,this.#l=I.pointerId,this.#i=I.pointerType,window.addEventListener("pointermove",s=>{C||(C=!0,this._onStartDragging());const{clientX:G,clientY:b,pointerId:m}=s;if(m!==this.#l){II(s);return}const[B,o]=this.screenToPageTranslation(G-this.#N,b-this.#R);this.#N=G,this.#R=b,this._uiManager.dragSelectedEditors(B,o)},Z),window.addEventListener("touchmove",II,Z),window.addEventListener("pointerdown",s=>{s.pointerType===this.#i&&(this.#n||s.isPrimary)&&i(s),II(s)},Z));const d=s=>{if(!this.#l||this.#l===s.pointerId){i(s);return}II(s)};window.addEventListener("pointerup",d,{signal:l}),window.addEventListener("blur",d,{signal:l})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#Y&&clearTimeout(this.#Y),this.#Y=setTimeout(()=>{this.#Y=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(I,g,C){I.changeParent(this),this.x=g,this.y=C,this.fixAndSetPosition(),this._onTranslated()}getRect(I,g,C=this.rotation){const A=this.parentScale,[l,Z]=this.pageDimensions,[i,d]=this.pageTranslation,s=I/A,G=g/A,b=this.x*l,m=this.y*Z,B=this.width*l,o=this.height*Z;switch(C){case 0:return[b+s+i,Z-m-G-o+d,b+s+B+i,Z-m-G+d];case 90:return[b+G+i,Z-m+s+d,b+G+o+i,Z-m+s+B+d];case 180:return[b-s-B+i,Z-m+G+d,b-s+i,Z-m+G+o+d];case 270:return[b-G-o+i,Z-m-s-B+d,b-G+i,Z-m-s+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(I,g){const[C,A,l,Z]=I,i=l-C,d=Z-A;switch(this.rotation){case 0:return[C,g-Z,i,d];case 90:return[C,g-A,d,i];case 180:return[l,g-A,i,d];case 270:return[l,g-Z,d,i];default:throw new Error("Invalid rotation")}}onceAdded(I){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#o=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#o=!1,!0):!1}isInEditMode(){return this.#o}shouldGetKeyboardEvents(){return this.#a}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:I,left:g,bottom:C,right:A}=this.getClientDimensions(),{innerHeight:l,innerWidth:Z}=window;return g<Z&&A>0&&I<l&&C>0}#x(){if(this.#s||!this.div)return;this.#s=new AbortController;const I=this._uiManager.combinedSignal(this.#s);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:I}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:I})}rebuild(){this.#x()}rotate(I){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(I=!1,g=null){j("An editor must be serializable")}static async deserialize(I,g,C){const A=new this.prototype.constructor({parent:g,id:g.getNextId(),uiManager:C,annotationElementId:I.annotationElementId});A.rotation=I.rotation,A.#I=I.accessibilityData,A._isCopy=I.isCopy||!1;const[l,Z]=A.pageDimensions,[i,d,s,G]=A.getRectInCurrentCoords(I.rect,Z);return A.x=i/l,A.y=d/Z,A.width=s/l,A.height=G/Z,A}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#s?.abort(),this.#s=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#Y&&(clearTimeout(this.#Y),this.#Y=null),this.#U(),this.removeEditToolbar(),this.#h){for(const I of this.#h.values())clearTimeout(I);this.#h=null}this.parent=null,this.#n?.destroy(),this.#n=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#H(),this.#c.classList.remove("hidden"))}get toolbarPosition(){return null}keydown(I){if(!this.isResizable||I.target!==this.div||I.key!=="Enter")return;this._uiManager.setSelected(this),this.#m={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const g=this.#c.children;if(!this.#g){this.#g=Array.from(g);const Z=this.#v.bind(this),i=this.#O.bind(this),d=this._uiManager._signal;for(const s of this.#g){const G=s.getAttribute("data-resizer-name");s.setAttribute("role","spinbutton"),s.addEventListener("keydown",Z,{signal:d}),s.addEventListener("blur",i,{signal:d}),s.addEventListener("focus",this.#p.bind(this,G),{signal:d}),s.setAttribute("data-l10n-id",D._l10nResizer[G])}}const C=this.#g[0];let A=0;for(const Z of g){if(Z===C)break;A++}const l=(360-this.rotation+this.parentRotation)%360/90*(this.#g.length/4);if(l!==A){if(l<A)for(let i=0;i<A-l;i++)this.#c.append(this.#c.firstChild);else if(l>A)for(let i=0;i<l-A;i++)this.#c.firstChild.before(this.#c.lastChild);let Z=0;for(const i of g){const s=this.#g[Z++].getAttribute("data-resizer-name");i.setAttribute("data-l10n-id",D._l10nResizer[s])}}this.#F(0),this.#a=!0,this.#c.firstChild.focus({focusVisible:!0}),I.preventDefault(),I.stopImmediatePropagation()}#v(I){D._resizerKeyboardManager.exec(this,I)}#O(I){this.#a&&I.relatedTarget?.parentNode!==this.#c&&this.#U()}#p(I){this.#W=this.#a?I:""}#F(I){if(this.#g)for(const g of this.#g)g.tabIndex=I}_resizeWithKeyboard(I,g){this.#a&&this.#Q(this.#W,{deltaX:I,deltaY:g,fromKeyboard:!0})}#U(){this.#a=!1,this.#F(-1),this.#S()}_stopResizingWithKeyboard(){this.#U(),this.div.focus()}select(){if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#C?.toggleAltTextBadge(!1)}}unselect(){this.isSelected&&(this.isSelected=!1,this.#c?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#C?.toggleAltTextBadge(!0))}updateParams(I,g){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(I){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#b}set isEditing(I){this.#b=I,this.parent&&(I?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(I,g){this.#d=!0;const C=I/g,{style:A}=this.div;A.aspectRatio=C,A.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(I,g=!1){if(g){this.#h||=new Map;const{action:C}=I;let A=this.#h.get(C);A&&clearTimeout(A),A=setTimeout(()=>{this._reportTelemetry(I),this.#h.delete(C),this.#h.size===0&&(this.#h=null)},D._telemetryTimeout),this.#h.set(C,A);return}I.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:I}})}show(I=this._isVisible){this.div.classList.toggle("hidden",!I),this._isVisible=I}enable(){this.div&&(this.div.tabIndex=0),this.#Z=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#Z=!0}renderAnnotationElement(I){let g=I.container.querySelector(".annotationContent");if(!g)g=document.createElement("div"),g.classList.add("annotationContent",this.editorType),I.container.prepend(g);else if(g.nodeName==="CANVAS"){const C=g;g=document.createElement("div"),g.classList.add("annotationContent",this.editorType),C.before(g)}return g}resetAnnotationElement(I){const{firstChild:g}=I.container;g?.nodeName==="DIV"&&g.classList.contains("annotationContent")&&g.remove()}}class Cl extends D{constructor(I){super(I),this.annotationElementId=I.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const QC=3285377520,aI=4294901760,HI=65535;class jC{constructor(I){this.h1=I?I&4294967295:QC,this.h2=I?I&4294967295:QC}update(I){let g,C;if(typeof I=="string"){g=new Uint8Array(I.length*2),C=0;for(let W=0,Y=I.length;W<Y;W++){const w=I.charCodeAt(W);w<=255?g[C++]=w:(g[C++]=w>>>8,g[C++]=w&255)}}else if(ArrayBuffer.isView(I))g=I.slice(),C=g.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const A=C>>2,l=C-A*4,Z=new Uint32Array(g.buffer,0,A);let i=0,d=0,s=this.h1,G=this.h2;const b=3432918353,m=461845907,B=b&HI,o=m&HI;for(let W=0;W<A;W++)W&1?(i=Z[W],i=i*b&aI|i*B&HI,i=i<<15|i>>>17,i=i*m&aI|i*o&HI,s^=i,s=s<<13|s>>>19,s=s*5+3864292196):(d=Z[W],d=d*b&aI|d*B&HI,d=d<<15|d>>>17,d=d*m&aI|d*o&HI,G^=d,G=G<<13|G>>>19,G=G*5+3864292196);switch(i=0,l){case 3:i^=g[A*4+2]<<16;case 2:i^=g[A*4+1]<<8;case 1:i^=g[A*4],i=i*b&aI|i*B&HI,i=i<<15|i>>>17,i=i*m&aI|i*o&HI,A&1?s^=i:G^=i}this.h1=s,this.h2=G}hexdigest(){let I=this.h1,g=this.h2;return I^=g>>>1,I=I*3981806797&aI|I*36045&HI,g=g*4283543511&aI|((g<<16|I>>>16)*2950163797&aI)>>>16,I^=g>>>1,I=I*444984403&aI|I*60499&HI,g=g*3301882366&aI|((g<<16|I>>>16)*3120437893&aI)>>>16,I^=g>>>1,(I>>>0).toString(16).padStart(8,"0")+(g>>>0).toString(16).padStart(8,"0")}}const iC=Object.freeze({map:null,hash:"",transfer:void 0});class dC{#I=!1;#g=null;#C=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(I,g){const C=this.#C.get(I);return C===void 0?g:Object.assign(g,C)}getRawValue(I){return this.#C.get(I)}remove(I){if(this.#C.delete(I),this.#C.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const g of this.#C.values())if(g instanceof D)return;this.onAnnotationEditor(null)}}setValue(I,g){const C=this.#C.get(I);let A=!1;if(C!==void 0)for(const[l,Z]of Object.entries(g))C[l]!==Z&&(A=!0,C[l]=Z);else A=!0,this.#C.set(I,g);A&&this.#A(),g instanceof D&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(g.constructor._type)}has(I){return this.#C.has(I)}get size(){return this.#C.size}#A(){this.#I||(this.#I=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#I&&(this.#I=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new OC(this)}get serializable(){if(this.#C.size===0)return iC;const I=new Map,g=new jC,C=[],A=Object.create(null);let l=!1;for(const[Z,i]of this.#C){const d=i instanceof D?i.serialize(!1,A):i;d&&(I.set(Z,d),g.update(`${Z}:${JSON.stringify(d)}`),l||=!!d.bitmap)}if(l)for(const Z of I.values())Z.bitmap&&C.push(Z.bitmap);return I.size>0?{map:I,hash:g.hexdigest(),transfer:C}:iC}get editorStats(){let I=null;const g=new Map;for(const C of this.#C.values()){if(!(C instanceof D))continue;const A=C.telemetryFinalData;if(!A)continue;const{type:l}=A;g.has(l)||g.set(l,Object.getPrototypeOf(C).constructor),I||=Object.create(null);const Z=I[l]||=new Map;for(const[i,d]of Object.entries(A)){if(i==="type")continue;let s=Z.get(i);s||(s=new Map,Z.set(i,s));const G=s.get(d)??0;s.set(d,G+1)}}for(const[C,A]of g)I[C]=A.computeTelemetryFinalData(I[C]);return I}resetModifiedIds(){this.#g=null}get modifiedIds(){if(this.#g)return this.#g;const I=[];for(const g of this.#C.values())!(g instanceof D)||!g.annotationElementId||!g.serialize()||I.push(g.annotationElementId);return this.#g={ids:new Set(I),hash:I.join(",")}}[Symbol.iterator](){return this.#C.entries()}}class OC extends dC{#I;constructor(I){super();const{map:g,hash:C,transfer:A}=I.serializable,l=structuredClone(g,A?{transfer:A}:null);this.#I={map:l,hash:C,transfer:A}}get print(){j("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#I}get modifiedIds(){return J(this,"modifiedIds",{ids:new Set,hash:""})}}class Al{#I=new Set;constructor({ownerDocument:I=globalThis.document,styleElement:g=null}){this._document=I,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(I){this.nativeFontFaces.add(I),this._document.fonts.add(I)}removeNativeFontFace(I){this.nativeFontFaces.delete(I),this._document.fonts.delete(I)}insertRule(I){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const g=this.styleElement.sheet;g.insertRule(I,g.cssRules.length)}clear(){for(const I of this.nativeFontFaces)this._document.fonts.delete(I);this.nativeFontFaces.clear(),this.#I.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:I,disableFontFace:g,_inspectFont:C}){if(!(!I||this.#I.has(I.loadedName))){if($(!g,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:A,src:l,style:Z}=I,i=new FontFace(A,l,Z);this.addNativeFontFace(i);try{await i.load(),this.#I.add(A),C?.(I)}catch{F(`Cannot load system font: ${I.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(i)}return}j("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(I){if(I.attached||I.missingFile&&!I.systemFontInfo)return;if(I.attached=!0,I.systemFontInfo){await this.loadSystemFont(I);return}if(this.isFontLoadingAPISupported){const C=I.createNativeFontFace();if(C){this.addNativeFontFace(C);try{await C.loaded}catch(A){throw F(`Failed to load font '${C.family}': '${A}'.`),I.disableFontFace=!0,A}}return}const g=I.createFontFaceRule();if(g){if(this.insertRule(g),this.isSyncFontLoadingSupported)return;await new Promise(C=>{const A=this._queueLoadingCallback(C);this._prepareFontLoadEvent(I,A)})}}get isFontLoadingAPISupported(){const I=!!this._document?.fonts;return J(this,"isFontLoadingAPISupported",I)}get isSyncFontLoadingSupported(){return J(this,"isSyncFontLoadingSupported",_||ZI.platform.isFirefox)}_queueLoadingCallback(I){function g(){for($(!A.done,"completeRequest() cannot be called twice."),A.done=!0;C.length>0&&C[0].done;){const l=C.shift();setTimeout(l.callback,0)}}const{loadingRequests:C}=this,A={done:!1,complete:g,callback:I};return C.push(A),A}get _loadTestFont(){const I=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return J(this,"_loadTestFont",I)}_prepareFontLoadEvent(I,g){function C(N,V){return N.charCodeAt(V)<<24|N.charCodeAt(V+1)<<16|N.charCodeAt(V+2)<<8|N.charCodeAt(V+3)&255}function A(N,V,R,X){const n=N.substring(0,V),y=N.substring(V+R);return n+X+y}let l,Z;const i=this._document.createElement("canvas");i.width=1,i.height=1;const d=i.getContext("2d");let s=0;function G(N,V){if(++s>30){F("Load test font never loaded."),V();return}if(d.font="30px "+N,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){V();return}setTimeout(G.bind(null,N,V))}const b=`lt${Date.now()}${this.loadTestFontId++}`;let m=this._loadTestFont;m=A(m,976,b.length,b);const o=16,W=1482184792;let Y=C(m,o);for(l=0,Z=b.length-3;l<Z;l+=4)Y=Y-W+C(b,l)|0;l<b.length&&(Y=Y-W+C(b+"XXX",l)|0),m=A(m,o,4,QA(Y));const w=`url(data:font/opentype;base64,${btoa(m)});`,a=`@font-face {font-family:"${b}";src:${w}}`;this.insertRule(a);const h=this._document.createElement("div");h.style.visibility="hidden",h.style.width=h.style.height="10px",h.style.position="absolute",h.style.top=h.style.left="0px";for(const N of[I.loadedName,b]){const V=this._document.createElement("span");V.textContent="Hi",V.style.fontFamily=N,h.append(V)}this._document.body.append(h),G(b,()=>{h.remove(),g.complete()})}}class ll{constructor(I,g=null){this.compiledGlyphs=Object.create(null);for(const C in I)this[C]=I[C];this._inspectFont=g}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let I;if(!this.cssFontInfo)I=new FontFace(this.loadedName,this.data,{});else{const g={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(g.style=`oblique ${this.cssFontInfo.italicAngle}deg`),I=new FontFace(this.cssFontInfo.fontFamily,this.data,g)}return this._inspectFont?.(this),I}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const I=`url(data:${this.mimetype};base64,${kC(this.data)});`;let g;if(!this.cssFontInfo)g=`@font-face {font-family:"${this.loadedName}";src:${I}}`;else{let C=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(C+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),g=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${C}src:${I}}`}return this._inspectFont?.(this,I),g}getPathGenerator(I,g){if(this.compiledGlyphs[g]!==void 0)return this.compiledGlyphs[g];const C=this.loadedName+"_path_"+g;let A;try{A=I.get(C)}catch(Z){F(`getPathGenerator - ignoring character: "${Z}".`)}const l=new Path2D(A||"");return this.fontExtraProperties||I.delete(C),this.compiledGlyphs[g]=l}}function Zl(c){if(c instanceof URL)return c.href;if(typeof c=="string"){if(_)return c;const I=URL.parse(c,window.location);if(I)return I.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function il(c){if(_&&typeof Buffer<"u"&&c instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(c instanceof Uint8Array&&c.byteLength===c.buffer.byteLength)return c;if(typeof c=="string")return dg(c);if(c instanceof ArrayBuffer||ArrayBuffer.isView(c)||typeof c=="object"&&!isNaN(c?.length))return new Uint8Array(c);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function zg(c){if(typeof c!="string")return null;if(c.endsWith("/"))return c;throw new Error(`Invalid factory url: "${c}" must include trailing slash.`)}const sC=c=>typeof c=="object"&&Number.isInteger(c?.num)&&c.num>=0&&Number.isInteger(c?.gen)&&c.gen>=0,dl=c=>typeof c=="object"&&typeof c?.name=="string",sl=vA.bind(null,sC,dl);class Gl{#I=new Map;#g=Promise.resolve();postMessage(I,g){const C={data:structuredClone(I,g?{transfer:g}:null)};this.#g.then(()=>{for(const[A]of this.#I)A.call(this,C)})}addEventListener(I,g,C=null){let A=null;if(C?.signal instanceof AbortSignal){const{signal:l}=C;if(l.aborted){F("LoopbackPort - cannot use an `aborted` signal.");return}const Z=()=>this.removeEventListener(I,g);A=()=>l.removeEventListener("abort",Z),l.addEventListener("abort",Z)}this.#I.set(g,A)}removeEventListener(I,g){this.#I.get(g)?.(),this.#I.delete(g)}terminate(){for(const[,I]of this.#I)I?.();this.#I.clear()}}const Jg={DATA:1,ERROR:2},gI={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function UC(){}function BI(c){if(c instanceof zI||c instanceof fg||c instanceof pC||c instanceof Dg||c instanceof Pg)return c;switch(c instanceof Error||typeof c=="object"&&c!==null||j('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),c.name){case"AbortException":return new zI(c.message);case"InvalidPDFException":return new fg(c.message);case"PasswordException":return new pC(c.message,c.code);case"ResponseException":return new Dg(c.message,c.status,c.missing);case"UnknownErrorException":return new Pg(c.message,c.details)}return new Pg(c.message,c.toString())}class Bg{#I=new AbortController;constructor(I,g,C){this.sourceName=I,this.targetName=g,this.comObj=C,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),C.addEventListener("message",this.#g.bind(this),{signal:this.#I.signal})}#g({data:I}){if(I.targetName!==this.sourceName)return;if(I.stream){this.#A(I);return}if(I.callback){const C=I.callbackId,A=this.callbackCapabilities[C];if(!A)throw new Error(`Cannot resolve callback ${C}`);if(delete this.callbackCapabilities[C],I.callback===Jg.DATA)A.resolve(I.data);else if(I.callback===Jg.ERROR)A.reject(BI(I.reason));else throw new Error("Unexpected callback case");return}const g=this.actionHandler[I.action];if(!g)throw new Error(`Unknown action from worker: ${I.action}`);if(I.callbackId){const C=this.sourceName,A=I.sourceName,l=this.comObj;Promise.try(g,I.data).then(function(Z){l.postMessage({sourceName:C,targetName:A,callback:Jg.DATA,callbackId:I.callbackId,data:Z})},function(Z){l.postMessage({sourceName:C,targetName:A,callback:Jg.ERROR,callbackId:I.callbackId,reason:BI(Z)})});return}if(I.streamId){this.#C(I);return}g(I.data)}on(I,g){const C=this.actionHandler;if(C[I])throw new Error(`There is already an actionName called "${I}"`);C[I]=g}send(I,g,C){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:I,data:g},C)}sendWithPromise(I,g,C){const A=this.callbackId++,l=Promise.withResolvers();this.callbackCapabilities[A]=l;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:I,callbackId:A,data:g},C)}catch(Z){l.reject(Z)}return l.promise}sendWithStream(I,g,C,A){const l=this.streamId++,Z=this.sourceName,i=this.targetName,d=this.comObj;return new ReadableStream({start:s=>{const G=Promise.withResolvers();return this.streamControllers[l]={controller:s,startCall:G,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:Z,targetName:i,action:I,streamId:l,data:g,desiredSize:s.desiredSize},A),G.promise},pull:s=>{const G=Promise.withResolvers();return this.streamControllers[l].pullCall=G,d.postMessage({sourceName:Z,targetName:i,stream:gI.PULL,streamId:l,desiredSize:s.desiredSize}),G.promise},cancel:s=>{$(s instanceof Error,"cancel must have a valid reason");const G=Promise.withResolvers();return this.streamControllers[l].cancelCall=G,this.streamControllers[l].isClosed=!0,d.postMessage({sourceName:Z,targetName:i,stream:gI.CANCEL,streamId:l,reason:BI(s)}),G.promise}},C)}#C(I){const g=I.streamId,C=this.sourceName,A=I.sourceName,l=this.comObj,Z=this,i=this.actionHandler[I.action],d={enqueue(s,G=1,b){if(this.isCancelled)return;const m=this.desiredSize;this.desiredSize-=G,m>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),l.postMessage({sourceName:C,targetName:A,stream:gI.ENQUEUE,streamId:g,chunk:s},b)},close(){this.isCancelled||(this.isCancelled=!0,l.postMessage({sourceName:C,targetName:A,stream:gI.CLOSE,streamId:g}),delete Z.streamSinks[g])},error(s){$(s instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,l.postMessage({sourceName:C,targetName:A,stream:gI.ERROR,streamId:g,reason:BI(s)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:I.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[g]=d,Promise.try(i,I.data,d).then(function(){l.postMessage({sourceName:C,targetName:A,stream:gI.START_COMPLETE,streamId:g,success:!0})},function(s){l.postMessage({sourceName:C,targetName:A,stream:gI.START_COMPLETE,streamId:g,reason:BI(s)})})}#A(I){const g=I.streamId,C=this.sourceName,A=I.sourceName,l=this.comObj,Z=this.streamControllers[g],i=this.streamSinks[g];switch(I.stream){case gI.START_COMPLETE:I.success?Z.startCall.resolve():Z.startCall.reject(BI(I.reason));break;case gI.PULL_COMPLETE:I.success?Z.pullCall.resolve():Z.pullCall.reject(BI(I.reason));break;case gI.PULL:if(!i){l.postMessage({sourceName:C,targetName:A,stream:gI.PULL_COMPLETE,streamId:g,success:!0});break}i.desiredSize<=0&&I.desiredSize>0&&i.sinkCapability.resolve(),i.desiredSize=I.desiredSize,Promise.try(i.onPull||UC).then(function(){l.postMessage({sourceName:C,targetName:A,stream:gI.PULL_COMPLETE,streamId:g,success:!0})},function(s){l.postMessage({sourceName:C,targetName:A,stream:gI.PULL_COMPLETE,streamId:g,reason:BI(s)})});break;case gI.ENQUEUE:if($(Z,"enqueue should have stream controller"),Z.isClosed)break;Z.controller.enqueue(I.chunk);break;case gI.CLOSE:if($(Z,"close should have stream controller"),Z.isClosed)break;Z.isClosed=!0,Z.controller.close(),this.#Z(Z,g);break;case gI.ERROR:$(Z,"error should have stream controller"),Z.controller.error(BI(I.reason)),this.#Z(Z,g);break;case gI.CANCEL_COMPLETE:I.success?Z.cancelCall.resolve():Z.cancelCall.reject(BI(I.reason)),this.#Z(Z,g);break;case gI.CANCEL:if(!i)break;const d=BI(I.reason);Promise.try(i.onCancel||UC,d).then(function(){l.postMessage({sourceName:C,targetName:A,stream:gI.CANCEL_COMPLETE,streamId:g,success:!0})},function(s){l.postMessage({sourceName:C,targetName:A,stream:gI.CANCEL_COMPLETE,streamId:g,reason:BI(s)})}),i.sinkCapability.reject(d),i.isCancelled=!0,delete this.streamSinks[g];break;default:throw new Error("Unexpected stream case")}}async#Z(I,g){await Promise.allSettled([I.startCall?.promise,I.pullCall?.promise,I.cancelCall?.promise]),delete this.streamControllers[g]}destroy(){this.#I?.abort(),this.#I=null}}class xC{#I=!1;constructor({enableHWA:I=!1}){this.#I=I}create(I,g){if(I<=0||g<=0)throw new Error("Invalid canvas size");const C=this._createCanvas(I,g);return{canvas:C,context:C.getContext("2d",{willReadFrequently:!this.#I})}}reset(I,g,C){if(!I.canvas)throw new Error("Canvas is not specified");if(g<=0||C<=0)throw new Error("Invalid canvas size");I.canvas.width=g,I.canvas.height=C}destroy(I){if(!I.canvas)throw new Error("Canvas is not specified");I.canvas.width=0,I.canvas.height=0,I.canvas=null,I.context=null}_createCanvas(I,g){j("Abstract method `_createCanvas` called.")}}class cl extends xC{constructor({ownerDocument:I=globalThis.document,enableHWA:g=!1}){super({enableHWA:g}),this._document=I}_createCanvas(I,g){const C=this._document.createElement("canvas");return C.width=I,C.height=g,C}}class vC{constructor({baseUrl:I=null,isCompressed:g=!0}){this.baseUrl=I,this.isCompressed=g}async fetch({name:I}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!I)throw new Error("CMap name must be specified.");const g=this.baseUrl+I+(this.isCompressed?".bcmap":"");return this._fetch(g).then(C=>({cMapData:C,isCompressed:this.isCompressed})).catch(C=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${g}`)})}async _fetch(I){j("Abstract method `_fetch` called.")}}class rC extends vC{async _fetch(I){const g=await sg(I,this.isCompressed?"arraybuffer":"text");return g instanceof ArrayBuffer?new Uint8Array(g):dg(g)}}class EC{addFilter(I){return"none"}addHCMFilter(I,g){return"none"}addAlphaFilter(I){return"none"}addLuminosityFilter(I){return"none"}addHighlightHCMFilter(I,g,C,A,l){return"none"}destroy(I=!1){}}class bl extends EC{#I;#g;#C;#A;#Z;#l;#i=0;constructor({docId:I,ownerDocument:g=globalThis.document}){super(),this.#A=I,this.#Z=g}get#d(){return this.#g||=new Map}get#c(){return this.#l||=new Map}get#G(){if(!this.#C){const I=this.#Z.createElement("div"),{style:g}=I;g.visibility="hidden",g.contain="strict",g.width=g.height=0,g.position="absolute",g.top=g.left=0,g.zIndex=-1;const C=this.#Z.createElementNS(DI,"svg");C.setAttribute("width",0),C.setAttribute("height",0),this.#C=this.#Z.createElementNS(DI,"defs"),I.append(C),C.append(this.#C),this.#Z.body.append(I)}return this.#C}#m(I){if(I.length===1){const d=I[0],s=new Array(256);for(let b=0;b<256;b++)s[b]=d[b]/255;const G=s.join(",");return[G,G,G]}const[g,C,A]=I,l=new Array(256),Z=new Array(256),i=new Array(256);for(let d=0;d<256;d++)l[d]=g[d]/255,Z[d]=C[d]/255,i[d]=A[d]/255;return[l.join(","),Z.join(","),i.join(",")]}#s(I){if(this.#I===void 0){this.#I="";const g=this.#Z.URL;g!==this.#Z.baseURI&&(Kg(g)?F('#createUrl: ignore "data:"-URL for performance reasons.'):this.#I=SC(g,""))}return`url(${this.#I}#${I})`}addFilter(I){if(!I)return"none";let g=this.#d.get(I);if(g)return g;const[C,A,l]=this.#m(I),Z=I.length===1?C:`${C}${A}${l}`;if(g=this.#d.get(Z),g)return this.#d.set(I,g),g;const i=`g_${this.#A}_transfer_map_${this.#i++}`,d=this.#s(i);this.#d.set(I,d),this.#d.set(Z,d);const s=this.#B(i);return this.#o(C,A,l,s),d}addHCMFilter(I,g){const C=`${I}-${g}`,A="base";let l=this.#c.get(A);if(l?.key===C||(l?(l.filter?.remove(),l.key=C,l.url="none",l.filter=null):(l={key:C,url:"none",filter:null},this.#c.set(A,l)),!I||!g))return l.url;const Z=this.#Y(I);I=t.makeHexColor(...Z);const i=this.#Y(g);if(g=t.makeHexColor(...i),this.#G.style.color="",I==="#000000"&&g==="#ffffff"||I===g)return l.url;const d=new Array(256);for(let B=0;B<=255;B++){const o=B/255;d[B]=o<=.03928?o/12.92:((o+.055)/1.055)**2.4}const s=d.join(","),G=`g_${this.#A}_hcm_filter`,b=l.filter=this.#B(G);this.#o(s,s,s,b),this.#w(b);const m=(B,o)=>{const W=Z[B]/255,Y=i[B]/255,w=new Array(o+1);for(let a=0;a<=o;a++)w[a]=W+a/o*(Y-W);return w.join(",")};return this.#o(m(0,5),m(1,5),m(2,5),b),l.url=this.#s(G),l.url}addAlphaFilter(I){let g=this.#d.get(I);if(g)return g;const[C]=this.#m([I]),A=`alpha_${C}`;if(g=this.#d.get(A),g)return this.#d.set(I,g),g;const l=`g_${this.#A}_alpha_map_${this.#i++}`,Z=this.#s(l);this.#d.set(I,Z),this.#d.set(A,Z);const i=this.#B(l);return this.#a(C,i),Z}addLuminosityFilter(I){let g=this.#d.get(I||"luminosity");if(g)return g;let C,A;if(I?([C]=this.#m([I]),A=`luminosity_${C}`):A="luminosity",g=this.#d.get(A),g)return this.#d.set(I,g),g;const l=`g_${this.#A}_luminosity_map_${this.#i++}`,Z=this.#s(l);this.#d.set(I,Z),this.#d.set(A,Z);const i=this.#B(l);return this.#W(i),I&&this.#a(C,i),Z}addHighlightHCMFilter(I,g,C,A,l){const Z=`${g}-${C}-${A}-${l}`;let i=this.#c.get(I);if(i?.key===Z||(i?(i.filter?.remove(),i.key=Z,i.url="none",i.filter=null):(i={key:Z,url:"none",filter:null},this.#c.set(I,i)),!g||!C))return i.url;const[d,s]=[g,C].map(this.#Y.bind(this));let G=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),b=Math.round(.2126*s[0]+.7152*s[1]+.0722*s[2]),[m,B]=[A,l].map(this.#Y.bind(this));b<G&&([G,b,m,B]=[b,G,B,m]),this.#G.style.color="";const o=(w,a,h)=>{const N=new Array(256),V=(b-G)/h,R=w/255,X=(a-w)/(255*h);let n=0;for(let y=0;y<=h;y++){const K=Math.round(G+y*V),e=R+y*X;for(let T=n;T<=K;T++)N[T]=e;n=K+1}for(let y=n;y<256;y++)N[y]=N[n-1];return N.join(",")},W=`g_${this.#A}_hcm_${I}_filter`,Y=i.filter=this.#B(W);return this.#w(Y),this.#o(o(m[0],B[0],5),o(m[1],B[1],5),o(m[2],B[2],5),Y),i.url=this.#s(W),i.url}destroy(I=!1){I&&this.#l?.size||(this.#C?.parentNode.parentNode.remove(),this.#C=null,this.#g?.clear(),this.#g=null,this.#l?.clear(),this.#l=null,this.#i=0)}#W(I){const g=this.#Z.createElementNS(DI,"feColorMatrix");g.setAttribute("type","matrix"),g.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),I.append(g)}#w(I){const g=this.#Z.createElementNS(DI,"feColorMatrix");g.setAttribute("type","matrix"),g.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),I.append(g)}#B(I){const g=this.#Z.createElementNS(DI,"filter");return g.setAttribute("color-interpolation-filters","sRGB"),g.setAttribute("id",I),this.#G.append(g),g}#b(I,g,C){const A=this.#Z.createElementNS(DI,g);A.setAttribute("type","discrete"),A.setAttribute("tableValues",C),I.append(A)}#o(I,g,C,A){const l=this.#Z.createElementNS(DI,"feComponentTransfer");A.append(l),this.#b(l,"feFuncR",I),this.#b(l,"feFuncG",g),this.#b(l,"feFuncB",C)}#a(I,g){const C=this.#Z.createElementNS(DI,"feComponentTransfer");g.append(C),this.#b(C,"feFuncA",I)}#Y(I){return this.#G.style.color=I,Sg(getComputedStyle(this.#G).getPropertyValue("color"))}}class PC{constructor({baseUrl:I=null}){this.baseUrl=I}async fetch({filename:I}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!I)throw new Error("Font filename must be specified.");const g=`${this.baseUrl}${I}`;return this._fetch(g).catch(C=>{throw new Error(`Unable to load font data at: ${g}`)})}async _fetch(I){j("Abstract method `_fetch` called.")}}class fC extends PC{async _fetch(I){const g=await sg(I,"arraybuffer");return new Uint8Array(g)}}class _C{constructor({baseUrl:I=null}){this.baseUrl=I}async fetch({filename:I}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!I)throw new Error("Wasm filename must be specified.");const g=`${this.baseUrl}${I}`;return this._fetch(g).catch(C=>{throw new Error(`Unable to load wasm data at: ${g}`)})}async _fetch(I){j("Abstract method `_fetch` called.")}}class qC extends _C{async _fetch(I){const g=await sg(I,"arraybuffer");return new Uint8Array(g)}}_&&F("Please use the `legacy` build in Node.js environments.");async function GC(c){const g=await process.getBuiltinModule("fs").promises.readFile(c);return new Uint8Array(g)}class ml extends EC{}class Bl extends xC{_createCanvas(I,g){return process.getBuiltinModule("module").createRequire(typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:AI&&AI.tagName.toUpperCase()==="SCRIPT"&&AI.src||new URL("vue-pdf-signer.umd.js",document.baseURI).href)("@napi-rs/canvas").createCanvas(I,g)}}class Wl extends vC{async _fetch(I){return GC(I)}}class ol extends PC{async _fetch(I){return GC(I)}}class wl extends _C{async _fetch(I){return GC(I)}}const iI={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function cC(c,I){if(!I)return;const g=I[2]-I[0],C=I[3]-I[1],A=new Path2D;A.rect(I[0],I[1],g,C),c.clip(A)}class bC{isModifyingCurrentTransform(){return!1}getPattern(){j("Abstract method `getPattern` called.")}}class Yl extends bC{constructor(I){super(),this._type=I[1],this._bbox=I[2],this._colorStops=I[3],this._p0=I[4],this._p1=I[5],this._r0=I[6],this._r1=I[7],this.matrix=null}_createGradient(I){let g;this._type==="axial"?g=I.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(g=I.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const C of this._colorStops)g.addColorStop(C[0],C[1]);return g}getPattern(I,g,C,A){let l;if(A===iI.STROKE||A===iI.FILL){const Z=g.current.getClippedPathBoundingBox(A,v(I))||[0,0,0,0],i=Math.ceil(Z[2]-Z[0])||1,d=Math.ceil(Z[3]-Z[1])||1,s=g.cachedCanvases.getCanvas("pattern",i,d),G=s.context;G.clearRect(0,0,G.canvas.width,G.canvas.height),G.beginPath(),G.rect(0,0,G.canvas.width,G.canvas.height),G.translate(-Z[0],-Z[1]),C=t.transform(C,[1,0,0,1,Z[0],Z[1]]),G.transform(...g.baseTransform),this.matrix&&G.transform(...this.matrix),cC(G,this._bbox),G.fillStyle=this._createGradient(G),G.fill(),l=I.createPattern(s.canvas,"no-repeat");const b=new DOMMatrix(C);l.setTransform(b)}else cC(I,this._bbox),l=this._createGradient(I);return l}}function mC(c,I,g,C,A,l,Z,i){const d=I.coords,s=I.colors,G=c.data,b=c.width*4;let m;d[g+1]>d[C+1]&&(m=g,g=C,C=m,m=l,l=Z,Z=m),d[C+1]>d[A+1]&&(m=C,C=A,A=m,m=Z,Z=i,i=m),d[g+1]>d[C+1]&&(m=g,g=C,C=m,m=l,l=Z,Z=m);const B=(d[g]+I.offsetX)*I.scaleX,o=(d[g+1]+I.offsetY)*I.scaleY,W=(d[C]+I.offsetX)*I.scaleX,Y=(d[C+1]+I.offsetY)*I.scaleY,w=(d[A]+I.offsetX)*I.scaleX,a=(d[A+1]+I.offsetY)*I.scaleY;if(o>=a)return;const h=s[l],N=s[l+1],V=s[l+2],R=s[Z],X=s[Z+1],n=s[Z+2],y=s[i],K=s[i+1],e=s[i+2],T=Math.round(o),O=Math.round(a);let L,mI,M,u,NI,pI,PI,uI;for(let lI=T;lI<=O;lI++){if(lI<Y){const r=lI<o?0:(o-lI)/(o-Y);L=B-(B-W)*r,mI=h-(h-R)*r,M=N-(N-X)*r,u=V-(V-n)*r}else{let r;lI>a?r=1:Y===a?r=0:r=(Y-lI)/(Y-a),L=W-(W-w)*r,mI=R-(R-y)*r,M=X-(X-K)*r,u=n-(n-e)*r}let f;lI<o?f=0:lI>a?f=1:f=(o-lI)/(o-a),NI=B-(B-w)*f,pI=h-(h-y)*f,PI=N-(N-K)*f,uI=V-(V-e)*f;const Zg=Math.round(Math.min(L,NI)),LI=Math.round(Math.max(L,NI));let TI=b*lI+Zg*4;for(let r=Zg;r<=LI;r++)f=(L-r)/(L-NI),f<0?f=0:f>1&&(f=1),G[TI++]=mI-(mI-pI)*f|0,G[TI++]=M-(M-PI)*f|0,G[TI++]=u-(u-uI)*f|0,G[TI++]=255}}function hl(c,I,g){const C=I.coords,A=I.colors;let l,Z;switch(I.type){case"lattice":const i=I.verticesPerRow,d=Math.floor(C.length/i)-1,s=i-1;for(l=0;l<d;l++){let G=l*i;for(let b=0;b<s;b++,G++)mC(c,g,C[G],C[G+1],C[G+i],A[G],A[G+1],A[G+i]),mC(c,g,C[G+i+1],C[G+1],C[G+i],A[G+i+1],A[G+1],A[G+i])}break;case"triangles":for(l=0,Z=C.length;l<Z;l+=3)mC(c,g,C[l],C[l+1],C[l+2],A[l],A[l+1],A[l+2]);break;default:throw new Error("illegal figure")}}class al extends bC{constructor(I){super(),this._coords=I[2],this._colors=I[3],this._figures=I[4],this._bounds=I[5],this._bbox=I[6],this._background=I[7],this.matrix=null}_createMeshCanvas(I,g,C){const i=Math.floor(this._bounds[0]),d=Math.floor(this._bounds[1]),s=Math.ceil(this._bounds[2])-i,G=Math.ceil(this._bounds[3])-d,b=Math.min(Math.ceil(Math.abs(s*I[0]*1.1)),3e3),m=Math.min(Math.ceil(Math.abs(G*I[1]*1.1)),3e3),B=s/b,o=G/m,W={coords:this._coords,colors:this._colors,offsetX:-i,offsetY:-d,scaleX:1/B,scaleY:1/o},Y=b+4,w=m+4,a=C.getCanvas("mesh",Y,w),h=a.context,N=h.createImageData(b,m);if(g){const R=N.data;for(let X=0,n=R.length;X<n;X+=4)R[X]=g[0],R[X+1]=g[1],R[X+2]=g[2],R[X+3]=255}for(const R of this._figures)hl(N,R,W);return h.putImageData(N,2,2),{canvas:a.canvas,offsetX:i-2*B,offsetY:d-2*o,scaleX:B,scaleY:o}}isModifyingCurrentTransform(){return!0}getPattern(I,g,C,A){cC(I,this._bbox);const l=new Float32Array(2);if(A===iI.SHADING)t.singularValueDecompose2dScale(v(I),l);else if(this.matrix){t.singularValueDecompose2dScale(this.matrix,l);const[i,d]=l;t.singularValueDecompose2dScale(g.baseTransform,l),l[0]*=i,l[1]*=d}else t.singularValueDecompose2dScale(g.baseTransform,l);const Z=this._createMeshCanvas(l,A===iI.SHADING?null:this._background,g.cachedCanvases);return A!==iI.SHADING&&(I.setTransform(...g.baseTransform),this.matrix&&I.transform(...this.matrix)),I.translate(Z.offsetX,Z.offsetY),I.scale(Z.scaleX,Z.scaleY),I.createPattern(Z.canvas,"no-repeat")}}class Vl extends bC{getPattern(){return"hotpink"}}function Nl(c){switch(c[0]){case"RadialAxial":return new Yl(c);case"Mesh":return new al(c);case"Dummy":return new Vl}throw new Error(`Unknown IR type: ${c[0]}`)}const $C={COLORED:1,UNCOLORED:2};class BC{static MAX_PATTERN_SIZE=3e3;constructor(I,g,C,A){this.color=I[1],this.operatorList=I[2],this.matrix=I[3],this.bbox=I[4],this.xstep=I[5],this.ystep=I[6],this.paintType=I[7],this.tilingType=I[8],this.ctx=g,this.canvasGraphicsFactory=C,this.baseTransform=A}createPatternCanvas(I){const{bbox:g,operatorList:C,paintType:A,tilingType:l,color:Z,canvasGraphicsFactory:i}=this;let{xstep:d,ystep:s}=this;d=Math.abs(d),s=Math.abs(s),eg("TilingType: "+l);const G=g[0],b=g[1],m=g[2],B=g[3],o=m-G,W=B-b,Y=new Float32Array(2);t.singularValueDecompose2dScale(this.matrix,Y);const[w,a]=Y;t.singularValueDecompose2dScale(this.baseTransform,Y);const h=w*Y[0],N=a*Y[1];let V=o,R=W,X=!1,n=!1;const y=Math.ceil(d*h),K=Math.ceil(s*N),e=Math.ceil(o*h),T=Math.ceil(W*N);y>=e?V=d:X=!0,K>=T?R=s:n=!0;const O=this.getSizeAndScale(V,this.ctx.canvas.width,h),L=this.getSizeAndScale(R,this.ctx.canvas.height,N),mI=I.cachedCanvases.getCanvas("pattern",O.size,L.size),M=mI.context,u=i.createCanvasGraphics(M);if(u.groupLevel=I.groupLevel,this.setFillAndStrokeStyleToContext(u,A,Z),M.translate(-O.scale*G,-L.scale*b),u.transform(O.scale,0,0,L.scale,0,0),M.save(),this.clipBbox(u,G,b,m,B),u.baseTransform=v(u.ctx),u.executeOperatorList(C),u.endDrawing(),M.restore(),X||n){const NI=mI.canvas;X&&(V=d),n&&(R=s);const pI=this.getSizeAndScale(V,this.ctx.canvas.width,h),PI=this.getSizeAndScale(R,this.ctx.canvas.height,N),uI=pI.size,lI=PI.size,f=I.cachedCanvases.getCanvas("pattern-workaround",uI,lI),Zg=f.context,LI=X?Math.floor(o/d):0,TI=n?Math.floor(W/s):0;for(let r=0;r<=LI;r++)for(let Xg=0;Xg<=TI;Xg++)Zg.drawImage(NI,uI*r,lI*Xg,uI,lI,0,0,uI,lI);return{canvas:f.canvas,scaleX:pI.scale,scaleY:PI.scale,offsetX:G,offsetY:b}}return{canvas:mI.canvas,scaleX:O.scale,scaleY:L.scale,offsetX:G,offsetY:b}}getSizeAndScale(I,g,C){const A=Math.max(BC.MAX_PATTERN_SIZE,g);let l=Math.ceil(I*C);return l>=A?l=A:C=l/I,{scale:C,size:l}}clipBbox(I,g,C,A,l){const Z=A-g,i=l-C;I.ctx.rect(g,C,Z,i),t.axialAlignedBoundingBox([g,C,A,l],v(I.ctx),I.current.minMax),I.clip(),I.endPath()}setFillAndStrokeStyleToContext(I,g,C){const A=I.ctx,l=I.current;switch(g){case $C.COLORED:const{fillStyle:Z,strokeStyle:i}=this.ctx;A.fillStyle=l.fillColor=Z,A.strokeStyle=l.strokeColor=i;break;case $C.UNCOLORED:A.fillStyle=A.strokeStyle=C,l.fillColor=l.strokeColor=C;break;default:throw new TA(`Unsupported paint type: ${g}`)}}isModifyingCurrentTransform(){return!1}getPattern(I,g,C,A){let l=C;A!==iI.SHADING&&(l=t.transform(l,g.baseTransform),this.matrix&&(l=t.transform(l,this.matrix)));const Z=this.createPatternCanvas(g);let i=new DOMMatrix(l);i=i.translate(Z.offsetX,Z.offsetY),i=i.scale(1/Z.scaleX,1/Z.scaleY);const d=I.createPattern(Z.canvas,"repeat");return d.setTransform(i),d}}function Rl({src:c,srcPos:I=0,dest:g,width:C,height:A,nonBlackColor:l=4294967295,inverseDecode:Z=!1}){const i=ZI.isLittleEndian?4278190080:255,[d,s]=Z?[l,i]:[i,l],G=C>>3,b=C&7,m=c.length;g=new Uint32Array(g.buffer);let B=0;for(let o=0;o<A;o++){for(const Y=I+G;I<Y;I++){const w=I<m?c[I]:255;g[B++]=w&128?s:d,g[B++]=w&64?s:d,g[B++]=w&32?s:d,g[B++]=w&16?s:d,g[B++]=w&8?s:d,g[B++]=w&4?s:d,g[B++]=w&2?s:d,g[B++]=w&1?s:d}if(b===0)continue;const W=I<m?c[I++]:255;for(let Y=0;Y<b;Y++)g[B++]=W&1<<7-Y?s:d}return{srcPos:I,destPos:B}}const IA=16,gA=100,Xl=15,CA=10,WI=16,WC=new DOMMatrix,YI=new Float32Array(2),qI=new Float32Array([1/0,1/0,-1/0,-1/0]);function nl(c,I){if(c._removeMirroring)throw new Error("Context is already forwarding operations.");c.__originalSave=c.save,c.__originalRestore=c.restore,c.__originalRotate=c.rotate,c.__originalScale=c.scale,c.__originalTranslate=c.translate,c.__originalTransform=c.transform,c.__originalSetTransform=c.setTransform,c.__originalResetTransform=c.resetTransform,c.__originalClip=c.clip,c.__originalMoveTo=c.moveTo,c.__originalLineTo=c.lineTo,c.__originalBezierCurveTo=c.bezierCurveTo,c.__originalRect=c.rect,c.__originalClosePath=c.closePath,c.__originalBeginPath=c.beginPath,c._removeMirroring=()=>{c.save=c.__originalSave,c.restore=c.__originalRestore,c.rotate=c.__originalRotate,c.scale=c.__originalScale,c.translate=c.__originalTranslate,c.transform=c.__originalTransform,c.setTransform=c.__originalSetTransform,c.resetTransform=c.__originalResetTransform,c.clip=c.__originalClip,c.moveTo=c.__originalMoveTo,c.lineTo=c.__originalLineTo,c.bezierCurveTo=c.__originalBezierCurveTo,c.rect=c.__originalRect,c.closePath=c.__originalClosePath,c.beginPath=c.__originalBeginPath,delete c._removeMirroring},c.save=function(){I.save(),this.__originalSave()},c.restore=function(){I.restore(),this.__originalRestore()},c.translate=function(g,C){I.translate(g,C),this.__originalTranslate(g,C)},c.scale=function(g,C){I.scale(g,C),this.__originalScale(g,C)},c.transform=function(g,C,A,l,Z,i){I.transform(g,C,A,l,Z,i),this.__originalTransform(g,C,A,l,Z,i)},c.setTransform=function(g,C,A,l,Z,i){I.setTransform(g,C,A,l,Z,i),this.__originalSetTransform(g,C,A,l,Z,i)},c.resetTransform=function(){I.resetTransform(),this.__originalResetTransform()},c.rotate=function(g){I.rotate(g),this.__originalRotate(g)},c.clip=function(g){I.clip(g),this.__originalClip(g)},c.moveTo=function(g,C){I.moveTo(g,C),this.__originalMoveTo(g,C)},c.lineTo=function(g,C){I.lineTo(g,C),this.__originalLineTo(g,C)},c.bezierCurveTo=function(g,C,A,l,Z,i){I.bezierCurveTo(g,C,A,l,Z,i),this.__originalBezierCurveTo(g,C,A,l,Z,i)},c.rect=function(g,C,A,l){I.rect(g,C,A,l),this.__originalRect(g,C,A,l)},c.closePath=function(){I.closePath(),this.__originalClosePath()},c.beginPath=function(){I.beginPath(),this.__originalBeginPath()}}class yl{constructor(I){this.canvasFactory=I,this.cache=Object.create(null)}getCanvas(I,g,C){let A;return this.cache[I]!==void 0?(A=this.cache[I],this.canvasFactory.reset(A,g,C)):(A=this.canvasFactory.create(g,C),this.cache[I]=A),A}delete(I){delete this.cache[I]}clear(){for(const I in this.cache){const g=this.cache[I];this.canvasFactory.destroy(g),delete this.cache[I]}}}function kg(c,I,g,C,A,l,Z,i,d,s){const[G,b,m,B,o,W]=v(c);if(b===0&&m===0){const a=Z*G+o,h=Math.round(a),N=i*B+W,V=Math.round(N),R=(Z+d)*G+o,X=Math.abs(Math.round(R)-h)||1,n=(i+s)*B+W,y=Math.abs(Math.round(n)-V)||1;return c.setTransform(Math.sign(G),0,0,Math.sign(B),h,V),c.drawImage(I,g,C,A,l,0,0,X,y),c.setTransform(G,b,m,B,o,W),[X,y]}if(G===0&&B===0){const a=i*m+o,h=Math.round(a),N=Z*b+W,V=Math.round(N),R=(i+s)*m+o,X=Math.abs(Math.round(R)-h)||1,n=(Z+d)*b+W,y=Math.abs(Math.round(n)-V)||1;return c.setTransform(0,Math.sign(b),Math.sign(m),0,h,V),c.drawImage(I,g,C,A,l,0,0,y,X),c.setTransform(G,b,m,B,o,W),[y,X]}c.drawImage(I,g,C,A,l,Z,i,d,s);const Y=Math.hypot(G,b),w=Math.hypot(m,B);return[Y*d,w*s]}class AA{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=ig;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=sI.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(I,g){this.clipBox=new Float32Array([0,0,I,g]),this.minMax=qI.slice()}clone(){const I=Object.create(this);return I.clipBox=this.clipBox.slice(),I.minMax=this.minMax.slice(),I}getPathBoundingBox(I=iI.FILL,g=null){const C=this.minMax.slice();if(I===iI.STROKE){g||j("Stroke bounding box must include transform."),t.singularValueDecompose2dScale(g,YI);const A=YI[0]*this.lineWidth/2,l=YI[1]*this.lineWidth/2;C[0]-=A,C[1]-=l,C[2]+=A,C[3]+=l}return C}updateClipFromPath(){const I=t.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(I||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(I){this.clipBox.set(I,0),this.minMax.set(qI,0)}getClippedPathBoundingBox(I=iI.FILL,g=null){return t.intersect(this.clipBox,this.getPathBoundingBox(I,g))}}function lA(c,I){if(I instanceof ImageData){c.putImageData(I,0,0);return}const g=I.height,C=I.width,A=g%WI,l=(g-A)/WI,Z=A===0?l:l+1,i=c.createImageData(C,WI);let d=0,s;const G=I.data,b=i.data;let m,B,o,W;if(I.kind===yg.GRAYSCALE_1BPP){const Y=G.byteLength,w=new Uint32Array(b.buffer,0,b.byteLength>>2),a=w.length,h=C+7>>3,N=4294967295,V=ZI.isLittleEndian?4278190080:255;for(m=0;m<Z;m++){for(o=m<l?WI:A,s=0,B=0;B<o;B++){const R=Y-d;let X=0;const n=R>h?C:R*8-7,y=n&-8;let K=0,e=0;for(;X<y;X+=8)e=G[d++],w[s++]=e&128?N:V,w[s++]=e&64?N:V,w[s++]=e&32?N:V,w[s++]=e&16?N:V,w[s++]=e&8?N:V,w[s++]=e&4?N:V,w[s++]=e&2?N:V,w[s++]=e&1?N:V;for(;X<n;X++)K===0&&(e=G[d++],K=128),w[s++]=e&K?N:V,K>>=1}for(;s<a;)w[s++]=0;c.putImageData(i,0,m*WI)}}else if(I.kind===yg.RGBA_32BPP){for(B=0,W=C*WI*4,m=0;m<l;m++)b.set(G.subarray(d,d+W)),d+=W,c.putImageData(i,0,B),B+=WI;m<Z&&(W=C*A*4,b.set(G.subarray(d,d+W)),c.putImageData(i,0,B))}else if(I.kind===yg.RGB_24BPP)for(o=WI,W=C*o,m=0;m<Z;m++){for(m>=l&&(o=A,W=C*o),s=0,B=W;B--;)b[s++]=G[d++],b[s++]=G[d++],b[s++]=G[d++],b[s++]=255;c.putImageData(i,0,m*WI)}else throw new Error(`bad image kind: ${I.kind}`)}function ZA(c,I){if(I.bitmap){c.drawImage(I.bitmap,0,0);return}const g=I.height,C=I.width,A=g%WI,l=(g-A)/WI,Z=A===0?l:l+1,i=c.createImageData(C,WI);let d=0;const s=I.data,G=i.data;for(let b=0;b<Z;b++){const m=b<l?WI:A;({srcPos:d}=Rl({src:s,srcPos:d,dest:G,width:C,height:m,nonBlackColor:0})),c.putImageData(i,0,b*WI)}}function Wg(c,I){const g=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const C of g)c[C]!==void 0&&(I[C]=c[C]);c.setLineDash!==void 0&&(I.setLineDash(c.getLineDash()),I.lineDashOffset=c.lineDashOffset)}function Lg(c){c.strokeStyle=c.fillStyle="#000000",c.fillRule="nonzero",c.globalAlpha=1,c.lineWidth=1,c.lineCap="butt",c.lineJoin="miter",c.miterLimit=10,c.globalCompositeOperation="source-over",c.font="10px sans-serif",c.setLineDash!==void 0&&(c.setLineDash([]),c.lineDashOffset=0);const{filter:I}=c;I!=="none"&&I!==""&&(c.filter="none")}function iA(c,I){if(I)return!0;t.singularValueDecompose2dScale(c,YI);const g=Math.fround(nI.pixelRatio*_I.PDF_TO_CSS_UNITS);return YI[0]<=g&&YI[1]<=g}const Hl=["butt","round","square"],Ml=["miter","round","bevel"],ul={},dA={};class $I{constructor(I,g,C,A,l,{optionalContentConfig:Z,markedContentStack:i=null},d,s){this.ctx=I,this.current=new AA(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=g,this.objs=C,this.canvasFactory=A,this.filterFactory=l,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=i||[],this.optionalContentConfig=Z,this.cachedCanvases=new yl(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=d,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=s,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(I,g=null){return typeof I=="string"?I.startsWith("g_")?this.commonObjs.get(I):this.objs.get(I):g}beginDrawing({transform:I,viewport:g,transparency:C=!1,background:A=null}){const l=this.ctx.canvas.width,Z=this.ctx.canvas.height,i=this.ctx.fillStyle;if(this.ctx.fillStyle=A||"#ffffff",this.ctx.fillRect(0,0,l,Z),this.ctx.fillStyle=i,C){const d=this.cachedCanvases.getCanvas("transparent",l,Z);this.compositeCtx=this.ctx,this.transparentCanvas=d.canvas,this.ctx=d.context,this.ctx.save(),this.ctx.transform(...v(this.compositeCtx))}this.ctx.save(),Lg(this.ctx),I&&(this.ctx.transform(...I),this.outputScaleX=I[0],this.outputScaleY=I[0]),this.ctx.transform(...g.transform),this.viewportScale=g.scale,this.baseTransform=v(this.ctx)}executeOperatorList(I,g,C,A){const l=I.argsArray,Z=I.fnArray;let i=g||0;const d=l.length;if(d===i)return i;const s=d-i>CA&&typeof C=="function",G=s?Date.now()+Xl:0;let b=0;const m=this.commonObjs,B=this.objs;let o;for(;;){if(A!==void 0&&i===A.nextBreakPoint)return A.breakIt(i,C),i;if(o=Z[i],o!==Mg.dependency)this[o].apply(this,l[i]);else for(const W of l[i]){const Y=W.startsWith("g_")?m:B;if(!Y.has(W))return Y.get(W,C),i}if(i++,i===d)return i;if(s&&++b>CA){if(Date.now()>G)return C(),i;b=0}}}#I(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#I(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const I of this._cachedBitmapsMap.values()){for(const g of I.values())typeof HTMLCanvasElement<"u"&&g instanceof HTMLCanvasElement&&(g.width=g.height=0);I.clear()}this._cachedBitmapsMap.clear(),this.#g()}#g(){if(this.pageColors){const I=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(I!=="none"){const g=this.ctx.filter;this.ctx.filter=I,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=g}}}_scaleImage(I,g){const C=I.width??I.displayWidth,A=I.height??I.displayHeight;let l=Math.max(Math.hypot(g[0],g[1]),1),Z=Math.max(Math.hypot(g[2],g[3]),1),i=C,d=A,s="prescale1",G,b;for(;l>2&&i>1||Z>2&&d>1;){let m=i,B=d;l>2&&i>1&&(m=i>=16384?Math.floor(i/2)-1||1:Math.ceil(i/2),l/=i/m),Z>2&&d>1&&(B=d>=16384?Math.floor(d/2)-1||1:Math.ceil(d)/2,Z/=d/B),G=this.cachedCanvases.getCanvas(s,m,B),b=G.context,b.clearRect(0,0,m,B),b.drawImage(I,0,0,i,d,0,0,m,B),I=G.canvas,i=m,d=B,s=s==="prescale1"?"prescale2":"prescale1"}return{img:I,paintWidth:i,paintHeight:d}}_createMaskCanvas(I){const g=this.ctx,{width:C,height:A}=I,l=this.current.fillColor,Z=this.current.patternFill,i=v(g);let d,s,G,b;if((I.bitmap||I.data)&&I.count>1){const y=I.bitmap||I.data.buffer;s=JSON.stringify(Z?i:[i.slice(0,4),l]),d=this._cachedBitmapsMap.get(y),d||(d=new Map,this._cachedBitmapsMap.set(y,d));const K=d.get(s);if(K&&!Z){const e=Math.round(Math.min(i[0],i[2])+i[4]),T=Math.round(Math.min(i[1],i[3])+i[5]);return{canvas:K,offsetX:e,offsetY:T}}G=K}G||(b=this.cachedCanvases.getCanvas("maskCanvas",C,A),ZA(b.context,I));let m=t.transform(i,[1/C,0,0,-1/A,0,0]);m=t.transform(m,[1,0,0,1,0,-A]);const B=qI.slice();t.axialAlignedBoundingBox([0,0,C,A],m,B);const[o,W,Y,w]=B,a=Math.round(Y-o)||1,h=Math.round(w-W)||1,N=this.cachedCanvases.getCanvas("fillCanvas",a,h),V=N.context,R=o,X=W;V.translate(-R,-X),V.transform(...m),G||(G=this._scaleImage(b.canvas,XI(V)),G=G.img,d&&Z&&d.set(s,G)),V.imageSmoothingEnabled=iA(v(V),I.interpolate),kg(V,G,0,0,G.width,G.height,0,0,C,A),V.globalCompositeOperation="source-in";const n=t.transform(XI(V),[1,0,0,1,-R,-X]);return V.fillStyle=Z?l.getPattern(g,this,n,iI.FILL):l,V.fillRect(0,0,C,A),d&&!Z&&(this.cachedCanvases.delete("fillCanvas"),d.set(s,N.canvas)),{canvas:N.canvas,offsetX:Math.round(R),offsetY:Math.round(X)}}setLineWidth(I){I!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=I,this.ctx.lineWidth=I}setLineCap(I){this.ctx.lineCap=Hl[I]}setLineJoin(I){this.ctx.lineJoin=Ml[I]}setMiterLimit(I){this.ctx.miterLimit=I}setDash(I,g){const C=this.ctx;C.setLineDash!==void 0&&(C.setLineDash(I),C.lineDashOffset=g)}setRenderingIntent(I){}setFlatness(I){}setGState(I){for(const[g,C]of I)switch(g){case"LW":this.setLineWidth(C);break;case"LC":this.setLineCap(C);break;case"LJ":this.setLineJoin(C);break;case"ML":this.setMiterLimit(C);break;case"D":this.setDash(C[0],C[1]);break;case"RI":this.setRenderingIntent(C);break;case"FL":this.setFlatness(C);break;case"Font":this.setFont(C[0],C[1]);break;case"CA":this.current.strokeAlpha=C;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=C;break;case"BM":this.ctx.globalCompositeOperation=C;break;case"SMask":this.current.activeSMask=C?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(C);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const I=this.inSMaskMode;this.current.activeSMask&&!I?this.beginSMaskMode():!this.current.activeSMask&&I&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const I=this.ctx.canvas.width,g=this.ctx.canvas.height,C="smaskGroupAt"+this.groupLevel,A=this.cachedCanvases.getCanvas(C,I,g);this.suspendedCtx=this.ctx;const l=this.ctx=A.context;l.setTransform(this.suspendedCtx.getTransform()),Wg(this.suspendedCtx,l),nl(l,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Wg(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(I){if(!this.current.activeSMask)return;I?(I[0]=Math.floor(I[0]),I[1]=Math.floor(I[1]),I[2]=Math.ceil(I[2]),I[3]=Math.ceil(I[3])):I=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const g=this.current.activeSMask,C=this.suspendedCtx;this.composeSMask(C,g,this.ctx,I),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(I,g,C,A){const l=A[0],Z=A[1],i=A[2]-l,d=A[3]-Z;i===0||d===0||(this.genericComposeSMask(g.context,C,i,d,g.subtype,g.backdrop,g.transferMap,l,Z,g.offsetX,g.offsetY),I.save(),I.globalAlpha=1,I.globalCompositeOperation="source-over",I.setTransform(1,0,0,1,0,0),I.drawImage(C.canvas,0,0),I.restore())}genericComposeSMask(I,g,C,A,l,Z,i,d,s,G,b){let m=I.canvas,B=d-G,o=s-b;if(Z)if(B<0||o<0||B+C>m.width||o+A>m.height){const Y=this.cachedCanvases.getCanvas("maskExtension",C,A),w=Y.context;w.drawImage(m,-B,-o),w.globalCompositeOperation="destination-atop",w.fillStyle=Z,w.fillRect(0,0,C,A),w.globalCompositeOperation="source-over",m=Y.canvas,B=o=0}else{I.save(),I.globalAlpha=1,I.setTransform(1,0,0,1,0,0);const Y=new Path2D;Y.rect(B,o,C,A),I.clip(Y),I.globalCompositeOperation="destination-atop",I.fillStyle=Z,I.fillRect(B,o,C,A),I.restore()}g.save(),g.globalAlpha=1,g.setTransform(1,0,0,1,0,0),l==="Alpha"&&i?g.filter=this.filterFactory.addAlphaFilter(i):l==="Luminosity"&&(g.filter=this.filterFactory.addLuminosityFilter(i));const W=new Path2D;W.rect(d,s,C,A),g.clip(W),g.globalCompositeOperation="destination-in",g.drawImage(m,B,o,C,A,d,s,C,A),g.restore()}save(){this.inSMaskMode&&Wg(this.ctx,this.suspendedCtx),this.ctx.save();const I=this.current;this.stateStack.push(I),this.current=I.clone()}restore(){if(this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Wg(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(I,g,C,A,l,Z){this.ctx.transform(I,g,C,A,l,Z),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(I,g,C){let[A]=g;if(!C){A||=g[0]=new Path2D,this[I](A);return}if(!(A instanceof Path2D)){const l=g[0]=new Path2D;for(let Z=0,i=A.length;Z<i;)switch(A[Z++]){case ug.moveTo:l.moveTo(A[Z++],A[Z++]);break;case ug.lineTo:l.lineTo(A[Z++],A[Z++]);break;case ug.curveTo:l.bezierCurveTo(A[Z++],A[Z++],A[Z++],A[Z++],A[Z++],A[Z++]);break;case ug.closePath:l.closePath();break;default:F(`Unrecognized drawing path operator: ${A[Z-1]}`);break}A=l}t.axialAlignedBoundingBox(C,v(this.ctx),this.current.minMax),this[I](A)}closePath(){this.ctx.closePath()}stroke(I,g=!0){const C=this.ctx,A=this.current.strokeColor;if(C.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof A=="object"&&A?.getPattern){const l=A.isModifyingCurrentTransform()?C.getTransform():null;if(C.save(),C.strokeStyle=A.getPattern(C,this,XI(C),iI.STROKE),l){const Z=new Path2D;Z.addPath(I,C.getTransform().invertSelf().multiplySelf(l)),I=Z}this.rescaleAndStroke(I,!1),C.restore()}else this.rescaleAndStroke(I,!0);g&&this.consumePath(I,this.current.getClippedPathBoundingBox(iI.STROKE,v(this.ctx))),C.globalAlpha=this.current.fillAlpha}closeStroke(I){this.stroke(I)}fill(I,g=!0){const C=this.ctx,A=this.current.fillColor,l=this.current.patternFill;let Z=!1;if(l){const d=A.isModifyingCurrentTransform()?C.getTransform():null;if(C.save(),C.fillStyle=A.getPattern(C,this,XI(C),iI.FILL),d){const s=new Path2D;s.addPath(I,C.getTransform().invertSelf().multiplySelf(d)),I=s}Z=!0}const i=this.current.getClippedPathBoundingBox();this.contentVisible&&i!==null&&(this.pendingEOFill?(C.fill(I,"evenodd"),this.pendingEOFill=!1):C.fill(I)),Z&&C.restore(),g&&this.consumePath(I,i)}eoFill(I){this.pendingEOFill=!0,this.fill(I)}fillStroke(I){this.fill(I,!1),this.stroke(I,!1),this.consumePath(I)}eoFillStroke(I){this.pendingEOFill=!0,this.fillStroke(I)}closeFillStroke(I){this.fillStroke(I)}closeEOFillStroke(I){this.pendingEOFill=!0,this.fillStroke(I)}endPath(I){this.consumePath(I)}rawFillPath(I){this.ctx.fill(I)}clip(){this.pendingClip=ul}eoClip(){this.pendingClip=dA}beginText(){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const I=this.pendingTextPaths,g=this.ctx;if(I===void 0)return;const C=new Path2D,A=g.getTransform().invertSelf();for(const{transform:l,x:Z,y:i,fontSize:d,path:s}of I)s&&C.addPath(s,new DOMMatrix(l).preMultiplySelf(A).translate(Z,i).scale(d,-d));g.clip(C),delete this.pendingTextPaths}setCharSpacing(I){this.current.charSpacing=I}setWordSpacing(I){this.current.wordSpacing=I}setHScale(I){this.current.textHScale=I/100}setLeading(I){this.current.leading=-I}setFont(I,g){const C=this.commonObjs.get(I),A=this.current;if(!C)throw new Error(`Can't find font for ${I}`);if(A.fontMatrix=C.fontMatrix||ig,(A.fontMatrix[0]===0||A.fontMatrix[3]===0)&&F("Invalid font matrix for font "+I),g<0?(g=-g,A.fontDirection=-1):A.fontDirection=1,this.current.font=C,this.current.fontSize=g,C.isType3Font)return;const l=C.loadedName||"sans-serif",Z=C.systemFontInfo?.css||`"${l}", ${C.fallbackName}`;let i="normal";C.black?i="900":C.bold&&(i="bold");const d=C.italic?"italic":"normal";let s=g;g<IA?s=IA:g>gA&&(s=gA),this.current.fontSizeScale=g/s,this.ctx.font=`${d} ${i} ${s}px ${Z}`}setTextRenderingMode(I){this.current.textRenderingMode=I}setTextRise(I){this.current.textRise=I}moveText(I,g){this.current.x=this.current.lineX+=I,this.current.y=this.current.lineY+=g}setLeadingMoveText(I,g){this.setLeading(-g),this.moveText(I,g)}setTextMatrix(I){const{current:g}=this;g.textMatrix=I,g.textMatrixScale=Math.hypot(I[0],I[1]),g.x=g.lineX=0,g.y=g.lineY=0}nextLine(){this.moveText(0,this.current.leading)}#C(I,g,C){const A=new Path2D;return A.addPath(I,new DOMMatrix(C).invertSelf().multiplySelf(g)),A}paintChar(I,g,C,A,l){const Z=this.ctx,i=this.current,d=i.font,s=i.textRenderingMode,G=i.fontSize/i.fontSizeScale,b=s&sI.FILL_STROKE_MASK,m=!!(s&sI.ADD_TO_PATH_FLAG),B=i.patternFill&&!d.missingFile,o=i.patternStroke&&!d.missingFile;let W;if((d.disableFontFace||m||B||o)&&!d.missingFile&&(W=d.getPathGenerator(this.commonObjs,I)),W&&(d.disableFontFace||B||o)){Z.save(),Z.translate(g,C),Z.scale(G,-G);let Y;if((b===sI.FILL||b===sI.FILL_STROKE)&&(A?(Y=Z.getTransform(),Z.setTransform(...A),Z.fill(this.#C(W,Y,A))):Z.fill(W)),b===sI.STROKE||b===sI.FILL_STROKE)if(l){Y||=Z.getTransform(),Z.setTransform(...l);const{a:w,b:a,c:h,d:N}=Y,V=t.inverseTransform(l),R=t.transform([w,a,h,N,0,0],V);t.singularValueDecompose2dScale(R,YI),Z.lineWidth*=Math.max(YI[0],YI[1])/G,Z.stroke(this.#C(W,Y,l))}else Z.lineWidth/=G,Z.stroke(W);Z.restore()}else(b===sI.FILL||b===sI.FILL_STROKE)&&Z.fillText(I,g,C),(b===sI.STROKE||b===sI.FILL_STROKE)&&Z.strokeText(I,g,C);m&&(this.pendingTextPaths||=[]).push({transform:v(Z),x:g,y:C,fontSize:G,path:W})}get isFontSubpixelAAEnabled(){const{context:I}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);I.scale(1.5,1),I.fillText("I",0,10);const g=I.getImageData(0,0,10,10).data;let C=!1;for(let A=3;A<g.length;A+=4)if(g[A]>0&&g[A]<255){C=!0;break}return J(this,"isFontSubpixelAAEnabled",C)}showText(I){const g=this.current,C=g.font;if(C.isType3Font)return this.showType3Text(I);const A=g.fontSize;if(A===0)return;const l=this.ctx,Z=g.fontSizeScale,i=g.charSpacing,d=g.wordSpacing,s=g.fontDirection,G=g.textHScale*s,b=I.length,m=C.vertical,B=m?1:-1,o=C.defaultVMetrics,W=A*g.fontMatrix[0],Y=g.textRenderingMode===sI.FILL&&!C.disableFontFace&&!g.patternFill;l.save(),g.textMatrix&&l.transform(...g.textMatrix),l.translate(g.x,g.y+g.textRise),s>0?l.scale(G,-1):l.scale(G,1);let w,a;if(g.patternFill){l.save();const X=g.fillColor.getPattern(l,this,XI(l),iI.FILL);w=v(l),l.restore(),l.fillStyle=X}if(g.patternStroke){l.save();const X=g.strokeColor.getPattern(l,this,XI(l),iI.STROKE);a=v(l),l.restore(),l.strokeStyle=X}let h=g.lineWidth;const N=g.textMatrixScale;if(N===0||h===0){const X=g.textRenderingMode&sI.FILL_STROKE_MASK;(X===sI.STROKE||X===sI.FILL_STROKE)&&(h=this.getSinglePixelWidth())}else h/=N;if(Z!==1&&(l.scale(Z,Z),h/=Z),l.lineWidth=h,C.isInvalidPDFjsFont){const X=[];let n=0;for(const y of I)X.push(y.unicode),n+=y.width;l.fillText(X.join(""),0,0),g.x+=n*W*G,l.restore(),this.compose();return}let V=0,R;for(R=0;R<b;++R){const X=I[R];if(typeof X=="number"){V+=B*X*A/1e3;continue}let n=!1;const y=(X.isSpace?d:0)+i,K=X.fontChar,e=X.accent;let T,O,L=X.width;if(m){const M=X.vmetric||o,u=-(X.vmetric?M[1]:L*.5)*W,NI=M[2]*W;L=M?-M[0]:L,T=u/Z,O=(V+NI)/Z}else T=V/Z,O=0;if(C.remeasure&&L>0){const M=l.measureText(K).width*1e3/A*Z;if(L<M&&this.isFontSubpixelAAEnabled){const u=L/M;n=!0,l.save(),l.scale(u,1),T/=u}else L!==M&&(T+=(L-M)/2e3*A/Z)}if(this.contentVisible&&(X.isInFont||C.missingFile)){if(Y&&!e)l.fillText(K,T,O);else if(this.paintChar(K,T,O,w,a),e){const M=T+A*e.offset.x/Z,u=O-A*e.offset.y/Z;this.paintChar(e.fontChar,M,u,w,a)}}const mI=m?L*W-y*s:L*W+y*s;V+=mI,n&&l.restore()}m?g.y-=V:g.x+=V*G,l.restore(),this.compose()}showType3Text(I){const g=this.ctx,C=this.current,A=C.font,l=C.fontSize,Z=C.fontDirection,i=A.vertical?1:-1,d=C.charSpacing,s=C.wordSpacing,G=C.textHScale*Z,b=C.fontMatrix||ig,m=I.length,B=C.textRenderingMode===sI.INVISIBLE;let o,W,Y,w;if(!(B||l===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,g.save(),C.textMatrix&&g.transform(...C.textMatrix),g.translate(C.x,C.y+C.textRise),g.scale(G,Z),o=0;o<m;++o){if(W=I[o],typeof W=="number"){w=i*W*l/1e3,this.ctx.translate(w,0),C.x+=w*G;continue}const a=(W.isSpace?s:0)+d,h=A.charProcOperatorList[W.operatorListId];h?this.contentVisible&&(this.save(),g.scale(l,l),g.transform(...b),this.executeOperatorList(h),this.restore()):F(`Type3 character "${W.operatorListId}" is not available.`);const N=[W.width,0];t.applyTransform(N,b),Y=N[0]*l+a,g.translate(Y,0),C.x+=Y*G}g.restore()}}setCharWidth(I,g){}setCharWidthAndBounds(I,g,C,A,l,Z){const i=new Path2D;i.rect(C,A,l-C,Z-A),this.ctx.clip(i),this.endPath()}getColorN_Pattern(I){let g;if(I[0]==="TilingPattern"){const C=this.baseTransform||v(this.ctx),A={createCanvasGraphics:l=>new $I(l,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};g=new BC(I,this.ctx,A,C)}else g=this._getPattern(I[1],I[2]);return g}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(I){this.ctx.strokeStyle=this.current.strokeColor=I,this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(I){this.ctx.fillStyle=this.current.fillColor=I,this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(I,g=null){let C;return this.cachedPatterns.has(I)?C=this.cachedPatterns.get(I):(C=Nl(this.getObject(I)),this.cachedPatterns.set(I,C)),g&&(C.matrix=g),C}shadingFill(I){if(!this.contentVisible)return;const g=this.ctx;this.save();const C=this._getPattern(I);g.fillStyle=C.getPattern(g,this,XI(g),iI.SHADING);const A=XI(g);if(A){const{width:l,height:Z}=g.canvas,i=qI.slice();t.axialAlignedBoundingBox([0,0,l,Z],A,i);const[d,s,G,b]=i;this.ctx.fillRect(d,s,G-d,b-s)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){j("Should not call beginInlineImage")}beginImageData(){j("Should not call beginImageData")}paintFormXObjectBegin(I,g){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),I&&this.transform(...I),this.baseTransform=v(this.ctx),g)){t.axialAlignedBoundingBox(g,this.baseTransform,this.current.minMax);const[C,A,l,Z]=g,i=new Path2D;i.rect(C,A,l-C,Z-A),this.ctx.clip(i),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(I){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const g=this.ctx;I.isolated||eg("TODO: Support non-isolated groups."),I.knockout&&F("Knockout groups not supported.");const C=v(g);if(I.matrix&&g.transform(...I.matrix),!I.bbox)throw new Error("Bounding box is required.");let A=qI.slice();t.axialAlignedBoundingBox(I.bbox,v(g),A);const l=[0,0,g.canvas.width,g.canvas.height];A=t.intersect(A,l)||[0,0,0,0];const Z=Math.floor(A[0]),i=Math.floor(A[1]),d=Math.max(Math.ceil(A[2])-Z,1),s=Math.max(Math.ceil(A[3])-i,1);this.current.startNewPathAndClipBox([0,0,d,s]);let G="groupAt"+this.groupLevel;I.smask&&(G+="_smask_"+this.smaskCounter++%2);const b=this.cachedCanvases.getCanvas(G,d,s),m=b.context;m.translate(-Z,-i),m.transform(...C);let B=new Path2D;const[o,W,Y,w]=I.bbox;if(B.rect(o,W,Y-o,w-W),I.matrix){const a=new Path2D;a.addPath(B,new DOMMatrix(I.matrix)),B=a}m.clip(B),I.smask?this.smaskStack.push({canvas:b.canvas,context:m,offsetX:Z,offsetY:i,subtype:I.smask.subtype,backdrop:I.smask.backdrop,transferMap:I.smask.transferMap||null,startTransformInverse:null}):(g.setTransform(1,0,0,1,0,0),g.translate(Z,i),g.save()),Wg(g,m),this.ctx=m,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(g),this.groupLevel++}endGroup(I){if(!this.contentVisible)return;this.groupLevel--;const g=this.ctx,C=this.groupStack.pop();if(this.ctx=C,this.ctx.imageSmoothingEnabled=!1,I.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const A=v(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...A);const l=qI.slice();t.axialAlignedBoundingBox([0,0,g.canvas.width,g.canvas.height],A,l),this.ctx.drawImage(g.canvas,0,0),this.ctx.restore(),this.compose(l)}}beginAnnotation(I,g,C,A,l){if(this.#I(),Lg(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),g){const Z=g[2]-g[0],i=g[3]-g[1];if(l&&this.annotationCanvasMap){C=C.slice(),C[4]-=g[0],C[5]-=g[1],g=g.slice(),g[0]=g[1]=0,g[2]=Z,g[3]=i,t.singularValueDecompose2dScale(v(this.ctx),YI);const{viewportScale:d}=this,s=Math.ceil(Z*this.outputScaleX*d),G=Math.ceil(i*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(s,G);const{canvas:b,context:m}=this.annotationCanvas;this.annotationCanvasMap.set(I,b),this.annotationCanvas.savedCtx=this.ctx,this.ctx=m,this.ctx.save(),this.ctx.setTransform(YI[0],0,0,-YI[1],0,i*YI[1]),Lg(this.ctx)}else{Lg(this.ctx),this.endPath();const d=new Path2D;d.rect(g[0],g[1],Z,i),this.ctx.clip(d)}}this.current=new AA(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...C),this.transform(...A)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#g(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(I){if(!this.contentVisible)return;const g=I.count;I=this.getObject(I.data,I),I.count=g;const C=this.ctx,A=this._createMaskCanvas(I),l=A.canvas;C.save(),C.setTransform(1,0,0,1,0,0),C.drawImage(l,A.offsetX,A.offsetY),C.restore(),this.compose()}paintImageMaskXObjectRepeat(I,g,C=0,A=0,l,Z){if(!this.contentVisible)return;I=this.getObject(I.data,I);const i=this.ctx;i.save();const d=v(i);i.transform(g,C,A,l,0,0);const s=this._createMaskCanvas(I);i.setTransform(1,0,0,1,s.offsetX-d[4],s.offsetY-d[5]);for(let G=0,b=Z.length;G<b;G+=2){const m=t.transform(d,[g,C,A,l,Z[G],Z[G+1]]);i.drawImage(s.canvas,m[4],m[5])}i.restore(),this.compose()}paintImageMaskXObjectGroup(I){if(!this.contentVisible)return;const g=this.ctx,C=this.current.fillColor,A=this.current.patternFill;for(const l of I){const{data:Z,width:i,height:d,transform:s}=l,G=this.cachedCanvases.getCanvas("maskCanvas",i,d),b=G.context;b.save();const m=this.getObject(Z,l);ZA(b,m),b.globalCompositeOperation="source-in",b.fillStyle=A?C.getPattern(b,this,XI(g),iI.FILL):C,b.fillRect(0,0,i,d),b.restore(),g.save(),g.transform(...s),g.scale(1,-1),kg(g,G.canvas,0,0,i,d,0,-1,1,1),g.restore()}this.compose()}paintImageXObject(I){if(!this.contentVisible)return;const g=this.getObject(I);if(!g){F("Dependent image isn't ready yet");return}this.paintInlineImageXObject(g)}paintImageXObjectRepeat(I,g,C,A){if(!this.contentVisible)return;const l=this.getObject(I);if(!l){F("Dependent image isn't ready yet");return}const Z=l.width,i=l.height,d=[];for(let s=0,G=A.length;s<G;s+=2)d.push({transform:[g,0,0,C,A[s],A[s+1]],x:0,y:0,w:Z,h:i});this.paintInlineImageXObjectGroup(l,d)}applyTransferMapsToCanvas(I){return this.current.transferMaps!=="none"&&(I.filter=this.current.transferMaps,I.drawImage(I.canvas,0,0),I.filter="none"),I.canvas}applyTransferMapsToBitmap(I){if(this.current.transferMaps==="none")return I.bitmap;const{bitmap:g,width:C,height:A}=I,l=this.cachedCanvases.getCanvas("inlineImage",C,A),Z=l.context;return Z.filter=this.current.transferMaps,Z.drawImage(g,0,0),Z.filter="none",l.canvas}paintInlineImageXObject(I){if(!this.contentVisible)return;const g=I.width,C=I.height,A=this.ctx;this.save();const{filter:l}=A;l!=="none"&&l!==""&&(A.filter="none"),A.scale(1/g,-1/C);let Z;if(I.bitmap)Z=this.applyTransferMapsToBitmap(I);else if(typeof HTMLElement=="function"&&I instanceof HTMLElement||!I.data)Z=I;else{const s=this.cachedCanvases.getCanvas("inlineImage",g,C).context;lA(s,I),Z=this.applyTransferMapsToCanvas(s)}const i=this._scaleImage(Z,XI(A));A.imageSmoothingEnabled=iA(v(A),I.interpolate),kg(A,i.img,0,0,i.paintWidth,i.paintHeight,0,-C,g,C),this.compose(),this.restore()}paintInlineImageXObjectGroup(I,g){if(!this.contentVisible)return;const C=this.ctx;let A;if(I.bitmap)A=I.bitmap;else{const l=I.width,Z=I.height,d=this.cachedCanvases.getCanvas("inlineImage",l,Z).context;lA(d,I),A=this.applyTransferMapsToCanvas(d)}for(const l of g)C.save(),C.transform(...l.transform),C.scale(1,-1),kg(C,A,l.x,l.y,l.w,l.h,0,-1,1,1),C.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(I){}markPointProps(I,g){}beginMarkedContent(I){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(I,g){I==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(g)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(I,g){const C=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(g);const A=this.ctx;this.pendingClip&&(C||(this.pendingClip===dA?A.clip(I,"evenodd"):A.clip(I)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const I=v(this.ctx);if(I[1]===0&&I[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(I[0]),Math.abs(I[3]));else{const g=Math.abs(I[0]*I[3]-I[2]*I[1]),C=Math.hypot(I[0],I[2]),A=Math.hypot(I[1],I[3]);this._cachedGetSinglePixelWidth=Math.max(C,A)/g}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:I}=this.current,{a:g,b:C,c:A,d:l}=this.ctx.getTransform();let Z,i;if(C===0&&A===0){const d=Math.abs(g),s=Math.abs(l);if(d===s)if(I===0)Z=i=1/d;else{const G=d*I;Z=i=G<1?1/G:1}else if(I===0)Z=1/d,i=1/s;else{const G=d*I,b=s*I;Z=G<1?1/G:1,i=b<1?1/b:1}}else{const d=Math.abs(g*l-C*A),s=Math.hypot(g,C),G=Math.hypot(A,l);if(I===0)Z=G/d,i=s/d;else{const b=I*d;Z=G>b?G/b:1,i=s>b?s/b:1}}this._cachedScaleForStroking[0]=Z,this._cachedScaleForStroking[1]=i}return this._cachedScaleForStroking}rescaleAndStroke(I,g){const{ctx:C,current:{lineWidth:A}}=this,[l,Z]=this.getScaleForStroking();if(l===Z){C.lineWidth=(A||1)*l,C.stroke(I);return}const i=C.getLineDash();g&&C.save(),C.scale(l,Z),WC.a=1/l,WC.d=1/Z;const d=new Path2D;if(d.addPath(I,WC),i.length>0){const s=Math.max(l,Z);C.setLineDash(i.map(G=>G/s)),C.lineDashOffset/=s}C.lineWidth=A||1,C.stroke(d),g&&C.restore()}isContentVisible(){for(let I=this.markedContentStack.length-1;I>=0;I--)if(!this.markedContentStack[I].visible)return!1;return!0}}for(const c in Mg)$I.prototype[c]!==void 0&&($I.prototype[Mg[c]]=$I.prototype[c]);class Ig{static#I=null;static#g="";static get workerPort(){return this.#I}static set workerPort(I){if(!(typeof Worker<"u"&&I instanceof Worker)&&I!==null)throw new Error("Invalid `workerPort` type.");this.#I=I}static get workerSrc(){return this.#g}static set workerSrc(I){if(typeof I!="string")throw new Error("Invalid `workerSrc` type.");this.#g=I}}class tl{#I;#g;constructor({parsedData:I,rawData:g}){this.#I=I,this.#g=g}getRaw(){return this.#g}get(I){return this.#I.get(I)??null}[Symbol.iterator](){return this.#I.entries()}}const gg=Symbol("INTERNAL");class el{#I=!1;#g=!1;#C=!1;#A=!0;constructor(I,{name:g,intent:C,usage:A,rbGroups:l}){this.#I=!!(I&wI.DISPLAY),this.#g=!!(I&wI.PRINT),this.name=g,this.intent=C,this.usage=A,this.rbGroups=l}get visible(){if(this.#C)return this.#A;if(!this.#A)return!1;const{print:I,view:g}=this.usage;return this.#I?g?.viewState!=="OFF":this.#g?I?.printState!=="OFF":!0}_setVisible(I,g,C=!1){I!==gg&&j("Internal method `_setVisible` called."),this.#C=C,this.#A=g}}class Dl{#I=null;#g=new Map;#C=null;#A=null;constructor(I,g=wI.DISPLAY){if(this.renderingIntent=g,this.name=null,this.creator=null,I!==null){this.name=I.name,this.creator=I.creator,this.#A=I.order;for(const C of I.groups)this.#g.set(C.id,new el(g,C));if(I.baseState==="OFF")for(const C of this.#g.values())C._setVisible(gg,!1);for(const C of I.on)this.#g.get(C)._setVisible(gg,!0);for(const C of I.off)this.#g.get(C)._setVisible(gg,!1);this.#C=this.getHash()}}#Z(I){const g=I.length;if(g<2)return!0;const C=I[0];for(let A=1;A<g;A++){const l=I[A];let Z;if(Array.isArray(l))Z=this.#Z(l);else if(this.#g.has(l))Z=this.#g.get(l).visible;else return F(`Optional content group not found: ${l}`),!0;switch(C){case"And":if(!Z)return!1;break;case"Or":if(Z)return!0;break;case"Not":return!Z;default:return!0}}return C==="And"}isVisible(I){if(this.#g.size===0)return!0;if(!I)return eg("Optional content group not defined."),!0;if(I.type==="OCG")return this.#g.has(I.id)?this.#g.get(I.id).visible:(F(`Optional content group not found: ${I.id}`),!0);if(I.type==="OCMD"){if(I.expression)return this.#Z(I.expression);if(!I.policy||I.policy==="AnyOn"){for(const g of I.ids){if(!this.#g.has(g))return F(`Optional content group not found: ${g}`),!0;if(this.#g.get(g).visible)return!0}return!1}else if(I.policy==="AllOn"){for(const g of I.ids){if(!this.#g.has(g))return F(`Optional content group not found: ${g}`),!0;if(!this.#g.get(g).visible)return!1}return!0}else if(I.policy==="AnyOff"){for(const g of I.ids){if(!this.#g.has(g))return F(`Optional content group not found: ${g}`),!0;if(!this.#g.get(g).visible)return!0}return!1}else if(I.policy==="AllOff"){for(const g of I.ids){if(!this.#g.has(g))return F(`Optional content group not found: ${g}`),!0;if(this.#g.get(g).visible)return!1}return!0}return F(`Unknown optional content policy ${I.policy}.`),!0}return F(`Unknown group type ${I.type}.`),!0}setVisibility(I,g=!0,C=!0){const A=this.#g.get(I);if(!A){F(`Optional content group not found: ${I}`);return}if(C&&g&&A.rbGroups.length)for(const l of A.rbGroups)for(const Z of l)Z!==I&&this.#g.get(Z)?._setVisible(gg,!1,!0);A._setVisible(gg,!!g,!0),this.#I=null}setOCGState({state:I,preserveRB:g}){let C;for(const A of I){switch(A){case"ON":case"OFF":case"Toggle":C=A;continue}const l=this.#g.get(A);if(l)switch(C){case"ON":this.setVisibility(A,!0,g);break;case"OFF":this.setVisibility(A,!1,g);break;case"Toggle":this.setVisibility(A,!l.visible,g);break}}this.#I=null}get hasInitialVisibility(){return this.#C===null||this.getHash()===this.#C}getOrder(){return this.#g.size?this.#A?this.#A.slice():[...this.#g.keys()]:null}getGroup(I){return this.#g.get(I)||null}getHash(){if(this.#I!==null)return this.#I;const I=new jC;for(const[g,C]of this.#g)I.update(`${g}:${C.visible}`);return this.#I=I.hexdigest()}[Symbol.iterator](){return this.#g.entries()}}class Kl{constructor(I,{disableRange:g=!1,disableStream:C=!1}){$(I,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:A,initialData:l,progressiveDone:Z,contentDispositionFilename:i}=I;if(this._queuedChunks=[],this._progressiveDone=Z,this._contentDispositionFilename=i,l?.length>0){const d=l instanceof Uint8Array&&l.byteLength===l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=I,this._isStreamingSupported=!C,this._isRangeSupported=!g,this._contentLength=A,this._fullRequestReader=null,this._rangeReaders=[],I.addRangeListener((d,s)=>{this._onReceiveData({begin:d,chunk:s})}),I.addProgressListener((d,s)=>{this._onProgress({loaded:d,total:s})}),I.addProgressiveReadListener(d=>{this._onReceiveData({chunk:d})}),I.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),I.transportReady()}_onReceiveData({begin:I,chunk:g}){const C=g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength?g.buffer:new Uint8Array(g).buffer;if(I===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(C):this._queuedChunks.push(C);else{const A=this._rangeReaders.some(function(l){return l._begin!==I?!1:(l._enqueue(C),!0)});$(A,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(I){I.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:I.loaded}):this._fullRequestReader?.onProgress?.({loaded:I.loaded,total:I.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(I){const g=this._rangeReaders.indexOf(I);g>=0&&this._rangeReaders.splice(g,1)}getFullReader(){$(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const I=this._queuedChunks;return this._queuedChunks=null,new Sl(this,I,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(I,g){if(g<=this._progressiveDataLength)return null;const C=new pl(this,I,g);return this._pdfDataRangeTransport.requestDataRange(I,g),this._rangeReaders.push(C),C}cancelAllRequests(I){this._fullRequestReader?.cancel(I);for(const g of this._rangeReaders.slice(0))g.cancel(I);this._pdfDataRangeTransport.abort()}}class Sl{constructor(I,g,C=!1,A=null){this._stream=I,this._done=C||!1,this._filename=gC(A)?A:null,this._queuedChunks=g||[],this._loaded=0;for(const l of this._queuedChunks)this._loaded+=l.byteLength;this._requests=[],this._headersReady=Promise.resolve(),I._fullRequestReader=this,this.onProgress=null}_enqueue(I){this._done||(this._requests.length>0?this._requests.shift().resolve({value:I,done:!1}):this._queuedChunks.push(I),this._loaded+=I.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const I=Promise.withResolvers();return this._requests.push(I),I.promise}cancel(I){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class pl{constructor(I,g,C){this._stream=I,this._begin=g,this._end=C,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(I){if(!this._done){if(this._requests.length===0)this._queuedChunk=I;else{this._requests.shift().resolve({value:I,done:!1});for(const C of this._requests)C.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const g=this._queuedChunk;return this._queuedChunk=null,{value:g,done:!1}}if(this._done)return{value:void 0,done:!0};const I=Promise.withResolvers();return this._requests.push(I),I.promise}cancel(I){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Fl(c){let I=!0,g=C("filename\\*","i").exec(c);if(g){g=g[1];let G=i(g);return G=unescape(G),G=d(G),G=s(G),l(G)}if(g=Z(c),g){const G=s(g);return l(G)}if(g=C("filename","i").exec(c),g){g=g[1];let G=i(g);return G=s(G),l(G)}function C(G,b){return new RegExp("(?:^|;)\\s*"+G+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',b)}function A(G,b){if(G){if(!/^[\x00-\xFF]+$/.test(b))return b;try{const m=new TextDecoder(G,{fatal:!0}),B=dg(b);b=m.decode(B),I=!1}catch{}}return b}function l(G){return I&&/[\x80-\xff]/.test(G)&&(G=A("utf-8",G),I&&(G=A("iso-8859-1",G))),G}function Z(G){const b=[];let m;const B=C("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(m=B.exec(G))!==null;){let[,W,Y,w]=m;if(W=parseInt(W,10),W in b){if(W===0)break;continue}b[W]=[Y,w]}const o=[];for(let W=0;W<b.length&&W in b;++W){let[Y,w]=b[W];w=i(w),Y&&(w=unescape(w),W===0&&(w=d(w))),o.push(w)}return o.join("")}function i(G){if(G.startsWith('"')){const b=G.slice(1).split('\\"');for(let m=0;m<b.length;++m){const B=b[m].indexOf('"');B!==-1&&(b[m]=b[m].slice(0,B),b.length=m+1),b[m]=b[m].replaceAll(/\\(.)/g,"$1")}G=b.join('"')}return G}function d(G){const b=G.indexOf("'");if(b===-1)return G;const m=G.slice(0,b),o=G.slice(b+1).replace(/^[^']*'/,"");return A(m,o)}function s(G){return!G.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(G)?G:G.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(b,m,B,o){if(B==="q"||B==="Q")return o=o.replaceAll("_"," "),o=o.replaceAll(/=([0-9a-fA-F]{2})/g,function(W,Y){return String.fromCharCode(parseInt(Y,16))}),A(m,o);try{o=atob(o)}catch{}return A(m,o)})}return""}function sA(c,I){const g=new Headers;if(!c||!I||typeof I!="object")return g;for(const C in I){const A=I[C];A!==void 0&&g.append(C,A)}return g}function Tg(c){return URL.parse(c)?.origin??null}function GA({responseHeaders:c,isHttp:I,rangeChunkSize:g,disableRange:C}){const A={allowRangeRequests:!1,suggestedLength:void 0},l=parseInt(c.get("Content-Length"),10);return!Number.isInteger(l)||(A.suggestedLength=l,l<=2*g)||C||!I||c.get("Accept-Ranges")!=="bytes"||(c.get("Content-Encoding")||"identity")!=="identity"||(A.allowRangeRequests=!0),A}function cA(c){const I=c.get("Content-Disposition");if(I){let g=Fl(I);if(g.includes("%"))try{g=decodeURIComponent(g)}catch{}if(gC(g))return g}return null}function og(c,I){return new Dg(`Unexpected server response (${c}) while retrieving PDF "${I}".`,c,c===404||c===0&&I.startsWith("file:"))}function bA(c){return c===200||c===206}function mA(c,I,g){return{method:"GET",headers:c,signal:g.signal,mode:"cors",credentials:I?"include":"same-origin",redirect:"follow"}}function BA(c){return c instanceof Uint8Array?c.buffer:c instanceof ArrayBuffer?c:(F(`getArrayBuffer - unexpected data format: ${c}`),new Uint8Array(c).buffer)}class zl{_responseOrigin=null;constructor(I){this.source=I,this.isHttp=/^https?:/i.test(I.url),this.headers=sA(this.isHttp,I.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return $(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Jl(this),this._fullRequestReader}getRangeReader(I,g){if(g<=this._progressiveDataLength)return null;const C=new kl(this,I,g);return this._rangeRequestReaders.push(C),C}cancelAllRequests(I){this._fullRequestReader?.cancel(I);for(const g of this._rangeRequestReaders.slice(0))g.cancel(I)}}class Jl{constructor(I){this._stream=I,this._reader=null,this._loaded=0,this._filename=null;const g=I.source;this._withCredentials=g.withCredentials||!1,this._contentLength=g.length,this._headersCapability=Promise.withResolvers(),this._disableRange=g.disableRange||!1,this._rangeChunkSize=g.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!g.disableStream,this._isRangeSupported=!g.disableRange;const C=new Headers(I.headers),A=g.url;fetch(A,mA(C,this._withCredentials,this._abortController)).then(l=>{if(I._responseOrigin=Tg(l.url),!bA(l.status))throw og(l.status,A);this._reader=l.body.getReader(),this._headersCapability.resolve();const Z=l.headers,{allowRangeRequests:i,suggestedLength:d}=GA({responseHeaders:Z,isHttp:I.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=i,this._contentLength=d||this._contentLength,this._filename=cA(Z),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new zI("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:I,done:g}=await this._reader.read();return g?{value:I,done:g}:(this._loaded+=I.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:BA(I),done:!1})}cancel(I){this._reader?.cancel(I),this._abortController.abort()}}class kl{constructor(I,g,C){this._stream=I,this._reader=null,this._loaded=0;const A=I.source;this._withCredentials=A.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!A.disableStream,this._abortController=new AbortController;const l=new Headers(I.headers);l.append("Range",`bytes=${g}-${C-1}`);const Z=A.url;fetch(Z,mA(l,this._withCredentials,this._abortController)).then(i=>{const d=Tg(i.url);if(d!==I._responseOrigin)throw new Error(`Expected range response-origin "${d}" to match "${I._responseOrigin}".`);if(!bA(i.status))throw og(i.status,Z);this._readCapability.resolve(),this._reader=i.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:I,done:g}=await this._reader.read();return g?{value:I,done:g}:(this._loaded+=I.byteLength,this.onProgress?.({loaded:this._loaded}),{value:BA(I),done:!1})}cancel(I){this._reader?.cancel(I),this._abortController.abort()}}const oC=200,wC=206;function Ll(c){const I=c.response;return typeof I!="string"?I:dg(I).buffer}class Tl{_responseOrigin=null;constructor({url:I,httpHeaders:g,withCredentials:C}){this.url=I,this.isHttp=/^https?:/i.test(I),this.headers=sA(this.isHttp,g),this.withCredentials=C||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(I){const g=new XMLHttpRequest,C=this.currXhrId++,A=this.pendingRequests[C]={xhr:g};g.open("GET",this.url),g.withCredentials=this.withCredentials;for(const[l,Z]of this.headers)g.setRequestHeader(l,Z);return this.isHttp&&"begin"in I&&"end"in I?(g.setRequestHeader("Range",`bytes=${I.begin}-${I.end-1}`),A.expectedStatus=wC):A.expectedStatus=oC,g.responseType="arraybuffer",$(I.onError,"Expected `onError` callback to be provided."),g.onerror=()=>{I.onError(g.status)},g.onreadystatechange=this.onStateChange.bind(this,C),g.onprogress=this.onProgress.bind(this,C),A.onHeadersReceived=I.onHeadersReceived,A.onDone=I.onDone,A.onError=I.onError,A.onProgress=I.onProgress,g.send(null),C}onProgress(I,g){const C=this.pendingRequests[I];C&&C.onProgress?.(g)}onStateChange(I,g){const C=this.pendingRequests[I];if(!C)return;const A=C.xhr;if(A.readyState>=2&&C.onHeadersReceived&&(C.onHeadersReceived(),delete C.onHeadersReceived),A.readyState!==4||!(I in this.pendingRequests))return;if(delete this.pendingRequests[I],A.status===0&&this.isHttp){C.onError(A.status);return}const l=A.status||oC;if(!(l===oC&&C.expectedStatus===wC)&&l!==C.expectedStatus){C.onError(A.status);return}const i=Ll(A);if(l===wC){const d=A.getResponseHeader("Content-Range"),s=/bytes (\d+)-(\d+)\/(\d+)/.exec(d);s?C.onDone({begin:parseInt(s[1],10),chunk:i}):(F('Missing or invalid "Content-Range" header.'),C.onError(0))}else i?C.onDone({begin:0,chunk:i}):C.onError(A.status)}getRequestXhr(I){return this.pendingRequests[I].xhr}isPendingRequest(I){return I in this.pendingRequests}abortRequest(I){const g=this.pendingRequests[I].xhr;delete this.pendingRequests[I],g.abort()}}class Ql{constructor(I){this._source=I,this._manager=new Tl(I),this._rangeChunkSize=I.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(I){const g=this._rangeRequestReaders.indexOf(I);g>=0&&this._rangeRequestReaders.splice(g,1)}getFullReader(){return $(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new jl(this._manager,this._source),this._fullRequestReader}getRangeReader(I,g){const C=new Ol(this._manager,I,g);return C.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(C),C}cancelAllRequests(I){this._fullRequestReader?.cancel(I);for(const g of this._rangeRequestReaders.slice(0))g.cancel(I)}}class jl{constructor(I,g){this._manager=I,this._url=g.url,this._fullRequestId=I.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=g.disableRange||!1,this._contentLength=g.length,this._rangeChunkSize=g.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const I=this._fullRequestId,g=this._manager.getRequestXhr(I);this._manager._responseOrigin=Tg(g.responseURL);const C=g.getAllResponseHeaders(),A=new Headers(C?C.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(i=>{const[d,...s]=i.split(": ");return[d,s.join(": ")]}):[]),{allowRangeRequests:l,suggestedLength:Z}=GA({responseHeaders:A,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});l&&(this._isRangeSupported=!0),this._contentLength=Z||this._contentLength,this._filename=cA(A),this._isRangeSupported&&this._manager.abortRequest(I),this._headersCapability.resolve()}_onDone(I){if(I&&(this._requests.length>0?this._requests.shift().resolve({value:I.chunk,done:!1}):this._cachedChunks.push(I.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(I){this._storedError=og(I,this._url),this._headersCapability.reject(this._storedError);for(const g of this._requests)g.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(I){this.onProgress?.({loaded:I.loaded,total:I.lengthComputable?I.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const I=Promise.withResolvers();return this._requests.push(I),I.promise}cancel(I){this._done=!0,this._headersCapability.reject(I);for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Ol{constructor(I,g,C){this._manager=I,this._url=I.url,this._requestId=I.request({begin:g,end:C,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const I=Tg(this._manager.getRequestXhr(this._requestId)?.responseURL);I!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${I}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(I){const g=I.chunk;this._requests.length>0?this._requests.shift().resolve({value:g,done:!1}):this._queuedChunk=g,this._done=!0;for(const C of this._requests)C.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(I){this._storedError??=og(I,this._url);for(const g of this._requests)g.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(I){this.isStreamingSupported||this.onProgress?.({loaded:I.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const g=this._queuedChunk;return this._queuedChunk=null,{value:g,done:!1}}if(this._done)return{value:void 0,done:!0};const I=Promise.withResolvers();return this._requests.push(I),I.promise}cancel(I){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Ul=/^[a-z][a-z0-9\-+.]+:/i;function xl(c){if(Ul.test(c))return new URL(c);const I=process.getBuiltinModule("url");return new URL(I.pathToFileURL(c))}class vl{constructor(I){this.source=I,this.url=xl(I.url),$(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return $(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new rl(this),this._fullRequestReader}getRangeReader(I,g){if(g<=this._progressiveDataLength)return null;const C=new El(this,I,g);return this._rangeRequestReaders.push(C),C}cancelAllRequests(I){this._fullRequestReader?.cancel(I);for(const g of this._rangeRequestReaders.slice(0))g.cancel(I)}}class rl{constructor(I){this._url=I.url,this._done=!1,this._storedError=null,this.onProgress=null;const g=I.source;this._contentLength=g.length,this._loaded=0,this._filename=null,this._disableRange=g.disableRange||!1,this._rangeChunkSize=g.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!g.disableStream,this._isRangeSupported=!g.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const C=process.getBuiltinModule("fs");C.promises.lstat(this._url).then(A=>{this._contentLength=A.size,this._setReadableStream(C.createReadStream(this._url)),this._headersCapability.resolve()},A=>{A.code==="ENOENT"&&(A=og(0,this._url.href)),this._storedError=A,this._headersCapability.reject(A)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const I=this._readableStream.read();return I===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=I.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(I).buffer,done:!1})}cancel(I){if(!this._readableStream){this._error(I);return}this._readableStream.destroy(I)}_error(I){this._storedError=I,this._readCapability.resolve()}_setReadableStream(I){this._readableStream=I,I.on("readable",()=>{this._readCapability.resolve()}),I.on("end",()=>{I.destroy(),this._done=!0,this._readCapability.resolve()}),I.on("error",g=>{this._error(g)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new zI("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class El{constructor(I,g,C){this._url=I.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const A=I.source;this._isStreamingSupported=!A.disableStream;const l=process.getBuiltinModule("fs");this._setReadableStream(l.createReadStream(this._url,{start:g,end:C-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const I=this._readableStream.read();return I===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=I.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(I).buffer,done:!1})}cancel(I){if(!this._readableStream){this._error(I);return}this._readableStream.destroy(I)}_error(I){this._storedError=I,this._readCapability.resolve()}_setReadableStream(I){this._readableStream=I,I.on("readable",()=>{this._readCapability.resolve()}),I.on("end",()=>{I.destroy(),this._done=!0,this._readCapability.resolve()}),I.on("error",g=>{this._error(g)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const wg=Symbol("INITIAL_DATA");class WA{#I=Object.create(null);#g(I){return this.#I[I]||={...Promise.withResolvers(),data:wg}}get(I,g=null){if(g){const A=this.#g(I);return A.promise.then(()=>g(A.data)),null}const C=this.#I[I];if(!C||C.data===wg)throw new Error(`Requesting object that isn't resolved yet ${I}.`);return C.data}has(I){const g=this.#I[I];return!!g&&g.data!==wg}delete(I){const g=this.#I[I];return!g||g.data===wg?!1:(delete this.#I[I],!0)}resolve(I,g=null){const C=this.#g(I);C.data=g,C.resolve()}clear(){for(const I in this.#I){const{data:g}=this.#I[I];g?.bitmap?.close()}this.#I=Object.create(null)}*[Symbol.iterator](){for(const I in this.#I){const{data:g}=this.#I[I];g!==wg&&(yield[I,g])}}}const Pl=1e5,oA=30;class cI{#I=Promise.withResolvers();#g=null;#C=!1;#A=!!globalThis.FontInspector?.enabled;#Z=null;#l=null;#i=0;#d=0;#c=null;#G=null;#m=0;#s=0;#W=Object.create(null);#w=[];#B=null;#b=[];#o=new WeakMap;#a=null;static#Y=new Map;static#N=new Map;static#R=new WeakMap;static#h=null;static#n=new Set;constructor({textContentSource:I,container:g,viewport:C}){if(I instanceof ReadableStream)this.#B=I;else if(typeof I=="object")this.#B=new ReadableStream({start(d){d.enqueue(I),d.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#g=this.#G=g,this.#s=C.scale*nI.pixelRatio,this.#m=C.rotation,this.#l={div:null,properties:null,ctx:null};const{pageWidth:A,pageHeight:l,pageX:Z,pageY:i}=C.rawDims;this.#a=[1,0,0,-1,-Z,i+l],this.#d=A,this.#i=l,cI.#H(),jI(g,C),this.#I.promise.finally(()=>{cI.#n.delete(this),this.#l=null,this.#W=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:I,isFirefox:g}=ZI.platform;return J(this,"fontFamilyMap",new Map([["sans-serif",`${I&&g?"Calibri, ":""}sans-serif`],["monospace",`${I&&g?"Lucida Console, ":""}monospace`]]))}render(){const I=()=>{this.#c.read().then(({value:g,done:C})=>{if(C){this.#I.resolve();return}this.#Z??=g.lang,Object.assign(this.#W,g.styles),this.#t(g.items),I()},this.#I.reject)};return this.#c=this.#B.getReader(),cI.#n.add(this),I(),this.#I.promise}update({viewport:I,onBefore:g=null}){const C=I.scale*nI.pixelRatio,A=I.rotation;if(A!==this.#m&&(g?.(),this.#m=A,jI(this.#G,{rotation:A})),C!==this.#s){g?.(),this.#s=C;const l={div:null,properties:null,ctx:cI.#u(this.#Z)};for(const Z of this.#b)l.properties=this.#o.get(Z),l.div=Z,this.#e(l)}}cancel(){const I=new zI("TextLayer task cancelled.");this.#c?.cancel(I).catch(()=>{}),this.#c=null,this.#I.reject(I)}get textDivs(){return this.#b}get textContentItemsStr(){return this.#w}#t(I){if(this.#C)return;this.#l.ctx??=cI.#u(this.#Z);const g=this.#b,C=this.#w;for(const A of I){if(g.length>Pl){F("Ignoring additional textDivs for performance reasons."),this.#C=!0;return}if(A.str===void 0){if(A.type==="beginMarkedContentProps"||A.type==="beginMarkedContent"){const l=this.#g;this.#g=document.createElement("span"),this.#g.classList.add("markedContent"),A.id&&this.#g.setAttribute("id",`${A.id}`),l.append(this.#g)}else A.type==="endMarkedContent"&&(this.#g=this.#g.parentNode);continue}C.push(A.str),this.#X(A)}}#X(I){const g=document.createElement("span"),C={angle:0,canvasWidth:0,hasText:I.str!=="",hasEOL:I.hasEOL,fontSize:0};this.#b.push(g);const A=t.transform(this.#a,I.transform);let l=Math.atan2(A[1],A[0]);const Z=this.#W[I.fontName];Z.vertical&&(l+=Math.PI/2);let i=this.#A&&Z.fontSubstitution||Z.fontFamily;i=cI.fontFamilyMap.get(i)||i;const d=Math.hypot(A[2],A[3]),s=d*cI.#K(i,Z,this.#Z);let G,b;l===0?(G=A[4],b=A[5]-s):(G=A[4]+s*Math.sin(l),b=A[5]-s*Math.cos(l));const m="calc(var(--total-scale-factor) *",B=g.style;this.#g===this.#G?(B.left=`${(100*G/this.#d).toFixed(2)}%`,B.top=`${(100*b/this.#i).toFixed(2)}%`):(B.left=`${m}${G.toFixed(2)}px)`,B.top=`${m}${b.toFixed(2)}px)`),B.fontSize=`${m}${(cI.#h*d).toFixed(2)}px)`,B.fontFamily=i,C.fontSize=d,g.setAttribute("role","presentation"),g.textContent=I.str,g.dir=I.dir,this.#A&&(g.dataset.fontName=Z.fontSubstitutionLoadedName||I.fontName),l!==0&&(C.angle=l*(180/Math.PI));let o=!1;if(I.str.length>1)o=!0;else if(I.str!==" "&&I.transform[0]!==I.transform[3]){const W=Math.abs(I.transform[0]),Y=Math.abs(I.transform[3]);W!==Y&&Math.max(W,Y)/Math.min(W,Y)>1.5&&(o=!0)}if(o&&(C.canvasWidth=Z.vertical?I.height:I.width),this.#o.set(g,C),this.#l.div=g,this.#l.properties=C,this.#e(this.#l),C.hasText&&this.#g.append(g),C.hasEOL){const W=document.createElement("br");W.setAttribute("role","presentation"),this.#g.append(W)}}#e(I){const{div:g,properties:C,ctx:A}=I,{style:l}=g;let Z="";if(cI.#h>1&&(Z=`scale(${1/cI.#h})`),C.canvasWidth!==0&&C.hasText){const{fontFamily:i}=l,{canvasWidth:d,fontSize:s}=C;cI.#M(A,s*this.#s,i);const{width:G}=A.measureText(g.textContent);G>0&&(Z=`scaleX(${d*this.#s/G}) ${Z}`)}C.angle!==0&&(Z=`rotate(${C.angle}deg) ${Z}`),Z.length>0&&(l.transform=Z)}static cleanup(){if(!(this.#n.size>0)){this.#Y.clear();for(const{canvas:I}of this.#N.values())I.remove();this.#N.clear()}}static#u(I=null){let g=this.#N.get(I||="");if(!g){const C=document.createElement("canvas");C.className="hiddenCanvasElement",C.lang=I,document.body.append(C),g=C.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#N.set(I,g),this.#R.set(g,{size:0,family:""})}return g}static#M(I,g,C){const A=this.#R.get(I);g===A.size&&C===A.family||(I.font=`${g}px ${C}`,A.size=g,A.family=C)}static#H(){if(this.#h!==null)return;const I=document.createElement("div");I.style.opacity=0,I.style.lineHeight=1,I.style.fontSize="1px",I.style.position="absolute",I.textContent="X",document.body.append(I),this.#h=I.getBoundingClientRect().height,I.remove()}static#K(I,g,C){const A=this.#Y.get(I);if(A)return A;const l=this.#u(C);l.canvas.width=l.canvas.height=oA,this.#M(l,oA,I);const Z=l.measureText(""),i=Z.fontBoundingBoxAscent,d=Math.abs(Z.fontBoundingBoxDescent);l.canvas.width=l.canvas.height=0;let s=.8;return i?s=i/(i+d):(ZI.platform.isFirefox&&F("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),g.ascent?s=g.ascent:g.descent&&(s=1+g.descent)),this.#Y.set(I,s),s}}class Yg{static textContent(I){const g=[],C={items:g,styles:Object.create(null)};function A(l){if(!l)return;let Z=null;const i=l.name;if(i==="#text")Z=l.value;else if(Yg.shouldBuildText(i))l?.attributes?.textContent?Z=l.attributes.textContent:l.value&&(Z=l.value);else return;if(Z!==null&&g.push({str:Z}),!!l.children)for(const d of l.children)A(d)}return A(I),C}static shouldBuildText(I){return!(I==="textarea"||I==="input"||I==="option"||I==="select")}}const fl=100;function wA(c={}){typeof c=="string"||c instanceof URL?c={url:c}:(c instanceof ArrayBuffer||ArrayBuffer.isView(c))&&(c={data:c});const I=new YC,{docId:g}=I,C=c.url?Zl(c.url):null,A=c.data?il(c.data):null,l=c.httpHeaders||null,Z=c.withCredentials===!0,i=c.password??null,d=c.range instanceof YA?c.range:null,s=Number.isInteger(c.rangeChunkSize)&&c.rangeChunkSize>0?c.rangeChunkSize:2**16;let G=c.worker instanceof hg?c.worker:null;const b=c.verbosity,m=typeof c.docBaseUrl=="string"&&!Kg(c.docBaseUrl)?c.docBaseUrl:null,B=zg(c.cMapUrl),o=c.cMapPacked!==!1,W=c.CMapReaderFactory||(_?Wl:rC),Y=zg(c.iccUrl),w=zg(c.standardFontDataUrl),a=c.StandardFontDataFactory||(_?ol:fC),h=zg(c.wasmUrl),N=c.WasmFactory||(_?wl:qC),V=c.stopAtErrors!==!0,R=Number.isInteger(c.maxImageSize)&&c.maxImageSize>-1?c.maxImageSize:-1,X=c.isEvalSupported!==!1,n=typeof c.isOffscreenCanvasSupported=="boolean"?c.isOffscreenCanvasSupported:!_,y=typeof c.isImageDecoderSupported=="boolean"?c.isImageDecoderSupported:!_&&(ZI.platform.isFirefox||!globalThis.chrome),K=Number.isInteger(c.canvasMaxAreaInBytes)?c.canvasMaxAreaInBytes:-1,e=typeof c.disableFontFace=="boolean"?c.disableFontFace:_,T=c.fontExtraProperties===!0,O=c.enableXfa===!0,L=c.ownerDocument||globalThis.document,mI=c.disableRange===!0,M=c.disableStream===!0,u=c.disableAutoFetch===!0,NI=c.pdfBug===!0,pI=c.CanvasFactory||(_?Bl:cl),PI=c.FilterFactory||(_?ml:bl),uI=c.enableHWA===!0,lI=c.useWasm!==!1,f=d?d.length:c.length??NaN,Zg=typeof c.useSystemFonts=="boolean"?c.useSystemFonts:!_&&!e,LI=typeof c.useWorkerFetch=="boolean"?c.useWorkerFetch:!!(W===rC&&a===fC&&N===qC&&B&&w&&h&&cg(B,document.baseURI)&&cg(w,document.baseURI)&&cg(h,document.baseURI)),TI=null;JA(b);const r={canvasFactory:new pI({ownerDocument:L,enableHWA:uI}),filterFactory:new PI({docId:g,ownerDocument:L}),cMapReaderFactory:LI?null:new W({baseUrl:B,isCompressed:o}),standardFontDataFactory:LI?null:new a({baseUrl:w}),wasmFactory:LI?null:new N({baseUrl:h})};G||(G=hg.create({verbosity:b,port:Ig.workerPort}),I._worker=G);const Xg={docId:g,apiVersion:"5.4.54",data:A,password:i,disableAutoFetch:u,rangeChunkSize:s,length:f,docBaseUrl:m,enableXfa:O,evaluatorOptions:{maxImageSize:R,disableFontFace:e,ignoreErrors:V,isEvalSupported:X,isOffscreenCanvasSupported:n,isImageDecoderSupported:y,canvasMaxAreaInBytes:K,fontExtraProperties:T,useSystemFonts:Zg,useWasm:lI,useWorkerFetch:LI,cMapUrl:B,iccUrl:Y,standardFontDataUrl:w,wasmUrl:h}},FZ={ownerDocument:L,pdfBug:NI,styleElement:TI,loadingParams:{disableAutoFetch:u,enableXfa:O}};return G.promise.then(function(){if(I.destroyed)throw new Error("Loading aborted");if(G.destroyed)throw new Error("Worker was destroyed");const zZ=G.messageHandler.sendWithPromise("GetDocRequest",Xg,A?[A.buffer]:null);let uC;if(d)uC=new Kl(d,{disableRange:mI,disableStream:M});else if(!A){if(!C)throw new Error("getDocument - no `url` parameter provided.");const tC=cg(C)?zl:_?vl:Ql;uC=new tC({url:C,length:f,httpHeaders:l,withCredentials:Z,rangeChunkSize:s,disableRange:mI,disableStream:M})}return zZ.then(tC=>{if(I.destroyed)throw new Error("Loading aborted");if(G.destroyed)throw new Error("Worker was destroyed");const eA=new Bg(g,tC,G.port),JZ=new $l(eA,I,uC,FZ,r,uI);I._transport=JZ,eA.send("Ready",null)})}).catch(I._capability.reject),I}class YC{static#I=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${YC.#I++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(I){throw this._worker?.port&&delete this._worker._pendingDestroy,I}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class YA{#I=Promise.withResolvers();#g=[];#C=[];#A=[];#Z=[];constructor(I,g,C=!1,A=null){this.length=I,this.initialData=g,this.progressiveDone=C,this.contentDispositionFilename=A}addRangeListener(I){this.#Z.push(I)}addProgressListener(I){this.#A.push(I)}addProgressiveReadListener(I){this.#C.push(I)}addProgressiveDoneListener(I){this.#g.push(I)}onDataRange(I,g){for(const C of this.#Z)C(I,g)}onDataProgress(I,g){this.#I.promise.then(()=>{for(const C of this.#A)C(I,g)})}onDataProgressiveRead(I){this.#I.promise.then(()=>{for(const g of this.#C)g(I)})}onDataProgressiveDone(){this.#I.promise.then(()=>{for(const I of this.#g)I()})}transportReady(){this.#I.resolve()}requestDataRange(I,g){j("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class _l{constructor(I,g){this._pdfInfo=I,this._transport=g}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return J(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(I){return this._transport.getPage(I)}getPageIndex(I){return this._transport.getPageIndex(I)}getDestinations(){return this._transport.getDestinations()}getDestination(I){return this._transport.getDestination(I)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:I="display"}={}){const{renderingIntent:g}=this._transport.getRenderingIntent(I);return this._transport.getOptionalContentConfig(g)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(I=!1){return this._transport.startCleanup(I||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(I){return this._transport.cachedPageNumber(I)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class ql{#I=!1;constructor(I,g,C,A=!1){this._pageIndex=I,this._pageInfo=g,this._transport=C,this._stats=A?new LC:null,this._pdfBug=A,this.commonObjs=C.commonObjs,this.objs=new WA,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:I,rotation:g=this.rotate,offsetX:C=0,offsetY:A=0,dontFlip:l=!1}={}){return new Gg({viewBox:this.view,userUnit:this.userUnit,scale:I,rotation:g,offsetX:C,offsetY:A,dontFlip:l})}getAnnotations({intent:I="display"}={}){const{renderingIntent:g}=this._transport.getRenderingIntent(I);return this._transport.getAnnotations(this._pageIndex,g)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return J(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:I,canvas:g=I.canvas,viewport:C,intent:A="display",annotationMode:l=FI.ENABLE,transform:Z=null,background:i=null,optionalContentConfigPromise:d=null,annotationCanvasMap:s=null,pageColors:G=null,printAnnotationStorage:b=null,isEditing:m=!1}){this._stats?.time("Overall");const B=this._transport.getRenderingIntent(A,l,b,m),{renderingIntent:o,cacheKey:W}=B;this.#I=!1,d||=this._transport.getOptionalContentConfig(o);let Y=this._intentStates.get(W);Y||(Y=Object.create(null),this._intentStates.set(W,Y)),Y.streamReaderCancelTimeout&&(clearTimeout(Y.streamReaderCancelTimeout),Y.streamReaderCancelTimeout=null);const w=!!(o&wI.PRINT);Y.displayReadyCapability||(Y.displayReadyCapability=Promise.withResolvers(),Y.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(B));const a=V=>{Y.renderTasks.delete(h),w&&(this.#I=!0),this.#g(),V?(h.capability.reject(V),this._abortOperatorList({intentState:Y,reason:V instanceof Error?V:new Error(V)})):h.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},h=new Cg({callback:a,params:{canvas:g,canvasContext:I,viewport:C,transform:Z,background:i},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:s,operatorList:Y.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!w,pdfBug:this._pdfBug,pageColors:G,enableHWA:this._transport.enableHWA});(Y.renderTasks||=new Set).add(h);const N=h.task;return Promise.all([Y.displayReadyCapability.promise,d]).then(([V,R])=>{if(this.destroyed){a();return}if(this._stats?.time("Rendering"),!(R.renderingIntent&o))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");h.initializeGraphics({transparency:V,optionalContentConfig:R}),h.operatorListChanged()}).catch(a),N}getOperatorList({intent:I="display",annotationMode:g=FI.ENABLE,printAnnotationStorage:C=null,isEditing:A=!1}={}){function l(){i.operatorList.lastChunk&&(i.opListReadCapability.resolve(i.operatorList),i.renderTasks.delete(d))}const Z=this._transport.getRenderingIntent(I,g,C,A,!0);let i=this._intentStates.get(Z.cacheKey);i||(i=Object.create(null),this._intentStates.set(Z.cacheKey,i));let d;return i.opListReadCapability||(d=Object.create(null),d.operatorListChanged=l,i.opListReadCapability=Promise.withResolvers(),(i.renderTasks||=new Set).add(d),i.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(Z)),i.opListReadCapability.promise}streamTextContent({includeMarkedContent:I=!1,disableNormalization:g=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:I===!0,disableNormalization:g===!0},{highWaterMark:100,size(A){return A.items.length}})}getTextContent(I={}){if(this._transport._htmlForXfa)return this.getXfa().then(C=>Yg.textContent(C));const g=this.streamTextContent(I);return new Promise(function(C,A){function l(){Z.read().then(function({value:d,done:s}){if(s){C(i);return}i.lang??=d.lang,Object.assign(i.styles,d.styles),i.items.push(...d.items),l()},A)}const Z=g.getReader(),i={items:[],styles:Object.create(null),lang:null};l()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const I=[];for(const g of this._intentStates.values())if(this._abortOperatorList({intentState:g,reason:new Error("Page was destroyed."),force:!0}),!g.opListReadCapability)for(const C of g.renderTasks)I.push(C.completed),C.cancel();return this.objs.clear(),this.#I=!1,Promise.all(I)}cleanup(I=!1){this.#I=!0;const g=this.#g();return I&&g&&(this._stats&&=new LC),g}#g(){if(!this.#I||this.destroyed)return!1;for(const{renderTasks:I,operatorList:g}of this._intentStates.values())if(I.size>0||!g.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#I=!1,!0}_startRenderPage(I,g){const C=this._intentStates.get(g);C&&(this._stats?.timeEnd("Page Request"),C.displayReadyCapability?.resolve(I))}_renderPageChunk(I,g){for(let C=0,A=I.length;C<A;C++)g.operatorList.fnArray.push(I.fnArray[C]),g.operatorList.argsArray.push(I.argsArray[C]);g.operatorList.lastChunk=I.lastChunk,g.operatorList.separateAnnots=I.separateAnnots;for(const C of g.renderTasks)C.operatorListChanged();I.lastChunk&&this.#g()}_pumpOperatorList({renderingIntent:I,cacheKey:g,annotationStorageSerializable:C,modifiedIds:A}){const{map:l,transfer:Z}=C,d=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:I,cacheKey:g,annotationStorage:l,modifiedIds:A},Z).getReader(),s=this._intentStates.get(g);s.streamReader=d;const G=()=>{d.read().then(({value:b,done:m})=>{if(m){s.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(b,s),G())},b=>{if(s.streamReader=null,!this._transport.destroyed){if(s.operatorList){s.operatorList.lastChunk=!0;for(const m of s.renderTasks)m.operatorListChanged();this.#g()}if(s.displayReadyCapability)s.displayReadyCapability.reject(b);else if(s.opListReadCapability)s.opListReadCapability.reject(b);else throw b}})};G()}_abortOperatorList({intentState:I,reason:g,force:C=!1}){if(I.streamReader){if(I.streamReaderCancelTimeout&&(clearTimeout(I.streamReaderCancelTimeout),I.streamReaderCancelTimeout=null),!C){if(I.renderTasks.size>0)return;if(g instanceof IC){let A=fl;g.extraDelay>0&&g.extraDelay<1e3&&(A+=g.extraDelay),I.streamReaderCancelTimeout=setTimeout(()=>{I.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:I,reason:g,force:!0})},A);return}}if(I.streamReader.cancel(new zI(g.message)).catch(()=>{}),I.streamReader=null,!this._transport.destroyed){for(const[A,l]of this._intentStates)if(l===I){this._intentStates.delete(A);break}this.cleanup()}}}get stats(){return this._stats}}const U=class U{constructor({name:I=null,port:g=null,verbosity:C=kA()}={}){tI(this,bI);tI(this,kI,Promise.withResolvers());tI(this,RI,null);tI(this,SI,null);tI(this,vI,null);if(this.name=I,this.destroyed=!1,this.verbosity=C,g){if(x(U,EI).has(g))throw new Error("Cannot use more than one PDFWorker per port.");x(U,EI).set(g,this),eI(this,bI,SA).call(this,g)}else eI(this,bI,pA).call(this)}get promise(){return x(this,kI).promise}get port(){return x(this,SI)}get messageHandler(){return x(this,RI)}destroy(){this.destroyed=!0,x(this,vI)?.terminate(),oI(this,vI,null),x(U,EI).delete(x(this,SI)),oI(this,SI,null),x(this,RI)?.destroy(),oI(this,RI,null)}static create(I){const g=x(this,EI).get(I?.port);if(g){if(g._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return g}return new U(I)}static get workerSrc(){if(Ig.workerSrc)return Ig.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return J(this,"_setupFakeWorkerGlobal",(async()=>x(this,lg,rg)?x(this,lg,rg):(await import(this.workerSrc)).WorkerMessageHandler)())}};kI=new WeakMap,RI=new WeakMap,SI=new WeakMap,vI=new WeakMap,xg=new WeakMap,rI=new WeakMap,EI=new WeakMap,bI=new WeakSet,vg=function(){x(this,kI).resolve(),x(this,RI).send("configure",{verbosity:this.verbosity})},SA=function(I){oI(this,SI,I),oI(this,RI,new Bg("main","worker",I)),x(this,RI).on("ready",()=>{}),eI(this,bI,vg).call(this)},pA=function(){if(x(U,rI)||x(U,lg,rg)){eI(this,bI,ng).call(this);return}let{workerSrc:I}=U;try{U._isSameOrigin(window.location,I)||(I=U._createCDNWrapper(new URL(I,window.location).href));const g=new Worker(I,{type:"module"}),C=new Bg("main","worker",g),A=()=>{l.abort(),C.destroy(),g.terminate(),this.destroyed?x(this,kI).reject(new Error("Worker was destroyed")):eI(this,bI,ng).call(this)},l=new AbortController;g.addEventListener("error",()=>{x(this,vI)||A()},{signal:l.signal}),C.on("test",i=>{if(l.abort(),this.destroyed||!i){A();return}oI(this,RI,C),oI(this,SI,g),oI(this,vI,g),eI(this,bI,vg).call(this)}),C.on("ready",i=>{if(l.abort(),this.destroyed){A();return}try{Z()}catch{eI(this,bI,ng).call(this)}});const Z=()=>{const i=new Uint8Array;C.send("test",i,[i.buffer])};Z();return}catch{eg("The worker has been disabled.")}eI(this,bI,ng).call(this)},ng=function(){x(U,rI)||(F("Setting up fake worker."),oI(U,rI,!0)),U._setupFakeWorkerGlobal.then(I=>{if(this.destroyed){x(this,kI).reject(new Error("Worker was destroyed"));return}const g=new Gl;oI(this,SI,g);const C=`fake${KA(U,xg)._++}`,A=new Bg(C+"_worker",C,g);I.setup(A,g),oI(this,RI,new Bg(C,C+"_worker",g)),eI(this,bI,vg).call(this)}).catch(I=>{x(this,kI).reject(new Error(`Setting up fake worker failed: "${I.message}".`))})},lg=new WeakSet,rg=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},tI(U,lg),tI(U,xg,0),tI(U,rI,!1),tI(U,EI,new WeakMap),_&&(oI(U,rI,!0),Ig.workerSrc||="./pdf.worker.mjs"),U._isSameOrigin=(I,g)=>{const C=URL.parse(I);if(!C?.origin||C.origin==="null")return!1;const A=new URL(g,C);return C.origin===A.origin},U._createCDNWrapper=I=>{const g=`await import("${I}");`;return URL.createObjectURL(new Blob([g],{type:"text/javascript"}))},U.fromPort=I=>{if(fA("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!I?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return U.create(I)};let hg=U;class $l{#I=new Map;#g=new Map;#C=new Map;#A=new Map;#Z=null;constructor(I,g,C,A,l,Z){this.messageHandler=I,this.loadingTask=g,this.commonObjs=new WA,this.fontLoader=new Al({ownerDocument:A.ownerDocument,styleElement:A.styleElement}),this.loadingParams=A.loadingParams,this._params=A,this.canvasFactory=l.canvasFactory,this.filterFactory=l.filterFactory,this.cMapReaderFactory=l.cMapReaderFactory,this.standardFontDataFactory=l.standardFontDataFactory,this.wasmFactory=l.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=C,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=Z,this.setupMessageHandler()}#l(I,g=null){const C=this.#I.get(I);if(C)return C;const A=this.messageHandler.sendWithPromise(I,g);return this.#I.set(I,A),A}get annotationStorage(){return J(this,"annotationStorage",new dC)}getRenderingIntent(I,g=FI.ENABLE,C=null,A=!1,l=!1){let Z=wI.DISPLAY,i=iC;switch(I){case"any":Z=wI.ANY;break;case"display":break;case"print":Z=wI.PRINT;break;default:F(`getRenderingIntent - invalid intent: ${I}`)}const d=Z&wI.PRINT&&C instanceof OC?C:this.annotationStorage;switch(g){case FI.DISABLE:Z+=wI.ANNOTATIONS_DISABLE;break;case FI.ENABLE:break;case FI.ENABLE_FORMS:Z+=wI.ANNOTATIONS_FORMS;break;case FI.ENABLE_STORAGE:Z+=wI.ANNOTATIONS_STORAGE,i=d.serializable;break;default:F(`getRenderingIntent - invalid annotationMode: ${g}`)}A&&(Z+=wI.IS_EDITING),l&&(Z+=wI.OPLIST);const{ids:s,hash:G}=d.modifiedIds,b=[Z,i.hash,G];return{renderingIntent:Z,cacheKey:b.join("_"),annotationStorageSerializable:i,modifiedIds:s}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#Z?.reject(new Error("Worker was destroyed during onPassword callback"));const I=[];for(const C of this.#g.values())I.push(C._destroy());this.#g.clear(),this.#C.clear(),this.#A.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const g=this.messageHandler.sendWithPromise("Terminate",null);return I.push(g),Promise.all(I).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#I.clear(),this.filterFactory.destroy(),cI.cleanup(),this._networkStream?.cancelAllRequests(new zI("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:I,loadingTask:g}=this;I.on("GetReader",(C,A)=>{$(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=l=>{this._lastProgress={loaded:l.loaded,total:l.total}},A.onPull=()=>{this._fullReader.read().then(function({value:l,done:Z}){if(Z){A.close();return}$(l instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),A.enqueue(new Uint8Array(l),1,[l])}).catch(l=>{A.error(l)})},A.onCancel=l=>{this._fullReader.cancel(l),A.ready.catch(Z=>{if(!this.destroyed)throw Z})}}),I.on("ReaderHeadersReady",async C=>{await this._fullReader.headersReady;const{isStreamingSupported:A,isRangeSupported:l,contentLength:Z}=this._fullReader;return(!A||!l)&&(this._lastProgress&&g.onProgress?.(this._lastProgress),this._fullReader.onProgress=i=>{g.onProgress?.({loaded:i.loaded,total:i.total})}),{isStreamingSupported:A,isRangeSupported:l,contentLength:Z}}),I.on("GetRangeReader",(C,A)=>{$(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const l=this._networkStream.getRangeReader(C.begin,C.end);if(!l){A.close();return}A.onPull=()=>{l.read().then(function({value:Z,done:i}){if(i){A.close();return}$(Z instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),A.enqueue(new Uint8Array(Z),1,[Z])}).catch(Z=>{A.error(Z)})},A.onCancel=Z=>{l.cancel(Z),A.ready.catch(i=>{if(!this.destroyed)throw i})}}),I.on("GetDoc",({pdfInfo:C})=>{this._numPages=C.numPages,this._htmlForXfa=C.htmlForXfa,delete C.htmlForXfa,g._capability.resolve(new _l(C,this))}),I.on("DocException",C=>{g._capability.reject(BI(C))}),I.on("PasswordRequest",C=>{this.#Z=Promise.withResolvers();try{if(!g.onPassword)throw BI(C);const A=l=>{l instanceof Error?this.#Z.reject(l):this.#Z.resolve({password:l})};g.onPassword(A,C.code)}catch(A){this.#Z.reject(A)}return this.#Z.promise}),I.on("DataLoaded",C=>{g.onProgress?.({loaded:C.length,total:C.length}),this.downloadInfoCapability.resolve(C)}),I.on("StartRenderPage",C=>{if(this.destroyed)return;this.#g.get(C.pageIndex)._startRenderPage(C.transparency,C.cacheKey)}),I.on("commonobj",([C,A,l])=>{if(this.destroyed||this.commonObjs.has(C))return null;switch(A){case"Font":if("error"in l){const s=l.error;F(`Error during font loading: ${s}`),this.commonObjs.resolve(C,s);break}const Z=this._params.pdfBug&&globalThis.FontInspector?.enabled?(s,G)=>globalThis.FontInspector.fontAdded(s,G):null,i=new ll(l,Z);this.fontLoader.bind(i).catch(()=>I.sendWithPromise("FontFallback",{id:C})).finally(()=>{!i.fontExtraProperties&&i.data&&(i.data=null),this.commonObjs.resolve(C,i)});break;case"CopyLocalImage":const{imageRef:d}=l;$(d,"The imageRef must be defined.");for(const s of this.#g.values())for(const[,G]of s.objs)if(G?.ref===d)return G.dataLen?(this.commonObjs.resolve(C,structuredClone(G)),G.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(C,l);break;default:throw new Error(`Got unknown common object type ${A}`)}return null}),I.on("obj",([C,A,l,Z])=>{if(this.destroyed)return;const i=this.#g.get(A);if(!i.objs.has(C)){if(i._intentStates.size===0){Z?.bitmap?.close();return}switch(l){case"Image":case"Pattern":i.objs.resolve(C,Z);break;default:throw new Error(`Got unknown object type ${l}`)}}}),I.on("DocProgress",C=>{this.destroyed||g.onProgress?.({loaded:C.loaded,total:C.total})}),I.on("FetchBinaryData",async C=>{if(this.destroyed)throw new Error("Worker was destroyed.");const A=this[C.type];if(!A)throw new Error(`${C.type} not initialized, see the \`useWorkerFetch\` parameter.`);return A.fetch(C)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&F("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:I,transfer:g}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:I,filename:this._fullReader?.filename??null},g).finally(()=>{this.annotationStorage.resetModified()})}getPage(I){if(!Number.isInteger(I)||I<=0||I>this._numPages)return Promise.reject(new Error("Invalid page request."));const g=I-1,C=this.#C.get(g);if(C)return C;const A=this.messageHandler.sendWithPromise("GetPage",{pageIndex:g}).then(l=>{if(this.destroyed)throw new Error("Transport destroyed");l.refStr&&this.#A.set(l.refStr,I);const Z=new ql(g,l,this,this._params.pdfBug);return this.#g.set(g,Z),Z});return this.#C.set(g,A),A}getPageIndex(I){return sC(I)?this.messageHandler.sendWithPromise("GetPageIndex",{num:I.num,gen:I.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(I,g){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:I,intent:g})}getFieldObjects(){return this.#l("GetFieldObjects")}hasJSActions(){return this.#l("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(I){return typeof I!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:I})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#l("GetDocJSActions")}getPageJSActions(I){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:I})}getStructTree(I){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:I})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(I){return this.#l("GetOptionalContentConfig").then(g=>new Dl(g,I))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const I="GetMetadata",g=this.#I.get(I);if(g)return g;const C=this.messageHandler.sendWithPromise(I,null).then(A=>({info:A[0],metadata:A[1]?new tl(A[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#I.set(I,C),C}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(I=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const g of this.#g.values())if(!g.cleanup())throw new Error(`startCleanup: Page ${g.pageNumber} is currently rendering.`);this.commonObjs.clear(),I||this.fontLoader.clear(),this.#I.clear(),this.filterFactory.destroy(!0),cI.cleanup()}}cachedPageNumber(I){if(!sC(I))return null;const g=I.gen===0?`${I.num}R`:`${I.num}R${I.gen}`;return this.#A.get(g)??null}}class IZ{#I=null;onContinue=null;onError=null;constructor(I){this.#I=I}get promise(){return this.#I.capability.promise}cancel(I=0){this.#I.cancel(null,I)}get separateAnnots(){const{separateAnnots:I}=this.#I.operatorList;if(!I)return!1;const{annotationCanvasMap:g}=this.#I;return I.form||I.canvas&&g?.size>0}}class Cg{#I=null;static#g=new WeakSet;constructor({callback:I,params:g,objs:C,commonObjs:A,annotationCanvasMap:l,operatorList:Z,pageIndex:i,canvasFactory:d,filterFactory:s,useRequestAnimationFrame:G=!1,pdfBug:b=!1,pageColors:m=null,enableHWA:B=!1}){this.callback=I,this.params=g,this.objs=C,this.commonObjs=A,this.annotationCanvasMap=l,this.operatorListIdx=null,this.operatorList=Z,this._pageIndex=i,this.canvasFactory=d,this.filterFactory=s,this._pdfBug=b,this.pageColors=m,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=G===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new IZ(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=g.canvas,this._canvasContext=g.canvas?null:g.canvasContext,this._enableHWA=B}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:I=!1,optionalContentConfig:g}){if(this.cancelled)return;if(this._canvas){if(Cg.#g.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Cg.#g.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:C,transform:A,background:l}=this.params,Z=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new $I(Z,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:g},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:A,viewport:C,transparency:I,background:l}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(I=null,g=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#I&&(window.cancelAnimationFrame(this.#I),this.#I=null),Cg.#g.delete(this._canvas),I||=new IC(`Rendering cancelled, page ${this._pageIndex+1}`,g),this.callback(I),this.task.onError?.(I)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#I=window.requestAnimationFrame(()=>{this.#I=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Cg.#g.delete(this._canvas),this.callback())))}}const gZ="5.4.54",CZ="295fb3ec4";class VI{#I=null;#g=null;#C;#A=null;#Z=!1;#l=!1;#i=null;#d;#c=null;#G=null;static#m=null;static get _keyboardManager(){return J(this,"_keyboardManager",new mg([[["Escape","mac+Escape"],VI.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],VI.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],VI.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],VI.prototype._moveToPrevious],[["Home","mac+Home"],VI.prototype._moveToBeginning],[["End","mac+End"],VI.prototype._moveToEnd]]))}constructor({editor:I=null,uiManager:g=null}){I?(this.#l=!1,this.#i=I):this.#l=!0,this.#G=I?._uiManager||g,this.#d=this.#G._eventBus,this.#C=I?.color?.toUpperCase()||this.#G?.highlightColors.values().next().value||"#FFFF98",VI.#m||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const I=this.#I=document.createElement("button");I.className="colorPicker",I.tabIndex="0",I.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),I.ariaHasPopup="true",this.#i&&(I.ariaControls=`${this.#i.id}_colorpicker_dropdown`);const g=this.#G._signal;I.addEventListener("click",this.#B.bind(this),{signal:g}),I.addEventListener("keydown",this.#w.bind(this),{signal:g});const C=this.#g=document.createElement("span");return C.className="swatch",C.ariaHidden="true",C.style.backgroundColor=this.#C,I.append(C),I}renderMainDropdown(){const I=this.#A=this.#s();return I.ariaOrientation="horizontal",I.ariaLabelledBy="highlightColorPickerLabel",I}#s(){const I=document.createElement("div"),g=this.#G._signal;I.addEventListener("contextmenu",hI,{signal:g}),I.className="dropdown",I.role="listbox",I.ariaMultiSelectable="false",I.ariaOrientation="vertical",I.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#i&&(I.id=`${this.#i.id}_colorpicker_dropdown`);for(const[C,A]of this.#G.highlightColors){const l=document.createElement("button");l.tabIndex="0",l.role="option",l.setAttribute("data-color",A),l.title=C,l.setAttribute("data-l10n-id",VI.#m[C]);const Z=document.createElement("span");l.append(Z),Z.className="swatch",Z.style.backgroundColor=A,l.ariaSelected=A===this.#C,l.addEventListener("click",this.#W.bind(this,A),{signal:g}),I.append(l)}return I.addEventListener("keydown",this.#w.bind(this),{signal:g}),I}#W(I,g){g.stopPropagation(),this.#d.dispatch("switchannotationeditorparams",{source:this,type:k.HIGHLIGHT_COLOR,value:I}),this.updateColor(I)}_colorSelectFromKeyboard(I){if(I.target===this.#I){this.#B(I);return}const g=I.target.getAttribute("data-color");g&&this.#W(g,I)}_moveToNext(I){if(!this.#o){this.#B(I);return}if(I.target===this.#I){this.#A.firstChild?.focus();return}I.target.nextSibling?.focus()}_moveToPrevious(I){if(I.target===this.#A?.firstChild||I.target===this.#I){this.#o&&this._hideDropdownFromKeyboard();return}this.#o||this.#B(I),I.target.previousSibling?.focus()}_moveToBeginning(I){if(!this.#o){this.#B(I);return}this.#A.firstChild?.focus()}_moveToEnd(I){if(!this.#o){this.#B(I);return}this.#A.lastChild?.focus()}#w(I){VI._keyboardManager.exec(this,I)}#B(I){if(this.#o){this.hideDropdown();return}if(this.#Z=I.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#b.bind(this),{signal:this.#G.combinedSignal(this.#c)})),this.#I.ariaExpanded="true",this.#A){this.#A.classList.remove("hidden");return}const g=this.#A=this.#s();this.#I.append(g)}#b(I){this.#A?.contains(I.target)||this.hideDropdown()}hideDropdown(){this.#A?.classList.add("hidden"),this.#I.ariaExpanded="false",this.#c?.abort(),this.#c=null}get#o(){return this.#A&&!this.#A.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#l){if(!this.#o){this.#i?.unselect();return}this.hideDropdown(),this.#I.focus({preventScroll:!0,focusVisible:this.#Z})}}updateColor(I){if(this.#g&&(this.#g.style.backgroundColor=I),!this.#A)return;const g=this.#G.highlightColors.values();for(const C of this.#A.children)C.ariaSelected=g.next().value===I.toUpperCase()}destroy(){this.#I?.remove(),this.#I=null,this.#g=null,this.#A?.remove(),this.#A=null}}class ag{#I=null;#g=null;#C=null;static#A=null;constructor(I){this.#g=I,this.#C=I._uiManager,ag.#A||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#I)return this.#I;const{editorType:I,colorType:g,colorValue:C}=this.#g,A=this.#I=document.createElement("input");return A.type="color",A.value=C||"#000000",A.className="basicColorPicker",A.tabIndex=0,A.setAttribute("data-l10n-id",ag.#A[I]),A.addEventListener("input",()=>{this.#C.updateParams(g,A.value)},{signal:this.#C._signal}),A}update(I){this.#I&&(this.#I.value=I)}destroy(){this.#I?.remove(),this.#I=null}hideDropdown(){}}function hA(c){return Math.floor(Math.max(0,Math.min(1,c))*255).toString(16).padStart(2,"0")}function Vg(c){return Math.max(0,Math.min(255,255*c))}class aA{static CMYK_G([I,g,C,A]){return["G",1-Math.min(1,.3*I+.59*C+.11*g+A)]}static G_CMYK([I]){return["CMYK",0,0,0,1-I]}static G_RGB([I]){return["RGB",I,I,I]}static G_rgb([I]){return I=Vg(I),[I,I,I]}static G_HTML([I]){const g=hA(I);return`#${g}${g}${g}`}static RGB_G([I,g,C]){return["G",.3*I+.59*g+.11*C]}static RGB_rgb(I){return I.map(Vg)}static RGB_HTML(I){return`#${I.map(hA).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([I,g,C,A]){return["RGB",1-Math.min(1,I+A),1-Math.min(1,C+A),1-Math.min(1,g+A)]}static CMYK_rgb([I,g,C,A]){return[Vg(1-Math.min(1,I+A)),Vg(1-Math.min(1,C+A)),Vg(1-Math.min(1,g+A))]}static CMYK_HTML(I){const g=this.CMYK_RGB(I).slice(1);return this.RGB_HTML(g)}static RGB_CMYK([I,g,C]){const A=1-I,l=1-g,Z=1-C,i=Math.min(A,l,Z);return["CMYK",A,l,Z,i]}}class AZ{create(I,g,C=!1){if(I<=0||g<=0)throw new Error("Invalid SVG dimensions");const A=this._createSVG("svg:svg");return A.setAttribute("version","1.1"),C||(A.setAttribute("width",`${I}px`),A.setAttribute("height",`${g}px`)),A.setAttribute("preserveAspectRatio","none"),A.setAttribute("viewBox",`0 0 ${I} ${g}`),A}createElement(I){if(typeof I!="string")throw new Error("Invalid SVG element type");return this._createSVG(I)}_createSVG(I){j("Abstract method `_createSVG` called.")}}class Qg extends AZ{_createSVG(I){return document.createElementNS(DI,I)}}class VA{static setupStorage(I,g,C,A,l){const Z=A.getValue(g,{value:null});switch(C.name){case"textarea":if(Z.value!==null&&(I.textContent=Z.value),l==="print")break;I.addEventListener("input",i=>{A.setValue(g,{value:i.target.value})});break;case"input":if(C.attributes.type==="radio"||C.attributes.type==="checkbox"){if(Z.value===C.attributes.xfaOn?I.setAttribute("checked",!0):Z.value===C.attributes.xfaOff&&I.removeAttribute("checked"),l==="print")break;I.addEventListener("change",i=>{A.setValue(g,{value:i.target.checked?i.target.getAttribute("xfaOn"):i.target.getAttribute("xfaOff")})})}else{if(Z.value!==null&&I.setAttribute("value",Z.value),l==="print")break;I.addEventListener("input",i=>{A.setValue(g,{value:i.target.value})})}break;case"select":if(Z.value!==null){I.setAttribute("value",Z.value);for(const i of C.children)i.attributes.value===Z.value?i.attributes.selected=!0:i.attributes.hasOwnProperty("selected")&&delete i.attributes.selected}I.addEventListener("input",i=>{const d=i.target.options,s=d.selectedIndex===-1?"":d[d.selectedIndex].value;A.setValue(g,{value:s})});break}}static setAttributes({html:I,element:g,storage:C=null,intent:A,linkService:l}){const{attributes:Z}=g,i=I instanceof HTMLAnchorElement;Z.type==="radio"&&(Z.name=`${Z.name}-${A}`);for(const[d,s]of Object.entries(Z))if(s!=null)switch(d){case"class":s.length&&I.setAttribute(d,s.join(" "));break;case"dataId":break;case"id":I.setAttribute("data-element-id",s);break;case"style":Object.assign(I.style,s);break;case"textContent":I.textContent=s;break;default:(!i||d!=="href"&&d!=="newWindow")&&I.setAttribute(d,s)}i&&l.addLinkAttributes(I,Z.href,Z.newWindow),C&&Z.dataId&&this.setupStorage(I,Z.dataId,g,C)}static render(I){const g=I.annotationStorage,C=I.linkService,A=I.xfaHtml,l=I.intent||"display",Z=document.createElement(A.name);A.attributes&&this.setAttributes({html:Z,element:A,intent:l,linkService:C});const i=l!=="richText",d=I.div;if(d.append(Z),I.viewport){const b=`matrix(${I.viewport.transform.join(",")})`;d.style.transform=b}i&&d.setAttribute("class","xfaLayer xfaFont");const s=[];if(A.children.length===0){if(A.value){const b=document.createTextNode(A.value);Z.append(b),i&&Yg.shouldBuildText(A.name)&&s.push(b)}return{textDivs:s}}const G=[[A,-1,Z]];for(;G.length>0;){const[b,m,B]=G.at(-1);if(m+1===b.children.length){G.pop();continue}const o=b.children[++G.at(-1)[1]];if(o===null)continue;const{name:W}=o;if(W==="#text"){const w=document.createTextNode(o.value);s.push(w),B.append(w);continue}const Y=o?.attributes?.xmlns?document.createElementNS(o.attributes.xmlns,W):document.createElement(W);if(B.append(Y),o.attributes&&this.setAttributes({html:Y,element:o,storage:g,intent:l,linkService:C}),o.children?.length>0)G.push([o,-1,Y]);else if(o.value){const w=document.createTextNode(o.value);i&&Yg.shouldBuildText(W)&&s.push(w),Y.append(w)}}for(const b of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))b.setAttribute("readOnly",!0);return{textDivs:s}}static update(I){const g=`matrix(${I.viewport.transform.join(",")})`;I.div.style.transform=g,I.div.hidden=!1}}const lZ=9,OI=new WeakSet,ZZ=new Date().getTimezoneOffset()*60*1e3;class NA{static create(I){switch(I.data.annotationType){case q.LINK:return new hC(I);case q.TEXT:return new iZ(I);case q.WIDGET:switch(I.data.fieldType){case"Tx":return new dZ(I);case"Btn":return I.data.radioButton?new RA(I):I.data.checkBox?new GZ(I):new cZ(I);case"Ch":return new bZ(I);case"Sig":return new sZ(I)}return new UI(I);case q.POPUP:return new aC(I);case q.FREETEXT:return new XA(I);case q.LINE:return new BZ(I);case q.SQUARE:return new WZ(I);case q.CIRCLE:return new oZ(I);case q.POLYLINE:return new nA(I);case q.CARET:return new YZ(I);case q.INK:return new VC(I);case q.POLYGON:return new wZ(I);case q.HIGHLIGHT:return new yA(I);case q.UNDERLINE:return new hZ(I);case q.SQUIGGLY:return new aZ(I);case q.STRIKEOUT:return new VZ(I);case q.STAMP:return new HA(I);case q.FILEATTACHMENT:return new NZ(I);default:return new E(I)}}}class E{#I=null;#g=!1;#C=null;constructor(I,{isRenderable:g=!1,ignoreBorder:C=!1,createQuadrilaterals:A=!1}={}){this.isRenderable=g,this.data=I.data,this.layer=I.layer,this.linkService=I.linkService,this.downloadManager=I.downloadManager,this.imageResourcesPath=I.imageResourcesPath,this.renderForms=I.renderForms,this.svgFactory=I.svgFactory,this.annotationStorage=I.annotationStorage,this.enableScripting=I.enableScripting,this.hasJSActions=I.hasJSActions,this._fieldObjects=I.fieldObjects,this.parent=I.parent,g&&(this.container=this._createContainer(C)),A&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:I,richText:g}){return!!(I?.str||g?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return E._hasPopupData(this.data)}updateEdited(I){if(!this.container)return;I.rect&&(this.#I||={rect:this.data.rect.slice(0)});const{rect:g,popup:C}=I;g&&this.#A(g);let A=this.#C?.popup||this.popup;!A&&C?.text&&(this._createPopup(C),A=this.#C.popup),A&&(A.updateEdited(I),C?.deleted&&(A.remove(),this.#C=null,this.popup=null))}resetEdited(){this.#I&&(this.#A(this.#I.rect),this.#C?.popup.resetEdited(),this.#I=null)}#A(I){const{container:{style:g},data:{rect:C,rotation:A},parent:{viewport:{rawDims:{pageWidth:l,pageHeight:Z,pageX:i,pageY:d}}}}=this;C?.splice(0,4,...I),g.left=`${100*(I[0]-i)/l}%`,g.top=`${100*(Z-I[3]+d)/Z}%`,A===0?(g.width=`${100*(I[2]-I[0])/l}%`,g.height=`${100*(I[3]-I[1])/Z}%`):this.setRotation(A)}_createContainer(I){const{data:g,parent:{page:C,viewport:A}}=this,l=document.createElement("section");l.setAttribute("data-annotation-id",g.id),!(this instanceof UI)&&!(this instanceof hC)&&(l.tabIndex=0);const{style:Z}=l;if(Z.zIndex=this.parent.zIndex++,g.alternativeText&&(l.title=g.alternativeText),g.noRotate&&l.classList.add("norotate"),!g.rect||this instanceof aC){const{rotation:W}=g;return!g.hasOwnCanvas&&W!==0&&this.setRotation(W,l),l}const{width:i,height:d}=this;if(!I&&g.borderStyle.width>0){Z.borderWidth=`${g.borderStyle.width}px`;const W=g.borderStyle.horizontalCornerRadius,Y=g.borderStyle.verticalCornerRadius;if(W>0||Y>0){const a=`calc(${W}px * var(--total-scale-factor)) / calc(${Y}px * var(--total-scale-factor))`;Z.borderRadius=a}else if(this instanceof RA){const a=`calc(${i}px * var(--total-scale-factor)) / calc(${d}px * var(--total-scale-factor))`;Z.borderRadius=a}switch(g.borderStyle.style){case fI.SOLID:Z.borderStyle="solid";break;case fI.DASHED:Z.borderStyle="dashed";break;case fI.BEVELED:F("Unimplemented border style: beveled");break;case fI.INSET:F("Unimplemented border style: inset");break;case fI.UNDERLINE:Z.borderBottomStyle="solid";break}const w=g.borderColor||null;w?(this.#g=!0,Z.borderColor=t.makeHexColor(w[0]|0,w[1]|0,w[2]|0)):Z.borderWidth=0}const s=t.normalizeRect([g.rect[0],C.view[3]-g.rect[1]+C.view[1],g.rect[2],C.view[3]-g.rect[3]+C.view[1]]),{pageWidth:G,pageHeight:b,pageX:m,pageY:B}=A.rawDims;Z.left=`${100*(s[0]-m)/G}%`,Z.top=`${100*(s[1]-B)/b}%`;const{rotation:o}=g;return g.hasOwnCanvas||o===0?(Z.width=`${100*i/G}%`,Z.height=`${100*d/b}%`):this.setRotation(o,l),l}setRotation(I,g=this.container){if(!this.data.rect)return;const{pageWidth:C,pageHeight:A}=this.parent.viewport.rawDims;let{width:l,height:Z}=this;I%180!==0&&([l,Z]=[Z,l]),g.style.width=`${100*l/C}%`,g.style.height=`${100*Z/A}%`,g.setAttribute("data-main-rotation",(360-I)%360)}get _commonActions(){const I=(g,C,A)=>{const l=A.detail[g],Z=l[0],i=l.slice(1);A.target.style[C]=aA[`${Z}_HTML`](i),this.annotationStorage.setValue(this.data.id,{[C]:aA[`${Z}_rgb`](i)})};return J(this,"_commonActions",{display:g=>{const{display:C}=g.detail,A=C%2===1;this.container.style.visibility=A?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:A,noPrint:C===1||C===2})},print:g=>{this.annotationStorage.setValue(this.data.id,{noPrint:!g.detail.print})},hidden:g=>{const{hidden:C}=g.detail;this.container.style.visibility=C?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:C,noView:C})},focus:g=>{setTimeout(()=>g.target.focus({preventScroll:!1}),0)},userName:g=>{g.target.title=g.detail.userName},readonly:g=>{g.target.disabled=g.detail.readonly},required:g=>{this._setRequired(g.target,g.detail.required)},bgColor:g=>{I("bgColor","backgroundColor",g)},fillColor:g=>{I("fillColor","backgroundColor",g)},fgColor:g=>{I("fgColor","color",g)},textColor:g=>{I("textColor","color",g)},borderColor:g=>{I("borderColor","borderColor",g)},strokeColor:g=>{I("strokeColor","borderColor",g)},rotation:g=>{const C=g.detail.rotation;this.setRotation(C),this.annotationStorage.setValue(this.data.id,{rotation:C})}})}_dispatchEventFromSandbox(I,g){const C=this._commonActions;for(const A of Object.keys(g.detail))(I[A]||C[A])?.(g)}_setDefaultPropertiesFromJS(I){if(!this.enableScripting)return;const g=this.annotationStorage.getRawValue(this.data.id);if(!g)return;const C=this._commonActions;for(const[A,l]of Object.entries(g)){const Z=C[A];if(Z){const i={detail:{[A]:l},target:I};Z(i),delete g[A]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:I}=this.data;if(!I)return;const[g,C,A,l]=this.data.rect.map(W=>Math.fround(W));if(I.length===8){const[W,Y,w,a]=I.subarray(2,6);if(A===W&&l===Y&&g===w&&C===a)return}const{style:Z}=this.container;let i;if(this.#g){const{borderColor:W,borderWidth:Y}=Z;Z.borderWidth=0,i=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${W}" stroke-width="${Y}">`],this.container.classList.add("hasBorder")}const d=A-g,s=l-C,{svgFactory:G}=this,b=G.createElement("svg");b.classList.add("quadrilateralsContainer"),b.setAttribute("width",0),b.setAttribute("height",0),b.role="none";const m=G.createElement("defs");b.append(m);const B=G.createElement("clipPath"),o=`clippath_${this.data.id}`;B.setAttribute("id",o),B.setAttribute("clipPathUnits","objectBoundingBox"),m.append(B);for(let W=2,Y=I.length;W<Y;W+=8){const w=I[W],a=I[W+1],h=I[W+2],N=I[W+3],V=G.createElement("rect"),R=(h-g)/d,X=(l-a)/s,n=(w-h)/d,y=(a-N)/s;V.setAttribute("x",R),V.setAttribute("y",X),V.setAttribute("width",n),V.setAttribute("height",y),B.append(V),i?.push(`<rect vector-effect="non-scaling-stroke" x="${R}" y="${X}" width="${n}" height="${y}"/>`)}this.#g&&(i.push("</g></svg>')"),Z.backgroundImage=i.join("")),this.container.append(b),this.container.style.clipPath=`url(#${o})`}_createPopup(I=null){const{data:g}=this;let C,A;I?(C={str:I.text},A=I.date):(C=g.contentsObj,A=g.modificationDate);const l=this.#C=new aC({data:{color:g.color,titleObj:g.titleObj,modificationDate:A,contentsObj:C,richText:g.richText,parentRect:g.rect,borderStyle:0,id:`popup_${g.id}`,rotation:g.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent.div.append(l.render())}get hasPopupElement(){return!!(this.#C||this.popup||this.data.popupRef)}render(){j("Abstract method `AnnotationElement.render` called")}_getElementsByName(I,g=null){const C=[];if(this._fieldObjects){const A=this._fieldObjects[I];if(A)for(const{page:l,id:Z,exportValues:i}of A){if(l===-1||Z===g)continue;const d=typeof i=="string"?i:null,s=document.querySelector(`[data-element-id="${Z}"]`);if(s&&!OI.has(s)){F(`_getElementsByName - element not allowed: ${Z}`);continue}C.push({id:Z,exportValue:d,domElement:s})}return C}for(const A of document.getElementsByName(I)){const{exportValue:l}=A,Z=A.getAttribute("data-element-id");Z!==g&&OI.has(A)&&C.push({id:Z,exportValue:l,domElement:A})}return C}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const I=this.getElementsToTriggerPopup();if(Array.isArray(I))for(const g of I)g.classList.add("highlightArea");else I.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:I,data:{id:g}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:I,editId:g,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class hC extends E{constructor(I,g=null){super(I,{isRenderable:!0,ignoreBorder:!!g?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=I.data.isTooltipOnly}render(){const{data:I,linkService:g}=this,C=document.createElement("a");C.setAttribute("data-element-id",I.id);let A=!1;return I.url?(g.addLinkAttributes(C,I.url,I.newWindow),A=!0):I.action?(this._bindNamedAction(C,I.action,I.overlaidText),A=!0):I.attachment?(this.#g(C,I.attachment,I.overlaidText,I.attachmentDest),A=!0):I.setOCGState?(this.#C(C,I.setOCGState,I.overlaidText),A=!0):I.dest?(this._bindLink(C,I.dest,I.overlaidText),A=!0):(I.actions&&(I.actions.Action||I.actions["Mouse Up"]||I.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(C,I),A=!0),I.resetForm?(this._bindResetFormAction(C,I.resetForm),A=!0):this.isTooltipOnly&&!A&&(this._bindLink(C,""),A=!0)),this.container.classList.add("linkAnnotation"),A&&this.container.append(C),this.container}#I(){this.container.setAttribute("data-internal-link","")}_bindLink(I,g,C=""){I.href=this.linkService.getDestinationHash(g),I.onclick=()=>(g&&this.linkService.goToDestination(g),!1),(g||g==="")&&this.#I(),C&&(I.title=C)}_bindNamedAction(I,g,C=""){I.href=this.linkService.getAnchorUrl(""),I.onclick=()=>(this.linkService.executeNamedAction(g),!1),C&&(I.title=C),this.#I()}#g(I,g,C="",A=null){I.href=this.linkService.getAnchorUrl(""),g.description?I.title=g.description:C&&(I.title=C),I.onclick=()=>(this.downloadManager?.openOrDownloadData(g.content,g.filename,A),!1),this.#I()}#C(I,g,C=""){I.href=this.linkService.getAnchorUrl(""),I.onclick=()=>(this.linkService.executeSetOCGState(g),!1),C&&(I.title=C),this.#I()}_bindJSAction(I,g){I.href=this.linkService.getAnchorUrl("");const C=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const A of Object.keys(g.actions)){const l=C.get(A);l&&(I[l]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g.id,name:A}}),!1))}g.overlaidText&&(I.title=g.overlaidText),I.onclick||(I.onclick=()=>!1),this.#I()}_bindResetFormAction(I,g){const C=I.onclick;if(C||(I.href=this.linkService.getAnchorUrl("")),this.#I(),!this._fieldObjects){F('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),C||(I.onclick=()=>!1);return}I.onclick=()=>{C?.();const{fields:A,refs:l,include:Z}=g,i=[];if(A.length!==0||l.length!==0){const G=new Set(l);for(const b of A){const m=this._fieldObjects[b]||[];for(const{id:B}of m)G.add(B)}for(const b of Object.values(this._fieldObjects))for(const m of b)G.has(m.id)===Z&&i.push(m)}else for(const G of Object.values(this._fieldObjects))i.push(...G);const d=this.annotationStorage,s=[];for(const G of i){const{id:b}=G;switch(s.push(b),G.type){case"text":{const B=G.defaultValue||"";d.setValue(b,{value:B});break}case"checkbox":case"radiobutton":{const B=G.defaultValue===G.exportValues;d.setValue(b,{value:B});break}case"combobox":case"listbox":{const B=G.defaultValue||"";d.setValue(b,{value:B});break}default:continue}const m=document.querySelector(`[data-element-id="${b}"]`);if(m){if(!OI.has(m)){F(`_bindResetFormAction - element not allowed: ${b}`);continue}}else continue;m.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:s,name:"ResetForm"}}),!1}}}class iZ extends E{constructor(I){super(I,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const I=document.createElement("img");return I.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",I.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),I.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(I),this.container}}class UI extends E{render(){return this.container}showElementAndHideCanvas(I){this.data.hasOwnCanvas&&(I.previousSibling?.nodeName==="CANVAS"&&(I.previousSibling.hidden=!0),I.hidden=!1)}_getKeyModifier(I){return ZI.platform.isMac?I.metaKey:I.ctrlKey}_setEventListener(I,g,C,A,l){C.includes("mouse")?I.addEventListener(C,Z=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:A,value:l(Z),shift:Z.shiftKey,modifier:this._getKeyModifier(Z)}})}):I.addEventListener(C,Z=>{if(C==="blur"){if(!g.focused||!Z.relatedTarget)return;g.focused=!1}else if(C==="focus"){if(g.focused)return;g.focused=!0}l&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:A,value:l(Z)}})})}_setEventListeners(I,g,C,A){for(const[l,Z]of C)(Z==="Action"||this.data.actions?.[Z])&&((Z==="Focus"||Z==="Blur")&&(g||={focused:!1}),this._setEventListener(I,g,l,Z,A),Z==="Focus"&&!this.data.actions?.Blur?this._setEventListener(I,g,"blur","Blur",null):Z==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(I,g,"focus","Focus",null))}_setBackgroundColor(I){const g=this.data.backgroundColor||null;I.style.backgroundColor=g===null?"transparent":t.makeHexColor(g[0],g[1],g[2])}_setTextStyle(I){const g=["left","center","right"],{fontColor:C}=this.data.defaultAppearanceData,A=this.data.defaultAppearanceData.fontSize||lZ,l=I.style;let Z;const i=2,d=s=>Math.round(10*s)/10;if(this.data.multiLine){const s=Math.abs(this.data.rect[3]-this.data.rect[1]-i),G=Math.round(s/(Eg*A))||1,b=s/G;Z=Math.min(A,d(b/Eg))}else{const s=Math.abs(this.data.rect[3]-this.data.rect[1]-i);Z=Math.min(A,d(s/Eg))}l.fontSize=`calc(${Z}px * var(--total-scale-factor))`,l.color=t.makeHexColor(C[0],C[1],C[2]),this.data.textAlignment!==null&&(l.textAlign=g[this.data.textAlignment])}_setRequired(I,g){g?I.setAttribute("required",!0):I.removeAttribute("required"),I.setAttribute("aria-required",g)}}class dZ extends UI{constructor(I){const g=I.renderForms||I.data.hasOwnCanvas||!I.data.hasAppearance&&!!I.data.fieldValue;super(I,{isRenderable:g})}setPropertyOnSiblings(I,g,C,A){const l=this.annotationStorage;for(const Z of this._getElementsByName(I.name,I.id))Z.domElement&&(Z.domElement[g]=C),l.setValue(Z.id,{[A]:C})}render(){const I=this.annotationStorage,g=this.data.id;this.container.classList.add("textWidgetAnnotation");let C=null;if(this.renderForms){const A=I.getValue(g,{value:this.data.fieldValue});let l=A.value||"";const Z=I.getValue(g,{charLimit:this.data.maxLen}).charLimit;Z&&l.length>Z&&(l=l.slice(0,Z));let i=A.formattedValue||this.data.textContent?.join(`
`)||null;i&&this.data.comb&&(i=i.replaceAll(/\s+/g,""));const d={userValue:l,formattedValue:i,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(C=document.createElement("textarea"),C.textContent=i??l,this.data.doNotScroll&&(C.style.overflowY="hidden")):(C=document.createElement("input"),C.type=this.data.password?"password":"text",C.setAttribute("value",i??l),this.data.doNotScroll&&(C.style.overflowX="hidden")),this.data.hasOwnCanvas&&(C.hidden=!0),OI.add(C),C.setAttribute("data-element-id",g),C.disabled=this.data.readOnly,C.name=this.data.fieldName,C.tabIndex=0;const{datetimeFormat:s,datetimeType:G,timeStep:b}=this.data,m=!!G&&this.enableScripting;s&&(C.title=s),this._setRequired(C,this.data.required),Z&&(C.maxLength=Z),C.addEventListener("input",o=>{I.setValue(g,{value:o.target.value}),this.setPropertyOnSiblings(C,"value",o.target.value,"value"),d.formattedValue=null}),C.addEventListener("resetform",o=>{const W=this.data.defaultFieldValue??"";C.value=d.userValue=W,d.formattedValue=null});let B=o=>{const{formattedValue:W}=d;W!=null&&(o.target.value=W),o.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){C.addEventListener("focus",W=>{if(d.focused)return;const{target:Y}=W;if(m&&(Y.type=G,b&&(Y.step=b)),d.userValue){const w=d.userValue;if(m)if(G==="time"){const a=new Date(w),h=[a.getHours(),a.getMinutes(),a.getSeconds()];Y.value=h.map(N=>N.toString().padStart(2,"0")).join(":")}else Y.value=new Date(w-ZZ).toISOString().split(G==="date"?"T":".",1)[0];else Y.value=w}d.lastCommittedValue=Y.value,d.commitKey=1,this.data.actions?.Focus||(d.focused=!0)}),C.addEventListener("updatefromsandbox",W=>{this.showElementAndHideCanvas(W.target);const Y={value(w){d.userValue=w.detail.value??"",m||I.setValue(g,{value:d.userValue.toString()}),w.target.value=d.userValue},formattedValue(w){const{formattedValue:a}=w.detail;d.formattedValue=a,a!=null&&w.target!==document.activeElement&&(w.target.value=a);const h={formattedValue:a};m&&(h.value=a),I.setValue(g,h)},selRange(w){w.target.setSelectionRange(...w.detail.selRange)},charLimit:w=>{const{charLimit:a}=w.detail,{target:h}=w;if(a===0){h.removeAttribute("maxLength");return}h.setAttribute("maxLength",a);let N=d.userValue;!N||N.length<=a||(N=N.slice(0,a),h.value=d.userValue=N,I.setValue(g,{value:N}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g,name:"Keystroke",value:N,willCommit:!0,commitKey:1,selStart:h.selectionStart,selEnd:h.selectionEnd}}))}};this._dispatchEventFromSandbox(Y,W)}),C.addEventListener("keydown",W=>{d.commitKey=1;let Y=-1;if(W.key==="Escape"?Y=0:W.key==="Enter"&&!this.data.multiLine?Y=2:W.key==="Tab"&&(d.commitKey=3),Y===-1)return;const{value:w}=W.target;d.lastCommittedValue!==w&&(d.lastCommittedValue=w,d.userValue=w,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g,name:"Keystroke",value:w,willCommit:!0,commitKey:Y,selStart:W.target.selectionStart,selEnd:W.target.selectionEnd}}))});const o=B;B=null,C.addEventListener("blur",W=>{if(!d.focused||!W.relatedTarget)return;this.data.actions?.Blur||(d.focused=!1);const{target:Y}=W;let{value:w}=Y;if(m){if(w&&G==="time"){const a=w.split(":").map(h=>parseInt(h,10));w=new Date(2e3,0,1,a[0],a[1],a[2]||0).valueOf(),Y.step=""}else w=new Date(w).valueOf();Y.type="text"}d.userValue=w,d.lastCommittedValue!==w&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g,name:"Keystroke",value:w,willCommit:!0,commitKey:d.commitKey,selStart:W.target.selectionStart,selEnd:W.target.selectionEnd}}),o(W)}),this.data.actions?.Keystroke&&C.addEventListener("beforeinput",W=>{d.lastCommittedValue=null;const{data:Y,target:w}=W,{value:a,selectionStart:h,selectionEnd:N}=w;let V=h,R=N;switch(W.inputType){case"deleteWordBackward":{const X=a.substring(0,h).match(/\w*[^\w]*$/);X&&(V-=X[0].length);break}case"deleteWordForward":{const X=a.substring(h).match(/^[^\w]*\w*/);X&&(R+=X[0].length);break}case"deleteContentBackward":h===N&&(V-=1);break;case"deleteContentForward":h===N&&(R+=1);break}W.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g,name:"Keystroke",value:a,change:Y||"",willCommit:!1,selStart:V,selEnd:R}})}),this._setEventListeners(C,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],W=>W.target.value)}if(B&&C.addEventListener("blur",B),this.data.comb){const W=(this.data.rect[2]-this.data.rect[0])/Z;C.classList.add("comb"),C.style.letterSpacing=`calc(${W}px * var(--total-scale-factor) - 1ch)`}}else C=document.createElement("div"),C.textContent=this.data.fieldValue,C.style.verticalAlign="middle",C.style.display="table-cell",this.data.hasOwnCanvas&&(C.hidden=!0);return this._setTextStyle(C),this._setBackgroundColor(C),this._setDefaultPropertiesFromJS(C),this.container.append(C),this.container}}class sZ extends UI{constructor(I){super(I,{isRenderable:!!I.data.hasOwnCanvas})}}class GZ extends UI{constructor(I){super(I,{isRenderable:I.renderForms})}render(){const I=this.annotationStorage,g=this.data,C=g.id;let A=I.getValue(C,{value:g.exportValue===g.fieldValue}).value;typeof A=="string"&&(A=A!=="Off",I.setValue(C,{value:A})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const l=document.createElement("input");return OI.add(l),l.setAttribute("data-element-id",C),l.disabled=g.readOnly,this._setRequired(l,this.data.required),l.type="checkbox",l.name=g.fieldName,A&&l.setAttribute("checked",!0),l.setAttribute("exportValue",g.exportValue),l.tabIndex=0,l.addEventListener("change",Z=>{const{name:i,checked:d}=Z.target;for(const s of this._getElementsByName(i,C)){const G=d&&s.exportValue===g.exportValue;s.domElement&&(s.domElement.checked=G),I.setValue(s.id,{value:G})}I.setValue(C,{value:d})}),l.addEventListener("resetform",Z=>{const i=g.defaultFieldValue||"Off";Z.target.checked=i===g.exportValue}),this.enableScripting&&this.hasJSActions&&(l.addEventListener("updatefromsandbox",Z=>{const i={value(d){d.target.checked=d.detail.value!=="Off",I.setValue(C,{value:d.target.checked})}};this._dispatchEventFromSandbox(i,Z)}),this._setEventListeners(l,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Z=>Z.target.checked)),this._setBackgroundColor(l),this._setDefaultPropertiesFromJS(l),this.container.append(l),this.container}}class RA extends UI{constructor(I){super(I,{isRenderable:I.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const I=this.annotationStorage,g=this.data,C=g.id;let A=I.getValue(C,{value:g.fieldValue===g.buttonValue}).value;if(typeof A=="string"&&(A=A!==g.buttonValue,I.setValue(C,{value:A})),A)for(const Z of this._getElementsByName(g.fieldName,C))I.setValue(Z.id,{value:!1});const l=document.createElement("input");if(OI.add(l),l.setAttribute("data-element-id",C),l.disabled=g.readOnly,this._setRequired(l,this.data.required),l.type="radio",l.name=g.fieldName,A&&l.setAttribute("checked",!0),l.tabIndex=0,l.addEventListener("change",Z=>{const{name:i,checked:d}=Z.target;for(const s of this._getElementsByName(i,C))I.setValue(s.id,{value:!1});I.setValue(C,{value:d})}),l.addEventListener("resetform",Z=>{const i=g.defaultFieldValue;Z.target.checked=i!=null&&i===g.buttonValue}),this.enableScripting&&this.hasJSActions){const Z=g.buttonValue;l.addEventListener("updatefromsandbox",i=>{const d={value:s=>{const G=Z===s.detail.value;for(const b of this._getElementsByName(s.target.name)){const m=G&&b.id===C;b.domElement&&(b.domElement.checked=m),I.setValue(b.id,{value:m})}}};this._dispatchEventFromSandbox(d,i)}),this._setEventListeners(l,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],i=>i.target.checked)}return this._setBackgroundColor(l),this._setDefaultPropertiesFromJS(l),this.container.append(l),this.container}}class cZ extends hC{constructor(I){super(I,{ignoreBorder:I.data.hasAppearance})}render(){const I=super.render();I.classList.add("buttonWidgetAnnotation","pushButton");const g=I.lastChild;return this.enableScripting&&this.hasJSActions&&g&&(this._setDefaultPropertiesFromJS(g),g.addEventListener("updatefromsandbox",C=>{this._dispatchEventFromSandbox({},C)})),I}}class bZ extends UI{constructor(I){super(I,{isRenderable:I.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const I=this.annotationStorage,g=this.data.id,C=I.getValue(g,{value:this.data.fieldValue}),A=document.createElement("select");OI.add(A),A.setAttribute("data-element-id",g),A.disabled=this.data.readOnly,this._setRequired(A,this.data.required),A.name=this.data.fieldName,A.tabIndex=0;let l=this.data.combo&&this.data.options.length>0;this.data.combo||(A.size=this.data.options.length,this.data.multiSelect&&(A.multiple=!0)),A.addEventListener("resetform",G=>{const b=this.data.defaultFieldValue;for(const m of A.options)m.selected=m.value===b});for(const G of this.data.options){const b=document.createElement("option");b.textContent=G.displayValue,b.value=G.exportValue,C.value.includes(G.exportValue)&&(b.setAttribute("selected",!0),l=!1),A.append(b)}let Z=null;if(l){const G=document.createElement("option");G.value=" ",G.setAttribute("hidden",!0),G.setAttribute("selected",!0),A.prepend(G),Z=()=>{G.remove(),A.removeEventListener("input",Z),Z=null},A.addEventListener("input",Z)}const i=G=>{const b=G?"value":"textContent",{options:m,multiple:B}=A;return B?Array.prototype.filter.call(m,o=>o.selected).map(o=>o[b]):m.selectedIndex===-1?null:m[m.selectedIndex][b]};let d=i(!1);const s=G=>{const b=G.target.options;return Array.prototype.map.call(b,m=>({displayValue:m.textContent,exportValue:m.value}))};return this.enableScripting&&this.hasJSActions?(A.addEventListener("updatefromsandbox",G=>{const b={value(m){Z?.();const B=m.detail.value,o=new Set(Array.isArray(B)?B:[B]);for(const W of A.options)W.selected=o.has(W.value);I.setValue(g,{value:i(!0)}),d=i(!1)},multipleSelection(m){A.multiple=!0},remove(m){const B=A.options,o=m.detail.remove;B[o].selected=!1,A.remove(o),B.length>0&&Array.prototype.findIndex.call(B,Y=>Y.selected)===-1&&(B[0].selected=!0),I.setValue(g,{value:i(!0),items:s(m)}),d=i(!1)},clear(m){for(;A.length!==0;)A.remove(0);I.setValue(g,{value:null,items:[]}),d=i(!1)},insert(m){const{index:B,displayValue:o,exportValue:W}=m.detail.insert,Y=A.children[B],w=document.createElement("option");w.textContent=o,w.value=W,Y?Y.before(w):A.append(w),I.setValue(g,{value:i(!0),items:s(m)}),d=i(!1)},items(m){const{items:B}=m.detail;for(;A.length!==0;)A.remove(0);for(const o of B){const{displayValue:W,exportValue:Y}=o,w=document.createElement("option");w.textContent=W,w.value=Y,A.append(w)}A.options.length>0&&(A.options[0].selected=!0),I.setValue(g,{value:i(!0),items:s(m)}),d=i(!1)},indices(m){const B=new Set(m.detail.indices);for(const o of m.target.options)o.selected=B.has(o.index);I.setValue(g,{value:i(!0)}),d=i(!1)},editable(m){m.target.disabled=!m.detail.editable}};this._dispatchEventFromSandbox(b,G)}),A.addEventListener("input",G=>{const b=i(!0),m=i(!1);I.setValue(g,{value:b}),G.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:g,name:"Keystroke",value:d,change:m,changeEx:b,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(A,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],G=>G.target.value)):A.addEventListener("input",function(G){I.setValue(g,{value:i(!0)})}),this.data.combo&&this._setTextStyle(A),this._setBackgroundColor(A),this._setDefaultPropertiesFromJS(A),this.container.append(A),this.container}}class aC extends E{constructor(I){const{data:g,elements:C}=I;super(I,{isRenderable:E._hasPopupData(g)}),this.elements=C,this.popup=null}render(){const{container:I}=this;I.classList.add("popupAnnotation"),I.role="comment";const g=this.popup=new mZ({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),C=[];for(const A of this.elements)A.popup=g,A.container.ariaHasPopup="dialog",C.push(A.data.id),A.addHighlightArea();return this.container.setAttribute("aria-controls",C.map(A=>`${$g}${A}`).join(",")),this.container}}class mZ{#I=this.#e.bind(this);#g=this.#K.bind(this);#C=this.#H.bind(this);#A=this.#M.bind(this);#Z=null;#l=null;#i=null;#d=null;#c=null;#G=null;#m=null;#s=!1;#W=null;#w=null;#B=null;#b=null;#o=null;#a=null;#Y=null;#N=!1;constructor({container:I,color:g,elements:C,titleObj:A,modificationDate:l,contentsObj:Z,richText:i,parent:d,rect:s,parentRect:G,open:b}){this.#l=I,this.#a=A,this.#i=Z,this.#o=i,this.#G=d,this.#Z=g,this.#b=s,this.#m=G,this.#c=C,this.#d=CC.toDateObject(l),this.trigger=C.flatMap(m=>m.getElementsToTriggerPopup()),this.#R(),this.#l.hidden=!0,b&&this.#M()}#R(){if(this.#w)return;this.#w=new AbortController;const{signal:I}=this.#w;for(const g of this.trigger)g.addEventListener("click",this.#A,{signal:I}),g.addEventListener("mouseenter",this.#C,{signal:I}),g.addEventListener("mouseleave",this.#g,{signal:I}),g.classList.add("popupTriggerArea");for(const g of this.#c)g.container?.addEventListener("keydown",this.#I,{signal:I})}render(){if(this.#W)return;const I=this.#W=document.createElement("div");if(I.className="popup",this.#Z){const A=I.style.outlineColor=t.makeHexColor(...this.#Z);I.style.backgroundColor=`color-mix(in srgb, ${A} 30%, white)`}const g=document.createElement("span");if(g.className="header",this.#a?.str){const A=document.createElement("span");A.className="title",g.append(A),{dir:A.dir,str:A.textContent}=this.#a}if(I.append(g),this.#d){const A=document.createElement("time");A.className="popupDate",A.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),A.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#d.valueOf()})),A.dateTime=this.#d.toISOString(),g.append(A)}const C=this.#h;if(C)VA.render({xfaHtml:C,intent:"richText",div:I}),I.lastChild.classList.add("richText","popupContent");else{const A=this._formatContents(this.#i);I.append(A)}this.#l.append(I)}get#h(){const I=this.#o,g=this.#i;return I?.str&&(!g?.str||g.str===I.str)&&this.#o.html||null}get#n(){return this.#h?.attributes?.style?.fontSize||0}get#t(){return this.#h?.attributes?.style?.color||null}#X(I){const g=[],C={str:I,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:g}]}},A={style:{color:this.#t,fontSize:this.#n?`calc(${this.#n}px * var(--total-scale-factor))`:""}};for(const l of I.split(`
`))g.push({name:"span",value:l,attributes:A});return C}_formatContents({str:I,dir:g}){const C=document.createElement("p");C.classList.add("popupContent"),C.dir=g;const A=I.split(/(?:\r\n?|\n)/);for(let l=0,Z=A.length;l<Z;++l){const i=A[l];C.append(document.createTextNode(i)),l<Z-1&&C.append(document.createElement("br"))}return C}#e(I){I.altKey||I.shiftKey||I.ctrlKey||I.metaKey||(I.key==="Enter"||I.key==="Escape"&&this.#s)&&this.#M()}updateEdited({rect:I,popup:g,deleted:C}){if(C||g?.deleted){this.remove();return}this.#R(),this.#Y||={contentsObj:this.#i,richText:this.#o},I&&(this.#B=null),g&&(this.#o=this.#X(g.text),this.#d=CC.toDateObject(g.date),this.#i=null),this.#W?.remove(),this.#W=null}resetEdited(){this.#Y&&({contentsObj:this.#i,richText:this.#o}=this.#Y,this.#Y=null,this.#W?.remove(),this.#W=null,this.#B=null)}remove(){this.#w?.abort(),this.#w=null,this.#W?.remove(),this.#W=null,this.#N=!1,this.#s=!1;for(const I of this.trigger)I.classList.remove("popupTriggerArea")}#u(){if(this.#B!==null)return;const{page:{view:I},viewport:{rawDims:{pageWidth:g,pageHeight:C,pageX:A,pageY:l}}}=this.#G;let Z=!!this.#m,i=Z?this.#m:this.#b;for(const o of this.#c)if(!i||t.intersect(o.data.rect,i)!==null){i=o.data.rect,Z=!0;break}const d=t.normalizeRect([i[0],I[3]-i[1]+I[1],i[2],I[3]-i[3]+I[1]]),G=Z?i[2]-i[0]+5:0,b=d[0]+G,m=d[1];this.#B=[100*(b-A)/g,100*(m-l)/C];const{style:B}=this.#l;B.left=`${this.#B[0]}%`,B.top=`${this.#B[1]}%`}#M(){this.#s=!this.#s,this.#s?(this.#H(),this.#l.addEventListener("click",this.#A),this.#l.addEventListener("keydown",this.#I)):(this.#K(),this.#l.removeEventListener("click",this.#A),this.#l.removeEventListener("keydown",this.#I))}#H(){this.#W||this.render(),this.isVisible?this.#s&&this.#l.classList.add("focused"):(this.#u(),this.#l.hidden=!1,this.#l.style.zIndex=parseInt(this.#l.style.zIndex)+1e3)}#K(){this.#l.classList.remove("focused"),!(this.#s||!this.isVisible)&&(this.#l.hidden=!0,this.#l.style.zIndex=parseInt(this.#l.style.zIndex)-1e3)}forceHide(){this.#N=this.isVisible,this.#N&&(this.#l.hidden=!0)}maybeShow(){this.#R(),this.#N&&(this.#W||this.#H(),this.#N=!1,this.#l.hidden=!1)}get isVisible(){return this.#l.hidden===!1}}class XA extends E{constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0}),this.textContent=I.data.textContent,this.textPosition=I.data.textPosition,this.annotationEditorType=p.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const I=document.createElement("div");I.classList.add("annotationTextContent"),I.setAttribute("role","comment");for(const g of this.textContent){const C=document.createElement("span");C.textContent=g,I.append(C)}this.container.append(I)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class BZ extends E{#I=null;constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:I,width:g,height:C}=this,A=this.svgFactory.create(g,C,!0),l=this.#I=this.svgFactory.createElement("svg:line");return l.setAttribute("x1",I.rect[2]-I.lineCoordinates[0]),l.setAttribute("y1",I.rect[3]-I.lineCoordinates[1]),l.setAttribute("x2",I.rect[2]-I.lineCoordinates[2]),l.setAttribute("y2",I.rect[3]-I.lineCoordinates[3]),l.setAttribute("stroke-width",I.borderStyle.width||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),A.append(l),this.container.append(A),!I.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}}class WZ extends E{#I=null;constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:I,width:g,height:C}=this,A=this.svgFactory.create(g,C,!0),l=I.borderStyle.width,Z=this.#I=this.svgFactory.createElement("svg:rect");return Z.setAttribute("x",l/2),Z.setAttribute("y",l/2),Z.setAttribute("width",g-l),Z.setAttribute("height",C-l),Z.setAttribute("stroke-width",l||1),Z.setAttribute("stroke","transparent"),Z.setAttribute("fill","transparent"),A.append(Z),this.container.append(A),!I.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}}class oZ extends E{#I=null;constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:I,width:g,height:C}=this,A=this.svgFactory.create(g,C,!0),l=I.borderStyle.width,Z=this.#I=this.svgFactory.createElement("svg:ellipse");return Z.setAttribute("cx",g/2),Z.setAttribute("cy",C/2),Z.setAttribute("rx",g/2-l/2),Z.setAttribute("ry",C/2-l/2),Z.setAttribute("stroke-width",l||1),Z.setAttribute("stroke","transparent"),Z.setAttribute("fill","transparent"),A.append(Z),this.container.append(A),!I.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}}class nA extends E{#I=null;constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:I,vertices:g,borderStyle:C,popupRef:A},width:l,height:Z}=this;if(!g)return this.container;const i=this.svgFactory.create(l,Z,!0);let d=[];for(let G=0,b=g.length;G<b;G+=2){const m=g[G]-I[0],B=I[3]-g[G+1];d.push(`${m},${B}`)}d=d.join(" ");const s=this.#I=this.svgFactory.createElement(this.svgElementName);return s.setAttribute("points",d),s.setAttribute("stroke-width",C.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),i.append(s),this.container.append(i),!A&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}}class wZ extends nA{constructor(I){super(I),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class YZ extends E{constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class VC extends E{#I=null;#g=[];constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?p.HIGHLIGHT:p.INK}#C(I,g){switch(I){case 90:return{transform:`rotate(90) translate(${-g[0]},${g[1]}) scale(1,-1)`,width:g[3]-g[1],height:g[2]-g[0]};case 180:return{transform:`rotate(180) translate(${-g[2]},${g[1]}) scale(1,-1)`,width:g[2]-g[0],height:g[3]-g[1]};case 270:return{transform:`rotate(270) translate(${-g[2]},${g[3]}) scale(1,-1)`,width:g[3]-g[1],height:g[2]-g[0]};default:return{transform:`translate(${-g[0]},${g[3]}) scale(1,-1)`,width:g[2]-g[0],height:g[3]-g[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:I,rotation:g,inkLists:C,borderStyle:A,popupRef:l}}=this,{transform:Z,width:i,height:d}=this.#C(g,I),s=this.svgFactory.create(i,d,!0),G=this.#I=this.svgFactory.createElement("svg:g");s.append(G),G.setAttribute("stroke-width",A.width||1),G.setAttribute("stroke-linecap","round"),G.setAttribute("stroke-linejoin","round"),G.setAttribute("stroke-miterlimit",10),G.setAttribute("stroke","transparent"),G.setAttribute("fill","transparent"),G.setAttribute("transform",Z);for(let b=0,m=C.length;b<m;b++){const B=this.svgFactory.createElement(this.svgElementName);this.#g.push(B),B.setAttribute("points",C[b].join(",")),G.append(B)}return!l&&this.hasPopupData&&this._createPopup(),this.container.append(s),this._editOnDoubleClick(),this.container}updateEdited(I){super.updateEdited(I);const{thickness:g,points:C,rect:A}=I,l=this.#I;if(g>=0&&l.setAttribute("stroke-width",g||1),C)for(let Z=0,i=this.#g.length;Z<i;Z++)this.#g[Z].setAttribute("points",C[Z].join(","));if(A){const{transform:Z,width:i,height:d}=this.#C(this.data.rotation,A);l.parentElement.setAttribute("viewBox",`0 0 ${i} ${d}`),l.setAttribute("transform",Z)}}getElementsToTriggerPopup(){return this.#g}addHighlightArea(){this.container.classList.add("highlightArea")}}class yA extends E{constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=p.HIGHLIGHT}render(){const{data:{overlaidText:I,popupRef:g}}=this;if(!g&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),I){const C=document.createElement("mark");C.classList.add("overlaidText"),C.textContent=I,this.container.append(C)}return this.container}}class hZ extends E{constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:I,popupRef:g}}=this;if(!g&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),I){const C=document.createElement("u");C.classList.add("overlaidText"),C.textContent=I,this.container.append(C)}return this.container}}class aZ extends E{constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:I,popupRef:g}}=this;if(!g&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),I){const C=document.createElement("u");C.classList.add("overlaidText"),C.textContent=I,this.container.append(C)}return this.container}}class VZ extends E{constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:I,popupRef:g}}=this;if(!g&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),I){const C=document.createElement("s");C.classList.add("overlaidText"),C.textContent=I,this.container.append(C)}return this.container}}class HA extends E{constructor(I){super(I,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=p.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class NZ extends E{#I=null;constructor(I){super(I,{isRenderable:!0});const{file:g}=this.data;this.filename=g.filename,this.content=g.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...g})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:I,data:g}=this;let C;g.hasAppearance||g.fillAlpha===0?C=document.createElement("div"):(C=document.createElement("img"),C.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(g.name)?"paperclip":"pushpin"}.svg`,g.fillAlpha&&g.fillAlpha<1&&(C.style=`filter: opacity(${Math.round(g.fillAlpha*100)}%);`)),C.addEventListener("dblclick",this.#g.bind(this)),this.#I=C;const{isMac:A}=ZI.platform;return I.addEventListener("keydown",l=>{l.key==="Enter"&&(A?l.metaKey:l.ctrlKey)&&this.#g()}),!g.popupRef&&this.hasPopupData?this._createPopup():C.classList.add("popupTriggerArea"),I.append(C),I}getElementsToTriggerPopup(){return this.#I}addHighlightArea(){this.container.classList.add("highlightArea")}#g(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class NC{#I=null;#g=null;#C=new Map;#A=null;constructor({div:I,accessibilityManager:g,annotationCanvasMap:C,annotationEditorUIManager:A,page:l,viewport:Z,structTreeLayer:i}){this.div=I,this.#I=g,this.#g=C,this.#A=i||null,this.page=l,this.viewport=Z,this.zIndex=0,this._annotationEditorUIManager=A}hasEditableAnnotations(){return this.#C.size>0}async#Z(I,g,C){const A=I.firstChild||I,l=A.id=`${$g}${g}`,Z=await this.#A?.getAriaAttributes(l);if(Z)for(const[i,d]of Z)A.setAttribute(i,d);C?C.at(-1).container.after(I):(this.div.append(I),this.#I?.moveElementInDOM(this.div,I,A,!1))}async render(I){const{annotations:g}=I,C=this.div;jI(C,this.viewport);const A=new Map,l={data:null,layer:C,linkService:I.linkService,downloadManager:I.downloadManager,imageResourcesPath:I.imageResourcesPath||"",renderForms:I.renderForms!==!1,svgFactory:new Qg,annotationStorage:I.annotationStorage||new dC,enableScripting:I.enableScripting===!0,hasJSActions:I.hasJSActions,fieldObjects:I.fieldObjects,parent:this,elements:null};for(const Z of g){if(Z.noHTML)continue;const i=Z.annotationType===q.POPUP;if(i){const G=A.get(Z.id);if(!G)continue;l.elements=G}else if(Z.rect[2]===Z.rect[0]||Z.rect[3]===Z.rect[1])continue;l.data=Z;const d=NA.create(l);if(!d.isRenderable)continue;if(!i&&Z.popupRef){const G=A.get(Z.popupRef);G?G.push(d):A.set(Z.popupRef,[d])}const s=d.render();Z.hidden&&(s.style.visibility="hidden"),await this.#Z(s,Z.id,l.elements),d._isEditable&&(this.#C.set(d.data.id,d),this._annotationEditorUIManager?.renderAnnotationElement(d))}this.#l()}async addLinkAnnotations(I,g){const C={data:null,layer:this.div,linkService:g,svgFactory:new Qg,parent:this};for(const A of I){A.borderStyle||=NC._defaultBorderStyle,C.data=A;const l=NA.create(C);if(!l.isRenderable)continue;const Z=l.render();await this.#Z(Z,A.id,null)}}update({viewport:I}){const g=this.div;this.viewport=I,jI(g,{rotation:I.rotation}),this.#l(),g.hidden=!1}#l(){if(!this.#g)return;const I=this.div;for(const[g,C]of this.#g){const A=I.querySelector(`[data-annotation-id="${g}"]`);if(!A)continue;C.className="annotationContent";const{firstChild:l}=A;l?l.nodeName==="CANVAS"?l.replaceWith(C):l.classList.contains("annotationContent")?l.after(C):l.before(C):A.append(C);const Z=this.#C.get(g);Z&&(Z._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(g,A.id,C),Z._hasNoCanvas=!1):Z.canvas=C)}this.#g.clear()}getEditableAnnotations(){return Array.from(this.#C.values())}getEditableAnnotation(I){return this.#C.get(I)}static get _defaultBorderStyle(){return J(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:fI.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const jg=/\r\n?|\n/g;class CI extends D{#I;#g="";#C=`${this.id}-editor`;#A=null;#Z;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const I=CI.prototype,g=l=>l.isEmpty(),C=JI.TRANSLATE_SMALL,A=JI.TRANSLATE_BIG;return J(this,"_keyboardManager",new mg([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],I.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],I.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],I._translateEmpty,{args:[-C,0],checker:g}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],I._translateEmpty,{args:[-A,0],checker:g}],[["ArrowRight","mac+ArrowRight"],I._translateEmpty,{args:[C,0],checker:g}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],I._translateEmpty,{args:[A,0],checker:g}],[["ArrowUp","mac+ArrowUp"],I._translateEmpty,{args:[0,-C],checker:g}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],I._translateEmpty,{args:[0,-A],checker:g}],[["ArrowDown","mac+ArrowDown"],I._translateEmpty,{args:[0,C],checker:g}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],I._translateEmpty,{args:[0,A],checker:g}]]))}static _type="freetext";static _editorType=p.FREETEXT;constructor(I){super({...I,name:"freeTextEditor"}),this.#I=I.color||CI._defaultColor||D._defaultLineColor,this.#Z=I.fontSize||CI._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(I,g){D.initialize(I,g);const C=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(C.getPropertyValue("--freetext-padding"))}static updateDefaultParams(I,g){switch(I){case k.FREETEXT_SIZE:CI._defaultFontSize=g;break;case k.FREETEXT_COLOR:CI._defaultColor=g;break}}updateParams(I,g){switch(I){case k.FREETEXT_SIZE:this.#l(g);break;case k.FREETEXT_COLOR:this.#i(g);break}}static get defaultPropertiesToUpdate(){return[[k.FREETEXT_SIZE,CI._defaultFontSize],[k.FREETEXT_COLOR,CI._defaultColor||D._defaultLineColor]]}get propertiesToUpdate(){return[[k.FREETEXT_SIZE,this.#Z],[k.FREETEXT_COLOR,this.#I]]}get toolbarButtons(){return this._colorPicker||=new ag(this),[["colorPicker",this._colorPicker]]}get colorType(){return k.FREETEXT_COLOR}get colorValue(){return this.#I}#l(I){const g=A=>{this.editorDiv.style.fontSize=`calc(${A}px * var(--total-scale-factor))`,this.translate(0,-(A-this.#Z)*this.parentScale),this.#Z=A,this.#c()},C=this.#Z;this.addCommands({cmd:g.bind(this,I),undo:g.bind(this,C),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:k.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#i(I){const g=A=>{this.#I=this.editorDiv.style.color=A,this._colorPicker?.update(A)},C=this.#I;this.addCommands({cmd:g.bind(this,I),undo:g.bind(this,C),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:k.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(I,g){this._uiManager.translateSelectedEditors(I,g,!0)}getInitialTranslation(){const I=this.parentScale;return[-CI._internalPadding*I,-(CI._internalPadding+this.#Z)*I]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#A=new AbortController;const I=this._uiManager.combinedSignal(this.#A);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:I}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:I}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:I}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:I}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:I}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#C),this._isDraggable=!0,this.#A?.abort(),this.#A=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(I){this._focusEventsAllowed&&(super.focusin(I),I.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(I){this.width||(this.enableEditMode(),I&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#d(){const I=[];this.editorDiv.normalize();let g=null;for(const C of this.editorDiv.childNodes)g?.nodeType===Node.TEXT_NODE&&C.nodeName==="BR"||(I.push(CI.#G(C)),g=C);return I.join(`
`)}#c(){const[I,g]=this.parentDimensions;let C;if(this.isAttachedToDOM)C=this.div.getBoundingClientRect();else{const{currentLayer:A,div:l}=this,Z=l.style.display,i=l.classList.contains("hidden");l.classList.remove("hidden"),l.style.display="hidden",A.div.append(this.div),C=l.getBoundingClientRect(),l.remove(),l.style.display=Z,l.classList.toggle("hidden",i)}this.rotation%180===this.parentRotation%180?(this.width=C.width/I,this.height=C.height/g):(this.width=C.height/I,this.height=C.width/g),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const I=this.#g,g=this.#g=this.#d().trimEnd();if(I===g)return;const C=A=>{if(this.#g=A,!A){this.remove();return}this.#m(),this._uiManager.rebuild(this),this.#c()};this.addCommands({cmd:()=>{C(g)},undo:()=>{C(I)},mustExec:!1}),this.#c()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(I){I.target===this.div&&I.key==="Enter"&&(this.enterInEditMode(),I.preventDefault())}editorDivKeydown(I){CI._keyboardManager.exec(this,I)}editorDivFocus(I){this.isEditing=!0}editorDivBlur(I){this.isEditing=!1}editorDivInput(I){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let I,g;(this._isCopy||this.annotationElementId)&&(I=this.x,g=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#C),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:C}=this.editorDiv;if(C.fontSize=`calc(${this.#Z}px * var(--total-scale-factor))`,C.color=this.#I,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[A,l]=this.parentDimensions;if(this.annotationElementId){const{position:Z}=this._initialData;let[i,d]=this.getInitialTranslation();[i,d]=this.pageTranslationToScreen(i,d);const[s,G]=this.pageDimensions,[b,m]=this.pageTranslation;let B,o;switch(this.rotation){case 0:B=I+(Z[0]-b)/s,o=g+this.height-(Z[1]-m)/G;break;case 90:B=I+(Z[0]-b)/s,o=g-(Z[1]-m)/G,[i,d]=[d,-i];break;case 180:B=I-this.width+(Z[0]-b)/s,o=g-(Z[1]-m)/G,[i,d]=[-i,-d];break;case 270:B=I+(Z[0]-b-this.height*G)/s,o=g+(Z[1]-m-this.width*s)/G,[i,d]=[-d,i];break}this.setAt(B*A,o*l,i,d)}else this._moveAfterPaste(I,g);this.#m(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#G(I){return(I.nodeType===Node.TEXT_NODE?I.nodeValue:I.innerText).replaceAll(jg,"")}editorDivPaste(I){const g=I.clipboardData||window.clipboardData,{types:C}=g;if(C.length===1&&C[0]==="text/plain")return;I.preventDefault();const A=CI.#W(g.getData("text")||"").replaceAll(jg,`
`);if(!A)return;const l=window.getSelection();if(!l.rangeCount)return;this.editorDiv.normalize(),l.deleteFromDocument();const Z=l.getRangeAt(0);if(!A.includes(`
`)){Z.insertNode(document.createTextNode(A)),this.editorDiv.normalize(),l.collapseToStart();return}const{startContainer:i,startOffset:d}=Z,s=[],G=[];if(i.nodeType===Node.TEXT_NODE){const B=i.parentElement;if(G.push(i.nodeValue.slice(d).replaceAll(jg,"")),B!==this.editorDiv){let o=s;for(const W of this.editorDiv.childNodes){if(W===B){o=G;continue}o.push(CI.#G(W))}}s.push(i.nodeValue.slice(0,d).replaceAll(jg,""))}else if(i===this.editorDiv){let B=s,o=0;for(const W of this.editorDiv.childNodes)o++===d&&(B=G),B.push(CI.#G(W))}this.#g=`${s.join(`
`)}${A}${G.join(`
`)}`,this.#m();const b=new Range;let m=Math.sumPrecise(s.map(B=>B.length));for(const{firstChild:B}of this.editorDiv.childNodes)if(B.nodeType===Node.TEXT_NODE){const o=B.nodeValue.length;if(m<=o){b.setStart(B,m),b.setEnd(B,m);break}m-=o}l.removeAllRanges(),l.addRange(b)}#m(){if(this.editorDiv.replaceChildren(),!!this.#g)for(const I of this.#g.split(`
`)){const g=document.createElement("div");g.append(I?document.createTextNode(I):document.createElement("br")),this.editorDiv.append(g)}}#s(){return this.#g.replaceAll(" "," ")}static#W(I){return I.replaceAll(" "," ")}get contentDiv(){return this.editorDiv}static async deserialize(I,g,C){let A=null;if(I instanceof XA){const{data:{defaultAppearanceData:{fontSize:Z,fontColor:i},rect:d,rotation:s,id:G,popupRef:b,contentsObj:m},textContent:B,textPosition:o,parent:{page:{pageNumber:W}}}=I;if(!B||B.length===0)return null;A=I={annotationType:p.FREETEXT,color:Array.from(i),fontSize:Z,value:B.join(`
`),position:o,pageIndex:W-1,rect:d.slice(0),rotation:s,annotationElementId:G,id:G,deleted:!1,popupRef:b,comment:m?.str||null}}const l=await super.deserialize(I,g,C);return l.#Z=I.fontSize,l.#I=t.makeHexColor(...I.color),l.#g=CI.#W(I.value),l._initialData=A,I.comment&&l.setCommentData(I.comment),l}serialize(I=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const g=CI._internalPadding*this.parentScale,C=this.getRect(g,g),A=D._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#I),l={annotationType:p.FREETEXT,color:A,fontSize:this.#Z,value:this.#s(),pageIndex:this.pageIndex,rect:C,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(l),I?(l.isCopy=!0,l):this.annotationElementId&&!this.#w(l)?null:(l.id=this.annotationElementId,l)}#w(I){const{value:g,fontSize:C,color:A,pageIndex:l}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||I.value!==g||I.fontSize!==C||I.color.some((Z,i)=>Z!==A[i])||I.pageIndex!==l}renderAnnotationElement(I){const g=super.renderAnnotationElement(I),{style:C}=g;C.fontSize=`calc(${this.#Z}px * var(--total-scale-factor))`,C.color=this.#I,g.replaceChildren();for(const Z of this.#g.split(`
`)){const i=document.createElement("div");i.append(Z?document.createTextNode(Z):document.createElement("br")),g.append(i)}const A=CI._internalPadding*this.parentScale,l={rect:this.getRect(A,A)};return l.popup=this.hasEditedComment?this.comment:{text:this.#g},I.updateEdited(l),g}resetAnnotationElement(I){super.resetAnnotationElement(I),I.resetEdited()}}class H{static PRECISION=1e-4;toSVGPath(){j("Abstract method `toSVGPath` must be implemented.")}get box(){j("Abstract getter `box` must be implemented.")}serialize(I,g){j("Abstract method `serialize` must be implemented.")}static _rescale(I,g,C,A,l,Z){Z||=new Float32Array(I.length);for(let i=0,d=I.length;i<d;i+=2)Z[i]=g+I[i]*A,Z[i+1]=C+I[i+1]*l;return Z}static _rescaleAndSwap(I,g,C,A,l,Z){Z||=new Float32Array(I.length);for(let i=0,d=I.length;i<d;i+=2)Z[i]=g+I[i+1]*A,Z[i+1]=C+I[i]*l;return Z}static _translate(I,g,C,A){A||=new Float32Array(I.length);for(let l=0,Z=I.length;l<Z;l+=2)A[l]=g+I[l],A[l+1]=C+I[l+1];return A}static svgRound(I){return Math.round(I*1e4)}static _normalizePoint(I,g,C,A,l){switch(l){case 90:return[1-g/C,I/A];case 180:return[1-I/C,1-g/A];case 270:return[g/C,1-I/A];default:return[I/C,g/A]}}static _normalizePagePoint(I,g,C){switch(C){case 90:return[1-g,I];case 180:return[1-I,1-g];case 270:return[g,1-I];default:return[I,g]}}static createBezierPoints(I,g,C,A,l,Z){return[(I+5*C)/6,(g+5*A)/6,(5*C+l)/6,(5*A+Z)/6,(C+l)/2,(A+Z)/2]}}class xI{#I;#g=[];#C;#A;#Z=[];#l=new Float32Array(18);#i;#d;#c;#G;#m;#s;#W=[];static#w=8;static#B=2;static#b=xI.#w+xI.#B;constructor({x:I,y:g},C,A,l,Z,i=0){this.#I=C,this.#s=l*A,this.#A=Z,this.#l.set([NaN,NaN,NaN,NaN,I,g],6),this.#C=i,this.#G=xI.#w*A,this.#c=xI.#b*A,this.#m=A,this.#W.push(I,g)}isEmpty(){return isNaN(this.#l[8])}#o(){const I=this.#l.subarray(4,6),g=this.#l.subarray(16,18),[C,A,l,Z]=this.#I;return[(this.#i+(I[0]-g[0])/2-C)/l,(this.#d+(I[1]-g[1])/2-A)/Z,(this.#i+(g[0]-I[0])/2-C)/l,(this.#d+(g[1]-I[1])/2-A)/Z]}add({x:I,y:g}){this.#i=I,this.#d=g;const[C,A,l,Z]=this.#I;let[i,d,s,G]=this.#l.subarray(8,12);const b=I-s,m=g-G,B=Math.hypot(b,m);if(B<this.#c)return!1;const o=B-this.#G,W=o/B,Y=W*b,w=W*m;let a=i,h=d;i=s,d=G,s+=Y,G+=w,this.#W?.push(I,g);const N=-w/o,V=Y/o,R=N*this.#s,X=V*this.#s;return this.#l.set(this.#l.subarray(2,8),0),this.#l.set([s+R,G+X],4),this.#l.set(this.#l.subarray(14,18),12),this.#l.set([s-R,G-X],16),isNaN(this.#l[6])?(this.#Z.length===0&&(this.#l.set([i+R,d+X],2),this.#Z.push(NaN,NaN,NaN,NaN,(i+R-C)/l,(d+X-A)/Z),this.#l.set([i-R,d-X],14),this.#g.push(NaN,NaN,NaN,NaN,(i-R-C)/l,(d-X-A)/Z)),this.#l.set([a,h,i,d,s,G],6),!this.isEmpty()):(this.#l.set([a,h,i,d,s,G],6),Math.abs(Math.atan2(h-d,a-i)-Math.atan2(w,Y))<Math.PI/2?([i,d,s,G]=this.#l.subarray(2,6),this.#Z.push(NaN,NaN,NaN,NaN,((i+s)/2-C)/l,((d+G)/2-A)/Z),[i,d,a,h]=this.#l.subarray(14,18),this.#g.push(NaN,NaN,NaN,NaN,((a+i)/2-C)/l,((h+d)/2-A)/Z),!0):([a,h,i,d,s,G]=this.#l.subarray(0,6),this.#Z.push(((a+5*i)/6-C)/l,((h+5*d)/6-A)/Z,((5*i+s)/6-C)/l,((5*d+G)/6-A)/Z,((i+s)/2-C)/l,((d+G)/2-A)/Z),[s,G,i,d,a,h]=this.#l.subarray(12,18),this.#g.push(((a+5*i)/6-C)/l,((h+5*d)/6-A)/Z,((5*i+s)/6-C)/l,((5*d+G)/6-A)/Z,((i+s)/2-C)/l,((d+G)/2-A)/Z),!0))}toSVGPath(){if(this.isEmpty())return"";const I=this.#Z,g=this.#g;if(isNaN(this.#l[6])&&!this.isEmpty())return this.#a();const C=[];C.push(`M${I[4]} ${I[5]}`);for(let A=6;A<I.length;A+=6)isNaN(I[A])?C.push(`L${I[A+4]} ${I[A+5]}`):C.push(`C${I[A]} ${I[A+1]} ${I[A+2]} ${I[A+3]} ${I[A+4]} ${I[A+5]}`);this.#N(C);for(let A=g.length-6;A>=6;A-=6)isNaN(g[A])?C.push(`L${g[A+4]} ${g[A+5]}`):C.push(`C${g[A]} ${g[A+1]} ${g[A+2]} ${g[A+3]} ${g[A+4]} ${g[A+5]}`);return this.#Y(C),C.join(" ")}#a(){const[I,g,C,A]=this.#I,[l,Z,i,d]=this.#o();return`M${(this.#l[2]-I)/C} ${(this.#l[3]-g)/A} L${(this.#l[4]-I)/C} ${(this.#l[5]-g)/A} L${l} ${Z} L${i} ${d} L${(this.#l[16]-I)/C} ${(this.#l[17]-g)/A} L${(this.#l[14]-I)/C} ${(this.#l[15]-g)/A} Z`}#Y(I){const g=this.#g;I.push(`L${g[4]} ${g[5]} Z`)}#N(I){const[g,C,A,l]=this.#I,Z=this.#l.subarray(4,6),i=this.#l.subarray(16,18),[d,s,G,b]=this.#o();I.push(`L${(Z[0]-g)/A} ${(Z[1]-C)/l} L${d} ${s} L${G} ${b} L${(i[0]-g)/A} ${(i[1]-C)/l}`)}newFreeDrawOutline(I,g,C,A,l,Z){return new MA(I,g,C,A,l,Z)}getOutlines(){const I=this.#Z,g=this.#g,C=this.#l,[A,l,Z,i]=this.#I,d=new Float32Array((this.#W?.length??0)+2);for(let b=0,m=d.length-2;b<m;b+=2)d[b]=(this.#W[b]-A)/Z,d[b+1]=(this.#W[b+1]-l)/i;if(d[d.length-2]=(this.#i-A)/Z,d[d.length-1]=(this.#d-l)/i,isNaN(C[6])&&!this.isEmpty())return this.#R(d);const s=new Float32Array(this.#Z.length+24+this.#g.length);let G=I.length;for(let b=0;b<G;b+=2){if(isNaN(I[b])){s[b]=s[b+1]=NaN;continue}s[b]=I[b],s[b+1]=I[b+1]}G=this.#n(s,G);for(let b=g.length-6;b>=6;b-=6)for(let m=0;m<6;m+=2){if(isNaN(g[b+m])){s[G]=s[G+1]=NaN,G+=2;continue}s[G]=g[b+m],s[G+1]=g[b+m+1],G+=2}return this.#h(s,G),this.newFreeDrawOutline(s,d,this.#I,this.#m,this.#C,this.#A)}#R(I){const g=this.#l,[C,A,l,Z]=this.#I,[i,d,s,G]=this.#o(),b=new Float32Array(36);return b.set([NaN,NaN,NaN,NaN,(g[2]-C)/l,(g[3]-A)/Z,NaN,NaN,NaN,NaN,(g[4]-C)/l,(g[5]-A)/Z,NaN,NaN,NaN,NaN,i,d,NaN,NaN,NaN,NaN,s,G,NaN,NaN,NaN,NaN,(g[16]-C)/l,(g[17]-A)/Z,NaN,NaN,NaN,NaN,(g[14]-C)/l,(g[15]-A)/Z],0),this.newFreeDrawOutline(b,I,this.#I,this.#m,this.#C,this.#A)}#h(I,g){const C=this.#g;return I.set([NaN,NaN,NaN,NaN,C[4],C[5]],g),g+=6}#n(I,g){const C=this.#l.subarray(4,6),A=this.#l.subarray(16,18),[l,Z,i,d]=this.#I,[s,G,b,m]=this.#o();return I.set([NaN,NaN,NaN,NaN,(C[0]-l)/i,(C[1]-Z)/d,NaN,NaN,NaN,NaN,s,G,NaN,NaN,NaN,NaN,b,m,NaN,NaN,NaN,NaN,(A[0]-l)/i,(A[1]-Z)/d],g),g+=24}}class MA extends H{#I;#g=new Float32Array(4);#C;#A;#Z;#l;#i;constructor(I,g,C,A,l,Z){super(),this.#i=I,this.#Z=g,this.#I=C,this.#l=A,this.#C=l,this.#A=Z,this.lastPoint=[NaN,NaN],this.#d(Z);const[i,d,s,G]=this.#g;for(let b=0,m=I.length;b<m;b+=2)I[b]=(I[b]-i)/s,I[b+1]=(I[b+1]-d)/G;for(let b=0,m=g.length;b<m;b+=2)g[b]=(g[b]-i)/s,g[b+1]=(g[b+1]-d)/G}toSVGPath(){const I=[`M${this.#i[4]} ${this.#i[5]}`];for(let g=6,C=this.#i.length;g<C;g+=6){if(isNaN(this.#i[g])){I.push(`L${this.#i[g+4]} ${this.#i[g+5]}`);continue}I.push(`C${this.#i[g]} ${this.#i[g+1]} ${this.#i[g+2]} ${this.#i[g+3]} ${this.#i[g+4]} ${this.#i[g+5]}`)}return I.push("Z"),I.join(" ")}serialize([I,g,C,A],l){const Z=C-I,i=A-g;let d,s;switch(l){case 0:d=H._rescale(this.#i,I,A,Z,-i),s=H._rescale(this.#Z,I,A,Z,-i);break;case 90:d=H._rescaleAndSwap(this.#i,I,g,Z,i),s=H._rescaleAndSwap(this.#Z,I,g,Z,i);break;case 180:d=H._rescale(this.#i,C,g,-Z,i),s=H._rescale(this.#Z,C,g,-Z,i);break;case 270:d=H._rescaleAndSwap(this.#i,C,A,-Z,-i),s=H._rescaleAndSwap(this.#Z,C,A,-Z,-i);break}return{outline:Array.from(d),points:[Array.from(s)]}}#d(I){const g=this.#i;let C=g[4],A=g[5];const l=[C,A,C,A];let Z=C,i=A;const d=I?Math.max:Math.min;for(let G=6,b=g.length;G<b;G+=6){const m=g[G+4],B=g[G+5];if(isNaN(g[G]))t.pointBoundingBox(m,B,l),i<B?(Z=m,i=B):i===B&&(Z=d(Z,m));else{const o=[1/0,1/0,-1/0,-1/0];t.bezierBoundingBox(C,A,...g.slice(G,G+6),o),t.rectBoundingBox(...o,l),i<o[3]?(Z=o[2],i=o[3]):i===o[3]&&(Z=d(Z,o[2]))}C=m,A=B}const s=this.#g;s[0]=l[0]-this.#C,s[1]=l[1]-this.#C,s[2]=l[2]-l[0]+2*this.#C,s[3]=l[3]-l[1]+2*this.#C,this.lastPoint=[Z,i]}get box(){return this.#g}newOutliner(I,g,C,A,l,Z=0){return new xI(I,g,C,A,l,Z)}getNewOutline(I,g){const[C,A,l,Z]=this.#g,[i,d,s,G]=this.#I,b=l*s,m=Z*G,B=C*s+i,o=A*G+d,W=this.newOutliner({x:this.#Z[0]*b+B,y:this.#Z[1]*m+o},this.#I,this.#l,I,this.#A,g??this.#C);for(let Y=2;Y<this.#Z.length;Y+=2)W.add({x:this.#Z[Y]*b+B,y:this.#Z[Y+1]*m+o});return W.getOutlines()}}class RC{#I;#g;#C=[];#A=[];constructor(I,g=0,C=0,A=!0){const l=[1/0,1/0,-1/0,-1/0],Z=10**-4;for(const{x:B,y:o,width:W,height:Y}of I){const w=Math.floor((B-g)/Z)*Z,a=Math.ceil((B+W+g)/Z)*Z,h=Math.floor((o-g)/Z)*Z,N=Math.ceil((o+Y+g)/Z)*Z,V=[w,h,N,!0],R=[a,h,N,!1];this.#C.push(V,R),t.rectBoundingBox(w,h,a,N,l)}const i=l[2]-l[0]+2*C,d=l[3]-l[1]+2*C,s=l[0]-C,G=l[1]-C,b=this.#C.at(A?-1:-2),m=[b[0],b[2]];for(const B of this.#C){const[o,W,Y]=B;B[0]=(o-s)/i,B[1]=(W-G)/d,B[2]=(Y-G)/d}this.#I=new Float32Array([s,G,i,d]),this.#g=m}getOutlines(){this.#C.sort((g,C)=>g[0]-C[0]||g[1]-C[1]||g[2]-C[2]);const I=[];for(const g of this.#C)g[3]?(I.push(...this.#c(g)),this.#i(g)):(this.#d(g),I.push(...this.#c(g)));return this.#Z(I)}#Z(I){const g=[],C=new Set;for(const Z of I){const[i,d,s]=Z;g.push([i,d,Z],[i,s,Z])}g.sort((Z,i)=>Z[1]-i[1]||Z[0]-i[0]);for(let Z=0,i=g.length;Z<i;Z+=2){const d=g[Z][2],s=g[Z+1][2];d.push(s),s.push(d),C.add(d),C.add(s)}const A=[];let l;for(;C.size>0;){const Z=C.values().next().value;let[i,d,s,G,b]=Z;C.delete(Z);let m=i,B=d;for(l=[i,s],A.push(l);;){let o;if(C.has(G))o=G;else if(C.has(b))o=b;else break;C.delete(o),[i,d,s,G,b]=o,m!==i&&(l.push(m,B,i,B===d?d:s),m=i),B=B===d?s:d}l.push(m,B)}return new RZ(A,this.#I,this.#g)}#l(I){const g=this.#A;let C=0,A=g.length-1;for(;C<=A;){const l=C+A>>1,Z=g[l][0];if(Z===I)return l;Z<I?C=l+1:A=l-1}return A+1}#i([,I,g]){const C=this.#l(I);this.#A.splice(C,0,[I,g])}#d([,I,g]){const C=this.#l(I);for(let A=C;A<this.#A.length;A++){const[l,Z]=this.#A[A];if(l!==I)break;if(l===I&&Z===g){this.#A.splice(A,1);return}}for(let A=C-1;A>=0;A--){const[l,Z]=this.#A[A];if(l!==I)break;if(l===I&&Z===g){this.#A.splice(A,1);return}}}#c(I){const[g,C,A]=I,l=[[g,C,A]],Z=this.#l(A);for(let i=0;i<Z;i++){const[d,s]=this.#A[i];for(let G=0,b=l.length;G<b;G++){const[,m,B]=l[G];if(!(s<=m||B<=d)){if(m>=d){if(B>s)l[G][1]=s;else{if(b===1)return[];l.splice(G,1),G--,b--}continue}l[G][2]=d,B>s&&l.push([g,s,B])}}}return l}}class RZ extends H{#I;#g;constructor(I,g,C){super(),this.#g=I,this.#I=g,this.lastPoint=C}toSVGPath(){const I=[];for(const g of this.#g){let[C,A]=g;I.push(`M${C} ${A}`);for(let l=2;l<g.length;l+=2){const Z=g[l],i=g[l+1];Z===C?(I.push(`V${i}`),A=i):i===A&&(I.push(`H${Z}`),C=Z)}I.push("Z")}return I.join(" ")}serialize([I,g,C,A],l){const Z=[],i=C-I,d=A-g;for(const s of this.#g){const G=new Array(s.length);for(let b=0;b<s.length;b+=2)G[b]=I+s[b]*i,G[b+1]=A-s[b+1]*d;Z.push(G)}return Z}get box(){return this.#I}get classNamesForOutlining(){return["highlightOutline"]}}class XC extends xI{newFreeDrawOutline(I,g,C,A,l,Z){return new XZ(I,g,C,A,l,Z)}}class XZ extends MA{newOutliner(I,g,C,A,l,Z=0){return new XC(I,g,C,A,l,Z)}}class P extends D{#I=null;#g=0;#C;#A=null;#Z=null;#l=null;#i=null;#d=0;#c=null;#G=null;#m=null;#s=!1;#W=null;#w;#B=null;#b="";#o;#a="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=p.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const I=P.prototype;return J(this,"_keyboardManager",new mg([[["ArrowLeft","mac+ArrowLeft"],I._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],I._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],I._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],I._moveCaret,{args:[3]}]]))}constructor(I){super({...I,name:"highlightEditor"}),this.color=I.color||P._defaultColor,this.#o=I.thickness||P._defaultThickness,this.#w=I.opacity||P._defaultOpacity,this.#C=I.boxes||null,this.#a=I.methodOfCreation||"",this.#b=I.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",I.highlightId>-1?(this.#s=!0,this.#N(I),this.#X()):this.#C&&(this.#I=I.anchorNode,this.#g=I.anchorOffset,this.#i=I.focusNode,this.#d=I.focusOffset,this.#Y(),this.#X(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#s?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#o,methodOfCreation:this.#a}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}get commentColor(){return this.color}static computeTelemetryFinalData(I){return{numberOfColors:I.get("color").size}}#Y(){const I=new RC(this.#C,.001);this.#G=I.getOutlines(),[this.x,this.y,this.width,this.height]=this.#G.box;const g=new RC(this.#C,.0025,.001,this._uiManager.direction==="ltr");this.#l=g.getOutlines();const{lastPoint:C}=this.#l;this.#W=[(C[0]-this.x)/this.width,(C[1]-this.y)/this.height]}#N({highlightOutlines:I,highlightId:g,clipPathId:C}){this.#G=I;const A=1.5;if(this.#l=I.getNewOutline(this.#o/2+A,.0025),g>=0)this.#m=g,this.#A=C,this.parent.drawLayer.finalizeDraw(g,{bbox:I.box,path:{d:I.toSVGPath()}}),this.#B=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#l.box,path:{d:this.#l.toSVGPath()}},!0);else if(this.parent){const G=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#m,{bbox:P.#e(this.#G.box,(G-this.rotation+360)%360),path:{d:I.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#B,{bbox:P.#e(this.#l.box,G),path:{d:this.#l.toSVGPath()}})}const[l,Z,i,d]=I.box;switch(this.rotation){case 0:this.x=l,this.y=Z,this.width=i,this.height=d;break;case 90:{const[G,b]=this.parentDimensions;this.x=Z,this.y=1-l,this.width=i*b/G,this.height=d*G/b;break}case 180:this.x=1-l,this.y=1-Z,this.width=i,this.height=d;break;case 270:{const[G,b]=this.parentDimensions;this.x=1-Z,this.y=l,this.width=i*b/G,this.height=d*G/b;break}}const{lastPoint:s}=this.#l;this.#W=[(s[0]-l)/i,(s[1]-Z)/d]}static initialize(I,g){D.initialize(I,g),P._defaultColor||=g.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(I,g){switch(I){case k.HIGHLIGHT_COLOR:P._defaultColor=g;break;case k.HIGHLIGHT_THICKNESS:P._defaultThickness=g;break}}translateInPage(I,g){}get toolbarPosition(){return this.#W}updateParams(I,g){switch(I){case k.HIGHLIGHT_COLOR:this.#R(g);break;case k.HIGHLIGHT_THICKNESS:this.#h(g);break}}static get defaultPropertiesToUpdate(){return[[k.HIGHLIGHT_COLOR,P._defaultColor],[k.HIGHLIGHT_THICKNESS,P._defaultThickness]]}get propertiesToUpdate(){return[[k.HIGHLIGHT_COLOR,this.color||P._defaultColor],[k.HIGHLIGHT_THICKNESS,this.#o||P._defaultThickness],[k.HIGHLIGHT_FREE,this.#s]]}#R(I){const g=(l,Z)=>{this.color=l,this.#w=Z,this.parent?.drawLayer.updateProperties(this.#m,{root:{fill:l,"fill-opacity":Z}}),this.#Z?.updateColor(l)},C=this.color,A=this.#w;this.addCommands({cmd:g.bind(this,I,P._defaultOpacity),undo:g.bind(this,C,A),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:k.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(I)},!0)}#h(I){const g=this.#o,C=A=>{this.#o=A,this.#n(A)};this.addCommands({cmd:C.bind(this,I),undo:C.bind(this,g),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:k.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:I},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#Z=new VI({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#H())}getBaseTranslation(){return[0,0]}getRect(I,g){return super.getRect(I,g,this.#H())}onceAdded(I){this.annotationElementId||this.parent.addUndoableEditor(this),I&&this.div.focus()}remove(){this.#t(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#X(),this.isAttachedToDOM||this.parent.add(this)))}setParent(I){let g=!1;this.parent&&!I?this.#t():I&&(this.#X(I),g=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(I),this.show(this._isVisible),g&&this.select()}#n(I){if(!this.#s)return;this.#N({highlightOutlines:this.#G.getNewOutline(I/2)}),this.fixAndSetPosition();const[g,C]=this.parentDimensions;this.setDims(this.width*g,this.height*C)}#t(){this.#m===null||!this.parent||(this.parent.drawLayer.remove(this.#m),this.#m=null,this.parent.drawLayer.remove(this.#B),this.#B=null)}#X(I=this.parent){this.#m===null&&({id:this.#m,clipPathId:this.#A}=I.drawLayer.draw({bbox:this.#G.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#w},rootClass:{highlight:!0,free:this.#s},path:{d:this.#G.toSVGPath()}},!1,!0),this.#B=I.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#s},bbox:this.#l.box,path:{d:this.#l.toSVGPath()}},this.#s),this.#c&&(this.#c.style.clipPath=this.#A))}static#e([I,g,C,A],l){switch(l){case 90:return[1-g-A,I,A,C];case 180:return[1-I-C,1-g-A,C,A];case 270:return[g,1-I-C,A,C]}return[I,g,C,A]}rotate(I){const{drawLayer:g}=this.parent;let C;this.#s?(I=(I-this.rotation+360)%360,C=P.#e(this.#G.box,I)):C=P.#e([this.x,this.y,this.width,this.height],I),g.updateProperties(this.#m,{bbox:C,root:{"data-main-rotation":I}}),g.updateProperties(this.#B,{bbox:P.#e(this.#l.box,I),root:{"data-main-rotation":I}})}render(){if(this.div)return this.div;const I=super.render();this.#b&&(I.setAttribute("aria-label",this.#b),I.setAttribute("role","mark")),this.#s?I.classList.add("free"):this.div.addEventListener("keydown",this.#u.bind(this),{signal:this._uiManager._signal});const g=this.#c=document.createElement("div");I.append(g),g.setAttribute("aria-hidden","true"),g.className="internal",g.style.clipPath=this.#A;const[C,A]=this.parentDimensions;return this.setDims(this.width*C,this.height*A),TC(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),I}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#B,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#B,{rootClass:{hovered:!1}})}#u(I){P._keyboardManager.exec(this,I)}_moveCaret(I){switch(this.parent.unselect(this),I){case 0:case 2:this.#M(!0);break;case 1:case 3:this.#M(!1);break}}#M(I){if(!this.#I)return;const g=window.getSelection();I?g.setPosition(this.#I,this.#g):g.setPosition(this.#i,this.#d)}select(){super.select(),this.#B&&this.parent?.drawLayer.updateProperties(this.#B,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#B&&(this.parent?.drawLayer.updateProperties(this.#B,{rootClass:{selected:!1}}),this.#s||this.#M(!1))}get _mustFixPosition(){return!this.#s}show(I=this._isVisible){super.show(I),this.parent&&(this.parent.drawLayer.updateProperties(this.#m,{rootClass:{hidden:!I}}),this.parent.drawLayer.updateProperties(this.#B,{rootClass:{hidden:!I}}))}#H(){return this.#s?this.rotation:0}#K(){if(this.#s)return null;const[I,g]=this.pageDimensions,[C,A]=this.pageTranslation,l=this.#C,Z=new Float32Array(l.length*8);let i=0;for(const{x:d,y:s,width:G,height:b}of l){const m=d*I+C,B=(1-s)*g+A;Z[i]=Z[i+4]=m,Z[i+1]=Z[i+3]=B,Z[i+2]=Z[i+6]=m+G*I,Z[i+5]=Z[i+7]=B-b*g,i+=8}return Z}#J(I){return this.#G.serialize(I,this.#H())}static startHighlighting(I,g,{target:C,x:A,y:l}){const{x:Z,y:i,width:d,height:s}=C.getBoundingClientRect(),G=new AbortController,b=I.combinedSignal(G),m=B=>{G.abort(),this.#Q(I,B)};window.addEventListener("blur",m,{signal:b}),window.addEventListener("pointerup",m,{signal:b}),window.addEventListener("pointerdown",II,{capture:!0,passive:!1,signal:b}),window.addEventListener("contextmenu",hI,{signal:b}),C.addEventListener("pointermove",this.#S.bind(this,I),{signal:b}),this._freeHighlight=new XC({x:A,y:l},[Z,i,d,s],I.scale,this._defaultThickness/2,g,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=I.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#S(I,g){this._freeHighlight.add(g)&&I.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#Q(I,g){this._freeHighlight.isEmpty()?I.drawLayer.remove(this._freeHighlightId):I.createAndAddNewEditor(g,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(I,g,C){let A=null;if(I instanceof yA){const{data:{quadPoints:o,rect:W,rotation:Y,id:w,color:a,opacity:h,popupRef:N,contentsObj:V},parent:{page:{pageNumber:R}}}=I;A=I={annotationType:p.HIGHLIGHT,color:Array.from(a),opacity:h,quadPoints:o,boxes:null,pageIndex:R-1,rect:W.slice(0),rotation:Y,annotationElementId:w,id:w,deleted:!1,popupRef:N,comment:V?.str||null}}else if(I instanceof VC){const{data:{inkLists:o,rect:W,rotation:Y,id:w,color:a,borderStyle:{rawWidth:h},popupRef:N,contentsObj:V},parent:{page:{pageNumber:R}}}=I;A=I={annotationType:p.HIGHLIGHT,color:Array.from(a),thickness:h,inkLists:o,boxes:null,pageIndex:R-1,rect:W.slice(0),rotation:Y,annotationElementId:w,id:w,deleted:!1,popupRef:N,comment:V?.str||null}}const{color:l,quadPoints:Z,inkLists:i,opacity:d}=I,s=await super.deserialize(I,g,C);s.color=t.makeHexColor(...l),s.#w=d||1,i&&(s.#o=I.thickness),s._initialData=A,I.comment&&s.setCommentData(I.comment);const[G,b]=s.pageDimensions,[m,B]=s.pageTranslation;if(Z){const o=s.#C=[];for(let W=0;W<Z.length;W+=8)o.push({x:(Z[W]-m)/G,y:1-(Z[W+1]-B)/b,width:(Z[W+2]-Z[W])/G,height:(Z[W+1]-Z[W+5])/b});s.#Y(),s.#X(),s.rotate(s.rotation)}else if(i){s.#s=!0;const o=i[0],W={x:o[0]-m,y:b-(o[1]-B)},Y=new XC(W,[0,0,G,b],1,s.#o/2,!0,.001);for(let h=0,N=o.length;h<N;h+=2)W.x=o[h]-m,W.y=b-(o[h+1]-B),Y.add(W);const{id:w,clipPathId:a}=g.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:s.color,"fill-opacity":s._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:Y.toSVGPath()}},!0,!0);s.#N({highlightOutlines:Y.getOutlines(),highlightId:w,clipPathId:a}),s.#X(),s.rotate(s.parentRotation)}return s}serialize(I=!1){if(this.isEmpty()||I)return null;if(this.deleted)return this.serializeDeleted();const g=this.getRect(0,0),C=D._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),A={annotationType:p.HIGHLIGHT,color:C,opacity:this.#w,thickness:this.#o,quadPoints:this.#K(),outlines:this.#J(g),pageIndex:this.pageIndex,rect:g,rotation:this.#H(),structTreeParentId:this._structTreeParentId};return this.addComment(A),this.annotationElementId&&!this.#y(A)?null:(A.id=this.annotationElementId,A)}#y(I){const{color:g}=this._initialData;return this.hasEditedComment||I.color.some((C,A)=>C!==g[A])}renderAnnotationElement(I){const g={rect:this.getRect(0,0)};return this.hasEditedComment&&(g.popup=this.comment),I.updateEdited(g),null}static canCreateNewEmptyEditor(){return!1}}class uA{#I=Object.create(null);updateProperty(I,g){this[I]=g,this.updateSVGProperty(I,g)}updateProperties(I){if(I)for(const[g,C]of Object.entries(I))g.startsWith("_")||this.updateProperty(g,C)}updateSVGProperty(I,g){this.#I[I]=g}toSVGProperties(){const I=this.#I;return this.#I=Object.create(null),{root:I}}reset(){this.#I=Object.create(null)}updateAll(I=this){this.updateProperties(I)}clone(){j("Not implemented")}}class S extends D{#I=null;#g;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#C=null;static#A=null;static#Z=null;static#l=NaN;static#i=null;static#d=null;static#c=NaN;static _INNER_MARGIN=3;constructor(I){super(I),this.#g=I.mustBeCommitted||!1,this._addOutlines(I)}_addOutlines(I){I.drawOutlines&&(this.#G(I),this.#W())}#G({drawOutlines:I,drawId:g,drawingOptions:C}){this.#I=I,this._drawingOptions||=C,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),g>=0?(this._drawId=g,this.parent.drawLayer.finalizeDraw(g,I.defaultProperties)):this._drawId=this.#m(I,this.parent),this.#b(I.box)}#m(I,g){const{id:C}=g.drawLayer.draw(S._mergeSVGProperties(this._drawingOptions.toSVGProperties(),I.defaultSVGProperties),!1,!1);return C}static _mergeSVGProperties(I,g){const C=new Set(Object.keys(I));for(const[A,l]of Object.entries(g))C.has(A)?Object.assign(I[A],l):I[A]=l;return I}static getDefaultDrawingOptions(I){j("Not implemented")}static get typesMap(){j("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(I,g){const C=this.typesMap.get(I);C&&this._defaultDrawingOptions.updateProperty(C,g),this._currentParent&&(S.#C.updateProperty(C,g),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(I,g){const C=this.constructor.typesMap.get(I);C&&this._updateProperty(I,C,g)}static get defaultPropertiesToUpdate(){const I=[],g=this._defaultDrawingOptions;for(const[C,A]of this.typesMap)I.push([C,g[A]]);return I}get propertiesToUpdate(){const I=[],{_drawingOptions:g}=this;for(const[C,A]of this.constructor.typesMap)I.push([C,g[A]]);return I}_updateProperty(I,g,C){const A=this._drawingOptions,l=A[g],Z=i=>{A.updateProperty(g,i);const d=this.#I.updateProperty(g,i);d&&this.#b(d),this.parent?.drawLayer.updateProperties(this._drawId,A.toSVGProperties()),I===this.colorType&&this._colorPicker?.update(i)};this.addCommands({cmd:Z.bind(this,C),undo:Z.bind(this,l),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:I,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,S._mergeSVGProperties(this.#I.getPathResizingSVGProperties(this.#B()),{bbox:this.#o()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,S._mergeSVGProperties(this.#I.getPathResizedSVGProperties(this.#B()),{bbox:this.#o()}))}_onTranslating(I,g){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#o()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,S._mergeSVGProperties(this.#I.getPathTranslatedSVGProperties(this.#B(),this.parentDimensions),{bbox:this.#o()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(I){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#g&&(this.#g=!1,this.commit(),this.parent.setSelected(this),I&&this.isOnScreen&&this.div.focus())}remove(){this.#s(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#W(),this.#b(this.#I.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(I){let g=!1;this.parent&&!I?(this._uiManager.removeShouldRescale(this),this.#s()):I&&(this._uiManager.addShouldRescale(this),this.#W(I),g=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(I),g&&this.select()}#s(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#W(I=this.parent){if(!(this._drawId!==null&&this.parent===I)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,I.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#m(this.#I,I)}}#w([I,g,C,A]){const{parentDimensions:[l,Z],rotation:i}=this;switch(i){case 90:return[g,1-I,C*(Z/l),A*(l/Z)];case 180:return[1-I,1-g,C,A];case 270:return[1-g,I,C*(Z/l),A*(l/Z)];default:return[I,g,C,A]}}#B(){const{x:I,y:g,width:C,height:A,parentDimensions:[l,Z],rotation:i}=this;switch(i){case 90:return[1-g,I,C*(l/Z),A*(Z/l)];case 180:return[1-I,1-g,C,A];case 270:return[g,1-I,C*(l/Z),A*(Z/l)];default:return[I,g,C,A]}}#b(I){if([this.x,this.y,this.width,this.height]=this.#w(I),this.div){this.fixAndSetPosition();const[g,C]=this.parentDimensions;this.setDims(this.width*g,this.height*C)}this._onResized()}#o(){const{x:I,y:g,width:C,height:A,rotation:l,parentRotation:Z,parentDimensions:[i,d]}=this;switch((l*4+Z)/90){case 1:return[1-g-A,I,A,C];case 2:return[1-I-C,1-g-A,C,A];case 3:return[g,1-I-C,A,C];case 4:return[I,g-C*(i/d),A*(d/i),C*(i/d)];case 5:return[1-g,I,C*(i/d),A*(d/i)];case 6:return[1-I-A*(d/i),1-g,A*(d/i),C*(i/d)];case 7:return[g-C*(i/d),1-I-A*(d/i),C*(i/d),A*(d/i)];case 8:return[I-C,g-A,C,A];case 9:return[1-g,I-C,A,C];case 10:return[1-I,1-g,C,A];case 11:return[g-A,1-I,A,C];case 12:return[I-A*(d/i),g,A*(d/i),C*(i/d)];case 13:return[1-g-C*(i/d),I-A*(d/i),C*(i/d),A*(d/i)];case 14:return[1-I,1-g-C*(i/d),A*(d/i),C*(i/d)];case 15:return[g,1-I,C*(i/d),A*(d/i)];default:return[I,g,C,A]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,S._mergeSVGProperties({bbox:this.#o()},this.#I.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#b(this.#I.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let I,g;this._isCopy&&(I=this.x,g=this.y);const C=super.render();C.classList.add("draw");const A=document.createElement("div");C.append(A),A.setAttribute("aria-hidden","true"),A.className="internal";const[l,Z]=this.parentDimensions;return this.setDims(this.width*l,this.height*Z),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(I,g),C}static createDrawerInstance(I,g,C,A,l){j("Not implemented")}static startDrawing(I,g,C,A){const{target:l,offsetX:Z,offsetY:i,pointerId:d,pointerType:s}=A;if(S.#i&&S.#i!==s)return;const{viewport:{rotation:G}}=I,{width:b,height:m}=l.getBoundingClientRect(),B=S.#A=new AbortController,o=I.combinedSignal(B);if(S.#l||=d,S.#i??=s,window.addEventListener("pointerup",W=>{S.#l===W.pointerId?this._endDraw(W):S.#d?.delete(W.pointerId)},{signal:o}),window.addEventListener("pointercancel",W=>{S.#l===W.pointerId?this._currentParent.endDrawingSession():S.#d?.delete(W.pointerId)},{signal:o}),window.addEventListener("pointerdown",W=>{S.#i===W.pointerType&&((S.#d||=new Set).add(W.pointerId),S.#C.isCancellable()&&(S.#C.removeLastElement(),S.#C.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:o}),window.addEventListener("contextmenu",hI,{signal:o}),l.addEventListener("pointermove",this._drawMove.bind(this),{signal:o}),l.addEventListener("touchmove",W=>{W.timeStamp===S.#c&&II(W)},{signal:o}),I.toggleDrawing(),g._editorUndoBar?.hide(),S.#C){I.drawLayer.updateProperties(this._currentDrawId,S.#C.startNew(Z,i,b,m,G));return}g.updateUIForDefaultProperties(this),S.#C=this.createDrawerInstance(Z,i,b,m,G),S.#Z=this.getDefaultDrawingOptions(),this._currentParent=I,{id:this._currentDrawId}=I.drawLayer.draw(this._mergeSVGProperties(S.#Z.toSVGProperties(),S.#C.defaultSVGProperties),!0,!1)}static _drawMove(I){if(S.#c=-1,!S.#C)return;const{offsetX:g,offsetY:C,pointerId:A}=I;if(S.#l===A){if(S.#d?.size>=1){this._endDraw(I);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,S.#C.add(g,C)),S.#c=I.timeStamp,II(I)}}static _cleanup(I){I&&(this._currentDrawId=-1,this._currentParent=null,S.#C=null,S.#Z=null,S.#i=null,S.#c=NaN),S.#A&&(S.#A.abort(),S.#A=null,S.#l=NaN,S.#d=null)}static _endDraw(I){const g=this._currentParent;if(g){if(g.toggleDrawing(!0),this._cleanup(!1),I?.target===g.div&&g.drawLayer.updateProperties(this._currentDrawId,S.#C.end(I.offsetX,I.offsetY)),this.supportMultipleDrawings){const C=S.#C,A=this._currentDrawId,l=C.getLastElement();g.addCommands({cmd:()=>{g.drawLayer.updateProperties(A,C.setLastElement(l))},undo:()=>{g.drawLayer.updateProperties(A,C.removeLastElement())},mustExec:!1,type:k.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(I){const g=this._currentParent;if(!g)return null;if(g.toggleDrawing(!0),g.cleanUndoStack(k.DRAW_STEP),!S.#C.isEmpty()){const{pageDimensions:[C,A],scale:l}=g,Z=g.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:S.#C.getOutlines(C*l,A*l,l,this._INNER_MARGIN),drawingOptions:S.#Z,mustBeCommitted:!I});return this._cleanup(!0),Z}return g.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(I){}static deserializeDraw(I,g,C,A,l,Z){j("Not implemented")}static async deserialize(I,g,C){const{rawDims:{pageWidth:A,pageHeight:l,pageX:Z,pageY:i}}=g.viewport,d=this.deserializeDraw(Z,i,A,l,this._INNER_MARGIN,I),s=await super.deserialize(I,g,C);return s.createDrawingOptions(I),s.#G({drawOutlines:d}),s.#W(),s.onScaleChanging(),s.rotate(),s}serializeDraw(I){const[g,C]=this.pageTranslation,[A,l]=this.pageDimensions;return this.#I.serialize([g,C,A,l],I)}renderAnnotationElement(I){return I.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}class nZ{#I=new Float64Array(6);#g;#C;#A;#Z;#l;#i="";#d=0;#c=new Ng;#G;#m;constructor(I,g,C,A,l,Z){this.#G=C,this.#m=A,this.#A=l,this.#Z=Z,[I,g]=this.#s(I,g);const i=this.#g=[NaN,NaN,NaN,NaN,I,g];this.#l=[I,g],this.#C=[{line:i,points:this.#l}],this.#I.set(i,0)}updateProperty(I,g){I==="stroke-width"&&(this.#Z=g)}#s(I,g){return H._normalizePoint(I,g,this.#G,this.#m,this.#A)}isEmpty(){return!this.#C||this.#C.length===0}isCancellable(){return this.#l.length<=10}add(I,g){[I,g]=this.#s(I,g);const[C,A,l,Z]=this.#I.subarray(2,6),i=I-l,d=g-Z;return Math.hypot(this.#G*i,this.#m*d)<=2?null:(this.#l.push(I,g),isNaN(C)?(this.#I.set([l,Z,I,g],2),this.#g.push(NaN,NaN,NaN,NaN,I,g),{path:{d:this.toSVGPath()}}):(isNaN(this.#I[0])&&this.#g.splice(6,6),this.#I.set([C,A,l,Z,I,g],0),this.#g.push(...H.createBezierPoints(C,A,l,Z,I,g)),{path:{d:this.toSVGPath()}}))}end(I,g){const C=this.add(I,g);return C||(this.#l.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(I,g,C,A,l){this.#G=C,this.#m=A,this.#A=l,[I,g]=this.#s(I,g);const Z=this.#g=[NaN,NaN,NaN,NaN,I,g];this.#l=[I,g];const i=this.#C.at(-1);return i&&(i.line=new Float32Array(i.line),i.points=new Float32Array(i.points)),this.#C.push({line:Z,points:this.#l}),this.#I.set(Z,0),this.#d=0,this.toSVGPath(),null}getLastElement(){return this.#C.at(-1)}setLastElement(I){return this.#C?(this.#C.push(I),this.#g=I.line,this.#l=I.points,this.#d=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(I)}removeLastElement(){if(!this.#C)return this.#c.removeLastElement();this.#C.pop(),this.#i="";for(let I=0,g=this.#C.length;I<g;I++){const{line:C,points:A}=this.#C[I];this.#g=C,this.#l=A,this.#d=0,this.toSVGPath()}return{path:{d:this.#i}}}toSVGPath(){const I=H.svgRound(this.#g[4]),g=H.svgRound(this.#g[5]);if(this.#l.length===2)return this.#i=`${this.#i} M ${I} ${g} Z`,this.#i;if(this.#l.length<=6){const A=this.#i.lastIndexOf("M");this.#i=`${this.#i.slice(0,A)} M ${I} ${g}`,this.#d=6}if(this.#l.length===4){const A=H.svgRound(this.#g[10]),l=H.svgRound(this.#g[11]);return this.#i=`${this.#i} L ${A} ${l}`,this.#d=12,this.#i}const C=[];this.#d===0&&(C.push(`M ${I} ${g}`),this.#d=6);for(let A=this.#d,l=this.#g.length;A<l;A+=6){const[Z,i,d,s,G,b]=this.#g.slice(A,A+6).map(H.svgRound);C.push(`C${Z} ${i} ${d} ${s} ${G} ${b}`)}return this.#i+=C.join(" "),this.#d=this.#g.length,this.#i}getOutlines(I,g,C,A){const l=this.#C.at(-1);return l.line=new Float32Array(l.line),l.points=new Float32Array(l.points),this.#c.build(this.#C,I,g,C,this.#A,this.#Z,A),this.#I=null,this.#g=null,this.#C=null,this.#i=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class Ng extends H{#I;#g=0;#C;#A;#Z;#l;#i;#d;#c;build(I,g,C,A,l,Z,i){this.#Z=g,this.#l=C,this.#i=A,this.#d=l,this.#c=Z,this.#C=i??0,this.#A=I,this.#s()}get thickness(){return this.#c}setLastElement(I){return this.#A.push(I),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#A.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const I=[];for(const{line:g}of this.#A){if(I.push(`M${H.svgRound(g[4])} ${H.svgRound(g[5])}`),g.length===6){I.push("Z");continue}if(g.length===12&&isNaN(g[6])){I.push(`L${H.svgRound(g[10])} ${H.svgRound(g[11])}`);continue}for(let C=6,A=g.length;C<A;C+=6){const[l,Z,i,d,s,G]=g.subarray(C,C+6).map(H.svgRound);I.push(`C${l} ${Z} ${i} ${d} ${s} ${G}`)}}return I.join("")}serialize([I,g,C,A],l){const Z=[],i=[],[d,s,G,b]=this.#m();let m,B,o,W,Y,w,a,h,N;switch(this.#d){case 0:N=H._rescale,m=I,B=g+A,o=C,W=-A,Y=I+d*C,w=g+(1-s-b)*A,a=I+(d+G)*C,h=g+(1-s)*A;break;case 90:N=H._rescaleAndSwap,m=I,B=g,o=C,W=A,Y=I+s*C,w=g+d*A,a=I+(s+b)*C,h=g+(d+G)*A;break;case 180:N=H._rescale,m=I+C,B=g,o=-C,W=A,Y=I+(1-d-G)*C,w=g+s*A,a=I+(1-d)*C,h=g+(s+b)*A;break;case 270:N=H._rescaleAndSwap,m=I+C,B=g+A,o=-C,W=-A,Y=I+(1-s-b)*C,w=g+(1-d-G)*A,a=I+(1-s)*C,h=g+(1-d)*A;break}for(const{line:V,points:R}of this.#A)Z.push(N(V,m,B,o,W,l?new Array(V.length):null)),i.push(N(R,m,B,o,W,l?new Array(R.length):null));return{lines:Z,points:i,rect:[Y,w,a,h]}}static deserialize(I,g,C,A,l,{paths:{lines:Z,points:i},rotation:d,thickness:s}){const G=[];let b,m,B,o,W;switch(d){case 0:W=H._rescale,b=-I/C,m=g/A+1,B=1/C,o=-1/A;break;case 90:W=H._rescaleAndSwap,b=-g/A,m=-I/C,B=1/A,o=1/C;break;case 180:W=H._rescale,b=I/C+1,m=-g/A,B=-1/C,o=1/A;break;case 270:W=H._rescaleAndSwap,b=g/A+1,m=I/C+1,B=-1/A,o=-1/C;break}if(!Z){Z=[];for(const w of i){const a=w.length;if(a===2){Z.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1]]));continue}if(a===4){Z.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1],NaN,NaN,NaN,NaN,w[2],w[3]]));continue}const h=new Float32Array(3*(a-2));Z.push(h);let[N,V,R,X]=w.subarray(0,4);h.set([NaN,NaN,NaN,NaN,N,V],0);for(let n=4;n<a;n+=2){const y=w[n],K=w[n+1];h.set(H.createBezierPoints(N,V,R,X,y,K),(n-2)*3),[N,V,R,X]=[R,X,y,K]}}}for(let w=0,a=Z.length;w<a;w++)G.push({line:W(Z[w].map(h=>h??NaN),b,m,B,o),points:W(i[w].map(h=>h??NaN),b,m,B,o)});const Y=new this.prototype.constructor;return Y.build(G,C,A,1,d,s,l),Y}#G(I=this.#c){const g=this.#C+I/2*this.#i;return this.#d%180===0?[g/this.#Z,g/this.#l]:[g/this.#l,g/this.#Z]}#m(){const[I,g,C,A]=this.#I,[l,Z]=this.#G(0);return[I+l,g+Z,C-2*l,A-2*Z]}#s(){const I=this.#I=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:A}of this.#A){if(A.length<=12){for(let i=4,d=A.length;i<d;i+=6)t.pointBoundingBox(A[i],A[i+1],I);continue}let l=A[4],Z=A[5];for(let i=6,d=A.length;i<d;i+=6){const[s,G,b,m,B,o]=A.subarray(i,i+6);t.bezierBoundingBox(l,Z,s,G,b,m,B,o,I),l=B,Z=o}}const[g,C]=this.#G();I[0]=GI(I[0]-g,0,1),I[1]=GI(I[1]-C,0,1),I[2]=GI(I[2]+g,0,1),I[3]=GI(I[3]+C,0,1),I[2]-=I[0],I[3]-=I[1]}get box(){return this.#I}updateProperty(I,g){return I==="stroke-width"?this.#W(g):null}#W(I){const[g,C]=this.#G();this.#c=I;const[A,l]=this.#G(),[Z,i]=[A-g,l-C],d=this.#I;return d[0]-=Z,d[1]-=i,d[2]+=2*Z,d[3]+=2*i,d}updateParentDimensions([I,g],C){const[A,l]=this.#G();this.#Z=I,this.#l=g,this.#i=C;const[Z,i]=this.#G(),d=Z-A,s=i-l,G=this.#I;return G[0]-=d,G[1]-=s,G[2]+=2*d,G[3]+=2*s,G}updateRotation(I){return this.#g=I,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#I.map(H.svgRound).join(" ")}get defaultProperties(){const[I,g]=this.#I;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(I)} ${H.svgRound(g)}`}}}get rotationTransform(){const[,,I,g]=this.#I;let C=0,A=0,l=0,Z=0,i=0,d=0;switch(this.#g){case 90:A=g/I,l=-I/g,i=I;break;case 180:C=-1,Z=-1,i=I,d=g;break;case 270:A=-g/I,l=I/g,d=g;break;default:return""}return`matrix(${C} ${A} ${l} ${Z} ${H.svgRound(i)} ${H.svgRound(d)})`}getPathResizingSVGProperties([I,g,C,A]){const[l,Z]=this.#G(),[i,d,s,G]=this.#I;if(Math.abs(s-l)<=H.PRECISION||Math.abs(G-Z)<=H.PRECISION){const W=I+C/2-(i+s/2),Y=g+A/2-(d+G/2);return{path:{"transform-origin":`${H.svgRound(I)} ${H.svgRound(g)}`,transform:`${this.rotationTransform} translate(${W} ${Y})`}}}const b=(C-2*l)/(s-2*l),m=(A-2*Z)/(G-2*Z),B=s/C,o=G/A;return{path:{"transform-origin":`${H.svgRound(i)} ${H.svgRound(d)}`,transform:`${this.rotationTransform} scale(${B} ${o}) translate(${H.svgRound(l)} ${H.svgRound(Z)}) scale(${b} ${m}) translate(${H.svgRound(-l)} ${H.svgRound(-Z)})`}}}getPathResizedSVGProperties([I,g,C,A]){const[l,Z]=this.#G(),i=this.#I,[d,s,G,b]=i;if(i[0]=I,i[1]=g,i[2]=C,i[3]=A,Math.abs(G-l)<=H.PRECISION||Math.abs(b-Z)<=H.PRECISION){const Y=I+C/2-(d+G/2),w=g+A/2-(s+b/2);for(const{line:a,points:h}of this.#A)H._translate(a,Y,w,a),H._translate(h,Y,w,h);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(I)} ${H.svgRound(g)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const m=(C-2*l)/(G-2*l),B=(A-2*Z)/(b-2*Z),o=-m*(d+l)+I+l,W=-B*(s+Z)+g+Z;if(m!==1||B!==1||o!==0||W!==0)for(const{line:Y,points:w}of this.#A)H._rescale(Y,o,W,m,B,Y),H._rescale(w,o,W,m,B,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${H.svgRound(I)} ${H.svgRound(g)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([I,g],C){const[A,l]=C,Z=this.#I,i=I-Z[0],d=g-Z[1];if(this.#Z===A&&this.#l===l)for(const{line:s,points:G}of this.#A)H._translate(s,i,d,s),H._translate(G,i,d,G);else{const s=this.#Z/A,G=this.#l/l;this.#Z=A,this.#l=l;for(const{line:b,points:m}of this.#A)H._rescale(b,i,d,s,G,b),H._rescale(m,i,d,s,G,m);Z[2]*=s,Z[3]*=G}return Z[0]=I,Z[1]=g,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${H.svgRound(I)} ${H.svgRound(g)}`}}}get defaultSVGProperties(){const I=this.#I;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${H.svgRound(I[0])} ${H.svgRound(I[1])}`,transform:this.rotationTransform||null},bbox:I}}}class Og extends uA{constructor(I){super(),this._viewParameters=I,super.updateProperties({fill:"none",stroke:D._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(I,g){I==="stroke-width"&&(g??=this["stroke-width"],g*=this._viewParameters.realScale),super.updateSVGProperty(I,g)}clone(){const I=new Og(this._viewParameters);return I.updateAll(this),I}}class nC extends S{static _type="ink";static _editorType=p.INK;static _defaultDrawingOptions=null;constructor(I){super({...I,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(I,g){D.initialize(I,g),this._defaultDrawingOptions=new Og(g.viewParameters)}static getDefaultDrawingOptions(I){const g=this._defaultDrawingOptions.clone();return g.updateProperties(I),g}static get supportMultipleDrawings(){return!0}static get typesMap(){return J(this,"typesMap",new Map([[k.INK_THICKNESS,"stroke-width"],[k.INK_COLOR,"stroke"],[k.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(I,g,C,A,l){return new nZ(I,g,C,A,l,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(I,g,C,A,l,Z){return Ng.deserialize(I,g,C,A,l,Z)}static async deserialize(I,g,C){let A=null;if(I instanceof VC){const{data:{inkLists:Z,rect:i,rotation:d,id:s,color:G,opacity:b,borderStyle:{rawWidth:m},popupRef:B,contentsObj:o},parent:{page:{pageNumber:W}}}=I;A=I={annotationType:p.INK,color:Array.from(G),thickness:m,opacity:b,paths:{points:Z},boxes:null,pageIndex:W-1,rect:i.slice(0),rotation:d,annotationElementId:s,id:s,deleted:!1,popupRef:B,comment:o?.str||null}}const l=await super.deserialize(I,g,C);return l._initialData=A,I.comment&&l.setCommentData(I.comment),l}get toolbarButtons(){return this._colorPicker||=new ag(this),[["colorPicker",this._colorPicker]]}get colorType(){return k.INK_COLOR}get colorValue(){return this._drawingOptions.stroke}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:I,_drawingOptions:g,parent:C}=this;g.updateSVGProperty("stroke-width"),C.drawLayer.updateProperties(I,g.toSVGProperties())}static onScaleChangingWhenDrawing(){const I=this._currentParent;I&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),I.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:I,thickness:g,opacity:C}){this._drawingOptions=nC.getDefaultDrawingOptions({stroke:t.makeHexColor(...I),"stroke-width":g,"stroke-opacity":C})}serialize(I=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:g,points:C,rect:A}=this.serializeDraw(I),{_drawingOptions:{stroke:l,"stroke-opacity":Z,"stroke-width":i}}=this,d={annotationType:p.INK,color:D._colorManager.convert(l),opacity:Z,thickness:i,paths:{lines:g,points:C},pageIndex:this.pageIndex,rect:A,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(d),I?(d.isCopy=!0,d):this.annotationElementId&&!this.#I(d)?null:(d.id=this.annotationElementId,d)}#I(I){const{color:g,thickness:C,opacity:A,pageIndex:l}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||I.color.some((Z,i)=>Z!==g[i])||I.thickness!==C||I.opacity!==A||I.pageIndex!==l}renderAnnotationElement(I){const{points:g,rect:C}=this.serializeDraw(!1),A={rect:C,thickness:this._drawingOptions["stroke-width"],points:g};return this.hasEditedComment&&(A.popup=this.comment),I.updateEdited(A),null}}class yC extends Ng{toSVGPath(){let I=super.toSVGPath();return I.endsWith("Z")||(I+="Z"),I}}const Ug=8,Rg=3;class Ag{static#I={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#g(I,g,C,A){return C-=I,A-=g,C===0?A>0?0:4:C===1?A+6:2-A}static#C=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#A(I,g,C,A,l,Z,i){const d=this.#g(C,A,l,Z);for(let s=0;s<8;s++){const G=(-s+d-i+16)%8,b=this.#C[2*G],m=this.#C[2*G+1];if(I[(C+b)*g+(A+m)]!==0)return G}return-1}static#Z(I,g,C,A,l,Z,i){const d=this.#g(C,A,l,Z);for(let s=0;s<8;s++){const G=(s+d+i+16)%8,b=this.#C[2*G],m=this.#C[2*G+1];if(I[(C+b)*g+(A+m)]!==0)return G}return-1}static#l(I,g,C,A){const l=I.length,Z=new Int32Array(l);for(let G=0;G<l;G++)Z[G]=I[G]<=A?1:0;for(let G=1;G<C-1;G++)Z[G*g]=Z[G*g+g-1]=0;for(let G=0;G<g;G++)Z[G]=Z[g*C-1-G]=0;let i=1,d;const s=[];for(let G=1;G<C-1;G++){d=1;for(let b=1;b<g-1;b++){const m=G*g+b,B=Z[m];if(B===0)continue;let o=G,W=b;if(B===1&&Z[m-1]===0)i+=1,W-=1;else if(B>=1&&Z[m+1]===0)i+=1,W+=1,B>1&&(d=B);else{B!==1&&(d=Math.abs(B));continue}const Y=[b,G],w=W===b+1,a={isHole:w,points:Y,id:i,parent:0};s.push(a);let h;for(const e of s)if(e.id===d){h=e;break}h?h.isHole?a.parent=w?h.parent:d:a.parent=w?d:h.parent:a.parent=w?d:0;const N=this.#A(Z,g,G,b,o,W,0);if(N===-1){Z[m]=-i,Z[m]!==1&&(d=Math.abs(Z[m]));continue}let V=this.#C[2*N],R=this.#C[2*N+1];const X=G+V,n=b+R;o=X,W=n;let y=G,K=b;for(;;){const e=this.#Z(Z,g,y,K,o,W,1);V=this.#C[2*e],R=this.#C[2*e+1];const T=y+V,O=K+R;Y.push(O,T);const L=y*g+K;if(Z[L+1]===0?Z[L]=-i:Z[L]===1&&(Z[L]=i),T===G&&O===b&&y===X&&K===n){Z[m]!==1&&(d=Math.abs(Z[m]));break}else o=y,W=K,y=T,K=O}}}return s}static#i(I,g,C,A){if(C-g<=4){for(let X=g;X<C-2;X+=2)A.push(I[X],I[X+1]);return}const l=I[g],Z=I[g+1],i=I[C-4]-l,d=I[C-3]-Z,s=Math.hypot(i,d),G=i/s,b=d/s,m=G*Z-b*l,B=d/i,o=1/s,W=Math.atan(B),Y=Math.cos(W),w=Math.sin(W),a=o*(Math.abs(Y)+Math.abs(w)),h=o*(1-a+a**2),N=Math.max(Math.atan(Math.abs(w+Y)*h),Math.atan(Math.abs(w-Y)*h));let V=0,R=g;for(let X=g+2;X<C-2;X+=2){const n=Math.abs(m-G*I[X+1]+b*I[X]);n>V&&(R=X,V=n)}V>(s*N)**2?(this.#i(I,g,R+2,A),this.#i(I,R,C,A)):A.push(l,Z)}static#d(I){const g=[],C=I.length;return this.#i(I,0,C,g),g.push(I[C-2],I[C-1]),g.length<=4?null:g}static#c(I,g,C,A,l,Z){const i=new Float32Array(Z**2),d=-2*A**2,s=Z>>1;for(let W=0;W<Z;W++){const Y=(W-s)**2;for(let w=0;w<Z;w++)i[W*Z+w]=Math.exp((Y+(w-s)**2)/d)}const G=new Float32Array(256),b=-2*l**2;for(let W=0;W<256;W++)G[W]=Math.exp(W**2/b);const m=I.length,B=new Uint8Array(m),o=new Uint32Array(256);for(let W=0;W<C;W++)for(let Y=0;Y<g;Y++){const w=W*g+Y,a=I[w];let h=0,N=0;for(let R=0;R<Z;R++){const X=W+R-s;if(!(X<0||X>=C))for(let n=0;n<Z;n++){const y=Y+n-s;if(y<0||y>=g)continue;const K=I[X*g+y],e=i[R*Z+n]*G[Math.abs(K-a)];h+=K*e,N+=e}}const V=B[w]=Math.round(h/N);o[V]++}return[B,o]}static#G(I){const g=new Uint32Array(256);for(const C of I)g[C]++;return g}static#m(I){const g=I.length,C=new Uint8ClampedArray(g>>2);let A=-1/0,l=1/0;for(let i=0,d=C.length;i<d;i++){const s=C[i]=I[i<<2];A=Math.max(A,s),l=Math.min(l,s)}const Z=255/(A-l);for(let i=0,d=C.length;i<d;i++)C[i]=(C[i]-l)*Z;return C}static#s(I){let g,C=-1/0,A=-1/0;const l=I.findIndex(d=>d!==0);let Z=l,i=l;for(g=l;g<256;g++){const d=I[g];d>C&&(g-Z>A&&(A=g-Z,i=g-1),C=d,Z=g)}for(g=i-1;g>=0&&!(I[g]>I[g+1]);g--);return g}static#W(I){const g=I,{width:C,height:A}=I,{maxDim:l}=this.#I;let Z=C,i=A;if(C>l||A>l){let m=C,B=A,o=Math.log2(Math.max(C,A)/l);const W=Math.floor(o);o=o===W?W-1:W;for(let w=0;w<o;w++){Z=Math.ceil(m/2),i=Math.ceil(B/2);const a=new OffscreenCanvas(Z,i);a.getContext("2d").drawImage(I,0,0,m,B,0,0,Z,i),m=Z,B=i,I!==g&&I.close(),I=a.transferToImageBitmap()}const Y=Math.min(l/Z,l/i);Z=Math.round(Z*Y),i=Math.round(i*Y)}const s=new OffscreenCanvas(Z,i).getContext("2d",{willReadFrequently:!0});s.fillStyle="white",s.fillRect(0,0,Z,i),s.filter="grayscale(1)",s.drawImage(I,0,0,I.width,I.height,0,0,Z,i);const G=s.getImageData(0,0,Z,i).data;return[this.#m(G),Z,i]}static extractContoursFromText(I,{fontFamily:g,fontStyle:C,fontWeight:A},l,Z,i,d){let s=new OffscreenCanvas(1,1),G=s.getContext("2d",{alpha:!1});const b=200,m=G.font=`${C} ${A} ${b}px ${g}`,{actualBoundingBoxLeft:B,actualBoundingBoxRight:o,actualBoundingBoxAscent:W,actualBoundingBoxDescent:Y,fontBoundingBoxAscent:w,fontBoundingBoxDescent:a,width:h}=G.measureText(I),N=1.5,V=Math.ceil(Math.max(Math.abs(B)+Math.abs(o)||0,h)*N),R=Math.ceil(Math.max(Math.abs(W)+Math.abs(Y)||b,Math.abs(w)+Math.abs(a)||b)*N);s=new OffscreenCanvas(V,R),G=s.getContext("2d",{alpha:!0,willReadFrequently:!0}),G.font=m,G.filter="grayscale(1)",G.fillStyle="white",G.fillRect(0,0,V,R),G.fillStyle="black",G.fillText(I,V*(N-1)/2,R*(3-N)/2);const X=this.#m(G.getImageData(0,0,V,R).data),n=this.#G(X),y=this.#s(n),K=this.#l(X,V,R,y);return this.processDrawnLines({lines:{curves:K,width:V,height:R},pageWidth:l,pageHeight:Z,rotation:i,innerMargin:d,mustSmooth:!0,areContours:!0})}static process(I,g,C,A,l){const[Z,i,d]=this.#W(I),[s,G]=this.#c(Z,i,d,Math.hypot(i,d)*this.#I.sigmaSFactor,this.#I.sigmaR,this.#I.kernelSize),b=this.#s(G),m=this.#l(s,i,d,b);return this.processDrawnLines({lines:{curves:m,width:i,height:d},pageWidth:g,pageHeight:C,rotation:A,innerMargin:l,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:I,pageWidth:g,pageHeight:C,rotation:A,innerMargin:l,mustSmooth:Z,areContours:i}){A%180!==0&&([g,C]=[C,g]);const{curves:d,width:s,height:G}=I,b=I.thickness??0,m=[],B=Math.min(g/s,C/G),o=B/g,W=B/C,Y=[];for(const{points:a}of d){const h=Z?this.#d(a):a;if(!h)continue;Y.push(h);const N=h.length,V=new Float32Array(N),R=new Float32Array(3*(N===2?2:N-2));if(m.push({line:R,points:V}),N===2){V[0]=h[0]*o,V[1]=h[1]*W,R.set([NaN,NaN,NaN,NaN,V[0],V[1]],0);continue}let[X,n,y,K]=h;X*=o,n*=W,y*=o,K*=W,V.set([X,n,y,K],0),R.set([NaN,NaN,NaN,NaN,X,n],0);for(let e=4;e<N;e+=2){const T=V[e]=h[e]*o,O=V[e+1]=h[e+1]*W;R.set(H.createBezierPoints(X,n,y,K,T,O),(e-2)*3),[X,n,y,K]=[y,K,T,O]}}if(m.length===0)return null;const w=i?new yC:new Ng;return w.build(m,g,C,1,A,i?0:b,l),{outline:w,newCurves:Y,areContours:i,thickness:b,width:s,height:G}}static async compressSignature({outlines:I,areContours:g,thickness:C,width:A,height:l}){let Z=1/0,i=-1/0,d=0;for(const h of I){d+=h.length;for(let N=2,V=h.length;N<V;N++){const R=h[N]-h[N-2];Z=Math.min(Z,R),i=Math.max(i,R)}}let s;Z>=-128&&i<=127?s=Int8Array:Z>=-32768&&i<=32767?s=Int16Array:s=Int32Array;const G=I.length,b=Ug+Rg*G,m=new Uint32Array(b);let B=0;m[B++]=b*Uint32Array.BYTES_PER_ELEMENT+(d-2*G)*s.BYTES_PER_ELEMENT,m[B++]=0,m[B++]=A,m[B++]=l,m[B++]=g?0:1,m[B++]=Math.max(0,Math.floor(C??0)),m[B++]=G,m[B++]=s.BYTES_PER_ELEMENT;for(const h of I)m[B++]=h.length-2,m[B++]=h[0],m[B++]=h[1];const o=new CompressionStream("deflate-raw"),W=o.writable.getWriter();await W.ready,W.write(m);const Y=s.prototype.constructor;for(const h of I){const N=new Y(h.length-2);for(let V=2,R=h.length;V<R;V++)N[V-2]=h[V]-h[V-2];W.write(N)}W.close();const w=await new Response(o.readable).arrayBuffer(),a=new Uint8Array(w);return kC(a)}static async decompressSignature(I){try{const g=rA(I),{readable:C,writable:A}=new DecompressionStream("deflate-raw"),l=A.getWriter();await l.ready,l.write(g).then(async()=>{await l.ready,await l.close()}).catch(()=>{});let Z=null,i=0;for await(const h of C)Z||=new Uint8Array(new Uint32Array(h.buffer,0,4)[0]),Z.set(h,i),i+=h.length;const d=new Uint32Array(Z.buffer,0,Z.length>>2),s=d[1];if(s!==0)throw new Error(`Invalid version: ${s}`);const G=d[2],b=d[3],m=d[4]===0,B=d[5],o=d[6],W=d[7],Y=[],w=(Ug+Rg*o)*Uint32Array.BYTES_PER_ELEMENT;let a;switch(W){case Int8Array.BYTES_PER_ELEMENT:a=new Int8Array(Z.buffer,w);break;case Int16Array.BYTES_PER_ELEMENT:a=new Int16Array(Z.buffer,w);break;case Int32Array.BYTES_PER_ELEMENT:a=new Int32Array(Z.buffer,w);break}i=0;for(let h=0;h<o;h++){const N=d[Rg*h+Ug],V=new Float32Array(N+2);Y.push(V);for(let R=0;R<Rg-1;R++)V[R]=d[Rg*h+Ug+R+1];for(let R=0;R<N;R++)V[R+2]=V[R]+a[i++]}return{areContours:m,thickness:B,outlines:Y,width:G,height:b}}catch(g){return F(`decompressSignature: ${g}`),null}}}class HC extends uA{constructor(){super(),super.updateProperties({fill:D._defaultLineColor,"stroke-width":0})}clone(){const I=new HC;return I.updateAll(this),I}}class MC extends Og{constructor(I){super(I),super.updateProperties({stroke:D._defaultLineColor,"stroke-width":1})}clone(){const I=new MC(this._viewParameters);return I.updateAll(this),I}}class MI extends S{#I=!1;#g=null;#C=null;#A=null;static _type="signature";static _editorType=p.SIGNATURE;static _defaultDrawingOptions=null;constructor(I){super({...I,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#C=I.signatureData||null,this.#g=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(I,g){D.initialize(I,g),this._defaultDrawingOptions=new HC,this._defaultDrawnSignatureOptions=new MC(g.viewParameters)}static getDefaultDrawingOptions(I){const g=this._defaultDrawingOptions.clone();return g.updateProperties(I),g}static get supportMultipleDrawings(){return!1}static get typesMap(){return J(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#g}}static computeTelemetryFinalData(I){const g=I.get("hasDescription");return{hasAltText:g.get(!0)??0,hasNoAltText:g.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let I,g;const{_isCopy:C}=this;if(C&&(this._isCopy=!1,I=this.x,g=this.y),super.render(),this._drawId===null)if(this.#C){const{lines:A,mustSmooth:l,areContours:Z,description:i,uuid:d,heightInPage:s}=this.#C,{rawDims:{pageWidth:G,pageHeight:b},rotation:m}=this.parent.viewport,B=Ag.processDrawnLines({lines:A,pageWidth:G,pageHeight:b,rotation:m,innerMargin:MI._INNER_MARGIN,mustSmooth:l,areContours:Z});this.addSignature(B,s,i,d)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#g||""}));return C&&(this._isCopy=!0,this._moveAfterPaste(I,g)),this.div}setUuid(I){this.#A=I,this.addEditToolbar()}getUuid(){return this.#A}get description(){return this.#g}set description(I){this.#g=I,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:I})),super.addEditToolbar().then(g=>{g?.updateEditSignatureButton(I)}))}getSignaturePreview(){const{newCurves:I,areContours:g,thickness:C,width:A,height:l}=this.#C,Z=Math.max(A,l),i=Ag.processDrawnLines({lines:{curves:I.map(d=>({points:d})),thickness:C,width:A,height:l},pageWidth:Z,pageHeight:Z,rotation:0,innerMargin:0,mustSmooth:!1,areContours:g});return{areContours:g,outline:i.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(I,g,C,A){const{x:l,y:Z}=this,{outline:i}=this.#C=I;this.#I=i instanceof yC,this.description=C;let d;this.#I?d=MI.getDefaultDrawingOptions():(d=MI._defaultDrawnSignatureOptions.clone(),d.updateProperties({"stroke-width":i.thickness})),this._addOutlines({drawOutlines:i,drawingOptions:d});const[s,G]=this.parentDimensions,[,b]=this.pageDimensions;let m=g/b;m=m>=1?.5:m,this.width*=m/this.height,this.width>=1&&(m*=.9/this.width,this.width=.9),this.height=m,this.setDims(s*this.width,G*this.height),this.x=l,this.y=Z,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(A),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!A,hasDescription:!!C}}),this.div.hidden=!1}getFromImage(I){const{rawDims:{pageWidth:g,pageHeight:C},rotation:A}=this.parent.viewport;return Ag.process(I,g,C,A,MI._INNER_MARGIN)}getFromText(I,g){const{rawDims:{pageWidth:C,pageHeight:A},rotation:l}=this.parent.viewport;return Ag.extractContoursFromText(I,g,C,A,l,MI._INNER_MARGIN)}getDrawnSignature(I){const{rawDims:{pageWidth:g,pageHeight:C},rotation:A}=this.parent.viewport;return Ag.processDrawnLines({lines:I,pageWidth:g,pageHeight:C,rotation:A,innerMargin:MI._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:I,thickness:g}){I?this._drawingOptions=MI.getDefaultDrawingOptions():(this._drawingOptions=MI._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":g}))}serialize(I=!1){if(this.isEmpty())return null;const{lines:g,points:C,rect:A}=this.serializeDraw(I),{_drawingOptions:{"stroke-width":l}}=this,Z={annotationType:p.SIGNATURE,isSignature:!0,areContours:this.#I,color:[0,0,0],thickness:this.#I?0:l,pageIndex:this.pageIndex,rect:A,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(Z),I?(Z.paths={lines:g,points:C},Z.uuid=this.#A,Z.isCopy=!0):Z.lines=g,this.#g&&(Z.accessibilityData={type:"Figure",alt:this.#g}),Z}static deserializeDraw(I,g,C,A,l,Z){return Z.areContours?yC.deserialize(I,g,C,A,l,Z):Ng.deserialize(I,g,C,A,l,Z)}static async deserialize(I,g,C){const A=await super.deserialize(I,g,C);return A.#I=I.areContours,A.description=I.accessibilityData?.alt||"",A.#A=I.uuid,A}}class yZ extends D{#I=null;#g=null;#C=null;#A=null;#Z=null;#l="";#i=null;#d=!1;#c=null;#G=!1;#m=!1;static _type="stamp";static _editorType=p.STAMP;constructor(I){super({...I,name:"stampEditor"}),this.#A=I.bitmapUrl,this.#Z=I.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(I,g){D.initialize(I,g)}static isHandlingMimeForPasting(I){return AC.includes(I)}static paste(I,g){g.pasteEditor({mode:p.STAMP},{bitmapFile:I.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(I){const g=I.get("hasAltText");return{hasAltText:g.get(!0)??0,hasNoAltText:g.get(!1)??0}}#s(I,g=!1){if(!I){this.remove();return}this.#I=I.bitmap,g||(this.#g=I.id,this.#G=I.isSvg),I.file&&(this.#l=I.file.name),this.#B()}#W(){if(this.#C=null,this._uiManager.enableWaiting(!1),!!this.#i){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#I){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#I){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(I=null,g=!0){if(this.hasAltTextData())return null;const{mlManager:C}=this._uiManager;if(!C)throw new Error("No ML.");if(!await C.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:A,width:l,height:Z}=I||this.copyCanvas(null,null,!0).imageData,i=await C.guess({name:"altText",request:{data:A,width:l,height:Z,channels:A.length/(l*Z)}});if(!i)throw new Error("No response from the AI service.");if(i.error)throw new Error("Error from the AI service.");if(i.cancel)return null;if(!i.output)throw new Error("No valid response from the AI service.");const d=i.output;return await this.setGuessedAltText(d),g&&!this.hasAltTextData()&&(this.altTextData={alt:d,decorative:!1}),d}#w(){if(this.#g){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#g).then(C=>this.#s(C,!0)).finally(()=>this.#W());return}if(this.#A){const C=this.#A;this.#A=null,this._uiManager.enableWaiting(!0),this.#C=this._uiManager.imageManager.getFromUrl(C).then(A=>this.#s(A)).finally(()=>this.#W());return}if(this.#Z){const C=this.#Z;this.#Z=null,this._uiManager.enableWaiting(!0),this.#C=this._uiManager.imageManager.getFromFile(C).then(A=>this.#s(A)).finally(()=>this.#W());return}const I=document.createElement("input");I.type="file",I.accept=AC.join(",");const g=this._uiManager._signal;this.#C=new Promise(C=>{I.addEventListener("change",async()=>{if(!I.files||I.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const A=await this._uiManager.imageManager.getFromFile(I.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#s(A)}C()},{signal:g}),I.addEventListener("cancel",()=>{this.remove(),C()},{signal:g})}).finally(()=>this.#W()),I.click()}remove(){this.#g&&(this.#I=null,this._uiManager.imageManager.deleteId(this.#g),this.#i?.remove(),this.#i=null,this.#c&&(clearTimeout(this.#c),this.#c=null)),super.remove()}rebuild(){if(!this.parent){this.#g&&this.#w();return}super.rebuild(),this.div!==null&&(this.#g&&this.#i===null&&this.#w(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(I){this._isDraggable=!0,I&&this.div.focus()}isEmpty(){return!(this.#C||this.#I||this.#A||this.#Z||this.#g||this.#d)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let I,g;return this._isCopy&&(I=this.x,g=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#d||(this.#I?this.#B():this.#w()),this._isCopy&&this._moveAfterPaste(I,g),this._uiManager.addShouldRescale(this),this.div}setCanvas(I,g){const{id:C,bitmap:A}=this._uiManager.imageManager.getFromCanvas(I,g);g.remove(),C&&this._uiManager.imageManager.isValidId(C)&&(this.#g=C,A&&(this.#I=A),this.#d=!1,this.#B())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#c!==null&&clearTimeout(this.#c);const I=200;this.#c=setTimeout(()=>{this.#c=null,this.#o()},I)}#B(){const{div:I}=this;let{width:g,height:C}=this.#I;const[A,l]=this.pageDimensions,Z=.75;if(this.width)g=this.width*A,C=this.height*l;else if(g>Z*A||C>Z*l){const G=Math.min(Z*A/g,Z*l/C);g*=G,C*=G}const[i,d]=this.parentDimensions;this.setDims(g*i/A,C*d/l),this._uiManager.enableWaiting(!1);const s=this.#i=document.createElement("canvas");s.setAttribute("role","img"),this.addContainer(s),this.width=g/A,this.height=C/l,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(I.hidden=!1),this.#o(),this.#m||(this.parent.addUndoableEditor(this),this.#m=!0),this._reportTelemetry({action:"inserted_image"}),this.#l&&this.div.setAttribute("aria-description",this.#l),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(I,g,C=!1){I||(I=224);const{width:A,height:l}=this.#I,Z=new nI;let i=this.#I,d=A,s=l,G=null;if(g){if(A>g||l>g){const R=Math.min(g/A,g/l);d=Math.floor(A*R),s=Math.floor(l*R)}G=document.createElement("canvas");const m=G.width=Math.ceil(d*Z.sx),B=G.height=Math.ceil(s*Z.sy);this.#G||(i=this.#b(m,B));const o=G.getContext("2d");o.filter=this._uiManager.hcmFilter;let W="white",Y="#cfcfd8";this._uiManager.hcmFilter!=="none"?Y="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(W="#8f8f9d",Y="#42414d");const w=15,a=w*Z.sx,h=w*Z.sy,N=new OffscreenCanvas(a*2,h*2),V=N.getContext("2d");V.fillStyle=W,V.fillRect(0,0,a*2,h*2),V.fillStyle=Y,V.fillRect(0,0,a,h),V.fillRect(a,h,a,h),o.fillStyle=o.createPattern(N,"repeat"),o.fillRect(0,0,m,B),o.drawImage(i,0,0,i.width,i.height,0,0,m,B)}let b=null;if(C){let m,B;if(Z.symmetric&&i.width<I&&i.height<I)m=i.width,B=i.height;else if(i=this.#I,A>I||l>I){const Y=Math.min(I/A,I/l);m=Math.floor(A*Y),B=Math.floor(l*Y),this.#G||(i=this.#b(m,B))}const W=new OffscreenCanvas(m,B).getContext("2d",{willReadFrequently:!0});W.drawImage(i,0,0,i.width,i.height,0,0,m,B),b={width:m,height:B,data:W.getImageData(0,0,m,B).data}}return{canvas:G,width:d,height:s,imageData:b}}#b(I,g){const{width:C,height:A}=this.#I;let l=C,Z=A,i=this.#I;for(;l>2*I||Z>2*g;){const d=l,s=Z;l>2*I&&(l=l>=16384?Math.floor(l/2)-1:Math.ceil(l/2)),Z>2*g&&(Z=Z>=16384?Math.floor(Z/2)-1:Math.ceil(Z/2));const G=new OffscreenCanvas(l,Z);G.getContext("2d").drawImage(i,0,0,d,s,0,0,l,Z),i=G.transferToImageBitmap()}return i}#o(){const[I,g]=this.parentDimensions,{width:C,height:A}=this,l=new nI,Z=Math.ceil(C*I*l.sx),i=Math.ceil(A*g*l.sy),d=this.#i;if(!d||d.width===Z&&d.height===i)return;d.width=Z,d.height=i;const s=this.#G?this.#I:this.#b(Z,i),G=d.getContext("2d");G.filter=this._uiManager.hcmFilter,G.drawImage(s,0,0,s.width,s.height,0,0,Z,i)}#a(I){if(I){if(this.#G){const A=this._uiManager.imageManager.getSvgUrl(this.#g);if(A)return A}const g=document.createElement("canvas");return{width:g.width,height:g.height}=this.#I,g.getContext("2d").drawImage(this.#I,0,0),g.toDataURL()}if(this.#G){const[g,C]=this.pageDimensions,A=Math.round(this.width*g*_I.PDF_TO_CSS_UNITS),l=Math.round(this.height*C*_I.PDF_TO_CSS_UNITS),Z=new OffscreenCanvas(A,l);return Z.getContext("2d").drawImage(this.#I,0,0,this.#I.width,this.#I.height,0,0,A,l),Z.transferToImageBitmap()}return structuredClone(this.#I)}static async deserialize(I,g,C){let A=null,l=!1;if(I instanceof HA){const{data:{rect:W,rotation:Y,id:w,structParent:a,popupRef:h,contentsObj:N},container:V,parent:{page:{pageNumber:R}},canvas:X}=I;let n,y;X?(delete I.canvas,{id:n,bitmap:y}=C.imageManager.getFromCanvas(V.id,X),X.remove()):(l=!0,I._hasNoCanvas=!0);const K=(await g._structTree.getAriaAttributes(`${$g}${w}`))?.get("aria-label")||"";A=I={annotationType:p.STAMP,bitmapId:n,bitmap:y,pageIndex:R-1,rect:W.slice(0),rotation:Y,annotationElementId:w,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:K},isSvg:!1,structParent:a,popupRef:h,comment:N?.str||null}}const Z=await super.deserialize(I,g,C),{rect:i,bitmap:d,bitmapUrl:s,bitmapId:G,isSvg:b,accessibilityData:m}=I;l?(C.addMissingCanvas(I.id,Z),Z.#d=!0):G&&C.imageManager.isValidId(G)?(Z.#g=G,d&&(Z.#I=d)):Z.#A=s,Z.#G=b;const[B,o]=Z.pageDimensions;return Z.width=(i[2]-i[0])/B,Z.height=(i[3]-i[1])/o,m&&(Z.altTextData=m),Z._initialData=A,I.comment&&Z.setCommentData(I.comment),Z.#m=!!A,Z}serialize(I=!1,g=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const C={annotationType:p.STAMP,bitmapId:this.#g,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#G,structTreeParentId:this._structTreeParentId};if(this.addComment(C),I)return C.bitmapUrl=this.#a(!0),C.accessibilityData=this.serializeAltText(!0),C.isCopy=!0,C;const{decorative:A,altText:l}=this.serializeAltText(!1);if(!A&&l&&(C.accessibilityData={type:"Figure",alt:l}),this.annotationElementId){const i=this.#Y(C);if(i.isSame)return null;i.isSameAltText?delete C.accessibilityData:C.accessibilityData.structParent=this._initialData.structParent??-1}if(C.id=this.annotationElementId,g===null)return C;g.stamps||=new Map;const Z=this.#G?(C.rect[2]-C.rect[0])*(C.rect[3]-C.rect[1]):null;if(!g.stamps.has(this.#g))g.stamps.set(this.#g,{area:Z,serialized:C}),C.bitmap=this.#a(!1);else if(this.#G){const i=g.stamps.get(this.#g);Z>i.area&&(i.area=Z,i.serialized.bitmap.close(),i.serialized.bitmap=this.#a(!1))}return C}#Y(I){const{pageIndex:g,accessibilityData:{altText:C}}=this._initialData,A=I.pageIndex===g,l=(I.accessibilityData?.alt||"")===C;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&A&&l,isSameAltText:l}}renderAnnotationElement(I){const g={rect:this.getRect(0,0)};return this.hasEditedComment&&(g.popup=this.comment),I.updateEdited(g),null}}class KI{#I;#g=!1;#C=null;#A=null;#Z=null;#l=new Map;#i=!1;#d=!1;#c=!1;#G=null;#m=null;#s=null;#W=null;#w=null;#B=-1;#b;static _initialized=!1;static#o=new Map([CI,nC,yZ,P,MI].map(I=>[I._editorType,I]));constructor({uiManager:I,pageIndex:g,div:C,structTreeLayer:A,accessibilityManager:l,annotationLayer:Z,drawLayer:i,textLayer:d,viewport:s,l10n:G}){const b=[...KI.#o.values()];if(!KI._initialized){KI._initialized=!0;for(const m of b)m.initialize(G,I)}I.registerEditorTypes(b),this.#b=I,this.pageIndex=g,this.div=C,this.#I=l,this.#C=Z,this.viewport=s,this.#s=d,this.drawLayer=i,this._structTree=A,this.#b.addLayer(this)}get isEmpty(){return this.#l.size===0}get isInvisible(){return this.isEmpty&&this.#b.getMode()===p.NONE}updateToolbar(I){this.#b.updateToolbar(I)}updateMode(I=this.#b.getMode()){switch(this.#h(),I){case p.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case p.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case p.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:g}=this.div;for(const C of KI.#o.values())g.toggle(`${C._type}Editing`,I===C._editorType);this.div.hidden=!1}hasTextLayer(I){return I===this.#s?.div}setEditingState(I){this.#b.setEditingState(I)}addCommands(I){this.#b.addCommands(I)}cleanUndoStack(I){this.#b.cleanUndoStack(I)}toggleDrawing(I=!1){this.div.classList.toggle("drawing",!I)}togglePointerEvents(I=!1){this.div.classList.toggle("disabled",!I)}toggleAnnotationLayerPointerEvents(I=!1){this.#C?.div.classList.toggle("disabled",!I)}async enable(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.#w?.abort(),this.#w=null;const I=new Set;for(const C of this.#l.values())C.enableEditing(),C.show(!0),C.annotationElementId&&(this.#b.removeChangedExistingAnnotation(C),I.add(C.annotationElementId));if(!this.#C){this.#c=!1;return}const g=this.#C.getEditableAnnotations();for(const C of g){if(C.hide(),this.#b.isDeletedAnnotationElement(C.data.id)||I.has(C.data.id))continue;const A=await this.deserialize(C);A&&(this.addOrRebuild(A),A.enableEditing())}this.#c=!1}disable(){if(this.#d=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.#s&&!this.#w){this.#w=new AbortController;const A=this.#b.combinedSignal(this.#w);this.#s.div.addEventListener("pointerdown",l=>{const{clientX:i,clientY:d,timeStamp:s}=l,G=this.#B;if(s-G>500){this.#B=s;return}this.#B=-1;const{classList:b}=this.div;b.toggle("getElements",!0);const m=document.elementsFromPoint(i,d);if(b.toggle("getElements",!1),!this.div.contains(m[0]))return;let B;const o=new RegExp(`^${DC}[0-9]+$`);for(const Y of m)if(o.test(Y.id)){B=Y.id;break}if(!B)return;const W=this.#l.get(B);W?.annotationElementId===null&&(l.stopPropagation(),l.preventDefault(),W.dblclick())},{signal:A,capture:!0})}const I=new Map,g=new Map;for(const A of this.#l.values())if(A.disableEditing(),!!A.annotationElementId){if(A.serialize()!==null){I.set(A.annotationElementId,A);continue}else g.set(A.annotationElementId,A);this.getEditableAnnotation(A.annotationElementId)?.show(),A.remove()}if(this.#C){const A=this.#C.getEditableAnnotations();for(const l of A){const{id:Z}=l.data;if(this.#b.isDeletedAnnotationElement(Z)){l.updateEdited({deleted:!0});continue}let i=g.get(Z);if(i){i.resetAnnotationElement(l),i.show(!1),l.show();continue}i=I.get(Z),i&&(this.#b.addChangedExistingAnnotation(i),i.renderAnnotationElement(l)&&i.show(!1)),l.show()}}this.#h(),this.isEmpty&&(this.div.hidden=!0);const{classList:C}=this.div;for(const A of KI.#o.values())C.remove(`${A._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#d=!1}getEditableAnnotation(I){return this.#C?.getEditableAnnotation(I)||null}setActiveEditor(I){this.#b.getActive()!==I&&this.#b.setActiveEditor(I)}enableTextSelection(){if(this.div.tabIndex=-1,this.#s?.div&&!this.#W){this.#W=new AbortController;const I=this.#b.combinedSignal(this.#W);this.#s.div.addEventListener("pointerdown",this.#a.bind(this),{signal:I}),this.#s.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#s?.div&&this.#W&&(this.#W.abort(),this.#W=null,this.#s.div.classList.remove("highlighting"))}#a(I){this.#b.unselectAll();const{target:g}=I;if(g===this.#s.div||(g.getAttribute("role")==="img"||g.classList.contains("endOfContent"))&&this.#s.div.contains(g)){const{isMac:C}=ZI.platform;if(I.button!==0||I.ctrlKey&&C)return;this.#b.showAllEditors("highlight",!0,!0),this.#s.div.classList.add("free"),this.toggleDrawing(),P.startHighlighting(this,this.#b.direction==="ltr",{target:this.#s.div,x:I.x,y:I.y}),this.#s.div.addEventListener("pointerup",()=>{this.#s.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#b._signal}),I.preventDefault()}}enableClick(){if(this.#A)return;this.#A=new AbortController;const I=this.#b.combinedSignal(this.#A);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:I});const g=this.pointerup.bind(this);this.div.addEventListener("pointerup",g,{signal:I}),this.div.addEventListener("pointercancel",g,{signal:I})}disableClick(){this.#A?.abort(),this.#A=null}attach(I){this.#l.set(I.id,I);const{annotationElementId:g}=I;g&&this.#b.isDeletedAnnotationElement(g)&&this.#b.removeDeletedAnnotationElement(I)}detach(I){this.#l.delete(I.id),this.#I?.removePointerInTextLayer(I.contentDiv),!this.#d&&I.annotationElementId&&this.#b.addDeletedAnnotationElement(I)}remove(I){this.detach(I),this.#b.removeEditor(I),I.div.remove(),I.isAttachedToDOM=!1}changeParent(I){I.parent!==this&&(I.parent&&I.annotationElementId&&(this.#b.addDeletedAnnotationElement(I.annotationElementId),D.deleteAnnotationElement(I),I.annotationElementId=null),this.attach(I),I.parent?.detach(I),I.setParent(this),I.div&&I.isAttachedToDOM&&(I.div.remove(),this.div.append(I.div)))}add(I){if(!(I.parent===this&&I.isAttachedToDOM)){if(this.changeParent(I),this.#b.addEditor(I),this.attach(I),!I.isAttachedToDOM){const g=I.render();this.div.append(g),I.isAttachedToDOM=!0}I.fixAndSetPosition(),I.onceAdded(!this.#c),this.#b.addToAnnotationStorage(I),I._reportTelemetry(I.telemetryInitialData)}}moveEditorInDOM(I){if(!I.isAttachedToDOM)return;const{activeElement:g}=document;I.div.contains(g)&&!this.#Z&&(I._focusEventsAllowed=!1,this.#Z=setTimeout(()=>{this.#Z=null,I.div.contains(document.activeElement)?I._focusEventsAllowed=!0:(I.div.addEventListener("focusin",()=>{I._focusEventsAllowed=!0},{once:!0,signal:this.#b._signal}),g.focus())},0)),I._structTreeParentId=this.#I?.moveElementInDOM(this.div,I.div,I.contentDiv,!0)}addOrRebuild(I){I.needsToBeRebuilt()?(I.parent||=this,I.rebuild(),I.show()):this.add(I)}addUndoableEditor(I){const g=()=>I._uiManager.rebuild(I),C=()=>{I.remove()};this.addCommands({cmd:g,undo:C,mustExec:!1})}getNextId(){return this.#b.getId()}get#Y(){return KI.#o.get(this.#b.getMode())}combinedSignal(I){return this.#b.combinedSignal(I)}#N(I){const g=this.#Y;return g?new g.prototype.constructor(I):null}canCreateNewEmptyEditor(){return this.#Y?.canCreateNewEmptyEditor()}async pasteEditor(I,g){this.updateToolbar(I),await this.#b.updateMode(I.mode);const{offsetX:C,offsetY:A}=this.#R(),l=this.getNextId(),Z=this.#N({parent:this,id:l,x:C,y:A,uiManager:this.#b,isCentered:!0,...g});Z&&this.add(Z)}async deserialize(I){return await KI.#o.get(I.annotationType??I.annotationEditorType)?.deserialize(I,this,this.#b)||null}createAndAddNewEditor(I,g,C={}){const A=this.getNextId(),l=this.#N({parent:this,id:A,x:I.offsetX,y:I.offsetY,uiManager:this.#b,isCentered:g,...C});return l&&this.add(l),l}#R(){const{x:I,y:g,width:C,height:A}=this.div.getBoundingClientRect(),l=Math.max(0,I),Z=Math.max(0,g),i=Math.min(window.innerWidth,I+C),d=Math.min(window.innerHeight,g+A),s=(l+i)/2-I,G=(Z+d)/2-g,[b,m]=this.viewport.rotation%180===0?[s,G]:[G,s];return{offsetX:b,offsetY:m}}addNewEditor(I={}){this.createAndAddNewEditor(this.#R(),!0,I)}setSelected(I){this.#b.setSelected(I)}toggleSelected(I){this.#b.toggleSelected(I)}unselect(I){this.#b.unselect(I)}pointerup(I){const{isMac:g}=ZI.platform;if(I.button!==0||I.ctrlKey&&g||I.target!==this.div||!this.#i||(this.#i=!1,this.#Y?.isDrawer&&this.#Y.supportMultipleDrawings))return;if(!this.#g){this.#g=!0;return}const C=this.#b.getMode();if(C===p.STAMP||C===p.SIGNATURE){this.#b.unselectAll();return}this.createAndAddNewEditor(I,!1)}pointerdown(I){if(this.#b.getMode()===p.HIGHLIGHT&&this.enableTextSelection(),this.#i){this.#i=!1;return}const{isMac:g}=ZI.platform;if(I.button!==0||I.ctrlKey&&g||I.target!==this.div)return;if(this.#i=!0,this.#Y?.isDrawer){this.startDrawingSession(I);return}const C=this.#b.getActive();this.#g=!C||C.isEmpty()}startDrawingSession(I){if(this.div.focus({preventScroll:!0}),this.#G){this.#Y.startDrawing(this,this.#b,!1,I);return}this.#b.setCurrentDrawingSession(this),this.#G=new AbortController;const g=this.#b.combinedSignal(this.#G);this.div.addEventListener("blur",({relatedTarget:C})=>{C&&!this.div.contains(C)&&(this.#m=null,this.commitOrRemove())},{signal:g}),this.#Y.startDrawing(this,this.#b,!1,I)}pause(I){if(I){const{activeElement:g}=document;this.div.contains(g)&&(this.#m=g);return}this.#m&&setTimeout(()=>{this.#m?.focus(),this.#m=null},0)}endDrawingSession(I=!1){return this.#G?(this.#b.setCurrentDrawingSession(null),this.#G.abort(),this.#G=null,this.#m=null,this.#Y.endDrawing(I)):null}findNewParent(I,g,C){const A=this.#b.findParent(g,C);return A===null||A===this?!1:(A.changeParent(I),!0)}commitOrRemove(){return this.#G?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#G&&this.#Y.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#b.getActive()?.parent===this&&(this.#b.commitOrRemove(),this.#b.setActiveEditor(null)),this.#Z&&(clearTimeout(this.#Z),this.#Z=null);for(const I of this.#l.values())this.#I?.removePointerInTextLayer(I.contentDiv),I.setParent(null),I.isAttachedToDOM=!1,I.div.remove();this.div=null,this.#l.clear(),this.#b.removeLayer(this)}#h(){for(const I of this.#l.values())I.isEmpty()&&I.remove()}render({viewport:I}){this.viewport=I,jI(this.div,I);for(const g of this.#b.getEditors(this.pageIndex))this.add(g),g.rebuild();this.updateMode()}update({viewport:I}){this.#b.commitOrRemove(),this.#h();const g=this.viewport.rotation,C=I.rotation;if(this.viewport=I,jI(this.div,{rotation:C}),g!==C)for(const A of this.#l.values())A.rotate(C)}get pageDimensions(){const{pageWidth:I,pageHeight:g}=this.viewport.rawDims;return[I,g]}get scale(){return this.#b.viewParameters.realScale}}class dI{#I=null;#g=new Map;#C=new Map;static#A=0;constructor({pageIndex:I}){this.pageIndex=I}setParent(I){if(!this.#I){this.#I=I;return}if(this.#I!==I){if(this.#g.size>0)for(const g of this.#g.values())g.remove(),I.append(g);this.#I=I}}static get _svgFactory(){return J(this,"_svgFactory",new Qg)}static#Z(I,[g,C,A,l]){const{style:Z}=I;Z.top=`${100*C}%`,Z.left=`${100*g}%`,Z.width=`${100*A}%`,Z.height=`${100*l}%`}#l(){const I=dI._svgFactory.create(1,1,!0);return this.#I.append(I),I.setAttribute("aria-hidden",!0),I}#i(I,g){const C=dI._svgFactory.createElement("clipPath");I.append(C);const A=`clip_${g}`;C.setAttribute("id",A),C.setAttribute("clipPathUnits","objectBoundingBox");const l=dI._svgFactory.createElement("use");return C.append(l),l.setAttribute("href",`#${g}`),l.classList.add("clip"),A}#d(I,g){for(const[C,A]of Object.entries(g))A===null?I.removeAttribute(C):I.setAttribute(C,A)}draw(I,g=!1,C=!1){const A=dI.#A++,l=this.#l(),Z=dI._svgFactory.createElement("defs");l.append(Z);const i=dI._svgFactory.createElement("path");Z.append(i);const d=`path_p${this.pageIndex}_${A}`;i.setAttribute("id",d),i.setAttribute("vector-effect","non-scaling-stroke"),g&&this.#C.set(A,i);const s=C?this.#i(Z,d):null,G=dI._svgFactory.createElement("use");return l.append(G),G.setAttribute("href",`#${d}`),this.updateProperties(l,I),this.#g.set(A,l),{id:A,clipPathId:`url(#${s})`}}drawOutline(I,g){const C=dI.#A++,A=this.#l(),l=dI._svgFactory.createElement("defs");A.append(l);const Z=dI._svgFactory.createElement("path");l.append(Z);const i=`path_p${this.pageIndex}_${C}`;Z.setAttribute("id",i),Z.setAttribute("vector-effect","non-scaling-stroke");let d;if(g){const b=dI._svgFactory.createElement("mask");l.append(b),d=`mask_p${this.pageIndex}_${C}`,b.setAttribute("id",d),b.setAttribute("maskUnits","objectBoundingBox");const m=dI._svgFactory.createElement("rect");b.append(m),m.setAttribute("width","1"),m.setAttribute("height","1"),m.setAttribute("fill","white");const B=dI._svgFactory.createElement("use");b.append(B),B.setAttribute("href",`#${i}`),B.setAttribute("stroke","none"),B.setAttribute("fill","black"),B.setAttribute("fill-rule","nonzero"),B.classList.add("mask")}const s=dI._svgFactory.createElement("use");A.append(s),s.setAttribute("href",`#${i}`),d&&s.setAttribute("mask",`url(#${d})`);const G=s.cloneNode();return A.append(G),s.classList.add("mainOutline"),G.classList.add("secondaryOutline"),this.updateProperties(A,I),this.#g.set(C,A),C}finalizeDraw(I,g){this.#C.delete(I),this.updateProperties(I,g)}updateProperties(I,g){if(!g)return;const{root:C,bbox:A,rootClass:l,path:Z}=g,i=typeof I=="number"?this.#g.get(I):I;if(i){if(C&&this.#d(i,C),A&&dI.#Z(i,A),l){const{classList:d}=i;for(const[s,G]of Object.entries(l))d.toggle(s,G)}if(Z){const s=i.firstChild.firstChild;this.#d(s,Z)}}}updateParent(I,g){if(g===this)return;const C=this.#g.get(I);C&&(g.#I.append(C),this.#g.delete(I),g.#g.set(I,C))}remove(I){this.#C.delete(I),this.#I!==null&&(this.#g.get(I).remove(),this.#g.delete(I))}destroy(){this.#I=null;for(const I of this.#g.values())I.remove();this.#g.clear(),this.#C.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:RC},globalThis.pdfjsLib={AbortException:zI,AnnotationEditorLayer:KI,AnnotationEditorParamsType:k,AnnotationEditorType:p,AnnotationEditorUIManager:JI,AnnotationLayer:NC,AnnotationMode:FI,AnnotationType:q,build:CZ,ColorPicker:VI,createValidAbsoluteUrl:KC,DOMSVGFactory:Qg,DrawLayer:dI,FeatureTest:ZI,fetchData:sg,getDocument:wA,getFilenameFromUrl:EA,getPdfFilenameFromUrl:PA,getRGB:Sg,getUuid:JC,getXfaPageViewport:_A,GlobalWorkerOptions:Ig,ImageKind:yg,InvalidPDFException:fg,isDataScheme:Kg,isPdfFile:gC,isValidExplicitDest:sl,MathClamp:GI,noContextMenu:hI,normalizeUnicode:xA,OPS:Mg,OutputScale:nI,PasswordResponses:zA,PDFDataRangeTransport:YA,PDFDateString:CC,PDFWorker:hg,PermissionFlag:FA,PixelsPerInch:_I,RenderingCancelledException:IC,ResponseException:Dg,setLayerDimensions:jI,shadow:J,SignatureExtractor:Ag,stopEvent:II,SupportedImageMimeTypes:AC,TextLayer:cI,TouchManager:Fg,updateUrlHash:SC,Util:t,VerbosityLevel:Hg,version:gZ,XfaLayer:VA};const HZ="data:text/javascript;base64,LyoqCiAqIEBsaWNzdGFydCBUaGUgZm9sbG93aW5nIGlzIHRoZSBlbnRpcmUgbGljZW5zZSBub3RpY2UgZm9yIHRoZQogKiBKYXZhU2NyaXB0IGNvZGUgaW4gdGhpcyBwYWdlCiAqCiAqIENvcHlyaWdodCAyMDI0IE1vemlsbGEgRm91bmRhdGlvbgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKgogKiBAbGljZW5kIFRoZSBhYm92ZSBpcyB0aGUgZW50aXJlIGxpY2Vuc2Ugbm90aWNlIGZvciB0aGUKICogSmF2YVNjcmlwdCBjb2RlIGluIHRoaXMgcGFnZQogKi8KCi8qKgogKiBwZGZqc1ZlcnNpb24gPSA1LjQuNTQKICogcGRmanNCdWlsZCA9IDI5NWZiM2VjNAogKi8KCjsvLyAuL3NyYy9zaGFyZWQvdXRpbC5qcwpjb25zdCBpc05vZGVKUyA9IHR5cGVvZiBwcm9jZXNzID09PSAib2JqZWN0IiAmJiBwcm9jZXNzICsgIiIgPT09ICJbb2JqZWN0IHByb2Nlc3NdIiAmJiAhcHJvY2Vzcy52ZXJzaW9ucy5udyAmJiAhKHByb2Nlc3MudmVyc2lvbnMuZWxlY3Ryb24gJiYgcHJvY2Vzcy50eXBlICYmIHByb2Nlc3MudHlwZSAhPT0gImJyb3dzZXIiKTsKY29uc3QgRk9OVF9JREVOVElUWV9NQVRSSVggPSBbMC4wMDEsIDAsIDAsIDAuMDAxLCAwLCAwXTsKY29uc3QgTElORV9GQUNUT1IgPSAxLjM1Owpjb25zdCBMSU5FX0RFU0NFTlRfRkFDVE9SID0gMC4zNTsKY29uc3QgQkFTRUxJTkVfRkFDVE9SID0gTElORV9ERVNDRU5UX0ZBQ1RPUiAvIExJTkVfRkFDVE9SOwpjb25zdCBSZW5kZXJpbmdJbnRlbnRGbGFnID0gewogIEFOWTogMHgwMSwKICBESVNQTEFZOiAweDAyLAogIFBSSU5UOiAweDA0LAogIFNBVkU6IDB4MDgsCiAgQU5OT1RBVElPTlNfRk9STVM6IDB4MTAsCiAgQU5OT1RBVElPTlNfU1RPUkFHRTogMHgyMCwKICBBTk5PVEFUSU9OU19ESVNBQkxFOiAweDQwLAogIElTX0VESVRJTkc6IDB4ODAsCiAgT1BMSVNUOiAweDEwMAp9Owpjb25zdCBBbm5vdGF0aW9uTW9kZSA9IHsKICBESVNBQkxFOiAwLAogIEVOQUJMRTogMSwKICBFTkFCTEVfRk9STVM6IDIsCiAgRU5BQkxFX1NUT1JBR0U6IDMKfTsKY29uc3QgQW5ub3RhdGlvbkVkaXRvclByZWZpeCA9ICJwZGZqc19pbnRlcm5hbF9lZGl0b3JfIjsKY29uc3QgQW5ub3RhdGlvbkVkaXRvclR5cGUgPSB7CiAgRElTQUJMRTogLTEsCiAgTk9ORTogMCwKICBGUkVFVEVYVDogMywKICBISUdITElHSFQ6IDksCiAgU1RBTVA6IDEzLAogIElOSzogMTUsCiAgU0lHTkFUVVJFOiAxMDEsCiAgQ09NTUVOVDogMTAyCn07CmNvbnN0IEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlID0gewogIFJFU0laRTogMSwKICBDUkVBVEU6IDIsCiAgRlJFRVRFWFRfU0laRTogMTEsCiAgRlJFRVRFWFRfQ09MT1I6IDEyLAogIEZSRUVURVhUX09QQUNJVFk6IDEzLAogIElOS19DT0xPUjogMjEsCiAgSU5LX1RISUNLTkVTUzogMjIsCiAgSU5LX09QQUNJVFk6IDIzLAogIEhJR0hMSUdIVF9DT0xPUjogMzEsCiAgSElHSExJR0hUX1RISUNLTkVTUzogMzIsCiAgSElHSExJR0hUX0ZSRUU6IDMzLAogIEhJR0hMSUdIVF9TSE9XX0FMTDogMzQsCiAgRFJBV19TVEVQOiA0MQp9Owpjb25zdCBQZXJtaXNzaW9uRmxhZyA9IHsKICBQUklOVDogMHgwNCwKICBNT0RJRllfQ09OVEVOVFM6IDB4MDgsCiAgQ09QWTogMHgxMCwKICBNT0RJRllfQU5OT1RBVElPTlM6IDB4MjAsCiAgRklMTF9JTlRFUkFDVElWRV9GT1JNUzogMHgxMDAsCiAgQ09QWV9GT1JfQUNDRVNTSUJJTElUWTogMHgyMDAsCiAgQVNTRU1CTEU6IDB4NDAwLAogIFBSSU5UX0hJR0hfUVVBTElUWTogMHg4MDAKfTsKY29uc3QgVGV4dFJlbmRlcmluZ01vZGUgPSB7CiAgRklMTDogMCwKICBTVFJPS0U6IDEsCiAgRklMTF9TVFJPS0U6IDIsCiAgSU5WSVNJQkxFOiAzLAogIEZJTExfQUREX1RPX1BBVEg6IDQsCiAgU1RST0tFX0FERF9UT19QQVRIOiA1LAogIEZJTExfU1RST0tFX0FERF9UT19QQVRIOiA2LAogIEFERF9UT19QQVRIOiA3LAogIEZJTExfU1RST0tFX01BU0s6IDMsCiAgQUREX1RPX1BBVEhfRkxBRzogNAp9Owpjb25zdCBJbWFnZUtpbmQgPSB7CiAgR1JBWVNDQUxFXzFCUFA6IDEsCiAgUkdCXzI0QlBQOiAyLAogIFJHQkFfMzJCUFA6IDMKfTsKY29uc3QgQW5ub3RhdGlvblR5cGUgPSB7CiAgVEVYVDogMSwKICBMSU5LOiAyLAogIEZSRUVURVhUOiAzLAogIExJTkU6IDQsCiAgU1FVQVJFOiA1LAogIENJUkNMRTogNiwKICBQT0xZR09OOiA3LAogIFBPTFlMSU5FOiA4LAogIEhJR0hMSUdIVDogOSwKICBVTkRFUkxJTkU6IDEwLAogIFNRVUlHR0xZOiAxMSwKICBTVFJJS0VPVVQ6IDEyLAogIFNUQU1QOiAxMywKICBDQVJFVDogMTQsCiAgSU5LOiAxNSwKICBQT1BVUDogMTYsCiAgRklMRUFUVEFDSE1FTlQ6IDE3LAogIFNPVU5EOiAxOCwKICBNT1ZJRTogMTksCiAgV0lER0VUOiAyMCwKICBTQ1JFRU46IDIxLAogIFBSSU5URVJNQVJLOiAyMiwKICBUUkFQTkVUOiAyMywKICBXQVRFUk1BUks6IDI0LAogIFRIUkVFRDogMjUsCiAgUkVEQUNUOiAyNgp9Owpjb25zdCBBbm5vdGF0aW9uUmVwbHlUeXBlID0gewogIEdST1VQOiAiR3JvdXAiLAogIFJFUExZOiAiUiIKfTsKY29uc3QgQW5ub3RhdGlvbkZsYWcgPSB7CiAgSU5WSVNJQkxFOiAweDAxLAogIEhJRERFTjogMHgwMiwKICBQUklOVDogMHgwNCwKICBOT1pPT006IDB4MDgsCiAgTk9ST1RBVEU6IDB4MTAsCiAgTk9WSUVXOiAweDIwLAogIFJFQURPTkxZOiAweDQwLAogIExPQ0tFRDogMHg4MCwKICBUT0dHTEVOT1ZJRVc6IDB4MTAwLAogIExPQ0tFRENPTlRFTlRTOiAweDIwMAp9Owpjb25zdCBBbm5vdGF0aW9uRmllbGRGbGFnID0gewogIFJFQURPTkxZOiAweDAwMDAwMDEsCiAgUkVRVUlSRUQ6IDB4MDAwMDAwMiwKICBOT0VYUE9SVDogMHgwMDAwMDA0LAogIE1VTFRJTElORTogMHgwMDAxMDAwLAogIFBBU1NXT1JEOiAweDAwMDIwMDAsCiAgTk9UT0dHTEVUT09GRjogMHgwMDA0MDAwLAogIFJBRElPOiAweDAwMDgwMDAsCiAgUFVTSEJVVFRPTjogMHgwMDEwMDAwLAogIENPTUJPOiAweDAwMjAwMDAsCiAgRURJVDogMHgwMDQwMDAwLAogIFNPUlQ6IDB4MDA4MDAwMCwKICBGSUxFU0VMRUNUOiAweDAxMDAwMDAsCiAgTVVMVElTRUxFQ1Q6IDB4MDIwMDAwMCwKICBET05PVFNQRUxMQ0hFQ0s6IDB4MDQwMDAwMCwKICBET05PVFNDUk9MTDogMHgwODAwMDAwLAogIENPTUI6IDB4MTAwMDAwMCwKICBSSUNIVEVYVDogMHgyMDAwMDAwLAogIFJBRElPU0lOVU5JU09OOiAweDIwMDAwMDAsCiAgQ09NTUlUT05TRUxDSEFOR0U6IDB4NDAwMDAwMAp9Owpjb25zdCBBbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlID0gewogIFNPTElEOiAxLAogIERBU0hFRDogMiwKICBCRVZFTEVEOiAzLAogIElOU0VUOiA0LAogIFVOREVSTElORTogNQp9Owpjb25zdCBBbm5vdGF0aW9uQWN0aW9uRXZlbnRUeXBlID0gewogIEU6ICJNb3VzZSBFbnRlciIsCiAgWDogIk1vdXNlIEV4aXQiLAogIEQ6ICJNb3VzZSBEb3duIiwKICBVOiAiTW91c2UgVXAiLAogIEZvOiAiRm9jdXMiLAogIEJsOiAiQmx1ciIsCiAgUE86ICJQYWdlT3BlbiIsCiAgUEM6ICJQYWdlQ2xvc2UiLAogIFBWOiAiUGFnZVZpc2libGUiLAogIFBJOiAiUGFnZUludmlzaWJsZSIsCiAgSzogIktleXN0cm9rZSIsCiAgRjogIkZvcm1hdCIsCiAgVjogIlZhbGlkYXRlIiwKICBDOiAiQ2FsY3VsYXRlIgp9Owpjb25zdCBEb2N1bWVudEFjdGlvbkV2ZW50VHlwZSA9IHsKICBXQzogIldpbGxDbG9zZSIsCiAgV1M6ICJXaWxsU2F2ZSIsCiAgRFM6ICJEaWRTYXZlIiwKICBXUDogIldpbGxQcmludCIsCiAgRFA6ICJEaWRQcmludCIKfTsKY29uc3QgUGFnZUFjdGlvbkV2ZW50VHlwZSA9IHsKICBPOiAiUGFnZU9wZW4iLAogIEM6ICJQYWdlQ2xvc2UiCn07CmNvbnN0IFZlcmJvc2l0eUxldmVsID0gewogIEVSUk9SUzogMCwKICBXQVJOSU5HUzogMSwKICBJTkZPUzogNQp9Owpjb25zdCBPUFMgPSB7CiAgZGVwZW5kZW5jeTogMSwKICBzZXRMaW5lV2lkdGg6IDIsCiAgc2V0TGluZUNhcDogMywKICBzZXRMaW5lSm9pbjogNCwKICBzZXRNaXRlckxpbWl0OiA1LAogIHNldERhc2g6IDYsCiAgc2V0UmVuZGVyaW5nSW50ZW50OiA3LAogIHNldEZsYXRuZXNzOiA4LAogIHNldEdTdGF0ZTogOSwKICBzYXZlOiAxMCwKICByZXN0b3JlOiAxMSwKICB0cmFuc2Zvcm06IDEyLAogIG1vdmVUbzogMTMsCiAgbGluZVRvOiAxNCwKICBjdXJ2ZVRvOiAxNSwKICBjdXJ2ZVRvMjogMTYsCiAgY3VydmVUbzM6IDE3LAogIGNsb3NlUGF0aDogMTgsCiAgcmVjdGFuZ2xlOiAxOSwKICBzdHJva2U6IDIwLAogIGNsb3NlU3Ryb2tlOiAyMSwKICBmaWxsOiAyMiwKICBlb0ZpbGw6IDIzLAogIGZpbGxTdHJva2U6IDI0LAogIGVvRmlsbFN0cm9rZTogMjUsCiAgY2xvc2VGaWxsU3Ryb2tlOiAyNiwKICBjbG9zZUVPRmlsbFN0cm9rZTogMjcsCiAgZW5kUGF0aDogMjgsCiAgY2xpcDogMjksCiAgZW9DbGlwOiAzMCwKICBiZWdpblRleHQ6IDMxLAogIGVuZFRleHQ6IDMyLAogIHNldENoYXJTcGFjaW5nOiAzMywKICBzZXRXb3JkU3BhY2luZzogMzQsCiAgc2V0SFNjYWxlOiAzNSwKICBzZXRMZWFkaW5nOiAzNiwKICBzZXRGb250OiAzNywKICBzZXRUZXh0UmVuZGVyaW5nTW9kZTogMzgsCiAgc2V0VGV4dFJpc2U6IDM5LAogIG1vdmVUZXh0OiA0MCwKICBzZXRMZWFkaW5nTW92ZVRleHQ6IDQxLAogIHNldFRleHRNYXRyaXg6IDQyLAogIG5leHRMaW5lOiA0MywKICBzaG93VGV4dDogNDQsCiAgc2hvd1NwYWNlZFRleHQ6IDQ1LAogIG5leHRMaW5lU2hvd1RleHQ6IDQ2LAogIG5leHRMaW5lU2V0U3BhY2luZ1Nob3dUZXh0OiA0NywKICBzZXRDaGFyV2lkdGg6IDQ4LAogIHNldENoYXJXaWR0aEFuZEJvdW5kczogNDksCiAgc2V0U3Ryb2tlQ29sb3JTcGFjZTogNTAsCiAgc2V0RmlsbENvbG9yU3BhY2U6IDUxLAogIHNldFN0cm9rZUNvbG9yOiA1MiwKICBzZXRTdHJva2VDb2xvck46IDUzLAogIHNldEZpbGxDb2xvcjogNTQsCiAgc2V0RmlsbENvbG9yTjogNTUsCiAgc2V0U3Ryb2tlR3JheTogNTYsCiAgc2V0RmlsbEdyYXk6IDU3LAogIHNldFN0cm9rZVJHQkNvbG9yOiA1OCwKICBzZXRGaWxsUkdCQ29sb3I6IDU5LAogIHNldFN0cm9rZUNNWUtDb2xvcjogNjAsCiAgc2V0RmlsbENNWUtDb2xvcjogNjEsCiAgc2hhZGluZ0ZpbGw6IDYyLAogIGJlZ2luSW5saW5lSW1hZ2U6IDYzLAogIGJlZ2luSW1hZ2VEYXRhOiA2NCwKICBlbmRJbmxpbmVJbWFnZTogNjUsCiAgcGFpbnRYT2JqZWN0OiA2NiwKICBtYXJrUG9pbnQ6IDY3LAogIG1hcmtQb2ludFByb3BzOiA2OCwKICBiZWdpbk1hcmtlZENvbnRlbnQ6IDY5LAogIGJlZ2luTWFya2VkQ29udGVudFByb3BzOiA3MCwKICBlbmRNYXJrZWRDb250ZW50OiA3MSwKICBiZWdpbkNvbXBhdDogNzIsCiAgZW5kQ29tcGF0OiA3MywKICBwYWludEZvcm1YT2JqZWN0QmVnaW46IDc0LAogIHBhaW50Rm9ybVhPYmplY3RFbmQ6IDc1LAogIGJlZ2luR3JvdXA6IDc2LAogIGVuZEdyb3VwOiA3NywKICBiZWdpbkFubm90YXRpb246IDgwLAogIGVuZEFubm90YXRpb246IDgxLAogIHBhaW50SW1hZ2VNYXNrWE9iamVjdDogODMsCiAgcGFpbnRJbWFnZU1hc2tYT2JqZWN0R3JvdXA6IDg0LAogIHBhaW50SW1hZ2VYT2JqZWN0OiA4NSwKICBwYWludElubGluZUltYWdlWE9iamVjdDogODYsCiAgcGFpbnRJbmxpbmVJbWFnZVhPYmplY3RHcm91cDogODcsCiAgcGFpbnRJbWFnZVhPYmplY3RSZXBlYXQ6IDg4LAogIHBhaW50SW1hZ2VNYXNrWE9iamVjdFJlcGVhdDogODksCiAgcGFpbnRTb2xpZENvbG9ySW1hZ2VNYXNrOiA5MCwKICBjb25zdHJ1Y3RQYXRoOiA5MSwKICBzZXRTdHJva2VUcmFuc3BhcmVudDogOTIsCiAgc2V0RmlsbFRyYW5zcGFyZW50OiA5MywKICByYXdGaWxsUGF0aDogOTQKfTsKY29uc3QgRHJhd09QUyA9IHsKICBtb3ZlVG86IDAsCiAgbGluZVRvOiAxLAogIGN1cnZlVG86IDIsCiAgY2xvc2VQYXRoOiAzCn07CmNvbnN0IFBhc3N3b3JkUmVzcG9uc2VzID0gewogIE5FRURfUEFTU1dPUkQ6IDEsCiAgSU5DT1JSRUNUX1BBU1NXT1JEOiAyCn07CmxldCB2ZXJib3NpdHkgPSBWZXJib3NpdHlMZXZlbC5XQVJOSU5HUzsKZnVuY3Rpb24gc2V0VmVyYm9zaXR5TGV2ZWwobGV2ZWwpIHsKICBpZiAoTnVtYmVyLmlzSW50ZWdlcihsZXZlbCkpIHsKICAgIHZlcmJvc2l0eSA9IGxldmVsOwogIH0KfQpmdW5jdGlvbiBnZXRWZXJib3NpdHlMZXZlbCgpIHsKICByZXR1cm4gdmVyYm9zaXR5Owp9CmZ1bmN0aW9uIGluZm8obXNnKSB7CiAgaWYgKHZlcmJvc2l0eSA+PSBWZXJib3NpdHlMZXZlbC5JTkZPUykgewogICAgY29uc29sZS5sb2coYEluZm86ICR7bXNnfWApOwogIH0KfQpmdW5jdGlvbiB3YXJuKG1zZykgewogIGlmICh2ZXJib3NpdHkgPj0gVmVyYm9zaXR5TGV2ZWwuV0FSTklOR1MpIHsKICAgIGNvbnNvbGUubG9nKGBXYXJuaW5nOiAke21zZ31gKTsKICB9Cn0KZnVuY3Rpb24gdW5yZWFjaGFibGUobXNnKSB7CiAgdGhyb3cgbmV3IEVycm9yKG1zZyk7Cn0KZnVuY3Rpb24gYXNzZXJ0KGNvbmQsIG1zZykgewogIGlmICghY29uZCkgewogICAgdW5yZWFjaGFibGUobXNnKTsKICB9Cn0KZnVuY3Rpb24gX2lzVmFsaWRQcm90b2NvbCh1cmwpIHsKICBzd2l0Y2ggKHVybD8ucHJvdG9jb2wpIHsKICAgIGNhc2UgImh0dHA6IjoKICAgIGNhc2UgImh0dHBzOiI6CiAgICBjYXNlICJmdHA6IjoKICAgIGNhc2UgIm1haWx0bzoiOgogICAgY2FzZSAidGVsOiI6CiAgICAgIHJldHVybiB0cnVlOwogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIGZhbHNlOwogIH0KfQpmdW5jdGlvbiBjcmVhdGVWYWxpZEFic29sdXRlVXJsKHVybCwgYmFzZVVybCA9IG51bGwsIG9wdGlvbnMgPSBudWxsKSB7CiAgaWYgKCF1cmwpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBpZiAob3B0aW9ucyAmJiB0eXBlb2YgdXJsID09PSAic3RyaW5nIikgewogICAgaWYgKG9wdGlvbnMuYWRkRGVmYXVsdFByb3RvY29sICYmIHVybC5zdGFydHNXaXRoKCJ3d3cuIikpIHsKICAgICAgY29uc3QgZG90cyA9IHVybC5tYXRjaCgvXC4vZyk7CiAgICAgIGlmIChkb3RzPy5sZW5ndGggPj0gMikgewogICAgICAgIHVybCA9IGBodHRwOi8vJHt1cmx9YDsKICAgICAgfQogICAgfQogICAgaWYgKG9wdGlvbnMudHJ5Q29udmVydEVuY29kaW5nKSB7CiAgICAgIHRyeSB7CiAgICAgICAgdXJsID0gc3RyaW5nVG9VVEY4U3RyaW5nKHVybCk7CiAgICAgIH0gY2F0Y2gge30KICAgIH0KICB9CiAgY29uc3QgYWJzb2x1dGVVcmwgPSBiYXNlVXJsID8gVVJMLnBhcnNlKHVybCwgYmFzZVVybCkgOiBVUkwucGFyc2UodXJsKTsKICByZXR1cm4gX2lzVmFsaWRQcm90b2NvbChhYnNvbHV0ZVVybCkgPyBhYnNvbHV0ZVVybCA6IG51bGw7Cn0KZnVuY3Rpb24gdXBkYXRlVXJsSGFzaCh1cmwsIGhhc2gsIGFsbG93UmVsID0gZmFsc2UpIHsKICBjb25zdCByZXMgPSBVUkwucGFyc2UodXJsKTsKICBpZiAocmVzKSB7CiAgICByZXMuaGFzaCA9IGhhc2g7CiAgICByZXR1cm4gcmVzLmhyZWY7CiAgfQogIGlmIChhbGxvd1JlbCAmJiBjcmVhdGVWYWxpZEFic29sdXRlVXJsKHVybCwgImh0dHA6Ly9leGFtcGxlLmNvbSIpKSB7CiAgICByZXR1cm4gdXJsLnNwbGl0KCIjIiwgMSlbMF0gKyBgJHtoYXNoID8gYCMke2hhc2h9YCA6ICIifWA7CiAgfQogIHJldHVybiAiIjsKfQpmdW5jdGlvbiBzaGFkb3cob2JqLCBwcm9wLCB2YWx1ZSwgbm9uU2VyaWFsaXphYmxlID0gZmFsc2UpIHsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBwcm9wLCB7CiAgICB2YWx1ZSwKICAgIGVudW1lcmFibGU6ICFub25TZXJpYWxpemFibGUsCiAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICB3cml0YWJsZTogZmFsc2UKICB9KTsKICByZXR1cm4gdmFsdWU7Cn0KY29uc3QgQmFzZUV4Y2VwdGlvbiA9IGZ1bmN0aW9uIEJhc2VFeGNlcHRpb25DbG9zdXJlKCkgewogIGZ1bmN0aW9uIEJhc2VFeGNlcHRpb24obWVzc2FnZSwgbmFtZSkgewogICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgfQogIEJhc2VFeGNlcHRpb24ucHJvdG90eXBlID0gbmV3IEVycm9yKCk7CiAgQmFzZUV4Y2VwdGlvbi5jb25zdHJ1Y3RvciA9IEJhc2VFeGNlcHRpb247CiAgcmV0dXJuIEJhc2VFeGNlcHRpb247Cn0oKTsKY2xhc3MgUGFzc3dvcmRFeGNlcHRpb24gZXh0ZW5kcyBCYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2csIGNvZGUpIHsKICAgIHN1cGVyKG1zZywgIlBhc3N3b3JkRXhjZXB0aW9uIik7CiAgICB0aGlzLmNvZGUgPSBjb2RlOwogIH0KfQpjbGFzcyBVbmtub3duRXJyb3JFeGNlcHRpb24gZXh0ZW5kcyBCYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2csIGRldGFpbHMpIHsKICAgIHN1cGVyKG1zZywgIlVua25vd25FcnJvckV4Y2VwdGlvbiIpOwogICAgdGhpcy5kZXRhaWxzID0gZGV0YWlsczsKICB9Cn0KY2xhc3MgSW52YWxpZFBERkV4Y2VwdGlvbiBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiSW52YWxpZFBERkV4Y2VwdGlvbiIpOwogIH0KfQpjbGFzcyBSZXNwb25zZUV4Y2VwdGlvbiBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZywgc3RhdHVzLCBtaXNzaW5nKSB7CiAgICBzdXBlcihtc2csICJSZXNwb25zZUV4Y2VwdGlvbiIpOwogICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7CiAgICB0aGlzLm1pc3NpbmcgPSBtaXNzaW5nOwogIH0KfQpjbGFzcyBGb3JtYXRFcnJvciBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiRm9ybWF0RXJyb3IiKTsKICB9Cn0KY2xhc3MgQWJvcnRFeGNlcHRpb24gZXh0ZW5kcyBCYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2cpIHsKICAgIHN1cGVyKG1zZywgIkFib3J0RXhjZXB0aW9uIik7CiAgfQp9CmZ1bmN0aW9uIGJ5dGVzVG9TdHJpbmcoYnl0ZXMpIHsKICBpZiAodHlwZW9mIGJ5dGVzICE9PSAib2JqZWN0IiB8fCBieXRlcz8ubGVuZ3RoID09PSB1bmRlZmluZWQpIHsKICAgIHVucmVhY2hhYmxlKCJJbnZhbGlkIGFyZ3VtZW50IGZvciBieXRlc1RvU3RyaW5nIik7CiAgfQogIGNvbnN0IGxlbmd0aCA9IGJ5dGVzLmxlbmd0aDsKICBjb25zdCBNQVhfQVJHVU1FTlRfQ09VTlQgPSA4MTkyOwogIGlmIChsZW5ndGggPCBNQVhfQVJHVU1FTlRfQ09VTlQpIHsKICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGJ5dGVzKTsKICB9CiAgY29uc3Qgc3RyQnVmID0gW107CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gTUFYX0FSR1VNRU5UX0NPVU5UKSB7CiAgICBjb25zdCBjaHVua0VuZCA9IE1hdGgubWluKGkgKyBNQVhfQVJHVU1FTlRfQ09VTlQsIGxlbmd0aCk7CiAgICBjb25zdCBjaHVuayA9IGJ5dGVzLnN1YmFycmF5KGksIGNodW5rRW5kKTsKICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgY2h1bmspKTsKICB9CiAgcmV0dXJuIHN0ckJ1Zi5qb2luKCIiKTsKfQpmdW5jdGlvbiBzdHJpbmdUb0J5dGVzKHN0cikgewogIGlmICh0eXBlb2Ygc3RyICE9PSAic3RyaW5nIikgewogICAgdW5yZWFjaGFibGUoIkludmFsaWQgYXJndW1lbnQgZm9yIHN0cmluZ1RvQnl0ZXMiKTsKICB9CiAgY29uc3QgbGVuZ3RoID0gc3RyLmxlbmd0aDsKICBjb25zdCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgYnl0ZXNbaV0gPSBzdHIuY2hhckNvZGVBdChpKSAmIDB4ZmY7CiAgfQogIHJldHVybiBieXRlczsKfQpmdW5jdGlvbiBzdHJpbmczMih2YWx1ZSkgewogIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHZhbHVlID4+IDI0ICYgMHhmZiwgdmFsdWUgPj4gMTYgJiAweGZmLCB2YWx1ZSA+PiA4ICYgMHhmZiwgdmFsdWUgJiAweGZmKTsKfQpmdW5jdGlvbiBvYmplY3RTaXplKG9iaikgewogIHJldHVybiBPYmplY3Qua2V5cyhvYmopLmxlbmd0aDsKfQpmdW5jdGlvbiBpc0xpdHRsZUVuZGlhbigpIHsKICBjb25zdCBidWZmZXI4ID0gbmV3IFVpbnQ4QXJyYXkoNCk7CiAgYnVmZmVyOFswXSA9IDE7CiAgY29uc3QgdmlldzMyID0gbmV3IFVpbnQzMkFycmF5KGJ1ZmZlcjguYnVmZmVyLCAwLCAxKTsKICByZXR1cm4gdmlldzMyWzBdID09PSAxOwp9CmZ1bmN0aW9uIGlzRXZhbFN1cHBvcnRlZCgpIHsKICB0cnkgewogICAgbmV3IEZ1bmN0aW9uKCIiKTsKICAgIHJldHVybiB0cnVlOwogIH0gY2F0Y2ggewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQpjbGFzcyBGZWF0dXJlVGVzdCB7CiAgc3RhdGljIGdldCBpc0xpdHRsZUVuZGlhbigpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImlzTGl0dGxlRW5kaWFuIiwgaXNMaXR0bGVFbmRpYW4oKSk7CiAgfQogIHN0YXRpYyBnZXQgaXNFdmFsU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNFdmFsU3VwcG9ydGVkIiwgaXNFdmFsU3VwcG9ydGVkKCkpOwogIH0KICBzdGF0aWMgZ2V0IGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQiLCB0eXBlb2YgT2Zmc2NyZWVuQ2FudmFzICE9PSAidW5kZWZpbmVkIik7CiAgfQogIHN0YXRpYyBnZXQgaXNJbWFnZURlY29kZXJTdXBwb3J0ZWQoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJpc0ltYWdlRGVjb2RlclN1cHBvcnRlZCIsIHR5cGVvZiBJbWFnZURlY29kZXIgIT09ICJ1bmRlZmluZWQiKTsKICB9CiAgc3RhdGljIGdldCBwbGF0Zm9ybSgpIHsKICAgIGNvbnN0IHsKICAgICAgcGxhdGZvcm0sCiAgICAgIHVzZXJBZ2VudAogICAgfSA9IG5hdmlnYXRvcjsKICAgIHJldHVybiBzaGFkb3codGhpcywgInBsYXRmb3JtIiwgewogICAgICBpc0FuZHJvaWQ6IHVzZXJBZ2VudC5pbmNsdWRlcygiQW5kcm9pZCIpLAogICAgICBpc0xpbnV4OiBwbGF0Zm9ybS5pbmNsdWRlcygiTGludXgiKSwKICAgICAgaXNNYWM6IHBsYXRmb3JtLmluY2x1ZGVzKCJNYWMiKSwKICAgICAgaXNXaW5kb3dzOiBwbGF0Zm9ybS5pbmNsdWRlcygiV2luIiksCiAgICAgIGlzRmlyZWZveDogdXNlckFnZW50LmluY2x1ZGVzKCJGaXJlZm94IikKICAgIH0pOwogIH0KICBzdGF0aWMgZ2V0IGlzQ1NTUm91bmRTdXBwb3J0ZWQoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJpc0NTU1JvdW5kU3VwcG9ydGVkIiwgZ2xvYmFsVGhpcy5DU1M/LnN1cHBvcnRzPy4oIndpZHRoOiByb3VuZCgxLjVweCwgMXB4KSIpKTsKICB9Cn0KY29uc3QgaGV4TnVtYmVycyA9IEFycmF5LmZyb20oQXJyYXkoMjU2KS5rZXlzKCksIG4gPT4gbi50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKSk7CmNsYXNzIFV0aWwgewogIHN0YXRpYyBtYWtlSGV4Q29sb3IociwgZywgYikgewogICAgcmV0dXJuIGAjJHtoZXhOdW1iZXJzW3JdfSR7aGV4TnVtYmVyc1tnXX0ke2hleE51bWJlcnNbYl19YDsKICB9CiAgc3RhdGljIHNjYWxlTWluTWF4KHRyYW5zZm9ybSwgbWluTWF4KSB7CiAgICBsZXQgdGVtcDsKICAgIGlmICh0cmFuc2Zvcm1bMF0pIHsKICAgICAgaWYgKHRyYW5zZm9ybVswXSA8IDApIHsKICAgICAgICB0ZW1wID0gbWluTWF4WzBdOwogICAgICAgIG1pbk1heFswXSA9IG1pbk1heFsyXTsKICAgICAgICBtaW5NYXhbMl0gPSB0ZW1wOwogICAgICB9CiAgICAgIG1pbk1heFswXSAqPSB0cmFuc2Zvcm1bMF07CiAgICAgIG1pbk1heFsyXSAqPSB0cmFuc2Zvcm1bMF07CiAgICAgIGlmICh0cmFuc2Zvcm1bM10gPCAwKSB7CiAgICAgICAgdGVtcCA9IG1pbk1heFsxXTsKICAgICAgICBtaW5NYXhbMV0gPSBtaW5NYXhbM107CiAgICAgICAgbWluTWF4WzNdID0gdGVtcDsKICAgICAgfQogICAgICBtaW5NYXhbMV0gKj0gdHJhbnNmb3JtWzNdOwogICAgICBtaW5NYXhbM10gKj0gdHJhbnNmb3JtWzNdOwogICAgfSBlbHNlIHsKICAgICAgdGVtcCA9IG1pbk1heFswXTsKICAgICAgbWluTWF4WzBdID0gbWluTWF4WzFdOwogICAgICBtaW5NYXhbMV0gPSB0ZW1wOwogICAgICB0ZW1wID0gbWluTWF4WzJdOwogICAgICBtaW5NYXhbMl0gPSBtaW5NYXhbM107CiAgICAgIG1pbk1heFszXSA9IHRlbXA7CiAgICAgIGlmICh0cmFuc2Zvcm1bMV0gPCAwKSB7CiAgICAgICAgdGVtcCA9IG1pbk1heFsxXTsKICAgICAgICBtaW5NYXhbMV0gPSBtaW5NYXhbM107CiAgICAgICAgbWluTWF4WzNdID0gdGVtcDsKICAgICAgfQogICAgICBtaW5NYXhbMV0gKj0gdHJhbnNmb3JtWzFdOwogICAgICBtaW5NYXhbM10gKj0gdHJhbnNmb3JtWzFdOwogICAgICBpZiAodHJhbnNmb3JtWzJdIDwgMCkgewogICAgICAgIHRlbXAgPSBtaW5NYXhbMF07CiAgICAgICAgbWluTWF4WzBdID0gbWluTWF4WzJdOwogICAgICAgIG1pbk1heFsyXSA9IHRlbXA7CiAgICAgIH0KICAgICAgbWluTWF4WzBdICo9IHRyYW5zZm9ybVsyXTsKICAgICAgbWluTWF4WzJdICo9IHRyYW5zZm9ybVsyXTsKICAgIH0KICAgIG1pbk1heFswXSArPSB0cmFuc2Zvcm1bNF07CiAgICBtaW5NYXhbMV0gKz0gdHJhbnNmb3JtWzVdOwogICAgbWluTWF4WzJdICs9IHRyYW5zZm9ybVs0XTsKICAgIG1pbk1heFszXSArPSB0cmFuc2Zvcm1bNV07CiAgfQogIHN0YXRpYyB0cmFuc2Zvcm0obTEsIG0yKSB7CiAgICByZXR1cm4gW20xWzBdICogbTJbMF0gKyBtMVsyXSAqIG0yWzFdLCBtMVsxXSAqIG0yWzBdICsgbTFbM10gKiBtMlsxXSwgbTFbMF0gKiBtMlsyXSArIG0xWzJdICogbTJbM10sIG0xWzFdICogbTJbMl0gKyBtMVszXSAqIG0yWzNdLCBtMVswXSAqIG0yWzRdICsgbTFbMl0gKiBtMls1XSArIG0xWzRdLCBtMVsxXSAqIG0yWzRdICsgbTFbM10gKiBtMls1XSArIG0xWzVdXTsKICB9CiAgc3RhdGljIGFwcGx5VHJhbnNmb3JtKHAsIG0sIHBvcyA9IDApIHsKICAgIGNvbnN0IHAwID0gcFtwb3NdOwogICAgY29uc3QgcDEgPSBwW3BvcyArIDFdOwogICAgcFtwb3NdID0gcDAgKiBtWzBdICsgcDEgKiBtWzJdICsgbVs0XTsKICAgIHBbcG9zICsgMV0gPSBwMCAqIG1bMV0gKyBwMSAqIG1bM10gKyBtWzVdOwogIH0KICBzdGF0aWMgYXBwbHlUcmFuc2Zvcm1Ub0JlemllcihwLCB0cmFuc2Zvcm0sIHBvcyA9IDApIHsKICAgIGNvbnN0IG0wID0gdHJhbnNmb3JtWzBdOwogICAgY29uc3QgbTEgPSB0cmFuc2Zvcm1bMV07CiAgICBjb25zdCBtMiA9IHRyYW5zZm9ybVsyXTsKICAgIGNvbnN0IG0zID0gdHJhbnNmb3JtWzNdOwogICAgY29uc3QgbTQgPSB0cmFuc2Zvcm1bNF07CiAgICBjb25zdCBtNSA9IHRyYW5zZm9ybVs1XTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgaSArPSAyKSB7CiAgICAgIGNvbnN0IHBJID0gcFtwb3MgKyBpXTsKICAgICAgY29uc3QgcEkxID0gcFtwb3MgKyBpICsgMV07CiAgICAgIHBbcG9zICsgaV0gPSBwSSAqIG0wICsgcEkxICogbTIgKyBtNDsKICAgICAgcFtwb3MgKyBpICsgMV0gPSBwSSAqIG0xICsgcEkxICogbTMgKyBtNTsKICAgIH0KICB9CiAgc3RhdGljIGFwcGx5SW52ZXJzZVRyYW5zZm9ybShwLCBtKSB7CiAgICBjb25zdCBwMCA9IHBbMF07CiAgICBjb25zdCBwMSA9IHBbMV07CiAgICBjb25zdCBkID0gbVswXSAqIG1bM10gLSBtWzFdICogbVsyXTsKICAgIHBbMF0gPSAocDAgKiBtWzNdIC0gcDEgKiBtWzJdICsgbVsyXSAqIG1bNV0gLSBtWzRdICogbVszXSkgLyBkOwogICAgcFsxXSA9ICgtcDAgKiBtWzFdICsgcDEgKiBtWzBdICsgbVs0XSAqIG1bMV0gLSBtWzVdICogbVswXSkgLyBkOwogIH0KICBzdGF0aWMgYXhpYWxBbGlnbmVkQm91bmRpbmdCb3gocmVjdCwgdHJhbnNmb3JtLCBvdXRwdXQpIHsKICAgIGNvbnN0IG0wID0gdHJhbnNmb3JtWzBdOwogICAgY29uc3QgbTEgPSB0cmFuc2Zvcm1bMV07CiAgICBjb25zdCBtMiA9IHRyYW5zZm9ybVsyXTsKICAgIGNvbnN0IG0zID0gdHJhbnNmb3JtWzNdOwogICAgY29uc3QgbTQgPSB0cmFuc2Zvcm1bNF07CiAgICBjb25zdCBtNSA9IHRyYW5zZm9ybVs1XTsKICAgIGNvbnN0IHIwID0gcmVjdFswXTsKICAgIGNvbnN0IHIxID0gcmVjdFsxXTsKICAgIGNvbnN0IHIyID0gcmVjdFsyXTsKICAgIGNvbnN0IHIzID0gcmVjdFszXTsKICAgIGxldCBhMCA9IG0wICogcjAgKyBtNDsKICAgIGxldCBhMiA9IGEwOwogICAgbGV0IGExID0gbTAgKiByMiArIG00OwogICAgbGV0IGEzID0gYTE7CiAgICBsZXQgYjAgPSBtMyAqIHIxICsgbTU7CiAgICBsZXQgYjIgPSBiMDsKICAgIGxldCBiMSA9IG0zICogcjMgKyBtNTsKICAgIGxldCBiMyA9IGIxOwogICAgaWYgKG0xICE9PSAwIHx8IG0yICE9PSAwKSB7CiAgICAgIGNvbnN0IG0xcjAgPSBtMSAqIHIwOwogICAgICBjb25zdCBtMXIyID0gbTEgKiByMjsKICAgICAgY29uc3QgbTJyMSA9IG0yICogcjE7CiAgICAgIGNvbnN0IG0ycjMgPSBtMiAqIHIzOwogICAgICBhMCArPSBtMnIxOwogICAgICBhMyArPSBtMnIxOwogICAgICBhMSArPSBtMnIzOwogICAgICBhMiArPSBtMnIzOwogICAgICBiMCArPSBtMXIwOwogICAgICBiMyArPSBtMXIwOwogICAgICBiMSArPSBtMXIyOwogICAgICBiMiArPSBtMXIyOwogICAgfQogICAgb3V0cHV0WzBdID0gTWF0aC5taW4ob3V0cHV0WzBdLCBhMCwgYTEsIGEyLCBhMyk7CiAgICBvdXRwdXRbMV0gPSBNYXRoLm1pbihvdXRwdXRbMV0sIGIwLCBiMSwgYjIsIGIzKTsKICAgIG91dHB1dFsyXSA9IE1hdGgubWF4KG91dHB1dFsyXSwgYTAsIGExLCBhMiwgYTMpOwogICAgb3V0cHV0WzNdID0gTWF0aC5tYXgob3V0cHV0WzNdLCBiMCwgYjEsIGIyLCBiMyk7CiAgfQogIHN0YXRpYyBpbnZlcnNlVHJhbnNmb3JtKG0pIHsKICAgIGNvbnN0IGQgPSBtWzBdICogbVszXSAtIG1bMV0gKiBtWzJdOwogICAgcmV0dXJuIFttWzNdIC8gZCwgLW1bMV0gLyBkLCAtbVsyXSAvIGQsIG1bMF0gLyBkLCAobVsyXSAqIG1bNV0gLSBtWzRdICogbVszXSkgLyBkLCAobVs0XSAqIG1bMV0gLSBtWzVdICogbVswXSkgLyBkXTsKICB9CiAgc3RhdGljIHNpbmd1bGFyVmFsdWVEZWNvbXBvc2UyZFNjYWxlKG1hdHJpeCwgb3V0cHV0KSB7CiAgICBjb25zdCBtMCA9IG1hdHJpeFswXTsKICAgIGNvbnN0IG0xID0gbWF0cml4WzFdOwogICAgY29uc3QgbTIgPSBtYXRyaXhbMl07CiAgICBjb25zdCBtMyA9IG1hdHJpeFszXTsKICAgIGNvbnN0IGEgPSBtMCAqKiAyICsgbTEgKiogMjsKICAgIGNvbnN0IGIgPSBtMCAqIG0yICsgbTEgKiBtMzsKICAgIGNvbnN0IGMgPSBtMiAqKiAyICsgbTMgKiogMjsKICAgIGNvbnN0IGZpcnN0ID0gKGEgKyBjKSAvIDI7CiAgICBjb25zdCBzZWNvbmQgPSBNYXRoLnNxcnQoZmlyc3QgKiogMiAtIChhICogYyAtIGIgKiogMikpOwogICAgb3V0cHV0WzBdID0gTWF0aC5zcXJ0KGZpcnN0ICsgc2Vjb25kIHx8IDEpOwogICAgb3V0cHV0WzFdID0gTWF0aC5zcXJ0KGZpcnN0IC0gc2Vjb25kIHx8IDEpOwogIH0KICBzdGF0aWMgbm9ybWFsaXplUmVjdChyZWN0KSB7CiAgICBjb25zdCByID0gcmVjdC5zbGljZSgwKTsKICAgIGlmIChyZWN0WzBdID4gcmVjdFsyXSkgewogICAgICByWzBdID0gcmVjdFsyXTsKICAgICAgclsyXSA9IHJlY3RbMF07CiAgICB9CiAgICBpZiAocmVjdFsxXSA+IHJlY3RbM10pIHsKICAgICAgclsxXSA9IHJlY3RbM107CiAgICAgIHJbM10gPSByZWN0WzFdOwogICAgfQogICAgcmV0dXJuIHI7CiAgfQogIHN0YXRpYyBpbnRlcnNlY3QocmVjdDEsIHJlY3QyKSB7CiAgICBjb25zdCB4TG93ID0gTWF0aC5tYXgoTWF0aC5taW4ocmVjdDFbMF0sIHJlY3QxWzJdKSwgTWF0aC5taW4ocmVjdDJbMF0sIHJlY3QyWzJdKSk7CiAgICBjb25zdCB4SGlnaCA9IE1hdGgubWluKE1hdGgubWF4KHJlY3QxWzBdLCByZWN0MVsyXSksIE1hdGgubWF4KHJlY3QyWzBdLCByZWN0MlsyXSkpOwogICAgaWYgKHhMb3cgPiB4SGlnaCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHlMb3cgPSBNYXRoLm1heChNYXRoLm1pbihyZWN0MVsxXSwgcmVjdDFbM10pLCBNYXRoLm1pbihyZWN0MlsxXSwgcmVjdDJbM10pKTsKICAgIGNvbnN0IHlIaWdoID0gTWF0aC5taW4oTWF0aC5tYXgocmVjdDFbMV0sIHJlY3QxWzNdKSwgTWF0aC5tYXgocmVjdDJbMV0sIHJlY3QyWzNdKSk7CiAgICBpZiAoeUxvdyA+IHlIaWdoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcmV0dXJuIFt4TG93LCB5TG93LCB4SGlnaCwgeUhpZ2hdOwogIH0KICBzdGF0aWMgcG9pbnRCb3VuZGluZ0JveCh4LCB5LCBtaW5NYXgpIHsKICAgIG1pbk1heFswXSA9IE1hdGgubWluKG1pbk1heFswXSwgeCk7CiAgICBtaW5NYXhbMV0gPSBNYXRoLm1pbihtaW5NYXhbMV0sIHkpOwogICAgbWluTWF4WzJdID0gTWF0aC5tYXgobWluTWF4WzJdLCB4KTsKICAgIG1pbk1heFszXSA9IE1hdGgubWF4KG1pbk1heFszXSwgeSk7CiAgfQogIHN0YXRpYyByZWN0Qm91bmRpbmdCb3goeDAsIHkwLCB4MSwgeTEsIG1pbk1heCkgewogICAgbWluTWF4WzBdID0gTWF0aC5taW4obWluTWF4WzBdLCB4MCwgeDEpOwogICAgbWluTWF4WzFdID0gTWF0aC5taW4obWluTWF4WzFdLCB5MCwgeTEpOwogICAgbWluTWF4WzJdID0gTWF0aC5tYXgobWluTWF4WzJdLCB4MCwgeDEpOwogICAgbWluTWF4WzNdID0gTWF0aC5tYXgobWluTWF4WzNdLCB5MCwgeTEpOwogIH0KICBzdGF0aWMgI2dldEV4dHJlbXVtT25DdXJ2ZSh4MCwgeDEsIHgyLCB4MywgeTAsIHkxLCB5MiwgeTMsIHQsIG1pbk1heCkgewogICAgaWYgKHQgPD0gMCB8fCB0ID49IDEpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgbXQgPSAxIC0gdDsKICAgIGNvbnN0IHR0ID0gdCAqIHQ7CiAgICBjb25zdCB0dHQgPSB0dCAqIHQ7CiAgICBjb25zdCB4ID0gbXQgKiAobXQgKiAobXQgKiB4MCArIDMgKiB0ICogeDEpICsgMyAqIHR0ICogeDIpICsgdHR0ICogeDM7CiAgICBjb25zdCB5ID0gbXQgKiAobXQgKiAobXQgKiB5MCArIDMgKiB0ICogeTEpICsgMyAqIHR0ICogeTIpICsgdHR0ICogeTM7CiAgICBtaW5NYXhbMF0gPSBNYXRoLm1pbihtaW5NYXhbMF0sIHgpOwogICAgbWluTWF4WzFdID0gTWF0aC5taW4obWluTWF4WzFdLCB5KTsKICAgIG1pbk1heFsyXSA9IE1hdGgubWF4KG1pbk1heFsyXSwgeCk7CiAgICBtaW5NYXhbM10gPSBNYXRoLm1heChtaW5NYXhbM10sIHkpOwogIH0KICBzdGF0aWMgI2dldEV4dHJlbXVtKHgwLCB4MSwgeDIsIHgzLCB5MCwgeTEsIHkyLCB5MywgYSwgYiwgYywgbWluTWF4KSB7CiAgICBpZiAoTWF0aC5hYnMoYSkgPCAxZS0xMikgewogICAgICBpZiAoTWF0aC5hYnMoYikgPj0gMWUtMTIpIHsKICAgICAgICB0aGlzLiNnZXRFeHRyZW11bU9uQ3VydmUoeDAsIHgxLCB4MiwgeDMsIHkwLCB5MSwgeTIsIHkzLCAtYyAvIGIsIG1pbk1heCk7CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYyAqIGE7CiAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHNxcnREZWx0YSA9IE1hdGguc3FydChkZWx0YSk7CiAgICBjb25zdCBhMiA9IDIgKiBhOwogICAgdGhpcy4jZ2V0RXh0cmVtdW1PbkN1cnZlKHgwLCB4MSwgeDIsIHgzLCB5MCwgeTEsIHkyLCB5MywgKC1iICsgc3FydERlbHRhKSAvIGEyLCBtaW5NYXgpOwogICAgdGhpcy4jZ2V0RXh0cmVtdW1PbkN1cnZlKHgwLCB4MSwgeDIsIHgzLCB5MCwgeTEsIHkyLCB5MywgKC1iIC0gc3FydERlbHRhKSAvIGEyLCBtaW5NYXgpOwogIH0KICBzdGF0aWMgYmV6aWVyQm91bmRpbmdCb3goeDAsIHkwLCB4MSwgeTEsIHgyLCB5MiwgeDMsIHkzLCBtaW5NYXgpIHsKICAgIG1pbk1heFswXSA9IE1hdGgubWluKG1pbk1heFswXSwgeDAsIHgzKTsKICAgIG1pbk1heFsxXSA9IE1hdGgubWluKG1pbk1heFsxXSwgeTAsIHkzKTsKICAgIG1pbk1heFsyXSA9IE1hdGgubWF4KG1pbk1heFsyXSwgeDAsIHgzKTsKICAgIG1pbk1heFszXSA9IE1hdGgubWF4KG1pbk1heFszXSwgeTAsIHkzKTsKICAgIHRoaXMuI2dldEV4dHJlbXVtKHgwLCB4MSwgeDIsIHgzLCB5MCwgeTEsIHkyLCB5MywgMyAqICgteDAgKyAzICogKHgxIC0geDIpICsgeDMpLCA2ICogKHgwIC0gMiAqIHgxICsgeDIpLCAzICogKHgxIC0geDApLCBtaW5NYXgpOwogICAgdGhpcy4jZ2V0RXh0cmVtdW0oeDAsIHgxLCB4MiwgeDMsIHkwLCB5MSwgeTIsIHkzLCAzICogKC15MCArIDMgKiAoeTEgLSB5MikgKyB5MyksIDYgKiAoeTAgLSAyICogeTEgKyB5MiksIDMgKiAoeTEgLSB5MCksIG1pbk1heCk7CiAgfQp9CmNvbnN0IFBERlN0cmluZ1RyYW5zbGF0ZVRhYmxlID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDB4MmQ4LCAweDJjNywgMHgyYzYsIDB4MmQ5LCAweDJkZCwgMHgyZGIsIDB4MmRhLCAweDJkYywgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMHgyMDIyLCAweDIwMjAsIDB4MjAyMSwgMHgyMDI2LCAweDIwMTQsIDB4MjAxMywgMHgxOTIsIDB4MjA0NCwgMHgyMDM5LCAweDIwM2EsIDB4MjIxMiwgMHgyMDMwLCAweDIwMWUsIDB4MjAxYywgMHgyMDFkLCAweDIwMTgsIDB4MjAxOSwgMHgyMDFhLCAweDIxMjIsIDB4ZmIwMSwgMHhmYjAyLCAweDE0MSwgMHgxNTIsIDB4MTYwLCAweDE3OCwgMHgxN2QsIDB4MTMxLCAweDE0MiwgMHgxNTMsIDB4MTYxLCAweDE3ZSwgMCwgMHgyMGFjXTsKZnVuY3Rpb24gc3RyaW5nVG9QREZTdHJpbmcoc3RyLCBrZWVwRXNjYXBlU2VxdWVuY2UgPSBmYWxzZSkgewogIGlmIChzdHJbMF0gPj0gIlx4RUYiKSB7CiAgICBsZXQgZW5jb2Rpbmc7CiAgICBpZiAoc3RyWzBdID09PSAiXHhGRSIgJiYgc3RyWzFdID09PSAiXHhGRiIpIHsKICAgICAgZW5jb2RpbmcgPSAidXRmLTE2YmUiOwogICAgICBpZiAoc3RyLmxlbmd0aCAlIDIgPT09IDEpIHsKICAgICAgICBzdHIgPSBzdHIuc2xpY2UoMCwgLTEpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKHN0clswXSA9PT0gIlx4RkYiICYmIHN0clsxXSA9PT0gIlx4RkUiKSB7CiAgICAgIGVuY29kaW5nID0gInV0Zi0xNmxlIjsKICAgICAgaWYgKHN0ci5sZW5ndGggJSAyID09PSAxKSB7CiAgICAgICAgc3RyID0gc3RyLnNsaWNlKDAsIC0xKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChzdHJbMF0gPT09ICJceEVGIiAmJiBzdHJbMV0gPT09ICJceEJCIiAmJiBzdHJbMl0gPT09ICJceEJGIikgewogICAgICBlbmNvZGluZyA9ICJ1dGYtOCI7CiAgICB9CiAgICBpZiAoZW5jb2RpbmcpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKGVuY29kaW5nLCB7CiAgICAgICAgICBmYXRhbDogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIGNvbnN0IGJ1ZmZlciA9IHN0cmluZ1RvQnl0ZXMoc3RyKTsKICAgICAgICBjb25zdCBkZWNvZGVkID0gZGVjb2Rlci5kZWNvZGUoYnVmZmVyKTsKICAgICAgICBpZiAoa2VlcEVzY2FwZVNlcXVlbmNlIHx8ICFkZWNvZGVkLmluY2x1ZGVzKCJceDFiIikpIHsKICAgICAgICAgIHJldHVybiBkZWNvZGVkOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGVjb2RlZC5yZXBsYWNlQWxsKC9ceDFiW15ceDFiXSooPzpceDFifCQpL2csICIiKTsKICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICB3YXJuKGBzdHJpbmdUb1BERlN0cmluZzogIiR7ZXh9Ii5gKTsKICAgICAgfQogICAgfQogIH0KICBjb25zdCBzdHJCdWYgPSBbXTsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBzdHIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgY2hhckNvZGUgPSBzdHIuY2hhckNvZGVBdChpKTsKICAgIGlmICgha2VlcEVzY2FwZVNlcXVlbmNlICYmIGNoYXJDb2RlID09PSAweDFiKSB7CiAgICAgIHdoaWxlICgrK2kgPCBpaSAmJiBzdHIuY2hhckNvZGVBdChpKSAhPT0gMHgxYikge30KICAgICAgY29udGludWU7CiAgICB9CiAgICBjb25zdCBjb2RlID0gUERGU3RyaW5nVHJhbnNsYXRlVGFibGVbY2hhckNvZGVdOwogICAgc3RyQnVmLnB1c2goY29kZSA/IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSkgOiBzdHIuY2hhckF0KGkpKTsKICB9CiAgcmV0dXJuIHN0ckJ1Zi5qb2luKCIiKTsKfQpmdW5jdGlvbiBzdHJpbmdUb1VURjhTdHJpbmcoc3RyKSB7CiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoc3RyKSk7Cn0KZnVuY3Rpb24gdXRmOFN0cmluZ1RvU3RyaW5nKHN0cikgewogIHJldHVybiB1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoc3RyKSk7Cn0KZnVuY3Rpb24gaXNBcnJheUVxdWFsKGFycjEsIGFycjIpIHsKICBpZiAoYXJyMS5sZW5ndGggIT09IGFycjIubGVuZ3RoKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGZvciAobGV0IGkgPSAwLCBpaSA9IGFycjEubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgaWYgKGFycjFbaV0gIT09IGFycjJbaV0pIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KICByZXR1cm4gdHJ1ZTsKfQpmdW5jdGlvbiBnZXRNb2RpZmljYXRpb25EYXRlKGRhdGUgPSBuZXcgRGF0ZSgpKSB7CiAgaWYgKCEoZGF0ZSBpbnN0YW5jZW9mIERhdGUpKSB7CiAgICBkYXRlID0gbmV3IERhdGUoZGF0ZSk7CiAgfQogIGNvbnN0IGJ1ZmZlciA9IFtkYXRlLmdldFVUQ0Z1bGxZZWFyKCkudG9TdHJpbmcoKSwgKGRhdGUuZ2V0VVRDTW9udGgoKSArIDEpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgIjAiKSwgZGF0ZS5nZXRVVENEYXRlKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAiMCIpLCBkYXRlLmdldFVUQ0hvdXJzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAiMCIpLCBkYXRlLmdldFVUQ01pbnV0ZXMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICIwIiksIGRhdGUuZ2V0VVRDU2Vjb25kcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgIjAiKV07CiAgcmV0dXJuIGJ1ZmZlci5qb2luKCIiKTsKfQpsZXQgTm9ybWFsaXplUmVnZXggPSBudWxsOwpsZXQgTm9ybWFsaXphdGlvbk1hcCA9IG51bGw7CmZ1bmN0aW9uIG5vcm1hbGl6ZVVuaWNvZGUoc3RyKSB7CiAgaWYgKCFOb3JtYWxpemVSZWdleCkgewogICAgTm9ybWFsaXplUmVnZXggPSAvKFtcdTAwYTBcdTAwYjVcdTAzN2VcdTBlYjNcdTIwMDAtXHUyMDBhXHUyMDJmXHUyMTI2XHVmYjAwLVx1ZmIwNFx1ZmIwNlx1ZmIyMC1cdWZiMzZcdWZiMzgtXHVmYjNjXHVmYjNlXHVmYjQwLVx1ZmI0MVx1ZmI0My1cdWZiNDRcdWZiNDYtXHVmYmExXHVmYmE0LVx1ZmJhOVx1ZmJhZS1cdWZiYjFcdWZiZDMtXHVmYmRjXHVmYmRlLVx1ZmJlN1x1ZmJlYS1cdWZiZjhcdWZiZmMtXHVmYmZkXHVmYzAwLVx1ZmM1ZFx1ZmM2NC1cdWZjZjFcdWZjZjUtXHVmZDNkXHVmZDg4XHVmZGY0XHVmZGZhLVx1ZmRmYlx1ZmU3MVx1ZmU3N1x1ZmU3OVx1ZmU3Ylx1ZmU3ZF0rKXwoXHVmYjA1KykvZ3U7CiAgICBOb3JtYWxpemF0aW9uTWFwID0gbmV3IE1hcChbWyLvrIUiLCAixb90Il1dKTsKICB9CiAgcmV0dXJuIHN0ci5yZXBsYWNlQWxsKE5vcm1hbGl6ZVJlZ2V4LCAoXywgcDEsIHAyKSA9PiBwMSA/IHAxLm5vcm1hbGl6ZSgiTkZLQyIpIDogTm9ybWFsaXphdGlvbk1hcC5nZXQocDIpKTsKfQpmdW5jdGlvbiBnZXRVdWlkKCkgewogIGlmICh0eXBlb2YgY3J5cHRvLnJhbmRvbVVVSUQgPT09ICJmdW5jdGlvbiIpIHsKICAgIHJldHVybiBjcnlwdG8ucmFuZG9tVVVJRCgpOwogIH0KICBjb25zdCBidWYgPSBuZXcgVWludDhBcnJheSgzMik7CiAgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhidWYpOwogIHJldHVybiBieXRlc1RvU3RyaW5nKGJ1Zik7Cn0KY29uc3QgQW5ub3RhdGlvblByZWZpeCA9ICJwZGZqc19pbnRlcm5hbF9pZF8iOwpmdW5jdGlvbiBfaXNWYWxpZEV4cGxpY2l0RGVzdCh2YWxpZFJlZiwgdmFsaWROYW1lLCBkZXN0KSB7CiAgaWYgKCFBcnJheS5pc0FycmF5KGRlc3QpIHx8IGRlc3QubGVuZ3RoIDwgMikgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBjb25zdCBbcGFnZSwgem9vbSwgLi4uYXJnc10gPSBkZXN0OwogIGlmICghdmFsaWRSZWYocGFnZSkgJiYgIU51bWJlci5pc0ludGVnZXIocGFnZSkpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgaWYgKCF2YWxpZE5hbWUoem9vbSkpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgY29uc3QgYXJnc0xlbiA9IGFyZ3MubGVuZ3RoOwogIGxldCBhbGxvd051bGwgPSB0cnVlOwogIHN3aXRjaCAoem9vbS5uYW1lKSB7CiAgICBjYXNlICJYWVoiOgogICAgICBpZiAoYXJnc0xlbiA8IDIgfHwgYXJnc0xlbiA+IDMpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgYnJlYWs7CiAgICBjYXNlICJGaXQiOgogICAgY2FzZSAiRml0QiI6CiAgICAgIHJldHVybiBhcmdzTGVuID09PSAwOwogICAgY2FzZSAiRml0SCI6CiAgICBjYXNlICJGaXRCSCI6CiAgICBjYXNlICJGaXRWIjoKICAgIGNhc2UgIkZpdEJWIjoKICAgICAgaWYgKGFyZ3NMZW4gPiAxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGJyZWFrOwogICAgY2FzZSAiRml0UiI6CiAgICAgIGlmIChhcmdzTGVuICE9PSA0KSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGFsbG93TnVsbCA9IGZhbHNlOwogICAgICBicmVhazsKICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiBmYWxzZTsKICB9CiAgZm9yIChjb25zdCBhcmcgb2YgYXJncykgewogICAgaWYgKHR5cGVvZiBhcmcgPT09ICJudW1iZXIiIHx8IGFsbG93TnVsbCAmJiBhcmcgPT09IG51bGwpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIE1hdGhDbGFtcCh2LCBtaW4sIG1heCkgewogIHJldHVybiBNYXRoLm1pbihNYXRoLm1heCh2LCBtaW4pLCBtYXgpOwp9CmZ1bmN0aW9uIHRvSGV4VXRpbChhcnIpIHsKICBpZiAoVWludDhBcnJheS5wcm90b3R5cGUudG9IZXgpIHsKICAgIHJldHVybiBhcnIudG9IZXgoKTsKICB9CiAgcmV0dXJuIEFycmF5LmZyb20oYXJyLCBudW0gPT4gaGV4TnVtYmVyc1tudW1dKS5qb2luKCIiKTsKfQpmdW5jdGlvbiB0b0Jhc2U2NFV0aWwoYXJyKSB7CiAgaWYgKFVpbnQ4QXJyYXkucHJvdG90eXBlLnRvQmFzZTY0KSB7CiAgICByZXR1cm4gYXJyLnRvQmFzZTY0KCk7CiAgfQogIHJldHVybiBidG9hKGJ5dGVzVG9TdHJpbmcoYXJyKSk7Cn0KZnVuY3Rpb24gZnJvbUJhc2U2NFV0aWwoc3RyKSB7CiAgaWYgKFVpbnQ4QXJyYXkuZnJvbUJhc2U2NCkgewogICAgcmV0dXJuIFVpbnQ4QXJyYXkuZnJvbUJhc2U2NChzdHIpOwogIH0KICByZXR1cm4gc3RyaW5nVG9CeXRlcyhhdG9iKHN0cikpOwp9CmlmICh0eXBlb2YgUHJvbWlzZS50cnkgIT09ICJmdW5jdGlvbiIpIHsKICBQcm9taXNlLnRyeSA9IGZ1bmN0aW9uIChmbiwgLi4uYXJncykgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICByZXNvbHZlKGZuKC4uLmFyZ3MpKTsKICAgIH0pOwogIH07Cn0KaWYgKHR5cGVvZiBNYXRoLnN1bVByZWNpc2UgIT09ICJmdW5jdGlvbiIpIHsKICBNYXRoLnN1bVByZWNpc2UgPSBmdW5jdGlvbiAobnVtYmVycykgewogICAgcmV0dXJuIG51bWJlcnMucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCk7CiAgfTsKfQoKOy8vIC4vc3JjL2NvcmUvcHJpbWl0aXZlcy5qcwoKY29uc3QgQ0lSQ1VMQVJfUkVGID0gU3ltYm9sKCJDSVJDVUxBUl9SRUYiKTsKY29uc3QgRU9GID0gU3ltYm9sKCJFT0YiKTsKbGV0IENtZENhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKbGV0IE5hbWVDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CmxldCBSZWZDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CmZ1bmN0aW9uIGNsZWFyUHJpbWl0aXZlQ2FjaGVzKCkgewogIENtZENhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBOYW1lQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIFJlZkNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKfQpjbGFzcyBOYW1lIHsKICBjb25zdHJ1Y3RvcihuYW1lKSB7CiAgICB0aGlzLm5hbWUgPSBuYW1lOwogIH0KICBzdGF0aWMgZ2V0KG5hbWUpIHsKICAgIHJldHVybiBOYW1lQ2FjaGVbbmFtZV0gfHw9IG5ldyBOYW1lKG5hbWUpOwogIH0KfQpjbGFzcyBDbWQgewogIGNvbnN0cnVjdG9yKGNtZCkgewogICAgdGhpcy5jbWQgPSBjbWQ7CiAgfQogIHN0YXRpYyBnZXQoY21kKSB7CiAgICByZXR1cm4gQ21kQ2FjaGVbY21kXSB8fD0gbmV3IENtZChjbWQpOwogIH0KfQpjb25zdCBub25TZXJpYWxpemFibGUgPSBmdW5jdGlvbiBub25TZXJpYWxpemFibGVDbG9zdXJlKCkgewogIHJldHVybiBub25TZXJpYWxpemFibGU7Cn07CmNsYXNzIERpY3QgewogIGNvbnN0cnVjdG9yKHhyZWYgPSBudWxsKSB7CiAgICB0aGlzLl9tYXAgPSBuZXcgTWFwKCk7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy5vYmpJZCA9IG51bGw7CiAgICB0aGlzLnN1cHByZXNzRW5jcnlwdGlvbiA9IGZhbHNlOwogICAgdGhpcy5fX25vblNlcmlhbGl6YWJsZV9fID0gbm9uU2VyaWFsaXphYmxlOwogIH0KICBhc3NpZ25YcmVmKG5ld1hyZWYpIHsKICAgIHRoaXMueHJlZiA9IG5ld1hyZWY7CiAgfQogIGdldCBzaXplKCkgewogICAgcmV0dXJuIHRoaXMuX21hcC5zaXplOwogIH0KICBnZXQoa2V5MSwga2V5Miwga2V5MykgewogICAgbGV0IHZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkxKTsKICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGtleTIgIT09IHVuZGVmaW5lZCkgewogICAgICB2YWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5Mik7CiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGtleTMgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHZhbHVlID0gdGhpcy5fbWFwLmdldChrZXkzKTsKICAgICAgfQogICAgfQogICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgUmVmICYmIHRoaXMueHJlZikgewogICAgICByZXR1cm4gdGhpcy54cmVmLmZldGNoKHZhbHVlLCB0aGlzLnN1cHByZXNzRW5jcnlwdGlvbik7CiAgICB9CiAgICByZXR1cm4gdmFsdWU7CiAgfQogIGFzeW5jIGdldEFzeW5jKGtleTEsIGtleTIsIGtleTMpIHsKICAgIGxldCB2YWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5MSk7CiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCAmJiBrZXkyICE9PSB1bmRlZmluZWQpIHsKICAgICAgdmFsdWUgPSB0aGlzLl9tYXAuZ2V0KGtleTIpOwogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCAmJiBrZXkzICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB2YWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5Myk7CiAgICAgIH0KICAgIH0KICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFJlZiAmJiB0aGlzLnhyZWYpIHsKICAgICAgcmV0dXJuIHRoaXMueHJlZi5mZXRjaEFzeW5jKHZhbHVlLCB0aGlzLnN1cHByZXNzRW5jcnlwdGlvbik7CiAgICB9CiAgICByZXR1cm4gdmFsdWU7CiAgfQogIGdldEFycmF5KGtleTEsIGtleTIsIGtleTMpIHsKICAgIGxldCB2YWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5MSk7CiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCAmJiBrZXkyICE9PSB1bmRlZmluZWQpIHsKICAgICAgdmFsdWUgPSB0aGlzLl9tYXAuZ2V0KGtleTIpOwogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCAmJiBrZXkzICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB2YWx1ZSA9IHRoaXMuX21hcC5nZXQoa2V5Myk7CiAgICAgIH0KICAgIH0KICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFJlZiAmJiB0aGlzLnhyZWYpIHsKICAgICAgdmFsdWUgPSB0aGlzLnhyZWYuZmV0Y2godmFsdWUsIHRoaXMuc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgIH0KICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICB2YWx1ZSA9IHZhbHVlLnNsaWNlKCk7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHZhbHVlLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBpZiAodmFsdWVbaV0gaW5zdGFuY2VvZiBSZWYgJiYgdGhpcy54cmVmKSB7CiAgICAgICAgICB2YWx1ZVtpXSA9IHRoaXMueHJlZi5mZXRjaCh2YWx1ZVtpXSwgdGhpcy5zdXBwcmVzc0VuY3J5cHRpb24pOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHZhbHVlOwogIH0KICBnZXRSYXcoa2V5KSB7CiAgICByZXR1cm4gdGhpcy5fbWFwLmdldChrZXkpOwogIH0KICBnZXRLZXlzKCkgewogICAgcmV0dXJuIFsuLi50aGlzLl9tYXAua2V5cygpXTsKICB9CiAgZ2V0UmF3VmFsdWVzKCkgewogICAgcmV0dXJuIFsuLi50aGlzLl9tYXAudmFsdWVzKCldOwogIH0KICBzZXQoa2V5LCB2YWx1ZSkgewogICAgdGhpcy5fbWFwLnNldChrZXksIHZhbHVlKTsKICB9CiAgc2V0SWZOb3RFeGlzdHMoa2V5LCB2YWx1ZSkgewogICAgaWYgKCF0aGlzLmhhcyhrZXkpKSB7CiAgICAgIHRoaXMuc2V0KGtleSwgdmFsdWUpOwogICAgfQogIH0KICBzZXRJZk51bWJlcihrZXksIHZhbHVlKSB7CiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAibnVtYmVyIikgewogICAgICB0aGlzLnNldChrZXksIHZhbHVlKTsKICAgIH0KICB9CiAgc2V0SWZBcnJheShrZXksIHZhbHVlKSB7CiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkgfHwgQXJyYXlCdWZmZXIuaXNWaWV3KHZhbHVlKSkgewogICAgICB0aGlzLnNldChrZXksIHZhbHVlKTsKICAgIH0KICB9CiAgc2V0SWZEZWZpbmVkKGtleSwgdmFsdWUpIHsKICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBudWxsKSB7CiAgICAgIHRoaXMuc2V0KGtleSwgdmFsdWUpOwogICAgfQogIH0KICBzZXRJZk5hbWUoa2V5LCB2YWx1ZSkgewogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIpIHsKICAgICAgdGhpcy5zZXQoa2V5LCBOYW1lLmdldCh2YWx1ZSkpOwogICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgdGhpcy5zZXQoa2V5LCB2YWx1ZSk7CiAgICB9CiAgfQogIGhhcyhrZXkpIHsKICAgIHJldHVybiB0aGlzLl9tYXAuaGFzKGtleSk7CiAgfQogICpbU3ltYm9sLml0ZXJhdG9yXSgpIHsKICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHRoaXMuX21hcCkgewogICAgICB5aWVsZCBba2V5LCB2YWx1ZSBpbnN0YW5jZW9mIFJlZiAmJiB0aGlzLnhyZWYgPyB0aGlzLnhyZWYuZmV0Y2godmFsdWUsIHRoaXMuc3VwcHJlc3NFbmNyeXB0aW9uKSA6IHZhbHVlXTsKICAgIH0KICB9CiAgc3RhdGljIGdldCBlbXB0eSgpIHsKICAgIGNvbnN0IGVtcHR5RGljdCA9IG5ldyBEaWN0KG51bGwpOwogICAgZW1wdHlEaWN0LnNldCA9IChrZXksIHZhbHVlKSA9PiB7CiAgICAgIHVucmVhY2hhYmxlKCJTaG91bGQgbm90IGNhbGwgYHNldGAgb24gdGhlIGVtcHR5IGRpY3Rpb25hcnkuIik7CiAgICB9OwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZW1wdHkiLCBlbXB0eURpY3QpOwogIH0KICBzdGF0aWMgbWVyZ2UoewogICAgeHJlZiwKICAgIGRpY3RBcnJheSwKICAgIG1lcmdlU3ViRGljdHMgPSBmYWxzZQogIH0pIHsKICAgIGNvbnN0IG1lcmdlZERpY3QgPSBuZXcgRGljdCh4cmVmKSwKICAgICAgcHJvcGVydGllcyA9IG5ldyBNYXAoKTsKICAgIGZvciAoY29uc3QgZGljdCBvZiBkaWN0QXJyYXkpIHsKICAgICAgaWYgKCEoZGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgZGljdC5fbWFwKSB7CiAgICAgICAgbGV0IHByb3BlcnR5ID0gcHJvcGVydGllcy5nZXQoa2V5KTsKICAgICAgICBpZiAocHJvcGVydHkgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcHJvcGVydHkgPSBbXTsKICAgICAgICAgIHByb3BlcnRpZXMuc2V0KGtleSwgcHJvcGVydHkpOwogICAgICAgIH0gZWxzZSBpZiAoIW1lcmdlU3ViRGljdHMgfHwgISh2YWx1ZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgcHJvcGVydHkucHVzaCh2YWx1ZSk7CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3QgW25hbWUsIHZhbHVlc10gb2YgcHJvcGVydGllcykgewogICAgICBpZiAodmFsdWVzLmxlbmd0aCA9PT0gMSB8fCAhKHZhbHVlc1swXSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgbWVyZ2VkRGljdC5fbWFwLnNldChuYW1lLCB2YWx1ZXNbMF0pOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHN1YkRpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgICAgZm9yIChjb25zdCBkaWN0IG9mIHZhbHVlcykgewogICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIGRpY3QuX21hcCkgewogICAgICAgICAgaWYgKCFzdWJEaWN0Ll9tYXAuaGFzKGtleSkpIHsKICAgICAgICAgICAgc3ViRGljdC5fbWFwLnNldChrZXksIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHN1YkRpY3Quc2l6ZSA+IDApIHsKICAgICAgICBtZXJnZWREaWN0Ll9tYXAuc2V0KG5hbWUsIHN1YkRpY3QpOwogICAgICB9CiAgICB9CiAgICBwcm9wZXJ0aWVzLmNsZWFyKCk7CiAgICByZXR1cm4gbWVyZ2VkRGljdC5zaXplID4gMCA/IG1lcmdlZERpY3QgOiBEaWN0LmVtcHR5OwogIH0KICBjbG9uZSgpIHsKICAgIGNvbnN0IGRpY3QgPSBuZXcgRGljdCh0aGlzLnhyZWYpOwogICAgZm9yIChjb25zdCBrZXkgb2YgdGhpcy5nZXRLZXlzKCkpIHsKICAgICAgZGljdC5zZXQoa2V5LCB0aGlzLmdldFJhdyhrZXkpKTsKICAgIH0KICAgIHJldHVybiBkaWN0OwogIH0KICBkZWxldGUoa2V5KSB7CiAgICBkZWxldGUgdGhpcy5fbWFwW2tleV07CiAgfQp9CmNsYXNzIFJlZiB7CiAgY29uc3RydWN0b3IobnVtLCBnZW4pIHsKICAgIHRoaXMubnVtID0gbnVtOwogICAgdGhpcy5nZW4gPSBnZW47CiAgfQogIHRvU3RyaW5nKCkgewogICAgaWYgKHRoaXMuZ2VuID09PSAwKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLm51bX1SYDsKICAgIH0KICAgIHJldHVybiBgJHt0aGlzLm51bX1SJHt0aGlzLmdlbn1gOwogIH0KICBzdGF0aWMgZnJvbVN0cmluZyhzdHIpIHsKICAgIGNvbnN0IHJlZiA9IFJlZkNhY2hlW3N0cl07CiAgICBpZiAocmVmKSB7CiAgICAgIHJldHVybiByZWY7CiAgICB9CiAgICBjb25zdCBtID0gL14oXGQrKVIoXGQqKSQvLmV4ZWMoc3RyKTsKICAgIGlmICghbSB8fCBtWzFdID09PSAiMCIpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICByZXR1cm4gUmVmQ2FjaGVbc3RyXSA9IG5ldyBSZWYocGFyc2VJbnQobVsxXSksICFtWzJdID8gMCA6IHBhcnNlSW50KG1bMl0pKTsKICB9CiAgc3RhdGljIGdldChudW0sIGdlbikgewogICAgY29uc3Qga2V5ID0gZ2VuID09PSAwID8gYCR7bnVtfVJgIDogYCR7bnVtfVIke2dlbn1gOwogICAgcmV0dXJuIFJlZkNhY2hlW2tleV0gfHw9IG5ldyBSZWYobnVtLCBnZW4pOwogIH0KfQpjbGFzcyBSZWZTZXQgewogIGNvbnN0cnVjdG9yKHBhcmVudCA9IG51bGwpIHsKICAgIHRoaXMuX3NldCA9IG5ldyBTZXQocGFyZW50Py5fc2V0KTsKICB9CiAgaGFzKHJlZikgewogICAgcmV0dXJuIHRoaXMuX3NldC5oYXMocmVmLnRvU3RyaW5nKCkpOwogIH0KICBwdXQocmVmKSB7CiAgICB0aGlzLl9zZXQuYWRkKHJlZi50b1N0cmluZygpKTsKICB9CiAgcmVtb3ZlKHJlZikgewogICAgdGhpcy5fc2V0LmRlbGV0ZShyZWYudG9TdHJpbmcoKSk7CiAgfQogIFtTeW1ib2wuaXRlcmF0b3JdKCkgewogICAgcmV0dXJuIHRoaXMuX3NldC52YWx1ZXMoKTsKICB9CiAgY2xlYXIoKSB7CiAgICB0aGlzLl9zZXQuY2xlYXIoKTsKICB9Cn0KY2xhc3MgUmVmU2V0Q2FjaGUgewogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5fbWFwID0gbmV3IE1hcCgpOwogIH0KICBnZXQgc2l6ZSgpIHsKICAgIHJldHVybiB0aGlzLl9tYXAuc2l6ZTsKICB9CiAgZ2V0KHJlZikgewogICAgcmV0dXJuIHRoaXMuX21hcC5nZXQocmVmLnRvU3RyaW5nKCkpOwogIH0KICBoYXMocmVmKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwLmhhcyhyZWYudG9TdHJpbmcoKSk7CiAgfQogIHB1dChyZWYsIG9iaikgewogICAgdGhpcy5fbWFwLnNldChyZWYudG9TdHJpbmcoKSwgb2JqKTsKICB9CiAgcHV0QWxpYXMocmVmLCBhbGlhc1JlZikgewogICAgdGhpcy5fbWFwLnNldChyZWYudG9TdHJpbmcoKSwgdGhpcy5nZXQoYWxpYXNSZWYpKTsKICB9CiAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwLnZhbHVlcygpOwogIH0KICBjbGVhcigpIHsKICAgIHRoaXMuX21hcC5jbGVhcigpOwogIH0KICAqdmFsdWVzKCkgewogICAgeWllbGQqIHRoaXMuX21hcC52YWx1ZXMoKTsKICB9CiAgKml0ZW1zKCkgewogICAgZm9yIChjb25zdCBbcmVmLCB2YWx1ZV0gb2YgdGhpcy5fbWFwKSB7CiAgICAgIHlpZWxkIFtSZWYuZnJvbVN0cmluZyhyZWYpLCB2YWx1ZV07CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGlzTmFtZSh2LCBuYW1lKSB7CiAgcmV0dXJuIHYgaW5zdGFuY2VvZiBOYW1lICYmIChuYW1lID09PSB1bmRlZmluZWQgfHwgdi5uYW1lID09PSBuYW1lKTsKfQpmdW5jdGlvbiBpc0NtZCh2LCBjbWQpIHsKICByZXR1cm4gdiBpbnN0YW5jZW9mIENtZCAmJiAoY21kID09PSB1bmRlZmluZWQgfHwgdi5jbWQgPT09IGNtZCk7Cn0KZnVuY3Rpb24gaXNEaWN0KHYsIHR5cGUpIHsKICByZXR1cm4gdiBpbnN0YW5jZW9mIERpY3QgJiYgKHR5cGUgPT09IHVuZGVmaW5lZCB8fCBpc05hbWUodi5nZXQoIlR5cGUiKSwgdHlwZSkpOwp9CmZ1bmN0aW9uIGlzUmVmc0VxdWFsKHYxLCB2MikgewogIHJldHVybiB2MS5udW0gPT09IHYyLm51bSAmJiB2MS5nZW4gPT09IHYyLmdlbjsKfQoKOy8vIC4vc3JjL2NvcmUvYmFzZV9zdHJlYW0uanMKCmNsYXNzIEJhc2VTdHJlYW0gewogIGdldCBsZW5ndGgoKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgZ2V0dGVyIGBsZW5ndGhgIGFjY2Vzc2VkIik7CiAgfQogIGdldCBpc0VtcHR5KCkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IGdldHRlciBgaXNFbXB0eWAgYWNjZXNzZWQiKTsKICB9CiAgZ2V0IGlzRGF0YUxvYWRlZCgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImlzRGF0YUxvYWRlZCIsIHRydWUpOwogIH0KICBnZXRCeXRlKCkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgZ2V0Qnl0ZWAgY2FsbGVkIik7CiAgfQogIGdldEJ5dGVzKGxlbmd0aCkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgZ2V0Qnl0ZXNgIGNhbGxlZCIpOwogIH0KICBhc3luYyBnZXRJbWFnZURhdGEobGVuZ3RoLCBkZWNvZGVyT3B0aW9ucykgewogICAgcmV0dXJuIHRoaXMuZ2V0Qnl0ZXMobGVuZ3RoLCBkZWNvZGVyT3B0aW9ucyk7CiAgfQogIGFzeW5jIGFzeW5jR2V0Qnl0ZXMoKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBhc3luY0dldEJ5dGVzYCBjYWxsZWQiKTsKICB9CiAgZ2V0IGlzQXN5bmMoKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGdldCBpc0FzeW5jRGVjb2RlcigpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgZ2V0IGNhbkFzeW5jRGVjb2RlSW1hZ2VGcm9tQnVmZmVyKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBhc3luYyBnZXRUcmFuc2ZlcmFibGVJbWFnZSgpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBwZWVrQnl0ZSgpIHsKICAgIGNvbnN0IHBlZWtlZEJ5dGUgPSB0aGlzLmdldEJ5dGUoKTsKICAgIGlmIChwZWVrZWRCeXRlICE9PSAtMSkgewogICAgICB0aGlzLnBvcy0tOwogICAgfQogICAgcmV0dXJuIHBlZWtlZEJ5dGU7CiAgfQogIHBlZWtCeXRlcyhsZW5ndGgpIHsKICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5nZXRCeXRlcyhsZW5ndGgpOwogICAgdGhpcy5wb3MgLT0gYnl0ZXMubGVuZ3RoOwogICAgcmV0dXJuIGJ5dGVzOwogIH0KICBnZXRVaW50MTYoKSB7CiAgICBjb25zdCBiMCA9IHRoaXMuZ2V0Qnl0ZSgpOwogICAgY29uc3QgYjEgPSB0aGlzLmdldEJ5dGUoKTsKICAgIGlmIChiMCA9PT0gLTEgfHwgYjEgPT09IC0xKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIHJldHVybiAoYjAgPDwgOCkgKyBiMTsKICB9CiAgZ2V0SW50MzIoKSB7CiAgICBjb25zdCBiMCA9IHRoaXMuZ2V0Qnl0ZSgpOwogICAgY29uc3QgYjEgPSB0aGlzLmdldEJ5dGUoKTsKICAgIGNvbnN0IGIyID0gdGhpcy5nZXRCeXRlKCk7CiAgICBjb25zdCBiMyA9IHRoaXMuZ2V0Qnl0ZSgpOwogICAgcmV0dXJuIChiMCA8PCAyNCkgKyAoYjEgPDwgMTYpICsgKGIyIDw8IDgpICsgYjM7CiAgfQogIGdldEJ5dGVSYW5nZShiZWdpbiwgZW5kKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBnZXRCeXRlUmFuZ2VgIGNhbGxlZCIpOwogIH0KICBnZXRTdHJpbmcobGVuZ3RoKSB7CiAgICByZXR1cm4gYnl0ZXNUb1N0cmluZyh0aGlzLmdldEJ5dGVzKGxlbmd0aCkpOwogIH0KICBza2lwKG4pIHsKICAgIHRoaXMucG9zICs9IG4gfHwgMTsKICB9CiAgcmVzZXQoKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGByZXNldGAgY2FsbGVkIik7CiAgfQogIG1vdmVTdGFydCgpIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYG1vdmVTdGFydGAgY2FsbGVkIik7CiAgfQogIG1ha2VTdWJTdHJlYW0oc3RhcnQsIGxlbmd0aCwgZGljdCA9IG51bGwpIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYG1ha2VTdWJTdHJlYW1gIGNhbGxlZCIpOwogIH0KICBnZXRCYXNlU3RyZWFtcygpIHsKICAgIHJldHVybiBudWxsOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY29yZV91dGlscy5qcwoKCgpjb25zdCBQREZfVkVSU0lPTl9SRUdFWFAgPSAvXlsxLTldXC5cZCQvOwpjb25zdCBNQVhfSU5UXzMyID0gMiAqKiAzMSAtIDE7CmNvbnN0IE1JTl9JTlRfMzIgPSAtKDIgKiogMzEpOwpjb25zdCBJREVOVElUWV9NQVRSSVggPSBbMSwgMCwgMCwgMSwgMCwgMF07CmNvbnN0IFJFU09VUkNFU19LRVlTX09QRVJBVE9SX0xJU1QgPSBbIkNvbG9yU3BhY2UiLCAiRXh0R1N0YXRlIiwgIkZvbnQiLCAiUGF0dGVybiIsICJQcm9wZXJ0aWVzIiwgIlNoYWRpbmciLCAiWE9iamVjdCJdOwpjb25zdCBSRVNPVVJDRVNfS0VZU19URVhUX0NPTlRFTlQgPSBbIkV4dEdTdGF0ZSIsICJGb250IiwgIlByb3BlcnRpZXMiLCAiWE9iamVjdCJdOwpmdW5jdGlvbiBnZXRMb29rdXBUYWJsZUZhY3RvcnkoaW5pdGlhbGl6ZXIpIHsKICBsZXQgbG9va3VwOwogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICBpZiAoaW5pdGlhbGl6ZXIpIHsKICAgICAgbG9va3VwID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgaW5pdGlhbGl6ZXIobG9va3VwKTsKICAgICAgaW5pdGlhbGl6ZXIgPSBudWxsOwogICAgfQogICAgcmV0dXJuIGxvb2t1cDsKICB9Owp9CmNsYXNzIE1pc3NpbmdEYXRhRXhjZXB0aW9uIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IoYmVnaW4sIGVuZCkgewogICAgc3VwZXIoYE1pc3NpbmcgZGF0YSBbJHtiZWdpbn0sICR7ZW5kfSlgLCAiTWlzc2luZ0RhdGFFeGNlcHRpb24iKTsKICAgIHRoaXMuYmVnaW4gPSBiZWdpbjsKICAgIHRoaXMuZW5kID0gZW5kOwogIH0KfQpjbGFzcyBQYXJzZXJFT0ZFeGNlcHRpb24gZXh0ZW5kcyBCYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2cpIHsKICAgIHN1cGVyKG1zZywgIlBhcnNlckVPRkV4Y2VwdGlvbiIpOwogIH0KfQpjbGFzcyBYUmVmRW50cnlFeGNlcHRpb24gZXh0ZW5kcyBCYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2cpIHsKICAgIHN1cGVyKG1zZywgIlhSZWZFbnRyeUV4Y2VwdGlvbiIpOwogIH0KfQpjbGFzcyBYUmVmUGFyc2VFeGNlcHRpb24gZXh0ZW5kcyBCYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2cpIHsKICAgIHN1cGVyKG1zZywgIlhSZWZQYXJzZUV4Y2VwdGlvbiIpOwogIH0KfQpmdW5jdGlvbiBhcnJheUJ1ZmZlcnNUb0J5dGVzKGFycikgewogIGNvbnN0IGxlbmd0aCA9IGFyci5sZW5ndGg7CiAgaWYgKGxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KDApOwogIH0KICBpZiAobGVuZ3RoID09PSAxKSB7CiAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYXJyWzBdKTsKICB9CiAgbGV0IGRhdGFMZW5ndGggPSAwOwogIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgIGRhdGFMZW5ndGggKz0gYXJyW2ldLmJ5dGVMZW5ndGg7CiAgfQogIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShkYXRhTGVuZ3RoKTsKICBsZXQgcG9zID0gMDsKICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCBpdGVtID0gbmV3IFVpbnQ4QXJyYXkoYXJyW2ldKTsKICAgIGRhdGEuc2V0KGl0ZW0sIHBvcyk7CiAgICBwb3MgKz0gaXRlbS5ieXRlTGVuZ3RoOwogIH0KICByZXR1cm4gZGF0YTsKfQphc3luYyBmdW5jdGlvbiBmZXRjaEJpbmFyeURhdGEodXJsKSB7CiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwpOwogIGlmICghcmVzcG9uc2Uub2spIHsKICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIGZpbGUgIiR7dXJsfSIgd2l0aCAiJHtyZXNwb25zZS5zdGF0dXNUZXh0fSIuYCk7CiAgfQogIHJldHVybiBuZXcgVWludDhBcnJheShhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpKTsKfQpmdW5jdGlvbiBnZXRJbmhlcml0YWJsZVByb3BlcnR5KHsKICBkaWN0LAogIGtleSwKICBnZXRBcnJheSA9IGZhbHNlLAogIHN0b3BXaGVuRm91bmQgPSB0cnVlCn0pIHsKICBsZXQgdmFsdWVzOwogIGNvbnN0IHZpc2l0ZWQgPSBuZXcgUmVmU2V0KCk7CiAgd2hpbGUgKGRpY3QgaW5zdGFuY2VvZiBEaWN0ICYmICEoZGljdC5vYmpJZCAmJiB2aXNpdGVkLmhhcyhkaWN0Lm9iaklkKSkpIHsKICAgIGlmIChkaWN0Lm9iaklkKSB7CiAgICAgIHZpc2l0ZWQucHV0KGRpY3Qub2JqSWQpOwogICAgfQogICAgY29uc3QgdmFsdWUgPSBnZXRBcnJheSA/IGRpY3QuZ2V0QXJyYXkoa2V5KSA6IGRpY3QuZ2V0KGtleSk7CiAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICBpZiAoc3RvcFdoZW5Gb3VuZCkgewogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfQogICAgICAodmFsdWVzIHx8PSBbXSkucHVzaCh2YWx1ZSk7CiAgICB9CiAgICBkaWN0ID0gZGljdC5nZXQoIlBhcmVudCIpOwogIH0KICByZXR1cm4gdmFsdWVzOwp9CmZ1bmN0aW9uIGdldFBhcmVudFRvVXBkYXRlKGRpY3QsIHJlZiwgeHJlZikgewogIGNvbnN0IHZpc2l0ZWQgPSBuZXcgUmVmU2V0KCk7CiAgY29uc3QgZmlyc3REaWN0ID0gZGljdDsKICBjb25zdCByZXN1bHQgPSB7CiAgICBkaWN0OiBudWxsLAogICAgcmVmOiBudWxsCiAgfTsKICB3aGlsZSAoZGljdCBpbnN0YW5jZW9mIERpY3QgJiYgIXZpc2l0ZWQuaGFzKHJlZikpIHsKICAgIHZpc2l0ZWQucHV0KHJlZik7CiAgICBpZiAoZGljdC5oYXMoIlQiKSkgewogICAgICBicmVhazsKICAgIH0KICAgIHJlZiA9IGRpY3QuZ2V0UmF3KCJQYXJlbnQiKTsKICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIFJlZikpIHsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIGRpY3QgPSB4cmVmLmZldGNoKHJlZik7CiAgfQogIGlmIChkaWN0IGluc3RhbmNlb2YgRGljdCAmJiBkaWN0ICE9PSBmaXJzdERpY3QpIHsKICAgIHJlc3VsdC5kaWN0ID0gZGljdDsKICAgIHJlc3VsdC5yZWYgPSByZWY7CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KY29uc3QgUk9NQU5fTlVNQkVSX01BUCA9IFsiIiwgIkMiLCAiQ0MiLCAiQ0NDIiwgIkNEIiwgIkQiLCAiREMiLCAiRENDIiwgIkRDQ0MiLCAiQ00iLCAiIiwgIlgiLCAiWFgiLCAiWFhYIiwgIlhMIiwgIkwiLCAiTFgiLCAiTFhYIiwgIkxYWFgiLCAiWEMiLCAiIiwgIkkiLCAiSUkiLCAiSUlJIiwgIklWIiwgIlYiLCAiVkkiLCAiVklJIiwgIlZJSUkiLCAiSVgiXTsKZnVuY3Rpb24gdG9Sb21hbk51bWVyYWxzKG51bWJlciwgbG93ZXJDYXNlID0gZmFsc2UpIHsKICBhc3NlcnQoTnVtYmVyLmlzSW50ZWdlcihudW1iZXIpICYmIG51bWJlciA+IDAsICJUaGUgbnVtYmVyIHNob3VsZCBiZSBhIHBvc2l0aXZlIGludGVnZXIuIik7CiAgY29uc3Qgcm9tYW4gPSAiTSIucmVwZWF0KG51bWJlciAvIDEwMDAgfCAwKSArIFJPTUFOX05VTUJFUl9NQVBbbnVtYmVyICUgMTAwMCAvIDEwMCB8IDBdICsgUk9NQU5fTlVNQkVSX01BUFsxMCArIChudW1iZXIgJSAxMDAgLyAxMCB8IDApXSArIFJPTUFOX05VTUJFUl9NQVBbMjAgKyBudW1iZXIgJSAxMF07CiAgcmV0dXJuIGxvd2VyQ2FzZSA/IHJvbWFuLnRvTG93ZXJDYXNlKCkgOiByb21hbjsKfQpmdW5jdGlvbiBsb2cyKHgpIHsKICByZXR1cm4geCA+IDAgPyBNYXRoLmNlaWwoTWF0aC5sb2cyKHgpKSA6IDA7Cn0KZnVuY3Rpb24gcmVhZEludDgoZGF0YSwgb2Zmc2V0KSB7CiAgcmV0dXJuIGRhdGFbb2Zmc2V0XSA8PCAyNCA+PiAyNDsKfQpmdW5jdGlvbiByZWFkSW50MTYoZGF0YSwgb2Zmc2V0KSB7CiAgcmV0dXJuIChkYXRhW29mZnNldF0gPDwgMjQgfCBkYXRhW29mZnNldCArIDFdIDw8IDE2KSA+PiAxNjsKfQpmdW5jdGlvbiByZWFkVWludDE2KGRhdGEsIG9mZnNldCkgewogIHJldHVybiBkYXRhW29mZnNldF0gPDwgOCB8IGRhdGFbb2Zmc2V0ICsgMV07Cn0KZnVuY3Rpb24gcmVhZFVpbnQzMihkYXRhLCBvZmZzZXQpIHsKICByZXR1cm4gKGRhdGFbb2Zmc2V0XSA8PCAyNCB8IGRhdGFbb2Zmc2V0ICsgMV0gPDwgMTYgfCBkYXRhW29mZnNldCArIDJdIDw8IDggfCBkYXRhW29mZnNldCArIDNdKSA+Pj4gMDsKfQpmdW5jdGlvbiBpc1doaXRlU3BhY2UoY2gpIHsKICByZXR1cm4gY2ggPT09IDB4MjAgfHwgY2ggPT09IDB4MDkgfHwgY2ggPT09IDB4MGQgfHwgY2ggPT09IDB4MGE7Cn0KZnVuY3Rpb24gaXNCb29sZWFuQXJyYXkoYXJyLCBsZW4pIHsKICByZXR1cm4gQXJyYXkuaXNBcnJheShhcnIpICYmIChsZW4gPT09IG51bGwgfHwgYXJyLmxlbmd0aCA9PT0gbGVuKSAmJiBhcnIuZXZlcnkoeCA9PiB0eXBlb2YgeCA9PT0gImJvb2xlYW4iKTsKfQpmdW5jdGlvbiBpc051bWJlckFycmF5KGFyciwgbGVuKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgewogICAgcmV0dXJuIChsZW4gPT09IG51bGwgfHwgYXJyLmxlbmd0aCA9PT0gbGVuKSAmJiBhcnIuZXZlcnkoeCA9PiB0eXBlb2YgeCA9PT0gIm51bWJlciIpOwogIH0KICByZXR1cm4gQXJyYXlCdWZmZXIuaXNWaWV3KGFycikgJiYgIShhcnIgaW5zdGFuY2VvZiBCaWdJbnQ2NEFycmF5IHx8IGFyciBpbnN0YW5jZW9mIEJpZ1VpbnQ2NEFycmF5KSAmJiAobGVuID09PSBudWxsIHx8IGFyci5sZW5ndGggPT09IGxlbik7Cn0KZnVuY3Rpb24gbG9va3VwTWF0cml4KGFyciwgZmFsbGJhY2spIHsKICByZXR1cm4gaXNOdW1iZXJBcnJheShhcnIsIDYpID8gYXJyIDogZmFsbGJhY2s7Cn0KZnVuY3Rpb24gbG9va3VwUmVjdChhcnIsIGZhbGxiYWNrKSB7CiAgcmV0dXJuIGlzTnVtYmVyQXJyYXkoYXJyLCA0KSA/IGFyciA6IGZhbGxiYWNrOwp9CmZ1bmN0aW9uIGxvb2t1cE5vcm1hbFJlY3QoYXJyLCBmYWxsYmFjaykgewogIHJldHVybiBpc051bWJlckFycmF5KGFyciwgNCkgPyBVdGlsLm5vcm1hbGl6ZVJlY3QoYXJyKSA6IGZhbGxiYWNrOwp9CmZ1bmN0aW9uIHBhcnNlWEZBUGF0aChwYXRoKSB7CiAgY29uc3QgcG9zaXRpb25QYXR0ZXJuID0gLyguKylcWyhcZCspXF0kLzsKICByZXR1cm4gcGF0aC5zcGxpdCgiLiIpLm1hcChjb21wb25lbnQgPT4gewogICAgY29uc3QgbSA9IGNvbXBvbmVudC5tYXRjaChwb3NpdGlvblBhdHRlcm4pOwogICAgaWYgKG0pIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiBtWzFdLAogICAgICAgIHBvczogcGFyc2VJbnQobVsyXSwgMTApCiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gewogICAgICBuYW1lOiBjb21wb25lbnQsCiAgICAgIHBvczogMAogICAgfTsKICB9KTsKfQpmdW5jdGlvbiBlc2NhcGVQREZOYW1lKHN0cikgewogIGNvbnN0IGJ1ZmZlciA9IFtdOwogIGxldCBzdGFydCA9IDA7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3RyLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGNvbnN0IGNoYXIgPSBzdHIuY2hhckNvZGVBdChpKTsKICAgIGlmIChjaGFyIDwgMHgyMSB8fCBjaGFyID4gMHg3ZSB8fCBjaGFyID09PSAweDIzIHx8IGNoYXIgPT09IDB4MjggfHwgY2hhciA9PT0gMHgyOSB8fCBjaGFyID09PSAweDNjIHx8IGNoYXIgPT09IDB4M2UgfHwgY2hhciA9PT0gMHg1YiB8fCBjaGFyID09PSAweDVkIHx8IGNoYXIgPT09IDB4N2IgfHwgY2hhciA9PT0gMHg3ZCB8fCBjaGFyID09PSAweDJmIHx8IGNoYXIgPT09IDB4MjUpIHsKICAgICAgaWYgKHN0YXJ0IDwgaSkgewogICAgICAgIGJ1ZmZlci5wdXNoKHN0ci5zdWJzdHJpbmcoc3RhcnQsIGkpKTsKICAgICAgfQogICAgICBidWZmZXIucHVzaChgIyR7Y2hhci50b1N0cmluZygxNil9YCk7CiAgICAgIHN0YXJ0ID0gaSArIDE7CiAgICB9CiAgfQogIGlmIChidWZmZXIubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gc3RyOwogIH0KICBpZiAoc3RhcnQgPCBzdHIubGVuZ3RoKSB7CiAgICBidWZmZXIucHVzaChzdHIuc3Vic3RyaW5nKHN0YXJ0LCBzdHIubGVuZ3RoKSk7CiAgfQogIHJldHVybiBidWZmZXIuam9pbigiIik7Cn0KZnVuY3Rpb24gZXNjYXBlU3RyaW5nKHN0cikgewogIHJldHVybiBzdHIucmVwbGFjZUFsbCgvKFsoKVxcXG5ccl0pL2csIG1hdGNoID0+IHsKICAgIGlmIChtYXRjaCA9PT0gIlxuIikgewogICAgICByZXR1cm4gIlxcbiI7CiAgICB9IGVsc2UgaWYgKG1hdGNoID09PSAiXHIiKSB7CiAgICAgIHJldHVybiAiXFxyIjsKICAgIH0KICAgIHJldHVybiBgXFwke21hdGNofWA7CiAgfSk7Cn0KZnVuY3Rpb24gX2NvbGxlY3RKUyhlbnRyeSwgeHJlZiwgbGlzdCwgcGFyZW50cykgewogIGlmICghZW50cnkpIHsKICAgIHJldHVybjsKICB9CiAgbGV0IHBhcmVudCA9IG51bGw7CiAgaWYgKGVudHJ5IGluc3RhbmNlb2YgUmVmKSB7CiAgICBpZiAocGFyZW50cy5oYXMoZW50cnkpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHBhcmVudCA9IGVudHJ5OwogICAgcGFyZW50cy5wdXQocGFyZW50KTsKICAgIGVudHJ5ID0geHJlZi5mZXRjaChlbnRyeSk7CiAgfQogIGlmIChBcnJheS5pc0FycmF5KGVudHJ5KSkgewogICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVudHJ5KSB7CiAgICAgIF9jb2xsZWN0SlMoZWxlbWVudCwgeHJlZiwgbGlzdCwgcGFyZW50cyk7CiAgICB9CiAgfSBlbHNlIGlmIChlbnRyeSBpbnN0YW5jZW9mIERpY3QpIHsKICAgIGlmIChpc05hbWUoZW50cnkuZ2V0KCJTIiksICJKYXZhU2NyaXB0IikpIHsKICAgICAgY29uc3QganMgPSBlbnRyeS5nZXQoIkpTIik7CiAgICAgIGxldCBjb2RlOwogICAgICBpZiAoanMgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgICAgY29kZSA9IGpzLmdldFN0cmluZygpOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBqcyA9PT0gInN0cmluZyIpIHsKICAgICAgICBjb2RlID0ganM7CiAgICAgIH0KICAgICAgY29kZSAmJj0gc3RyaW5nVG9QREZTdHJpbmcoY29kZSwgdHJ1ZSkucmVwbGFjZUFsbCgiXHgwMCIsICIiKTsKICAgICAgaWYgKGNvZGUpIHsKICAgICAgICBsaXN0LnB1c2goY29kZS50cmltKCkpOwogICAgICB9CiAgICB9CiAgICBfY29sbGVjdEpTKGVudHJ5LmdldFJhdygiTmV4dCIpLCB4cmVmLCBsaXN0LCBwYXJlbnRzKTsKICB9CiAgaWYgKHBhcmVudCkgewogICAgcGFyZW50cy5yZW1vdmUocGFyZW50KTsKICB9Cn0KZnVuY3Rpb24gY29sbGVjdEFjdGlvbnMoeHJlZiwgZGljdCwgZXZlbnRUeXBlKSB7CiAgY29uc3QgYWN0aW9ucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgY29uc3QgYWRkaXRpb25hbEFjdGlvbnNEaWN0cyA9IGdldEluaGVyaXRhYmxlUHJvcGVydHkoewogICAgZGljdCwKICAgIGtleTogIkFBIiwKICAgIHN0b3BXaGVuRm91bmQ6IGZhbHNlCiAgfSk7CiAgaWYgKGFkZGl0aW9uYWxBY3Rpb25zRGljdHMpIHsKICAgIGZvciAobGV0IGkgPSBhZGRpdGlvbmFsQWN0aW9uc0RpY3RzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgIGNvbnN0IGFkZGl0aW9uYWxBY3Rpb25zID0gYWRkaXRpb25hbEFjdGlvbnNEaWN0c1tpXTsKICAgICAgaWYgKCEoYWRkaXRpb25hbEFjdGlvbnMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAoY29uc3Qga2V5IG9mIGFkZGl0aW9uYWxBY3Rpb25zLmdldEtleXMoKSkgewogICAgICAgIGNvbnN0IGFjdGlvbiA9IGV2ZW50VHlwZVtrZXldOwogICAgICAgIGlmICghYWN0aW9uKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYWN0aW9uRGljdCA9IGFkZGl0aW9uYWxBY3Rpb25zLmdldFJhdyhrZXkpOwogICAgICAgIGNvbnN0IHBhcmVudHMgPSBuZXcgUmVmU2V0KCk7CiAgICAgICAgY29uc3QgbGlzdCA9IFtdOwogICAgICAgIF9jb2xsZWN0SlMoYWN0aW9uRGljdCwgeHJlZiwgbGlzdCwgcGFyZW50cyk7CiAgICAgICAgaWYgKGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgYWN0aW9uc1thY3Rpb25dID0gbGlzdDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgaWYgKGRpY3QuaGFzKCJBIikpIHsKICAgIGNvbnN0IGFjdGlvbkRpY3QgPSBkaWN0LmdldCgiQSIpOwogICAgY29uc3QgcGFyZW50cyA9IG5ldyBSZWZTZXQoKTsKICAgIGNvbnN0IGxpc3QgPSBbXTsKICAgIF9jb2xsZWN0SlMoYWN0aW9uRGljdCwgeHJlZiwgbGlzdCwgcGFyZW50cyk7CiAgICBpZiAobGlzdC5sZW5ndGggPiAwKSB7CiAgICAgIGFjdGlvbnMuQWN0aW9uID0gbGlzdDsKICAgIH0KICB9CiAgcmV0dXJuIG9iamVjdFNpemUoYWN0aW9ucykgPiAwID8gYWN0aW9ucyA6IG51bGw7Cn0KY29uc3QgWE1MRW50aXRpZXMgPSB7CiAgMHgzYzogIiZsdDsiLAogIDB4M2U6ICImZ3Q7IiwKICAweDI2OiAiJmFtcDsiLAogIDB4MjI6ICImcXVvdDsiLAogIDB4Mjc6ICImYXBvczsiCn07CmZ1bmN0aW9uKiBjb2RlUG9pbnRJdGVyKHN0cikgewogIGZvciAobGV0IGkgPSAwLCBpaSA9IHN0ci5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCBjaGFyID0gc3RyLmNvZGVQb2ludEF0KGkpOwogICAgaWYgKGNoYXIgPiAweGQ3ZmYgJiYgKGNoYXIgPCAweGUwMDAgfHwgY2hhciA+IDB4ZmZmZCkpIHsKICAgICAgaSsrOwogICAgfQogICAgeWllbGQgY2hhcjsKICB9Cn0KZnVuY3Rpb24gZW5jb2RlVG9YbWxTdHJpbmcoc3RyKSB7CiAgY29uc3QgYnVmZmVyID0gW107CiAgbGV0IHN0YXJ0ID0gMDsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBzdHIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgY2hhciA9IHN0ci5jb2RlUG9pbnRBdChpKTsKICAgIGlmICgweDIwIDw9IGNoYXIgJiYgY2hhciA8PSAweDdlKSB7CiAgICAgIGNvbnN0IGVudGl0eSA9IFhNTEVudGl0aWVzW2NoYXJdOwogICAgICBpZiAoZW50aXR5KSB7CiAgICAgICAgaWYgKHN0YXJ0IDwgaSkgewogICAgICAgICAgYnVmZmVyLnB1c2goc3RyLnN1YnN0cmluZyhzdGFydCwgaSkpOwogICAgICAgIH0KICAgICAgICBidWZmZXIucHVzaChlbnRpdHkpOwogICAgICAgIHN0YXJ0ID0gaSArIDE7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChzdGFydCA8IGkpIHsKICAgICAgICBidWZmZXIucHVzaChzdHIuc3Vic3RyaW5nKHN0YXJ0LCBpKSk7CiAgICAgIH0KICAgICAgYnVmZmVyLnB1c2goYCYjeCR7Y2hhci50b1N0cmluZygxNikudG9VcHBlckNhc2UoKX07YCk7CiAgICAgIGlmIChjaGFyID4gMHhkN2ZmICYmIChjaGFyIDwgMHhlMDAwIHx8IGNoYXIgPiAweGZmZmQpKSB7CiAgICAgICAgaSsrOwogICAgICB9CiAgICAgIHN0YXJ0ID0gaSArIDE7CiAgICB9CiAgfQogIGlmIChidWZmZXIubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gc3RyOwogIH0KICBpZiAoc3RhcnQgPCBzdHIubGVuZ3RoKSB7CiAgICBidWZmZXIucHVzaChzdHIuc3Vic3RyaW5nKHN0YXJ0LCBzdHIubGVuZ3RoKSk7CiAgfQogIHJldHVybiBidWZmZXIuam9pbigiIik7Cn0KZnVuY3Rpb24gdmFsaWRhdGVGb250TmFtZShmb250RmFtaWx5LCBtdXN0V2FybiA9IGZhbHNlKSB7CiAgY29uc3QgbSA9IC9eKCJ8JykuKigifCcpJC8uZXhlYyhmb250RmFtaWx5KTsKICBpZiAobSAmJiBtWzFdID09PSBtWzJdKSB7CiAgICBjb25zdCByZSA9IG5ldyBSZWdFeHAoYFteXFxcXF0ke21bMV19YCk7CiAgICBpZiAocmUudGVzdChmb250RmFtaWx5LnNsaWNlKDEsIC0xKSkpIHsKICAgICAgaWYgKG11c3RXYXJuKSB7CiAgICAgICAgd2FybihgRm9udEZhbWlseSBjb250YWlucyB1bmVzY2FwZWQgJHttWzFdfTogJHtmb250RmFtaWx5fS5gKTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSBlbHNlIHsKICAgIGZvciAoY29uc3QgaWRlbnQgb2YgZm9udEZhbWlseS5zcGxpdCgvWyBcdF0rLykpIHsKICAgICAgaWYgKC9eKFxkfCgtKFxkfC0pKSkvLnRlc3QoaWRlbnQpIHx8ICEvXltcdy1cXF0rJC8udGVzdChpZGVudCkpIHsKICAgICAgICBpZiAobXVzdFdhcm4pIHsKICAgICAgICAgIHdhcm4oYEZvbnRGYW1pbHkgY29udGFpbnMgaW52YWxpZCA8Y3VzdG9tLWlkZW50PjogJHtmb250RmFtaWx5fS5gKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgfQogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIHZhbGlkYXRlQ1NTRm9udChjc3NGb250SW5mbykgewogIGNvbnN0IERFRkFVTFRfQ1NTX0ZPTlRfT0JMSVFVRSA9ICIxNCI7CiAgY29uc3QgREVGQVVMVF9DU1NfRk9OVF9XRUlHSFQgPSAiNDAwIjsKICBjb25zdCBDU1NfRk9OVF9XRUlHSFRfVkFMVUVTID0gbmV3IFNldChbIjEwMCIsICIyMDAiLCAiMzAwIiwgIjQwMCIsICI1MDAiLCAiNjAwIiwgIjcwMCIsICI4MDAiLCAiOTAwIiwgIjEwMDAiLCAibm9ybWFsIiwgImJvbGQiLCAiYm9sZGVyIiwgImxpZ2h0ZXIiXSk7CiAgY29uc3QgewogICAgZm9udEZhbWlseSwKICAgIGZvbnRXZWlnaHQsCiAgICBpdGFsaWNBbmdsZQogIH0gPSBjc3NGb250SW5mbzsKICBpZiAoIXZhbGlkYXRlRm9udE5hbWUoZm9udEZhbWlseSwgdHJ1ZSkpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgY29uc3Qgd2VpZ2h0ID0gZm9udFdlaWdodCA/IGZvbnRXZWlnaHQudG9TdHJpbmcoKSA6ICIiOwogIGNzc0ZvbnRJbmZvLmZvbnRXZWlnaHQgPSBDU1NfRk9OVF9XRUlHSFRfVkFMVUVTLmhhcyh3ZWlnaHQpID8gd2VpZ2h0IDogREVGQVVMVF9DU1NfRk9OVF9XRUlHSFQ7CiAgY29uc3QgYW5nbGUgPSBwYXJzZUZsb2F0KGl0YWxpY0FuZ2xlKTsKICBjc3NGb250SW5mby5pdGFsaWNBbmdsZSA9IGlzTmFOKGFuZ2xlKSB8fCBhbmdsZSA8IC05MCB8fCBhbmdsZSA+IDkwID8gREVGQVVMVF9DU1NfRk9OVF9PQkxJUVVFIDogaXRhbGljQW5nbGUudG9TdHJpbmcoKTsKICByZXR1cm4gdHJ1ZTsKfQpmdW5jdGlvbiByZWNvdmVySnNVUkwoc3RyKSB7CiAgY29uc3QgVVJMX09QRU5fTUVUSE9EUyA9IFsiYXBwLmxhdW5jaFVSTCIsICJ3aW5kb3cub3BlbiIsICJ4ZmEuaG9zdC5nb3RvVVJMIl07CiAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKCJeXFxzKigiICsgVVJMX09QRU5fTUVUSE9EUy5qb2luKCJ8IikucmVwbGFjZUFsbCgiLiIsICJcXC4iKSArICIpXFwoKD86J3xcIikoW14nXCJdKikoPzonfFwiKSg/OixcXHMqKFxcdyspXFwpfFxcKSkiLCAiaSIpOwogIGNvbnN0IGpzVXJsID0gcmVnZXguZXhlYyhzdHIpOwogIGlmIChqc1VybD8uWzJdKSB7CiAgICByZXR1cm4gewogICAgICB1cmw6IGpzVXJsWzJdLAogICAgICBuZXdXaW5kb3c6IGpzVXJsWzFdID09PSAiYXBwLmxhdW5jaFVSTCIgJiYganNVcmxbM10gPT09ICJ0cnVlIgogICAgfTsKICB9CiAgcmV0dXJuIG51bGw7Cn0KZnVuY3Rpb24gbnVtYmVyVG9TdHJpbmcodmFsdWUpIHsKICBpZiAoTnVtYmVyLmlzSW50ZWdlcih2YWx1ZSkpIHsKICAgIHJldHVybiB2YWx1ZS50b1N0cmluZygpOwogIH0KICBjb25zdCByb3VuZGVkVmFsdWUgPSBNYXRoLnJvdW5kKHZhbHVlICogMTAwKTsKICBpZiAocm91bmRlZFZhbHVlICUgMTAwID09PSAwKSB7CiAgICByZXR1cm4gKHJvdW5kZWRWYWx1ZSAvIDEwMCkudG9TdHJpbmcoKTsKICB9CiAgaWYgKHJvdW5kZWRWYWx1ZSAlIDEwID09PSAwKSB7CiAgICByZXR1cm4gdmFsdWUudG9GaXhlZCgxKTsKICB9CiAgcmV0dXJuIHZhbHVlLnRvRml4ZWQoMik7Cn0KZnVuY3Rpb24gZ2V0TmV3QW5ub3RhdGlvbnNNYXAoYW5ub3RhdGlvblN0b3JhZ2UpIHsKICBpZiAoIWFubm90YXRpb25TdG9yYWdlKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY29uc3QgbmV3QW5ub3RhdGlvbnNCeVBhZ2UgPSBuZXcgTWFwKCk7CiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIGlmICgha2V5LnN0YXJ0c1dpdGgoQW5ub3RhdGlvbkVkaXRvclByZWZpeCkpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBsZXQgYW5ub3RhdGlvbnMgPSBuZXdBbm5vdGF0aW9uc0J5UGFnZS5nZXQodmFsdWUucGFnZUluZGV4KTsKICAgIGlmICghYW5ub3RhdGlvbnMpIHsKICAgICAgYW5ub3RhdGlvbnMgPSBbXTsKICAgICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2Uuc2V0KHZhbHVlLnBhZ2VJbmRleCwgYW5ub3RhdGlvbnMpOwogICAgfQogICAgYW5ub3RhdGlvbnMucHVzaCh2YWx1ZSk7CiAgfQogIHJldHVybiBuZXdBbm5vdGF0aW9uc0J5UGFnZS5zaXplID4gMCA/IG5ld0Fubm90YXRpb25zQnlQYWdlIDogbnVsbDsKfQpmdW5jdGlvbiBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKHN0cikgewogIGlmIChzdHIgPT09IG51bGwgfHwgc3RyID09PSB1bmRlZmluZWQpIHsKICAgIHJldHVybiBzdHI7CiAgfQogIHJldHVybiBpc0FzY2lpKHN0cikgPyBzdHIgOiBzdHJpbmdUb1VURjE2U3RyaW5nKHN0ciwgdHJ1ZSk7Cn0KZnVuY3Rpb24gaXNBc2NpaShzdHIpIHsKICBpZiAodHlwZW9mIHN0ciAhPT0gInN0cmluZyIpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgcmV0dXJuICFzdHIgfHwgL15bXHgwMC1ceDdGXSokLy50ZXN0KHN0cik7Cn0KZnVuY3Rpb24gc3RyaW5nVG9VVEYxNkhleFN0cmluZyhzdHIpIHsKICBjb25zdCBidWYgPSBbXTsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBzdHIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgY2hhciA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgYnVmLnB1c2goaGV4TnVtYmVyc1tjaGFyID4+IDggJiAweGZmXSwgaGV4TnVtYmVyc1tjaGFyICYgMHhmZl0pOwogIH0KICByZXR1cm4gYnVmLmpvaW4oIiIpOwp9CmZ1bmN0aW9uIHN0cmluZ1RvVVRGMTZTdHJpbmcoc3RyLCBiaWdFbmRpYW4gPSBmYWxzZSkgewogIGNvbnN0IGJ1ZiA9IFtdOwogIGlmIChiaWdFbmRpYW4pIHsKICAgIGJ1Zi5wdXNoKCJceEZFXHhGRiIpOwogIH0KICBmb3IgKGxldCBpID0gMCwgaWkgPSBzdHIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgY2hhciA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgYnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaGFyID4+IDggJiAweGZmKSwgU3RyaW5nLmZyb21DaGFyQ29kZShjaGFyICYgMHhmZikpOwogIH0KICByZXR1cm4gYnVmLmpvaW4oIiIpOwp9CmZ1bmN0aW9uIGdldFJvdGF0aW9uTWF0cml4KHJvdGF0aW9uLCB3aWR0aCwgaGVpZ2h0KSB7CiAgc3dpdGNoIChyb3RhdGlvbikgewogICAgY2FzZSA5MDoKICAgICAgcmV0dXJuIFswLCAxLCAtMSwgMCwgd2lkdGgsIDBdOwogICAgY2FzZSAxODA6CiAgICAgIHJldHVybiBbLTEsIDAsIDAsIC0xLCB3aWR0aCwgaGVpZ2h0XTsKICAgIGNhc2UgMjcwOgogICAgICByZXR1cm4gWzAsIC0xLCAxLCAwLCAwLCBoZWlnaHRdOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHJvdGF0aW9uIik7CiAgfQp9CmZ1bmN0aW9uIGdldFNpemVJbkJ5dGVzKHgpIHsKICByZXR1cm4gTWF0aC5jZWlsKE1hdGguY2VpbChNYXRoLmxvZzIoMSArIHgpKSAvIDgpOwp9Cgo7Ly8gLi9leHRlcm5hbC9xY21zL3FjbXNfdXRpbHMuanMKY2xhc3MgUUNNUyB7CiAgc3RhdGljICNtZW1vcnlBcnJheSA9IG51bGw7CiAgc3RhdGljIF9tZW1vcnkgPSBudWxsOwogIHN0YXRpYyBfbXVzdEFkZEFscGhhID0gZmFsc2U7CiAgc3RhdGljIF9kZXN0QnVmZmVyID0gbnVsbDsKICBzdGF0aWMgX2Rlc3RPZmZzZXQgPSAwOwogIHN0YXRpYyBfZGVzdExlbmd0aCA9IDA7CiAgc3RhdGljIF9jc3NDb2xvciA9ICIiOwogIHN0YXRpYyBfbWFrZUhleENvbG9yID0gbnVsbDsKICBzdGF0aWMgZ2V0IF9tZW1vcnlBcnJheSgpIHsKICAgIGNvbnN0IGFycmF5ID0gdGhpcy4jbWVtb3J5QXJyYXk7CiAgICBpZiAoYXJyYXk/LmJ5dGVMZW5ndGgpIHsKICAgICAgcmV0dXJuIGFycmF5OwogICAgfQogICAgcmV0dXJuIHRoaXMuI21lbW9yeUFycmF5ID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5fbWVtb3J5LmJ1ZmZlcik7CiAgfQp9CmZ1bmN0aW9uIGNvcHlfcmVzdWx0KHB0ciwgbGVuKSB7CiAgY29uc3QgewogICAgX211c3RBZGRBbHBoYSwKICAgIF9kZXN0QnVmZmVyLAogICAgX2Rlc3RPZmZzZXQsCiAgICBfZGVzdExlbmd0aCwKICAgIF9tZW1vcnlBcnJheQogIH0gPSBRQ01TOwogIGlmIChsZW4gPT09IF9kZXN0TGVuZ3RoKSB7CiAgICBfZGVzdEJ1ZmZlci5zZXQoX21lbW9yeUFycmF5LnN1YmFycmF5KHB0ciwgcHRyICsgbGVuKSwgX2Rlc3RPZmZzZXQpOwogICAgcmV0dXJuOwogIH0KICBpZiAoX211c3RBZGRBbHBoYSkgewogICAgZm9yIChsZXQgaSA9IHB0ciwgaWkgPSBwdHIgKyBsZW4sIGogPSBfZGVzdE9mZnNldDsgaSA8IGlpOyBpICs9IDMsIGogKz0gNCkgewogICAgICBfZGVzdEJ1ZmZlcltqXSA9IF9tZW1vcnlBcnJheVtpXTsKICAgICAgX2Rlc3RCdWZmZXJbaiArIDFdID0gX21lbW9yeUFycmF5W2kgKyAxXTsKICAgICAgX2Rlc3RCdWZmZXJbaiArIDJdID0gX21lbW9yeUFycmF5W2kgKyAyXTsKICAgICAgX2Rlc3RCdWZmZXJbaiArIDNdID0gMjU1OwogICAgfQogIH0gZWxzZSB7CiAgICBmb3IgKGxldCBpID0gcHRyLCBpaSA9IHB0ciArIGxlbiwgaiA9IF9kZXN0T2Zmc2V0OyBpIDwgaWk7IGkgKz0gMywgaiArPSA0KSB7CiAgICAgIF9kZXN0QnVmZmVyW2pdID0gX21lbW9yeUFycmF5W2ldOwogICAgICBfZGVzdEJ1ZmZlcltqICsgMV0gPSBfbWVtb3J5QXJyYXlbaSArIDFdOwogICAgICBfZGVzdEJ1ZmZlcltqICsgMl0gPSBfbWVtb3J5QXJyYXlbaSArIDJdOwogICAgfQogIH0KfQpmdW5jdGlvbiBjb3B5X3JnYihwdHIpIHsKICBjb25zdCB7CiAgICBfZGVzdEJ1ZmZlciwKICAgIF9kZXN0T2Zmc2V0LAogICAgX21lbW9yeUFycmF5CiAgfSA9IFFDTVM7CiAgX2Rlc3RCdWZmZXJbX2Rlc3RPZmZzZXRdID0gX21lbW9yeUFycmF5W3B0cl07CiAgX2Rlc3RCdWZmZXJbX2Rlc3RPZmZzZXQgKyAxXSA9IF9tZW1vcnlBcnJheVtwdHIgKyAxXTsKICBfZGVzdEJ1ZmZlcltfZGVzdE9mZnNldCArIDJdID0gX21lbW9yeUFycmF5W3B0ciArIDJdOwp9CmZ1bmN0aW9uIG1ha2VfY3NzUkdCKHB0cikgewogIGNvbnN0IHsKICAgIF9tZW1vcnlBcnJheQogIH0gPSBRQ01TOwogIFFDTVMuX2Nzc0NvbG9yID0gUUNNUy5fbWFrZUhleENvbG9yKF9tZW1vcnlBcnJheVtwdHJdLCBfbWVtb3J5QXJyYXlbcHRyICsgMV0sIF9tZW1vcnlBcnJheVtwdHIgKyAyXSk7Cn0KCjsvLyAuL2V4dGVybmFsL3FjbXMvcWNtcy5qcwoKbGV0IHdhc207CmNvbnN0IGNhY2hlZFRleHREZWNvZGVyID0gdHlwZW9mIFRleHREZWNvZGVyICE9PSAndW5kZWZpbmVkJyA/IG5ldyBUZXh0RGVjb2RlcigndXRmLTgnLCB7CiAgaWdub3JlQk9NOiB0cnVlLAogIGZhdGFsOiB0cnVlCn0pIDogewogIGRlY29kZTogKCkgPT4gewogICAgdGhyb3cgRXJyb3IoJ1RleHREZWNvZGVyIG5vdCBhdmFpbGFibGUnKTsKICB9Cn07CmlmICh0eXBlb2YgVGV4dERlY29kZXIgIT09ICd1bmRlZmluZWQnKSB7CiAgY2FjaGVkVGV4dERlY29kZXIuZGVjb2RlKCk7Cn0KOwpsZXQgY2FjaGVkVWludDhBcnJheU1lbW9yeTAgPSBudWxsOwpmdW5jdGlvbiBnZXRVaW50OEFycmF5TWVtb3J5MCgpIHsKICBpZiAoY2FjaGVkVWludDhBcnJheU1lbW9yeTAgPT09IG51bGwgfHwgY2FjaGVkVWludDhBcnJheU1lbW9yeTAuYnl0ZUxlbmd0aCA9PT0gMCkgewogICAgY2FjaGVkVWludDhBcnJheU1lbW9yeTAgPSBuZXcgVWludDhBcnJheSh3YXNtLm1lbW9yeS5idWZmZXIpOwogIH0KICByZXR1cm4gY2FjaGVkVWludDhBcnJheU1lbW9yeTA7Cn0KZnVuY3Rpb24gZ2V0U3RyaW5nRnJvbVdhc20wKHB0ciwgbGVuKSB7CiAgcHRyID0gcHRyID4+PiAwOwogIHJldHVybiBjYWNoZWRUZXh0RGVjb2Rlci5kZWNvZGUoZ2V0VWludDhBcnJheU1lbW9yeTAoKS5zdWJhcnJheShwdHIsIHB0ciArIGxlbikpOwp9CmxldCBXQVNNX1ZFQ1RPUl9MRU4gPSAwOwpmdW5jdGlvbiBwYXNzQXJyYXk4VG9XYXNtMChhcmcsIG1hbGxvYykgewogIGNvbnN0IHB0ciA9IG1hbGxvYyhhcmcubGVuZ3RoICogMSwgMSkgPj4+IDA7CiAgZ2V0VWludDhBcnJheU1lbW9yeTAoKS5zZXQoYXJnLCBwdHIgLyAxKTsKICBXQVNNX1ZFQ1RPUl9MRU4gPSBhcmcubGVuZ3RoOwogIHJldHVybiBwdHI7Cn0KZnVuY3Rpb24gcWNtc19jb252ZXJ0X2FycmF5KHRyYW5zZm9ybWVyLCBzcmMpIHsKICBjb25zdCBwdHIwID0gcGFzc0FycmF5OFRvV2FzbTAoc3JjLCB3YXNtLl9fd2JpbmRnZW5fbWFsbG9jKTsKICBjb25zdCBsZW4wID0gV0FTTV9WRUNUT1JfTEVOOwogIHdhc20ucWNtc19jb252ZXJ0X2FycmF5KHRyYW5zZm9ybWVyLCBwdHIwLCBsZW4wKTsKfQpmdW5jdGlvbiBxY21zX2NvbnZlcnRfb25lKHRyYW5zZm9ybWVyLCBzcmMsIGNzcykgewogIHdhc20ucWNtc19jb252ZXJ0X29uZSh0cmFuc2Zvcm1lciwgc3JjLCBjc3MpOwp9CmZ1bmN0aW9uIHFjbXNfY29udmVydF90aHJlZSh0cmFuc2Zvcm1lciwgc3JjMSwgc3JjMiwgc3JjMywgY3NzKSB7CiAgd2FzbS5xY21zX2NvbnZlcnRfdGhyZWUodHJhbnNmb3JtZXIsIHNyYzEsIHNyYzIsIHNyYzMsIGNzcyk7Cn0KZnVuY3Rpb24gcWNtc19jb252ZXJ0X2ZvdXIodHJhbnNmb3JtZXIsIHNyYzEsIHNyYzIsIHNyYzMsIHNyYzQsIGNzcykgewogIHdhc20ucWNtc19jb252ZXJ0X2ZvdXIodHJhbnNmb3JtZXIsIHNyYzEsIHNyYzIsIHNyYzMsIHNyYzQsIGNzcyk7Cn0KZnVuY3Rpb24gcWNtc190cmFuc2Zvcm1lcl9mcm9tX21lbW9yeShtZW0sIGluX3R5cGUsIGludGVudCkgewogIGNvbnN0IHB0cjAgPSBwYXNzQXJyYXk4VG9XYXNtMChtZW0sIHdhc20uX193YmluZGdlbl9tYWxsb2MpOwogIGNvbnN0IGxlbjAgPSBXQVNNX1ZFQ1RPUl9MRU47CiAgY29uc3QgcmV0ID0gd2FzbS5xY21zX3RyYW5zZm9ybWVyX2Zyb21fbWVtb3J5KHB0cjAsIGxlbjAsIGluX3R5cGUsIGludGVudCk7CiAgcmV0dXJuIHJldCA+Pj4gMDsKfQpmdW5jdGlvbiBxY21zX2Ryb3BfdHJhbnNmb3JtZXIodHJhbnNmb3JtZXIpIHsKICB3YXNtLnFjbXNfZHJvcF90cmFuc2Zvcm1lcih0cmFuc2Zvcm1lcik7Cn0KY29uc3QgRGF0YVR5cGUgPSBPYmplY3QuZnJlZXplKHsKICBSR0I4OiAwLAogICIwIjogIlJHQjgiLAogIFJHQkE4OiAxLAogICIxIjogIlJHQkE4IiwKICBCR1JBODogMiwKICAiMiI6ICJCR1JBOCIsCiAgR3JheTg6IDMsCiAgIjMiOiAiR3JheTgiLAogIEdyYXlBODogNCwKICAiNCI6ICJHcmF5QTgiLAogIENNWUs6IDUsCiAgIjUiOiAiQ01ZSyIKfSk7CmNvbnN0IEludGVudCA9IE9iamVjdC5mcmVlemUoewogIFBlcmNlcHR1YWw6IDAsCiAgIjAiOiAiUGVyY2VwdHVhbCIsCiAgUmVsYXRpdmVDb2xvcmltZXRyaWM6IDEsCiAgIjEiOiAiUmVsYXRpdmVDb2xvcmltZXRyaWMiLAogIFNhdHVyYXRpb246IDIsCiAgIjIiOiAiU2F0dXJhdGlvbiIsCiAgQWJzb2x1dGVDb2xvcmltZXRyaWM6IDMsCiAgIjMiOiAiQWJzb2x1dGVDb2xvcmltZXRyaWMiCn0pOwphc3luYyBmdW5jdGlvbiBfX3diZ19sb2FkKG1vZHVsZSwgaW1wb3J0cykgewogIGlmICh0eXBlb2YgUmVzcG9uc2UgPT09ICdmdW5jdGlvbicgJiYgbW9kdWxlIGluc3RhbmNlb2YgUmVzcG9uc2UpIHsKICAgIGlmICh0eXBlb2YgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmcgPT09ICdmdW5jdGlvbicpIHsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gYXdhaXQgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmcobW9kdWxlLCBpbXBvcnRzKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlmIChtb2R1bGUuaGVhZGVycy5nZXQoJ0NvbnRlbnQtVHlwZScpICE9ICdhcHBsaWNhdGlvbi93YXNtJykgewogICAgICAgICAgY29uc29sZS53YXJuKCJgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmdgIGZhaWxlZCBiZWNhdXNlIHlvdXIgc2VydmVyIGRvZXMgbm90IHNlcnZlIFdhc20gd2l0aCBgYXBwbGljYXRpb24vd2FzbWAgTUlNRSB0eXBlLiBGYWxsaW5nIGJhY2sgdG8gYFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlYCB3aGljaCBpcyBzbG93ZXIuIE9yaWdpbmFsIGVycm9yOlxuIiwgZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBjb25zdCBieXRlcyA9IGF3YWl0IG1vZHVsZS5hcnJheUJ1ZmZlcigpOwogICAgcmV0dXJuIGF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKGJ5dGVzLCBpbXBvcnRzKTsKICB9IGVsc2UgewogICAgY29uc3QgaW5zdGFuY2UgPSBhd2FpdCBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZShtb2R1bGUsIGltcG9ydHMpOwogICAgaWYgKGluc3RhbmNlIGluc3RhbmNlb2YgV2ViQXNzZW1ibHkuSW5zdGFuY2UpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBpbnN0YW5jZSwKICAgICAgICBtb2R1bGUKICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBpbnN0YW5jZTsKICAgIH0KICB9Cn0KZnVuY3Rpb24gX193YmdfZ2V0X2ltcG9ydHMoKSB7CiAgY29uc3QgaW1wb3J0cyA9IHt9OwogIGltcG9ydHMud2JnID0ge307CiAgaW1wb3J0cy53YmcuX193YmdfY29weXJlc3VsdF9iMDhlZTdkMjczZjI5NWRkID0gZnVuY3Rpb24gKGFyZzAsIGFyZzEpIHsKICAgIGNvcHlfcmVzdWx0KGFyZzAgPj4+IDAsIGFyZzEgPj4+IDApOwogIH07CiAgaW1wb3J0cy53YmcuX193YmdfY29weXJnYl9kNjBjZTE3YmIwNWQ5YjY3ID0gZnVuY3Rpb24gKGFyZzApIHsKICAgIGNvcHlfcmdiKGFyZzAgPj4+IDApOwogIH07CiAgaW1wb3J0cy53YmcuX193YmdfbWFrZWNzc1JHQl84OTNiZjBjZDlmZGIzMDJkID0gZnVuY3Rpb24gKGFyZzApIHsKICAgIG1ha2VfY3NzUkdCKGFyZzAgPj4+IDApOwogIH07CiAgaW1wb3J0cy53YmcuX193YmluZGdlbl9pbml0X2V4dGVybnJlZl90YWJsZSA9IGZ1bmN0aW9uICgpIHsKICAgIGNvbnN0IHRhYmxlID0gd2FzbS5fX3diaW5kZ2VuX2V4cG9ydF8wOwogICAgY29uc3Qgb2Zmc2V0ID0gdGFibGUuZ3Jvdyg0KTsKICAgIHRhYmxlLnNldCgwLCB1bmRlZmluZWQpOwogICAgdGFibGUuc2V0KG9mZnNldCArIDAsIHVuZGVmaW5lZCk7CiAgICB0YWJsZS5zZXQob2Zmc2V0ICsgMSwgbnVsbCk7CiAgICB0YWJsZS5zZXQob2Zmc2V0ICsgMiwgdHJ1ZSk7CiAgICB0YWJsZS5zZXQob2Zmc2V0ICsgMywgZmFsc2UpOwogIH07CiAgaW1wb3J0cy53YmcuX193YmluZGdlbl90aHJvdyA9IGZ1bmN0aW9uIChhcmcwLCBhcmcxKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoZ2V0U3RyaW5nRnJvbVdhc20wKGFyZzAsIGFyZzEpKTsKICB9OwogIHJldHVybiBpbXBvcnRzOwp9CmZ1bmN0aW9uIF9fd2JnX2luaXRfbWVtb3J5KGltcG9ydHMsIG1lbW9yeSkge30KZnVuY3Rpb24gX193YmdfZmluYWxpemVfaW5pdChpbnN0YW5jZSwgbW9kdWxlKSB7CiAgd2FzbSA9IGluc3RhbmNlLmV4cG9ydHM7CiAgX193YmdfaW5pdC5fX3diaW5kZ2VuX3dhc21fbW9kdWxlID0gbW9kdWxlOwogIGNhY2hlZFVpbnQ4QXJyYXlNZW1vcnkwID0gbnVsbDsKICB3YXNtLl9fd2JpbmRnZW5fc3RhcnQoKTsKICByZXR1cm4gd2FzbTsKfQpmdW5jdGlvbiBpbml0U3luYyhtb2R1bGUpIHsKICBpZiAod2FzbSAhPT0gdW5kZWZpbmVkKSByZXR1cm4gd2FzbTsKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIGlmIChPYmplY3QuZ2V0UHJvdG90eXBlT2YobW9kdWxlKSA9PT0gT2JqZWN0LnByb3RvdHlwZSkgewogICAgICAoewogICAgICAgIG1vZHVsZQogICAgICB9ID0gbW9kdWxlKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnNvbGUud2FybigndXNpbmcgZGVwcmVjYXRlZCBwYXJhbWV0ZXJzIGZvciBgaW5pdFN5bmMoKWA7IHBhc3MgYSBzaW5nbGUgb2JqZWN0IGluc3RlYWQnKTsKICAgIH0KICB9CiAgY29uc3QgaW1wb3J0cyA9IF9fd2JnX2dldF9pbXBvcnRzKCk7CiAgX193YmdfaW5pdF9tZW1vcnkoaW1wb3J0cyk7CiAgaWYgKCEobW9kdWxlIGluc3RhbmNlb2YgV2ViQXNzZW1ibHkuTW9kdWxlKSkgewogICAgbW9kdWxlID0gbmV3IFdlYkFzc2VtYmx5Lk1vZHVsZShtb2R1bGUpOwogIH0KICBjb25zdCBpbnN0YW5jZSA9IG5ldyBXZWJBc3NlbWJseS5JbnN0YW5jZShtb2R1bGUsIGltcG9ydHMpOwogIHJldHVybiBfX3diZ19maW5hbGl6ZV9pbml0KGluc3RhbmNlLCBtb2R1bGUpOwp9CmFzeW5jIGZ1bmN0aW9uIF9fd2JnX2luaXQobW9kdWxlX29yX3BhdGgpIHsKICBpZiAod2FzbSAhPT0gdW5kZWZpbmVkKSByZXR1cm4gd2FzbTsKICBpZiAodHlwZW9mIG1vZHVsZV9vcl9wYXRoICE9PSAndW5kZWZpbmVkJykgewogICAgaWYgKE9iamVjdC5nZXRQcm90b3R5cGVPZihtb2R1bGVfb3JfcGF0aCkgPT09IE9iamVjdC5wcm90b3R5cGUpIHsKICAgICAgKHsKICAgICAgICBtb2R1bGVfb3JfcGF0aAogICAgICB9ID0gbW9kdWxlX29yX3BhdGgpOwogICAgfSBlbHNlIHsKICAgICAgY29uc29sZS53YXJuKCd1c2luZyBkZXByZWNhdGVkIHBhcmFtZXRlcnMgZm9yIHRoZSBpbml0aWFsaXphdGlvbiBmdW5jdGlvbjsgcGFzcyBhIHNpbmdsZSBvYmplY3QgaW5zdGVhZCcpOwogICAgfQogIH0KICBjb25zdCBpbXBvcnRzID0gX193YmdfZ2V0X2ltcG9ydHMoKTsKICBpZiAodHlwZW9mIG1vZHVsZV9vcl9wYXRoID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgUmVxdWVzdCA9PT0gJ2Z1bmN0aW9uJyAmJiBtb2R1bGVfb3JfcGF0aCBpbnN0YW5jZW9mIFJlcXVlc3QgfHwgdHlwZW9mIFVSTCA9PT0gJ2Z1bmN0aW9uJyAmJiBtb2R1bGVfb3JfcGF0aCBpbnN0YW5jZW9mIFVSTCkgewogICAgbW9kdWxlX29yX3BhdGggPSBmZXRjaChtb2R1bGVfb3JfcGF0aCk7CiAgfQogIF9fd2JnX2luaXRfbWVtb3J5KGltcG9ydHMpOwogIGNvbnN0IHsKICAgIGluc3RhbmNlLAogICAgbW9kdWxlCiAgfSA9IGF3YWl0IF9fd2JnX2xvYWQoYXdhaXQgbW9kdWxlX29yX3BhdGgsIGltcG9ydHMpOwogIHJldHVybiBfX3diZ19maW5hbGl6ZV9pbml0KGluc3RhbmNlLCBtb2R1bGUpOwp9CgovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIGNvbnN0IHFjbXMgPSAoKC8qIHVudXNlZCBwdXJlIGV4cHJlc3Npb24gb3Igc3VwZXIgKi8gbnVsbCAmJiAoX193YmdfaW5pdCkpKTsKOy8vIC4vc3JjL2NvcmUvY29sb3JzcGFjZS5qcwoKCmZ1bmN0aW9uIHJlc2l6ZVJnYkltYWdlKHNyYywgZGVzdCwgdzEsIGgxLCB3MiwgaDIsIGFscGhhMDEpIHsKICBjb25zdCBDT01QT05FTlRTID0gMzsKICBhbHBoYTAxID0gYWxwaGEwMSAhPT0gMSA/IDAgOiBhbHBoYTAxOwogIGNvbnN0IHhSYXRpbyA9IHcxIC8gdzI7CiAgY29uc3QgeVJhdGlvID0gaDEgLyBoMjsKICBsZXQgbmV3SW5kZXggPSAwLAogICAgb2xkSW5kZXg7CiAgY29uc3QgeFNjYWxlZCA9IG5ldyBVaW50MTZBcnJheSh3Mik7CiAgY29uc3QgdzFTY2FubGluZSA9IHcxICogQ09NUE9ORU5UUzsKICBmb3IgKGxldCBpID0gMDsgaSA8IHcyOyBpKyspIHsKICAgIHhTY2FsZWRbaV0gPSBNYXRoLmZsb29yKGkgKiB4UmF0aW8pICogQ09NUE9ORU5UUzsKICB9CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBoMjsgaSsrKSB7CiAgICBjb25zdCBweSA9IE1hdGguZmxvb3IoaSAqIHlSYXRpbykgKiB3MVNjYW5saW5lOwogICAgZm9yIChsZXQgaiA9IDA7IGogPCB3MjsgaisrKSB7CiAgICAgIG9sZEluZGV4ID0gcHkgKyB4U2NhbGVkW2pdOwogICAgICBkZXN0W25ld0luZGV4KytdID0gc3JjW29sZEluZGV4KytdOwogICAgICBkZXN0W25ld0luZGV4KytdID0gc3JjW29sZEluZGV4KytdOwogICAgICBkZXN0W25ld0luZGV4KytdID0gc3JjW29sZEluZGV4KytdOwogICAgICBuZXdJbmRleCArPSBhbHBoYTAxOwogICAgfQogIH0KfQpmdW5jdGlvbiByZXNpemVSZ2JhSW1hZ2Uoc3JjLCBkZXN0LCB3MSwgaDEsIHcyLCBoMiwgYWxwaGEwMSkgewogIGNvbnN0IHhSYXRpbyA9IHcxIC8gdzI7CiAgY29uc3QgeVJhdGlvID0gaDEgLyBoMjsKICBsZXQgbmV3SW5kZXggPSAwOwogIGNvbnN0IHhTY2FsZWQgPSBuZXcgVWludDE2QXJyYXkodzIpOwogIGlmIChhbHBoYTAxID09PSAxKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHcyOyBpKyspIHsKICAgICAgeFNjYWxlZFtpXSA9IE1hdGguZmxvb3IoaSAqIHhSYXRpbyk7CiAgICB9CiAgICBjb25zdCBzcmMzMiA9IG5ldyBVaW50MzJBcnJheShzcmMuYnVmZmVyKTsKICAgIGNvbnN0IGRlc3QzMiA9IG5ldyBVaW50MzJBcnJheShkZXN0LmJ1ZmZlcik7CiAgICBjb25zdCByZ2JNYXNrID0gRmVhdHVyZVRlc3QuaXNMaXR0bGVFbmRpYW4gPyAweDAwZmZmZmZmIDogMHhmZmZmZmYwMDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaDI7IGkrKykgewogICAgICBjb25zdCBidWYgPSBzcmMzMi5zdWJhcnJheShNYXRoLmZsb29yKGkgKiB5UmF0aW8pICogdzEpOwogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHcyOyBqKyspIHsKICAgICAgICBkZXN0MzJbbmV3SW5kZXgrK10gfD0gYnVmW3hTY2FsZWRbal1dICYgcmdiTWFzazsKICAgICAgfQogICAgfQogIH0gZWxzZSB7CiAgICBjb25zdCBDT01QT05FTlRTID0gNDsKICAgIGNvbnN0IHcxU2NhbmxpbmUgPSB3MSAqIENPTVBPTkVOVFM7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHcyOyBpKyspIHsKICAgICAgeFNjYWxlZFtpXSA9IE1hdGguZmxvb3IoaSAqIHhSYXRpbykgKiBDT01QT05FTlRTOwogICAgfQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoMjsgaSsrKSB7CiAgICAgIGNvbnN0IGJ1ZiA9IHNyYy5zdWJhcnJheShNYXRoLmZsb29yKGkgKiB5UmF0aW8pICogdzFTY2FubGluZSk7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdzI7IGorKykgewogICAgICAgIGNvbnN0IG9sZEluZGV4ID0geFNjYWxlZFtqXTsKICAgICAgICBkZXN0W25ld0luZGV4KytdID0gYnVmW29sZEluZGV4XTsKICAgICAgICBkZXN0W25ld0luZGV4KytdID0gYnVmW29sZEluZGV4ICsgMV07CiAgICAgICAgZGVzdFtuZXdJbmRleCsrXSA9IGJ1ZltvbGRJbmRleCArIDJdOwogICAgICB9CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGNvcHlSZ2JhSW1hZ2Uoc3JjLCBkZXN0LCBhbHBoYTAxKSB7CiAgaWYgKGFscGhhMDEgPT09IDEpIHsKICAgIGNvbnN0IHNyYzMyID0gbmV3IFVpbnQzMkFycmF5KHNyYy5idWZmZXIpOwogICAgY29uc3QgZGVzdDMyID0gbmV3IFVpbnQzMkFycmF5KGRlc3QuYnVmZmVyKTsKICAgIGNvbnN0IHJnYk1hc2sgPSBGZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbiA/IDB4MDBmZmZmZmYgOiAweGZmZmZmZjAwOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3JjMzIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBkZXN0MzJbaV0gfD0gc3JjMzJbaV0gJiByZ2JNYXNrOwogICAgfQogIH0gZWxzZSB7CiAgICBsZXQgaiA9IDA7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBzcmMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gNCkgewogICAgICBkZXN0W2orK10gPSBzcmNbaV07CiAgICAgIGRlc3RbaisrXSA9IHNyY1tpICsgMV07CiAgICAgIGRlc3RbaisrXSA9IHNyY1tpICsgMl07CiAgICB9CiAgfQp9CmNsYXNzIENvbG9yU3BhY2UgewogIHN0YXRpYyAjcmdiQnVmID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KDMpOwogIGNvbnN0cnVjdG9yKG5hbWUsIG51bUNvbXBzKSB7CiAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgdGhpcy5udW1Db21wcyA9IG51bUNvbXBzOwogIH0KICBnZXRSZ2Ioc3JjLCBzcmNPZmZzZXQsIG91dHB1dCA9IG5ldyBVaW50OENsYW1wZWRBcnJheSgzKSkgewogICAgdGhpcy5nZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBvdXRwdXQsIDApOwogICAgcmV0dXJuIG91dHB1dDsKICB9CiAgZ2V0UmdiSGV4KHNyYywgc3JjT2Zmc2V0KSB7CiAgICBjb25zdCBidWZmZXIgPSB0aGlzLmdldFJnYihzcmMsIHNyY09mZnNldCwgQ29sb3JTcGFjZS4jcmdiQnVmKTsKICAgIHJldHVybiBVdGlsLm1ha2VIZXhDb2xvcihidWZmZXJbMF0sIGJ1ZmZlclsxXSwgYnVmZmVyWzJdKTsKICB9CiAgZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgdW5yZWFjaGFibGUoIlNob3VsZCBub3QgY2FsbCBDb2xvclNwYWNlLmdldFJnYkl0ZW0iKTsKICB9CiAgZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgdW5yZWFjaGFibGUoIlNob3VsZCBub3QgY2FsbCBDb2xvclNwYWNlLmdldFJnYkJ1ZmZlciIpOwogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgIHVucmVhY2hhYmxlKCJTaG91bGQgbm90IGNhbGwgQ29sb3JTcGFjZS5nZXRPdXRwdXRMZW5ndGgiKTsKICB9CiAgaXNQYXNzdGhyb3VnaChiaXRzKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlzRGVmYXVsdERlY29kZShkZWNvZGVNYXAsIGJwYykgewogICAgcmV0dXJuIENvbG9yU3BhY2UuaXNEZWZhdWx0RGVjb2RlKGRlY29kZU1hcCwgdGhpcy5udW1Db21wcyk7CiAgfQogIGZpbGxSZ2IoZGVzdCwgb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHQsIHdpZHRoLCBoZWlnaHQsIGFjdHVhbEhlaWdodCwgYnBjLCBjb21wcywgYWxwaGEwMSkgewogICAgY29uc3QgY291bnQgPSBvcmlnaW5hbFdpZHRoICogb3JpZ2luYWxIZWlnaHQ7CiAgICBsZXQgcmdiQnVmID0gbnVsbDsKICAgIGNvbnN0IG51bUNvbXBvbmVudENvbG9ycyA9IDEgPDwgYnBjOwogICAgY29uc3QgbmVlZHNSZXNpemluZyA9IG9yaWdpbmFsSGVpZ2h0ICE9PSBoZWlnaHQgfHwgb3JpZ2luYWxXaWR0aCAhPT0gd2lkdGg7CiAgICBpZiAodGhpcy5pc1Bhc3N0aHJvdWdoKGJwYykpIHsKICAgICAgcmdiQnVmID0gY29tcHM7CiAgICB9IGVsc2UgaWYgKHRoaXMubnVtQ29tcHMgPT09IDEgJiYgY291bnQgPiBudW1Db21wb25lbnRDb2xvcnMgJiYgdGhpcy5uYW1lICE9PSAiRGV2aWNlR3JheSIgJiYgdGhpcy5uYW1lICE9PSAiRGV2aWNlUkdCIikgewogICAgICBjb25zdCBhbGxDb2xvcnMgPSBicGMgPD0gOCA/IG5ldyBVaW50OEFycmF5KG51bUNvbXBvbmVudENvbG9ycykgOiBuZXcgVWludDE2QXJyYXkobnVtQ29tcG9uZW50Q29sb3JzKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1Db21wb25lbnRDb2xvcnM7IGkrKykgewogICAgICAgIGFsbENvbG9yc1tpXSA9IGk7CiAgICAgIH0KICAgICAgY29uc3QgY29sb3JNYXAgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobnVtQ29tcG9uZW50Q29sb3JzICogMyk7CiAgICAgIHRoaXMuZ2V0UmdiQnVmZmVyKGFsbENvbG9ycywgMCwgbnVtQ29tcG9uZW50Q29sb3JzLCBjb2xvck1hcCwgMCwgYnBjLCAwKTsKICAgICAgaWYgKCFuZWVkc1Jlc2l6aW5nKSB7CiAgICAgICAgbGV0IGRlc3RQb3MgPSAwOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewogICAgICAgICAgY29uc3Qga2V5ID0gY29tcHNbaV0gKiAzOwogICAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gY29sb3JNYXBba2V5XTsKICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGNvbG9yTWFwW2tleSArIDFdOwogICAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gY29sb3JNYXBba2V5ICsgMl07CiAgICAgICAgICBkZXN0UG9zICs9IGFscGhhMDE7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJnYkJ1ZiA9IG5ldyBVaW50OEFycmF5KGNvdW50ICogMyk7CiAgICAgICAgbGV0IHJnYlBvcyA9IDA7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgKytpKSB7CiAgICAgICAgICBjb25zdCBrZXkgPSBjb21wc1tpXSAqIDM7CiAgICAgICAgICByZ2JCdWZbcmdiUG9zKytdID0gY29sb3JNYXBba2V5XTsKICAgICAgICAgIHJnYkJ1ZltyZ2JQb3MrK10gPSBjb2xvck1hcFtrZXkgKyAxXTsKICAgICAgICAgIHJnYkJ1ZltyZ2JQb3MrK10gPSBjb2xvck1hcFtrZXkgKyAyXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoIW5lZWRzUmVzaXppbmcpIHsKICAgICAgdGhpcy5nZXRSZ2JCdWZmZXIoY29tcHMsIDAsIHdpZHRoICogYWN0dWFsSGVpZ2h0LCBkZXN0LCAwLCBicGMsIGFscGhhMDEpOwogICAgfSBlbHNlIHsKICAgICAgcmdiQnVmID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGNvdW50ICogMyk7CiAgICAgIHRoaXMuZ2V0UmdiQnVmZmVyKGNvbXBzLCAwLCBjb3VudCwgcmdiQnVmLCAwLCBicGMsIDApOwogICAgfQogICAgaWYgKHJnYkJ1ZikgewogICAgICBpZiAobmVlZHNSZXNpemluZykgewogICAgICAgIHJlc2l6ZVJnYkltYWdlKHJnYkJ1ZiwgZGVzdCwgb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHQsIHdpZHRoLCBoZWlnaHQsIGFscGhhMDEpOwogICAgICB9IGVsc2UgewogICAgICAgIGxldCBkZXN0UG9zID0gMCwKICAgICAgICAgIHJnYlBvcyA9IDA7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gd2lkdGggKiBhY3R1YWxIZWlnaHQ7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICBkZXN0W2Rlc3RQb3MrK10gPSByZ2JCdWZbcmdiUG9zKytdOwogICAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gcmdiQnVmW3JnYlBvcysrXTsKICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHJnYkJ1ZltyZ2JQb3MrK107CiAgICAgICAgICBkZXN0UG9zICs9IGFscGhhMDE7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIGdldCB1c2VzWmVyb1RvT25lUmFuZ2UoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ1c2VzWmVyb1RvT25lUmFuZ2UiLCB0cnVlKTsKICB9CiAgc3RhdGljIGlzRGVmYXVsdERlY29kZShkZWNvZGUsIG51bUNvbXBzKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGVjb2RlKSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmIChudW1Db21wcyAqIDIgIT09IGRlY29kZS5sZW5ndGgpIHsKICAgICAgd2FybigiVGhlIGRlY29kZSBtYXAgaXMgbm90IHRoZSBjb3JyZWN0IGxlbmd0aCIpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGRlY29kZS5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgIGlmIChkZWNvZGVbaV0gIT09IDAgfHwgZGVjb2RlW2kgKyAxXSAhPT0gMSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQp9CmNsYXNzIEFsdGVybmF0ZUNTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgY29uc3RydWN0b3IobnVtQ29tcHMsIGJhc2UsIHRpbnRGbikgewogICAgc3VwZXIoIkFsdGVybmF0ZSIsIG51bUNvbXBzKTsKICAgIHRoaXMuYmFzZSA9IGJhc2U7CiAgICB0aGlzLnRpbnRGbiA9IHRpbnRGbjsKICAgIHRoaXMudG1wQnVmID0gbmV3IEZsb2F0MzJBcnJheShiYXNlLm51bUNvbXBzKTsKICB9CiAgZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgY29uc3QgdG1wQnVmID0gdGhpcy50bXBCdWY7CiAgICB0aGlzLnRpbnRGbihzcmMsIHNyY09mZnNldCwgdG1wQnVmLCAwKTsKICAgIHRoaXMuYmFzZS5nZXRSZ2JJdGVtKHRtcEJ1ZiwgMCwgZGVzdCwgZGVzdE9mZnNldCk7CiAgfQogIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgIGNvbnN0IHRpbnRGbiA9IHRoaXMudGludEZuOwogICAgY29uc3QgYmFzZSA9IHRoaXMuYmFzZTsKICAgIGNvbnN0IHNjYWxlID0gMSAvICgoMSA8PCBiaXRzKSAtIDEpOwogICAgY29uc3QgYmFzZU51bUNvbXBzID0gYmFzZS5udW1Db21wczsKICAgIGNvbnN0IHVzZXNaZXJvVG9PbmVSYW5nZSA9IGJhc2UudXNlc1plcm9Ub09uZVJhbmdlOwogICAgY29uc3QgaXNQYXNzdGhyb3VnaCA9IChiYXNlLmlzUGFzc3Rocm91Z2goOCkgfHwgIXVzZXNaZXJvVG9PbmVSYW5nZSkgJiYgYWxwaGEwMSA9PT0gMDsKICAgIGxldCBwb3MgPSBpc1Bhc3N0aHJvdWdoID8gZGVzdE9mZnNldCA6IDA7CiAgICBjb25zdCBiYXNlQnVmID0gaXNQYXNzdGhyb3VnaCA/IGRlc3QgOiBuZXcgVWludDhDbGFtcGVkQXJyYXkoYmFzZU51bUNvbXBzICogY291bnQpOwogICAgY29uc3QgbnVtQ29tcHMgPSB0aGlzLm51bUNvbXBzOwogICAgY29uc3Qgc2NhbGVkID0gbmV3IEZsb2F0MzJBcnJheShudW1Db21wcyk7CiAgICBjb25zdCB0aW50ZWQgPSBuZXcgRmxvYXQzMkFycmF5KGJhc2VOdW1Db21wcyk7CiAgICBsZXQgaSwgajsKICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgIGZvciAoaiA9IDA7IGogPCBudW1Db21wczsgaisrKSB7CiAgICAgICAgc2NhbGVkW2pdID0gc3JjW3NyY09mZnNldCsrXSAqIHNjYWxlOwogICAgICB9CiAgICAgIHRpbnRGbihzY2FsZWQsIDAsIHRpbnRlZCwgMCk7CiAgICAgIGlmICh1c2VzWmVyb1RvT25lUmFuZ2UpIHsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgYmFzZU51bUNvbXBzOyBqKyspIHsKICAgICAgICAgIGJhc2VCdWZbcG9zKytdID0gdGludGVkW2pdICogMjU1OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBiYXNlLmdldFJnYkl0ZW0odGludGVkLCAwLCBiYXNlQnVmLCBwb3MpOwogICAgICAgIHBvcyArPSBiYXNlTnVtQ29tcHM7CiAgICAgIH0KICAgIH0KICAgIGlmICghaXNQYXNzdGhyb3VnaCkgewogICAgICBiYXNlLmdldFJnYkJ1ZmZlcihiYXNlQnVmLCAwLCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgOCwgYWxwaGEwMSk7CiAgICB9CiAgfQogIGdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCwgYWxwaGEwMSkgewogICAgcmV0dXJuIHRoaXMuYmFzZS5nZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGggKiB0aGlzLmJhc2UubnVtQ29tcHMgLyB0aGlzLm51bUNvbXBzLCBhbHBoYTAxKTsKICB9Cn0KY2xhc3MgUGF0dGVybkNTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgY29uc3RydWN0b3IoYmFzZUNTKSB7CiAgICBzdXBlcigiUGF0dGVybiIsIG51bGwpOwogICAgdGhpcy5iYXNlID0gYmFzZUNTOwogIH0KICBpc0RlZmF1bHREZWNvZGUoZGVjb2RlTWFwLCBicGMpIHsKICAgIHVucmVhY2hhYmxlKCJTaG91bGQgbm90IGNhbGwgUGF0dGVybkNTLmlzRGVmYXVsdERlY29kZSIpOwogIH0KfQpjbGFzcyBJbmRleGVkQ1MgZXh0ZW5kcyBDb2xvclNwYWNlIHsKICBjb25zdHJ1Y3RvcihiYXNlLCBoaWdoVmFsLCBsb29rdXApIHsKICAgIHN1cGVyKCJJbmRleGVkIiwgMSk7CiAgICB0aGlzLmJhc2UgPSBiYXNlOwogICAgdGhpcy5oaWdoVmFsID0gaGlnaFZhbDsKICAgIGNvbnN0IGxlbmd0aCA9IGJhc2UubnVtQ29tcHMgKiAoaGlnaFZhbCArIDEpOwogICAgdGhpcy5sb29rdXAgPSBuZXcgVWludDhBcnJheShsZW5ndGgpOwogICAgaWYgKGxvb2t1cCBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgY29uc3QgYnl0ZXMgPSBsb29rdXAuZ2V0Qnl0ZXMobGVuZ3RoKTsKICAgICAgdGhpcy5sb29rdXAuc2V0KGJ5dGVzKTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIGxvb2t1cCA9PT0gInN0cmluZyIpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgIHRoaXMubG9va3VwW2ldID0gbG9va3VwLmNoYXJDb2RlQXQoaSkgJiAweGZmOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEluZGV4ZWRDUyAtIHVucmVjb2duaXplZCBsb29rdXAgdGFibGU6ICR7bG9va3VwfWApOwogICAgfQogIH0KICBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICBjb25zdCB7CiAgICAgIGJhc2UsCiAgICAgIGhpZ2hWYWwsCiAgICAgIGxvb2t1cAogICAgfSA9IHRoaXM7CiAgICBjb25zdCBzdGFydCA9IE1hdGhDbGFtcChNYXRoLnJvdW5kKHNyY1tzcmNPZmZzZXRdKSwgMCwgaGlnaFZhbCkgKiBiYXNlLm51bUNvbXBzOwogICAgYmFzZS5nZXRSZ2JCdWZmZXIobG9va3VwLCBzdGFydCwgMSwgZGVzdCwgZGVzdE9mZnNldCwgOCwgMCk7CiAgfQogIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgIGNvbnN0IHsKICAgICAgYmFzZSwKICAgICAgaGlnaFZhbCwKICAgICAgbG9va3VwCiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHsKICAgICAgbnVtQ29tcHMKICAgIH0gPSBiYXNlOwogICAgY29uc3Qgb3V0cHV0RGVsdGEgPSBiYXNlLmdldE91dHB1dExlbmd0aChudW1Db21wcywgYWxwaGEwMSk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyArK2kpIHsKICAgICAgY29uc3QgbG9va3VwUG9zID0gTWF0aENsYW1wKE1hdGgucm91bmQoc3JjW3NyY09mZnNldCsrXSksIDAsIGhpZ2hWYWwpICogbnVtQ29tcHM7CiAgICAgIGJhc2UuZ2V0UmdiQnVmZmVyKGxvb2t1cCwgbG9va3VwUG9zLCAxLCBkZXN0LCBkZXN0T2Zmc2V0LCA4LCBhbHBoYTAxKTsKICAgICAgZGVzdE9mZnNldCArPSBvdXRwdXREZWx0YTsKICAgIH0KICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICByZXR1cm4gdGhpcy5iYXNlLmdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCAqIHRoaXMuYmFzZS5udW1Db21wcywgYWxwaGEwMSk7CiAgfQogIGlzRGVmYXVsdERlY29kZShkZWNvZGVNYXAsIGJwYykgewogICAgaWYgKCFBcnJheS5pc0FycmF5KGRlY29kZU1hcCkpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAoZGVjb2RlTWFwLmxlbmd0aCAhPT0gMikgewogICAgICB3YXJuKCJEZWNvZGUgbWFwIGxlbmd0aCBpcyBub3QgY29ycmVjdCIpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihicGMpIHx8IGJwYyA8IDEpIHsKICAgICAgd2FybigiQml0cyBwZXIgY29tcG9uZW50IGlzIG5vdCBjb3JyZWN0Iik7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGRlY29kZU1hcFswXSA9PT0gMCAmJiBkZWNvZGVNYXBbMV0gPT09ICgxIDw8IGJwYykgLSAxOwogIH0KfQpjbGFzcyBEZXZpY2VHcmF5Q1MgZXh0ZW5kcyBDb2xvclNwYWNlIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKCJEZXZpY2VHcmF5IiwgMSk7CiAgfQogIGdldFJnYkl0ZW0oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgIGNvbnN0IGMgPSBzcmNbc3JjT2Zmc2V0XSAqIDI1NTsKICAgIGRlc3RbZGVzdE9mZnNldF0gPSBkZXN0W2Rlc3RPZmZzZXQgKyAxXSA9IGRlc3RbZGVzdE9mZnNldCArIDJdID0gYzsKICB9CiAgZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgY29uc3Qgc2NhbGUgPSAyNTUgLyAoKDEgPDwgYml0cykgLSAxKTsKICAgIGxldCBqID0gc3JjT2Zmc2V0LAogICAgICBxID0gZGVzdE9mZnNldDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewogICAgICBjb25zdCBjID0gc2NhbGUgKiBzcmNbaisrXTsKICAgICAgZGVzdFtxKytdID0gYzsKICAgICAgZGVzdFtxKytdID0gYzsKICAgICAgZGVzdFtxKytdID0gYzsKICAgICAgcSArPSBhbHBoYTAxOwogICAgfQogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgIHJldHVybiBpbnB1dExlbmd0aCAqICgzICsgYWxwaGEwMSk7CiAgfQp9CmNsYXNzIERldmljZVJnYkNTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigiRGV2aWNlUkdCIiwgMyk7CiAgfQogIGdldFJnYkl0ZW0oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgIGRlc3RbZGVzdE9mZnNldF0gPSBzcmNbc3JjT2Zmc2V0XSAqIDI1NTsKICAgIGRlc3RbZGVzdE9mZnNldCArIDFdID0gc3JjW3NyY09mZnNldCArIDFdICogMjU1OwogICAgZGVzdFtkZXN0T2Zmc2V0ICsgMl0gPSBzcmNbc3JjT2Zmc2V0ICsgMl0gKiAyNTU7CiAgfQogIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgIGlmIChiaXRzID09PSA4ICYmIGFscGhhMDEgPT09IDApIHsKICAgICAgZGVzdC5zZXQoc3JjLnN1YmFycmF5KHNyY09mZnNldCwgc3JjT2Zmc2V0ICsgY291bnQgKiAzKSwgZGVzdE9mZnNldCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHNjYWxlID0gMjU1IC8gKCgxIDw8IGJpdHMpIC0gMSk7CiAgICBsZXQgaiA9IHNyY09mZnNldCwKICAgICAgcSA9IGRlc3RPZmZzZXQ7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyArK2kpIHsKICAgICAgZGVzdFtxKytdID0gc2NhbGUgKiBzcmNbaisrXTsKICAgICAgZGVzdFtxKytdID0gc2NhbGUgKiBzcmNbaisrXTsKICAgICAgZGVzdFtxKytdID0gc2NhbGUgKiBzcmNbaisrXTsKICAgICAgcSArPSBhbHBoYTAxOwogICAgfQogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgIHJldHVybiBpbnB1dExlbmd0aCAqICgzICsgYWxwaGEwMSkgLyAzIHwgMDsKICB9CiAgaXNQYXNzdGhyb3VnaChiaXRzKSB7CiAgICByZXR1cm4gYml0cyA9PT0gODsKICB9Cn0KY2xhc3MgRGV2aWNlUmdiYUNTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigiRGV2aWNlUkdCQSIsIDQpOwogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIF9hbHBoYTAxKSB7CiAgICByZXR1cm4gaW5wdXRMZW5ndGggKiA0OwogIH0KICBpc1Bhc3N0aHJvdWdoKGJpdHMpIHsKICAgIHJldHVybiBiaXRzID09PSA4OwogIH0KICBmaWxsUmdiKGRlc3QsIG9yaWdpbmFsV2lkdGgsIG9yaWdpbmFsSGVpZ2h0LCB3aWR0aCwgaGVpZ2h0LCBhY3R1YWxIZWlnaHQsIGJwYywgY29tcHMsIGFscGhhMDEpIHsKICAgIGlmIChvcmlnaW5hbEhlaWdodCAhPT0gaGVpZ2h0IHx8IG9yaWdpbmFsV2lkdGggIT09IHdpZHRoKSB7CiAgICAgIHJlc2l6ZVJnYmFJbWFnZShjb21wcywgZGVzdCwgb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHQsIHdpZHRoLCBoZWlnaHQsIGFscGhhMDEpOwogICAgfSBlbHNlIHsKICAgICAgY29weVJnYmFJbWFnZShjb21wcywgZGVzdCwgYWxwaGEwMSk7CiAgICB9CiAgfQp9CmNsYXNzIERldmljZUNteWtDUyBleHRlbmRzIENvbG9yU3BhY2UgewogIGNvbnN0cnVjdG9yKCkgewogICAgc3VwZXIoIkRldmljZUNNWUsiLCA0KTsKICB9CiAgI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBzcmNTY2FsZSwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgY29uc3QgYyA9IHNyY1tzcmNPZmZzZXRdICogc3JjU2NhbGU7CiAgICBjb25zdCBtID0gc3JjW3NyY09mZnNldCArIDFdICogc3JjU2NhbGU7CiAgICBjb25zdCB5ID0gc3JjW3NyY09mZnNldCArIDJdICogc3JjU2NhbGU7CiAgICBjb25zdCBrID0gc3JjW3NyY09mZnNldCArIDNdICogc3JjU2NhbGU7CiAgICBkZXN0W2Rlc3RPZmZzZXRdID0gMjU1ICsgYyAqICgtNC4zODczMzIzODQ2MDk5ODggKiBjICsgNTQuNDg2MTUxOTQxODkxNzYgKiBtICsgMTguODIyOTA1MDIxNjUzMDIgKiB5ICsgMjEyLjI1NjYyNDUxNjM5NTg1ICogayArIC0yODUuMjMzMTAyNjEzNzAwNCkgKyBtICogKDEuNzE0OTc2MzQ3NzM2MjEzNCAqIG0gLSA1LjYwOTY3MzY5MDQwNDczMTUgKiB5ICsgLTE3Ljg3Mzg3MDg2MTQxNTQ0NCAqIGsgLSA1LjQ5NzAwNjQyNzE5NjM2NikgKyB5ICogKC0yLjUyMTczNDAxMzE2ODMwMzMgKiB5IC0gMjEuMjQ4OTIzMzM3MzUzMDczICogayArIDE3LjUxMTkyNzA4NDE4MTMpICsgayAqICgtMjEuODYxMjIxNDc0NjM2MDUgKiBrIC0gMTg5LjQ4MTgwODM1OTIyNzQ3KTsKICAgIGRlc3RbZGVzdE9mZnNldCArIDFdID0gMjU1ICsgYyAqICg4Ljg0MTA0MTQyMjAzNjE0OSAqIGMgKyA2MC4xMTgwMjcwNDU1OTczNjYgKiBtICsgNi44NzE0MjU1OTIwNDkwMDcgKiB5ICsgMzEuMTU5MTAwMTMwMDU1OTIyICogayArIC03OS4yOTcwODQ0ODE2NTQ4KSArIG0gKiAoLTE1LjMxMDM2MTMwNjk2NzgxNyAqIG0gKyAxNy41NzUyNTEyNjExMDk0ODIgKiB5ICsgMTMxLjM1MjUwOTEyNDkzOTc2ICogayAtIDE5MC45NDUzMzAyNTg4OTUxKSArIHkgKiAoNC40NDQzMzkxMDI4NTI3MzkgKiB5ICsgOS44NjMyODYxNDkzNDA1ICogayAtIDI0Ljg2NzQxNTgyNTU1ODc4KSArIGsgKiAoLTIwLjczNzMyNTQ3MTE4MTAzNCAqIGsgLSAxODcuODA0NTM3MDk3MTk1NzgpOwogICAgZGVzdFtkZXN0T2Zmc2V0ICsgMl0gPSAyNTUgKyBjICogKDAuODg0MjUyMjQzMDAwMzI5NiAqIGMgKyA4LjA3ODY3NzUwMzExMjkyOCAqIG0gKyAzMC44OTk3ODMwOTcwMzcyOSAqIHkgLSAwLjIzODgzMjM4Njg5MTc4OTM0ICogayArIC0xNC4xODM1NzY3OTk2NzMyODYpICsgbSAqICgxMC40OTU5MzI3MzQzMjA3MiAqIG0gKyA2My4wMjM3ODQ5NDc1NDA1MiAqIHkgKyA1MC42MDY5NTc2NTYzNjA3MzQgKiBrIC0gMTEyLjIzODg0MjUzNzE5MjQ4KSArIHkgKiAoMC4wMzI5NjA0MTExNDg3MzIxNyAqIHkgKyAxMTUuNjAzODQ0NDk2NDY2NDEgKiBrICsgLTE5My41ODIwOTM1Njg2MTUwNSkgKyBrICogKC0yMi4zMzgxNjgwNzMwOTg4NiAqIGsgLSAxODAuMTI2MTM5NzQ3MDgzNjcpOwogIH0KICBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICB0aGlzLiN0b1JnYihzcmMsIHNyY09mZnNldCwgMSwgZGVzdCwgZGVzdE9mZnNldCk7CiAgfQogIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgIGNvbnN0IHNjYWxlID0gMSAvICgoMSA8PCBiaXRzKSAtIDEpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgIHRoaXMuI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBzY2FsZSwgZGVzdCwgZGVzdE9mZnNldCk7CiAgICAgIHNyY09mZnNldCArPSA0OwogICAgICBkZXN0T2Zmc2V0ICs9IDMgKyBhbHBoYTAxOwogICAgfQogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgIHJldHVybiBpbnB1dExlbmd0aCAvIDQgKiAoMyArIGFscGhhMDEpIHwgMDsKICB9Cn0KY2xhc3MgQ2FsR3JheUNTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgY29uc3RydWN0b3Iod2hpdGVQb2ludCwgYmxhY2tQb2ludCwgZ2FtbWEpIHsKICAgIHN1cGVyKCJDYWxHcmF5IiwgMSk7CiAgICBpZiAoIXdoaXRlUG9pbnQpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJXaGl0ZVBvaW50IG1pc3NpbmcgLSByZXF1aXJlZCBmb3IgY29sb3Igc3BhY2UgQ2FsR3JheSIpOwogICAgfQogICAgW3RoaXMuWFcsIHRoaXMuWVcsIHRoaXMuWlddID0gd2hpdGVQb2ludDsKICAgIFt0aGlzLlhCLCB0aGlzLllCLCB0aGlzLlpCXSA9IGJsYWNrUG9pbnQgfHwgWzAsIDAsIDBdOwogICAgdGhpcy5HID0gZ2FtbWEgfHwgMTsKICAgIGlmICh0aGlzLlhXIDwgMCB8fCB0aGlzLlpXIDwgMCB8fCB0aGlzLllXICE9PSAxKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBXaGl0ZVBvaW50IGNvbXBvbmVudHMgZm9yICR7dGhpcy5uYW1lfSwgbm8gZmFsbGJhY2sgYXZhaWxhYmxlYCk7CiAgICB9CiAgICBpZiAodGhpcy5YQiA8IDAgfHwgdGhpcy5ZQiA8IDAgfHwgdGhpcy5aQiA8IDApIHsKICAgICAgaW5mbyhgSW52YWxpZCBCbGFja1BvaW50IGZvciAke3RoaXMubmFtZX0sIGZhbGxpbmcgYmFjayB0byBkZWZhdWx0LmApOwogICAgICB0aGlzLlhCID0gdGhpcy5ZQiA9IHRoaXMuWkIgPSAwOwogICAgfQogICAgaWYgKHRoaXMuWEIgIT09IDAgfHwgdGhpcy5ZQiAhPT0gMCB8fCB0aGlzLlpCICE9PSAwKSB7CiAgICAgIHdhcm4oYCR7dGhpcy5uYW1lfSwgQmxhY2tQb2ludDogWEI6ICR7dGhpcy5YQn0sIFlCOiAke3RoaXMuWUJ9LCBgICsgYFpCOiAke3RoaXMuWkJ9LCBvbmx5IGRlZmF1bHQgdmFsdWVzIGFyZSBzdXBwb3J0ZWQuYCk7CiAgICB9CiAgICBpZiAodGhpcy5HIDwgMSkgewogICAgICBpbmZvKGBJbnZhbGlkIEdhbW1hOiAke3RoaXMuR30gZm9yICR7dGhpcy5uYW1lfSwgZmFsbGluZyBiYWNrIHRvIGRlZmF1bHQuYCk7CiAgICAgIHRoaXMuRyA9IDE7CiAgICB9CiAgfQogICN0b1JnYihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCwgc2NhbGUpIHsKICAgIGNvbnN0IEEgPSBzcmNbc3JjT2Zmc2V0XSAqIHNjYWxlOwogICAgY29uc3QgQUcgPSBBICoqIHRoaXMuRzsKICAgIGNvbnN0IEwgPSB0aGlzLllXICogQUc7CiAgICBjb25zdCB2YWwgPSBNYXRoLm1heCgyOTUuOCAqIEwgKiogMC4zMzMzMzMzMzMzMzMzMzMzIC0gNDAuOCwgMCk7CiAgICBkZXN0W2Rlc3RPZmZzZXRdID0gdmFsOwogICAgZGVzdFtkZXN0T2Zmc2V0ICsgMV0gPSB2YWw7CiAgICBkZXN0W2Rlc3RPZmZzZXQgKyAyXSA9IHZhbDsKICB9CiAgZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgdGhpcy4jdG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQsIDEpOwogIH0KICBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICBjb25zdCBzY2FsZSA9IDEgLyAoKDEgPDwgYml0cykgLSAxKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewogICAgICB0aGlzLiN0b1JnYihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCwgc2NhbGUpOwogICAgICBzcmNPZmZzZXQgKz0gMTsKICAgICAgZGVzdE9mZnNldCArPSAzICsgYWxwaGEwMTsKICAgIH0KICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICByZXR1cm4gaW5wdXRMZW5ndGggKiAoMyArIGFscGhhMDEpOwogIH0KfQpjbGFzcyBDYWxSR0JDUyBleHRlbmRzIENvbG9yU3BhY2UgewogIHN0YXRpYyAjQlJBREZPUkRfU0NBTEVfTUFUUklYID0gbmV3IEZsb2F0MzJBcnJheShbMC44OTUxLCAwLjI2NjQsIC0wLjE2MTQsIC0wLjc1MDIsIDEuNzEzNSwgMC4wMzY3LCAwLjAzODksIC0wLjA2ODUsIDEuMDI5Nl0pOwogIHN0YXRpYyAjQlJBREZPUkRfU0NBTEVfSU5WRVJTRV9NQVRSSVggPSBuZXcgRmxvYXQzMkFycmF5KFswLjk4Njk5MjksIC0wLjE0NzA1NDMsIDAuMTU5OTYyNywgMC40MzIzMDUzLCAwLjUxODM2MDMsIDAuMDQ5MjkxMiwgLTAuMDA4NTI4NywgMC4wNDAwNDI4LCAwLjk2ODQ4NjddKTsKICBzdGF0aWMgI1NSR0JfRDY1X1hZWl9UT19SR0JfTUFUUklYID0gbmV3IEZsb2F0MzJBcnJheShbMy4yNDA0NTQyLCAtMS41MzcxMzg1LCAtMC40OTg1MzE0LCAtMC45NjkyNjYwLCAxLjg3NjAxMDgsIDAuMDQxNTU2MCwgMC4wNTU2NDM0LCAtMC4yMDQwMjU5LCAxLjA1NzIyNTJdKTsKICBzdGF0aWMgI0ZMQVRfV0hJVEVQT0lOVF9NQVRSSVggPSBuZXcgRmxvYXQzMkFycmF5KFsxLCAxLCAxXSk7CiAgc3RhdGljICN0ZW1wTm9ybWFsaXplTWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgzKTsKICBzdGF0aWMgI3RlbXBDb252ZXJ0TWF0cml4MSA9IG5ldyBGbG9hdDMyQXJyYXkoMyk7CiAgc3RhdGljICN0ZW1wQ29udmVydE1hdHJpeDIgPSBuZXcgRmxvYXQzMkFycmF5KDMpOwogIHN0YXRpYyAjREVDT0RFX0xfQ09OU1RBTlQgPSAoKDggKyAxNikgLyAxMTYpICoqIDMgLyA4LjA7CiAgY29uc3RydWN0b3Iod2hpdGVQb2ludCwgYmxhY2tQb2ludCwgZ2FtbWEsIG1hdHJpeCkgewogICAgc3VwZXIoIkNhbFJHQiIsIDMpOwogICAgaWYgKCF3aGl0ZVBvaW50KSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiV2hpdGVQb2ludCBtaXNzaW5nIC0gcmVxdWlyZWQgZm9yIGNvbG9yIHNwYWNlIENhbFJHQiIpOwogICAgfQogICAgY29uc3QgW1hXLCBZVywgWlddID0gdGhpcy53aGl0ZVBvaW50ID0gd2hpdGVQb2ludDsKICAgIGNvbnN0IFtYQiwgWUIsIFpCXSA9IHRoaXMuYmxhY2tQb2ludCA9IGJsYWNrUG9pbnQgfHwgbmV3IEZsb2F0MzJBcnJheSgzKTsKICAgIFt0aGlzLkdSLCB0aGlzLkdHLCB0aGlzLkdCXSA9IGdhbW1hIHx8IG5ldyBGbG9hdDMyQXJyYXkoWzEsIDEsIDFdKTsKICAgIFt0aGlzLk1YQSwgdGhpcy5NWUEsIHRoaXMuTVpBLCB0aGlzLk1YQiwgdGhpcy5NWUIsIHRoaXMuTVpCLCB0aGlzLk1YQywgdGhpcy5NWUMsIHRoaXMuTVpDXSA9IG1hdHJpeCB8fCBuZXcgRmxvYXQzMkFycmF5KFsxLCAwLCAwLCAwLCAxLCAwLCAwLCAwLCAxXSk7CiAgICBpZiAoWFcgPCAwIHx8IFpXIDwgMCB8fCBZVyAhPT0gMSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgV2hpdGVQb2ludCBjb21wb25lbnRzIGZvciAke3RoaXMubmFtZX0sIG5vIGZhbGxiYWNrIGF2YWlsYWJsZWApOwogICAgfQogICAgaWYgKFhCIDwgMCB8fCBZQiA8IDAgfHwgWkIgPCAwKSB7CiAgICAgIGluZm8oYEludmFsaWQgQmxhY2tQb2ludCBmb3IgJHt0aGlzLm5hbWV9IFske1hCfSwgJHtZQn0sICR7WkJ9XSwgYCArICJmYWxsaW5nIGJhY2sgdG8gZGVmYXVsdC4iKTsKICAgICAgdGhpcy5ibGFja1BvaW50ID0gbmV3IEZsb2F0MzJBcnJheSgzKTsKICAgIH0KICAgIGlmICh0aGlzLkdSIDwgMCB8fCB0aGlzLkdHIDwgMCB8fCB0aGlzLkdCIDwgMCkgewogICAgICBpbmZvKGBJbnZhbGlkIEdhbW1hIFske3RoaXMuR1J9LCAke3RoaXMuR0d9LCAke3RoaXMuR0J9XSBmb3IgYCArIGAke3RoaXMubmFtZX0sIGZhbGxpbmcgYmFjayB0byBkZWZhdWx0LmApOwogICAgICB0aGlzLkdSID0gdGhpcy5HRyA9IHRoaXMuR0IgPSAxOwogICAgfQogIH0KICAjbWF0cml4UHJvZHVjdChhLCBiLCByZXN1bHQpIHsKICAgIHJlc3VsdFswXSA9IGFbMF0gKiBiWzBdICsgYVsxXSAqIGJbMV0gKyBhWzJdICogYlsyXTsKICAgIHJlc3VsdFsxXSA9IGFbM10gKiBiWzBdICsgYVs0XSAqIGJbMV0gKyBhWzVdICogYlsyXTsKICAgIHJlc3VsdFsyXSA9IGFbNl0gKiBiWzBdICsgYVs3XSAqIGJbMV0gKyBhWzhdICogYlsyXTsKICB9CiAgI3RvRmxhdChzb3VyY2VXaGl0ZVBvaW50LCBMTVMsIHJlc3VsdCkgewogICAgcmVzdWx0WzBdID0gTE1TWzBdICogMSAvIHNvdXJjZVdoaXRlUG9pbnRbMF07CiAgICByZXN1bHRbMV0gPSBMTVNbMV0gKiAxIC8gc291cmNlV2hpdGVQb2ludFsxXTsKICAgIHJlc3VsdFsyXSA9IExNU1syXSAqIDEgLyBzb3VyY2VXaGl0ZVBvaW50WzJdOwogIH0KICAjdG9ENjUoc291cmNlV2hpdGVQb2ludCwgTE1TLCByZXN1bHQpIHsKICAgIGNvbnN0IEQ2NVggPSAwLjk1MDQ3OwogICAgY29uc3QgRDY1WSA9IDE7CiAgICBjb25zdCBENjVaID0gMS4wODg4MzsKICAgIHJlc3VsdFswXSA9IExNU1swXSAqIEQ2NVggLyBzb3VyY2VXaGl0ZVBvaW50WzBdOwogICAgcmVzdWx0WzFdID0gTE1TWzFdICogRDY1WSAvIHNvdXJjZVdoaXRlUG9pbnRbMV07CiAgICByZXN1bHRbMl0gPSBMTVNbMl0gKiBENjVaIC8gc291cmNlV2hpdGVQb2ludFsyXTsKICB9CiAgI3NSR0JUcmFuc2ZlckZ1bmN0aW9uKGNvbG9yKSB7CiAgICBpZiAoY29sb3IgPD0gMC4wMDMxMzA4KSB7CiAgICAgIHJldHVybiBNYXRoQ2xhbXAoMTIuOTIgKiBjb2xvciwgMCwgMSk7CiAgICB9CiAgICBpZiAoY29sb3IgPj0gMC45OTU1NDUyNSkgewogICAgICByZXR1cm4gMTsKICAgIH0KICAgIHJldHVybiBNYXRoQ2xhbXAoKDEgKyAwLjA1NSkgKiBjb2xvciAqKiAoMSAvIDIuNCkgLSAwLjA1NSwgMCwgMSk7CiAgfQogICNkZWNvZGVMKEwpIHsKICAgIGlmIChMIDwgMCkgewogICAgICByZXR1cm4gLXRoaXMuI2RlY29kZUwoLUwpOwogICAgfQogICAgaWYgKEwgPiA4LjApIHsKICAgICAgcmV0dXJuICgoTCArIDE2KSAvIDExNikgKiogMzsKICAgIH0KICAgIHJldHVybiBMICogQ2FsUkdCQ1MuI0RFQ09ERV9MX0NPTlNUQU5UOwogIH0KICAjY29tcGVuc2F0ZUJsYWNrUG9pbnQoc291cmNlQmxhY2tQb2ludCwgWFlaX0ZsYXQsIHJlc3VsdCkgewogICAgaWYgKHNvdXJjZUJsYWNrUG9pbnRbMF0gPT09IDAgJiYgc291cmNlQmxhY2tQb2ludFsxXSA9PT0gMCAmJiBzb3VyY2VCbGFja1BvaW50WzJdID09PSAwKSB7CiAgICAgIHJlc3VsdFswXSA9IFhZWl9GbGF0WzBdOwogICAgICByZXN1bHRbMV0gPSBYWVpfRmxhdFsxXTsKICAgICAgcmVzdWx0WzJdID0gWFlaX0ZsYXRbMl07CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHplcm9EZWNvZGVMID0gdGhpcy4jZGVjb2RlTCgwKTsKICAgIGNvbnN0IFhfRFNUID0gemVyb0RlY29kZUw7CiAgICBjb25zdCBYX1NSQyA9IHRoaXMuI2RlY29kZUwoc291cmNlQmxhY2tQb2ludFswXSk7CiAgICBjb25zdCBZX0RTVCA9IHplcm9EZWNvZGVMOwogICAgY29uc3QgWV9TUkMgPSB0aGlzLiNkZWNvZGVMKHNvdXJjZUJsYWNrUG9pbnRbMV0pOwogICAgY29uc3QgWl9EU1QgPSB6ZXJvRGVjb2RlTDsKICAgIGNvbnN0IFpfU1JDID0gdGhpcy4jZGVjb2RlTChzb3VyY2VCbGFja1BvaW50WzJdKTsKICAgIGNvbnN0IFhfU2NhbGUgPSAoMSAtIFhfRFNUKSAvICgxIC0gWF9TUkMpOwogICAgY29uc3QgWF9PZmZzZXQgPSAxIC0gWF9TY2FsZTsKICAgIGNvbnN0IFlfU2NhbGUgPSAoMSAtIFlfRFNUKSAvICgxIC0gWV9TUkMpOwogICAgY29uc3QgWV9PZmZzZXQgPSAxIC0gWV9TY2FsZTsKICAgIGNvbnN0IFpfU2NhbGUgPSAoMSAtIFpfRFNUKSAvICgxIC0gWl9TUkMpOwogICAgY29uc3QgWl9PZmZzZXQgPSAxIC0gWl9TY2FsZTsKICAgIHJlc3VsdFswXSA9IFhZWl9GbGF0WzBdICogWF9TY2FsZSArIFhfT2Zmc2V0OwogICAgcmVzdWx0WzFdID0gWFlaX0ZsYXRbMV0gKiBZX1NjYWxlICsgWV9PZmZzZXQ7CiAgICByZXN1bHRbMl0gPSBYWVpfRmxhdFsyXSAqIFpfU2NhbGUgKyBaX09mZnNldDsKICB9CiAgI25vcm1hbGl6ZVdoaXRlUG9pbnRUb0ZsYXQoc291cmNlV2hpdGVQb2ludCwgWFlaX0luLCByZXN1bHQpIHsKICAgIGlmIChzb3VyY2VXaGl0ZVBvaW50WzBdID09PSAxICYmIHNvdXJjZVdoaXRlUG9pbnRbMl0gPT09IDEpIHsKICAgICAgcmVzdWx0WzBdID0gWFlaX0luWzBdOwogICAgICByZXN1bHRbMV0gPSBYWVpfSW5bMV07CiAgICAgIHJlc3VsdFsyXSA9IFhZWl9JblsyXTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgTE1TID0gcmVzdWx0OwogICAgdGhpcy4jbWF0cml4UHJvZHVjdChDYWxSR0JDUy4jQlJBREZPUkRfU0NBTEVfTUFUUklYLCBYWVpfSW4sIExNUyk7CiAgICBjb25zdCBMTVNfRmxhdCA9IENhbFJHQkNTLiN0ZW1wTm9ybWFsaXplTWF0cml4OwogICAgdGhpcy4jdG9GbGF0KHNvdXJjZVdoaXRlUG9pbnQsIExNUywgTE1TX0ZsYXQpOwogICAgdGhpcy4jbWF0cml4UHJvZHVjdChDYWxSR0JDUy4jQlJBREZPUkRfU0NBTEVfSU5WRVJTRV9NQVRSSVgsIExNU19GbGF0LCByZXN1bHQpOwogIH0KICAjbm9ybWFsaXplV2hpdGVQb2ludFRvRDY1KHNvdXJjZVdoaXRlUG9pbnQsIFhZWl9JbiwgcmVzdWx0KSB7CiAgICBjb25zdCBMTVMgPSByZXN1bHQ7CiAgICB0aGlzLiNtYXRyaXhQcm9kdWN0KENhbFJHQkNTLiNCUkFERk9SRF9TQ0FMRV9NQVRSSVgsIFhZWl9JbiwgTE1TKTsKICAgIGNvbnN0IExNU19ENjUgPSBDYWxSR0JDUy4jdGVtcE5vcm1hbGl6ZU1hdHJpeDsKICAgIHRoaXMuI3RvRDY1KHNvdXJjZVdoaXRlUG9pbnQsIExNUywgTE1TX0Q2NSk7CiAgICB0aGlzLiNtYXRyaXhQcm9kdWN0KENhbFJHQkNTLiNCUkFERk9SRF9TQ0FMRV9JTlZFUlNFX01BVFJJWCwgTE1TX0Q2NSwgcmVzdWx0KTsKICB9CiAgI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0LCBzY2FsZSkgewogICAgY29uc3QgQSA9IE1hdGhDbGFtcChzcmNbc3JjT2Zmc2V0XSAqIHNjYWxlLCAwLCAxKTsKICAgIGNvbnN0IEIgPSBNYXRoQ2xhbXAoc3JjW3NyY09mZnNldCArIDFdICogc2NhbGUsIDAsIDEpOwogICAgY29uc3QgQyA9IE1hdGhDbGFtcChzcmNbc3JjT2Zmc2V0ICsgMl0gKiBzY2FsZSwgMCwgMSk7CiAgICBjb25zdCBBR1IgPSBBID09PSAxID8gMSA6IEEgKiogdGhpcy5HUjsKICAgIGNvbnN0IEJHRyA9IEIgPT09IDEgPyAxIDogQiAqKiB0aGlzLkdHOwogICAgY29uc3QgQ0dCID0gQyA9PT0gMSA/IDEgOiBDICoqIHRoaXMuR0I7CiAgICBjb25zdCBYID0gdGhpcy5NWEEgKiBBR1IgKyB0aGlzLk1YQiAqIEJHRyArIHRoaXMuTVhDICogQ0dCOwogICAgY29uc3QgWSA9IHRoaXMuTVlBICogQUdSICsgdGhpcy5NWUIgKiBCR0cgKyB0aGlzLk1ZQyAqIENHQjsKICAgIGNvbnN0IFogPSB0aGlzLk1aQSAqIEFHUiArIHRoaXMuTVpCICogQkdHICsgdGhpcy5NWkMgKiBDR0I7CiAgICBjb25zdCBYWVogPSBDYWxSR0JDUy4jdGVtcENvbnZlcnRNYXRyaXgxOwogICAgWFlaWzBdID0gWDsKICAgIFhZWlsxXSA9IFk7CiAgICBYWVpbMl0gPSBaOwogICAgY29uc3QgWFlaX0ZsYXQgPSBDYWxSR0JDUy4jdGVtcENvbnZlcnRNYXRyaXgyOwogICAgdGhpcy4jbm9ybWFsaXplV2hpdGVQb2ludFRvRmxhdCh0aGlzLndoaXRlUG9pbnQsIFhZWiwgWFlaX0ZsYXQpOwogICAgY29uc3QgWFlaX0JsYWNrID0gQ2FsUkdCQ1MuI3RlbXBDb252ZXJ0TWF0cml4MTsKICAgIHRoaXMuI2NvbXBlbnNhdGVCbGFja1BvaW50KHRoaXMuYmxhY2tQb2ludCwgWFlaX0ZsYXQsIFhZWl9CbGFjayk7CiAgICBjb25zdCBYWVpfRDY1ID0gQ2FsUkdCQ1MuI3RlbXBDb252ZXJ0TWF0cml4MjsKICAgIHRoaXMuI25vcm1hbGl6ZVdoaXRlUG9pbnRUb0Q2NShDYWxSR0JDUy4jRkxBVF9XSElURVBPSU5UX01BVFJJWCwgWFlaX0JsYWNrLCBYWVpfRDY1KTsKICAgIGNvbnN0IFNSR0IgPSBDYWxSR0JDUy4jdGVtcENvbnZlcnRNYXRyaXgxOwogICAgdGhpcy4jbWF0cml4UHJvZHVjdChDYWxSR0JDUy4jU1JHQl9ENjVfWFlaX1RPX1JHQl9NQVRSSVgsIFhZWl9ENjUsIFNSR0IpOwogICAgZGVzdFtkZXN0T2Zmc2V0XSA9IHRoaXMuI3NSR0JUcmFuc2ZlckZ1bmN0aW9uKFNSR0JbMF0pICogMjU1OwogICAgZGVzdFtkZXN0T2Zmc2V0ICsgMV0gPSB0aGlzLiNzUkdCVHJhbnNmZXJGdW5jdGlvbihTUkdCWzFdKSAqIDI1NTsKICAgIGRlc3RbZGVzdE9mZnNldCArIDJdID0gdGhpcy4jc1JHQlRyYW5zZmVyRnVuY3Rpb24oU1JHQlsyXSkgKiAyNTU7CiAgfQogIGdldFJnYkl0ZW0oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgIHRoaXMuI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0LCAxKTsKICB9CiAgZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgY29uc3Qgc2NhbGUgPSAxIC8gKCgxIDw8IGJpdHMpIC0gMSk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyArK2kpIHsKICAgICAgdGhpcy4jdG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQsIHNjYWxlKTsKICAgICAgc3JjT2Zmc2V0ICs9IDM7CiAgICAgIGRlc3RPZmZzZXQgKz0gMyArIGFscGhhMDE7CiAgICB9CiAgfQogIGdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCwgYWxwaGEwMSkgewogICAgcmV0dXJuIGlucHV0TGVuZ3RoICogKDMgKyBhbHBoYTAxKSAvIDMgfCAwOwogIH0KfQpjbGFzcyBMYWJDUyBleHRlbmRzIENvbG9yU3BhY2UgewogIGNvbnN0cnVjdG9yKHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIHJhbmdlKSB7CiAgICBzdXBlcigiTGFiIiwgMyk7CiAgICBpZiAoIXdoaXRlUG9pbnQpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJXaGl0ZVBvaW50IG1pc3NpbmcgLSByZXF1aXJlZCBmb3IgY29sb3Igc3BhY2UgTGFiIik7CiAgICB9CiAgICBbdGhpcy5YVywgdGhpcy5ZVywgdGhpcy5aV10gPSB3aGl0ZVBvaW50OwogICAgW3RoaXMuYW1pbiwgdGhpcy5hbWF4LCB0aGlzLmJtaW4sIHRoaXMuYm1heF0gPSByYW5nZSB8fCBbLTEwMCwgMTAwLCAtMTAwLCAxMDBdOwogICAgW3RoaXMuWEIsIHRoaXMuWUIsIHRoaXMuWkJdID0gYmxhY2tQb2ludCB8fCBbMCwgMCwgMF07CiAgICBpZiAodGhpcy5YVyA8IDAgfHwgdGhpcy5aVyA8IDAgfHwgdGhpcy5ZVyAhPT0gMSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgV2hpdGVQb2ludCBjb21wb25lbnRzLCBubyBmYWxsYmFjayBhdmFpbGFibGUiKTsKICAgIH0KICAgIGlmICh0aGlzLlhCIDwgMCB8fCB0aGlzLllCIDwgMCB8fCB0aGlzLlpCIDwgMCkgewogICAgICBpbmZvKCJJbnZhbGlkIEJsYWNrUG9pbnQsIGZhbGxpbmcgYmFjayB0byBkZWZhdWx0Iik7CiAgICAgIHRoaXMuWEIgPSB0aGlzLllCID0gdGhpcy5aQiA9IDA7CiAgICB9CiAgICBpZiAodGhpcy5hbWluID4gdGhpcy5hbWF4IHx8IHRoaXMuYm1pbiA+IHRoaXMuYm1heCkgewogICAgICBpbmZvKCJJbnZhbGlkIFJhbmdlLCBmYWxsaW5nIGJhY2sgdG8gZGVmYXVsdHMiKTsKICAgICAgdGhpcy5hbWluID0gLTEwMDsKICAgICAgdGhpcy5hbWF4ID0gMTAwOwogICAgICB0aGlzLmJtaW4gPSAtMTAwOwogICAgICB0aGlzLmJtYXggPSAxMDA7CiAgICB9CiAgfQogICNmbl9nKHgpIHsKICAgIHJldHVybiB4ID49IDYgLyAyOSA/IHggKiogMyA6IDEwOCAvIDg0MSAqICh4IC0gNCAvIDI5KTsKICB9CiAgI2RlY29kZSh2YWx1ZSwgaGlnaDEsIGxvdzIsIGhpZ2gyKSB7CiAgICByZXR1cm4gbG93MiArIHZhbHVlICogKGhpZ2gyIC0gbG93MikgLyBoaWdoMTsKICB9CiAgI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBtYXhWYWwsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgIGxldCBMcyA9IHNyY1tzcmNPZmZzZXRdOwogICAgbGV0IGFzID0gc3JjW3NyY09mZnNldCArIDFdOwogICAgbGV0IGJzID0gc3JjW3NyY09mZnNldCArIDJdOwogICAgaWYgKG1heFZhbCAhPT0gZmFsc2UpIHsKICAgICAgTHMgPSB0aGlzLiNkZWNvZGUoTHMsIG1heFZhbCwgMCwgMTAwKTsKICAgICAgYXMgPSB0aGlzLiNkZWNvZGUoYXMsIG1heFZhbCwgdGhpcy5hbWluLCB0aGlzLmFtYXgpOwogICAgICBicyA9IHRoaXMuI2RlY29kZShicywgbWF4VmFsLCB0aGlzLmJtaW4sIHRoaXMuYm1heCk7CiAgICB9CiAgICBpZiAoYXMgPiB0aGlzLmFtYXgpIHsKICAgICAgYXMgPSB0aGlzLmFtYXg7CiAgICB9IGVsc2UgaWYgKGFzIDwgdGhpcy5hbWluKSB7CiAgICAgIGFzID0gdGhpcy5hbWluOwogICAgfQogICAgaWYgKGJzID4gdGhpcy5ibWF4KSB7CiAgICAgIGJzID0gdGhpcy5ibWF4OwogICAgfSBlbHNlIGlmIChicyA8IHRoaXMuYm1pbikgewogICAgICBicyA9IHRoaXMuYm1pbjsKICAgIH0KICAgIGNvbnN0IE0gPSAoTHMgKyAxNikgLyAxMTY7CiAgICBjb25zdCBMID0gTSArIGFzIC8gNTAwOwogICAgY29uc3QgTiA9IE0gLSBicyAvIDIwMDsKICAgIGNvbnN0IFggPSB0aGlzLlhXICogdGhpcy4jZm5fZyhMKTsKICAgIGNvbnN0IFkgPSB0aGlzLllXICogdGhpcy4jZm5fZyhNKTsKICAgIGNvbnN0IFogPSB0aGlzLlpXICogdGhpcy4jZm5fZyhOKTsKICAgIGxldCByLCBnLCBiOwogICAgaWYgKHRoaXMuWlcgPCAxKSB7CiAgICAgIHIgPSBYICogMy4xMzM5ICsgWSAqIC0xLjYxNyArIFogKiAtMC40OTA2OwogICAgICBnID0gWCAqIC0wLjk3ODUgKyBZICogMS45MTYgKyBaICogMC4wMzMzOwogICAgICBiID0gWCAqIDAuMDcyICsgWSAqIC0wLjIyOSArIFogKiAxLjQwNTc7CiAgICB9IGVsc2UgewogICAgICByID0gWCAqIDMuMjQwNiArIFkgKiAtMS41MzcyICsgWiAqIC0wLjQ5ODY7CiAgICAgIGcgPSBYICogLTAuOTY4OSArIFkgKiAxLjg3NTggKyBaICogMC4wNDE1OwogICAgICBiID0gWCAqIDAuMDU1NyArIFkgKiAtMC4yMDQgKyBaICogMS4wNTc7CiAgICB9CiAgICBkZXN0W2Rlc3RPZmZzZXRdID0gTWF0aC5zcXJ0KHIpICogMjU1OwogICAgZGVzdFtkZXN0T2Zmc2V0ICsgMV0gPSBNYXRoLnNxcnQoZykgKiAyNTU7CiAgICBkZXN0W2Rlc3RPZmZzZXQgKyAyXSA9IE1hdGguc3FydChiKSAqIDI1NTsKICB9CiAgZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgdGhpcy4jdG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIGZhbHNlLCBkZXN0LCBkZXN0T2Zmc2V0KTsKICB9CiAgZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgY29uc3QgbWF4VmFsID0gKDEgPDwgYml0cykgLSAxOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgIHRoaXMuI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBtYXhWYWwsIGRlc3QsIGRlc3RPZmZzZXQpOwogICAgICBzcmNPZmZzZXQgKz0gMzsKICAgICAgZGVzdE9mZnNldCArPSAzICsgYWxwaGEwMTsKICAgIH0KICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICByZXR1cm4gaW5wdXRMZW5ndGggKiAoMyArIGFscGhhMDEpIC8gMyB8IDA7CiAgfQogIGlzRGVmYXVsdERlY29kZShkZWNvZGVNYXAsIGJwYykgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGdldCB1c2VzWmVyb1RvT25lUmFuZ2UoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ1c2VzWmVyb1RvT25lUmFuZ2UiLCBmYWxzZSk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9pY2NfY29sb3JzcGFjZS5qcwoKCgoKZnVuY3Rpb24gZmV0Y2hTeW5jKHVybCkgewogIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogIHhoci5vcGVuKCJHRVQiLCB1cmwsIGZhbHNlKTsKICB4aHIucmVzcG9uc2VUeXBlID0gImFycmF5YnVmZmVyIjsKICB4aHIuc2VuZChudWxsKTsKICByZXR1cm4geGhyLnJlc3BvbnNlOwp9CmNsYXNzIEljY0NvbG9yU3BhY2UgZXh0ZW5kcyBDb2xvclNwYWNlIHsKICAjdHJhbnNmb3JtZXI7CiAgI2NvbnZlcnRQaXhlbDsKICBzdGF0aWMgI3VzZVdhc20gPSB0cnVlOwogIHN0YXRpYyAjd2FzbVVybCA9IG51bGw7CiAgc3RhdGljICNmaW5hbGl6ZXIgPSBuZXcgRmluYWxpemF0aW9uUmVnaXN0cnkodHJhbnNmb3JtZXIgPT4gewogICAgcWNtc19kcm9wX3RyYW5zZm9ybWVyKHRyYW5zZm9ybWVyKTsKICB9KTsKICBjb25zdHJ1Y3RvcihpY2NQcm9maWxlLCBuYW1lLCBudW1Db21wcykgewogICAgaWYgKCFJY2NDb2xvclNwYWNlLmlzVXNhYmxlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gSUNDIGNvbG9yIHNwYWNlIHN1cHBvcnQiKTsKICAgIH0KICAgIHN1cGVyKG5hbWUsIG51bUNvbXBzKTsKICAgIGxldCBpblR5cGU7CiAgICBzd2l0Y2ggKG51bUNvbXBzKSB7CiAgICAgIGNhc2UgMToKICAgICAgICBpblR5cGUgPSBEYXRhVHlwZS5HcmF5ODsKICAgICAgICB0aGlzLiNjb252ZXJ0UGl4ZWwgPSAoc3JjLCBzcmNPZmZzZXQsIGNzcykgPT4gcWNtc19jb252ZXJ0X29uZSh0aGlzLiN0cmFuc2Zvcm1lciwgc3JjW3NyY09mZnNldF0gKiAyNTUsIGNzcyk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMzoKICAgICAgICBpblR5cGUgPSBEYXRhVHlwZS5SR0I4OwogICAgICAgIHRoaXMuI2NvbnZlcnRQaXhlbCA9IChzcmMsIHNyY09mZnNldCwgY3NzKSA9PiBxY21zX2NvbnZlcnRfdGhyZWUodGhpcy4jdHJhbnNmb3JtZXIsIHNyY1tzcmNPZmZzZXRdICogMjU1LCBzcmNbc3JjT2Zmc2V0ICsgMV0gKiAyNTUsIHNyY1tzcmNPZmZzZXQgKyAyXSAqIDI1NSwgY3NzKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSA0OgogICAgICAgIGluVHlwZSA9IERhdGFUeXBlLkNNWUs7CiAgICAgICAgdGhpcy4jY29udmVydFBpeGVsID0gKHNyYywgc3JjT2Zmc2V0LCBjc3MpID0+IHFjbXNfY29udmVydF9mb3VyKHRoaXMuI3RyYW5zZm9ybWVyLCBzcmNbc3JjT2Zmc2V0XSAqIDI1NSwgc3JjW3NyY09mZnNldCArIDFdICogMjU1LCBzcmNbc3JjT2Zmc2V0ICsgMl0gKiAyNTUsIHNyY1tzcmNPZmZzZXQgKyAzXSAqIDI1NSwgY3NzKTsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIG51bWJlciBvZiBjb21wb25lbnRzOiAke251bUNvbXBzfWApOwogICAgfQogICAgdGhpcy4jdHJhbnNmb3JtZXIgPSBxY21zX3RyYW5zZm9ybWVyX2Zyb21fbWVtb3J5KGljY1Byb2ZpbGUsIGluVHlwZSwgSW50ZW50LlBlcmNlcHR1YWwpOwogICAgaWYgKCF0aGlzLiN0cmFuc2Zvcm1lcikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkZhaWxlZCB0byBjcmVhdGUgSUNDIGNvbG9yIHNwYWNlIik7CiAgICB9CiAgICBJY2NDb2xvclNwYWNlLiNmaW5hbGl6ZXIucmVnaXN0ZXIodGhpcywgdGhpcy4jdHJhbnNmb3JtZXIpOwogIH0KICBnZXRSZ2JIZXgoc3JjLCBzcmNPZmZzZXQpIHsKICAgIHRoaXMuI2NvbnZlcnRQaXhlbChzcmMsIHNyY09mZnNldCwgdHJ1ZSk7CiAgICByZXR1cm4gUUNNUy5fY3NzQ29sb3I7CiAgfQogIGdldFJnYkl0ZW0oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgIFFDTVMuX2Rlc3RCdWZmZXIgPSBkZXN0OwogICAgUUNNUy5fZGVzdE9mZnNldCA9IGRlc3RPZmZzZXQ7CiAgICBRQ01TLl9kZXN0TGVuZ3RoID0gMzsKICAgIHRoaXMuI2NvbnZlcnRQaXhlbChzcmMsIHNyY09mZnNldCwgZmFsc2UpOwogICAgUUNNUy5fZGVzdEJ1ZmZlciA9IG51bGw7CiAgfQogIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgIHNyYyA9IHNyYy5zdWJhcnJheShzcmNPZmZzZXQsIHNyY09mZnNldCArIGNvdW50ICogdGhpcy5udW1Db21wcyk7CiAgICBpZiAoYml0cyAhPT0gOCkgewogICAgICBjb25zdCBzY2FsZSA9IDI1NSAvICgoMSA8PCBiaXRzKSAtIDEpOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBzcmMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIHNyY1tpXSAqPSBzY2FsZTsKICAgICAgfQogICAgfQogICAgUUNNUy5fbXVzdEFkZEFscGhhID0gYWxwaGEwMSAmJiBkZXN0LmJ1ZmZlciA9PT0gc3JjLmJ1ZmZlcjsKICAgIFFDTVMuX2Rlc3RCdWZmZXIgPSBkZXN0OwogICAgUUNNUy5fZGVzdE9mZnNldCA9IGRlc3RPZmZzZXQ7CiAgICBRQ01TLl9kZXN0TGVuZ3RoID0gY291bnQgKiAoMyArIGFscGhhMDEpOwogICAgcWNtc19jb252ZXJ0X2FycmF5KHRoaXMuI3RyYW5zZm9ybWVyLCBzcmMpOwogICAgUUNNUy5fbXVzdEFkZEFscGhhID0gZmFsc2U7CiAgICBRQ01TLl9kZXN0QnVmZmVyID0gbnVsbDsKICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICByZXR1cm4gaW5wdXRMZW5ndGggLyB0aGlzLm51bUNvbXBzICogKDMgKyBhbHBoYTAxKSB8IDA7CiAgfQogIHN0YXRpYyBzZXRPcHRpb25zKHsKICAgIHVzZVdhc20sCiAgICB1c2VXb3JrZXJGZXRjaCwKICAgIHdhc21VcmwKICB9KSB7CiAgICBpZiAoIXVzZVdvcmtlckZldGNoKSB7CiAgICAgIHRoaXMuI3VzZVdhc20gPSBmYWxzZTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jdXNlV2FzbSA9IHVzZVdhc207CiAgICB0aGlzLiN3YXNtVXJsID0gd2FzbVVybDsKICB9CiAgc3RhdGljIGdldCBpc1VzYWJsZSgpIHsKICAgIGxldCBpc1VzYWJsZSA9IGZhbHNlOwogICAgaWYgKHRoaXMuI3VzZVdhc20pIHsKICAgICAgaWYgKHRoaXMuI3dhc21VcmwpIHsKICAgICAgICB0cnkgewogICAgICAgICAgdGhpcy5fbW9kdWxlID0gaW5pdFN5bmMoewogICAgICAgICAgICBtb2R1bGU6IGZldGNoU3luYyhgJHt0aGlzLiN3YXNtVXJsfXFjbXNfYmcud2FzbWApCiAgICAgICAgICB9KTsKICAgICAgICAgIGlzVXNhYmxlID0gISF0aGlzLl9tb2R1bGU7CiAgICAgICAgICBRQ01TLl9tZW1vcnkgPSB0aGlzLl9tb2R1bGUubWVtb3J5OwogICAgICAgICAgUUNNUy5fbWFrZUhleENvbG9yID0gVXRpbC5tYWtlSGV4Q29sb3I7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgd2FybihgSUNDQmFzZWQgY29sb3Igc3BhY2U6ICIke2V9Ii5gKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2FybigiTm8gSUNDIGNvbG9yIHNwYWNlIHN1cHBvcnQgZHVlIHRvIG1pc3NpbmcgYHdhc21VcmxgIEFQSSBvcHRpb24iKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNVc2FibGUiLCBpc1VzYWJsZSk7CiAgfQp9CmNsYXNzIENteWtJQ0NCYXNlZENTIGV4dGVuZHMgSWNjQ29sb3JTcGFjZSB7CiAgc3RhdGljICNpY2NVcmw7CiAgY29uc3RydWN0b3IoKSB7CiAgICBjb25zdCBpY2NQcm9maWxlID0gbmV3IFVpbnQ4QXJyYXkoZmV0Y2hTeW5jKGAke0NteWtJQ0NCYXNlZENTLiNpY2NVcmx9Q0dBVFMwMDFDb21wYXQtdjItbWljcm8uaWNjYCkpOwogICAgc3VwZXIoaWNjUHJvZmlsZSwgIkRldmljZUNNWUsiLCA0KTsKICB9CiAgc3RhdGljIHNldE9wdGlvbnMoewogICAgaWNjVXJsCiAgfSkgewogICAgdGhpcy4jaWNjVXJsID0gaWNjVXJsOwogIH0KICBzdGF0aWMgZ2V0IGlzVXNhYmxlKCkgewogICAgbGV0IGlzVXNhYmxlID0gZmFsc2U7CiAgICBpZiAoSWNjQ29sb3JTcGFjZS5pc1VzYWJsZSkgewogICAgICBpZiAodGhpcy4jaWNjVXJsKSB7CiAgICAgICAgaXNVc2FibGUgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHdhcm4oIk5vIENNWUsgSUNDIHByb2ZpbGUgc3VwcG9ydCBkdWUgdG8gbWlzc2luZyBgaWNjVXJsYCBBUEkgb3B0aW9uIik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImlzVXNhYmxlIiwgaXNVc2FibGUpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvc3RyZWFtLmpzCgoKY2xhc3MgU3RyZWFtIGV4dGVuZHMgQmFzZVN0cmVhbSB7CiAgY29uc3RydWN0b3IoYXJyYXlCdWZmZXIsIHN0YXJ0LCBsZW5ndGgsIGRpY3QpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLmJ5dGVzID0gYXJyYXlCdWZmZXIgaW5zdGFuY2VvZiBVaW50OEFycmF5ID8gYXJyYXlCdWZmZXIgOiBuZXcgVWludDhBcnJheShhcnJheUJ1ZmZlcik7CiAgICB0aGlzLnN0YXJ0ID0gc3RhcnQgfHwgMDsKICAgIHRoaXMucG9zID0gdGhpcy5zdGFydDsKICAgIHRoaXMuZW5kID0gc3RhcnQgKyBsZW5ndGggfHwgdGhpcy5ieXRlcy5sZW5ndGg7CiAgICB0aGlzLmRpY3QgPSBkaWN0OwogIH0KICBnZXQgbGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuZW5kIC0gdGhpcy5zdGFydDsKICB9CiAgZ2V0IGlzRW1wdHkoKSB7CiAgICByZXR1cm4gdGhpcy5sZW5ndGggPT09IDA7CiAgfQogIGdldEJ5dGUoKSB7CiAgICBpZiAodGhpcy5wb3MgPj0gdGhpcy5lbmQpIHsKICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgcmV0dXJuIHRoaXMuYnl0ZXNbdGhpcy5wb3MrK107CiAgfQogIGdldEJ5dGVzKGxlbmd0aCkgewogICAgY29uc3QgYnl0ZXMgPSB0aGlzLmJ5dGVzOwogICAgY29uc3QgcG9zID0gdGhpcy5wb3M7CiAgICBjb25zdCBzdHJFbmQgPSB0aGlzLmVuZDsKICAgIGlmICghbGVuZ3RoKSB7CiAgICAgIHJldHVybiBieXRlcy5zdWJhcnJheShwb3MsIHN0ckVuZCk7CiAgICB9CiAgICBsZXQgZW5kID0gcG9zICsgbGVuZ3RoOwogICAgaWYgKGVuZCA+IHN0ckVuZCkgewogICAgICBlbmQgPSBzdHJFbmQ7CiAgICB9CiAgICB0aGlzLnBvcyA9IGVuZDsKICAgIHJldHVybiBieXRlcy5zdWJhcnJheShwb3MsIGVuZCk7CiAgfQogIGdldEJ5dGVSYW5nZShiZWdpbiwgZW5kKSB7CiAgICBpZiAoYmVnaW4gPCAwKSB7CiAgICAgIGJlZ2luID0gMDsKICAgIH0KICAgIGlmIChlbmQgPiB0aGlzLmVuZCkgewogICAgICBlbmQgPSB0aGlzLmVuZDsKICAgIH0KICAgIHJldHVybiB0aGlzLmJ5dGVzLnN1YmFycmF5KGJlZ2luLCBlbmQpOwogIH0KICByZXNldCgpIHsKICAgIHRoaXMucG9zID0gdGhpcy5zdGFydDsKICB9CiAgbW92ZVN0YXJ0KCkgewogICAgdGhpcy5zdGFydCA9IHRoaXMucG9zOwogIH0KICBtYWtlU3ViU3RyZWFtKHN0YXJ0LCBsZW5ndGgsIGRpY3QgPSBudWxsKSB7CiAgICByZXR1cm4gbmV3IFN0cmVhbSh0aGlzLmJ5dGVzLmJ1ZmZlciwgc3RhcnQsIGxlbmd0aCwgZGljdCk7CiAgfQp9CmNsYXNzIFN0cmluZ1N0cmVhbSBleHRlbmRzIFN0cmVhbSB7CiAgY29uc3RydWN0b3Ioc3RyKSB7CiAgICBzdXBlcihzdHJpbmdUb0J5dGVzKHN0cikpOwogIH0KfQpjbGFzcyBOdWxsU3RyZWFtIGV4dGVuZHMgU3RyZWFtIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKG5ldyBVaW50OEFycmF5KDApKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2NodW5rZWRfc3RyZWFtLmpzCgoKCmNsYXNzIENodW5rZWRTdHJlYW0gZXh0ZW5kcyBTdHJlYW0gewogIGNvbnN0cnVjdG9yKGxlbmd0aCwgY2h1bmtTaXplLCBtYW5hZ2VyKSB7CiAgICBzdXBlcihuZXcgVWludDhBcnJheShsZW5ndGgpLCAwLCBsZW5ndGgsIG51bGwpOwogICAgdGhpcy5jaHVua1NpemUgPSBjaHVua1NpemU7CiAgICB0aGlzLl9sb2FkZWRDaHVua3MgPSBuZXcgU2V0KCk7CiAgICB0aGlzLm51bUNodW5rcyA9IE1hdGguY2VpbChsZW5ndGggLyBjaHVua1NpemUpOwogICAgdGhpcy5tYW5hZ2VyID0gbWFuYWdlcjsKICAgIHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoID0gMDsKICAgIHRoaXMubGFzdFN1Y2Nlc3NmdWxFbnN1cmVCeXRlQ2h1bmsgPSAtMTsKICB9CiAgZ2V0TWlzc2luZ0NodW5rcygpIHsKICAgIGNvbnN0IGNodW5rcyA9IFtdOwogICAgZm9yIChsZXQgY2h1bmsgPSAwLCBuID0gdGhpcy5udW1DaHVua3M7IGNodW5rIDwgbjsgKytjaHVuaykgewogICAgICBpZiAoIXRoaXMuX2xvYWRlZENodW5rcy5oYXMoY2h1bmspKSB7CiAgICAgICAgY2h1bmtzLnB1c2goY2h1bmspOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gY2h1bmtzOwogIH0KICBnZXQgbnVtQ2h1bmtzTG9hZGVkKCkgewogICAgcmV0dXJuIHRoaXMuX2xvYWRlZENodW5rcy5zaXplOwogIH0KICBnZXQgaXNEYXRhTG9hZGVkKCkgewogICAgcmV0dXJuIHRoaXMubnVtQ2h1bmtzTG9hZGVkID09PSB0aGlzLm51bUNodW5rczsKICB9CiAgb25SZWNlaXZlRGF0YShiZWdpbiwgY2h1bmspIHsKICAgIGNvbnN0IGNodW5rU2l6ZSA9IHRoaXMuY2h1bmtTaXplOwogICAgaWYgKGJlZ2luICUgY2h1bmtTaXplICE9PSAwKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgQmFkIGJlZ2luIG9mZnNldDogJHtiZWdpbn1gKTsKICAgIH0KICAgIGNvbnN0IGVuZCA9IGJlZ2luICsgY2h1bmsuYnl0ZUxlbmd0aDsKICAgIGlmIChlbmQgJSBjaHVua1NpemUgIT09IDAgJiYgZW5kICE9PSB0aGlzLmJ5dGVzLmxlbmd0aCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYEJhZCBlbmQgb2Zmc2V0OiAke2VuZH1gKTsKICAgIH0KICAgIHRoaXMuYnl0ZXMuc2V0KG5ldyBVaW50OEFycmF5KGNodW5rKSwgYmVnaW4pOwogICAgY29uc3QgYmVnaW5DaHVuayA9IE1hdGguZmxvb3IoYmVnaW4gLyBjaHVua1NpemUpOwogICAgY29uc3QgZW5kQ2h1bmsgPSBNYXRoLmZsb29yKChlbmQgLSAxKSAvIGNodW5rU2l6ZSkgKyAxOwogICAgZm9yIChsZXQgY3VyQ2h1bmsgPSBiZWdpbkNodW5rOyBjdXJDaHVuayA8IGVuZENodW5rOyArK2N1ckNodW5rKSB7CiAgICAgIHRoaXMuX2xvYWRlZENodW5rcy5hZGQoY3VyQ2h1bmspOwogICAgfQogIH0KICBvblJlY2VpdmVQcm9ncmVzc2l2ZURhdGEoZGF0YSkgewogICAgbGV0IHBvc2l0aW9uID0gdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGg7CiAgICBjb25zdCBiZWdpbkNodW5rID0gTWF0aC5mbG9vcihwb3NpdGlvbiAvIHRoaXMuY2h1bmtTaXplKTsKICAgIHRoaXMuYnl0ZXMuc2V0KG5ldyBVaW50OEFycmF5KGRhdGEpLCBwb3NpdGlvbik7CiAgICBwb3NpdGlvbiArPSBkYXRhLmJ5dGVMZW5ndGg7CiAgICB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCA9IHBvc2l0aW9uOwogICAgY29uc3QgZW5kQ2h1bmsgPSBwb3NpdGlvbiA+PSB0aGlzLmVuZCA/IHRoaXMubnVtQ2h1bmtzIDogTWF0aC5mbG9vcihwb3NpdGlvbiAvIHRoaXMuY2h1bmtTaXplKTsKICAgIGZvciAobGV0IGN1ckNodW5rID0gYmVnaW5DaHVuazsgY3VyQ2h1bmsgPCBlbmRDaHVuazsgKytjdXJDaHVuaykgewogICAgICB0aGlzLl9sb2FkZWRDaHVua3MuYWRkKGN1ckNodW5rKTsKICAgIH0KICB9CiAgZW5zdXJlQnl0ZShwb3MpIHsKICAgIGlmIChwb3MgPCB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBjaHVuayA9IE1hdGguZmxvb3IocG9zIC8gdGhpcy5jaHVua1NpemUpOwogICAgaWYgKGNodW5rID4gdGhpcy5udW1DaHVua3MpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGNodW5rID09PSB0aGlzLmxhc3RTdWNjZXNzZnVsRW5zdXJlQnl0ZUNodW5rKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghdGhpcy5fbG9hZGVkQ2h1bmtzLmhhcyhjaHVuaykpIHsKICAgICAgdGhyb3cgbmV3IE1pc3NpbmdEYXRhRXhjZXB0aW9uKHBvcywgcG9zICsgMSk7CiAgICB9CiAgICB0aGlzLmxhc3RTdWNjZXNzZnVsRW5zdXJlQnl0ZUNodW5rID0gY2h1bms7CiAgfQogIGVuc3VyZVJhbmdlKGJlZ2luLCBlbmQpIHsKICAgIGlmIChiZWdpbiA+PSBlbmQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGVuZCA8PSB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBiZWdpbkNodW5rID0gTWF0aC5mbG9vcihiZWdpbiAvIHRoaXMuY2h1bmtTaXplKTsKICAgIGlmIChiZWdpbkNodW5rID4gdGhpcy5udW1DaHVua3MpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZW5kQ2h1bmsgPSBNYXRoLm1pbihNYXRoLmZsb29yKChlbmQgLSAxKSAvIHRoaXMuY2h1bmtTaXplKSArIDEsIHRoaXMubnVtQ2h1bmtzKTsKICAgIGZvciAobGV0IGNodW5rID0gYmVnaW5DaHVuazsgY2h1bmsgPCBlbmRDaHVuazsgKytjaHVuaykgewogICAgICBpZiAoIXRoaXMuX2xvYWRlZENodW5rcy5oYXMoY2h1bmspKSB7CiAgICAgICAgdGhyb3cgbmV3IE1pc3NpbmdEYXRhRXhjZXB0aW9uKGJlZ2luLCBlbmQpOwogICAgICB9CiAgICB9CiAgfQogIG5leHRFbXB0eUNodW5rKGJlZ2luQ2h1bmspIHsKICAgIGNvbnN0IG51bUNodW5rcyA9IHRoaXMubnVtQ2h1bmtzOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1DaHVua3M7ICsraSkgewogICAgICBjb25zdCBjaHVuayA9IChiZWdpbkNodW5rICsgaSkgJSBudW1DaHVua3M7CiAgICAgIGlmICghdGhpcy5fbG9hZGVkQ2h1bmtzLmhhcyhjaHVuaykpIHsKICAgICAgICByZXR1cm4gY2h1bms7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICBoYXNDaHVuayhjaHVuaykgewogICAgcmV0dXJuIHRoaXMuX2xvYWRlZENodW5rcy5oYXMoY2h1bmspOwogIH0KICBnZXRCeXRlKCkgewogICAgY29uc3QgcG9zID0gdGhpcy5wb3M7CiAgICBpZiAocG9zID49IHRoaXMuZW5kKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIGlmIChwb3MgPj0gdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGgpIHsKICAgICAgdGhpcy5lbnN1cmVCeXRlKHBvcyk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5ieXRlc1t0aGlzLnBvcysrXTsKICB9CiAgZ2V0Qnl0ZXMobGVuZ3RoKSB7CiAgICBjb25zdCBieXRlcyA9IHRoaXMuYnl0ZXM7CiAgICBjb25zdCBwb3MgPSB0aGlzLnBvczsKICAgIGNvbnN0IHN0ckVuZCA9IHRoaXMuZW5kOwogICAgaWYgKCFsZW5ndGgpIHsKICAgICAgaWYgKHN0ckVuZCA+IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgICAgdGhpcy5lbnN1cmVSYW5nZShwb3MsIHN0ckVuZCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGJ5dGVzLnN1YmFycmF5KHBvcywgc3RyRW5kKTsKICAgIH0KICAgIGxldCBlbmQgPSBwb3MgKyBsZW5ndGg7CiAgICBpZiAoZW5kID4gc3RyRW5kKSB7CiAgICAgIGVuZCA9IHN0ckVuZDsKICAgIH0KICAgIGlmIChlbmQgPiB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICB0aGlzLmVuc3VyZVJhbmdlKHBvcywgZW5kKTsKICAgIH0KICAgIHRoaXMucG9zID0gZW5kOwogICAgcmV0dXJuIGJ5dGVzLnN1YmFycmF5KHBvcywgZW5kKTsKICB9CiAgZ2V0Qnl0ZVJhbmdlKGJlZ2luLCBlbmQpIHsKICAgIGlmIChiZWdpbiA8IDApIHsKICAgICAgYmVnaW4gPSAwOwogICAgfQogICAgaWYgKGVuZCA+IHRoaXMuZW5kKSB7CiAgICAgIGVuZCA9IHRoaXMuZW5kOwogICAgfQogICAgaWYgKGVuZCA+IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgIHRoaXMuZW5zdXJlUmFuZ2UoYmVnaW4sIGVuZCk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5ieXRlcy5zdWJhcnJheShiZWdpbiwgZW5kKTsKICB9CiAgbWFrZVN1YlN0cmVhbShzdGFydCwgbGVuZ3RoLCBkaWN0ID0gbnVsbCkgewogICAgaWYgKGxlbmd0aCkgewogICAgICBpZiAoc3RhcnQgKyBsZW5ndGggPiB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICAgIHRoaXMuZW5zdXJlUmFuZ2Uoc3RhcnQsIHN0YXJ0ICsgbGVuZ3RoKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChzdGFydCA+PSB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICB0aGlzLmVuc3VyZUJ5dGUoc3RhcnQpOwogICAgfQogICAgZnVuY3Rpb24gQ2h1bmtlZFN0cmVhbVN1YnN0cmVhbSgpIHt9CiAgICBDaHVua2VkU3RyZWFtU3Vic3RyZWFtLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUodGhpcyk7CiAgICBDaHVua2VkU3RyZWFtU3Vic3RyZWFtLnByb3RvdHlwZS5nZXRNaXNzaW5nQ2h1bmtzID0gZnVuY3Rpb24gKCkgewogICAgICBjb25zdCBjaHVua1NpemUgPSB0aGlzLmNodW5rU2l6ZTsKICAgICAgY29uc3QgYmVnaW5DaHVuayA9IE1hdGguZmxvb3IodGhpcy5zdGFydCAvIGNodW5rU2l6ZSk7CiAgICAgIGNvbnN0IGVuZENodW5rID0gTWF0aC5mbG9vcigodGhpcy5lbmQgLSAxKSAvIGNodW5rU2l6ZSkgKyAxOwogICAgICBjb25zdCBtaXNzaW5nQ2h1bmtzID0gW107CiAgICAgIGZvciAobGV0IGNodW5rID0gYmVnaW5DaHVuazsgY2h1bmsgPCBlbmRDaHVuazsgKytjaHVuaykgewogICAgICAgIGlmICghdGhpcy5fbG9hZGVkQ2h1bmtzLmhhcyhjaHVuaykpIHsKICAgICAgICAgIG1pc3NpbmdDaHVua3MucHVzaChjaHVuayk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBtaXNzaW5nQ2h1bmtzOwogICAgfTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaHVua2VkU3RyZWFtU3Vic3RyZWFtLnByb3RvdHlwZSwgImlzRGF0YUxvYWRlZCIsIHsKICAgICAgZ2V0KCkgewogICAgICAgIGlmICh0aGlzLm51bUNodW5rc0xvYWRlZCA9PT0gdGhpcy5udW1DaHVua3MpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5nZXRNaXNzaW5nQ2h1bmtzKCkubGVuZ3RoID09PSAwOwogICAgICB9LAogICAgICBjb25maWd1cmFibGU6IHRydWUKICAgIH0pOwogICAgY29uc3Qgc3ViU3RyZWFtID0gbmV3IENodW5rZWRTdHJlYW1TdWJzdHJlYW0oKTsKICAgIHN1YlN0cmVhbS5wb3MgPSBzdWJTdHJlYW0uc3RhcnQgPSBzdGFydDsKICAgIHN1YlN0cmVhbS5lbmQgPSBzdGFydCArIGxlbmd0aCB8fCB0aGlzLmVuZDsKICAgIHN1YlN0cmVhbS5kaWN0ID0gZGljdDsKICAgIHJldHVybiBzdWJTdHJlYW07CiAgfQogIGdldEJhc2VTdHJlYW1zKCkgewogICAgcmV0dXJuIFt0aGlzXTsKICB9Cn0KY2xhc3MgQ2h1bmtlZFN0cmVhbU1hbmFnZXIgewogIGNvbnN0cnVjdG9yKHBkZk5ldHdvcmtTdHJlYW0sIGFyZ3MpIHsKICAgIHRoaXMubGVuZ3RoID0gYXJncy5sZW5ndGg7CiAgICB0aGlzLmNodW5rU2l6ZSA9IGFyZ3MucmFuZ2VDaHVua1NpemU7CiAgICB0aGlzLnN0cmVhbSA9IG5ldyBDaHVua2VkU3RyZWFtKHRoaXMubGVuZ3RoLCB0aGlzLmNodW5rU2l6ZSwgdGhpcyk7CiAgICB0aGlzLnBkZk5ldHdvcmtTdHJlYW0gPSBwZGZOZXR3b3JrU3RyZWFtOwogICAgdGhpcy5kaXNhYmxlQXV0b0ZldGNoID0gYXJncy5kaXNhYmxlQXV0b0ZldGNoOwogICAgdGhpcy5tc2dIYW5kbGVyID0gYXJncy5tc2dIYW5kbGVyOwogICAgdGhpcy5jdXJyUmVxdWVzdElkID0gMDsKICAgIHRoaXMuX2NodW5rc05lZWRlZEJ5UmVxdWVzdCA9IG5ldyBNYXAoKTsKICAgIHRoaXMuX3JlcXVlc3RzQnlDaHVuayA9IG5ldyBNYXAoKTsKICAgIHRoaXMuX3Byb21pc2VzQnlSZXF1ZXN0ID0gbmV3IE1hcCgpOwogICAgdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGggPSAwOwogICAgdGhpcy5hYm9ydGVkID0gZmFsc2U7CiAgICB0aGlzLl9sb2FkZWRTdHJlYW1DYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgfQogIHNlbmRSZXF1ZXN0KGJlZ2luLCBlbmQpIHsKICAgIGNvbnN0IHJhbmdlUmVhZGVyID0gdGhpcy5wZGZOZXR3b3JrU3RyZWFtLmdldFJhbmdlUmVhZGVyKGJlZ2luLCBlbmQpOwogICAgaWYgKCFyYW5nZVJlYWRlci5pc1N0cmVhbWluZ1N1cHBvcnRlZCkgewogICAgICByYW5nZVJlYWRlci5vblByb2dyZXNzID0gdGhpcy5vblByb2dyZXNzLmJpbmQodGhpcyk7CiAgICB9CiAgICBsZXQgY2h1bmtzID0gW10sCiAgICAgIGxvYWRlZCA9IDA7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICBjb25zdCByZWFkQ2h1bmsgPSAoewogICAgICAgIHZhbHVlLAogICAgICAgIGRvbmUKICAgICAgfSkgPT4gewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoZG9uZSkgewogICAgICAgICAgICBjb25zdCBjaHVua0RhdGEgPSBhcnJheUJ1ZmZlcnNUb0J5dGVzKGNodW5rcyk7CiAgICAgICAgICAgIGNodW5rcyA9IG51bGw7CiAgICAgICAgICAgIHJlc29sdmUoY2h1bmtEYXRhKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgbG9hZGVkICs9IHZhbHVlLmJ5dGVMZW5ndGg7CiAgICAgICAgICBpZiAocmFuZ2VSZWFkZXIuaXNTdHJlYW1pbmdTdXBwb3J0ZWQpIHsKICAgICAgICAgICAgdGhpcy5vblByb2dyZXNzKHsKICAgICAgICAgICAgICBsb2FkZWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBjaHVua3MucHVzaCh2YWx1ZSk7CiAgICAgICAgICByYW5nZVJlYWRlci5yZWFkKCkudGhlbihyZWFkQ2h1bmssIHJlamVjdCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgcmVqZWN0KGUpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmFuZ2VSZWFkZXIucmVhZCgpLnRoZW4ocmVhZENodW5rLCByZWplY3QpOwogICAgfSkudGhlbihkYXRhID0+IHsKICAgICAgaWYgKHRoaXMuYWJvcnRlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLm9uUmVjZWl2ZURhdGEoewogICAgICAgIGNodW5rOiBkYXRhLAogICAgICAgIGJlZ2luCiAgICAgIH0pOwogICAgfSk7CiAgfQogIHJlcXVlc3RBbGxDaHVua3Mobm9GZXRjaCA9IGZhbHNlKSB7CiAgICBpZiAoIW5vRmV0Y2gpIHsKICAgICAgY29uc3QgbWlzc2luZ0NodW5rcyA9IHRoaXMuc3RyZWFtLmdldE1pc3NpbmdDaHVua3MoKTsKICAgICAgdGhpcy5fcmVxdWVzdENodW5rcyhtaXNzaW5nQ2h1bmtzKTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9sb2FkZWRTdHJlYW1DYXBhYmlsaXR5LnByb21pc2U7CiAgfQogIF9yZXF1ZXN0Q2h1bmtzKGNodW5rcykgewogICAgY29uc3QgcmVxdWVzdElkID0gdGhpcy5jdXJyUmVxdWVzdElkKys7CiAgICBjb25zdCBjaHVua3NOZWVkZWQgPSBuZXcgU2V0KCk7CiAgICB0aGlzLl9jaHVua3NOZWVkZWRCeVJlcXVlc3Quc2V0KHJlcXVlc3RJZCwgY2h1bmtzTmVlZGVkKTsKICAgIGZvciAoY29uc3QgY2h1bmsgb2YgY2h1bmtzKSB7CiAgICAgIGlmICghdGhpcy5zdHJlYW0uaGFzQ2h1bmsoY2h1bmspKSB7CiAgICAgICAgY2h1bmtzTmVlZGVkLmFkZChjaHVuayk7CiAgICAgIH0KICAgIH0KICAgIGlmIChjaHVua3NOZWVkZWQuc2l6ZSA9PT0gMCkgewogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICB9CiAgICBjb25zdCBjYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICB0aGlzLl9wcm9taXNlc0J5UmVxdWVzdC5zZXQocmVxdWVzdElkLCBjYXBhYmlsaXR5KTsKICAgIGNvbnN0IGNodW5rc1RvUmVxdWVzdCA9IFtdOwogICAgZm9yIChjb25zdCBjaHVuayBvZiBjaHVua3NOZWVkZWQpIHsKICAgICAgbGV0IHJlcXVlc3RJZHMgPSB0aGlzLl9yZXF1ZXN0c0J5Q2h1bmsuZ2V0KGNodW5rKTsKICAgICAgaWYgKCFyZXF1ZXN0SWRzKSB7CiAgICAgICAgcmVxdWVzdElkcyA9IFtdOwogICAgICAgIHRoaXMuX3JlcXVlc3RzQnlDaHVuay5zZXQoY2h1bmssIHJlcXVlc3RJZHMpOwogICAgICAgIGNodW5rc1RvUmVxdWVzdC5wdXNoKGNodW5rKTsKICAgICAgfQogICAgICByZXF1ZXN0SWRzLnB1c2gocmVxdWVzdElkKTsKICAgIH0KICAgIGlmIChjaHVua3NUb1JlcXVlc3QubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBncm91cGVkQ2h1bmtzVG9SZXF1ZXN0ID0gdGhpcy5ncm91cENodW5rcyhjaHVua3NUb1JlcXVlc3QpOwogICAgICBmb3IgKGNvbnN0IGdyb3VwZWRDaHVuayBvZiBncm91cGVkQ2h1bmtzVG9SZXF1ZXN0KSB7CiAgICAgICAgY29uc3QgYmVnaW4gPSBncm91cGVkQ2h1bmsuYmVnaW5DaHVuayAqIHRoaXMuY2h1bmtTaXplOwogICAgICAgIGNvbnN0IGVuZCA9IE1hdGgubWluKGdyb3VwZWRDaHVuay5lbmRDaHVuayAqIHRoaXMuY2h1bmtTaXplLCB0aGlzLmxlbmd0aCk7CiAgICAgICAgdGhpcy5zZW5kUmVxdWVzdChiZWdpbiwgZW5kKS5jYXRjaChjYXBhYmlsaXR5LnJlamVjdCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2UuY2F0Y2gocmVhc29uID0+IHsKICAgICAgaWYgKHRoaXMuYWJvcnRlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aHJvdyByZWFzb247CiAgICB9KTsKICB9CiAgZ2V0U3RyZWFtKCkgewogICAgcmV0dXJuIHRoaXMuc3RyZWFtOwogIH0KICByZXF1ZXN0UmFuZ2UoYmVnaW4sIGVuZCkgewogICAgZW5kID0gTWF0aC5taW4oZW5kLCB0aGlzLmxlbmd0aCk7CiAgICBjb25zdCBiZWdpbkNodW5rID0gdGhpcy5nZXRCZWdpbkNodW5rKGJlZ2luKTsKICAgIGNvbnN0IGVuZENodW5rID0gdGhpcy5nZXRFbmRDaHVuayhlbmQpOwogICAgY29uc3QgY2h1bmtzID0gW107CiAgICBmb3IgKGxldCBjaHVuayA9IGJlZ2luQ2h1bms7IGNodW5rIDwgZW5kQ2h1bms7ICsrY2h1bmspIHsKICAgICAgY2h1bmtzLnB1c2goY2h1bmspOwogICAgfQogICAgcmV0dXJuIHRoaXMuX3JlcXVlc3RDaHVua3MoY2h1bmtzKTsKICB9CiAgcmVxdWVzdFJhbmdlcyhyYW5nZXMgPSBbXSkgewogICAgY29uc3QgY2h1bmtzVG9SZXF1ZXN0ID0gW107CiAgICBmb3IgKGNvbnN0IHJhbmdlIG9mIHJhbmdlcykgewogICAgICBjb25zdCBiZWdpbkNodW5rID0gdGhpcy5nZXRCZWdpbkNodW5rKHJhbmdlLmJlZ2luKTsKICAgICAgY29uc3QgZW5kQ2h1bmsgPSB0aGlzLmdldEVuZENodW5rKHJhbmdlLmVuZCk7CiAgICAgIGZvciAobGV0IGNodW5rID0gYmVnaW5DaHVuazsgY2h1bmsgPCBlbmRDaHVuazsgKytjaHVuaykgewogICAgICAgIGlmICghY2h1bmtzVG9SZXF1ZXN0LmluY2x1ZGVzKGNodW5rKSkgewogICAgICAgICAgY2h1bmtzVG9SZXF1ZXN0LnB1c2goY2h1bmspOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY2h1bmtzVG9SZXF1ZXN0LnNvcnQoKGEsIGIpID0+IGEgLSBiKTsKICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0Q2h1bmtzKGNodW5rc1RvUmVxdWVzdCk7CiAgfQogIGdyb3VwQ2h1bmtzKGNodW5rcykgewogICAgY29uc3QgZ3JvdXBlZENodW5rcyA9IFtdOwogICAgbGV0IGJlZ2luQ2h1bmsgPSAtMTsKICAgIGxldCBwcmV2Q2h1bmsgPSAtMTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGNodW5rcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgIGNvbnN0IGNodW5rID0gY2h1bmtzW2ldOwogICAgICBpZiAoYmVnaW5DaHVuayA8IDApIHsKICAgICAgICBiZWdpbkNodW5rID0gY2h1bms7CiAgICAgIH0KICAgICAgaWYgKHByZXZDaHVuayA+PSAwICYmIHByZXZDaHVuayArIDEgIT09IGNodW5rKSB7CiAgICAgICAgZ3JvdXBlZENodW5rcy5wdXNoKHsKICAgICAgICAgIGJlZ2luQ2h1bmssCiAgICAgICAgICBlbmRDaHVuazogcHJldkNodW5rICsgMQogICAgICAgIH0pOwogICAgICAgIGJlZ2luQ2h1bmsgPSBjaHVuazsKICAgICAgfQogICAgICBpZiAoaSArIDEgPT09IGNodW5rcy5sZW5ndGgpIHsKICAgICAgICBncm91cGVkQ2h1bmtzLnB1c2goewogICAgICAgICAgYmVnaW5DaHVuaywKICAgICAgICAgIGVuZENodW5rOiBjaHVuayArIDEKICAgICAgICB9KTsKICAgICAgfQogICAgICBwcmV2Q2h1bmsgPSBjaHVuazsKICAgIH0KICAgIHJldHVybiBncm91cGVkQ2h1bmtzOwogIH0KICBvblByb2dyZXNzKGFyZ3MpIHsKICAgIHRoaXMubXNnSGFuZGxlci5zZW5kKCJEb2NQcm9ncmVzcyIsIHsKICAgICAgbG9hZGVkOiB0aGlzLnN0cmVhbS5udW1DaHVua3NMb2FkZWQgKiB0aGlzLmNodW5rU2l6ZSArIGFyZ3MubG9hZGVkLAogICAgICB0b3RhbDogdGhpcy5sZW5ndGgKICAgIH0pOwogIH0KICBvblJlY2VpdmVEYXRhKGFyZ3MpIHsKICAgIGNvbnN0IGNodW5rID0gYXJncy5jaHVuazsKICAgIGNvbnN0IGlzUHJvZ3Jlc3NpdmUgPSBhcmdzLmJlZ2luID09PSB1bmRlZmluZWQ7CiAgICBjb25zdCBiZWdpbiA9IGlzUHJvZ3Jlc3NpdmUgPyB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCA6IGFyZ3MuYmVnaW47CiAgICBjb25zdCBlbmQgPSBiZWdpbiArIGNodW5rLmJ5dGVMZW5ndGg7CiAgICBjb25zdCBiZWdpbkNodW5rID0gTWF0aC5mbG9vcihiZWdpbiAvIHRoaXMuY2h1bmtTaXplKTsKICAgIGNvbnN0IGVuZENodW5rID0gZW5kIDwgdGhpcy5sZW5ndGggPyBNYXRoLmZsb29yKGVuZCAvIHRoaXMuY2h1bmtTaXplKSA6IE1hdGguY2VpbChlbmQgLyB0aGlzLmNodW5rU2l6ZSk7CiAgICBpZiAoaXNQcm9ncmVzc2l2ZSkgewogICAgICB0aGlzLnN0cmVhbS5vblJlY2VpdmVQcm9ncmVzc2l2ZURhdGEoY2h1bmspOwogICAgICB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCA9IGVuZDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuc3RyZWFtLm9uUmVjZWl2ZURhdGEoYmVnaW4sIGNodW5rKTsKICAgIH0KICAgIGlmICh0aGlzLnN0cmVhbS5pc0RhdGFMb2FkZWQpIHsKICAgICAgdGhpcy5fbG9hZGVkU3RyZWFtQ2FwYWJpbGl0eS5yZXNvbHZlKHRoaXMuc3RyZWFtKTsKICAgIH0KICAgIGNvbnN0IGxvYWRlZFJlcXVlc3RzID0gW107CiAgICBmb3IgKGxldCBjdXJDaHVuayA9IGJlZ2luQ2h1bms7IGN1ckNodW5rIDwgZW5kQ2h1bms7ICsrY3VyQ2h1bmspIHsKICAgICAgY29uc3QgcmVxdWVzdElkcyA9IHRoaXMuX3JlcXVlc3RzQnlDaHVuay5nZXQoY3VyQ2h1bmspOwogICAgICBpZiAoIXJlcXVlc3RJZHMpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB0aGlzLl9yZXF1ZXN0c0J5Q2h1bmsuZGVsZXRlKGN1ckNodW5rKTsKICAgICAgZm9yIChjb25zdCByZXF1ZXN0SWQgb2YgcmVxdWVzdElkcykgewogICAgICAgIGNvbnN0IGNodW5rc05lZWRlZCA9IHRoaXMuX2NodW5rc05lZWRlZEJ5UmVxdWVzdC5nZXQocmVxdWVzdElkKTsKICAgICAgICBpZiAoY2h1bmtzTmVlZGVkLmhhcyhjdXJDaHVuaykpIHsKICAgICAgICAgIGNodW5rc05lZWRlZC5kZWxldGUoY3VyQ2h1bmspOwogICAgICAgIH0KICAgICAgICBpZiAoY2h1bmtzTmVlZGVkLnNpemUgPiAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgbG9hZGVkUmVxdWVzdHMucHVzaChyZXF1ZXN0SWQpOwogICAgICB9CiAgICB9CiAgICBpZiAoIXRoaXMuZGlzYWJsZUF1dG9GZXRjaCAmJiB0aGlzLl9yZXF1ZXN0c0J5Q2h1bmsuc2l6ZSA9PT0gMCkgewogICAgICBsZXQgbmV4dEVtcHR5Q2h1bms7CiAgICAgIGlmICh0aGlzLnN0cmVhbS5udW1DaHVua3NMb2FkZWQgPT09IDEpIHsKICAgICAgICBjb25zdCBsYXN0Q2h1bmsgPSB0aGlzLnN0cmVhbS5udW1DaHVua3MgLSAxOwogICAgICAgIGlmICghdGhpcy5zdHJlYW0uaGFzQ2h1bmsobGFzdENodW5rKSkgewogICAgICAgICAgbmV4dEVtcHR5Q2h1bmsgPSBsYXN0Q2h1bms7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIG5leHRFbXB0eUNodW5rID0gdGhpcy5zdHJlYW0ubmV4dEVtcHR5Q2h1bmsoZW5kQ2h1bmspOwogICAgICB9CiAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG5leHRFbXB0eUNodW5rKSkgewogICAgICAgIHRoaXMuX3JlcXVlc3RDaHVua3MoW25leHRFbXB0eUNodW5rXSk7CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3QgcmVxdWVzdElkIG9mIGxvYWRlZFJlcXVlc3RzKSB7CiAgICAgIGNvbnN0IGNhcGFiaWxpdHkgPSB0aGlzLl9wcm9taXNlc0J5UmVxdWVzdC5nZXQocmVxdWVzdElkKTsKICAgICAgdGhpcy5fcHJvbWlzZXNCeVJlcXVlc3QuZGVsZXRlKHJlcXVlc3RJZCk7CiAgICAgIGNhcGFiaWxpdHkucmVzb2x2ZSgpOwogICAgfQogICAgdGhpcy5tc2dIYW5kbGVyLnNlbmQoIkRvY1Byb2dyZXNzIiwgewogICAgICBsb2FkZWQ6IHRoaXMuc3RyZWFtLm51bUNodW5rc0xvYWRlZCAqIHRoaXMuY2h1bmtTaXplLAogICAgICB0b3RhbDogdGhpcy5sZW5ndGgKICAgIH0pOwogIH0KICBvbkVycm9yKGVycikgewogICAgdGhpcy5fbG9hZGVkU3RyZWFtQ2FwYWJpbGl0eS5yZWplY3QoZXJyKTsKICB9CiAgZ2V0QmVnaW5DaHVuayhiZWdpbikgewogICAgcmV0dXJuIE1hdGguZmxvb3IoYmVnaW4gLyB0aGlzLmNodW5rU2l6ZSk7CiAgfQogIGdldEVuZENodW5rKGVuZCkgewogICAgcmV0dXJuIE1hdGguZmxvb3IoKGVuZCAtIDEpIC8gdGhpcy5jaHVua1NpemUpICsgMTsKICB9CiAgYWJvcnQocmVhc29uKSB7CiAgICB0aGlzLmFib3J0ZWQgPSB0cnVlOwogICAgdGhpcy5wZGZOZXR3b3JrU3RyZWFtPy5jYW5jZWxBbGxSZXF1ZXN0cyhyZWFzb24pOwogICAgZm9yIChjb25zdCBjYXBhYmlsaXR5IG9mIHRoaXMuX3Byb21pc2VzQnlSZXF1ZXN0LnZhbHVlcygpKSB7CiAgICAgIGNhcGFiaWxpdHkucmVqZWN0KHJlYXNvbik7CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvc2hhcmVkL2ltYWdlX3V0aWxzLmpzCgpmdW5jdGlvbiBjb252ZXJ0VG9SR0JBKHBhcmFtcykgewogIHN3aXRjaCAocGFyYW1zLmtpbmQpIHsKICAgIGNhc2UgSW1hZ2VLaW5kLkdSQVlTQ0FMRV8xQlBQOgogICAgICByZXR1cm4gY29udmVydEJsYWNrQW5kV2hpdGVUb1JHQkEocGFyYW1zKTsKICAgIGNhc2UgSW1hZ2VLaW5kLlJHQl8yNEJQUDoKICAgICAgcmV0dXJuIGNvbnZlcnRSR0JUb1JHQkEocGFyYW1zKTsKICB9CiAgcmV0dXJuIG51bGw7Cn0KZnVuY3Rpb24gY29udmVydEJsYWNrQW5kV2hpdGVUb1JHQkEoewogIHNyYywKICBzcmNQb3MgPSAwLAogIGRlc3QsCiAgd2lkdGgsCiAgaGVpZ2h0LAogIG5vbkJsYWNrQ29sb3IgPSAweGZmZmZmZmZmLAogIGludmVyc2VEZWNvZGUgPSBmYWxzZQp9KSB7CiAgY29uc3QgYmxhY2sgPSBGZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbiA/IDB4ZmYwMDAwMDAgOiAweDAwMDAwMGZmOwogIGNvbnN0IFt6ZXJvTWFwcGluZywgb25lTWFwcGluZ10gPSBpbnZlcnNlRGVjb2RlID8gW25vbkJsYWNrQ29sb3IsIGJsYWNrXSA6IFtibGFjaywgbm9uQmxhY2tDb2xvcl07CiAgY29uc3Qgd2lkdGhJblNvdXJjZSA9IHdpZHRoID4+IDM7CiAgY29uc3Qgd2lkdGhSZW1haW5kZXIgPSB3aWR0aCAmIDc7CiAgY29uc3Qgc3JjTGVuZ3RoID0gc3JjLmxlbmd0aDsKICBkZXN0ID0gbmV3IFVpbnQzMkFycmF5KGRlc3QuYnVmZmVyKTsKICBsZXQgZGVzdFBvcyA9IDA7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgZm9yIChjb25zdCBtYXggPSBzcmNQb3MgKyB3aWR0aEluU291cmNlOyBzcmNQb3MgPCBtYXg7IHNyY1BvcysrKSB7CiAgICAgIGNvbnN0IGVsZW0gPSBzcmNQb3MgPCBzcmNMZW5ndGggPyBzcmNbc3JjUG9zXSA6IDI1NTsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAwMDAwMDAgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAwYjEwMDAwMDAgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAwYjEwMDAwMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAwMDAgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAwYjEwMDAgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAwYjEwMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAwYjEgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICB9CiAgICBpZiAod2lkdGhSZW1haW5kZXIgPT09IDApIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBjb25zdCBlbGVtID0gc3JjUG9zIDwgc3JjTGVuZ3RoID8gc3JjW3NyY1BvcysrXSA6IDI1NTsKICAgIGZvciAobGV0IGogPSAwOyBqIDwgd2lkdGhSZW1haW5kZXI7IGorKykgewogICAgICBkZXN0W2Rlc3RQb3MrK10gPSBlbGVtICYgMSA8PCA3IC0gaiA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgIH0KICB9CiAgcmV0dXJuIHsKICAgIHNyY1BvcywKICAgIGRlc3RQb3MKICB9Owp9CmZ1bmN0aW9uIGNvbnZlcnRSR0JUb1JHQkEoewogIHNyYywKICBzcmNQb3MgPSAwLAogIGRlc3QsCiAgZGVzdFBvcyA9IDAsCiAgd2lkdGgsCiAgaGVpZ2h0Cn0pIHsKICBsZXQgaSA9IDA7CiAgY29uc3QgbGVuID0gd2lkdGggKiBoZWlnaHQgKiAzOwogIGNvbnN0IGxlbjMyID0gbGVuID4+IDI7CiAgY29uc3Qgc3JjMzIgPSBuZXcgVWludDMyQXJyYXkoc3JjLmJ1ZmZlciwgc3JjUG9zLCBsZW4zMik7CiAgaWYgKEZlYXR1cmVUZXN0LmlzTGl0dGxlRW5kaWFuKSB7CiAgICBmb3IgKDsgaSA8IGxlbjMyIC0gMjsgaSArPSAzLCBkZXN0UG9zICs9IDQpIHsKICAgICAgY29uc3QgczEgPSBzcmMzMltpXTsKICAgICAgY29uc3QgczIgPSBzcmMzMltpICsgMV07CiAgICAgIGNvbnN0IHMzID0gc3JjMzJbaSArIDJdOwogICAgICBkZXN0W2Rlc3RQb3NdID0gczEgfCAweGZmMDAwMDAwOwogICAgICBkZXN0W2Rlc3RQb3MgKyAxXSA9IHMxID4+PiAyNCB8IHMyIDw8IDggfCAweGZmMDAwMDAwOwogICAgICBkZXN0W2Rlc3RQb3MgKyAyXSA9IHMyID4+PiAxNiB8IHMzIDw8IDE2IHwgMHhmZjAwMDAwMDsKICAgICAgZGVzdFtkZXN0UG9zICsgM10gPSBzMyA+Pj4gOCB8IDB4ZmYwMDAwMDA7CiAgICB9CiAgICBmb3IgKGxldCBqID0gaSAqIDQsIGpqID0gc3JjUG9zICsgbGVuOyBqIDwgamo7IGogKz0gMykgewogICAgICBkZXN0W2Rlc3RQb3MrK10gPSBzcmNbal0gfCBzcmNbaiArIDFdIDw8IDggfCBzcmNbaiArIDJdIDw8IDE2IHwgMHhmZjAwMDAwMDsKICAgIH0KICB9IGVsc2UgewogICAgZm9yICg7IGkgPCBsZW4zMiAtIDI7IGkgKz0gMywgZGVzdFBvcyArPSA0KSB7CiAgICAgIGNvbnN0IHMxID0gc3JjMzJbaV07CiAgICAgIGNvbnN0IHMyID0gc3JjMzJbaSArIDFdOwogICAgICBjb25zdCBzMyA9IHNyYzMyW2kgKyAyXTsKICAgICAgZGVzdFtkZXN0UG9zXSA9IHMxIHwgMHhmZjsKICAgICAgZGVzdFtkZXN0UG9zICsgMV0gPSBzMSA8PCAyNCB8IHMyID4+PiA4IHwgMHhmZjsKICAgICAgZGVzdFtkZXN0UG9zICsgMl0gPSBzMiA8PCAxNiB8IHMzID4+PiAxNiB8IDB4ZmY7CiAgICAgIGRlc3RbZGVzdFBvcyArIDNdID0gczMgPDwgOCB8IDB4ZmY7CiAgICB9CiAgICBmb3IgKGxldCBqID0gaSAqIDQsIGpqID0gc3JjUG9zICsgbGVuOyBqIDwgamo7IGogKz0gMykgewogICAgICBkZXN0W2Rlc3RQb3MrK10gPSBzcmNbal0gPDwgMjQgfCBzcmNbaiArIDFdIDw8IDE2IHwgc3JjW2ogKyAyXSA8PCA4IHwgMHhmZjsKICAgIH0KICB9CiAgcmV0dXJuIHsKICAgIHNyY1Bvczogc3JjUG9zICsgbGVuLAogICAgZGVzdFBvcwogIH07Cn0KZnVuY3Rpb24gZ3JheVRvUkdCQShzcmMsIGRlc3QpIHsKICBpZiAoRmVhdHVyZVRlc3QuaXNMaXR0bGVFbmRpYW4pIHsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHNyYy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGRlc3RbaV0gPSBzcmNbaV0gKiAweDEwMTAxIHwgMHhmZjAwMDAwMDsKICAgIH0KICB9IGVsc2UgewogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3JjLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgZGVzdFtpXSA9IHNyY1tpXSAqIDB4MTAxMDEwMCB8IDB4MDAwMDAwZmY7CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9pbWFnZV9yZXNpemVyLmpzCgoKCmNvbnN0IE1JTl9JTUFHRV9ESU0gPSAyMDQ4Owpjb25zdCBNQVhfSU1BR0VfRElNID0gNjU1Mzc7CmNvbnN0IE1BWF9FUlJPUiA9IDEyODsKY2xhc3MgSW1hZ2VSZXNpemVyIHsKICBzdGF0aWMgI2dvb2RTcXVhcmVMZW5ndGggPSBNSU5fSU1BR0VfRElNOwogIHN0YXRpYyAjaXNJbWFnZURlY29kZXJTdXBwb3J0ZWQgPSBGZWF0dXJlVGVzdC5pc0ltYWdlRGVjb2RlclN1cHBvcnRlZDsKICBjb25zdHJ1Y3RvcihpbWdEYXRhLCBpc01hc2spIHsKICAgIHRoaXMuX2ltZ0RhdGEgPSBpbWdEYXRhOwogICAgdGhpcy5faXNNYXNrID0gaXNNYXNrOwogIH0KICBzdGF0aWMgZ2V0IGNhblVzZUltYWdlRGVjb2RlcigpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImNhblVzZUltYWdlRGVjb2RlciIsIHRoaXMuI2lzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkID8gSW1hZ2VEZWNvZGVyLmlzVHlwZVN1cHBvcnRlZCgiaW1hZ2UvYm1wIikgOiBQcm9taXNlLnJlc29sdmUoZmFsc2UpKTsKICB9CiAgc3RhdGljIG5lZWRzVG9CZVJlc2l6ZWQod2lkdGgsIGhlaWdodCkgewogICAgaWYgKHdpZHRoIDw9IHRoaXMuI2dvb2RTcXVhcmVMZW5ndGggJiYgaGVpZ2h0IDw9IHRoaXMuI2dvb2RTcXVhcmVMZW5ndGgpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgewogICAgICBNQVhfRElNCiAgICB9ID0gdGhpczsKICAgIGlmICh3aWR0aCA+IE1BWF9ESU0gfHwgaGVpZ2h0ID4gTUFYX0RJTSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGNvbnN0IGFyZWEgPSB3aWR0aCAqIGhlaWdodDsKICAgIGlmICh0aGlzLl9oYXNNYXhBcmVhKSB7CiAgICAgIHJldHVybiBhcmVhID4gdGhpcy5NQVhfQVJFQTsKICAgIH0KICAgIGlmIChhcmVhIDwgdGhpcy4jZ29vZFNxdWFyZUxlbmd0aCAqKiAyKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzLl9hcmVHb29kRGltcyh3aWR0aCwgaGVpZ2h0KSkgewogICAgICB0aGlzLiNnb29kU3F1YXJlTGVuZ3RoID0gTWF0aC5tYXgodGhpcy4jZ29vZFNxdWFyZUxlbmd0aCwgTWF0aC5mbG9vcihNYXRoLnNxcnQod2lkdGggKiBoZWlnaHQpKSk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRoaXMuI2dvb2RTcXVhcmVMZW5ndGggPSB0aGlzLl9ndWVzc01heCh0aGlzLiNnb29kU3F1YXJlTGVuZ3RoLCBNQVhfRElNLCBNQVhfRVJST1IsIDApOwogICAgY29uc3QgbWF4QXJlYSA9IHRoaXMuTUFYX0FSRUEgPSB0aGlzLiNnb29kU3F1YXJlTGVuZ3RoICoqIDI7CiAgICByZXR1cm4gYXJlYSA+IG1heEFyZWE7CiAgfQogIHN0YXRpYyBnZXRSZWR1Y2VQb3dlckZvckpQWCh3aWR0aCwgaGVpZ2h0LCBjb21wb25lbnRzQ291bnQpIHsKICAgIGNvbnN0IGFyZWEgPSB3aWR0aCAqIGhlaWdodDsKICAgIGNvbnN0IG1heEpQWEFyZWEgPSAyICoqIDMwIC8gKGNvbXBvbmVudHNDb3VudCAqIDQpOwogICAgaWYgKCF0aGlzLm5lZWRzVG9CZVJlc2l6ZWQod2lkdGgsIGhlaWdodCkpIHsKICAgICAgaWYgKGFyZWEgPiBtYXhKUFhBcmVhKSB7CiAgICAgICAgcmV0dXJuIE1hdGguY2VpbChNYXRoLmxvZzIoYXJlYSAvIG1heEpQWEFyZWEpKTsKICAgICAgfQogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgTUFYX0RJTSwKICAgICAgTUFYX0FSRUEKICAgIH0gPSB0aGlzOwogICAgY29uc3QgbWluRmFjdG9yID0gTWF0aC5tYXgod2lkdGggLyBNQVhfRElNLCBoZWlnaHQgLyBNQVhfRElNLCBNYXRoLnNxcnQoYXJlYSAvIE1hdGgubWluKG1heEpQWEFyZWEsIE1BWF9BUkVBKSkpOwogICAgcmV0dXJuIE1hdGguY2VpbChNYXRoLmxvZzIobWluRmFjdG9yKSk7CiAgfQogIHN0YXRpYyBnZXQgTUFYX0RJTSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgIk1BWF9ESU0iLCB0aGlzLl9ndWVzc01heChNSU5fSU1BR0VfRElNLCBNQVhfSU1BR0VfRElNLCAwLCAxKSk7CiAgfQogIHN0YXRpYyBnZXQgTUFYX0FSRUEoKSB7CiAgICB0aGlzLl9oYXNNYXhBcmVhID0gdHJ1ZTsKICAgIHJldHVybiBzaGFkb3codGhpcywgIk1BWF9BUkVBIiwgdGhpcy5fZ3Vlc3NNYXgodGhpcy4jZ29vZFNxdWFyZUxlbmd0aCwgdGhpcy5NQVhfRElNLCBNQVhfRVJST1IsIDApICoqIDIpOwogIH0KICBzdGF0aWMgc2V0IE1BWF9BUkVBKGFyZWEpIHsKICAgIGlmIChhcmVhID49IDApIHsKICAgICAgdGhpcy5faGFzTWF4QXJlYSA9IHRydWU7CiAgICAgIHNoYWRvdyh0aGlzLCAiTUFYX0FSRUEiLCBhcmVhKTsKICAgIH0KICB9CiAgc3RhdGljIHNldE9wdGlvbnMoewogICAgY2FudmFzTWF4QXJlYUluQnl0ZXMgPSAtMSwKICAgIGlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkID0gZmFsc2UKICB9KSB7CiAgICBpZiAoIXRoaXMuX2hhc01heEFyZWEpIHsKICAgICAgdGhpcy5NQVhfQVJFQSA9IGNhbnZhc01heEFyZWFJbkJ5dGVzID4+IDI7CiAgICB9CiAgICB0aGlzLiNpc0ltYWdlRGVjb2RlclN1cHBvcnRlZCA9IGlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkOwogIH0KICBzdGF0aWMgX2FyZUdvb2REaW1zKHdpZHRoLCBoZWlnaHQpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IGNhbnZhcyA9IG5ldyBPZmZzY3JlZW5DYW52YXMod2lkdGgsIGhlaWdodCk7CiAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICBjdHguZmlsbFJlY3QoMCwgMCwgMSwgMSk7CiAgICAgIGNvbnN0IG9wYWNpdHkgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIDEsIDEpLmRhdGFbM107CiAgICAgIGNhbnZhcy53aWR0aCA9IGNhbnZhcy5oZWlnaHQgPSAxOwogICAgICByZXR1cm4gb3BhY2l0eSAhPT0gMDsKICAgIH0gY2F0Y2ggewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQogIHN0YXRpYyBfZ3Vlc3NNYXgoc3RhcnQsIGVuZCwgdG9sZXJhbmNlLCBkZWZhdWx0SGVpZ2h0KSB7CiAgICB3aGlsZSAoc3RhcnQgKyB0b2xlcmFuY2UgKyAxIDwgZW5kKSB7CiAgICAgIGNvbnN0IG1pZGRsZSA9IE1hdGguZmxvb3IoKHN0YXJ0ICsgZW5kKSAvIDIpOwogICAgICBjb25zdCBoZWlnaHQgPSBkZWZhdWx0SGVpZ2h0IHx8IG1pZGRsZTsKICAgICAgaWYgKHRoaXMuX2FyZUdvb2REaW1zKG1pZGRsZSwgaGVpZ2h0KSkgewogICAgICAgIHN0YXJ0ID0gbWlkZGxlOwogICAgICB9IGVsc2UgewogICAgICAgIGVuZCA9IG1pZGRsZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHN0YXJ0OwogIH0KICBzdGF0aWMgYXN5bmMgY3JlYXRlSW1hZ2UoaW1nRGF0YSwgaXNNYXNrID0gZmFsc2UpIHsKICAgIHJldHVybiBuZXcgSW1hZ2VSZXNpemVyKGltZ0RhdGEsIGlzTWFzaykuX2NyZWF0ZUltYWdlKCk7CiAgfQogIGFzeW5jIF9jcmVhdGVJbWFnZSgpIHsKICAgIGNvbnN0IHsKICAgICAgX2ltZ0RhdGE6IGltZ0RhdGEKICAgIH0gPSB0aGlzOwogICAgY29uc3QgewogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0CiAgICB9ID0gaW1nRGF0YTsKICAgIGlmICh3aWR0aCAqIGhlaWdodCAqIDQgPiBNQVhfSU5UXzMyKSB7CiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuI3Jlc2NhbGVJbWFnZURhdGEoKTsKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGRhdGEgPSB0aGlzLl9lbmNvZGVCTVAoKTsKICAgIGxldCBkZWNvZGVyLCBpbWFnZVByb21pc2U7CiAgICBpZiAoYXdhaXQgSW1hZ2VSZXNpemVyLmNhblVzZUltYWdlRGVjb2RlcikgewogICAgICBkZWNvZGVyID0gbmV3IEltYWdlRGVjb2Rlcih7CiAgICAgICAgZGF0YSwKICAgICAgICB0eXBlOiAiaW1hZ2UvYm1wIiwKICAgICAgICBwcmVmZXJBbmltYXRpb246IGZhbHNlLAogICAgICAgIHRyYW5zZmVyOiBbZGF0YS5idWZmZXJdCiAgICAgIH0pOwogICAgICBpbWFnZVByb21pc2UgPSBkZWNvZGVyLmRlY29kZSgpLmNhdGNoKHJlYXNvbiA9PiB7CiAgICAgICAgd2FybihgQk1QIGltYWdlIGRlY29kaW5nIGZhaWxlZDogJHtyZWFzb259YCk7CiAgICAgICAgcmV0dXJuIGNyZWF0ZUltYWdlQml0bWFwKG5ldyBCbG9iKFt0aGlzLl9lbmNvZGVCTVAoKS5idWZmZXJdLCB7CiAgICAgICAgICB0eXBlOiAiaW1hZ2UvYm1wIgogICAgICAgIH0pKTsKICAgICAgfSkuZmluYWxseSgoKSA9PiB7CiAgICAgICAgZGVjb2Rlci5jbG9zZSgpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGltYWdlUHJvbWlzZSA9IGNyZWF0ZUltYWdlQml0bWFwKG5ldyBCbG9iKFtkYXRhLmJ1ZmZlcl0sIHsKICAgICAgICB0eXBlOiAiaW1hZ2UvYm1wIgogICAgICB9KSk7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIE1BWF9BUkVBLAogICAgICBNQVhfRElNCiAgICB9ID0gSW1hZ2VSZXNpemVyOwogICAgY29uc3QgbWluRmFjdG9yID0gTWF0aC5tYXgod2lkdGggLyBNQVhfRElNLCBoZWlnaHQgLyBNQVhfRElNLCBNYXRoLnNxcnQod2lkdGggKiBoZWlnaHQgLyBNQVhfQVJFQSkpOwogICAgY29uc3QgZmlyc3RGYWN0b3IgPSBNYXRoLm1heChtaW5GYWN0b3IsIDIpOwogICAgY29uc3QgZmFjdG9yID0gTWF0aC5yb3VuZCgxMCAqIChtaW5GYWN0b3IgKyAxLjI1KSkgLyAxMCAvIGZpcnN0RmFjdG9yOwogICAgY29uc3QgTiA9IE1hdGguZmxvb3IoTWF0aC5sb2cyKGZhY3RvcikpOwogICAgY29uc3Qgc3RlcHMgPSBuZXcgQXJyYXkoTiArIDIpLmZpbGwoMik7CiAgICBzdGVwc1swXSA9IGZpcnN0RmFjdG9yOwogICAgc3RlcHMuc3BsaWNlKC0xLCAxLCBmYWN0b3IgLyAoMSA8PCBOKSk7CiAgICBsZXQgbmV3V2lkdGggPSB3aWR0aDsKICAgIGxldCBuZXdIZWlnaHQgPSBoZWlnaHQ7CiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbWFnZVByb21pc2U7CiAgICBsZXQgYml0bWFwID0gcmVzdWx0LmltYWdlIHx8IHJlc3VsdDsKICAgIGZvciAoY29uc3Qgc3RlcCBvZiBzdGVwcykgewogICAgICBjb25zdCBwcmV2V2lkdGggPSBuZXdXaWR0aDsKICAgICAgY29uc3QgcHJldkhlaWdodCA9IG5ld0hlaWdodDsKICAgICAgbmV3V2lkdGggPSBNYXRoLmZsb29yKG5ld1dpZHRoIC8gc3RlcCkgLSAxOwogICAgICBuZXdIZWlnaHQgPSBNYXRoLmZsb29yKG5ld0hlaWdodCAvIHN0ZXApIC0gMTsKICAgICAgY29uc3QgY2FudmFzID0gbmV3IE9mZnNjcmVlbkNhbnZhcyhuZXdXaWR0aCwgbmV3SGVpZ2h0KTsKICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwLCBwcmV2V2lkdGgsIHByZXZIZWlnaHQsIDAsIDAsIG5ld1dpZHRoLCBuZXdIZWlnaHQpOwogICAgICBiaXRtYXAuY2xvc2UoKTsKICAgICAgYml0bWFwID0gY2FudmFzLnRyYW5zZmVyVG9JbWFnZUJpdG1hcCgpOwogICAgfQogICAgaW1nRGF0YS5kYXRhID0gbnVsbDsKICAgIGltZ0RhdGEuYml0bWFwID0gYml0bWFwOwogICAgaW1nRGF0YS53aWR0aCA9IG5ld1dpZHRoOwogICAgaW1nRGF0YS5oZWlnaHQgPSBuZXdIZWlnaHQ7CiAgICByZXR1cm4gaW1nRGF0YTsKICB9CiAgI3Jlc2NhbGVJbWFnZURhdGEoKSB7CiAgICBjb25zdCB7CiAgICAgIF9pbWdEYXRhOiBpbWdEYXRhCiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHsKICAgICAgZGF0YSwKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodCwKICAgICAga2luZAogICAgfSA9IGltZ0RhdGE7CiAgICBjb25zdCByZ2JhU2l6ZSA9IHdpZHRoICogaGVpZ2h0ICogNDsKICAgIGNvbnN0IEsgPSBNYXRoLmNlaWwoTWF0aC5sb2cyKHJnYmFTaXplIC8gTUFYX0lOVF8zMikpOwogICAgY29uc3QgbmV3V2lkdGggPSB3aWR0aCA+PiBLOwogICAgY29uc3QgbmV3SGVpZ2h0ID0gaGVpZ2h0ID4+IEs7CiAgICBsZXQgcmdiYURhdGE7CiAgICBsZXQgbWF4SGVpZ2h0ID0gaGVpZ2h0OwogICAgdHJ5IHsKICAgICAgcmdiYURhdGEgPSBuZXcgVWludDhBcnJheShyZ2JhU2l6ZSk7CiAgICB9IGNhdGNoIHsKICAgICAgbGV0IG4gPSBNYXRoLmZsb29yKE1hdGgubG9nMihyZ2JhU2l6ZSArIDEpKTsKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmdiYURhdGEgPSBuZXcgVWludDhBcnJheSgyICoqIG4gLSAxKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgbiAtPSAxOwogICAgICAgIH0KICAgICAgfQogICAgICBtYXhIZWlnaHQgPSBNYXRoLmZsb29yKCgyICoqIG4gLSAxKSAvICh3aWR0aCAqIDQpKTsKICAgICAgY29uc3QgbmV3U2l6ZSA9IHdpZHRoICogbWF4SGVpZ2h0ICogNDsKICAgICAgaWYgKG5ld1NpemUgPCByZ2JhRGF0YS5sZW5ndGgpIHsKICAgICAgICByZ2JhRGF0YSA9IG5ldyBVaW50OEFycmF5KG5ld1NpemUpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBzcmMzMiA9IG5ldyBVaW50MzJBcnJheShyZ2JhRGF0YS5idWZmZXIpOwogICAgY29uc3QgZGVzdDMyID0gbmV3IFVpbnQzMkFycmF5KG5ld1dpZHRoICogbmV3SGVpZ2h0KTsKICAgIGxldCBzcmNQb3MgPSAwOwogICAgbGV0IG5ld0luZGV4ID0gMDsKICAgIGNvbnN0IHN0ZXAgPSBNYXRoLmNlaWwoaGVpZ2h0IC8gbWF4SGVpZ2h0KTsKICAgIGNvbnN0IHJlbWFpbmRlciA9IGhlaWdodCAlIG1heEhlaWdodCA9PT0gMCA/IGhlaWdodCA6IGhlaWdodCAlIG1heEhlaWdodDsKICAgIGZvciAobGV0IGsgPSAwOyBrIDwgc3RlcDsgaysrKSB7CiAgICAgIGNvbnN0IGggPSBrIDwgc3RlcCAtIDEgPyBtYXhIZWlnaHQgOiByZW1haW5kZXI7CiAgICAgICh7CiAgICAgICAgc3JjUG9zCiAgICAgIH0gPSBjb252ZXJ0VG9SR0JBKHsKICAgICAgICBraW5kLAogICAgICAgIHNyYzogZGF0YSwKICAgICAgICBkZXN0OiBzcmMzMiwKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQ6IGgsCiAgICAgICAgaW52ZXJzZURlY29kZTogdGhpcy5faXNNYXNrLAogICAgICAgIHNyY1BvcwogICAgICB9KSk7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGggPj4gSzsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCBidWYgPSBzcmMzMi5zdWJhcnJheSgoaSA8PCBLKSAqIHdpZHRoKTsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IG5ld1dpZHRoOyBqKyspIHsKICAgICAgICAgIGRlc3QzMltuZXdJbmRleCsrXSA9IGJ1ZltqIDw8IEtdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKEltYWdlUmVzaXplci5uZWVkc1RvQmVSZXNpemVkKG5ld1dpZHRoLCBuZXdIZWlnaHQpKSB7CiAgICAgIGltZ0RhdGEuZGF0YSA9IGRlc3QzMjsKICAgICAgaW1nRGF0YS53aWR0aCA9IG5ld1dpZHRoOwogICAgICBpbWdEYXRhLmhlaWdodCA9IG5ld0hlaWdodDsKICAgICAgaW1nRGF0YS5raW5kID0gSW1hZ2VLaW5kLlJHQkFfMzJCUFA7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgY2FudmFzID0gbmV3IE9mZnNjcmVlbkNhbnZhcyhuZXdXaWR0aCwgbmV3SGVpZ2h0KTsKICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIsIHsKICAgICAgd2lsbFJlYWRGcmVxdWVudGx5OiB0cnVlCiAgICB9KTsKICAgIGN0eC5wdXRJbWFnZURhdGEobmV3IEltYWdlRGF0YShuZXcgVWludDhDbGFtcGVkQXJyYXkoZGVzdDMyLmJ1ZmZlciksIG5ld1dpZHRoLCBuZXdIZWlnaHQpLCAwLCAwKTsKICAgIGltZ0RhdGEuZGF0YSA9IG51bGw7CiAgICBpbWdEYXRhLmJpdG1hcCA9IGNhbnZhcy50cmFuc2ZlclRvSW1hZ2VCaXRtYXAoKTsKICAgIGltZ0RhdGEud2lkdGggPSBuZXdXaWR0aDsKICAgIGltZ0RhdGEuaGVpZ2h0ID0gbmV3SGVpZ2h0OwogICAgcmV0dXJuIGltZ0RhdGE7CiAgfQogIF9lbmNvZGVCTVAoKSB7CiAgICBjb25zdCB7CiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQsCiAgICAgIGtpbmQKICAgIH0gPSB0aGlzLl9pbWdEYXRhOwogICAgbGV0IGRhdGEgPSB0aGlzLl9pbWdEYXRhLmRhdGE7CiAgICBsZXQgYml0UGVyUGl4ZWw7CiAgICBsZXQgY29sb3JUYWJsZSA9IG5ldyBVaW50OEFycmF5KDApOwogICAgbGV0IG1hc2tUYWJsZSA9IGNvbG9yVGFibGU7CiAgICBsZXQgY29tcHJlc3Npb24gPSAwOwogICAgc3dpdGNoIChraW5kKSB7CiAgICAgIGNhc2UgSW1hZ2VLaW5kLkdSQVlTQ0FMRV8xQlBQOgogICAgICAgIHsKICAgICAgICAgIGJpdFBlclBpeGVsID0gMTsKICAgICAgICAgIGNvbG9yVGFibGUgPSBuZXcgVWludDhBcnJheSh0aGlzLl9pc01hc2sgPyBbMjU1LCAyNTUsIDI1NSwgMjU1LCAwLCAwLCAwLCAwXSA6IFswLCAwLCAwLCAwLCAyNTUsIDI1NSwgMjU1LCAyNTVdKTsKICAgICAgICAgIGNvbnN0IHJvd0xlbiA9IHdpZHRoICsgNyA+PiAzOwogICAgICAgICAgY29uc3Qgcm93U2l6ZSA9IHJvd0xlbiArIDMgJiAtNDsKICAgICAgICAgIGlmIChyb3dMZW4gIT09IHJvd1NpemUpIHsKICAgICAgICAgICAgY29uc3QgbmV3RGF0YSA9IG5ldyBVaW50OEFycmF5KHJvd1NpemUgKiBoZWlnaHQpOwogICAgICAgICAgICBsZXQgayA9IDA7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGhlaWdodCAqIHJvd0xlbjsgaSA8IGlpOyBpICs9IHJvd0xlbiwgayArPSByb3dTaXplKSB7CiAgICAgICAgICAgICAgbmV3RGF0YS5zZXQoZGF0YS5zdWJhcnJheShpLCBpICsgcm93TGVuKSwgayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YSA9IG5ld0RhdGE7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgSW1hZ2VLaW5kLlJHQl8yNEJQUDoKICAgICAgICB7CiAgICAgICAgICBiaXRQZXJQaXhlbCA9IDI0OwogICAgICAgICAgaWYgKHdpZHRoICYgMykgewogICAgICAgICAgICBjb25zdCByb3dMZW4gPSAzICogd2lkdGg7CiAgICAgICAgICAgIGNvbnN0IHJvd1NpemUgPSByb3dMZW4gKyAzICYgLTQ7CiAgICAgICAgICAgIGNvbnN0IGV4dHJhTGVuID0gcm93U2l6ZSAtIHJvd0xlbjsKICAgICAgICAgICAgY29uc3QgbmV3RGF0YSA9IG5ldyBVaW50OEFycmF5KHJvd1NpemUgKiBoZWlnaHQpOwogICAgICAgICAgICBsZXQgayA9IDA7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGhlaWdodCAqIHJvd0xlbjsgaSA8IGlpOyBpICs9IHJvd0xlbikgewogICAgICAgICAgICAgIGNvbnN0IHJvdyA9IGRhdGEuc3ViYXJyYXkoaSwgaSArIHJvd0xlbik7CiAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCByb3dMZW47IGogKz0gMykgewogICAgICAgICAgICAgICAgbmV3RGF0YVtrKytdID0gcm93W2ogKyAyXTsKICAgICAgICAgICAgICAgIG5ld0RhdGFbaysrXSA9IHJvd1tqICsgMV07CiAgICAgICAgICAgICAgICBuZXdEYXRhW2srK10gPSByb3dbal07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGsgKz0gZXh0cmFMZW47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YSA9IG5ld0RhdGE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBkYXRhLmxlbmd0aDsgaSA8IGlpOyBpICs9IDMpIHsKICAgICAgICAgICAgICBjb25zdCB0bXAgPSBkYXRhW2ldOwogICAgICAgICAgICAgIGRhdGFbaV0gPSBkYXRhW2kgKyAyXTsKICAgICAgICAgICAgICBkYXRhW2kgKyAyXSA9IHRtcDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlIEltYWdlS2luZC5SR0JBXzMyQlBQOgogICAgICAgIGJpdFBlclBpeGVsID0gMzI7CiAgICAgICAgY29tcHJlc3Npb24gPSAzOwogICAgICAgIG1hc2tUYWJsZSA9IG5ldyBVaW50OEFycmF5KDQgKyA0ICsgNCArIDQgKyA1Mik7CiAgICAgICAgY29uc3QgdmlldyA9IG5ldyBEYXRhVmlldyhtYXNrVGFibGUuYnVmZmVyKTsKICAgICAgICBpZiAoRmVhdHVyZVRlc3QuaXNMaXR0bGVFbmRpYW4pIHsKICAgICAgICAgIHZpZXcuc2V0VWludDMyKDAsIDB4MDAwMDAwZmYsIHRydWUpOwogICAgICAgICAgdmlldy5zZXRVaW50MzIoNCwgMHgwMDAwZmYwMCwgdHJ1ZSk7CiAgICAgICAgICB2aWV3LnNldFVpbnQzMig4LCAweDAwZmYwMDAwLCB0cnVlKTsKICAgICAgICAgIHZpZXcuc2V0VWludDMyKDEyLCAweGZmMDAwMDAwLCB0cnVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmlldy5zZXRVaW50MzIoMCwgMHhmZjAwMDAwMCwgdHJ1ZSk7CiAgICAgICAgICB2aWV3LnNldFVpbnQzMig0LCAweDAwZmYwMDAwLCB0cnVlKTsKICAgICAgICAgIHZpZXcuc2V0VWludDMyKDgsIDB4MDAwMGZmMDAsIHRydWUpOwogICAgICAgICAgdmlldy5zZXRVaW50MzIoMTIsIDB4MDAwMDAwZmYsIHRydWUpOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgZm9ybWF0Iik7CiAgICB9CiAgICBsZXQgaSA9IDA7CiAgICBjb25zdCBoZWFkZXJMZW5ndGggPSA0MCArIG1hc2tUYWJsZS5sZW5ndGg7CiAgICBjb25zdCBmaWxlTGVuZ3RoID0gMTQgKyBoZWFkZXJMZW5ndGggKyBjb2xvclRhYmxlLmxlbmd0aCArIGRhdGEubGVuZ3RoOwogICAgY29uc3QgYm1wRGF0YSA9IG5ldyBVaW50OEFycmF5KGZpbGVMZW5ndGgpOwogICAgY29uc3QgdmlldyA9IG5ldyBEYXRhVmlldyhibXBEYXRhLmJ1ZmZlcik7CiAgICB2aWV3LnNldFVpbnQxNihpLCAweDRkNDIsIHRydWUpOwogICAgaSArPSAyOwogICAgdmlldy5zZXRVaW50MzIoaSwgZmlsZUxlbmd0aCwgdHJ1ZSk7CiAgICBpICs9IDQ7CiAgICB2aWV3LnNldFVpbnQzMihpLCAwLCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIHZpZXcuc2V0VWludDMyKGksIDE0ICsgaGVhZGVyTGVuZ3RoICsgY29sb3JUYWJsZS5sZW5ndGgsIHRydWUpOwogICAgaSArPSA0OwogICAgdmlldy5zZXRVaW50MzIoaSwgaGVhZGVyTGVuZ3RoLCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIHZpZXcuc2V0SW50MzIoaSwgd2lkdGgsIHRydWUpOwogICAgaSArPSA0OwogICAgdmlldy5zZXRJbnQzMihpLCAtaGVpZ2h0LCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIHZpZXcuc2V0VWludDE2KGksIDEsIHRydWUpOwogICAgaSArPSAyOwogICAgdmlldy5zZXRVaW50MTYoaSwgYml0UGVyUGl4ZWwsIHRydWUpOwogICAgaSArPSAyOwogICAgdmlldy5zZXRVaW50MzIoaSwgY29tcHJlc3Npb24sIHRydWUpOwogICAgaSArPSA0OwogICAgdmlldy5zZXRVaW50MzIoaSwgMCwgdHJ1ZSk7CiAgICBpICs9IDQ7CiAgICB2aWV3LnNldEludDMyKGksIDAsIHRydWUpOwogICAgaSArPSA0OwogICAgdmlldy5zZXRJbnQzMihpLCAwLCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIHZpZXcuc2V0VWludDMyKGksIGNvbG9yVGFibGUubGVuZ3RoIC8gNCwgdHJ1ZSk7CiAgICBpICs9IDQ7CiAgICB2aWV3LnNldFVpbnQzMihpLCAwLCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIGJtcERhdGEuc2V0KG1hc2tUYWJsZSwgaSk7CiAgICBpICs9IG1hc2tUYWJsZS5sZW5ndGg7CiAgICBibXBEYXRhLnNldChjb2xvclRhYmxlLCBpKTsKICAgIGkgKz0gY29sb3JUYWJsZS5sZW5ndGg7CiAgICBibXBEYXRhLnNldChkYXRhLCBpKTsKICAgIHJldHVybiBibXBEYXRhOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvZGVjb2RlX3N0cmVhbS5qcwoKCmNvbnN0IGVtcHR5QnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMCk7CmNsYXNzIERlY29kZVN0cmVhbSBleHRlbmRzIEJhc2VTdHJlYW0gewogIGNvbnN0cnVjdG9yKG1heWJlTWluQnVmZmVyTGVuZ3RoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5fcmF3TWluQnVmZmVyTGVuZ3RoID0gbWF5YmVNaW5CdWZmZXJMZW5ndGggfHwgMDsKICAgIHRoaXMucG9zID0gMDsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gMDsKICAgIHRoaXMuZW9mID0gZmFsc2U7CiAgICB0aGlzLmJ1ZmZlciA9IGVtcHR5QnVmZmVyOwogICAgdGhpcy5taW5CdWZmZXJMZW5ndGggPSA1MTI7CiAgICBpZiAobWF5YmVNaW5CdWZmZXJMZW5ndGgpIHsKICAgICAgd2hpbGUgKHRoaXMubWluQnVmZmVyTGVuZ3RoIDwgbWF5YmVNaW5CdWZmZXJMZW5ndGgpIHsKICAgICAgICB0aGlzLm1pbkJ1ZmZlckxlbmd0aCAqPSAyOwogICAgICB9CiAgICB9CiAgfQogIGdldCBpc0VtcHR5KCkgewogICAgd2hpbGUgKCF0aGlzLmVvZiAmJiB0aGlzLmJ1ZmZlckxlbmd0aCA9PT0gMCkgewogICAgICB0aGlzLnJlYWRCbG9jaygpOwogICAgfQogICAgcmV0dXJuIHRoaXMuYnVmZmVyTGVuZ3RoID09PSAwOwogIH0KICBlbnN1cmVCdWZmZXIocmVxdWVzdGVkKSB7CiAgICBjb25zdCBidWZmZXIgPSB0aGlzLmJ1ZmZlcjsKICAgIGlmIChyZXF1ZXN0ZWQgPD0gYnVmZmVyLmJ5dGVMZW5ndGgpIHsKICAgICAgcmV0dXJuIGJ1ZmZlcjsKICAgIH0KICAgIGxldCBzaXplID0gdGhpcy5taW5CdWZmZXJMZW5ndGg7CiAgICB3aGlsZSAoc2l6ZSA8IHJlcXVlc3RlZCkgewogICAgICBzaXplICo9IDI7CiAgICB9CiAgICBjb25zdCBidWZmZXIyID0gbmV3IFVpbnQ4QXJyYXkoc2l6ZSk7CiAgICBidWZmZXIyLnNldChidWZmZXIpOwogICAgcmV0dXJuIHRoaXMuYnVmZmVyID0gYnVmZmVyMjsKICB9CiAgZ2V0Qnl0ZSgpIHsKICAgIGNvbnN0IHBvcyA9IHRoaXMucG9zOwogICAgd2hpbGUgKHRoaXMuYnVmZmVyTGVuZ3RoIDw9IHBvcykgewogICAgICBpZiAodGhpcy5lb2YpIHsKICAgICAgICByZXR1cm4gLTE7CiAgICAgIH0KICAgICAgdGhpcy5yZWFkQmxvY2soKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmJ1ZmZlclt0aGlzLnBvcysrXTsKICB9CiAgZ2V0Qnl0ZXMobGVuZ3RoLCBkZWNvZGVyT3B0aW9ucyA9IG51bGwpIHsKICAgIGNvbnN0IHBvcyA9IHRoaXMucG9zOwogICAgbGV0IGVuZDsKICAgIGlmIChsZW5ndGgpIHsKICAgICAgdGhpcy5lbnN1cmVCdWZmZXIocG9zICsgbGVuZ3RoKTsKICAgICAgZW5kID0gcG9zICsgbGVuZ3RoOwogICAgICB3aGlsZSAoIXRoaXMuZW9mICYmIHRoaXMuYnVmZmVyTGVuZ3RoIDwgZW5kKSB7CiAgICAgICAgdGhpcy5yZWFkQmxvY2soZGVjb2Rlck9wdGlvbnMpOwogICAgICB9CiAgICAgIGNvbnN0IGJ1ZkVuZCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgICBpZiAoZW5kID4gYnVmRW5kKSB7CiAgICAgICAgZW5kID0gYnVmRW5kOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB3aGlsZSAoIXRoaXMuZW9mKSB7CiAgICAgICAgdGhpcy5yZWFkQmxvY2soZGVjb2Rlck9wdGlvbnMpOwogICAgICB9CiAgICAgIGVuZCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgfQogICAgdGhpcy5wb3MgPSBlbmQ7CiAgICByZXR1cm4gdGhpcy5idWZmZXIuc3ViYXJyYXkocG9zLCBlbmQpOwogIH0KICBhc3luYyBnZXRJbWFnZURhdGEobGVuZ3RoLCBkZWNvZGVyT3B0aW9ucykgewogICAgaWYgKCF0aGlzLmNhbkFzeW5jRGVjb2RlSW1hZ2VGcm9tQnVmZmVyKSB7CiAgICAgIGlmICh0aGlzLmlzQXN5bmNEZWNvZGVyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZGVjb2RlSW1hZ2UobnVsbCwgZGVjb2Rlck9wdGlvbnMpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmdldEJ5dGVzKGxlbmd0aCwgZGVjb2Rlck9wdGlvbnMpOwogICAgfQogICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuc3RyZWFtLmFzeW5jR2V0Qnl0ZXMoKTsKICAgIHJldHVybiB0aGlzLmRlY29kZUltYWdlKGRhdGEsIGRlY29kZXJPcHRpb25zKTsKICB9CiAgcmVzZXQoKSB7CiAgICB0aGlzLnBvcyA9IDA7CiAgfQogIG1ha2VTdWJTdHJlYW0oc3RhcnQsIGxlbmd0aCwgZGljdCA9IG51bGwpIHsKICAgIGlmIChsZW5ndGggPT09IHVuZGVmaW5lZCkgewogICAgICB3aGlsZSAoIXRoaXMuZW9mKSB7CiAgICAgICAgdGhpcy5yZWFkQmxvY2soKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY29uc3QgZW5kID0gc3RhcnQgKyBsZW5ndGg7CiAgICAgIHdoaWxlICh0aGlzLmJ1ZmZlckxlbmd0aCA8PSBlbmQgJiYgIXRoaXMuZW9mKSB7CiAgICAgICAgdGhpcy5yZWFkQmxvY2soKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG5ldyBTdHJlYW0odGhpcy5idWZmZXIsIHN0YXJ0LCBsZW5ndGgsIGRpY3QpOwogIH0KICBnZXRCYXNlU3RyZWFtcygpIHsKICAgIHJldHVybiB0aGlzLnN0ciA/IHRoaXMuc3RyLmdldEJhc2VTdHJlYW1zKCkgOiBudWxsOwogIH0KfQpjbGFzcyBTdHJlYW1zU2VxdWVuY2VTdHJlYW0gZXh0ZW5kcyBEZWNvZGVTdHJlYW0gewogIGNvbnN0cnVjdG9yKHN0cmVhbXMsIG9uRXJyb3IgPSBudWxsKSB7CiAgICBzdHJlYW1zID0gc3RyZWFtcy5maWx0ZXIocyA9PiBzIGluc3RhbmNlb2YgQmFzZVN0cmVhbSk7CiAgICBsZXQgbWF5YmVMZW5ndGggPSAwOwogICAgZm9yIChjb25zdCBzdHJlYW0gb2Ygc3RyZWFtcykgewogICAgICBtYXliZUxlbmd0aCArPSBzdHJlYW0gaW5zdGFuY2VvZiBEZWNvZGVTdHJlYW0gPyBzdHJlYW0uX3Jhd01pbkJ1ZmZlckxlbmd0aCA6IHN0cmVhbS5sZW5ndGg7CiAgICB9CiAgICBzdXBlcihtYXliZUxlbmd0aCk7CiAgICB0aGlzLnN0cmVhbXMgPSBzdHJlYW1zOwogICAgdGhpcy5fb25FcnJvciA9IG9uRXJyb3I7CiAgfQogIHJlYWRCbG9jaygpIHsKICAgIGNvbnN0IHN0cmVhbXMgPSB0aGlzLnN0cmVhbXM7CiAgICBpZiAoc3RyZWFtcy5sZW5ndGggPT09IDApIHsKICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBzdHJlYW0gPSBzdHJlYW1zLnNoaWZ0KCk7CiAgICBsZXQgY2h1bms7CiAgICB0cnkgewogICAgICBjaHVuayA9IHN0cmVhbS5nZXRCeXRlcygpOwogICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgIGlmICh0aGlzLl9vbkVycm9yKSB7CiAgICAgICAgdGhpcy5fb25FcnJvcihyZWFzb24sIHN0cmVhbS5kaWN0Py5vYmpJZCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRocm93IHJlYXNvbjsKICAgIH0KICAgIGNvbnN0IGJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgY29uc3QgbmV3TGVuZ3RoID0gYnVmZmVyTGVuZ3RoICsgY2h1bmsubGVuZ3RoOwogICAgY29uc3QgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIobmV3TGVuZ3RoKTsKICAgIGJ1ZmZlci5zZXQoY2h1bmssIGJ1ZmZlckxlbmd0aCk7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IG5ld0xlbmd0aDsKICB9CiAgZ2V0QmFzZVN0cmVhbXMoKSB7CiAgICBjb25zdCBiYXNlU3RyZWFtc0J1ZiA9IFtdOwogICAgZm9yIChjb25zdCBzdHJlYW0gb2YgdGhpcy5zdHJlYW1zKSB7CiAgICAgIGNvbnN0IGJhc2VTdHJlYW1zID0gc3RyZWFtLmdldEJhc2VTdHJlYW1zKCk7CiAgICAgIGlmIChiYXNlU3RyZWFtcykgewogICAgICAgIGJhc2VTdHJlYW1zQnVmLnB1c2goLi4uYmFzZVN0cmVhbXMpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gYmFzZVN0cmVhbXNCdWYubGVuZ3RoID4gMCA/IGJhc2VTdHJlYW1zQnVmIDogbnVsbDsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2NvbG9yc3BhY2VfdXRpbHMuanMKCgoKCgpjbGFzcyBDb2xvclNwYWNlVXRpbHMgewogIHN0YXRpYyBwYXJzZSh7CiAgICBjcywKICAgIHhyZWYsCiAgICByZXNvdXJjZXMgPSBudWxsLAogICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUsCiAgICBhc3luY0lmTm90Q2FjaGVkID0gZmFsc2UKICB9KSB7CiAgICBjb25zdCBvcHRpb25zID0gewogICAgICB4cmVmLAogICAgICByZXNvdXJjZXMsCiAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgfTsKICAgIGxldCBjc05hbWUsIGNzUmVmLCBwYXJzZWRDUzsKICAgIGlmIChjcyBpbnN0YW5jZW9mIFJlZikgewogICAgICBjc1JlZiA9IGNzOwogICAgICBjb25zdCBjYWNoZWRDUyA9IGdsb2JhbENvbG9yU3BhY2VDYWNoZS5nZXRCeVJlZihjc1JlZikgfHwgbG9jYWxDb2xvclNwYWNlQ2FjaGUuZ2V0QnlSZWYoY3NSZWYpOwogICAgICBpZiAoY2FjaGVkQ1MpIHsKICAgICAgICByZXR1cm4gY2FjaGVkQ1M7CiAgICAgIH0KICAgICAgY3MgPSB4cmVmLmZldGNoKGNzKTsKICAgIH0KICAgIGlmIChjcyBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgY3NOYW1lID0gY3MubmFtZTsKICAgICAgY29uc3QgY2FjaGVkQ1MgPSBsb2NhbENvbG9yU3BhY2VDYWNoZS5nZXRCeU5hbWUoY3NOYW1lKTsKICAgICAgaWYgKGNhY2hlZENTKSB7CiAgICAgICAgcmV0dXJuIGNhY2hlZENTOwogICAgICB9CiAgICB9CiAgICB0cnkgewogICAgICBwYXJzZWRDUyA9IHRoaXMuI3BhcnNlKGNzLCBvcHRpb25zKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChhc3luY0lmTm90Q2FjaGVkICYmICEoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikpIHsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXgpOwogICAgICB9CiAgICAgIHRocm93IGV4OwogICAgfQogICAgaWYgKGNzTmFtZSB8fCBjc1JlZikgewogICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZS5zZXQoY3NOYW1lLCBjc1JlZiwgcGFyc2VkQ1MpOwogICAgICBpZiAoY3NSZWYpIHsKICAgICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUuc2V0KG51bGwsIGNzUmVmLCBwYXJzZWRDUyk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhc3luY0lmTm90Q2FjaGVkID8gUHJvbWlzZS5yZXNvbHZlKHBhcnNlZENTKSA6IHBhcnNlZENTOwogIH0KICBzdGF0aWMgI3N1YlBhcnNlKGNzLCBvcHRpb25zKSB7CiAgICBjb25zdCB7CiAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZQogICAgfSA9IG9wdGlvbnM7CiAgICBsZXQgY3NSZWY7CiAgICBpZiAoY3MgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgY3NSZWYgPSBjczsKICAgICAgY29uc3QgY2FjaGVkQ1MgPSBnbG9iYWxDb2xvclNwYWNlQ2FjaGUuZ2V0QnlSZWYoY3NSZWYpOwogICAgICBpZiAoY2FjaGVkQ1MpIHsKICAgICAgICByZXR1cm4gY2FjaGVkQ1M7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHBhcnNlZENTID0gdGhpcy4jcGFyc2UoY3MsIG9wdGlvbnMpOwogICAgaWYgKGNzUmVmKSB7CiAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZS5zZXQobnVsbCwgY3NSZWYsIHBhcnNlZENTKTsKICAgIH0KICAgIHJldHVybiBwYXJzZWRDUzsKICB9CiAgc3RhdGljICNwYXJzZShjcywgb3B0aW9ucykgewogICAgY29uc3QgewogICAgICB4cmVmLAogICAgICByZXNvdXJjZXMsCiAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlCiAgICB9ID0gb3B0aW9uczsKICAgIGNzID0geHJlZi5mZXRjaElmUmVmKGNzKTsKICAgIGlmIChjcyBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgc3dpdGNoIChjcy5uYW1lKSB7CiAgICAgICAgY2FzZSAiRyI6CiAgICAgICAgY2FzZSAiRGV2aWNlR3JheSI6CiAgICAgICAgICByZXR1cm4gdGhpcy5ncmF5OwogICAgICAgIGNhc2UgIlJHQiI6CiAgICAgICAgY2FzZSAiRGV2aWNlUkdCIjoKICAgICAgICAgIHJldHVybiB0aGlzLnJnYjsKICAgICAgICBjYXNlICJEZXZpY2VSR0JBIjoKICAgICAgICAgIHJldHVybiB0aGlzLnJnYmE7CiAgICAgICAgY2FzZSAiQ01ZSyI6CiAgICAgICAgY2FzZSAiRGV2aWNlQ01ZSyI6CiAgICAgICAgICByZXR1cm4gdGhpcy5jbXlrOwogICAgICAgIGNhc2UgIlBhdHRlcm4iOgogICAgICAgICAgcmV0dXJuIG5ldyBQYXR0ZXJuQ1MobnVsbCk7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmIChyZXNvdXJjZXMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICAgIGNvbnN0IGNvbG9yU3BhY2VzID0gcmVzb3VyY2VzLmdldCgiQ29sb3JTcGFjZSIpOwogICAgICAgICAgICBpZiAoY29sb3JTcGFjZXMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICAgICAgY29uc3QgcmVzb3VyY2VzQ1MgPSBjb2xvclNwYWNlcy5nZXQoY3MubmFtZSk7CiAgICAgICAgICAgICAgaWYgKHJlc291cmNlc0NTKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2VzQ1MgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiNwYXJzZShyZXNvdXJjZXNDUywgb3B0aW9ucyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjcyA9IHJlc291cmNlc0NTOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB3YXJuKGBVbnJlY29nbml6ZWQgQ29sb3JTcGFjZTogJHtjcy5uYW1lfWApOwogICAgICAgICAgcmV0dXJuIHRoaXMuZ3JheTsKICAgICAgfQogICAgfQogICAgaWYgKEFycmF5LmlzQXJyYXkoY3MpKSB7CiAgICAgIGNvbnN0IG1vZGUgPSB4cmVmLmZldGNoSWZSZWYoY3NbMF0pLm5hbWU7CiAgICAgIGxldCBwYXJhbXMsIG51bUNvbXBzLCBiYXNlQ1MsIHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIGdhbW1hOwogICAgICBzd2l0Y2ggKG1vZGUpIHsKICAgICAgICBjYXNlICJHIjoKICAgICAgICBjYXNlICJEZXZpY2VHcmF5IjoKICAgICAgICAgIHJldHVybiB0aGlzLmdyYXk7CiAgICAgICAgY2FzZSAiUkdCIjoKICAgICAgICBjYXNlICJEZXZpY2VSR0IiOgogICAgICAgICAgcmV0dXJuIHRoaXMucmdiOwogICAgICAgIGNhc2UgIkNNWUsiOgogICAgICAgIGNhc2UgIkRldmljZUNNWUsiOgogICAgICAgICAgcmV0dXJuIHRoaXMuY215azsKICAgICAgICBjYXNlICJDYWxHcmF5IjoKICAgICAgICAgIHBhcmFtcyA9IHhyZWYuZmV0Y2hJZlJlZihjc1sxXSk7CiAgICAgICAgICB3aGl0ZVBvaW50ID0gcGFyYW1zLmdldEFycmF5KCJXaGl0ZVBvaW50Iik7CiAgICAgICAgICBibGFja1BvaW50ID0gcGFyYW1zLmdldEFycmF5KCJCbGFja1BvaW50Iik7CiAgICAgICAgICBnYW1tYSA9IHBhcmFtcy5nZXQoIkdhbW1hIik7CiAgICAgICAgICByZXR1cm4gbmV3IENhbEdyYXlDUyh3aGl0ZVBvaW50LCBibGFja1BvaW50LCBnYW1tYSk7CiAgICAgICAgY2FzZSAiQ2FsUkdCIjoKICAgICAgICAgIHBhcmFtcyA9IHhyZWYuZmV0Y2hJZlJlZihjc1sxXSk7CiAgICAgICAgICB3aGl0ZVBvaW50ID0gcGFyYW1zLmdldEFycmF5KCJXaGl0ZVBvaW50Iik7CiAgICAgICAgICBibGFja1BvaW50ID0gcGFyYW1zLmdldEFycmF5KCJCbGFja1BvaW50Iik7CiAgICAgICAgICBnYW1tYSA9IHBhcmFtcy5nZXRBcnJheSgiR2FtbWEiKTsKICAgICAgICAgIGNvbnN0IG1hdHJpeCA9IHBhcmFtcy5nZXRBcnJheSgiTWF0cml4Iik7CiAgICAgICAgICByZXR1cm4gbmV3IENhbFJHQkNTKHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIGdhbW1hLCBtYXRyaXgpOwogICAgICAgIGNhc2UgIklDQ0Jhc2VkIjoKICAgICAgICAgIGNvbnN0IGlzUmVmID0gY3NbMV0gaW5zdGFuY2VvZiBSZWY7CiAgICAgICAgICBpZiAoaXNSZWYpIHsKICAgICAgICAgICAgY29uc3QgY2FjaGVkQ1MgPSBnbG9iYWxDb2xvclNwYWNlQ2FjaGUuZ2V0QnlSZWYoY3NbMV0pOwogICAgICAgICAgICBpZiAoY2FjaGVkQ1MpIHsKICAgICAgICAgICAgICByZXR1cm4gY2FjaGVkQ1M7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHN0cmVhbSA9IHhyZWYuZmV0Y2hJZlJlZihjc1sxXSk7CiAgICAgICAgICBjb25zdCBkaWN0ID0gc3RyZWFtLmRpY3Q7CiAgICAgICAgICBudW1Db21wcyA9IGRpY3QuZ2V0KCJOIik7CiAgICAgICAgICBpZiAoSWNjQ29sb3JTcGFjZS5pc1VzYWJsZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGNvbnN0IGljY0NTID0gbmV3IEljY0NvbG9yU3BhY2Uoc3RyZWFtLmdldEJ5dGVzKCksICJJQ0NCYXNlZCIsIG51bUNvbXBzKTsKICAgICAgICAgICAgICBpZiAoaXNSZWYpIHsKICAgICAgICAgICAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZS5zZXQobnVsbCwgY3NbMV0sIGljY0NTKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGljY0NTOwogICAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBleDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgd2FybihgSUNDQmFzZWQgY29sb3Igc3BhY2UgKCR7Y3NbMV19KTogIiR7ZXh9Ii5gKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgY29uc3QgYWx0UmF3ID0gZGljdC5nZXRSYXcoIkFsdGVybmF0ZSIpOwogICAgICAgICAgaWYgKGFsdFJhdykgewogICAgICAgICAgICBjb25zdCBhbHRDUyA9IHRoaXMuI3N1YlBhcnNlKGFsdFJhdywgb3B0aW9ucyk7CiAgICAgICAgICAgIGlmIChhbHRDUy5udW1Db21wcyA9PT0gbnVtQ29tcHMpIHsKICAgICAgICAgICAgICByZXR1cm4gYWx0Q1M7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd2FybigiSUNDQmFzZWQgY29sb3Igc3BhY2U6IElnbm9yaW5nIGluY29ycmVjdCAvQWx0ZXJuYXRlIGVudHJ5LiIpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG51bUNvbXBzID09PSAxKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdyYXk7CiAgICAgICAgICB9IGVsc2UgaWYgKG51bUNvbXBzID09PSAzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnJnYjsKICAgICAgICAgIH0gZWxzZSBpZiAobnVtQ29tcHMgPT09IDQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY215azsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlBhdHRlcm4iOgogICAgICAgICAgYmFzZUNTID0gY3NbMV0gfHwgbnVsbDsKICAgICAgICAgIGlmIChiYXNlQ1MpIHsKICAgICAgICAgICAgYmFzZUNTID0gdGhpcy4jc3ViUGFyc2UoYmFzZUNTLCBvcHRpb25zKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuZXcgUGF0dGVybkNTKGJhc2VDUyk7CiAgICAgICAgY2FzZSAiSSI6CiAgICAgICAgY2FzZSAiSW5kZXhlZCI6CiAgICAgICAgICBiYXNlQ1MgPSB0aGlzLiNzdWJQYXJzZShjc1sxXSwgb3B0aW9ucyk7CiAgICAgICAgICBjb25zdCBoaVZhbCA9IE1hdGhDbGFtcCh4cmVmLmZldGNoSWZSZWYoY3NbMl0pLCAwLCAyNTUpOwogICAgICAgICAgY29uc3QgbG9va3VwID0geHJlZi5mZXRjaElmUmVmKGNzWzNdKTsKICAgICAgICAgIHJldHVybiBuZXcgSW5kZXhlZENTKGJhc2VDUywgaGlWYWwsIGxvb2t1cCk7CiAgICAgICAgY2FzZSAiU2VwYXJhdGlvbiI6CiAgICAgICAgY2FzZSAiRGV2aWNlTiI6CiAgICAgICAgICBjb25zdCBuYW1lID0geHJlZi5mZXRjaElmUmVmKGNzWzFdKTsKICAgICAgICAgIG51bUNvbXBzID0gQXJyYXkuaXNBcnJheShuYW1lKSA/IG5hbWUubGVuZ3RoIDogMTsKICAgICAgICAgIGJhc2VDUyA9IHRoaXMuI3N1YlBhcnNlKGNzWzJdLCBvcHRpb25zKTsKICAgICAgICAgIGNvbnN0IHRpbnRGbiA9IHBkZkZ1bmN0aW9uRmFjdG9yeS5jcmVhdGUoY3NbM10pOwogICAgICAgICAgcmV0dXJuIG5ldyBBbHRlcm5hdGVDUyhudW1Db21wcywgYmFzZUNTLCB0aW50Rm4pOwogICAgICAgIGNhc2UgIkxhYiI6CiAgICAgICAgICBwYXJhbXMgPSB4cmVmLmZldGNoSWZSZWYoY3NbMV0pOwogICAgICAgICAgd2hpdGVQb2ludCA9IHBhcmFtcy5nZXRBcnJheSgiV2hpdGVQb2ludCIpOwogICAgICAgICAgYmxhY2tQb2ludCA9IHBhcmFtcy5nZXRBcnJheSgiQmxhY2tQb2ludCIpOwogICAgICAgICAgY29uc3QgcmFuZ2UgPSBwYXJhbXMuZ2V0QXJyYXkoIlJhbmdlIik7CiAgICAgICAgICByZXR1cm4gbmV3IExhYkNTKHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIHJhbmdlKTsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgd2FybihgVW5pbXBsZW1lbnRlZCBDb2xvclNwYWNlIG9iamVjdDogJHttb2RlfWApOwogICAgICAgICAgcmV0dXJuIHRoaXMuZ3JheTsKICAgICAgfQogICAgfQogICAgd2FybihgVW5yZWNvZ25pemVkIENvbG9yU3BhY2Ugb2JqZWN0OiAke2NzfWApOwogICAgcmV0dXJuIHRoaXMuZ3JheTsKICB9CiAgc3RhdGljIGdldCBncmF5KCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZ3JheSIsIG5ldyBEZXZpY2VHcmF5Q1MoKSk7CiAgfQogIHN0YXRpYyBnZXQgcmdiKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAicmdiIiwgbmV3IERldmljZVJnYkNTKCkpOwogIH0KICBzdGF0aWMgZ2V0IHJnYmEoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJyZ2JhIiwgbmV3IERldmljZVJnYmFDUygpKTsKICB9CiAgc3RhdGljIGdldCBjbXlrKCkgewogICAgaWYgKENteWtJQ0NCYXNlZENTLmlzVXNhYmxlKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiY215ayIsIG5ldyBDbXlrSUNDQmFzZWRDUygpKTsKICAgICAgfSBjYXRjaCB7CiAgICAgICAgd2FybigiQ01ZSyBmYWxsYmFjazogRGV2aWNlQ01ZSyIpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJjbXlrIiwgbmV3IERldmljZUNteWtDUygpKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2pwZy5qcwoKCgoKCmNsYXNzIEpwZWdFcnJvciBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiSnBlZ0Vycm9yIik7CiAgfQp9CmNsYXNzIEROTE1hcmtlckVycm9yIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobWVzc2FnZSwgc2NhbkxpbmVzKSB7CiAgICBzdXBlcihtZXNzYWdlLCAiRE5MTWFya2VyRXJyb3IiKTsKICAgIHRoaXMuc2NhbkxpbmVzID0gc2NhbkxpbmVzOwogIH0KfQpjbGFzcyBFT0lNYXJrZXJFcnJvciBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiRU9JTWFya2VyRXJyb3IiKTsKICB9Cn0KY29uc3QgZGN0WmlnWmFnID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDEsIDgsIDE2LCA5LCAyLCAzLCAxMCwgMTcsIDI0LCAzMiwgMjUsIDE4LCAxMSwgNCwgNSwgMTIsIDE5LCAyNiwgMzMsIDQwLCA0OCwgNDEsIDM0LCAyNywgMjAsIDEzLCA2LCA3LCAxNCwgMjEsIDI4LCAzNSwgNDIsIDQ5LCA1NiwgNTcsIDUwLCA0MywgMzYsIDI5LCAyMiwgMTUsIDIzLCAzMCwgMzcsIDQ0LCA1MSwgNTgsIDU5LCA1MiwgNDUsIDM4LCAzMSwgMzksIDQ2LCA1MywgNjAsIDYxLCA1NCwgNDcsIDU1LCA2MiwgNjNdKTsKY29uc3QgZGN0Q29zMSA9IDQwMTc7CmNvbnN0IGRjdFNpbjEgPSA3OTk7CmNvbnN0IGRjdENvczMgPSAzNDA2Owpjb25zdCBkY3RTaW4zID0gMjI3NjsKY29uc3QgZGN0Q29zNiA9IDE1Njc7CmNvbnN0IGRjdFNpbjYgPSAzNzg0Owpjb25zdCBkY3RTcXJ0MiA9IDU3OTM7CmNvbnN0IGRjdFNxcnQxZDIgPSAyODk2OwpmdW5jdGlvbiBidWlsZEh1ZmZtYW5UYWJsZShjb2RlTGVuZ3RocywgdmFsdWVzKSB7CiAgbGV0IGsgPSAwLAogICAgaSwKICAgIGosCiAgICBsZW5ndGggPSAxNjsKICB3aGlsZSAobGVuZ3RoID4gMCAmJiAhY29kZUxlbmd0aHNbbGVuZ3RoIC0gMV0pIHsKICAgIGxlbmd0aC0tOwogIH0KICBjb25zdCBjb2RlID0gW3sKICAgIGNoaWxkcmVuOiBbXSwKICAgIGluZGV4OiAwCiAgfV07CiAgbGV0IHAgPSBjb2RlWzBdLAogICAgcTsKICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgIGZvciAoaiA9IDA7IGogPCBjb2RlTGVuZ3Roc1tpXTsgaisrKSB7CiAgICAgIHAgPSBjb2RlLnBvcCgpOwogICAgICBwLmNoaWxkcmVuW3AuaW5kZXhdID0gdmFsdWVzW2tdOwogICAgICB3aGlsZSAocC5pbmRleCA+IDApIHsKICAgICAgICBwID0gY29kZS5wb3AoKTsKICAgICAgfQogICAgICBwLmluZGV4Kys7CiAgICAgIGNvZGUucHVzaChwKTsKICAgICAgd2hpbGUgKGNvZGUubGVuZ3RoIDw9IGkpIHsKICAgICAgICBjb2RlLnB1c2gocSA9IHsKICAgICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICAgIGluZGV4OiAwCiAgICAgICAgfSk7CiAgICAgICAgcC5jaGlsZHJlbltwLmluZGV4XSA9IHEuY2hpbGRyZW47CiAgICAgICAgcCA9IHE7CiAgICAgIH0KICAgICAgaysrOwogICAgfQogICAgaWYgKGkgKyAxIDwgbGVuZ3RoKSB7CiAgICAgIGNvZGUucHVzaChxID0gewogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBpbmRleDogMAogICAgICB9KTsKICAgICAgcC5jaGlsZHJlbltwLmluZGV4XSA9IHEuY2hpbGRyZW47CiAgICAgIHAgPSBxOwogICAgfQogIH0KICByZXR1cm4gY29kZVswXS5jaGlsZHJlbjsKfQpmdW5jdGlvbiBnZXRCbG9ja0J1ZmZlck9mZnNldChjb21wb25lbnQsIHJvdywgY29sKSB7CiAgcmV0dXJuIDY0ICogKChjb21wb25lbnQuYmxvY2tzUGVyTGluZSArIDEpICogcm93ICsgY29sKTsKfQpmdW5jdGlvbiBkZWNvZGVTY2FuKGRhdGEsIG9mZnNldCwgZnJhbWUsIGNvbXBvbmVudHMsIHJlc2V0SW50ZXJ2YWwsIHNwZWN0cmFsU3RhcnQsIHNwZWN0cmFsRW5kLCBzdWNjZXNzaXZlUHJldiwgc3VjY2Vzc2l2ZSwgcGFyc2VETkxNYXJrZXIgPSBmYWxzZSkgewogIGNvbnN0IG1jdXNQZXJMaW5lID0gZnJhbWUubWN1c1BlckxpbmU7CiAgY29uc3QgcHJvZ3Jlc3NpdmUgPSBmcmFtZS5wcm9ncmVzc2l2ZTsKICBjb25zdCBzdGFydE9mZnNldCA9IG9mZnNldDsKICBsZXQgYml0c0RhdGEgPSAwLAogICAgYml0c0NvdW50ID0gMDsKICBmdW5jdGlvbiByZWFkQml0KCkgewogICAgaWYgKGJpdHNDb3VudCA+IDApIHsKICAgICAgYml0c0NvdW50LS07CiAgICAgIHJldHVybiBiaXRzRGF0YSA+PiBiaXRzQ291bnQgJiAxOwogICAgfQogICAgYml0c0RhdGEgPSBkYXRhW29mZnNldCsrXTsKICAgIGlmIChiaXRzRGF0YSA9PT0gMHhmZikgewogICAgICBjb25zdCBuZXh0Qnl0ZSA9IGRhdGFbb2Zmc2V0KytdOwogICAgICBpZiAobmV4dEJ5dGUpIHsKICAgICAgICBpZiAobmV4dEJ5dGUgPT09IDB4ZGMgJiYgcGFyc2VETkxNYXJrZXIpIHsKICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgY29uc3Qgc2NhbkxpbmVzID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBpZiAoc2NhbkxpbmVzID4gMCAmJiBzY2FuTGluZXMgIT09IGZyYW1lLnNjYW5MaW5lcykgewogICAgICAgICAgICB0aHJvdyBuZXcgRE5MTWFya2VyRXJyb3IoIkZvdW5kIEROTCBtYXJrZXIgKDB4RkZEQykgd2hpbGUgcGFyc2luZyBzY2FuIGRhdGEiLCBzY2FuTGluZXMpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAobmV4dEJ5dGUgPT09IDB4ZDkpIHsKICAgICAgICAgIGlmIChwYXJzZUROTE1hcmtlcikgewogICAgICAgICAgICBjb25zdCBtYXliZVNjYW5MaW5lcyA9IGJsb2NrUm93ICogKGZyYW1lLnByZWNpc2lvbiA9PT0gOCA/IDggOiAwKTsKICAgICAgICAgICAgaWYgKG1heWJlU2NhbkxpbmVzID4gMCAmJiBNYXRoLnJvdW5kKGZyYW1lLnNjYW5MaW5lcyAvIG1heWJlU2NhbkxpbmVzKSA+PSA1KSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEROTE1hcmtlckVycm9yKCJGb3VuZCBFT0kgbWFya2VyICgweEZGRDkpIHdoaWxlIHBhcnNpbmcgc2NhbiBkYXRhLCAiICsgInBvc3NpYmx5IGNhdXNlZCBieSBpbmNvcnJlY3QgYHNjYW5MaW5lc2AgcGFyYW1ldGVyIiwgbWF5YmVTY2FuTGluZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgRU9JTWFya2VyRXJyb3IoIkZvdW5kIEVPSSBtYXJrZXIgKDB4RkZEOSkgd2hpbGUgcGFyc2luZyBzY2FuIGRhdGEiKTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcihgdW5leHBlY3RlZCBtYXJrZXIgJHsoYml0c0RhdGEgPDwgOCB8IG5leHRCeXRlKS50b1N0cmluZygxNil9YCk7CiAgICAgIH0KICAgIH0KICAgIGJpdHNDb3VudCA9IDc7CiAgICByZXR1cm4gYml0c0RhdGEgPj4+IDc7CiAgfQogIGZ1bmN0aW9uIGRlY29kZUh1ZmZtYW4odHJlZSkgewogICAgbGV0IG5vZGUgPSB0cmVlOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgbm9kZSA9IG5vZGVbcmVhZEJpdCgpXTsKICAgICAgc3dpdGNoICh0eXBlb2Ygbm9kZSkgewogICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICBjYXNlICJvYmplY3QiOgogICAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiaW52YWxpZCBodWZmbWFuIHNlcXVlbmNlIik7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHJlY2VpdmUobGVuZ3RoKSB7CiAgICBsZXQgbiA9IDA7CiAgICB3aGlsZSAobGVuZ3RoID4gMCkgewogICAgICBuID0gbiA8PCAxIHwgcmVhZEJpdCgpOwogICAgICBsZW5ndGgtLTsKICAgIH0KICAgIHJldHVybiBuOwogIH0KICBmdW5jdGlvbiByZWNlaXZlQW5kRXh0ZW5kKGxlbmd0aCkgewogICAgaWYgKGxlbmd0aCA9PT0gMSkgewogICAgICByZXR1cm4gcmVhZEJpdCgpID09PSAxID8gMSA6IC0xOwogICAgfQogICAgY29uc3QgbiA9IHJlY2VpdmUobGVuZ3RoKTsKICAgIGlmIChuID49IDEgPDwgbGVuZ3RoIC0gMSkgewogICAgICByZXR1cm4gbjsKICAgIH0KICAgIHJldHVybiBuICsgKC0xIDw8IGxlbmd0aCkgKyAxOwogIH0KICBmdW5jdGlvbiBkZWNvZGVCYXNlbGluZShjb21wb25lbnQsIGJsb2NrT2Zmc2V0KSB7CiAgICBjb25zdCB0ID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlREMpOwogICAgY29uc3QgZGlmZiA9IHQgPT09IDAgPyAwIDogcmVjZWl2ZUFuZEV4dGVuZCh0KTsKICAgIGNvbXBvbmVudC5ibG9ja0RhdGFbYmxvY2tPZmZzZXRdID0gY29tcG9uZW50LnByZWQgKz0gZGlmZjsKICAgIGxldCBrID0gMTsKICAgIHdoaWxlIChrIDwgNjQpIHsKICAgICAgY29uc3QgcnMgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVBQyk7CiAgICAgIGNvbnN0IHMgPSBycyAmIDE1LAogICAgICAgIHIgPSBycyA+PiA0OwogICAgICBpZiAocyA9PT0gMCkgewogICAgICAgIGlmIChyIDwgMTUpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBrICs9IDE2OwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGsgKz0gcjsKICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1trXTsKICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtibG9ja09mZnNldCArIHpdID0gcmVjZWl2ZUFuZEV4dGVuZChzKTsKICAgICAgaysrOwogICAgfQogIH0KICBmdW5jdGlvbiBkZWNvZGVEQ0ZpcnN0KGNvbXBvbmVudCwgYmxvY2tPZmZzZXQpIHsKICAgIGNvbnN0IHQgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVEQyk7CiAgICBjb25zdCBkaWZmID0gdCA9PT0gMCA/IDAgOiByZWNlaXZlQW5kRXh0ZW5kKHQpIDw8IHN1Y2Nlc3NpdmU7CiAgICBjb21wb25lbnQuYmxvY2tEYXRhW2Jsb2NrT2Zmc2V0XSA9IGNvbXBvbmVudC5wcmVkICs9IGRpZmY7CiAgfQogIGZ1bmN0aW9uIGRlY29kZURDU3VjY2Vzc2l2ZShjb21wb25lbnQsIGJsb2NrT2Zmc2V0KSB7CiAgICBjb21wb25lbnQuYmxvY2tEYXRhW2Jsb2NrT2Zmc2V0XSB8PSByZWFkQml0KCkgPDwgc3VjY2Vzc2l2ZTsKICB9CiAgbGV0IGVvYnJ1biA9IDA7CiAgZnVuY3Rpb24gZGVjb2RlQUNGaXJzdChjb21wb25lbnQsIGJsb2NrT2Zmc2V0KSB7CiAgICBpZiAoZW9icnVuID4gMCkgewogICAgICBlb2JydW4tLTsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGsgPSBzcGVjdHJhbFN0YXJ0OwogICAgY29uc3QgZSA9IHNwZWN0cmFsRW5kOwogICAgd2hpbGUgKGsgPD0gZSkgewogICAgICBjb25zdCBycyA9IGRlY29kZUh1ZmZtYW4oY29tcG9uZW50Lmh1ZmZtYW5UYWJsZUFDKTsKICAgICAgY29uc3QgcyA9IHJzICYgMTUsCiAgICAgICAgciA9IHJzID4+IDQ7CiAgICAgIGlmIChzID09PSAwKSB7CiAgICAgICAgaWYgKHIgPCAxNSkgewogICAgICAgICAgZW9icnVuID0gcmVjZWl2ZShyKSArICgxIDw8IHIpIC0gMTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBrICs9IDE2OwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGsgKz0gcjsKICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1trXTsKICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtibG9ja09mZnNldCArIHpdID0gcmVjZWl2ZUFuZEV4dGVuZChzKSAqICgxIDw8IHN1Y2Nlc3NpdmUpOwogICAgICBrKys7CiAgICB9CiAgfQogIGxldCBzdWNjZXNzaXZlQUNTdGF0ZSA9IDAsCiAgICBzdWNjZXNzaXZlQUNOZXh0VmFsdWU7CiAgZnVuY3Rpb24gZGVjb2RlQUNTdWNjZXNzaXZlKGNvbXBvbmVudCwgYmxvY2tPZmZzZXQpIHsKICAgIGxldCBrID0gc3BlY3RyYWxTdGFydDsKICAgIGNvbnN0IGUgPSBzcGVjdHJhbEVuZDsKICAgIGxldCByID0gMDsKICAgIGxldCBzOwogICAgbGV0IHJzOwogICAgd2hpbGUgKGsgPD0gZSkgewogICAgICBjb25zdCBvZmZzZXRaID0gYmxvY2tPZmZzZXQgKyBkY3RaaWdaYWdba107CiAgICAgIGNvbnN0IHNpZ24gPSBjb21wb25lbnQuYmxvY2tEYXRhW29mZnNldFpdIDwgMCA/IC0xIDogMTsKICAgICAgc3dpdGNoIChzdWNjZXNzaXZlQUNTdGF0ZSkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHJzID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlQUMpOwogICAgICAgICAgcyA9IHJzICYgMTU7CiAgICAgICAgICByID0gcnMgPj4gNDsKICAgICAgICAgIGlmIChzID09PSAwKSB7CiAgICAgICAgICAgIGlmIChyIDwgMTUpIHsKICAgICAgICAgICAgICBlb2JydW4gPSByZWNlaXZlKHIpICsgKDEgPDwgcik7CiAgICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDU3RhdGUgPSA0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHIgPSAxNjsKICAgICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChzICE9PSAxKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiaW52YWxpZCBBQ24gZW5jb2RpbmciKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdWNjZXNzaXZlQUNOZXh0VmFsdWUgPSByZWNlaXZlQW5kRXh0ZW5kKHMpOwogICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IHIgPyAyIDogMzsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIGNhc2UgMToKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBpZiAoY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSkgewogICAgICAgICAgICBjb21wb25lbnQuYmxvY2tEYXRhW29mZnNldFpdICs9IHNpZ24gKiAocmVhZEJpdCgpIDw8IHN1Y2Nlc3NpdmUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgci0tOwogICAgICAgICAgICBpZiAociA9PT0gMCkgewogICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gc3VjY2Vzc2l2ZUFDU3RhdGUgPT09IDIgPyAzIDogMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzOgogICAgICAgICAgaWYgKGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0Wl0pIHsKICAgICAgICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSArPSBzaWduICogKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0Wl0gPSBzdWNjZXNzaXZlQUNOZXh0VmFsdWUgPDwgc3VjY2Vzc2l2ZTsKICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDU3RhdGUgPSAwOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA0OgogICAgICAgICAgaWYgKGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0Wl0pIHsKICAgICAgICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSArPSBzaWduICogKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGsrKzsKICAgIH0KICAgIGlmIChzdWNjZXNzaXZlQUNTdGF0ZSA9PT0gNCkgewogICAgICBlb2JydW4tLTsKICAgICAgaWYgKGVvYnJ1biA9PT0gMCkgewogICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMDsKICAgICAgfQogICAgfQogIH0KICBsZXQgYmxvY2tSb3cgPSAwOwogIGZ1bmN0aW9uIGRlY29kZU1jdShjb21wb25lbnQsIGRlY29kZSwgbWN1LCByb3csIGNvbCkgewogICAgY29uc3QgbWN1Um93ID0gbWN1IC8gbWN1c1BlckxpbmUgfCAwOwogICAgY29uc3QgbWN1Q29sID0gbWN1ICUgbWN1c1BlckxpbmU7CiAgICBibG9ja1JvdyA9IG1jdVJvdyAqIGNvbXBvbmVudC52ICsgcm93OwogICAgY29uc3QgYmxvY2tDb2wgPSBtY3VDb2wgKiBjb21wb25lbnQuaCArIGNvbDsKICAgIGNvbnN0IGJsb2NrT2Zmc2V0ID0gZ2V0QmxvY2tCdWZmZXJPZmZzZXQoY29tcG9uZW50LCBibG9ja1JvdywgYmxvY2tDb2wpOwogICAgZGVjb2RlKGNvbXBvbmVudCwgYmxvY2tPZmZzZXQpOwogIH0KICBmdW5jdGlvbiBkZWNvZGVCbG9jayhjb21wb25lbnQsIGRlY29kZSwgbWN1KSB7CiAgICBibG9ja1JvdyA9IG1jdSAvIGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lIHwgMDsKICAgIGNvbnN0IGJsb2NrQ29sID0gbWN1ICUgY29tcG9uZW50LmJsb2Nrc1BlckxpbmU7CiAgICBjb25zdCBibG9ja09mZnNldCA9IGdldEJsb2NrQnVmZmVyT2Zmc2V0KGNvbXBvbmVudCwgYmxvY2tSb3csIGJsb2NrQ29sKTsKICAgIGRlY29kZShjb21wb25lbnQsIGJsb2NrT2Zmc2V0KTsKICB9CiAgY29uc3QgY29tcG9uZW50c0xlbmd0aCA9IGNvbXBvbmVudHMubGVuZ3RoOwogIGxldCBjb21wb25lbnQsIGksIGosIGssIG47CiAgbGV0IGRlY29kZUZuOwogIGlmIChwcm9ncmVzc2l2ZSkgewogICAgaWYgKHNwZWN0cmFsU3RhcnQgPT09IDApIHsKICAgICAgZGVjb2RlRm4gPSBzdWNjZXNzaXZlUHJldiA9PT0gMCA/IGRlY29kZURDRmlyc3QgOiBkZWNvZGVEQ1N1Y2Nlc3NpdmU7CiAgICB9IGVsc2UgewogICAgICBkZWNvZGVGbiA9IHN1Y2Nlc3NpdmVQcmV2ID09PSAwID8gZGVjb2RlQUNGaXJzdCA6IGRlY29kZUFDU3VjY2Vzc2l2ZTsKICAgIH0KICB9IGVsc2UgewogICAgZGVjb2RlRm4gPSBkZWNvZGVCYXNlbGluZTsKICB9CiAgbGV0IG1jdSA9IDAsCiAgICBmaWxlTWFya2VyOwogIGNvbnN0IG1jdUV4cGVjdGVkID0gY29tcG9uZW50c0xlbmd0aCA9PT0gMSA/IGNvbXBvbmVudHNbMF0uYmxvY2tzUGVyTGluZSAqIGNvbXBvbmVudHNbMF0uYmxvY2tzUGVyQ29sdW1uIDogbWN1c1BlckxpbmUgKiBmcmFtZS5tY3VzUGVyQ29sdW1uOwogIGxldCBoLCB2OwogIHdoaWxlIChtY3UgPD0gbWN1RXhwZWN0ZWQpIHsKICAgIGNvbnN0IG1jdVRvUmVhZCA9IHJlc2V0SW50ZXJ2YWwgPyBNYXRoLm1pbihtY3VFeHBlY3RlZCAtIG1jdSwgcmVzZXRJbnRlcnZhbCkgOiBtY3VFeHBlY3RlZDsKICAgIGlmIChtY3VUb1JlYWQgPiAwKSB7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzTGVuZ3RoOyBpKyspIHsKICAgICAgICBjb21wb25lbnRzW2ldLnByZWQgPSAwOwogICAgICB9CiAgICAgIGVvYnJ1biA9IDA7CiAgICAgIGlmIChjb21wb25lbnRzTGVuZ3RoID09PSAxKSB7CiAgICAgICAgY29tcG9uZW50ID0gY29tcG9uZW50c1swXTsKICAgICAgICBmb3IgKG4gPSAwOyBuIDwgbWN1VG9SZWFkOyBuKyspIHsKICAgICAgICAgIGRlY29kZUJsb2NrKGNvbXBvbmVudCwgZGVjb2RlRm4sIG1jdSk7CiAgICAgICAgICBtY3UrKzsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChuID0gMDsgbiA8IG1jdVRvUmVhZDsgbisrKSB7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY29tcG9uZW50c0xlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbXBvbmVudCA9IGNvbXBvbmVudHNbaV07CiAgICAgICAgICAgIGggPSBjb21wb25lbnQuaDsKICAgICAgICAgICAgdiA9IGNvbXBvbmVudC52OwogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgdjsgaisrKSB7CiAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IGg7IGsrKykgewogICAgICAgICAgICAgICAgZGVjb2RlTWN1KGNvbXBvbmVudCwgZGVjb2RlRm4sIG1jdSwgaiwgayk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtY3UrKzsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGJpdHNDb3VudCA9IDA7CiAgICBmaWxlTWFya2VyID0gZmluZE5leHRGaWxlTWFya2VyKGRhdGEsIG9mZnNldCk7CiAgICBpZiAoIWZpbGVNYXJrZXIpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoZmlsZU1hcmtlci5pbnZhbGlkKSB7CiAgICAgIGNvbnN0IHBhcnRpYWxNc2cgPSBtY3VUb1JlYWQgPiAwID8gInVuZXhwZWN0ZWQiIDogImV4Y2Vzc2l2ZSI7CiAgICAgIHdhcm4oYGRlY29kZVNjYW4gLSAke3BhcnRpYWxNc2d9IE1DVSBkYXRhLCBjdXJyZW50IG1hcmtlciBpczogJHtmaWxlTWFya2VyLmludmFsaWR9YCk7CiAgICAgIG9mZnNldCA9IGZpbGVNYXJrZXIub2Zmc2V0OwogICAgfQogICAgaWYgKGZpbGVNYXJrZXIubWFya2VyID49IDB4ZmZkMCAmJiBmaWxlTWFya2VyLm1hcmtlciA8PSAweGZmZDcpIHsKICAgICAgb2Zmc2V0ICs9IDI7CiAgICB9IGVsc2UgewogICAgICBicmVhazsKICAgIH0KICB9CiAgcmV0dXJuIG9mZnNldCAtIHN0YXJ0T2Zmc2V0Owp9CmZ1bmN0aW9uIHF1YW50aXplQW5kSW52ZXJzZShjb21wb25lbnQsIGJsb2NrQnVmZmVyT2Zmc2V0LCBwKSB7CiAgY29uc3QgcXQgPSBjb21wb25lbnQucXVhbnRpemF0aW9uVGFibGUsCiAgICBibG9ja0RhdGEgPSBjb21wb25lbnQuYmxvY2tEYXRhOwogIGxldCB2MCwgdjEsIHYyLCB2MywgdjQsIHY1LCB2Niwgdjc7CiAgbGV0IHAwLCBwMSwgcDIsIHAzLCBwNCwgcDUsIHA2LCBwNzsKICBsZXQgdDsKICBpZiAoIXF0KSB7CiAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJtaXNzaW5nIHJlcXVpcmVkIFF1YW50aXphdGlvbiBUYWJsZS4iKTsKICB9CiAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgNjQ7IHJvdyArPSA4KSB7CiAgICBwMCA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvd107CiAgICBwMSA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvdyArIDFdOwogICAgcDIgPSBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyByb3cgKyAyXTsKICAgIHAzID0gYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgcm93ICsgM107CiAgICBwNCA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvdyArIDRdOwogICAgcDUgPSBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyByb3cgKyA1XTsKICAgIHA2ID0gYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgcm93ICsgNl07CiAgICBwNyA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvdyArIDddOwogICAgcDAgKj0gcXRbcm93XTsKICAgIGlmICgocDEgfCBwMiB8IHAzIHwgcDQgfCBwNSB8IHA2IHwgcDcpID09PSAwKSB7CiAgICAgIHQgPSBkY3RTcXJ0MiAqIHAwICsgNTEyID4+IDEwOwogICAgICBwW3Jvd10gPSB0OwogICAgICBwW3JvdyArIDFdID0gdDsKICAgICAgcFtyb3cgKyAyXSA9IHQ7CiAgICAgIHBbcm93ICsgM10gPSB0OwogICAgICBwW3JvdyArIDRdID0gdDsKICAgICAgcFtyb3cgKyA1XSA9IHQ7CiAgICAgIHBbcm93ICsgNl0gPSB0OwogICAgICBwW3JvdyArIDddID0gdDsKICAgICAgY29udGludWU7CiAgICB9CiAgICBwMSAqPSBxdFtyb3cgKyAxXTsKICAgIHAyICo9IHF0W3JvdyArIDJdOwogICAgcDMgKj0gcXRbcm93ICsgM107CiAgICBwNCAqPSBxdFtyb3cgKyA0XTsKICAgIHA1ICo9IHF0W3JvdyArIDVdOwogICAgcDYgKj0gcXRbcm93ICsgNl07CiAgICBwNyAqPSBxdFtyb3cgKyA3XTsKICAgIHYwID0gZGN0U3FydDIgKiBwMCArIDEyOCA+PiA4OwogICAgdjEgPSBkY3RTcXJ0MiAqIHA0ICsgMTI4ID4+IDg7CiAgICB2MiA9IHAyOwogICAgdjMgPSBwNjsKICAgIHY0ID0gZGN0U3FydDFkMiAqIChwMSAtIHA3KSArIDEyOCA+PiA4OwogICAgdjcgPSBkY3RTcXJ0MWQyICogKHAxICsgcDcpICsgMTI4ID4+IDg7CiAgICB2NSA9IHAzIDw8IDQ7CiAgICB2NiA9IHA1IDw8IDQ7CiAgICB2MCA9IHYwICsgdjEgKyAxID4+IDE7CiAgICB2MSA9IHYwIC0gdjE7CiAgICB0ID0gdjIgKiBkY3RTaW42ICsgdjMgKiBkY3RDb3M2ICsgMTI4ID4+IDg7CiAgICB2MiA9IHYyICogZGN0Q29zNiAtIHYzICogZGN0U2luNiArIDEyOCA+PiA4OwogICAgdjMgPSB0OwogICAgdjQgPSB2NCArIHY2ICsgMSA+PiAxOwogICAgdjYgPSB2NCAtIHY2OwogICAgdjcgPSB2NyArIHY1ICsgMSA+PiAxOwogICAgdjUgPSB2NyAtIHY1OwogICAgdjAgPSB2MCArIHYzICsgMSA+PiAxOwogICAgdjMgPSB2MCAtIHYzOwogICAgdjEgPSB2MSArIHYyICsgMSA+PiAxOwogICAgdjIgPSB2MSAtIHYyOwogICAgdCA9IHY0ICogZGN0U2luMyArIHY3ICogZGN0Q29zMyArIDIwNDggPj4gMTI7CiAgICB2NCA9IHY0ICogZGN0Q29zMyAtIHY3ICogZGN0U2luMyArIDIwNDggPj4gMTI7CiAgICB2NyA9IHQ7CiAgICB0ID0gdjUgKiBkY3RTaW4xICsgdjYgKiBkY3RDb3MxICsgMjA0OCA+PiAxMjsKICAgIHY1ID0gdjUgKiBkY3RDb3MxIC0gdjYgKiBkY3RTaW4xICsgMjA0OCA+PiAxMjsKICAgIHY2ID0gdDsKICAgIHBbcm93XSA9IHYwICsgdjc7CiAgICBwW3JvdyArIDddID0gdjAgLSB2NzsKICAgIHBbcm93ICsgMV0gPSB2MSArIHY2OwogICAgcFtyb3cgKyA2XSA9IHYxIC0gdjY7CiAgICBwW3JvdyArIDJdID0gdjIgKyB2NTsKICAgIHBbcm93ICsgNV0gPSB2MiAtIHY1OwogICAgcFtyb3cgKyAzXSA9IHYzICsgdjQ7CiAgICBwW3JvdyArIDRdID0gdjMgLSB2NDsKICB9CiAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgODsgKytjb2wpIHsKICAgIHAwID0gcFtjb2xdOwogICAgcDEgPSBwW2NvbCArIDhdOwogICAgcDIgPSBwW2NvbCArIDE2XTsKICAgIHAzID0gcFtjb2wgKyAyNF07CiAgICBwNCA9IHBbY29sICsgMzJdOwogICAgcDUgPSBwW2NvbCArIDQwXTsKICAgIHA2ID0gcFtjb2wgKyA0OF07CiAgICBwNyA9IHBbY29sICsgNTZdOwogICAgaWYgKChwMSB8IHAyIHwgcDMgfCBwNCB8IHA1IHwgcDYgfCBwNykgPT09IDApIHsKICAgICAgdCA9IGRjdFNxcnQyICogcDAgKyA4MTkyID4+IDE0OwogICAgICBpZiAodCA8IC0yMDQwKSB7CiAgICAgICAgdCA9IDA7CiAgICAgIH0gZWxzZSBpZiAodCA+PSAyMDI0KSB7CiAgICAgICAgdCA9IDI1NTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0ID0gdCArIDIwNTYgPj4gNDsKICAgICAgfQogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2xdID0gdDsKICAgICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sICsgOF0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAxNl0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAyNF0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAzMl0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA0MF0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA0OF0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA1Nl0gPSB0OwogICAgICBjb250aW51ZTsKICAgIH0KICAgIHYwID0gZGN0U3FydDIgKiBwMCArIDIwNDggPj4gMTI7CiAgICB2MSA9IGRjdFNxcnQyICogcDQgKyAyMDQ4ID4+IDEyOwogICAgdjIgPSBwMjsKICAgIHYzID0gcDY7CiAgICB2NCA9IGRjdFNxcnQxZDIgKiAocDEgLSBwNykgKyAyMDQ4ID4+IDEyOwogICAgdjcgPSBkY3RTcXJ0MWQyICogKHAxICsgcDcpICsgMjA0OCA+PiAxMjsKICAgIHY1ID0gcDM7CiAgICB2NiA9IHA1OwogICAgdjAgPSAodjAgKyB2MSArIDEgPj4gMSkgKyA0MTEyOwogICAgdjEgPSB2MCAtIHYxOwogICAgdCA9IHYyICogZGN0U2luNiArIHYzICogZGN0Q29zNiArIDIwNDggPj4gMTI7CiAgICB2MiA9IHYyICogZGN0Q29zNiAtIHYzICogZGN0U2luNiArIDIwNDggPj4gMTI7CiAgICB2MyA9IHQ7CiAgICB2NCA9IHY0ICsgdjYgKyAxID4+IDE7CiAgICB2NiA9IHY0IC0gdjY7CiAgICB2NyA9IHY3ICsgdjUgKyAxID4+IDE7CiAgICB2NSA9IHY3IC0gdjU7CiAgICB2MCA9IHYwICsgdjMgKyAxID4+IDE7CiAgICB2MyA9IHYwIC0gdjM7CiAgICB2MSA9IHYxICsgdjIgKyAxID4+IDE7CiAgICB2MiA9IHYxIC0gdjI7CiAgICB0ID0gdjQgKiBkY3RTaW4zICsgdjcgKiBkY3RDb3MzICsgMjA0OCA+PiAxMjsKICAgIHY0ID0gdjQgKiBkY3RDb3MzIC0gdjcgKiBkY3RTaW4zICsgMjA0OCA+PiAxMjsKICAgIHY3ID0gdDsKICAgIHQgPSB2NSAqIGRjdFNpbjEgKyB2NiAqIGRjdENvczEgKyAyMDQ4ID4+IDEyOwogICAgdjUgPSB2NSAqIGRjdENvczEgLSB2NiAqIGRjdFNpbjEgKyAyMDQ4ID4+IDEyOwogICAgdjYgPSB0OwogICAgcDAgPSB2MCArIHY3OwogICAgcDcgPSB2MCAtIHY3OwogICAgcDEgPSB2MSArIHY2OwogICAgcDYgPSB2MSAtIHY2OwogICAgcDIgPSB2MiArIHY1OwogICAgcDUgPSB2MiAtIHY1OwogICAgcDMgPSB2MyArIHY0OwogICAgcDQgPSB2MyAtIHY0OwogICAgaWYgKHAwIDwgMTYpIHsKICAgICAgcDAgPSAwOwogICAgfSBlbHNlIGlmIChwMCA+PSA0MDgwKSB7CiAgICAgIHAwID0gMjU1OwogICAgfSBlbHNlIHsKICAgICAgcDAgPj49IDQ7CiAgICB9CiAgICBpZiAocDEgPCAxNikgewogICAgICBwMSA9IDA7CiAgICB9IGVsc2UgaWYgKHAxID49IDQwODApIHsKICAgICAgcDEgPSAyNTU7CiAgICB9IGVsc2UgewogICAgICBwMSA+Pj0gNDsKICAgIH0KICAgIGlmIChwMiA8IDE2KSB7CiAgICAgIHAyID0gMDsKICAgIH0gZWxzZSBpZiAocDIgPj0gNDA4MCkgewogICAgICBwMiA9IDI1NTsKICAgIH0gZWxzZSB7CiAgICAgIHAyID4+PSA0OwogICAgfQogICAgaWYgKHAzIDwgMTYpIHsKICAgICAgcDMgPSAwOwogICAgfSBlbHNlIGlmIChwMyA+PSA0MDgwKSB7CiAgICAgIHAzID0gMjU1OwogICAgfSBlbHNlIHsKICAgICAgcDMgPj49IDQ7CiAgICB9CiAgICBpZiAocDQgPCAxNikgewogICAgICBwNCA9IDA7CiAgICB9IGVsc2UgaWYgKHA0ID49IDQwODApIHsKICAgICAgcDQgPSAyNTU7CiAgICB9IGVsc2UgewogICAgICBwNCA+Pj0gNDsKICAgIH0KICAgIGlmIChwNSA8IDE2KSB7CiAgICAgIHA1ID0gMDsKICAgIH0gZWxzZSBpZiAocDUgPj0gNDA4MCkgewogICAgICBwNSA9IDI1NTsKICAgIH0gZWxzZSB7CiAgICAgIHA1ID4+PSA0OwogICAgfQogICAgaWYgKHA2IDwgMTYpIHsKICAgICAgcDYgPSAwOwogICAgfSBlbHNlIGlmIChwNiA+PSA0MDgwKSB7CiAgICAgIHA2ID0gMjU1OwogICAgfSBlbHNlIHsKICAgICAgcDYgPj49IDQ7CiAgICB9CiAgICBpZiAocDcgPCAxNikgewogICAgICBwNyA9IDA7CiAgICB9IGVsc2UgaWYgKHA3ID49IDQwODApIHsKICAgICAgcDcgPSAyNTU7CiAgICB9IGVsc2UgewogICAgICBwNyA+Pj0gNDsKICAgIH0KICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbF0gPSBwMDsKICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDhdID0gcDE7CiAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAxNl0gPSBwMjsKICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDI0XSA9IHAzOwogICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sICsgMzJdID0gcDQ7CiAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA0MF0gPSBwNTsKICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDQ4XSA9IHA2OwogICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sICsgNTZdID0gcDc7CiAgfQp9CmZ1bmN0aW9uIGJ1aWxkQ29tcG9uZW50RGF0YShmcmFtZSwgY29tcG9uZW50KSB7CiAgY29uc3QgYmxvY2tzUGVyTGluZSA9IGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lOwogIGNvbnN0IGJsb2Nrc1BlckNvbHVtbiA9IGNvbXBvbmVudC5ibG9ja3NQZXJDb2x1bW47CiAgY29uc3QgY29tcHV0YXRpb25CdWZmZXIgPSBuZXcgSW50MTZBcnJheSg2NCk7CiAgZm9yIChsZXQgYmxvY2tSb3cgPSAwOyBibG9ja1JvdyA8IGJsb2Nrc1BlckNvbHVtbjsgYmxvY2tSb3crKykgewogICAgZm9yIChsZXQgYmxvY2tDb2wgPSAwOyBibG9ja0NvbCA8IGJsb2Nrc1BlckxpbmU7IGJsb2NrQ29sKyspIHsKICAgICAgY29uc3Qgb2Zmc2V0ID0gZ2V0QmxvY2tCdWZmZXJPZmZzZXQoY29tcG9uZW50LCBibG9ja1JvdywgYmxvY2tDb2wpOwogICAgICBxdWFudGl6ZUFuZEludmVyc2UoY29tcG9uZW50LCBvZmZzZXQsIGNvbXB1dGF0aW9uQnVmZmVyKTsKICAgIH0KICB9CiAgcmV0dXJuIGNvbXBvbmVudC5ibG9ja0RhdGE7Cn0KZnVuY3Rpb24gZmluZE5leHRGaWxlTWFya2VyKGRhdGEsIGN1cnJlbnRQb3MsIHN0YXJ0UG9zID0gY3VycmVudFBvcykgewogIGNvbnN0IG1heFBvcyA9IGRhdGEubGVuZ3RoIC0gMTsKICBsZXQgbmV3UG9zID0gc3RhcnRQb3MgPCBjdXJyZW50UG9zID8gc3RhcnRQb3MgOiBjdXJyZW50UG9zOwogIGlmIChjdXJyZW50UG9zID49IG1heFBvcykgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IGN1cnJlbnRNYXJrZXIgPSByZWFkVWludDE2KGRhdGEsIGN1cnJlbnRQb3MpOwogIGlmIChjdXJyZW50TWFya2VyID49IDB4ZmZjMCAmJiBjdXJyZW50TWFya2VyIDw9IDB4ZmZmZSkgewogICAgcmV0dXJuIHsKICAgICAgaW52YWxpZDogbnVsbCwKICAgICAgbWFya2VyOiBjdXJyZW50TWFya2VyLAogICAgICBvZmZzZXQ6IGN1cnJlbnRQb3MKICAgIH07CiAgfQogIGxldCBuZXdNYXJrZXIgPSByZWFkVWludDE2KGRhdGEsIG5ld1Bvcyk7CiAgd2hpbGUgKCEobmV3TWFya2VyID49IDB4ZmZjMCAmJiBuZXdNYXJrZXIgPD0gMHhmZmZlKSkgewogICAgaWYgKCsrbmV3UG9zID49IG1heFBvcykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIG5ld01hcmtlciA9IHJlYWRVaW50MTYoZGF0YSwgbmV3UG9zKTsKICB9CiAgcmV0dXJuIHsKICAgIGludmFsaWQ6IGN1cnJlbnRNYXJrZXIudG9TdHJpbmcoMTYpLAogICAgbWFya2VyOiBuZXdNYXJrZXIsCiAgICBvZmZzZXQ6IG5ld1BvcwogIH07Cn0KZnVuY3Rpb24gcHJlcGFyZUNvbXBvbmVudHMoZnJhbWUpIHsKICBjb25zdCBtY3VzUGVyTGluZSA9IE1hdGguY2VpbChmcmFtZS5zYW1wbGVzUGVyTGluZSAvIDggLyBmcmFtZS5tYXhIKTsKICBjb25zdCBtY3VzUGVyQ29sdW1uID0gTWF0aC5jZWlsKGZyYW1lLnNjYW5MaW5lcyAvIDggLyBmcmFtZS5tYXhWKTsKICBmb3IgKGNvbnN0IGNvbXBvbmVudCBvZiBmcmFtZS5jb21wb25lbnRzKSB7CiAgICBjb25zdCBibG9ja3NQZXJMaW5lID0gTWF0aC5jZWlsKE1hdGguY2VpbChmcmFtZS5zYW1wbGVzUGVyTGluZSAvIDgpICogY29tcG9uZW50LmggLyBmcmFtZS5tYXhIKTsKICAgIGNvbnN0IGJsb2Nrc1BlckNvbHVtbiA9IE1hdGguY2VpbChNYXRoLmNlaWwoZnJhbWUuc2NhbkxpbmVzIC8gOCkgKiBjb21wb25lbnQudiAvIGZyYW1lLm1heFYpOwogICAgY29uc3QgYmxvY2tzUGVyTGluZUZvck1jdSA9IG1jdXNQZXJMaW5lICogY29tcG9uZW50Lmg7CiAgICBjb25zdCBibG9ja3NQZXJDb2x1bW5Gb3JNY3UgPSBtY3VzUGVyQ29sdW1uICogY29tcG9uZW50LnY7CiAgICBjb25zdCBibG9ja3NCdWZmZXJTaXplID0gNjQgKiBibG9ja3NQZXJDb2x1bW5Gb3JNY3UgKiAoYmxvY2tzUGVyTGluZUZvck1jdSArIDEpOwogICAgY29tcG9uZW50LmJsb2NrRGF0YSA9IG5ldyBJbnQxNkFycmF5KGJsb2Nrc0J1ZmZlclNpemUpOwogICAgY29tcG9uZW50LmJsb2Nrc1BlckxpbmUgPSBibG9ja3NQZXJMaW5lOwogICAgY29tcG9uZW50LmJsb2Nrc1BlckNvbHVtbiA9IGJsb2Nrc1BlckNvbHVtbjsKICB9CiAgZnJhbWUubWN1c1BlckxpbmUgPSBtY3VzUGVyTGluZTsKICBmcmFtZS5tY3VzUGVyQ29sdW1uID0gbWN1c1BlckNvbHVtbjsKfQpmdW5jdGlvbiByZWFkRGF0YUJsb2NrKGRhdGEsIG9mZnNldCkgewogIGNvbnN0IGxlbmd0aCA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICBvZmZzZXQgKz0gMjsKICBsZXQgZW5kT2Zmc2V0ID0gb2Zmc2V0ICsgbGVuZ3RoIC0gMjsKICBjb25zdCBmaWxlTWFya2VyID0gZmluZE5leHRGaWxlTWFya2VyKGRhdGEsIGVuZE9mZnNldCwgb2Zmc2V0KTsKICBpZiAoZmlsZU1hcmtlcj8uaW52YWxpZCkgewogICAgd2FybigicmVhZERhdGFCbG9jayAtIGluY29ycmVjdCBsZW5ndGgsIGN1cnJlbnQgbWFya2VyIGlzOiAiICsgZmlsZU1hcmtlci5pbnZhbGlkKTsKICAgIGVuZE9mZnNldCA9IGZpbGVNYXJrZXIub2Zmc2V0OwogIH0KICBjb25zdCBhcnJheSA9IGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBlbmRPZmZzZXQpOwogIHJldHVybiB7CiAgICBhcHBEYXRhOiBhcnJheSwKICAgIG9sZE9mZnNldDogb2Zmc2V0LAogICAgbmV3T2Zmc2V0OiBvZmZzZXQgKyBhcnJheS5sZW5ndGgKICB9Owp9CmZ1bmN0aW9uIHNraXBEYXRhKGRhdGEsIG9mZnNldCkgewogIGNvbnN0IGxlbmd0aCA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICBvZmZzZXQgKz0gMjsKICBjb25zdCBlbmRPZmZzZXQgPSBvZmZzZXQgKyBsZW5ndGggLSAyOwogIGNvbnN0IGZpbGVNYXJrZXIgPSBmaW5kTmV4dEZpbGVNYXJrZXIoZGF0YSwgZW5kT2Zmc2V0LCBvZmZzZXQpOwogIGlmIChmaWxlTWFya2VyPy5pbnZhbGlkKSB7CiAgICByZXR1cm4gZmlsZU1hcmtlci5vZmZzZXQ7CiAgfQogIHJldHVybiBlbmRPZmZzZXQ7Cn0KY2xhc3MgSnBlZ0ltYWdlIHsKICBjb25zdHJ1Y3Rvcih7CiAgICBkZWNvZGVUcmFuc2Zvcm0gPSBudWxsLAogICAgY29sb3JUcmFuc2Zvcm0gPSAtMQogIH0gPSB7fSkgewogICAgdGhpcy5fZGVjb2RlVHJhbnNmb3JtID0gZGVjb2RlVHJhbnNmb3JtOwogICAgdGhpcy5fY29sb3JUcmFuc2Zvcm0gPSBjb2xvclRyYW5zZm9ybTsKICB9CiAgc3RhdGljIGNhblVzZUltYWdlRGVjb2RlcihkYXRhLCBjb2xvclRyYW5zZm9ybSA9IC0xKSB7CiAgICBsZXQgZXhpZk9mZnNldHMgPSBudWxsOwogICAgbGV0IG9mZnNldCA9IDA7CiAgICBsZXQgbnVtQ29tcG9uZW50cyA9IG51bGw7CiAgICBsZXQgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICAgIG9mZnNldCArPSAyOwogICAgaWYgKGZpbGVNYXJrZXIgIT09IDB4ZmZkOCkgewogICAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJTT0kgbm90IGZvdW5kIik7CiAgICB9CiAgICBmaWxlTWFya2VyID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgb2Zmc2V0ICs9IDI7CiAgICBtYXJrZXJMb29wOiB3aGlsZSAoZmlsZU1hcmtlciAhPT0gMHhmZmQ5KSB7CiAgICAgIHN3aXRjaCAoZmlsZU1hcmtlcikgewogICAgICAgIGNhc2UgMHhmZmUxOgogICAgICAgICAgY29uc3QgewogICAgICAgICAgICBhcHBEYXRhLAogICAgICAgICAgICBvbGRPZmZzZXQsCiAgICAgICAgICAgIG5ld09mZnNldAogICAgICAgICAgfSA9IHJlYWREYXRhQmxvY2soZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCA9IG5ld09mZnNldDsKICAgICAgICAgIGlmIChhcHBEYXRhWzBdID09PSAweDQ1ICYmIGFwcERhdGFbMV0gPT09IDB4NzggJiYgYXBwRGF0YVsyXSA9PT0gMHg2OSAmJiBhcHBEYXRhWzNdID09PSAweDY2ICYmIGFwcERhdGFbNF0gPT09IDAgJiYgYXBwRGF0YVs1XSA9PT0gMCkgewogICAgICAgICAgICBpZiAoZXhpZk9mZnNldHMpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJEdXBsaWNhdGUgRVhJRi1ibG9ja3MgZm91bmQuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXhpZk9mZnNldHMgPSB7CiAgICAgICAgICAgICAgZXhpZlN0YXJ0OiBvbGRPZmZzZXQgKyA2LAogICAgICAgICAgICAgIGV4aWZFbmQ6IG5ld09mZnNldAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgY2FzZSAweGZmYzA6CiAgICAgICAgY2FzZSAweGZmYzE6CiAgICAgICAgY2FzZSAweGZmYzI6CiAgICAgICAgICBudW1Db21wb25lbnRzID0gZGF0YVtvZmZzZXQgKyAoMiArIDEgKyAyICsgMildOwogICAgICAgICAgYnJlYWsgbWFya2VyTG9vcDsKICAgICAgICBjYXNlIDB4ZmZmZjoKICAgICAgICAgIGlmIChkYXRhW29mZnNldF0gIT09IDB4ZmYpIHsKICAgICAgICAgICAgb2Zmc2V0LS07CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBvZmZzZXQgPSBza2lwRGF0YShkYXRhLCBvZmZzZXQpOwogICAgICBmaWxlTWFya2VyID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICBvZmZzZXQgKz0gMjsKICAgIH0KICAgIGlmIChudW1Db21wb25lbnRzID09PSA0KSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKG51bUNvbXBvbmVudHMgPT09IDMgJiYgY29sb3JUcmFuc2Zvcm0gPT09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICByZXR1cm4gZXhpZk9mZnNldHMgfHwge307CiAgfQogIHBhcnNlKGRhdGEsIHsKICAgIGRubFNjYW5MaW5lcyA9IG51bGwKICB9ID0ge30pIHsKICAgIGxldCBvZmZzZXQgPSAwOwogICAgbGV0IGpmaWYgPSBudWxsOwogICAgbGV0IGFkb2JlID0gbnVsbDsKICAgIGxldCBmcmFtZSwgcmVzZXRJbnRlcnZhbDsKICAgIGxldCBudW1TT1NNYXJrZXJzID0gMDsKICAgIGNvbnN0IHF1YW50aXphdGlvblRhYmxlcyA9IFtdOwogICAgY29uc3QgaHVmZm1hblRhYmxlc0FDID0gW10sCiAgICAgIGh1ZmZtYW5UYWJsZXNEQyA9IFtdOwogICAgbGV0IGZpbGVNYXJrZXIgPSByZWFkVWludDE2KGRhdGEsIG9mZnNldCk7CiAgICBvZmZzZXQgKz0gMjsKICAgIGlmIChmaWxlTWFya2VyICE9PSAweGZmZDgpIHsKICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiU09JIG5vdCBmb3VuZCIpOwogICAgfQogICAgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICAgIG9mZnNldCArPSAyOwogICAgbWFya2VyTG9vcDogd2hpbGUgKGZpbGVNYXJrZXIgIT09IDB4ZmZkOSkgewogICAgICBsZXQgaSwgaiwgbDsKICAgICAgc3dpdGNoIChmaWxlTWFya2VyKSB7CiAgICAgICAgY2FzZSAweGZmZTA6CiAgICAgICAgY2FzZSAweGZmZTE6CiAgICAgICAgY2FzZSAweGZmZTI6CiAgICAgICAgY2FzZSAweGZmZTM6CiAgICAgICAgY2FzZSAweGZmZTQ6CiAgICAgICAgY2FzZSAweGZmZTU6CiAgICAgICAgY2FzZSAweGZmZTY6CiAgICAgICAgY2FzZSAweGZmZTc6CiAgICAgICAgY2FzZSAweGZmZTg6CiAgICAgICAgY2FzZSAweGZmZTk6CiAgICAgICAgY2FzZSAweGZmZWE6CiAgICAgICAgY2FzZSAweGZmZWI6CiAgICAgICAgY2FzZSAweGZmZWM6CiAgICAgICAgY2FzZSAweGZmZWQ6CiAgICAgICAgY2FzZSAweGZmZWU6CiAgICAgICAgY2FzZSAweGZmZWY6CiAgICAgICAgY2FzZSAweGZmZmU6CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGFwcERhdGEsCiAgICAgICAgICAgIG5ld09mZnNldAogICAgICAgICAgfSA9IHJlYWREYXRhQmxvY2soZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCA9IG5ld09mZnNldDsKICAgICAgICAgIGlmIChmaWxlTWFya2VyID09PSAweGZmZTApIHsKICAgICAgICAgICAgaWYgKGFwcERhdGFbMF0gPT09IDB4NGEgJiYgYXBwRGF0YVsxXSA9PT0gMHg0NiAmJiBhcHBEYXRhWzJdID09PSAweDQ5ICYmIGFwcERhdGFbM10gPT09IDB4NDYgJiYgYXBwRGF0YVs0XSA9PT0gMCkgewogICAgICAgICAgICAgIGpmaWYgPSB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiB7CiAgICAgICAgICAgICAgICAgIG1ham9yOiBhcHBEYXRhWzVdLAogICAgICAgICAgICAgICAgICBtaW5vcjogYXBwRGF0YVs2XQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRlbnNpdHlVbml0czogYXBwRGF0YVs3XSwKICAgICAgICAgICAgICAgIHhEZW5zaXR5OiBhcHBEYXRhWzhdIDw8IDggfCBhcHBEYXRhWzldLAogICAgICAgICAgICAgICAgeURlbnNpdHk6IGFwcERhdGFbMTBdIDw8IDggfCBhcHBEYXRhWzExXSwKICAgICAgICAgICAgICAgIHRodW1iV2lkdGg6IGFwcERhdGFbMTJdLAogICAgICAgICAgICAgICAgdGh1bWJIZWlnaHQ6IGFwcERhdGFbMTNdLAogICAgICAgICAgICAgICAgdGh1bWJEYXRhOiBhcHBEYXRhLnN1YmFycmF5KDE0LCAxNCArIDMgKiBhcHBEYXRhWzEyXSAqIGFwcERhdGFbMTNdKQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChmaWxlTWFya2VyID09PSAweGZmZWUpIHsKICAgICAgICAgICAgaWYgKGFwcERhdGFbMF0gPT09IDB4NDEgJiYgYXBwRGF0YVsxXSA9PT0gMHg2NCAmJiBhcHBEYXRhWzJdID09PSAweDZmICYmIGFwcERhdGFbM10gPT09IDB4NjIgJiYgYXBwRGF0YVs0XSA9PT0gMHg2NSkgewogICAgICAgICAgICAgIGFkb2JlID0gewogICAgICAgICAgICAgICAgdmVyc2lvbjogYXBwRGF0YVs1XSA8PCA4IHwgYXBwRGF0YVs2XSwKICAgICAgICAgICAgICAgIGZsYWdzMDogYXBwRGF0YVs3XSA8PCA4IHwgYXBwRGF0YVs4XSwKICAgICAgICAgICAgICAgIGZsYWdzMTogYXBwRGF0YVs5XSA8PCA4IHwgYXBwRGF0YVsxMF0sCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Db2RlOiBhcHBEYXRhWzExXQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHhmZmRiOgogICAgICAgICAgY29uc3QgcXVhbnRpemF0aW9uVGFibGVzTGVuZ3RoID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBjb25zdCBxdWFudGl6YXRpb25UYWJsZXNFbmQgPSBxdWFudGl6YXRpb25UYWJsZXNMZW5ndGggKyBvZmZzZXQgLSAyOwogICAgICAgICAgbGV0IHo7CiAgICAgICAgICB3aGlsZSAob2Zmc2V0IDwgcXVhbnRpemF0aW9uVGFibGVzRW5kKSB7CiAgICAgICAgICAgIGNvbnN0IHF1YW50aXphdGlvblRhYmxlU3BlYyA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICBjb25zdCB0YWJsZURhdGEgPSBuZXcgVWludDE2QXJyYXkoNjQpOwogICAgICAgICAgICBpZiAocXVhbnRpemF0aW9uVGFibGVTcGVjID4+IDQgPT09IDApIHsKICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgNjQ7IGorKykgewogICAgICAgICAgICAgICAgeiA9IGRjdFppZ1phZ1tqXTsKICAgICAgICAgICAgICAgIHRhYmxlRGF0YVt6XSA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChxdWFudGl6YXRpb25UYWJsZVNwZWMgPj4gNCA9PT0gMSkgewogICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCA2NDsgaisrKSB7CiAgICAgICAgICAgICAgICB6ID0gZGN0WmlnWmFnW2pdOwogICAgICAgICAgICAgICAgdGFibGVEYXRhW3pdID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93IG5ldyBKcGVnRXJyb3IoIkRRVCAtIGludmFsaWQgdGFibGUgc3BlYyIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHF1YW50aXphdGlvblRhYmxlc1txdWFudGl6YXRpb25UYWJsZVNwZWMgJiAxNV0gPSB0YWJsZURhdGE7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4ZmZjMDoKICAgICAgICBjYXNlIDB4ZmZjMToKICAgICAgICBjYXNlIDB4ZmZjMjoKICAgICAgICAgIGlmIChmcmFtZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJPbmx5IHNpbmdsZSBmcmFtZSBKUEVHcyBzdXBwb3J0ZWQiKTsKICAgICAgICAgIH0KICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgZnJhbWUgPSB7fTsKICAgICAgICAgIGZyYW1lLmV4dGVuZGVkID0gZmlsZU1hcmtlciA9PT0gMHhmZmMxOwogICAgICAgICAgZnJhbWUucHJvZ3Jlc3NpdmUgPSBmaWxlTWFya2VyID09PSAweGZmYzI7CiAgICAgICAgICBmcmFtZS5wcmVjaXNpb24gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgIGNvbnN0IHNvZlNjYW5MaW5lcyA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgZnJhbWUuc2NhbkxpbmVzID0gZG5sU2NhbkxpbmVzIHx8IHNvZlNjYW5MaW5lczsKICAgICAgICAgIGZyYW1lLnNhbXBsZXNQZXJMaW5lID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBmcmFtZS5jb21wb25lbnRzID0gW107CiAgICAgICAgICBmcmFtZS5jb21wb25lbnRJZHMgPSB7fTsKICAgICAgICAgIGNvbnN0IGNvbXBvbmVudHNDb3VudCA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgbGV0IG1heEggPSAwLAogICAgICAgICAgICBtYXhWID0gMDsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzQ291bnQ7IGkrKykgewogICAgICAgICAgICBjb25zdCBjb21wb25lbnRJZCA9IGRhdGFbb2Zmc2V0XTsKICAgICAgICAgICAgY29uc3QgaCA9IGRhdGFbb2Zmc2V0ICsgMV0gPj4gNDsKICAgICAgICAgICAgY29uc3QgdiA9IGRhdGFbb2Zmc2V0ICsgMV0gJiAxNTsKICAgICAgICAgICAgaWYgKG1heEggPCBoKSB7CiAgICAgICAgICAgICAgbWF4SCA9IGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1heFYgPCB2KSB7CiAgICAgICAgICAgICAgbWF4ViA9IHY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcUlkID0gZGF0YVtvZmZzZXQgKyAyXTsKICAgICAgICAgICAgbCA9IGZyYW1lLmNvbXBvbmVudHMucHVzaCh7CiAgICAgICAgICAgICAgaCwKICAgICAgICAgICAgICB2LAogICAgICAgICAgICAgIHF1YW50aXphdGlvbklkOiBxSWQsCiAgICAgICAgICAgICAgcXVhbnRpemF0aW9uVGFibGU6IG51bGwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGZyYW1lLmNvbXBvbmVudElkc1tjb21wb25lbnRJZF0gPSBsIC0gMTsKICAgICAgICAgICAgb2Zmc2V0ICs9IDM7CiAgICAgICAgICB9CiAgICAgICAgICBmcmFtZS5tYXhIID0gbWF4SDsKICAgICAgICAgIGZyYW1lLm1heFYgPSBtYXhWOwogICAgICAgICAgcHJlcGFyZUNvbXBvbmVudHMoZnJhbWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGZmYzQ6CiAgICAgICAgICBjb25zdCBodWZmbWFuTGVuZ3RoID0gcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBmb3IgKGkgPSAyOyBpIDwgaHVmZm1hbkxlbmd0aDspIHsKICAgICAgICAgICAgY29uc3QgaHVmZm1hblRhYmxlU3BlYyA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICBjb25zdCBjb2RlTGVuZ3RocyA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgICAgICAgICAgbGV0IGNvZGVMZW5ndGhTdW0gPSAwOwogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgMTY7IGorKywgb2Zmc2V0KyspIHsKICAgICAgICAgICAgICBjb2RlTGVuZ3RoU3VtICs9IGNvZGVMZW5ndGhzW2pdID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGh1ZmZtYW5WYWx1ZXMgPSBuZXcgVWludDhBcnJheShjb2RlTGVuZ3RoU3VtKTsKICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGNvZGVMZW5ndGhTdW07IGorKywgb2Zmc2V0KyspIHsKICAgICAgICAgICAgICBodWZmbWFuVmFsdWVzW2pdID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGkgKz0gMTcgKyBjb2RlTGVuZ3RoU3VtOwogICAgICAgICAgICAoaHVmZm1hblRhYmxlU3BlYyA+PiA0ID09PSAwID8gaHVmZm1hblRhYmxlc0RDIDogaHVmZm1hblRhYmxlc0FDKVtodWZmbWFuVGFibGVTcGVjICYgMTVdID0gYnVpbGRIdWZmbWFuVGFibGUoY29kZUxlbmd0aHMsIGh1ZmZtYW5WYWx1ZXMpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGZmZGQ6CiAgICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgICAgIHJlc2V0SW50ZXJ2YWwgPSByZWFkVWludDE2KGRhdGEsIG9mZnNldCk7CiAgICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHhmZmRhOgogICAgICAgICAgY29uc3QgcGFyc2VETkxNYXJrZXIgPSArK251bVNPU01hcmtlcnMgPT09IDEgJiYgIWRubFNjYW5MaW5lczsKICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgY29uc3Qgc2VsZWN0b3JzQ291bnQgPSBkYXRhW29mZnNldCsrXSwKICAgICAgICAgICAgY29tcG9uZW50cyA9IFtdOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNlbGVjdG9yc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3QgY29tcG9uZW50SW5kZXggPSBmcmFtZS5jb21wb25lbnRJZHNbaW5kZXhdOwogICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSBmcmFtZS5jb21wb25lbnRzW2NvbXBvbmVudEluZGV4XTsKICAgICAgICAgICAgY29tcG9uZW50LmluZGV4ID0gaW5kZXg7CiAgICAgICAgICAgIGNvbnN0IHRhYmxlU3BlYyA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICBjb21wb25lbnQuaHVmZm1hblRhYmxlREMgPSBodWZmbWFuVGFibGVzRENbdGFibGVTcGVjID4+IDRdOwogICAgICAgICAgICBjb21wb25lbnQuaHVmZm1hblRhYmxlQUMgPSBodWZmbWFuVGFibGVzQUNbdGFibGVTcGVjICYgMTVdOwogICAgICAgICAgICBjb21wb25lbnRzLnB1c2goY29tcG9uZW50KTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHNwZWN0cmFsU3RhcnQgPSBkYXRhW29mZnNldCsrXSwKICAgICAgICAgICAgc3BlY3RyYWxFbmQgPSBkYXRhW29mZnNldCsrXSwKICAgICAgICAgICAgc3VjY2Vzc2l2ZUFwcHJveGltYXRpb24gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NlZCA9IGRlY29kZVNjYW4oZGF0YSwgb2Zmc2V0LCBmcmFtZSwgY29tcG9uZW50cywgcmVzZXRJbnRlcnZhbCwgc3BlY3RyYWxTdGFydCwgc3BlY3RyYWxFbmQsIHN1Y2Nlc3NpdmVBcHByb3hpbWF0aW9uID4+IDQsIHN1Y2Nlc3NpdmVBcHByb3hpbWF0aW9uICYgMTUsIHBhcnNlRE5MTWFya2VyKTsKICAgICAgICAgICAgb2Zmc2V0ICs9IHByb2Nlc3NlZDsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIGlmIChleCBpbnN0YW5jZW9mIEROTE1hcmtlckVycm9yKSB7CiAgICAgICAgICAgICAgd2FybihgJHtleC5tZXNzYWdlfSAtLSBhdHRlbXB0aW5nIHRvIHJlLXBhcnNlIHRoZSBKUEVHIGltYWdlLmApOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlKGRhdGEsIHsKICAgICAgICAgICAgICAgIGRubFNjYW5MaW5lczogZXguc2NhbkxpbmVzCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXggaW5zdGFuY2VvZiBFT0lNYXJrZXJFcnJvcikgewogICAgICAgICAgICAgIHdhcm4oYCR7ZXgubWVzc2FnZX0gLS0gaWdub3JpbmcgdGhlIHJlc3Qgb2YgdGhlIGltYWdlIGRhdGEuYCk7CiAgICAgICAgICAgICAgYnJlYWsgbWFya2VyTG9vcDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBleDsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHhmZmRjOgogICAgICAgICAgb2Zmc2V0ICs9IDQ7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4ZmZmZjoKICAgICAgICAgIGlmIChkYXRhW29mZnNldF0gIT09IDB4ZmYpIHsKICAgICAgICAgICAgb2Zmc2V0LS07CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgY29uc3QgbmV4dEZpbGVNYXJrZXIgPSBmaW5kTmV4dEZpbGVNYXJrZXIoZGF0YSwgb2Zmc2V0IC0gMiwgb2Zmc2V0IC0gMyk7CiAgICAgICAgICBpZiAobmV4dEZpbGVNYXJrZXI/LmludmFsaWQpIHsKICAgICAgICAgICAgd2FybigiSnBlZ0ltYWdlLnBhcnNlIC0gdW5leHBlY3RlZCBkYXRhLCBjdXJyZW50IG1hcmtlciBpczogIiArIG5leHRGaWxlTWFya2VyLmludmFsaWQpOwogICAgICAgICAgICBvZmZzZXQgPSBuZXh0RmlsZU1hcmtlci5vZmZzZXQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFuZXh0RmlsZU1hcmtlciB8fCBvZmZzZXQgPj0gZGF0YS5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHdhcm4oIkpwZWdJbWFnZS5wYXJzZSAtIHJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgaW1hZ2UgZGF0YSAiICsgIndpdGhvdXQgZmluZGluZyBhbiBFT0kgbWFya2VyICgweEZGRDkpLiIpOwogICAgICAgICAgICBicmVhayBtYXJrZXJMb29wOwogICAgICAgICAgfQogICAgICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiSnBlZ0ltYWdlLnBhcnNlIC0gdW5rbm93biBtYXJrZXI6ICIgKyBmaWxlTWFya2VyLnRvU3RyaW5nKDE2KSk7CiAgICAgIH0KICAgICAgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICAgICAgb2Zmc2V0ICs9IDI7CiAgICB9CiAgICBpZiAoIWZyYW1lKSB7CiAgICAgIHRocm93IG5ldyBKcGVnRXJyb3IoIkpwZWdJbWFnZS5wYXJzZSAtIG5vIGZyYW1lIGRhdGEgZm91bmQuIik7CiAgICB9CiAgICB0aGlzLndpZHRoID0gZnJhbWUuc2FtcGxlc1BlckxpbmU7CiAgICB0aGlzLmhlaWdodCA9IGZyYW1lLnNjYW5MaW5lczsKICAgIHRoaXMuamZpZiA9IGpmaWY7CiAgICB0aGlzLmFkb2JlID0gYWRvYmU7CiAgICB0aGlzLmNvbXBvbmVudHMgPSBbXTsKICAgIGZvciAoY29uc3QgY29tcG9uZW50IG9mIGZyYW1lLmNvbXBvbmVudHMpIHsKICAgICAgY29uc3QgcXVhbnRpemF0aW9uVGFibGUgPSBxdWFudGl6YXRpb25UYWJsZXNbY29tcG9uZW50LnF1YW50aXphdGlvbklkXTsKICAgICAgaWYgKHF1YW50aXphdGlvblRhYmxlKSB7CiAgICAgICAgY29tcG9uZW50LnF1YW50aXphdGlvblRhYmxlID0gcXVhbnRpemF0aW9uVGFibGU7CiAgICAgIH0KICAgICAgdGhpcy5jb21wb25lbnRzLnB1c2goewogICAgICAgIGluZGV4OiBjb21wb25lbnQuaW5kZXgsCiAgICAgICAgb3V0cHV0OiBidWlsZENvbXBvbmVudERhdGEoZnJhbWUsIGNvbXBvbmVudCksCiAgICAgICAgc2NhbGVYOiBjb21wb25lbnQuaCAvIGZyYW1lLm1heEgsCiAgICAgICAgc2NhbGVZOiBjb21wb25lbnQudiAvIGZyYW1lLm1heFYsCiAgICAgICAgYmxvY2tzUGVyTGluZTogY29tcG9uZW50LmJsb2Nrc1BlckxpbmUsCiAgICAgICAgYmxvY2tzUGVyQ29sdW1uOiBjb21wb25lbnQuYmxvY2tzUGVyQ29sdW1uCiAgICAgIH0pOwogICAgfQogICAgdGhpcy5udW1Db21wb25lbnRzID0gdGhpcy5jb21wb25lbnRzLmxlbmd0aDsKICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQogIF9nZXRMaW5lYXJpemVkQmxvY2tEYXRhKHdpZHRoLCBoZWlnaHQsIGlzU291cmNlUERGID0gZmFsc2UpIHsKICAgIGNvbnN0IHNjYWxlWCA9IHRoaXMud2lkdGggLyB3aWR0aCwKICAgICAgc2NhbGVZID0gdGhpcy5oZWlnaHQgLyBoZWlnaHQ7CiAgICBsZXQgY29tcG9uZW50LCBjb21wb25lbnRTY2FsZVgsIGNvbXBvbmVudFNjYWxlWSwgYmxvY2tzUGVyU2NhbmxpbmU7CiAgICBsZXQgeCwgeSwgaSwgaiwgazsKICAgIGxldCBpbmRleDsKICAgIGxldCBvZmZzZXQgPSAwOwogICAgbGV0IG91dHB1dDsKICAgIGNvbnN0IG51bUNvbXBvbmVudHMgPSB0aGlzLmNvbXBvbmVudHMubGVuZ3RoOwogICAgY29uc3QgZGF0YUxlbmd0aCA9IHdpZHRoICogaGVpZ2h0ICogbnVtQ29tcG9uZW50czsKICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoZGF0YUxlbmd0aCk7CiAgICBjb25zdCB4U2NhbGVCbG9ja09mZnNldCA9IG5ldyBVaW50MzJBcnJheSh3aWR0aCk7CiAgICBjb25zdCBtYXNrM0xTQiA9IDB4ZmZmZmZmZjg7CiAgICBsZXQgbGFzdENvbXBvbmVudFNjYWxlWDsKICAgIGZvciAoaSA9IDA7IGkgPCBudW1Db21wb25lbnRzOyBpKyspIHsKICAgICAgY29tcG9uZW50ID0gdGhpcy5jb21wb25lbnRzW2ldOwogICAgICBjb21wb25lbnRTY2FsZVggPSBjb21wb25lbnQuc2NhbGVYICogc2NhbGVYOwogICAgICBjb21wb25lbnRTY2FsZVkgPSBjb21wb25lbnQuc2NhbGVZICogc2NhbGVZOwogICAgICBvZmZzZXQgPSBpOwogICAgICBvdXRwdXQgPSBjb21wb25lbnQub3V0cHV0OwogICAgICBibG9ja3NQZXJTY2FubGluZSA9IGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lICsgMSA8PCAzOwogICAgICBpZiAoY29tcG9uZW50U2NhbGVYICE9PSBsYXN0Q29tcG9uZW50U2NhbGVYKSB7CiAgICAgICAgZm9yICh4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHsKICAgICAgICAgIGogPSAwIHwgeCAqIGNvbXBvbmVudFNjYWxlWDsKICAgICAgICAgIHhTY2FsZUJsb2NrT2Zmc2V0W3hdID0gKGogJiBtYXNrM0xTQikgPDwgMyB8IGogJiA3OwogICAgICAgIH0KICAgICAgICBsYXN0Q29tcG9uZW50U2NhbGVYID0gY29tcG9uZW50U2NhbGVYOwogICAgICB9CiAgICAgIGZvciAoeSA9IDA7IHkgPCBoZWlnaHQ7IHkrKykgewogICAgICAgIGogPSAwIHwgeSAqIGNvbXBvbmVudFNjYWxlWTsKICAgICAgICBpbmRleCA9IGJsb2Nrc1BlclNjYW5saW5lICogKGogJiBtYXNrM0xTQikgfCAoaiAmIDcpIDw8IDM7CiAgICAgICAgZm9yICh4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHsKICAgICAgICAgIGRhdGFbb2Zmc2V0XSA9IG91dHB1dFtpbmRleCArIHhTY2FsZUJsb2NrT2Zmc2V0W3hdXTsKICAgICAgICAgIG9mZnNldCArPSBudW1Db21wb25lbnRzOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbGV0IHRyYW5zZm9ybSA9IHRoaXMuX2RlY29kZVRyYW5zZm9ybTsKICAgIGlmICghaXNTb3VyY2VQREYgJiYgbnVtQ29tcG9uZW50cyA9PT0gNCAmJiAhdHJhbnNmb3JtKSB7CiAgICAgIHRyYW5zZm9ybSA9IG5ldyBJbnQzMkFycmF5KFstMjU2LCAyNTUsIC0yNTYsIDI1NSwgLTI1NiwgMjU1LCAtMjU2LCAyNTVdKTsKICAgIH0KICAgIGlmICh0cmFuc2Zvcm0pIHsKICAgICAgZm9yIChpID0gMDsgaSA8IGRhdGFMZW5ndGg7KSB7CiAgICAgICAgZm9yIChqID0gMCwgayA9IDA7IGogPCBudW1Db21wb25lbnRzOyBqKyssIGkrKywgayArPSAyKSB7CiAgICAgICAgICBkYXRhW2ldID0gKGRhdGFbaV0gKiB0cmFuc2Zvcm1ba10gPj4gOCkgKyB0cmFuc2Zvcm1bayArIDFdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7CiAgfQogIGdldCBfaXNDb2xvckNvbnZlcnNpb25OZWVkZWQoKSB7CiAgICBpZiAodGhpcy5hZG9iZSkgewogICAgICByZXR1cm4gISF0aGlzLmFkb2JlLnRyYW5zZm9ybUNvZGU7CiAgICB9CiAgICBpZiAodGhpcy5udW1Db21wb25lbnRzID09PSAzKSB7CiAgICAgIGlmICh0aGlzLl9jb2xvclRyYW5zZm9ybSA9PT0gMCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbXBvbmVudHNbMF0uaW5kZXggPT09IDB4NTIgJiYgdGhpcy5jb21wb25lbnRzWzFdLmluZGV4ID09PSAweDQ3ICYmIHRoaXMuY29tcG9uZW50c1syXS5pbmRleCA9PT0gMHg0MikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmICh0aGlzLl9jb2xvclRyYW5zZm9ybSA9PT0gMSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgX2NvbnZlcnRZY2NUb1JnYihkYXRhKSB7CiAgICBsZXQgWSwgQ2IsIENyOwogICAgZm9yIChsZXQgaSA9IDAsIGxlbmd0aCA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpICs9IDMpIHsKICAgICAgWSA9IGRhdGFbaV07CiAgICAgIENiID0gZGF0YVtpICsgMV07CiAgICAgIENyID0gZGF0YVtpICsgMl07CiAgICAgIGRhdGFbaV0gPSBZIC0gMTc5LjQ1NiArIDEuNDAyICogQ3I7CiAgICAgIGRhdGFbaSArIDFdID0gWSArIDEzNS40NTkgLSAwLjM0NCAqIENiIC0gMC43MTQgKiBDcjsKICAgICAgZGF0YVtpICsgMl0gPSBZIC0gMjI2LjgxNiArIDEuNzcyICogQ2I7CiAgICB9CiAgICByZXR1cm4gZGF0YTsKICB9CiAgX2NvbnZlcnRZY2NUb1JnYmEoZGF0YSwgb3V0KSB7CiAgICBmb3IgKGxldCBpID0gMCwgaiA9IDAsIGxlbmd0aCA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpICs9IDMsIGogKz0gNCkgewogICAgICBjb25zdCBZID0gZGF0YVtpXTsKICAgICAgY29uc3QgQ2IgPSBkYXRhW2kgKyAxXTsKICAgICAgY29uc3QgQ3IgPSBkYXRhW2kgKyAyXTsKICAgICAgb3V0W2pdID0gWSAtIDE3OS40NTYgKyAxLjQwMiAqIENyOwogICAgICBvdXRbaiArIDFdID0gWSArIDEzNS40NTkgLSAwLjM0NCAqIENiIC0gMC43MTQgKiBDcjsKICAgICAgb3V0W2ogKyAyXSA9IFkgLSAyMjYuODE2ICsgMS43NzIgKiBDYjsKICAgICAgb3V0W2ogKyAzXSA9IDI1NTsKICAgIH0KICAgIHJldHVybiBvdXQ7CiAgfQogIF9jb252ZXJ0WWNja1RvUmdiKGRhdGEpIHsKICAgIHRoaXMuX2NvbnZlcnRZY2NrVG9DbXlrKGRhdGEpOwogICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRDbXlrVG9SZ2IoZGF0YSk7CiAgfQogIF9jb252ZXJ0WWNja1RvUmdiYShkYXRhKSB7CiAgICB0aGlzLl9jb252ZXJ0WWNja1RvQ215ayhkYXRhKTsKICAgIHJldHVybiB0aGlzLl9jb252ZXJ0Q215a1RvUmdiYShkYXRhKTsKICB9CiAgX2NvbnZlcnRZY2NrVG9DbXlrKGRhdGEpIHsKICAgIGxldCBZLCBDYiwgQ3I7CiAgICBmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gZGF0YS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkgKz0gNCkgewogICAgICBZID0gZGF0YVtpXTsKICAgICAgQ2IgPSBkYXRhW2kgKyAxXTsKICAgICAgQ3IgPSBkYXRhW2kgKyAyXTsKICAgICAgZGF0YVtpXSA9IDQzNC40NTYgLSBZIC0gMS40MDIgKiBDcjsKICAgICAgZGF0YVtpICsgMV0gPSAxMTkuNTQxIC0gWSArIDAuMzQ0ICogQ2IgKyAwLjcxNCAqIENyOwogICAgICBkYXRhW2kgKyAyXSA9IDQ4MS44MTYgLSBZIC0gMS43NzIgKiBDYjsKICAgIH0KICAgIHJldHVybiBkYXRhOwogIH0KICBfY29udmVydENteWtUb1JnYihkYXRhKSB7CiAgICBjb25zdCBjb3VudCA9IGRhdGEubGVuZ3RoIC8gNDsKICAgIENvbG9yU3BhY2VVdGlscy5jbXlrLmdldFJnYkJ1ZmZlcihkYXRhLCAwLCBjb3VudCwgZGF0YSwgMCwgOCwgMCk7CiAgICByZXR1cm4gZGF0YS5zdWJhcnJheSgwLCBjb3VudCAqIDMpOwogIH0KICBfY29udmVydENteWtUb1JnYmEoZGF0YSkgewogICAgQ29sb3JTcGFjZVV0aWxzLmNteWsuZ2V0UmdiQnVmZmVyKGRhdGEsIDAsIGRhdGEubGVuZ3RoIC8gNCwgZGF0YSwgMCwgOCwgMSk7CiAgICBpZiAoQ29sb3JTcGFjZVV0aWxzLmNteWsgaW5zdGFuY2VvZiBEZXZpY2VDbXlrQ1MpIHsKICAgICAgZm9yIChsZXQgaSA9IDMsIGlpID0gZGF0YS5sZW5ndGg7IGkgPCBpaTsgaSArPSA0KSB7CiAgICAgICAgZGF0YVtpXSA9IDI1NTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7CiAgfQogIGdldERhdGEoewogICAgd2lkdGgsCiAgICBoZWlnaHQsCiAgICBmb3JjZVJHQkEgPSBmYWxzZSwKICAgIGZvcmNlUkdCID0gZmFsc2UsCiAgICBpc1NvdXJjZVBERiA9IGZhbHNlCiAgfSkgewogICAgaWYgKHRoaXMubnVtQ29tcG9uZW50cyA+IDQpIHsKICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiVW5zdXBwb3J0ZWQgY29sb3IgbW9kZSIpOwogICAgfQogICAgY29uc3QgZGF0YSA9IHRoaXMuX2dldExpbmVhcml6ZWRCbG9ja0RhdGEod2lkdGgsIGhlaWdodCwgaXNTb3VyY2VQREYpOwogICAgaWYgKHRoaXMubnVtQ29tcG9uZW50cyA9PT0gMSAmJiAoZm9yY2VSR0JBIHx8IGZvcmNlUkdCKSkgewogICAgICBjb25zdCBsZW4gPSBkYXRhLmxlbmd0aCAqIChmb3JjZVJHQkEgPyA0IDogMyk7CiAgICAgIGNvbnN0IHJnYmFEYXRhID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGxlbik7CiAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICBpZiAoZm9yY2VSR0JBKSB7CiAgICAgICAgZ3JheVRvUkdCQShkYXRhLCBuZXcgVWludDMyQXJyYXkocmdiYURhdGEuYnVmZmVyKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChjb25zdCBncmF5Q29sb3Igb2YgZGF0YSkgewogICAgICAgICAgcmdiYURhdGFbb2Zmc2V0KytdID0gZ3JheUNvbG9yOwogICAgICAgICAgcmdiYURhdGFbb2Zmc2V0KytdID0gZ3JheUNvbG9yOwogICAgICAgICAgcmdiYURhdGFbb2Zmc2V0KytdID0gZ3JheUNvbG9yOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmdiYURhdGE7CiAgICB9IGVsc2UgaWYgKHRoaXMubnVtQ29tcG9uZW50cyA9PT0gMyAmJiB0aGlzLl9pc0NvbG9yQ29udmVyc2lvbk5lZWRlZCkgewogICAgICBpZiAoZm9yY2VSR0JBKSB7CiAgICAgICAgY29uc3QgcmdiYURhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoZGF0YS5sZW5ndGggLyAzICogNCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRZY2NUb1JnYmEoZGF0YSwgcmdiYURhdGEpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl9jb252ZXJ0WWNjVG9SZ2IoZGF0YSk7CiAgICB9IGVsc2UgaWYgKHRoaXMubnVtQ29tcG9uZW50cyA9PT0gNCkgewogICAgICBpZiAodGhpcy5faXNDb2xvckNvbnZlcnNpb25OZWVkZWQpIHsKICAgICAgICBpZiAoZm9yY2VSR0JBKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydFljY2tUb1JnYmEoZGF0YSk7CiAgICAgICAgfQogICAgICAgIGlmIChmb3JjZVJHQikgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRZY2NrVG9SZ2IoZGF0YSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLl9jb252ZXJ0WWNja1RvQ215ayhkYXRhKTsKICAgICAgfSBlbHNlIGlmIChmb3JjZVJHQkEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydENteWtUb1JnYmEoZGF0YSk7CiAgICAgIH0gZWxzZSBpZiAoZm9yY2VSR0IpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydENteWtUb1JnYihkYXRhKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9qcGVnX3N0cmVhbS5qcwoKCgoKY2xhc3MgSnBlZ1N0cmVhbSBleHRlbmRzIERlY29kZVN0cmVhbSB7CiAgc3RhdGljICNpc0ltYWdlRGVjb2RlclN1cHBvcnRlZCA9IEZlYXR1cmVUZXN0LmlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkOwogIGNvbnN0cnVjdG9yKHN0cmVhbSwgbWF5YmVMZW5ndGgsIHBhcmFtcykgewogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07CiAgICB0aGlzLmRpY3QgPSBzdHJlYW0uZGljdDsKICAgIHRoaXMubWF5YmVMZW5ndGggPSBtYXliZUxlbmd0aDsKICAgIHRoaXMucGFyYW1zID0gcGFyYW1zOwogIH0KICBzdGF0aWMgZ2V0IGNhblVzZUltYWdlRGVjb2RlcigpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImNhblVzZUltYWdlRGVjb2RlciIsIHRoaXMuI2lzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkID8gSW1hZ2VEZWNvZGVyLmlzVHlwZVN1cHBvcnRlZCgiaW1hZ2UvanBlZyIpIDogUHJvbWlzZS5yZXNvbHZlKGZhbHNlKSk7CiAgfQogIHN0YXRpYyBzZXRPcHRpb25zKHsKICAgIGlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkID0gZmFsc2UKICB9KSB7CiAgICB0aGlzLiNpc0ltYWdlRGVjb2RlclN1cHBvcnRlZCA9IGlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkOwogIH0KICBnZXQgYnl0ZXMoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJieXRlcyIsIHRoaXMuc3RyZWFtLmdldEJ5dGVzKHRoaXMubWF5YmVMZW5ndGgpKTsKICB9CiAgZW5zdXJlQnVmZmVyKHJlcXVlc3RlZCkge30KICByZWFkQmxvY2soKSB7CiAgICB0aGlzLmRlY29kZUltYWdlKCk7CiAgfQogIGdldCBqcGVnT3B0aW9ucygpIHsKICAgIGNvbnN0IGpwZWdPcHRpb25zID0gewogICAgICBkZWNvZGVUcmFuc2Zvcm06IHVuZGVmaW5lZCwKICAgICAgY29sb3JUcmFuc2Zvcm06IHVuZGVmaW5lZAogICAgfTsKICAgIGNvbnN0IGRlY29kZUFyciA9IHRoaXMuZGljdC5nZXRBcnJheSgiRCIsICJEZWNvZGUiKTsKICAgIGlmICgodGhpcy5mb3JjZVJHQkEgfHwgdGhpcy5mb3JjZVJHQikgJiYgQXJyYXkuaXNBcnJheShkZWNvZGVBcnIpKSB7CiAgICAgIGNvbnN0IGJpdHNQZXJDb21wb25lbnQgPSB0aGlzLmRpY3QuZ2V0KCJCUEMiLCAiQml0c1BlckNvbXBvbmVudCIpIHx8IDg7CiAgICAgIGNvbnN0IGRlY29kZUFyckxlbmd0aCA9IGRlY29kZUFyci5sZW5ndGg7CiAgICAgIGNvbnN0IHRyYW5zZm9ybSA9IG5ldyBJbnQzMkFycmF5KGRlY29kZUFyckxlbmd0aCk7CiAgICAgIGxldCB0cmFuc2Zvcm1OZWVkZWQgPSBmYWxzZTsKICAgICAgY29uc3QgbWF4VmFsdWUgPSAoMSA8PCBiaXRzUGVyQ29tcG9uZW50KSAtIDE7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGVjb2RlQXJyTGVuZ3RoOyBpICs9IDIpIHsKICAgICAgICB0cmFuc2Zvcm1baV0gPSAoZGVjb2RlQXJyW2kgKyAxXSAtIGRlY29kZUFycltpXSkgKiAyNTYgfCAwOwogICAgICAgIHRyYW5zZm9ybVtpICsgMV0gPSBkZWNvZGVBcnJbaV0gKiBtYXhWYWx1ZSB8IDA7CiAgICAgICAgaWYgKHRyYW5zZm9ybVtpXSAhPT0gMjU2IHx8IHRyYW5zZm9ybVtpICsgMV0gIT09IDApIHsKICAgICAgICAgIHRyYW5zZm9ybU5lZWRlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0cmFuc2Zvcm1OZWVkZWQpIHsKICAgICAgICBqcGVnT3B0aW9ucy5kZWNvZGVUcmFuc2Zvcm0gPSB0cmFuc2Zvcm07CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzLnBhcmFtcyBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgY29uc3QgY29sb3JUcmFuc2Zvcm0gPSB0aGlzLnBhcmFtcy5nZXQoIkNvbG9yVHJhbnNmb3JtIik7CiAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGNvbG9yVHJhbnNmb3JtKSkgewogICAgICAgIGpwZWdPcHRpb25zLmNvbG9yVHJhbnNmb3JtID0gY29sb3JUcmFuc2Zvcm07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImpwZWdPcHRpb25zIiwganBlZ09wdGlvbnMpOwogIH0KICAjc2tpcFVzZWxlc3NCeXRlcyhkYXRhKSB7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBkYXRhLmxlbmd0aCAtIDE7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGlmIChkYXRhW2ldID09PSAweGZmICYmIGRhdGFbaSArIDFdID09PSAweGQ4KSB7CiAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICBkYXRhID0gZGF0YS5zdWJhcnJheShpKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkYXRhOwogIH0KICBkZWNvZGVJbWFnZShieXRlcykgewogICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgIHJldHVybiB0aGlzLmJ1ZmZlcjsKICAgIH0KICAgIGJ5dGVzID0gdGhpcy4jc2tpcFVzZWxlc3NCeXRlcyhieXRlcyB8fCB0aGlzLmJ5dGVzKTsKICAgIGNvbnN0IGpwZWdJbWFnZSA9IG5ldyBKcGVnSW1hZ2UodGhpcy5qcGVnT3B0aW9ucyk7CiAgICBqcGVnSW1hZ2UucGFyc2UoYnl0ZXMpOwogICAgY29uc3QgZGF0YSA9IGpwZWdJbWFnZS5nZXREYXRhKHsKICAgICAgd2lkdGg6IHRoaXMuZHJhd1dpZHRoLAogICAgICBoZWlnaHQ6IHRoaXMuZHJhd0hlaWdodCwKICAgICAgZm9yY2VSR0JBOiB0aGlzLmZvcmNlUkdCQSwKICAgICAgZm9yY2VSR0I6IHRoaXMuZm9yY2VSR0IsCiAgICAgIGlzU291cmNlUERGOiB0cnVlCiAgICB9KTsKICAgIHRoaXMuYnVmZmVyID0gZGF0YTsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gZGF0YS5sZW5ndGg7CiAgICB0aGlzLmVvZiA9IHRydWU7CiAgICByZXR1cm4gdGhpcy5idWZmZXI7CiAgfQogIGdldCBjYW5Bc3luY0RlY29kZUltYWdlRnJvbUJ1ZmZlcigpIHsKICAgIHJldHVybiB0aGlzLnN0cmVhbS5pc0FzeW5jOwogIH0KICBhc3luYyBnZXRUcmFuc2ZlcmFibGVJbWFnZSgpIHsKICAgIGlmICghKGF3YWl0IEpwZWdTdHJlYW0uY2FuVXNlSW1hZ2VEZWNvZGVyKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IGpwZWdPcHRpb25zID0gdGhpcy5qcGVnT3B0aW9uczsKICAgIGlmIChqcGVnT3B0aW9ucy5kZWNvZGVUcmFuc2Zvcm0pIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBsZXQgZGVjb2RlcjsKICAgIHRyeSB7CiAgICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5jYW5Bc3luY0RlY29kZUltYWdlRnJvbUJ1ZmZlciAmJiAoYXdhaXQgdGhpcy5zdHJlYW0uYXN5bmNHZXRCeXRlcygpKSB8fCB0aGlzLmJ5dGVzOwogICAgICBpZiAoIWJ5dGVzKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgbGV0IGRhdGEgPSB0aGlzLiNza2lwVXNlbGVzc0J5dGVzKGJ5dGVzKTsKICAgICAgY29uc3QgdXNlSW1hZ2VEZWNvZGVyID0gSnBlZ0ltYWdlLmNhblVzZUltYWdlRGVjb2RlcihkYXRhLCBqcGVnT3B0aW9ucy5jb2xvclRyYW5zZm9ybSk7CiAgICAgIGlmICghdXNlSW1hZ2VEZWNvZGVyKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKHVzZUltYWdlRGVjb2Rlci5leGlmU3RhcnQpIHsKICAgICAgICBkYXRhID0gZGF0YS5zbGljZSgpOwogICAgICAgIGRhdGEuZmlsbCgweDAwLCB1c2VJbWFnZURlY29kZXIuZXhpZlN0YXJ0LCB1c2VJbWFnZURlY29kZXIuZXhpZkVuZCk7CiAgICAgIH0KICAgICAgZGVjb2RlciA9IG5ldyBJbWFnZURlY29kZXIoewogICAgICAgIGRhdGEsCiAgICAgICAgdHlwZTogImltYWdlL2pwZWciLAogICAgICAgIHByZWZlckFuaW1hdGlvbjogZmFsc2UKICAgICAgfSk7CiAgICAgIHJldHVybiAoYXdhaXQgZGVjb2Rlci5kZWNvZGUoKSkuaW1hZ2U7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgd2FybihgZ2V0VHJhbnNmZXJhYmxlSW1hZ2UgLSBmYWlsZWQ6ICIke3JlYXNvbn0iLmApOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0gZmluYWxseSB7CiAgICAgIGRlY29kZXI/LmNsb3NlKCk7CiAgICB9CiAgfQp9Cgo7Ly8gLi9leHRlcm5hbC9vcGVuanBlZy9vcGVuanBlZy5qcwp2YXIgT3BlbkpQRUcgPSAoKCkgPT4gewogIHJldHVybiBhc3luYyBmdW5jdGlvbiAobW9kdWxlQXJnID0ge30pIHsKICAgIHZhciBtb2R1bGVSdG47CiAgICB2YXIgTW9kdWxlID0gbW9kdWxlQXJnOwogICAgdmFyIHJlYWR5UHJvbWlzZVJlc29sdmUsIHJlYWR5UHJvbWlzZVJlamVjdDsKICAgIHZhciByZWFkeVByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIHJlYWR5UHJvbWlzZVJlc29sdmUgPSByZXNvbHZlOwogICAgICByZWFkeVByb21pc2VSZWplY3QgPSByZWplY3Q7CiAgICB9KTsKICAgIHZhciBFTlZJUk9OTUVOVF9JU19XRUIgPSB0cnVlOwogICAgdmFyIEVOVklST05NRU5UX0lTX1dPUktFUiA9IGZhbHNlOwogICAgdmFyIGFyZ3VtZW50c18gPSBbXTsKICAgIHZhciB0aGlzUHJvZ3JhbSA9ICIuL3RoaXMucHJvZ3JhbSI7CiAgICB2YXIgcXVpdF8gPSAoc3RhdHVzLCB0b1Rocm93KSA9PiB7CiAgICAgIHRocm93IHRvVGhyb3c7CiAgICB9OwogICAgdmFyIF9zY3JpcHROYW1lID0gaW1wb3J0Lm1ldGEudXJsOwogICAgdmFyIHNjcmlwdERpcmVjdG9yeSA9ICIiOwogICAgdmFyIHJlYWRBc3luYywgcmVhZEJpbmFyeTsKICAgIGlmIChFTlZJUk9OTUVOVF9JU19XRUIgfHwgRU5WSVJPTk1FTlRfSVNfV09SS0VSKSB7CiAgICAgIHRyeSB7CiAgICAgICAgc2NyaXB0RGlyZWN0b3J5ID0gbmV3IFVSTCgiLiIsIF9zY3JpcHROYW1lKS5ocmVmOwogICAgICB9IGNhdGNoIHt9CiAgICAgIHJlYWRBc3luYyA9IGFzeW5jIHVybCA9PiB7CiAgICAgICAgdmFyIHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7CiAgICAgICAgICBjcmVkZW50aWFsczogInNhbWUtb3JpZ2luIgogICAgICAgIH0pOwogICAgICAgIGlmIChyZXNwb25zZS5vaykgewogICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmFycmF5QnVmZmVyKCk7CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBFcnJvcihyZXNwb25zZS5zdGF0dXMgKyAiIDogIiArIHJlc3BvbnNlLnVybCk7CiAgICAgIH07CiAgICB9IGVsc2Uge30KICAgIHZhciBvdXQgPSBjb25zb2xlLmxvZy5iaW5kKGNvbnNvbGUpOwogICAgdmFyIGVyciA9IGNvbnNvbGUuZXJyb3IuYmluZChjb25zb2xlKTsKICAgIHZhciB3YXNtQmluYXJ5OwogICAgdmFyIHdhc21NZW1vcnk7CiAgICB2YXIgQUJPUlQgPSBmYWxzZTsKICAgIHZhciBFWElUU1RBVFVTOwogICAgdmFyIEhFQVA4LCBIRUFQVTgsIEhFQVAxNiwgSEVBUFUxNiwgSEVBUDMyLCBIRUFQVTMyLCBIRUFQRjMyLCBIRUFQNjQsIEhFQVBVNjQsIEhFQVBGNjQ7CiAgICB2YXIgcnVudGltZUluaXRpYWxpemVkID0gZmFsc2U7CiAgICBmdW5jdGlvbiB1cGRhdGVNZW1vcnlWaWV3cygpIHsKICAgICAgdmFyIGIgPSB3YXNtTWVtb3J5LmJ1ZmZlcjsKICAgICAgSEVBUDggPSBuZXcgSW50OEFycmF5KGIpOwogICAgICBIRUFQMTYgPSBuZXcgSW50MTZBcnJheShiKTsKICAgICAgSEVBUFU4ID0gbmV3IFVpbnQ4QXJyYXkoYik7CiAgICAgIEhFQVBVMTYgPSBuZXcgVWludDE2QXJyYXkoYik7CiAgICAgIEhFQVAzMiA9IG5ldyBJbnQzMkFycmF5KGIpOwogICAgICBIRUFQVTMyID0gbmV3IFVpbnQzMkFycmF5KGIpOwogICAgICBIRUFQRjMyID0gbmV3IEZsb2F0MzJBcnJheShiKTsKICAgICAgSEVBUEY2NCA9IG5ldyBGbG9hdDY0QXJyYXkoYik7CiAgICAgIEhFQVA2NCA9IG5ldyBCaWdJbnQ2NEFycmF5KGIpOwogICAgICBIRUFQVTY0ID0gbmV3IEJpZ1VpbnQ2NEFycmF5KGIpOwogICAgfQogICAgZnVuY3Rpb24gcHJlUnVuKCkgewogICAgICBpZiAoTW9kdWxlWyJwcmVSdW4iXSkgewogICAgICAgIGlmICh0eXBlb2YgTW9kdWxlWyJwcmVSdW4iXSA9PSAiZnVuY3Rpb24iKSBNb2R1bGVbInByZVJ1biJdID0gW01vZHVsZVsicHJlUnVuIl1dOwogICAgICAgIHdoaWxlIChNb2R1bGVbInByZVJ1biJdLmxlbmd0aCkgewogICAgICAgICAgYWRkT25QcmVSdW4oTW9kdWxlWyJwcmVSdW4iXS5zaGlmdCgpKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY2FsbFJ1bnRpbWVDYWxsYmFja3Mob25QcmVSdW5zKTsKICAgIH0KICAgIGZ1bmN0aW9uIGluaXRSdW50aW1lKCkgewogICAgICBydW50aW1lSW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICB3YXNtRXhwb3J0c1sidCJdKCk7CiAgICB9CiAgICBmdW5jdGlvbiBwb3N0UnVuKCkgewogICAgICBpZiAoTW9kdWxlWyJwb3N0UnVuIl0pIHsKICAgICAgICBpZiAodHlwZW9mIE1vZHVsZVsicG9zdFJ1biJdID09ICJmdW5jdGlvbiIpIE1vZHVsZVsicG9zdFJ1biJdID0gW01vZHVsZVsicG9zdFJ1biJdXTsKICAgICAgICB3aGlsZSAoTW9kdWxlWyJwb3N0UnVuIl0ubGVuZ3RoKSB7CiAgICAgICAgICBhZGRPblBvc3RSdW4oTW9kdWxlWyJwb3N0UnVuIl0uc2hpZnQoKSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNhbGxSdW50aW1lQ2FsbGJhY2tzKG9uUG9zdFJ1bnMpOwogICAgfQogICAgdmFyIHJ1bkRlcGVuZGVuY2llcyA9IDA7CiAgICB2YXIgZGVwZW5kZW5jaWVzRnVsZmlsbGVkID0gbnVsbDsKICAgIGZ1bmN0aW9uIGFkZFJ1bkRlcGVuZGVuY3koaWQpIHsKICAgICAgcnVuRGVwZW5kZW5jaWVzKys7CiAgICAgIE1vZHVsZVsibW9uaXRvclJ1bkRlcGVuZGVuY2llcyJdPy4ocnVuRGVwZW5kZW5jaWVzKTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlbW92ZVJ1bkRlcGVuZGVuY3koaWQpIHsKICAgICAgcnVuRGVwZW5kZW5jaWVzLS07CiAgICAgIE1vZHVsZVsibW9uaXRvclJ1bkRlcGVuZGVuY2llcyJdPy4ocnVuRGVwZW5kZW5jaWVzKTsKICAgICAgaWYgKHJ1bkRlcGVuZGVuY2llcyA9PSAwKSB7CiAgICAgICAgaWYgKGRlcGVuZGVuY2llc0Z1bGZpbGxlZCkgewogICAgICAgICAgdmFyIGNhbGxiYWNrID0gZGVwZW5kZW5jaWVzRnVsZmlsbGVkOwogICAgICAgICAgZGVwZW5kZW5jaWVzRnVsZmlsbGVkID0gbnVsbDsKICAgICAgICAgIGNhbGxiYWNrKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBhYm9ydCh3aGF0KSB7CiAgICAgIE1vZHVsZVsib25BYm9ydCJdPy4od2hhdCk7CiAgICAgIHdoYXQgPSAiQWJvcnRlZCgiICsgd2hhdCArICIpIjsKICAgICAgZXJyKHdoYXQpOwogICAgICBBQk9SVCA9IHRydWU7CiAgICAgIHdoYXQgKz0gIi4gQnVpbGQgd2l0aCAtc0FTU0VSVElPTlMgZm9yIG1vcmUgaW5mby4iOwogICAgICB2YXIgZSA9IG5ldyBXZWJBc3NlbWJseS5SdW50aW1lRXJyb3Iod2hhdCk7CiAgICAgIHJlYWR5UHJvbWlzZVJlamVjdChlKTsKICAgICAgdGhyb3cgZTsKICAgIH0KICAgIHZhciB3YXNtQmluYXJ5RmlsZTsKICAgIGZ1bmN0aW9uIGdldFdhc21JbXBvcnRzKCkgewogICAgICByZXR1cm4gewogICAgICAgIGE6IHdhc21JbXBvcnRzCiAgICAgIH07CiAgICB9CiAgICBhc3luYyBmdW5jdGlvbiBjcmVhdGVXYXNtKCkgewogICAgICBmdW5jdGlvbiByZWNlaXZlSW5zdGFuY2UoaW5zdGFuY2UsIG1vZHVsZSkgewogICAgICAgIHdhc21FeHBvcnRzID0gaW5zdGFuY2UuZXhwb3J0czsKICAgICAgICB3YXNtTWVtb3J5ID0gd2FzbUV4cG9ydHNbInMiXTsKICAgICAgICB1cGRhdGVNZW1vcnlWaWV3cygpOwogICAgICAgIHJlbW92ZVJ1bkRlcGVuZGVuY3koIndhc20taW5zdGFudGlhdGUiKTsKICAgICAgICByZXR1cm4gd2FzbUV4cG9ydHM7CiAgICAgIH0KICAgICAgYWRkUnVuRGVwZW5kZW5jeSgid2FzbS1pbnN0YW50aWF0ZSIpOwogICAgICB2YXIgaW5mbyA9IGdldFdhc21JbXBvcnRzKCk7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgTW9kdWxlWyJpbnN0YW50aWF0ZVdhc20iXShpbmZvLCAobW9kLCBpbnN0KSA9PiB7CiAgICAgICAgICByZXNvbHZlKHJlY2VpdmVJbnN0YW5jZShtb2QsIGluc3QpKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICBjbGFzcyBFeGl0U3RhdHVzIHsKICAgICAgbmFtZSA9ICJFeGl0U3RhdHVzIjsKICAgICAgY29uc3RydWN0b3Ioc3RhdHVzKSB7CiAgICAgICAgdGhpcy5tZXNzYWdlID0gYFByb2dyYW0gdGVybWluYXRlZCB3aXRoIGV4aXQoJHtzdGF0dXN9KWA7CiAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7CiAgICAgIH0KICAgIH0KICAgIHZhciBjYWxsUnVudGltZUNhbGxiYWNrcyA9IGNhbGxiYWNrcyA9PiB7CiAgICAgIHdoaWxlIChjYWxsYmFja3MubGVuZ3RoID4gMCkgewogICAgICAgIGNhbGxiYWNrcy5zaGlmdCgpKE1vZHVsZSk7CiAgICAgIH0KICAgIH07CiAgICB2YXIgb25Qb3N0UnVucyA9IFtdOwogICAgdmFyIGFkZE9uUG9zdFJ1biA9IGNiID0+IG9uUG9zdFJ1bnMucHVzaChjYik7CiAgICB2YXIgb25QcmVSdW5zID0gW107CiAgICB2YXIgYWRkT25QcmVSdW4gPSBjYiA9PiBvblByZVJ1bnMucHVzaChjYik7CiAgICB2YXIgbm9FeGl0UnVudGltZSA9IHRydWU7CiAgICB2YXIgX19hYm9ydF9qcyA9ICgpID0+IGFib3J0KCIiKTsKICAgIHZhciBydW50aW1lS2VlcGFsaXZlQ291bnRlciA9IDA7CiAgICB2YXIgX19lbXNjcmlwdGVuX3J1bnRpbWVfa2VlcGFsaXZlX2NsZWFyID0gKCkgPT4gewogICAgICBub0V4aXRSdW50aW1lID0gZmFsc2U7CiAgICAgIHJ1bnRpbWVLZWVwYWxpdmVDb3VudGVyID0gMDsKICAgIH07CiAgICB2YXIgdGltZXJzID0ge307CiAgICB2YXIgaGFuZGxlRXhjZXB0aW9uID0gZSA9PiB7CiAgICAgIGlmIChlIGluc3RhbmNlb2YgRXhpdFN0YXR1cyB8fCBlID09ICJ1bndpbmQiKSB7CiAgICAgICAgcmV0dXJuIEVYSVRTVEFUVVM7CiAgICAgIH0KICAgICAgcXVpdF8oMSwgZSk7CiAgICB9OwogICAgdmFyIGtlZXBSdW50aW1lQWxpdmUgPSAoKSA9PiBub0V4aXRSdW50aW1lIHx8IHJ1bnRpbWVLZWVwYWxpdmVDb3VudGVyID4gMDsKICAgIHZhciBfcHJvY19leGl0ID0gY29kZSA9PiB7CiAgICAgIEVYSVRTVEFUVVMgPSBjb2RlOwogICAgICBpZiAoIWtlZXBSdW50aW1lQWxpdmUoKSkgewogICAgICAgIE1vZHVsZVsib25FeGl0Il0/Lihjb2RlKTsKICAgICAgICBBQk9SVCA9IHRydWU7CiAgICAgIH0KICAgICAgcXVpdF8oY29kZSwgbmV3IEV4aXRTdGF0dXMoY29kZSkpOwogICAgfTsKICAgIHZhciBleGl0SlMgPSAoc3RhdHVzLCBpbXBsaWNpdCkgPT4gewogICAgICBFWElUU1RBVFVTID0gc3RhdHVzOwogICAgICBfcHJvY19leGl0KHN0YXR1cyk7CiAgICB9OwogICAgdmFyIF9leGl0ID0gZXhpdEpTOwogICAgdmFyIG1heWJlRXhpdCA9ICgpID0+IHsKICAgICAgaWYgKCFrZWVwUnVudGltZUFsaXZlKCkpIHsKICAgICAgICB0cnkgewogICAgICAgICAgX2V4aXQoRVhJVFNUQVRVUyk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgaGFuZGxlRXhjZXB0aW9uKGUpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIHZhciBjYWxsVXNlckNhbGxiYWNrID0gZnVuYyA9PiB7CiAgICAgIGlmIChBQk9SVCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIGZ1bmMoKTsKICAgICAgICBtYXliZUV4aXQoKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGhhbmRsZUV4Y2VwdGlvbihlKTsKICAgICAgfQogICAgfTsKICAgIHZhciBfZW1zY3JpcHRlbl9nZXRfbm93ID0gKCkgPT4gcGVyZm9ybWFuY2Uubm93KCk7CiAgICB2YXIgX19zZXRpdGltZXJfanMgPSAod2hpY2gsIHRpbWVvdXRfbXMpID0+IHsKICAgICAgaWYgKHRpbWVyc1t3aGljaF0pIHsKICAgICAgICBjbGVhclRpbWVvdXQodGltZXJzW3doaWNoXS5pZCk7CiAgICAgICAgZGVsZXRlIHRpbWVyc1t3aGljaF07CiAgICAgIH0KICAgICAgaWYgKCF0aW1lb3V0X21zKSByZXR1cm4gMDsKICAgICAgdmFyIGlkID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgZGVsZXRlIHRpbWVyc1t3aGljaF07CiAgICAgICAgY2FsbFVzZXJDYWxsYmFjaygoKSA9PiBfX2Vtc2NyaXB0ZW5fdGltZW91dCh3aGljaCwgX2Vtc2NyaXB0ZW5fZ2V0X25vdygpKSk7CiAgICAgIH0sIHRpbWVvdXRfbXMpOwogICAgICB0aW1lcnNbd2hpY2hdID0gewogICAgICAgIGlkLAogICAgICAgIHRpbWVvdXRfbXMKICAgICAgfTsKICAgICAgcmV0dXJuIDA7CiAgICB9OwogICAgZnVuY3Rpb24gX2NvcHlfcGl4ZWxzXzEoY29tcEdfcHRyLCBuYl9waXhlbHMpIHsKICAgICAgY29tcEdfcHRyID4+PSAyOwogICAgICBjb25zdCBpbWFnZURhdGEgPSBNb2R1bGUuaW1hZ2VEYXRhID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KG5iX3BpeGVscyk7CiAgICAgIGNvbnN0IGNvbXBHID0gSEVBUDMyLnN1YmFycmF5KGNvbXBHX3B0ciwgY29tcEdfcHRyICsgbmJfcGl4ZWxzKTsKICAgICAgaW1hZ2VEYXRhLnNldChjb21wRyk7CiAgICB9CiAgICBmdW5jdGlvbiBfY29weV9waXhlbHNfMyhjb21wUl9wdHIsIGNvbXBHX3B0ciwgY29tcEJfcHRyLCBuYl9waXhlbHMpIHsKICAgICAgY29tcFJfcHRyID4+PSAyOwogICAgICBjb21wR19wdHIgPj49IDI7CiAgICAgIGNvbXBCX3B0ciA+Pj0gMjsKICAgICAgY29uc3QgaW1hZ2VEYXRhID0gTW9kdWxlLmltYWdlRGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShuYl9waXhlbHMgKiAzKTsKICAgICAgY29uc3QgY29tcFIgPSBIRUFQMzIuc3ViYXJyYXkoY29tcFJfcHRyLCBjb21wUl9wdHIgKyBuYl9waXhlbHMpOwogICAgICBjb25zdCBjb21wRyA9IEhFQVAzMi5zdWJhcnJheShjb21wR19wdHIsIGNvbXBHX3B0ciArIG5iX3BpeGVscyk7CiAgICAgIGNvbnN0IGNvbXBCID0gSEVBUDMyLnN1YmFycmF5KGNvbXBCX3B0ciwgY29tcEJfcHRyICsgbmJfcGl4ZWxzKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuYl9waXhlbHM7IGkrKykgewogICAgICAgIGltYWdlRGF0YVszICogaV0gPSBjb21wUltpXTsKICAgICAgICBpbWFnZURhdGFbMyAqIGkgKyAxXSA9IGNvbXBHW2ldOwogICAgICAgIGltYWdlRGF0YVszICogaSArIDJdID0gY29tcEJbaV07CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIF9jb3B5X3BpeGVsc180KGNvbXBSX3B0ciwgY29tcEdfcHRyLCBjb21wQl9wdHIsIGNvbXBBX3B0ciwgbmJfcGl4ZWxzKSB7CiAgICAgIGNvbXBSX3B0ciA+Pj0gMjsKICAgICAgY29tcEdfcHRyID4+PSAyOwogICAgICBjb21wQl9wdHIgPj49IDI7CiAgICAgIGNvbXBBX3B0ciA+Pj0gMjsKICAgICAgY29uc3QgaW1hZ2VEYXRhID0gTW9kdWxlLmltYWdlRGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShuYl9waXhlbHMgKiA0KTsKICAgICAgY29uc3QgY29tcFIgPSBIRUFQMzIuc3ViYXJyYXkoY29tcFJfcHRyLCBjb21wUl9wdHIgKyBuYl9waXhlbHMpOwogICAgICBjb25zdCBjb21wRyA9IEhFQVAzMi5zdWJhcnJheShjb21wR19wdHIsIGNvbXBHX3B0ciArIG5iX3BpeGVscyk7CiAgICAgIGNvbnN0IGNvbXBCID0gSEVBUDMyLnN1YmFycmF5KGNvbXBCX3B0ciwgY29tcEJfcHRyICsgbmJfcGl4ZWxzKTsKICAgICAgY29uc3QgY29tcEEgPSBIRUFQMzIuc3ViYXJyYXkoY29tcEFfcHRyLCBjb21wQV9wdHIgKyBuYl9waXhlbHMpOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5iX3BpeGVsczsgaSsrKSB7CiAgICAgICAgaW1hZ2VEYXRhWzQgKiBpXSA9IGNvbXBSW2ldOwogICAgICAgIGltYWdlRGF0YVs0ICogaSArIDFdID0gY29tcEdbaV07CiAgICAgICAgaW1hZ2VEYXRhWzQgKiBpICsgMl0gPSBjb21wQltpXTsKICAgICAgICBpbWFnZURhdGFbNCAqIGkgKyAzXSA9IGNvbXBBW2ldOwogICAgICB9CiAgICB9CiAgICB2YXIgZ2V0SGVhcE1heCA9ICgpID0+IDIxNDc0ODM2NDg7CiAgICB2YXIgYWxpZ25NZW1vcnkgPSAoc2l6ZSwgYWxpZ25tZW50KSA9PiBNYXRoLmNlaWwoc2l6ZSAvIGFsaWdubWVudCkgKiBhbGlnbm1lbnQ7CiAgICB2YXIgZ3Jvd01lbW9yeSA9IHNpemUgPT4gewogICAgICB2YXIgYiA9IHdhc21NZW1vcnkuYnVmZmVyOwogICAgICB2YXIgcGFnZXMgPSAoc2l6ZSAtIGIuYnl0ZUxlbmd0aCArIDY1NTM1KSAvIDY1NTM2IHwgMDsKICAgICAgdHJ5IHsKICAgICAgICB3YXNtTWVtb3J5Lmdyb3cocGFnZXMpOwogICAgICAgIHVwZGF0ZU1lbW9yeVZpZXdzKCk7CiAgICAgICAgcmV0dXJuIDE7CiAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICB9OwogICAgdmFyIF9lbXNjcmlwdGVuX3Jlc2l6ZV9oZWFwID0gcmVxdWVzdGVkU2l6ZSA9PiB7CiAgICAgIHZhciBvbGRTaXplID0gSEVBUFU4Lmxlbmd0aDsKICAgICAgcmVxdWVzdGVkU2l6ZSA+Pj49IDA7CiAgICAgIHZhciBtYXhIZWFwU2l6ZSA9IGdldEhlYXBNYXgoKTsKICAgICAgaWYgKHJlcXVlc3RlZFNpemUgPiBtYXhIZWFwU2l6ZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBmb3IgKHZhciBjdXREb3duID0gMTsgY3V0RG93biA8PSA0OyBjdXREb3duICo9IDIpIHsKICAgICAgICB2YXIgb3Zlckdyb3duSGVhcFNpemUgPSBvbGRTaXplICogKDEgKyAuMiAvIGN1dERvd24pOwogICAgICAgIG92ZXJHcm93bkhlYXBTaXplID0gTWF0aC5taW4ob3Zlckdyb3duSGVhcFNpemUsIHJlcXVlc3RlZFNpemUgKyAxMDA2NjMyOTYpOwogICAgICAgIHZhciBuZXdTaXplID0gTWF0aC5taW4obWF4SGVhcFNpemUsIGFsaWduTWVtb3J5KE1hdGgubWF4KHJlcXVlc3RlZFNpemUsIG92ZXJHcm93bkhlYXBTaXplKSwgNjU1MzYpKTsKICAgICAgICB2YXIgcmVwbGFjZW1lbnQgPSBncm93TWVtb3J5KG5ld1NpemUpOwogICAgICAgIGlmIChyZXBsYWNlbWVudCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CiAgICB2YXIgRU5WID0ge307CiAgICB2YXIgZ2V0RXhlY3V0YWJsZU5hbWUgPSAoKSA9PiB0aGlzUHJvZ3JhbSB8fCAiLi90aGlzLnByb2dyYW0iOwogICAgdmFyIGdldEVudlN0cmluZ3MgPSAoKSA9PiB7CiAgICAgIGlmICghZ2V0RW52U3RyaW5ncy5zdHJpbmdzKSB7CiAgICAgICAgdmFyIGxhbmcgPSAodHlwZW9mIG5hdmlnYXRvciA9PSAib2JqZWN0IiAmJiBuYXZpZ2F0b3IubGFuZ3VhZ2VzICYmIG5hdmlnYXRvci5sYW5ndWFnZXNbMF0gfHwgIkMiKS5yZXBsYWNlKCItIiwgIl8iKSArICIuVVRGLTgiOwogICAgICAgIHZhciBlbnYgPSB7CiAgICAgICAgICBVU0VSOiAid2ViX3VzZXIiLAogICAgICAgICAgTE9HTkFNRTogIndlYl91c2VyIiwKICAgICAgICAgIFBBVEg6ICIvIiwKICAgICAgICAgIFBXRDogIi8iLAogICAgICAgICAgSE9NRTogIi9ob21lL3dlYl91c2VyIiwKICAgICAgICAgIExBTkc6IGxhbmcsCiAgICAgICAgICBfOiBnZXRFeGVjdXRhYmxlTmFtZSgpCiAgICAgICAgfTsKICAgICAgICBmb3IgKHZhciB4IGluIEVOVikgewogICAgICAgICAgaWYgKEVOVlt4XSA9PT0gdW5kZWZpbmVkKSBkZWxldGUgZW52W3hdO2Vsc2UgZW52W3hdID0gRU5WW3hdOwogICAgICAgIH0KICAgICAgICB2YXIgc3RyaW5ncyA9IFtdOwogICAgICAgIGZvciAodmFyIHggaW4gZW52KSB7CiAgICAgICAgICBzdHJpbmdzLnB1c2goYCR7eH09JHtlbnZbeF19YCk7CiAgICAgICAgfQogICAgICAgIGdldEVudlN0cmluZ3Muc3RyaW5ncyA9IHN0cmluZ3M7CiAgICAgIH0KICAgICAgcmV0dXJuIGdldEVudlN0cmluZ3Muc3RyaW5nczsKICAgIH07CiAgICB2YXIgc3RyaW5nVG9VVEY4QXJyYXkgPSAoc3RyLCBoZWFwLCBvdXRJZHgsIG1heEJ5dGVzVG9Xcml0ZSkgPT4gewogICAgICBpZiAoIShtYXhCeXRlc1RvV3JpdGUgPiAwKSkgcmV0dXJuIDA7CiAgICAgIHZhciBzdGFydElkeCA9IG91dElkeDsKICAgICAgdmFyIGVuZElkeCA9IG91dElkeCArIG1heEJ5dGVzVG9Xcml0ZSAtIDE7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgKytpKSB7CiAgICAgICAgdmFyIHUgPSBzdHIuY2hhckNvZGVBdChpKTsKICAgICAgICBpZiAodSA+PSA1NTI5NiAmJiB1IDw9IDU3MzQzKSB7CiAgICAgICAgICB2YXIgdTEgPSBzdHIuY2hhckNvZGVBdCgrK2kpOwogICAgICAgICAgdSA9IDY1NTM2ICsgKCh1ICYgMTAyMykgPDwgMTApIHwgdTEgJiAxMDIzOwogICAgICAgIH0KICAgICAgICBpZiAodSA8PSAxMjcpIHsKICAgICAgICAgIGlmIChvdXRJZHggPj0gZW5kSWR4KSBicmVhazsKICAgICAgICAgIGhlYXBbb3V0SWR4KytdID0gdTsKICAgICAgICB9IGVsc2UgaWYgKHUgPD0gMjA0NykgewogICAgICAgICAgaWYgKG91dElkeCArIDEgPj0gZW5kSWR4KSBicmVhazsKICAgICAgICAgIGhlYXBbb3V0SWR4KytdID0gMTkyIHwgdSA+PiA2OwogICAgICAgICAgaGVhcFtvdXRJZHgrK10gPSAxMjggfCB1ICYgNjM7CiAgICAgICAgfSBlbHNlIGlmICh1IDw9IDY1NTM1KSB7CiAgICAgICAgICBpZiAob3V0SWR4ICsgMiA+PSBlbmRJZHgpIGJyZWFrOwogICAgICAgICAgaGVhcFtvdXRJZHgrK10gPSAyMjQgfCB1ID4+IDEyOwogICAgICAgICAgaGVhcFtvdXRJZHgrK10gPSAxMjggfCB1ID4+IDYgJiA2MzsKICAgICAgICAgIGhlYXBbb3V0SWR4KytdID0gMTI4IHwgdSAmIDYzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAob3V0SWR4ICsgMyA+PSBlbmRJZHgpIGJyZWFrOwogICAgICAgICAgaGVhcFtvdXRJZHgrK10gPSAyNDAgfCB1ID4+IDE4OwogICAgICAgICAgaGVhcFtvdXRJZHgrK10gPSAxMjggfCB1ID4+IDEyICYgNjM7CiAgICAgICAgICBoZWFwW291dElkeCsrXSA9IDEyOCB8IHUgPj4gNiAmIDYzOwogICAgICAgICAgaGVhcFtvdXRJZHgrK10gPSAxMjggfCB1ICYgNjM7CiAgICAgICAgfQogICAgICB9CiAgICAgIGhlYXBbb3V0SWR4XSA9IDA7CiAgICAgIHJldHVybiBvdXRJZHggLSBzdGFydElkeDsKICAgIH07CiAgICB2YXIgc3RyaW5nVG9VVEY4ID0gKHN0ciwgb3V0UHRyLCBtYXhCeXRlc1RvV3JpdGUpID0+IHN0cmluZ1RvVVRGOEFycmF5KHN0ciwgSEVBUFU4LCBvdXRQdHIsIG1heEJ5dGVzVG9Xcml0ZSk7CiAgICB2YXIgX2Vudmlyb25fZ2V0ID0gKF9fZW52aXJvbiwgZW52aXJvbl9idWYpID0+IHsKICAgICAgdmFyIGJ1ZlNpemUgPSAwOwogICAgICB2YXIgZW52cCA9IDA7CiAgICAgIGZvciAodmFyIHN0cmluZyBvZiBnZXRFbnZTdHJpbmdzKCkpIHsKICAgICAgICB2YXIgcHRyID0gZW52aXJvbl9idWYgKyBidWZTaXplOwogICAgICAgIEhFQVBVMzJbX19lbnZpcm9uICsgZW52cCA+PiAyXSA9IHB0cjsKICAgICAgICBidWZTaXplICs9IHN0cmluZ1RvVVRGOChzdHJpbmcsIHB0ciwgSW5maW5pdHkpICsgMTsKICAgICAgICBlbnZwICs9IDQ7CiAgICAgIH0KICAgICAgcmV0dXJuIDA7CiAgICB9OwogICAgdmFyIGxlbmd0aEJ5dGVzVVRGOCA9IHN0ciA9PiB7CiAgICAgIHZhciBsZW4gPSAwOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7ICsraSkgewogICAgICAgIHZhciBjID0gc3RyLmNoYXJDb2RlQXQoaSk7CiAgICAgICAgaWYgKGMgPD0gMTI3KSB7CiAgICAgICAgICBsZW4rKzsKICAgICAgICB9IGVsc2UgaWYgKGMgPD0gMjA0NykgewogICAgICAgICAgbGVuICs9IDI7CiAgICAgICAgfSBlbHNlIGlmIChjID49IDU1Mjk2ICYmIGMgPD0gNTczNDMpIHsKICAgICAgICAgIGxlbiArPSA0OwogICAgICAgICAgKytpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsZW4gKz0gMzsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGxlbjsKICAgIH07CiAgICB2YXIgX2Vudmlyb25fc2l6ZXNfZ2V0ID0gKHBlbnZpcm9uX2NvdW50LCBwZW52aXJvbl9idWZfc2l6ZSkgPT4gewogICAgICB2YXIgc3RyaW5ncyA9IGdldEVudlN0cmluZ3MoKTsKICAgICAgSEVBUFUzMltwZW52aXJvbl9jb3VudCA+PiAyXSA9IHN0cmluZ3MubGVuZ3RoOwogICAgICB2YXIgYnVmU2l6ZSA9IDA7CiAgICAgIGZvciAodmFyIHN0cmluZyBvZiBzdHJpbmdzKSB7CiAgICAgICAgYnVmU2l6ZSArPSBsZW5ndGhCeXRlc1VURjgoc3RyaW5nKSArIDE7CiAgICAgIH0KICAgICAgSEVBUFUzMltwZW52aXJvbl9idWZfc2l6ZSA+PiAyXSA9IGJ1ZlNpemU7CiAgICAgIHJldHVybiAwOwogICAgfTsKICAgIHZhciBfZmRfY2xvc2UgPSBmZCA9PiA1MjsKICAgIHZhciBJTlQ1M19NQVggPSA5MDA3MTk5MjU0NzQwOTkyOwogICAgdmFyIElOVDUzX01JTiA9IC05MDA3MTk5MjU0NzQwOTkyOwogICAgdmFyIGJpZ2ludFRvSTUzQ2hlY2tlZCA9IG51bSA9PiBudW0gPCBJTlQ1M19NSU4gfHwgbnVtID4gSU5UNTNfTUFYID8gTmFOIDogTnVtYmVyKG51bSk7CiAgICBmdW5jdGlvbiBfZmRfc2VlayhmZCwgb2Zmc2V0LCB3aGVuY2UsIG5ld09mZnNldCkgewogICAgICBvZmZzZXQgPSBiaWdpbnRUb0k1M0NoZWNrZWQob2Zmc2V0KTsKICAgICAgcmV0dXJuIDcwOwogICAgfQogICAgdmFyIHByaW50Q2hhckJ1ZmZlcnMgPSBbbnVsbCwgW10sIFtdXTsKICAgIHZhciBVVEY4RGVjb2RlciA9IHR5cGVvZiBUZXh0RGVjb2RlciAhPSAidW5kZWZpbmVkIiA/IG5ldyBUZXh0RGVjb2RlcigpIDogdW5kZWZpbmVkOwogICAgdmFyIFVURjhBcnJheVRvU3RyaW5nID0gKGhlYXBPckFycmF5LCBpZHggPSAwLCBtYXhCeXRlc1RvUmVhZCA9IE5hTikgPT4gewogICAgICB2YXIgZW5kSWR4ID0gaWR4ICsgbWF4Qnl0ZXNUb1JlYWQ7CiAgICAgIHZhciBlbmRQdHIgPSBpZHg7CiAgICAgIHdoaWxlIChoZWFwT3JBcnJheVtlbmRQdHJdICYmICEoZW5kUHRyID49IGVuZElkeCkpICsrZW5kUHRyOwogICAgICBpZiAoZW5kUHRyIC0gaWR4ID4gMTYgJiYgaGVhcE9yQXJyYXkuYnVmZmVyICYmIFVURjhEZWNvZGVyKSB7CiAgICAgICAgcmV0dXJuIFVURjhEZWNvZGVyLmRlY29kZShoZWFwT3JBcnJheS5zdWJhcnJheShpZHgsIGVuZFB0cikpOwogICAgICB9CiAgICAgIHZhciBzdHIgPSAiIjsKICAgICAgd2hpbGUgKGlkeCA8IGVuZFB0cikgewogICAgICAgIHZhciB1MCA9IGhlYXBPckFycmF5W2lkeCsrXTsKICAgICAgICBpZiAoISh1MCAmIDEyOCkpIHsKICAgICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHUwKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICB2YXIgdTEgPSBoZWFwT3JBcnJheVtpZHgrK10gJiA2MzsKICAgICAgICBpZiAoKHUwICYgMjI0KSA9PSAxOTIpIHsKICAgICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCh1MCAmIDMxKSA8PCA2IHwgdTEpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHZhciB1MiA9IGhlYXBPckFycmF5W2lkeCsrXSAmIDYzOwogICAgICAgIGlmICgodTAgJiAyNDApID09IDIyNCkgewogICAgICAgICAgdTAgPSAodTAgJiAxNSkgPDwgMTIgfCB1MSA8PCA2IHwgdTI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHUwID0gKHUwICYgNykgPDwgMTggfCB1MSA8PCAxMiB8IHUyIDw8IDYgfCBoZWFwT3JBcnJheVtpZHgrK10gJiA2MzsKICAgICAgICB9CiAgICAgICAgaWYgKHUwIDwgNjU1MzYpIHsKICAgICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHUwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGNoID0gdTAgLSA2NTUzNjsKICAgICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDU1Mjk2IHwgY2ggPj4gMTAsIDU2MzIwIHwgY2ggJiAxMDIzKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHN0cjsKICAgIH07CiAgICB2YXIgcHJpbnRDaGFyID0gKHN0cmVhbSwgY3VycikgPT4gewogICAgICB2YXIgYnVmZmVyID0gcHJpbnRDaGFyQnVmZmVyc1tzdHJlYW1dOwogICAgICBpZiAoY3VyciA9PT0gMCB8fCBjdXJyID09PSAxMCkgewogICAgICAgIChzdHJlYW0gPT09IDEgPyBvdXQgOiBlcnIpKFVURjhBcnJheVRvU3RyaW5nKGJ1ZmZlcikpOwogICAgICAgIGJ1ZmZlci5sZW5ndGggPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGJ1ZmZlci5wdXNoKGN1cnIpOwogICAgICB9CiAgICB9OwogICAgdmFyIFVURjhUb1N0cmluZyA9IChwdHIsIG1heEJ5dGVzVG9SZWFkKSA9PiBwdHIgPyBVVEY4QXJyYXlUb1N0cmluZyhIRUFQVTgsIHB0ciwgbWF4Qnl0ZXNUb1JlYWQpIDogIiI7CiAgICB2YXIgX2ZkX3dyaXRlID0gKGZkLCBpb3YsIGlvdmNudCwgcG51bSkgPT4gewogICAgICB2YXIgbnVtID0gMDsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpb3ZjbnQ7IGkrKykgewogICAgICAgIHZhciBwdHIgPSBIRUFQVTMyW2lvdiA+PiAyXTsKICAgICAgICB2YXIgbGVuID0gSEVBUFUzMltpb3YgKyA0ID4+IDJdOwogICAgICAgIGlvdiArPSA4OwogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbGVuOyBqKyspIHsKICAgICAgICAgIHByaW50Q2hhcihmZCwgSEVBUFU4W3B0ciArIGpdKTsKICAgICAgICB9CiAgICAgICAgbnVtICs9IGxlbjsKICAgICAgfQogICAgICBIRUFQVTMyW3BudW0gPj4gMl0gPSBudW07CiAgICAgIHJldHVybiAwOwogICAgfTsKICAgIGZ1bmN0aW9uIF9ncmF5X3RvX3JnYmEoY29tcEdfcHRyLCBuYl9waXhlbHMpIHsKICAgICAgY29tcEdfcHRyID4+PSAyOwogICAgICBjb25zdCBpbWFnZURhdGEgPSBNb2R1bGUuaW1hZ2VEYXRhID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KG5iX3BpeGVscyAqIDQpOwogICAgICBjb25zdCBjb21wRyA9IEhFQVAzMi5zdWJhcnJheShjb21wR19wdHIsIGNvbXBHX3B0ciArIG5iX3BpeGVscyk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmJfcGl4ZWxzOyBpKyspIHsKICAgICAgICBpbWFnZURhdGFbNCAqIGldID0gaW1hZ2VEYXRhWzQgKiBpICsgMV0gPSBpbWFnZURhdGFbNCAqIGkgKyAyXSA9IGNvbXBHW2ldOwogICAgICAgIGltYWdlRGF0YVs0ICogaSArIDNdID0gMjU1OwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBfZ3JheWFfdG9fcmdiYShjb21wR19wdHIsIGNvbXBBX3B0ciwgbmJfcGl4ZWxzKSB7CiAgICAgIGNvbXBHX3B0ciA+Pj0gMjsKICAgICAgY29tcEFfcHRyID4+PSAyOwogICAgICBjb25zdCBpbWFnZURhdGEgPSBNb2R1bGUuaW1hZ2VEYXRhID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KG5iX3BpeGVscyAqIDQpOwogICAgICBjb25zdCBjb21wRyA9IEhFQVAzMi5zdWJhcnJheShjb21wR19wdHIsIGNvbXBHX3B0ciArIG5iX3BpeGVscyk7CiAgICAgIGNvbnN0IGNvbXBBID0gSEVBUDMyLnN1YmFycmF5KGNvbXBBX3B0ciwgY29tcEFfcHRyICsgbmJfcGl4ZWxzKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuYl9waXhlbHM7IGkrKykgewogICAgICAgIGltYWdlRGF0YVs0ICogaV0gPSBpbWFnZURhdGFbNCAqIGkgKyAxXSA9IGltYWdlRGF0YVs0ICogaSArIDJdID0gY29tcEdbaV07CiAgICAgICAgaW1hZ2VEYXRhWzQgKiBpICsgM10gPSBjb21wQVtpXTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gX2pzUHJpbnRXYXJuaW5nKG1lc3NhZ2VfcHRyKSB7CiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBVVEY4VG9TdHJpbmcobWVzc2FnZV9wdHIpOwogICAgICAoTW9kdWxlLndhcm4gfHwgY29uc29sZS53YXJuKShgT3BlbkpQRUc6ICR7bWVzc2FnZX1gKTsKICAgIH0KICAgIGZ1bmN0aW9uIF9yZ2JfdG9fcmdiYShjb21wUl9wdHIsIGNvbXBHX3B0ciwgY29tcEJfcHRyLCBuYl9waXhlbHMpIHsKICAgICAgY29tcFJfcHRyID4+PSAyOwogICAgICBjb21wR19wdHIgPj49IDI7CiAgICAgIGNvbXBCX3B0ciA+Pj0gMjsKICAgICAgY29uc3QgaW1hZ2VEYXRhID0gTW9kdWxlLmltYWdlRGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShuYl9waXhlbHMgKiA0KTsKICAgICAgY29uc3QgY29tcFIgPSBIRUFQMzIuc3ViYXJyYXkoY29tcFJfcHRyLCBjb21wUl9wdHIgKyBuYl9waXhlbHMpOwogICAgICBjb25zdCBjb21wRyA9IEhFQVAzMi5zdWJhcnJheShjb21wR19wdHIsIGNvbXBHX3B0ciArIG5iX3BpeGVscyk7CiAgICAgIGNvbnN0IGNvbXBCID0gSEVBUDMyLnN1YmFycmF5KGNvbXBCX3B0ciwgY29tcEJfcHRyICsgbmJfcGl4ZWxzKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuYl9waXhlbHM7IGkrKykgewogICAgICAgIGltYWdlRGF0YVs0ICogaV0gPSBjb21wUltpXTsKICAgICAgICBpbWFnZURhdGFbNCAqIGkgKyAxXSA9IGNvbXBHW2ldOwogICAgICAgIGltYWdlRGF0YVs0ICogaSArIDJdID0gY29tcEJbaV07CiAgICAgICAgaW1hZ2VEYXRhWzQgKiBpICsgM10gPSAyNTU7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIF9zdG9yZUVycm9yTWVzc2FnZShtZXNzYWdlX3B0cikgewogICAgICBjb25zdCBtZXNzYWdlID0gVVRGOFRvU3RyaW5nKG1lc3NhZ2VfcHRyKTsKICAgICAgaWYgKCFNb2R1bGUuZXJyb3JNZXNzYWdlcykgewogICAgICAgIE1vZHVsZS5lcnJvck1lc3NhZ2VzID0gbWVzc2FnZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBNb2R1bGUuZXJyb3JNZXNzYWdlcyArPSAiXG4iICsgbWVzc2FnZTsKICAgICAgfQogICAgfQogICAgdmFyIHdyaXRlQXJyYXlUb01lbW9yeSA9IChhcnJheSwgYnVmZmVyKSA9PiB7CiAgICAgIEhFQVA4LnNldChhcnJheSwgYnVmZmVyKTsKICAgIH07CiAgICBpZiAoTW9kdWxlWyJub0V4aXRSdW50aW1lIl0pIG5vRXhpdFJ1bnRpbWUgPSBNb2R1bGVbIm5vRXhpdFJ1bnRpbWUiXTsKICAgIGlmIChNb2R1bGVbInByaW50Il0pIG91dCA9IE1vZHVsZVsicHJpbnQiXTsKICAgIGlmIChNb2R1bGVbInByaW50RXJyIl0pIGVyciA9IE1vZHVsZVsicHJpbnRFcnIiXTsKICAgIGlmIChNb2R1bGVbIndhc21CaW5hcnkiXSkgd2FzbUJpbmFyeSA9IE1vZHVsZVsid2FzbUJpbmFyeSJdOwogICAgaWYgKE1vZHVsZVsiYXJndW1lbnRzIl0pIGFyZ3VtZW50c18gPSBNb2R1bGVbImFyZ3VtZW50cyJdOwogICAgaWYgKE1vZHVsZVsidGhpc1Byb2dyYW0iXSkgdGhpc1Byb2dyYW0gPSBNb2R1bGVbInRoaXNQcm9ncmFtIl07CiAgICBNb2R1bGVbIndyaXRlQXJyYXlUb01lbW9yeSJdID0gd3JpdGVBcnJheVRvTWVtb3J5OwogICAgdmFyIHdhc21JbXBvcnRzID0gewogICAgICBsOiBfX2Fib3J0X2pzLAogICAgICBrOiBfX2Vtc2NyaXB0ZW5fcnVudGltZV9rZWVwYWxpdmVfY2xlYXIsCiAgICAgIG06IF9fc2V0aXRpbWVyX2pzLAogICAgICBnOiBfY29weV9waXhlbHNfMSwKICAgICAgZjogX2NvcHlfcGl4ZWxzXzMsCiAgICAgIGU6IF9jb3B5X3BpeGVsc180LAogICAgICBuOiBfZW1zY3JpcHRlbl9yZXNpemVfaGVhcCwKICAgICAgcDogX2Vudmlyb25fZ2V0LAogICAgICBxOiBfZW52aXJvbl9zaXplc19nZXQsCiAgICAgIGI6IF9mZF9jbG9zZSwKICAgICAgbzogX2ZkX3NlZWssCiAgICAgIGM6IF9mZF93cml0ZSwKICAgICAgcjogX2dyYXlfdG9fcmdiYSwKICAgICAgaTogX2dyYXlhX3RvX3JnYmEsCiAgICAgIGQ6IF9qc1ByaW50V2FybmluZywKICAgICAgajogX3Byb2NfZXhpdCwKICAgICAgaDogX3JnYl90b19yZ2JhLAogICAgICBhOiBfc3RvcmVFcnJvck1lc3NhZ2UKICAgIH07CiAgICB2YXIgd2FzbUV4cG9ydHMgPSBhd2FpdCBjcmVhdGVXYXNtKCk7CiAgICB2YXIgX19fd2FzbV9jYWxsX2N0b3JzID0gd2FzbUV4cG9ydHNbInQiXTsKICAgIHZhciBfbWFsbG9jID0gTW9kdWxlWyJfbWFsbG9jIl0gPSB3YXNtRXhwb3J0c1sidSJdOwogICAgdmFyIF9mcmVlID0gTW9kdWxlWyJfZnJlZSJdID0gd2FzbUV4cG9ydHNbInYiXTsKICAgIHZhciBfanAyX2RlY29kZSA9IE1vZHVsZVsiX2pwMl9kZWNvZGUiXSA9IHdhc21FeHBvcnRzWyJ3Il07CiAgICB2YXIgX19lbXNjcmlwdGVuX3RpbWVvdXQgPSB3YXNtRXhwb3J0c1sieCJdOwogICAgZnVuY3Rpb24gcnVuKCkgewogICAgICBpZiAocnVuRGVwZW5kZW5jaWVzID4gMCkgewogICAgICAgIGRlcGVuZGVuY2llc0Z1bGZpbGxlZCA9IHJ1bjsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgcHJlUnVuKCk7CiAgICAgIGlmIChydW5EZXBlbmRlbmNpZXMgPiAwKSB7CiAgICAgICAgZGVwZW5kZW5jaWVzRnVsZmlsbGVkID0gcnVuOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBmdW5jdGlvbiBkb1J1bigpIHsKICAgICAgICBNb2R1bGVbImNhbGxlZFJ1biJdID0gdHJ1ZTsKICAgICAgICBpZiAoQUJPUlQpIHJldHVybjsKICAgICAgICBpbml0UnVudGltZSgpOwogICAgICAgIHJlYWR5UHJvbWlzZVJlc29sdmUoTW9kdWxlKTsKICAgICAgICBNb2R1bGVbIm9uUnVudGltZUluaXRpYWxpemVkIl0/LigpOwogICAgICAgIHBvc3RSdW4oKTsKICAgICAgfQogICAgICBpZiAoTW9kdWxlWyJzZXRTdGF0dXMiXSkgewogICAgICAgIE1vZHVsZVsic2V0U3RhdHVzIl0oIlJ1bm5pbmcuLi4iKTsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gTW9kdWxlWyJzZXRTdGF0dXMiXSgiIiksIDEpOwogICAgICAgICAgZG9SdW4oKTsKICAgICAgICB9LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkb1J1bigpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBwcmVJbml0KCkgewogICAgICBpZiAoTW9kdWxlWyJwcmVJbml0Il0pIHsKICAgICAgICBpZiAodHlwZW9mIE1vZHVsZVsicHJlSW5pdCJdID09ICJmdW5jdGlvbiIpIE1vZHVsZVsicHJlSW5pdCJdID0gW01vZHVsZVsicHJlSW5pdCJdXTsKICAgICAgICB3aGlsZSAoTW9kdWxlWyJwcmVJbml0Il0ubGVuZ3RoID4gMCkgewogICAgICAgICAgTW9kdWxlWyJwcmVJbml0Il0uc2hpZnQoKSgpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcHJlSW5pdCgpOwogICAgcnVuKCk7CiAgICBtb2R1bGVSdG4gPSByZWFkeVByb21pc2U7CiAgICByZXR1cm4gbW9kdWxlUnRuOwogIH07Cn0pKCk7Ci8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gY29uc3Qgb3BlbmpwZWcgPSAoT3BlbkpQRUcpOwo7Ly8gLi9zcmMvY29yZS9qcHguanMKCgoKCmNsYXNzIEpweEVycm9yIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobXNnKSB7CiAgICBzdXBlcihtc2csICJKcHhFcnJvciIpOwogIH0KfQpjbGFzcyBKcHhJbWFnZSB7CiAgc3RhdGljICNidWZmZXIgPSBudWxsOwogIHN0YXRpYyAjaGFuZGxlciA9IG51bGw7CiAgc3RhdGljICNtb2R1bGVQcm9taXNlID0gbnVsbDsKICBzdGF0aWMgI3VzZVdhc20gPSB0cnVlOwogIHN0YXRpYyAjdXNlV29ya2VyRmV0Y2ggPSB0cnVlOwogIHN0YXRpYyAjd2FzbVVybCA9IG51bGw7CiAgc3RhdGljIHNldE9wdGlvbnMoewogICAgaGFuZGxlciwKICAgIHVzZVdhc20sCiAgICB1c2VXb3JrZXJGZXRjaCwKICAgIHdhc21VcmwKICB9KSB7CiAgICB0aGlzLiN1c2VXYXNtID0gdXNlV2FzbTsKICAgIHRoaXMuI3VzZVdvcmtlckZldGNoID0gdXNlV29ya2VyRmV0Y2g7CiAgICB0aGlzLiN3YXNtVXJsID0gd2FzbVVybDsKICAgIGlmICghdXNlV29ya2VyRmV0Y2gpIHsKICAgICAgdGhpcy4jaGFuZGxlciA9IGhhbmRsZXI7CiAgICB9CiAgfQogIHN0YXRpYyBhc3luYyAjZ2V0SnNNb2R1bGUoZmFsbGJhY2tDYWxsYmFjaykgewogICAgY29uc3QgcGF0aCA9IGAke3RoaXMuI3dhc21Vcmx9b3BlbmpwZWdfbm93YXNtX2ZhbGxiYWNrLmpzYDsKICAgIGxldCBpbnN0YW5jZSA9IG51bGw7CiAgICB0cnkgewogICAgICBjb25zdCBtb2QgPSBhd2FpdCBpbXBvcnQoCiAgICAgIC8qd2VicGFja0lnbm9yZTogdHJ1ZSovCiAgICAgIC8qQHZpdGUtaWdub3JlKi8KICAgICAgcGF0aCk7CiAgICAgIGluc3RhbmNlID0gbW9kLmRlZmF1bHQoKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgd2FybihgSnB4SW1hZ2UjZ2V0SnNNb2R1bGU6ICR7ZX1gKTsKICAgIH0KICAgIGZhbGxiYWNrQ2FsbGJhY2soaW5zdGFuY2UpOwogIH0KICBzdGF0aWMgYXN5bmMgI2luc3RhbnRpYXRlV2FzbShmYWxsYmFja0NhbGxiYWNrLCBpbXBvcnRzLCBzdWNjZXNzQ2FsbGJhY2spIHsKICAgIGNvbnN0IGZpbGVuYW1lID0gIm9wZW5qcGVnLndhc20iOwogICAgdHJ5IHsKICAgICAgaWYgKCF0aGlzLiNidWZmZXIpIHsKICAgICAgICBpZiAodGhpcy4jdXNlV29ya2VyRmV0Y2gpIHsKICAgICAgICAgIHRoaXMuI2J1ZmZlciA9IGF3YWl0IGZldGNoQmluYXJ5RGF0YShgJHt0aGlzLiN3YXNtVXJsfSR7ZmlsZW5hbWV9YCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuI2J1ZmZlciA9IGF3YWl0IHRoaXMuI2hhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJGZXRjaEJpbmFyeURhdGEiLCB7CiAgICAgICAgICAgIHR5cGU6ICJ3YXNtRmFjdG9yeSIsCiAgICAgICAgICAgIGZpbGVuYW1lCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKHRoaXMuI2J1ZmZlciwgaW1wb3J0cyk7CiAgICAgIHJldHVybiBzdWNjZXNzQ2FsbGJhY2socmVzdWx0cy5pbnN0YW5jZSk7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgd2FybihgSnB4SW1hZ2UjaW5zdGFudGlhdGVXYXNtOiAke3JlYXNvbn1gKTsKICAgICAgdGhpcy4jZ2V0SnNNb2R1bGUoZmFsbGJhY2tDYWxsYmFjayk7CiAgICAgIHJldHVybiBudWxsOwogICAgfSBmaW5hbGx5IHsKICAgICAgdGhpcy4jaGFuZGxlciA9IG51bGw7CiAgICB9CiAgfQogIHN0YXRpYyBhc3luYyBkZWNvZGUoYnl0ZXMsIHsKICAgIG51bUNvbXBvbmVudHMgPSA0LAogICAgaXNJbmRleGVkQ29sb3JtYXAgPSBmYWxzZSwKICAgIHNtYXNrSW5EYXRhID0gZmFsc2UsCiAgICByZWR1Y2VQb3dlciA9IDAKICB9ID0ge30pIHsKICAgIGlmICghdGhpcy4jbW9kdWxlUHJvbWlzZSkgewogICAgICBjb25zdCB7CiAgICAgICAgcHJvbWlzZSwKICAgICAgICByZXNvbHZlCiAgICAgIH0gPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgICAgY29uc3QgcHJvbWlzZXMgPSBbcHJvbWlzZV07CiAgICAgIGlmICghdGhpcy4jdXNlV2FzbSkgewogICAgICAgIHRoaXMuI2dldEpzTW9kdWxlKHJlc29sdmUpOwogICAgICB9IGVsc2UgewogICAgICAgIHByb21pc2VzLnB1c2gob3BlbmpwZWcoewogICAgICAgICAgd2Fybjogd2FybiwKICAgICAgICAgIGluc3RhbnRpYXRlV2FzbTogdGhpcy4jaW5zdGFudGlhdGVXYXNtLmJpbmQodGhpcywgcmVzb2x2ZSkKICAgICAgICB9KSk7CiAgICAgIH0KICAgICAgdGhpcy4jbW9kdWxlUHJvbWlzZSA9IFByb21pc2UucmFjZShwcm9taXNlcyk7CiAgICB9CiAgICBjb25zdCBtb2R1bGUgPSBhd2FpdCB0aGlzLiNtb2R1bGVQcm9taXNlOwogICAgaWYgKCFtb2R1bGUpIHsKICAgICAgdGhyb3cgbmV3IEpweEVycm9yKCJPcGVuSlBFRyBmYWlsZWQgdG8gaW5pdGlhbGl6ZSIpOwogICAgfQogICAgbGV0IHB0cjsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHNpemUgPSBieXRlcy5sZW5ndGg7CiAgICAgIHB0ciA9IG1vZHVsZS5fbWFsbG9jKHNpemUpOwogICAgICBtb2R1bGUud3JpdGVBcnJheVRvTWVtb3J5KGJ5dGVzLCBwdHIpOwogICAgICBjb25zdCByZXQgPSBtb2R1bGUuX2pwMl9kZWNvZGUocHRyLCBzaXplLCBudW1Db21wb25lbnRzID4gMCA/IG51bUNvbXBvbmVudHMgOiAwLCAhIWlzSW5kZXhlZENvbG9ybWFwLCAhIXNtYXNrSW5EYXRhLCByZWR1Y2VQb3dlcik7CiAgICAgIGlmIChyZXQpIHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBlcnJvck1lc3NhZ2VzCiAgICAgICAgfSA9IG1vZHVsZTsKICAgICAgICBpZiAoZXJyb3JNZXNzYWdlcykgewogICAgICAgICAgZGVsZXRlIG1vZHVsZS5lcnJvck1lc3NhZ2VzOwogICAgICAgICAgdGhyb3cgbmV3IEpweEVycm9yKGVycm9yTWVzc2FnZXMpOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgSnB4RXJyb3IoIlVua25vd24gZXJyb3IiKTsKICAgICAgfQogICAgICBjb25zdCB7CiAgICAgICAgaW1hZ2VEYXRhCiAgICAgIH0gPSBtb2R1bGU7CiAgICAgIG1vZHVsZS5pbWFnZURhdGEgPSBudWxsOwogICAgICByZXR1cm4gaW1hZ2VEYXRhOwogICAgfSBmaW5hbGx5IHsKICAgICAgaWYgKHB0cikgewogICAgICAgIG1vZHVsZS5fZnJlZShwdHIpOwogICAgICB9CiAgICB9CiAgfQogIHN0YXRpYyBjbGVhbnVwKCkgewogICAgdGhpcy4jbW9kdWxlUHJvbWlzZSA9IG51bGw7CiAgfQogIHN0YXRpYyBwYXJzZUltYWdlUHJvcGVydGllcyhzdHJlYW0pIHsKICAgIGxldCBuZXdCeXRlID0gc3RyZWFtLmdldEJ5dGUoKTsKICAgIHdoaWxlIChuZXdCeXRlID49IDApIHsKICAgICAgY29uc3Qgb2xkQnl0ZSA9IG5ld0J5dGU7CiAgICAgIG5ld0J5dGUgPSBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICBjb25zdCBjb2RlID0gb2xkQnl0ZSA8PCA4IHwgbmV3Qnl0ZTsKICAgICAgaWYgKGNvZGUgPT09IDB4ZmY1MSkgewogICAgICAgIHN0cmVhbS5za2lwKDQpOwogICAgICAgIGNvbnN0IFhzaXogPSBzdHJlYW0uZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgICBjb25zdCBZc2l6ID0gc3RyZWFtLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgY29uc3QgWE9zaXogPSBzdHJlYW0uZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgICBjb25zdCBZT3NpeiA9IHN0cmVhbS5nZXRJbnQzMigpID4+PiAwOwogICAgICAgIHN0cmVhbS5za2lwKDE2KTsKICAgICAgICBjb25zdCBDc2l6ID0gc3RyZWFtLmdldFVpbnQxNigpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICB3aWR0aDogWHNpeiAtIFhPc2l6LAogICAgICAgICAgaGVpZ2h0OiBZc2l6IC0gWU9zaXosCiAgICAgICAgICBiaXRzUGVyQ29tcG9uZW50OiA4LAogICAgICAgICAgY29tcG9uZW50c0NvdW50OiBDc2l6CiAgICAgICAgfTsKICAgICAgfQogICAgfQogICAgdGhyb3cgbmV3IEpweEVycm9yKCJObyBzaXplIG1hcmtlciBmb3VuZCBpbiBKUFggc3RyZWFtIik7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9vcGVyYXRvcl9saXN0LmpzCgpmdW5jdGlvbiBhZGRTdGF0ZShwYXJlbnRTdGF0ZSwgcGF0dGVybiwgY2hlY2tGbiwgaXRlcmF0ZUZuLCBwcm9jZXNzRm4pIHsKICBsZXQgc3RhdGUgPSBwYXJlbnRTdGF0ZTsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBwYXR0ZXJuLmxlbmd0aCAtIDE7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCBpdGVtID0gcGF0dGVybltpXTsKICAgIHN0YXRlID0gc3RhdGVbaXRlbV0gfHw9IFtdOwogIH0KICBzdGF0ZVtwYXR0ZXJuLmF0KC0xKV0gPSB7CiAgICBjaGVja0ZuLAogICAgaXRlcmF0ZUZuLAogICAgcHJvY2Vzc0ZuCiAgfTsKfQpjb25zdCBJbml0aWFsU3RhdGUgPSBbXTsKYWRkU3RhdGUoSW5pdGlhbFN0YXRlLCBbT1BTLnNhdmUsIE9QUy50cmFuc2Zvcm0sIE9QUy5wYWludElubGluZUltYWdlWE9iamVjdCwgT1BTLnJlc3RvcmVdLCBudWxsLCBmdW5jdGlvbiBpdGVyYXRlSW5saW5lSW1hZ2VHcm91cChjb250ZXh0LCBpKSB7CiAgY29uc3QgZm5BcnJheSA9IGNvbnRleHQuZm5BcnJheTsKICBjb25zdCBpRmlyc3RTYXZlID0gY29udGV4dC5pQ3VyciAtIDM7CiAgY29uc3QgcG9zID0gKGkgLSBpRmlyc3RTYXZlKSAlIDQ7CiAgc3dpdGNoIChwb3MpIHsKICAgIGNhc2UgMDoKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IE9QUy5zYXZlOwogICAgY2FzZSAxOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gT1BTLnRyYW5zZm9ybTsKICAgIGNhc2UgMjoKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IE9QUy5wYWludElubGluZUltYWdlWE9iamVjdDsKICAgIGNhc2UgMzoKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IE9QUy5yZXN0b3JlOwogIH0KICB0aHJvdyBuZXcgRXJyb3IoYGl0ZXJhdGVJbmxpbmVJbWFnZUdyb3VwIC0gaW52YWxpZCBwb3M6ICR7cG9zfWApOwp9LCBmdW5jdGlvbiBmb3VuZElubGluZUltYWdlR3JvdXAoY29udGV4dCwgaSkgewogIGNvbnN0IE1JTl9JTUFHRVNfSU5fSU5MSU5FX0lNQUdFU19CTE9DSyA9IDEwOwogIGNvbnN0IE1BWF9JTUFHRVNfSU5fSU5MSU5FX0lNQUdFU19CTE9DSyA9IDIwMDsKICBjb25zdCBNQVhfV0lEVEggPSAxMDAwOwogIGNvbnN0IElNQUdFX1BBRERJTkcgPSAxOwogIGNvbnN0IGZuQXJyYXkgPSBjb250ZXh0LmZuQXJyYXksCiAgICBhcmdzQXJyYXkgPSBjb250ZXh0LmFyZ3NBcnJheTsKICBjb25zdCBjdXJyID0gY29udGV4dC5pQ3VycjsKICBjb25zdCBpRmlyc3RTYXZlID0gY3VyciAtIDM7CiAgY29uc3QgaUZpcnN0VHJhbnNmb3JtID0gY3VyciAtIDI7CiAgY29uc3QgaUZpcnN0UElJWE8gPSBjdXJyIC0gMTsKICBjb25zdCBjb3VudCA9IE1hdGgubWluKE1hdGguZmxvb3IoKGkgLSBpRmlyc3RTYXZlKSAvIDQpLCBNQVhfSU1BR0VTX0lOX0lOTElORV9JTUFHRVNfQkxPQ0spOwogIGlmIChjb3VudCA8IE1JTl9JTUFHRVNfSU5fSU5MSU5FX0lNQUdFU19CTE9DSykgewogICAgcmV0dXJuIGkgLSAoaSAtIGlGaXJzdFNhdmUpICUgNDsKICB9CiAgbGV0IG1heFggPSAwOwogIGNvbnN0IG1hcCA9IFtdOwogIGxldCBtYXhMaW5lSGVpZ2h0ID0gMDsKICBsZXQgY3VycmVudFggPSBJTUFHRV9QQURESU5HLAogICAgY3VycmVudFkgPSBJTUFHRV9QQURESU5HOwogIGZvciAobGV0IHEgPSAwOyBxIDwgY291bnQ7IHErKykgewogICAgY29uc3QgdHJhbnNmb3JtID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybSArIChxIDw8IDIpXTsKICAgIGNvbnN0IGltZyA9IGFyZ3NBcnJheVtpRmlyc3RQSUlYTyArIChxIDw8IDIpXVswXTsKICAgIGlmIChjdXJyZW50WCArIGltZy53aWR0aCA+IE1BWF9XSURUSCkgewogICAgICBtYXhYID0gTWF0aC5tYXgobWF4WCwgY3VycmVudFgpOwogICAgICBjdXJyZW50WSArPSBtYXhMaW5lSGVpZ2h0ICsgMiAqIElNQUdFX1BBRERJTkc7CiAgICAgIGN1cnJlbnRYID0gMDsKICAgICAgbWF4TGluZUhlaWdodCA9IDA7CiAgICB9CiAgICBtYXAucHVzaCh7CiAgICAgIHRyYW5zZm9ybSwKICAgICAgeDogY3VycmVudFgsCiAgICAgIHk6IGN1cnJlbnRZLAogICAgICB3OiBpbWcud2lkdGgsCiAgICAgIGg6IGltZy5oZWlnaHQKICAgIH0pOwogICAgY3VycmVudFggKz0gaW1nLndpZHRoICsgMiAqIElNQUdFX1BBRERJTkc7CiAgICBtYXhMaW5lSGVpZ2h0ID0gTWF0aC5tYXgobWF4TGluZUhlaWdodCwgaW1nLmhlaWdodCk7CiAgfQogIGNvbnN0IGltZ1dpZHRoID0gTWF0aC5tYXgobWF4WCwgY3VycmVudFgpICsgSU1BR0VfUEFERElORzsKICBjb25zdCBpbWdIZWlnaHQgPSBjdXJyZW50WSArIG1heExpbmVIZWlnaHQgKyBJTUFHRV9QQURESU5HOwogIGNvbnN0IGltZ0RhdGEgPSBuZXcgVWludDhBcnJheShpbWdXaWR0aCAqIGltZ0hlaWdodCAqIDQpOwogIGNvbnN0IGltZ1Jvd1NpemUgPSBpbWdXaWR0aCA8PCAyOwogIGZvciAobGV0IHEgPSAwOyBxIDwgY291bnQ7IHErKykgewogICAgY29uc3QgZGF0YSA9IGFyZ3NBcnJheVtpRmlyc3RQSUlYTyArIChxIDw8IDIpXVswXS5kYXRhOwogICAgY29uc3Qgcm93U2l6ZSA9IG1hcFtxXS53IDw8IDI7CiAgICBsZXQgZGF0YU9mZnNldCA9IDA7CiAgICBsZXQgb2Zmc2V0ID0gbWFwW3FdLnggKyBtYXBbcV0ueSAqIGltZ1dpZHRoIDw8IDI7CiAgICBpbWdEYXRhLnNldChkYXRhLnN1YmFycmF5KDAsIHJvd1NpemUpLCBvZmZzZXQgLSBpbWdSb3dTaXplKTsKICAgIGZvciAobGV0IGsgPSAwLCBrayA9IG1hcFtxXS5oOyBrIDwga2s7IGsrKykgewogICAgICBpbWdEYXRhLnNldChkYXRhLnN1YmFycmF5KGRhdGFPZmZzZXQsIGRhdGFPZmZzZXQgKyByb3dTaXplKSwgb2Zmc2V0KTsKICAgICAgZGF0YU9mZnNldCArPSByb3dTaXplOwogICAgICBvZmZzZXQgKz0gaW1nUm93U2l6ZTsKICAgIH0KICAgIGltZ0RhdGEuc2V0KGRhdGEuc3ViYXJyYXkoZGF0YU9mZnNldCAtIHJvd1NpemUsIGRhdGFPZmZzZXQpLCBvZmZzZXQpOwogICAgd2hpbGUgKG9mZnNldCA+PSAwKSB7CiAgICAgIGRhdGFbb2Zmc2V0IC0gNF0gPSBkYXRhW29mZnNldF07CiAgICAgIGRhdGFbb2Zmc2V0IC0gM10gPSBkYXRhW29mZnNldCArIDFdOwogICAgICBkYXRhW29mZnNldCAtIDJdID0gZGF0YVtvZmZzZXQgKyAyXTsKICAgICAgZGF0YVtvZmZzZXQgLSAxXSA9IGRhdGFbb2Zmc2V0ICsgM107CiAgICAgIGRhdGFbb2Zmc2V0ICsgcm93U2l6ZV0gPSBkYXRhW29mZnNldCArIHJvd1NpemUgLSA0XTsKICAgICAgZGF0YVtvZmZzZXQgKyByb3dTaXplICsgMV0gPSBkYXRhW29mZnNldCArIHJvd1NpemUgLSAzXTsKICAgICAgZGF0YVtvZmZzZXQgKyByb3dTaXplICsgMl0gPSBkYXRhW29mZnNldCArIHJvd1NpemUgLSAyXTsKICAgICAgZGF0YVtvZmZzZXQgKyByb3dTaXplICsgM10gPSBkYXRhW29mZnNldCArIHJvd1NpemUgLSAxXTsKICAgICAgb2Zmc2V0IC09IGltZ1Jvd1NpemU7CiAgICB9CiAgfQogIGNvbnN0IGltZyA9IHsKICAgIHdpZHRoOiBpbWdXaWR0aCwKICAgIGhlaWdodDogaW1nSGVpZ2h0CiAgfTsKICBpZiAoY29udGV4dC5pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCkgewogICAgY29uc3QgY2FudmFzID0gbmV3IE9mZnNjcmVlbkNhbnZhcyhpbWdXaWR0aCwgaW1nSGVpZ2h0KTsKICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgY3R4LnB1dEltYWdlRGF0YShuZXcgSW1hZ2VEYXRhKG5ldyBVaW50OENsYW1wZWRBcnJheShpbWdEYXRhLmJ1ZmZlciksIGltZ1dpZHRoLCBpbWdIZWlnaHQpLCAwLCAwKTsKICAgIGltZy5iaXRtYXAgPSBjYW52YXMudHJhbnNmZXJUb0ltYWdlQml0bWFwKCk7CiAgICBpbWcuZGF0YSA9IG51bGw7CiAgfSBlbHNlIHsKICAgIGltZy5raW5kID0gSW1hZ2VLaW5kLlJHQkFfMzJCUFA7CiAgICBpbWcuZGF0YSA9IGltZ0RhdGE7CiAgfQogIGZuQXJyYXkuc3BsaWNlKGlGaXJzdFNhdmUsIGNvdW50ICogNCwgT1BTLnBhaW50SW5saW5lSW1hZ2VYT2JqZWN0R3JvdXApOwogIGFyZ3NBcnJheS5zcGxpY2UoaUZpcnN0U2F2ZSwgY291bnQgKiA0LCBbaW1nLCBtYXBdKTsKICByZXR1cm4gaUZpcnN0U2F2ZSArIDE7Cn0pOwphZGRTdGF0ZShJbml0aWFsU3RhdGUsIFtPUFMuc2F2ZSwgT1BTLnRyYW5zZm9ybSwgT1BTLnBhaW50SW1hZ2VNYXNrWE9iamVjdCwgT1BTLnJlc3RvcmVdLCBudWxsLCBmdW5jdGlvbiBpdGVyYXRlSW1hZ2VNYXNrR3JvdXAoY29udGV4dCwgaSkgewogIGNvbnN0IGZuQXJyYXkgPSBjb250ZXh0LmZuQXJyYXk7CiAgY29uc3QgaUZpcnN0U2F2ZSA9IGNvbnRleHQuaUN1cnIgLSAzOwogIGNvbnN0IHBvcyA9IChpIC0gaUZpcnN0U2F2ZSkgJSA0OwogIHN3aXRjaCAocG9zKSB7CiAgICBjYXNlIDA6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMuc2F2ZTsKICAgIGNhc2UgMToKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IE9QUy50cmFuc2Zvcm07CiAgICBjYXNlIDI6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMucGFpbnRJbWFnZU1hc2tYT2JqZWN0OwogICAgY2FzZSAzOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gT1BTLnJlc3RvcmU7CiAgfQogIHRocm93IG5ldyBFcnJvcihgaXRlcmF0ZUltYWdlTWFza0dyb3VwIC0gaW52YWxpZCBwb3M6ICR7cG9zfWApOwp9LCBmdW5jdGlvbiBmb3VuZEltYWdlTWFza0dyb3VwKGNvbnRleHQsIGkpIHsKICBjb25zdCBNSU5fSU1BR0VTX0lOX01BU0tTX0JMT0NLID0gMTA7CiAgY29uc3QgTUFYX0lNQUdFU19JTl9NQVNLU19CTE9DSyA9IDEwMDsKICBjb25zdCBNQVhfU0FNRV9JTUFHRVNfSU5fTUFTS1NfQkxPQ0sgPSAxMDAwOwogIGNvbnN0IGZuQXJyYXkgPSBjb250ZXh0LmZuQXJyYXksCiAgICBhcmdzQXJyYXkgPSBjb250ZXh0LmFyZ3NBcnJheTsKICBjb25zdCBjdXJyID0gY29udGV4dC5pQ3VycjsKICBjb25zdCBpRmlyc3RTYXZlID0gY3VyciAtIDM7CiAgY29uc3QgaUZpcnN0VHJhbnNmb3JtID0gY3VyciAtIDI7CiAgY29uc3QgaUZpcnN0UElNWE8gPSBjdXJyIC0gMTsKICBsZXQgY291bnQgPSBNYXRoLmZsb29yKChpIC0gaUZpcnN0U2F2ZSkgLyA0KTsKICBpZiAoY291bnQgPCBNSU5fSU1BR0VTX0lOX01BU0tTX0JMT0NLKSB7CiAgICByZXR1cm4gaSAtIChpIC0gaUZpcnN0U2F2ZSkgJSA0OwogIH0KICBsZXQgaXNTYW1lSW1hZ2UgPSBmYWxzZTsKICBsZXQgaVRyYW5zZm9ybSwgdHJhbnNmb3JtQXJnczsKICBjb25zdCBmaXJzdFBJTVhPQXJnMCA9IGFyZ3NBcnJheVtpRmlyc3RQSU1YT11bMF07CiAgY29uc3QgZmlyc3RUcmFuc2Zvcm1BcmcwID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV1bMF0sCiAgICBmaXJzdFRyYW5zZm9ybUFyZzEgPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXVsxXSwKICAgIGZpcnN0VHJhbnNmb3JtQXJnMiA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzJdLAogICAgZmlyc3RUcmFuc2Zvcm1BcmczID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV1bM107CiAgaWYgKGZpcnN0VHJhbnNmb3JtQXJnMSA9PT0gZmlyc3RUcmFuc2Zvcm1BcmcyKSB7CiAgICBpc1NhbWVJbWFnZSA9IHRydWU7CiAgICBpVHJhbnNmb3JtID0gaUZpcnN0VHJhbnNmb3JtICsgNDsKICAgIGxldCBpUElNWE8gPSBpRmlyc3RQSU1YTyArIDQ7CiAgICBmb3IgKGxldCBxID0gMTsgcSA8IGNvdW50OyBxKyssIGlUcmFuc2Zvcm0gKz0gNCwgaVBJTVhPICs9IDQpIHsKICAgICAgdHJhbnNmb3JtQXJncyA9IGFyZ3NBcnJheVtpVHJhbnNmb3JtXTsKICAgICAgaWYgKGFyZ3NBcnJheVtpUElNWE9dWzBdICE9PSBmaXJzdFBJTVhPQXJnMCB8fCB0cmFuc2Zvcm1BcmdzWzBdICE9PSBmaXJzdFRyYW5zZm9ybUFyZzAgfHwgdHJhbnNmb3JtQXJnc1sxXSAhPT0gZmlyc3RUcmFuc2Zvcm1BcmcxIHx8IHRyYW5zZm9ybUFyZ3NbMl0gIT09IGZpcnN0VHJhbnNmb3JtQXJnMiB8fCB0cmFuc2Zvcm1BcmdzWzNdICE9PSBmaXJzdFRyYW5zZm9ybUFyZzMpIHsKICAgICAgICBpZiAocSA8IE1JTl9JTUFHRVNfSU5fTUFTS1NfQkxPQ0spIHsKICAgICAgICAgIGlzU2FtZUltYWdlID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvdW50ID0gcTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9CiAgaWYgKGlzU2FtZUltYWdlKSB7CiAgICBjb3VudCA9IE1hdGgubWluKGNvdW50LCBNQVhfU0FNRV9JTUFHRVNfSU5fTUFTS1NfQkxPQ0spOwogICAgY29uc3QgcG9zaXRpb25zID0gbmV3IEZsb2F0MzJBcnJheShjb3VudCAqIDIpOwogICAgaVRyYW5zZm9ybSA9IGlGaXJzdFRyYW5zZm9ybTsKICAgIGZvciAobGV0IHEgPSAwOyBxIDwgY291bnQ7IHErKywgaVRyYW5zZm9ybSArPSA0KSB7CiAgICAgIHRyYW5zZm9ybUFyZ3MgPSBhcmdzQXJyYXlbaVRyYW5zZm9ybV07CiAgICAgIHBvc2l0aW9uc1txIDw8IDFdID0gdHJhbnNmb3JtQXJnc1s0XTsKICAgICAgcG9zaXRpb25zWyhxIDw8IDEpICsgMV0gPSB0cmFuc2Zvcm1BcmdzWzVdOwogICAgfQogICAgZm5BcnJheS5zcGxpY2UoaUZpcnN0U2F2ZSwgY291bnQgKiA0LCBPUFMucGFpbnRJbWFnZU1hc2tYT2JqZWN0UmVwZWF0KTsKICAgIGFyZ3NBcnJheS5zcGxpY2UoaUZpcnN0U2F2ZSwgY291bnQgKiA0LCBbZmlyc3RQSU1YT0FyZzAsIGZpcnN0VHJhbnNmb3JtQXJnMCwgZmlyc3RUcmFuc2Zvcm1BcmcxLCBmaXJzdFRyYW5zZm9ybUFyZzIsIGZpcnN0VHJhbnNmb3JtQXJnMywgcG9zaXRpb25zXSk7CiAgfSBlbHNlIHsKICAgIGNvdW50ID0gTWF0aC5taW4oY291bnQsIE1BWF9JTUFHRVNfSU5fTUFTS1NfQkxPQ0spOwogICAgY29uc3QgaW1hZ2VzID0gW107CiAgICBmb3IgKGxldCBxID0gMDsgcSA8IGNvdW50OyBxKyspIHsKICAgICAgdHJhbnNmb3JtQXJncyA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm0gKyAocSA8PCAyKV07CiAgICAgIGNvbnN0IG1hc2tQYXJhbXMgPSBhcmdzQXJyYXlbaUZpcnN0UElNWE8gKyAocSA8PCAyKV1bMF07CiAgICAgIGltYWdlcy5wdXNoKHsKICAgICAgICBkYXRhOiBtYXNrUGFyYW1zLmRhdGEsCiAgICAgICAgd2lkdGg6IG1hc2tQYXJhbXMud2lkdGgsCiAgICAgICAgaGVpZ2h0OiBtYXNrUGFyYW1zLmhlaWdodCwKICAgICAgICBpbnRlcnBvbGF0ZTogbWFza1BhcmFtcy5pbnRlcnBvbGF0ZSwKICAgICAgICBjb3VudDogbWFza1BhcmFtcy5jb3VudCwKICAgICAgICB0cmFuc2Zvcm06IHRyYW5zZm9ybUFyZ3MKICAgICAgfSk7CiAgICB9CiAgICBmbkFycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIE9QUy5wYWludEltYWdlTWFza1hPYmplY3RHcm91cCk7CiAgICBhcmdzQXJyYXkuc3BsaWNlKGlGaXJzdFNhdmUsIGNvdW50ICogNCwgW2ltYWdlc10pOwogIH0KICByZXR1cm4gaUZpcnN0U2F2ZSArIDE7Cn0pOwphZGRTdGF0ZShJbml0aWFsU3RhdGUsIFtPUFMuc2F2ZSwgT1BTLnRyYW5zZm9ybSwgT1BTLnBhaW50SW1hZ2VYT2JqZWN0LCBPUFMucmVzdG9yZV0sIGZ1bmN0aW9uIChjb250ZXh0KSB7CiAgY29uc3QgYXJnc0FycmF5ID0gY29udGV4dC5hcmdzQXJyYXk7CiAgY29uc3QgaUZpcnN0VHJhbnNmb3JtID0gY29udGV4dC5pQ3VyciAtIDI7CiAgcmV0dXJuIGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzFdID09PSAwICYmIGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzJdID09PSAwOwp9LCBmdW5jdGlvbiBpdGVyYXRlSW1hZ2VHcm91cChjb250ZXh0LCBpKSB7CiAgY29uc3QgZm5BcnJheSA9IGNvbnRleHQuZm5BcnJheSwKICAgIGFyZ3NBcnJheSA9IGNvbnRleHQuYXJnc0FycmF5OwogIGNvbnN0IGlGaXJzdFNhdmUgPSBjb250ZXh0LmlDdXJyIC0gMzsKICBjb25zdCBwb3MgPSAoaSAtIGlGaXJzdFNhdmUpICUgNDsKICBzd2l0Y2ggKHBvcykgewogICAgY2FzZSAwOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gT1BTLnNhdmU7CiAgICBjYXNlIDE6CiAgICAgIGlmIChmbkFycmF5W2ldICE9PSBPUFMudHJhbnNmb3JtKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGNvbnN0IGlGaXJzdFRyYW5zZm9ybSA9IGNvbnRleHQuaUN1cnIgLSAyOwogICAgICBjb25zdCBmaXJzdFRyYW5zZm9ybUFyZzAgPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXVswXTsKICAgICAgY29uc3QgZmlyc3RUcmFuc2Zvcm1BcmczID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV1bM107CiAgICAgIGlmIChhcmdzQXJyYXlbaV1bMF0gIT09IGZpcnN0VHJhbnNmb3JtQXJnMCB8fCBhcmdzQXJyYXlbaV1bMV0gIT09IDAgfHwgYXJnc0FycmF5W2ldWzJdICE9PSAwIHx8IGFyZ3NBcnJheVtpXVszXSAhPT0gZmlyc3RUcmFuc2Zvcm1BcmczKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgY2FzZSAyOgogICAgICBpZiAoZm5BcnJheVtpXSAhPT0gT1BTLnBhaW50SW1hZ2VYT2JqZWN0KSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGNvbnN0IGlGaXJzdFBJWE8gPSBjb250ZXh0LmlDdXJyIC0gMTsKICAgICAgY29uc3QgZmlyc3RQSVhPQXJnMCA9IGFyZ3NBcnJheVtpRmlyc3RQSVhPXVswXTsKICAgICAgaWYgKGFyZ3NBcnJheVtpXVswXSAhPT0gZmlyc3RQSVhPQXJnMCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIGNhc2UgMzoKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IE9QUy5yZXN0b3JlOwogIH0KICB0aHJvdyBuZXcgRXJyb3IoYGl0ZXJhdGVJbWFnZUdyb3VwIC0gaW52YWxpZCBwb3M6ICR7cG9zfWApOwp9LCBmdW5jdGlvbiAoY29udGV4dCwgaSkgewogIGNvbnN0IE1JTl9JTUFHRVNfSU5fQkxPQ0sgPSAzOwogIGNvbnN0IE1BWF9JTUFHRVNfSU5fQkxPQ0sgPSAxMDAwOwogIGNvbnN0IGZuQXJyYXkgPSBjb250ZXh0LmZuQXJyYXksCiAgICBhcmdzQXJyYXkgPSBjb250ZXh0LmFyZ3NBcnJheTsKICBjb25zdCBjdXJyID0gY29udGV4dC5pQ3VycjsKICBjb25zdCBpRmlyc3RTYXZlID0gY3VyciAtIDM7CiAgY29uc3QgaUZpcnN0VHJhbnNmb3JtID0gY3VyciAtIDI7CiAgY29uc3QgaUZpcnN0UElYTyA9IGN1cnIgLSAxOwogIGNvbnN0IGZpcnN0UElYT0FyZzAgPSBhcmdzQXJyYXlbaUZpcnN0UElYT11bMF07CiAgY29uc3QgZmlyc3RUcmFuc2Zvcm1BcmcwID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV1bMF07CiAgY29uc3QgZmlyc3RUcmFuc2Zvcm1BcmczID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV1bM107CiAgY29uc3QgY291bnQgPSBNYXRoLm1pbihNYXRoLmZsb29yKChpIC0gaUZpcnN0U2F2ZSkgLyA0KSwgTUFYX0lNQUdFU19JTl9CTE9DSyk7CiAgaWYgKGNvdW50IDwgTUlOX0lNQUdFU19JTl9CTE9DSykgewogICAgcmV0dXJuIGkgLSAoaSAtIGlGaXJzdFNhdmUpICUgNDsKICB9CiAgY29uc3QgcG9zaXRpb25zID0gbmV3IEZsb2F0MzJBcnJheShjb3VudCAqIDIpOwogIGxldCBpVHJhbnNmb3JtID0gaUZpcnN0VHJhbnNmb3JtOwogIGZvciAobGV0IHEgPSAwOyBxIDwgY291bnQ7IHErKywgaVRyYW5zZm9ybSArPSA0KSB7CiAgICBjb25zdCB0cmFuc2Zvcm1BcmdzID0gYXJnc0FycmF5W2lUcmFuc2Zvcm1dOwogICAgcG9zaXRpb25zW3EgPDwgMV0gPSB0cmFuc2Zvcm1BcmdzWzRdOwogICAgcG9zaXRpb25zWyhxIDw8IDEpICsgMV0gPSB0cmFuc2Zvcm1BcmdzWzVdOwogIH0KICBjb25zdCBhcmdzID0gW2ZpcnN0UElYT0FyZzAsIGZpcnN0VHJhbnNmb3JtQXJnMCwgZmlyc3RUcmFuc2Zvcm1BcmczLCBwb3NpdGlvbnNdOwogIGZuQXJyYXkuc3BsaWNlKGlGaXJzdFNhdmUsIGNvdW50ICogNCwgT1BTLnBhaW50SW1hZ2VYT2JqZWN0UmVwZWF0KTsKICBhcmdzQXJyYXkuc3BsaWNlKGlGaXJzdFNhdmUsIGNvdW50ICogNCwgYXJncyk7CiAgcmV0dXJuIGlGaXJzdFNhdmUgKyAxOwp9KTsKYWRkU3RhdGUoSW5pdGlhbFN0YXRlLCBbT1BTLmJlZ2luVGV4dCwgT1BTLnNldEZvbnQsIE9QUy5zZXRUZXh0TWF0cml4LCBPUFMuc2hvd1RleHQsIE9QUy5lbmRUZXh0XSwgbnVsbCwgZnVuY3Rpb24gaXRlcmF0ZVNob3dUZXh0R3JvdXAoY29udGV4dCwgaSkgewogIGNvbnN0IGZuQXJyYXkgPSBjb250ZXh0LmZuQXJyYXksCiAgICBhcmdzQXJyYXkgPSBjb250ZXh0LmFyZ3NBcnJheTsKICBjb25zdCBpRmlyc3RTYXZlID0gY29udGV4dC5pQ3VyciAtIDQ7CiAgY29uc3QgcG9zID0gKGkgLSBpRmlyc3RTYXZlKSAlIDU7CiAgc3dpdGNoIChwb3MpIHsKICAgIGNhc2UgMDoKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IE9QUy5iZWdpblRleHQ7CiAgICBjYXNlIDE6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMuc2V0Rm9udDsKICAgIGNhc2UgMjoKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IE9QUy5zZXRUZXh0TWF0cml4OwogICAgY2FzZSAzOgogICAgICBpZiAoZm5BcnJheVtpXSAhPT0gT1BTLnNob3dUZXh0KSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGNvbnN0IGlGaXJzdFNldEZvbnQgPSBjb250ZXh0LmlDdXJyIC0gMzsKICAgICAgY29uc3QgZmlyc3RTZXRGb250QXJnMCA9IGFyZ3NBcnJheVtpRmlyc3RTZXRGb250XVswXTsKICAgICAgY29uc3QgZmlyc3RTZXRGb250QXJnMSA9IGFyZ3NBcnJheVtpRmlyc3RTZXRGb250XVsxXTsKICAgICAgaWYgKGFyZ3NBcnJheVtpXVswXSAhPT0gZmlyc3RTZXRGb250QXJnMCB8fCBhcmdzQXJyYXlbaV1bMV0gIT09IGZpcnN0U2V0Rm9udEFyZzEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICBjYXNlIDQ6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBPUFMuZW5kVGV4dDsKICB9CiAgdGhyb3cgbmV3IEVycm9yKGBpdGVyYXRlU2hvd1RleHRHcm91cCAtIGludmFsaWQgcG9zOiAke3Bvc31gKTsKfSwgZnVuY3Rpb24gKGNvbnRleHQsIGkpIHsKICBjb25zdCBNSU5fQ0hBUlNfSU5fQkxPQ0sgPSAzOwogIGNvbnN0IE1BWF9DSEFSU19JTl9CTE9DSyA9IDEwMDA7CiAgY29uc3QgZm5BcnJheSA9IGNvbnRleHQuZm5BcnJheSwKICAgIGFyZ3NBcnJheSA9IGNvbnRleHQuYXJnc0FycmF5OwogIGNvbnN0IGN1cnIgPSBjb250ZXh0LmlDdXJyOwogIGNvbnN0IGlGaXJzdEJlZ2luVGV4dCA9IGN1cnIgLSA0OwogIGNvbnN0IGlGaXJzdFNldEZvbnQgPSBjdXJyIC0gMzsKICBjb25zdCBpRmlyc3RTZXRUZXh0TWF0cml4ID0gY3VyciAtIDI7CiAgY29uc3QgaUZpcnN0U2hvd1RleHQgPSBjdXJyIC0gMTsKICBjb25zdCBpRmlyc3RFbmRUZXh0ID0gY3VycjsKICBjb25zdCBmaXJzdFNldEZvbnRBcmcwID0gYXJnc0FycmF5W2lGaXJzdFNldEZvbnRdWzBdOwogIGNvbnN0IGZpcnN0U2V0Rm9udEFyZzEgPSBhcmdzQXJyYXlbaUZpcnN0U2V0Rm9udF1bMV07CiAgbGV0IGNvdW50ID0gTWF0aC5taW4oTWF0aC5mbG9vcigoaSAtIGlGaXJzdEJlZ2luVGV4dCkgLyA1KSwgTUFYX0NIQVJTX0lOX0JMT0NLKTsKICBpZiAoY291bnQgPCBNSU5fQ0hBUlNfSU5fQkxPQ0spIHsKICAgIHJldHVybiBpIC0gKGkgLSBpRmlyc3RCZWdpblRleHQpICUgNTsKICB9CiAgbGV0IGlGaXJzdCA9IGlGaXJzdEJlZ2luVGV4dDsKICBpZiAoaUZpcnN0QmVnaW5UZXh0ID49IDQgJiYgZm5BcnJheVtpRmlyc3RCZWdpblRleHQgLSA0XSA9PT0gZm5BcnJheVtpRmlyc3RTZXRGb250XSAmJiBmbkFycmF5W2lGaXJzdEJlZ2luVGV4dCAtIDNdID09PSBmbkFycmF5W2lGaXJzdFNldFRleHRNYXRyaXhdICYmIGZuQXJyYXlbaUZpcnN0QmVnaW5UZXh0IC0gMl0gPT09IGZuQXJyYXlbaUZpcnN0U2hvd1RleHRdICYmIGZuQXJyYXlbaUZpcnN0QmVnaW5UZXh0IC0gMV0gPT09IGZuQXJyYXlbaUZpcnN0RW5kVGV4dF0gJiYgYXJnc0FycmF5W2lGaXJzdEJlZ2luVGV4dCAtIDRdWzBdID09PSBmaXJzdFNldEZvbnRBcmcwICYmIGFyZ3NBcnJheVtpRmlyc3RCZWdpblRleHQgLSA0XVsxXSA9PT0gZmlyc3RTZXRGb250QXJnMSkgewogICAgY291bnQrKzsKICAgIGlGaXJzdCAtPSA1OwogIH0KICBsZXQgaUVuZFRleHQgPSBpRmlyc3QgKyA0OwogIGZvciAobGV0IHEgPSAxOyBxIDwgY291bnQ7IHErKykgewogICAgZm5BcnJheS5zcGxpY2UoaUVuZFRleHQsIDMpOwogICAgYXJnc0FycmF5LnNwbGljZShpRW5kVGV4dCwgMyk7CiAgICBpRW5kVGV4dCArPSAyOwogIH0KICByZXR1cm4gaUVuZFRleHQgKyAxOwp9KTsKYWRkU3RhdGUoSW5pdGlhbFN0YXRlLCBbT1BTLnNhdmUsIE9QUy50cmFuc2Zvcm0sIE9QUy5jb25zdHJ1Y3RQYXRoLCBPUFMucmVzdG9yZV0sIGNvbnRleHQgPT4gewogIGNvbnN0IGFyZ3NBcnJheSA9IGNvbnRleHQuYXJnc0FycmF5OwogIGNvbnN0IGlGaXJzdENvbnN0cnVjdFBhdGggPSBjb250ZXh0LmlDdXJyIC0gMTsKICBjb25zdCBvcCA9IGFyZ3NBcnJheVtpRmlyc3RDb25zdHJ1Y3RQYXRoXVswXTsKICBpZiAob3AgIT09IE9QUy5zdHJva2UgJiYgb3AgIT09IE9QUy5jbG9zZVN0cm9rZSAmJiBvcCAhPT0gT1BTLmZpbGxTdHJva2UgJiYgb3AgIT09IE9QUy5lb0ZpbGxTdHJva2UgJiYgb3AgIT09IE9QUy5jbG9zZUZpbGxTdHJva2UgJiYgb3AgIT09IE9QUy5jbG9zZUVPRmlsbFN0cm9rZSkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGNvbnN0IGlGaXJzdFRyYW5zZm9ybSA9IGNvbnRleHQuaUN1cnIgLSAyOwogIGNvbnN0IHRyYW5zZm9ybSA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dOwogIHJldHVybiB0cmFuc2Zvcm1bMF0gPT09IDEgJiYgdHJhbnNmb3JtWzFdID09PSAwICYmIHRyYW5zZm9ybVsyXSA9PT0gMCAmJiB0cmFuc2Zvcm1bM10gPT09IDE7Cn0sICgpID0+IGZhbHNlLCAoY29udGV4dCwgaSkgPT4gewogIGNvbnN0IHsKICAgIGZuQXJyYXksCiAgICBhcmdzQXJyYXkKICB9ID0gY29udGV4dDsKICBjb25zdCBjdXJyID0gY29udGV4dC5pQ3VycjsKICBjb25zdCBpRmlyc3RTYXZlID0gY3VyciAtIDM7CiAgY29uc3QgaUZpcnN0VHJhbnNmb3JtID0gY3VyciAtIDI7CiAgY29uc3QgaUZpcnN0Q29uc3RydWN0UGF0aCA9IGN1cnIgLSAxOwogIGNvbnN0IGFyZ3MgPSBhcmdzQXJyYXlbaUZpcnN0Q29uc3RydWN0UGF0aF07CiAgY29uc3QgdHJhbnNmb3JtID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV07CiAgY29uc3QgWywgW2J1ZmZlcl0sIG1pbk1heF0gPSBhcmdzOwogIGlmIChtaW5NYXgpIHsKICAgIFV0aWwuc2NhbGVNaW5NYXgodHJhbnNmb3JtLCBtaW5NYXgpOwogICAgZm9yIChsZXQgayA9IDAsIGtrID0gYnVmZmVyLmxlbmd0aDsgayA8IGtrOykgewogICAgICBzd2l0Y2ggKGJ1ZmZlcltrKytdKSB7CiAgICAgICAgY2FzZSBEcmF3T1BTLm1vdmVUbzoKICAgICAgICBjYXNlIERyYXdPUFMubGluZVRvOgogICAgICAgICAgVXRpbC5hcHBseVRyYW5zZm9ybShidWZmZXIsIHRyYW5zZm9ybSwgayk7CiAgICAgICAgICBrICs9IDI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIERyYXdPUFMuY3VydmVUbzoKICAgICAgICAgIFV0aWwuYXBwbHlUcmFuc2Zvcm1Ub0JlemllcihidWZmZXIsIHRyYW5zZm9ybSwgayk7CiAgICAgICAgICBrICs9IDY7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogIH0KICBmbkFycmF5LnNwbGljZShpRmlyc3RTYXZlLCA0LCBPUFMuY29uc3RydWN0UGF0aCk7CiAgYXJnc0FycmF5LnNwbGljZShpRmlyc3RTYXZlLCA0LCBhcmdzKTsKICByZXR1cm4gaUZpcnN0U2F2ZSArIDE7Cn0pOwpjbGFzcyBOdWxsT3B0aW1pemVyIHsKICBjb25zdHJ1Y3RvcihxdWV1ZSkgewogICAgdGhpcy5xdWV1ZSA9IHF1ZXVlOwogIH0KICBfb3B0aW1pemUoKSB7fQogIHB1c2goZm4sIGFyZ3MpIHsKICAgIHRoaXMucXVldWUuZm5BcnJheS5wdXNoKGZuKTsKICAgIHRoaXMucXVldWUuYXJnc0FycmF5LnB1c2goYXJncyk7CiAgICB0aGlzLl9vcHRpbWl6ZSgpOwogIH0KICBmbHVzaCgpIHt9CiAgcmVzZXQoKSB7fQp9CmNsYXNzIFF1ZXVlT3B0aW1pemVyIGV4dGVuZHMgTnVsbE9wdGltaXplciB7CiAgY29uc3RydWN0b3IocXVldWUpIHsKICAgIHN1cGVyKHF1ZXVlKTsKICAgIHRoaXMuc3RhdGUgPSBudWxsOwogICAgdGhpcy5jb250ZXh0ID0gewogICAgICBpQ3VycjogMCwKICAgICAgZm5BcnJheTogcXVldWUuZm5BcnJheSwKICAgICAgYXJnc0FycmF5OiBxdWV1ZS5hcmdzQXJyYXksCiAgICAgIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkOiBPcGVyYXRvckxpc3QuaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQKICAgIH07CiAgICB0aGlzLm1hdGNoID0gbnVsbDsKICAgIHRoaXMubGFzdFByb2Nlc3NlZCA9IDA7CiAgfQogIF9vcHRpbWl6ZSgpIHsKICAgIGNvbnN0IGZuQXJyYXkgPSB0aGlzLnF1ZXVlLmZuQXJyYXk7CiAgICBsZXQgaSA9IHRoaXMubGFzdFByb2Nlc3NlZCwKICAgICAgaWkgPSBmbkFycmF5Lmxlbmd0aDsKICAgIGxldCBzdGF0ZSA9IHRoaXMuc3RhdGU7CiAgICBsZXQgbWF0Y2ggPSB0aGlzLm1hdGNoOwogICAgaWYgKCFzdGF0ZSAmJiAhbWF0Y2ggJiYgaSArIDEgPT09IGlpICYmICFJbml0aWFsU3RhdGVbZm5BcnJheVtpXV0pIHsKICAgICAgdGhpcy5sYXN0UHJvY2Vzc2VkID0gaWk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGNvbnRleHQgPSB0aGlzLmNvbnRleHQ7CiAgICB3aGlsZSAoaSA8IGlpKSB7CiAgICAgIGlmIChtYXRjaCkgewogICAgICAgIGNvbnN0IGl0ZXJhdGUgPSAoMCwgbWF0Y2guaXRlcmF0ZUZuKShjb250ZXh0LCBpKTsKICAgICAgICBpZiAoaXRlcmF0ZSkgewogICAgICAgICAgaSsrOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGkgPSAoMCwgbWF0Y2gucHJvY2Vzc0ZuKShjb250ZXh0LCBpICsgMSk7CiAgICAgICAgaWkgPSBmbkFycmF5Lmxlbmd0aDsKICAgICAgICBtYXRjaCA9IG51bGw7CiAgICAgICAgc3RhdGUgPSBudWxsOwogICAgICAgIGlmIChpID49IGlpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgc3RhdGUgPSAoc3RhdGUgfHwgSW5pdGlhbFN0YXRlKVtmbkFycmF5W2ldXTsKICAgICAgaWYgKCFzdGF0ZSB8fCBBcnJheS5pc0FycmF5KHN0YXRlKSkgewogICAgICAgIGkrKzsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb250ZXh0LmlDdXJyID0gaTsKICAgICAgaSsrOwogICAgICBpZiAoc3RhdGUuY2hlY2tGbiAmJiAhKDAsIHN0YXRlLmNoZWNrRm4pKGNvbnRleHQpKSB7CiAgICAgICAgc3RhdGUgPSBudWxsOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIG1hdGNoID0gc3RhdGU7CiAgICAgIHN0YXRlID0gbnVsbDsKICAgIH0KICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTsKICAgIHRoaXMubWF0Y2ggPSBtYXRjaDsKICAgIHRoaXMubGFzdFByb2Nlc3NlZCA9IGk7CiAgfQogIGZsdXNoKCkgewogICAgd2hpbGUgKHRoaXMubWF0Y2gpIHsKICAgICAgY29uc3QgbGVuZ3RoID0gdGhpcy5xdWV1ZS5mbkFycmF5Lmxlbmd0aDsKICAgICAgdGhpcy5sYXN0UHJvY2Vzc2VkID0gKDAsIHRoaXMubWF0Y2gucHJvY2Vzc0ZuKSh0aGlzLmNvbnRleHQsIGxlbmd0aCk7CiAgICAgIHRoaXMubWF0Y2ggPSBudWxsOwogICAgICB0aGlzLnN0YXRlID0gbnVsbDsKICAgICAgdGhpcy5fb3B0aW1pemUoKTsKICAgIH0KICB9CiAgcmVzZXQoKSB7CiAgICB0aGlzLnN0YXRlID0gbnVsbDsKICAgIHRoaXMubWF0Y2ggPSBudWxsOwogICAgdGhpcy5sYXN0UHJvY2Vzc2VkID0gMDsKICB9Cn0KY2xhc3MgT3BlcmF0b3JMaXN0IHsKICBzdGF0aWMgQ0hVTktfU0laRSA9IDEwMDA7CiAgc3RhdGljIENIVU5LX1NJWkVfQUJPVVQgPSB0aGlzLkNIVU5LX1NJWkUgLSA1OwogIHN0YXRpYyBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCA9IGZhbHNlOwogIGNvbnN0cnVjdG9yKGludGVudCA9IDAsIHN0cmVhbVNpbmspIHsKICAgIHRoaXMuX3N0cmVhbVNpbmsgPSBzdHJlYW1TaW5rOwogICAgdGhpcy5mbkFycmF5ID0gW107CiAgICB0aGlzLmFyZ3NBcnJheSA9IFtdOwogICAgdGhpcy5vcHRpbWl6ZXIgPSBzdHJlYW1TaW5rICYmICEoaW50ZW50ICYgUmVuZGVyaW5nSW50ZW50RmxhZy5PUExJU1QpID8gbmV3IFF1ZXVlT3B0aW1pemVyKHRoaXMpIDogbmV3IE51bGxPcHRpbWl6ZXIodGhpcyk7CiAgICB0aGlzLmRlcGVuZGVuY2llcyA9IG5ldyBTZXQoKTsKICAgIHRoaXMuX3RvdGFsTGVuZ3RoID0gMDsKICAgIHRoaXMud2VpZ2h0ID0gMDsKICAgIHRoaXMuX3Jlc29sdmVkID0gc3RyZWFtU2luayA/IG51bGwgOiBQcm9taXNlLnJlc29sdmUoKTsKICB9CiAgc3RhdGljIHNldE9wdGlvbnMoewogICAgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQKICB9KSB7CiAgICB0aGlzLmlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkID0gaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQ7CiAgfQogIGdldCBsZW5ndGgoKSB7CiAgICByZXR1cm4gdGhpcy5hcmdzQXJyYXkubGVuZ3RoOwogIH0KICBnZXQgcmVhZHkoKSB7CiAgICByZXR1cm4gdGhpcy5fcmVzb2x2ZWQgfHwgdGhpcy5fc3RyZWFtU2luay5yZWFkeTsKICB9CiAgZ2V0IHRvdGFsTGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuX3RvdGFsTGVuZ3RoICsgdGhpcy5sZW5ndGg7CiAgfQogIGFkZE9wKGZuLCBhcmdzKSB7CiAgICB0aGlzLm9wdGltaXplci5wdXNoKGZuLCBhcmdzKTsKICAgIHRoaXMud2VpZ2h0Kys7CiAgICBpZiAodGhpcy5fc3RyZWFtU2luaykgewogICAgICBpZiAodGhpcy53ZWlnaHQgPj0gT3BlcmF0b3JMaXN0LkNIVU5LX1NJWkUpIHsKICAgICAgICB0aGlzLmZsdXNoKCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy53ZWlnaHQgPj0gT3BlcmF0b3JMaXN0LkNIVU5LX1NJWkVfQUJPVVQgJiYgKGZuID09PSBPUFMucmVzdG9yZSB8fCBmbiA9PT0gT1BTLmVuZFRleHQpKSB7CiAgICAgICAgdGhpcy5mbHVzaCgpOwogICAgICB9CiAgICB9CiAgfQogIGFkZEltYWdlT3BzKGZuLCBhcmdzLCBvcHRpb25hbENvbnRlbnQsIGhhc01hc2sgPSBmYWxzZSkgewogICAgaWYgKGhhc01hc2spIHsKICAgICAgdGhpcy5hZGRPcChPUFMuc2F2ZSk7CiAgICAgIHRoaXMuYWRkT3AoT1BTLnNldEdTdGF0ZSwgW1tbIlNNYXNrIiwgZmFsc2VdXV0pOwogICAgfQogICAgaWYgKG9wdGlvbmFsQ29udGVudCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXMuYWRkT3AoT1BTLmJlZ2luTWFya2VkQ29udGVudFByb3BzLCBbIk9DIiwgb3B0aW9uYWxDb250ZW50XSk7CiAgICB9CiAgICB0aGlzLmFkZE9wKGZuLCBhcmdzKTsKICAgIGlmIChvcHRpb25hbENvbnRlbnQgIT09IHVuZGVmaW5lZCkgewogICAgICB0aGlzLmFkZE9wKE9QUy5lbmRNYXJrZWRDb250ZW50LCBbXSk7CiAgICB9CiAgICBpZiAoaGFzTWFzaykgewogICAgICB0aGlzLmFkZE9wKE9QUy5yZXN0b3JlKTsKICAgIH0KICB9CiAgYWRkRGVwZW5kZW5jeShkZXBlbmRlbmN5KSB7CiAgICBpZiAodGhpcy5kZXBlbmRlbmNpZXMuaGFzKGRlcGVuZGVuY3kpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuZGVwZW5kZW5jaWVzLmFkZChkZXBlbmRlbmN5KTsKICAgIHRoaXMuYWRkT3AoT1BTLmRlcGVuZGVuY3ksIFtkZXBlbmRlbmN5XSk7CiAgfQogIGFkZERlcGVuZGVuY2llcyhkZXBlbmRlbmNpZXMpIHsKICAgIGZvciAoY29uc3QgZGVwZW5kZW5jeSBvZiBkZXBlbmRlbmNpZXMpIHsKICAgICAgdGhpcy5hZGREZXBlbmRlbmN5KGRlcGVuZGVuY3kpOwogICAgfQogIH0KICBhZGRPcExpc3Qob3BMaXN0KSB7CiAgICBpZiAoIShvcExpc3QgaW5zdGFuY2VvZiBPcGVyYXRvckxpc3QpKSB7CiAgICAgIHdhcm4oJ2FkZE9wTGlzdCAtIGlnbm9yaW5nIGludmFsaWQgIm9wTGlzdCIgcGFyYW1ldGVyLicpOwogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IGRlcGVuZGVuY3kgb2Ygb3BMaXN0LmRlcGVuZGVuY2llcykgewogICAgICB0aGlzLmRlcGVuZGVuY2llcy5hZGQoZGVwZW5kZW5jeSk7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBvcExpc3QubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICB0aGlzLmFkZE9wKG9wTGlzdC5mbkFycmF5W2ldLCBvcExpc3QuYXJnc0FycmF5W2ldKTsKICAgIH0KICB9CiAgZ2V0SVIoKSB7CiAgICByZXR1cm4gewogICAgICBmbkFycmF5OiB0aGlzLmZuQXJyYXksCiAgICAgIGFyZ3NBcnJheTogdGhpcy5hcmdzQXJyYXksCiAgICAgIGxlbmd0aDogdGhpcy5sZW5ndGgKICAgIH07CiAgfQogIGdldCBfdHJhbnNmZXJzKCkgewogICAgY29uc3QgdHJhbnNmZXJzID0gW107CiAgICBjb25zdCB7CiAgICAgIGZuQXJyYXksCiAgICAgIGFyZ3NBcnJheSwKICAgICAgbGVuZ3RoCiAgICB9ID0gdGhpczsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgc3dpdGNoIChmbkFycmF5W2ldKSB7CiAgICAgICAgY2FzZSBPUFMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3Q6CiAgICAgICAgY2FzZSBPUFMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3RHcm91cDoKICAgICAgICBjYXNlIE9QUy5wYWludEltYWdlTWFza1hPYmplY3Q6CiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICBiaXRtYXAsCiAgICAgICAgICAgICAgZGF0YQogICAgICAgICAgICB9ID0gYXJnc0FycmF5W2ldWzBdOwogICAgICAgICAgICBpZiAoYml0bWFwIHx8IGRhdGE/LmJ1ZmZlcikgewogICAgICAgICAgICAgIHRyYW5zZmVycy5wdXNoKGJpdG1hcCB8fCBkYXRhLmJ1ZmZlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgY2FzZSBPUFMuY29uc3RydWN0UGF0aDoKICAgICAgICAgIHsKICAgICAgICAgICAgY29uc3QgWywgW2RhdGFdLCBtaW5NYXhdID0gYXJnc0FycmF5W2ldOwogICAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICAgIHRyYW5zZmVycy5wdXNoKGRhdGEuYnVmZmVyLCBtaW5NYXguYnVmZmVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICBjYXNlIE9QUy5wYWludEZvcm1YT2JqZWN0QmVnaW46CiAgICAgICAgICBjb25zdCBbbWF0cml4LCBiYm94XSA9IGFyZ3NBcnJheVtpXTsKICAgICAgICAgIGlmIChtYXRyaXgpIHsKICAgICAgICAgICAgdHJhbnNmZXJzLnB1c2gobWF0cml4LmJ1ZmZlcik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYmJveCkgewogICAgICAgICAgICB0cmFuc2ZlcnMucHVzaChiYm94LmJ1ZmZlcik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIE9QUy5zZXRUZXh0TWF0cml4OgogICAgICAgICAgdHJhbnNmZXJzLnB1c2goYXJnc0FycmF5W2ldWzBdLmJ1ZmZlcik7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRyYW5zZmVyczsKICB9CiAgZmx1c2gobGFzdENodW5rID0gZmFsc2UsIHNlcGFyYXRlQW5ub3RzID0gbnVsbCkgewogICAgdGhpcy5vcHRpbWl6ZXIuZmx1c2goKTsKICAgIGNvbnN0IGxlbmd0aCA9IHRoaXMubGVuZ3RoOwogICAgdGhpcy5fdG90YWxMZW5ndGggKz0gbGVuZ3RoOwogICAgdGhpcy5fc3RyZWFtU2luay5lbnF1ZXVlKHsKICAgICAgZm5BcnJheTogdGhpcy5mbkFycmF5LAogICAgICBhcmdzQXJyYXk6IHRoaXMuYXJnc0FycmF5LAogICAgICBsYXN0Q2h1bmssCiAgICAgIHNlcGFyYXRlQW5ub3RzLAogICAgICBsZW5ndGgKICAgIH0sIDEsIHRoaXMuX3RyYW5zZmVycyk7CiAgICB0aGlzLmRlcGVuZGVuY2llcy5jbGVhcigpOwogICAgdGhpcy5mbkFycmF5Lmxlbmd0aCA9IDA7CiAgICB0aGlzLmFyZ3NBcnJheS5sZW5ndGggPSAwOwogICAgdGhpcy53ZWlnaHQgPSAwOwogICAgdGhpcy5vcHRpbWl6ZXIucmVzZXQoKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2JpbmFyeV9jbWFwLmpzCgpmdW5jdGlvbiBoZXhUb0ludChhLCBzaXplKSB7CiAgbGV0IG4gPSAwOwogIGZvciAobGV0IGkgPSAwOyBpIDw9IHNpemU7IGkrKykgewogICAgbiA9IG4gPDwgOCB8IGFbaV07CiAgfQogIHJldHVybiBuID4+PiAwOwp9CmZ1bmN0aW9uIGhleFRvU3RyKGEsIHNpemUpIHsKICBpZiAoc2l6ZSA9PT0gMSkgewogICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoYVswXSwgYVsxXSk7CiAgfQogIGlmIChzaXplID09PSAzKSB7CiAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShhWzBdLCBhWzFdLCBhWzJdLCBhWzNdKTsKICB9CiAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoLi4uYS5zdWJhcnJheSgwLCBzaXplICsgMSkpOwp9CmZ1bmN0aW9uIGFkZEhleChhLCBiLCBzaXplKSB7CiAgbGV0IGMgPSAwOwogIGZvciAobGV0IGkgPSBzaXplOyBpID49IDA7IGktLSkgewogICAgYyArPSBhW2ldICsgYltpXTsKICAgIGFbaV0gPSBjICYgMjU1OwogICAgYyA+Pj0gODsKICB9Cn0KZnVuY3Rpb24gaW5jSGV4KGEsIHNpemUpIHsKICBsZXQgYyA9IDE7CiAgZm9yIChsZXQgaSA9IHNpemU7IGkgPj0gMCAmJiBjID4gMDsgaS0tKSB7CiAgICBjICs9IGFbaV07CiAgICBhW2ldID0gYyAmIDI1NTsKICAgIGMgPj49IDg7CiAgfQp9CmNvbnN0IE1BWF9OVU1fU0laRSA9IDE2Owpjb25zdCBNQVhfRU5DT0RFRF9OVU1fU0laRSA9IDE5OwpjbGFzcyBCaW5hcnlDTWFwU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihkYXRhKSB7CiAgICB0aGlzLmJ1ZmZlciA9IGRhdGE7CiAgICB0aGlzLnBvcyA9IDA7CiAgICB0aGlzLmVuZCA9IGRhdGEubGVuZ3RoOwogICAgdGhpcy50bXBCdWYgPSBuZXcgVWludDhBcnJheShNQVhfRU5DT0RFRF9OVU1fU0laRSk7CiAgfQogIHJlYWRCeXRlKCkgewogICAgaWYgKHRoaXMucG9zID49IHRoaXMuZW5kKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIHJldHVybiB0aGlzLmJ1ZmZlclt0aGlzLnBvcysrXTsKICB9CiAgcmVhZE51bWJlcigpIHsKICAgIGxldCBuID0gMDsKICAgIGxldCBsYXN0OwogICAgZG8gewogICAgICBjb25zdCBiID0gdGhpcy5yZWFkQnl0ZSgpOwogICAgICBpZiAoYiA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoInVuZXhwZWN0ZWQgRU9GIGluIGJjbWFwIik7CiAgICAgIH0KICAgICAgbGFzdCA9ICEoYiAmIDB4ODApOwogICAgICBuID0gbiA8PCA3IHwgYiAmIDB4N2Y7CiAgICB9IHdoaWxlICghbGFzdCk7CiAgICByZXR1cm4gbjsKICB9CiAgcmVhZFNpZ25lZCgpIHsKICAgIGNvbnN0IG4gPSB0aGlzLnJlYWROdW1iZXIoKTsKICAgIHJldHVybiBuICYgMSA/IH4obiA+Pj4gMSkgOiBuID4+PiAxOwogIH0KICByZWFkSGV4KG51bSwgc2l6ZSkgewogICAgbnVtLnNldCh0aGlzLmJ1ZmZlci5zdWJhcnJheSh0aGlzLnBvcywgdGhpcy5wb3MgKyBzaXplICsgMSkpOwogICAgdGhpcy5wb3MgKz0gc2l6ZSArIDE7CiAgfQogIHJlYWRIZXhOdW1iZXIobnVtLCBzaXplKSB7CiAgICBsZXQgbGFzdDsKICAgIGNvbnN0IHN0YWNrID0gdGhpcy50bXBCdWY7CiAgICBsZXQgc3AgPSAwOwogICAgZG8gewogICAgICBjb25zdCBiID0gdGhpcy5yZWFkQnl0ZSgpOwogICAgICBpZiAoYiA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoInVuZXhwZWN0ZWQgRU9GIGluIGJjbWFwIik7CiAgICAgIH0KICAgICAgbGFzdCA9ICEoYiAmIDB4ODApOwogICAgICBzdGFja1tzcCsrXSA9IGIgJiAweDdmOwogICAgfSB3aGlsZSAoIWxhc3QpOwogICAgbGV0IGkgPSBzaXplLAogICAgICBidWZmZXIgPSAwLAogICAgICBidWZmZXJTaXplID0gMDsKICAgIHdoaWxlIChpID49IDApIHsKICAgICAgd2hpbGUgKGJ1ZmZlclNpemUgPCA4ICYmIHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICBidWZmZXIgfD0gc3RhY2tbLS1zcF0gPDwgYnVmZmVyU2l6ZTsKICAgICAgICBidWZmZXJTaXplICs9IDc7CiAgICAgIH0KICAgICAgbnVtW2ldID0gYnVmZmVyICYgMjU1OwogICAgICBpLS07CiAgICAgIGJ1ZmZlciA+Pj0gODsKICAgICAgYnVmZmVyU2l6ZSAtPSA4OwogICAgfQogIH0KICByZWFkSGV4U2lnbmVkKG51bSwgc2l6ZSkgewogICAgdGhpcy5yZWFkSGV4TnVtYmVyKG51bSwgc2l6ZSk7CiAgICBjb25zdCBzaWduID0gbnVtW3NpemVdICYgMSA/IDI1NSA6IDA7CiAgICBsZXQgYyA9IDA7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBzaXplOyBpKyspIHsKICAgICAgYyA9IChjICYgMSkgPDwgOCB8IG51bVtpXTsKICAgICAgbnVtW2ldID0gYyA+PiAxIF4gc2lnbjsKICAgIH0KICB9CiAgcmVhZFN0cmluZygpIHsKICAgIGNvbnN0IGxlbiA9IHRoaXMucmVhZE51bWJlcigpLAogICAgICBidWYgPSBuZXcgQXJyYXkobGVuKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgYnVmW2ldID0gdGhpcy5yZWFkTnVtYmVyKCk7CiAgICB9CiAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSguLi5idWYpOwogIH0KfQpjbGFzcyBCaW5hcnlDTWFwUmVhZGVyIHsKICBhc3luYyBwcm9jZXNzKGRhdGEsIGNNYXAsIGV4dGVuZCkgewogICAgY29uc3Qgc3RyZWFtID0gbmV3IEJpbmFyeUNNYXBTdHJlYW0oZGF0YSk7CiAgICBjb25zdCBoZWFkZXIgPSBzdHJlYW0ucmVhZEJ5dGUoKTsKICAgIGNNYXAudmVydGljYWwgPSAhIShoZWFkZXIgJiAxKTsKICAgIGxldCB1c2VDTWFwID0gbnVsbDsKICAgIGNvbnN0IHN0YXJ0ID0gbmV3IFVpbnQ4QXJyYXkoTUFYX05VTV9TSVpFKTsKICAgIGNvbnN0IGVuZCA9IG5ldyBVaW50OEFycmF5KE1BWF9OVU1fU0laRSk7CiAgICBjb25zdCBjaGFyID0gbmV3IFVpbnQ4QXJyYXkoTUFYX05VTV9TSVpFKTsKICAgIGNvbnN0IGNoYXJDb2RlID0gbmV3IFVpbnQ4QXJyYXkoTUFYX05VTV9TSVpFKTsKICAgIGNvbnN0IHRtcCA9IG5ldyBVaW50OEFycmF5KE1BWF9OVU1fU0laRSk7CiAgICBsZXQgY29kZTsKICAgIGxldCBiOwogICAgd2hpbGUgKChiID0gc3RyZWFtLnJlYWRCeXRlKCkpID49IDApIHsKICAgICAgY29uc3QgdHlwZSA9IGIgPj4gNTsKICAgICAgaWYgKHR5cGUgPT09IDcpIHsKICAgICAgICBzd2l0Y2ggKGIgJiAweDFmKSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHN0cmVhbS5yZWFkU3RyaW5nKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICB1c2VDTWFwID0gc3RyZWFtLnJlYWRTdHJpbmcoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHNlcXVlbmNlID0gISEoYiAmIDB4MTApOwogICAgICBjb25zdCBkYXRhU2l6ZSA9IGIgJiAxNTsKICAgICAgaWYgKGRhdGFTaXplICsgMSA+IE1BWF9OVU1fU0laRSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiQmluYXJ5Q01hcFJlYWRlci5wcm9jZXNzOiBJbnZhbGlkIGRhdGFTaXplLiIpOwogICAgICB9CiAgICAgIGNvbnN0IHVjczJEYXRhU2l6ZSA9IDE7CiAgICAgIGNvbnN0IHN1Yml0ZW1zQ291bnQgPSBzdHJlYW0ucmVhZE51bWJlcigpOwogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBzdHJlYW0ucmVhZEhleChzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgY01hcC5hZGRDb2Rlc3BhY2VSYW5nZShkYXRhU2l6ZSArIDEsIGhleFRvSW50KHN0YXJ0LCBkYXRhU2l6ZSksIGhleFRvSW50KGVuZCwgZGF0YVNpemUpKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgc3ViaXRlbXNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGluY0hleChlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgICAgYWRkSGV4KHN0YXJ0LCBlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGFkZEhleChlbmQsIHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGNNYXAuYWRkQ29kZXNwYWNlUmFuZ2UoZGF0YVNpemUgKyAxLCBoZXhUb0ludChzdGFydCwgZGF0YVNpemUpLCBoZXhUb0ludChlbmQsIGRhdGFTaXplKSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBzdHJlYW0ucmVhZEhleChzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgc3RyZWFtLnJlYWROdW1iZXIoKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgc3ViaXRlbXNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGluY0hleChlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgICAgYWRkSGV4KHN0YXJ0LCBlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGFkZEhleChlbmQsIHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIHN0cmVhbS5yZWFkTnVtYmVyKCk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBzdHJlYW0ucmVhZEhleChjaGFyLCBkYXRhU2l6ZSk7CiAgICAgICAgICBjb2RlID0gc3RyZWFtLnJlYWROdW1iZXIoKTsKICAgICAgICAgIGNNYXAubWFwT25lKGhleFRvSW50KGNoYXIsIGRhdGFTaXplKSwgY29kZSk7CiAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHN1Yml0ZW1zQ291bnQ7IGkrKykgewogICAgICAgICAgICBpbmNIZXgoY2hhciwgZGF0YVNpemUpOwogICAgICAgICAgICBpZiAoIXNlcXVlbmNlKSB7CiAgICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIodG1wLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgYWRkSGV4KGNoYXIsIHRtcCwgZGF0YVNpemUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvZGUgPSBzdHJlYW0ucmVhZFNpZ25lZCgpICsgKGNvZGUgKyAxKTsKICAgICAgICAgICAgY01hcC5tYXBPbmUoaGV4VG9JbnQoY2hhciwgZGF0YVNpemUpLCBjb2RlKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMzoKICAgICAgICAgIHN0cmVhbS5yZWFkSGV4KHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICBzdHJlYW0ucmVhZEhleE51bWJlcihlbmQsIGRhdGFTaXplKTsKICAgICAgICAgIGFkZEhleChlbmQsIHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICBjb2RlID0gc3RyZWFtLnJlYWROdW1iZXIoKTsKICAgICAgICAgIGNNYXAubWFwQ2lkUmFuZ2UoaGV4VG9JbnQoc3RhcnQsIGRhdGFTaXplKSwgaGV4VG9JbnQoZW5kLCBkYXRhU2l6ZSksIGNvZGUpOwogICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzdWJpdGVtc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgaW5jSGV4KGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgICBpZiAoIXNlcXVlbmNlKSB7CiAgICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgICAgICBhZGRIZXgoc3RhcnQsIGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHN0YXJ0LnNldChlbmQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgICBjb2RlID0gc3RyZWFtLnJlYWROdW1iZXIoKTsKICAgICAgICAgICAgY01hcC5tYXBDaWRSYW5nZShoZXhUb0ludChzdGFydCwgZGF0YVNpemUpLCBoZXhUb0ludChlbmQsIGRhdGFTaXplKSwgY29kZSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDQ6CiAgICAgICAgICBzdHJlYW0ucmVhZEhleChjaGFyLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgc3RyZWFtLnJlYWRIZXgoY2hhckNvZGUsIGRhdGFTaXplKTsKICAgICAgICAgIGNNYXAubWFwT25lKGhleFRvSW50KGNoYXIsIHVjczJEYXRhU2l6ZSksIGhleFRvU3RyKGNoYXJDb2RlLCBkYXRhU2l6ZSkpOwogICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzdWJpdGVtc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgaW5jSGV4KGNoYXIsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICAgIGlmICghc2VxdWVuY2UpIHsKICAgICAgICAgICAgICBzdHJlYW0ucmVhZEhleE51bWJlcih0bXAsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICAgICAgYWRkSGV4KGNoYXIsIHRtcCwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbmNIZXgoY2hhckNvZGUsIGRhdGFTaXplKTsKICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhTaWduZWQodG1wLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGFkZEhleChjaGFyQ29kZSwgdG1wLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGNNYXAubWFwT25lKGhleFRvSW50KGNoYXIsIHVjczJEYXRhU2l6ZSksIGhleFRvU3RyKGNoYXJDb2RlLCBkYXRhU2l6ZSkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA1OgogICAgICAgICAgc3RyZWFtLnJlYWRIZXgoc3RhcnQsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICBzdHJlYW0ucmVhZEhleE51bWJlcihlbmQsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgIHN0cmVhbS5yZWFkSGV4KGNoYXJDb2RlLCBkYXRhU2l6ZSk7CiAgICAgICAgICBjTWFwLm1hcEJmUmFuZ2UoaGV4VG9JbnQoc3RhcnQsIHVjczJEYXRhU2l6ZSksIGhleFRvSW50KGVuZCwgdWNzMkRhdGFTaXplKSwgaGV4VG9TdHIoY2hhckNvZGUsIGRhdGFTaXplKSk7CiAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHN1Yml0ZW1zQ291bnQ7IGkrKykgewogICAgICAgICAgICBpbmNIZXgoZW5kLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgICBpZiAoIXNlcXVlbmNlKSB7CiAgICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoc3RhcnQsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICAgICAgYWRkSGV4KHN0YXJ0LCBlbmQsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc3RhcnQuc2V0KGVuZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXgoY2hhckNvZGUsIGRhdGFTaXplKTsKICAgICAgICAgICAgY01hcC5tYXBCZlJhbmdlKGhleFRvSW50KHN0YXJ0LCB1Y3MyRGF0YVNpemUpLCBoZXhUb0ludChlbmQsIHVjczJEYXRhU2l6ZSksIGhleFRvU3RyKGNoYXJDb2RlLCBkYXRhU2l6ZSkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQmluYXJ5Q01hcFJlYWRlci5wcm9jZXNzIC0gdW5rbm93biB0eXBlOiAke3R5cGV9YCk7CiAgICAgIH0KICAgIH0KICAgIGlmICh1c2VDTWFwKSB7CiAgICAgIHJldHVybiBleHRlbmQodXNlQ01hcCk7CiAgICB9CiAgICByZXR1cm4gY01hcDsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2FzY2lpXzg1X3N0cmVhbS5qcwoKCmNsYXNzIEFzY2lpODVTdHJlYW0gZXh0ZW5kcyBEZWNvZGVTdHJlYW0gewogIGNvbnN0cnVjdG9yKHN0ciwgbWF5YmVMZW5ndGgpIHsKICAgIGlmIChtYXliZUxlbmd0aCkgewogICAgICBtYXliZUxlbmd0aCAqPSAwLjg7CiAgICB9CiAgICBzdXBlcihtYXliZUxlbmd0aCk7CiAgICB0aGlzLnN0ciA9IHN0cjsKICAgIHRoaXMuZGljdCA9IHN0ci5kaWN0OwogICAgdGhpcy5pbnB1dCA9IG5ldyBVaW50OEFycmF5KDUpOwogIH0KICByZWFkQmxvY2soKSB7CiAgICBjb25zdCBUSUxEQV9DSEFSID0gMHg3ZTsKICAgIGNvbnN0IFpfTE9XRVJfQ0hBUiA9IDB4N2E7CiAgICBjb25zdCBFT0YgPSAtMTsKICAgIGNvbnN0IHN0ciA9IHRoaXMuc3RyOwogICAgbGV0IGMgPSBzdHIuZ2V0Qnl0ZSgpOwogICAgd2hpbGUgKGlzV2hpdGVTcGFjZShjKSkgewogICAgICBjID0gc3RyLmdldEJ5dGUoKTsKICAgIH0KICAgIGlmIChjID09PSBFT0YgfHwgYyA9PT0gVElMREFfQ0hBUikgewogICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgbGV0IGJ1ZmZlciwgaTsKICAgIGlmIChjID09PSBaX0xPV0VSX0NIQVIpIHsKICAgICAgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoYnVmZmVyTGVuZ3RoICsgNCk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCA0OyArK2kpIHsKICAgICAgICBidWZmZXJbYnVmZmVyTGVuZ3RoICsgaV0gPSAwOwogICAgICB9CiAgICAgIHRoaXMuYnVmZmVyTGVuZ3RoICs9IDQ7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBpbnB1dCA9IHRoaXMuaW5wdXQ7CiAgICAgIGlucHV0WzBdID0gYzsKICAgICAgZm9yIChpID0gMTsgaSA8IDU7ICsraSkgewogICAgICAgIGMgPSBzdHIuZ2V0Qnl0ZSgpOwogICAgICAgIHdoaWxlIChpc1doaXRlU3BhY2UoYykpIHsKICAgICAgICAgIGMgPSBzdHIuZ2V0Qnl0ZSgpOwogICAgICAgIH0KICAgICAgICBpbnB1dFtpXSA9IGM7CiAgICAgICAgaWYgKGMgPT09IEVPRiB8fCBjID09PSBUSUxEQV9DSEFSKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoYnVmZmVyTGVuZ3RoICsgaSAtIDEpOwogICAgICB0aGlzLmJ1ZmZlckxlbmd0aCArPSBpIC0gMTsKICAgICAgaWYgKGkgPCA1KSB7CiAgICAgICAgZm9yICg7IGkgPCA1OyArK2kpIHsKICAgICAgICAgIGlucHV0W2ldID0gMHgyMSArIDg0OwogICAgICAgIH0KICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgIH0KICAgICAgbGV0IHQgPSAwOwogICAgICBmb3IgKGkgPSAwOyBpIDwgNTsgKytpKSB7CiAgICAgICAgdCA9IHQgKiA4NSArIChpbnB1dFtpXSAtIDB4MjEpOwogICAgICB9CiAgICAgIGZvciAoaSA9IDM7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aCArIGldID0gdCAmIDB4ZmY7CiAgICAgICAgdCA+Pj0gODsKICAgICAgfQogICAgfQogIH0KfQoKOy8vIC4vc3JjL2NvcmUvYXNjaWlfaGV4X3N0cmVhbS5qcwoKY2xhc3MgQXNjaWlIZXhTdHJlYW0gZXh0ZW5kcyBEZWNvZGVTdHJlYW0gewogIGNvbnN0cnVjdG9yKHN0ciwgbWF5YmVMZW5ndGgpIHsKICAgIGlmIChtYXliZUxlbmd0aCkgewogICAgICBtYXliZUxlbmd0aCAqPSAwLjU7CiAgICB9CiAgICBzdXBlcihtYXliZUxlbmd0aCk7CiAgICB0aGlzLnN0ciA9IHN0cjsKICAgIHRoaXMuZGljdCA9IHN0ci5kaWN0OwogICAgdGhpcy5maXJzdERpZ2l0ID0gLTE7CiAgfQogIHJlYWRCbG9jaygpIHsKICAgIGNvbnN0IFVQU1RSRUFNX0JMT0NLX1NJWkUgPSA4MDAwOwogICAgY29uc3QgYnl0ZXMgPSB0aGlzLnN0ci5nZXRCeXRlcyhVUFNUUkVBTV9CTE9DS19TSVpFKTsKICAgIGlmICghYnl0ZXMubGVuZ3RoKSB7CiAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgbWF4RGVjb2RlTGVuZ3RoID0gYnl0ZXMubGVuZ3RoICsgMSA+PiAxOwogICAgY29uc3QgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIodGhpcy5idWZmZXJMZW5ndGggKyBtYXhEZWNvZGVMZW5ndGgpOwogICAgbGV0IGJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgbGV0IGZpcnN0RGlnaXQgPSB0aGlzLmZpcnN0RGlnaXQ7CiAgICBmb3IgKGNvbnN0IGNoIG9mIGJ5dGVzKSB7CiAgICAgIGxldCBkaWdpdDsKICAgICAgaWYgKGNoID49IDB4MzAgJiYgY2ggPD0gMHgzOSkgewogICAgICAgIGRpZ2l0ID0gY2ggJiAweDBmOwogICAgICB9IGVsc2UgaWYgKGNoID49IDB4NDEgJiYgY2ggPD0gMHg0NiB8fCBjaCA+PSAweDYxICYmIGNoIDw9IDB4NjYpIHsKICAgICAgICBkaWdpdCA9IChjaCAmIDB4MGYpICsgOTsKICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHgzZSkgewogICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoZmlyc3REaWdpdCA8IDApIHsKICAgICAgICBmaXJzdERpZ2l0ID0gZGlnaXQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aCsrXSA9IGZpcnN0RGlnaXQgPDwgNCB8IGRpZ2l0OwogICAgICAgIGZpcnN0RGlnaXQgPSAtMTsKICAgICAgfQogICAgfQogICAgaWYgKGZpcnN0RGlnaXQgPj0gMCAmJiB0aGlzLmVvZikgewogICAgICBidWZmZXJbYnVmZmVyTGVuZ3RoKytdID0gZmlyc3REaWdpdCA8PCA0OwogICAgICBmaXJzdERpZ2l0ID0gLTE7CiAgICB9CiAgICB0aGlzLmZpcnN0RGlnaXQgPSBmaXJzdERpZ2l0OwogICAgdGhpcy5idWZmZXJMZW5ndGggPSBidWZmZXJMZW5ndGg7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9jY2l0dC5qcwoKY29uc3QgY2NpdHRFT0wgPSAtMjsKY29uc3QgY2NpdHRFT0YgPSAtMTsKY29uc3QgdHdvRGltUGFzcyA9IDA7CmNvbnN0IHR3b0RpbUhvcml6ID0gMTsKY29uc3QgdHdvRGltVmVydDAgPSAyOwpjb25zdCB0d29EaW1WZXJ0UjEgPSAzOwpjb25zdCB0d29EaW1WZXJ0TDEgPSA0Owpjb25zdCB0d29EaW1WZXJ0UjIgPSA1Owpjb25zdCB0d29EaW1WZXJ0TDIgPSA2Owpjb25zdCB0d29EaW1WZXJ0UjMgPSA3Owpjb25zdCB0d29EaW1WZXJ0TDMgPSA4Owpjb25zdCB0d29EaW1UYWJsZSA9IFtbLTEsIC0xXSwgWy0xLCAtMV0sIFs3LCB0d29EaW1WZXJ0TDNdLCBbNywgdHdvRGltVmVydFIzXSwgWzYsIHR3b0RpbVZlcnRMMl0sIFs2LCB0d29EaW1WZXJ0TDJdLCBbNiwgdHdvRGltVmVydFIyXSwgWzYsIHR3b0RpbVZlcnRSMl0sIFs0LCB0d29EaW1QYXNzXSwgWzQsIHR3b0RpbVBhc3NdLCBbNCwgdHdvRGltUGFzc10sIFs0LCB0d29EaW1QYXNzXSwgWzQsIHR3b0RpbVBhc3NdLCBbNCwgdHdvRGltUGFzc10sIFs0LCB0d29EaW1QYXNzXSwgWzQsIHR3b0RpbVBhc3NdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltSG9yaXpdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF0sIFsxLCB0d29EaW1WZXJ0MF1dOwpjb25zdCB3aGl0ZVRhYmxlMSA9IFtbLTEsIC0xXSwgWzEyLCBjY2l0dEVPTF0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWzExLCAxNzkyXSwgWzExLCAxNzkyXSwgWzEyLCAxOTg0XSwgWzEyLCAyMDQ4XSwgWzEyLCAyMTEyXSwgWzEyLCAyMTc2XSwgWzEyLCAyMjQwXSwgWzEyLCAyMzA0XSwgWzExLCAxODU2XSwgWzExLCAxODU2XSwgWzExLCAxOTIwXSwgWzExLCAxOTIwXSwgWzEyLCAyMzY4XSwgWzEyLCAyNDMyXSwgWzEyLCAyNDk2XSwgWzEyLCAyNTYwXV07CmNvbnN0IHdoaXRlVGFibGUyID0gW1stMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbOCwgMjldLCBbOCwgMjldLCBbOCwgMzBdLCBbOCwgMzBdLCBbOCwgNDVdLCBbOCwgNDVdLCBbOCwgNDZdLCBbOCwgNDZdLCBbNywgMjJdLCBbNywgMjJdLCBbNywgMjJdLCBbNywgMjJdLCBbNywgMjNdLCBbNywgMjNdLCBbNywgMjNdLCBbNywgMjNdLCBbOCwgNDddLCBbOCwgNDddLCBbOCwgNDhdLCBbOCwgNDhdLCBbNiwgMTNdLCBbNiwgMTNdLCBbNiwgMTNdLCBbNiwgMTNdLCBbNiwgMTNdLCBbNiwgMTNdLCBbNiwgMTNdLCBbNiwgMTNdLCBbNywgMjBdLCBbNywgMjBdLCBbNywgMjBdLCBbNywgMjBdLCBbOCwgMzNdLCBbOCwgMzNdLCBbOCwgMzRdLCBbOCwgMzRdLCBbOCwgMzVdLCBbOCwgMzVdLCBbOCwgMzZdLCBbOCwgMzZdLCBbOCwgMzddLCBbOCwgMzddLCBbOCwgMzhdLCBbOCwgMzhdLCBbNywgMTldLCBbNywgMTldLCBbNywgMTldLCBbNywgMTldLCBbOCwgMzFdLCBbOCwgMzFdLCBbOCwgMzJdLCBbOCwgMzJdLCBbNiwgMV0sIFs2LCAxXSwgWzYsIDFdLCBbNiwgMV0sIFs2LCAxXSwgWzYsIDFdLCBbNiwgMV0sIFs2LCAxXSwgWzYsIDEyXSwgWzYsIDEyXSwgWzYsIDEyXSwgWzYsIDEyXSwgWzYsIDEyXSwgWzYsIDEyXSwgWzYsIDEyXSwgWzYsIDEyXSwgWzgsIDUzXSwgWzgsIDUzXSwgWzgsIDU0XSwgWzgsIDU0XSwgWzcsIDI2XSwgWzcsIDI2XSwgWzcsIDI2XSwgWzcsIDI2XSwgWzgsIDM5XSwgWzgsIDM5XSwgWzgsIDQwXSwgWzgsIDQwXSwgWzgsIDQxXSwgWzgsIDQxXSwgWzgsIDQyXSwgWzgsIDQyXSwgWzgsIDQzXSwgWzgsIDQzXSwgWzgsIDQ0XSwgWzgsIDQ0XSwgWzcsIDIxXSwgWzcsIDIxXSwgWzcsIDIxXSwgWzcsIDIxXSwgWzcsIDI4XSwgWzcsIDI4XSwgWzcsIDI4XSwgWzcsIDI4XSwgWzgsIDYxXSwgWzgsIDYxXSwgWzgsIDYyXSwgWzgsIDYyXSwgWzgsIDYzXSwgWzgsIDYzXSwgWzgsIDBdLCBbOCwgMF0sIFs4LCAzMjBdLCBbOCwgMzIwXSwgWzgsIDM4NF0sIFs4LCAzODRdLCBbNSwgMTBdLCBbNSwgMTBdLCBbNSwgMTBdLCBbNSwgMTBdLCBbNSwgMTBdLCBbNSwgMTBdLCBbNSwgMTBdLCBbNSwgMTBdLCBbNSwgMTBdLCBbNSwgMTBdLCBbNSwgMTBdLCBbNSwgMTBdLCBbNSwgMTBdLCBbNSwgMTBdLCBbNSwgMTBdLCBbNSwgMTBdLCBbNSwgMTFdLCBbNSwgMTFdLCBbNSwgMTFdLCBbNSwgMTFdLCBbNSwgMTFdLCBbNSwgMTFdLCBbNSwgMTFdLCBbNSwgMTFdLCBbNSwgMTFdLCBbNSwgMTFdLCBbNSwgMTFdLCBbNSwgMTFdLCBbNSwgMTFdLCBbNSwgMTFdLCBbNSwgMTFdLCBbNSwgMTFdLCBbNywgMjddLCBbNywgMjddLCBbNywgMjddLCBbNywgMjddLCBbOCwgNTldLCBbOCwgNTldLCBbOCwgNjBdLCBbOCwgNjBdLCBbOSwgMTQ3Ml0sIFs5LCAxNTM2XSwgWzksIDE2MDBdLCBbOSwgMTcyOF0sIFs3LCAxOF0sIFs3LCAxOF0sIFs3LCAxOF0sIFs3LCAxOF0sIFs3LCAyNF0sIFs3LCAyNF0sIFs3LCAyNF0sIFs3LCAyNF0sIFs4LCA0OV0sIFs4LCA0OV0sIFs4LCA1MF0sIFs4LCA1MF0sIFs4LCA1MV0sIFs4LCA1MV0sIFs4LCA1Ml0sIFs4LCA1Ml0sIFs3LCAyNV0sIFs3LCAyNV0sIFs3LCAyNV0sIFs3LCAyNV0sIFs4LCA1NV0sIFs4LCA1NV0sIFs4LCA1Nl0sIFs4LCA1Nl0sIFs4LCA1N10sIFs4LCA1N10sIFs4LCA1OF0sIFs4LCA1OF0sIFs2LCAxOTJdLCBbNiwgMTkyXSwgWzYsIDE5Ml0sIFs2LCAxOTJdLCBbNiwgMTkyXSwgWzYsIDE5Ml0sIFs2LCAxOTJdLCBbNiwgMTkyXSwgWzYsIDE2NjRdLCBbNiwgMTY2NF0sIFs2LCAxNjY0XSwgWzYsIDE2NjRdLCBbNiwgMTY2NF0sIFs2LCAxNjY0XSwgWzYsIDE2NjRdLCBbNiwgMTY2NF0sIFs4LCA0NDhdLCBbOCwgNDQ4XSwgWzgsIDUxMl0sIFs4LCA1MTJdLCBbOSwgNzA0XSwgWzksIDc2OF0sIFs4LCA2NDBdLCBbOCwgNjQwXSwgWzgsIDU3Nl0sIFs4LCA1NzZdLCBbOSwgODMyXSwgWzksIDg5Nl0sIFs5LCA5NjBdLCBbOSwgMTAyNF0sIFs5LCAxMDg4XSwgWzksIDExNTJdLCBbOSwgMTIxNl0sIFs5LCAxMjgwXSwgWzksIDEzNDRdLCBbOSwgMTQwOF0sIFs3LCAyNTZdLCBbNywgMjU2XSwgWzcsIDI1Nl0sIFs3LCAyNTZdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzYsIDE2XSwgWzYsIDE2XSwgWzYsIDE2XSwgWzYsIDE2XSwgWzYsIDE2XSwgWzYsIDE2XSwgWzYsIDE2XSwgWzYsIDE2XSwgWzYsIDE3XSwgWzYsIDE3XSwgWzYsIDE3XSwgWzYsIDE3XSwgWzYsIDE3XSwgWzYsIDE3XSwgWzYsIDE3XSwgWzYsIDE3XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNiwgMTRdLCBbNiwgMTRdLCBbNiwgMTRdLCBbNiwgMTRdLCBbNiwgMTRdLCBbNiwgMTRdLCBbNiwgMTRdLCBbNiwgMTRdLCBbNiwgMTVdLCBbNiwgMTVdLCBbNiwgMTVdLCBbNiwgMTVdLCBbNiwgMTVdLCBbNiwgMTVdLCBbNiwgMTVdLCBbNiwgMTVdLCBbNSwgNjRdLCBbNSwgNjRdLCBbNSwgNjRdLCBbNSwgNjRdLCBbNSwgNjRdLCBbNSwgNjRdLCBbNSwgNjRdLCBbNSwgNjRdLCBbNSwgNjRdLCBbNSwgNjRdLCBbNSwgNjRdLCBbNSwgNjRdLCBbNSwgNjRdLCBbNSwgNjRdLCBbNSwgNjRdLCBbNSwgNjRdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN11dOwpjb25zdCBibGFja1RhYmxlMSA9IFtbLTEsIC0xXSwgWy0xLCAtMV0sIFsxMiwgY2NpdHRFT0xdLCBbMTIsIGNjaXR0RU9MXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFsxMSwgMTc5Ml0sIFsxMSwgMTc5Ml0sIFsxMSwgMTc5Ml0sIFsxMSwgMTc5Ml0sIFsxMiwgMTk4NF0sIFsxMiwgMTk4NF0sIFsxMiwgMjA0OF0sIFsxMiwgMjA0OF0sIFsxMiwgMjExMl0sIFsxMiwgMjExMl0sIFsxMiwgMjE3Nl0sIFsxMiwgMjE3Nl0sIFsxMiwgMjI0MF0sIFsxMiwgMjI0MF0sIFsxMiwgMjMwNF0sIFsxMiwgMjMwNF0sIFsxMSwgMTg1Nl0sIFsxMSwgMTg1Nl0sIFsxMSwgMTg1Nl0sIFsxMSwgMTg1Nl0sIFsxMSwgMTkyMF0sIFsxMSwgMTkyMF0sIFsxMSwgMTkyMF0sIFsxMSwgMTkyMF0sIFsxMiwgMjM2OF0sIFsxMiwgMjM2OF0sIFsxMiwgMjQzMl0sIFsxMiwgMjQzMl0sIFsxMiwgMjQ5Nl0sIFsxMiwgMjQ5Nl0sIFsxMiwgMjU2MF0sIFsxMiwgMjU2MF0sIFsxMCwgMThdLCBbMTAsIDE4XSwgWzEwLCAxOF0sIFsxMCwgMThdLCBbMTAsIDE4XSwgWzEwLCAxOF0sIFsxMCwgMThdLCBbMTAsIDE4XSwgWzEyLCA1Ml0sIFsxMiwgNTJdLCBbMTMsIDY0MF0sIFsxMywgNzA0XSwgWzEzLCA3NjhdLCBbMTMsIDgzMl0sIFsxMiwgNTVdLCBbMTIsIDU1XSwgWzEyLCA1Nl0sIFsxMiwgNTZdLCBbMTMsIDEyODBdLCBbMTMsIDEzNDRdLCBbMTMsIDE0MDhdLCBbMTMsIDE0NzJdLCBbMTIsIDU5XSwgWzEyLCA1OV0sIFsxMiwgNjBdLCBbMTIsIDYwXSwgWzEzLCAxNTM2XSwgWzEzLCAxNjAwXSwgWzExLCAyNF0sIFsxMSwgMjRdLCBbMTEsIDI0XSwgWzExLCAyNF0sIFsxMSwgMjVdLCBbMTEsIDI1XSwgWzExLCAyNV0sIFsxMSwgMjVdLCBbMTMsIDE2NjRdLCBbMTMsIDE3MjhdLCBbMTIsIDMyMF0sIFsxMiwgMzIwXSwgWzEyLCAzODRdLCBbMTIsIDM4NF0sIFsxMiwgNDQ4XSwgWzEyLCA0NDhdLCBbMTMsIDUxMl0sIFsxMywgNTc2XSwgWzEyLCA1M10sIFsxMiwgNTNdLCBbMTIsIDU0XSwgWzEyLCA1NF0sIFsxMywgODk2XSwgWzEzLCA5NjBdLCBbMTMsIDEwMjRdLCBbMTMsIDEwODhdLCBbMTMsIDExNTJdLCBbMTMsIDEyMTZdLCBbMTAsIDY0XSwgWzEwLCA2NF0sIFsxMCwgNjRdLCBbMTAsIDY0XSwgWzEwLCA2NF0sIFsxMCwgNjRdLCBbMTAsIDY0XSwgWzEwLCA2NF1dOwpjb25zdCBibGFja1RhYmxlMiA9IFtbOCwgMTNdLCBbOCwgMTNdLCBbOCwgMTNdLCBbOCwgMTNdLCBbOCwgMTNdLCBbOCwgMTNdLCBbOCwgMTNdLCBbOCwgMTNdLCBbOCwgMTNdLCBbOCwgMTNdLCBbOCwgMTNdLCBbOCwgMTNdLCBbOCwgMTNdLCBbOCwgMTNdLCBbOCwgMTNdLCBbOCwgMTNdLCBbMTEsIDIzXSwgWzExLCAyM10sIFsxMiwgNTBdLCBbMTIsIDUxXSwgWzEyLCA0NF0sIFsxMiwgNDVdLCBbMTIsIDQ2XSwgWzEyLCA0N10sIFsxMiwgNTddLCBbMTIsIDU4XSwgWzEyLCA2MV0sIFsxMiwgMjU2XSwgWzEwLCAxNl0sIFsxMCwgMTZdLCBbMTAsIDE2XSwgWzEwLCAxNl0sIFsxMCwgMTddLCBbMTAsIDE3XSwgWzEwLCAxN10sIFsxMCwgMTddLCBbMTIsIDQ4XSwgWzEyLCA0OV0sIFsxMiwgNjJdLCBbMTIsIDYzXSwgWzEyLCAzMF0sIFsxMiwgMzFdLCBbMTIsIDMyXSwgWzEyLCAzM10sIFsxMiwgNDBdLCBbMTIsIDQxXSwgWzExLCAyMl0sIFsxMSwgMjJdLCBbOCwgMTRdLCBbOCwgMTRdLCBbOCwgMTRdLCBbOCwgMTRdLCBbOCwgMTRdLCBbOCwgMTRdLCBbOCwgMTRdLCBbOCwgMTRdLCBbOCwgMTRdLCBbOCwgMTRdLCBbOCwgMTRdLCBbOCwgMTRdLCBbOCwgMTRdLCBbOCwgMTRdLCBbOCwgMTRdLCBbOCwgMTRdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTBdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbNywgMTFdLCBbOSwgMTVdLCBbOSwgMTVdLCBbOSwgMTVdLCBbOSwgMTVdLCBbOSwgMTVdLCBbOSwgMTVdLCBbOSwgMTVdLCBbOSwgMTVdLCBbMTIsIDEyOF0sIFsxMiwgMTkyXSwgWzEyLCAyNl0sIFsxMiwgMjddLCBbMTIsIDI4XSwgWzEyLCAyOV0sIFsxMSwgMTldLCBbMTEsIDE5XSwgWzExLCAyMF0sIFsxMSwgMjBdLCBbMTIsIDM0XSwgWzEyLCAzNV0sIFsxMiwgMzZdLCBbMTIsIDM3XSwgWzEyLCAzOF0sIFsxMiwgMzldLCBbMTEsIDIxXSwgWzExLCAyMV0sIFsxMiwgNDJdLCBbMTIsIDQzXSwgWzEwLCAwXSwgWzEwLCAwXSwgWzEwLCAwXSwgWzEwLCAwXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXSwgWzcsIDEyXV07CmNvbnN0IGJsYWNrVGFibGUzID0gW1stMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbNiwgOV0sIFs2LCA4XSwgWzUsIDddLCBbNSwgN10sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbMywgMV0sIFszLCAxXSwgWzMsIDFdLCBbMywgMV0sIFszLCAxXSwgWzMsIDFdLCBbMywgMV0sIFszLCAxXSwgWzMsIDRdLCBbMywgNF0sIFszLCA0XSwgWzMsIDRdLCBbMywgNF0sIFszLCA0XSwgWzMsIDRdLCBbMywgNF0sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdXTsKY2xhc3MgQ0NJVFRGYXhEZWNvZGVyIHsKICBjb25zdHJ1Y3Rvcihzb3VyY2UsIG9wdGlvbnMgPSB7fSkgewogICAgaWYgKHR5cGVvZiBzb3VyY2U/Lm5leHQgIT09ICJmdW5jdGlvbiIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdDQ0lUVEZheERlY29kZXIgLSBpbnZhbGlkICJzb3VyY2UiIHBhcmFtZXRlci4nKTsKICAgIH0KICAgIHRoaXMuc291cmNlID0gc291cmNlOwogICAgdGhpcy5lb2YgPSBmYWxzZTsKICAgIHRoaXMuZW5jb2RpbmcgPSBvcHRpb25zLksgfHwgMDsKICAgIHRoaXMuZW9saW5lID0gb3B0aW9ucy5FbmRPZkxpbmUgfHwgZmFsc2U7CiAgICB0aGlzLmJ5dGVBbGlnbiA9IG9wdGlvbnMuRW5jb2RlZEJ5dGVBbGlnbiB8fCBmYWxzZTsKICAgIHRoaXMuY29sdW1ucyA9IG9wdGlvbnMuQ29sdW1ucyB8fCAxNzI4OwogICAgdGhpcy5yb3dzID0gb3B0aW9ucy5Sb3dzIHx8IDA7CiAgICB0aGlzLmVvYmxvY2sgPSBvcHRpb25zLkVuZE9mQmxvY2sgPz8gdHJ1ZTsKICAgIHRoaXMuYmxhY2sgPSBvcHRpb25zLkJsYWNrSXMxIHx8IGZhbHNlOwogICAgdGhpcy5jb2RpbmdMaW5lID0gbmV3IFVpbnQzMkFycmF5KHRoaXMuY29sdW1ucyArIDEpOwogICAgdGhpcy5yZWZMaW5lID0gbmV3IFVpbnQzMkFycmF5KHRoaXMuY29sdW1ucyArIDIpOwogICAgdGhpcy5jb2RpbmdMaW5lWzBdID0gdGhpcy5jb2x1bW5zOwogICAgdGhpcy5jb2RpbmdQb3MgPSAwOwogICAgdGhpcy5yb3cgPSAwOwogICAgdGhpcy5uZXh0TGluZTJEID0gdGhpcy5lbmNvZGluZyA8IDA7CiAgICB0aGlzLmlucHV0Qml0cyA9IDA7CiAgICB0aGlzLmlucHV0QnVmID0gMDsKICAgIHRoaXMub3V0cHV0Qml0cyA9IDA7CiAgICB0aGlzLnJvd3NEb25lID0gZmFsc2U7CiAgICBsZXQgY29kZTE7CiAgICB3aGlsZSAoKGNvZGUxID0gdGhpcy5fbG9va0JpdHMoMTIpKSA9PT0gMCkgewogICAgICB0aGlzLl9lYXRCaXRzKDEpOwogICAgfQogICAgaWYgKGNvZGUxID09PSAxKSB7CiAgICAgIHRoaXMuX2VhdEJpdHMoMTIpOwogICAgfQogICAgaWYgKHRoaXMuZW5jb2RpbmcgPiAwKSB7CiAgICAgIHRoaXMubmV4dExpbmUyRCA9ICF0aGlzLl9sb29rQml0cygxKTsKICAgICAgdGhpcy5fZWF0Qml0cygxKTsKICAgIH0KICB9CiAgcmVhZE5leHRDaGFyKCkgewogICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIGNvbnN0IHJlZkxpbmUgPSB0aGlzLnJlZkxpbmU7CiAgICBjb25zdCBjb2RpbmdMaW5lID0gdGhpcy5jb2RpbmdMaW5lOwogICAgY29uc3QgY29sdW1ucyA9IHRoaXMuY29sdW1uczsKICAgIGxldCByZWZQb3MsIGJsYWNrUGl4ZWxzLCBiaXRzLCBpOwogICAgaWYgKHRoaXMub3V0cHV0Qml0cyA9PT0gMCkgewogICAgICBpZiAodGhpcy5yb3dzRG9uZSkgewogICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgfQogICAgICBpZiAodGhpcy5lb2YpIHsKICAgICAgICByZXR1cm4gLTE7CiAgICAgIH0KICAgICAgdGhpcy5lcnIgPSBmYWxzZTsKICAgICAgbGV0IGNvZGUxLCBjb2RlMiwgY29kZTM7CiAgICAgIGlmICh0aGlzLm5leHRMaW5lMkQpIHsKICAgICAgICBmb3IgKGkgPSAwOyBjb2RpbmdMaW5lW2ldIDwgY29sdW1uczsgKytpKSB7CiAgICAgICAgICByZWZMaW5lW2ldID0gY29kaW5nTGluZVtpXTsKICAgICAgICB9CiAgICAgICAgcmVmTGluZVtpKytdID0gY29sdW1uczsKICAgICAgICByZWZMaW5lW2ldID0gY29sdW1uczsKICAgICAgICBjb2RpbmdMaW5lWzBdID0gMDsKICAgICAgICB0aGlzLmNvZGluZ1BvcyA9IDA7CiAgICAgICAgcmVmUG9zID0gMDsKICAgICAgICBibGFja1BpeGVscyA9IDA7CiAgICAgICAgd2hpbGUgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgY29kZTEgPSB0aGlzLl9nZXRUd29EaW1Db2RlKCk7CiAgICAgICAgICBzd2l0Y2ggKGNvZGUxKSB7CiAgICAgICAgICAgIGNhc2UgdHdvRGltUGFzczoKICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHMocmVmTGluZVtyZWZQb3MgKyAxXSwgYmxhY2tQaXhlbHMpOwogICAgICAgICAgICAgIGlmIChyZWZMaW5lW3JlZlBvcyArIDFdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgcmVmUG9zICs9IDI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIHR3b0RpbUhvcml6OgogICAgICAgICAgICAgIGNvZGUxID0gY29kZTIgPSAwOwogICAgICAgICAgICAgIGlmIChibGFja1BpeGVscykgewogICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICBjb2RlMSArPSBjb2RlMyA9IHRoaXMuX2dldEJsYWNrQ29kZSgpOwogICAgICAgICAgICAgICAgfSB3aGlsZSAoY29kZTMgPj0gNjQpOwogICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICBjb2RlMiArPSBjb2RlMyA9IHRoaXMuX2dldFdoaXRlQ29kZSgpOwogICAgICAgICAgICAgICAgfSB3aGlsZSAoY29kZTMgPj0gNjQpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgIGNvZGUxICs9IGNvZGUzID0gdGhpcy5fZ2V0V2hpdGVDb2RlKCk7CiAgICAgICAgICAgICAgICB9IHdoaWxlIChjb2RlMyA+PSA2NCk7CiAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgIGNvZGUyICs9IGNvZGUzID0gdGhpcy5fZ2V0QmxhY2tDb2RlKCk7CiAgICAgICAgICAgICAgICB9IHdoaWxlIChjb2RlMyA+PSA2NCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVscyhjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSArIGNvZGUxLCBibGFja1BpeGVscyk7CiAgICAgICAgICAgICAgaWYgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICsgY29kZTIsIGJsYWNrUGl4ZWxzIF4gMSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHdoaWxlIChyZWZMaW5lW3JlZlBvc10gPD0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gJiYgcmVmTGluZVtyZWZQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgcmVmUG9zICs9IDI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIHR3b0RpbVZlcnRSMzoKICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHMocmVmTGluZVtyZWZQb3NdICsgMywgYmxhY2tQaXhlbHMpOwogICAgICAgICAgICAgIGJsYWNrUGl4ZWxzIF49IDE7CiAgICAgICAgICAgICAgaWYgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgKytyZWZQb3M7CiAgICAgICAgICAgICAgICB3aGlsZSAocmVmTGluZVtyZWZQb3NdIDw9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICYmIHJlZkxpbmVbcmVmUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgcmVmUG9zICs9IDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIHR3b0RpbVZlcnRSMjoKICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHMocmVmTGluZVtyZWZQb3NdICsgMiwgYmxhY2tQaXhlbHMpOwogICAgICAgICAgICAgIGJsYWNrUGl4ZWxzIF49IDE7CiAgICAgICAgICAgICAgaWYgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgKytyZWZQb3M7CiAgICAgICAgICAgICAgICB3aGlsZSAocmVmTGluZVtyZWZQb3NdIDw9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICYmIHJlZkxpbmVbcmVmUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgcmVmUG9zICs9IDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIHR3b0RpbVZlcnRSMToKICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHMocmVmTGluZVtyZWZQb3NdICsgMSwgYmxhY2tQaXhlbHMpOwogICAgICAgICAgICAgIGJsYWNrUGl4ZWxzIF49IDE7CiAgICAgICAgICAgICAgaWYgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgKytyZWZQb3M7CiAgICAgICAgICAgICAgICB3aGlsZSAocmVmTGluZVtyZWZQb3NdIDw9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICYmIHJlZkxpbmVbcmVmUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgcmVmUG9zICs9IDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIHR3b0RpbVZlcnQwOgogICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVscyhyZWZMaW5lW3JlZlBvc10sIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgICAgICBibGFja1BpeGVscyBePSAxOwogICAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICsrcmVmUG9zOwogICAgICAgICAgICAgICAgd2hpbGUgKHJlZkxpbmVbcmVmUG9zXSA8PSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAmJiByZWZMaW5lW3JlZlBvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSB0d29EaW1WZXJ0TDM6CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzTmVnKHJlZkxpbmVbcmVmUG9zXSAtIDMsIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgICAgICBibGFja1BpeGVscyBePSAxOwogICAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgIGlmIChyZWZQb3MgPiAwKSB7CiAgICAgICAgICAgICAgICAgIC0tcmVmUG9zOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgKytyZWZQb3M7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB3aGlsZSAocmVmTGluZVtyZWZQb3NdIDw9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICYmIHJlZkxpbmVbcmVmUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgcmVmUG9zICs9IDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIHR3b0RpbVZlcnRMMjoKICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHNOZWcocmVmTGluZVtyZWZQb3NdIC0gMiwgYmxhY2tQaXhlbHMpOwogICAgICAgICAgICAgIGJsYWNrUGl4ZWxzIF49IDE7CiAgICAgICAgICAgICAgaWYgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgaWYgKHJlZlBvcyA+IDApIHsKICAgICAgICAgICAgICAgICAgLS1yZWZQb3M7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICArK3JlZlBvczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdoaWxlIChyZWZMaW5lW3JlZlBvc10gPD0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gJiYgcmVmTGluZVtyZWZQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgICByZWZQb3MgKz0gMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgdHdvRGltVmVydEwxOgogICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVsc05lZyhyZWZMaW5lW3JlZlBvc10gLSAxLCBibGFja1BpeGVscyk7CiAgICAgICAgICAgICAgYmxhY2tQaXhlbHMgXj0gMTsKICAgICAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICBpZiAocmVmUG9zID4gMCkgewogICAgICAgICAgICAgICAgICAtLXJlZlBvczsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICsrcmVmUG9zOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2hpbGUgKHJlZkxpbmVbcmVmUG9zXSA8PSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAmJiByZWZMaW5lW3JlZlBvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBjY2l0dEVPRjoKICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHMoY29sdW1ucywgMCk7CiAgICAgICAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIGluZm8oImJhZCAyZCBjb2RlIik7CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKGNvbHVtbnMsIDApOwogICAgICAgICAgICAgIHRoaXMuZXJyID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29kaW5nTGluZVswXSA9IDA7CiAgICAgICAgdGhpcy5jb2RpbmdQb3MgPSAwOwogICAgICAgIGJsYWNrUGl4ZWxzID0gMDsKICAgICAgICB3aGlsZSAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICBjb2RlMSA9IDA7CiAgICAgICAgICBpZiAoYmxhY2tQaXhlbHMpIHsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGNvZGUxICs9IGNvZGUzID0gdGhpcy5fZ2V0QmxhY2tDb2RlKCk7CiAgICAgICAgICAgIH0gd2hpbGUgKGNvZGUzID49IDY0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBjb2RlMSArPSBjb2RlMyA9IHRoaXMuX2dldFdoaXRlQ29kZSgpOwogICAgICAgICAgICB9IHdoaWxlIChjb2RlMyA+PSA2NCk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLl9hZGRQaXhlbHMoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gKyBjb2RlMSwgYmxhY2tQaXhlbHMpOwogICAgICAgICAgYmxhY2tQaXhlbHMgXj0gMTsKICAgICAgICB9CiAgICAgIH0KICAgICAgbGV0IGdvdEVPTCA9IGZhbHNlOwogICAgICBpZiAodGhpcy5ieXRlQWxpZ24pIHsKICAgICAgICB0aGlzLmlucHV0Qml0cyAmPSB+NzsKICAgICAgfQogICAgICBpZiAoIXRoaXMuZW9ibG9jayAmJiB0aGlzLnJvdyA9PT0gdGhpcy5yb3dzIC0gMSkgewogICAgICAgIHRoaXMucm93c0RvbmUgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIGNvZGUxID0gdGhpcy5fbG9va0JpdHMoMTIpOwogICAgICAgIGlmICh0aGlzLmVvbGluZSkgewogICAgICAgICAgd2hpbGUgKGNvZGUxICE9PSBjY2l0dEVPRiAmJiBjb2RlMSAhPT0gMSkgewogICAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwogICAgICAgICAgICBjb2RlMSA9IHRoaXMuX2xvb2tCaXRzKDEyKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgd2hpbGUgKGNvZGUxID09PSAwKSB7CiAgICAgICAgICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICAgICAgICAgIGNvZGUxID0gdGhpcy5fbG9va0JpdHMoMTIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoY29kZTEgPT09IDEpIHsKICAgICAgICAgIHRoaXMuX2VhdEJpdHMoMTIpOwogICAgICAgICAgZ290RU9MID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKGNvZGUxID09PSBjY2l0dEVPRikgewogICAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIXRoaXMuZW9mICYmIHRoaXMuZW5jb2RpbmcgPiAwICYmICF0aGlzLnJvd3NEb25lKSB7CiAgICAgICAgdGhpcy5uZXh0TGluZTJEID0gIXRoaXMuX2xvb2tCaXRzKDEpOwogICAgICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZW9ibG9jayAmJiBnb3RFT0wgJiYgdGhpcy5ieXRlQWxpZ24pIHsKICAgICAgICBjb2RlMSA9IHRoaXMuX2xvb2tCaXRzKDEyKTsKICAgICAgICBpZiAoY29kZTEgPT09IDEpIHsKICAgICAgICAgIHRoaXMuX2VhdEJpdHMoMTIpOwogICAgICAgICAgaWYgKHRoaXMuZW5jb2RpbmcgPiAwKSB7CiAgICAgICAgICAgIHRoaXMuX2xvb2tCaXRzKDEpOwogICAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuZW5jb2RpbmcgPj0gMCkgewogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgNDsgKytpKSB7CiAgICAgICAgICAgICAgY29kZTEgPSB0aGlzLl9sb29rQml0cygxMik7CiAgICAgICAgICAgICAgaWYgKGNvZGUxICE9PSAxKSB7CiAgICAgICAgICAgICAgICBpbmZvKCJiYWQgcnRjIGNvZGU6ICIgKyBjb2RlMSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMuX2VhdEJpdHMoMTIpOwogICAgICAgICAgICAgIGlmICh0aGlzLmVuY29kaW5nID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5fbG9va0JpdHMoMSk7CiAgICAgICAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0aGlzLmVyciAmJiB0aGlzLmVvbGluZSkgewogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBjb2RlMSA9IHRoaXMuX2xvb2tCaXRzKDEzKTsKICAgICAgICAgIGlmIChjb2RlMSA9PT0gY2NpdHRFT0YpIHsKICAgICAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY29kZTEgPj4gMSA9PT0gMSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2VhdEJpdHMoMTIpOwogICAgICAgIGlmICh0aGlzLmVuY29kaW5nID4gMCkgewogICAgICAgICAgdGhpcy5fZWF0Qml0cygxKTsKICAgICAgICAgIHRoaXMubmV4dExpbmUyRCA9ICEoY29kZTEgJiAxKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5vdXRwdXRCaXRzID0gY29kaW5nTGluZVswXSA+IDAgPyBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zID0gMF0gOiBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zID0gMV07CiAgICAgIHRoaXMucm93Kys7CiAgICB9CiAgICBsZXQgYzsKICAgIGlmICh0aGlzLm91dHB1dEJpdHMgPj0gOCkgewogICAgICBjID0gdGhpcy5jb2RpbmdQb3MgJiAxID8gMCA6IDB4ZmY7CiAgICAgIHRoaXMub3V0cHV0Qml0cyAtPSA4OwogICAgICBpZiAodGhpcy5vdXRwdXRCaXRzID09PSAwICYmIGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgIHRoaXMuY29kaW5nUG9zKys7CiAgICAgICAgdGhpcy5vdXRwdXRCaXRzID0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gLSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zIC0gMV07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGJpdHMgPSA4OwogICAgICBjID0gMDsKICAgICAgZG8gewogICAgICAgIGlmICh0eXBlb2YgdGhpcy5vdXRwdXRCaXRzICE9PSAibnVtYmVyIikgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCdJbnZhbGlkIC9DQ0lUVEZheERlY29kZSBkYXRhLCAib3V0cHV0Qml0cyIgbXVzdCBiZSBhIG51bWJlci4nKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMub3V0cHV0Qml0cyA+IGJpdHMpIHsKICAgICAgICAgIGMgPDw9IGJpdHM7CiAgICAgICAgICBpZiAoISh0aGlzLmNvZGluZ1BvcyAmIDEpKSB7CiAgICAgICAgICAgIGMgfD0gMHhmZiA+PiA4IC0gYml0czsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMub3V0cHV0Qml0cyAtPSBiaXRzOwogICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGMgPDw9IHRoaXMub3V0cHV0Qml0czsKICAgICAgICAgIGlmICghKHRoaXMuY29kaW5nUG9zICYgMSkpIHsKICAgICAgICAgICAgYyB8PSAweGZmID4+IDggLSB0aGlzLm91dHB1dEJpdHM7CiAgICAgICAgICB9CiAgICAgICAgICBiaXRzIC09IHRoaXMub3V0cHV0Qml0czsKICAgICAgICAgIHRoaXMub3V0cHV0Qml0cyA9IDA7CiAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgIHRoaXMuY29kaW5nUG9zKys7CiAgICAgICAgICAgIHRoaXMub3V0cHV0Qml0cyA9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIC0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1BvcyAtIDFdOwogICAgICAgICAgfSBlbHNlIGlmIChiaXRzID4gMCkgewogICAgICAgICAgICBjIDw8PSBiaXRzOwogICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gd2hpbGUgKGJpdHMpOwogICAgfQogICAgaWYgKHRoaXMuYmxhY2spIHsKICAgICAgYyBePSAweGZmOwogICAgfQogICAgcmV0dXJuIGM7CiAgfQogIF9hZGRQaXhlbHMoYTEsIGJsYWNrUGl4ZWxzKSB7CiAgICBjb25zdCBjb2RpbmdMaW5lID0gdGhpcy5jb2RpbmdMaW5lOwogICAgbGV0IGNvZGluZ1BvcyA9IHRoaXMuY29kaW5nUG9zOwogICAgaWYgKGExID4gY29kaW5nTGluZVtjb2RpbmdQb3NdKSB7CiAgICAgIGlmIChhMSA+IHRoaXMuY29sdW1ucykgewogICAgICAgIGluZm8oInJvdyBpcyB3cm9uZyBsZW5ndGgiKTsKICAgICAgICB0aGlzLmVyciA9IHRydWU7CiAgICAgICAgYTEgPSB0aGlzLmNvbHVtbnM7CiAgICAgIH0KICAgICAgaWYgKGNvZGluZ1BvcyAmIDEgXiBibGFja1BpeGVscykgewogICAgICAgICsrY29kaW5nUG9zOwogICAgICB9CiAgICAgIGNvZGluZ0xpbmVbY29kaW5nUG9zXSA9IGExOwogICAgfQogICAgdGhpcy5jb2RpbmdQb3MgPSBjb2RpbmdQb3M7CiAgfQogIF9hZGRQaXhlbHNOZWcoYTEsIGJsYWNrUGl4ZWxzKSB7CiAgICBjb25zdCBjb2RpbmdMaW5lID0gdGhpcy5jb2RpbmdMaW5lOwogICAgbGV0IGNvZGluZ1BvcyA9IHRoaXMuY29kaW5nUG9zOwogICAgaWYgKGExID4gY29kaW5nTGluZVtjb2RpbmdQb3NdKSB7CiAgICAgIGlmIChhMSA+IHRoaXMuY29sdW1ucykgewogICAgICAgIGluZm8oInJvdyBpcyB3cm9uZyBsZW5ndGgiKTsKICAgICAgICB0aGlzLmVyciA9IHRydWU7CiAgICAgICAgYTEgPSB0aGlzLmNvbHVtbnM7CiAgICAgIH0KICAgICAgaWYgKGNvZGluZ1BvcyAmIDEgXiBibGFja1BpeGVscykgewogICAgICAgICsrY29kaW5nUG9zOwogICAgICB9CiAgICAgIGNvZGluZ0xpbmVbY29kaW5nUG9zXSA9IGExOwogICAgfSBlbHNlIGlmIChhMSA8IGNvZGluZ0xpbmVbY29kaW5nUG9zXSkgewogICAgICBpZiAoYTEgPCAwKSB7CiAgICAgICAgaW5mbygiaW52YWxpZCBjb2RlIik7CiAgICAgICAgdGhpcy5lcnIgPSB0cnVlOwogICAgICAgIGExID0gMDsKICAgICAgfQogICAgICB3aGlsZSAoY29kaW5nUG9zID4gMCAmJiBhMSA8IGNvZGluZ0xpbmVbY29kaW5nUG9zIC0gMV0pIHsKICAgICAgICAtLWNvZGluZ1BvczsKICAgICAgfQogICAgICBjb2RpbmdMaW5lW2NvZGluZ1Bvc10gPSBhMTsKICAgIH0KICAgIHRoaXMuY29kaW5nUG9zID0gY29kaW5nUG9zOwogIH0KICBfZmluZFRhYmxlQ29kZShzdGFydCwgZW5kLCB0YWJsZSwgbGltaXQpIHsKICAgIGNvbnN0IGxpbWl0VmFsdWUgPSBsaW1pdCB8fCAwOwogICAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDw9IGVuZDsgKytpKSB7CiAgICAgIGxldCBjb2RlID0gdGhpcy5fbG9va0JpdHMoaSk7CiAgICAgIGlmIChjb2RlID09PSBjY2l0dEVPRikgewogICAgICAgIHJldHVybiBbdHJ1ZSwgMSwgZmFsc2VdOwogICAgICB9CiAgICAgIGlmIChpIDwgZW5kKSB7CiAgICAgICAgY29kZSA8PD0gZW5kIC0gaTsKICAgICAgfQogICAgICBpZiAoIWxpbWl0VmFsdWUgfHwgY29kZSA+PSBsaW1pdFZhbHVlKSB7CiAgICAgICAgY29uc3QgcCA9IHRhYmxlW2NvZGUgLSBsaW1pdFZhbHVlXTsKICAgICAgICBpZiAocFswXSA9PT0gaSkgewogICAgICAgICAgdGhpcy5fZWF0Qml0cyhpKTsKICAgICAgICAgIHJldHVybiBbdHJ1ZSwgcFsxXSwgdHJ1ZV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gW2ZhbHNlLCAwLCBmYWxzZV07CiAgfQogIF9nZXRUd29EaW1Db2RlKCkgewogICAgbGV0IGNvZGUgPSAwOwogICAgbGV0IHA7CiAgICBpZiAodGhpcy5lb2Jsb2NrKSB7CiAgICAgIGNvZGUgPSB0aGlzLl9sb29rQml0cyg3KTsKICAgICAgcCA9IHR3b0RpbVRhYmxlW2NvZGVdOwogICAgICBpZiAocD8uWzBdID4gMCkgewogICAgICAgIHRoaXMuX2VhdEJpdHMocFswXSk7CiAgICAgICAgcmV0dXJuIHBbMV07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX2ZpbmRUYWJsZUNvZGUoMSwgNywgdHdvRGltVGFibGUpOwogICAgICBpZiAocmVzdWx0WzBdICYmIHJlc3VsdFsyXSkgewogICAgICAgIHJldHVybiByZXN1bHRbMV07CiAgICAgIH0KICAgIH0KICAgIGluZm8oIkJhZCB0d28gZGltIGNvZGUiKTsKICAgIHJldHVybiBjY2l0dEVPRjsKICB9CiAgX2dldFdoaXRlQ29kZSgpIHsKICAgIGxldCBjb2RlID0gMDsKICAgIGxldCBwOwogICAgaWYgKHRoaXMuZW9ibG9jaykgewogICAgICBjb2RlID0gdGhpcy5fbG9va0JpdHMoMTIpOwogICAgICBpZiAoY29kZSA9PT0gY2NpdHRFT0YpIHsKICAgICAgICByZXR1cm4gMTsKICAgICAgfQogICAgICBwID0gY29kZSA+PiA1ID09PSAwID8gd2hpdGVUYWJsZTFbY29kZV0gOiB3aGl0ZVRhYmxlMltjb2RlID4+IDNdOwogICAgICBpZiAocFswXSA+IDApIHsKICAgICAgICB0aGlzLl9lYXRCaXRzKHBbMF0pOwogICAgICAgIHJldHVybiBwWzFdOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5fZmluZFRhYmxlQ29kZSgxLCA5LCB3aGl0ZVRhYmxlMik7CiAgICAgIGlmIChyZXN1bHRbMF0pIHsKICAgICAgICByZXR1cm4gcmVzdWx0WzFdOwogICAgICB9CiAgICAgIHJlc3VsdCA9IHRoaXMuX2ZpbmRUYWJsZUNvZGUoMTEsIDEyLCB3aGl0ZVRhYmxlMSk7CiAgICAgIGlmIChyZXN1bHRbMF0pIHsKICAgICAgICByZXR1cm4gcmVzdWx0WzFdOwogICAgICB9CiAgICB9CiAgICBpbmZvKCJiYWQgd2hpdGUgY29kZSIpOwogICAgdGhpcy5fZWF0Qml0cygxKTsKICAgIHJldHVybiAxOwogIH0KICBfZ2V0QmxhY2tDb2RlKCkgewogICAgbGV0IGNvZGUsIHA7CiAgICBpZiAodGhpcy5lb2Jsb2NrKSB7CiAgICAgIGNvZGUgPSB0aGlzLl9sb29rQml0cygxMyk7CiAgICAgIGlmIChjb2RlID09PSBjY2l0dEVPRikgewogICAgICAgIHJldHVybiAxOwogICAgICB9CiAgICAgIGlmIChjb2RlID4+IDcgPT09IDApIHsKICAgICAgICBwID0gYmxhY2tUYWJsZTFbY29kZV07CiAgICAgIH0gZWxzZSBpZiAoY29kZSA+PiA5ID09PSAwICYmIGNvZGUgPj4gNyAhPT0gMCkgewogICAgICAgIHAgPSBibGFja1RhYmxlMlsoY29kZSA+PiAxKSAtIDY0XTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwID0gYmxhY2tUYWJsZTNbY29kZSA+PiA3XTsKICAgICAgfQogICAgICBpZiAocFswXSA+IDApIHsKICAgICAgICB0aGlzLl9lYXRCaXRzKHBbMF0pOwogICAgICAgIHJldHVybiBwWzFdOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5fZmluZFRhYmxlQ29kZSgyLCA2LCBibGFja1RhYmxlMyk7CiAgICAgIGlmIChyZXN1bHRbMF0pIHsKICAgICAgICByZXR1cm4gcmVzdWx0WzFdOwogICAgICB9CiAgICAgIHJlc3VsdCA9IHRoaXMuX2ZpbmRUYWJsZUNvZGUoNywgMTIsIGJsYWNrVGFibGUyLCA2NCk7CiAgICAgIGlmIChyZXN1bHRbMF0pIHsKICAgICAgICByZXR1cm4gcmVzdWx0WzFdOwogICAgICB9CiAgICAgIHJlc3VsdCA9IHRoaXMuX2ZpbmRUYWJsZUNvZGUoMTAsIDEzLCBibGFja1RhYmxlMSk7CiAgICAgIGlmIChyZXN1bHRbMF0pIHsKICAgICAgICByZXR1cm4gcmVzdWx0WzFdOwogICAgICB9CiAgICB9CiAgICBpbmZvKCJiYWQgYmxhY2sgY29kZSIpOwogICAgdGhpcy5fZWF0Qml0cygxKTsKICAgIHJldHVybiAxOwogIH0KICBfbG9va0JpdHMobikgewogICAgbGV0IGM7CiAgICB3aGlsZSAodGhpcy5pbnB1dEJpdHMgPCBuKSB7CiAgICAgIGlmICgoYyA9IHRoaXMuc291cmNlLm5leHQoKSkgPT09IC0xKSB7CiAgICAgICAgaWYgKHRoaXMuaW5wdXRCaXRzID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gY2NpdHRFT0Y7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmlucHV0QnVmIDw8IG4gLSB0aGlzLmlucHV0Qml0cyAmIDB4ZmZmZiA+PiAxNiAtIG47CiAgICAgIH0KICAgICAgdGhpcy5pbnB1dEJ1ZiA9IHRoaXMuaW5wdXRCdWYgPDwgOCB8IGM7CiAgICAgIHRoaXMuaW5wdXRCaXRzICs9IDg7CiAgICB9CiAgICByZXR1cm4gdGhpcy5pbnB1dEJ1ZiA+PiB0aGlzLmlucHV0Qml0cyAtIG4gJiAweGZmZmYgPj4gMTYgLSBuOwogIH0KICBfZWF0Qml0cyhuKSB7CiAgICBpZiAoKHRoaXMuaW5wdXRCaXRzIC09IG4pIDwgMCkgewogICAgICB0aGlzLmlucHV0Qml0cyA9IDA7CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9jY2l0dF9zdHJlYW0uanMKCgoKY2xhc3MgQ0NJVFRGYXhTdHJlYW0gZXh0ZW5kcyBEZWNvZGVTdHJlYW0gewogIGNvbnN0cnVjdG9yKHN0ciwgbWF5YmVMZW5ndGgsIHBhcmFtcykgewogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHIgPSBzdHI7CiAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICAgIGlmICghKHBhcmFtcyBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHBhcmFtcyA9IERpY3QuZW1wdHk7CiAgICB9CiAgICBjb25zdCBzb3VyY2UgPSB7CiAgICAgIG5leHQoKSB7CiAgICAgICAgcmV0dXJuIHN0ci5nZXRCeXRlKCk7CiAgICAgIH0KICAgIH07CiAgICB0aGlzLmNjaXR0RmF4RGVjb2RlciA9IG5ldyBDQ0lUVEZheERlY29kZXIoc291cmNlLCB7CiAgICAgIEs6IHBhcmFtcy5nZXQoIksiKSwKICAgICAgRW5kT2ZMaW5lOiBwYXJhbXMuZ2V0KCJFbmRPZkxpbmUiKSwKICAgICAgRW5jb2RlZEJ5dGVBbGlnbjogcGFyYW1zLmdldCgiRW5jb2RlZEJ5dGVBbGlnbiIpLAogICAgICBDb2x1bW5zOiBwYXJhbXMuZ2V0KCJDb2x1bW5zIiksCiAgICAgIFJvd3M6IHBhcmFtcy5nZXQoIlJvd3MiKSwKICAgICAgRW5kT2ZCbG9jazogcGFyYW1zLmdldCgiRW5kT2ZCbG9jayIpLAogICAgICBCbGFja0lzMTogcGFyYW1zLmdldCgiQmxhY2tJczEiKQogICAgfSk7CiAgfQogIHJlYWRCbG9jaygpIHsKICAgIHdoaWxlICghdGhpcy5lb2YpIHsKICAgICAgY29uc3QgYyA9IHRoaXMuY2NpdHRGYXhEZWNvZGVyLnJlYWROZXh0Q2hhcigpOwogICAgICBpZiAoYyA9PT0gLTEpIHsKICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuZW5zdXJlQnVmZmVyKHRoaXMuYnVmZmVyTGVuZ3RoICsgMSk7CiAgICAgIHRoaXMuYnVmZmVyW3RoaXMuYnVmZmVyTGVuZ3RoKytdID0gYzsKICAgIH0KICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2ZsYXRlX3N0cmVhbS5qcwoKCgpjb25zdCBjb2RlTGVuQ29kZU1hcCA9IG5ldyBJbnQzMkFycmF5KFsxNiwgMTcsIDE4LCAwLCA4LCA3LCA5LCA2LCAxMCwgNSwgMTEsIDQsIDEyLCAzLCAxMywgMiwgMTQsIDEsIDE1XSk7CmNvbnN0IGxlbmd0aERlY29kZSA9IG5ldyBJbnQzMkFycmF5KFsweDAwMDAzLCAweDAwMDA0LCAweDAwMDA1LCAweDAwMDA2LCAweDAwMDA3LCAweDAwMDA4LCAweDAwMDA5LCAweDAwMDBhLCAweDEwMDBiLCAweDEwMDBkLCAweDEwMDBmLCAweDEwMDExLCAweDIwMDEzLCAweDIwMDE3LCAweDIwMDFiLCAweDIwMDFmLCAweDMwMDIzLCAweDMwMDJiLCAweDMwMDMzLCAweDMwMDNiLCAweDQwMDQzLCAweDQwMDUzLCAweDQwMDYzLCAweDQwMDczLCAweDUwMDgzLCAweDUwMGEzLCAweDUwMGMzLCAweDUwMGUzLCAweDAwMTAyLCAweDAwMTAyLCAweDAwMTAyXSk7CmNvbnN0IGRpc3REZWNvZGUgPSBuZXcgSW50MzJBcnJheShbMHgwMDAwMSwgMHgwMDAwMiwgMHgwMDAwMywgMHgwMDAwNCwgMHgxMDAwNSwgMHgxMDAwNywgMHgyMDAwOSwgMHgyMDAwZCwgMHgzMDAxMSwgMHgzMDAxOSwgMHg0MDAyMSwgMHg0MDAzMSwgMHg1MDA0MSwgMHg1MDA2MSwgMHg2MDA4MSwgMHg2MDBjMSwgMHg3MDEwMSwgMHg3MDE4MSwgMHg4MDIwMSwgMHg4MDMwMSwgMHg5MDQwMSwgMHg5MDYwMSwgMHhhMDgwMSwgMHhhMGMwMSwgMHhiMTAwMSwgMHhiMTgwMSwgMHhjMjAwMSwgMHhjMzAwMSwgMHhkNDAwMSwgMHhkNjAwMV0pOwpjb25zdCBmaXhlZExpdENvZGVUYWIgPSBbbmV3IEludDMyQXJyYXkoWzB4NzAxMDAsIDB4ODAwNTAsIDB4ODAwMTAsIDB4ODAxMTgsIDB4NzAxMTAsIDB4ODAwNzAsIDB4ODAwMzAsIDB4OTAwYzAsIDB4NzAxMDgsIDB4ODAwNjAsIDB4ODAwMjAsIDB4OTAwYTAsIDB4ODAwMDAsIDB4ODAwODAsIDB4ODAwNDAsIDB4OTAwZTAsIDB4NzAxMDQsIDB4ODAwNTgsIDB4ODAwMTgsIDB4OTAwOTAsIDB4NzAxMTQsIDB4ODAwNzgsIDB4ODAwMzgsIDB4OTAwZDAsIDB4NzAxMGMsIDB4ODAwNjgsIDB4ODAwMjgsIDB4OTAwYjAsIDB4ODAwMDgsIDB4ODAwODgsIDB4ODAwNDgsIDB4OTAwZjAsIDB4NzAxMDIsIDB4ODAwNTQsIDB4ODAwMTQsIDB4ODAxMWMsIDB4NzAxMTIsIDB4ODAwNzQsIDB4ODAwMzQsIDB4OTAwYzgsIDB4NzAxMGEsIDB4ODAwNjQsIDB4ODAwMjQsIDB4OTAwYTgsIDB4ODAwMDQsIDB4ODAwODQsIDB4ODAwNDQsIDB4OTAwZTgsIDB4NzAxMDYsIDB4ODAwNWMsIDB4ODAwMWMsIDB4OTAwOTgsIDB4NzAxMTYsIDB4ODAwN2MsIDB4ODAwM2MsIDB4OTAwZDgsIDB4NzAxMGUsIDB4ODAwNmMsIDB4ODAwMmMsIDB4OTAwYjgsIDB4ODAwMGMsIDB4ODAwOGMsIDB4ODAwNGMsIDB4OTAwZjgsIDB4NzAxMDEsIDB4ODAwNTIsIDB4ODAwMTIsIDB4ODAxMWEsIDB4NzAxMTEsIDB4ODAwNzIsIDB4ODAwMzIsIDB4OTAwYzQsIDB4NzAxMDksIDB4ODAwNjIsIDB4ODAwMjIsIDB4OTAwYTQsIDB4ODAwMDIsIDB4ODAwODIsIDB4ODAwNDIsIDB4OTAwZTQsIDB4NzAxMDUsIDB4ODAwNWEsIDB4ODAwMWEsIDB4OTAwOTQsIDB4NzAxMTUsIDB4ODAwN2EsIDB4ODAwM2EsIDB4OTAwZDQsIDB4NzAxMGQsIDB4ODAwNmEsIDB4ODAwMmEsIDB4OTAwYjQsIDB4ODAwMGEsIDB4ODAwOGEsIDB4ODAwNGEsIDB4OTAwZjQsIDB4NzAxMDMsIDB4ODAwNTYsIDB4ODAwMTYsIDB4ODAxMWUsIDB4NzAxMTMsIDB4ODAwNzYsIDB4ODAwMzYsIDB4OTAwY2MsIDB4NzAxMGIsIDB4ODAwNjYsIDB4ODAwMjYsIDB4OTAwYWMsIDB4ODAwMDYsIDB4ODAwODYsIDB4ODAwNDYsIDB4OTAwZWMsIDB4NzAxMDcsIDB4ODAwNWUsIDB4ODAwMWUsIDB4OTAwOWMsIDB4NzAxMTcsIDB4ODAwN2UsIDB4ODAwM2UsIDB4OTAwZGMsIDB4NzAxMGYsIDB4ODAwNmUsIDB4ODAwMmUsIDB4OTAwYmMsIDB4ODAwMGUsIDB4ODAwOGUsIDB4ODAwNGUsIDB4OTAwZmMsIDB4NzAxMDAsIDB4ODAwNTEsIDB4ODAwMTEsIDB4ODAxMTksIDB4NzAxMTAsIDB4ODAwNzEsIDB4ODAwMzEsIDB4OTAwYzIsIDB4NzAxMDgsIDB4ODAwNjEsIDB4ODAwMjEsIDB4OTAwYTIsIDB4ODAwMDEsIDB4ODAwODEsIDB4ODAwNDEsIDB4OTAwZTIsIDB4NzAxMDQsIDB4ODAwNTksIDB4ODAwMTksIDB4OTAwOTIsIDB4NzAxMTQsIDB4ODAwNzksIDB4ODAwMzksIDB4OTAwZDIsIDB4NzAxMGMsIDB4ODAwNjksIDB4ODAwMjksIDB4OTAwYjIsIDB4ODAwMDksIDB4ODAwODksIDB4ODAwNDksIDB4OTAwZjIsIDB4NzAxMDIsIDB4ODAwNTUsIDB4ODAwMTUsIDB4ODAxMWQsIDB4NzAxMTIsIDB4ODAwNzUsIDB4ODAwMzUsIDB4OTAwY2EsIDB4NzAxMGEsIDB4ODAwNjUsIDB4ODAwMjUsIDB4OTAwYWEsIDB4ODAwMDUsIDB4ODAwODUsIDB4ODAwNDUsIDB4OTAwZWEsIDB4NzAxMDYsIDB4ODAwNWQsIDB4ODAwMWQsIDB4OTAwOWEsIDB4NzAxMTYsIDB4ODAwN2QsIDB4ODAwM2QsIDB4OTAwZGEsIDB4NzAxMGUsIDB4ODAwNmQsIDB4ODAwMmQsIDB4OTAwYmEsIDB4ODAwMGQsIDB4ODAwOGQsIDB4ODAwNGQsIDB4OTAwZmEsIDB4NzAxMDEsIDB4ODAwNTMsIDB4ODAwMTMsIDB4ODAxMWIsIDB4NzAxMTEsIDB4ODAwNzMsIDB4ODAwMzMsIDB4OTAwYzYsIDB4NzAxMDksIDB4ODAwNjMsIDB4ODAwMjMsIDB4OTAwYTYsIDB4ODAwMDMsIDB4ODAwODMsIDB4ODAwNDMsIDB4OTAwZTYsIDB4NzAxMDUsIDB4ODAwNWIsIDB4ODAwMWIsIDB4OTAwOTYsIDB4NzAxMTUsIDB4ODAwN2IsIDB4ODAwM2IsIDB4OTAwZDYsIDB4NzAxMGQsIDB4ODAwNmIsIDB4ODAwMmIsIDB4OTAwYjYsIDB4ODAwMGIsIDB4ODAwOGIsIDB4ODAwNGIsIDB4OTAwZjYsIDB4NzAxMDMsIDB4ODAwNTcsIDB4ODAwMTcsIDB4ODAxMWYsIDB4NzAxMTMsIDB4ODAwNzcsIDB4ODAwMzcsIDB4OTAwY2UsIDB4NzAxMGIsIDB4ODAwNjcsIDB4ODAwMjcsIDB4OTAwYWUsIDB4ODAwMDcsIDB4ODAwODcsIDB4ODAwNDcsIDB4OTAwZWUsIDB4NzAxMDcsIDB4ODAwNWYsIDB4ODAwMWYsIDB4OTAwOWUsIDB4NzAxMTcsIDB4ODAwN2YsIDB4ODAwM2YsIDB4OTAwZGUsIDB4NzAxMGYsIDB4ODAwNmYsIDB4ODAwMmYsIDB4OTAwYmUsIDB4ODAwMGYsIDB4ODAwOGYsIDB4ODAwNGYsIDB4OTAwZmUsIDB4NzAxMDAsIDB4ODAwNTAsIDB4ODAwMTAsIDB4ODAxMTgsIDB4NzAxMTAsIDB4ODAwNzAsIDB4ODAwMzAsIDB4OTAwYzEsIDB4NzAxMDgsIDB4ODAwNjAsIDB4ODAwMjAsIDB4OTAwYTEsIDB4ODAwMDAsIDB4ODAwODAsIDB4ODAwNDAsIDB4OTAwZTEsIDB4NzAxMDQsIDB4ODAwNTgsIDB4ODAwMTgsIDB4OTAwOTEsIDB4NzAxMTQsIDB4ODAwNzgsIDB4ODAwMzgsIDB4OTAwZDEsIDB4NzAxMGMsIDB4ODAwNjgsIDB4ODAwMjgsIDB4OTAwYjEsIDB4ODAwMDgsIDB4ODAwODgsIDB4ODAwNDgsIDB4OTAwZjEsIDB4NzAxMDIsIDB4ODAwNTQsIDB4ODAwMTQsIDB4ODAxMWMsIDB4NzAxMTIsIDB4ODAwNzQsIDB4ODAwMzQsIDB4OTAwYzksIDB4NzAxMGEsIDB4ODAwNjQsIDB4ODAwMjQsIDB4OTAwYTksIDB4ODAwMDQsIDB4ODAwODQsIDB4ODAwNDQsIDB4OTAwZTksIDB4NzAxMDYsIDB4ODAwNWMsIDB4ODAwMWMsIDB4OTAwOTksIDB4NzAxMTYsIDB4ODAwN2MsIDB4ODAwM2MsIDB4OTAwZDksIDB4NzAxMGUsIDB4ODAwNmMsIDB4ODAwMmMsIDB4OTAwYjksIDB4ODAwMGMsIDB4ODAwOGMsIDB4ODAwNGMsIDB4OTAwZjksIDB4NzAxMDEsIDB4ODAwNTIsIDB4ODAwMTIsIDB4ODAxMWEsIDB4NzAxMTEsIDB4ODAwNzIsIDB4ODAwMzIsIDB4OTAwYzUsIDB4NzAxMDksIDB4ODAwNjIsIDB4ODAwMjIsIDB4OTAwYTUsIDB4ODAwMDIsIDB4ODAwODIsIDB4ODAwNDIsIDB4OTAwZTUsIDB4NzAxMDUsIDB4ODAwNWEsIDB4ODAwMWEsIDB4OTAwOTUsIDB4NzAxMTUsIDB4ODAwN2EsIDB4ODAwM2EsIDB4OTAwZDUsIDB4NzAxMGQsIDB4ODAwNmEsIDB4ODAwMmEsIDB4OTAwYjUsIDB4ODAwMGEsIDB4ODAwOGEsIDB4ODAwNGEsIDB4OTAwZjUsIDB4NzAxMDMsIDB4ODAwNTYsIDB4ODAwMTYsIDB4ODAxMWUsIDB4NzAxMTMsIDB4ODAwNzYsIDB4ODAwMzYsIDB4OTAwY2QsIDB4NzAxMGIsIDB4ODAwNjYsIDB4ODAwMjYsIDB4OTAwYWQsIDB4ODAwMDYsIDB4ODAwODYsIDB4ODAwNDYsIDB4OTAwZWQsIDB4NzAxMDcsIDB4ODAwNWUsIDB4ODAwMWUsIDB4OTAwOWQsIDB4NzAxMTcsIDB4ODAwN2UsIDB4ODAwM2UsIDB4OTAwZGQsIDB4NzAxMGYsIDB4ODAwNmUsIDB4ODAwMmUsIDB4OTAwYmQsIDB4ODAwMGUsIDB4ODAwOGUsIDB4ODAwNGUsIDB4OTAwZmQsIDB4NzAxMDAsIDB4ODAwNTEsIDB4ODAwMTEsIDB4ODAxMTksIDB4NzAxMTAsIDB4ODAwNzEsIDB4ODAwMzEsIDB4OTAwYzMsIDB4NzAxMDgsIDB4ODAwNjEsIDB4ODAwMjEsIDB4OTAwYTMsIDB4ODAwMDEsIDB4ODAwODEsIDB4ODAwNDEsIDB4OTAwZTMsIDB4NzAxMDQsIDB4ODAwNTksIDB4ODAwMTksIDB4OTAwOTMsIDB4NzAxMTQsIDB4ODAwNzksIDB4ODAwMzksIDB4OTAwZDMsIDB4NzAxMGMsIDB4ODAwNjksIDB4ODAwMjksIDB4OTAwYjMsIDB4ODAwMDksIDB4ODAwODksIDB4ODAwNDksIDB4OTAwZjMsIDB4NzAxMDIsIDB4ODAwNTUsIDB4ODAwMTUsIDB4ODAxMWQsIDB4NzAxMTIsIDB4ODAwNzUsIDB4ODAwMzUsIDB4OTAwY2IsIDB4NzAxMGEsIDB4ODAwNjUsIDB4ODAwMjUsIDB4OTAwYWIsIDB4ODAwMDUsIDB4ODAwODUsIDB4ODAwNDUsIDB4OTAwZWIsIDB4NzAxMDYsIDB4ODAwNWQsIDB4ODAwMWQsIDB4OTAwOWIsIDB4NzAxMTYsIDB4ODAwN2QsIDB4ODAwM2QsIDB4OTAwZGIsIDB4NzAxMGUsIDB4ODAwNmQsIDB4ODAwMmQsIDB4OTAwYmIsIDB4ODAwMGQsIDB4ODAwOGQsIDB4ODAwNGQsIDB4OTAwZmIsIDB4NzAxMDEsIDB4ODAwNTMsIDB4ODAwMTMsIDB4ODAxMWIsIDB4NzAxMTEsIDB4ODAwNzMsIDB4ODAwMzMsIDB4OTAwYzcsIDB4NzAxMDksIDB4ODAwNjMsIDB4ODAwMjMsIDB4OTAwYTcsIDB4ODAwMDMsIDB4ODAwODMsIDB4ODAwNDMsIDB4OTAwZTcsIDB4NzAxMDUsIDB4ODAwNWIsIDB4ODAwMWIsIDB4OTAwOTcsIDB4NzAxMTUsIDB4ODAwN2IsIDB4ODAwM2IsIDB4OTAwZDcsIDB4NzAxMGQsIDB4ODAwNmIsIDB4ODAwMmIsIDB4OTAwYjcsIDB4ODAwMGIsIDB4ODAwOGIsIDB4ODAwNGIsIDB4OTAwZjcsIDB4NzAxMDMsIDB4ODAwNTcsIDB4ODAwMTcsIDB4ODAxMWYsIDB4NzAxMTMsIDB4ODAwNzcsIDB4ODAwMzcsIDB4OTAwY2YsIDB4NzAxMGIsIDB4ODAwNjcsIDB4ODAwMjcsIDB4OTAwYWYsIDB4ODAwMDcsIDB4ODAwODcsIDB4ODAwNDcsIDB4OTAwZWYsIDB4NzAxMDcsIDB4ODAwNWYsIDB4ODAwMWYsIDB4OTAwOWYsIDB4NzAxMTcsIDB4ODAwN2YsIDB4ODAwM2YsIDB4OTAwZGYsIDB4NzAxMGYsIDB4ODAwNmYsIDB4ODAwMmYsIDB4OTAwYmYsIDB4ODAwMGYsIDB4ODAwOGYsIDB4ODAwNGYsIDB4OTAwZmZdKSwgOV07CmNvbnN0IGZpeGVkRGlzdENvZGVUYWIgPSBbbmV3IEludDMyQXJyYXkoWzB4NTAwMDAsIDB4NTAwMTAsIDB4NTAwMDgsIDB4NTAwMTgsIDB4NTAwMDQsIDB4NTAwMTQsIDB4NTAwMGMsIDB4NTAwMWMsIDB4NTAwMDIsIDB4NTAwMTIsIDB4NTAwMGEsIDB4NTAwMWEsIDB4NTAwMDYsIDB4NTAwMTYsIDB4NTAwMGUsIDB4MDAwMDAsIDB4NTAwMDEsIDB4NTAwMTEsIDB4NTAwMDksIDB4NTAwMTksIDB4NTAwMDUsIDB4NTAwMTUsIDB4NTAwMGQsIDB4NTAwMWQsIDB4NTAwMDMsIDB4NTAwMTMsIDB4NTAwMGIsIDB4NTAwMWIsIDB4NTAwMDcsIDB4NTAwMTcsIDB4NTAwMGYsIDB4MDAwMDBdKSwgNV07CmNsYXNzIEZsYXRlU3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIsIG1heWJlTGVuZ3RoKSB7CiAgICBzdXBlcihtYXliZUxlbmd0aCk7CiAgICB0aGlzLnN0ciA9IHN0cjsKICAgIHRoaXMuZGljdCA9IHN0ci5kaWN0OwogICAgY29uc3QgY21mID0gc3RyLmdldEJ5dGUoKTsKICAgIGNvbnN0IGZsZyA9IHN0ci5nZXRCeXRlKCk7CiAgICBpZiAoY21mID09PSAtMSB8fCBmbGcgPT09IC0xKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBoZWFkZXIgaW4gZmxhdGUgc3RyZWFtOiAke2NtZn0sICR7ZmxnfWApOwogICAgfQogICAgaWYgKChjbWYgJiAweDBmKSAhPT0gMHgwOCkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYFVua25vd24gY29tcHJlc3Npb24gbWV0aG9kIGluIGZsYXRlIHN0cmVhbTogJHtjbWZ9LCAke2ZsZ31gKTsKICAgIH0KICAgIGlmICgoKGNtZiA8PCA4KSArIGZsZykgJSAzMSAhPT0gMCkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEJhZCBGQ0hFQ0sgaW4gZmxhdGUgc3RyZWFtOiAke2NtZn0sICR7ZmxnfWApOwogICAgfQogICAgaWYgKGZsZyAmIDB4MjApIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBGRElDVCBiaXQgc2V0IGluIGZsYXRlIHN0cmVhbTogJHtjbWZ9LCAke2ZsZ31gKTsKICAgIH0KICAgIHRoaXMuY29kZVNpemUgPSAwOwogICAgdGhpcy5jb2RlQnVmID0gMDsKICB9CiAgYXN5bmMgZ2V0SW1hZ2VEYXRhKGxlbmd0aCwgX2RlY29kZXJPcHRpb25zKSB7CiAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5hc3luY0dldEJ5dGVzKCk7CiAgICBpZiAoIWRhdGEpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0Qnl0ZXMobGVuZ3RoKTsKICAgIH0KICAgIGlmIChkYXRhLmxlbmd0aCA8PSBsZW5ndGgpIHsKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICByZXR1cm4gZGF0YS5zdWJhcnJheSgwLCBsZW5ndGgpOwogIH0KICBhc3luYyBhc3luY0dldEJ5dGVzKCkgewogICAgdGhpcy5zdHIucmVzZXQoKTsKICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5zdHIuZ2V0Qnl0ZXMoKTsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHsKICAgICAgICByZWFkYWJsZSwKICAgICAgICB3cml0YWJsZQogICAgICB9ID0gbmV3IERlY29tcHJlc3Npb25TdHJlYW0oImRlZmxhdGUiKTsKICAgICAgY29uc3Qgd3JpdGVyID0gd3JpdGFibGUuZ2V0V3JpdGVyKCk7CiAgICAgIGF3YWl0IHdyaXRlci5yZWFkeTsKICAgICAgd3JpdGVyLndyaXRlKGJ5dGVzKS50aGVuKGFzeW5jICgpID0+IHsKICAgICAgICBhd2FpdCB3cml0ZXIucmVhZHk7CiAgICAgICAgYXdhaXQgd3JpdGVyLmNsb3NlKCk7CiAgICAgIH0pLmNhdGNoKCgpID0+IHt9KTsKICAgICAgY29uc3QgY2h1bmtzID0gW107CiAgICAgIGxldCB0b3RhbExlbmd0aCA9IDA7CiAgICAgIGZvciBhd2FpdCAoY29uc3QgY2h1bmsgb2YgcmVhZGFibGUpIHsKICAgICAgICBjaHVua3MucHVzaChjaHVuayk7CiAgICAgICAgdG90YWxMZW5ndGggKz0gY2h1bmsuYnl0ZUxlbmd0aDsKICAgICAgfQogICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkodG90YWxMZW5ndGgpOwogICAgICBsZXQgb2Zmc2V0ID0gMDsKICAgICAgZm9yIChjb25zdCBjaHVuayBvZiBjaHVua3MpIHsKICAgICAgICBkYXRhLnNldChjaHVuaywgb2Zmc2V0KTsKICAgICAgICBvZmZzZXQgKz0gY2h1bmsuYnl0ZUxlbmd0aDsKICAgICAgfQogICAgICByZXR1cm4gZGF0YTsKICAgIH0gY2F0Y2ggewogICAgICB0aGlzLnN0ciA9IG5ldyBTdHJlYW0oYnl0ZXMsIDIsIGJ5dGVzLmxlbmd0aCwgdGhpcy5zdHIuZGljdCk7CiAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfQogIGdldCBpc0FzeW5jKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGdldEJpdHMoYml0cykgewogICAgY29uc3Qgc3RyID0gdGhpcy5zdHI7CiAgICBsZXQgY29kZVNpemUgPSB0aGlzLmNvZGVTaXplOwogICAgbGV0IGNvZGVCdWYgPSB0aGlzLmNvZGVCdWY7CiAgICBsZXQgYjsKICAgIHdoaWxlIChjb2RlU2l6ZSA8IGJpdHMpIHsKICAgICAgaWYgKChiID0gc3RyLmdldEJ5dGUoKSkgPT09IC0xKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJCYWQgZW5jb2RpbmcgaW4gZmxhdGUgc3RyZWFtIik7CiAgICAgIH0KICAgICAgY29kZUJ1ZiB8PSBiIDw8IGNvZGVTaXplOwogICAgICBjb2RlU2l6ZSArPSA4OwogICAgfQogICAgYiA9IGNvZGVCdWYgJiAoMSA8PCBiaXRzKSAtIDE7CiAgICB0aGlzLmNvZGVCdWYgPSBjb2RlQnVmID4+IGJpdHM7CiAgICB0aGlzLmNvZGVTaXplID0gY29kZVNpemUgLT0gYml0czsKICAgIHJldHVybiBiOwogIH0KICBnZXRDb2RlKHRhYmxlKSB7CiAgICBjb25zdCBzdHIgPSB0aGlzLnN0cjsKICAgIGNvbnN0IGNvZGVzID0gdGFibGVbMF07CiAgICBjb25zdCBtYXhMZW4gPSB0YWJsZVsxXTsKICAgIGxldCBjb2RlU2l6ZSA9IHRoaXMuY29kZVNpemU7CiAgICBsZXQgY29kZUJ1ZiA9IHRoaXMuY29kZUJ1ZjsKICAgIGxldCBiOwogICAgd2hpbGUgKGNvZGVTaXplIDwgbWF4TGVuKSB7CiAgICAgIGlmICgoYiA9IHN0ci5nZXRCeXRlKCkpID09PSAtMSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNvZGVCdWYgfD0gYiA8PCBjb2RlU2l6ZTsKICAgICAgY29kZVNpemUgKz0gODsKICAgIH0KICAgIGNvbnN0IGNvZGUgPSBjb2Rlc1tjb2RlQnVmICYgKDEgPDwgbWF4TGVuKSAtIDFdOwogICAgY29uc3QgY29kZUxlbiA9IGNvZGUgPj4gMTY7CiAgICBjb25zdCBjb2RlVmFsID0gY29kZSAmIDB4ZmZmZjsKICAgIGlmIChjb2RlTGVuIDwgMSB8fCBjb2RlU2l6ZSA8IGNvZGVMZW4pIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJCYWQgZW5jb2RpbmcgaW4gZmxhdGUgc3RyZWFtIik7CiAgICB9CiAgICB0aGlzLmNvZGVCdWYgPSBjb2RlQnVmID4+IGNvZGVMZW47CiAgICB0aGlzLmNvZGVTaXplID0gY29kZVNpemUgLSBjb2RlTGVuOwogICAgcmV0dXJuIGNvZGVWYWw7CiAgfQogIGdlbmVyYXRlSHVmZm1hblRhYmxlKGxlbmd0aHMpIHsKICAgIGNvbnN0IG4gPSBsZW5ndGhzLmxlbmd0aDsKICAgIGxldCBtYXhMZW4gPSAwOwogICAgbGV0IGk7CiAgICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgIGlmIChsZW5ndGhzW2ldID4gbWF4TGVuKSB7CiAgICAgICAgbWF4TGVuID0gbGVuZ3Roc1tpXTsKICAgICAgfQogICAgfQogICAgY29uc3Qgc2l6ZSA9IDEgPDwgbWF4TGVuOwogICAgY29uc3QgY29kZXMgPSBuZXcgSW50MzJBcnJheShzaXplKTsKICAgIGZvciAobGV0IGxlbiA9IDEsIGNvZGUgPSAwLCBza2lwID0gMjsgbGVuIDw9IG1heExlbjsgKytsZW4sIGNvZGUgPDw9IDEsIHNraXAgPDw9IDEpIHsKICAgICAgZm9yIChsZXQgdmFsID0gMDsgdmFsIDwgbjsgKyt2YWwpIHsKICAgICAgICBpZiAobGVuZ3Roc1t2YWxdID09PSBsZW4pIHsKICAgICAgICAgIGxldCBjb2RlMiA9IDA7CiAgICAgICAgICBsZXQgdCA9IGNvZGU7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgY29kZTIgPSBjb2RlMiA8PCAxIHwgdCAmIDE7CiAgICAgICAgICAgIHQgPj49IDE7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKGkgPSBjb2RlMjsgaSA8IHNpemU7IGkgKz0gc2tpcCkgewogICAgICAgICAgICBjb2Rlc1tpXSA9IGxlbiA8PCAxNiB8IHZhbDsKICAgICAgICAgIH0KICAgICAgICAgICsrY29kZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBbY29kZXMsIG1heExlbl07CiAgfQogICNlbmRzU3RyZWFtT25FcnJvcihlcnIpIHsKICAgIGluZm8oZXJyKTsKICAgIHRoaXMuZW9mID0gdHJ1ZTsKICB9CiAgcmVhZEJsb2NrKCkgewogICAgbGV0IGJ1ZmZlciwgaGRyLCBsZW47CiAgICBjb25zdCBzdHIgPSB0aGlzLnN0cjsKICAgIHRyeSB7CiAgICAgIGhkciA9IHRoaXMuZ2V0Qml0cygzKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIHRoaXMuI2VuZHNTdHJlYW1PbkVycm9yKGV4Lm1lc3NhZ2UpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoaGRyICYgMSkgewogICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICB9CiAgICBoZHIgPj49IDE7CiAgICBpZiAoaGRyID09PSAwKSB7CiAgICAgIGxldCBiOwogICAgICBpZiAoKGIgPSBzdHIuZ2V0Qnl0ZSgpKSA9PT0gLTEpIHsKICAgICAgICB0aGlzLiNlbmRzU3RyZWFtT25FcnJvcigiQmFkIGJsb2NrIGhlYWRlciBpbiBmbGF0ZSBzdHJlYW0iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgbGV0IGJsb2NrTGVuID0gYjsKICAgICAgaWYgKChiID0gc3RyLmdldEJ5dGUoKSkgPT09IC0xKSB7CiAgICAgICAgdGhpcy4jZW5kc1N0cmVhbU9uRXJyb3IoIkJhZCBibG9jayBoZWFkZXIgaW4gZmxhdGUgc3RyZWFtIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGJsb2NrTGVuIHw9IGIgPDwgODsKICAgICAgaWYgKChiID0gc3RyLmdldEJ5dGUoKSkgPT09IC0xKSB7CiAgICAgICAgdGhpcy4jZW5kc1N0cmVhbU9uRXJyb3IoIkJhZCBibG9jayBoZWFkZXIgaW4gZmxhdGUgc3RyZWFtIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxldCBjaGVjayA9IGI7CiAgICAgIGlmICgoYiA9IHN0ci5nZXRCeXRlKCkpID09PSAtMSkgewogICAgICAgIHRoaXMuI2VuZHNTdHJlYW1PbkVycm9yKCJCYWQgYmxvY2sgaGVhZGVyIGluIGZsYXRlIHN0cmVhbSIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjaGVjayB8PSBiIDw8IDg7CiAgICAgIGlmIChjaGVjayAhPT0gKH5ibG9ja0xlbiAmIDB4ZmZmZikgJiYgKGJsb2NrTGVuICE9PSAwIHx8IGNoZWNrICE9PSAwKSkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiQmFkIHVuY29tcHJlc3NlZCBibG9jayBsZW5ndGggaW4gZmxhdGUgc3RyZWFtIik7CiAgICAgIH0KICAgICAgdGhpcy5jb2RlQnVmID0gMDsKICAgICAgdGhpcy5jb2RlU2l6ZSA9IDA7CiAgICAgIGNvbnN0IGJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoLAogICAgICAgIGVuZCA9IGJ1ZmZlckxlbmd0aCArIGJsb2NrTGVuOwogICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihlbmQpOwogICAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IGVuZDsKICAgICAgaWYgKGJsb2NrTGVuID09PSAwKSB7CiAgICAgICAgaWYgKHN0ci5wZWVrQnl0ZSgpID09PSAtMSkgewogICAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBibG9jayA9IHN0ci5nZXRCeXRlcyhibG9ja0xlbik7CiAgICAgICAgYnVmZmVyLnNldChibG9jaywgYnVmZmVyTGVuZ3RoKTsKICAgICAgICBpZiAoYmxvY2subGVuZ3RoIDwgYmxvY2tMZW4pIHsKICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGxpdENvZGVUYWJsZTsKICAgIGxldCBkaXN0Q29kZVRhYmxlOwogICAgaWYgKGhkciA9PT0gMSkgewogICAgICBsaXRDb2RlVGFibGUgPSBmaXhlZExpdENvZGVUYWI7CiAgICAgIGRpc3RDb2RlVGFibGUgPSBmaXhlZERpc3RDb2RlVGFiOwogICAgfSBlbHNlIGlmIChoZHIgPT09IDIpIHsKICAgICAgY29uc3QgbnVtTGl0Q29kZXMgPSB0aGlzLmdldEJpdHMoNSkgKyAyNTc7CiAgICAgIGNvbnN0IG51bURpc3RDb2RlcyA9IHRoaXMuZ2V0Qml0cyg1KSArIDE7CiAgICAgIGNvbnN0IG51bUNvZGVMZW5Db2RlcyA9IHRoaXMuZ2V0Qml0cyg0KSArIDQ7CiAgICAgIGNvbnN0IGNvZGVMZW5Db2RlTGVuZ3RocyA9IG5ldyBVaW50OEFycmF5KGNvZGVMZW5Db2RlTWFwLmxlbmd0aCk7CiAgICAgIGxldCBpOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtQ29kZUxlbkNvZGVzOyArK2kpIHsKICAgICAgICBjb2RlTGVuQ29kZUxlbmd0aHNbY29kZUxlbkNvZGVNYXBbaV1dID0gdGhpcy5nZXRCaXRzKDMpOwogICAgICB9CiAgICAgIGNvbnN0IGNvZGVMZW5Db2RlVGFiID0gdGhpcy5nZW5lcmF0ZUh1ZmZtYW5UYWJsZShjb2RlTGVuQ29kZUxlbmd0aHMpOwogICAgICBsZW4gPSAwOwogICAgICBpID0gMDsKICAgICAgY29uc3QgY29kZXMgPSBudW1MaXRDb2RlcyArIG51bURpc3RDb2RlczsKICAgICAgY29uc3QgY29kZUxlbmd0aHMgPSBuZXcgVWludDhBcnJheShjb2Rlcyk7CiAgICAgIGxldCBiaXRzTGVuZ3RoLCBiaXRzT2Zmc2V0LCB3aGF0OwogICAgICB3aGlsZSAoaSA8IGNvZGVzKSB7CiAgICAgICAgY29uc3QgY29kZSA9IHRoaXMuZ2V0Q29kZShjb2RlTGVuQ29kZVRhYik7CiAgICAgICAgaWYgKGNvZGUgPT09IDE2KSB7CiAgICAgICAgICBiaXRzTGVuZ3RoID0gMjsKICAgICAgICAgIGJpdHNPZmZzZXQgPSAzOwogICAgICAgICAgd2hhdCA9IGxlbjsKICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPT09IDE3KSB7CiAgICAgICAgICBiaXRzTGVuZ3RoID0gMzsKICAgICAgICAgIGJpdHNPZmZzZXQgPSAzOwogICAgICAgICAgd2hhdCA9IGxlbiA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChjb2RlID09PSAxOCkgewogICAgICAgICAgYml0c0xlbmd0aCA9IDc7CiAgICAgICAgICBiaXRzT2Zmc2V0ID0gMTE7CiAgICAgICAgICB3aGF0ID0gbGVuID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29kZUxlbmd0aHNbaSsrXSA9IGxlbiA9IGNvZGU7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgbGV0IHJlcGVhdExlbmd0aCA9IHRoaXMuZ2V0Qml0cyhiaXRzTGVuZ3RoKSArIGJpdHNPZmZzZXQ7CiAgICAgICAgd2hpbGUgKHJlcGVhdExlbmd0aC0tID4gMCkgewogICAgICAgICAgY29kZUxlbmd0aHNbaSsrXSA9IHdoYXQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIGxpdENvZGVUYWJsZSA9IHRoaXMuZ2VuZXJhdGVIdWZmbWFuVGFibGUoY29kZUxlbmd0aHMuc3ViYXJyYXkoMCwgbnVtTGl0Q29kZXMpKTsKICAgICAgZGlzdENvZGVUYWJsZSA9IHRoaXMuZ2VuZXJhdGVIdWZmbWFuVGFibGUoY29kZUxlbmd0aHMuc3ViYXJyYXkobnVtTGl0Q29kZXMsIGNvZGVzKSk7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlVua25vd24gYmxvY2sgdHlwZSBpbiBmbGF0ZSBzdHJlYW0iKTsKICAgIH0KICAgIGJ1ZmZlciA9IHRoaXMuYnVmZmVyOwogICAgbGV0IGxpbWl0ID0gYnVmZmVyID8gYnVmZmVyLmxlbmd0aCA6IDA7CiAgICBsZXQgcG9zID0gdGhpcy5idWZmZXJMZW5ndGg7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBsZXQgY29kZTEgPSB0aGlzLmdldENvZGUobGl0Q29kZVRhYmxlKTsKICAgICAgaWYgKGNvZGUxIDwgMjU2KSB7CiAgICAgICAgaWYgKHBvcyArIDEgPj0gbGltaXQpIHsKICAgICAgICAgIGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKHBvcyArIDEpOwogICAgICAgICAgbGltaXQgPSBidWZmZXIubGVuZ3RoOwogICAgICAgIH0KICAgICAgICBidWZmZXJbcG9zKytdID0gY29kZTE7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGNvZGUxID09PSAyNTYpIHsKICAgICAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IHBvczsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29kZTEgLT0gMjU3OwogICAgICBjb2RlMSA9IGxlbmd0aERlY29kZVtjb2RlMV07CiAgICAgIGxldCBjb2RlMiA9IGNvZGUxID4+IDE2OwogICAgICBpZiAoY29kZTIgPiAwKSB7CiAgICAgICAgY29kZTIgPSB0aGlzLmdldEJpdHMoY29kZTIpOwogICAgICB9CiAgICAgIGxlbiA9IChjb2RlMSAmIDB4ZmZmZikgKyBjb2RlMjsKICAgICAgY29kZTEgPSB0aGlzLmdldENvZGUoZGlzdENvZGVUYWJsZSk7CiAgICAgIGNvZGUxID0gZGlzdERlY29kZVtjb2RlMV07CiAgICAgIGNvZGUyID0gY29kZTEgPj4gMTY7CiAgICAgIGlmIChjb2RlMiA+IDApIHsKICAgICAgICBjb2RlMiA9IHRoaXMuZ2V0Qml0cyhjb2RlMik7CiAgICAgIH0KICAgICAgY29uc3QgZGlzdCA9IChjb2RlMSAmIDB4ZmZmZikgKyBjb2RlMjsKICAgICAgaWYgKHBvcyArIGxlbiA+PSBsaW1pdCkgewogICAgICAgIGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKHBvcyArIGxlbik7CiAgICAgICAgbGltaXQgPSBidWZmZXIubGVuZ3RoOwogICAgICB9CiAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbGVuOyArK2ssICsrcG9zKSB7CiAgICAgICAgYnVmZmVyW3Bvc10gPSBidWZmZXJbcG9zIC0gZGlzdF07CiAgICAgIH0KICAgIH0KICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2FyaXRobWV0aWNfZGVjb2Rlci5qcwpjb25zdCBRZVRhYmxlID0gW3sKICBxZTogMHg1NjAxLAogIG5tcHM6IDEsCiAgbmxwczogMSwKICBzd2l0Y2hGbGFnOiAxCn0sIHsKICBxZTogMHgzNDAxLAogIG5tcHM6IDIsCiAgbmxwczogNiwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgxODAxLAogIG5tcHM6IDMsCiAgbmxwczogOSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwYWMxLAogIG5tcHM6IDQsCiAgbmxwczogMTIsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDUyMSwKICBubXBzOiA1LAogIG5scHM6IDI5LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAyMjEsCiAgbm1wczogMzgsCiAgbmxwczogMzMsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4NTYwMSwKICBubXBzOiA3LAogIG5scHM6IDYsCiAgc3dpdGNoRmxhZzogMQp9LCB7CiAgcWU6IDB4NTQwMSwKICBubXBzOiA4LAogIG5scHM6IDE0LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDQ4MDEsCiAgbm1wczogOSwKICBubHBzOiAxNCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgzODAxLAogIG5tcHM6IDEwLAogIG5scHM6IDE0LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDMwMDEsCiAgbm1wczogMTEsCiAgbmxwczogMTcsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MjQwMSwKICBubXBzOiAxMiwKICBubHBzOiAxOCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgxYzAxLAogIG5tcHM6IDEzLAogIG5scHM6IDIwLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDE2MDEsCiAgbm1wczogMjksCiAgbmxwczogMjEsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4NTYwMSwKICBubXBzOiAxNSwKICBubHBzOiAxNCwKICBzd2l0Y2hGbGFnOiAxCn0sIHsKICBxZTogMHg1NDAxLAogIG5tcHM6IDE2LAogIG5scHM6IDE0LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDUxMDEsCiAgbm1wczogMTcsCiAgbmxwczogMTUsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4NDgwMSwKICBubXBzOiAxOCwKICBubHBzOiAxNiwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgzODAxLAogIG5tcHM6IDE5LAogIG5scHM6IDE3LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDM0MDEsCiAgbm1wczogMjAsCiAgbmxwczogMTgsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MzAwMSwKICBubXBzOiAyMSwKICBubHBzOiAxOSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgyODAxLAogIG5tcHM6IDIyLAogIG5scHM6IDE5LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDI0MDEsCiAgbm1wczogMjMsCiAgbmxwczogMjAsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MjIwMSwKICBubXBzOiAyNCwKICBubHBzOiAyMSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgxYzAxLAogIG5tcHM6IDI1LAogIG5scHM6IDIyLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDE4MDEsCiAgbm1wczogMjYsCiAgbmxwczogMjMsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MTYwMSwKICBubXBzOiAyNywKICBubHBzOiAyNCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgxNDAxLAogIG5tcHM6IDI4LAogIG5scHM6IDI1LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDEyMDEsCiAgbm1wczogMjksCiAgbmxwczogMjYsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MTEwMSwKICBubXBzOiAzMCwKICBubHBzOiAyNywKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwYWMxLAogIG5tcHM6IDMxLAogIG5scHM6IDI4LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDA5YzEsCiAgbm1wczogMzIsCiAgbmxwczogMjksCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDhhMSwKICBubXBzOiAzMywKICBubHBzOiAzMCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwNTIxLAogIG5tcHM6IDM0LAogIG5scHM6IDMxLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDA0NDEsCiAgbm1wczogMzUsCiAgbmxwczogMzIsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDJhMSwKICBubXBzOiAzNiwKICBubHBzOiAzMywKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMjIxLAogIG5tcHM6IDM3LAogIG5scHM6IDM0LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAxNDEsCiAgbm1wczogMzgsCiAgbmxwczogMzUsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDExMSwKICBubXBzOiAzOSwKICBubHBzOiAzNiwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMDg1LAogIG5tcHM6IDQwLAogIG5scHM6IDM3LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAwNDksCiAgbm1wczogNDEsCiAgbmxwczogMzgsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDAyNSwKICBubXBzOiA0MiwKICBubHBzOiAzOSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMDE1LAogIG5tcHM6IDQzLAogIG5scHM6IDQwLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAwMDksCiAgbm1wczogNDQsCiAgbmxwczogNDEsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDAwNSwKICBubXBzOiA0NSwKICBubHBzOiA0MiwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMDAxLAogIG5tcHM6IDQ1LAogIG5scHM6IDQzLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDU2MDEsCiAgbm1wczogNDYsCiAgbmxwczogNDYsCiAgc3dpdGNoRmxhZzogMAp9XTsKY2xhc3MgQXJpdGhtZXRpY0RlY29kZXIgewogIGNvbnN0cnVjdG9yKGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICB0aGlzLmJwID0gc3RhcnQ7CiAgICB0aGlzLmRhdGFFbmQgPSBlbmQ7CiAgICB0aGlzLmNoaWdoID0gZGF0YVtzdGFydF07CiAgICB0aGlzLmNsb3cgPSAwOwogICAgdGhpcy5ieXRlSW4oKTsKICAgIHRoaXMuY2hpZ2ggPSB0aGlzLmNoaWdoIDw8IDcgJiAweGZmZmYgfCB0aGlzLmNsb3cgPj4gOSAmIDB4N2Y7CiAgICB0aGlzLmNsb3cgPSB0aGlzLmNsb3cgPDwgNyAmIDB4ZmZmZjsKICAgIHRoaXMuY3QgLT0gNzsKICAgIHRoaXMuYSA9IDB4ODAwMDsKICB9CiAgYnl0ZUluKCkgewogICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgIGxldCBicCA9IHRoaXMuYnA7CiAgICBpZiAoZGF0YVticF0gPT09IDB4ZmYpIHsKICAgICAgaWYgKGRhdGFbYnAgKyAxXSA+IDB4OGYpIHsKICAgICAgICB0aGlzLmNsb3cgKz0gMHhmZjAwOwogICAgICAgIHRoaXMuY3QgPSA4OwogICAgICB9IGVsc2UgewogICAgICAgIGJwKys7CiAgICAgICAgdGhpcy5jbG93ICs9IGRhdGFbYnBdIDw8IDk7CiAgICAgICAgdGhpcy5jdCA9IDc7CiAgICAgICAgdGhpcy5icCA9IGJwOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBicCsrOwogICAgICB0aGlzLmNsb3cgKz0gYnAgPCB0aGlzLmRhdGFFbmQgPyBkYXRhW2JwXSA8PCA4IDogMHhmZjAwOwogICAgICB0aGlzLmN0ID0gODsKICAgICAgdGhpcy5icCA9IGJwOwogICAgfQogICAgaWYgKHRoaXMuY2xvdyA+IDB4ZmZmZikgewogICAgICB0aGlzLmNoaWdoICs9IHRoaXMuY2xvdyA+PiAxNjsKICAgICAgdGhpcy5jbG93ICY9IDB4ZmZmZjsKICAgIH0KICB9CiAgcmVhZEJpdChjb250ZXh0cywgcG9zKSB7CiAgICBsZXQgY3hfaW5kZXggPSBjb250ZXh0c1twb3NdID4+IDEsCiAgICAgIGN4X21wcyA9IGNvbnRleHRzW3Bvc10gJiAxOwogICAgY29uc3QgcWVUYWJsZUljeCA9IFFlVGFibGVbY3hfaW5kZXhdOwogICAgY29uc3QgcWVJY3ggPSBxZVRhYmxlSWN4LnFlOwogICAgbGV0IGQ7CiAgICBsZXQgYSA9IHRoaXMuYSAtIHFlSWN4OwogICAgaWYgKHRoaXMuY2hpZ2ggPCBxZUljeCkgewogICAgICBpZiAoYSA8IHFlSWN4KSB7CiAgICAgICAgYSA9IHFlSWN4OwogICAgICAgIGQgPSBjeF9tcHM7CiAgICAgICAgY3hfaW5kZXggPSBxZVRhYmxlSWN4Lm5tcHM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYSA9IHFlSWN4OwogICAgICAgIGQgPSAxIF4gY3hfbXBzOwogICAgICAgIGlmIChxZVRhYmxlSWN4LnN3aXRjaEZsYWcgPT09IDEpIHsKICAgICAgICAgIGN4X21wcyA9IGQ7CiAgICAgICAgfQogICAgICAgIGN4X2luZGV4ID0gcWVUYWJsZUljeC5ubHBzOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNoaWdoIC09IHFlSWN4OwogICAgICBpZiAoKGEgJiAweDgwMDApICE9PSAwKSB7CiAgICAgICAgdGhpcy5hID0gYTsKICAgICAgICByZXR1cm4gY3hfbXBzOwogICAgICB9CiAgICAgIGlmIChhIDwgcWVJY3gpIHsKICAgICAgICBkID0gMSBeIGN4X21wczsKICAgICAgICBpZiAocWVUYWJsZUljeC5zd2l0Y2hGbGFnID09PSAxKSB7CiAgICAgICAgICBjeF9tcHMgPSBkOwogICAgICAgIH0KICAgICAgICBjeF9pbmRleCA9IHFlVGFibGVJY3gubmxwczsKICAgICAgfSBlbHNlIHsKICAgICAgICBkID0gY3hfbXBzOwogICAgICAgIGN4X2luZGV4ID0gcWVUYWJsZUljeC5ubXBzOwogICAgICB9CiAgICB9CiAgICBkbyB7CiAgICAgIGlmICh0aGlzLmN0ID09PSAwKSB7CiAgICAgICAgdGhpcy5ieXRlSW4oKTsKICAgICAgfQogICAgICBhIDw8PSAxOwogICAgICB0aGlzLmNoaWdoID0gdGhpcy5jaGlnaCA8PCAxICYgMHhmZmZmIHwgdGhpcy5jbG93ID4+IDE1ICYgMTsKICAgICAgdGhpcy5jbG93ID0gdGhpcy5jbG93IDw8IDEgJiAweGZmZmY7CiAgICAgIHRoaXMuY3QtLTsKICAgIH0gd2hpbGUgKChhICYgMHg4MDAwKSA9PT0gMCk7CiAgICB0aGlzLmEgPSBhOwogICAgY29udGV4dHNbcG9zXSA9IGN4X2luZGV4IDw8IDEgfCBjeF9tcHM7CiAgICByZXR1cm4gZDsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2piaWcyLmpzCgoKCgpjbGFzcyBKYmlnMkVycm9yIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobXNnKSB7CiAgICBzdXBlcihtc2csICJKYmlnMkVycm9yIik7CiAgfQp9CmNsYXNzIENvbnRleHRDYWNoZSB7CiAgZ2V0Q29udGV4dHMoaWQpIHsKICAgIGlmIChpZCBpbiB0aGlzKSB7CiAgICAgIHJldHVybiB0aGlzW2lkXTsKICAgIH0KICAgIHJldHVybiB0aGlzW2lkXSA9IG5ldyBJbnQ4QXJyYXkoMSA8PCAxNik7CiAgfQp9CmNsYXNzIERlY29kaW5nQ29udGV4dCB7CiAgY29uc3RydWN0b3IoZGF0YSwgc3RhcnQsIGVuZCkgewogICAgdGhpcy5kYXRhID0gZGF0YTsKICAgIHRoaXMuc3RhcnQgPSBzdGFydDsKICAgIHRoaXMuZW5kID0gZW5kOwogIH0KICBnZXQgZGVjb2RlcigpIHsKICAgIGNvbnN0IGRlY29kZXIgPSBuZXcgQXJpdGhtZXRpY0RlY29kZXIodGhpcy5kYXRhLCB0aGlzLnN0YXJ0LCB0aGlzLmVuZCk7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJkZWNvZGVyIiwgZGVjb2Rlcik7CiAgfQogIGdldCBjb250ZXh0Q2FjaGUoKSB7CiAgICBjb25zdCBjYWNoZSA9IG5ldyBDb250ZXh0Q2FjaGUoKTsKICAgIHJldHVybiBzaGFkb3codGhpcywgImNvbnRleHRDYWNoZSIsIGNhY2hlKTsKICB9Cn0KZnVuY3Rpb24gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsIHByb2NlZHVyZSwgZGVjb2RlcikgewogIGNvbnN0IGNvbnRleHRzID0gY29udGV4dENhY2hlLmdldENvbnRleHRzKHByb2NlZHVyZSk7CiAgbGV0IHByZXYgPSAxOwogIGZ1bmN0aW9uIHJlYWRCaXRzKGxlbmd0aCkgewogICAgbGV0IHYgPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBjb25zdCBiaXQgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIHByZXYpOwogICAgICBwcmV2ID0gcHJldiA8IDI1NiA/IHByZXYgPDwgMSB8IGJpdCA6IChwcmV2IDw8IDEgfCBiaXQpICYgNTExIHwgMjU2OwogICAgICB2ID0gdiA8PCAxIHwgYml0OwogICAgfQogICAgcmV0dXJuIHYgPj4+IDA7CiAgfQogIGNvbnN0IHNpZ24gPSByZWFkQml0cygxKTsKICBjb25zdCB2YWx1ZSA9IHJlYWRCaXRzKDEpID8gcmVhZEJpdHMoMSkgPyByZWFkQml0cygxKSA/IHJlYWRCaXRzKDEpID8gcmVhZEJpdHMoMSkgPyByZWFkQml0cygzMikgKyA0NDM2IDogcmVhZEJpdHMoMTIpICsgMzQwIDogcmVhZEJpdHMoOCkgKyA4NCA6IHJlYWRCaXRzKDYpICsgMjAgOiByZWFkQml0cyg0KSArIDQgOiByZWFkQml0cygyKTsKICBsZXQgc2lnbmVkVmFsdWU7CiAgaWYgKHNpZ24gPT09IDApIHsKICAgIHNpZ25lZFZhbHVlID0gdmFsdWU7CiAgfSBlbHNlIGlmICh2YWx1ZSA+IDApIHsKICAgIHNpZ25lZFZhbHVlID0gLXZhbHVlOwogIH0KICBpZiAoc2lnbmVkVmFsdWUgPj0gTUlOX0lOVF8zMiAmJiBzaWduZWRWYWx1ZSA8PSBNQVhfSU5UXzMyKSB7CiAgICByZXR1cm4gc2lnbmVkVmFsdWU7CiAgfQogIHJldHVybiBudWxsOwp9CmZ1bmN0aW9uIGRlY29kZUlBSUQoY29udGV4dENhY2hlLCBkZWNvZGVyLCBjb2RlTGVuZ3RoKSB7CiAgY29uc3QgY29udGV4dHMgPSBjb250ZXh0Q2FjaGUuZ2V0Q29udGV4dHMoIklBSUQiKTsKICBsZXQgcHJldiA9IDE7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2RlTGVuZ3RoOyBpKyspIHsKICAgIGNvbnN0IGJpdCA9IGRlY29kZXIucmVhZEJpdChjb250ZXh0cywgcHJldik7CiAgICBwcmV2ID0gcHJldiA8PCAxIHwgYml0OwogIH0KICBpZiAoY29kZUxlbmd0aCA8IDMxKSB7CiAgICByZXR1cm4gcHJldiAmICgxIDw8IGNvZGVMZW5ndGgpIC0gMTsKICB9CiAgcmV0dXJuIHByZXYgJiAweDdmZmZmZmZmOwp9CmNvbnN0IFNlZ21lbnRUeXBlcyA9IFsiU3ltYm9sRGljdGlvbmFyeSIsIG51bGwsIG51bGwsIG51bGwsICJJbnRlcm1lZGlhdGVUZXh0UmVnaW9uIiwgbnVsbCwgIkltbWVkaWF0ZVRleHRSZWdpb24iLCAiSW1tZWRpYXRlTG9zc2xlc3NUZXh0UmVnaW9uIiwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgIlBhdHRlcm5EaWN0aW9uYXJ5IiwgbnVsbCwgbnVsbCwgbnVsbCwgIkludGVybWVkaWF0ZUhhbGZ0b25lUmVnaW9uIiwgbnVsbCwgIkltbWVkaWF0ZUhhbGZ0b25lUmVnaW9uIiwgIkltbWVkaWF0ZUxvc3NsZXNzSGFsZnRvbmVSZWdpb24iLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCAiSW50ZXJtZWRpYXRlR2VuZXJpY1JlZ2lvbiIsIG51bGwsICJJbW1lZGlhdGVHZW5lcmljUmVnaW9uIiwgIkltbWVkaWF0ZUxvc3NsZXNzR2VuZXJpY1JlZ2lvbiIsICJJbnRlcm1lZGlhdGVHZW5lcmljUmVmaW5lbWVudFJlZ2lvbiIsIG51bGwsICJJbW1lZGlhdGVHZW5lcmljUmVmaW5lbWVudFJlZ2lvbiIsICJJbW1lZGlhdGVMb3NzbGVzc0dlbmVyaWNSZWZpbmVtZW50UmVnaW9uIiwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgIlBhZ2VJbmZvcm1hdGlvbiIsICJFbmRPZlBhZ2UiLCAiRW5kT2ZTdHJpcGUiLCAiRW5kT2ZGaWxlIiwgIlByb2ZpbGVzIiwgIlRhYmxlcyIsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsICJFeHRlbnNpb24iXTsKY29uc3QgQ29kaW5nVGVtcGxhdGVzID0gW1t7CiAgeDogLTEsCiAgeTogLTIKfSwgewogIHg6IDAsCiAgeTogLTIKfSwgewogIHg6IDEsCiAgeTogLTIKfSwgewogIHg6IC0yLAogIHk6IC0xCn0sIHsKICB4OiAtMSwKICB5OiAtMQp9LCB7CiAgeDogMCwKICB5OiAtMQp9LCB7CiAgeDogMSwKICB5OiAtMQp9LCB7CiAgeDogMiwKICB5OiAtMQp9LCB7CiAgeDogLTQsCiAgeTogMAp9LCB7CiAgeDogLTMsCiAgeTogMAp9LCB7CiAgeDogLTIsCiAgeTogMAp9LCB7CiAgeDogLTEsCiAgeTogMAp9XSwgW3sKICB4OiAtMSwKICB5OiAtMgp9LCB7CiAgeDogMCwKICB5OiAtMgp9LCB7CiAgeDogMSwKICB5OiAtMgp9LCB7CiAgeDogMiwKICB5OiAtMgp9LCB7CiAgeDogLTIsCiAgeTogLTEKfSwgewogIHg6IC0xLAogIHk6IC0xCn0sIHsKICB4OiAwLAogIHk6IC0xCn0sIHsKICB4OiAxLAogIHk6IC0xCn0sIHsKICB4OiAyLAogIHk6IC0xCn0sIHsKICB4OiAtMywKICB5OiAwCn0sIHsKICB4OiAtMiwKICB5OiAwCn0sIHsKICB4OiAtMSwKICB5OiAwCn1dLCBbewogIHg6IC0xLAogIHk6IC0yCn0sIHsKICB4OiAwLAogIHk6IC0yCn0sIHsKICB4OiAxLAogIHk6IC0yCn0sIHsKICB4OiAtMiwKICB5OiAtMQp9LCB7CiAgeDogLTEsCiAgeTogLTEKfSwgewogIHg6IDAsCiAgeTogLTEKfSwgewogIHg6IDEsCiAgeTogLTEKfSwgewogIHg6IC0yLAogIHk6IDAKfSwgewogIHg6IC0xLAogIHk6IDAKfV0sIFt7CiAgeDogLTMsCiAgeTogLTEKfSwgewogIHg6IC0yLAogIHk6IC0xCn0sIHsKICB4OiAtMSwKICB5OiAtMQp9LCB7CiAgeDogMCwKICB5OiAtMQp9LCB7CiAgeDogMSwKICB5OiAtMQp9LCB7CiAgeDogLTQsCiAgeTogMAp9LCB7CiAgeDogLTMsCiAgeTogMAp9LCB7CiAgeDogLTIsCiAgeTogMAp9LCB7CiAgeDogLTEsCiAgeTogMAp9XV07CmNvbnN0IFJlZmluZW1lbnRUZW1wbGF0ZXMgPSBbewogIGNvZGluZzogW3sKICAgIHg6IDAsCiAgICB5OiAtMQogIH0sIHsKICAgIHg6IDEsCiAgICB5OiAtMQogIH0sIHsKICAgIHg6IC0xLAogICAgeTogMAogIH1dLAogIHJlZmVyZW5jZTogW3sKICAgIHg6IDAsCiAgICB5OiAtMQogIH0sIHsKICAgIHg6IDEsCiAgICB5OiAtMQogIH0sIHsKICAgIHg6IC0xLAogICAgeTogMAogIH0sIHsKICAgIHg6IDAsCiAgICB5OiAwCiAgfSwgewogICAgeDogMSwKICAgIHk6IDAKICB9LCB7CiAgICB4OiAtMSwKICAgIHk6IDEKICB9LCB7CiAgICB4OiAwLAogICAgeTogMQogIH0sIHsKICAgIHg6IDEsCiAgICB5OiAxCiAgfV0KfSwgewogIGNvZGluZzogW3sKICAgIHg6IC0xLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAwLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAxLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAtMSwKICAgIHk6IDAKICB9XSwKICByZWZlcmVuY2U6IFt7CiAgICB4OiAwLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAtMSwKICAgIHk6IDAKICB9LCB7CiAgICB4OiAwLAogICAgeTogMAogIH0sIHsKICAgIHg6IDEsCiAgICB5OiAwCiAgfSwgewogICAgeDogMCwKICAgIHk6IDEKICB9LCB7CiAgICB4OiAxLAogICAgeTogMQogIH1dCn1dOwpjb25zdCBSZXVzZWRDb250ZXh0cyA9IFsweDliMjUsIDB4MDc5NSwgMHgwMGU1LCAweDAxOTVdOwpjb25zdCBSZWZpbmVtZW50UmV1c2VkQ29udGV4dHMgPSBbMHgwMDIwLCAweDAwMDhdOwpmdW5jdGlvbiBkZWNvZGVCaXRtYXBUZW1wbGF0ZTAod2lkdGgsIGhlaWdodCwgZGVjb2RpbmdDb250ZXh0KSB7CiAgY29uc3QgZGVjb2RlciA9IGRlY29kaW5nQ29udGV4dC5kZWNvZGVyOwogIGNvbnN0IGNvbnRleHRzID0gZGVjb2RpbmdDb250ZXh0LmNvbnRleHRDYWNoZS5nZXRDb250ZXh0cygiR0IiKTsKICBjb25zdCBiaXRtYXAgPSBbXTsKICBsZXQgY29udGV4dExhYmVsLCBpLCBqLCBwaXhlbCwgcm93LCByb3cxLCByb3cyOwogIGNvbnN0IE9MRF9QSVhFTF9NQVNLID0gMHg3YmY3OwogIGZvciAoaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgcm93ID0gYml0bWFwW2ldID0gbmV3IFVpbnQ4QXJyYXkod2lkdGgpOwogICAgcm93MSA9IGkgPCAxID8gcm93IDogYml0bWFwW2kgLSAxXTsKICAgIHJvdzIgPSBpIDwgMiA/IHJvdyA6IGJpdG1hcFtpIC0gMl07CiAgICBjb250ZXh0TGFiZWwgPSByb3cyWzBdIDw8IDEzIHwgcm93MlsxXSA8PCAxMiB8IHJvdzJbMl0gPDwgMTEgfCByb3cxWzBdIDw8IDcgfCByb3cxWzFdIDw8IDYgfCByb3cxWzJdIDw8IDUgfCByb3cxWzNdIDw8IDQ7CiAgICBmb3IgKGogPSAwOyBqIDwgd2lkdGg7IGorKykgewogICAgICByb3dbal0gPSBwaXhlbCA9IGRlY29kZXIucmVhZEJpdChjb250ZXh0cywgY29udGV4dExhYmVsKTsKICAgICAgY29udGV4dExhYmVsID0gKGNvbnRleHRMYWJlbCAmIE9MRF9QSVhFTF9NQVNLKSA8PCAxIHwgKGogKyAzIDwgd2lkdGggPyByb3cyW2ogKyAzXSA8PCAxMSA6IDApIHwgKGogKyA0IDwgd2lkdGggPyByb3cxW2ogKyA0XSA8PCA0IDogMCkgfCBwaXhlbDsKICAgIH0KICB9CiAgcmV0dXJuIGJpdG1hcDsKfQpmdW5jdGlvbiBkZWNvZGVCaXRtYXAobW1yLCB3aWR0aCwgaGVpZ2h0LCB0ZW1wbGF0ZUluZGV4LCBwcmVkaWN0aW9uLCBza2lwLCBhdCwgZGVjb2RpbmdDb250ZXh0KSB7CiAgaWYgKG1tcikgewogICAgY29uc3QgaW5wdXQgPSBuZXcgUmVhZGVyKGRlY29kaW5nQ29udGV4dC5kYXRhLCBkZWNvZGluZ0NvbnRleHQuc3RhcnQsIGRlY29kaW5nQ29udGV4dC5lbmQpOwogICAgcmV0dXJuIGRlY29kZU1NUkJpdG1hcChpbnB1dCwgd2lkdGgsIGhlaWdodCwgZmFsc2UpOwogIH0KICBpZiAodGVtcGxhdGVJbmRleCA9PT0gMCAmJiAhc2tpcCAmJiAhcHJlZGljdGlvbiAmJiBhdC5sZW5ndGggPT09IDQgJiYgYXRbMF0ueCA9PT0gMyAmJiBhdFswXS55ID09PSAtMSAmJiBhdFsxXS54ID09PSAtMyAmJiBhdFsxXS55ID09PSAtMSAmJiBhdFsyXS54ID09PSAyICYmIGF0WzJdLnkgPT09IC0yICYmIGF0WzNdLnggPT09IC0yICYmIGF0WzNdLnkgPT09IC0yKSB7CiAgICByZXR1cm4gZGVjb2RlQml0bWFwVGVtcGxhdGUwKHdpZHRoLCBoZWlnaHQsIGRlY29kaW5nQ29udGV4dCk7CiAgfQogIGNvbnN0IHVzZXNraXAgPSAhIXNraXA7CiAgY29uc3QgdGVtcGxhdGUgPSBDb2RpbmdUZW1wbGF0ZXNbdGVtcGxhdGVJbmRleF0uY29uY2F0KGF0KTsKICB0ZW1wbGF0ZS5zb3J0KChhLCBiKSA9PiBhLnkgLSBiLnkgfHwgYS54IC0gYi54KTsKICBjb25zdCB0ZW1wbGF0ZUxlbmd0aCA9IHRlbXBsYXRlLmxlbmd0aDsKICBjb25zdCB0ZW1wbGF0ZVggPSBuZXcgSW50OEFycmF5KHRlbXBsYXRlTGVuZ3RoKTsKICBjb25zdCB0ZW1wbGF0ZVkgPSBuZXcgSW50OEFycmF5KHRlbXBsYXRlTGVuZ3RoKTsKICBjb25zdCBjaGFuZ2luZ1RlbXBsYXRlRW50cmllcyA9IFtdOwogIGxldCByZXVzZU1hc2sgPSAwLAogICAgbWluWCA9IDAsCiAgICBtYXhYID0gMCwKICAgIG1pblkgPSAwOwogIGxldCBjLCBrOwogIGZvciAoayA9IDA7IGsgPCB0ZW1wbGF0ZUxlbmd0aDsgaysrKSB7CiAgICB0ZW1wbGF0ZVhba10gPSB0ZW1wbGF0ZVtrXS54OwogICAgdGVtcGxhdGVZW2tdID0gdGVtcGxhdGVba10ueTsKICAgIG1pblggPSBNYXRoLm1pbihtaW5YLCB0ZW1wbGF0ZVtrXS54KTsKICAgIG1heFggPSBNYXRoLm1heChtYXhYLCB0ZW1wbGF0ZVtrXS54KTsKICAgIG1pblkgPSBNYXRoLm1pbihtaW5ZLCB0ZW1wbGF0ZVtrXS55KTsKICAgIGlmIChrIDwgdGVtcGxhdGVMZW5ndGggLSAxICYmIHRlbXBsYXRlW2tdLnkgPT09IHRlbXBsYXRlW2sgKyAxXS55ICYmIHRlbXBsYXRlW2tdLnggPT09IHRlbXBsYXRlW2sgKyAxXS54IC0gMSkgewogICAgICByZXVzZU1hc2sgfD0gMSA8PCB0ZW1wbGF0ZUxlbmd0aCAtIDEgLSBrOwogICAgfSBlbHNlIHsKICAgICAgY2hhbmdpbmdUZW1wbGF0ZUVudHJpZXMucHVzaChrKTsKICAgIH0KICB9CiAgY29uc3QgY2hhbmdpbmdFbnRyaWVzTGVuZ3RoID0gY2hhbmdpbmdUZW1wbGF0ZUVudHJpZXMubGVuZ3RoOwogIGNvbnN0IGNoYW5naW5nVGVtcGxhdGVYID0gbmV3IEludDhBcnJheShjaGFuZ2luZ0VudHJpZXNMZW5ndGgpOwogIGNvbnN0IGNoYW5naW5nVGVtcGxhdGVZID0gbmV3IEludDhBcnJheShjaGFuZ2luZ0VudHJpZXNMZW5ndGgpOwogIGNvbnN0IGNoYW5naW5nVGVtcGxhdGVCaXQgPSBuZXcgVWludDE2QXJyYXkoY2hhbmdpbmdFbnRyaWVzTGVuZ3RoKTsKICBmb3IgKGMgPSAwOyBjIDwgY2hhbmdpbmdFbnRyaWVzTGVuZ3RoOyBjKyspIHsKICAgIGsgPSBjaGFuZ2luZ1RlbXBsYXRlRW50cmllc1tjXTsKICAgIGNoYW5naW5nVGVtcGxhdGVYW2NdID0gdGVtcGxhdGVba10ueDsKICAgIGNoYW5naW5nVGVtcGxhdGVZW2NdID0gdGVtcGxhdGVba10ueTsKICAgIGNoYW5naW5nVGVtcGxhdGVCaXRbY10gPSAxIDw8IHRlbXBsYXRlTGVuZ3RoIC0gMSAtIGs7CiAgfQogIGNvbnN0IHNiYl9sZWZ0ID0gLW1pblg7CiAgY29uc3Qgc2JiX3RvcCA9IC1taW5ZOwogIGNvbnN0IHNiYl9yaWdodCA9IHdpZHRoIC0gbWF4WDsKICBjb25zdCBwc2V1ZG9QaXhlbENvbnRleHQgPSBSZXVzZWRDb250ZXh0c1t0ZW1wbGF0ZUluZGV4XTsKICBsZXQgcm93ID0gbmV3IFVpbnQ4QXJyYXkod2lkdGgpOwogIGNvbnN0IGJpdG1hcCA9IFtdOwogIGNvbnN0IGRlY29kZXIgPSBkZWNvZGluZ0NvbnRleHQuZGVjb2RlcjsKICBjb25zdCBjb250ZXh0cyA9IGRlY29kaW5nQ29udGV4dC5jb250ZXh0Q2FjaGUuZ2V0Q29udGV4dHMoIkdCIik7CiAgbGV0IGx0cCA9IDAsCiAgICBqLAogICAgaTAsCiAgICBqMCwKICAgIGNvbnRleHRMYWJlbCA9IDAsCiAgICBiaXQsCiAgICBzaGlmdDsKICBmb3IgKGxldCBpID0gMDsgaSA8IGhlaWdodDsgaSsrKSB7CiAgICBpZiAocHJlZGljdGlvbikgewogICAgICBjb25zdCBzbHRwID0gZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBwc2V1ZG9QaXhlbENvbnRleHQpOwogICAgICBsdHAgXj0gc2x0cDsKICAgICAgaWYgKGx0cCkgewogICAgICAgIGJpdG1hcC5wdXNoKHJvdyk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgIH0KICAgIHJvdyA9IG5ldyBVaW50OEFycmF5KHJvdyk7CiAgICBiaXRtYXAucHVzaChyb3cpOwogICAgZm9yIChqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgaWYgKHVzZXNraXAgJiYgc2tpcFtpXVtqXSkgewogICAgICAgIHJvd1tqXSA9IDA7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGogPj0gc2JiX2xlZnQgJiYgaiA8IHNiYl9yaWdodCAmJiBpID49IHNiYl90b3ApIHsKICAgICAgICBjb250ZXh0TGFiZWwgPSBjb250ZXh0TGFiZWwgPDwgMSAmIHJldXNlTWFzazsKICAgICAgICBmb3IgKGsgPSAwOyBrIDwgY2hhbmdpbmdFbnRyaWVzTGVuZ3RoOyBrKyspIHsKICAgICAgICAgIGkwID0gaSArIGNoYW5naW5nVGVtcGxhdGVZW2tdOwogICAgICAgICAgajAgPSBqICsgY2hhbmdpbmdUZW1wbGF0ZVhba107CiAgICAgICAgICBiaXQgPSBiaXRtYXBbaTBdW2owXTsKICAgICAgICAgIGlmIChiaXQpIHsKICAgICAgICAgICAgYml0ID0gY2hhbmdpbmdUZW1wbGF0ZUJpdFtrXTsKICAgICAgICAgICAgY29udGV4dExhYmVsIHw9IGJpdDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29udGV4dExhYmVsID0gMDsKICAgICAgICBzaGlmdCA9IHRlbXBsYXRlTGVuZ3RoIC0gMTsKICAgICAgICBmb3IgKGsgPSAwOyBrIDwgdGVtcGxhdGVMZW5ndGg7IGsrKywgc2hpZnQtLSkgewogICAgICAgICAgajAgPSBqICsgdGVtcGxhdGVYW2tdOwogICAgICAgICAgaWYgKGowID49IDAgJiYgajAgPCB3aWR0aCkgewogICAgICAgICAgICBpMCA9IGkgKyB0ZW1wbGF0ZVlba107CiAgICAgICAgICAgIGlmIChpMCA+PSAwKSB7CiAgICAgICAgICAgICAgYml0ID0gYml0bWFwW2kwXVtqMF07CiAgICAgICAgICAgICAgaWYgKGJpdCkgewogICAgICAgICAgICAgICAgY29udGV4dExhYmVsIHw9IGJpdCA8PCBzaGlmdDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgcGl4ZWwgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIGNvbnRleHRMYWJlbCk7CiAgICAgIHJvd1tqXSA9IHBpeGVsOwogICAgfQogIH0KICByZXR1cm4gYml0bWFwOwp9CmZ1bmN0aW9uIGRlY29kZVJlZmluZW1lbnQod2lkdGgsIGhlaWdodCwgdGVtcGxhdGVJbmRleCwgcmVmZXJlbmNlQml0bWFwLCBvZmZzZXRYLCBvZmZzZXRZLCBwcmVkaWN0aW9uLCBhdCwgZGVjb2RpbmdDb250ZXh0KSB7CiAgbGV0IGNvZGluZ1RlbXBsYXRlID0gUmVmaW5lbWVudFRlbXBsYXRlc1t0ZW1wbGF0ZUluZGV4XS5jb2Rpbmc7CiAgaWYgKHRlbXBsYXRlSW5kZXggPT09IDApIHsKICAgIGNvZGluZ1RlbXBsYXRlID0gY29kaW5nVGVtcGxhdGUuY29uY2F0KFthdFswXV0pOwogIH0KICBjb25zdCBjb2RpbmdUZW1wbGF0ZUxlbmd0aCA9IGNvZGluZ1RlbXBsYXRlLmxlbmd0aDsKICBjb25zdCBjb2RpbmdUZW1wbGF0ZVggPSBuZXcgSW50MzJBcnJheShjb2RpbmdUZW1wbGF0ZUxlbmd0aCk7CiAgY29uc3QgY29kaW5nVGVtcGxhdGVZID0gbmV3IEludDMyQXJyYXkoY29kaW5nVGVtcGxhdGVMZW5ndGgpOwogIGxldCBrOwogIGZvciAoayA9IDA7IGsgPCBjb2RpbmdUZW1wbGF0ZUxlbmd0aDsgaysrKSB7CiAgICBjb2RpbmdUZW1wbGF0ZVhba10gPSBjb2RpbmdUZW1wbGF0ZVtrXS54OwogICAgY29kaW5nVGVtcGxhdGVZW2tdID0gY29kaW5nVGVtcGxhdGVba10ueTsKICB9CiAgbGV0IHJlZmVyZW5jZVRlbXBsYXRlID0gUmVmaW5lbWVudFRlbXBsYXRlc1t0ZW1wbGF0ZUluZGV4XS5yZWZlcmVuY2U7CiAgaWYgKHRlbXBsYXRlSW5kZXggPT09IDApIHsKICAgIHJlZmVyZW5jZVRlbXBsYXRlID0gcmVmZXJlbmNlVGVtcGxhdGUuY29uY2F0KFthdFsxXV0pOwogIH0KICBjb25zdCByZWZlcmVuY2VUZW1wbGF0ZUxlbmd0aCA9IHJlZmVyZW5jZVRlbXBsYXRlLmxlbmd0aDsKICBjb25zdCByZWZlcmVuY2VUZW1wbGF0ZVggPSBuZXcgSW50MzJBcnJheShyZWZlcmVuY2VUZW1wbGF0ZUxlbmd0aCk7CiAgY29uc3QgcmVmZXJlbmNlVGVtcGxhdGVZID0gbmV3IEludDMyQXJyYXkocmVmZXJlbmNlVGVtcGxhdGVMZW5ndGgpOwogIGZvciAoayA9IDA7IGsgPCByZWZlcmVuY2VUZW1wbGF0ZUxlbmd0aDsgaysrKSB7CiAgICByZWZlcmVuY2VUZW1wbGF0ZVhba10gPSByZWZlcmVuY2VUZW1wbGF0ZVtrXS54OwogICAgcmVmZXJlbmNlVGVtcGxhdGVZW2tdID0gcmVmZXJlbmNlVGVtcGxhdGVba10ueTsKICB9CiAgY29uc3QgcmVmZXJlbmNlV2lkdGggPSByZWZlcmVuY2VCaXRtYXBbMF0ubGVuZ3RoOwogIGNvbnN0IHJlZmVyZW5jZUhlaWdodCA9IHJlZmVyZW5jZUJpdG1hcC5sZW5ndGg7CiAgY29uc3QgcHNldWRvUGl4ZWxDb250ZXh0ID0gUmVmaW5lbWVudFJldXNlZENvbnRleHRzW3RlbXBsYXRlSW5kZXhdOwogIGNvbnN0IGJpdG1hcCA9IFtdOwogIGNvbnN0IGRlY29kZXIgPSBkZWNvZGluZ0NvbnRleHQuZGVjb2RlcjsKICBjb25zdCBjb250ZXh0cyA9IGRlY29kaW5nQ29udGV4dC5jb250ZXh0Q2FjaGUuZ2V0Q29udGV4dHMoIkdSIik7CiAgbGV0IGx0cCA9IDA7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgaWYgKHByZWRpY3Rpb24pIHsKICAgICAgY29uc3Qgc2x0cCA9IGRlY29kZXIucmVhZEJpdChjb250ZXh0cywgcHNldWRvUGl4ZWxDb250ZXh0KTsKICAgICAgbHRwIF49IHNsdHA7CiAgICAgIGlmIChsdHApIHsKICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigicHJlZGljdGlvbiBpcyBub3Qgc3VwcG9ydGVkIik7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHJvdyA9IG5ldyBVaW50OEFycmF5KHdpZHRoKTsKICAgIGJpdG1hcC5wdXNoKHJvdyk7CiAgICBmb3IgKGxldCBqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgbGV0IGkwLCBqMDsKICAgICAgbGV0IGNvbnRleHRMYWJlbCA9IDA7CiAgICAgIGZvciAoayA9IDA7IGsgPCBjb2RpbmdUZW1wbGF0ZUxlbmd0aDsgaysrKSB7CiAgICAgICAgaTAgPSBpICsgY29kaW5nVGVtcGxhdGVZW2tdOwogICAgICAgIGowID0gaiArIGNvZGluZ1RlbXBsYXRlWFtrXTsKICAgICAgICBpZiAoaTAgPCAwIHx8IGowIDwgMCB8fCBqMCA+PSB3aWR0aCkgewogICAgICAgICAgY29udGV4dExhYmVsIDw8PSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb250ZXh0TGFiZWwgPSBjb250ZXh0TGFiZWwgPDwgMSB8IGJpdG1hcFtpMF1bajBdOwogICAgICAgIH0KICAgICAgfQogICAgICBmb3IgKGsgPSAwOyBrIDwgcmVmZXJlbmNlVGVtcGxhdGVMZW5ndGg7IGsrKykgewogICAgICAgIGkwID0gaSArIHJlZmVyZW5jZVRlbXBsYXRlWVtrXSAtIG9mZnNldFk7CiAgICAgICAgajAgPSBqICsgcmVmZXJlbmNlVGVtcGxhdGVYW2tdIC0gb2Zmc2V0WDsKICAgICAgICBpZiAoaTAgPCAwIHx8IGkwID49IHJlZmVyZW5jZUhlaWdodCB8fCBqMCA8IDAgfHwgajAgPj0gcmVmZXJlbmNlV2lkdGgpIHsKICAgICAgICAgIGNvbnRleHRMYWJlbCA8PD0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29udGV4dExhYmVsID0gY29udGV4dExhYmVsIDw8IDEgfCByZWZlcmVuY2VCaXRtYXBbaTBdW2owXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgcGl4ZWwgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIGNvbnRleHRMYWJlbCk7CiAgICAgIHJvd1tqXSA9IHBpeGVsOwogICAgfQogIH0KICByZXR1cm4gYml0bWFwOwp9CmZ1bmN0aW9uIGRlY29kZVN5bWJvbERpY3Rpb25hcnkoaHVmZm1hbiwgcmVmaW5lbWVudCwgc3ltYm9scywgbnVtYmVyT2ZOZXdTeW1ib2xzLCBudW1iZXJPZkV4cG9ydGVkU3ltYm9scywgaHVmZm1hblRhYmxlcywgdGVtcGxhdGVJbmRleCwgYXQsIHJlZmluZW1lbnRUZW1wbGF0ZUluZGV4LCByZWZpbmVtZW50QXQsIGRlY29kaW5nQ29udGV4dCwgaHVmZm1hbklucHV0KSB7CiAgaWYgKGh1ZmZtYW4gJiYgcmVmaW5lbWVudCkgewogICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoInN5bWJvbCByZWZpbmVtZW50IHdpdGggSHVmZm1hbiBpcyBub3Qgc3VwcG9ydGVkIik7CiAgfQogIGNvbnN0IG5ld1N5bWJvbHMgPSBbXTsKICBsZXQgY3VycmVudEhlaWdodCA9IDA7CiAgbGV0IHN5bWJvbENvZGVMZW5ndGggPSBsb2cyKHN5bWJvbHMubGVuZ3RoICsgbnVtYmVyT2ZOZXdTeW1ib2xzKTsKICBjb25zdCBkZWNvZGVyID0gZGVjb2RpbmdDb250ZXh0LmRlY29kZXI7CiAgY29uc3QgY29udGV4dENhY2hlID0gZGVjb2RpbmdDb250ZXh0LmNvbnRleHRDYWNoZTsKICBsZXQgdGFibGVCMSwgc3ltYm9sV2lkdGhzOwogIGlmIChodWZmbWFuKSB7CiAgICB0YWJsZUIxID0gZ2V0U3RhbmRhcmRUYWJsZSgxKTsKICAgIHN5bWJvbFdpZHRocyA9IFtdOwogICAgc3ltYm9sQ29kZUxlbmd0aCA9IE1hdGgubWF4KHN5bWJvbENvZGVMZW5ndGgsIDEpOwogIH0KICB3aGlsZSAobmV3U3ltYm9scy5sZW5ndGggPCBudW1iZXJPZk5ld1N5bWJvbHMpIHsKICAgIGNvbnN0IGRlbHRhSGVpZ2h0ID0gaHVmZm1hbiA/IGh1ZmZtYW5UYWJsZXMudGFibGVEZWx0YUhlaWdodC5kZWNvZGUoaHVmZm1hbklucHV0KSA6IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFESCIsIGRlY29kZXIpOwogICAgY3VycmVudEhlaWdodCArPSBkZWx0YUhlaWdodDsKICAgIGxldCBjdXJyZW50V2lkdGggPSAwLAogICAgICB0b3RhbFdpZHRoID0gMDsKICAgIGNvbnN0IGZpcnN0U3ltYm9sID0gaHVmZm1hbiA/IHN5bWJvbFdpZHRocy5sZW5ndGggOiAwOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgY29uc3QgZGVsdGFXaWR0aCA9IGh1ZmZtYW4gPyBodWZmbWFuVGFibGVzLnRhYmxlRGVsdGFXaWR0aC5kZWNvZGUoaHVmZm1hbklucHV0KSA6IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFEVyIsIGRlY29kZXIpOwogICAgICBpZiAoZGVsdGFXaWR0aCA9PT0gbnVsbCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGN1cnJlbnRXaWR0aCArPSBkZWx0YVdpZHRoOwogICAgICB0b3RhbFdpZHRoICs9IGN1cnJlbnRXaWR0aDsKICAgICAgbGV0IGJpdG1hcDsKICAgICAgaWYgKHJlZmluZW1lbnQpIHsKICAgICAgICBjb25zdCBudW1iZXJPZkluc3RhbmNlcyA9IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFBSSIsIGRlY29kZXIpOwogICAgICAgIGlmIChudW1iZXJPZkluc3RhbmNlcyA+IDEpIHsKICAgICAgICAgIGJpdG1hcCA9IGRlY29kZVRleHRSZWdpb24oaHVmZm1hbiwgcmVmaW5lbWVudCwgY3VycmVudFdpZHRoLCBjdXJyZW50SGVpZ2h0LCAwLCBudW1iZXJPZkluc3RhbmNlcywgMSwgc3ltYm9scy5jb25jYXQobmV3U3ltYm9scyksIHN5bWJvbENvZGVMZW5ndGgsIDAsIDAsIDEsIDAsIGh1ZmZtYW5UYWJsZXMsIHJlZmluZW1lbnRUZW1wbGF0ZUluZGV4LCByZWZpbmVtZW50QXQsIGRlY29kaW5nQ29udGV4dCwgMCwgaHVmZm1hbklucHV0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3Qgc3ltYm9sSWQgPSBkZWNvZGVJQUlEKGNvbnRleHRDYWNoZSwgZGVjb2Rlciwgc3ltYm9sQ29kZUxlbmd0aCk7CiAgICAgICAgICBjb25zdCByZHggPSBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBUkRYIiwgZGVjb2Rlcik7CiAgICAgICAgICBjb25zdCByZHkgPSBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBUkRZIiwgZGVjb2Rlcik7CiAgICAgICAgICBjb25zdCBzeW1ib2wgPSBzeW1ib2xJZCA8IHN5bWJvbHMubGVuZ3RoID8gc3ltYm9sc1tzeW1ib2xJZF0gOiBuZXdTeW1ib2xzW3N5bWJvbElkIC0gc3ltYm9scy5sZW5ndGhdOwogICAgICAgICAgYml0bWFwID0gZGVjb2RlUmVmaW5lbWVudChjdXJyZW50V2lkdGgsIGN1cnJlbnRIZWlnaHQsIHJlZmluZW1lbnRUZW1wbGF0ZUluZGV4LCBzeW1ib2wsIHJkeCwgcmR5LCBmYWxzZSwgcmVmaW5lbWVudEF0LCBkZWNvZGluZ0NvbnRleHQpOwogICAgICAgIH0KICAgICAgICBuZXdTeW1ib2xzLnB1c2goYml0bWFwKTsKICAgICAgfSBlbHNlIGlmIChodWZmbWFuKSB7CiAgICAgICAgc3ltYm9sV2lkdGhzLnB1c2goY3VycmVudFdpZHRoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBiaXRtYXAgPSBkZWNvZGVCaXRtYXAoZmFsc2UsIGN1cnJlbnRXaWR0aCwgY3VycmVudEhlaWdodCwgdGVtcGxhdGVJbmRleCwgZmFsc2UsIG51bGwsIGF0LCBkZWNvZGluZ0NvbnRleHQpOwogICAgICAgIG5ld1N5bWJvbHMucHVzaChiaXRtYXApOwogICAgICB9CiAgICB9CiAgICBpZiAoaHVmZm1hbiAmJiAhcmVmaW5lbWVudCkgewogICAgICBjb25zdCBiaXRtYXBTaXplID0gaHVmZm1hblRhYmxlcy50YWJsZUJpdG1hcFNpemUuZGVjb2RlKGh1ZmZtYW5JbnB1dCk7CiAgICAgIGh1ZmZtYW5JbnB1dC5ieXRlQWxpZ24oKTsKICAgICAgbGV0IGNvbGxlY3RpdmVCaXRtYXA7CiAgICAgIGlmIChiaXRtYXBTaXplID09PSAwKSB7CiAgICAgICAgY29sbGVjdGl2ZUJpdG1hcCA9IHJlYWRVbmNvbXByZXNzZWRCaXRtYXAoaHVmZm1hbklucHV0LCB0b3RhbFdpZHRoLCBjdXJyZW50SGVpZ2h0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBvcmlnaW5hbEVuZCA9IGh1ZmZtYW5JbnB1dC5lbmQ7CiAgICAgICAgY29uc3QgYml0bWFwRW5kID0gaHVmZm1hbklucHV0LnBvc2l0aW9uICsgYml0bWFwU2l6ZTsKICAgICAgICBodWZmbWFuSW5wdXQuZW5kID0gYml0bWFwRW5kOwogICAgICAgIGNvbGxlY3RpdmVCaXRtYXAgPSBkZWNvZGVNTVJCaXRtYXAoaHVmZm1hbklucHV0LCB0b3RhbFdpZHRoLCBjdXJyZW50SGVpZ2h0LCBmYWxzZSk7CiAgICAgICAgaHVmZm1hbklucHV0LmVuZCA9IG9yaWdpbmFsRW5kOwogICAgICAgIGh1ZmZtYW5JbnB1dC5wb3NpdGlvbiA9IGJpdG1hcEVuZDsKICAgICAgfQogICAgICBjb25zdCBudW1iZXJPZlN5bWJvbHNEZWNvZGVkID0gc3ltYm9sV2lkdGhzLmxlbmd0aDsKICAgICAgaWYgKGZpcnN0U3ltYm9sID09PSBudW1iZXJPZlN5bWJvbHNEZWNvZGVkIC0gMSkgewogICAgICAgIG5ld1N5bWJvbHMucHVzaChjb2xsZWN0aXZlQml0bWFwKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsZXQgaSwKICAgICAgICAgIHksCiAgICAgICAgICB4TWluID0gMCwKICAgICAgICAgIHhNYXgsCiAgICAgICAgICBiaXRtYXBXaWR0aCwKICAgICAgICAgIHN5bWJvbEJpdG1hcDsKICAgICAgICBmb3IgKGkgPSBmaXJzdFN5bWJvbDsgaSA8IG51bWJlck9mU3ltYm9sc0RlY29kZWQ7IGkrKykgewogICAgICAgICAgYml0bWFwV2lkdGggPSBzeW1ib2xXaWR0aHNbaV07CiAgICAgICAgICB4TWF4ID0geE1pbiArIGJpdG1hcFdpZHRoOwogICAgICAgICAgc3ltYm9sQml0bWFwID0gW107CiAgICAgICAgICBmb3IgKHkgPSAwOyB5IDwgY3VycmVudEhlaWdodDsgeSsrKSB7CiAgICAgICAgICAgIHN5bWJvbEJpdG1hcC5wdXNoKGNvbGxlY3RpdmVCaXRtYXBbeV0uc3ViYXJyYXkoeE1pbiwgeE1heCkpOwogICAgICAgICAgfQogICAgICAgICAgbmV3U3ltYm9scy5wdXNoKHN5bWJvbEJpdG1hcCk7CiAgICAgICAgICB4TWluID0geE1heDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgY29uc3QgZXhwb3J0ZWRTeW1ib2xzID0gW10sCiAgICBmbGFncyA9IFtdOwogIGxldCBjdXJyZW50RmxhZyA9IGZhbHNlLAogICAgaSwKICAgIGlpOwogIGNvbnN0IHRvdGFsU3ltYm9sc0xlbmd0aCA9IHN5bWJvbHMubGVuZ3RoICsgbnVtYmVyT2ZOZXdTeW1ib2xzOwogIHdoaWxlIChmbGFncy5sZW5ndGggPCB0b3RhbFN5bWJvbHNMZW5ndGgpIHsKICAgIGxldCBydW5MZW5ndGggPSBodWZmbWFuID8gdGFibGVCMS5kZWNvZGUoaHVmZm1hbklucHV0KSA6IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFFWCIsIGRlY29kZXIpOwogICAgd2hpbGUgKHJ1bkxlbmd0aC0tKSB7CiAgICAgIGZsYWdzLnB1c2goY3VycmVudEZsYWcpOwogICAgfQogICAgY3VycmVudEZsYWcgPSAhY3VycmVudEZsYWc7CiAgfQogIGZvciAoaSA9IDAsIGlpID0gc3ltYm9scy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBpZiAoZmxhZ3NbaV0pIHsKICAgICAgZXhwb3J0ZWRTeW1ib2xzLnB1c2goc3ltYm9sc1tpXSk7CiAgICB9CiAgfQogIGZvciAobGV0IGogPSAwOyBqIDwgbnVtYmVyT2ZOZXdTeW1ib2xzOyBpKyssIGorKykgewogICAgaWYgKGZsYWdzW2ldKSB7CiAgICAgIGV4cG9ydGVkU3ltYm9scy5wdXNoKG5ld1N5bWJvbHNbal0pOwogICAgfQogIH0KICByZXR1cm4gZXhwb3J0ZWRTeW1ib2xzOwp9CmZ1bmN0aW9uIGRlY29kZVRleHRSZWdpb24oaHVmZm1hbiwgcmVmaW5lbWVudCwgd2lkdGgsIGhlaWdodCwgZGVmYXVsdFBpeGVsVmFsdWUsIG51bWJlck9mU3ltYm9sSW5zdGFuY2VzLCBzdHJpcFNpemUsIGlucHV0U3ltYm9scywgc3ltYm9sQ29kZUxlbmd0aCwgdHJhbnNwb3NlZCwgZHNPZmZzZXQsIHJlZmVyZW5jZUNvcm5lciwgY29tYmluYXRpb25PcGVyYXRvciwgaHVmZm1hblRhYmxlcywgcmVmaW5lbWVudFRlbXBsYXRlSW5kZXgsIHJlZmluZW1lbnRBdCwgZGVjb2RpbmdDb250ZXh0LCBsb2dTdHJpcFNpemUsIGh1ZmZtYW5JbnB1dCkgewogIGlmIChodWZmbWFuICYmIHJlZmluZW1lbnQpIHsKICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJyZWZpbmVtZW50IHdpdGggSHVmZm1hbiBpcyBub3Qgc3VwcG9ydGVkIik7CiAgfQogIGNvbnN0IGJpdG1hcCA9IFtdOwogIGxldCBpLCByb3c7CiAgZm9yIChpID0gMDsgaSA8IGhlaWdodDsgaSsrKSB7CiAgICByb3cgPSBuZXcgVWludDhBcnJheSh3aWR0aCk7CiAgICBpZiAoZGVmYXVsdFBpeGVsVmFsdWUpIHsKICAgICAgcm93LmZpbGwoZGVmYXVsdFBpeGVsVmFsdWUpOwogICAgfQogICAgYml0bWFwLnB1c2gocm93KTsKICB9CiAgY29uc3QgZGVjb2RlciA9IGRlY29kaW5nQ29udGV4dC5kZWNvZGVyOwogIGNvbnN0IGNvbnRleHRDYWNoZSA9IGRlY29kaW5nQ29udGV4dC5jb250ZXh0Q2FjaGU7CiAgbGV0IHN0cmlwVCA9IGh1ZmZtYW4gPyAtaHVmZm1hblRhYmxlcy50YWJsZURlbHRhVC5kZWNvZGUoaHVmZm1hbklucHV0KSA6IC1kZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBRFQiLCBkZWNvZGVyKTsKICBsZXQgZmlyc3RTID0gMDsKICBpID0gMDsKICB3aGlsZSAoaSA8IG51bWJlck9mU3ltYm9sSW5zdGFuY2VzKSB7CiAgICBjb25zdCBkZWx0YVQgPSBodWZmbWFuID8gaHVmZm1hblRhYmxlcy50YWJsZURlbHRhVC5kZWNvZGUoaHVmZm1hbklucHV0KSA6IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFEVCIsIGRlY29kZXIpOwogICAgc3RyaXBUICs9IGRlbHRhVDsKICAgIGNvbnN0IGRlbHRhRmlyc3RTID0gaHVmZm1hbiA/IGh1ZmZtYW5UYWJsZXMudGFibGVGaXJzdFMuZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBRlMiLCBkZWNvZGVyKTsKICAgIGZpcnN0UyArPSBkZWx0YUZpcnN0UzsKICAgIGxldCBjdXJyZW50UyA9IGZpcnN0UzsKICAgIGRvIHsKICAgICAgbGV0IGN1cnJlbnRUID0gMDsKICAgICAgaWYgKHN0cmlwU2l6ZSA+IDEpIHsKICAgICAgICBjdXJyZW50VCA9IGh1ZmZtYW4gPyBodWZmbWFuSW5wdXQucmVhZEJpdHMobG9nU3RyaXBTaXplKSA6IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFJVCIsIGRlY29kZXIpOwogICAgICB9CiAgICAgIGNvbnN0IHQgPSBzdHJpcFNpemUgKiBzdHJpcFQgKyBjdXJyZW50VDsKICAgICAgY29uc3Qgc3ltYm9sSWQgPSBodWZmbWFuID8gaHVmZm1hblRhYmxlcy5zeW1ib2xJRFRhYmxlLmRlY29kZShodWZmbWFuSW5wdXQpIDogZGVjb2RlSUFJRChjb250ZXh0Q2FjaGUsIGRlY29kZXIsIHN5bWJvbENvZGVMZW5ndGgpOwogICAgICBjb25zdCBhcHBseVJlZmluZW1lbnQgPSByZWZpbmVtZW50ICYmIChodWZmbWFuID8gaHVmZm1hbklucHV0LnJlYWRCaXQoKSA6IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFSSSIsIGRlY29kZXIpKTsKICAgICAgbGV0IHN5bWJvbEJpdG1hcCA9IGlucHV0U3ltYm9sc1tzeW1ib2xJZF07CiAgICAgIGxldCBzeW1ib2xXaWR0aCA9IHN5bWJvbEJpdG1hcFswXS5sZW5ndGg7CiAgICAgIGxldCBzeW1ib2xIZWlnaHQgPSBzeW1ib2xCaXRtYXAubGVuZ3RoOwogICAgICBpZiAoYXBwbHlSZWZpbmVtZW50KSB7CiAgICAgICAgY29uc3QgcmR3ID0gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQVJEVyIsIGRlY29kZXIpOwogICAgICAgIGNvbnN0IHJkaCA9IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFSREgiLCBkZWNvZGVyKTsKICAgICAgICBjb25zdCByZHggPSBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBUkRYIiwgZGVjb2Rlcik7CiAgICAgICAgY29uc3QgcmR5ID0gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQVJEWSIsIGRlY29kZXIpOwogICAgICAgIHN5bWJvbFdpZHRoICs9IHJkdzsKICAgICAgICBzeW1ib2xIZWlnaHQgKz0gcmRoOwogICAgICAgIHN5bWJvbEJpdG1hcCA9IGRlY29kZVJlZmluZW1lbnQoc3ltYm9sV2lkdGgsIHN5bWJvbEhlaWdodCwgcmVmaW5lbWVudFRlbXBsYXRlSW5kZXgsIHN5bWJvbEJpdG1hcCwgKHJkdyA+PiAxKSArIHJkeCwgKHJkaCA+PiAxKSArIHJkeSwgZmFsc2UsIHJlZmluZW1lbnRBdCwgZGVjb2RpbmdDb250ZXh0KTsKICAgICAgfQogICAgICBsZXQgaW5jcmVtZW50ID0gMDsKICAgICAgaWYgKCF0cmFuc3Bvc2VkKSB7CiAgICAgICAgaWYgKHJlZmVyZW5jZUNvcm5lciA+IDEpIHsKICAgICAgICAgIGN1cnJlbnRTICs9IHN5bWJvbFdpZHRoIC0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaW5jcmVtZW50ID0gc3ltYm9sV2lkdGggLSAxOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghKHJlZmVyZW5jZUNvcm5lciAmIDEpKSB7CiAgICAgICAgY3VycmVudFMgKz0gc3ltYm9sSGVpZ2h0IC0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpbmNyZW1lbnQgPSBzeW1ib2xIZWlnaHQgLSAxOwogICAgICB9CiAgICAgIGNvbnN0IG9mZnNldFQgPSB0IC0gKHJlZmVyZW5jZUNvcm5lciAmIDEgPyAwIDogc3ltYm9sSGVpZ2h0IC0gMSk7CiAgICAgIGNvbnN0IG9mZnNldFMgPSBjdXJyZW50UyAtIChyZWZlcmVuY2VDb3JuZXIgJiAyID8gc3ltYm9sV2lkdGggLSAxIDogMCk7CiAgICAgIGxldCBzMiwgdDIsIHN5bWJvbFJvdzsKICAgICAgaWYgKHRyYW5zcG9zZWQpIHsKICAgICAgICBmb3IgKHMyID0gMDsgczIgPCBzeW1ib2xIZWlnaHQ7IHMyKyspIHsKICAgICAgICAgIHJvdyA9IGJpdG1hcFtvZmZzZXRTICsgczJdOwogICAgICAgICAgaWYgKCFyb3cpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBzeW1ib2xSb3cgPSBzeW1ib2xCaXRtYXBbczJdOwogICAgICAgICAgY29uc3QgbWF4V2lkdGggPSBNYXRoLm1pbih3aWR0aCAtIG9mZnNldFQsIHN5bWJvbFdpZHRoKTsKICAgICAgICAgIHN3aXRjaCAoY29tYmluYXRpb25PcGVyYXRvcikgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgZm9yICh0MiA9IDA7IHQyIDwgbWF4V2lkdGg7IHQyKyspIHsKICAgICAgICAgICAgICAgIHJvd1tvZmZzZXRUICsgdDJdIHw9IHN5bWJvbFJvd1t0Ml07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgZm9yICh0MiA9IDA7IHQyIDwgbWF4V2lkdGg7IHQyKyspIHsKICAgICAgICAgICAgICAgIHJvd1tvZmZzZXRUICsgdDJdIF49IHN5bWJvbFJvd1t0Ml07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKGBvcGVyYXRvciAke2NvbWJpbmF0aW9uT3BlcmF0b3J9IGlzIG5vdCBzdXBwb3J0ZWRgKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yICh0MiA9IDA7IHQyIDwgc3ltYm9sSGVpZ2h0OyB0MisrKSB7CiAgICAgICAgICByb3cgPSBiaXRtYXBbb2Zmc2V0VCArIHQyXTsKICAgICAgICAgIGlmICghcm93KSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgc3ltYm9sUm93ID0gc3ltYm9sQml0bWFwW3QyXTsKICAgICAgICAgIHN3aXRjaCAoY29tYmluYXRpb25PcGVyYXRvcikgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgZm9yIChzMiA9IDA7IHMyIDwgc3ltYm9sV2lkdGg7IHMyKyspIHsKICAgICAgICAgICAgICAgIHJvd1tvZmZzZXRTICsgczJdIHw9IHN5bWJvbFJvd1tzMl07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgZm9yIChzMiA9IDA7IHMyIDwgc3ltYm9sV2lkdGg7IHMyKyspIHsKICAgICAgICAgICAgICAgIHJvd1tvZmZzZXRTICsgczJdIF49IHN5bWJvbFJvd1tzMl07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKGBvcGVyYXRvciAke2NvbWJpbmF0aW9uT3BlcmF0b3J9IGlzIG5vdCBzdXBwb3J0ZWRgKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaSsrOwogICAgICBjb25zdCBkZWx0YVMgPSBodWZmbWFuID8gaHVmZm1hblRhYmxlcy50YWJsZURlbHRhUy5kZWNvZGUoaHVmZm1hbklucHV0KSA6IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFEUyIsIGRlY29kZXIpOwogICAgICBpZiAoZGVsdGFTID09PSBudWxsKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY3VycmVudFMgKz0gaW5jcmVtZW50ICsgZGVsdGFTICsgZHNPZmZzZXQ7CiAgICB9IHdoaWxlICh0cnVlKTsKICB9CiAgcmV0dXJuIGJpdG1hcDsKfQpmdW5jdGlvbiBkZWNvZGVQYXR0ZXJuRGljdGlvbmFyeShtbXIsIHBhdHRlcm5XaWR0aCwgcGF0dGVybkhlaWdodCwgbWF4UGF0dGVybkluZGV4LCB0ZW1wbGF0ZSwgZGVjb2RpbmdDb250ZXh0KSB7CiAgY29uc3QgYXQgPSBbXTsKICBpZiAoIW1tcikgewogICAgYXQucHVzaCh7CiAgICAgIHg6IC1wYXR0ZXJuV2lkdGgsCiAgICAgIHk6IDAKICAgIH0pOwogICAgaWYgKHRlbXBsYXRlID09PSAwKSB7CiAgICAgIGF0LnB1c2goewogICAgICAgIHg6IC0zLAogICAgICAgIHk6IC0xCiAgICAgIH0sIHsKICAgICAgICB4OiAyLAogICAgICAgIHk6IC0yCiAgICAgIH0sIHsKICAgICAgICB4OiAtMiwKICAgICAgICB5OiAtMgogICAgICB9KTsKICAgIH0KICB9CiAgY29uc3QgY29sbGVjdGl2ZVdpZHRoID0gKG1heFBhdHRlcm5JbmRleCArIDEpICogcGF0dGVybldpZHRoOwogIGNvbnN0IGNvbGxlY3RpdmVCaXRtYXAgPSBkZWNvZGVCaXRtYXAobW1yLCBjb2xsZWN0aXZlV2lkdGgsIHBhdHRlcm5IZWlnaHQsIHRlbXBsYXRlLCBmYWxzZSwgbnVsbCwgYXQsIGRlY29kaW5nQ29udGV4dCk7CiAgY29uc3QgcGF0dGVybnMgPSBbXTsKICBmb3IgKGxldCBpID0gMDsgaSA8PSBtYXhQYXR0ZXJuSW5kZXg7IGkrKykgewogICAgY29uc3QgcGF0dGVybkJpdG1hcCA9IFtdOwogICAgY29uc3QgeE1pbiA9IHBhdHRlcm5XaWR0aCAqIGk7CiAgICBjb25zdCB4TWF4ID0geE1pbiArIHBhdHRlcm5XaWR0aDsKICAgIGZvciAobGV0IHkgPSAwOyB5IDwgcGF0dGVybkhlaWdodDsgeSsrKSB7CiAgICAgIHBhdHRlcm5CaXRtYXAucHVzaChjb2xsZWN0aXZlQml0bWFwW3ldLnN1YmFycmF5KHhNaW4sIHhNYXgpKTsKICAgIH0KICAgIHBhdHRlcm5zLnB1c2gocGF0dGVybkJpdG1hcCk7CiAgfQogIHJldHVybiBwYXR0ZXJuczsKfQpmdW5jdGlvbiBkZWNvZGVIYWxmdG9uZVJlZ2lvbihtbXIsIHBhdHRlcm5zLCB0ZW1wbGF0ZSwgcmVnaW9uV2lkdGgsIHJlZ2lvbkhlaWdodCwgZGVmYXVsdFBpeGVsVmFsdWUsIGVuYWJsZVNraXAsIGNvbWJpbmF0aW9uT3BlcmF0b3IsIGdyaWRXaWR0aCwgZ3JpZEhlaWdodCwgZ3JpZE9mZnNldFgsIGdyaWRPZmZzZXRZLCBncmlkVmVjdG9yWCwgZ3JpZFZlY3RvclksIGRlY29kaW5nQ29udGV4dCkgewogIGNvbnN0IHNraXAgPSBudWxsOwogIGlmIChlbmFibGVTa2lwKSB7CiAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigic2tpcCBpcyBub3Qgc3VwcG9ydGVkIik7CiAgfQogIGlmIChjb21iaW5hdGlvbk9wZXJhdG9yICE9PSAwKSB7CiAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcihgb3BlcmF0b3IgIiR7Y29tYmluYXRpb25PcGVyYXRvcn0iIGlzIG5vdCBzdXBwb3J0ZWQgaW4gaGFsZnRvbmUgcmVnaW9uYCk7CiAgfQogIGNvbnN0IHJlZ2lvbkJpdG1hcCA9IFtdOwogIGxldCBpLCBqLCByb3c7CiAgZm9yIChpID0gMDsgaSA8IHJlZ2lvbkhlaWdodDsgaSsrKSB7CiAgICByb3cgPSBuZXcgVWludDhBcnJheShyZWdpb25XaWR0aCk7CiAgICBpZiAoZGVmYXVsdFBpeGVsVmFsdWUpIHsKICAgICAgcm93LmZpbGwoZGVmYXVsdFBpeGVsVmFsdWUpOwogICAgfQogICAgcmVnaW9uQml0bWFwLnB1c2gocm93KTsKICB9CiAgY29uc3QgbnVtYmVyT2ZQYXR0ZXJucyA9IHBhdHRlcm5zLmxlbmd0aDsKICBjb25zdCBwYXR0ZXJuMCA9IHBhdHRlcm5zWzBdOwogIGNvbnN0IHBhdHRlcm5XaWR0aCA9IHBhdHRlcm4wWzBdLmxlbmd0aCwKICAgIHBhdHRlcm5IZWlnaHQgPSBwYXR0ZXJuMC5sZW5ndGg7CiAgY29uc3QgYml0c1BlclZhbHVlID0gbG9nMihudW1iZXJPZlBhdHRlcm5zKTsKICBjb25zdCBhdCA9IFtdOwogIGlmICghbW1yKSB7CiAgICBhdC5wdXNoKHsKICAgICAgeDogdGVtcGxhdGUgPD0gMSA/IDMgOiAyLAogICAgICB5OiAtMQogICAgfSk7CiAgICBpZiAodGVtcGxhdGUgPT09IDApIHsKICAgICAgYXQucHVzaCh7CiAgICAgICAgeDogLTMsCiAgICAgICAgeTogLTEKICAgICAgfSwgewogICAgICAgIHg6IDIsCiAgICAgICAgeTogLTIKICAgICAgfSwgewogICAgICAgIHg6IC0yLAogICAgICAgIHk6IC0yCiAgICAgIH0pOwogICAgfQogIH0KICBjb25zdCBncmF5U2NhbGVCaXRQbGFuZXMgPSBbXTsKICBsZXQgbW1ySW5wdXQsIGJpdG1hcDsKICBpZiAobW1yKSB7CiAgICBtbXJJbnB1dCA9IG5ldyBSZWFkZXIoZGVjb2RpbmdDb250ZXh0LmRhdGEsIGRlY29kaW5nQ29udGV4dC5zdGFydCwgZGVjb2RpbmdDb250ZXh0LmVuZCk7CiAgfQogIGZvciAoaSA9IGJpdHNQZXJWYWx1ZSAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICBpZiAobW1yKSB7CiAgICAgIGJpdG1hcCA9IGRlY29kZU1NUkJpdG1hcChtbXJJbnB1dCwgZ3JpZFdpZHRoLCBncmlkSGVpZ2h0LCB0cnVlKTsKICAgIH0gZWxzZSB7CiAgICAgIGJpdG1hcCA9IGRlY29kZUJpdG1hcChmYWxzZSwgZ3JpZFdpZHRoLCBncmlkSGVpZ2h0LCB0ZW1wbGF0ZSwgZmFsc2UsIHNraXAsIGF0LCBkZWNvZGluZ0NvbnRleHQpOwogICAgfQogICAgZ3JheVNjYWxlQml0UGxhbmVzW2ldID0gYml0bWFwOwogIH0KICBsZXQgbWcsIG5nLCBiaXQsIHBhdHRlcm5JbmRleCwgcGF0dGVybkJpdG1hcCwgeCwgeSwgcGF0dGVyblJvdywgcmVnaW9uUm93OwogIGZvciAobWcgPSAwOyBtZyA8IGdyaWRIZWlnaHQ7IG1nKyspIHsKICAgIGZvciAobmcgPSAwOyBuZyA8IGdyaWRXaWR0aDsgbmcrKykgewogICAgICBiaXQgPSAwOwogICAgICBwYXR0ZXJuSW5kZXggPSAwOwogICAgICBmb3IgKGogPSBiaXRzUGVyVmFsdWUgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgIGJpdCBePSBncmF5U2NhbGVCaXRQbGFuZXNbal1bbWddW25nXTsKICAgICAgICBwYXR0ZXJuSW5kZXggfD0gYml0IDw8IGo7CiAgICAgIH0KICAgICAgcGF0dGVybkJpdG1hcCA9IHBhdHRlcm5zW3BhdHRlcm5JbmRleF07CiAgICAgIHggPSBncmlkT2Zmc2V0WCArIG1nICogZ3JpZFZlY3RvclkgKyBuZyAqIGdyaWRWZWN0b3JYID4+IDg7CiAgICAgIHkgPSBncmlkT2Zmc2V0WSArIG1nICogZ3JpZFZlY3RvclggLSBuZyAqIGdyaWRWZWN0b3JZID4+IDg7CiAgICAgIGlmICh4ID49IDAgJiYgeCArIHBhdHRlcm5XaWR0aCA8PSByZWdpb25XaWR0aCAmJiB5ID49IDAgJiYgeSArIHBhdHRlcm5IZWlnaHQgPD0gcmVnaW9uSGVpZ2h0KSB7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBhdHRlcm5IZWlnaHQ7IGkrKykgewogICAgICAgICAgcmVnaW9uUm93ID0gcmVnaW9uQml0bWFwW3kgKyBpXTsKICAgICAgICAgIHBhdHRlcm5Sb3cgPSBwYXR0ZXJuQml0bWFwW2ldOwogICAgICAgICAgZm9yIChqID0gMDsgaiA8IHBhdHRlcm5XaWR0aDsgaisrKSB7CiAgICAgICAgICAgIHJlZ2lvblJvd1t4ICsgal0gfD0gcGF0dGVyblJvd1tqXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGV0IHJlZ2lvblgsIHJlZ2lvblk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBhdHRlcm5IZWlnaHQ7IGkrKykgewogICAgICAgICAgcmVnaW9uWSA9IHkgKyBpOwogICAgICAgICAgaWYgKHJlZ2lvblkgPCAwIHx8IHJlZ2lvblkgPj0gcmVnaW9uSGVpZ2h0KSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgcmVnaW9uUm93ID0gcmVnaW9uQml0bWFwW3JlZ2lvblldOwogICAgICAgICAgcGF0dGVyblJvdyA9IHBhdHRlcm5CaXRtYXBbaV07CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgcGF0dGVybldpZHRoOyBqKyspIHsKICAgICAgICAgICAgcmVnaW9uWCA9IHggKyBqOwogICAgICAgICAgICBpZiAocmVnaW9uWCA+PSAwICYmIHJlZ2lvblggPCByZWdpb25XaWR0aCkgewogICAgICAgICAgICAgIHJlZ2lvblJvd1tyZWdpb25YXSB8PSBwYXR0ZXJuUm93W2pdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIHJldHVybiByZWdpb25CaXRtYXA7Cn0KZnVuY3Rpb24gcmVhZFNlZ21lbnRIZWFkZXIoZGF0YSwgc3RhcnQpIHsKICBjb25zdCBzZWdtZW50SGVhZGVyID0ge307CiAgc2VnbWVudEhlYWRlci5udW1iZXIgPSByZWFkVWludDMyKGRhdGEsIHN0YXJ0KTsKICBjb25zdCBmbGFncyA9IGRhdGFbc3RhcnQgKyA0XTsKICBjb25zdCBzZWdtZW50VHlwZSA9IGZsYWdzICYgMHgzZjsKICBpZiAoIVNlZ21lbnRUeXBlc1tzZWdtZW50VHlwZV0pIHsKICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIHNlZ21lbnQgdHlwZTogIiArIHNlZ21lbnRUeXBlKTsKICB9CiAgc2VnbWVudEhlYWRlci50eXBlID0gc2VnbWVudFR5cGU7CiAgc2VnbWVudEhlYWRlci50eXBlTmFtZSA9IFNlZ21lbnRUeXBlc1tzZWdtZW50VHlwZV07CiAgc2VnbWVudEhlYWRlci5kZWZlcnJlZE5vblJldGFpbiA9ICEhKGZsYWdzICYgMHg4MCk7CiAgY29uc3QgcGFnZUFzc29jaWF0aW9uRmllbGRTaXplID0gISEoZmxhZ3MgJiAweDQwKTsKICBjb25zdCByZWZlcnJlZEZsYWdzID0gZGF0YVtzdGFydCArIDVdOwogIGxldCByZWZlcnJlZFRvQ291bnQgPSByZWZlcnJlZEZsYWdzID4+IDUgJiA3OwogIGNvbnN0IHJldGFpbkJpdHMgPSBbcmVmZXJyZWRGbGFncyAmIDMxXTsKICBsZXQgcG9zaXRpb24gPSBzdGFydCArIDY7CiAgaWYgKHJlZmVycmVkRmxhZ3MgPT09IDcpIHsKICAgIHJlZmVycmVkVG9Db3VudCA9IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24gLSAxKSAmIDB4MWZmZmZmZmY7CiAgICBwb3NpdGlvbiArPSAzOwogICAgbGV0IGJ5dGVzID0gcmVmZXJyZWRUb0NvdW50ICsgNyA+PiAzOwogICAgcmV0YWluQml0c1swXSA9IGRhdGFbcG9zaXRpb24rK107CiAgICB3aGlsZSAoLS1ieXRlcyA+IDApIHsKICAgICAgcmV0YWluQml0cy5wdXNoKGRhdGFbcG9zaXRpb24rK10pOwogICAgfQogIH0gZWxzZSBpZiAocmVmZXJyZWRGbGFncyA9PT0gNSB8fCByZWZlcnJlZEZsYWdzID09PSA2KSB7CiAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigiaW52YWxpZCByZWZlcnJlZC10byBmbGFncyIpOwogIH0KICBzZWdtZW50SGVhZGVyLnJldGFpbkJpdHMgPSByZXRhaW5CaXRzOwogIGxldCByZWZlcnJlZFRvU2VnbWVudE51bWJlclNpemUgPSA0OwogIGlmIChzZWdtZW50SGVhZGVyLm51bWJlciA8PSAyNTYpIHsKICAgIHJlZmVycmVkVG9TZWdtZW50TnVtYmVyU2l6ZSA9IDE7CiAgfSBlbHNlIGlmIChzZWdtZW50SGVhZGVyLm51bWJlciA8PSA2NTUzNikgewogICAgcmVmZXJyZWRUb1NlZ21lbnROdW1iZXJTaXplID0gMjsKICB9CiAgY29uc3QgcmVmZXJyZWRUbyA9IFtdOwogIGxldCBpLCBpaTsKICBmb3IgKGkgPSAwOyBpIDwgcmVmZXJyZWRUb0NvdW50OyBpKyspIHsKICAgIGxldCBudW1iZXI7CiAgICBpZiAocmVmZXJyZWRUb1NlZ21lbnROdW1iZXJTaXplID09PSAxKSB7CiAgICAgIG51bWJlciA9IGRhdGFbcG9zaXRpb25dOwogICAgfSBlbHNlIGlmIChyZWZlcnJlZFRvU2VnbWVudE51bWJlclNpemUgPT09IDIpIHsKICAgICAgbnVtYmVyID0gcmVhZFVpbnQxNihkYXRhLCBwb3NpdGlvbik7CiAgICB9IGVsc2UgewogICAgICBudW1iZXIgPSByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uKTsKICAgIH0KICAgIHJlZmVycmVkVG8ucHVzaChudW1iZXIpOwogICAgcG9zaXRpb24gKz0gcmVmZXJyZWRUb1NlZ21lbnROdW1iZXJTaXplOwogIH0KICBzZWdtZW50SGVhZGVyLnJlZmVycmVkVG8gPSByZWZlcnJlZFRvOwogIGlmICghcGFnZUFzc29jaWF0aW9uRmllbGRTaXplKSB7CiAgICBzZWdtZW50SGVhZGVyLnBhZ2VBc3NvY2lhdGlvbiA9IGRhdGFbcG9zaXRpb24rK107CiAgfSBlbHNlIHsKICAgIHNlZ21lbnRIZWFkZXIucGFnZUFzc29jaWF0aW9uID0gcmVhZFVpbnQzMihkYXRhLCBwb3NpdGlvbik7CiAgICBwb3NpdGlvbiArPSA0OwogIH0KICBzZWdtZW50SGVhZGVyLmxlbmd0aCA9IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24pOwogIHBvc2l0aW9uICs9IDQ7CiAgaWYgKHNlZ21lbnRIZWFkZXIubGVuZ3RoID09PSAweGZmZmZmZmZmKSB7CiAgICBpZiAoc2VnbWVudFR5cGUgPT09IDM4KSB7CiAgICAgIGNvbnN0IGdlbmVyaWNSZWdpb25JbmZvID0gcmVhZFJlZ2lvblNlZ21lbnRJbmZvcm1hdGlvbihkYXRhLCBwb3NpdGlvbik7CiAgICAgIGNvbnN0IGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgPSBkYXRhW3Bvc2l0aW9uICsgUmVnaW9uU2VnbWVudEluZm9ybWF0aW9uRmllbGRMZW5ndGhdOwogICAgICBjb25zdCBnZW5lcmljUmVnaW9uTW1yID0gISEoZ2VuZXJpY1JlZ2lvblNlZ21lbnRGbGFncyAmIDEpOwogICAgICBjb25zdCBzZWFyY2hQYXR0ZXJuTGVuZ3RoID0gNjsKICAgICAgY29uc3Qgc2VhcmNoUGF0dGVybiA9IG5ldyBVaW50OEFycmF5KHNlYXJjaFBhdHRlcm5MZW5ndGgpOwogICAgICBpZiAoIWdlbmVyaWNSZWdpb25NbXIpIHsKICAgICAgICBzZWFyY2hQYXR0ZXJuWzBdID0gMHhmZjsKICAgICAgICBzZWFyY2hQYXR0ZXJuWzFdID0gMHhhYzsKICAgICAgfQogICAgICBzZWFyY2hQYXR0ZXJuWzJdID0gZ2VuZXJpY1JlZ2lvbkluZm8uaGVpZ2h0ID4+PiAyNCAmIDB4ZmY7CiAgICAgIHNlYXJjaFBhdHRlcm5bM10gPSBnZW5lcmljUmVnaW9uSW5mby5oZWlnaHQgPj4gMTYgJiAweGZmOwogICAgICBzZWFyY2hQYXR0ZXJuWzRdID0gZ2VuZXJpY1JlZ2lvbkluZm8uaGVpZ2h0ID4+IDggJiAweGZmOwogICAgICBzZWFyY2hQYXR0ZXJuWzVdID0gZ2VuZXJpY1JlZ2lvbkluZm8uaGVpZ2h0ICYgMHhmZjsKICAgICAgZm9yIChpID0gcG9zaXRpb24sIGlpID0gZGF0YS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgbGV0IGogPSAwOwogICAgICAgIHdoaWxlIChqIDwgc2VhcmNoUGF0dGVybkxlbmd0aCAmJiBzZWFyY2hQYXR0ZXJuW2pdID09PSBkYXRhW2kgKyBqXSkgewogICAgICAgICAgaisrOwogICAgICAgIH0KICAgICAgICBpZiAoaiA9PT0gc2VhcmNoUGF0dGVybkxlbmd0aCkgewogICAgICAgICAgc2VnbWVudEhlYWRlci5sZW5ndGggPSBpICsgc2VhcmNoUGF0dGVybkxlbmd0aDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc2VnbWVudEhlYWRlci5sZW5ndGggPT09IDB4ZmZmZmZmZmYpIHsKICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigic2VnbWVudCBlbmQgd2FzIG5vdCBmb3VuZCIpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigiaW52YWxpZCB1bmtub3duIHNlZ21lbnQgbGVuZ3RoIik7CiAgICB9CiAgfQogIHNlZ21lbnRIZWFkZXIuaGVhZGVyRW5kID0gcG9zaXRpb247CiAgcmV0dXJuIHNlZ21lbnRIZWFkZXI7Cn0KZnVuY3Rpb24gcmVhZFNlZ21lbnRzKGhlYWRlciwgZGF0YSwgc3RhcnQsIGVuZCkgewogIGNvbnN0IHNlZ21lbnRzID0gW107CiAgbGV0IHBvc2l0aW9uID0gc3RhcnQ7CiAgd2hpbGUgKHBvc2l0aW9uIDwgZW5kKSB7CiAgICBjb25zdCBzZWdtZW50SGVhZGVyID0gcmVhZFNlZ21lbnRIZWFkZXIoZGF0YSwgcG9zaXRpb24pOwogICAgcG9zaXRpb24gPSBzZWdtZW50SGVhZGVyLmhlYWRlckVuZDsKICAgIGNvbnN0IHNlZ21lbnQgPSB7CiAgICAgIGhlYWRlcjogc2VnbWVudEhlYWRlciwKICAgICAgZGF0YQogICAgfTsKICAgIGlmICghaGVhZGVyLnJhbmRvbUFjY2VzcykgewogICAgICBzZWdtZW50LnN0YXJ0ID0gcG9zaXRpb247CiAgICAgIHBvc2l0aW9uICs9IHNlZ21lbnRIZWFkZXIubGVuZ3RoOwogICAgICBzZWdtZW50LmVuZCA9IHBvc2l0aW9uOwogICAgfQogICAgc2VnbWVudHMucHVzaChzZWdtZW50KTsKICAgIGlmIChzZWdtZW50SGVhZGVyLnR5cGUgPT09IDUxKSB7CiAgICAgIGJyZWFrOwogICAgfQogIH0KICBpZiAoaGVhZGVyLnJhbmRvbUFjY2VzcykgewogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gc2VnbWVudHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBzZWdtZW50c1tpXS5zdGFydCA9IHBvc2l0aW9uOwogICAgICBwb3NpdGlvbiArPSBzZWdtZW50c1tpXS5oZWFkZXIubGVuZ3RoOwogICAgICBzZWdtZW50c1tpXS5lbmQgPSBwb3NpdGlvbjsKICAgIH0KICB9CiAgcmV0dXJuIHNlZ21lbnRzOwp9CmZ1bmN0aW9uIHJlYWRSZWdpb25TZWdtZW50SW5mb3JtYXRpb24oZGF0YSwgc3RhcnQpIHsKICByZXR1cm4gewogICAgd2lkdGg6IHJlYWRVaW50MzIoZGF0YSwgc3RhcnQpLAogICAgaGVpZ2h0OiByZWFkVWludDMyKGRhdGEsIHN0YXJ0ICsgNCksCiAgICB4OiByZWFkVWludDMyKGRhdGEsIHN0YXJ0ICsgOCksCiAgICB5OiByZWFkVWludDMyKGRhdGEsIHN0YXJ0ICsgMTIpLAogICAgY29tYmluYXRpb25PcGVyYXRvcjogZGF0YVtzdGFydCArIDE2XSAmIDcKICB9Owp9CmNvbnN0IFJlZ2lvblNlZ21lbnRJbmZvcm1hdGlvbkZpZWxkTGVuZ3RoID0gMTc7CmZ1bmN0aW9uIHByb2Nlc3NTZWdtZW50KHNlZ21lbnQsIHZpc2l0b3IpIHsKICBjb25zdCBoZWFkZXIgPSBzZWdtZW50LmhlYWRlcjsKICBjb25zdCBkYXRhID0gc2VnbWVudC5kYXRhLAogICAgZW5kID0gc2VnbWVudC5lbmQ7CiAgbGV0IHBvc2l0aW9uID0gc2VnbWVudC5zdGFydDsKICBsZXQgYXJncywgYXQsIGksIGF0TGVuZ3RoOwogIHN3aXRjaCAoaGVhZGVyLnR5cGUpIHsKICAgIGNhc2UgMDoKICAgICAgY29uc3QgZGljdGlvbmFyeSA9IHt9OwogICAgICBjb25zdCBkaWN0aW9uYXJ5RmxhZ3MgPSByZWFkVWludDE2KGRhdGEsIHBvc2l0aW9uKTsKICAgICAgZGljdGlvbmFyeS5odWZmbWFuID0gISEoZGljdGlvbmFyeUZsYWdzICYgMSk7CiAgICAgIGRpY3Rpb25hcnkucmVmaW5lbWVudCA9ICEhKGRpY3Rpb25hcnlGbGFncyAmIDIpOwogICAgICBkaWN0aW9uYXJ5Lmh1ZmZtYW5ESFNlbGVjdG9yID0gZGljdGlvbmFyeUZsYWdzID4+IDIgJiAzOwogICAgICBkaWN0aW9uYXJ5Lmh1ZmZtYW5EV1NlbGVjdG9yID0gZGljdGlvbmFyeUZsYWdzID4+IDQgJiAzOwogICAgICBkaWN0aW9uYXJ5LmJpdG1hcFNpemVTZWxlY3RvciA9IGRpY3Rpb25hcnlGbGFncyA+PiA2ICYgMTsKICAgICAgZGljdGlvbmFyeS5hZ2dyZWdhdGlvbkluc3RhbmNlc1NlbGVjdG9yID0gZGljdGlvbmFyeUZsYWdzID4+IDcgJiAxOwogICAgICBkaWN0aW9uYXJ5LmJpdG1hcENvZGluZ0NvbnRleHRVc2VkID0gISEoZGljdGlvbmFyeUZsYWdzICYgMjU2KTsKICAgICAgZGljdGlvbmFyeS5iaXRtYXBDb2RpbmdDb250ZXh0UmV0YWluZWQgPSAhIShkaWN0aW9uYXJ5RmxhZ3MgJiA1MTIpOwogICAgICBkaWN0aW9uYXJ5LnRlbXBsYXRlID0gZGljdGlvbmFyeUZsYWdzID4+IDEwICYgMzsKICAgICAgZGljdGlvbmFyeS5yZWZpbmVtZW50VGVtcGxhdGUgPSBkaWN0aW9uYXJ5RmxhZ3MgPj4gMTIgJiAxOwogICAgICBwb3NpdGlvbiArPSAyOwogICAgICBpZiAoIWRpY3Rpb25hcnkuaHVmZm1hbikgewogICAgICAgIGF0TGVuZ3RoID0gZGljdGlvbmFyeS50ZW1wbGF0ZSA9PT0gMCA/IDQgOiAxOwogICAgICAgIGF0ID0gW107CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGF0TGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGF0LnB1c2goewogICAgICAgICAgICB4OiByZWFkSW50OChkYXRhLCBwb3NpdGlvbiksCiAgICAgICAgICAgIHk6IHJlYWRJbnQ4KGRhdGEsIHBvc2l0aW9uICsgMSkKICAgICAgICAgIH0pOwogICAgICAgICAgcG9zaXRpb24gKz0gMjsKICAgICAgICB9CiAgICAgICAgZGljdGlvbmFyeS5hdCA9IGF0OwogICAgICB9CiAgICAgIGlmIChkaWN0aW9uYXJ5LnJlZmluZW1lbnQgJiYgIWRpY3Rpb25hcnkucmVmaW5lbWVudFRlbXBsYXRlKSB7CiAgICAgICAgYXQgPSBbXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMjsgaSsrKSB7CiAgICAgICAgICBhdC5wdXNoKHsKICAgICAgICAgICAgeDogcmVhZEludDgoZGF0YSwgcG9zaXRpb24pLAogICAgICAgICAgICB5OiByZWFkSW50OChkYXRhLCBwb3NpdGlvbiArIDEpCiAgICAgICAgICB9KTsKICAgICAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgICAgfQogICAgICAgIGRpY3Rpb25hcnkucmVmaW5lbWVudEF0ID0gYXQ7CiAgICAgIH0KICAgICAgZGljdGlvbmFyeS5udW1iZXJPZkV4cG9ydGVkU3ltYm9scyA9IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSA0OwogICAgICBkaWN0aW9uYXJ5Lm51bWJlck9mTmV3U3ltYm9scyA9IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSA0OwogICAgICBhcmdzID0gW2RpY3Rpb25hcnksIGhlYWRlci5udW1iZXIsIGhlYWRlci5yZWZlcnJlZFRvLCBkYXRhLCBwb3NpdGlvbiwgZW5kXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDY6CiAgICBjYXNlIDc6CiAgICAgIGNvbnN0IHRleHRSZWdpb24gPSB7fTsKICAgICAgdGV4dFJlZ2lvbi5pbmZvID0gcmVhZFJlZ2lvblNlZ21lbnRJbmZvcm1hdGlvbihkYXRhLCBwb3NpdGlvbik7CiAgICAgIHBvc2l0aW9uICs9IFJlZ2lvblNlZ21lbnRJbmZvcm1hdGlvbkZpZWxkTGVuZ3RoOwogICAgICBjb25zdCB0ZXh0UmVnaW9uU2VnbWVudEZsYWdzID0gcmVhZFVpbnQxNihkYXRhLCBwb3NpdGlvbik7CiAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgIHRleHRSZWdpb24uaHVmZm1hbiA9ICEhKHRleHRSZWdpb25TZWdtZW50RmxhZ3MgJiAxKTsKICAgICAgdGV4dFJlZ2lvbi5yZWZpbmVtZW50ID0gISEodGV4dFJlZ2lvblNlZ21lbnRGbGFncyAmIDIpOwogICAgICB0ZXh0UmVnaW9uLmxvZ1N0cmlwU2l6ZSA9IHRleHRSZWdpb25TZWdtZW50RmxhZ3MgPj4gMiAmIDM7CiAgICAgIHRleHRSZWdpb24uc3RyaXBTaXplID0gMSA8PCB0ZXh0UmVnaW9uLmxvZ1N0cmlwU2l6ZTsKICAgICAgdGV4dFJlZ2lvbi5yZWZlcmVuY2VDb3JuZXIgPSB0ZXh0UmVnaW9uU2VnbWVudEZsYWdzID4+IDQgJiAzOwogICAgICB0ZXh0UmVnaW9uLnRyYW5zcG9zZWQgPSAhISh0ZXh0UmVnaW9uU2VnbWVudEZsYWdzICYgNjQpOwogICAgICB0ZXh0UmVnaW9uLmNvbWJpbmF0aW9uT3BlcmF0b3IgPSB0ZXh0UmVnaW9uU2VnbWVudEZsYWdzID4+IDcgJiAzOwogICAgICB0ZXh0UmVnaW9uLmRlZmF1bHRQaXhlbFZhbHVlID0gdGV4dFJlZ2lvblNlZ21lbnRGbGFncyA+PiA5ICYgMTsKICAgICAgdGV4dFJlZ2lvbi5kc09mZnNldCA9IHRleHRSZWdpb25TZWdtZW50RmxhZ3MgPDwgMTcgPj4gMjc7CiAgICAgIHRleHRSZWdpb24ucmVmaW5lbWVudFRlbXBsYXRlID0gdGV4dFJlZ2lvblNlZ21lbnRGbGFncyA+PiAxNSAmIDE7CiAgICAgIGlmICh0ZXh0UmVnaW9uLmh1ZmZtYW4pIHsKICAgICAgICBjb25zdCB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzID0gcmVhZFVpbnQxNihkYXRhLCBwb3NpdGlvbik7CiAgICAgICAgcG9zaXRpb24gKz0gMjsKICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5GUyA9IHRleHRSZWdpb25IdWZmbWFuRmxhZ3MgJiAzOwogICAgICAgIHRleHRSZWdpb24uaHVmZm1hbkRTID0gdGV4dFJlZ2lvbkh1ZmZtYW5GbGFncyA+PiAyICYgMzsKICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5EVCA9IHRleHRSZWdpb25IdWZmbWFuRmxhZ3MgPj4gNCAmIDM7CiAgICAgICAgdGV4dFJlZ2lvbi5odWZmbWFuUmVmaW5lbWVudERXID0gdGV4dFJlZ2lvbkh1ZmZtYW5GbGFncyA+PiA2ICYgMzsKICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5SZWZpbmVtZW50REggPSB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzID4+IDggJiAzOwogICAgICAgIHRleHRSZWdpb24uaHVmZm1hblJlZmluZW1lbnREWCA9IHRleHRSZWdpb25IdWZmbWFuRmxhZ3MgPj4gMTAgJiAzOwogICAgICAgIHRleHRSZWdpb24uaHVmZm1hblJlZmluZW1lbnREWSA9IHRleHRSZWdpb25IdWZmbWFuRmxhZ3MgPj4gMTIgJiAzOwogICAgICAgIHRleHRSZWdpb24uaHVmZm1hblJlZmluZW1lbnRTaXplU2VsZWN0b3IgPSAhISh0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzICYgMHg0MDAwKTsKICAgICAgfQogICAgICBpZiAodGV4dFJlZ2lvbi5yZWZpbmVtZW50ICYmICF0ZXh0UmVnaW9uLnJlZmluZW1lbnRUZW1wbGF0ZSkgewogICAgICAgIGF0ID0gW107CiAgICAgICAgZm9yIChpID0gMDsgaSA8IDI7IGkrKykgewogICAgICAgICAgYXQucHVzaCh7CiAgICAgICAgICAgIHg6IHJlYWRJbnQ4KGRhdGEsIHBvc2l0aW9uKSwKICAgICAgICAgICAgeTogcmVhZEludDgoZGF0YSwgcG9zaXRpb24gKyAxKQogICAgICAgICAgfSk7CiAgICAgICAgICBwb3NpdGlvbiArPSAyOwogICAgICAgIH0KICAgICAgICB0ZXh0UmVnaW9uLnJlZmluZW1lbnRBdCA9IGF0OwogICAgICB9CiAgICAgIHRleHRSZWdpb24ubnVtYmVyT2ZTeW1ib2xJbnN0YW5jZXMgPSByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgYXJncyA9IFt0ZXh0UmVnaW9uLCBoZWFkZXIucmVmZXJyZWRUbywgZGF0YSwgcG9zaXRpb24sIGVuZF07CiAgICAgIGJyZWFrOwogICAgY2FzZSAxNjoKICAgICAgY29uc3QgcGF0dGVybkRpY3Rpb25hcnkgPSB7fTsKICAgICAgY29uc3QgcGF0dGVybkRpY3Rpb25hcnlGbGFncyA9IGRhdGFbcG9zaXRpb24rK107CiAgICAgIHBhdHRlcm5EaWN0aW9uYXJ5Lm1tciA9ICEhKHBhdHRlcm5EaWN0aW9uYXJ5RmxhZ3MgJiAxKTsKICAgICAgcGF0dGVybkRpY3Rpb25hcnkudGVtcGxhdGUgPSBwYXR0ZXJuRGljdGlvbmFyeUZsYWdzID4+IDEgJiAzOwogICAgICBwYXR0ZXJuRGljdGlvbmFyeS5wYXR0ZXJuV2lkdGggPSBkYXRhW3Bvc2l0aW9uKytdOwogICAgICBwYXR0ZXJuRGljdGlvbmFyeS5wYXR0ZXJuSGVpZ2h0ID0gZGF0YVtwb3NpdGlvbisrXTsKICAgICAgcGF0dGVybkRpY3Rpb25hcnkubWF4UGF0dGVybkluZGV4ID0gcmVhZFVpbnQzMihkYXRhLCBwb3NpdGlvbik7CiAgICAgIHBvc2l0aW9uICs9IDQ7CiAgICAgIGFyZ3MgPSBbcGF0dGVybkRpY3Rpb25hcnksIGhlYWRlci5udW1iZXIsIGRhdGEsIHBvc2l0aW9uLCBlbmRdOwogICAgICBicmVhazsKICAgIGNhc2UgMjI6CiAgICBjYXNlIDIzOgogICAgICBjb25zdCBoYWxmdG9uZVJlZ2lvbiA9IHt9OwogICAgICBoYWxmdG9uZVJlZ2lvbi5pbmZvID0gcmVhZFJlZ2lvblNlZ21lbnRJbmZvcm1hdGlvbihkYXRhLCBwb3NpdGlvbik7CiAgICAgIHBvc2l0aW9uICs9IFJlZ2lvblNlZ21lbnRJbmZvcm1hdGlvbkZpZWxkTGVuZ3RoOwogICAgICBjb25zdCBoYWxmdG9uZVJlZ2lvbkZsYWdzID0gZGF0YVtwb3NpdGlvbisrXTsKICAgICAgaGFsZnRvbmVSZWdpb24ubW1yID0gISEoaGFsZnRvbmVSZWdpb25GbGFncyAmIDEpOwogICAgICBoYWxmdG9uZVJlZ2lvbi50ZW1wbGF0ZSA9IGhhbGZ0b25lUmVnaW9uRmxhZ3MgPj4gMSAmIDM7CiAgICAgIGhhbGZ0b25lUmVnaW9uLmVuYWJsZVNraXAgPSAhIShoYWxmdG9uZVJlZ2lvbkZsYWdzICYgOCk7CiAgICAgIGhhbGZ0b25lUmVnaW9uLmNvbWJpbmF0aW9uT3BlcmF0b3IgPSBoYWxmdG9uZVJlZ2lvbkZsYWdzID4+IDQgJiA3OwogICAgICBoYWxmdG9uZVJlZ2lvbi5kZWZhdWx0UGl4ZWxWYWx1ZSA9IGhhbGZ0b25lUmVnaW9uRmxhZ3MgPj4gNyAmIDE7CiAgICAgIGhhbGZ0b25lUmVnaW9uLmdyaWRXaWR0aCA9IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSA0OwogICAgICBoYWxmdG9uZVJlZ2lvbi5ncmlkSGVpZ2h0ID0gcmVhZFVpbnQzMihkYXRhLCBwb3NpdGlvbik7CiAgICAgIHBvc2l0aW9uICs9IDQ7CiAgICAgIGhhbGZ0b25lUmVnaW9uLmdyaWRPZmZzZXRYID0gcmVhZFVpbnQzMihkYXRhLCBwb3NpdGlvbikgJiAweGZmZmZmZmZmOwogICAgICBwb3NpdGlvbiArPSA0OwogICAgICBoYWxmdG9uZVJlZ2lvbi5ncmlkT2Zmc2V0WSA9IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24pICYgMHhmZmZmZmZmZjsKICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgaGFsZnRvbmVSZWdpb24uZ3JpZFZlY3RvclggPSByZWFkVWludDE2KGRhdGEsIHBvc2l0aW9uKTsKICAgICAgcG9zaXRpb24gKz0gMjsKICAgICAgaGFsZnRvbmVSZWdpb24uZ3JpZFZlY3RvclkgPSByZWFkVWludDE2KGRhdGEsIHBvc2l0aW9uKTsKICAgICAgcG9zaXRpb24gKz0gMjsKICAgICAgYXJncyA9IFtoYWxmdG9uZVJlZ2lvbiwgaGVhZGVyLnJlZmVycmVkVG8sIGRhdGEsIHBvc2l0aW9uLCBlbmRdOwogICAgICBicmVhazsKICAgIGNhc2UgMzg6CiAgICBjYXNlIDM5OgogICAgICBjb25zdCBnZW5lcmljUmVnaW9uID0ge307CiAgICAgIGdlbmVyaWNSZWdpb24uaW5mbyA9IHJlYWRSZWdpb25TZWdtZW50SW5mb3JtYXRpb24oZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSBSZWdpb25TZWdtZW50SW5mb3JtYXRpb25GaWVsZExlbmd0aDsKICAgICAgY29uc3QgZ2VuZXJpY1JlZ2lvblNlZ21lbnRGbGFncyA9IGRhdGFbcG9zaXRpb24rK107CiAgICAgIGdlbmVyaWNSZWdpb24ubW1yID0gISEoZ2VuZXJpY1JlZ2lvblNlZ21lbnRGbGFncyAmIDEpOwogICAgICBnZW5lcmljUmVnaW9uLnRlbXBsYXRlID0gZ2VuZXJpY1JlZ2lvblNlZ21lbnRGbGFncyA+PiAxICYgMzsKICAgICAgZ2VuZXJpY1JlZ2lvbi5wcmVkaWN0aW9uID0gISEoZ2VuZXJpY1JlZ2lvblNlZ21lbnRGbGFncyAmIDgpOwogICAgICBpZiAoIWdlbmVyaWNSZWdpb24ubW1yKSB7CiAgICAgICAgYXRMZW5ndGggPSBnZW5lcmljUmVnaW9uLnRlbXBsYXRlID09PSAwID8gNCA6IDE7CiAgICAgICAgYXQgPSBbXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXRMZW5ndGg7IGkrKykgewogICAgICAgICAgYXQucHVzaCh7CiAgICAgICAgICAgIHg6IHJlYWRJbnQ4KGRhdGEsIHBvc2l0aW9uKSwKICAgICAgICAgICAgeTogcmVhZEludDgoZGF0YSwgcG9zaXRpb24gKyAxKQogICAgICAgICAgfSk7CiAgICAgICAgICBwb3NpdGlvbiArPSAyOwogICAgICAgIH0KICAgICAgICBnZW5lcmljUmVnaW9uLmF0ID0gYXQ7CiAgICAgIH0KICAgICAgYXJncyA9IFtnZW5lcmljUmVnaW9uLCBkYXRhLCBwb3NpdGlvbiwgZW5kXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDQ4OgogICAgICBjb25zdCBwYWdlSW5mbyA9IHsKICAgICAgICB3aWR0aDogcmVhZFVpbnQzMihkYXRhLCBwb3NpdGlvbiksCiAgICAgICAgaGVpZ2h0OiByZWFkVWludDMyKGRhdGEsIHBvc2l0aW9uICsgNCksCiAgICAgICAgcmVzb2x1dGlvblg6IHJlYWRVaW50MzIoZGF0YSwgcG9zaXRpb24gKyA4KSwKICAgICAgICByZXNvbHV0aW9uWTogcmVhZFVpbnQzMihkYXRhLCBwb3NpdGlvbiArIDEyKQogICAgICB9OwogICAgICBpZiAocGFnZUluZm8uaGVpZ2h0ID09PSAweGZmZmZmZmZmKSB7CiAgICAgICAgZGVsZXRlIHBhZ2VJbmZvLmhlaWdodDsKICAgICAgfQogICAgICBjb25zdCBwYWdlU2VnbWVudEZsYWdzID0gZGF0YVtwb3NpdGlvbiArIDE2XTsKICAgICAgcmVhZFVpbnQxNihkYXRhLCBwb3NpdGlvbiArIDE3KTsKICAgICAgcGFnZUluZm8ubG9zc2xlc3MgPSAhIShwYWdlU2VnbWVudEZsYWdzICYgMSk7CiAgICAgIHBhZ2VJbmZvLnJlZmluZW1lbnQgPSAhIShwYWdlU2VnbWVudEZsYWdzICYgMik7CiAgICAgIHBhZ2VJbmZvLmRlZmF1bHRQaXhlbFZhbHVlID0gcGFnZVNlZ21lbnRGbGFncyA+PiAyICYgMTsKICAgICAgcGFnZUluZm8uY29tYmluYXRpb25PcGVyYXRvciA9IHBhZ2VTZWdtZW50RmxhZ3MgPj4gMyAmIDM7CiAgICAgIHBhZ2VJbmZvLnJlcXVpcmVzQnVmZmVyID0gISEocGFnZVNlZ21lbnRGbGFncyAmIDMyKTsKICAgICAgcGFnZUluZm8uY29tYmluYXRpb25PcGVyYXRvck92ZXJyaWRlID0gISEocGFnZVNlZ21lbnRGbGFncyAmIDY0KTsKICAgICAgYXJncyA9IFtwYWdlSW5mb107CiAgICAgIGJyZWFrOwogICAgY2FzZSA0OToKICAgICAgYnJlYWs7CiAgICBjYXNlIDUwOgogICAgICBicmVhazsKICAgIGNhc2UgNTE6CiAgICAgIGJyZWFrOwogICAgY2FzZSA1MzoKICAgICAgYXJncyA9IFtoZWFkZXIubnVtYmVyLCBkYXRhLCBwb3NpdGlvbiwgZW5kXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDYyOgogICAgICBicmVhazsKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKGBzZWdtZW50IHR5cGUgJHtoZWFkZXIudHlwZU5hbWV9KCR7aGVhZGVyLnR5cGV9KSBpcyBub3QgaW1wbGVtZW50ZWRgKTsKICB9CiAgY29uc3QgY2FsbGJhY2tOYW1lID0gIm9uIiArIGhlYWRlci50eXBlTmFtZTsKICBpZiAoY2FsbGJhY2tOYW1lIGluIHZpc2l0b3IpIHsKICAgIHZpc2l0b3JbY2FsbGJhY2tOYW1lXS5hcHBseSh2aXNpdG9yLCBhcmdzKTsKICB9Cn0KZnVuY3Rpb24gcHJvY2Vzc1NlZ21lbnRzKHNlZ21lbnRzLCB2aXNpdG9yKSB7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gc2VnbWVudHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgcHJvY2Vzc1NlZ21lbnQoc2VnbWVudHNbaV0sIHZpc2l0b3IpOwogIH0KfQpmdW5jdGlvbiBwYXJzZUpiaWcyQ2h1bmtzKGNodW5rcykgewogIGNvbnN0IHZpc2l0b3IgPSBuZXcgU2ltcGxlU2VnbWVudFZpc2l0b3IoKTsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBjaHVua3MubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgY2h1bmsgPSBjaHVua3NbaV07CiAgICBjb25zdCBzZWdtZW50cyA9IHJlYWRTZWdtZW50cyh7fSwgY2h1bmsuZGF0YSwgY2h1bmsuc3RhcnQsIGNodW5rLmVuZCk7CiAgICBwcm9jZXNzU2VnbWVudHMoc2VnbWVudHMsIHZpc2l0b3IpOwogIH0KICByZXR1cm4gdmlzaXRvci5idWZmZXI7Cn0KY2xhc3MgU2ltcGxlU2VnbWVudFZpc2l0b3IgewogIG9uUGFnZUluZm9ybWF0aW9uKGluZm8pIHsKICAgIHRoaXMuY3VycmVudFBhZ2VJbmZvID0gaW5mbzsKICAgIGNvbnN0IHJvd1NpemUgPSBpbmZvLndpZHRoICsgNyA+PiAzOwogICAgY29uc3QgYnVmZmVyID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHJvd1NpemUgKiBpbmZvLmhlaWdodCk7CiAgICBpZiAoaW5mby5kZWZhdWx0UGl4ZWxWYWx1ZSkgewogICAgICBidWZmZXIuZmlsbCgweGZmKTsKICAgIH0KICAgIHRoaXMuYnVmZmVyID0gYnVmZmVyOwogIH0KICBkcmF3Qml0bWFwKHJlZ2lvbkluZm8sIGJpdG1hcCkgewogICAgY29uc3QgcGFnZUluZm8gPSB0aGlzLmN1cnJlbnRQYWdlSW5mbzsKICAgIGNvbnN0IHdpZHRoID0gcmVnaW9uSW5mby53aWR0aCwKICAgICAgaGVpZ2h0ID0gcmVnaW9uSW5mby5oZWlnaHQ7CiAgICBjb25zdCByb3dTaXplID0gcGFnZUluZm8ud2lkdGggKyA3ID4+IDM7CiAgICBjb25zdCBjb21iaW5hdGlvbk9wZXJhdG9yID0gcGFnZUluZm8uY29tYmluYXRpb25PcGVyYXRvck92ZXJyaWRlID8gcmVnaW9uSW5mby5jb21iaW5hdGlvbk9wZXJhdG9yIDogcGFnZUluZm8uY29tYmluYXRpb25PcGVyYXRvcjsKICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuYnVmZmVyOwogICAgY29uc3QgbWFzazAgPSAxMjggPj4gKHJlZ2lvbkluZm8ueCAmIDcpOwogICAgbGV0IG9mZnNldDAgPSByZWdpb25JbmZvLnkgKiByb3dTaXplICsgKHJlZ2lvbkluZm8ueCA+PiAzKTsKICAgIGxldCBpLCBqLCBtYXNrLCBvZmZzZXQ7CiAgICBzd2l0Y2ggKGNvbWJpbmF0aW9uT3BlcmF0b3IpIHsKICAgICAgY2FzZSAwOgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgICAgICAgbWFzayA9IG1hc2swOwogICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0MDsKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CiAgICAgICAgICAgIGlmIChiaXRtYXBbaV1bal0pIHsKICAgICAgICAgICAgICBidWZmZXJbb2Zmc2V0XSB8PSBtYXNrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1hc2sgPj49IDE7CiAgICAgICAgICAgIGlmICghbWFzaykgewogICAgICAgICAgICAgIG1hc2sgPSAxMjg7CiAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIG9mZnNldDAgKz0gcm93U2l6ZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMjoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgICAgICAgIG1hc2sgPSBtYXNrMDsKICAgICAgICAgIG9mZnNldCA9IG9mZnNldDA7CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgd2lkdGg7IGorKykgewogICAgICAgICAgICBpZiAoYml0bWFwW2ldW2pdKSB7CiAgICAgICAgICAgICAgYnVmZmVyW29mZnNldF0gXj0gbWFzazsKICAgICAgICAgICAgfQogICAgICAgICAgICBtYXNrID4+PSAxOwogICAgICAgICAgICBpZiAoIW1hc2spIHsKICAgICAgICAgICAgICBtYXNrID0gMTI4OwogICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBvZmZzZXQwICs9IHJvd1NpemU7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKGBvcGVyYXRvciAke2NvbWJpbmF0aW9uT3BlcmF0b3J9IGlzIG5vdCBzdXBwb3J0ZWRgKTsKICAgIH0KICB9CiAgb25JbW1lZGlhdGVHZW5lcmljUmVnaW9uKHJlZ2lvbiwgZGF0YSwgc3RhcnQsIGVuZCkgewogICAgY29uc3QgcmVnaW9uSW5mbyA9IHJlZ2lvbi5pbmZvOwogICAgY29uc3QgZGVjb2RpbmdDb250ZXh0ID0gbmV3IERlY29kaW5nQ29udGV4dChkYXRhLCBzdGFydCwgZW5kKTsKICAgIGNvbnN0IGJpdG1hcCA9IGRlY29kZUJpdG1hcChyZWdpb24ubW1yLCByZWdpb25JbmZvLndpZHRoLCByZWdpb25JbmZvLmhlaWdodCwgcmVnaW9uLnRlbXBsYXRlLCByZWdpb24ucHJlZGljdGlvbiwgbnVsbCwgcmVnaW9uLmF0LCBkZWNvZGluZ0NvbnRleHQpOwogICAgdGhpcy5kcmF3Qml0bWFwKHJlZ2lvbkluZm8sIGJpdG1hcCk7CiAgfQogIG9uSW1tZWRpYXRlTG9zc2xlc3NHZW5lcmljUmVnaW9uKCkgewogICAgdGhpcy5vbkltbWVkaWF0ZUdlbmVyaWNSZWdpb24oLi4uYXJndW1lbnRzKTsKICB9CiAgb25TeW1ib2xEaWN0aW9uYXJ5KGRpY3Rpb25hcnksIGN1cnJlbnRTZWdtZW50LCByZWZlcnJlZFNlZ21lbnRzLCBkYXRhLCBzdGFydCwgZW5kKSB7CiAgICBsZXQgaHVmZm1hblRhYmxlcywgaHVmZm1hbklucHV0OwogICAgaWYgKGRpY3Rpb25hcnkuaHVmZm1hbikgewogICAgICBodWZmbWFuVGFibGVzID0gZ2V0U3ltYm9sRGljdGlvbmFyeUh1ZmZtYW5UYWJsZXMoZGljdGlvbmFyeSwgcmVmZXJyZWRTZWdtZW50cywgdGhpcy5jdXN0b21UYWJsZXMpOwogICAgICBodWZmbWFuSW5wdXQgPSBuZXcgUmVhZGVyKGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgfQogICAgbGV0IHN5bWJvbHMgPSB0aGlzLnN5bWJvbHM7CiAgICBpZiAoIXN5bWJvbHMpIHsKICAgICAgdGhpcy5zeW1ib2xzID0gc3ltYm9scyA9IHt9OwogICAgfQogICAgY29uc3QgaW5wdXRTeW1ib2xzID0gW107CiAgICBmb3IgKGNvbnN0IHJlZmVycmVkU2VnbWVudCBvZiByZWZlcnJlZFNlZ21lbnRzKSB7CiAgICAgIGNvbnN0IHJlZmVycmVkU3ltYm9scyA9IHN5bWJvbHNbcmVmZXJyZWRTZWdtZW50XTsKICAgICAgaWYgKHJlZmVycmVkU3ltYm9scykgewogICAgICAgIGlucHV0U3ltYm9scy5wdXNoKC4uLnJlZmVycmVkU3ltYm9scyk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGRlY29kaW5nQ29udGV4dCA9IG5ldyBEZWNvZGluZ0NvbnRleHQoZGF0YSwgc3RhcnQsIGVuZCk7CiAgICBzeW1ib2xzW2N1cnJlbnRTZWdtZW50XSA9IGRlY29kZVN5bWJvbERpY3Rpb25hcnkoZGljdGlvbmFyeS5odWZmbWFuLCBkaWN0aW9uYXJ5LnJlZmluZW1lbnQsIGlucHV0U3ltYm9scywgZGljdGlvbmFyeS5udW1iZXJPZk5ld1N5bWJvbHMsIGRpY3Rpb25hcnkubnVtYmVyT2ZFeHBvcnRlZFN5bWJvbHMsIGh1ZmZtYW5UYWJsZXMsIGRpY3Rpb25hcnkudGVtcGxhdGUsIGRpY3Rpb25hcnkuYXQsIGRpY3Rpb25hcnkucmVmaW5lbWVudFRlbXBsYXRlLCBkaWN0aW9uYXJ5LnJlZmluZW1lbnRBdCwgZGVjb2RpbmdDb250ZXh0LCBodWZmbWFuSW5wdXQpOwogIH0KICBvbkltbWVkaWF0ZVRleHRSZWdpb24ocmVnaW9uLCByZWZlcnJlZFNlZ21lbnRzLCBkYXRhLCBzdGFydCwgZW5kKSB7CiAgICBjb25zdCByZWdpb25JbmZvID0gcmVnaW9uLmluZm87CiAgICBsZXQgaHVmZm1hblRhYmxlcywgaHVmZm1hbklucHV0OwogICAgY29uc3Qgc3ltYm9scyA9IHRoaXMuc3ltYm9sczsKICAgIGNvbnN0IGlucHV0U3ltYm9scyA9IFtdOwogICAgZm9yIChjb25zdCByZWZlcnJlZFNlZ21lbnQgb2YgcmVmZXJyZWRTZWdtZW50cykgewogICAgICBjb25zdCByZWZlcnJlZFN5bWJvbHMgPSBzeW1ib2xzW3JlZmVycmVkU2VnbWVudF07CiAgICAgIGlmIChyZWZlcnJlZFN5bWJvbHMpIHsKICAgICAgICBpbnB1dFN5bWJvbHMucHVzaCguLi5yZWZlcnJlZFN5bWJvbHMpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBzeW1ib2xDb2RlTGVuZ3RoID0gbG9nMihpbnB1dFN5bWJvbHMubGVuZ3RoKTsKICAgIGlmIChyZWdpb24uaHVmZm1hbikgewogICAgICBodWZmbWFuSW5wdXQgPSBuZXcgUmVhZGVyKGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgICBodWZmbWFuVGFibGVzID0gZ2V0VGV4dFJlZ2lvbkh1ZmZtYW5UYWJsZXMocmVnaW9uLCByZWZlcnJlZFNlZ21lbnRzLCB0aGlzLmN1c3RvbVRhYmxlcywgaW5wdXRTeW1ib2xzLmxlbmd0aCwgaHVmZm1hbklucHV0KTsKICAgIH0KICAgIGNvbnN0IGRlY29kaW5nQ29udGV4dCA9IG5ldyBEZWNvZGluZ0NvbnRleHQoZGF0YSwgc3RhcnQsIGVuZCk7CiAgICBjb25zdCBiaXRtYXAgPSBkZWNvZGVUZXh0UmVnaW9uKHJlZ2lvbi5odWZmbWFuLCByZWdpb24ucmVmaW5lbWVudCwgcmVnaW9uSW5mby53aWR0aCwgcmVnaW9uSW5mby5oZWlnaHQsIHJlZ2lvbi5kZWZhdWx0UGl4ZWxWYWx1ZSwgcmVnaW9uLm51bWJlck9mU3ltYm9sSW5zdGFuY2VzLCByZWdpb24uc3RyaXBTaXplLCBpbnB1dFN5bWJvbHMsIHN5bWJvbENvZGVMZW5ndGgsIHJlZ2lvbi50cmFuc3Bvc2VkLCByZWdpb24uZHNPZmZzZXQsIHJlZ2lvbi5yZWZlcmVuY2VDb3JuZXIsIHJlZ2lvbi5jb21iaW5hdGlvbk9wZXJhdG9yLCBodWZmbWFuVGFibGVzLCByZWdpb24ucmVmaW5lbWVudFRlbXBsYXRlLCByZWdpb24ucmVmaW5lbWVudEF0LCBkZWNvZGluZ0NvbnRleHQsIHJlZ2lvbi5sb2dTdHJpcFNpemUsIGh1ZmZtYW5JbnB1dCk7CiAgICB0aGlzLmRyYXdCaXRtYXAocmVnaW9uSW5mbywgYml0bWFwKTsKICB9CiAgb25JbW1lZGlhdGVMb3NzbGVzc1RleHRSZWdpb24oKSB7CiAgICB0aGlzLm9uSW1tZWRpYXRlVGV4dFJlZ2lvbiguLi5hcmd1bWVudHMpOwogIH0KICBvblBhdHRlcm5EaWN0aW9uYXJ5KGRpY3Rpb25hcnksIGN1cnJlbnRTZWdtZW50LCBkYXRhLCBzdGFydCwgZW5kKSB7CiAgICBsZXQgcGF0dGVybnMgPSB0aGlzLnBhdHRlcm5zOwogICAgaWYgKCFwYXR0ZXJucykgewogICAgICB0aGlzLnBhdHRlcm5zID0gcGF0dGVybnMgPSB7fTsKICAgIH0KICAgIGNvbnN0IGRlY29kaW5nQ29udGV4dCA9IG5ldyBEZWNvZGluZ0NvbnRleHQoZGF0YSwgc3RhcnQsIGVuZCk7CiAgICBwYXR0ZXJuc1tjdXJyZW50U2VnbWVudF0gPSBkZWNvZGVQYXR0ZXJuRGljdGlvbmFyeShkaWN0aW9uYXJ5Lm1tciwgZGljdGlvbmFyeS5wYXR0ZXJuV2lkdGgsIGRpY3Rpb25hcnkucGF0dGVybkhlaWdodCwgZGljdGlvbmFyeS5tYXhQYXR0ZXJuSW5kZXgsIGRpY3Rpb25hcnkudGVtcGxhdGUsIGRlY29kaW5nQ29udGV4dCk7CiAgfQogIG9uSW1tZWRpYXRlSGFsZnRvbmVSZWdpb24ocmVnaW9uLCByZWZlcnJlZFNlZ21lbnRzLCBkYXRhLCBzdGFydCwgZW5kKSB7CiAgICBjb25zdCBwYXR0ZXJucyA9IHRoaXMucGF0dGVybnNbcmVmZXJyZWRTZWdtZW50c1swXV07CiAgICBjb25zdCByZWdpb25JbmZvID0gcmVnaW9uLmluZm87CiAgICBjb25zdCBkZWNvZGluZ0NvbnRleHQgPSBuZXcgRGVjb2RpbmdDb250ZXh0KGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgY29uc3QgYml0bWFwID0gZGVjb2RlSGFsZnRvbmVSZWdpb24ocmVnaW9uLm1tciwgcGF0dGVybnMsIHJlZ2lvbi50ZW1wbGF0ZSwgcmVnaW9uSW5mby53aWR0aCwgcmVnaW9uSW5mby5oZWlnaHQsIHJlZ2lvbi5kZWZhdWx0UGl4ZWxWYWx1ZSwgcmVnaW9uLmVuYWJsZVNraXAsIHJlZ2lvbi5jb21iaW5hdGlvbk9wZXJhdG9yLCByZWdpb24uZ3JpZFdpZHRoLCByZWdpb24uZ3JpZEhlaWdodCwgcmVnaW9uLmdyaWRPZmZzZXRYLCByZWdpb24uZ3JpZE9mZnNldFksIHJlZ2lvbi5ncmlkVmVjdG9yWCwgcmVnaW9uLmdyaWRWZWN0b3JZLCBkZWNvZGluZ0NvbnRleHQpOwogICAgdGhpcy5kcmF3Qml0bWFwKHJlZ2lvbkluZm8sIGJpdG1hcCk7CiAgfQogIG9uSW1tZWRpYXRlTG9zc2xlc3NIYWxmdG9uZVJlZ2lvbigpIHsKICAgIHRoaXMub25JbW1lZGlhdGVIYWxmdG9uZVJlZ2lvbiguLi5hcmd1bWVudHMpOwogIH0KICBvblRhYmxlcyhjdXJyZW50U2VnbWVudCwgZGF0YSwgc3RhcnQsIGVuZCkgewogICAgbGV0IGN1c3RvbVRhYmxlcyA9IHRoaXMuY3VzdG9tVGFibGVzOwogICAgaWYgKCFjdXN0b21UYWJsZXMpIHsKICAgICAgdGhpcy5jdXN0b21UYWJsZXMgPSBjdXN0b21UYWJsZXMgPSB7fTsKICAgIH0KICAgIGN1c3RvbVRhYmxlc1tjdXJyZW50U2VnbWVudF0gPSBkZWNvZGVUYWJsZXNTZWdtZW50KGRhdGEsIHN0YXJ0LCBlbmQpOwogIH0KfQpjbGFzcyBIdWZmbWFuTGluZSB7CiAgY29uc3RydWN0b3IobGluZURhdGEpIHsKICAgIGlmIChsaW5lRGF0YS5sZW5ndGggPT09IDIpIHsKICAgICAgdGhpcy5pc09PQiA9IHRydWU7CiAgICAgIHRoaXMucmFuZ2VMb3cgPSAwOwogICAgICB0aGlzLnByZWZpeExlbmd0aCA9IGxpbmVEYXRhWzBdOwogICAgICB0aGlzLnJhbmdlTGVuZ3RoID0gMDsKICAgICAgdGhpcy5wcmVmaXhDb2RlID0gbGluZURhdGFbMV07CiAgICAgIHRoaXMuaXNMb3dlclJhbmdlID0gZmFsc2U7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmlzT09CID0gZmFsc2U7CiAgICAgIHRoaXMucmFuZ2VMb3cgPSBsaW5lRGF0YVswXTsKICAgICAgdGhpcy5wcmVmaXhMZW5ndGggPSBsaW5lRGF0YVsxXTsKICAgICAgdGhpcy5yYW5nZUxlbmd0aCA9IGxpbmVEYXRhWzJdOwogICAgICB0aGlzLnByZWZpeENvZGUgPSBsaW5lRGF0YVszXTsKICAgICAgdGhpcy5pc0xvd2VyUmFuZ2UgPSBsaW5lRGF0YVs0XSA9PT0gImxvd2VyIjsKICAgIH0KICB9Cn0KY2xhc3MgSHVmZm1hblRyZWVOb2RlIHsKICBjb25zdHJ1Y3RvcihsaW5lKSB7CiAgICB0aGlzLmNoaWxkcmVuID0gW107CiAgICBpZiAobGluZSkgewogICAgICB0aGlzLmlzTGVhZiA9IHRydWU7CiAgICAgIHRoaXMucmFuZ2VMZW5ndGggPSBsaW5lLnJhbmdlTGVuZ3RoOwogICAgICB0aGlzLnJhbmdlTG93ID0gbGluZS5yYW5nZUxvdzsKICAgICAgdGhpcy5pc0xvd2VyUmFuZ2UgPSBsaW5lLmlzTG93ZXJSYW5nZTsKICAgICAgdGhpcy5pc09PQiA9IGxpbmUuaXNPT0I7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmlzTGVhZiA9IGZhbHNlOwogICAgfQogIH0KICBidWlsZFRyZWUobGluZSwgc2hpZnQpIHsKICAgIGNvbnN0IGJpdCA9IGxpbmUucHJlZml4Q29kZSA+PiBzaGlmdCAmIDE7CiAgICBpZiAoc2hpZnQgPD0gMCkgewogICAgICB0aGlzLmNoaWxkcmVuW2JpdF0gPSBuZXcgSHVmZm1hblRyZWVOb2RlKGxpbmUpOwogICAgfSBlbHNlIHsKICAgICAgbGV0IG5vZGUgPSB0aGlzLmNoaWxkcmVuW2JpdF07CiAgICAgIGlmICghbm9kZSkgewogICAgICAgIHRoaXMuY2hpbGRyZW5bYml0XSA9IG5vZGUgPSBuZXcgSHVmZm1hblRyZWVOb2RlKG51bGwpOwogICAgICB9CiAgICAgIG5vZGUuYnVpbGRUcmVlKGxpbmUsIHNoaWZ0IC0gMSk7CiAgICB9CiAgfQogIGRlY29kZU5vZGUocmVhZGVyKSB7CiAgICBpZiAodGhpcy5pc0xlYWYpIHsKICAgICAgaWYgKHRoaXMuaXNPT0IpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBodE9mZnNldCA9IHJlYWRlci5yZWFkQml0cyh0aGlzLnJhbmdlTGVuZ3RoKTsKICAgICAgcmV0dXJuIHRoaXMucmFuZ2VMb3cgKyAodGhpcy5pc0xvd2VyUmFuZ2UgPyAtaHRPZmZzZXQgOiBodE9mZnNldCk7CiAgICB9CiAgICBjb25zdCBub2RlID0gdGhpcy5jaGlsZHJlbltyZWFkZXIucmVhZEJpdCgpXTsKICAgIGlmICghbm9kZSkgewogICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigiaW52YWxpZCBIdWZmbWFuIGRhdGEiKTsKICAgIH0KICAgIHJldHVybiBub2RlLmRlY29kZU5vZGUocmVhZGVyKTsKICB9Cn0KY2xhc3MgSHVmZm1hblRhYmxlIHsKICBjb25zdHJ1Y3RvcihsaW5lcywgcHJlZml4Q29kZXNEb25lKSB7CiAgICBpZiAoIXByZWZpeENvZGVzRG9uZSkgewogICAgICB0aGlzLmFzc2lnblByZWZpeENvZGVzKGxpbmVzKTsKICAgIH0KICAgIHRoaXMucm9vdE5vZGUgPSBuZXcgSHVmZm1hblRyZWVOb2RlKG51bGwpOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gbGluZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBsaW5lID0gbGluZXNbaV07CiAgICAgIGlmIChsaW5lLnByZWZpeExlbmd0aCA+IDApIHsKICAgICAgICB0aGlzLnJvb3ROb2RlLmJ1aWxkVHJlZShsaW5lLCBsaW5lLnByZWZpeExlbmd0aCAtIDEpOwogICAgICB9CiAgICB9CiAgfQogIGRlY29kZShyZWFkZXIpIHsKICAgIHJldHVybiB0aGlzLnJvb3ROb2RlLmRlY29kZU5vZGUocmVhZGVyKTsKICB9CiAgYXNzaWduUHJlZml4Q29kZXMobGluZXMpIHsKICAgIGNvbnN0IGxpbmVzTGVuZ3RoID0gbGluZXMubGVuZ3RoOwogICAgbGV0IHByZWZpeExlbmd0aE1heCA9IDA7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmVzTGVuZ3RoOyBpKyspIHsKICAgICAgcHJlZml4TGVuZ3RoTWF4ID0gTWF0aC5tYXgocHJlZml4TGVuZ3RoTWF4LCBsaW5lc1tpXS5wcmVmaXhMZW5ndGgpOwogICAgfQogICAgY29uc3QgaGlzdG9ncmFtID0gbmV3IFVpbnQzMkFycmF5KHByZWZpeExlbmd0aE1heCArIDEpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lc0xlbmd0aDsgaSsrKSB7CiAgICAgIGhpc3RvZ3JhbVtsaW5lc1tpXS5wcmVmaXhMZW5ndGhdKys7CiAgICB9CiAgICBsZXQgY3VycmVudExlbmd0aCA9IDEsCiAgICAgIGZpcnN0Q29kZSA9IDAsCiAgICAgIGN1cnJlbnRDb2RlLAogICAgICBjdXJyZW50VGVtcCwKICAgICAgbGluZTsKICAgIGhpc3RvZ3JhbVswXSA9IDA7CiAgICB3aGlsZSAoY3VycmVudExlbmd0aCA8PSBwcmVmaXhMZW5ndGhNYXgpIHsKICAgICAgZmlyc3RDb2RlID0gZmlyc3RDb2RlICsgaGlzdG9ncmFtW2N1cnJlbnRMZW5ndGggLSAxXSA8PCAxOwogICAgICBjdXJyZW50Q29kZSA9IGZpcnN0Q29kZTsKICAgICAgY3VycmVudFRlbXAgPSAwOwogICAgICB3aGlsZSAoY3VycmVudFRlbXAgPCBsaW5lc0xlbmd0aCkgewogICAgICAgIGxpbmUgPSBsaW5lc1tjdXJyZW50VGVtcF07CiAgICAgICAgaWYgKGxpbmUucHJlZml4TGVuZ3RoID09PSBjdXJyZW50TGVuZ3RoKSB7CiAgICAgICAgICBsaW5lLnByZWZpeENvZGUgPSBjdXJyZW50Q29kZTsKICAgICAgICAgIGN1cnJlbnRDb2RlKys7CiAgICAgICAgfQogICAgICAgIGN1cnJlbnRUZW1wKys7CiAgICAgIH0KICAgICAgY3VycmVudExlbmd0aCsrOwogICAgfQogIH0KfQpmdW5jdGlvbiBkZWNvZGVUYWJsZXNTZWdtZW50KGRhdGEsIHN0YXJ0LCBlbmQpIHsKICBjb25zdCBmbGFncyA9IGRhdGFbc3RhcnRdOwogIGNvbnN0IGxvd2VzdFZhbHVlID0gcmVhZFVpbnQzMihkYXRhLCBzdGFydCArIDEpICYgMHhmZmZmZmZmZjsKICBjb25zdCBoaWdoZXN0VmFsdWUgPSByZWFkVWludDMyKGRhdGEsIHN0YXJ0ICsgNSkgJiAweGZmZmZmZmZmOwogIGNvbnN0IHJlYWRlciA9IG5ldyBSZWFkZXIoZGF0YSwgc3RhcnQgKyA5LCBlbmQpOwogIGNvbnN0IHByZWZpeFNpemVCaXRzID0gKGZsYWdzID4+IDEgJiA3KSArIDE7CiAgY29uc3QgcmFuZ2VTaXplQml0cyA9IChmbGFncyA+PiA0ICYgNykgKyAxOwogIGNvbnN0IGxpbmVzID0gW107CiAgbGV0IHByZWZpeExlbmd0aCwKICAgIHJhbmdlTGVuZ3RoLAogICAgY3VycmVudFJhbmdlTG93ID0gbG93ZXN0VmFsdWU7CiAgZG8gewogICAgcHJlZml4TGVuZ3RoID0gcmVhZGVyLnJlYWRCaXRzKHByZWZpeFNpemVCaXRzKTsKICAgIHJhbmdlTGVuZ3RoID0gcmVhZGVyLnJlYWRCaXRzKHJhbmdlU2l6ZUJpdHMpOwogICAgbGluZXMucHVzaChuZXcgSHVmZm1hbkxpbmUoW2N1cnJlbnRSYW5nZUxvdywgcHJlZml4TGVuZ3RoLCByYW5nZUxlbmd0aCwgMF0pKTsKICAgIGN1cnJlbnRSYW5nZUxvdyArPSAxIDw8IHJhbmdlTGVuZ3RoOwogIH0gd2hpbGUgKGN1cnJlbnRSYW5nZUxvdyA8IGhpZ2hlc3RWYWx1ZSk7CiAgcHJlZml4TGVuZ3RoID0gcmVhZGVyLnJlYWRCaXRzKHByZWZpeFNpemVCaXRzKTsKICBsaW5lcy5wdXNoKG5ldyBIdWZmbWFuTGluZShbbG93ZXN0VmFsdWUgLSAxLCBwcmVmaXhMZW5ndGgsIDMyLCAwLCAibG93ZXIiXSkpOwogIHByZWZpeExlbmd0aCA9IHJlYWRlci5yZWFkQml0cyhwcmVmaXhTaXplQml0cyk7CiAgbGluZXMucHVzaChuZXcgSHVmZm1hbkxpbmUoW2hpZ2hlc3RWYWx1ZSwgcHJlZml4TGVuZ3RoLCAzMiwgMF0pKTsKICBpZiAoZmxhZ3MgJiAxKSB7CiAgICBwcmVmaXhMZW5ndGggPSByZWFkZXIucmVhZEJpdHMocHJlZml4U2l6ZUJpdHMpOwogICAgbGluZXMucHVzaChuZXcgSHVmZm1hbkxpbmUoW3ByZWZpeExlbmd0aCwgMF0pKTsKICB9CiAgcmV0dXJuIG5ldyBIdWZmbWFuVGFibGUobGluZXMsIGZhbHNlKTsKfQpjb25zdCBzdGFuZGFyZFRhYmxlc0NhY2hlID0ge307CmZ1bmN0aW9uIGdldFN0YW5kYXJkVGFibGUobnVtYmVyKSB7CiAgbGV0IHRhYmxlID0gc3RhbmRhcmRUYWJsZXNDYWNoZVtudW1iZXJdOwogIGlmICh0YWJsZSkgewogICAgcmV0dXJuIHRhYmxlOwogIH0KICBsZXQgbGluZXM7CiAgc3dpdGNoIChudW1iZXIpIHsKICAgIGNhc2UgMToKICAgICAgbGluZXMgPSBbWzAsIDEsIDQsIDB4MF0sIFsxNiwgMiwgOCwgMHgyXSwgWzI3MiwgMywgMTYsIDB4Nl0sIFs2NTgwOCwgMywgMzIsIDB4N11dOwogICAgICBicmVhazsKICAgIGNhc2UgMjoKICAgICAgbGluZXMgPSBbWzAsIDEsIDAsIDB4MF0sIFsxLCAyLCAwLCAweDJdLCBbMiwgMywgMCwgMHg2XSwgWzMsIDQsIDMsIDB4ZV0sIFsxMSwgNSwgNiwgMHgxZV0sIFs3NSwgNiwgMzIsIDB4M2VdLCBbNiwgMHgzZl1dOwogICAgICBicmVhazsKICAgIGNhc2UgMzoKICAgICAgbGluZXMgPSBbWy0yNTYsIDgsIDgsIDB4ZmVdLCBbMCwgMSwgMCwgMHgwXSwgWzEsIDIsIDAsIDB4Ml0sIFsyLCAzLCAwLCAweDZdLCBbMywgNCwgMywgMHhlXSwgWzExLCA1LCA2LCAweDFlXSwgWy0yNTcsIDgsIDMyLCAweGZmLCAibG93ZXIiXSwgWzc1LCA3LCAzMiwgMHg3ZV0sIFs2LCAweDNlXV07CiAgICAgIGJyZWFrOwogICAgY2FzZSA0OgogICAgICBsaW5lcyA9IFtbMSwgMSwgMCwgMHgwXSwgWzIsIDIsIDAsIDB4Ml0sIFszLCAzLCAwLCAweDZdLCBbNCwgNCwgMywgMHhlXSwgWzEyLCA1LCA2LCAweDFlXSwgWzc2LCA1LCAzMiwgMHgxZl1dOwogICAgICBicmVhazsKICAgIGNhc2UgNToKICAgICAgbGluZXMgPSBbWy0yNTUsIDcsIDgsIDB4N2VdLCBbMSwgMSwgMCwgMHgwXSwgWzIsIDIsIDAsIDB4Ml0sIFszLCAzLCAwLCAweDZdLCBbNCwgNCwgMywgMHhlXSwgWzEyLCA1LCA2LCAweDFlXSwgWy0yNTYsIDcsIDMyLCAweDdmLCAibG93ZXIiXSwgWzc2LCA2LCAzMiwgMHgzZV1dOwogICAgICBicmVhazsKICAgIGNhc2UgNjoKICAgICAgbGluZXMgPSBbWy0yMDQ4LCA1LCAxMCwgMHgxY10sIFstMTAyNCwgNCwgOSwgMHg4XSwgWy01MTIsIDQsIDgsIDB4OV0sIFstMjU2LCA0LCA3LCAweGFdLCBbLTEyOCwgNSwgNiwgMHgxZF0sIFstNjQsIDUsIDUsIDB4MWVdLCBbLTMyLCA0LCA1LCAweGJdLCBbMCwgMiwgNywgMHgwXSwgWzEyOCwgMywgNywgMHgyXSwgWzI1NiwgMywgOCwgMHgzXSwgWzUxMiwgNCwgOSwgMHhjXSwgWzEwMjQsIDQsIDEwLCAweGRdLCBbLTIwNDksIDYsIDMyLCAweDNlLCAibG93ZXIiXSwgWzIwNDgsIDYsIDMyLCAweDNmXV07CiAgICAgIGJyZWFrOwogICAgY2FzZSA3OgogICAgICBsaW5lcyA9IFtbLTEwMjQsIDQsIDksIDB4OF0sIFstNTEyLCAzLCA4LCAweDBdLCBbLTI1NiwgNCwgNywgMHg5XSwgWy0xMjgsIDUsIDYsIDB4MWFdLCBbLTY0LCA1LCA1LCAweDFiXSwgWy0zMiwgNCwgNSwgMHhhXSwgWzAsIDQsIDUsIDB4Yl0sIFszMiwgNSwgNSwgMHgxY10sIFs2NCwgNSwgNiwgMHgxZF0sIFsxMjgsIDQsIDcsIDB4Y10sIFsyNTYsIDMsIDgsIDB4MV0sIFs1MTIsIDMsIDksIDB4Ml0sIFsxMDI0LCAzLCAxMCwgMHgzXSwgWy0xMDI1LCA1LCAzMiwgMHgxZSwgImxvd2VyIl0sIFsyMDQ4LCA1LCAzMiwgMHgxZl1dOwogICAgICBicmVhazsKICAgIGNhc2UgODoKICAgICAgbGluZXMgPSBbWy0xNSwgOCwgMywgMHhmY10sIFstNywgOSwgMSwgMHgxZmNdLCBbLTUsIDgsIDEsIDB4ZmRdLCBbLTMsIDksIDAsIDB4MWZkXSwgWy0yLCA3LCAwLCAweDdjXSwgWy0xLCA0LCAwLCAweGFdLCBbMCwgMiwgMSwgMHgwXSwgWzIsIDUsIDAsIDB4MWFdLCBbMywgNiwgMCwgMHgzYV0sIFs0LCAzLCA0LCAweDRdLCBbMjAsIDYsIDEsIDB4M2JdLCBbMjIsIDQsIDQsIDB4Yl0sIFszOCwgNCwgNSwgMHhjXSwgWzcwLCA1LCA2LCAweDFiXSwgWzEzNCwgNSwgNywgMHgxY10sIFsyNjIsIDYsIDcsIDB4M2NdLCBbMzkwLCA3LCA4LCAweDdkXSwgWzY0NiwgNiwgMTAsIDB4M2RdLCBbLTE2LCA5LCAzMiwgMHgxZmUsICJsb3dlciJdLCBbMTY3MCwgOSwgMzIsIDB4MWZmXSwgWzIsIDB4MV1dOwogICAgICBicmVhazsKICAgIGNhc2UgOToKICAgICAgbGluZXMgPSBbWy0zMSwgOCwgNCwgMHhmY10sIFstMTUsIDksIDIsIDB4MWZjXSwgWy0xMSwgOCwgMiwgMHhmZF0sIFstNywgOSwgMSwgMHgxZmRdLCBbLTUsIDcsIDEsIDB4N2NdLCBbLTMsIDQsIDEsIDB4YV0sIFstMSwgMywgMSwgMHgyXSwgWzEsIDMsIDEsIDB4M10sIFszLCA1LCAxLCAweDFhXSwgWzUsIDYsIDEsIDB4M2FdLCBbNywgMywgNSwgMHg0XSwgWzM5LCA2LCAyLCAweDNiXSwgWzQzLCA0LCA1LCAweGJdLCBbNzUsIDQsIDYsIDB4Y10sIFsxMzksIDUsIDcsIDB4MWJdLCBbMjY3LCA1LCA4LCAweDFjXSwgWzUyMywgNiwgOCwgMHgzY10sIFs3NzksIDcsIDksIDB4N2RdLCBbMTI5MSwgNiwgMTEsIDB4M2RdLCBbLTMyLCA5LCAzMiwgMHgxZmUsICJsb3dlciJdLCBbMzMzOSwgOSwgMzIsIDB4MWZmXSwgWzIsIDB4MF1dOwogICAgICBicmVhazsKICAgIGNhc2UgMTA6CiAgICAgIGxpbmVzID0gW1stMjEsIDcsIDQsIDB4N2FdLCBbLTUsIDgsIDAsIDB4ZmNdLCBbLTQsIDcsIDAsIDB4N2JdLCBbLTMsIDUsIDAsIDB4MThdLCBbLTIsIDIsIDIsIDB4MF0sIFsyLCA1LCAwLCAweDE5XSwgWzMsIDYsIDAsIDB4MzZdLCBbNCwgNywgMCwgMHg3Y10sIFs1LCA4LCAwLCAweGZkXSwgWzYsIDIsIDYsIDB4MV0sIFs3MCwgNSwgNSwgMHgxYV0sIFsxMDIsIDYsIDUsIDB4MzddLCBbMTM0LCA2LCA2LCAweDM4XSwgWzE5OCwgNiwgNywgMHgzOV0sIFszMjYsIDYsIDgsIDB4M2FdLCBbNTgyLCA2LCA5LCAweDNiXSwgWzEwOTQsIDYsIDEwLCAweDNjXSwgWzIxMTgsIDcsIDExLCAweDdkXSwgWy0yMiwgOCwgMzIsIDB4ZmUsICJsb3dlciJdLCBbNDE2NiwgOCwgMzIsIDB4ZmZdLCBbMiwgMHgyXV07CiAgICAgIGJyZWFrOwogICAgY2FzZSAxMToKICAgICAgbGluZXMgPSBbWzEsIDEsIDAsIDB4MF0sIFsyLCAyLCAxLCAweDJdLCBbNCwgNCwgMCwgMHhjXSwgWzUsIDQsIDEsIDB4ZF0sIFs3LCA1LCAxLCAweDFjXSwgWzksIDUsIDIsIDB4MWRdLCBbMTMsIDYsIDIsIDB4M2NdLCBbMTcsIDcsIDIsIDB4N2FdLCBbMjEsIDcsIDMsIDB4N2JdLCBbMjksIDcsIDQsIDB4N2NdLCBbNDUsIDcsIDUsIDB4N2RdLCBbNzcsIDcsIDYsIDB4N2VdLCBbMTQxLCA3LCAzMiwgMHg3Zl1dOwogICAgICBicmVhazsKICAgIGNhc2UgMTI6CiAgICAgIGxpbmVzID0gW1sxLCAxLCAwLCAweDBdLCBbMiwgMiwgMCwgMHgyXSwgWzMsIDMsIDEsIDB4Nl0sIFs1LCA1LCAwLCAweDFjXSwgWzYsIDUsIDEsIDB4MWRdLCBbOCwgNiwgMSwgMHgzY10sIFsxMCwgNywgMCwgMHg3YV0sIFsxMSwgNywgMSwgMHg3Yl0sIFsxMywgNywgMiwgMHg3Y10sIFsxNywgNywgMywgMHg3ZF0sIFsyNSwgNywgNCwgMHg3ZV0sIFs0MSwgOCwgNSwgMHhmZV0sIFs3MywgOCwgMzIsIDB4ZmZdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDEzOgogICAgICBsaW5lcyA9IFtbMSwgMSwgMCwgMHgwXSwgWzIsIDMsIDAsIDB4NF0sIFszLCA0LCAwLCAweGNdLCBbNCwgNSwgMCwgMHgxY10sIFs1LCA0LCAxLCAweGRdLCBbNywgMywgMywgMHg1XSwgWzE1LCA2LCAxLCAweDNhXSwgWzE3LCA2LCAyLCAweDNiXSwgWzIxLCA2LCAzLCAweDNjXSwgWzI5LCA2LCA0LCAweDNkXSwgWzQ1LCA2LCA1LCAweDNlXSwgWzc3LCA3LCA2LCAweDdlXSwgWzE0MSwgNywgMzIsIDB4N2ZdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDE0OgogICAgICBsaW5lcyA9IFtbLTIsIDMsIDAsIDB4NF0sIFstMSwgMywgMCwgMHg1XSwgWzAsIDEsIDAsIDB4MF0sIFsxLCAzLCAwLCAweDZdLCBbMiwgMywgMCwgMHg3XV07CiAgICAgIGJyZWFrOwogICAgY2FzZSAxNToKICAgICAgbGluZXMgPSBbWy0yNCwgNywgNCwgMHg3Y10sIFstOCwgNiwgMiwgMHgzY10sIFstNCwgNSwgMSwgMHgxY10sIFstMiwgNCwgMCwgMHhjXSwgWy0xLCAzLCAwLCAweDRdLCBbMCwgMSwgMCwgMHgwXSwgWzEsIDMsIDAsIDB4NV0sIFsyLCA0LCAwLCAweGRdLCBbMywgNSwgMSwgMHgxZF0sIFs1LCA2LCAyLCAweDNkXSwgWzksIDcsIDQsIDB4N2RdLCBbLTI1LCA3LCAzMiwgMHg3ZSwgImxvd2VyIl0sIFsyNSwgNywgMzIsIDB4N2ZdXTsKICAgICAgYnJlYWs7CiAgICBkZWZhdWx0OgogICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcihgc3RhbmRhcmQgdGFibGUgQi4ke251bWJlcn0gZG9lcyBub3QgZXhpc3RgKTsKICB9CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gbGluZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgbGluZXNbaV0gPSBuZXcgSHVmZm1hbkxpbmUobGluZXNbaV0pOwogIH0KICB0YWJsZSA9IG5ldyBIdWZmbWFuVGFibGUobGluZXMsIHRydWUpOwogIHN0YW5kYXJkVGFibGVzQ2FjaGVbbnVtYmVyXSA9IHRhYmxlOwogIHJldHVybiB0YWJsZTsKfQpjbGFzcyBSZWFkZXIgewogIGNvbnN0cnVjdG9yKGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICB0aGlzLnN0YXJ0ID0gc3RhcnQ7CiAgICB0aGlzLmVuZCA9IGVuZDsKICAgIHRoaXMucG9zaXRpb24gPSBzdGFydDsKICAgIHRoaXMuc2hpZnQgPSAtMTsKICAgIHRoaXMuY3VycmVudEJ5dGUgPSAwOwogIH0KICByZWFkQml0KCkgewogICAgaWYgKHRoaXMuc2hpZnQgPCAwKSB7CiAgICAgIGlmICh0aGlzLnBvc2l0aW9uID49IHRoaXMuZW5kKSB7CiAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImVuZCBvZiBkYXRhIHdoaWxlIHJlYWRpbmcgYml0Iik7CiAgICAgIH0KICAgICAgdGhpcy5jdXJyZW50Qnl0ZSA9IHRoaXMuZGF0YVt0aGlzLnBvc2l0aW9uKytdOwogICAgICB0aGlzLnNoaWZ0ID0gNzsKICAgIH0KICAgIGNvbnN0IGJpdCA9IHRoaXMuY3VycmVudEJ5dGUgPj4gdGhpcy5zaGlmdCAmIDE7CiAgICB0aGlzLnNoaWZ0LS07CiAgICByZXR1cm4gYml0OwogIH0KICByZWFkQml0cyhudW1CaXRzKSB7CiAgICBsZXQgcmVzdWx0ID0gMCwKICAgICAgaTsKICAgIGZvciAoaSA9IG51bUJpdHMgLSAxOyBpID49IDA7IGktLSkgewogICAgICByZXN1bHQgfD0gdGhpcy5yZWFkQml0KCkgPDwgaTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQogIGJ5dGVBbGlnbigpIHsKICAgIHRoaXMuc2hpZnQgPSAtMTsKICB9CiAgbmV4dCgpIHsKICAgIGlmICh0aGlzLnBvc2l0aW9uID49IHRoaXMuZW5kKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIHJldHVybiB0aGlzLmRhdGFbdGhpcy5wb3NpdGlvbisrXTsKICB9Cn0KZnVuY3Rpb24gZ2V0Q3VzdG9tSHVmZm1hblRhYmxlKGluZGV4LCByZWZlcnJlZFRvLCBjdXN0b21UYWJsZXMpIHsKICBsZXQgY3VycmVudEluZGV4ID0gMDsKICBmb3IgKGxldCBpID0gMCwgaWkgPSByZWZlcnJlZFRvLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGNvbnN0IHRhYmxlID0gY3VzdG9tVGFibGVzW3JlZmVycmVkVG9baV1dOwogICAgaWYgKHRhYmxlKSB7CiAgICAgIGlmIChpbmRleCA9PT0gY3VycmVudEluZGV4KSB7CiAgICAgICAgcmV0dXJuIHRhYmxlOwogICAgICB9CiAgICAgIGN1cnJlbnRJbmRleCsrOwogICAgfQogIH0KICB0aHJvdyBuZXcgSmJpZzJFcnJvcigiY2FuJ3QgZmluZCBjdXN0b20gSHVmZm1hbiB0YWJsZSIpOwp9CmZ1bmN0aW9uIGdldFRleHRSZWdpb25IdWZmbWFuVGFibGVzKHRleHRSZWdpb24sIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcywgbnVtYmVyT2ZTeW1ib2xzLCByZWFkZXIpIHsKICBjb25zdCBjb2RlcyA9IFtdOwogIGZvciAobGV0IGkgPSAwOyBpIDw9IDM0OyBpKyspIHsKICAgIGNvbnN0IGNvZGVMZW5ndGggPSByZWFkZXIucmVhZEJpdHMoNCk7CiAgICBjb2Rlcy5wdXNoKG5ldyBIdWZmbWFuTGluZShbaSwgY29kZUxlbmd0aCwgMCwgMF0pKTsKICB9CiAgY29uc3QgcnVuQ29kZXNUYWJsZSA9IG5ldyBIdWZmbWFuVGFibGUoY29kZXMsIGZhbHNlKTsKICBjb2Rlcy5sZW5ndGggPSAwOwogIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtYmVyT2ZTeW1ib2xzOykgewogICAgY29uc3QgY29kZUxlbmd0aCA9IHJ1bkNvZGVzVGFibGUuZGVjb2RlKHJlYWRlcik7CiAgICBpZiAoY29kZUxlbmd0aCA+PSAzMikgewogICAgICBsZXQgcmVwZWF0ZWRMZW5ndGgsIG51bWJlck9mUmVwZWF0cywgajsKICAgICAgc3dpdGNoIChjb2RlTGVuZ3RoKSB7CiAgICAgICAgY2FzZSAzMjoKICAgICAgICAgIGlmIChpID09PSAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJubyBwcmV2aW91cyB2YWx1ZSBpbiBzeW1ib2wgSUQgdGFibGUiKTsKICAgICAgICAgIH0KICAgICAgICAgIG51bWJlck9mUmVwZWF0cyA9IHJlYWRlci5yZWFkQml0cygyKSArIDM7CiAgICAgICAgICByZXBlYXRlZExlbmd0aCA9IGNvZGVzW2kgLSAxXS5wcmVmaXhMZW5ndGg7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDMzOgogICAgICAgICAgbnVtYmVyT2ZSZXBlYXRzID0gcmVhZGVyLnJlYWRCaXRzKDMpICsgMzsKICAgICAgICAgIHJlcGVhdGVkTGVuZ3RoID0gMDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMzQ6CiAgICAgICAgICBudW1iZXJPZlJlcGVhdHMgPSByZWFkZXIucmVhZEJpdHMoNykgKyAxMTsKICAgICAgICAgIHJlcGVhdGVkTGVuZ3RoID0gMDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigiaW52YWxpZCBjb2RlIGxlbmd0aCBpbiBzeW1ib2wgSUQgdGFibGUiKTsKICAgICAgfQogICAgICBmb3IgKGogPSAwOyBqIDwgbnVtYmVyT2ZSZXBlYXRzOyBqKyspIHsKICAgICAgICBjb2Rlcy5wdXNoKG5ldyBIdWZmbWFuTGluZShbaSwgcmVwZWF0ZWRMZW5ndGgsIDAsIDBdKSk7CiAgICAgICAgaSsrOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb2Rlcy5wdXNoKG5ldyBIdWZmbWFuTGluZShbaSwgY29kZUxlbmd0aCwgMCwgMF0pKTsKICAgICAgaSsrOwogICAgfQogIH0KICByZWFkZXIuYnl0ZUFsaWduKCk7CiAgY29uc3Qgc3ltYm9sSURUYWJsZSA9IG5ldyBIdWZmbWFuVGFibGUoY29kZXMsIGZhbHNlKTsKICBsZXQgY3VzdG9tSW5kZXggPSAwLAogICAgdGFibGVGaXJzdFMsCiAgICB0YWJsZURlbHRhUywKICAgIHRhYmxlRGVsdGFUOwogIHN3aXRjaCAodGV4dFJlZ2lvbi5odWZmbWFuRlMpIHsKICAgIGNhc2UgMDoKICAgIGNhc2UgMToKICAgICAgdGFibGVGaXJzdFMgPSBnZXRTdGFuZGFyZFRhYmxlKHRleHRSZWdpb24uaHVmZm1hbkZTICsgNik7CiAgICAgIGJyZWFrOwogICAgY2FzZSAzOgogICAgICB0YWJsZUZpcnN0UyA9IGdldEN1c3RvbUh1ZmZtYW5UYWJsZShjdXN0b21JbmRleCwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzKTsKICAgICAgY3VzdG9tSW5kZXgrKzsKICAgICAgYnJlYWs7CiAgICBkZWZhdWx0OgogICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigiaW52YWxpZCBIdWZmbWFuIEZTIHNlbGVjdG9yIik7CiAgfQogIHN3aXRjaCAodGV4dFJlZ2lvbi5odWZmbWFuRFMpIHsKICAgIGNhc2UgMDoKICAgIGNhc2UgMToKICAgIGNhc2UgMjoKICAgICAgdGFibGVEZWx0YVMgPSBnZXRTdGFuZGFyZFRhYmxlKHRleHRSZWdpb24uaHVmZm1hbkRTICsgOCk7CiAgICAgIGJyZWFrOwogICAgY2FzZSAzOgogICAgICB0YWJsZURlbHRhUyA9IGdldEN1c3RvbUh1ZmZtYW5UYWJsZShjdXN0b21JbmRleCwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzKTsKICAgICAgY3VzdG9tSW5kZXgrKzsKICAgICAgYnJlYWs7CiAgICBkZWZhdWx0OgogICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigiaW52YWxpZCBIdWZmbWFuIERTIHNlbGVjdG9yIik7CiAgfQogIHN3aXRjaCAodGV4dFJlZ2lvbi5odWZmbWFuRFQpIHsKICAgIGNhc2UgMDoKICAgIGNhc2UgMToKICAgIGNhc2UgMjoKICAgICAgdGFibGVEZWx0YVQgPSBnZXRTdGFuZGFyZFRhYmxlKHRleHRSZWdpb24uaHVmZm1hbkRUICsgMTEpOwogICAgICBicmVhazsKICAgIGNhc2UgMzoKICAgICAgdGFibGVEZWx0YVQgPSBnZXRDdXN0b21IdWZmbWFuVGFibGUoY3VzdG9tSW5kZXgsIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcyk7CiAgICAgIGN1c3RvbUluZGV4Kys7CiAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgSHVmZm1hbiBEVCBzZWxlY3RvciIpOwogIH0KICBpZiAodGV4dFJlZ2lvbi5yZWZpbmVtZW50KSB7CiAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigicmVmaW5lbWVudCB3aXRoIEh1ZmZtYW4gaXMgbm90IHN1cHBvcnRlZCIpOwogIH0KICByZXR1cm4gewogICAgc3ltYm9sSURUYWJsZSwKICAgIHRhYmxlRmlyc3RTLAogICAgdGFibGVEZWx0YVMsCiAgICB0YWJsZURlbHRhVAogIH07Cn0KZnVuY3Rpb24gZ2V0U3ltYm9sRGljdGlvbmFyeUh1ZmZtYW5UYWJsZXMoZGljdGlvbmFyeSwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzKSB7CiAgbGV0IGN1c3RvbUluZGV4ID0gMCwKICAgIHRhYmxlRGVsdGFIZWlnaHQsCiAgICB0YWJsZURlbHRhV2lkdGg7CiAgc3dpdGNoIChkaWN0aW9uYXJ5Lmh1ZmZtYW5ESFNlbGVjdG9yKSB7CiAgICBjYXNlIDA6CiAgICBjYXNlIDE6CiAgICAgIHRhYmxlRGVsdGFIZWlnaHQgPSBnZXRTdGFuZGFyZFRhYmxlKGRpY3Rpb25hcnkuaHVmZm1hbkRIU2VsZWN0b3IgKyA0KTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDM6CiAgICAgIHRhYmxlRGVsdGFIZWlnaHQgPSBnZXRDdXN0b21IdWZmbWFuVGFibGUoY3VzdG9tSW5kZXgsIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcyk7CiAgICAgIGN1c3RvbUluZGV4Kys7CiAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgSHVmZm1hbiBESCBzZWxlY3RvciIpOwogIH0KICBzd2l0Y2ggKGRpY3Rpb25hcnkuaHVmZm1hbkRXU2VsZWN0b3IpIHsKICAgIGNhc2UgMDoKICAgIGNhc2UgMToKICAgICAgdGFibGVEZWx0YVdpZHRoID0gZ2V0U3RhbmRhcmRUYWJsZShkaWN0aW9uYXJ5Lmh1ZmZtYW5EV1NlbGVjdG9yICsgMik7CiAgICAgIGJyZWFrOwogICAgY2FzZSAzOgogICAgICB0YWJsZURlbHRhV2lkdGggPSBnZXRDdXN0b21IdWZmbWFuVGFibGUoY3VzdG9tSW5kZXgsIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcyk7CiAgICAgIGN1c3RvbUluZGV4Kys7CiAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgSHVmZm1hbiBEVyBzZWxlY3RvciIpOwogIH0KICBsZXQgdGFibGVCaXRtYXBTaXplLCB0YWJsZUFnZ3JlZ2F0ZUluc3RhbmNlczsKICBpZiAoZGljdGlvbmFyeS5iaXRtYXBTaXplU2VsZWN0b3IpIHsKICAgIHRhYmxlQml0bWFwU2l6ZSA9IGdldEN1c3RvbUh1ZmZtYW5UYWJsZShjdXN0b21JbmRleCwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzKTsKICAgIGN1c3RvbUluZGV4Kys7CiAgfSBlbHNlIHsKICAgIHRhYmxlQml0bWFwU2l6ZSA9IGdldFN0YW5kYXJkVGFibGUoMSk7CiAgfQogIGlmIChkaWN0aW9uYXJ5LmFnZ3JlZ2F0aW9uSW5zdGFuY2VzU2VsZWN0b3IpIHsKICAgIHRhYmxlQWdncmVnYXRlSW5zdGFuY2VzID0gZ2V0Q3VzdG9tSHVmZm1hblRhYmxlKGN1c3RvbUluZGV4LCByZWZlcnJlZFRvLCBjdXN0b21UYWJsZXMpOwogIH0gZWxzZSB7CiAgICB0YWJsZUFnZ3JlZ2F0ZUluc3RhbmNlcyA9IGdldFN0YW5kYXJkVGFibGUoMSk7CiAgfQogIHJldHVybiB7CiAgICB0YWJsZURlbHRhSGVpZ2h0LAogICAgdGFibGVEZWx0YVdpZHRoLAogICAgdGFibGVCaXRtYXBTaXplLAogICAgdGFibGVBZ2dyZWdhdGVJbnN0YW5jZXMKICB9Owp9CmZ1bmN0aW9uIHJlYWRVbmNvbXByZXNzZWRCaXRtYXAocmVhZGVyLCB3aWR0aCwgaGVpZ2h0KSB7CiAgY29uc3QgYml0bWFwID0gW107CiAgZm9yIChsZXQgeSA9IDA7IHkgPCBoZWlnaHQ7IHkrKykgewogICAgY29uc3Qgcm93ID0gbmV3IFVpbnQ4QXJyYXkod2lkdGgpOwogICAgYml0bWFwLnB1c2gocm93KTsKICAgIGZvciAobGV0IHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewogICAgICByb3dbeF0gPSByZWFkZXIucmVhZEJpdCgpOwogICAgfQogICAgcmVhZGVyLmJ5dGVBbGlnbigpOwogIH0KICByZXR1cm4gYml0bWFwOwp9CmZ1bmN0aW9uIGRlY29kZU1NUkJpdG1hcChpbnB1dCwgd2lkdGgsIGhlaWdodCwgZW5kT2ZCbG9jaykgewogIGNvbnN0IHBhcmFtcyA9IHsKICAgIEs6IC0xLAogICAgQ29sdW1uczogd2lkdGgsCiAgICBSb3dzOiBoZWlnaHQsCiAgICBCbGFja0lzMTogdHJ1ZSwKICAgIEVuZE9mQmxvY2s6IGVuZE9mQmxvY2sKICB9OwogIGNvbnN0IGRlY29kZXIgPSBuZXcgQ0NJVFRGYXhEZWNvZGVyKGlucHV0LCBwYXJhbXMpOwogIGNvbnN0IGJpdG1hcCA9IFtdOwogIGxldCBjdXJyZW50Qnl0ZSwKICAgIGVvZiA9IGZhbHNlOwogIGZvciAobGV0IHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKICAgIGNvbnN0IHJvdyA9IG5ldyBVaW50OEFycmF5KHdpZHRoKTsKICAgIGJpdG1hcC5wdXNoKHJvdyk7CiAgICBsZXQgc2hpZnQgPSAtMTsKICAgIGZvciAobGV0IHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewogICAgICBpZiAoc2hpZnQgPCAwKSB7CiAgICAgICAgY3VycmVudEJ5dGUgPSBkZWNvZGVyLnJlYWROZXh0Q2hhcigpOwogICAgICAgIGlmIChjdXJyZW50Qnl0ZSA9PT0gLTEpIHsKICAgICAgICAgIGN1cnJlbnRCeXRlID0gMDsKICAgICAgICAgIGVvZiA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHNoaWZ0ID0gNzsKICAgICAgfQogICAgICByb3dbeF0gPSBjdXJyZW50Qnl0ZSA+PiBzaGlmdCAmIDE7CiAgICAgIHNoaWZ0LS07CiAgICB9CiAgfQogIGlmIChlbmRPZkJsb2NrICYmICFlb2YpIHsKICAgIGNvbnN0IGxvb2tGb3JFT0ZMaW1pdCA9IDU7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxvb2tGb3JFT0ZMaW1pdDsgaSsrKSB7CiAgICAgIGlmIChkZWNvZGVyLnJlYWROZXh0Q2hhcigpID09PSAtMSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQogIHJldHVybiBiaXRtYXA7Cn0KY2xhc3MgSmJpZzJJbWFnZSB7CiAgcGFyc2VDaHVua3MoY2h1bmtzKSB7CiAgICByZXR1cm4gcGFyc2VKYmlnMkNodW5rcyhjaHVua3MpOwogIH0KICBwYXJzZShkYXRhKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBpbXBsZW1lbnRlZDogSmJpZzJJbWFnZS5wYXJzZSIpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvamJpZzJfc3RyZWFtLmpzCgoKCgoKY2xhc3MgSmJpZzJTdHJlYW0gZXh0ZW5kcyBEZWNvZGVTdHJlYW0gewogIGNvbnN0cnVjdG9yKHN0cmVhbSwgbWF5YmVMZW5ndGgsIHBhcmFtcykgewogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07CiAgICB0aGlzLmRpY3QgPSBzdHJlYW0uZGljdDsKICAgIHRoaXMubWF5YmVMZW5ndGggPSBtYXliZUxlbmd0aDsKICAgIHRoaXMucGFyYW1zID0gcGFyYW1zOwogIH0KICBnZXQgYnl0ZXMoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJieXRlcyIsIHRoaXMuc3RyZWFtLmdldEJ5dGVzKHRoaXMubWF5YmVMZW5ndGgpKTsKICB9CiAgZW5zdXJlQnVmZmVyKHJlcXVlc3RlZCkge30KICByZWFkQmxvY2soKSB7CiAgICB0aGlzLmRlY29kZUltYWdlKCk7CiAgfQogIGRlY29kZUltYWdlKGJ5dGVzKSB7CiAgICBpZiAodGhpcy5lb2YpIHsKICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyOwogICAgfQogICAgYnl0ZXMgfHw9IHRoaXMuYnl0ZXM7CiAgICBjb25zdCBqYmlnMkltYWdlID0gbmV3IEpiaWcySW1hZ2UoKTsKICAgIGNvbnN0IGNodW5rcyA9IFtdOwogICAgaWYgKHRoaXMucGFyYW1zIGluc3RhbmNlb2YgRGljdCkgewogICAgICBjb25zdCBnbG9iYWxzU3RyZWFtID0gdGhpcy5wYXJhbXMuZ2V0KCJKQklHMkdsb2JhbHMiKTsKICAgICAgaWYgKGdsb2JhbHNTdHJlYW0gaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgICAgY29uc3QgZ2xvYmFscyA9IGdsb2JhbHNTdHJlYW0uZ2V0Qnl0ZXMoKTsKICAgICAgICBjaHVua3MucHVzaCh7CiAgICAgICAgICBkYXRhOiBnbG9iYWxzLAogICAgICAgICAgc3RhcnQ6IDAsCiAgICAgICAgICBlbmQ6IGdsb2JhbHMubGVuZ3RoCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIGNodW5rcy5wdXNoKHsKICAgICAgZGF0YTogYnl0ZXMsCiAgICAgIHN0YXJ0OiAwLAogICAgICBlbmQ6IGJ5dGVzLmxlbmd0aAogICAgfSk7CiAgICBjb25zdCBkYXRhID0gamJpZzJJbWFnZS5wYXJzZUNodW5rcyhjaHVua3MpOwogICAgY29uc3QgZGF0YUxlbmd0aCA9IGRhdGEubGVuZ3RoOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhTGVuZ3RoOyBpKyspIHsKICAgICAgZGF0YVtpXSBePSAweGZmOwogICAgfQogICAgdGhpcy5idWZmZXIgPSBkYXRhOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSBkYXRhTGVuZ3RoOwogICAgdGhpcy5lb2YgPSB0cnVlOwogICAgcmV0dXJuIHRoaXMuYnVmZmVyOwogIH0KICBnZXQgY2FuQXN5bmNEZWNvZGVJbWFnZUZyb21CdWZmZXIoKSB7CiAgICByZXR1cm4gdGhpcy5zdHJlYW0uaXNBc3luYzsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2pweF9zdHJlYW0uanMKCgoKY2xhc3MgSnB4U3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIG1heWJlTGVuZ3RoLCBwYXJhbXMpIHsKICAgIHN1cGVyKG1heWJlTGVuZ3RoKTsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy5kaWN0ID0gc3RyZWFtLmRpY3Q7CiAgICB0aGlzLm1heWJlTGVuZ3RoID0gbWF5YmVMZW5ndGg7CiAgICB0aGlzLnBhcmFtcyA9IHBhcmFtczsKICB9CiAgZ2V0IGJ5dGVzKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiYnl0ZXMiLCB0aGlzLnN0cmVhbS5nZXRCeXRlcyh0aGlzLm1heWJlTGVuZ3RoKSk7CiAgfQogIGVuc3VyZUJ1ZmZlcihyZXF1ZXN0ZWQpIHt9CiAgcmVhZEJsb2NrKGRlY29kZXJPcHRpb25zKSB7CiAgICB1bnJlYWNoYWJsZSgiSnB4U3RyZWFtLnJlYWRCbG9jayIpOwogIH0KICBnZXQgaXNBc3luY0RlY29kZXIoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgYXN5bmMgZGVjb2RlSW1hZ2UoYnl0ZXMsIGRlY29kZXJPcHRpb25zKSB7CiAgICBpZiAodGhpcy5lb2YpIHsKICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyOwogICAgfQogICAgYnl0ZXMgfHw9IHRoaXMuYnl0ZXM7CiAgICB0aGlzLmJ1ZmZlciA9IGF3YWl0IEpweEltYWdlLmRlY29kZShieXRlcywgZGVjb2Rlck9wdGlvbnMpOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlci5sZW5ndGg7CiAgICB0aGlzLmVvZiA9IHRydWU7CiAgICByZXR1cm4gdGhpcy5idWZmZXI7CiAgfQogIGdldCBjYW5Bc3luY0RlY29kZUltYWdlRnJvbUJ1ZmZlcigpIHsKICAgIHJldHVybiB0aGlzLnN0cmVhbS5pc0FzeW5jOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvbHp3X3N0cmVhbS5qcwoKY2xhc3MgTFpXU3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIsIG1heWJlTGVuZ3RoLCBlYXJseUNoYW5nZSkgewogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHIgPSBzdHI7CiAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICAgIHRoaXMuY2FjaGVkRGF0YSA9IDA7CiAgICB0aGlzLmJpdHNDYWNoZWQgPSAwOwogICAgY29uc3QgbWF4THp3RGljdGlvbmFyeVNpemUgPSA0MDk2OwogICAgY29uc3QgbHp3U3RhdGUgPSB7CiAgICAgIGVhcmx5Q2hhbmdlLAogICAgICBjb2RlTGVuZ3RoOiA5LAogICAgICBuZXh0Q29kZTogMjU4LAogICAgICBkaWN0aW9uYXJ5VmFsdWVzOiBuZXcgVWludDhBcnJheShtYXhMendEaWN0aW9uYXJ5U2l6ZSksCiAgICAgIGRpY3Rpb25hcnlMZW5ndGhzOiBuZXcgVWludDE2QXJyYXkobWF4THp3RGljdGlvbmFyeVNpemUpLAogICAgICBkaWN0aW9uYXJ5UHJldkNvZGVzOiBuZXcgVWludDE2QXJyYXkobWF4THp3RGljdGlvbmFyeVNpemUpLAogICAgICBjdXJyZW50U2VxdWVuY2U6IG5ldyBVaW50OEFycmF5KG1heEx6d0RpY3Rpb25hcnlTaXplKSwKICAgICAgY3VycmVudFNlcXVlbmNlTGVuZ3RoOiAwCiAgICB9OwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7ICsraSkgewogICAgICBsendTdGF0ZS5kaWN0aW9uYXJ5VmFsdWVzW2ldID0gaTsKICAgICAgbHp3U3RhdGUuZGljdGlvbmFyeUxlbmd0aHNbaV0gPSAxOwogICAgfQogICAgdGhpcy5sendTdGF0ZSA9IGx6d1N0YXRlOwogIH0KICByZWFkQml0cyhuKSB7CiAgICBsZXQgYml0c0NhY2hlZCA9IHRoaXMuYml0c0NhY2hlZDsKICAgIGxldCBjYWNoZWREYXRhID0gdGhpcy5jYWNoZWREYXRhOwogICAgd2hpbGUgKGJpdHNDYWNoZWQgPCBuKSB7CiAgICAgIGNvbnN0IGMgPSB0aGlzLnN0ci5nZXRCeXRlKCk7CiAgICAgIGlmIChjID09PSAtMSkgewogICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjYWNoZWREYXRhID0gY2FjaGVkRGF0YSA8PCA4IHwgYzsKICAgICAgYml0c0NhY2hlZCArPSA4OwogICAgfQogICAgdGhpcy5iaXRzQ2FjaGVkID0gYml0c0NhY2hlZCAtPSBuOwogICAgdGhpcy5jYWNoZWREYXRhID0gY2FjaGVkRGF0YTsKICAgIHRoaXMubGFzdENvZGUgPSBudWxsOwogICAgcmV0dXJuIGNhY2hlZERhdGEgPj4+IGJpdHNDYWNoZWQgJiAoMSA8PCBuKSAtIDE7CiAgfQogIHJlYWRCbG9jaygpIHsKICAgIGNvbnN0IGJsb2NrU2l6ZSA9IDUxMiwKICAgICAgZGVjb2RlZFNpemVEZWx0YSA9IGJsb2NrU2l6ZTsKICAgIGxldCBlc3RpbWF0ZWREZWNvZGVkU2l6ZSA9IGJsb2NrU2l6ZSAqIDI7CiAgICBsZXQgaSwgaiwgcTsKICAgIGNvbnN0IGx6d1N0YXRlID0gdGhpcy5sendTdGF0ZTsKICAgIGlmICghbHp3U3RhdGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZWFybHlDaGFuZ2UgPSBsendTdGF0ZS5lYXJseUNoYW5nZTsKICAgIGxldCBuZXh0Q29kZSA9IGx6d1N0YXRlLm5leHRDb2RlOwogICAgY29uc3QgZGljdGlvbmFyeVZhbHVlcyA9IGx6d1N0YXRlLmRpY3Rpb25hcnlWYWx1ZXM7CiAgICBjb25zdCBkaWN0aW9uYXJ5TGVuZ3RocyA9IGx6d1N0YXRlLmRpY3Rpb25hcnlMZW5ndGhzOwogICAgY29uc3QgZGljdGlvbmFyeVByZXZDb2RlcyA9IGx6d1N0YXRlLmRpY3Rpb25hcnlQcmV2Q29kZXM7CiAgICBsZXQgY29kZUxlbmd0aCA9IGx6d1N0YXRlLmNvZGVMZW5ndGg7CiAgICBsZXQgcHJldkNvZGUgPSBsendTdGF0ZS5wcmV2Q29kZTsKICAgIGNvbnN0IGN1cnJlbnRTZXF1ZW5jZSA9IGx6d1N0YXRlLmN1cnJlbnRTZXF1ZW5jZTsKICAgIGxldCBjdXJyZW50U2VxdWVuY2VMZW5ndGggPSBsendTdGF0ZS5jdXJyZW50U2VxdWVuY2VMZW5ndGg7CiAgICBsZXQgZGVjb2RlZExlbmd0aCA9IDA7CiAgICBsZXQgY3VycmVudEJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgbGV0IGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKHRoaXMuYnVmZmVyTGVuZ3RoICsgZXN0aW1hdGVkRGVjb2RlZFNpemUpOwogICAgZm9yIChpID0gMDsgaSA8IGJsb2NrU2l6ZTsgaSsrKSB7CiAgICAgIGNvbnN0IGNvZGUgPSB0aGlzLnJlYWRCaXRzKGNvZGVMZW5ndGgpOwogICAgICBjb25zdCBoYXNQcmV2ID0gY3VycmVudFNlcXVlbmNlTGVuZ3RoID4gMDsKICAgICAgaWYgKGNvZGUgPCAyNTYpIHsKICAgICAgICBjdXJyZW50U2VxdWVuY2VbMF0gPSBjb2RlOwogICAgICAgIGN1cnJlbnRTZXF1ZW5jZUxlbmd0aCA9IDE7CiAgICAgIH0gZWxzZSBpZiAoY29kZSA+PSAyNTgpIHsKICAgICAgICBpZiAoY29kZSA8IG5leHRDb2RlKSB7CiAgICAgICAgICBjdXJyZW50U2VxdWVuY2VMZW5ndGggPSBkaWN0aW9uYXJ5TGVuZ3Roc1tjb2RlXTsKICAgICAgICAgIGZvciAoaiA9IGN1cnJlbnRTZXF1ZW5jZUxlbmd0aCAtIDEsIHEgPSBjb2RlOyBqID49IDA7IGotLSkgewogICAgICAgICAgICBjdXJyZW50U2VxdWVuY2Vbal0gPSBkaWN0aW9uYXJ5VmFsdWVzW3FdOwogICAgICAgICAgICBxID0gZGljdGlvbmFyeVByZXZDb2Rlc1txXTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3VycmVudFNlcXVlbmNlW2N1cnJlbnRTZXF1ZW5jZUxlbmd0aCsrXSA9IGN1cnJlbnRTZXF1ZW5jZVswXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoY29kZSA9PT0gMjU2KSB7CiAgICAgICAgY29kZUxlbmd0aCA9IDk7CiAgICAgICAgbmV4dENvZGUgPSAyNTg7CiAgICAgICAgY3VycmVudFNlcXVlbmNlTGVuZ3RoID0gMDsKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgZGVsZXRlIHRoaXMubHp3U3RhdGU7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKGhhc1ByZXYpIHsKICAgICAgICBkaWN0aW9uYXJ5UHJldkNvZGVzW25leHRDb2RlXSA9IHByZXZDb2RlOwogICAgICAgIGRpY3Rpb25hcnlMZW5ndGhzW25leHRDb2RlXSA9IGRpY3Rpb25hcnlMZW5ndGhzW3ByZXZDb2RlXSArIDE7CiAgICAgICAgZGljdGlvbmFyeVZhbHVlc1tuZXh0Q29kZV0gPSBjdXJyZW50U2VxdWVuY2VbMF07CiAgICAgICAgbmV4dENvZGUrKzsKICAgICAgICBjb2RlTGVuZ3RoID0gbmV4dENvZGUgKyBlYXJseUNoYW5nZSAmIG5leHRDb2RlICsgZWFybHlDaGFuZ2UgLSAxID8gY29kZUxlbmd0aCA6IE1hdGgubWluKE1hdGgubG9nKG5leHRDb2RlICsgZWFybHlDaGFuZ2UpIC8gMC42OTMxNDcxODA1NTk5NDUzICsgMSwgMTIpIHwgMDsKICAgICAgfQogICAgICBwcmV2Q29kZSA9IGNvZGU7CiAgICAgIGRlY29kZWRMZW5ndGggKz0gY3VycmVudFNlcXVlbmNlTGVuZ3RoOwogICAgICBpZiAoZXN0aW1hdGVkRGVjb2RlZFNpemUgPCBkZWNvZGVkTGVuZ3RoKSB7CiAgICAgICAgZG8gewogICAgICAgICAgZXN0aW1hdGVkRGVjb2RlZFNpemUgKz0gZGVjb2RlZFNpemVEZWx0YTsKICAgICAgICB9IHdoaWxlIChlc3RpbWF0ZWREZWNvZGVkU2l6ZSA8IGRlY29kZWRMZW5ndGgpOwogICAgICAgIGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKHRoaXMuYnVmZmVyTGVuZ3RoICsgZXN0aW1hdGVkRGVjb2RlZFNpemUpOwogICAgICB9CiAgICAgIGZvciAoaiA9IDA7IGogPCBjdXJyZW50U2VxdWVuY2VMZW5ndGg7IGorKykgewogICAgICAgIGJ1ZmZlcltjdXJyZW50QnVmZmVyTGVuZ3RoKytdID0gY3VycmVudFNlcXVlbmNlW2pdOwogICAgICB9CiAgICB9CiAgICBsendTdGF0ZS5uZXh0Q29kZSA9IG5leHRDb2RlOwogICAgbHp3U3RhdGUuY29kZUxlbmd0aCA9IGNvZGVMZW5ndGg7CiAgICBsendTdGF0ZS5wcmV2Q29kZSA9IHByZXZDb2RlOwogICAgbHp3U3RhdGUuY3VycmVudFNlcXVlbmNlTGVuZ3RoID0gY3VycmVudFNlcXVlbmNlTGVuZ3RoOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSBjdXJyZW50QnVmZmVyTGVuZ3RoOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvcHJlZGljdG9yX3N0cmVhbS5qcwoKCgpjbGFzcyBQcmVkaWN0b3JTdHJlYW0gZXh0ZW5kcyBEZWNvZGVTdHJlYW0gewogIGNvbnN0cnVjdG9yKHN0ciwgbWF5YmVMZW5ndGgsIHBhcmFtcykgewogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgaWYgKCEocGFyYW1zIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuIHN0cjsKICAgIH0KICAgIGNvbnN0IHByZWRpY3RvciA9IHRoaXMucHJlZGljdG9yID0gcGFyYW1zLmdldCgiUHJlZGljdG9yIikgfHwgMTsKICAgIGlmIChwcmVkaWN0b3IgPD0gMSkgewogICAgICByZXR1cm4gc3RyOwogICAgfQogICAgaWYgKHByZWRpY3RvciAhPT0gMiAmJiAocHJlZGljdG9yIDwgMTAgfHwgcHJlZGljdG9yID4gMTUpKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgVW5zdXBwb3J0ZWQgcHJlZGljdG9yOiAke3ByZWRpY3Rvcn1gKTsKICAgIH0KICAgIHRoaXMucmVhZEJsb2NrID0gcHJlZGljdG9yID09PSAyID8gdGhpcy5yZWFkQmxvY2tUaWZmIDogdGhpcy5yZWFkQmxvY2tQbmc7CiAgICB0aGlzLnN0ciA9IHN0cjsKICAgIHRoaXMuZGljdCA9IHN0ci5kaWN0OwogICAgY29uc3QgY29sb3JzID0gdGhpcy5jb2xvcnMgPSBwYXJhbXMuZ2V0KCJDb2xvcnMiKSB8fCAxOwogICAgY29uc3QgYml0cyA9IHRoaXMuYml0cyA9IHBhcmFtcy5nZXQoIkJQQyIsICJCaXRzUGVyQ29tcG9uZW50IikgfHwgODsKICAgIGNvbnN0IGNvbHVtbnMgPSB0aGlzLmNvbHVtbnMgPSBwYXJhbXMuZ2V0KCJDb2x1bW5zIikgfHwgMTsKICAgIHRoaXMucGl4Qnl0ZXMgPSBjb2xvcnMgKiBiaXRzICsgNyA+PiAzOwogICAgdGhpcy5yb3dCeXRlcyA9IGNvbHVtbnMgKiBjb2xvcnMgKiBiaXRzICsgNyA+PiAzOwogICAgcmV0dXJuIHRoaXM7CiAgfQogIHJlYWRCbG9ja1RpZmYoKSB7CiAgICBjb25zdCByb3dCeXRlcyA9IHRoaXMucm93Qnl0ZXM7CiAgICBjb25zdCBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKGJ1ZmZlckxlbmd0aCArIHJvd0J5dGVzKTsKICAgIGNvbnN0IGJpdHMgPSB0aGlzLmJpdHM7CiAgICBjb25zdCBjb2xvcnMgPSB0aGlzLmNvbG9yczsKICAgIGNvbnN0IHJhd0J5dGVzID0gdGhpcy5zdHIuZ2V0Qnl0ZXMocm93Qnl0ZXMpOwogICAgdGhpcy5lb2YgPSAhcmF3Qnl0ZXMubGVuZ3RoOwogICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBpbmJ1ZiA9IDAsCiAgICAgIG91dGJ1ZiA9IDA7CiAgICBsZXQgaW5iaXRzID0gMCwKICAgICAgb3V0Yml0cyA9IDA7CiAgICBsZXQgcG9zID0gYnVmZmVyTGVuZ3RoOwogICAgbGV0IGk7CiAgICBpZiAoYml0cyA9PT0gMSAmJiBjb2xvcnMgPT09IDEpIHsKICAgICAgZm9yIChpID0gMDsgaSA8IHJvd0J5dGVzOyArK2kpIHsKICAgICAgICBsZXQgYyA9IHJhd0J5dGVzW2ldIF4gaW5idWY7CiAgICAgICAgYyBePSBjID4+IDE7CiAgICAgICAgYyBePSBjID4+IDI7CiAgICAgICAgYyBePSBjID4+IDQ7CiAgICAgICAgaW5idWYgPSAoYyAmIDEpIDw8IDc7CiAgICAgICAgYnVmZmVyW3BvcysrXSA9IGM7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoYml0cyA9PT0gOCkgewogICAgICBmb3IgKGkgPSAwOyBpIDwgY29sb3JzOyArK2kpIHsKICAgICAgICBidWZmZXJbcG9zKytdID0gcmF3Qnl0ZXNbaV07CiAgICAgIH0KICAgICAgZm9yICg7IGkgPCByb3dCeXRlczsgKytpKSB7CiAgICAgICAgYnVmZmVyW3Bvc10gPSBidWZmZXJbcG9zIC0gY29sb3JzXSArIHJhd0J5dGVzW2ldOwogICAgICAgIHBvcysrOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGJpdHMgPT09IDE2KSB7CiAgICAgIGNvbnN0IGJ5dGVzUGVyUGl4ZWwgPSBjb2xvcnMgKiAyOwogICAgICBmb3IgKGkgPSAwOyBpIDwgYnl0ZXNQZXJQaXhlbDsgKytpKSB7CiAgICAgICAgYnVmZmVyW3BvcysrXSA9IHJhd0J5dGVzW2ldOwogICAgICB9CiAgICAgIGZvciAoOyBpIDwgcm93Qnl0ZXM7IGkgKz0gMikgewogICAgICAgIGNvbnN0IHN1bSA9ICgocmF3Qnl0ZXNbaV0gJiAweGZmKSA8PCA4KSArIChyYXdCeXRlc1tpICsgMV0gJiAweGZmKSArICgoYnVmZmVyW3BvcyAtIGJ5dGVzUGVyUGl4ZWxdICYgMHhmZikgPDwgOCkgKyAoYnVmZmVyW3BvcyAtIGJ5dGVzUGVyUGl4ZWwgKyAxXSAmIDB4ZmYpOwogICAgICAgIGJ1ZmZlcltwb3MrK10gPSBzdW0gPj4gOCAmIDB4ZmY7CiAgICAgICAgYnVmZmVyW3BvcysrXSA9IHN1bSAmIDB4ZmY7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGNvbXBBcnJheSA9IG5ldyBVaW50OEFycmF5KGNvbG9ycyArIDEpOwogICAgICBjb25zdCBiaXRNYXNrID0gKDEgPDwgYml0cykgLSAxOwogICAgICBsZXQgaiA9IDAsCiAgICAgICAgayA9IGJ1ZmZlckxlbmd0aDsKICAgICAgY29uc3QgY29sdW1ucyA9IHRoaXMuY29sdW1uczsKICAgICAgZm9yIChpID0gMDsgaSA8IGNvbHVtbnM7ICsraSkgewogICAgICAgIGZvciAobGV0IGtrID0gMDsga2sgPCBjb2xvcnM7ICsra2spIHsKICAgICAgICAgIGlmIChpbmJpdHMgPCBiaXRzKSB7CiAgICAgICAgICAgIGluYnVmID0gaW5idWYgPDwgOCB8IHJhd0J5dGVzW2orK10gJiAweGZmOwogICAgICAgICAgICBpbmJpdHMgKz0gODsKICAgICAgICAgIH0KICAgICAgICAgIGNvbXBBcnJheVtra10gPSBjb21wQXJyYXlba2tdICsgKGluYnVmID4+IGluYml0cyAtIGJpdHMpICYgYml0TWFzazsKICAgICAgICAgIGluYml0cyAtPSBiaXRzOwogICAgICAgICAgb3V0YnVmID0gb3V0YnVmIDw8IGJpdHMgfCBjb21wQXJyYXlba2tdOwogICAgICAgICAgb3V0Yml0cyArPSBiaXRzOwogICAgICAgICAgaWYgKG91dGJpdHMgPj0gOCkgewogICAgICAgICAgICBidWZmZXJbaysrXSA9IG91dGJ1ZiA+PiBvdXRiaXRzIC0gOCAmIDB4ZmY7CiAgICAgICAgICAgIG91dGJpdHMgLT0gODsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKG91dGJpdHMgPiAwKSB7CiAgICAgICAgYnVmZmVyW2srK10gPSAob3V0YnVmIDw8IDggLSBvdXRiaXRzKSArIChpbmJ1ZiAmICgxIDw8IDggLSBvdXRiaXRzKSAtIDEpOwogICAgICB9CiAgICB9CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCArPSByb3dCeXRlczsKICB9CiAgcmVhZEJsb2NrUG5nKCkgewogICAgY29uc3Qgcm93Qnl0ZXMgPSB0aGlzLnJvd0J5dGVzOwogICAgY29uc3QgcGl4Qnl0ZXMgPSB0aGlzLnBpeEJ5dGVzOwogICAgY29uc3QgcHJlZGljdG9yID0gdGhpcy5zdHIuZ2V0Qnl0ZSgpOwogICAgY29uc3QgcmF3Qnl0ZXMgPSB0aGlzLnN0ci5nZXRCeXRlcyhyb3dCeXRlcyk7CiAgICB0aGlzLmVvZiA9ICFyYXdCeXRlcy5sZW5ndGg7CiAgICBpZiAodGhpcy5lb2YpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJMZW5ndGg7CiAgICBjb25zdCBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihidWZmZXJMZW5ndGggKyByb3dCeXRlcyk7CiAgICBsZXQgcHJldlJvdyA9IGJ1ZmZlci5zdWJhcnJheShidWZmZXJMZW5ndGggLSByb3dCeXRlcywgYnVmZmVyTGVuZ3RoKTsKICAgIGlmIChwcmV2Um93Lmxlbmd0aCA9PT0gMCkgewogICAgICBwcmV2Um93ID0gbmV3IFVpbnQ4QXJyYXkocm93Qnl0ZXMpOwogICAgfQogICAgbGV0IGksCiAgICAgIGogPSBidWZmZXJMZW5ndGgsCiAgICAgIHVwLAogICAgICBjOwogICAgc3dpdGNoIChwcmVkaWN0b3IpIHsKICAgICAgY2FzZSAwOgogICAgICAgIGZvciAoaSA9IDA7IGkgPCByb3dCeXRlczsgKytpKSB7CiAgICAgICAgICBidWZmZXJbaisrXSA9IHJhd0J5dGVzW2ldOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAxOgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwaXhCeXRlczsgKytpKSB7CiAgICAgICAgICBidWZmZXJbaisrXSA9IHJhd0J5dGVzW2ldOwogICAgICAgIH0KICAgICAgICBmb3IgKDsgaSA8IHJvd0J5dGVzOyArK2kpIHsKICAgICAgICAgIGJ1ZmZlcltqXSA9IGJ1ZmZlcltqIC0gcGl4Qnl0ZXNdICsgcmF3Qnl0ZXNbaV0gJiAweGZmOwogICAgICAgICAgaisrOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAyOgogICAgICAgIGZvciAoaSA9IDA7IGkgPCByb3dCeXRlczsgKytpKSB7CiAgICAgICAgICBidWZmZXJbaisrXSA9IHByZXZSb3dbaV0gKyByYXdCeXRlc1tpXSAmIDB4ZmY7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDM6CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBpeEJ5dGVzOyArK2kpIHsKICAgICAgICAgIGJ1ZmZlcltqKytdID0gKHByZXZSb3dbaV0gPj4gMSkgKyByYXdCeXRlc1tpXTsKICAgICAgICB9CiAgICAgICAgZm9yICg7IGkgPCByb3dCeXRlczsgKytpKSB7CiAgICAgICAgICBidWZmZXJbal0gPSAocHJldlJvd1tpXSArIGJ1ZmZlcltqIC0gcGl4Qnl0ZXNdID4+IDEpICsgcmF3Qnl0ZXNbaV0gJiAweGZmOwogICAgICAgICAgaisrOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSA0OgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwaXhCeXRlczsgKytpKSB7CiAgICAgICAgICB1cCA9IHByZXZSb3dbaV07CiAgICAgICAgICBjID0gcmF3Qnl0ZXNbaV07CiAgICAgICAgICBidWZmZXJbaisrXSA9IHVwICsgYzsKICAgICAgICB9CiAgICAgICAgZm9yICg7IGkgPCByb3dCeXRlczsgKytpKSB7CiAgICAgICAgICB1cCA9IHByZXZSb3dbaV07CiAgICAgICAgICBjb25zdCB1cExlZnQgPSBwcmV2Um93W2kgLSBwaXhCeXRlc107CiAgICAgICAgICBjb25zdCBsZWZ0ID0gYnVmZmVyW2ogLSBwaXhCeXRlc107CiAgICAgICAgICBjb25zdCBwID0gbGVmdCArIHVwIC0gdXBMZWZ0OwogICAgICAgICAgbGV0IHBhID0gcCAtIGxlZnQ7CiAgICAgICAgICBpZiAocGEgPCAwKSB7CiAgICAgICAgICAgIHBhID0gLXBhOwogICAgICAgICAgfQogICAgICAgICAgbGV0IHBiID0gcCAtIHVwOwogICAgICAgICAgaWYgKHBiIDwgMCkgewogICAgICAgICAgICBwYiA9IC1wYjsKICAgICAgICAgIH0KICAgICAgICAgIGxldCBwYyA9IHAgLSB1cExlZnQ7CiAgICAgICAgICBpZiAocGMgPCAwKSB7CiAgICAgICAgICAgIHBjID0gLXBjOwogICAgICAgICAgfQogICAgICAgICAgYyA9IHJhd0J5dGVzW2ldOwogICAgICAgICAgaWYgKHBhIDw9IHBiICYmIHBhIDw9IHBjKSB7CiAgICAgICAgICAgIGJ1ZmZlcltqKytdID0gbGVmdCArIGM7CiAgICAgICAgICB9IGVsc2UgaWYgKHBiIDw9IHBjKSB7CiAgICAgICAgICAgIGJ1ZmZlcltqKytdID0gdXAgKyBjOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnVmZmVyW2orK10gPSB1cExlZnQgKyBjOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYFVuc3VwcG9ydGVkIHByZWRpY3RvcjogJHtwcmVkaWN0b3J9YCk7CiAgICB9CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCArPSByb3dCeXRlczsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3J1bl9sZW5ndGhfc3RyZWFtLmpzCgpjbGFzcyBSdW5MZW5ndGhTdHJlYW0gZXh0ZW5kcyBEZWNvZGVTdHJlYW0gewogIGNvbnN0cnVjdG9yKHN0ciwgbWF5YmVMZW5ndGgpIHsKICAgIHN1cGVyKG1heWJlTGVuZ3RoKTsKICAgIHRoaXMuc3RyID0gc3RyOwogICAgdGhpcy5kaWN0ID0gc3RyLmRpY3Q7CiAgfQogIHJlYWRCbG9jaygpIHsKICAgIGNvbnN0IHJlcGVhdEhlYWRlciA9IHRoaXMuc3RyLmdldEJ5dGVzKDIpOwogICAgaWYgKCFyZXBlYXRIZWFkZXIgfHwgcmVwZWF0SGVhZGVyLmxlbmd0aCA8IDIgfHwgcmVwZWF0SGVhZGVyWzBdID09PSAxMjgpIHsKICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgYnVmZmVyOwogICAgbGV0IGJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgbGV0IG4gPSByZXBlYXRIZWFkZXJbMF07CiAgICBpZiAobiA8IDEyOCkgewogICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihidWZmZXJMZW5ndGggKyBuICsgMSk7CiAgICAgIGJ1ZmZlcltidWZmZXJMZW5ndGgrK10gPSByZXBlYXRIZWFkZXJbMV07CiAgICAgIGlmIChuID4gMCkgewogICAgICAgIGNvbnN0IHNvdXJjZSA9IHRoaXMuc3RyLmdldEJ5dGVzKG4pOwogICAgICAgIGJ1ZmZlci5zZXQoc291cmNlLCBidWZmZXJMZW5ndGgpOwogICAgICAgIGJ1ZmZlckxlbmd0aCArPSBuOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBuID0gMjU3IC0gbjsKICAgICAgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoYnVmZmVyTGVuZ3RoICsgbiArIDEpOwogICAgICBidWZmZXIuZmlsbChyZXBlYXRIZWFkZXJbMV0sIGJ1ZmZlckxlbmd0aCwgYnVmZmVyTGVuZ3RoICsgbik7CiAgICAgIGJ1ZmZlckxlbmd0aCArPSBuOwogICAgfQogICAgdGhpcy5idWZmZXJMZW5ndGggPSBidWZmZXJMZW5ndGg7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9wYXJzZXIuanMKCgoKCgoKCgoKCgoKCgpjb25zdCBNQVhfTEVOR1RIX1RPX0NBQ0hFID0gMTAwMDsKZnVuY3Rpb24gZ2V0SW5saW5lSW1hZ2VDYWNoZUtleShieXRlcykgewogIGNvbnN0IHN0ckJ1ZiA9IFtdLAogICAgaWkgPSBieXRlcy5sZW5ndGg7CiAgbGV0IGkgPSAwOwogIHdoaWxlIChpIDwgaWkgLSAxKSB7CiAgICBzdHJCdWYucHVzaChieXRlc1tpKytdIDw8IDggfCBieXRlc1tpKytdKTsKICB9CiAgaWYgKGkgPCBpaSkgewogICAgc3RyQnVmLnB1c2goYnl0ZXNbaV0pOwogIH0KICByZXR1cm4gaWkgKyAiXyIgKyBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIHN0ckJ1Zik7Cn0KY2xhc3MgUGFyc2VyIHsKICBjb25zdHJ1Y3Rvcih7CiAgICBsZXhlciwKICAgIHhyZWYsCiAgICBhbGxvd1N0cmVhbXMgPSBmYWxzZSwKICAgIHJlY292ZXJ5TW9kZSA9IGZhbHNlCiAgfSkgewogICAgdGhpcy5sZXhlciA9IGxleGVyOwogICAgdGhpcy54cmVmID0geHJlZjsKICAgIHRoaXMuYWxsb3dTdHJlYW1zID0gYWxsb3dTdHJlYW1zOwogICAgdGhpcy5yZWNvdmVyeU1vZGUgPSByZWNvdmVyeU1vZGU7CiAgICB0aGlzLmltYWdlQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgdGhpcy5faW1hZ2VJZCA9IDA7CiAgICB0aGlzLnJlZmlsbCgpOwogIH0KICByZWZpbGwoKSB7CiAgICB0aGlzLmJ1ZjEgPSB0aGlzLmxleGVyLmdldE9iaigpOwogICAgdGhpcy5idWYyID0gdGhpcy5sZXhlci5nZXRPYmooKTsKICB9CiAgc2hpZnQoKSB7CiAgICBpZiAodGhpcy5idWYyIGluc3RhbmNlb2YgQ21kICYmIHRoaXMuYnVmMi5jbWQgPT09ICJJRCIpIHsKICAgICAgdGhpcy5idWYxID0gdGhpcy5idWYyOwogICAgICB0aGlzLmJ1ZjIgPSBudWxsOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5idWYxID0gdGhpcy5idWYyOwogICAgICB0aGlzLmJ1ZjIgPSB0aGlzLmxleGVyLmdldE9iaigpOwogICAgfQogIH0KICB0cnlTaGlmdCgpIHsKICAgIHRyeSB7CiAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGlmIChlIGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBlOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9CiAgZ2V0T2JqKGNpcGhlclRyYW5zZm9ybSA9IG51bGwpIHsKICAgIGNvbnN0IGJ1ZjEgPSB0aGlzLmJ1ZjE7CiAgICB0aGlzLnNoaWZ0KCk7CiAgICBpZiAoYnVmMSBpbnN0YW5jZW9mIENtZCkgewogICAgICBzd2l0Y2ggKGJ1ZjEuY21kKSB7CiAgICAgICAgY2FzZSAiQkkiOgogICAgICAgICAgcmV0dXJuIHRoaXMubWFrZUlubGluZUltYWdlKGNpcGhlclRyYW5zZm9ybSk7CiAgICAgICAgY2FzZSAiWyI6CiAgICAgICAgICBjb25zdCBhcnJheSA9IFtdOwogICAgICAgICAgd2hpbGUgKCFpc0NtZCh0aGlzLmJ1ZjEsICJdIikgJiYgdGhpcy5idWYxICE9PSBFT0YpIHsKICAgICAgICAgICAgYXJyYXkucHVzaCh0aGlzLmdldE9iaihjaXBoZXJUcmFuc2Zvcm0pKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmJ1ZjEgPT09IEVPRikgewogICAgICAgICAgICBpZiAodGhpcy5yZWNvdmVyeU1vZGUpIHsKICAgICAgICAgICAgICByZXR1cm4gYXJyYXk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgbmV3IFBhcnNlckVPRkV4Y2VwdGlvbigiRW5kIG9mIGZpbGUgaW5zaWRlIGFycmF5LiIpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5zaGlmdCgpOwogICAgICAgICAgcmV0dXJuIGFycmF5OwogICAgICAgIGNhc2UgIjw8IjoKICAgICAgICAgIGNvbnN0IGRpY3QgPSBuZXcgRGljdCh0aGlzLnhyZWYpOwogICAgICAgICAgd2hpbGUgKCFpc0NtZCh0aGlzLmJ1ZjEsICI+PiIpICYmIHRoaXMuYnVmMSAhPT0gRU9GKSB7CiAgICAgICAgICAgIGlmICghKHRoaXMuYnVmMSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgICAgICAgaW5mbygiTWFsZm9ybWVkIGRpY3Rpb25hcnk6IGtleSBtdXN0IGJlIGEgbmFtZSBvYmplY3QiKTsKICAgICAgICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3Qga2V5ID0gdGhpcy5idWYxLm5hbWU7CiAgICAgICAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgICAgICAgaWYgKHRoaXMuYnVmMSA9PT0gRU9GKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGljdC5zZXQoa2V5LCB0aGlzLmdldE9iaihjaXBoZXJUcmFuc2Zvcm0pKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmJ1ZjEgPT09IEVPRikgewogICAgICAgICAgICBpZiAodGhpcy5yZWNvdmVyeU1vZGUpIHsKICAgICAgICAgICAgICByZXR1cm4gZGljdDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBuZXcgUGFyc2VyRU9GRXhjZXB0aW9uKCJFbmQgb2YgZmlsZSBpbnNpZGUgZGljdGlvbmFyeS4iKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpc0NtZCh0aGlzLmJ1ZjIsICJzdHJlYW0iKSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5hbGxvd1N0cmVhbXMgPyB0aGlzLm1ha2VTdHJlYW0oZGljdCwgY2lwaGVyVHJhbnNmb3JtKSA6IGRpY3Q7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgICByZXR1cm4gZGljdDsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIGJ1ZjE7CiAgICAgIH0KICAgIH0KICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGJ1ZjEpKSB7CiAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKHRoaXMuYnVmMSkgJiYgaXNDbWQodGhpcy5idWYyLCAiUiIpKSB7CiAgICAgICAgY29uc3QgcmVmID0gUmVmLmdldChidWYxLCB0aGlzLmJ1ZjEpOwogICAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgcmV0dXJuIHJlZjsKICAgICAgfQogICAgICByZXR1cm4gYnVmMTsKICAgIH0KICAgIGlmICh0eXBlb2YgYnVmMSA9PT0gInN0cmluZyIpIHsKICAgICAgaWYgKGNpcGhlclRyYW5zZm9ybSkgewogICAgICAgIHJldHVybiBjaXBoZXJUcmFuc2Zvcm0uZGVjcnlwdFN0cmluZyhidWYxKTsKICAgICAgfQogICAgICByZXR1cm4gYnVmMTsKICAgIH0KICAgIHJldHVybiBidWYxOwogIH0KICBmaW5kRGVmYXVsdElubGluZVN0cmVhbUVuZChzdHJlYW0pIHsKICAgIGNvbnN0IEUgPSAweDQ1LAogICAgICBJID0gMHg0OSwKICAgICAgU1BBQ0UgPSAweDIwLAogICAgICBMRiA9IDB4YSwKICAgICAgQ1IgPSAweGQsCiAgICAgIE5VTCA9IDB4MDsKICAgIGNvbnN0IHsKICAgICAgICBrbm93bkNvbW1hbmRzCiAgICAgIH0gPSB0aGlzLmxleGVyLAogICAgICBzdGFydFBvcyA9IHN0cmVhbS5wb3MsCiAgICAgIG4gPSAxNTsKICAgIGxldCBzdGF0ZSA9IDAsCiAgICAgIGNoLAogICAgICBtYXliZUVJUG9zOwogICAgd2hpbGUgKChjaCA9IHN0cmVhbS5nZXRCeXRlKCkpICE9PSAtMSkgewogICAgICBpZiAoc3RhdGUgPT09IDApIHsKICAgICAgICBzdGF0ZSA9IGNoID09PSBFID8gMSA6IDA7CiAgICAgIH0gZWxzZSBpZiAoc3RhdGUgPT09IDEpIHsKICAgICAgICBzdGF0ZSA9IGNoID09PSBJID8gMiA6IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGNoID09PSBTUEFDRSB8fCBjaCA9PT0gTEYgfHwgY2ggPT09IENSKSB7CiAgICAgICAgICBtYXliZUVJUG9zID0gc3RyZWFtLnBvczsKICAgICAgICAgIGNvbnN0IGZvbGxvd2luZ0J5dGVzID0gc3RyZWFtLnBlZWtCeXRlcyhuKTsKICAgICAgICAgIGNvbnN0IGlpID0gZm9sbG93aW5nQnl0ZXMubGVuZ3RoOwogICAgICAgICAgaWYgKGlpID09PSAwKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIGNoID0gZm9sbG93aW5nQnl0ZXNbaV07CiAgICAgICAgICAgIGlmIChjaCA9PT0gTlVMICYmIGZvbGxvd2luZ0J5dGVzW2kgKyAxXSAhPT0gTlVMKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNoICE9PSBMRiAmJiBjaCAhPT0gQ1IgJiYgKGNoIDwgU1BBQ0UgfHwgY2ggPiAweDdmKSkgewogICAgICAgICAgICAgIHN0YXRlID0gMDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXRlICE9PSAyKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFrbm93bkNvbW1hbmRzKSB7CiAgICAgICAgICAgIHdhcm4oImZpbmREZWZhdWx0SW5saW5lU3RyZWFtRW5kIC0gYGxleGVyLmtub3duQ29tbWFuZHNgIGlzIHVuZGVmaW5lZC4iKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCB0bXBMZXhlciA9IG5ldyBMZXhlcihuZXcgU3RyZWFtKHN0cmVhbS5wZWVrQnl0ZXMoNSAqIG4pKSwga25vd25Db21tYW5kcyk7CiAgICAgICAgICB0bXBMZXhlci5faGV4U3RyaW5nV2FybiA9ICgpID0+IHt9OwogICAgICAgICAgbGV0IG51bUFyZ3MgPSAwOwogICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgY29uc3QgbmV4dE9iaiA9IHRtcExleGVyLmdldE9iaigpOwogICAgICAgICAgICBpZiAobmV4dE9iaiA9PT0gRU9GKSB7CiAgICAgICAgICAgICAgc3RhdGUgPSAwOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChuZXh0T2JqIGluc3RhbmNlb2YgQ21kKSB7CiAgICAgICAgICAgICAgY29uc3Qga25vd25Db21tYW5kID0ga25vd25Db21tYW5kc1tuZXh0T2JqLmNtZF07CiAgICAgICAgICAgICAgaWYgKCFrbm93bkNvbW1hbmQpIHsKICAgICAgICAgICAgICAgIHN0YXRlID0gMDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoa25vd25Db21tYW5kLnZhcmlhYmxlQXJncyA/IG51bUFyZ3MgPD0ga25vd25Db21tYW5kLm51bUFyZ3MgOiBudW1BcmdzID09PSBrbm93bkNvbW1hbmQubnVtQXJncykgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIG51bUFyZ3MgPSAwOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG51bUFyZ3MrKzsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdGF0ZSA9PT0gMikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RhdGUgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKGNoID09PSAtMSkgewogICAgICB3YXJuKCJmaW5kRGVmYXVsdElubGluZVN0cmVhbUVuZDogIiArICJSZWFjaGVkIHRoZSBlbmQgb2YgdGhlIHN0cmVhbSB3aXRob3V0IGZpbmRpbmcgYSB2YWxpZCBFSSBtYXJrZXIiKTsKICAgICAgaWYgKG1heWJlRUlQb3MpIHsKICAgICAgICB3YXJuKCcuLi4gdHJ5aW5nIHRvIHJlY292ZXIgYnkgdXNpbmcgdGhlIGxhc3QgIkVJIiBvY2N1cnJlbmNlLicpOwogICAgICAgIHN0cmVhbS5za2lwKC0oc3RyZWFtLnBvcyAtIG1heWJlRUlQb3MpKTsKICAgICAgfQogICAgfQogICAgbGV0IGVuZE9mZnNldCA9IDQ7CiAgICBzdHJlYW0uc2tpcCgtZW5kT2Zmc2V0KTsKICAgIGNoID0gc3RyZWFtLnBlZWtCeXRlKCk7CiAgICBzdHJlYW0uc2tpcChlbmRPZmZzZXQpOwogICAgaWYgKCFpc1doaXRlU3BhY2UoY2gpKSB7CiAgICAgIGVuZE9mZnNldC0tOwogICAgfQogICAgcmV0dXJuIHN0cmVhbS5wb3MgLSBlbmRPZmZzZXQgLSBzdGFydFBvczsKICB9CiAgZmluZERDVERlY29kZUlubGluZVN0cmVhbUVuZChzdHJlYW0pIHsKICAgIGNvbnN0IHN0YXJ0UG9zID0gc3RyZWFtLnBvczsKICAgIGxldCBmb3VuZEVPSSA9IGZhbHNlLAogICAgICBiLAogICAgICBtYXJrZXJMZW5ndGg7CiAgICB3aGlsZSAoKGIgPSBzdHJlYW0uZ2V0Qnl0ZSgpKSAhPT0gLTEpIHsKICAgICAgaWYgKGIgIT09IDB4ZmYpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBzd2l0Y2ggKHN0cmVhbS5nZXRCeXRlKCkpIHsKICAgICAgICBjYXNlIDB4MDA6CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4ZmY6CiAgICAgICAgICBzdHJlYW0uc2tpcCgtMSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4ZDk6CiAgICAgICAgICBmb3VuZEVPSSA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4YzA6CiAgICAgICAgY2FzZSAweGMxOgogICAgICAgIGNhc2UgMHhjMjoKICAgICAgICBjYXNlIDB4YzM6CiAgICAgICAgY2FzZSAweGM1OgogICAgICAgIGNhc2UgMHhjNjoKICAgICAgICBjYXNlIDB4Yzc6CiAgICAgICAgY2FzZSAweGM5OgogICAgICAgIGNhc2UgMHhjYToKICAgICAgICBjYXNlIDB4Y2I6CiAgICAgICAgY2FzZSAweGNkOgogICAgICAgIGNhc2UgMHhjZToKICAgICAgICBjYXNlIDB4Y2Y6CiAgICAgICAgY2FzZSAweGM0OgogICAgICAgIGNhc2UgMHhjYzoKICAgICAgICBjYXNlIDB4ZGE6CiAgICAgICAgY2FzZSAweGRiOgogICAgICAgIGNhc2UgMHhkYzoKICAgICAgICBjYXNlIDB4ZGQ6CiAgICAgICAgY2FzZSAweGRlOgogICAgICAgIGNhc2UgMHhkZjoKICAgICAgICBjYXNlIDB4ZTA6CiAgICAgICAgY2FzZSAweGUxOgogICAgICAgIGNhc2UgMHhlMjoKICAgICAgICBjYXNlIDB4ZTM6CiAgICAgICAgY2FzZSAweGU0OgogICAgICAgIGNhc2UgMHhlNToKICAgICAgICBjYXNlIDB4ZTY6CiAgICAgICAgY2FzZSAweGU3OgogICAgICAgIGNhc2UgMHhlODoKICAgICAgICBjYXNlIDB4ZTk6CiAgICAgICAgY2FzZSAweGVhOgogICAgICAgIGNhc2UgMHhlYjoKICAgICAgICBjYXNlIDB4ZWM6CiAgICAgICAgY2FzZSAweGVkOgogICAgICAgIGNhc2UgMHhlZToKICAgICAgICBjYXNlIDB4ZWY6CiAgICAgICAgY2FzZSAweGZlOgogICAgICAgICAgbWFya2VyTGVuZ3RoID0gc3RyZWFtLmdldFVpbnQxNigpOwogICAgICAgICAgaWYgKG1hcmtlckxlbmd0aCA+IDIpIHsKICAgICAgICAgICAgc3RyZWFtLnNraXAobWFya2VyTGVuZ3RoIC0gMik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdHJlYW0uc2tpcCgtMik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAoZm91bmRFT0kpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgY29uc3QgbGVuZ3RoID0gc3RyZWFtLnBvcyAtIHN0YXJ0UG9zOwogICAgaWYgKGIgPT09IC0xKSB7CiAgICAgIHdhcm4oIklubGluZSBEQ1REZWNvZGUgaW1hZ2Ugc3RyZWFtOiAiICsgIkVPSSBtYXJrZXIgbm90IGZvdW5kLCBzZWFyY2hpbmcgZm9yIC9FSS8gaW5zdGVhZC4iKTsKICAgICAgc3RyZWFtLnNraXAoLWxlbmd0aCk7CiAgICAgIHJldHVybiB0aGlzLmZpbmREZWZhdWx0SW5saW5lU3RyZWFtRW5kKHN0cmVhbSk7CiAgICB9CiAgICB0aGlzLmlubGluZVN0cmVhbVNraXBFSShzdHJlYW0pOwogICAgcmV0dXJuIGxlbmd0aDsKICB9CiAgZmluZEFTQ0lJODVEZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKSB7CiAgICBjb25zdCBUSUxERSA9IDB4N2UsCiAgICAgIEdUID0gMHgzZTsKICAgIGNvbnN0IHN0YXJ0UG9zID0gc3RyZWFtLnBvczsKICAgIGxldCBjaDsKICAgIHdoaWxlICgoY2ggPSBzdHJlYW0uZ2V0Qnl0ZSgpKSAhPT0gLTEpIHsKICAgICAgaWYgKGNoID09PSBUSUxERSkgewogICAgICAgIGNvbnN0IHRpbGRlUG9zID0gc3RyZWFtLnBvczsKICAgICAgICBjaCA9IHN0cmVhbS5wZWVrQnl0ZSgpOwogICAgICAgIHdoaWxlIChpc1doaXRlU3BhY2UoY2gpKSB7CiAgICAgICAgICBzdHJlYW0uc2tpcCgpOwogICAgICAgICAgY2ggPSBzdHJlYW0ucGVla0J5dGUoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNoID09PSBHVCkgewogICAgICAgICAgc3RyZWFtLnNraXAoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoc3RyZWFtLnBvcyA+IHRpbGRlUG9zKSB7CiAgICAgICAgICBjb25zdCBtYXliZUVJID0gc3RyZWFtLnBlZWtCeXRlcygyKTsKICAgICAgICAgIGlmIChtYXliZUVJWzBdID09PSAweDQ1ICYmIG1heWJlRUlbMV0gPT09IDB4NDkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBjb25zdCBsZW5ndGggPSBzdHJlYW0ucG9zIC0gc3RhcnRQb3M7CiAgICBpZiAoY2ggPT09IC0xKSB7CiAgICAgIHdhcm4oIklubGluZSBBU0NJSTg1RGVjb2RlIGltYWdlIHN0cmVhbTogIiArICJFT0QgbWFya2VyIG5vdCBmb3VuZCwgc2VhcmNoaW5nIGZvciAvRUkvIGluc3RlYWQuIik7CiAgICAgIHN0cmVhbS5za2lwKC1sZW5ndGgpOwogICAgICByZXR1cm4gdGhpcy5maW5kRGVmYXVsdElubGluZVN0cmVhbUVuZChzdHJlYW0pOwogICAgfQogICAgdGhpcy5pbmxpbmVTdHJlYW1Ta2lwRUkoc3RyZWFtKTsKICAgIHJldHVybiBsZW5ndGg7CiAgfQogIGZpbmRBU0NJSUhleERlY29kZUlubGluZVN0cmVhbUVuZChzdHJlYW0pIHsKICAgIGNvbnN0IEdUID0gMHgzZTsKICAgIGNvbnN0IHN0YXJ0UG9zID0gc3RyZWFtLnBvczsKICAgIGxldCBjaDsKICAgIHdoaWxlICgoY2ggPSBzdHJlYW0uZ2V0Qnl0ZSgpKSAhPT0gLTEpIHsKICAgICAgaWYgKGNoID09PSBHVCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBjb25zdCBsZW5ndGggPSBzdHJlYW0ucG9zIC0gc3RhcnRQb3M7CiAgICBpZiAoY2ggPT09IC0xKSB7CiAgICAgIHdhcm4oIklubGluZSBBU0NJSUhleERlY29kZSBpbWFnZSBzdHJlYW06ICIgKyAiRU9EIG1hcmtlciBub3QgZm91bmQsIHNlYXJjaGluZyBmb3IgL0VJLyBpbnN0ZWFkLiIpOwogICAgICBzdHJlYW0uc2tpcCgtbGVuZ3RoKTsKICAgICAgcmV0dXJuIHRoaXMuZmluZERlZmF1bHRJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKTsKICAgIH0KICAgIHRoaXMuaW5saW5lU3RyZWFtU2tpcEVJKHN0cmVhbSk7CiAgICByZXR1cm4gbGVuZ3RoOwogIH0KICBpbmxpbmVTdHJlYW1Ta2lwRUkoc3RyZWFtKSB7CiAgICBjb25zdCBFID0gMHg0NSwKICAgICAgSSA9IDB4NDk7CiAgICBsZXQgc3RhdGUgPSAwLAogICAgICBjaDsKICAgIHdoaWxlICgoY2ggPSBzdHJlYW0uZ2V0Qnl0ZSgpKSAhPT0gLTEpIHsKICAgICAgaWYgKHN0YXRlID09PSAwKSB7CiAgICAgICAgc3RhdGUgPSBjaCA9PT0gRSA/IDEgOiAwOwogICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSAxKSB7CiAgICAgICAgc3RhdGUgPSBjaCA9PT0gSSA/IDIgOiAwOwogICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSAyKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9CiAgbWFrZUlubGluZUltYWdlKGNpcGhlclRyYW5zZm9ybSkgewogICAgY29uc3QgbGV4ZXIgPSB0aGlzLmxleGVyOwogICAgY29uc3Qgc3RyZWFtID0gbGV4ZXIuc3RyZWFtOwogICAgY29uc3QgZGljdE1hcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBsZXQgZGljdExlbmd0aDsKICAgIHdoaWxlICghaXNDbWQodGhpcy5idWYxLCAiSUQiKSAmJiB0aGlzLmJ1ZjEgIT09IEVPRikgewogICAgICBpZiAoISh0aGlzLmJ1ZjEgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiRGljdGlvbmFyeSBrZXkgbXVzdCBiZSBhIG5hbWUgb2JqZWN0Iik7CiAgICAgIH0KICAgICAgY29uc3Qga2V5ID0gdGhpcy5idWYxLm5hbWU7CiAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgaWYgKHRoaXMuYnVmMSA9PT0gRU9GKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgZGljdE1hcFtrZXldID0gdGhpcy5nZXRPYmooY2lwaGVyVHJhbnNmb3JtKTsKICAgIH0KICAgIGlmIChsZXhlci5iZWdpbklubGluZUltYWdlUG9zICE9PSAtMSkgewogICAgICBkaWN0TGVuZ3RoID0gc3RyZWFtLnBvcyAtIGxleGVyLmJlZ2luSW5saW5lSW1hZ2VQb3M7CiAgICB9CiAgICBjb25zdCBmaWx0ZXIgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihkaWN0TWFwLkYgfHwgZGljdE1hcC5GaWx0ZXIpOwogICAgbGV0IGZpbHRlck5hbWU7CiAgICBpZiAoZmlsdGVyIGluc3RhbmNlb2YgTmFtZSkgewogICAgICBmaWx0ZXJOYW1lID0gZmlsdGVyLm5hbWU7CiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZmlsdGVyKSkgewogICAgICBjb25zdCBmaWx0ZXJaZXJvID0gdGhpcy54cmVmLmZldGNoSWZSZWYoZmlsdGVyWzBdKTsKICAgICAgaWYgKGZpbHRlclplcm8gaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgZmlsdGVyTmFtZSA9IGZpbHRlclplcm8ubmFtZTsKICAgICAgfQogICAgfQogICAgY29uc3Qgc3RhcnRQb3MgPSBzdHJlYW0ucG9zOwogICAgbGV0IGxlbmd0aDsKICAgIHN3aXRjaCAoZmlsdGVyTmFtZSkgewogICAgICBjYXNlICJEQ1QiOgogICAgICBjYXNlICJEQ1REZWNvZGUiOgogICAgICAgIGxlbmd0aCA9IHRoaXMuZmluZERDVERlY29kZUlubGluZVN0cmVhbUVuZChzdHJlYW0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJBODUiOgogICAgICBjYXNlICJBU0NJSTg1RGVjb2RlIjoKICAgICAgICBsZW5ndGggPSB0aGlzLmZpbmRBU0NJSTg1RGVjb2RlSW5saW5lU3RyZWFtRW5kKHN0cmVhbSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIkFIeCI6CiAgICAgIGNhc2UgIkFTQ0lJSGV4RGVjb2RlIjoKICAgICAgICBsZW5ndGggPSB0aGlzLmZpbmRBU0NJSUhleERlY29kZUlubGluZVN0cmVhbUVuZChzdHJlYW0pOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGxlbmd0aCA9IHRoaXMuZmluZERlZmF1bHRJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKTsKICAgIH0KICAgIGxldCBjYWNoZUtleTsKICAgIGlmIChsZW5ndGggPCBNQVhfTEVOR1RIX1RPX0NBQ0hFICYmIGRpY3RMZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IGluaXRpYWxTdHJlYW1Qb3MgPSBzdHJlYW0ucG9zOwogICAgICBzdHJlYW0ucG9zID0gbGV4ZXIuYmVnaW5JbmxpbmVJbWFnZVBvczsKICAgICAgY2FjaGVLZXkgPSBnZXRJbmxpbmVJbWFnZUNhY2hlS2V5KHN0cmVhbS5nZXRCeXRlcyhkaWN0TGVuZ3RoICsgbGVuZ3RoKSk7CiAgICAgIHN0cmVhbS5wb3MgPSBpbml0aWFsU3RyZWFtUG9zOwogICAgICBjb25zdCBjYWNoZUVudHJ5ID0gdGhpcy5pbWFnZUNhY2hlW2NhY2hlS2V5XTsKICAgICAgaWYgKGNhY2hlRW50cnkgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuYnVmMiA9IENtZC5nZXQoIkVJIik7CiAgICAgICAgdGhpcy5zaGlmdCgpOwogICAgICAgIGNhY2hlRW50cnkucmVzZXQoKTsKICAgICAgICByZXR1cm4gY2FjaGVFbnRyeTsKICAgICAgfQogICAgfQogICAgY29uc3QgZGljdCA9IG5ldyBEaWN0KHRoaXMueHJlZik7CiAgICBmb3IgKGNvbnN0IGtleSBpbiBkaWN0TWFwKSB7CiAgICAgIGRpY3Quc2V0KGtleSwgZGljdE1hcFtrZXldKTsKICAgIH0KICAgIGxldCBpbWFnZVN0cmVhbSA9IHN0cmVhbS5tYWtlU3ViU3RyZWFtKHN0YXJ0UG9zLCBsZW5ndGgsIGRpY3QpOwogICAgaWYgKGNpcGhlclRyYW5zZm9ybSkgewogICAgICBpbWFnZVN0cmVhbSA9IGNpcGhlclRyYW5zZm9ybS5jcmVhdGVTdHJlYW0oaW1hZ2VTdHJlYW0sIGxlbmd0aCk7CiAgICB9CiAgICBpbWFnZVN0cmVhbSA9IHRoaXMuZmlsdGVyKGltYWdlU3RyZWFtLCBkaWN0LCBsZW5ndGgpOwogICAgaW1hZ2VTdHJlYW0uZGljdCA9IGRpY3Q7CiAgICBpZiAoY2FjaGVLZXkgIT09IHVuZGVmaW5lZCkgewogICAgICBpbWFnZVN0cmVhbS5jYWNoZUtleSA9IGBpbmxpbmVfaW1nXyR7Kyt0aGlzLl9pbWFnZUlkfWA7CiAgICAgIHRoaXMuaW1hZ2VDYWNoZVtjYWNoZUtleV0gPSBpbWFnZVN0cmVhbTsKICAgIH0KICAgIHRoaXMuYnVmMiA9IENtZC5nZXQoIkVJIik7CiAgICB0aGlzLnNoaWZ0KCk7CiAgICByZXR1cm4gaW1hZ2VTdHJlYW07CiAgfQogICNmaW5kU3RyZWFtTGVuZ3RoKHN0YXJ0UG9zKSB7CiAgICBjb25zdCB7CiAgICAgIHN0cmVhbQogICAgfSA9IHRoaXMubGV4ZXI7CiAgICBzdHJlYW0ucG9zID0gc3RhcnRQb3M7CiAgICBjb25zdCBTQ0FOX0JMT0NLX0xFTkdUSCA9IDIwNDg7CiAgICBjb25zdCBzaWduYXR1cmVMZW5ndGggPSAiZW5kc3RyZWFtIi5sZW5ndGg7CiAgICBjb25zdCBFTkRfU0lHTkFUVVJFID0gbmV3IFVpbnQ4QXJyYXkoWzB4NjUsIDB4NmUsIDB4NjRdKTsKICAgIGNvbnN0IGVuZExlbmd0aCA9IEVORF9TSUdOQVRVUkUubGVuZ3RoOwogICAgY29uc3QgUEFSVElBTF9TSUdOQVRVUkUgPSBbbmV3IFVpbnQ4QXJyYXkoWzB4NzMsIDB4NzQsIDB4NzIsIDB4NjUsIDB4NjEsIDB4NmRdKSwgbmV3IFVpbnQ4QXJyYXkoWzB4NzMsIDB4NzQsIDB4NjUsIDB4NjEsIDB4NmRdKSwgbmV3IFVpbnQ4QXJyYXkoWzB4NzMsIDB4NzQsIDB4NzIsIDB4NjUsIDB4NjFdKV07CiAgICBjb25zdCBub3JtYWxMZW5ndGggPSBzaWduYXR1cmVMZW5ndGggLSBlbmRMZW5ndGg7CiAgICB3aGlsZSAoc3RyZWFtLnBvcyA8IHN0cmVhbS5lbmQpIHsKICAgICAgY29uc3Qgc2NhbkJ5dGVzID0gc3RyZWFtLnBlZWtCeXRlcyhTQ0FOX0JMT0NLX0xFTkdUSCk7CiAgICAgIGNvbnN0IHNjYW5MZW5ndGggPSBzY2FuQnl0ZXMubGVuZ3RoIC0gc2lnbmF0dXJlTGVuZ3RoOwogICAgICBpZiAoc2Nhbkxlbmd0aCA8PSAwKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgbGV0IHBvcyA9IDA7CiAgICAgIHdoaWxlIChwb3MgPCBzY2FuTGVuZ3RoKSB7CiAgICAgICAgbGV0IGogPSAwOwogICAgICAgIHdoaWxlIChqIDwgZW5kTGVuZ3RoICYmIHNjYW5CeXRlc1twb3MgKyBqXSA9PT0gRU5EX1NJR05BVFVSRVtqXSkgewogICAgICAgICAgaisrOwogICAgICAgIH0KICAgICAgICBpZiAoaiA+PSBlbmRMZW5ndGgpIHsKICAgICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgZm9yIChjb25zdCBwYXJ0IG9mIFBBUlRJQUxfU0lHTkFUVVJFKSB7CiAgICAgICAgICAgIGNvbnN0IHBhcnRMZW4gPSBwYXJ0Lmxlbmd0aDsKICAgICAgICAgICAgbGV0IGsgPSAwOwogICAgICAgICAgICB3aGlsZSAoayA8IHBhcnRMZW4gJiYgc2NhbkJ5dGVzW3BvcyArIGogKyBrXSA9PT0gcGFydFtrXSkgewogICAgICAgICAgICAgIGsrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoayA+PSBub3JtYWxMZW5ndGgpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGsgPj0gcGFydExlbikgewogICAgICAgICAgICAgIGNvbnN0IGxhc3RCeXRlID0gc2NhbkJ5dGVzW3BvcyArIGogKyBrXTsKICAgICAgICAgICAgICBpZiAoaXNXaGl0ZVNwYWNlKGxhc3RCeXRlKSkgewogICAgICAgICAgICAgICAgaW5mbyhgRm91bmQgIiR7Ynl0ZXNUb1N0cmluZyhbLi4uRU5EX1NJR05BVFVSRSwgLi4ucGFydF0pfSIgd2hlbiBgICsgInNlYXJjaGluZyBmb3IgZW5kc3RyZWFtIGNvbW1hbmQuIik7CiAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZm91bmQpIHsKICAgICAgICAgICAgc3RyZWFtLnBvcyArPSBwb3M7CiAgICAgICAgICAgIHJldHVybiBzdHJlYW0ucG9zIC0gc3RhcnRQb3M7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHBvcysrOwogICAgICB9CiAgICAgIHN0cmVhbS5wb3MgKz0gc2Nhbkxlbmd0aDsKICAgIH0KICAgIHJldHVybiAtMTsKICB9CiAgbWFrZVN0cmVhbShkaWN0LCBjaXBoZXJUcmFuc2Zvcm0pIHsKICAgIGNvbnN0IGxleGVyID0gdGhpcy5sZXhlcjsKICAgIGxldCBzdHJlYW0gPSBsZXhlci5zdHJlYW07CiAgICBsZXhlci5za2lwVG9OZXh0TGluZSgpOwogICAgY29uc3Qgc3RhcnRQb3MgPSBzdHJlYW0ucG9zIC0gMTsKICAgIGxldCBsZW5ndGggPSBkaWN0LmdldCgiTGVuZ3RoIik7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIobGVuZ3RoKSkgewogICAgICBpbmZvKGBCYWQgbGVuZ3RoICIke2xlbmd0aCAmJiBsZW5ndGgudG9TdHJpbmcoKX0iIGluIHN0cmVhbS5gKTsKICAgICAgbGVuZ3RoID0gMDsKICAgIH0KICAgIHN0cmVhbS5wb3MgPSBzdGFydFBvcyArIGxlbmd0aDsKICAgIGxleGVyLm5leHRDaGFyKCk7CiAgICBpZiAodGhpcy50cnlTaGlmdCgpICYmIGlzQ21kKHRoaXMuYnVmMiwgImVuZHN0cmVhbSIpKSB7CiAgICAgIHRoaXMuc2hpZnQoKTsKICAgIH0gZWxzZSB7CiAgICAgIGxlbmd0aCA9IHRoaXMuI2ZpbmRTdHJlYW1MZW5ndGgoc3RhcnRQb3MpOwogICAgICBpZiAobGVuZ3RoIDwgMCkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTWlzc2luZyBlbmRzdHJlYW0gY29tbWFuZC4iKTsKICAgICAgfQogICAgICBsZXhlci5uZXh0Q2hhcigpOwogICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgIHRoaXMuc2hpZnQoKTsKICAgIH0KICAgIHRoaXMuc2hpZnQoKTsKICAgIHN0cmVhbSA9IHN0cmVhbS5tYWtlU3ViU3RyZWFtKHN0YXJ0UG9zLCBsZW5ndGgsIGRpY3QpOwogICAgaWYgKGNpcGhlclRyYW5zZm9ybSkgewogICAgICBzdHJlYW0gPSBjaXBoZXJUcmFuc2Zvcm0uY3JlYXRlU3RyZWFtKHN0cmVhbSwgbGVuZ3RoKTsKICAgIH0KICAgIHN0cmVhbSA9IHRoaXMuZmlsdGVyKHN0cmVhbSwgZGljdCwgbGVuZ3RoKTsKICAgIHN0cmVhbS5kaWN0ID0gZGljdDsKICAgIHJldHVybiBzdHJlYW07CiAgfQogIGZpbHRlcihzdHJlYW0sIGRpY3QsIGxlbmd0aCkgewogICAgbGV0IGZpbHRlciA9IGRpY3QuZ2V0KCJGIiwgIkZpbHRlciIpOwogICAgbGV0IHBhcmFtcyA9IGRpY3QuZ2V0KCJEUCIsICJEZWNvZGVQYXJtcyIpOwogICAgaWYgKGZpbHRlciBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGFyYW1zKSkgewogICAgICAgIHdhcm4oIi9EZWNvZGVQYXJtcyBzaG91bGQgbm90IGJlIGFuIEFycmF5LCB3aGVuIC9GaWx0ZXIgaXMgYSBOYW1lLiIpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLm1ha2VGaWx0ZXIoc3RyZWFtLCBmaWx0ZXIubmFtZSwgbGVuZ3RoLCBwYXJhbXMpOwogICAgfQogICAgbGV0IG1heWJlTGVuZ3RoID0gbGVuZ3RoOwogICAgaWYgKEFycmF5LmlzQXJyYXkoZmlsdGVyKSkgewogICAgICBjb25zdCBmaWx0ZXJBcnJheSA9IGZpbHRlcjsKICAgICAgY29uc3QgcGFyYW1zQXJyYXkgPSBwYXJhbXM7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGZpbHRlckFycmF5Lmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICBmaWx0ZXIgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihmaWx0ZXJBcnJheVtpXSk7CiAgICAgICAgaWYgKCEoZmlsdGVyIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgQmFkIGZpbHRlciBuYW1lICIke2ZpbHRlcn0iYCk7CiAgICAgICAgfQogICAgICAgIHBhcmFtcyA9IG51bGw7CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGFyYW1zQXJyYXkpICYmIGkgaW4gcGFyYW1zQXJyYXkpIHsKICAgICAgICAgIHBhcmFtcyA9IHRoaXMueHJlZi5mZXRjaElmUmVmKHBhcmFtc0FycmF5W2ldKTsKICAgICAgICB9CiAgICAgICAgc3RyZWFtID0gdGhpcy5tYWtlRmlsdGVyKHN0cmVhbSwgZmlsdGVyLm5hbWUsIG1heWJlTGVuZ3RoLCBwYXJhbXMpOwogICAgICAgIG1heWJlTGVuZ3RoID0gbnVsbDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHN0cmVhbTsKICB9CiAgbWFrZUZpbHRlcihzdHJlYW0sIG5hbWUsIG1heWJlTGVuZ3RoLCBwYXJhbXMpIHsKICAgIGlmIChtYXliZUxlbmd0aCA9PT0gMCkgewogICAgICB3YXJuKGBFbXB0eSAiJHtuYW1lfSIgc3RyZWFtLmApOwogICAgICByZXR1cm4gbmV3IE51bGxTdHJlYW0oKTsKICAgIH0KICAgIHRyeSB7CiAgICAgIHN3aXRjaCAobmFtZSkgewogICAgICAgIGNhc2UgIkZsIjoKICAgICAgICBjYXNlICJGbGF0ZURlY29kZSI6CiAgICAgICAgICBpZiAocGFyYW1zKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJlZGljdG9yU3RyZWFtKG5ldyBGbGF0ZVN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoKSwgbWF5YmVMZW5ndGgsIHBhcmFtcyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbmV3IEZsYXRlU3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgpOwogICAgICAgIGNhc2UgIkxaVyI6CiAgICAgICAgY2FzZSAiTFpXRGVjb2RlIjoKICAgICAgICAgIGxldCBlYXJseUNoYW5nZSA9IDE7CiAgICAgICAgICBpZiAocGFyYW1zKSB7CiAgICAgICAgICAgIGlmIChwYXJhbXMuaGFzKCJFYXJseUNoYW5nZSIpKSB7CiAgICAgICAgICAgICAgZWFybHlDaGFuZ2UgPSBwYXJhbXMuZ2V0KCJFYXJseUNoYW5nZSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJlZGljdG9yU3RyZWFtKG5ldyBMWldTdHJlYW0oc3RyZWFtLCBtYXliZUxlbmd0aCwgZWFybHlDaGFuZ2UpLCBtYXliZUxlbmd0aCwgcGFyYW1zKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuZXcgTFpXU3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgsIGVhcmx5Q2hhbmdlKTsKICAgICAgICBjYXNlICJEQ1QiOgogICAgICAgIGNhc2UgIkRDVERlY29kZSI6CiAgICAgICAgICByZXR1cm4gbmV3IEpwZWdTdHJlYW0oc3RyZWFtLCBtYXliZUxlbmd0aCwgcGFyYW1zKTsKICAgICAgICBjYXNlICJKUFgiOgogICAgICAgIGNhc2UgIkpQWERlY29kZSI6CiAgICAgICAgICByZXR1cm4gbmV3IEpweFN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoLCBwYXJhbXMpOwogICAgICAgIGNhc2UgIkE4NSI6CiAgICAgICAgY2FzZSAiQVNDSUk4NURlY29kZSI6CiAgICAgICAgICByZXR1cm4gbmV3IEFzY2lpODVTdHJlYW0oc3RyZWFtLCBtYXliZUxlbmd0aCk7CiAgICAgICAgY2FzZSAiQUh4IjoKICAgICAgICBjYXNlICJBU0NJSUhleERlY29kZSI6CiAgICAgICAgICByZXR1cm4gbmV3IEFzY2lpSGV4U3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgpOwogICAgICAgIGNhc2UgIkNDRiI6CiAgICAgICAgY2FzZSAiQ0NJVFRGYXhEZWNvZGUiOgogICAgICAgICAgcmV0dXJuIG5ldyBDQ0lUVEZheFN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoLCBwYXJhbXMpOwogICAgICAgIGNhc2UgIlJMIjoKICAgICAgICBjYXNlICJSdW5MZW5ndGhEZWNvZGUiOgogICAgICAgICAgcmV0dXJuIG5ldyBSdW5MZW5ndGhTdHJlYW0oc3RyZWFtLCBtYXliZUxlbmd0aCk7CiAgICAgICAgY2FzZSAiSkJJRzJEZWNvZGUiOgogICAgICAgICAgcmV0dXJuIG5ldyBKYmlnMlN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoLCBwYXJhbXMpOwogICAgICB9CiAgICAgIHdhcm4oYEZpbHRlciAiJHtuYW1lfSIgaXMgbm90IHN1cHBvcnRlZC5gKTsKICAgICAgcmV0dXJuIHN0cmVhbTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgd2FybihgSW52YWxpZCBzdHJlYW06ICIke2V4fSJgKTsKICAgICAgcmV0dXJuIG5ldyBOdWxsU3RyZWFtKCk7CiAgICB9CiAgfQp9CmNvbnN0IHNwZWNpYWxDaGFycyA9IFsxLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAxLCAxLCAwLCAxLCAxLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAxLCAwLCAwLCAwLCAwLCAyLCAwLCAwLCAyLCAyLCAwLCAwLCAwLCAwLCAwLCAyLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAyLCAwLCAyLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAyLCAwLCAyLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAyLCAwLCAyLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKZnVuY3Rpb24gdG9IZXhEaWdpdChjaCkgewogIGlmIChjaCA+PSAweDMwICYmIGNoIDw9IDB4MzkpIHsKICAgIHJldHVybiBjaCAmIDB4MGY7CiAgfQogIGlmIChjaCA+PSAweDQxICYmIGNoIDw9IDB4NDYgfHwgY2ggPj0gMHg2MSAmJiBjaCA8PSAweDY2KSB7CiAgICByZXR1cm4gKGNoICYgMHgwZikgKyA5OwogIH0KICByZXR1cm4gLTE7Cn0KY2xhc3MgTGV4ZXIgewogIGNvbnN0cnVjdG9yKHN0cmVhbSwga25vd25Db21tYW5kcyA9IG51bGwpIHsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy5uZXh0Q2hhcigpOwogICAgdGhpcy5zdHJCdWYgPSBbXTsKICAgIHRoaXMua25vd25Db21tYW5kcyA9IGtub3duQ29tbWFuZHM7CiAgICB0aGlzLl9oZXhTdHJpbmdOdW1XYXJuID0gMDsKICAgIHRoaXMuYmVnaW5JbmxpbmVJbWFnZVBvcyA9IC0xOwogIH0KICBuZXh0Q2hhcigpIHsKICAgIHJldHVybiB0aGlzLmN1cnJlbnRDaGFyID0gdGhpcy5zdHJlYW0uZ2V0Qnl0ZSgpOwogIH0KICBwZWVrQ2hhcigpIHsKICAgIHJldHVybiB0aGlzLnN0cmVhbS5wZWVrQnl0ZSgpOwogIH0KICBnZXROdW1iZXIoKSB7CiAgICBsZXQgY2ggPSB0aGlzLmN1cnJlbnRDaGFyOwogICAgbGV0IGVOb3RhdGlvbiA9IGZhbHNlOwogICAgbGV0IGRpdmlkZUJ5ID0gMDsKICAgIGxldCBzaWduID0gMTsKICAgIGlmIChjaCA9PT0gMHgyZCkgewogICAgICBzaWduID0gLTE7CiAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICBpZiAoY2ggPT09IDB4MmQpIHsKICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChjaCA9PT0gMHgyYikgewogICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgIH0KICAgIGlmIChjaCA9PT0gMHgwYSB8fCBjaCA9PT0gMHgwZCkgewogICAgICBkbyB7CiAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgIH0gd2hpbGUgKGNoID09PSAweDBhIHx8IGNoID09PSAweDBkKTsKICAgIH0KICAgIGlmIChjaCA9PT0gMHgyZSkgewogICAgICBkaXZpZGVCeSA9IDEwOwogICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgIH0KICAgIGlmIChjaCA8IDB4MzAgfHwgY2ggPiAweDM5KSB7CiAgICAgIGNvbnN0IG1zZyA9IGBJbnZhbGlkIG51bWJlcjogJHtTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKX0gKGNoYXJDb2RlICR7Y2h9KWA7CiAgICAgIGlmIChpc1doaXRlU3BhY2UoY2gpIHx8IGNoID09PSAweDI4IHx8IGNoID09PSAweDNjIHx8IGNoID09PSAtMSkgewogICAgICAgIGluZm8oYExleGVyLmdldE51bWJlciAtICIke21zZ30iLmApOwogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihtc2cpOwogICAgfQogICAgbGV0IGJhc2VWYWx1ZSA9IGNoIC0gMHgzMDsKICAgIGxldCBwb3dlclZhbHVlID0gMDsKICAgIGxldCBwb3dlclZhbHVlU2lnbiA9IDE7CiAgICB3aGlsZSAoKGNoID0gdGhpcy5uZXh0Q2hhcigpKSA+PSAwKSB7CiAgICAgIGlmIChjaCA+PSAweDMwICYmIGNoIDw9IDB4MzkpIHsKICAgICAgICBjb25zdCBjdXJyZW50RGlnaXQgPSBjaCAtIDB4MzA7CiAgICAgICAgaWYgKGVOb3RhdGlvbikgewogICAgICAgICAgcG93ZXJWYWx1ZSA9IHBvd2VyVmFsdWUgKiAxMCArIGN1cnJlbnREaWdpdDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGRpdmlkZUJ5ICE9PSAwKSB7CiAgICAgICAgICAgIGRpdmlkZUJ5ICo9IDEwOwogICAgICAgICAgfQogICAgICAgICAgYmFzZVZhbHVlID0gYmFzZVZhbHVlICogMTAgKyBjdXJyZW50RGlnaXQ7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGNoID09PSAweDJlKSB7CiAgICAgICAgaWYgKGRpdmlkZUJ5ID09PSAwKSB7CiAgICAgICAgICBkaXZpZGVCeSA9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHgyZCkgewogICAgICAgIHdhcm4oIkJhZGx5IGZvcm1hdHRlZCBudW1iZXI6IG1pbnVzIHNpZ24gaW4gdGhlIG1pZGRsZSIpOwogICAgICB9IGVsc2UgaWYgKGNoID09PSAweDQ1IHx8IGNoID09PSAweDY1KSB7CiAgICAgICAgY2ggPSB0aGlzLnBlZWtDaGFyKCk7CiAgICAgICAgaWYgKGNoID09PSAweDJiIHx8IGNoID09PSAweDJkKSB7CiAgICAgICAgICBwb3dlclZhbHVlU2lnbiA9IGNoID09PSAweDJkID8gLTEgOiAxOwogICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIH0gZWxzZSBpZiAoY2ggPCAweDMwIHx8IGNoID4gMHgzOSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGVOb3RhdGlvbiA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmIChkaXZpZGVCeSAhPT0gMCkgewogICAgICBiYXNlVmFsdWUgLz0gZGl2aWRlQnk7CiAgICB9CiAgICBpZiAoZU5vdGF0aW9uKSB7CiAgICAgIGJhc2VWYWx1ZSAqPSAxMCAqKiAocG93ZXJWYWx1ZVNpZ24gKiBwb3dlclZhbHVlKTsKICAgIH0KICAgIHJldHVybiBzaWduICogYmFzZVZhbHVlOwogIH0KICBnZXRTdHJpbmcoKSB7CiAgICBsZXQgbnVtUGFyZW4gPSAxOwogICAgbGV0IGRvbmUgPSBmYWxzZTsKICAgIGNvbnN0IHN0ckJ1ZiA9IHRoaXMuc3RyQnVmOwogICAgc3RyQnVmLmxlbmd0aCA9IDA7CiAgICBsZXQgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBsZXQgY2hhckJ1ZmZlcmVkID0gZmFsc2U7CiAgICAgIHN3aXRjaCAoY2ggfCAwKSB7CiAgICAgICAgY2FzZSAtMToKICAgICAgICAgIHdhcm4oIlVudGVybWluYXRlZCBzdHJpbmciKTsKICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDI4OgogICAgICAgICAgKytudW1QYXJlbjsKICAgICAgICAgIHN0ckJ1Zi5wdXNoKCIoIik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4Mjk6CiAgICAgICAgICBpZiAoLS1udW1QYXJlbiA9PT0gMCkgewogICAgICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RyQnVmLnB1c2goIikiKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHg1YzoKICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgc3dpdGNoIChjaCkgewogICAgICAgICAgICBjYXNlIC0xOgogICAgICAgICAgICAgIHdhcm4oIlVudGVybWluYXRlZCBzdHJpbmciKTsKICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDZlOgogICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCJcbiIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4NzI6CiAgICAgICAgICAgICAgc3RyQnVmLnB1c2goIlxyIik7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHg3NDoKICAgICAgICAgICAgICBzdHJCdWYucHVzaCgiXHQiKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDYyOgogICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCJcYiIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4NjY6CiAgICAgICAgICAgICAgc3RyQnVmLnB1c2goIlxmIik7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHg1YzoKICAgICAgICAgICAgY2FzZSAweDI4OgogICAgICAgICAgICBjYXNlIDB4Mjk6CiAgICAgICAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaCkpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MzA6CiAgICAgICAgICAgIGNhc2UgMHgzMToKICAgICAgICAgICAgY2FzZSAweDMyOgogICAgICAgICAgICBjYXNlIDB4MzM6CiAgICAgICAgICAgIGNhc2UgMHgzNDoKICAgICAgICAgICAgY2FzZSAweDM1OgogICAgICAgICAgICBjYXNlIDB4MzY6CiAgICAgICAgICAgIGNhc2UgMHgzNzoKICAgICAgICAgICAgICBsZXQgeCA9IGNoICYgMHgwZjsKICAgICAgICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgICAgICBjaGFyQnVmZmVyZWQgPSB0cnVlOwogICAgICAgICAgICAgIGlmIChjaCA+PSAweDMwICYmIGNoIDw9IDB4MzcpIHsKICAgICAgICAgICAgICAgIHggPSAoeCA8PCAzKSArIChjaCAmIDB4MGYpOwogICAgICAgICAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgICAgICBpZiAoY2ggPj0gMHgzMCAmJiBjaCA8PSAweDM3KSB7CiAgICAgICAgICAgICAgICAgIGNoYXJCdWZmZXJlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB4ID0gKHggPDwgMykgKyAoY2ggJiAweDBmKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSh4KSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgwZDoKICAgICAgICAgICAgICBpZiAodGhpcy5wZWVrQ2hhcigpID09PSAweDBhKSB7CiAgICAgICAgICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MGE6CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaCkpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmIChkb25lKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKCFjaGFyQnVmZmVyZWQpIHsKICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHN0ckJ1Zi5qb2luKCIiKTsKICB9CiAgZ2V0TmFtZSgpIHsKICAgIGxldCBjaCwgcHJldmlvdXNDaDsKICAgIGNvbnN0IHN0ckJ1ZiA9IHRoaXMuc3RyQnVmOwogICAgc3RyQnVmLmxlbmd0aCA9IDA7CiAgICB3aGlsZSAoKGNoID0gdGhpcy5uZXh0Q2hhcigpKSA+PSAwICYmICFzcGVjaWFsQ2hhcnNbY2hdKSB7CiAgICAgIGlmIChjaCA9PT0gMHgyMykgewogICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIGlmIChzcGVjaWFsQ2hhcnNbY2hdKSB7CiAgICAgICAgICB3YXJuKCJMZXhlcl9nZXROYW1lOiAiICsgIk5VTUJFUiBTSUdOICgjKSBzaG91bGQgYmUgZm9sbG93ZWQgYnkgYSBoZXhhZGVjaW1hbCBudW1iZXIuIik7CiAgICAgICAgICBzdHJCdWYucHVzaCgiIyIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHggPSB0b0hleERpZ2l0KGNoKTsKICAgICAgICBpZiAoeCAhPT0gLTEpIHsKICAgICAgICAgIHByZXZpb3VzQ2ggPSBjaDsKICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgY29uc3QgeDIgPSB0b0hleERpZ2l0KGNoKTsKICAgICAgICAgIGlmICh4MiA9PT0gLTEpIHsKICAgICAgICAgICAgd2FybihgTGV4ZXJfZ2V0TmFtZTogSWxsZWdhbCBkaWdpdCAoJHtTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKX0pIGAgKyAiaW4gaGV4YWRlY2ltYWwgbnVtYmVyLiIpOwogICAgICAgICAgICBzdHJCdWYucHVzaCgiIyIsIFN0cmluZy5mcm9tQ2hhckNvZGUocHJldmlvdXNDaCkpOwogICAgICAgICAgICBpZiAoc3BlY2lhbENoYXJzW2NoXSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKHggPDwgNCB8IHgyKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0ckJ1Zi5wdXNoKCIjIiwgU3RyaW5nLmZyb21DaGFyQ29kZShjaCkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKSk7CiAgICAgIH0KICAgIH0KICAgIGlmIChzdHJCdWYubGVuZ3RoID4gMTI3KSB7CiAgICAgIHdhcm4oYE5hbWUgdG9rZW4gaXMgbG9uZ2VyIHRoYW4gYWxsb3dlZCBieSB0aGUgc3BlYzogJHtzdHJCdWYubGVuZ3RofWApOwogICAgfQogICAgcmV0dXJuIE5hbWUuZ2V0KHN0ckJ1Zi5qb2luKCIiKSk7CiAgfQogIF9oZXhTdHJpbmdXYXJuKGNoKSB7CiAgICBjb25zdCBNQVhfSEVYX1NUUklOR19OVU1fV0FSTiA9IDU7CiAgICBpZiAodGhpcy5faGV4U3RyaW5nTnVtV2FybisrID09PSBNQVhfSEVYX1NUUklOR19OVU1fV0FSTikgewogICAgICB3YXJuKCJnZXRIZXhTdHJpbmcgLSBpZ25vcmluZyBhZGRpdGlvbmFsIGludmFsaWQgY2hhcmFjdGVycy4iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuX2hleFN0cmluZ051bVdhcm4gPiBNQVhfSEVYX1NUUklOR19OVU1fV0FSTikgewogICAgICByZXR1cm47CiAgICB9CiAgICB3YXJuKGBnZXRIZXhTdHJpbmcgLSBpZ25vcmluZyBpbnZhbGlkIGNoYXJhY3RlcjogJHtjaH1gKTsKICB9CiAgZ2V0SGV4U3RyaW5nKCkgewogICAgY29uc3Qgc3RyQnVmID0gdGhpcy5zdHJCdWY7CiAgICBzdHJCdWYubGVuZ3RoID0gMDsKICAgIGxldCBjaCA9IHRoaXMuY3VycmVudENoYXI7CiAgICBsZXQgZmlyc3REaWdpdCA9IC0xLAogICAgICBkaWdpdCA9IC0xOwogICAgdGhpcy5faGV4U3RyaW5nTnVtV2FybiA9IDA7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBpZiAoY2ggPCAwKSB7CiAgICAgICAgd2FybigiVW50ZXJtaW5hdGVkIGhleCBzdHJpbmciKTsKICAgICAgICBicmVhazsKICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHgzZSkgewogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICBicmVhazsKICAgICAgfSBlbHNlIGlmIChzcGVjaWFsQ2hhcnNbY2hdID09PSAxKSB7CiAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGlnaXQgPSB0b0hleERpZ2l0KGNoKTsKICAgICAgICBpZiAoZGlnaXQgPT09IC0xKSB7CiAgICAgICAgICB0aGlzLl9oZXhTdHJpbmdXYXJuKGNoKTsKICAgICAgICB9IGVsc2UgaWYgKGZpcnN0RGlnaXQgPT09IC0xKSB7CiAgICAgICAgICBmaXJzdERpZ2l0ID0gZGlnaXQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoZmlyc3REaWdpdCA8PCA0IHwgZGlnaXQpKTsKICAgICAgICAgIGZpcnN0RGlnaXQgPSAtMTsKICAgICAgICB9CiAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgIH0KICAgIH0KICAgIGlmIChmaXJzdERpZ2l0ICE9PSAtMSkgewogICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGZpcnN0RGlnaXQgPDwgNCkpOwogICAgfQogICAgcmV0dXJuIHN0ckJ1Zi5qb2luKCIiKTsKICB9CiAgZ2V0T2JqKCkgewogICAgbGV0IGNvbW1lbnQgPSBmYWxzZTsKICAgIGxldCBjaCA9IHRoaXMuY3VycmVudENoYXI7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBpZiAoY2ggPCAwKSB7CiAgICAgICAgcmV0dXJuIEVPRjsKICAgICAgfQogICAgICBpZiAoY29tbWVudCkgewogICAgICAgIGlmIChjaCA9PT0gMHgwYSB8fCBjaCA9PT0gMHgwZCkgewogICAgICAgICAgY29tbWVudCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHgyNSkgewogICAgICAgIGNvbW1lbnQgPSB0cnVlOwogICAgICB9IGVsc2UgaWYgKHNwZWNpYWxDaGFyc1tjaF0gIT09IDEpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgIH0KICAgIHN3aXRjaCAoY2ggfCAwKSB7CiAgICAgIGNhc2UgMHgzMDoKICAgICAgY2FzZSAweDMxOgogICAgICBjYXNlIDB4MzI6CiAgICAgIGNhc2UgMHgzMzoKICAgICAgY2FzZSAweDM0OgogICAgICBjYXNlIDB4MzU6CiAgICAgIGNhc2UgMHgzNjoKICAgICAgY2FzZSAweDM3OgogICAgICBjYXNlIDB4Mzg6CiAgICAgIGNhc2UgMHgzOToKICAgICAgY2FzZSAweDJiOgogICAgICBjYXNlIDB4MmQ6CiAgICAgIGNhc2UgMHgyZToKICAgICAgICByZXR1cm4gdGhpcy5nZXROdW1iZXIoKTsKICAgICAgY2FzZSAweDI4OgogICAgICAgIHJldHVybiB0aGlzLmdldFN0cmluZygpOwogICAgICBjYXNlIDB4MmY6CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TmFtZSgpOwogICAgICBjYXNlIDB4NWI6CiAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIHJldHVybiBDbWQuZ2V0KCJbIik7CiAgICAgIGNhc2UgMHg1ZDoKICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgcmV0dXJuIENtZC5nZXQoIl0iKTsKICAgICAgY2FzZSAweDNjOgogICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIGlmIChjaCA9PT0gMHgzYykgewogICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgcmV0dXJuIENtZC5nZXQoIjw8Iik7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmdldEhleFN0cmluZygpOwogICAgICBjYXNlIDB4M2U6CiAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgaWYgKGNoID09PSAweDNlKSB7CiAgICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICByZXR1cm4gQ21kLmdldCgiPj4iKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIENtZC5nZXQoIj4iKTsKICAgICAgY2FzZSAweDdiOgogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICByZXR1cm4gQ21kLmdldCgieyIpOwogICAgICBjYXNlIDB4N2Q6CiAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIHJldHVybiBDbWQuZ2V0KCJ9Iik7CiAgICAgIGNhc2UgMHgyOToKICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbGxlZ2FsIGNoYXJhY3RlcjogJHtjaH1gKTsKICAgIH0KICAgIGxldCBzdHIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTsKICAgIGlmIChjaCA8IDB4MjAgfHwgY2ggPiAweDdmKSB7CiAgICAgIGNvbnN0IG5leHRDaCA9IHRoaXMucGVla0NoYXIoKTsKICAgICAgaWYgKG5leHRDaCA+PSAweDIwICYmIG5leHRDaCA8PSAweDdmKSB7CiAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIHJldHVybiBDbWQuZ2V0KHN0cik7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGtub3duQ29tbWFuZHMgPSB0aGlzLmtub3duQ29tbWFuZHM7CiAgICBsZXQga25vd25Db21tYW5kRm91bmQgPSBrbm93bkNvbW1hbmRzPy5bc3RyXSAhPT0gdW5kZWZpbmVkOwogICAgd2hpbGUgKChjaCA9IHRoaXMubmV4dENoYXIoKSkgPj0gMCAmJiAhc3BlY2lhbENoYXJzW2NoXSkgewogICAgICBjb25zdCBwb3NzaWJsZUNvbW1hbmQgPSBzdHIgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTsKICAgICAgaWYgKGtub3duQ29tbWFuZEZvdW5kICYmIGtub3duQ29tbWFuZHNbcG9zc2libGVDb21tYW5kXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKHN0ci5sZW5ndGggPT09IDEyOCkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgQ29tbWFuZCB0b2tlbiB0b28gbG9uZzogJHtzdHIubGVuZ3RofWApOwogICAgICB9CiAgICAgIHN0ciA9IHBvc3NpYmxlQ29tbWFuZDsKICAgICAga25vd25Db21tYW5kRm91bmQgPSBrbm93bkNvbW1hbmRzPy5bc3RyXSAhPT0gdW5kZWZpbmVkOwogICAgfQogICAgaWYgKHN0ciA9PT0gInRydWUiKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKHN0ciA9PT0gImZhbHNlIikgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoc3RyID09PSAibnVsbCIpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpZiAoc3RyID09PSAiQkkiKSB7CiAgICAgIHRoaXMuYmVnaW5JbmxpbmVJbWFnZVBvcyA9IHRoaXMuc3RyZWFtLnBvczsKICAgIH0KICAgIHJldHVybiBDbWQuZ2V0KHN0cik7CiAgfQogIHNraXBUb05leHRMaW5lKCkgewogICAgbGV0IGNoID0gdGhpcy5jdXJyZW50Q2hhcjsKICAgIHdoaWxlIChjaCA+PSAwKSB7CiAgICAgIGlmIChjaCA9PT0gMHgwZCkgewogICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIGlmIChjaCA9PT0gMHgwYSkgewogICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHgwYSkgewogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgIH0KICB9Cn0KY2xhc3MgTGluZWFyaXphdGlvbiB7CiAgc3RhdGljIGNyZWF0ZShzdHJlYW0pIHsKICAgIGZ1bmN0aW9uIGdldEludChsaW5EaWN0LCBuYW1lLCBhbGxvd1plcm9WYWx1ZSA9IGZhbHNlKSB7CiAgICAgIGNvbnN0IG9iaiA9IGxpbkRpY3QuZ2V0KG5hbWUpOwogICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihvYmopICYmIChhbGxvd1plcm9WYWx1ZSA/IG9iaiA+PSAwIDogb2JqID4gMCkpIHsKICAgICAgICByZXR1cm4gb2JqOwogICAgICB9CiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlICIke25hbWV9IiBwYXJhbWV0ZXIgaW4gdGhlIGxpbmVhcml6YXRpb24gYCArICJkaWN0aW9uYXJ5IGlzIGludmFsaWQuIik7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRIaW50cyhsaW5EaWN0KSB7CiAgICAgIGNvbnN0IGhpbnRzID0gbGluRGljdC5nZXQoIkgiKTsKICAgICAgbGV0IGhpbnRzTGVuZ3RoOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShoaW50cykgJiYgKChoaW50c0xlbmd0aCA9IGhpbnRzLmxlbmd0aCkgPT09IDIgfHwgaGludHNMZW5ndGggPT09IDQpKSB7CiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGhpbnRzTGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICBjb25zdCBoaW50ID0gaGludHNbaW5kZXhdOwogICAgICAgICAgaWYgKCEoTnVtYmVyLmlzSW50ZWdlcihoaW50KSAmJiBoaW50ID4gMCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBIaW50ICgke2luZGV4fSkgaW4gdGhlIGxpbmVhcml6YXRpb24gZGljdGlvbmFyeSBpcyBpbnZhbGlkLmApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gaGludHM7CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IEVycm9yKCJIaW50IGFycmF5IGluIHRoZSBsaW5lYXJpemF0aW9uIGRpY3Rpb25hcnkgaXMgaW52YWxpZC4iKTsKICAgIH0KICAgIGNvbnN0IHBhcnNlciA9IG5ldyBQYXJzZXIoewogICAgICBsZXhlcjogbmV3IExleGVyKHN0cmVhbSksCiAgICAgIHhyZWY6IG51bGwKICAgIH0pOwogICAgY29uc3Qgb2JqMSA9IHBhcnNlci5nZXRPYmooKTsKICAgIGNvbnN0IG9iajIgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICBjb25zdCBvYmozID0gcGFyc2VyLmdldE9iaigpOwogICAgY29uc3QgbGluRGljdCA9IHBhcnNlci5nZXRPYmooKTsKICAgIGxldCBvYmosIGxlbmd0aDsKICAgIGlmICghKE51bWJlci5pc0ludGVnZXIob2JqMSkgJiYgTnVtYmVyLmlzSW50ZWdlcihvYmoyKSAmJiBpc0NtZChvYmozLCAib2JqIikgJiYgbGluRGljdCBpbnN0YW5jZW9mIERpY3QgJiYgdHlwZW9mIChvYmogPSBsaW5EaWN0LmdldCgiTGluZWFyaXplZCIpKSA9PT0gIm51bWJlciIgJiYgb2JqID4gMCkpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9IGVsc2UgaWYgKChsZW5ndGggPSBnZXRJbnQobGluRGljdCwgIkwiKSkgIT09IHN0cmVhbS5sZW5ndGgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgIkwiIHBhcmFtZXRlciBpbiB0aGUgbGluZWFyaXphdGlvbiBkaWN0aW9uYXJ5ICcgKyAiZG9lcyBub3QgZXF1YWwgdGhlIHN0cmVhbSBsZW5ndGguIik7CiAgICB9CiAgICByZXR1cm4gewogICAgICBsZW5ndGgsCiAgICAgIGhpbnRzOiBnZXRIaW50cyhsaW5EaWN0KSwKICAgICAgb2JqZWN0TnVtYmVyRmlyc3Q6IGdldEludChsaW5EaWN0LCAiTyIpLAogICAgICBlbmRGaXJzdDogZ2V0SW50KGxpbkRpY3QsICJFIiksCiAgICAgIG51bVBhZ2VzOiBnZXRJbnQobGluRGljdCwgIk4iKSwKICAgICAgbWFpblhSZWZFbnRyaWVzT2Zmc2V0OiBnZXRJbnQobGluRGljdCwgIlQiKSwKICAgICAgcGFnZUZpcnN0OiBsaW5EaWN0LmhhcygiUCIpID8gZ2V0SW50KGxpbkRpY3QsICJQIiwgdHJ1ZSkgOiAwCiAgICB9OwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY21hcC5qcwoKCgoKCgoKY29uc3QgQlVJTFRfSU5fQ01BUFMgPSBbIkFkb2JlLUdCMS1VQ1MyIiwgIkFkb2JlLUNOUzEtVUNTMiIsICJBZG9iZS1KYXBhbjEtVUNTMiIsICJBZG9iZS1Lb3JlYTEtVUNTMiIsICI3OC1FVUMtSCIsICI3OC1FVUMtViIsICI3OC1IIiwgIjc4LVJLU0otSCIsICI3OC1SS1NKLVYiLCAiNzgtViIsICI3OG1zLVJLU0otSCIsICI3OG1zLVJLU0otViIsICI4M3B2LVJLU0otSCIsICI5MG1zLVJLU0otSCIsICI5MG1zLVJLU0otViIsICI5MG1zcC1SS1NKLUgiLCAiOTBtc3AtUktTSi1WIiwgIjkwcHYtUktTSi1IIiwgIjkwcHYtUktTSi1WIiwgIkFkZC1IIiwgIkFkZC1SS1NKLUgiLCAiQWRkLVJLU0otViIsICJBZGQtViIsICJBZG9iZS1DTlMxLTAiLCAiQWRvYmUtQ05TMS0xIiwgIkFkb2JlLUNOUzEtMiIsICJBZG9iZS1DTlMxLTMiLCAiQWRvYmUtQ05TMS00IiwgIkFkb2JlLUNOUzEtNSIsICJBZG9iZS1DTlMxLTYiLCAiQWRvYmUtR0IxLTAiLCAiQWRvYmUtR0IxLTEiLCAiQWRvYmUtR0IxLTIiLCAiQWRvYmUtR0IxLTMiLCAiQWRvYmUtR0IxLTQiLCAiQWRvYmUtR0IxLTUiLCAiQWRvYmUtSmFwYW4xLTAiLCAiQWRvYmUtSmFwYW4xLTEiLCAiQWRvYmUtSmFwYW4xLTIiLCAiQWRvYmUtSmFwYW4xLTMiLCAiQWRvYmUtSmFwYW4xLTQiLCAiQWRvYmUtSmFwYW4xLTUiLCAiQWRvYmUtSmFwYW4xLTYiLCAiQWRvYmUtS29yZWExLTAiLCAiQWRvYmUtS29yZWExLTEiLCAiQWRvYmUtS29yZWExLTIiLCAiQjUtSCIsICJCNS1WIiwgIkI1cGMtSCIsICJCNXBjLVYiLCAiQ05TLUVVQy1IIiwgIkNOUy1FVUMtViIsICJDTlMxLUgiLCAiQ05TMS1WIiwgIkNOUzItSCIsICJDTlMyLVYiLCAiRVRISy1CNS1IIiwgIkVUSEstQjUtViIsICJFVGVuLUI1LUgiLCAiRVRlbi1CNS1WIiwgIkVUZW5tcy1CNS1IIiwgIkVUZW5tcy1CNS1WIiwgIkVVQy1IIiwgIkVVQy1WIiwgIkV4dC1IIiwgIkV4dC1SS1NKLUgiLCAiRXh0LVJLU0otViIsICJFeHQtViIsICJHQi1FVUMtSCIsICJHQi1FVUMtViIsICJHQi1IIiwgIkdCLVYiLCAiR0JLLUVVQy1IIiwgIkdCSy1FVUMtViIsICJHQksySy1IIiwgIkdCSzJLLVYiLCAiR0JLcC1FVUMtSCIsICJHQktwLUVVQy1WIiwgIkdCVC1FVUMtSCIsICJHQlQtRVVDLVYiLCAiR0JULUgiLCAiR0JULVYiLCAiR0JUcGMtRVVDLUgiLCAiR0JUcGMtRVVDLVYiLCAiR0JwYy1FVUMtSCIsICJHQnBjLUVVQy1WIiwgIkgiLCAiSEtkbGEtQjUtSCIsICJIS2RsYS1CNS1WIiwgIkhLZGxiLUI1LUgiLCAiSEtkbGItQjUtViIsICJIS2djY3MtQjUtSCIsICJIS2djY3MtQjUtViIsICJIS20zMTQtQjUtSCIsICJIS20zMTQtQjUtViIsICJIS200NzEtQjUtSCIsICJIS200NzEtQjUtViIsICJIS3Njcy1CNS1IIiwgIkhLc2NzLUI1LVYiLCAiSGFua2FrdSIsICJIaXJhZ2FuYSIsICJLU0MtRVVDLUgiLCAiS1NDLUVVQy1WIiwgIktTQy1IIiwgIktTQy1Kb2hhYi1IIiwgIktTQy1Kb2hhYi1WIiwgIktTQy1WIiwgIktTQ21zLVVIQy1IIiwgIktTQ21zLVVIQy1IVy1IIiwgIktTQ21zLVVIQy1IVy1WIiwgIktTQ21zLVVIQy1WIiwgIktTQ3BjLUVVQy1IIiwgIktTQ3BjLUVVQy1WIiwgIkthdGFrYW5hIiwgIk5XUC1IIiwgIk5XUC1WIiwgIlJLU0otSCIsICJSS1NKLVYiLCAiUm9tYW4iLCAiVW5pQ05TLVVDUzItSCIsICJVbmlDTlMtVUNTMi1WIiwgIlVuaUNOUy1VVEYxNi1IIiwgIlVuaUNOUy1VVEYxNi1WIiwgIlVuaUNOUy1VVEYzMi1IIiwgIlVuaUNOUy1VVEYzMi1WIiwgIlVuaUNOUy1VVEY4LUgiLCAiVW5pQ05TLVVURjgtViIsICJVbmlHQi1VQ1MyLUgiLCAiVW5pR0ItVUNTMi1WIiwgIlVuaUdCLVVURjE2LUgiLCAiVW5pR0ItVVRGMTYtViIsICJVbmlHQi1VVEYzMi1IIiwgIlVuaUdCLVVURjMyLVYiLCAiVW5pR0ItVVRGOC1IIiwgIlVuaUdCLVVURjgtViIsICJVbmlKSVMtVUNTMi1IIiwgIlVuaUpJUy1VQ1MyLUhXLUgiLCAiVW5pSklTLVVDUzItSFctViIsICJVbmlKSVMtVUNTMi1WIiwgIlVuaUpJUy1VVEYxNi1IIiwgIlVuaUpJUy1VVEYxNi1WIiwgIlVuaUpJUy1VVEYzMi1IIiwgIlVuaUpJUy1VVEYzMi1WIiwgIlVuaUpJUy1VVEY4LUgiLCAiVW5pSklTLVVURjgtViIsICJVbmlKSVMyMDA0LVVURjE2LUgiLCAiVW5pSklTMjAwNC1VVEYxNi1WIiwgIlVuaUpJUzIwMDQtVVRGMzItSCIsICJVbmlKSVMyMDA0LVVURjMyLVYiLCAiVW5pSklTMjAwNC1VVEY4LUgiLCAiVW5pSklTMjAwNC1VVEY4LVYiLCAiVW5pSklTUHJvLVVDUzItSFctViIsICJVbmlKSVNQcm8tVUNTMi1WIiwgIlVuaUpJU1Byby1VVEY4LVYiLCAiVW5pSklTWDAyMTMtVVRGMzItSCIsICJVbmlKSVNYMDIxMy1VVEYzMi1WIiwgIlVuaUpJU1gwMjEzMjAwNC1VVEYzMi1IIiwgIlVuaUpJU1gwMjEzMjAwNC1VVEYzMi1WIiwgIlVuaUtTLVVDUzItSCIsICJVbmlLUy1VQ1MyLVYiLCAiVW5pS1MtVVRGMTYtSCIsICJVbmlLUy1VVEYxNi1WIiwgIlVuaUtTLVVURjMyLUgiLCAiVW5pS1MtVVRGMzItViIsICJVbmlLUy1VVEY4LUgiLCAiVW5pS1MtVVRGOC1WIiwgIlYiLCAiV1AtU3ltYm9sIl07CmNvbnN0IE1BWF9NQVBfUkFOR0UgPSAyICoqIDI0IC0gMTsKY2xhc3MgQ01hcCB7CiAgY29uc3RydWN0b3IoYnVpbHRJbkNNYXAgPSBmYWxzZSkgewogICAgdGhpcy5jb2Rlc3BhY2VSYW5nZXMgPSBbW10sIFtdLCBbXSwgW11dOwogICAgdGhpcy5udW1Db2Rlc3BhY2VSYW5nZXMgPSAwOwogICAgdGhpcy5fbWFwID0gW107CiAgICB0aGlzLm5hbWUgPSAiIjsKICAgIHRoaXMudmVydGljYWwgPSBmYWxzZTsKICAgIHRoaXMudXNlQ01hcCA9IG51bGw7CiAgICB0aGlzLmJ1aWx0SW5DTWFwID0gYnVpbHRJbkNNYXA7CiAgfQogIGFkZENvZGVzcGFjZVJhbmdlKG4sIGxvdywgaGlnaCkgewogICAgdGhpcy5jb2Rlc3BhY2VSYW5nZXNbbiAtIDFdLnB1c2gobG93LCBoaWdoKTsKICAgIHRoaXMubnVtQ29kZXNwYWNlUmFuZ2VzKys7CiAgfQogIG1hcENpZFJhbmdlKGxvdywgaGlnaCwgZHN0TG93KSB7CiAgICBpZiAoaGlnaCAtIGxvdyA+IE1BWF9NQVBfUkFOR0UpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJtYXBDaWRSYW5nZSAtIGlnbm9yaW5nIGRhdGEgYWJvdmUgTUFYX01BUF9SQU5HRS4iKTsKICAgIH0KICAgIHdoaWxlIChsb3cgPD0gaGlnaCkgewogICAgICB0aGlzLl9tYXBbbG93KytdID0gZHN0TG93Kys7CiAgICB9CiAgfQogIG1hcEJmUmFuZ2UobG93LCBoaWdoLCBkc3RMb3cpIHsKICAgIGlmIChoaWdoIC0gbG93ID4gTUFYX01BUF9SQU5HRSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIm1hcEJmUmFuZ2UgLSBpZ25vcmluZyBkYXRhIGFib3ZlIE1BWF9NQVBfUkFOR0UuIik7CiAgICB9CiAgICBjb25zdCBsYXN0Qnl0ZSA9IGRzdExvdy5sZW5ndGggLSAxOwogICAgd2hpbGUgKGxvdyA8PSBoaWdoKSB7CiAgICAgIHRoaXMuX21hcFtsb3crK10gPSBkc3RMb3c7CiAgICAgIGNvbnN0IG5leHRDaGFyQ29kZSA9IGRzdExvdy5jaGFyQ29kZUF0KGxhc3RCeXRlKSArIDE7CiAgICAgIGlmIChuZXh0Q2hhckNvZGUgPiAweGZmKSB7CiAgICAgICAgZHN0TG93ID0gZHN0TG93LnN1YnN0cmluZygwLCBsYXN0Qnl0ZSAtIDEpICsgU3RyaW5nLmZyb21DaGFyQ29kZShkc3RMb3cuY2hhckNvZGVBdChsYXN0Qnl0ZSAtIDEpICsgMSkgKyAiXHgwMCI7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZHN0TG93ID0gZHN0TG93LnN1YnN0cmluZygwLCBsYXN0Qnl0ZSkgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKG5leHRDaGFyQ29kZSk7CiAgICB9CiAgfQogIG1hcEJmUmFuZ2VUb0FycmF5KGxvdywgaGlnaCwgYXJyYXkpIHsKICAgIGlmIChoaWdoIC0gbG93ID4gTUFYX01BUF9SQU5HRSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIm1hcEJmUmFuZ2VUb0FycmF5IC0gaWdub3JpbmcgZGF0YSBhYm92ZSBNQVhfTUFQX1JBTkdFLiIpOwogICAgfQogICAgY29uc3QgaWkgPSBhcnJheS5sZW5ndGg7CiAgICBsZXQgaSA9IDA7CiAgICB3aGlsZSAobG93IDw9IGhpZ2ggJiYgaSA8IGlpKSB7CiAgICAgIHRoaXMuX21hcFtsb3ddID0gYXJyYXlbaSsrXTsKICAgICAgKytsb3c7CiAgICB9CiAgfQogIG1hcE9uZShzcmMsIGRzdCkgewogICAgdGhpcy5fbWFwW3NyY10gPSBkc3Q7CiAgfQogIGxvb2t1cChjb2RlKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwW2NvZGVdOwogIH0KICBjb250YWlucyhjb2RlKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwW2NvZGVdICE9PSB1bmRlZmluZWQ7CiAgfQogIGZvckVhY2goY2FsbGJhY2spIHsKICAgIGNvbnN0IG1hcCA9IHRoaXMuX21hcDsKICAgIGNvbnN0IGxlbmd0aCA9IG1hcC5sZW5ndGg7CiAgICBpZiAobGVuZ3RoIDw9IDB4MTAwMDApIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGlmIChtYXBbaV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgY2FsbGJhY2soaSwgbWFwW2ldKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGZvciAoY29uc3QgaSBpbiBtYXApIHsKICAgICAgICBjYWxsYmFjayhpLCBtYXBbaV0pOwogICAgICB9CiAgICB9CiAgfQogIGNoYXJDb2RlT2YodmFsdWUpIHsKICAgIGNvbnN0IG1hcCA9IHRoaXMuX21hcDsKICAgIGlmIChtYXAubGVuZ3RoIDw9IDB4MTAwMDApIHsKICAgICAgcmV0dXJuIG1hcC5pbmRleE9mKHZhbHVlKTsKICAgIH0KICAgIGZvciAoY29uc3QgY2hhckNvZGUgaW4gbWFwKSB7CiAgICAgIGlmIChtYXBbY2hhckNvZGVdID09PSB2YWx1ZSkgewogICAgICAgIHJldHVybiBjaGFyQ29kZSB8IDA7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAtMTsKICB9CiAgZ2V0TWFwKCkgewogICAgcmV0dXJuIHRoaXMuX21hcDsKICB9CiAgcmVhZENoYXJDb2RlKHN0ciwgb2Zmc2V0LCBvdXQpIHsKICAgIGxldCBjID0gMDsKICAgIGNvbnN0IGNvZGVzcGFjZVJhbmdlcyA9IHRoaXMuY29kZXNwYWNlUmFuZ2VzOwogICAgZm9yIChsZXQgbiA9IDAsIG5uID0gY29kZXNwYWNlUmFuZ2VzLmxlbmd0aDsgbiA8IG5uOyBuKyspIHsKICAgICAgYyA9IChjIDw8IDggfCBzdHIuY2hhckNvZGVBdChvZmZzZXQgKyBuKSkgPj4+IDA7CiAgICAgIGNvbnN0IGNvZGVzcGFjZVJhbmdlID0gY29kZXNwYWNlUmFuZ2VzW25dOwogICAgICBmb3IgKGxldCBrID0gMCwga2sgPSBjb2Rlc3BhY2VSYW5nZS5sZW5ndGg7IGsgPCBrazspIHsKICAgICAgICBjb25zdCBsb3cgPSBjb2Rlc3BhY2VSYW5nZVtrKytdOwogICAgICAgIGNvbnN0IGhpZ2ggPSBjb2Rlc3BhY2VSYW5nZVtrKytdOwogICAgICAgIGlmIChjID49IGxvdyAmJiBjIDw9IGhpZ2gpIHsKICAgICAgICAgIG91dC5jaGFyY29kZSA9IGM7CiAgICAgICAgICBvdXQubGVuZ3RoID0gbiArIDE7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBvdXQuY2hhcmNvZGUgPSAwOwogICAgb3V0Lmxlbmd0aCA9IDE7CiAgfQogIGdldENoYXJDb2RlTGVuZ3RoKGNoYXJDb2RlKSB7CiAgICBjb25zdCBjb2Rlc3BhY2VSYW5nZXMgPSB0aGlzLmNvZGVzcGFjZVJhbmdlczsKICAgIGZvciAobGV0IG4gPSAwLCBubiA9IGNvZGVzcGFjZVJhbmdlcy5sZW5ndGg7IG4gPCBubjsgbisrKSB7CiAgICAgIGNvbnN0IGNvZGVzcGFjZVJhbmdlID0gY29kZXNwYWNlUmFuZ2VzW25dOwogICAgICBmb3IgKGxldCBrID0gMCwga2sgPSBjb2Rlc3BhY2VSYW5nZS5sZW5ndGg7IGsgPCBrazspIHsKICAgICAgICBjb25zdCBsb3cgPSBjb2Rlc3BhY2VSYW5nZVtrKytdOwogICAgICAgIGNvbnN0IGhpZ2ggPSBjb2Rlc3BhY2VSYW5nZVtrKytdOwogICAgICAgIGlmIChjaGFyQ29kZSA+PSBsb3cgJiYgY2hhckNvZGUgPD0gaGlnaCkgewogICAgICAgICAgcmV0dXJuIG4gKyAxOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIDE7CiAgfQogIGdldCBsZW5ndGgoKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwLmxlbmd0aDsKICB9CiAgZ2V0IGlzSWRlbnRpdHlDTWFwKCkgewogICAgaWYgKCEodGhpcy5uYW1lID09PSAiSWRlbnRpdHktSCIgfHwgdGhpcy5uYW1lID09PSAiSWRlbnRpdHktViIpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzLl9tYXAubGVuZ3RoICE9PSAweDEwMDAwKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMHgxMDAwMDsgaSsrKSB7CiAgICAgIGlmICh0aGlzLl9tYXBbaV0gIT09IGkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KfQpjbGFzcyBJZGVudGl0eUNNYXAgZXh0ZW5kcyBDTWFwIHsKICBjb25zdHJ1Y3Rvcih2ZXJ0aWNhbCwgbikgewogICAgc3VwZXIoKTsKICAgIHRoaXMudmVydGljYWwgPSB2ZXJ0aWNhbDsKICAgIHRoaXMuYWRkQ29kZXNwYWNlUmFuZ2UobiwgMCwgMHhmZmZmKTsKICB9CiAgbWFwQ2lkUmFuZ2UobG93LCBoaWdoLCBkc3RMb3cpIHsKICAgIHVucmVhY2hhYmxlKCJzaG91bGQgbm90IGNhbGwgbWFwQ2lkUmFuZ2UiKTsKICB9CiAgbWFwQmZSYW5nZShsb3csIGhpZ2gsIGRzdExvdykgewogICAgdW5yZWFjaGFibGUoInNob3VsZCBub3QgY2FsbCBtYXBCZlJhbmdlIik7CiAgfQogIG1hcEJmUmFuZ2VUb0FycmF5KGxvdywgaGlnaCwgYXJyYXkpIHsKICAgIHVucmVhY2hhYmxlKCJzaG91bGQgbm90IGNhbGwgbWFwQmZSYW5nZVRvQXJyYXkiKTsKICB9CiAgbWFwT25lKHNyYywgZHN0KSB7CiAgICB1bnJlYWNoYWJsZSgic2hvdWxkIG5vdCBjYWxsIG1hcENpZE9uZSIpOwogIH0KICBsb29rdXAoY29kZSkgewogICAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIoY29kZSkgJiYgY29kZSA8PSAweGZmZmYgPyBjb2RlIDogdW5kZWZpbmVkOwogIH0KICBjb250YWlucyhjb2RlKSB7CiAgICByZXR1cm4gTnVtYmVyLmlzSW50ZWdlcihjb2RlKSAmJiBjb2RlIDw9IDB4ZmZmZjsKICB9CiAgZm9yRWFjaChjYWxsYmFjaykgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gMHhmZmZmOyBpKyspIHsKICAgICAgY2FsbGJhY2soaSwgaSk7CiAgICB9CiAgfQogIGNoYXJDb2RlT2YodmFsdWUpIHsKICAgIHJldHVybiBOdW1iZXIuaXNJbnRlZ2VyKHZhbHVlKSAmJiB2YWx1ZSA8PSAweGZmZmYgPyB2YWx1ZSA6IC0xOwogIH0KICBnZXRNYXAoKSB7CiAgICBjb25zdCBtYXAgPSBuZXcgQXJyYXkoMHgxMDAwMCk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSAweGZmZmY7IGkrKykgewogICAgICBtYXBbaV0gPSBpOwogICAgfQogICAgcmV0dXJuIG1hcDsKICB9CiAgZ2V0IGxlbmd0aCgpIHsKICAgIHJldHVybiAweDEwMDAwOwogIH0KICBnZXQgaXNJZGVudGl0eUNNYXAoKSB7CiAgICB1bnJlYWNoYWJsZSgic2hvdWxkIG5vdCBhY2Nlc3MgLmlzSWRlbnRpdHlDTWFwIik7CiAgfQp9CmZ1bmN0aW9uIHN0clRvSW50KHN0cikgewogIGxldCBhID0gMDsKICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykgewogICAgYSA9IGEgPDwgOCB8IHN0ci5jaGFyQ29kZUF0KGkpOwogIH0KICByZXR1cm4gYSA+Pj4gMDsKfQpmdW5jdGlvbiBleHBlY3RTdHJpbmcob2JqKSB7CiAgaWYgKHR5cGVvZiBvYmogIT09ICJzdHJpbmciKSB7CiAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIk1hbGZvcm1lZCBDTWFwOiBleHBlY3RlZCBzdHJpbmcuIik7CiAgfQp9CmZ1bmN0aW9uIGV4cGVjdEludChvYmopIHsKICBpZiAoIU51bWJlci5pc0ludGVnZXIob2JqKSkgewogICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJNYWxmb3JtZWQgQ01hcDogZXhwZWN0ZWQgaW50LiIpOwogIH0KfQpmdW5jdGlvbiBwYXJzZUJmQ2hhcihjTWFwLCBsZXhlcikgewogIHdoaWxlICh0cnVlKSB7CiAgICBsZXQgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBpZiAob2JqID09PSBFT0YpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoaXNDbWQob2JqLCAiZW5kYmZjaGFyIikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZXhwZWN0U3RyaW5nKG9iaik7CiAgICBjb25zdCBzcmMgPSBzdHJUb0ludChvYmopOwogICAgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBleHBlY3RTdHJpbmcob2JqKTsKICAgIGNvbnN0IGRzdCA9IG9iajsKICAgIGNNYXAubWFwT25lKHNyYywgZHN0KTsKICB9Cn0KZnVuY3Rpb24gcGFyc2VCZlJhbmdlKGNNYXAsIGxleGVyKSB7CiAgd2hpbGUgKHRydWUpIHsKICAgIGxldCBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgIGlmIChvYmogPT09IEVPRikgewogICAgICBicmVhazsKICAgIH0KICAgIGlmIChpc0NtZChvYmosICJlbmRiZnJhbmdlIikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZXhwZWN0U3RyaW5nKG9iaik7CiAgICBjb25zdCBsb3cgPSBzdHJUb0ludChvYmopOwogICAgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBleHBlY3RTdHJpbmcob2JqKTsKICAgIGNvbnN0IGhpZ2ggPSBzdHJUb0ludChvYmopOwogICAgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihvYmopIHx8IHR5cGVvZiBvYmogPT09ICJzdHJpbmciKSB7CiAgICAgIGNvbnN0IGRzdExvdyA9IE51bWJlci5pc0ludGVnZXIob2JqKSA/IFN0cmluZy5mcm9tQ2hhckNvZGUob2JqKSA6IG9iajsKICAgICAgY01hcC5tYXBCZlJhbmdlKGxvdywgaGlnaCwgZHN0TG93KTsKICAgIH0gZWxzZSBpZiAoaXNDbWQob2JqLCAiWyIpKSB7CiAgICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgICBjb25zdCBhcnJheSA9IFtdOwogICAgICB3aGlsZSAoIWlzQ21kKG9iaiwgIl0iKSAmJiBvYmogIT09IEVPRikgewogICAgICAgIGFycmF5LnB1c2gob2JqKTsKICAgICAgICBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgICAgfQogICAgICBjTWFwLm1hcEJmUmFuZ2VUb0FycmF5KGxvdywgaGlnaCwgYXJyYXkpOwogICAgfSBlbHNlIHsKICAgICAgYnJlYWs7CiAgICB9CiAgfQogIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBiZiByYW5nZS4iKTsKfQpmdW5jdGlvbiBwYXJzZUNpZENoYXIoY01hcCwgbGV4ZXIpIHsKICB3aGlsZSAodHJ1ZSkgewogICAgbGV0IG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgaWYgKG9iaiA9PT0gRU9GKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgaWYgKGlzQ21kKG9iaiwgImVuZGNpZGNoYXIiKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBleHBlY3RTdHJpbmcob2JqKTsKICAgIGNvbnN0IHNyYyA9IHN0clRvSW50KG9iaik7CiAgICBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgIGV4cGVjdEludChvYmopOwogICAgY29uc3QgZHN0ID0gb2JqOwogICAgY01hcC5tYXBPbmUoc3JjLCBkc3QpOwogIH0KfQpmdW5jdGlvbiBwYXJzZUNpZFJhbmdlKGNNYXAsIGxleGVyKSB7CiAgd2hpbGUgKHRydWUpIHsKICAgIGxldCBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgIGlmIChvYmogPT09IEVPRikgewogICAgICBicmVhazsKICAgIH0KICAgIGlmIChpc0NtZChvYmosICJlbmRjaWRyYW5nZSIpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGV4cGVjdFN0cmluZyhvYmopOwogICAgY29uc3QgbG93ID0gc3RyVG9JbnQob2JqKTsKICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgZXhwZWN0U3RyaW5nKG9iaik7CiAgICBjb25zdCBoaWdoID0gc3RyVG9JbnQob2JqKTsKICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgZXhwZWN0SW50KG9iaik7CiAgICBjb25zdCBkc3RMb3cgPSBvYmo7CiAgICBjTWFwLm1hcENpZFJhbmdlKGxvdywgaGlnaCwgZHN0TG93KTsKICB9Cn0KZnVuY3Rpb24gcGFyc2VDb2Rlc3BhY2VSYW5nZShjTWFwLCBsZXhlcikgewogIHdoaWxlICh0cnVlKSB7CiAgICBsZXQgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBpZiAob2JqID09PSBFT0YpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoaXNDbWQob2JqLCAiZW5kY29kZXNwYWNlcmFuZ2UiKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gInN0cmluZyIpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBjb25zdCBsb3cgPSBzdHJUb0ludChvYmopOwogICAgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gInN0cmluZyIpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBjb25zdCBoaWdoID0gc3RyVG9JbnQob2JqKTsKICAgIGNNYXAuYWRkQ29kZXNwYWNlUmFuZ2Uob2JqLmxlbmd0aCwgbG93LCBoaWdoKTsKICB9CiAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJJbnZhbGlkIGNvZGVzcGFjZSByYW5nZS4iKTsKfQpmdW5jdGlvbiBwYXJzZVdNb2RlKGNNYXAsIGxleGVyKSB7CiAgY29uc3Qgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgaWYgKE51bWJlci5pc0ludGVnZXIob2JqKSkgewogICAgY01hcC52ZXJ0aWNhbCA9ICEhb2JqOwogIH0KfQpmdW5jdGlvbiBwYXJzZUNNYXBOYW1lKGNNYXAsIGxleGVyKSB7CiAgY29uc3Qgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgaWYgKG9iaiBpbnN0YW5jZW9mIE5hbWUpIHsKICAgIGNNYXAubmFtZSA9IG9iai5uYW1lOwogIH0KfQphc3luYyBmdW5jdGlvbiBwYXJzZUNNYXAoY01hcCwgbGV4ZXIsIGZldGNoQnVpbHRJbkNNYXAsIHVzZUNNYXApIHsKICBsZXQgcHJldmlvdXMsIGVtYmVkZGVkVXNlQ01hcDsKICBvYmpMb29wOiB3aGlsZSAodHJ1ZSkgewogICAgdHJ5IHsKICAgICAgY29uc3Qgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICAgIGlmIChvYmogPT09IEVPRikgewogICAgICAgIGJyZWFrOwogICAgICB9IGVsc2UgaWYgKG9iaiBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICBpZiAob2JqLm5hbWUgPT09ICJXTW9kZSIpIHsKICAgICAgICAgIHBhcnNlV01vZGUoY01hcCwgbGV4ZXIpOwogICAgICAgIH0gZWxzZSBpZiAob2JqLm5hbWUgPT09ICJDTWFwTmFtZSIpIHsKICAgICAgICAgIHBhcnNlQ01hcE5hbWUoY01hcCwgbGV4ZXIpOwogICAgICAgIH0KICAgICAgICBwcmV2aW91cyA9IG9iajsKICAgICAgfSBlbHNlIGlmIChvYmogaW5zdGFuY2VvZiBDbWQpIHsKICAgICAgICBzd2l0Y2ggKG9iai5jbWQpIHsKICAgICAgICAgIGNhc2UgImVuZGNtYXAiOgogICAgICAgICAgICBicmVhayBvYmpMb29wOwogICAgICAgICAgY2FzZSAidXNlY21hcCI6CiAgICAgICAgICAgIGlmIChwcmV2aW91cyBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgICBlbWJlZGRlZFVzZUNNYXAgPSBwcmV2aW91cy5uYW1lOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiYmVnaW5jb2Rlc3BhY2VyYW5nZSI6CiAgICAgICAgICAgIHBhcnNlQ29kZXNwYWNlUmFuZ2UoY01hcCwgbGV4ZXIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImJlZ2luYmZjaGFyIjoKICAgICAgICAgICAgcGFyc2VCZkNoYXIoY01hcCwgbGV4ZXIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImJlZ2luY2lkY2hhciI6CiAgICAgICAgICAgIHBhcnNlQ2lkQ2hhcihjTWFwLCBsZXhlcik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiYmVnaW5iZnJhbmdlIjoKICAgICAgICAgICAgcGFyc2VCZlJhbmdlKGNNYXAsIGxleGVyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJiZWdpbmNpZHJhbmdlIjoKICAgICAgICAgICAgcGFyc2VDaWRSYW5nZShjTWFwLCBsZXhlcik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICB3YXJuKCJJbnZhbGlkIGNNYXAgZGF0YTogIiArIGV4KTsKICAgICAgY29udGludWU7CiAgICB9CiAgfQogIGlmICghdXNlQ01hcCAmJiBlbWJlZGRlZFVzZUNNYXApIHsKICAgIHVzZUNNYXAgPSBlbWJlZGRlZFVzZUNNYXA7CiAgfQogIGlmICh1c2VDTWFwKSB7CiAgICByZXR1cm4gZXh0ZW5kQ01hcChjTWFwLCBmZXRjaEJ1aWx0SW5DTWFwLCB1c2VDTWFwKTsKICB9CiAgcmV0dXJuIGNNYXA7Cn0KYXN5bmMgZnVuY3Rpb24gZXh0ZW5kQ01hcChjTWFwLCBmZXRjaEJ1aWx0SW5DTWFwLCB1c2VDTWFwKSB7CiAgY01hcC51c2VDTWFwID0gYXdhaXQgY3JlYXRlQnVpbHRJbkNNYXAodXNlQ01hcCwgZmV0Y2hCdWlsdEluQ01hcCk7CiAgaWYgKGNNYXAubnVtQ29kZXNwYWNlUmFuZ2VzID09PSAwKSB7CiAgICBjb25zdCB1c2VDb2Rlc3BhY2VSYW5nZXMgPSBjTWFwLnVzZUNNYXAuY29kZXNwYWNlUmFuZ2VzOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1c2VDb2Rlc3BhY2VSYW5nZXMubGVuZ3RoOyBpKyspIHsKICAgICAgY01hcC5jb2Rlc3BhY2VSYW5nZXNbaV0gPSB1c2VDb2Rlc3BhY2VSYW5nZXNbaV0uc2xpY2UoKTsKICAgIH0KICAgIGNNYXAubnVtQ29kZXNwYWNlUmFuZ2VzID0gY01hcC51c2VDTWFwLm51bUNvZGVzcGFjZVJhbmdlczsKICB9CiAgY01hcC51c2VDTWFwLmZvckVhY2goZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgIGlmICghY01hcC5jb250YWlucyhrZXkpKSB7CiAgICAgIGNNYXAubWFwT25lKGtleSwgdmFsdWUpOwogICAgfQogIH0pOwogIHJldHVybiBjTWFwOwp9CmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUJ1aWx0SW5DTWFwKG5hbWUsIGZldGNoQnVpbHRJbkNNYXApIHsKICBpZiAobmFtZSA9PT0gIklkZW50aXR5LUgiKSB7CiAgICByZXR1cm4gbmV3IElkZW50aXR5Q01hcChmYWxzZSwgMik7CiAgfSBlbHNlIGlmIChuYW1lID09PSAiSWRlbnRpdHktViIpIHsKICAgIHJldHVybiBuZXcgSWRlbnRpdHlDTWFwKHRydWUsIDIpOwogIH0KICBpZiAoIUJVSUxUX0lOX0NNQVBTLmluY2x1ZGVzKG5hbWUpKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gQ01hcCBuYW1lOiAiICsgbmFtZSk7CiAgfQogIGlmICghZmV0Y2hCdWlsdEluQ01hcCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJCdWlsdC1pbiBDTWFwIHBhcmFtZXRlcnMgYXJlIG5vdCBwcm92aWRlZC4iKTsKICB9CiAgY29uc3QgewogICAgY01hcERhdGEsCiAgICBpc0NvbXByZXNzZWQKICB9ID0gYXdhaXQgZmV0Y2hCdWlsdEluQ01hcChuYW1lKTsKICBjb25zdCBjTWFwID0gbmV3IENNYXAodHJ1ZSk7CiAgaWYgKGlzQ29tcHJlc3NlZCkgewogICAgcmV0dXJuIG5ldyBCaW5hcnlDTWFwUmVhZGVyKCkucHJvY2VzcyhjTWFwRGF0YSwgY01hcCwgdXNlQ01hcCA9PiBleHRlbmRDTWFwKGNNYXAsIGZldGNoQnVpbHRJbkNNYXAsIHVzZUNNYXApKTsKICB9CiAgY29uc3QgbGV4ZXIgPSBuZXcgTGV4ZXIobmV3IFN0cmVhbShjTWFwRGF0YSkpOwogIHJldHVybiBwYXJzZUNNYXAoY01hcCwgbGV4ZXIsIGZldGNoQnVpbHRJbkNNYXAsIG51bGwpOwp9CmNsYXNzIENNYXBGYWN0b3J5IHsKICBzdGF0aWMgYXN5bmMgY3JlYXRlKHsKICAgIGVuY29kaW5nLAogICAgZmV0Y2hCdWlsdEluQ01hcCwKICAgIHVzZUNNYXAKICB9KSB7CiAgICBpZiAoZW5jb2RpbmcgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgIHJldHVybiBjcmVhdGVCdWlsdEluQ01hcChlbmNvZGluZy5uYW1lLCBmZXRjaEJ1aWx0SW5DTWFwKTsKICAgIH0gZWxzZSBpZiAoZW5jb2RpbmcgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgIGNvbnN0IHBhcnNlZENNYXAgPSBhd2FpdCBwYXJzZUNNYXAobmV3IENNYXAoKSwgbmV3IExleGVyKGVuY29kaW5nKSwgZmV0Y2hCdWlsdEluQ01hcCwgdXNlQ01hcCk7CiAgICAgIGlmIChwYXJzZWRDTWFwLmlzSWRlbnRpdHlDTWFwKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZUJ1aWx0SW5DTWFwKHBhcnNlZENNYXAubmFtZSwgZmV0Y2hCdWlsdEluQ01hcCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHBhcnNlZENNYXA7CiAgICB9CiAgICB0aHJvdyBuZXcgRXJyb3IoIkVuY29kaW5nIHJlcXVpcmVkLiIpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvZW5jb2RpbmdzLmpzCmNvbnN0IEV4cGVydEVuY29kaW5nID0gWyIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgInNwYWNlIiwgImV4Y2xhbXNtYWxsIiwgIkh1bmdhcnVtbGF1dHNtYWxsIiwgIiIsICJkb2xsYXJvbGRzdHlsZSIsICJkb2xsYXJzdXBlcmlvciIsICJhbXBlcnNhbmRzbWFsbCIsICJBY3V0ZXNtYWxsIiwgInBhcmVubGVmdHN1cGVyaW9yIiwgInBhcmVucmlnaHRzdXBlcmlvciIsICJ0d29kb3RlbmxlYWRlciIsICJvbmVkb3RlbmxlYWRlciIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgImZyYWN0aW9uIiwgInplcm9vbGRzdHlsZSIsICJvbmVvbGRzdHlsZSIsICJ0d29vbGRzdHlsZSIsICJ0aHJlZW9sZHN0eWxlIiwgImZvdXJvbGRzdHlsZSIsICJmaXZlb2xkc3R5bGUiLCAic2l4b2xkc3R5bGUiLCAic2V2ZW5vbGRzdHlsZSIsICJlaWdodG9sZHN0eWxlIiwgIm5pbmVvbGRzdHlsZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAiY29tbWFzdXBlcmlvciIsICJ0aHJlZXF1YXJ0ZXJzZW1kYXNoIiwgInBlcmlvZHN1cGVyaW9yIiwgInF1ZXN0aW9uc21hbGwiLCAiIiwgImFzdXBlcmlvciIsICJic3VwZXJpb3IiLCAiY2VudHN1cGVyaW9yIiwgImRzdXBlcmlvciIsICJlc3VwZXJpb3IiLCAiIiwgIiIsICIiLCAiaXN1cGVyaW9yIiwgIiIsICIiLCAibHN1cGVyaW9yIiwgIm1zdXBlcmlvciIsICJuc3VwZXJpb3IiLCAib3N1cGVyaW9yIiwgIiIsICIiLCAicnN1cGVyaW9yIiwgInNzdXBlcmlvciIsICJ0c3VwZXJpb3IiLCAiIiwgImZmIiwgImZpIiwgImZsIiwgImZmaSIsICJmZmwiLCAicGFyZW5sZWZ0aW5mZXJpb3IiLCAiIiwgInBhcmVucmlnaHRpbmZlcmlvciIsICJDaXJjdW1mbGV4c21hbGwiLCAiaHlwaGVuc3VwZXJpb3IiLCAiR3JhdmVzbWFsbCIsICJBc21hbGwiLCAiQnNtYWxsIiwgIkNzbWFsbCIsICJEc21hbGwiLCAiRXNtYWxsIiwgIkZzbWFsbCIsICJHc21hbGwiLCAiSHNtYWxsIiwgIklzbWFsbCIsICJKc21hbGwiLCAiS3NtYWxsIiwgIkxzbWFsbCIsICJNc21hbGwiLCAiTnNtYWxsIiwgIk9zbWFsbCIsICJQc21hbGwiLCAiUXNtYWxsIiwgIlJzbWFsbCIsICJTc21hbGwiLCAiVHNtYWxsIiwgIlVzbWFsbCIsICJWc21hbGwiLCAiV3NtYWxsIiwgIlhzbWFsbCIsICJZc21hbGwiLCAiWnNtYWxsIiwgImNvbG9ubW9uZXRhcnkiLCAib25lZml0dGVkIiwgInJ1cGlhaCIsICJUaWxkZXNtYWxsIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJleGNsYW1kb3duc21hbGwiLCAiY2VudG9sZHN0eWxlIiwgIkxzbGFzaHNtYWxsIiwgIiIsICIiLCAiU2Nhcm9uc21hbGwiLCAiWmNhcm9uc21hbGwiLCAiRGllcmVzaXNzbWFsbCIsICJCcmV2ZXNtYWxsIiwgIkNhcm9uc21hbGwiLCAiIiwgIkRvdGFjY2VudHNtYWxsIiwgIiIsICIiLCAiTWFjcm9uc21hbGwiLCAiIiwgIiIsICJmaWd1cmVkYXNoIiwgImh5cGhlbmluZmVyaW9yIiwgIiIsICIiLCAiT2dvbmVrc21hbGwiLCAiUmluZ3NtYWxsIiwgIkNlZGlsbGFzbWFsbCIsICIiLCAiIiwgIiIsICJvbmVxdWFydGVyIiwgIm9uZWhhbGYiLCAidGhyZWVxdWFydGVycyIsICJxdWVzdGlvbmRvd25zbWFsbCIsICJvbmVlaWdodGgiLCAidGhyZWVlaWdodGhzIiwgImZpdmVlaWdodGhzIiwgInNldmVuZWlnaHRocyIsICJvbmV0aGlyZCIsICJ0d290aGlyZHMiLCAiIiwgIiIsICJ6ZXJvc3VwZXJpb3IiLCAib25lc3VwZXJpb3IiLCAidHdvc3VwZXJpb3IiLCAidGhyZWVzdXBlcmlvciIsICJmb3Vyc3VwZXJpb3IiLCAiZml2ZXN1cGVyaW9yIiwgInNpeHN1cGVyaW9yIiwgInNldmVuc3VwZXJpb3IiLCAiZWlnaHRzdXBlcmlvciIsICJuaW5lc3VwZXJpb3IiLCAiemVyb2luZmVyaW9yIiwgIm9uZWluZmVyaW9yIiwgInR3b2luZmVyaW9yIiwgInRocmVlaW5mZXJpb3IiLCAiZm91cmluZmVyaW9yIiwgImZpdmVpbmZlcmlvciIsICJzaXhpbmZlcmlvciIsICJzZXZlbmluZmVyaW9yIiwgImVpZ2h0aW5mZXJpb3IiLCAibmluZWluZmVyaW9yIiwgImNlbnRpbmZlcmlvciIsICJkb2xsYXJpbmZlcmlvciIsICJwZXJpb2RpbmZlcmlvciIsICJjb21tYWluZmVyaW9yIiwgIkFncmF2ZXNtYWxsIiwgIkFhY3V0ZXNtYWxsIiwgIkFjaXJjdW1mbGV4c21hbGwiLCAiQXRpbGRlc21hbGwiLCAiQWRpZXJlc2lzc21hbGwiLCAiQXJpbmdzbWFsbCIsICJBRXNtYWxsIiwgIkNjZWRpbGxhc21hbGwiLCAiRWdyYXZlc21hbGwiLCAiRWFjdXRlc21hbGwiLCAiRWNpcmN1bWZsZXhzbWFsbCIsICJFZGllcmVzaXNzbWFsbCIsICJJZ3JhdmVzbWFsbCIsICJJYWN1dGVzbWFsbCIsICJJY2lyY3VtZmxleHNtYWxsIiwgIklkaWVyZXNpc3NtYWxsIiwgIkV0aHNtYWxsIiwgIk50aWxkZXNtYWxsIiwgIk9ncmF2ZXNtYWxsIiwgIk9hY3V0ZXNtYWxsIiwgIk9jaXJjdW1mbGV4c21hbGwiLCAiT3RpbGRlc21hbGwiLCAiT2RpZXJlc2lzc21hbGwiLCAiT0VzbWFsbCIsICJPc2xhc2hzbWFsbCIsICJVZ3JhdmVzbWFsbCIsICJVYWN1dGVzbWFsbCIsICJVY2lyY3VtZmxleHNtYWxsIiwgIlVkaWVyZXNpc3NtYWxsIiwgIllhY3V0ZXNtYWxsIiwgIlRob3Juc21hbGwiLCAiWWRpZXJlc2lzc21hbGwiXTsKY29uc3QgTWFjRXhwZXJ0RW5jb2RpbmcgPSBbIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAic3BhY2UiLCAiZXhjbGFtc21hbGwiLCAiSHVuZ2FydW1sYXV0c21hbGwiLCAiY2VudG9sZHN0eWxlIiwgImRvbGxhcm9sZHN0eWxlIiwgImRvbGxhcnN1cGVyaW9yIiwgImFtcGVyc2FuZHNtYWxsIiwgIkFjdXRlc21hbGwiLCAicGFyZW5sZWZ0c3VwZXJpb3IiLCAicGFyZW5yaWdodHN1cGVyaW9yIiwgInR3b2RvdGVubGVhZGVyIiwgIm9uZWRvdGVubGVhZGVyIiwgImNvbW1hIiwgImh5cGhlbiIsICJwZXJpb2QiLCAiZnJhY3Rpb24iLCAiemVyb29sZHN0eWxlIiwgIm9uZW9sZHN0eWxlIiwgInR3b29sZHN0eWxlIiwgInRocmVlb2xkc3R5bGUiLCAiZm91cm9sZHN0eWxlIiwgImZpdmVvbGRzdHlsZSIsICJzaXhvbGRzdHlsZSIsICJzZXZlbm9sZHN0eWxlIiwgImVpZ2h0b2xkc3R5bGUiLCAibmluZW9sZHN0eWxlIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICIiLCAidGhyZWVxdWFydGVyc2VtZGFzaCIsICIiLCAicXVlc3Rpb25zbWFsbCIsICIiLCAiIiwgIiIsICIiLCAiRXRoc21hbGwiLCAiIiwgIiIsICJvbmVxdWFydGVyIiwgIm9uZWhhbGYiLCAidGhyZWVxdWFydGVycyIsICJvbmVlaWdodGgiLCAidGhyZWVlaWdodGhzIiwgImZpdmVlaWdodGhzIiwgInNldmVuZWlnaHRocyIsICJvbmV0aGlyZCIsICJ0d290aGlyZHMiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiZmYiLCAiZmkiLCAiZmwiLCAiZmZpIiwgImZmbCIsICJwYXJlbmxlZnRpbmZlcmlvciIsICIiLCAicGFyZW5yaWdodGluZmVyaW9yIiwgIkNpcmN1bWZsZXhzbWFsbCIsICJoeXBoZW5pbmZlcmlvciIsICJHcmF2ZXNtYWxsIiwgIkFzbWFsbCIsICJCc21hbGwiLCAiQ3NtYWxsIiwgIkRzbWFsbCIsICJFc21hbGwiLCAiRnNtYWxsIiwgIkdzbWFsbCIsICJIc21hbGwiLCAiSXNtYWxsIiwgIkpzbWFsbCIsICJLc21hbGwiLCAiTHNtYWxsIiwgIk1zbWFsbCIsICJOc21hbGwiLCAiT3NtYWxsIiwgIlBzbWFsbCIsICJRc21hbGwiLCAiUnNtYWxsIiwgIlNzbWFsbCIsICJUc21hbGwiLCAiVXNtYWxsIiwgIlZzbWFsbCIsICJXc21hbGwiLCAiWHNtYWxsIiwgIllzbWFsbCIsICJac21hbGwiLCAiY29sb25tb25ldGFyeSIsICJvbmVmaXR0ZWQiLCAicnVwaWFoIiwgIlRpbGRlc21hbGwiLCAiIiwgIiIsICJhc3VwZXJpb3IiLCAiY2VudHN1cGVyaW9yIiwgIiIsICIiLCAiIiwgIiIsICJBYWN1dGVzbWFsbCIsICJBZ3JhdmVzbWFsbCIsICJBY2lyY3VtZmxleHNtYWxsIiwgIkFkaWVyZXNpc3NtYWxsIiwgIkF0aWxkZXNtYWxsIiwgIkFyaW5nc21hbGwiLCAiQ2NlZGlsbGFzbWFsbCIsICJFYWN1dGVzbWFsbCIsICJFZ3JhdmVzbWFsbCIsICJFY2lyY3VtZmxleHNtYWxsIiwgIkVkaWVyZXNpc3NtYWxsIiwgIklhY3V0ZXNtYWxsIiwgIklncmF2ZXNtYWxsIiwgIkljaXJjdW1mbGV4c21hbGwiLCAiSWRpZXJlc2lzc21hbGwiLCAiTnRpbGRlc21hbGwiLCAiT2FjdXRlc21hbGwiLCAiT2dyYXZlc21hbGwiLCAiT2NpcmN1bWZsZXhzbWFsbCIsICJPZGllcmVzaXNzbWFsbCIsICJPdGlsZGVzbWFsbCIsICJVYWN1dGVzbWFsbCIsICJVZ3JhdmVzbWFsbCIsICJVY2lyY3VtZmxleHNtYWxsIiwgIlVkaWVyZXNpc3NtYWxsIiwgIiIsICJlaWdodHN1cGVyaW9yIiwgImZvdXJpbmZlcmlvciIsICJ0aHJlZWluZmVyaW9yIiwgInNpeGluZmVyaW9yIiwgImVpZ2h0aW5mZXJpb3IiLCAic2V2ZW5pbmZlcmlvciIsICJTY2Fyb25zbWFsbCIsICIiLCAiY2VudGluZmVyaW9yIiwgInR3b2luZmVyaW9yIiwgIiIsICJEaWVyZXNpc3NtYWxsIiwgIiIsICJDYXJvbnNtYWxsIiwgIm9zdXBlcmlvciIsICJmaXZlaW5mZXJpb3IiLCAiIiwgImNvbW1haW5mZXJpb3IiLCAicGVyaW9kaW5mZXJpb3IiLCAiWWFjdXRlc21hbGwiLCAiIiwgImRvbGxhcmluZmVyaW9yIiwgIiIsICIiLCAiVGhvcm5zbWFsbCIsICIiLCAibmluZWluZmVyaW9yIiwgInplcm9pbmZlcmlvciIsICJaY2Fyb25zbWFsbCIsICJBRXNtYWxsIiwgIk9zbGFzaHNtYWxsIiwgInF1ZXN0aW9uZG93bnNtYWxsIiwgIm9uZWluZmVyaW9yIiwgIkxzbGFzaHNtYWxsIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIkNlZGlsbGFzbWFsbCIsICIiLCAiIiwgIiIsICIiLCAiIiwgIk9Fc21hbGwiLCAiZmlndXJlZGFzaCIsICJoeXBoZW5zdXBlcmlvciIsICIiLCAiIiwgIiIsICIiLCAiZXhjbGFtZG93bnNtYWxsIiwgIiIsICJZZGllcmVzaXNzbWFsbCIsICIiLCAib25lc3VwZXJpb3IiLCAidHdvc3VwZXJpb3IiLCAidGhyZWVzdXBlcmlvciIsICJmb3Vyc3VwZXJpb3IiLCAiZml2ZXN1cGVyaW9yIiwgInNpeHN1cGVyaW9yIiwgInNldmVuc3VwZXJpb3IiLCAibmluZXN1cGVyaW9yIiwgInplcm9zdXBlcmlvciIsICIiLCAiZXN1cGVyaW9yIiwgInJzdXBlcmlvciIsICJ0c3VwZXJpb3IiLCAiIiwgIiIsICJpc3VwZXJpb3IiLCAic3N1cGVyaW9yIiwgImRzdXBlcmlvciIsICIiLCAiIiwgIiIsICIiLCAiIiwgImxzdXBlcmlvciIsICJPZ29uZWtzbWFsbCIsICJCcmV2ZXNtYWxsIiwgIk1hY3JvbnNtYWxsIiwgImJzdXBlcmlvciIsICJuc3VwZXJpb3IiLCAibXN1cGVyaW9yIiwgImNvbW1hc3VwZXJpb3IiLCAicGVyaW9kc3VwZXJpb3IiLCAiRG90YWNjZW50c21hbGwiLCAiUmluZ3NtYWxsIiwgIiIsICIiLCAiIiwgIiJdOwpjb25zdCBNYWNSb21hbkVuY29kaW5nID0gWyIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgInNwYWNlIiwgImV4Y2xhbSIsICJxdW90ZWRibCIsICJudW1iZXJzaWduIiwgImRvbGxhciIsICJwZXJjZW50IiwgImFtcGVyc2FuZCIsICJxdW90ZXNpbmdsZSIsICJwYXJlbmxlZnQiLCAicGFyZW5yaWdodCIsICJhc3RlcmlzayIsICJwbHVzIiwgImNvbW1hIiwgImh5cGhlbiIsICJwZXJpb2QiLCAic2xhc2giLCAiemVybyIsICJvbmUiLCAidHdvIiwgInRocmVlIiwgImZvdXIiLCAiZml2ZSIsICJzaXgiLCAic2V2ZW4iLCAiZWlnaHQiLCAibmluZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAibGVzcyIsICJlcXVhbCIsICJncmVhdGVyIiwgInF1ZXN0aW9uIiwgImF0IiwgIkEiLCAiQiIsICJDIiwgIkQiLCAiRSIsICJGIiwgIkciLCAiSCIsICJJIiwgIkoiLCAiSyIsICJMIiwgIk0iLCAiTiIsICJPIiwgIlAiLCAiUSIsICJSIiwgIlMiLCAiVCIsICJVIiwgIlYiLCAiVyIsICJYIiwgIlkiLCAiWiIsICJicmFja2V0bGVmdCIsICJiYWNrc2xhc2giLCAiYnJhY2tldHJpZ2h0IiwgImFzY2lpY2lyY3VtIiwgInVuZGVyc2NvcmUiLCAiZ3JhdmUiLCAiYSIsICJiIiwgImMiLCAiZCIsICJlIiwgImYiLCAiZyIsICJoIiwgImkiLCAiaiIsICJrIiwgImwiLCAibSIsICJuIiwgIm8iLCAicCIsICJxIiwgInIiLCAicyIsICJ0IiwgInUiLCAidiIsICJ3IiwgIngiLCAieSIsICJ6IiwgImJyYWNlbGVmdCIsICJiYXIiLCAiYnJhY2VyaWdodCIsICJhc2NpaXRpbGRlIiwgIiIsICJBZGllcmVzaXMiLCAiQXJpbmciLCAiQ2NlZGlsbGEiLCAiRWFjdXRlIiwgIk50aWxkZSIsICJPZGllcmVzaXMiLCAiVWRpZXJlc2lzIiwgImFhY3V0ZSIsICJhZ3JhdmUiLCAiYWNpcmN1bWZsZXgiLCAiYWRpZXJlc2lzIiwgImF0aWxkZSIsICJhcmluZyIsICJjY2VkaWxsYSIsICJlYWN1dGUiLCAiZWdyYXZlIiwgImVjaXJjdW1mbGV4IiwgImVkaWVyZXNpcyIsICJpYWN1dGUiLCAiaWdyYXZlIiwgImljaXJjdW1mbGV4IiwgImlkaWVyZXNpcyIsICJudGlsZGUiLCAib2FjdXRlIiwgIm9ncmF2ZSIsICJvY2lyY3VtZmxleCIsICJvZGllcmVzaXMiLCAib3RpbGRlIiwgInVhY3V0ZSIsICJ1Z3JhdmUiLCAidWNpcmN1bWZsZXgiLCAidWRpZXJlc2lzIiwgImRhZ2dlciIsICJkZWdyZWUiLCAiY2VudCIsICJzdGVybGluZyIsICJzZWN0aW9uIiwgImJ1bGxldCIsICJwYXJhZ3JhcGgiLCAiZ2VybWFuZGJscyIsICJyZWdpc3RlcmVkIiwgImNvcHlyaWdodCIsICJ0cmFkZW1hcmsiLCAiYWN1dGUiLCAiZGllcmVzaXMiLCAibm90ZXF1YWwiLCAiQUUiLCAiT3NsYXNoIiwgImluZmluaXR5IiwgInBsdXNtaW51cyIsICJsZXNzZXF1YWwiLCAiZ3JlYXRlcmVxdWFsIiwgInllbiIsICJtdSIsICJwYXJ0aWFsZGlmZiIsICJzdW1tYXRpb24iLCAicHJvZHVjdCIsICJwaSIsICJpbnRlZ3JhbCIsICJvcmRmZW1pbmluZSIsICJvcmRtYXNjdWxpbmUiLCAiT21lZ2EiLCAiYWUiLCAib3NsYXNoIiwgInF1ZXN0aW9uZG93biIsICJleGNsYW1kb3duIiwgImxvZ2ljYWxub3QiLCAicmFkaWNhbCIsICJmbG9yaW4iLCAiYXBwcm94ZXF1YWwiLCAiRGVsdGEiLCAiZ3VpbGxlbW90bGVmdCIsICJndWlsbGVtb3RyaWdodCIsICJlbGxpcHNpcyIsICJzcGFjZSIsICJBZ3JhdmUiLCAiQXRpbGRlIiwgIk90aWxkZSIsICJPRSIsICJvZSIsICJlbmRhc2giLCAiZW1kYXNoIiwgInF1b3RlZGJsbGVmdCIsICJxdW90ZWRibHJpZ2h0IiwgInF1b3RlbGVmdCIsICJxdW90ZXJpZ2h0IiwgImRpdmlkZSIsICJsb3plbmdlIiwgInlkaWVyZXNpcyIsICJZZGllcmVzaXMiLCAiZnJhY3Rpb24iLCAiY3VycmVuY3kiLCAiZ3VpbHNpbmdsbGVmdCIsICJndWlsc2luZ2xyaWdodCIsICJmaSIsICJmbCIsICJkYWdnZXJkYmwiLCAicGVyaW9kY2VudGVyZWQiLCAicXVvdGVzaW5nbGJhc2UiLCAicXVvdGVkYmxiYXNlIiwgInBlcnRob3VzYW5kIiwgIkFjaXJjdW1mbGV4IiwgIkVjaXJjdW1mbGV4IiwgIkFhY3V0ZSIsICJFZGllcmVzaXMiLCAiRWdyYXZlIiwgIklhY3V0ZSIsICJJY2lyY3VtZmxleCIsICJJZGllcmVzaXMiLCAiSWdyYXZlIiwgIk9hY3V0ZSIsICJPY2lyY3VtZmxleCIsICJhcHBsZSIsICJPZ3JhdmUiLCAiVWFjdXRlIiwgIlVjaXJjdW1mbGV4IiwgIlVncmF2ZSIsICJkb3RsZXNzaSIsICJjaXJjdW1mbGV4IiwgInRpbGRlIiwgIm1hY3JvbiIsICJicmV2ZSIsICJkb3RhY2NlbnQiLCAicmluZyIsICJjZWRpbGxhIiwgImh1bmdhcnVtbGF1dCIsICJvZ29uZWsiLCAiY2Fyb24iXTsKY29uc3QgU3RhbmRhcmRFbmNvZGluZyA9IFsiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJzcGFjZSIsICJleGNsYW0iLCAicXVvdGVkYmwiLCAibnVtYmVyc2lnbiIsICJkb2xsYXIiLCAicGVyY2VudCIsICJhbXBlcnNhbmQiLCAicXVvdGVyaWdodCIsICJwYXJlbmxlZnQiLCAicGFyZW5yaWdodCIsICJhc3RlcmlzayIsICJwbHVzIiwgImNvbW1hIiwgImh5cGhlbiIsICJwZXJpb2QiLCAic2xhc2giLCAiemVybyIsICJvbmUiLCAidHdvIiwgInRocmVlIiwgImZvdXIiLCAiZml2ZSIsICJzaXgiLCAic2V2ZW4iLCAiZWlnaHQiLCAibmluZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAibGVzcyIsICJlcXVhbCIsICJncmVhdGVyIiwgInF1ZXN0aW9uIiwgImF0IiwgIkEiLCAiQiIsICJDIiwgIkQiLCAiRSIsICJGIiwgIkciLCAiSCIsICJJIiwgIkoiLCAiSyIsICJMIiwgIk0iLCAiTiIsICJPIiwgIlAiLCAiUSIsICJSIiwgIlMiLCAiVCIsICJVIiwgIlYiLCAiVyIsICJYIiwgIlkiLCAiWiIsICJicmFja2V0bGVmdCIsICJiYWNrc2xhc2giLCAiYnJhY2tldHJpZ2h0IiwgImFzY2lpY2lyY3VtIiwgInVuZGVyc2NvcmUiLCAicXVvdGVsZWZ0IiwgImEiLCAiYiIsICJjIiwgImQiLCAiZSIsICJmIiwgImciLCAiaCIsICJpIiwgImoiLCAiayIsICJsIiwgIm0iLCAibiIsICJvIiwgInAiLCAicSIsICJyIiwgInMiLCAidCIsICJ1IiwgInYiLCAidyIsICJ4IiwgInkiLCAieiIsICJicmFjZWxlZnQiLCAiYmFyIiwgImJyYWNlcmlnaHQiLCAiYXNjaWl0aWxkZSIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiZXhjbGFtZG93biIsICJjZW50IiwgInN0ZXJsaW5nIiwgImZyYWN0aW9uIiwgInllbiIsICJmbG9yaW4iLCAic2VjdGlvbiIsICJjdXJyZW5jeSIsICJxdW90ZXNpbmdsZSIsICJxdW90ZWRibGxlZnQiLCAiZ3VpbGxlbW90bGVmdCIsICJndWlsc2luZ2xsZWZ0IiwgImd1aWxzaW5nbHJpZ2h0IiwgImZpIiwgImZsIiwgIiIsICJlbmRhc2giLCAiZGFnZ2VyIiwgImRhZ2dlcmRibCIsICJwZXJpb2RjZW50ZXJlZCIsICIiLCAicGFyYWdyYXBoIiwgImJ1bGxldCIsICJxdW90ZXNpbmdsYmFzZSIsICJxdW90ZWRibGJhc2UiLCAicXVvdGVkYmxyaWdodCIsICJndWlsbGVtb3RyaWdodCIsICJlbGxpcHNpcyIsICJwZXJ0aG91c2FuZCIsICIiLCAicXVlc3Rpb25kb3duIiwgIiIsICJncmF2ZSIsICJhY3V0ZSIsICJjaXJjdW1mbGV4IiwgInRpbGRlIiwgIm1hY3JvbiIsICJicmV2ZSIsICJkb3RhY2NlbnQiLCAiZGllcmVzaXMiLCAiIiwgInJpbmciLCAiY2VkaWxsYSIsICIiLCAiaHVuZ2FydW1sYXV0IiwgIm9nb25layIsICJjYXJvbiIsICJlbWRhc2giLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIkFFIiwgIiIsICJvcmRmZW1pbmluZSIsICIiLCAiIiwgIiIsICIiLCAiTHNsYXNoIiwgIk9zbGFzaCIsICJPRSIsICJvcmRtYXNjdWxpbmUiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJhZSIsICIiLCAiIiwgIiIsICJkb3RsZXNzaSIsICIiLCAiIiwgImxzbGFzaCIsICJvc2xhc2giLCAib2UiLCAiZ2VybWFuZGJscyIsICIiLCAiIiwgIiIsICIiXTsKY29uc3QgV2luQW5zaUVuY29kaW5nID0gWyIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgInNwYWNlIiwgImV4Y2xhbSIsICJxdW90ZWRibCIsICJudW1iZXJzaWduIiwgImRvbGxhciIsICJwZXJjZW50IiwgImFtcGVyc2FuZCIsICJxdW90ZXNpbmdsZSIsICJwYXJlbmxlZnQiLCAicGFyZW5yaWdodCIsICJhc3RlcmlzayIsICJwbHVzIiwgImNvbW1hIiwgImh5cGhlbiIsICJwZXJpb2QiLCAic2xhc2giLCAiemVybyIsICJvbmUiLCAidHdvIiwgInRocmVlIiwgImZvdXIiLCAiZml2ZSIsICJzaXgiLCAic2V2ZW4iLCAiZWlnaHQiLCAibmluZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAibGVzcyIsICJlcXVhbCIsICJncmVhdGVyIiwgInF1ZXN0aW9uIiwgImF0IiwgIkEiLCAiQiIsICJDIiwgIkQiLCAiRSIsICJGIiwgIkciLCAiSCIsICJJIiwgIkoiLCAiSyIsICJMIiwgIk0iLCAiTiIsICJPIiwgIlAiLCAiUSIsICJSIiwgIlMiLCAiVCIsICJVIiwgIlYiLCAiVyIsICJYIiwgIlkiLCAiWiIsICJicmFja2V0bGVmdCIsICJiYWNrc2xhc2giLCAiYnJhY2tldHJpZ2h0IiwgImFzY2lpY2lyY3VtIiwgInVuZGVyc2NvcmUiLCAiZ3JhdmUiLCAiYSIsICJiIiwgImMiLCAiZCIsICJlIiwgImYiLCAiZyIsICJoIiwgImkiLCAiaiIsICJrIiwgImwiLCAibSIsICJuIiwgIm8iLCAicCIsICJxIiwgInIiLCAicyIsICJ0IiwgInUiLCAidiIsICJ3IiwgIngiLCAieSIsICJ6IiwgImJyYWNlbGVmdCIsICJiYXIiLCAiYnJhY2VyaWdodCIsICJhc2NpaXRpbGRlIiwgImJ1bGxldCIsICJFdXJvIiwgImJ1bGxldCIsICJxdW90ZXNpbmdsYmFzZSIsICJmbG9yaW4iLCAicXVvdGVkYmxiYXNlIiwgImVsbGlwc2lzIiwgImRhZ2dlciIsICJkYWdnZXJkYmwiLCAiY2lyY3VtZmxleCIsICJwZXJ0aG91c2FuZCIsICJTY2Fyb24iLCAiZ3VpbHNpbmdsbGVmdCIsICJPRSIsICJidWxsZXQiLCAiWmNhcm9uIiwgImJ1bGxldCIsICJidWxsZXQiLCAicXVvdGVsZWZ0IiwgInF1b3RlcmlnaHQiLCAicXVvdGVkYmxsZWZ0IiwgInF1b3RlZGJscmlnaHQiLCAiYnVsbGV0IiwgImVuZGFzaCIsICJlbWRhc2giLCAidGlsZGUiLCAidHJhZGVtYXJrIiwgInNjYXJvbiIsICJndWlsc2luZ2xyaWdodCIsICJvZSIsICJidWxsZXQiLCAiemNhcm9uIiwgIllkaWVyZXNpcyIsICJzcGFjZSIsICJleGNsYW1kb3duIiwgImNlbnQiLCAic3RlcmxpbmciLCAiY3VycmVuY3kiLCAieWVuIiwgImJyb2tlbmJhciIsICJzZWN0aW9uIiwgImRpZXJlc2lzIiwgImNvcHlyaWdodCIsICJvcmRmZW1pbmluZSIsICJndWlsbGVtb3RsZWZ0IiwgImxvZ2ljYWxub3QiLCAiaHlwaGVuIiwgInJlZ2lzdGVyZWQiLCAibWFjcm9uIiwgImRlZ3JlZSIsICJwbHVzbWludXMiLCAidHdvc3VwZXJpb3IiLCAidGhyZWVzdXBlcmlvciIsICJhY3V0ZSIsICJtdSIsICJwYXJhZ3JhcGgiLCAicGVyaW9kY2VudGVyZWQiLCAiY2VkaWxsYSIsICJvbmVzdXBlcmlvciIsICJvcmRtYXNjdWxpbmUiLCAiZ3VpbGxlbW90cmlnaHQiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAicXVlc3Rpb25kb3duIiwgIkFncmF2ZSIsICJBYWN1dGUiLCAiQWNpcmN1bWZsZXgiLCAiQXRpbGRlIiwgIkFkaWVyZXNpcyIsICJBcmluZyIsICJBRSIsICJDY2VkaWxsYSIsICJFZ3JhdmUiLCAiRWFjdXRlIiwgIkVjaXJjdW1mbGV4IiwgIkVkaWVyZXNpcyIsICJJZ3JhdmUiLCAiSWFjdXRlIiwgIkljaXJjdW1mbGV4IiwgIklkaWVyZXNpcyIsICJFdGgiLCAiTnRpbGRlIiwgIk9ncmF2ZSIsICJPYWN1dGUiLCAiT2NpcmN1bWZsZXgiLCAiT3RpbGRlIiwgIk9kaWVyZXNpcyIsICJtdWx0aXBseSIsICJPc2xhc2giLCAiVWdyYXZlIiwgIlVhY3V0ZSIsICJVY2lyY3VtZmxleCIsICJVZGllcmVzaXMiLCAiWWFjdXRlIiwgIlRob3JuIiwgImdlcm1hbmRibHMiLCAiYWdyYXZlIiwgImFhY3V0ZSIsICJhY2lyY3VtZmxleCIsICJhdGlsZGUiLCAiYWRpZXJlc2lzIiwgImFyaW5nIiwgImFlIiwgImNjZWRpbGxhIiwgImVncmF2ZSIsICJlYWN1dGUiLCAiZWNpcmN1bWZsZXgiLCAiZWRpZXJlc2lzIiwgImlncmF2ZSIsICJpYWN1dGUiLCAiaWNpcmN1bWZsZXgiLCAiaWRpZXJlc2lzIiwgImV0aCIsICJudGlsZGUiLCAib2dyYXZlIiwgIm9hY3V0ZSIsICJvY2lyY3VtZmxleCIsICJvdGlsZGUiLCAib2RpZXJlc2lzIiwgImRpdmlkZSIsICJvc2xhc2giLCAidWdyYXZlIiwgInVhY3V0ZSIsICJ1Y2lyY3VtZmxleCIsICJ1ZGllcmVzaXMiLCAieWFjdXRlIiwgInRob3JuIiwgInlkaWVyZXNpcyJdOwpjb25zdCBTeW1ib2xTZXRFbmNvZGluZyA9IFsiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJzcGFjZSIsICJleGNsYW0iLCAidW5pdmVyc2FsIiwgIm51bWJlcnNpZ24iLCAiZXhpc3RlbnRpYWwiLCAicGVyY2VudCIsICJhbXBlcnNhbmQiLCAic3VjaHRoYXQiLCAicGFyZW5sZWZ0IiwgInBhcmVucmlnaHQiLCAiYXN0ZXJpc2ttYXRoIiwgInBsdXMiLCAiY29tbWEiLCAibWludXMiLCAicGVyaW9kIiwgInNsYXNoIiwgInplcm8iLCAib25lIiwgInR3byIsICJ0aHJlZSIsICJmb3VyIiwgImZpdmUiLCAic2l4IiwgInNldmVuIiwgImVpZ2h0IiwgIm5pbmUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImxlc3MiLCAiZXF1YWwiLCAiZ3JlYXRlciIsICJxdWVzdGlvbiIsICJjb25ncnVlbnQiLCAiQWxwaGEiLCAiQmV0YSIsICJDaGkiLCAiRGVsdGEiLCAiRXBzaWxvbiIsICJQaGkiLCAiR2FtbWEiLCAiRXRhIiwgIklvdGEiLCAidGhldGExIiwgIkthcHBhIiwgIkxhbWJkYSIsICJNdSIsICJOdSIsICJPbWljcm9uIiwgIlBpIiwgIlRoZXRhIiwgIlJobyIsICJTaWdtYSIsICJUYXUiLCAiVXBzaWxvbiIsICJzaWdtYTEiLCAiT21lZ2EiLCAiWGkiLCAiUHNpIiwgIlpldGEiLCAiYnJhY2tldGxlZnQiLCAidGhlcmVmb3JlIiwgImJyYWNrZXRyaWdodCIsICJwZXJwZW5kaWN1bGFyIiwgInVuZGVyc2NvcmUiLCAicmFkaWNhbGV4IiwgImFscGhhIiwgImJldGEiLCAiY2hpIiwgImRlbHRhIiwgImVwc2lsb24iLCAicGhpIiwgImdhbW1hIiwgImV0YSIsICJpb3RhIiwgInBoaTEiLCAia2FwcGEiLCAibGFtYmRhIiwgIm11IiwgIm51IiwgIm9taWNyb24iLCAicGkiLCAidGhldGEiLCAicmhvIiwgInNpZ21hIiwgInRhdSIsICJ1cHNpbG9uIiwgIm9tZWdhMSIsICJvbWVnYSIsICJ4aSIsICJwc2kiLCAiemV0YSIsICJicmFjZWxlZnQiLCAiYmFyIiwgImJyYWNlcmlnaHQiLCAic2ltaWxhciIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJFdXJvIiwgIlVwc2lsb24xIiwgIm1pbnV0ZSIsICJsZXNzZXF1YWwiLCAiZnJhY3Rpb24iLCAiaW5maW5pdHkiLCAiZmxvcmluIiwgImNsdWIiLCAiZGlhbW9uZCIsICJoZWFydCIsICJzcGFkZSIsICJhcnJvd2JvdGgiLCAiYXJyb3dsZWZ0IiwgImFycm93dXAiLCAiYXJyb3dyaWdodCIsICJhcnJvd2Rvd24iLCAiZGVncmVlIiwgInBsdXNtaW51cyIsICJzZWNvbmQiLCAiZ3JlYXRlcmVxdWFsIiwgIm11bHRpcGx5IiwgInByb3BvcnRpb25hbCIsICJwYXJ0aWFsZGlmZiIsICJidWxsZXQiLCAiZGl2aWRlIiwgIm5vdGVxdWFsIiwgImVxdWl2YWxlbmNlIiwgImFwcHJveGVxdWFsIiwgImVsbGlwc2lzIiwgImFycm93dmVydGV4IiwgImFycm93aG9yaXpleCIsICJjYXJyaWFnZXJldHVybiIsICJhbGVwaCIsICJJZnJha3R1ciIsICJSZnJha3R1ciIsICJ3ZWllcnN0cmFzcyIsICJjaXJjbGVtdWx0aXBseSIsICJjaXJjbGVwbHVzIiwgImVtcHR5c2V0IiwgImludGVyc2VjdGlvbiIsICJ1bmlvbiIsICJwcm9wZXJzdXBlcnNldCIsICJyZWZsZXhzdXBlcnNldCIsICJub3RzdWJzZXQiLCAicHJvcGVyc3Vic2V0IiwgInJlZmxleHN1YnNldCIsICJlbGVtZW50IiwgIm5vdGVsZW1lbnQiLCAiYW5nbGUiLCAiZ3JhZGllbnQiLCAicmVnaXN0ZXJzZXJpZiIsICJjb3B5cmlnaHRzZXJpZiIsICJ0cmFkZW1hcmtzZXJpZiIsICJwcm9kdWN0IiwgInJhZGljYWwiLCAiZG90bWF0aCIsICJsb2dpY2Fsbm90IiwgImxvZ2ljYWxhbmQiLCAibG9naWNhbG9yIiwgImFycm93ZGJsYm90aCIsICJhcnJvd2RibGxlZnQiLCAiYXJyb3dkYmx1cCIsICJhcnJvd2RibHJpZ2h0IiwgImFycm93ZGJsZG93biIsICJsb3plbmdlIiwgImFuZ2xlbGVmdCIsICJyZWdpc3RlcnNhbnMiLCAiY29weXJpZ2h0c2FucyIsICJ0cmFkZW1hcmtzYW5zIiwgInN1bW1hdGlvbiIsICJwYXJlbmxlZnR0cCIsICJwYXJlbmxlZnRleCIsICJwYXJlbmxlZnRidCIsICJicmFja2V0bGVmdHRwIiwgImJyYWNrZXRsZWZ0ZXgiLCAiYnJhY2tldGxlZnRidCIsICJicmFjZWxlZnR0cCIsICJicmFjZWxlZnRtaWQiLCAiYnJhY2VsZWZ0YnQiLCAiYnJhY2VleCIsICIiLCAiYW5nbGVyaWdodCIsICJpbnRlZ3JhbCIsICJpbnRlZ3JhbHRwIiwgImludGVncmFsZXgiLCAiaW50ZWdyYWxidCIsICJwYXJlbnJpZ2h0dHAiLCAicGFyZW5yaWdodGV4IiwgInBhcmVucmlnaHRidCIsICJicmFja2V0cmlnaHR0cCIsICJicmFja2V0cmlnaHRleCIsICJicmFja2V0cmlnaHRidCIsICJicmFjZXJpZ2h0dHAiLCAiYnJhY2VyaWdodG1pZCIsICJicmFjZXJpZ2h0YnQiLCAiIl07CmNvbnN0IFphcGZEaW5nYmF0c0VuY29kaW5nID0gWyIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgInNwYWNlIiwgImExIiwgImEyIiwgImEyMDIiLCAiYTMiLCAiYTQiLCAiYTUiLCAiYTExOSIsICJhMTE4IiwgImExMTciLCAiYTExIiwgImExMiIsICJhMTMiLCAiYTE0IiwgImExNSIsICJhMTYiLCAiYTEwNSIsICJhMTciLCAiYTE4IiwgImExOSIsICJhMjAiLCAiYTIxIiwgImEyMiIsICJhMjMiLCAiYTI0IiwgImEyNSIsICJhMjYiLCAiYTI3IiwgImEyOCIsICJhNiIsICJhNyIsICJhOCIsICJhOSIsICJhMTAiLCAiYTI5IiwgImEzMCIsICJhMzEiLCAiYTMyIiwgImEzMyIsICJhMzQiLCAiYTM1IiwgImEzNiIsICJhMzciLCAiYTM4IiwgImEzOSIsICJhNDAiLCAiYTQxIiwgImE0MiIsICJhNDMiLCAiYTQ0IiwgImE0NSIsICJhNDYiLCAiYTQ3IiwgImE0OCIsICJhNDkiLCAiYTUwIiwgImE1MSIsICJhNTIiLCAiYTUzIiwgImE1NCIsICJhNTUiLCAiYTU2IiwgImE1NyIsICJhNTgiLCAiYTU5IiwgImE2MCIsICJhNjEiLCAiYTYyIiwgImE2MyIsICJhNjQiLCAiYTY1IiwgImE2NiIsICJhNjciLCAiYTY4IiwgImE2OSIsICJhNzAiLCAiYTcxIiwgImE3MiIsICJhNzMiLCAiYTc0IiwgImEyMDMiLCAiYTc1IiwgImEyMDQiLCAiYTc2IiwgImE3NyIsICJhNzgiLCAiYTc5IiwgImE4MSIsICJhODIiLCAiYTgzIiwgImE4NCIsICJhOTciLCAiYTk4IiwgImE5OSIsICJhMTAwIiwgIiIsICJhODkiLCAiYTkwIiwgImE5MyIsICJhOTQiLCAiYTkxIiwgImE5MiIsICJhMjA1IiwgImE4NSIsICJhMjA2IiwgImE4NiIsICJhODciLCAiYTg4IiwgImE5NSIsICJhOTYiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgImExMDEiLCAiYTEwMiIsICJhMTAzIiwgImExMDQiLCAiYTEwNiIsICJhMTA3IiwgImExMDgiLCAiYTExMiIsICJhMTExIiwgImExMTAiLCAiYTEwOSIsICJhMTIwIiwgImExMjEiLCAiYTEyMiIsICJhMTIzIiwgImExMjQiLCAiYTEyNSIsICJhMTI2IiwgImExMjciLCAiYTEyOCIsICJhMTI5IiwgImExMzAiLCAiYTEzMSIsICJhMTMyIiwgImExMzMiLCAiYTEzNCIsICJhMTM1IiwgImExMzYiLCAiYTEzNyIsICJhMTM4IiwgImExMzkiLCAiYTE0MCIsICJhMTQxIiwgImExNDIiLCAiYTE0MyIsICJhMTQ0IiwgImExNDUiLCAiYTE0NiIsICJhMTQ3IiwgImExNDgiLCAiYTE0OSIsICJhMTUwIiwgImExNTEiLCAiYTE1MiIsICJhMTUzIiwgImExNTQiLCAiYTE1NSIsICJhMTU2IiwgImExNTciLCAiYTE1OCIsICJhMTU5IiwgImExNjAiLCAiYTE2MSIsICJhMTYzIiwgImExNjQiLCAiYTE5NiIsICJhMTY1IiwgImExOTIiLCAiYTE2NiIsICJhMTY3IiwgImExNjgiLCAiYTE2OSIsICJhMTcwIiwgImExNzEiLCAiYTE3MiIsICJhMTczIiwgImExNjIiLCAiYTE3NCIsICJhMTc1IiwgImExNzYiLCAiYTE3NyIsICJhMTc4IiwgImExNzkiLCAiYTE5MyIsICJhMTgwIiwgImExOTkiLCAiYTE4MSIsICJhMjAwIiwgImExODIiLCAiIiwgImEyMDEiLCAiYTE4MyIsICJhMTg0IiwgImExOTciLCAiYTE4NSIsICJhMTk0IiwgImExOTgiLCAiYTE4NiIsICJhMTk1IiwgImExODciLCAiYTE4OCIsICJhMTg5IiwgImExOTAiLCAiYTE5MSIsICIiXTsKZnVuY3Rpb24gZ2V0RW5jb2RpbmcoZW5jb2RpbmdOYW1lKSB7CiAgc3dpdGNoIChlbmNvZGluZ05hbWUpIHsKICAgIGNhc2UgIldpbkFuc2lFbmNvZGluZyI6CiAgICAgIHJldHVybiBXaW5BbnNpRW5jb2Rpbmc7CiAgICBjYXNlICJTdGFuZGFyZEVuY29kaW5nIjoKICAgICAgcmV0dXJuIFN0YW5kYXJkRW5jb2Rpbmc7CiAgICBjYXNlICJNYWNSb21hbkVuY29kaW5nIjoKICAgICAgcmV0dXJuIE1hY1JvbWFuRW5jb2Rpbmc7CiAgICBjYXNlICJTeW1ib2xTZXRFbmNvZGluZyI6CiAgICAgIHJldHVybiBTeW1ib2xTZXRFbmNvZGluZzsKICAgIGNhc2UgIlphcGZEaW5nYmF0c0VuY29kaW5nIjoKICAgICAgcmV0dXJuIFphcGZEaW5nYmF0c0VuY29kaW5nOwogICAgY2FzZSAiRXhwZXJ0RW5jb2RpbmciOgogICAgICByZXR1cm4gRXhwZXJ0RW5jb2Rpbmc7CiAgICBjYXNlICJNYWNFeHBlcnRFbmNvZGluZyI6CiAgICAgIHJldHVybiBNYWNFeHBlcnRFbmNvZGluZzsKICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiBudWxsOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvZ2x5cGhsaXN0LmpzCgpjb25zdCBnZXRHbHlwaHNVbmljb2RlID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgdC5BID0gMHgwMDQxOwogIHQuQUUgPSAweDAwYzY7CiAgdC5BRWFjdXRlID0gMHgwMWZjOwogIHQuQUVtYWNyb24gPSAweDAxZTI7CiAgdC5BRXNtYWxsID0gMHhmN2U2OwogIHQuQWFjdXRlID0gMHgwMGMxOwogIHQuQWFjdXRlc21hbGwgPSAweGY3ZTE7CiAgdC5BYnJldmUgPSAweDAxMDI7CiAgdC5BYnJldmVhY3V0ZSA9IDB4MWVhZTsKICB0LkFicmV2ZWN5cmlsbGljID0gMHgwNGQwOwogIHQuQWJyZXZlZG90YmVsb3cgPSAweDFlYjY7CiAgdC5BYnJldmVncmF2ZSA9IDB4MWViMDsKICB0LkFicmV2ZWhvb2thYm92ZSA9IDB4MWViMjsKICB0LkFicmV2ZXRpbGRlID0gMHgxZWI0OwogIHQuQWNhcm9uID0gMHgwMWNkOwogIHQuQWNpcmNsZSA9IDB4MjRiNjsKICB0LkFjaXJjdW1mbGV4ID0gMHgwMGMyOwogIHQuQWNpcmN1bWZsZXhhY3V0ZSA9IDB4MWVhNDsKICB0LkFjaXJjdW1mbGV4ZG90YmVsb3cgPSAweDFlYWM7CiAgdC5BY2lyY3VtZmxleGdyYXZlID0gMHgxZWE2OwogIHQuQWNpcmN1bWZsZXhob29rYWJvdmUgPSAweDFlYTg7CiAgdC5BY2lyY3VtZmxleHNtYWxsID0gMHhmN2UyOwogIHQuQWNpcmN1bWZsZXh0aWxkZSA9IDB4MWVhYTsKICB0LkFjdXRlID0gMHhmNmM5OwogIHQuQWN1dGVzbWFsbCA9IDB4ZjdiNDsKICB0LkFjeXJpbGxpYyA9IDB4MDQxMDsKICB0LkFkYmxncmF2ZSA9IDB4MDIwMDsKICB0LkFkaWVyZXNpcyA9IDB4MDBjNDsKICB0LkFkaWVyZXNpc2N5cmlsbGljID0gMHgwNGQyOwogIHQuQWRpZXJlc2lzbWFjcm9uID0gMHgwMWRlOwogIHQuQWRpZXJlc2lzc21hbGwgPSAweGY3ZTQ7CiAgdC5BZG90YmVsb3cgPSAweDFlYTA7CiAgdC5BZG90bWFjcm9uID0gMHgwMWUwOwogIHQuQWdyYXZlID0gMHgwMGMwOwogIHQuQWdyYXZlc21hbGwgPSAweGY3ZTA7CiAgdC5BaG9va2Fib3ZlID0gMHgxZWEyOwogIHQuQWllY3lyaWxsaWMgPSAweDA0ZDQ7CiAgdC5BaW52ZXJ0ZWRicmV2ZSA9IDB4MDIwMjsKICB0LkFscGhhID0gMHgwMzkxOwogIHQuQWxwaGF0b25vcyA9IDB4MDM4NjsKICB0LkFtYWNyb24gPSAweDAxMDA7CiAgdC5BbW9ub3NwYWNlID0gMHhmZjIxOwogIHQuQW9nb25layA9IDB4MDEwNDsKICB0LkFyaW5nID0gMHgwMGM1OwogIHQuQXJpbmdhY3V0ZSA9IDB4MDFmYTsKICB0LkFyaW5nYmVsb3cgPSAweDFlMDA7CiAgdC5BcmluZ3NtYWxsID0gMHhmN2U1OwogIHQuQXNtYWxsID0gMHhmNzYxOwogIHQuQXRpbGRlID0gMHgwMGMzOwogIHQuQXRpbGRlc21hbGwgPSAweGY3ZTM7CiAgdC5BeWJhcm1lbmlhbiA9IDB4MDUzMTsKICB0LkIgPSAweDAwNDI7CiAgdC5CY2lyY2xlID0gMHgyNGI3OwogIHQuQmRvdGFjY2VudCA9IDB4MWUwMjsKICB0LkJkb3RiZWxvdyA9IDB4MWUwNDsKICB0LkJlY3lyaWxsaWMgPSAweDA0MTE7CiAgdC5CZW5hcm1lbmlhbiA9IDB4MDUzMjsKICB0LkJldGEgPSAweDAzOTI7CiAgdC5CaG9vayA9IDB4MDE4MTsKICB0LkJsaW5lYmVsb3cgPSAweDFlMDY7CiAgdC5CbW9ub3NwYWNlID0gMHhmZjIyOwogIHQuQnJldmVzbWFsbCA9IDB4ZjZmNDsKICB0LkJzbWFsbCA9IDB4Zjc2MjsKICB0LkJ0b3BiYXIgPSAweDAxODI7CiAgdC5DID0gMHgwMDQzOwogIHQuQ2Fhcm1lbmlhbiA9IDB4MDUzZTsKICB0LkNhY3V0ZSA9IDB4MDEwNjsKICB0LkNhcm9uID0gMHhmNmNhOwogIHQuQ2Fyb25zbWFsbCA9IDB4ZjZmNTsKICB0LkNjYXJvbiA9IDB4MDEwYzsKICB0LkNjZWRpbGxhID0gMHgwMGM3OwogIHQuQ2NlZGlsbGFhY3V0ZSA9IDB4MWUwODsKICB0LkNjZWRpbGxhc21hbGwgPSAweGY3ZTc7CiAgdC5DY2lyY2xlID0gMHgyNGI4OwogIHQuQ2NpcmN1bWZsZXggPSAweDAxMDg7CiAgdC5DZG90ID0gMHgwMTBhOwogIHQuQ2RvdGFjY2VudCA9IDB4MDEwYTsKICB0LkNlZGlsbGFzbWFsbCA9IDB4ZjdiODsKICB0LkNoYWFybWVuaWFuID0gMHgwNTQ5OwogIHQuQ2hlYWJraGFzaWFuY3lyaWxsaWMgPSAweDA0YmM7CiAgdC5DaGVjeXJpbGxpYyA9IDB4MDQyNzsKICB0LkNoZWRlc2NlbmRlcmFia2hhc2lhbmN5cmlsbGljID0gMHgwNGJlOwogIHQuQ2hlZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0YjY7CiAgdC5DaGVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGY0OwogIHQuQ2hlaGFybWVuaWFuID0gMHgwNTQzOwogIHQuQ2hla2hha2Fzc2lhbmN5cmlsbGljID0gMHgwNGNiOwogIHQuQ2hldmVydGljYWxzdHJva2VjeXJpbGxpYyA9IDB4MDRiODsKICB0LkNoaSA9IDB4MDNhNzsKICB0LkNob29rID0gMHgwMTg3OwogIHQuQ2lyY3VtZmxleHNtYWxsID0gMHhmNmY2OwogIHQuQ21vbm9zcGFjZSA9IDB4ZmYyMzsKICB0LkNvYXJtZW5pYW4gPSAweDA1NTE7CiAgdC5Dc21hbGwgPSAweGY3NjM7CiAgdC5EID0gMHgwMDQ0OwogIHQuRFogPSAweDAxZjE7CiAgdC5EWmNhcm9uID0gMHgwMWM0OwogIHQuRGFhcm1lbmlhbiA9IDB4MDUzNDsKICB0LkRhZnJpY2FuID0gMHgwMTg5OwogIHQuRGNhcm9uID0gMHgwMTBlOwogIHQuRGNlZGlsbGEgPSAweDFlMTA7CiAgdC5EY2lyY2xlID0gMHgyNGI5OwogIHQuRGNpcmN1bWZsZXhiZWxvdyA9IDB4MWUxMjsKICB0LkRjcm9hdCA9IDB4MDExMDsKICB0LkRkb3RhY2NlbnQgPSAweDFlMGE7CiAgdC5EZG90YmVsb3cgPSAweDFlMGM7CiAgdC5EZWN5cmlsbGljID0gMHgwNDE0OwogIHQuRGVpY29wdGljID0gMHgwM2VlOwogIHQuRGVsdGEgPSAweDIyMDY7CiAgdC5EZWx0YWdyZWVrID0gMHgwMzk0OwogIHQuRGhvb2sgPSAweDAxOGE7CiAgdC5EaWVyZXNpcyA9IDB4ZjZjYjsKICB0LkRpZXJlc2lzQWN1dGUgPSAweGY2Y2M7CiAgdC5EaWVyZXNpc0dyYXZlID0gMHhmNmNkOwogIHQuRGllcmVzaXNzbWFsbCA9IDB4ZjdhODsKICB0LkRpZ2FtbWFncmVlayA9IDB4MDNkYzsKICB0LkRqZWN5cmlsbGljID0gMHgwNDAyOwogIHQuRGxpbmViZWxvdyA9IDB4MWUwZTsKICB0LkRtb25vc3BhY2UgPSAweGZmMjQ7CiAgdC5Eb3RhY2NlbnRzbWFsbCA9IDB4ZjZmNzsKICB0LkRzbGFzaCA9IDB4MDExMDsKICB0LkRzbWFsbCA9IDB4Zjc2NDsKICB0LkR0b3BiYXIgPSAweDAxOGI7CiAgdC5EeiA9IDB4MDFmMjsKICB0LkR6Y2Fyb24gPSAweDAxYzU7CiAgdC5EemVhYmtoYXNpYW5jeXJpbGxpYyA9IDB4MDRlMDsKICB0LkR6ZWN5cmlsbGljID0gMHgwNDA1OwogIHQuRHpoZWN5cmlsbGljID0gMHgwNDBmOwogIHQuRSA9IDB4MDA0NTsKICB0LkVhY3V0ZSA9IDB4MDBjOTsKICB0LkVhY3V0ZXNtYWxsID0gMHhmN2U5OwogIHQuRWJyZXZlID0gMHgwMTE0OwogIHQuRWNhcm9uID0gMHgwMTFhOwogIHQuRWNlZGlsbGFicmV2ZSA9IDB4MWUxYzsKICB0LkVjaGFybWVuaWFuID0gMHgwNTM1OwogIHQuRWNpcmNsZSA9IDB4MjRiYTsKICB0LkVjaXJjdW1mbGV4ID0gMHgwMGNhOwogIHQuRWNpcmN1bWZsZXhhY3V0ZSA9IDB4MWViZTsKICB0LkVjaXJjdW1mbGV4YmVsb3cgPSAweDFlMTg7CiAgdC5FY2lyY3VtZmxleGRvdGJlbG93ID0gMHgxZWM2OwogIHQuRWNpcmN1bWZsZXhncmF2ZSA9IDB4MWVjMDsKICB0LkVjaXJjdW1mbGV4aG9va2Fib3ZlID0gMHgxZWMyOwogIHQuRWNpcmN1bWZsZXhzbWFsbCA9IDB4ZjdlYTsKICB0LkVjaXJjdW1mbGV4dGlsZGUgPSAweDFlYzQ7CiAgdC5FY3lyaWxsaWMgPSAweDA0MDQ7CiAgdC5FZGJsZ3JhdmUgPSAweDAyMDQ7CiAgdC5FZGllcmVzaXMgPSAweDAwY2I7CiAgdC5FZGllcmVzaXNzbWFsbCA9IDB4ZjdlYjsKICB0LkVkb3QgPSAweDAxMTY7CiAgdC5FZG90YWNjZW50ID0gMHgwMTE2OwogIHQuRWRvdGJlbG93ID0gMHgxZWI4OwogIHQuRWZjeXJpbGxpYyA9IDB4MDQyNDsKICB0LkVncmF2ZSA9IDB4MDBjODsKICB0LkVncmF2ZXNtYWxsID0gMHhmN2U4OwogIHQuRWhhcm1lbmlhbiA9IDB4MDUzNzsKICB0LkVob29rYWJvdmUgPSAweDFlYmE7CiAgdC5FaWdodHJvbWFuID0gMHgyMTY3OwogIHQuRWludmVydGVkYnJldmUgPSAweDAyMDY7CiAgdC5FaW90aWZpZWRjeXJpbGxpYyA9IDB4MDQ2NDsKICB0LkVsY3lyaWxsaWMgPSAweDA0MWI7CiAgdC5FbGV2ZW5yb21hbiA9IDB4MjE2YTsKICB0LkVtYWNyb24gPSAweDAxMTI7CiAgdC5FbWFjcm9uYWN1dGUgPSAweDFlMTY7CiAgdC5FbWFjcm9uZ3JhdmUgPSAweDFlMTQ7CiAgdC5FbWN5cmlsbGljID0gMHgwNDFjOwogIHQuRW1vbm9zcGFjZSA9IDB4ZmYyNTsKICB0LkVuY3lyaWxsaWMgPSAweDA0MWQ7CiAgdC5FbmRlc2NlbmRlcmN5cmlsbGljID0gMHgwNGEyOwogIHQuRW5nID0gMHgwMTRhOwogIHQuRW5naGVjeXJpbGxpYyA9IDB4MDRhNDsKICB0LkVuaG9va2N5cmlsbGljID0gMHgwNGM3OwogIHQuRW9nb25layA9IDB4MDExODsKICB0LkVvcGVuID0gMHgwMTkwOwogIHQuRXBzaWxvbiA9IDB4MDM5NTsKICB0LkVwc2lsb250b25vcyA9IDB4MDM4ODsKICB0LkVyY3lyaWxsaWMgPSAweDA0MjA7CiAgdC5FcmV2ZXJzZWQgPSAweDAxOGU7CiAgdC5FcmV2ZXJzZWRjeXJpbGxpYyA9IDB4MDQyZDsKICB0LkVzY3lyaWxsaWMgPSAweDA0MjE7CiAgdC5Fc2Rlc2NlbmRlcmN5cmlsbGljID0gMHgwNGFhOwogIHQuRXNoID0gMHgwMWE5OwogIHQuRXNtYWxsID0gMHhmNzY1OwogIHQuRXRhID0gMHgwMzk3OwogIHQuRXRhcm1lbmlhbiA9IDB4MDUzODsKICB0LkV0YXRvbm9zID0gMHgwMzg5OwogIHQuRXRoID0gMHgwMGQwOwogIHQuRXRoc21hbGwgPSAweGY3ZjA7CiAgdC5FdGlsZGUgPSAweDFlYmM7CiAgdC5FdGlsZGViZWxvdyA9IDB4MWUxYTsKICB0LkV1cm8gPSAweDIwYWM7CiAgdC5FemggPSAweDAxYjc7CiAgdC5FemhjYXJvbiA9IDB4MDFlZTsKICB0LkV6aHJldmVyc2VkID0gMHgwMWI4OwogIHQuRiA9IDB4MDA0NjsKICB0LkZjaXJjbGUgPSAweDI0YmI7CiAgdC5GZG90YWNjZW50ID0gMHgxZTFlOwogIHQuRmVoYXJtZW5pYW4gPSAweDA1NTY7CiAgdC5GZWljb3B0aWMgPSAweDAzZTQ7CiAgdC5GaG9vayA9IDB4MDE5MTsKICB0LkZpdGFjeXJpbGxpYyA9IDB4MDQ3MjsKICB0LkZpdmVyb21hbiA9IDB4MjE2NDsKICB0LkZtb25vc3BhY2UgPSAweGZmMjY7CiAgdC5Gb3Vycm9tYW4gPSAweDIxNjM7CiAgdC5Gc21hbGwgPSAweGY3NjY7CiAgdC5HID0gMHgwMDQ3OwogIHQuR0JzcXVhcmUgPSAweDMzODc7CiAgdC5HYWN1dGUgPSAweDAxZjQ7CiAgdC5HYW1tYSA9IDB4MDM5MzsKICB0LkdhbW1hYWZyaWNhbiA9IDB4MDE5NDsKICB0LkdhbmdpYWNvcHRpYyA9IDB4MDNlYTsKICB0LkdicmV2ZSA9IDB4MDExZTsKICB0LkdjYXJvbiA9IDB4MDFlNjsKICB0LkdjZWRpbGxhID0gMHgwMTIyOwogIHQuR2NpcmNsZSA9IDB4MjRiYzsKICB0LkdjaXJjdW1mbGV4ID0gMHgwMTFjOwogIHQuR2NvbW1hYWNjZW50ID0gMHgwMTIyOwogIHQuR2RvdCA9IDB4MDEyMDsKICB0Lkdkb3RhY2NlbnQgPSAweDAxMjA7CiAgdC5HZWN5cmlsbGljID0gMHgwNDEzOwogIHQuR2hhZGFybWVuaWFuID0gMHgwNTQyOwogIHQuR2hlbWlkZGxlaG9va2N5cmlsbGljID0gMHgwNDk0OwogIHQuR2hlc3Ryb2tlY3lyaWxsaWMgPSAweDA0OTI7CiAgdC5HaGV1cHR1cm5jeXJpbGxpYyA9IDB4MDQ5MDsKICB0Lkdob29rID0gMHgwMTkzOwogIHQuR2ltYXJtZW5pYW4gPSAweDA1MzM7CiAgdC5HamVjeXJpbGxpYyA9IDB4MDQwMzsKICB0LkdtYWNyb24gPSAweDFlMjA7CiAgdC5HbW9ub3NwYWNlID0gMHhmZjI3OwogIHQuR3JhdmUgPSAweGY2Y2U7CiAgdC5HcmF2ZXNtYWxsID0gMHhmNzYwOwogIHQuR3NtYWxsID0gMHhmNzY3OwogIHQuR3NtYWxsaG9vayA9IDB4MDI5YjsKICB0LkdzdHJva2UgPSAweDAxZTQ7CiAgdC5IID0gMHgwMDQ4OwogIHQuSDE4NTMzID0gMHgyNWNmOwogIHQuSDE4NTQzID0gMHgyNWFhOwogIHQuSDE4NTUxID0gMHgyNWFiOwogIHQuSDIyMDczID0gMHgyNWExOwogIHQuSFBzcXVhcmUgPSAweDMzY2I7CiAgdC5IYWFia2hhc2lhbmN5cmlsbGljID0gMHgwNGE4OwogIHQuSGFkZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDRiMjsKICB0LkhhcmRzaWduY3lyaWxsaWMgPSAweDA0MmE7CiAgdC5IYmFyID0gMHgwMTI2OwogIHQuSGJyZXZlYmVsb3cgPSAweDFlMmE7CiAgdC5IY2VkaWxsYSA9IDB4MWUyODsKICB0LkhjaXJjbGUgPSAweDI0YmQ7CiAgdC5IY2lyY3VtZmxleCA9IDB4MDEyNDsKICB0LkhkaWVyZXNpcyA9IDB4MWUyNjsKICB0Lkhkb3RhY2NlbnQgPSAweDFlMjI7CiAgdC5IZG90YmVsb3cgPSAweDFlMjQ7CiAgdC5IbW9ub3NwYWNlID0gMHhmZjI4OwogIHQuSG9hcm1lbmlhbiA9IDB4MDU0MDsKICB0Lkhvcmljb3B0aWMgPSAweDAzZTg7CiAgdC5Ic21hbGwgPSAweGY3Njg7CiAgdC5IdW5nYXJ1bWxhdXQgPSAweGY2Y2Y7CiAgdC5IdW5nYXJ1bWxhdXRzbWFsbCA9IDB4ZjZmODsKICB0Lkh6c3F1YXJlID0gMHgzMzkwOwogIHQuSSA9IDB4MDA0OTsKICB0LklBY3lyaWxsaWMgPSAweDA0MmY7CiAgdC5JSiA9IDB4MDEzMjsKICB0LklVY3lyaWxsaWMgPSAweDA0MmU7CiAgdC5JYWN1dGUgPSAweDAwY2Q7CiAgdC5JYWN1dGVzbWFsbCA9IDB4ZjdlZDsKICB0LklicmV2ZSA9IDB4MDEyYzsKICB0LkljYXJvbiA9IDB4MDFjZjsKICB0LkljaXJjbGUgPSAweDI0YmU7CiAgdC5JY2lyY3VtZmxleCA9IDB4MDBjZTsKICB0LkljaXJjdW1mbGV4c21hbGwgPSAweGY3ZWU7CiAgdC5JY3lyaWxsaWMgPSAweDA0MDY7CiAgdC5JZGJsZ3JhdmUgPSAweDAyMDg7CiAgdC5JZGllcmVzaXMgPSAweDAwY2Y7CiAgdC5JZGllcmVzaXNhY3V0ZSA9IDB4MWUyZTsKICB0LklkaWVyZXNpc2N5cmlsbGljID0gMHgwNGU0OwogIHQuSWRpZXJlc2lzc21hbGwgPSAweGY3ZWY7CiAgdC5JZG90ID0gMHgwMTMwOwogIHQuSWRvdGFjY2VudCA9IDB4MDEzMDsKICB0Lklkb3RiZWxvdyA9IDB4MWVjYTsKICB0LkllYnJldmVjeXJpbGxpYyA9IDB4MDRkNjsKICB0LkllY3lyaWxsaWMgPSAweDA0MTU7CiAgdC5JZnJha3R1ciA9IDB4MjExMTsKICB0LklncmF2ZSA9IDB4MDBjYzsKICB0LklncmF2ZXNtYWxsID0gMHhmN2VjOwogIHQuSWhvb2thYm92ZSA9IDB4MWVjODsKICB0LklpY3lyaWxsaWMgPSAweDA0MTg7CiAgdC5JaW52ZXJ0ZWRicmV2ZSA9IDB4MDIwYTsKICB0Lklpc2hvcnRjeXJpbGxpYyA9IDB4MDQxOTsKICB0LkltYWNyb24gPSAweDAxMmE7CiAgdC5JbWFjcm9uY3lyaWxsaWMgPSAweDA0ZTI7CiAgdC5JbW9ub3NwYWNlID0gMHhmZjI5OwogIHQuSW5pYXJtZW5pYW4gPSAweDA1M2I7CiAgdC5Jb2N5cmlsbGljID0gMHgwNDAxOwogIHQuSW9nb25layA9IDB4MDEyZTsKICB0LklvdGEgPSAweDAzOTk7CiAgdC5Jb3RhYWZyaWNhbiA9IDB4MDE5NjsKICB0LklvdGFkaWVyZXNpcyA9IDB4MDNhYTsKICB0LklvdGF0b25vcyA9IDB4MDM4YTsKICB0LklzbWFsbCA9IDB4Zjc2OTsKICB0LklzdHJva2UgPSAweDAxOTc7CiAgdC5JdGlsZGUgPSAweDAxMjg7CiAgdC5JdGlsZGViZWxvdyA9IDB4MWUyYzsKICB0Lkl6aGl0c2FjeXJpbGxpYyA9IDB4MDQ3NDsKICB0Lkl6aGl0c2FkYmxncmF2ZWN5cmlsbGljID0gMHgwNDc2OwogIHQuSiA9IDB4MDA0YTsKICB0LkphYXJtZW5pYW4gPSAweDA1NDE7CiAgdC5KY2lyY2xlID0gMHgyNGJmOwogIHQuSmNpcmN1bWZsZXggPSAweDAxMzQ7CiAgdC5KZWN5cmlsbGljID0gMHgwNDA4OwogIHQuSmhlaGFybWVuaWFuID0gMHgwNTRiOwogIHQuSm1vbm9zcGFjZSA9IDB4ZmYyYTsKICB0LkpzbWFsbCA9IDB4Zjc2YTsKICB0LksgPSAweDAwNGI7CiAgdC5LQnNxdWFyZSA9IDB4MzM4NTsKICB0LktLc3F1YXJlID0gMHgzM2NkOwogIHQuS2FiYXNoa2lyY3lyaWxsaWMgPSAweDA0YTA7CiAgdC5LYWN1dGUgPSAweDFlMzA7CiAgdC5LYWN5cmlsbGljID0gMHgwNDFhOwogIHQuS2FkZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDQ5YTsKICB0LkthaG9va2N5cmlsbGljID0gMHgwNGMzOwogIHQuS2FwcGEgPSAweDAzOWE7CiAgdC5LYXN0cm9rZWN5cmlsbGljID0gMHgwNDllOwogIHQuS2F2ZXJ0aWNhbHN0cm9rZWN5cmlsbGljID0gMHgwNDljOwogIHQuS2Nhcm9uID0gMHgwMWU4OwogIHQuS2NlZGlsbGEgPSAweDAxMzY7CiAgdC5LY2lyY2xlID0gMHgyNGMwOwogIHQuS2NvbW1hYWNjZW50ID0gMHgwMTM2OwogIHQuS2RvdGJlbG93ID0gMHgxZTMyOwogIHQuS2VoYXJtZW5pYW4gPSAweDA1NTQ7CiAgdC5LZW5hcm1lbmlhbiA9IDB4MDUzZjsKICB0LktoYWN5cmlsbGljID0gMHgwNDI1OwogIHQuS2hlaWNvcHRpYyA9IDB4MDNlNjsKICB0Lktob29rID0gMHgwMTk4OwogIHQuS2plY3lyaWxsaWMgPSAweDA0MGM7CiAgdC5LbGluZWJlbG93ID0gMHgxZTM0OwogIHQuS21vbm9zcGFjZSA9IDB4ZmYyYjsKICB0LktvcHBhY3lyaWxsaWMgPSAweDA0ODA7CiAgdC5Lb3BwYWdyZWVrID0gMHgwM2RlOwogIHQuS3NpY3lyaWxsaWMgPSAweDA0NmU7CiAgdC5Lc21hbGwgPSAweGY3NmI7CiAgdC5MID0gMHgwMDRjOwogIHQuTEogPSAweDAxYzc7CiAgdC5MTCA9IDB4ZjZiZjsKICB0LkxhY3V0ZSA9IDB4MDEzOTsKICB0LkxhbWJkYSA9IDB4MDM5YjsKICB0LkxjYXJvbiA9IDB4MDEzZDsKICB0LkxjZWRpbGxhID0gMHgwMTNiOwogIHQuTGNpcmNsZSA9IDB4MjRjMTsKICB0LkxjaXJjdW1mbGV4YmVsb3cgPSAweDFlM2M7CiAgdC5MY29tbWFhY2NlbnQgPSAweDAxM2I7CiAgdC5MZG90ID0gMHgwMTNmOwogIHQuTGRvdGFjY2VudCA9IDB4MDEzZjsKICB0Lkxkb3RiZWxvdyA9IDB4MWUzNjsKICB0Lkxkb3RiZWxvd21hY3JvbiA9IDB4MWUzODsKICB0Lkxpd25hcm1lbmlhbiA9IDB4MDUzYzsKICB0LkxqID0gMHgwMWM4OwogIHQuTGplY3lyaWxsaWMgPSAweDA0MDk7CiAgdC5MbGluZWJlbG93ID0gMHgxZTNhOwogIHQuTG1vbm9zcGFjZSA9IDB4ZmYyYzsKICB0LkxzbGFzaCA9IDB4MDE0MTsKICB0LkxzbGFzaHNtYWxsID0gMHhmNmY5OwogIHQuTHNtYWxsID0gMHhmNzZjOwogIHQuTSA9IDB4MDA0ZDsKICB0Lk1Cc3F1YXJlID0gMHgzMzg2OwogIHQuTWFjcm9uID0gMHhmNmQwOwogIHQuTWFjcm9uc21hbGwgPSAweGY3YWY7CiAgdC5NYWN1dGUgPSAweDFlM2U7CiAgdC5NY2lyY2xlID0gMHgyNGMyOwogIHQuTWRvdGFjY2VudCA9IDB4MWU0MDsKICB0Lk1kb3RiZWxvdyA9IDB4MWU0MjsKICB0Lk1lbmFybWVuaWFuID0gMHgwNTQ0OwogIHQuTW1vbm9zcGFjZSA9IDB4ZmYyZDsKICB0Lk1zbWFsbCA9IDB4Zjc2ZDsKICB0Lk10dXJuZWQgPSAweDAxOWM7CiAgdC5NdSA9IDB4MDM5YzsKICB0Lk4gPSAweDAwNGU7CiAgdC5OSiA9IDB4MDFjYTsKICB0Lk5hY3V0ZSA9IDB4MDE0MzsKICB0Lk5jYXJvbiA9IDB4MDE0NzsKICB0Lk5jZWRpbGxhID0gMHgwMTQ1OwogIHQuTmNpcmNsZSA9IDB4MjRjMzsKICB0Lk5jaXJjdW1mbGV4YmVsb3cgPSAweDFlNGE7CiAgdC5OY29tbWFhY2NlbnQgPSAweDAxNDU7CiAgdC5OZG90YWNjZW50ID0gMHgxZTQ0OwogIHQuTmRvdGJlbG93ID0gMHgxZTQ2OwogIHQuTmhvb2tsZWZ0ID0gMHgwMTlkOwogIHQuTmluZXJvbWFuID0gMHgyMTY4OwogIHQuTmogPSAweDAxY2I7CiAgdC5OamVjeXJpbGxpYyA9IDB4MDQwYTsKICB0Lk5saW5lYmVsb3cgPSAweDFlNDg7CiAgdC5ObW9ub3NwYWNlID0gMHhmZjJlOwogIHQuTm93YXJtZW5pYW4gPSAweDA1NDY7CiAgdC5Oc21hbGwgPSAweGY3NmU7CiAgdC5OdGlsZGUgPSAweDAwZDE7CiAgdC5OdGlsZGVzbWFsbCA9IDB4ZjdmMTsKICB0Lk51ID0gMHgwMzlkOwogIHQuTyA9IDB4MDA0ZjsKICB0Lk9FID0gMHgwMTUyOwogIHQuT0VzbWFsbCA9IDB4ZjZmYTsKICB0Lk9hY3V0ZSA9IDB4MDBkMzsKICB0Lk9hY3V0ZXNtYWxsID0gMHhmN2YzOwogIHQuT2JhcnJlZGN5cmlsbGljID0gMHgwNGU4OwogIHQuT2JhcnJlZGRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZWE7CiAgdC5PYnJldmUgPSAweDAxNGU7CiAgdC5PY2Fyb24gPSAweDAxZDE7CiAgdC5PY2VudGVyZWR0aWxkZSA9IDB4MDE5ZjsKICB0Lk9jaXJjbGUgPSAweDI0YzQ7CiAgdC5PY2lyY3VtZmxleCA9IDB4MDBkNDsKICB0Lk9jaXJjdW1mbGV4YWN1dGUgPSAweDFlZDA7CiAgdC5PY2lyY3VtZmxleGRvdGJlbG93ID0gMHgxZWQ4OwogIHQuT2NpcmN1bWZsZXhncmF2ZSA9IDB4MWVkMjsKICB0Lk9jaXJjdW1mbGV4aG9va2Fib3ZlID0gMHgxZWQ0OwogIHQuT2NpcmN1bWZsZXhzbWFsbCA9IDB4ZjdmNDsKICB0Lk9jaXJjdW1mbGV4dGlsZGUgPSAweDFlZDY7CiAgdC5PY3lyaWxsaWMgPSAweDA0MWU7CiAgdC5PZGJsYWN1dGUgPSAweDAxNTA7CiAgdC5PZGJsZ3JhdmUgPSAweDAyMGM7CiAgdC5PZGllcmVzaXMgPSAweDAwZDY7CiAgdC5PZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRlNjsKICB0Lk9kaWVyZXNpc3NtYWxsID0gMHhmN2Y2OwogIHQuT2RvdGJlbG93ID0gMHgxZWNjOwogIHQuT2dvbmVrc21hbGwgPSAweGY2ZmI7CiAgdC5PZ3JhdmUgPSAweDAwZDI7CiAgdC5PZ3JhdmVzbWFsbCA9IDB4ZjdmMjsKICB0Lk9oYXJtZW5pYW4gPSAweDA1NTU7CiAgdC5PaG0gPSAweDIxMjY7CiAgdC5PaG9va2Fib3ZlID0gMHgxZWNlOwogIHQuT2hvcm4gPSAweDAxYTA7CiAgdC5PaG9ybmFjdXRlID0gMHgxZWRhOwogIHQuT2hvcm5kb3RiZWxvdyA9IDB4MWVlMjsKICB0Lk9ob3JuZ3JhdmUgPSAweDFlZGM7CiAgdC5PaG9ybmhvb2thYm92ZSA9IDB4MWVkZTsKICB0Lk9ob3JudGlsZGUgPSAweDFlZTA7CiAgdC5PaHVuZ2FydW1sYXV0ID0gMHgwMTUwOwogIHQuT2kgPSAweDAxYTI7CiAgdC5PaW52ZXJ0ZWRicmV2ZSA9IDB4MDIwZTsKICB0Lk9tYWNyb24gPSAweDAxNGM7CiAgdC5PbWFjcm9uYWN1dGUgPSAweDFlNTI7CiAgdC5PbWFjcm9uZ3JhdmUgPSAweDFlNTA7CiAgdC5PbWVnYSA9IDB4MjEyNjsKICB0Lk9tZWdhY3lyaWxsaWMgPSAweDA0NjA7CiAgdC5PbWVnYWdyZWVrID0gMHgwM2E5OwogIHQuT21lZ2Fyb3VuZGN5cmlsbGljID0gMHgwNDdhOwogIHQuT21lZ2F0aXRsb2N5cmlsbGljID0gMHgwNDdjOwogIHQuT21lZ2F0b25vcyA9IDB4MDM4ZjsKICB0Lk9taWNyb24gPSAweDAzOWY7CiAgdC5PbWljcm9udG9ub3MgPSAweDAzOGM7CiAgdC5PbW9ub3NwYWNlID0gMHhmZjJmOwogIHQuT25lcm9tYW4gPSAweDIxNjA7CiAgdC5Pb2dvbmVrID0gMHgwMWVhOwogIHQuT29nb25la21hY3JvbiA9IDB4MDFlYzsKICB0Lk9vcGVuID0gMHgwMTg2OwogIHQuT3NsYXNoID0gMHgwMGQ4OwogIHQuT3NsYXNoYWN1dGUgPSAweDAxZmU7CiAgdC5Pc2xhc2hzbWFsbCA9IDB4ZjdmODsKICB0Lk9zbWFsbCA9IDB4Zjc2ZjsKICB0Lk9zdHJva2VhY3V0ZSA9IDB4MDFmZTsKICB0Lk90Y3lyaWxsaWMgPSAweDA0N2U7CiAgdC5PdGlsZGUgPSAweDAwZDU7CiAgdC5PdGlsZGVhY3V0ZSA9IDB4MWU0YzsKICB0Lk90aWxkZWRpZXJlc2lzID0gMHgxZTRlOwogIHQuT3RpbGRlc21hbGwgPSAweGY3ZjU7CiAgdC5QID0gMHgwMDUwOwogIHQuUGFjdXRlID0gMHgxZTU0OwogIHQuUGNpcmNsZSA9IDB4MjRjNTsKICB0LlBkb3RhY2NlbnQgPSAweDFlNTY7CiAgdC5QZWN5cmlsbGljID0gMHgwNDFmOwogIHQuUGVoYXJtZW5pYW4gPSAweDA1NGE7CiAgdC5QZW1pZGRsZWhvb2tjeXJpbGxpYyA9IDB4MDRhNjsKICB0LlBoaSA9IDB4MDNhNjsKICB0LlBob29rID0gMHgwMWE0OwogIHQuUGkgPSAweDAzYTA7CiAgdC5QaXdyYXJtZW5pYW4gPSAweDA1NTM7CiAgdC5QbW9ub3NwYWNlID0gMHhmZjMwOwogIHQuUHNpID0gMHgwM2E4OwogIHQuUHNpY3lyaWxsaWMgPSAweDA0NzA7CiAgdC5Qc21hbGwgPSAweGY3NzA7CiAgdC5RID0gMHgwMDUxOwogIHQuUWNpcmNsZSA9IDB4MjRjNjsKICB0LlFtb25vc3BhY2UgPSAweGZmMzE7CiAgdC5Rc21hbGwgPSAweGY3NzE7CiAgdC5SID0gMHgwMDUyOwogIHQuUmFhcm1lbmlhbiA9IDB4MDU0YzsKICB0LlJhY3V0ZSA9IDB4MDE1NDsKICB0LlJjYXJvbiA9IDB4MDE1ODsKICB0LlJjZWRpbGxhID0gMHgwMTU2OwogIHQuUmNpcmNsZSA9IDB4MjRjNzsKICB0LlJjb21tYWFjY2VudCA9IDB4MDE1NjsKICB0LlJkYmxncmF2ZSA9IDB4MDIxMDsKICB0LlJkb3RhY2NlbnQgPSAweDFlNTg7CiAgdC5SZG90YmVsb3cgPSAweDFlNWE7CiAgdC5SZG90YmVsb3dtYWNyb24gPSAweDFlNWM7CiAgdC5SZWhhcm1lbmlhbiA9IDB4MDU1MDsKICB0LlJmcmFrdHVyID0gMHgyMTFjOwogIHQuUmhvID0gMHgwM2ExOwogIHQuUmluZ3NtYWxsID0gMHhmNmZjOwogIHQuUmludmVydGVkYnJldmUgPSAweDAyMTI7CiAgdC5SbGluZWJlbG93ID0gMHgxZTVlOwogIHQuUm1vbm9zcGFjZSA9IDB4ZmYzMjsKICB0LlJzbWFsbCA9IDB4Zjc3MjsKICB0LlJzbWFsbGludmVydGVkID0gMHgwMjgxOwogIHQuUnNtYWxsaW52ZXJ0ZWRzdXBlcmlvciA9IDB4MDJiNjsKICB0LlMgPSAweDAwNTM7CiAgdC5TRjAxMDAwMCA9IDB4MjUwYzsKICB0LlNGMDIwMDAwID0gMHgyNTE0OwogIHQuU0YwMzAwMDAgPSAweDI1MTA7CiAgdC5TRjA0MDAwMCA9IDB4MjUxODsKICB0LlNGMDUwMDAwID0gMHgyNTNjOwogIHQuU0YwNjAwMDAgPSAweDI1MmM7CiAgdC5TRjA3MDAwMCA9IDB4MjUzNDsKICB0LlNGMDgwMDAwID0gMHgyNTFjOwogIHQuU0YwOTAwMDAgPSAweDI1MjQ7CiAgdC5TRjEwMDAwMCA9IDB4MjUwMDsKICB0LlNGMTEwMDAwID0gMHgyNTAyOwogIHQuU0YxOTAwMDAgPSAweDI1NjE7CiAgdC5TRjIwMDAwMCA9IDB4MjU2MjsKICB0LlNGMjEwMDAwID0gMHgyNTU2OwogIHQuU0YyMjAwMDAgPSAweDI1NTU7CiAgdC5TRjIzMDAwMCA9IDB4MjU2MzsKICB0LlNGMjQwMDAwID0gMHgyNTUxOwogIHQuU0YyNTAwMDAgPSAweDI1NTc7CiAgdC5TRjI2MDAwMCA9IDB4MjU1ZDsKICB0LlNGMjcwMDAwID0gMHgyNTVjOwogIHQuU0YyODAwMDAgPSAweDI1NWI7CiAgdC5TRjM2MDAwMCA9IDB4MjU1ZTsKICB0LlNGMzcwMDAwID0gMHgyNTVmOwogIHQuU0YzODAwMDAgPSAweDI1NWE7CiAgdC5TRjM5MDAwMCA9IDB4MjU1NDsKICB0LlNGNDAwMDAwID0gMHgyNTY5OwogIHQuU0Y0MTAwMDAgPSAweDI1NjY7CiAgdC5TRjQyMDAwMCA9IDB4MjU2MDsKICB0LlNGNDMwMDAwID0gMHgyNTUwOwogIHQuU0Y0NDAwMDAgPSAweDI1NmM7CiAgdC5TRjQ1MDAwMCA9IDB4MjU2NzsKICB0LlNGNDYwMDAwID0gMHgyNTY4OwogIHQuU0Y0NzAwMDAgPSAweDI1NjQ7CiAgdC5TRjQ4MDAwMCA9IDB4MjU2NTsKICB0LlNGNDkwMDAwID0gMHgyNTU5OwogIHQuU0Y1MDAwMDAgPSAweDI1NTg7CiAgdC5TRjUxMDAwMCA9IDB4MjU1MjsKICB0LlNGNTIwMDAwID0gMHgyNTUzOwogIHQuU0Y1MzAwMDAgPSAweDI1NmI7CiAgdC5TRjU0MDAwMCA9IDB4MjU2YTsKICB0LlNhY3V0ZSA9IDB4MDE1YTsKICB0LlNhY3V0ZWRvdGFjY2VudCA9IDB4MWU2NDsKICB0LlNhbXBpZ3JlZWsgPSAweDAzZTA7CiAgdC5TY2Fyb24gPSAweDAxNjA7CiAgdC5TY2Fyb25kb3RhY2NlbnQgPSAweDFlNjY7CiAgdC5TY2Fyb25zbWFsbCA9IDB4ZjZmZDsKICB0LlNjZWRpbGxhID0gMHgwMTVlOwogIHQuU2Nod2EgPSAweDAxOGY7CiAgdC5TY2h3YWN5cmlsbGljID0gMHgwNGQ4OwogIHQuU2Nod2FkaWVyZXNpc2N5cmlsbGljID0gMHgwNGRhOwogIHQuU2NpcmNsZSA9IDB4MjRjODsKICB0LlNjaXJjdW1mbGV4ID0gMHgwMTVjOwogIHQuU2NvbW1hYWNjZW50ID0gMHgwMjE4OwogIHQuU2RvdGFjY2VudCA9IDB4MWU2MDsKICB0LlNkb3RiZWxvdyA9IDB4MWU2MjsKICB0LlNkb3RiZWxvd2RvdGFjY2VudCA9IDB4MWU2ODsKICB0LlNlaGFybWVuaWFuID0gMHgwNTRkOwogIHQuU2V2ZW5yb21hbiA9IDB4MjE2NjsKICB0LlNoYWFybWVuaWFuID0gMHgwNTQ3OwogIHQuU2hhY3lyaWxsaWMgPSAweDA0Mjg7CiAgdC5TaGNoYWN5cmlsbGljID0gMHgwNDI5OwogIHQuU2hlaWNvcHRpYyA9IDB4MDNlMjsKICB0LlNoaGFjeXJpbGxpYyA9IDB4MDRiYTsKICB0LlNoaW1hY29wdGljID0gMHgwM2VjOwogIHQuU2lnbWEgPSAweDAzYTM7CiAgdC5TaXhyb21hbiA9IDB4MjE2NTsKICB0LlNtb25vc3BhY2UgPSAweGZmMzM7CiAgdC5Tb2Z0c2lnbmN5cmlsbGljID0gMHgwNDJjOwogIHQuU3NtYWxsID0gMHhmNzczOwogIHQuU3RpZ21hZ3JlZWsgPSAweDAzZGE7CiAgdC5UID0gMHgwMDU0OwogIHQuVGF1ID0gMHgwM2E0OwogIHQuVGJhciA9IDB4MDE2NjsKICB0LlRjYXJvbiA9IDB4MDE2NDsKICB0LlRjZWRpbGxhID0gMHgwMTYyOwogIHQuVGNpcmNsZSA9IDB4MjRjOTsKICB0LlRjaXJjdW1mbGV4YmVsb3cgPSAweDFlNzA7CiAgdC5UY29tbWFhY2NlbnQgPSAweDAxNjI7CiAgdC5UZG90YWNjZW50ID0gMHgxZTZhOwogIHQuVGRvdGJlbG93ID0gMHgxZTZjOwogIHQuVGVjeXJpbGxpYyA9IDB4MDQyMjsKICB0LlRlZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0YWM7CiAgdC5UZW5yb21hbiA9IDB4MjE2OTsKICB0LlRldHNlY3lyaWxsaWMgPSAweDA0YjQ7CiAgdC5UaGV0YSA9IDB4MDM5ODsKICB0LlRob29rID0gMHgwMWFjOwogIHQuVGhvcm4gPSAweDAwZGU7CiAgdC5UaG9ybnNtYWxsID0gMHhmN2ZlOwogIHQuVGhyZWVyb21hbiA9IDB4MjE2MjsKICB0LlRpbGRlc21hbGwgPSAweGY2ZmU7CiAgdC5UaXduYXJtZW5pYW4gPSAweDA1NGY7CiAgdC5UbGluZWJlbG93ID0gMHgxZTZlOwogIHQuVG1vbm9zcGFjZSA9IDB4ZmYzNDsKICB0LlRvYXJtZW5pYW4gPSAweDA1Mzk7CiAgdC5Ub25lZml2ZSA9IDB4MDFiYzsKICB0LlRvbmVzaXggPSAweDAxODQ7CiAgdC5Ub25ldHdvID0gMHgwMWE3OwogIHQuVHJldHJvZmxleGhvb2sgPSAweDAxYWU7CiAgdC5Uc2VjeXJpbGxpYyA9IDB4MDQyNjsKICB0LlRzaGVjeXJpbGxpYyA9IDB4MDQwYjsKICB0LlRzbWFsbCA9IDB4Zjc3NDsKICB0LlR3ZWx2ZXJvbWFuID0gMHgyMTZiOwogIHQuVHdvcm9tYW4gPSAweDIxNjE7CiAgdC5VID0gMHgwMDU1OwogIHQuVWFjdXRlID0gMHgwMGRhOwogIHQuVWFjdXRlc21hbGwgPSAweGY3ZmE7CiAgdC5VYnJldmUgPSAweDAxNmM7CiAgdC5VY2Fyb24gPSAweDAxZDM7CiAgdC5VY2lyY2xlID0gMHgyNGNhOwogIHQuVWNpcmN1bWZsZXggPSAweDAwZGI7CiAgdC5VY2lyY3VtZmxleGJlbG93ID0gMHgxZTc2OwogIHQuVWNpcmN1bWZsZXhzbWFsbCA9IDB4ZjdmYjsKICB0LlVjeXJpbGxpYyA9IDB4MDQyMzsKICB0LlVkYmxhY3V0ZSA9IDB4MDE3MDsKICB0LlVkYmxncmF2ZSA9IDB4MDIxNDsKICB0LlVkaWVyZXNpcyA9IDB4MDBkYzsKICB0LlVkaWVyZXNpc2FjdXRlID0gMHgwMWQ3OwogIHQuVWRpZXJlc2lzYmVsb3cgPSAweDFlNzI7CiAgdC5VZGllcmVzaXNjYXJvbiA9IDB4MDFkOTsKICB0LlVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGYwOwogIHQuVWRpZXJlc2lzZ3JhdmUgPSAweDAxZGI7CiAgdC5VZGllcmVzaXNtYWNyb24gPSAweDAxZDU7CiAgdC5VZGllcmVzaXNzbWFsbCA9IDB4ZjdmYzsKICB0LlVkb3RiZWxvdyA9IDB4MWVlNDsKICB0LlVncmF2ZSA9IDB4MDBkOTsKICB0LlVncmF2ZXNtYWxsID0gMHhmN2Y5OwogIHQuVWhvb2thYm92ZSA9IDB4MWVlNjsKICB0LlVob3JuID0gMHgwMWFmOwogIHQuVWhvcm5hY3V0ZSA9IDB4MWVlODsKICB0LlVob3JuZG90YmVsb3cgPSAweDFlZjA7CiAgdC5VaG9ybmdyYXZlID0gMHgxZWVhOwogIHQuVWhvcm5ob29rYWJvdmUgPSAweDFlZWM7CiAgdC5VaG9ybnRpbGRlID0gMHgxZWVlOwogIHQuVWh1bmdhcnVtbGF1dCA9IDB4MDE3MDsKICB0LlVodW5nYXJ1bWxhdXRjeXJpbGxpYyA9IDB4MDRmMjsKICB0LlVpbnZlcnRlZGJyZXZlID0gMHgwMjE2OwogIHQuVWtjeXJpbGxpYyA9IDB4MDQ3ODsKICB0LlVtYWNyb24gPSAweDAxNmE7CiAgdC5VbWFjcm9uY3lyaWxsaWMgPSAweDA0ZWU7CiAgdC5VbWFjcm9uZGllcmVzaXMgPSAweDFlN2E7CiAgdC5VbW9ub3NwYWNlID0gMHhmZjM1OwogIHQuVW9nb25layA9IDB4MDE3MjsKICB0LlVwc2lsb24gPSAweDAzYTU7CiAgdC5VcHNpbG9uMSA9IDB4MDNkMjsKICB0LlVwc2lsb25hY3V0ZWhvb2tzeW1ib2xncmVlayA9IDB4MDNkMzsKICB0LlVwc2lsb25hZnJpY2FuID0gMHgwMWIxOwogIHQuVXBzaWxvbmRpZXJlc2lzID0gMHgwM2FiOwogIHQuVXBzaWxvbmRpZXJlc2lzaG9va3N5bWJvbGdyZWVrID0gMHgwM2Q0OwogIHQuVXBzaWxvbmhvb2tzeW1ib2wgPSAweDAzZDI7CiAgdC5VcHNpbG9udG9ub3MgPSAweDAzOGU7CiAgdC5VcmluZyA9IDB4MDE2ZTsKICB0LlVzaG9ydGN5cmlsbGljID0gMHgwNDBlOwogIHQuVXNtYWxsID0gMHhmNzc1OwogIHQuVXN0cmFpZ2h0Y3lyaWxsaWMgPSAweDA0YWU7CiAgdC5Vc3RyYWlnaHRzdHJva2VjeXJpbGxpYyA9IDB4MDRiMDsKICB0LlV0aWxkZSA9IDB4MDE2ODsKICB0LlV0aWxkZWFjdXRlID0gMHgxZTc4OwogIHQuVXRpbGRlYmVsb3cgPSAweDFlNzQ7CiAgdC5WID0gMHgwMDU2OwogIHQuVmNpcmNsZSA9IDB4MjRjYjsKICB0LlZkb3RiZWxvdyA9IDB4MWU3ZTsKICB0LlZlY3lyaWxsaWMgPSAweDA0MTI7CiAgdC5WZXdhcm1lbmlhbiA9IDB4MDU0ZTsKICB0LlZob29rID0gMHgwMWIyOwogIHQuVm1vbm9zcGFjZSA9IDB4ZmYzNjsKICB0LlZvYXJtZW5pYW4gPSAweDA1NDg7CiAgdC5Wc21hbGwgPSAweGY3NzY7CiAgdC5WdGlsZGUgPSAweDFlN2M7CiAgdC5XID0gMHgwMDU3OwogIHQuV2FjdXRlID0gMHgxZTgyOwogIHQuV2NpcmNsZSA9IDB4MjRjYzsKICB0LldjaXJjdW1mbGV4ID0gMHgwMTc0OwogIHQuV2RpZXJlc2lzID0gMHgxZTg0OwogIHQuV2RvdGFjY2VudCA9IDB4MWU4NjsKICB0Lldkb3RiZWxvdyA9IDB4MWU4ODsKICB0LldncmF2ZSA9IDB4MWU4MDsKICB0Lldtb25vc3BhY2UgPSAweGZmMzc7CiAgdC5Xc21hbGwgPSAweGY3Nzc7CiAgdC5YID0gMHgwMDU4OwogIHQuWGNpcmNsZSA9IDB4MjRjZDsKICB0LlhkaWVyZXNpcyA9IDB4MWU4YzsKICB0Llhkb3RhY2NlbnQgPSAweDFlOGE7CiAgdC5YZWhhcm1lbmlhbiA9IDB4MDUzZDsKICB0LlhpID0gMHgwMzllOwogIHQuWG1vbm9zcGFjZSA9IDB4ZmYzODsKICB0LlhzbWFsbCA9IDB4Zjc3ODsKICB0LlkgPSAweDAwNTk7CiAgdC5ZYWN1dGUgPSAweDAwZGQ7CiAgdC5ZYWN1dGVzbWFsbCA9IDB4ZjdmZDsKICB0LllhdGN5cmlsbGljID0gMHgwNDYyOwogIHQuWWNpcmNsZSA9IDB4MjRjZTsKICB0LlljaXJjdW1mbGV4ID0gMHgwMTc2OwogIHQuWWRpZXJlc2lzID0gMHgwMTc4OwogIHQuWWRpZXJlc2lzc21hbGwgPSAweGY3ZmY7CiAgdC5ZZG90YWNjZW50ID0gMHgxZThlOwogIHQuWWRvdGJlbG93ID0gMHgxZWY0OwogIHQuWWVyaWN5cmlsbGljID0gMHgwNDJiOwogIHQuWWVydWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0Zjg7CiAgdC5ZZ3JhdmUgPSAweDFlZjI7CiAgdC5ZaG9vayA9IDB4MDFiMzsKICB0Lllob29rYWJvdmUgPSAweDFlZjY7CiAgdC5ZaWFybWVuaWFuID0gMHgwNTQ1OwogIHQuWWljeXJpbGxpYyA9IDB4MDQwNzsKICB0Lllpd25hcm1lbmlhbiA9IDB4MDU1MjsKICB0Llltb25vc3BhY2UgPSAweGZmMzk7CiAgdC5Zc21hbGwgPSAweGY3Nzk7CiAgdC5ZdGlsZGUgPSAweDFlZjg7CiAgdC5ZdXNiaWdjeXJpbGxpYyA9IDB4MDQ2YTsKICB0Lll1c2JpZ2lvdGlmaWVkY3lyaWxsaWMgPSAweDA0NmM7CiAgdC5ZdXNsaXR0bGVjeXJpbGxpYyA9IDB4MDQ2NjsKICB0Lll1c2xpdHRsZWlvdGlmaWVkY3lyaWxsaWMgPSAweDA0Njg7CiAgdC5aID0gMHgwMDVhOwogIHQuWmFhcm1lbmlhbiA9IDB4MDUzNjsKICB0LlphY3V0ZSA9IDB4MDE3OTsKICB0LlpjYXJvbiA9IDB4MDE3ZDsKICB0LlpjYXJvbnNtYWxsID0gMHhmNmZmOwogIHQuWmNpcmNsZSA9IDB4MjRjZjsKICB0LlpjaXJjdW1mbGV4ID0gMHgxZTkwOwogIHQuWmRvdCA9IDB4MDE3YjsKICB0Llpkb3RhY2NlbnQgPSAweDAxN2I7CiAgdC5aZG90YmVsb3cgPSAweDFlOTI7CiAgdC5aZWN5cmlsbGljID0gMHgwNDE3OwogIHQuWmVkZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDQ5ODsKICB0LlplZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRkZTsKICB0LlpldGEgPSAweDAzOTY7CiAgdC5aaGVhcm1lbmlhbiA9IDB4MDUzYTsKICB0LlpoZWJyZXZlY3lyaWxsaWMgPSAweDA0YzE7CiAgdC5aaGVjeXJpbGxpYyA9IDB4MDQxNjsKICB0LlpoZWRlc2NlbmRlcmN5cmlsbGljID0gMHgwNDk2OwogIHQuWmhlZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRkYzsKICB0LlpsaW5lYmVsb3cgPSAweDFlOTQ7CiAgdC5abW9ub3NwYWNlID0gMHhmZjNhOwogIHQuWnNtYWxsID0gMHhmNzdhOwogIHQuWnN0cm9rZSA9IDB4MDFiNTsKICB0LmEgPSAweDAwNjE7CiAgdC5hYWJlbmdhbGkgPSAweDA5ODY7CiAgdC5hYWN1dGUgPSAweDAwZTE7CiAgdC5hYWRldmEgPSAweDA5MDY7CiAgdC5hYWd1amFyYXRpID0gMHgwYTg2OwogIHQuYWFndXJtdWtoaSA9IDB4MGEwNjsKICB0LmFhbWF0cmFndXJtdWtoaSA9IDB4MGEzZTsKICB0LmFhcnVzcXVhcmUgPSAweDMzMDM7CiAgdC5hYXZvd2Vsc2lnbmJlbmdhbGkgPSAweDA5YmU7CiAgdC5hYXZvd2Vsc2lnbmRldmEgPSAweDA5M2U7CiAgdC5hYXZvd2Vsc2lnbmd1amFyYXRpID0gMHgwYWJlOwogIHQuYWJicmV2aWF0aW9ubWFya2FybWVuaWFuID0gMHgwNTVmOwogIHQuYWJicmV2aWF0aW9uc2lnbmRldmEgPSAweDA5NzA7CiAgdC5hYmVuZ2FsaSA9IDB4MDk4NTsKICB0LmFib3BvbW9mbyA9IDB4MzExYTsKICB0LmFicmV2ZSA9IDB4MDEwMzsKICB0LmFicmV2ZWFjdXRlID0gMHgxZWFmOwogIHQuYWJyZXZlY3lyaWxsaWMgPSAweDA0ZDE7CiAgdC5hYnJldmVkb3RiZWxvdyA9IDB4MWViNzsKICB0LmFicmV2ZWdyYXZlID0gMHgxZWIxOwogIHQuYWJyZXZlaG9va2Fib3ZlID0gMHgxZWIzOwogIHQuYWJyZXZldGlsZGUgPSAweDFlYjU7CiAgdC5hY2Fyb24gPSAweDAxY2U7CiAgdC5hY2lyY2xlID0gMHgyNGQwOwogIHQuYWNpcmN1bWZsZXggPSAweDAwZTI7CiAgdC5hY2lyY3VtZmxleGFjdXRlID0gMHgxZWE1OwogIHQuYWNpcmN1bWZsZXhkb3RiZWxvdyA9IDB4MWVhZDsKICB0LmFjaXJjdW1mbGV4Z3JhdmUgPSAweDFlYTc7CiAgdC5hY2lyY3VtZmxleGhvb2thYm92ZSA9IDB4MWVhOTsKICB0LmFjaXJjdW1mbGV4dGlsZGUgPSAweDFlYWI7CiAgdC5hY3V0ZSA9IDB4MDBiNDsKICB0LmFjdXRlYmVsb3djbWIgPSAweDAzMTc7CiAgdC5hY3V0ZWNtYiA9IDB4MDMwMTsKICB0LmFjdXRlY29tYiA9IDB4MDMwMTsKICB0LmFjdXRlZGV2YSA9IDB4MDk1NDsKICB0LmFjdXRlbG93bW9kID0gMHgwMmNmOwogIHQuYWN1dGV0b25lY21iID0gMHgwMzQxOwogIHQuYWN5cmlsbGljID0gMHgwNDMwOwogIHQuYWRibGdyYXZlID0gMHgwMjAxOwogIHQuYWRkYWtndXJtdWtoaSA9IDB4MGE3MTsKICB0LmFkZXZhID0gMHgwOTA1OwogIHQuYWRpZXJlc2lzID0gMHgwMGU0OwogIHQuYWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZDM7CiAgdC5hZGllcmVzaXNtYWNyb24gPSAweDAxZGY7CiAgdC5hZG90YmVsb3cgPSAweDFlYTE7CiAgdC5hZG90bWFjcm9uID0gMHgwMWUxOwogIHQuYWUgPSAweDAwZTY7CiAgdC5hZWFjdXRlID0gMHgwMWZkOwogIHQuYWVrb3JlYW4gPSAweDMxNTA7CiAgdC5hZW1hY3JvbiA9IDB4MDFlMzsKICB0LmFmaWkwMDIwOCA9IDB4MjAxNTsKICB0LmFmaWkwODk0MSA9IDB4MjBhNDsKICB0LmFmaWkxMDAxNyA9IDB4MDQxMDsKICB0LmFmaWkxMDAxOCA9IDB4MDQxMTsKICB0LmFmaWkxMDAxOSA9IDB4MDQxMjsKICB0LmFmaWkxMDAyMCA9IDB4MDQxMzsKICB0LmFmaWkxMDAyMSA9IDB4MDQxNDsKICB0LmFmaWkxMDAyMiA9IDB4MDQxNTsKICB0LmFmaWkxMDAyMyA9IDB4MDQwMTsKICB0LmFmaWkxMDAyNCA9IDB4MDQxNjsKICB0LmFmaWkxMDAyNSA9IDB4MDQxNzsKICB0LmFmaWkxMDAyNiA9IDB4MDQxODsKICB0LmFmaWkxMDAyNyA9IDB4MDQxOTsKICB0LmFmaWkxMDAyOCA9IDB4MDQxYTsKICB0LmFmaWkxMDAyOSA9IDB4MDQxYjsKICB0LmFmaWkxMDAzMCA9IDB4MDQxYzsKICB0LmFmaWkxMDAzMSA9IDB4MDQxZDsKICB0LmFmaWkxMDAzMiA9IDB4MDQxZTsKICB0LmFmaWkxMDAzMyA9IDB4MDQxZjsKICB0LmFmaWkxMDAzNCA9IDB4MDQyMDsKICB0LmFmaWkxMDAzNSA9IDB4MDQyMTsKICB0LmFmaWkxMDAzNiA9IDB4MDQyMjsKICB0LmFmaWkxMDAzNyA9IDB4MDQyMzsKICB0LmFmaWkxMDAzOCA9IDB4MDQyNDsKICB0LmFmaWkxMDAzOSA9IDB4MDQyNTsKICB0LmFmaWkxMDA0MCA9IDB4MDQyNjsKICB0LmFmaWkxMDA0MSA9IDB4MDQyNzsKICB0LmFmaWkxMDA0MiA9IDB4MDQyODsKICB0LmFmaWkxMDA0MyA9IDB4MDQyOTsKICB0LmFmaWkxMDA0NCA9IDB4MDQyYTsKICB0LmFmaWkxMDA0NSA9IDB4MDQyYjsKICB0LmFmaWkxMDA0NiA9IDB4MDQyYzsKICB0LmFmaWkxMDA0NyA9IDB4MDQyZDsKICB0LmFmaWkxMDA0OCA9IDB4MDQyZTsKICB0LmFmaWkxMDA0OSA9IDB4MDQyZjsKICB0LmFmaWkxMDA1MCA9IDB4MDQ5MDsKICB0LmFmaWkxMDA1MSA9IDB4MDQwMjsKICB0LmFmaWkxMDA1MiA9IDB4MDQwMzsKICB0LmFmaWkxMDA1MyA9IDB4MDQwNDsKICB0LmFmaWkxMDA1NCA9IDB4MDQwNTsKICB0LmFmaWkxMDA1NSA9IDB4MDQwNjsKICB0LmFmaWkxMDA1NiA9IDB4MDQwNzsKICB0LmFmaWkxMDA1NyA9IDB4MDQwODsKICB0LmFmaWkxMDA1OCA9IDB4MDQwOTsKICB0LmFmaWkxMDA1OSA9IDB4MDQwYTsKICB0LmFmaWkxMDA2MCA9IDB4MDQwYjsKICB0LmFmaWkxMDA2MSA9IDB4MDQwYzsKICB0LmFmaWkxMDA2MiA9IDB4MDQwZTsKICB0LmFmaWkxMDA2MyA9IDB4ZjZjNDsKICB0LmFmaWkxMDA2NCA9IDB4ZjZjNTsKICB0LmFmaWkxMDA2NSA9IDB4MDQzMDsKICB0LmFmaWkxMDA2NiA9IDB4MDQzMTsKICB0LmFmaWkxMDA2NyA9IDB4MDQzMjsKICB0LmFmaWkxMDA2OCA9IDB4MDQzMzsKICB0LmFmaWkxMDA2OSA9IDB4MDQzNDsKICB0LmFmaWkxMDA3MCA9IDB4MDQzNTsKICB0LmFmaWkxMDA3MSA9IDB4MDQ1MTsKICB0LmFmaWkxMDA3MiA9IDB4MDQzNjsKICB0LmFmaWkxMDA3MyA9IDB4MDQzNzsKICB0LmFmaWkxMDA3NCA9IDB4MDQzODsKICB0LmFmaWkxMDA3NSA9IDB4MDQzOTsKICB0LmFmaWkxMDA3NiA9IDB4MDQzYTsKICB0LmFmaWkxMDA3NyA9IDB4MDQzYjsKICB0LmFmaWkxMDA3OCA9IDB4MDQzYzsKICB0LmFmaWkxMDA3OSA9IDB4MDQzZDsKICB0LmFmaWkxMDA4MCA9IDB4MDQzZTsKICB0LmFmaWkxMDA4MSA9IDB4MDQzZjsKICB0LmFmaWkxMDA4MiA9IDB4MDQ0MDsKICB0LmFmaWkxMDA4MyA9IDB4MDQ0MTsKICB0LmFmaWkxMDA4NCA9IDB4MDQ0MjsKICB0LmFmaWkxMDA4NSA9IDB4MDQ0MzsKICB0LmFmaWkxMDA4NiA9IDB4MDQ0NDsKICB0LmFmaWkxMDA4NyA9IDB4MDQ0NTsKICB0LmFmaWkxMDA4OCA9IDB4MDQ0NjsKICB0LmFmaWkxMDA4OSA9IDB4MDQ0NzsKICB0LmFmaWkxMDA5MCA9IDB4MDQ0ODsKICB0LmFmaWkxMDA5MSA9IDB4MDQ0OTsKICB0LmFmaWkxMDA5MiA9IDB4MDQ0YTsKICB0LmFmaWkxMDA5MyA9IDB4MDQ0YjsKICB0LmFmaWkxMDA5NCA9IDB4MDQ0YzsKICB0LmFmaWkxMDA5NSA9IDB4MDQ0ZDsKICB0LmFmaWkxMDA5NiA9IDB4MDQ0ZTsKICB0LmFmaWkxMDA5NyA9IDB4MDQ0ZjsKICB0LmFmaWkxMDA5OCA9IDB4MDQ5MTsKICB0LmFmaWkxMDA5OSA9IDB4MDQ1MjsKICB0LmFmaWkxMDEwMCA9IDB4MDQ1MzsKICB0LmFmaWkxMDEwMSA9IDB4MDQ1NDsKICB0LmFmaWkxMDEwMiA9IDB4MDQ1NTsKICB0LmFmaWkxMDEwMyA9IDB4MDQ1NjsKICB0LmFmaWkxMDEwNCA9IDB4MDQ1NzsKICB0LmFmaWkxMDEwNSA9IDB4MDQ1ODsKICB0LmFmaWkxMDEwNiA9IDB4MDQ1OTsKICB0LmFmaWkxMDEwNyA9IDB4MDQ1YTsKICB0LmFmaWkxMDEwOCA9IDB4MDQ1YjsKICB0LmFmaWkxMDEwOSA9IDB4MDQ1YzsKICB0LmFmaWkxMDExMCA9IDB4MDQ1ZTsKICB0LmFmaWkxMDE0NSA9IDB4MDQwZjsKICB0LmFmaWkxMDE0NiA9IDB4MDQ2MjsKICB0LmFmaWkxMDE0NyA9IDB4MDQ3MjsKICB0LmFmaWkxMDE0OCA9IDB4MDQ3NDsKICB0LmFmaWkxMDE5MiA9IDB4ZjZjNjsKICB0LmFmaWkxMDE5MyA9IDB4MDQ1ZjsKICB0LmFmaWkxMDE5NCA9IDB4MDQ2MzsKICB0LmFmaWkxMDE5NSA9IDB4MDQ3MzsKICB0LmFmaWkxMDE5NiA9IDB4MDQ3NTsKICB0LmFmaWkxMDgzMSA9IDB4ZjZjNzsKICB0LmFmaWkxMDgzMiA9IDB4ZjZjODsKICB0LmFmaWkxMDg0NiA9IDB4MDRkOTsKICB0LmFmaWkyOTkgPSAweDIwMGU7CiAgdC5hZmlpMzAwID0gMHgyMDBmOwogIHQuYWZpaTMwMSA9IDB4MjAwZDsKICB0LmFmaWk1NzM4MSA9IDB4MDY2YTsKICB0LmFmaWk1NzM4OCA9IDB4MDYwYzsKICB0LmFmaWk1NzM5MiA9IDB4MDY2MDsKICB0LmFmaWk1NzM5MyA9IDB4MDY2MTsKICB0LmFmaWk1NzM5NCA9IDB4MDY2MjsKICB0LmFmaWk1NzM5NSA9IDB4MDY2MzsKICB0LmFmaWk1NzM5NiA9IDB4MDY2NDsKICB0LmFmaWk1NzM5NyA9IDB4MDY2NTsKICB0LmFmaWk1NzM5OCA9IDB4MDY2NjsKICB0LmFmaWk1NzM5OSA9IDB4MDY2NzsKICB0LmFmaWk1NzQwMCA9IDB4MDY2ODsKICB0LmFmaWk1NzQwMSA9IDB4MDY2OTsKICB0LmFmaWk1NzQwMyA9IDB4MDYxYjsKICB0LmFmaWk1NzQwNyA9IDB4MDYxZjsKICB0LmFmaWk1NzQwOSA9IDB4MDYyMTsKICB0LmFmaWk1NzQxMCA9IDB4MDYyMjsKICB0LmFmaWk1NzQxMSA9IDB4MDYyMzsKICB0LmFmaWk1NzQxMiA9IDB4MDYyNDsKICB0LmFmaWk1NzQxMyA9IDB4MDYyNTsKICB0LmFmaWk1NzQxNCA9IDB4MDYyNjsKICB0LmFmaWk1NzQxNSA9IDB4MDYyNzsKICB0LmFmaWk1NzQxNiA9IDB4MDYyODsKICB0LmFmaWk1NzQxNyA9IDB4MDYyOTsKICB0LmFmaWk1NzQxOCA9IDB4MDYyYTsKICB0LmFmaWk1NzQxOSA9IDB4MDYyYjsKICB0LmFmaWk1NzQyMCA9IDB4MDYyYzsKICB0LmFmaWk1NzQyMSA9IDB4MDYyZDsKICB0LmFmaWk1NzQyMiA9IDB4MDYyZTsKICB0LmFmaWk1NzQyMyA9IDB4MDYyZjsKICB0LmFmaWk1NzQyNCA9IDB4MDYzMDsKICB0LmFmaWk1NzQyNSA9IDB4MDYzMTsKICB0LmFmaWk1NzQyNiA9IDB4MDYzMjsKICB0LmFmaWk1NzQyNyA9IDB4MDYzMzsKICB0LmFmaWk1NzQyOCA9IDB4MDYzNDsKICB0LmFmaWk1NzQyOSA9IDB4MDYzNTsKICB0LmFmaWk1NzQzMCA9IDB4MDYzNjsKICB0LmFmaWk1NzQzMSA9IDB4MDYzNzsKICB0LmFmaWk1NzQzMiA9IDB4MDYzODsKICB0LmFmaWk1NzQzMyA9IDB4MDYzOTsKICB0LmFmaWk1NzQzNCA9IDB4MDYzYTsKICB0LmFmaWk1NzQ0MCA9IDB4MDY0MDsKICB0LmFmaWk1NzQ0MSA9IDB4MDY0MTsKICB0LmFmaWk1NzQ0MiA9IDB4MDY0MjsKICB0LmFmaWk1NzQ0MyA9IDB4MDY0MzsKICB0LmFmaWk1NzQ0NCA9IDB4MDY0NDsKICB0LmFmaWk1NzQ0NSA9IDB4MDY0NTsKICB0LmFmaWk1NzQ0NiA9IDB4MDY0NjsKICB0LmFmaWk1NzQ0OCA9IDB4MDY0ODsKICB0LmFmaWk1NzQ0OSA9IDB4MDY0OTsKICB0LmFmaWk1NzQ1MCA9IDB4MDY0YTsKICB0LmFmaWk1NzQ1MSA9IDB4MDY0YjsKICB0LmFmaWk1NzQ1MiA9IDB4MDY0YzsKICB0LmFmaWk1NzQ1MyA9IDB4MDY0ZDsKICB0LmFmaWk1NzQ1NCA9IDB4MDY0ZTsKICB0LmFmaWk1NzQ1NSA9IDB4MDY0ZjsKICB0LmFmaWk1NzQ1NiA9IDB4MDY1MDsKICB0LmFmaWk1NzQ1NyA9IDB4MDY1MTsKICB0LmFmaWk1NzQ1OCA9IDB4MDY1MjsKICB0LmFmaWk1NzQ3MCA9IDB4MDY0NzsKICB0LmFmaWk1NzUwNSA9IDB4MDZhNDsKICB0LmFmaWk1NzUwNiA9IDB4MDY3ZTsKICB0LmFmaWk1NzUwNyA9IDB4MDY4NjsKICB0LmFmaWk1NzUwOCA9IDB4MDY5ODsKICB0LmFmaWk1NzUwOSA9IDB4MDZhZjsKICB0LmFmaWk1NzUxMSA9IDB4MDY3OTsKICB0LmFmaWk1NzUxMiA9IDB4MDY4ODsKICB0LmFmaWk1NzUxMyA9IDB4MDY5MTsKICB0LmFmaWk1NzUxNCA9IDB4MDZiYTsKICB0LmFmaWk1NzUxOSA9IDB4MDZkMjsKICB0LmFmaWk1NzUzNCA9IDB4MDZkNTsKICB0LmFmaWk1NzYzNiA9IDB4MjBhYTsKICB0LmFmaWk1NzY0NSA9IDB4MDViZTsKICB0LmFmaWk1NzY1OCA9IDB4MDVjMzsKICB0LmFmaWk1NzY2NCA9IDB4MDVkMDsKICB0LmFmaWk1NzY2NSA9IDB4MDVkMTsKICB0LmFmaWk1NzY2NiA9IDB4MDVkMjsKICB0LmFmaWk1NzY2NyA9IDB4MDVkMzsKICB0LmFmaWk1NzY2OCA9IDB4MDVkNDsKICB0LmFmaWk1NzY2OSA9IDB4MDVkNTsKICB0LmFmaWk1NzY3MCA9IDB4MDVkNjsKICB0LmFmaWk1NzY3MSA9IDB4MDVkNzsKICB0LmFmaWk1NzY3MiA9IDB4MDVkODsKICB0LmFmaWk1NzY3MyA9IDB4MDVkOTsKICB0LmFmaWk1NzY3NCA9IDB4MDVkYTsKICB0LmFmaWk1NzY3NSA9IDB4MDVkYjsKICB0LmFmaWk1NzY3NiA9IDB4MDVkYzsKICB0LmFmaWk1NzY3NyA9IDB4MDVkZDsKICB0LmFmaWk1NzY3OCA9IDB4MDVkZTsKICB0LmFmaWk1NzY3OSA9IDB4MDVkZjsKICB0LmFmaWk1NzY4MCA9IDB4MDVlMDsKICB0LmFmaWk1NzY4MSA9IDB4MDVlMTsKICB0LmFmaWk1NzY4MiA9IDB4MDVlMjsKICB0LmFmaWk1NzY4MyA9IDB4MDVlMzsKICB0LmFmaWk1NzY4NCA9IDB4MDVlNDsKICB0LmFmaWk1NzY4NSA9IDB4MDVlNTsKICB0LmFmaWk1NzY4NiA9IDB4MDVlNjsKICB0LmFmaWk1NzY4NyA9IDB4MDVlNzsKICB0LmFmaWk1NzY4OCA9IDB4MDVlODsKICB0LmFmaWk1NzY4OSA9IDB4MDVlOTsKICB0LmFmaWk1NzY5MCA9IDB4MDVlYTsKICB0LmFmaWk1NzY5NCA9IDB4ZmIyYTsKICB0LmFmaWk1NzY5NSA9IDB4ZmIyYjsKICB0LmFmaWk1NzcwMCA9IDB4ZmI0YjsKICB0LmFmaWk1NzcwNSA9IDB4ZmIxZjsKICB0LmFmaWk1NzcxNiA9IDB4MDVmMDsKICB0LmFmaWk1NzcxNyA9IDB4MDVmMTsKICB0LmFmaWk1NzcxOCA9IDB4MDVmMjsKICB0LmFmaWk1NzcyMyA9IDB4ZmIzNTsKICB0LmFmaWk1Nzc5MyA9IDB4MDViNDsKICB0LmFmaWk1Nzc5NCA9IDB4MDViNTsKICB0LmFmaWk1Nzc5NSA9IDB4MDViNjsKICB0LmFmaWk1Nzc5NiA9IDB4MDViYjsKICB0LmFmaWk1Nzc5NyA9IDB4MDViODsKICB0LmFmaWk1Nzc5OCA9IDB4MDViNzsKICB0LmFmaWk1Nzc5OSA9IDB4MDViMDsKICB0LmFmaWk1NzgwMCA9IDB4MDViMjsKICB0LmFmaWk1NzgwMSA9IDB4MDViMTsKICB0LmFmaWk1NzgwMiA9IDB4MDViMzsKICB0LmFmaWk1NzgwMyA9IDB4MDVjMjsKICB0LmFmaWk1NzgwNCA9IDB4MDVjMTsKICB0LmFmaWk1NzgwNiA9IDB4MDViOTsKICB0LmFmaWk1NzgwNyA9IDB4MDViYzsKICB0LmFmaWk1NzgzOSA9IDB4MDViZDsKICB0LmFmaWk1Nzg0MSA9IDB4MDViZjsKICB0LmFmaWk1Nzg0MiA9IDB4MDVjMDsKICB0LmFmaWk1NzkyOSA9IDB4MDJiYzsKICB0LmFmaWk2MTI0OCA9IDB4MjEwNTsKICB0LmFmaWk2MTI4OSA9IDB4MjExMzsKICB0LmFmaWk2MTM1MiA9IDB4MjExNjsKICB0LmFmaWk2MTU3MyA9IDB4MjAyYzsKICB0LmFmaWk2MTU3NCA9IDB4MjAyZDsKICB0LmFmaWk2MTU3NSA9IDB4MjAyZTsKICB0LmFmaWk2MTY2NCA9IDB4MjAwYzsKICB0LmFmaWk2MzE2NyA9IDB4MDY2ZDsKICB0LmFmaWk2NDkzNyA9IDB4MDJiZDsKICB0LmFncmF2ZSA9IDB4MDBlMDsKICB0LmFndWphcmF0aSA9IDB4MGE4NTsKICB0LmFndXJtdWtoaSA9IDB4MGEwNTsKICB0LmFoaXJhZ2FuYSA9IDB4MzA0MjsKICB0LmFob29rYWJvdmUgPSAweDFlYTM7CiAgdC5haWJlbmdhbGkgPSAweDA5OTA7CiAgdC5haWJvcG9tb2ZvID0gMHgzMTFlOwogIHQuYWlkZXZhID0gMHgwOTEwOwogIHQuYWllY3lyaWxsaWMgPSAweDA0ZDU7CiAgdC5haWd1amFyYXRpID0gMHgwYTkwOwogIHQuYWlndXJtdWtoaSA9IDB4MGExMDsKICB0LmFpbWF0cmFndXJtdWtoaSA9IDB4MGE0ODsKICB0LmFpbmFyYWJpYyA9IDB4MDYzOTsKICB0LmFpbmZpbmFsYXJhYmljID0gMHhmZWNhOwogIHQuYWluaW5pdGlhbGFyYWJpYyA9IDB4ZmVjYjsKICB0LmFpbm1lZGlhbGFyYWJpYyA9IDB4ZmVjYzsKICB0LmFpbnZlcnRlZGJyZXZlID0gMHgwMjAzOwogIHQuYWl2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWM4OwogIHQuYWl2b3dlbHNpZ25kZXZhID0gMHgwOTQ4OwogIHQuYWl2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjODsKICB0LmFrYXRha2FuYSA9IDB4MzBhMjsKICB0LmFrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3MTsKICB0LmFrb3JlYW4gPSAweDMxNGY7CiAgdC5hbGVmID0gMHgwNWQwOwogIHQuYWxlZmFyYWJpYyA9IDB4MDYyNzsKICB0LmFsZWZkYWdlc2hoZWJyZXcgPSAweGZiMzA7CiAgdC5hbGVmZmluYWxhcmFiaWMgPSAweGZlOGU7CiAgdC5hbGVmaGFtemFhYm92ZWFyYWJpYyA9IDB4MDYyMzsKICB0LmFsZWZoYW16YWFib3ZlZmluYWxhcmFiaWMgPSAweGZlODQ7CiAgdC5hbGVmaGFtemFiZWxvd2FyYWJpYyA9IDB4MDYyNTsKICB0LmFsZWZoYW16YWJlbG93ZmluYWxhcmFiaWMgPSAweGZlODg7CiAgdC5hbGVmaGVicmV3ID0gMHgwNWQwOwogIHQuYWxlZmxhbWVkaGVicmV3ID0gMHhmYjRmOwogIHQuYWxlZm1hZGRhYWJvdmVhcmFiaWMgPSAweDA2MjI7CiAgdC5hbGVmbWFkZGFhYm92ZWZpbmFsYXJhYmljID0gMHhmZTgyOwogIHQuYWxlZm1ha3N1cmFhcmFiaWMgPSAweDA2NDk7CiAgdC5hbGVmbWFrc3VyYWZpbmFsYXJhYmljID0gMHhmZWYwOwogIHQuYWxlZm1ha3N1cmFpbml0aWFsYXJhYmljID0gMHhmZWYzOwogIHQuYWxlZm1ha3N1cmFtZWRpYWxhcmFiaWMgPSAweGZlZjQ7CiAgdC5hbGVmcGF0YWhoZWJyZXcgPSAweGZiMmU7CiAgdC5hbGVmcWFtYXRzaGVicmV3ID0gMHhmYjJmOwogIHQuYWxlcGggPSAweDIxMzU7CiAgdC5hbGxlcXVhbCA9IDB4MjI0YzsKICB0LmFscGhhID0gMHgwM2IxOwogIHQuYWxwaGF0b25vcyA9IDB4MDNhYzsKICB0LmFtYWNyb24gPSAweDAxMDE7CiAgdC5hbW9ub3NwYWNlID0gMHhmZjQxOwogIHQuYW1wZXJzYW5kID0gMHgwMDI2OwogIHQuYW1wZXJzYW5kbW9ub3NwYWNlID0gMHhmZjA2OwogIHQuYW1wZXJzYW5kc21hbGwgPSAweGY3MjY7CiAgdC5hbXNxdWFyZSA9IDB4MzNjMjsKICB0LmFuYm9wb21vZm8gPSAweDMxMjI7CiAgdC5hbmdib3BvbW9mbyA9IDB4MzEyNDsKICB0LmFuZ2JyYWNrZXRsZWZ0ID0gMHgzMDA4OwogIHQuYW5nYnJhY2tldHJpZ2h0ID0gMHgzMDA5OwogIHQuYW5na2hhbmtodXRoYWkgPSAweDBlNWE7CiAgdC5hbmdsZSA9IDB4MjIyMDsKICB0LmFuZ2xlYnJhY2tldGxlZnQgPSAweDMwMDg7CiAgdC5hbmdsZWJyYWNrZXRsZWZ0dmVydGljYWwgPSAweGZlM2Y7CiAgdC5hbmdsZWJyYWNrZXRyaWdodCA9IDB4MzAwOTsKICB0LmFuZ2xlYnJhY2tldHJpZ2h0dmVydGljYWwgPSAweGZlNDA7CiAgdC5hbmdsZWxlZnQgPSAweDIzMjk7CiAgdC5hbmdsZXJpZ2h0ID0gMHgyMzJhOwogIHQuYW5nc3Ryb20gPSAweDIxMmI7CiAgdC5hbm90ZWxlaWEgPSAweDAzODc7CiAgdC5hbnVkYXR0YWRldmEgPSAweDA5NTI7CiAgdC5hbnVzdmFyYWJlbmdhbGkgPSAweDA5ODI7CiAgdC5hbnVzdmFyYWRldmEgPSAweDA5MDI7CiAgdC5hbnVzdmFyYWd1amFyYXRpID0gMHgwYTgyOwogIHQuYW9nb25layA9IDB4MDEwNTsKICB0LmFwYWF0b3NxdWFyZSA9IDB4MzMwMDsKICB0LmFwYXJlbiA9IDB4MjQ5YzsKICB0LmFwb3N0cm9waGVhcm1lbmlhbiA9IDB4MDU1YTsKICB0LmFwb3N0cm9waGVtb2QgPSAweDAyYmM7CiAgdC5hcHBsZSA9IDB4ZjhmZjsKICB0LmFwcHJvYWNoZXMgPSAweDIyNTA7CiAgdC5hcHByb3hlcXVhbCA9IDB4MjI0ODsKICB0LmFwcHJveGVxdWFsb3JpbWFnZSA9IDB4MjI1MjsKICB0LmFwcHJveGltYXRlbHllcXVhbCA9IDB4MjI0NTsKICB0LmFyYWVhZWtvcmVhbiA9IDB4MzE4ZTsKICB0LmFyYWVha29yZWFuID0gMHgzMThkOwogIHQuYXJjID0gMHgyMzEyOwogIHQuYXJpZ2h0aGFsZnJpbmcgPSAweDFlOWE7CiAgdC5hcmluZyA9IDB4MDBlNTsKICB0LmFyaW5nYWN1dGUgPSAweDAxZmI7CiAgdC5hcmluZ2JlbG93ID0gMHgxZTAxOwogIHQuYXJyb3dib3RoID0gMHgyMTk0OwogIHQuYXJyb3dkYXNoZG93biA9IDB4MjFlMzsKICB0LmFycm93ZGFzaGxlZnQgPSAweDIxZTA7CiAgdC5hcnJvd2Rhc2hyaWdodCA9IDB4MjFlMjsKICB0LmFycm93ZGFzaHVwID0gMHgyMWUxOwogIHQuYXJyb3dkYmxib3RoID0gMHgyMWQ0OwogIHQuYXJyb3dkYmxkb3duID0gMHgyMWQzOwogIHQuYXJyb3dkYmxsZWZ0ID0gMHgyMWQwOwogIHQuYXJyb3dkYmxyaWdodCA9IDB4MjFkMjsKICB0LmFycm93ZGJsdXAgPSAweDIxZDE7CiAgdC5hcnJvd2Rvd24gPSAweDIxOTM7CiAgdC5hcnJvd2Rvd25sZWZ0ID0gMHgyMTk5OwogIHQuYXJyb3dkb3ducmlnaHQgPSAweDIxOTg7CiAgdC5hcnJvd2Rvd253aGl0ZSA9IDB4MjFlOTsKICB0LmFycm93aGVhZGRvd25tb2QgPSAweDAyYzU7CiAgdC5hcnJvd2hlYWRsZWZ0bW9kID0gMHgwMmMyOwogIHQuYXJyb3doZWFkcmlnaHRtb2QgPSAweDAyYzM7CiAgdC5hcnJvd2hlYWR1cG1vZCA9IDB4MDJjNDsKICB0LmFycm93aG9yaXpleCA9IDB4ZjhlNzsKICB0LmFycm93bGVmdCA9IDB4MjE5MDsKICB0LmFycm93bGVmdGRibCA9IDB4MjFkMDsKICB0LmFycm93bGVmdGRibHN0cm9rZSA9IDB4MjFjZDsKICB0LmFycm93bGVmdG92ZXJyaWdodCA9IDB4MjFjNjsKICB0LmFycm93bGVmdHdoaXRlID0gMHgyMWU2OwogIHQuYXJyb3dyaWdodCA9IDB4MjE5MjsKICB0LmFycm93cmlnaHRkYmxzdHJva2UgPSAweDIxY2Y7CiAgdC5hcnJvd3JpZ2h0aGVhdnkgPSAweDI3OWU7CiAgdC5hcnJvd3JpZ2h0b3ZlcmxlZnQgPSAweDIxYzQ7CiAgdC5hcnJvd3JpZ2h0d2hpdGUgPSAweDIxZTg7CiAgdC5hcnJvd3RhYmxlZnQgPSAweDIxZTQ7CiAgdC5hcnJvd3RhYnJpZ2h0ID0gMHgyMWU1OwogIHQuYXJyb3d1cCA9IDB4MjE5MTsKICB0LmFycm93dXBkbiA9IDB4MjE5NTsKICB0LmFycm93dXBkbmJzZSA9IDB4MjFhODsKICB0LmFycm93dXBkb3duYmFzZSA9IDB4MjFhODsKICB0LmFycm93dXBsZWZ0ID0gMHgyMTk2OwogIHQuYXJyb3d1cGxlZnRvZmRvd24gPSAweDIxYzU7CiAgdC5hcnJvd3VwcmlnaHQgPSAweDIxOTc7CiAgdC5hcnJvd3Vwd2hpdGUgPSAweDIxZTc7CiAgdC5hcnJvd3ZlcnRleCA9IDB4ZjhlNjsKICB0LmFzY2lpY2lyY3VtID0gMHgwMDVlOwogIHQuYXNjaWljaXJjdW1tb25vc3BhY2UgPSAweGZmM2U7CiAgdC5hc2NpaXRpbGRlID0gMHgwMDdlOwogIHQuYXNjaWl0aWxkZW1vbm9zcGFjZSA9IDB4ZmY1ZTsKICB0LmFzY3JpcHQgPSAweDAyNTE7CiAgdC5hc2NyaXB0dHVybmVkID0gMHgwMjUyOwogIHQuYXNtYWxsaGlyYWdhbmEgPSAweDMwNDE7CiAgdC5hc21hbGxrYXRha2FuYSA9IDB4MzBhMTsKICB0LmFzbWFsbGthdGFrYW5haGFsZndpZHRoID0gMHhmZjY3OwogIHQuYXN0ZXJpc2sgPSAweDAwMmE7CiAgdC5hc3Rlcmlza2FsdG9uZWFyYWJpYyA9IDB4MDY2ZDsKICB0LmFzdGVyaXNrYXJhYmljID0gMHgwNjZkOwogIHQuYXN0ZXJpc2ttYXRoID0gMHgyMjE3OwogIHQuYXN0ZXJpc2ttb25vc3BhY2UgPSAweGZmMGE7CiAgdC5hc3Rlcmlza3NtYWxsID0gMHhmZTYxOwogIHQuYXN0ZXJpc20gPSAweDIwNDI7CiAgdC5hc3VwZXJpb3IgPSAweGY2ZTk7CiAgdC5hc3ltcHRvdGljYWxseWVxdWFsID0gMHgyMjQzOwogIHQuYXQgPSAweDAwNDA7CiAgdC5hdGlsZGUgPSAweDAwZTM7CiAgdC5hdG1vbm9zcGFjZSA9IDB4ZmYyMDsKICB0LmF0c21hbGwgPSAweGZlNmI7CiAgdC5hdHVybmVkID0gMHgwMjUwOwogIHQuYXViZW5nYWxpID0gMHgwOTk0OwogIHQuYXVib3BvbW9mbyA9IDB4MzEyMDsKICB0LmF1ZGV2YSA9IDB4MDkxNDsKICB0LmF1Z3VqYXJhdGkgPSAweDBhOTQ7CiAgdC5hdWd1cm11a2hpID0gMHgwYTE0OwogIHQuYXVsZW5ndGhtYXJrYmVuZ2FsaSA9IDB4MDlkNzsKICB0LmF1bWF0cmFndXJtdWtoaSA9IDB4MGE0YzsKICB0LmF1dm93ZWxzaWduYmVuZ2FsaSA9IDB4MDljYzsKICB0LmF1dm93ZWxzaWduZGV2YSA9IDB4MDk0YzsKICB0LmF1dm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhY2M7CiAgdC5hdmFncmFoYWRldmEgPSAweDA5M2Q7CiAgdC5heWJhcm1lbmlhbiA9IDB4MDU2MTsKICB0LmF5aW4gPSAweDA1ZTI7CiAgdC5heWluYWx0b25laGVicmV3ID0gMHhmYjIwOwogIHQuYXlpbmhlYnJldyA9IDB4MDVlMjsKICB0LmIgPSAweDAwNjI7CiAgdC5iYWJlbmdhbGkgPSAweDA5YWM7CiAgdC5iYWNrc2xhc2ggPSAweDAwNWM7CiAgdC5iYWNrc2xhc2htb25vc3BhY2UgPSAweGZmM2M7CiAgdC5iYWRldmEgPSAweDA5MmM7CiAgdC5iYWd1amFyYXRpID0gMHgwYWFjOwogIHQuYmFndXJtdWtoaSA9IDB4MGEyYzsKICB0LmJhaGlyYWdhbmEgPSAweDMwNzA7CiAgdC5iYWh0dGhhaSA9IDB4MGUzZjsKICB0LmJha2F0YWthbmEgPSAweDMwZDA7CiAgdC5iYXIgPSAweDAwN2M7CiAgdC5iYXJtb25vc3BhY2UgPSAweGZmNWM7CiAgdC5iYm9wb21vZm8gPSAweDMxMDU7CiAgdC5iY2lyY2xlID0gMHgyNGQxOwogIHQuYmRvdGFjY2VudCA9IDB4MWUwMzsKICB0LmJkb3RiZWxvdyA9IDB4MWUwNTsKICB0LmJlYW1lZHNpeHRlZW50aG5vdGVzID0gMHgyNjZjOwogIHQuYmVjYXVzZSA9IDB4MjIzNTsKICB0LmJlY3lyaWxsaWMgPSAweDA0MzE7CiAgdC5iZWhhcmFiaWMgPSAweDA2Mjg7CiAgdC5iZWhmaW5hbGFyYWJpYyA9IDB4ZmU5MDsKICB0LmJlaGluaXRpYWxhcmFiaWMgPSAweGZlOTE7CiAgdC5iZWhpcmFnYW5hID0gMHgzMDc5OwogIHQuYmVobWVkaWFsYXJhYmljID0gMHhmZTkyOwogIHQuYmVobWVlbWluaXRpYWxhcmFiaWMgPSAweGZjOWY7CiAgdC5iZWhtZWVtaXNvbGF0ZWRhcmFiaWMgPSAweGZjMDg7CiAgdC5iZWhub29uZmluYWxhcmFiaWMgPSAweGZjNmQ7CiAgdC5iZWthdGFrYW5hID0gMHgzMGQ5OwogIHQuYmVuYXJtZW5pYW4gPSAweDA1NjI7CiAgdC5iZXQgPSAweDA1ZDE7CiAgdC5iZXRhID0gMHgwM2IyOwogIHQuYmV0YXN5bWJvbGdyZWVrID0gMHgwM2QwOwogIHQuYmV0ZGFnZXNoID0gMHhmYjMxOwogIHQuYmV0ZGFnZXNoaGVicmV3ID0gMHhmYjMxOwogIHQuYmV0aGVicmV3ID0gMHgwNWQxOwogIHQuYmV0cmFmZWhlYnJldyA9IDB4ZmI0YzsKICB0LmJoYWJlbmdhbGkgPSAweDA5YWQ7CiAgdC5iaGFkZXZhID0gMHgwOTJkOwogIHQuYmhhZ3VqYXJhdGkgPSAweDBhYWQ7CiAgdC5iaGFndXJtdWtoaSA9IDB4MGEyZDsKICB0LmJob29rID0gMHgwMjUzOwogIHQuYmloaXJhZ2FuYSA9IDB4MzA3MzsKICB0LmJpa2F0YWthbmEgPSAweDMwZDM7CiAgdC5iaWxhYmlhbGNsaWNrID0gMHgwMjk4OwogIHQuYmluZGlndXJtdWtoaSA9IDB4MGEwMjsKICB0LmJpcnVzcXVhcmUgPSAweDMzMzE7CiAgdC5ibGFja2NpcmNsZSA9IDB4MjVjZjsKICB0LmJsYWNrZGlhbW9uZCA9IDB4MjVjNjsKICB0LmJsYWNrZG93bnBvaW50aW5ndHJpYW5nbGUgPSAweDI1YmM7CiAgdC5ibGFja2xlZnRwb2ludGluZ3BvaW50ZXIgPSAweDI1YzQ7CiAgdC5ibGFja2xlZnRwb2ludGluZ3RyaWFuZ2xlID0gMHgyNWMwOwogIHQuYmxhY2tsZW50aWN1bGFyYnJhY2tldGxlZnQgPSAweDMwMTA7CiAgdC5ibGFja2xlbnRpY3VsYXJicmFja2V0bGVmdHZlcnRpY2FsID0gMHhmZTNiOwogIHQuYmxhY2tsZW50aWN1bGFyYnJhY2tldHJpZ2h0ID0gMHgzMDExOwogIHQuYmxhY2tsZW50aWN1bGFyYnJhY2tldHJpZ2h0dmVydGljYWwgPSAweGZlM2M7CiAgdC5ibGFja2xvd2VybGVmdHRyaWFuZ2xlID0gMHgyNWUzOwogIHQuYmxhY2tsb3dlcnJpZ2h0dHJpYW5nbGUgPSAweDI1ZTI7CiAgdC5ibGFja3JlY3RhbmdsZSA9IDB4MjVhYzsKICB0LmJsYWNrcmlnaHRwb2ludGluZ3BvaW50ZXIgPSAweDI1YmE7CiAgdC5ibGFja3JpZ2h0cG9pbnRpbmd0cmlhbmdsZSA9IDB4MjViNjsKICB0LmJsYWNrc21hbGxzcXVhcmUgPSAweDI1YWE7CiAgdC5ibGFja3NtaWxpbmdmYWNlID0gMHgyNjNiOwogIHQuYmxhY2tzcXVhcmUgPSAweDI1YTA7CiAgdC5ibGFja3N0YXIgPSAweDI2MDU7CiAgdC5ibGFja3VwcGVybGVmdHRyaWFuZ2xlID0gMHgyNWU0OwogIHQuYmxhY2t1cHBlcnJpZ2h0dHJpYW5nbGUgPSAweDI1ZTU7CiAgdC5ibGFja3VwcG9pbnRpbmdzbWFsbHRyaWFuZ2xlID0gMHgyNWI0OwogIHQuYmxhY2t1cHBvaW50aW5ndHJpYW5nbGUgPSAweDI1YjI7CiAgdC5ibGFuayA9IDB4MjQyMzsKICB0LmJsaW5lYmVsb3cgPSAweDFlMDc7CiAgdC5ibG9jayA9IDB4MjU4ODsKICB0LmJtb25vc3BhY2UgPSAweGZmNDI7CiAgdC5ib2JhaW1haXRoYWkgPSAweDBlMWE7CiAgdC5ib2hpcmFnYW5hID0gMHgzMDdjOwogIHQuYm9rYXRha2FuYSA9IDB4MzBkYzsKICB0LmJwYXJlbiA9IDB4MjQ5ZDsKICB0LmJxc3F1YXJlID0gMHgzM2MzOwogIHQuYnJhY2VleCA9IDB4ZjhmNDsKICB0LmJyYWNlbGVmdCA9IDB4MDA3YjsKICB0LmJyYWNlbGVmdGJ0ID0gMHhmOGYzOwogIHQuYnJhY2VsZWZ0bWlkID0gMHhmOGYyOwogIHQuYnJhY2VsZWZ0bW9ub3NwYWNlID0gMHhmZjViOwogIHQuYnJhY2VsZWZ0c21hbGwgPSAweGZlNWI7CiAgdC5icmFjZWxlZnR0cCA9IDB4ZjhmMTsKICB0LmJyYWNlbGVmdHZlcnRpY2FsID0gMHhmZTM3OwogIHQuYnJhY2VyaWdodCA9IDB4MDA3ZDsKICB0LmJyYWNlcmlnaHRidCA9IDB4ZjhmZTsKICB0LmJyYWNlcmlnaHRtaWQgPSAweGY4ZmQ7CiAgdC5icmFjZXJpZ2h0bW9ub3NwYWNlID0gMHhmZjVkOwogIHQuYnJhY2VyaWdodHNtYWxsID0gMHhmZTVjOwogIHQuYnJhY2VyaWdodHRwID0gMHhmOGZjOwogIHQuYnJhY2VyaWdodHZlcnRpY2FsID0gMHhmZTM4OwogIHQuYnJhY2tldGxlZnQgPSAweDAwNWI7CiAgdC5icmFja2V0bGVmdGJ0ID0gMHhmOGYwOwogIHQuYnJhY2tldGxlZnRleCA9IDB4ZjhlZjsKICB0LmJyYWNrZXRsZWZ0bW9ub3NwYWNlID0gMHhmZjNiOwogIHQuYnJhY2tldGxlZnR0cCA9IDB4ZjhlZTsKICB0LmJyYWNrZXRyaWdodCA9IDB4MDA1ZDsKICB0LmJyYWNrZXRyaWdodGJ0ID0gMHhmOGZiOwogIHQuYnJhY2tldHJpZ2h0ZXggPSAweGY4ZmE7CiAgdC5icmFja2V0cmlnaHRtb25vc3BhY2UgPSAweGZmM2Q7CiAgdC5icmFja2V0cmlnaHR0cCA9IDB4ZjhmOTsKICB0LmJyZXZlID0gMHgwMmQ4OwogIHQuYnJldmViZWxvd2NtYiA9IDB4MDMyZTsKICB0LmJyZXZlY21iID0gMHgwMzA2OwogIHQuYnJldmVpbnZlcnRlZGJlbG93Y21iID0gMHgwMzJmOwogIHQuYnJldmVpbnZlcnRlZGNtYiA9IDB4MDMxMTsKICB0LmJyZXZlaW52ZXJ0ZWRkb3VibGVjbWIgPSAweDAzNjE7CiAgdC5icmlkZ2ViZWxvd2NtYiA9IDB4MDMyYTsKICB0LmJyaWRnZWludmVydGVkYmVsb3djbWIgPSAweDAzM2E7CiAgdC5icm9rZW5iYXIgPSAweDAwYTY7CiAgdC5ic3Ryb2tlID0gMHgwMTgwOwogIHQuYnN1cGVyaW9yID0gMHhmNmVhOwogIHQuYnRvcGJhciA9IDB4MDE4MzsKICB0LmJ1aGlyYWdhbmEgPSAweDMwNzY7CiAgdC5idWthdGFrYW5hID0gMHgzMGQ2OwogIHQuYnVsbGV0ID0gMHgyMDIyOwogIHQuYnVsbGV0aW52ZXJzZSA9IDB4MjVkODsKICB0LmJ1bGxldG9wZXJhdG9yID0gMHgyMjE5OwogIHQuYnVsbHNleWUgPSAweDI1Y2U7CiAgdC5jID0gMHgwMDYzOwogIHQuY2Fhcm1lbmlhbiA9IDB4MDU2ZTsKICB0LmNhYmVuZ2FsaSA9IDB4MDk5YTsKICB0LmNhY3V0ZSA9IDB4MDEwNzsKICB0LmNhZGV2YSA9IDB4MDkxYTsKICB0LmNhZ3VqYXJhdGkgPSAweDBhOWE7CiAgdC5jYWd1cm11a2hpID0gMHgwYTFhOwogIHQuY2Fsc3F1YXJlID0gMHgzMzg4OwogIHQuY2FuZHJhYmluZHViZW5nYWxpID0gMHgwOTgxOwogIHQuY2FuZHJhYmluZHVjbWIgPSAweDAzMTA7CiAgdC5jYW5kcmFiaW5kdWRldmEgPSAweDA5MDE7CiAgdC5jYW5kcmFiaW5kdWd1amFyYXRpID0gMHgwYTgxOwogIHQuY2Fwc2xvY2sgPSAweDIxZWE7CiAgdC5jYXJlb2YgPSAweDIxMDU7CiAgdC5jYXJvbiA9IDB4MDJjNzsKICB0LmNhcm9uYmVsb3djbWIgPSAweDAzMmM7CiAgdC5jYXJvbmNtYiA9IDB4MDMwYzsKICB0LmNhcnJpYWdlcmV0dXJuID0gMHgyMWI1OwogIHQuY2JvcG9tb2ZvID0gMHgzMTE4OwogIHQuY2Nhcm9uID0gMHgwMTBkOwogIHQuY2NlZGlsbGEgPSAweDAwZTc7CiAgdC5jY2VkaWxsYWFjdXRlID0gMHgxZTA5OwogIHQuY2NpcmNsZSA9IDB4MjRkMjsKICB0LmNjaXJjdW1mbGV4ID0gMHgwMTA5OwogIHQuY2N1cmwgPSAweDAyNTU7CiAgdC5jZG90ID0gMHgwMTBiOwogIHQuY2RvdGFjY2VudCA9IDB4MDEwYjsKICB0LmNkc3F1YXJlID0gMHgzM2M1OwogIHQuY2VkaWxsYSA9IDB4MDBiODsKICB0LmNlZGlsbGFjbWIgPSAweDAzMjc7CiAgdC5jZW50ID0gMHgwMGEyOwogIHQuY2VudGlncmFkZSA9IDB4MjEwMzsKICB0LmNlbnRpbmZlcmlvciA9IDB4ZjZkZjsKICB0LmNlbnRtb25vc3BhY2UgPSAweGZmZTA7CiAgdC5jZW50b2xkc3R5bGUgPSAweGY3YTI7CiAgdC5jZW50c3VwZXJpb3IgPSAweGY2ZTA7CiAgdC5jaGFhcm1lbmlhbiA9IDB4MDU3OTsKICB0LmNoYWJlbmdhbGkgPSAweDA5OWI7CiAgdC5jaGFkZXZhID0gMHgwOTFiOwogIHQuY2hhZ3VqYXJhdGkgPSAweDBhOWI7CiAgdC5jaGFndXJtdWtoaSA9IDB4MGExYjsKICB0LmNoYm9wb21vZm8gPSAweDMxMTQ7CiAgdC5jaGVhYmtoYXNpYW5jeXJpbGxpYyA9IDB4MDRiZDsKICB0LmNoZWNrbWFyayA9IDB4MjcxMzsKICB0LmNoZWN5cmlsbGljID0gMHgwNDQ3OwogIHQuY2hlZGVzY2VuZGVyYWJraGFzaWFuY3lyaWxsaWMgPSAweDA0YmY7CiAgdC5jaGVkZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDRiNzsKICB0LmNoZWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZjU7CiAgdC5jaGVoYXJtZW5pYW4gPSAweDA1NzM7CiAgdC5jaGVraGFrYXNzaWFuY3lyaWxsaWMgPSAweDA0Y2M7CiAgdC5jaGV2ZXJ0aWNhbHN0cm9rZWN5cmlsbGljID0gMHgwNGI5OwogIHQuY2hpID0gMHgwM2M3OwogIHQuY2hpZXVjaGFjaXJjbGVrb3JlYW4gPSAweDMyNzc7CiAgdC5jaGlldWNoYXBhcmVua29yZWFuID0gMHgzMjE3OwogIHQuY2hpZXVjaGNpcmNsZWtvcmVhbiA9IDB4MzI2OTsKICB0LmNoaWV1Y2hrb3JlYW4gPSAweDMxNGE7CiAgdC5jaGlldWNocGFyZW5rb3JlYW4gPSAweDMyMDk7CiAgdC5jaG9jaGFuZ3RoYWkgPSAweDBlMGE7CiAgdC5jaG9jaGFudGhhaSA9IDB4MGUwODsKICB0LmNob2NoaW5ndGhhaSA9IDB4MGUwOTsKICB0LmNob2Nob2V0aGFpID0gMHgwZTBjOwogIHQuY2hvb2sgPSAweDAxODg7CiAgdC5jaWV1Y2FjaXJjbGVrb3JlYW4gPSAweDMyNzY7CiAgdC5jaWV1Y2FwYXJlbmtvcmVhbiA9IDB4MzIxNjsKICB0LmNpZXVjY2lyY2xla29yZWFuID0gMHgzMjY4OwogIHQuY2lldWNrb3JlYW4gPSAweDMxNDg7CiAgdC5jaWV1Y3BhcmVua29yZWFuID0gMHgzMjA4OwogIHQuY2lldWN1cGFyZW5rb3JlYW4gPSAweDMyMWM7CiAgdC5jaXJjbGUgPSAweDI1Y2I7CiAgdC5jaXJjbGVjb3B5cnQgPSAweDAwYTk7CiAgdC5jaXJjbGVtdWx0aXBseSA9IDB4MjI5NzsKICB0LmNpcmNsZW90ID0gMHgyMjk5OwogIHQuY2lyY2xlcGx1cyA9IDB4MjI5NTsKICB0LmNpcmNsZXBvc3RhbG1hcmsgPSAweDMwMzY7CiAgdC5jaXJjbGV3aXRobGVmdGhhbGZibGFjayA9IDB4MjVkMDsKICB0LmNpcmNsZXdpdGhyaWdodGhhbGZibGFjayA9IDB4MjVkMTsKICB0LmNpcmN1bWZsZXggPSAweDAyYzY7CiAgdC5jaXJjdW1mbGV4YmVsb3djbWIgPSAweDAzMmQ7CiAgdC5jaXJjdW1mbGV4Y21iID0gMHgwMzAyOwogIHQuY2xlYXIgPSAweDIzMjc7CiAgdC5jbGlja2FsdmVvbGFyID0gMHgwMWMyOwogIHQuY2xpY2tkZW50YWwgPSAweDAxYzA7CiAgdC5jbGlja2xhdGVyYWwgPSAweDAxYzE7CiAgdC5jbGlja3JldHJvZmxleCA9IDB4MDFjMzsKICB0LmNsdWIgPSAweDI2NjM7CiAgdC5jbHVic3VpdGJsYWNrID0gMHgyNjYzOwogIHQuY2x1YnN1aXR3aGl0ZSA9IDB4MjY2NzsKICB0LmNtY3ViZWRzcXVhcmUgPSAweDMzYTQ7CiAgdC5jbW9ub3NwYWNlID0gMHhmZjQzOwogIHQuY21zcXVhcmVkc3F1YXJlID0gMHgzM2EwOwogIHQuY29hcm1lbmlhbiA9IDB4MDU4MTsKICB0LmNvbG9uID0gMHgwMDNhOwogIHQuY29sb25tb25ldGFyeSA9IDB4MjBhMTsKICB0LmNvbG9ubW9ub3NwYWNlID0gMHhmZjFhOwogIHQuY29sb25zaWduID0gMHgyMGExOwogIHQuY29sb25zbWFsbCA9IDB4ZmU1NTsKICB0LmNvbG9udHJpYW5ndWxhcmhhbGZtb2QgPSAweDAyZDE7CiAgdC5jb2xvbnRyaWFuZ3VsYXJtb2QgPSAweDAyZDA7CiAgdC5jb21tYSA9IDB4MDAyYzsKICB0LmNvbW1hYWJvdmVjbWIgPSAweDAzMTM7CiAgdC5jb21tYWFib3ZlcmlnaHRjbWIgPSAweDAzMTU7CiAgdC5jb21tYWFjY2VudCA9IDB4ZjZjMzsKICB0LmNvbW1hYXJhYmljID0gMHgwNjBjOwogIHQuY29tbWFhcm1lbmlhbiA9IDB4MDU1ZDsKICB0LmNvbW1haW5mZXJpb3IgPSAweGY2ZTE7CiAgdC5jb21tYW1vbm9zcGFjZSA9IDB4ZmYwYzsKICB0LmNvbW1hcmV2ZXJzZWRhYm92ZWNtYiA9IDB4MDMxNDsKICB0LmNvbW1hcmV2ZXJzZWRtb2QgPSAweDAyYmQ7CiAgdC5jb21tYXNtYWxsID0gMHhmZTUwOwogIHQuY29tbWFzdXBlcmlvciA9IDB4ZjZlMjsKICB0LmNvbW1hdHVybmVkYWJvdmVjbWIgPSAweDAzMTI7CiAgdC5jb21tYXR1cm5lZG1vZCA9IDB4MDJiYjsKICB0LmNvbXBhc3MgPSAweDI2M2M7CiAgdC5jb25ncnVlbnQgPSAweDIyNDU7CiAgdC5jb250b3VyaW50ZWdyYWwgPSAweDIyMmU7CiAgdC5jb250cm9sID0gMHgyMzAzOwogIHQuY29udHJvbEFDSyA9IDB4MDAwNjsKICB0LmNvbnRyb2xCRUwgPSAweDAwMDc7CiAgdC5jb250cm9sQlMgPSAweDAwMDg7CiAgdC5jb250cm9sQ0FOID0gMHgwMDE4OwogIHQuY29udHJvbENSID0gMHgwMDBkOwogIHQuY29udHJvbERDMSA9IDB4MDAxMTsKICB0LmNvbnRyb2xEQzIgPSAweDAwMTI7CiAgdC5jb250cm9sREMzID0gMHgwMDEzOwogIHQuY29udHJvbERDNCA9IDB4MDAxNDsKICB0LmNvbnRyb2xERUwgPSAweDAwN2Y7CiAgdC5jb250cm9sRExFID0gMHgwMDEwOwogIHQuY29udHJvbEVNID0gMHgwMDE5OwogIHQuY29udHJvbEVOUSA9IDB4MDAwNTsKICB0LmNvbnRyb2xFT1QgPSAweDAwMDQ7CiAgdC5jb250cm9sRVNDID0gMHgwMDFiOwogIHQuY29udHJvbEVUQiA9IDB4MDAxNzsKICB0LmNvbnRyb2xFVFggPSAweDAwMDM7CiAgdC5jb250cm9sRkYgPSAweDAwMGM7CiAgdC5jb250cm9sRlMgPSAweDAwMWM7CiAgdC5jb250cm9sR1MgPSAweDAwMWQ7CiAgdC5jb250cm9sSFQgPSAweDAwMDk7CiAgdC5jb250cm9sTEYgPSAweDAwMGE7CiAgdC5jb250cm9sTkFLID0gMHgwMDE1OwogIHQuY29udHJvbE5VTEwgPSAweDAwMDA7CiAgdC5jb250cm9sUlMgPSAweDAwMWU7CiAgdC5jb250cm9sU0kgPSAweDAwMGY7CiAgdC5jb250cm9sU08gPSAweDAwMGU7CiAgdC5jb250cm9sU09UID0gMHgwMDAyOwogIHQuY29udHJvbFNUWCA9IDB4MDAwMTsKICB0LmNvbnRyb2xTVUIgPSAweDAwMWE7CiAgdC5jb250cm9sU1lOID0gMHgwMDE2OwogIHQuY29udHJvbFVTID0gMHgwMDFmOwogIHQuY29udHJvbFZUID0gMHgwMDBiOwogIHQuY29weXJpZ2h0ID0gMHgwMGE5OwogIHQuY29weXJpZ2h0c2FucyA9IDB4ZjhlOTsKICB0LmNvcHlyaWdodHNlcmlmID0gMHhmNmQ5OwogIHQuY29ybmVyYnJhY2tldGxlZnQgPSAweDMwMGM7CiAgdC5jb3JuZXJicmFja2V0bGVmdGhhbGZ3aWR0aCA9IDB4ZmY2MjsKICB0LmNvcm5lcmJyYWNrZXRsZWZ0dmVydGljYWwgPSAweGZlNDE7CiAgdC5jb3JuZXJicmFja2V0cmlnaHQgPSAweDMwMGQ7CiAgdC5jb3JuZXJicmFja2V0cmlnaHRoYWxmd2lkdGggPSAweGZmNjM7CiAgdC5jb3JuZXJicmFja2V0cmlnaHR2ZXJ0aWNhbCA9IDB4ZmU0MjsKICB0LmNvcnBvcmF0aW9uc3F1YXJlID0gMHgzMzdmOwogIHQuY29zcXVhcmUgPSAweDMzYzc7CiAgdC5jb3Zlcmtnc3F1YXJlID0gMHgzM2M2OwogIHQuY3BhcmVuID0gMHgyNDllOwogIHQuY3J1emVpcm8gPSAweDIwYTI7CiAgdC5jc3RyZXRjaGVkID0gMHgwMjk3OwogIHQuY3VybHlhbmQgPSAweDIyY2Y7CiAgdC5jdXJseW9yID0gMHgyMmNlOwogIHQuY3VycmVuY3kgPSAweDAwYTQ7CiAgdC5jeXJCcmV2ZSA9IDB4ZjZkMTsKICB0LmN5ckZsZXggPSAweGY2ZDI7CiAgdC5jeXJicmV2ZSA9IDB4ZjZkNDsKICB0LmN5cmZsZXggPSAweGY2ZDU7CiAgdC5kID0gMHgwMDY0OwogIHQuZGFhcm1lbmlhbiA9IDB4MDU2NDsKICB0LmRhYmVuZ2FsaSA9IDB4MDlhNjsKICB0LmRhZGFyYWJpYyA9IDB4MDYzNjsKICB0LmRhZGV2YSA9IDB4MDkyNjsKICB0LmRhZGZpbmFsYXJhYmljID0gMHhmZWJlOwogIHQuZGFkaW5pdGlhbGFyYWJpYyA9IDB4ZmViZjsKICB0LmRhZG1lZGlhbGFyYWJpYyA9IDB4ZmVjMDsKICB0LmRhZ2VzaCA9IDB4MDViYzsKICB0LmRhZ2VzaGhlYnJldyA9IDB4MDViYzsKICB0LmRhZ2dlciA9IDB4MjAyMDsKICB0LmRhZ2dlcmRibCA9IDB4MjAyMTsKICB0LmRhZ3VqYXJhdGkgPSAweDBhYTY7CiAgdC5kYWd1cm11a2hpID0gMHgwYTI2OwogIHQuZGFoaXJhZ2FuYSA9IDB4MzA2MDsKICB0LmRha2F0YWthbmEgPSAweDMwYzA7CiAgdC5kYWxhcmFiaWMgPSAweDA2MmY7CiAgdC5kYWxldCA9IDB4MDVkMzsKICB0LmRhbGV0ZGFnZXNoID0gMHhmYjMzOwogIHQuZGFsZXRkYWdlc2hoZWJyZXcgPSAweGZiMzM7CiAgdC5kYWxldGhlYnJldyA9IDB4MDVkMzsKICB0LmRhbGZpbmFsYXJhYmljID0gMHhmZWFhOwogIHQuZGFtbWFhcmFiaWMgPSAweDA2NGY7CiAgdC5kYW1tYWxvd2FyYWJpYyA9IDB4MDY0ZjsKICB0LmRhbW1hdGFuYWx0b25lYXJhYmljID0gMHgwNjRjOwogIHQuZGFtbWF0YW5hcmFiaWMgPSAweDA2NGM7CiAgdC5kYW5kYSA9IDB4MDk2NDsKICB0LmRhcmdhaGVicmV3ID0gMHgwNWE3OwogIHQuZGFyZ2FsZWZ0aGVicmV3ID0gMHgwNWE3OwogIHQuZGFzaWFwbmV1bWF0YWN5cmlsbGljY21iID0gMHgwNDg1OwogIHQuZGJsR3JhdmUgPSAweGY2ZDM7CiAgdC5kYmxhbmdsZWJyYWNrZXRsZWZ0ID0gMHgzMDBhOwogIHQuZGJsYW5nbGVicmFja2V0bGVmdHZlcnRpY2FsID0gMHhmZTNkOwogIHQuZGJsYW5nbGVicmFja2V0cmlnaHQgPSAweDMwMGI7CiAgdC5kYmxhbmdsZWJyYWNrZXRyaWdodHZlcnRpY2FsID0gMHhmZTNlOwogIHQuZGJsYXJjaGludmVydGVkYmVsb3djbWIgPSAweDAzMmI7CiAgdC5kYmxhcnJvd2xlZnQgPSAweDIxZDQ7CiAgdC5kYmxhcnJvd3JpZ2h0ID0gMHgyMWQyOwogIHQuZGJsZGFuZGEgPSAweDA5NjU7CiAgdC5kYmxncmF2ZSA9IDB4ZjZkNjsKICB0LmRibGdyYXZlY21iID0gMHgwMzBmOwogIHQuZGJsaW50ZWdyYWwgPSAweDIyMmM7CiAgdC5kYmxsb3dsaW5lID0gMHgyMDE3OwogIHQuZGJsbG93bGluZWNtYiA9IDB4MDMzMzsKICB0LmRibG92ZXJsaW5lY21iID0gMHgwMzNmOwogIHQuZGJscHJpbWVtb2QgPSAweDAyYmE7CiAgdC5kYmx2ZXJ0aWNhbGJhciA9IDB4MjAxNjsKICB0LmRibHZlcnRpY2FsbGluZWFib3ZlY21iID0gMHgwMzBlOwogIHQuZGJvcG9tb2ZvID0gMHgzMTA5OwogIHQuZGJzcXVhcmUgPSAweDMzYzg7CiAgdC5kY2Fyb24gPSAweDAxMGY7CiAgdC5kY2VkaWxsYSA9IDB4MWUxMTsKICB0LmRjaXJjbGUgPSAweDI0ZDM7CiAgdC5kY2lyY3VtZmxleGJlbG93ID0gMHgxZTEzOwogIHQuZGNyb2F0ID0gMHgwMTExOwogIHQuZGRhYmVuZ2FsaSA9IDB4MDlhMTsKICB0LmRkYWRldmEgPSAweDA5MjE7CiAgdC5kZGFndWphcmF0aSA9IDB4MGFhMTsKICB0LmRkYWd1cm11a2hpID0gMHgwYTIxOwogIHQuZGRhbGFyYWJpYyA9IDB4MDY4ODsKICB0LmRkYWxmaW5hbGFyYWJpYyA9IDB4ZmI4OTsKICB0LmRkZGhhZGV2YSA9IDB4MDk1YzsKICB0LmRkaGFiZW5nYWxpID0gMHgwOWEyOwogIHQuZGRoYWRldmEgPSAweDA5MjI7CiAgdC5kZGhhZ3VqYXJhdGkgPSAweDBhYTI7CiAgdC5kZGhhZ3VybXVraGkgPSAweDBhMjI7CiAgdC5kZG90YWNjZW50ID0gMHgxZTBiOwogIHQuZGRvdGJlbG93ID0gMHgxZTBkOwogIHQuZGVjaW1hbHNlcGFyYXRvcmFyYWJpYyA9IDB4MDY2YjsKICB0LmRlY2ltYWxzZXBhcmF0b3JwZXJzaWFuID0gMHgwNjZiOwogIHQuZGVjeXJpbGxpYyA9IDB4MDQzNDsKICB0LmRlZ3JlZSA9IDB4MDBiMDsKICB0LmRlaGloZWJyZXcgPSAweDA1YWQ7CiAgdC5kZWhpcmFnYW5hID0gMHgzMDY3OwogIHQuZGVpY29wdGljID0gMHgwM2VmOwogIHQuZGVrYXRha2FuYSA9IDB4MzBjNzsKICB0LmRlbGV0ZWxlZnQgPSAweDIzMmI7CiAgdC5kZWxldGVyaWdodCA9IDB4MjMyNjsKICB0LmRlbHRhID0gMHgwM2I0OwogIHQuZGVsdGF0dXJuZWQgPSAweDAxOGQ7CiAgdC5kZW5vbWluYXRvcm1pbnVzb25lbnVtZXJhdG9yYmVuZ2FsaSA9IDB4MDlmODsKICB0LmRlemggPSAweDAyYTQ7CiAgdC5kaGFiZW5nYWxpID0gMHgwOWE3OwogIHQuZGhhZGV2YSA9IDB4MDkyNzsKICB0LmRoYWd1amFyYXRpID0gMHgwYWE3OwogIHQuZGhhZ3VybXVraGkgPSAweDBhMjc7CiAgdC5kaG9vayA9IDB4MDI1NzsKICB0LmRpYWx5dGlrYXRvbm9zID0gMHgwMzg1OwogIHQuZGlhbHl0aWthdG9ub3NjbWIgPSAweDAzNDQ7CiAgdC5kaWFtb25kID0gMHgyNjY2OwogIHQuZGlhbW9uZHN1aXR3aGl0ZSA9IDB4MjY2MjsKICB0LmRpZXJlc2lzID0gMHgwMGE4OwogIHQuZGllcmVzaXNhY3V0ZSA9IDB4ZjZkNzsKICB0LmRpZXJlc2lzYmVsb3djbWIgPSAweDAzMjQ7CiAgdC5kaWVyZXNpc2NtYiA9IDB4MDMwODsKICB0LmRpZXJlc2lzZ3JhdmUgPSAweGY2ZDg7CiAgdC5kaWVyZXNpc3Rvbm9zID0gMHgwMzg1OwogIHQuZGloaXJhZ2FuYSA9IDB4MzA2MjsKICB0LmRpa2F0YWthbmEgPSAweDMwYzI7CiAgdC5kaXR0b21hcmsgPSAweDMwMDM7CiAgdC5kaXZpZGUgPSAweDAwZjc7CiAgdC5kaXZpZGVzID0gMHgyMjIzOwogIHQuZGl2aXNpb25zbGFzaCA9IDB4MjIxNTsKICB0LmRqZWN5cmlsbGljID0gMHgwNDUyOwogIHQuZGtzaGFkZSA9IDB4MjU5MzsKICB0LmRsaW5lYmVsb3cgPSAweDFlMGY7CiAgdC5kbHNxdWFyZSA9IDB4MzM5NzsKICB0LmRtYWNyb24gPSAweDAxMTE7CiAgdC5kbW9ub3NwYWNlID0gMHhmZjQ0OwogIHQuZG5ibG9jayA9IDB4MjU4NDsKICB0LmRvY2hhZGF0aGFpID0gMHgwZTBlOwogIHQuZG9kZWt0aGFpID0gMHgwZTE0OwogIHQuZG9oaXJhZ2FuYSA9IDB4MzA2OTsKICB0LmRva2F0YWthbmEgPSAweDMwYzk7CiAgdC5kb2xsYXIgPSAweDAwMjQ7CiAgdC5kb2xsYXJpbmZlcmlvciA9IDB4ZjZlMzsKICB0LmRvbGxhcm1vbm9zcGFjZSA9IDB4ZmYwNDsKICB0LmRvbGxhcm9sZHN0eWxlID0gMHhmNzI0OwogIHQuZG9sbGFyc21hbGwgPSAweGZlNjk7CiAgdC5kb2xsYXJzdXBlcmlvciA9IDB4ZjZlNDsKICB0LmRvbmcgPSAweDIwYWI7CiAgdC5kb3J1c3F1YXJlID0gMHgzMzI2OwogIHQuZG90YWNjZW50ID0gMHgwMmQ5OwogIHQuZG90YWNjZW50Y21iID0gMHgwMzA3OwogIHQuZG90YmVsb3djbWIgPSAweDAzMjM7CiAgdC5kb3RiZWxvd2NvbWIgPSAweDAzMjM7CiAgdC5kb3RrYXRha2FuYSA9IDB4MzBmYjsKICB0LmRvdGxlc3NpID0gMHgwMTMxOwogIHQuZG90bGVzc2ogPSAweGY2YmU7CiAgdC5kb3RsZXNzanN0cm9rZWhvb2sgPSAweDAyODQ7CiAgdC5kb3RtYXRoID0gMHgyMmM1OwogIHQuZG90dGVkY2lyY2xlID0gMHgyNWNjOwogIHQuZG91YmxleW9kcGF0YWggPSAweGZiMWY7CiAgdC5kb3VibGV5b2RwYXRhaGhlYnJldyA9IDB4ZmIxZjsKICB0LmRvd250YWNrYmVsb3djbWIgPSAweDAzMWU7CiAgdC5kb3dudGFja21vZCA9IDB4MDJkNTsKICB0LmRwYXJlbiA9IDB4MjQ5ZjsKICB0LmRzdXBlcmlvciA9IDB4ZjZlYjsKICB0LmR0YWlsID0gMHgwMjU2OwogIHQuZHRvcGJhciA9IDB4MDE4YzsKICB0LmR1aGlyYWdhbmEgPSAweDMwNjU7CiAgdC5kdWthdGFrYW5hID0gMHgzMGM1OwogIHQuZHogPSAweDAxZjM7CiAgdC5kemFsdG9uZSA9IDB4MDJhMzsKICB0LmR6Y2Fyb24gPSAweDAxYzY7CiAgdC5kemN1cmwgPSAweDAyYTU7CiAgdC5kemVhYmtoYXNpYW5jeXJpbGxpYyA9IDB4MDRlMTsKICB0LmR6ZWN5cmlsbGljID0gMHgwNDU1OwogIHQuZHpoZWN5cmlsbGljID0gMHgwNDVmOwogIHQuZSA9IDB4MDA2NTsKICB0LmVhY3V0ZSA9IDB4MDBlOTsKICB0LmVhcnRoID0gMHgyNjQxOwogIHQuZWJlbmdhbGkgPSAweDA5OGY7CiAgdC5lYm9wb21vZm8gPSAweDMxMWM7CiAgdC5lYnJldmUgPSAweDAxMTU7CiAgdC5lY2FuZHJhZGV2YSA9IDB4MDkwZDsKICB0LmVjYW5kcmFndWphcmF0aSA9IDB4MGE4ZDsKICB0LmVjYW5kcmF2b3dlbHNpZ25kZXZhID0gMHgwOTQ1OwogIHQuZWNhbmRyYXZvd2Vsc2lnbmd1amFyYXRpID0gMHgwYWM1OwogIHQuZWNhcm9uID0gMHgwMTFiOwogIHQuZWNlZGlsbGFicmV2ZSA9IDB4MWUxZDsKICB0LmVjaGFybWVuaWFuID0gMHgwNTY1OwogIHQuZWNoeWl3bmFybWVuaWFuID0gMHgwNTg3OwogIHQuZWNpcmNsZSA9IDB4MjRkNDsKICB0LmVjaXJjdW1mbGV4ID0gMHgwMGVhOwogIHQuZWNpcmN1bWZsZXhhY3V0ZSA9IDB4MWViZjsKICB0LmVjaXJjdW1mbGV4YmVsb3cgPSAweDFlMTk7CiAgdC5lY2lyY3VtZmxleGRvdGJlbG93ID0gMHgxZWM3OwogIHQuZWNpcmN1bWZsZXhncmF2ZSA9IDB4MWVjMTsKICB0LmVjaXJjdW1mbGV4aG9va2Fib3ZlID0gMHgxZWMzOwogIHQuZWNpcmN1bWZsZXh0aWxkZSA9IDB4MWVjNTsKICB0LmVjeXJpbGxpYyA9IDB4MDQ1NDsKICB0LmVkYmxncmF2ZSA9IDB4MDIwNTsKICB0LmVkZXZhID0gMHgwOTBmOwogIHQuZWRpZXJlc2lzID0gMHgwMGViOwogIHQuZWRvdCA9IDB4MDExNzsKICB0LmVkb3RhY2NlbnQgPSAweDAxMTc7CiAgdC5lZG90YmVsb3cgPSAweDFlYjk7CiAgdC5lZWd1cm11a2hpID0gMHgwYTBmOwogIHQuZWVtYXRyYWd1cm11a2hpID0gMHgwYTQ3OwogIHQuZWZjeXJpbGxpYyA9IDB4MDQ0NDsKICB0LmVncmF2ZSA9IDB4MDBlODsKICB0LmVndWphcmF0aSA9IDB4MGE4ZjsKICB0LmVoYXJtZW5pYW4gPSAweDA1Njc7CiAgdC5laGJvcG9tb2ZvID0gMHgzMTFkOwogIHQuZWhpcmFnYW5hID0gMHgzMDQ4OwogIHQuZWhvb2thYm92ZSA9IDB4MWViYjsKICB0LmVpYm9wb21vZm8gPSAweDMxMWY7CiAgdC5laWdodCA9IDB4MDAzODsKICB0LmVpZ2h0YXJhYmljID0gMHgwNjY4OwogIHQuZWlnaHRiZW5nYWxpID0gMHgwOWVlOwogIHQuZWlnaHRjaXJjbGUgPSAweDI0Njc7CiAgdC5laWdodGNpcmNsZWludmVyc2VzYW5zc2VyaWYgPSAweDI3OTE7CiAgdC5laWdodGRldmEgPSAweDA5NmU7CiAgdC5laWdodGVlbmNpcmNsZSA9IDB4MjQ3MTsKICB0LmVpZ2h0ZWVucGFyZW4gPSAweDI0ODU7CiAgdC5laWdodGVlbnBlcmlvZCA9IDB4MjQ5OTsKICB0LmVpZ2h0Z3VqYXJhdGkgPSAweDBhZWU7CiAgdC5laWdodGd1cm11a2hpID0gMHgwYTZlOwogIHQuZWlnaHRoYWNrYXJhYmljID0gMHgwNjY4OwogIHQuZWlnaHRoYW5nemhvdSA9IDB4MzAyODsKICB0LmVpZ2h0aG5vdGViZWFtZWQgPSAweDI2NmI7CiAgdC5laWdodGlkZW9ncmFwaGljcGFyZW4gPSAweDMyMjc7CiAgdC5laWdodGluZmVyaW9yID0gMHgyMDg4OwogIHQuZWlnaHRtb25vc3BhY2UgPSAweGZmMTg7CiAgdC5laWdodG9sZHN0eWxlID0gMHhmNzM4OwogIHQuZWlnaHRwYXJlbiA9IDB4MjQ3YjsKICB0LmVpZ2h0cGVyaW9kID0gMHgyNDhmOwogIHQuZWlnaHRwZXJzaWFuID0gMHgwNmY4OwogIHQuZWlnaHRyb21hbiA9IDB4MjE3NzsKICB0LmVpZ2h0c3VwZXJpb3IgPSAweDIwNzg7CiAgdC5laWdodHRoYWkgPSAweDBlNTg7CiAgdC5laW52ZXJ0ZWRicmV2ZSA9IDB4MDIwNzsKICB0LmVpb3RpZmllZGN5cmlsbGljID0gMHgwNDY1OwogIHQuZWthdGFrYW5hID0gMHgzMGE4OwogIHQuZWthdGFrYW5haGFsZndpZHRoID0gMHhmZjc0OwogIHQuZWtvbmthcmd1cm11a2hpID0gMHgwYTc0OwogIHQuZWtvcmVhbiA9IDB4MzE1NDsKICB0LmVsY3lyaWxsaWMgPSAweDA0M2I7CiAgdC5lbGVtZW50ID0gMHgyMjA4OwogIHQuZWxldmVuY2lyY2xlID0gMHgyNDZhOwogIHQuZWxldmVucGFyZW4gPSAweDI0N2U7CiAgdC5lbGV2ZW5wZXJpb2QgPSAweDI0OTI7CiAgdC5lbGV2ZW5yb21hbiA9IDB4MjE3YTsKICB0LmVsbGlwc2lzID0gMHgyMDI2OwogIHQuZWxsaXBzaXN2ZXJ0aWNhbCA9IDB4MjJlZTsKICB0LmVtYWNyb24gPSAweDAxMTM7CiAgdC5lbWFjcm9uYWN1dGUgPSAweDFlMTc7CiAgdC5lbWFjcm9uZ3JhdmUgPSAweDFlMTU7CiAgdC5lbWN5cmlsbGljID0gMHgwNDNjOwogIHQuZW1kYXNoID0gMHgyMDE0OwogIHQuZW1kYXNodmVydGljYWwgPSAweGZlMzE7CiAgdC5lbW9ub3NwYWNlID0gMHhmZjQ1OwogIHQuZW1waGFzaXNtYXJrYXJtZW5pYW4gPSAweDA1NWI7CiAgdC5lbXB0eXNldCA9IDB4MjIwNTsKICB0LmVuYm9wb21vZm8gPSAweDMxMjM7CiAgdC5lbmN5cmlsbGljID0gMHgwNDNkOwogIHQuZW5kYXNoID0gMHgyMDEzOwogIHQuZW5kYXNodmVydGljYWwgPSAweGZlMzI7CiAgdC5lbmRlc2NlbmRlcmN5cmlsbGljID0gMHgwNGEzOwogIHQuZW5nID0gMHgwMTRiOwogIHQuZW5nYm9wb21vZm8gPSAweDMxMjU7CiAgdC5lbmdoZWN5cmlsbGljID0gMHgwNGE1OwogIHQuZW5ob29rY3lyaWxsaWMgPSAweDA0Yzg7CiAgdC5lbnNwYWNlID0gMHgyMDAyOwogIHQuZW9nb25layA9IDB4MDExOTsKICB0LmVva29yZWFuID0gMHgzMTUzOwogIHQuZW9wZW4gPSAweDAyNWI7CiAgdC5lb3BlbmNsb3NlZCA9IDB4MDI5YTsKICB0LmVvcGVucmV2ZXJzZWQgPSAweDAyNWM7CiAgdC5lb3BlbnJldmVyc2VkY2xvc2VkID0gMHgwMjVlOwogIHQuZW9wZW5yZXZlcnNlZGhvb2sgPSAweDAyNWQ7CiAgdC5lcGFyZW4gPSAweDI0YTA7CiAgdC5lcHNpbG9uID0gMHgwM2I1OwogIHQuZXBzaWxvbnRvbm9zID0gMHgwM2FkOwogIHQuZXF1YWwgPSAweDAwM2Q7CiAgdC5lcXVhbG1vbm9zcGFjZSA9IDB4ZmYxZDsKICB0LmVxdWFsc21hbGwgPSAweGZlNjY7CiAgdC5lcXVhbHN1cGVyaW9yID0gMHgyMDdjOwogIHQuZXF1aXZhbGVuY2UgPSAweDIyNjE7CiAgdC5lcmJvcG9tb2ZvID0gMHgzMTI2OwogIHQuZXJjeXJpbGxpYyA9IDB4MDQ0MDsKICB0LmVyZXZlcnNlZCA9IDB4MDI1ODsKICB0LmVyZXZlcnNlZGN5cmlsbGljID0gMHgwNDRkOwogIHQuZXNjeXJpbGxpYyA9IDB4MDQ0MTsKICB0LmVzZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0YWI7CiAgdC5lc2ggPSAweDAyODM7CiAgdC5lc2hjdXJsID0gMHgwMjg2OwogIHQuZXNob3J0ZGV2YSA9IDB4MDkwZTsKICB0LmVzaG9ydHZvd2Vsc2lnbmRldmEgPSAweDA5NDY7CiAgdC5lc2hyZXZlcnNlZGxvb3AgPSAweDAxYWE7CiAgdC5lc2hzcXVhdHJldmVyc2VkID0gMHgwMjg1OwogIHQuZXNtYWxsaGlyYWdhbmEgPSAweDMwNDc7CiAgdC5lc21hbGxrYXRha2FuYSA9IDB4MzBhNzsKICB0LmVzbWFsbGthdGFrYW5haGFsZndpZHRoID0gMHhmZjZhOwogIHQuZXN0aW1hdGVkID0gMHgyMTJlOwogIHQuZXN1cGVyaW9yID0gMHhmNmVjOwogIHQuZXRhID0gMHgwM2I3OwogIHQuZXRhcm1lbmlhbiA9IDB4MDU2ODsKICB0LmV0YXRvbm9zID0gMHgwM2FlOwogIHQuZXRoID0gMHgwMGYwOwogIHQuZXRpbGRlID0gMHgxZWJkOwogIHQuZXRpbGRlYmVsb3cgPSAweDFlMWI7CiAgdC5ldG5haHRhZm91a2hoZWJyZXcgPSAweDA1OTE7CiAgdC5ldG5haHRhZm91a2hsZWZ0aGVicmV3ID0gMHgwNTkxOwogIHQuZXRuYWh0YWhlYnJldyA9IDB4MDU5MTsKICB0LmV0bmFodGFsZWZ0aGVicmV3ID0gMHgwNTkxOwogIHQuZXR1cm5lZCA9IDB4MDFkZDsKICB0LmV1a29yZWFuID0gMHgzMTYxOwogIHQuZXVybyA9IDB4MjBhYzsKICB0LmV2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWM3OwogIHQuZXZvd2Vsc2lnbmRldmEgPSAweDA5NDc7CiAgdC5ldm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhYzc7CiAgdC5leGNsYW0gPSAweDAwMjE7CiAgdC5leGNsYW1hcm1lbmlhbiA9IDB4MDU1YzsKICB0LmV4Y2xhbWRibCA9IDB4MjAzYzsKICB0LmV4Y2xhbWRvd24gPSAweDAwYTE7CiAgdC5leGNsYW1kb3duc21hbGwgPSAweGY3YTE7CiAgdC5leGNsYW1tb25vc3BhY2UgPSAweGZmMDE7CiAgdC5leGNsYW1zbWFsbCA9IDB4ZjcyMTsKICB0LmV4aXN0ZW50aWFsID0gMHgyMjAzOwogIHQuZXpoID0gMHgwMjkyOwogIHQuZXpoY2Fyb24gPSAweDAxZWY7CiAgdC5lemhjdXJsID0gMHgwMjkzOwogIHQuZXpocmV2ZXJzZWQgPSAweDAxYjk7CiAgdC5lemh0YWlsID0gMHgwMWJhOwogIHQuZiA9IDB4MDA2NjsKICB0LmZhZGV2YSA9IDB4MDk1ZTsKICB0LmZhZ3VybXVraGkgPSAweDBhNWU7CiAgdC5mYWhyZW5oZWl0ID0gMHgyMTA5OwogIHQuZmF0aGFhcmFiaWMgPSAweDA2NGU7CiAgdC5mYXRoYWxvd2FyYWJpYyA9IDB4MDY0ZTsKICB0LmZhdGhhdGFuYXJhYmljID0gMHgwNjRiOwogIHQuZmJvcG9tb2ZvID0gMHgzMTA4OwogIHQuZmNpcmNsZSA9IDB4MjRkNTsKICB0LmZkb3RhY2NlbnQgPSAweDFlMWY7CiAgdC5mZWhhcmFiaWMgPSAweDA2NDE7CiAgdC5mZWhhcm1lbmlhbiA9IDB4MDU4NjsKICB0LmZlaGZpbmFsYXJhYmljID0gMHhmZWQyOwogIHQuZmVoaW5pdGlhbGFyYWJpYyA9IDB4ZmVkMzsKICB0LmZlaG1lZGlhbGFyYWJpYyA9IDB4ZmVkNDsKICB0LmZlaWNvcHRpYyA9IDB4MDNlNTsKICB0LmZlbWFsZSA9IDB4MjY0MDsKICB0LmZmID0gMHhmYjAwOwogIHQuZl9mID0gMHhmYjAwOwogIHQuZmZpID0gMHhmYjAzOwogIHQuZl9mX2kgPSAweGZiMDM7CiAgdC5mZmwgPSAweGZiMDQ7CiAgdC5mX2ZfbCA9IDB4ZmIwNDsKICB0LmZpID0gMHhmYjAxOwogIHQuZl9pID0gMHhmYjAxOwogIHQuZmlmdGVlbmNpcmNsZSA9IDB4MjQ2ZTsKICB0LmZpZnRlZW5wYXJlbiA9IDB4MjQ4MjsKICB0LmZpZnRlZW5wZXJpb2QgPSAweDI0OTY7CiAgdC5maWd1cmVkYXNoID0gMHgyMDEyOwogIHQuZmlsbGVkYm94ID0gMHgyNWEwOwogIHQuZmlsbGVkcmVjdCA9IDB4MjVhYzsKICB0LmZpbmFsa2FmID0gMHgwNWRhOwogIHQuZmluYWxrYWZkYWdlc2ggPSAweGZiM2E7CiAgdC5maW5hbGthZmRhZ2VzaGhlYnJldyA9IDB4ZmIzYTsKICB0LmZpbmFsa2FmaGVicmV3ID0gMHgwNWRhOwogIHQuZmluYWxtZW0gPSAweDA1ZGQ7CiAgdC5maW5hbG1lbWhlYnJldyA9IDB4MDVkZDsKICB0LmZpbmFsbnVuID0gMHgwNWRmOwogIHQuZmluYWxudW5oZWJyZXcgPSAweDA1ZGY7CiAgdC5maW5hbHBlID0gMHgwNWUzOwogIHQuZmluYWxwZWhlYnJldyA9IDB4MDVlMzsKICB0LmZpbmFsdHNhZGkgPSAweDA1ZTU7CiAgdC5maW5hbHRzYWRpaGVicmV3ID0gMHgwNWU1OwogIHQuZmlyc3R0b25lY2hpbmVzZSA9IDB4MDJjOTsKICB0LmZpc2hleWUgPSAweDI1Yzk7CiAgdC5maXRhY3lyaWxsaWMgPSAweDA0NzM7CiAgdC5maXZlID0gMHgwMDM1OwogIHQuZml2ZWFyYWJpYyA9IDB4MDY2NTsKICB0LmZpdmViZW5nYWxpID0gMHgwOWViOwogIHQuZml2ZWNpcmNsZSA9IDB4MjQ2NDsKICB0LmZpdmVjaXJjbGVpbnZlcnNlc2Fuc3NlcmlmID0gMHgyNzhlOwogIHQuZml2ZWRldmEgPSAweDA5NmI7CiAgdC5maXZlZWlnaHRocyA9IDB4MjE1ZDsKICB0LmZpdmVndWphcmF0aSA9IDB4MGFlYjsKICB0LmZpdmVndXJtdWtoaSA9IDB4MGE2YjsKICB0LmZpdmVoYWNrYXJhYmljID0gMHgwNjY1OwogIHQuZml2ZWhhbmd6aG91ID0gMHgzMDI1OwogIHQuZml2ZWlkZW9ncmFwaGljcGFyZW4gPSAweDMyMjQ7CiAgdC5maXZlaW5mZXJpb3IgPSAweDIwODU7CiAgdC5maXZlbW9ub3NwYWNlID0gMHhmZjE1OwogIHQuZml2ZW9sZHN0eWxlID0gMHhmNzM1OwogIHQuZml2ZXBhcmVuID0gMHgyNDc4OwogIHQuZml2ZXBlcmlvZCA9IDB4MjQ4YzsKICB0LmZpdmVwZXJzaWFuID0gMHgwNmY1OwogIHQuZml2ZXJvbWFuID0gMHgyMTc0OwogIHQuZml2ZXN1cGVyaW9yID0gMHgyMDc1OwogIHQuZml2ZXRoYWkgPSAweDBlNTU7CiAgdC5mbCA9IDB4ZmIwMjsKICB0LmZfbCA9IDB4ZmIwMjsKICB0LmZsb3JpbiA9IDB4MDE5MjsKICB0LmZtb25vc3BhY2UgPSAweGZmNDY7CiAgdC5mbXNxdWFyZSA9IDB4MzM5OTsKICB0LmZvZmFudGhhaSA9IDB4MGUxZjsKICB0LmZvZmF0aGFpID0gMHgwZTFkOwogIHQuZm9uZ21hbnRoYWkgPSAweDBlNGY7CiAgdC5mb3JhbGwgPSAweDIyMDA7CiAgdC5mb3VyID0gMHgwMDM0OwogIHQuZm91cmFyYWJpYyA9IDB4MDY2NDsKICB0LmZvdXJiZW5nYWxpID0gMHgwOWVhOwogIHQuZm91cmNpcmNsZSA9IDB4MjQ2MzsKICB0LmZvdXJjaXJjbGVpbnZlcnNlc2Fuc3NlcmlmID0gMHgyNzhkOwogIHQuZm91cmRldmEgPSAweDA5NmE7CiAgdC5mb3VyZ3VqYXJhdGkgPSAweDBhZWE7CiAgdC5mb3VyZ3VybXVraGkgPSAweDBhNmE7CiAgdC5mb3VyaGFja2FyYWJpYyA9IDB4MDY2NDsKICB0LmZvdXJoYW5nemhvdSA9IDB4MzAyNDsKICB0LmZvdXJpZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjIzOwogIHQuZm91cmluZmVyaW9yID0gMHgyMDg0OwogIHQuZm91cm1vbm9zcGFjZSA9IDB4ZmYxNDsKICB0LmZvdXJudW1lcmF0b3JiZW5nYWxpID0gMHgwOWY3OwogIHQuZm91cm9sZHN0eWxlID0gMHhmNzM0OwogIHQuZm91cnBhcmVuID0gMHgyNDc3OwogIHQuZm91cnBlcmlvZCA9IDB4MjQ4YjsKICB0LmZvdXJwZXJzaWFuID0gMHgwNmY0OwogIHQuZm91cnJvbWFuID0gMHgyMTczOwogIHQuZm91cnN1cGVyaW9yID0gMHgyMDc0OwogIHQuZm91cnRlZW5jaXJjbGUgPSAweDI0NmQ7CiAgdC5mb3VydGVlbnBhcmVuID0gMHgyNDgxOwogIHQuZm91cnRlZW5wZXJpb2QgPSAweDI0OTU7CiAgdC5mb3VydGhhaSA9IDB4MGU1NDsKICB0LmZvdXJ0aHRvbmVjaGluZXNlID0gMHgwMmNiOwogIHQuZnBhcmVuID0gMHgyNGExOwogIHQuZnJhY3Rpb24gPSAweDIwNDQ7CiAgdC5mcmFuYyA9IDB4MjBhMzsKICB0LmcgPSAweDAwNjc7CiAgdC5nYWJlbmdhbGkgPSAweDA5OTc7CiAgdC5nYWN1dGUgPSAweDAxZjU7CiAgdC5nYWRldmEgPSAweDA5MTc7CiAgdC5nYWZhcmFiaWMgPSAweDA2YWY7CiAgdC5nYWZmaW5hbGFyYWJpYyA9IDB4ZmI5MzsKICB0LmdhZmluaXRpYWxhcmFiaWMgPSAweGZiOTQ7CiAgdC5nYWZtZWRpYWxhcmFiaWMgPSAweGZiOTU7CiAgdC5nYWd1amFyYXRpID0gMHgwYTk3OwogIHQuZ2FndXJtdWtoaSA9IDB4MGExNzsKICB0LmdhaGlyYWdhbmEgPSAweDMwNGM7CiAgdC5nYWthdGFrYW5hID0gMHgzMGFjOwogIHQuZ2FtbWEgPSAweDAzYjM7CiAgdC5nYW1tYWxhdGluc21hbGwgPSAweDAyNjM7CiAgdC5nYW1tYXN1cGVyaW9yID0gMHgwMmUwOwogIHQuZ2FuZ2lhY29wdGljID0gMHgwM2ViOwogIHQuZ2JvcG9tb2ZvID0gMHgzMTBkOwogIHQuZ2JyZXZlID0gMHgwMTFmOwogIHQuZ2Nhcm9uID0gMHgwMWU3OwogIHQuZ2NlZGlsbGEgPSAweDAxMjM7CiAgdC5nY2lyY2xlID0gMHgyNGQ2OwogIHQuZ2NpcmN1bWZsZXggPSAweDAxMWQ7CiAgdC5nY29tbWFhY2NlbnQgPSAweDAxMjM7CiAgdC5nZG90ID0gMHgwMTIxOwogIHQuZ2RvdGFjY2VudCA9IDB4MDEyMTsKICB0LmdlY3lyaWxsaWMgPSAweDA0MzM7CiAgdC5nZWhpcmFnYW5hID0gMHgzMDUyOwogIHQuZ2VrYXRha2FuYSA9IDB4MzBiMjsKICB0Lmdlb21ldHJpY2FsbHllcXVhbCA9IDB4MjI1MTsKICB0LmdlcmVzaGFjY2VudGhlYnJldyA9IDB4MDU5YzsKICB0LmdlcmVzaGhlYnJldyA9IDB4MDVmMzsKICB0LmdlcmVzaG11cWRhbWhlYnJldyA9IDB4MDU5ZDsKICB0Lmdlcm1hbmRibHMgPSAweDAwZGY7CiAgdC5nZXJzaGF5aW1hY2NlbnRoZWJyZXcgPSAweDA1OWU7CiAgdC5nZXJzaGF5aW1oZWJyZXcgPSAweDA1ZjQ7CiAgdC5nZXRhbWFyayA9IDB4MzAxMzsKICB0LmdoYWJlbmdhbGkgPSAweDA5OTg7CiAgdC5naGFkYXJtZW5pYW4gPSAweDA1NzI7CiAgdC5naGFkZXZhID0gMHgwOTE4OwogIHQuZ2hhZ3VqYXJhdGkgPSAweDBhOTg7CiAgdC5naGFndXJtdWtoaSA9IDB4MGExODsKICB0LmdoYWluYXJhYmljID0gMHgwNjNhOwogIHQuZ2hhaW5maW5hbGFyYWJpYyA9IDB4ZmVjZTsKICB0LmdoYWluaW5pdGlhbGFyYWJpYyA9IDB4ZmVjZjsKICB0LmdoYWlubWVkaWFsYXJhYmljID0gMHhmZWQwOwogIHQuZ2hlbWlkZGxlaG9va2N5cmlsbGljID0gMHgwNDk1OwogIHQuZ2hlc3Ryb2tlY3lyaWxsaWMgPSAweDA0OTM7CiAgdC5naGV1cHR1cm5jeXJpbGxpYyA9IDB4MDQ5MTsKICB0LmdoaGFkZXZhID0gMHgwOTVhOwogIHQuZ2hoYWd1cm11a2hpID0gMHgwYTVhOwogIHQuZ2hvb2sgPSAweDAyNjA7CiAgdC5naHpzcXVhcmUgPSAweDMzOTM7CiAgdC5naWhpcmFnYW5hID0gMHgzMDRlOwogIHQuZ2lrYXRha2FuYSA9IDB4MzBhZTsKICB0LmdpbWFybWVuaWFuID0gMHgwNTYzOwogIHQuZ2ltZWwgPSAweDA1ZDI7CiAgdC5naW1lbGRhZ2VzaCA9IDB4ZmIzMjsKICB0LmdpbWVsZGFnZXNoaGVicmV3ID0gMHhmYjMyOwogIHQuZ2ltZWxoZWJyZXcgPSAweDA1ZDI7CiAgdC5namVjeXJpbGxpYyA9IDB4MDQ1MzsKICB0Lmdsb3R0YWxpbnZlcnRlZHN0cm9rZSA9IDB4MDFiZTsKICB0Lmdsb3R0YWxzdG9wID0gMHgwMjk0OwogIHQuZ2xvdHRhbHN0b3BpbnZlcnRlZCA9IDB4MDI5NjsKICB0Lmdsb3R0YWxzdG9wbW9kID0gMHgwMmMwOwogIHQuZ2xvdHRhbHN0b3ByZXZlcnNlZCA9IDB4MDI5NTsKICB0Lmdsb3R0YWxzdG9wcmV2ZXJzZWRtb2QgPSAweDAyYzE7CiAgdC5nbG90dGFsc3RvcHJldmVyc2Vkc3VwZXJpb3IgPSAweDAyZTQ7CiAgdC5nbG90dGFsc3RvcHN0cm9rZSA9IDB4MDJhMTsKICB0Lmdsb3R0YWxzdG9wc3Ryb2tlcmV2ZXJzZWQgPSAweDAyYTI7CiAgdC5nbWFjcm9uID0gMHgxZTIxOwogIHQuZ21vbm9zcGFjZSA9IDB4ZmY0NzsKICB0LmdvaGlyYWdhbmEgPSAweDMwNTQ7CiAgdC5nb2thdGFrYW5hID0gMHgzMGI0OwogIHQuZ3BhcmVuID0gMHgyNGEyOwogIHQuZ3Bhc3F1YXJlID0gMHgzM2FjOwogIHQuZ3JhZGllbnQgPSAweDIyMDc7CiAgdC5ncmF2ZSA9IDB4MDA2MDsKICB0LmdyYXZlYmVsb3djbWIgPSAweDAzMTY7CiAgdC5ncmF2ZWNtYiA9IDB4MDMwMDsKICB0LmdyYXZlY29tYiA9IDB4MDMwMDsKICB0LmdyYXZlZGV2YSA9IDB4MDk1MzsKICB0LmdyYXZlbG93bW9kID0gMHgwMmNlOwogIHQuZ3JhdmVtb25vc3BhY2UgPSAweGZmNDA7CiAgdC5ncmF2ZXRvbmVjbWIgPSAweDAzNDA7CiAgdC5ncmVhdGVyID0gMHgwMDNlOwogIHQuZ3JlYXRlcmVxdWFsID0gMHgyMjY1OwogIHQuZ3JlYXRlcmVxdWFsb3JsZXNzID0gMHgyMmRiOwogIHQuZ3JlYXRlcm1vbm9zcGFjZSA9IDB4ZmYxZTsKICB0LmdyZWF0ZXJvcmVxdWl2YWxlbnQgPSAweDIyNzM7CiAgdC5ncmVhdGVyb3JsZXNzID0gMHgyMjc3OwogIHQuZ3JlYXRlcm92ZXJlcXVhbCA9IDB4MjI2NzsKICB0LmdyZWF0ZXJzbWFsbCA9IDB4ZmU2NTsKICB0LmdzY3JpcHQgPSAweDAyNjE7CiAgdC5nc3Ryb2tlID0gMHgwMWU1OwogIHQuZ3VoaXJhZ2FuYSA9IDB4MzA1MDsKICB0Lmd1aWxsZW1vdGxlZnQgPSAweDAwYWI7CiAgdC5ndWlsbGVtb3RyaWdodCA9IDB4MDBiYjsKICB0Lmd1aWxzaW5nbGxlZnQgPSAweDIwMzk7CiAgdC5ndWlsc2luZ2xyaWdodCA9IDB4MjAzYTsKICB0Lmd1a2F0YWthbmEgPSAweDMwYjA7CiAgdC5ndXJhbXVzcXVhcmUgPSAweDMzMTg7CiAgdC5neXNxdWFyZSA9IDB4MzNjOTsKICB0LmggPSAweDAwNjg7CiAgdC5oYWFia2hhc2lhbmN5cmlsbGljID0gMHgwNGE5OwogIHQuaGFhbHRvbmVhcmFiaWMgPSAweDA2YzE7CiAgdC5oYWJlbmdhbGkgPSAweDA5Yjk7CiAgdC5oYWRlc2NlbmRlcmN5cmlsbGljID0gMHgwNGIzOwogIHQuaGFkZXZhID0gMHgwOTM5OwogIHQuaGFndWphcmF0aSA9IDB4MGFiOTsKICB0LmhhZ3VybXVraGkgPSAweDBhMzk7CiAgdC5oYWhhcmFiaWMgPSAweDA2MmQ7CiAgdC5oYWhmaW5hbGFyYWJpYyA9IDB4ZmVhMjsKICB0LmhhaGluaXRpYWxhcmFiaWMgPSAweGZlYTM7CiAgdC5oYWhpcmFnYW5hID0gMHgzMDZmOwogIHQuaGFobWVkaWFsYXJhYmljID0gMHhmZWE0OwogIHQuaGFpdHVzcXVhcmUgPSAweDMzMmE7CiAgdC5oYWthdGFrYW5hID0gMHgzMGNmOwogIHQuaGFrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4YTsKICB0LmhhbGFudGd1cm11a2hpID0gMHgwYTRkOwogIHQuaGFtemFhcmFiaWMgPSAweDA2MjE7CiAgdC5oYW16YWxvd2FyYWJpYyA9IDB4MDYyMTsKICB0Lmhhbmd1bGZpbGxlciA9IDB4MzE2NDsKICB0LmhhcmRzaWduY3lyaWxsaWMgPSAweDA0NGE7CiAgdC5oYXJwb29ubGVmdGJhcmJ1cCA9IDB4MjFiYzsKICB0LmhhcnBvb25yaWdodGJhcmJ1cCA9IDB4MjFjMDsKICB0Lmhhc3F1YXJlID0gMHgzM2NhOwogIHQuaGF0YWZwYXRhaCA9IDB4MDViMjsKICB0LmhhdGFmcGF0YWgxNiA9IDB4MDViMjsKICB0LmhhdGFmcGF0YWgyMyA9IDB4MDViMjsKICB0LmhhdGFmcGF0YWgyZiA9IDB4MDViMjsKICB0LmhhdGFmcGF0YWhoZWJyZXcgPSAweDA1YjI7CiAgdC5oYXRhZnBhdGFobmFycm93aGVicmV3ID0gMHgwNWIyOwogIHQuaGF0YWZwYXRhaHF1YXJ0ZXJoZWJyZXcgPSAweDA1YjI7CiAgdC5oYXRhZnBhdGFod2lkZWhlYnJldyA9IDB4MDViMjsKICB0LmhhdGFmcWFtYXRzID0gMHgwNWIzOwogIHQuaGF0YWZxYW1hdHMxYiA9IDB4MDViMzsKICB0LmhhdGFmcWFtYXRzMjggPSAweDA1YjM7CiAgdC5oYXRhZnFhbWF0czM0ID0gMHgwNWIzOwogIHQuaGF0YWZxYW1hdHNoZWJyZXcgPSAweDA1YjM7CiAgdC5oYXRhZnFhbWF0c25hcnJvd2hlYnJldyA9IDB4MDViMzsKICB0LmhhdGFmcWFtYXRzcXVhcnRlcmhlYnJldyA9IDB4MDViMzsKICB0LmhhdGFmcWFtYXRzd2lkZWhlYnJldyA9IDB4MDViMzsKICB0LmhhdGFmc2Vnb2wgPSAweDA1YjE7CiAgdC5oYXRhZnNlZ29sMTcgPSAweDA1YjE7CiAgdC5oYXRhZnNlZ29sMjQgPSAweDA1YjE7CiAgdC5oYXRhZnNlZ29sMzAgPSAweDA1YjE7CiAgdC5oYXRhZnNlZ29saGVicmV3ID0gMHgwNWIxOwogIHQuaGF0YWZzZWdvbG5hcnJvd2hlYnJldyA9IDB4MDViMTsKICB0LmhhdGFmc2Vnb2xxdWFydGVyaGVicmV3ID0gMHgwNWIxOwogIHQuaGF0YWZzZWdvbHdpZGVoZWJyZXcgPSAweDA1YjE7CiAgdC5oYmFyID0gMHgwMTI3OwogIHQuaGJvcG9tb2ZvID0gMHgzMTBmOwogIHQuaGJyZXZlYmVsb3cgPSAweDFlMmI7CiAgdC5oY2VkaWxsYSA9IDB4MWUyOTsKICB0LmhjaXJjbGUgPSAweDI0ZDc7CiAgdC5oY2lyY3VtZmxleCA9IDB4MDEyNTsKICB0LmhkaWVyZXNpcyA9IDB4MWUyNzsKICB0Lmhkb3RhY2NlbnQgPSAweDFlMjM7CiAgdC5oZG90YmVsb3cgPSAweDFlMjU7CiAgdC5oZSA9IDB4MDVkNDsKICB0LmhlYXJ0ID0gMHgyNjY1OwogIHQuaGVhcnRzdWl0YmxhY2sgPSAweDI2NjU7CiAgdC5oZWFydHN1aXR3aGl0ZSA9IDB4MjY2MTsKICB0LmhlZGFnZXNoID0gMHhmYjM0OwogIHQuaGVkYWdlc2hoZWJyZXcgPSAweGZiMzQ7CiAgdC5oZWhhbHRvbmVhcmFiaWMgPSAweDA2YzE7CiAgdC5oZWhhcmFiaWMgPSAweDA2NDc7CiAgdC5oZWhlYnJldyA9IDB4MDVkNDsKICB0LmhlaGZpbmFsYWx0b25lYXJhYmljID0gMHhmYmE3OwogIHQuaGVoZmluYWxhbHR0d29hcmFiaWMgPSAweGZlZWE7CiAgdC5oZWhmaW5hbGFyYWJpYyA9IDB4ZmVlYTsKICB0LmhlaGhhbXphYWJvdmVmaW5hbGFyYWJpYyA9IDB4ZmJhNTsKICB0LmhlaGhhbXphYWJvdmVpc29sYXRlZGFyYWJpYyA9IDB4ZmJhNDsKICB0LmhlaGluaXRpYWxhbHRvbmVhcmFiaWMgPSAweGZiYTg7CiAgdC5oZWhpbml0aWFsYXJhYmljID0gMHhmZWViOwogIHQuaGVoaXJhZ2FuYSA9IDB4MzA3ODsKICB0LmhlaG1lZGlhbGFsdG9uZWFyYWJpYyA9IDB4ZmJhOTsKICB0LmhlaG1lZGlhbGFyYWJpYyA9IDB4ZmVlYzsKICB0LmhlaXNlaWVyYXNxdWFyZSA9IDB4MzM3YjsKICB0Lmhla2F0YWthbmEgPSAweDMwZDg7CiAgdC5oZWthdGFrYW5haGFsZndpZHRoID0gMHhmZjhkOwogIHQuaGVrdXRhYXJ1c3F1YXJlID0gMHgzMzM2OwogIHQuaGVuZ2hvb2sgPSAweDAyNjc7CiAgdC5oZXJ1dHVzcXVhcmUgPSAweDMzMzk7CiAgdC5oZXQgPSAweDA1ZDc7CiAgdC5oZXRoZWJyZXcgPSAweDA1ZDc7CiAgdC5oaG9vayA9IDB4MDI2NjsKICB0Lmhob29rc3VwZXJpb3IgPSAweDAyYjE7CiAgdC5oaWV1aGFjaXJjbGVrb3JlYW4gPSAweDMyN2I7CiAgdC5oaWV1aGFwYXJlbmtvcmVhbiA9IDB4MzIxYjsKICB0LmhpZXVoY2lyY2xla29yZWFuID0gMHgzMjZkOwogIHQuaGlldWhrb3JlYW4gPSAweDMxNGU7CiAgdC5oaWV1aHBhcmVua29yZWFuID0gMHgzMjBkOwogIHQuaGloaXJhZ2FuYSA9IDB4MzA3MjsKICB0Lmhpa2F0YWthbmEgPSAweDMwZDI7CiAgdC5oaWthdGFrYW5haGFsZndpZHRoID0gMHhmZjhiOwogIHQuaGlyaXEgPSAweDA1YjQ7CiAgdC5oaXJpcTE0ID0gMHgwNWI0OwogIHQuaGlyaXEyMSA9IDB4MDViNDsKICB0LmhpcmlxMmQgPSAweDA1YjQ7CiAgdC5oaXJpcWhlYnJldyA9IDB4MDViNDsKICB0LmhpcmlxbmFycm93aGVicmV3ID0gMHgwNWI0OwogIHQuaGlyaXFxdWFydGVyaGVicmV3ID0gMHgwNWI0OwogIHQuaGlyaXF3aWRlaGVicmV3ID0gMHgwNWI0OwogIHQuaGxpbmViZWxvdyA9IDB4MWU5NjsKICB0Lmhtb25vc3BhY2UgPSAweGZmNDg7CiAgdC5ob2FybWVuaWFuID0gMHgwNTcwOwogIHQuaG9oaXB0aGFpID0gMHgwZTJiOwogIHQuaG9oaXJhZ2FuYSA9IDB4MzA3YjsKICB0Lmhva2F0YWthbmEgPSAweDMwZGI7CiAgdC5ob2thdGFrYW5haGFsZndpZHRoID0gMHhmZjhlOwogIHQuaG9sYW0gPSAweDA1Yjk7CiAgdC5ob2xhbTE5ID0gMHgwNWI5OwogIHQuaG9sYW0yNiA9IDB4MDViOTsKICB0LmhvbGFtMzIgPSAweDA1Yjk7CiAgdC5ob2xhbWhlYnJldyA9IDB4MDViOTsKICB0LmhvbGFtbmFycm93aGVicmV3ID0gMHgwNWI5OwogIHQuaG9sYW1xdWFydGVyaGVicmV3ID0gMHgwNWI5OwogIHQuaG9sYW13aWRlaGVicmV3ID0gMHgwNWI5OwogIHQuaG9ub2todWt0aGFpID0gMHgwZTJlOwogIHQuaG9va2Fib3ZlY29tYiA9IDB4MDMwOTsKICB0Lmhvb2tjbWIgPSAweDAzMDk7CiAgdC5ob29rcGFsYXRhbGl6ZWRiZWxvd2NtYiA9IDB4MDMyMTsKICB0Lmhvb2tyZXRyb2ZsZXhiZWxvd2NtYiA9IDB4MDMyMjsKICB0Lmhvb25zcXVhcmUgPSAweDMzNDI7CiAgdC5ob3JpY29wdGljID0gMHgwM2U5OwogIHQuaG9yaXpvbnRhbGJhciA9IDB4MjAxNTsKICB0Lmhvcm5jbWIgPSAweDAzMWI7CiAgdC5ob3RzcHJpbmdzID0gMHgyNjY4OwogIHQuaG91c2UgPSAweDIzMDI7CiAgdC5ocGFyZW4gPSAweDI0YTM7CiAgdC5oc3VwZXJpb3IgPSAweDAyYjA7CiAgdC5odHVybmVkID0gMHgwMjY1OwogIHQuaHVoaXJhZ2FuYSA9IDB4MzA3NTsKICB0Lmh1aWl0b3NxdWFyZSA9IDB4MzMzMzsKICB0Lmh1a2F0YWthbmEgPSAweDMwZDU7CiAgdC5odWthdGFrYW5haGFsZndpZHRoID0gMHhmZjhjOwogIHQuaHVuZ2FydW1sYXV0ID0gMHgwMmRkOwogIHQuaHVuZ2FydW1sYXV0Y21iID0gMHgwMzBiOwogIHQuaHYgPSAweDAxOTU7CiAgdC5oeXBoZW4gPSAweDAwMmQ7CiAgdC5oeXBoZW5pbmZlcmlvciA9IDB4ZjZlNTsKICB0Lmh5cGhlbm1vbm9zcGFjZSA9IDB4ZmYwZDsKICB0Lmh5cGhlbnNtYWxsID0gMHhmZTYzOwogIHQuaHlwaGVuc3VwZXJpb3IgPSAweGY2ZTY7CiAgdC5oeXBoZW50d28gPSAweDIwMTA7CiAgdC5pID0gMHgwMDY5OwogIHQuaWFjdXRlID0gMHgwMGVkOwogIHQuaWFjeXJpbGxpYyA9IDB4MDQ0ZjsKICB0LmliZW5nYWxpID0gMHgwOTg3OwogIHQuaWJvcG9tb2ZvID0gMHgzMTI3OwogIHQuaWJyZXZlID0gMHgwMTJkOwogIHQuaWNhcm9uID0gMHgwMWQwOwogIHQuaWNpcmNsZSA9IDB4MjRkODsKICB0LmljaXJjdW1mbGV4ID0gMHgwMGVlOwogIHQuaWN5cmlsbGljID0gMHgwNDU2OwogIHQuaWRibGdyYXZlID0gMHgwMjA5OwogIHQuaWRlb2dyYXBoZWFydGhjaXJjbGUgPSAweDMyOGY7CiAgdC5pZGVvZ3JhcGhmaXJlY2lyY2xlID0gMHgzMjhiOwogIHQuaWRlb2dyYXBoaWNhbGxpYW5jZXBhcmVuID0gMHgzMjNmOwogIHQuaWRlb2dyYXBoaWNjYWxscGFyZW4gPSAweDMyM2E7CiAgdC5pZGVvZ3JhcGhpY2NlbnRyZWNpcmNsZSA9IDB4MzJhNTsKICB0LmlkZW9ncmFwaGljY2xvc2UgPSAweDMwMDY7CiAgdC5pZGVvZ3JhcGhpY2NvbW1hID0gMHgzMDAxOwogIHQuaWRlb2dyYXBoaWNjb21tYWxlZnQgPSAweGZmNjQ7CiAgdC5pZGVvZ3JhcGhpY2NvbmdyYXR1bGF0aW9ucGFyZW4gPSAweDMyMzc7CiAgdC5pZGVvZ3JhcGhpY2NvcnJlY3RjaXJjbGUgPSAweDMyYTM7CiAgdC5pZGVvZ3JhcGhpY2VhcnRocGFyZW4gPSAweDMyMmY7CiAgdC5pZGVvZ3JhcGhpY2VudGVycHJpc2VwYXJlbiA9IDB4MzIzZDsKICB0LmlkZW9ncmFwaGljZXhjZWxsZW50Y2lyY2xlID0gMHgzMjlkOwogIHQuaWRlb2dyYXBoaWNmZXN0aXZhbHBhcmVuID0gMHgzMjQwOwogIHQuaWRlb2dyYXBoaWNmaW5hbmNpYWxjaXJjbGUgPSAweDMyOTY7CiAgdC5pZGVvZ3JhcGhpY2ZpbmFuY2lhbHBhcmVuID0gMHgzMjM2OwogIHQuaWRlb2dyYXBoaWNmaXJlcGFyZW4gPSAweDMyMmI7CiAgdC5pZGVvZ3JhcGhpY2hhdmVwYXJlbiA9IDB4MzIzMjsKICB0LmlkZW9ncmFwaGljaGlnaGNpcmNsZSA9IDB4MzJhNDsKICB0LmlkZW9ncmFwaGljaXRlcmF0aW9ubWFyayA9IDB4MzAwNTsKICB0LmlkZW9ncmFwaGljbGFib3JjaXJjbGUgPSAweDMyOTg7CiAgdC5pZGVvZ3JhcGhpY2xhYm9ycGFyZW4gPSAweDMyMzg7CiAgdC5pZGVvZ3JhcGhpY2xlZnRjaXJjbGUgPSAweDMyYTc7CiAgdC5pZGVvZ3JhcGhpY2xvd2NpcmNsZSA9IDB4MzJhNjsKICB0LmlkZW9ncmFwaGljbWVkaWNpbmVjaXJjbGUgPSAweDMyYTk7CiAgdC5pZGVvZ3JhcGhpY21ldGFscGFyZW4gPSAweDMyMmU7CiAgdC5pZGVvZ3JhcGhpY21vb25wYXJlbiA9IDB4MzIyYTsKICB0LmlkZW9ncmFwaGljbmFtZXBhcmVuID0gMHgzMjM0OwogIHQuaWRlb2dyYXBoaWNwZXJpb2QgPSAweDMwMDI7CiAgdC5pZGVvZ3JhcGhpY3ByaW50Y2lyY2xlID0gMHgzMjllOwogIHQuaWRlb2dyYXBoaWNyZWFjaHBhcmVuID0gMHgzMjQzOwogIHQuaWRlb2dyYXBoaWNyZXByZXNlbnRwYXJlbiA9IDB4MzIzOTsKICB0LmlkZW9ncmFwaGljcmVzb3VyY2VwYXJlbiA9IDB4MzIzZTsKICB0LmlkZW9ncmFwaGljcmlnaHRjaXJjbGUgPSAweDMyYTg7CiAgdC5pZGVvZ3JhcGhpY3NlY3JldGNpcmNsZSA9IDB4MzI5OTsKICB0LmlkZW9ncmFwaGljc2VsZnBhcmVuID0gMHgzMjQyOwogIHQuaWRlb2dyYXBoaWNzb2NpZXR5cGFyZW4gPSAweDMyMzM7CiAgdC5pZGVvZ3JhcGhpY3NwYWNlID0gMHgzMDAwOwogIHQuaWRlb2dyYXBoaWNzcGVjaWFscGFyZW4gPSAweDMyMzU7CiAgdC5pZGVvZ3JhcGhpY3N0b2NrcGFyZW4gPSAweDMyMzE7CiAgdC5pZGVvZ3JhcGhpY3N0dWR5cGFyZW4gPSAweDMyM2I7CiAgdC5pZGVvZ3JhcGhpY3N1bnBhcmVuID0gMHgzMjMwOwogIHQuaWRlb2dyYXBoaWNzdXBlcnZpc2VwYXJlbiA9IDB4MzIzYzsKICB0LmlkZW9ncmFwaGljd2F0ZXJwYXJlbiA9IDB4MzIyYzsKICB0LmlkZW9ncmFwaGljd29vZHBhcmVuID0gMHgzMjJkOwogIHQuaWRlb2dyYXBoaWN6ZXJvID0gMHgzMDA3OwogIHQuaWRlb2dyYXBobWV0YWxjaXJjbGUgPSAweDMyOGU7CiAgdC5pZGVvZ3JhcGhtb29uY2lyY2xlID0gMHgzMjhhOwogIHQuaWRlb2dyYXBobmFtZWNpcmNsZSA9IDB4MzI5NDsKICB0LmlkZW9ncmFwaHN1bmNpcmNsZSA9IDB4MzI5MDsKICB0LmlkZW9ncmFwaHdhdGVyY2lyY2xlID0gMHgzMjhjOwogIHQuaWRlb2dyYXBod29vZGNpcmNsZSA9IDB4MzI4ZDsKICB0LmlkZXZhID0gMHgwOTA3OwogIHQuaWRpZXJlc2lzID0gMHgwMGVmOwogIHQuaWRpZXJlc2lzYWN1dGUgPSAweDFlMmY7CiAgdC5pZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRlNTsKICB0Lmlkb3RiZWxvdyA9IDB4MWVjYjsKICB0LmllYnJldmVjeXJpbGxpYyA9IDB4MDRkNzsKICB0LmllY3lyaWxsaWMgPSAweDA0MzU7CiAgdC5pZXVuZ2FjaXJjbGVrb3JlYW4gPSAweDMyNzU7CiAgdC5pZXVuZ2FwYXJlbmtvcmVhbiA9IDB4MzIxNTsKICB0LmlldW5nY2lyY2xla29yZWFuID0gMHgzMjY3OwogIHQuaWV1bmdrb3JlYW4gPSAweDMxNDc7CiAgdC5pZXVuZ3BhcmVua29yZWFuID0gMHgzMjA3OwogIHQuaWdyYXZlID0gMHgwMGVjOwogIHQuaWd1amFyYXRpID0gMHgwYTg3OwogIHQuaWd1cm11a2hpID0gMHgwYTA3OwogIHQuaWhpcmFnYW5hID0gMHgzMDQ0OwogIHQuaWhvb2thYm92ZSA9IDB4MWVjOTsKICB0LmlpYmVuZ2FsaSA9IDB4MDk4ODsKICB0LmlpY3lyaWxsaWMgPSAweDA0Mzg7CiAgdC5paWRldmEgPSAweDA5MDg7CiAgdC5paWd1amFyYXRpID0gMHgwYTg4OwogIHQuaWlndXJtdWtoaSA9IDB4MGEwODsKICB0LmlpbWF0cmFndXJtdWtoaSA9IDB4MGE0MDsKICB0LmlpbnZlcnRlZGJyZXZlID0gMHgwMjBiOwogIHQuaWlzaG9ydGN5cmlsbGljID0gMHgwNDM5OwogIHQuaWl2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWMwOwogIHQuaWl2b3dlbHNpZ25kZXZhID0gMHgwOTQwOwogIHQuaWl2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjMDsKICB0LmlqID0gMHgwMTMzOwogIHQuaWthdGFrYW5hID0gMHgzMGE0OwogIHQuaWthdGFrYW5haGFsZndpZHRoID0gMHhmZjcyOwogIHQuaWtvcmVhbiA9IDB4MzE2MzsKICB0LmlsZGUgPSAweDAyZGM7CiAgdC5pbHV5aGVicmV3ID0gMHgwNWFjOwogIHQuaW1hY3JvbiA9IDB4MDEyYjsKICB0LmltYWNyb25jeXJpbGxpYyA9IDB4MDRlMzsKICB0LmltYWdlb3JhcHByb3hpbWF0ZWx5ZXF1YWwgPSAweDIyNTM7CiAgdC5pbWF0cmFndXJtdWtoaSA9IDB4MGEzZjsKICB0Lmltb25vc3BhY2UgPSAweGZmNDk7CiAgdC5pbmNyZW1lbnQgPSAweDIyMDY7CiAgdC5pbmZpbml0eSA9IDB4MjIxZTsKICB0LmluaWFybWVuaWFuID0gMHgwNTZiOwogIHQuaW50ZWdyYWwgPSAweDIyMmI7CiAgdC5pbnRlZ3JhbGJvdHRvbSA9IDB4MjMyMTsKICB0LmludGVncmFsYnQgPSAweDIzMjE7CiAgdC5pbnRlZ3JhbGV4ID0gMHhmOGY1OwogIHQuaW50ZWdyYWx0b3AgPSAweDIzMjA7CiAgdC5pbnRlZ3JhbHRwID0gMHgyMzIwOwogIHQuaW50ZXJzZWN0aW9uID0gMHgyMjI5OwogIHQuaW50aXNxdWFyZSA9IDB4MzMwNTsKICB0LmludmJ1bGxldCA9IDB4MjVkODsKICB0LmludmNpcmNsZSA9IDB4MjVkOTsKICB0LmludnNtaWxlZmFjZSA9IDB4MjYzYjsKICB0LmlvY3lyaWxsaWMgPSAweDA0NTE7CiAgdC5pb2dvbmVrID0gMHgwMTJmOwogIHQuaW90YSA9IDB4MDNiOTsKICB0LmlvdGFkaWVyZXNpcyA9IDB4MDNjYTsKICB0LmlvdGFkaWVyZXNpc3Rvbm9zID0gMHgwMzkwOwogIHQuaW90YWxhdGluID0gMHgwMjY5OwogIHQuaW90YXRvbm9zID0gMHgwM2FmOwogIHQuaXBhcmVuID0gMHgyNGE0OwogIHQuaXJpZ3VybXVraGkgPSAweDBhNzI7CiAgdC5pc21hbGxoaXJhZ2FuYSA9IDB4MzA0MzsKICB0LmlzbWFsbGthdGFrYW5hID0gMHgzMGEzOwogIHQuaXNtYWxsa2F0YWthbmFoYWxmd2lkdGggPSAweGZmNjg7CiAgdC5pc3NoYXJiZW5nYWxpID0gMHgwOWZhOwogIHQuaXN0cm9rZSA9IDB4MDI2ODsKICB0LmlzdXBlcmlvciA9IDB4ZjZlZDsKICB0Lml0ZXJhdGlvbmhpcmFnYW5hID0gMHgzMDlkOwogIHQuaXRlcmF0aW9ua2F0YWthbmEgPSAweDMwZmQ7CiAgdC5pdGlsZGUgPSAweDAxMjk7CiAgdC5pdGlsZGViZWxvdyA9IDB4MWUyZDsKICB0Lml1Ym9wb21vZm8gPSAweDMxMjk7CiAgdC5pdWN5cmlsbGljID0gMHgwNDRlOwogIHQuaXZvd2Vsc2lnbmJlbmdhbGkgPSAweDA5YmY7CiAgdC5pdm93ZWxzaWduZGV2YSA9IDB4MDkzZjsKICB0Lml2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFiZjsKICB0Lml6aGl0c2FjeXJpbGxpYyA9IDB4MDQ3NTsKICB0Lml6aGl0c2FkYmxncmF2ZWN5cmlsbGljID0gMHgwNDc3OwogIHQuaiA9IDB4MDA2YTsKICB0LmphYXJtZW5pYW4gPSAweDA1NzE7CiAgdC5qYWJlbmdhbGkgPSAweDA5OWM7CiAgdC5qYWRldmEgPSAweDA5MWM7CiAgdC5qYWd1amFyYXRpID0gMHgwYTljOwogIHQuamFndXJtdWtoaSA9IDB4MGExYzsKICB0Lmpib3BvbW9mbyA9IDB4MzExMDsKICB0LmpjYXJvbiA9IDB4MDFmMDsKICB0LmpjaXJjbGUgPSAweDI0ZDk7CiAgdC5qY2lyY3VtZmxleCA9IDB4MDEzNTsKICB0Lmpjcm9zc2VkdGFpbCA9IDB4MDI5ZDsKICB0Lmpkb3RsZXNzc3Ryb2tlID0gMHgwMjVmOwogIHQuamVjeXJpbGxpYyA9IDB4MDQ1ODsKICB0LmplZW1hcmFiaWMgPSAweDA2MmM7CiAgdC5qZWVtZmluYWxhcmFiaWMgPSAweGZlOWU7CiAgdC5qZWVtaW5pdGlhbGFyYWJpYyA9IDB4ZmU5ZjsKICB0LmplZW1tZWRpYWxhcmFiaWMgPSAweGZlYTA7CiAgdC5qZWhhcmFiaWMgPSAweDA2OTg7CiAgdC5qZWhmaW5hbGFyYWJpYyA9IDB4ZmI4YjsKICB0LmpoYWJlbmdhbGkgPSAweDA5OWQ7CiAgdC5qaGFkZXZhID0gMHgwOTFkOwogIHQuamhhZ3VqYXJhdGkgPSAweDBhOWQ7CiAgdC5qaGFndXJtdWtoaSA9IDB4MGExZDsKICB0LmpoZWhhcm1lbmlhbiA9IDB4MDU3YjsKICB0LmppcyA9IDB4MzAwNDsKICB0Lmptb25vc3BhY2UgPSAweGZmNGE7CiAgdC5qcGFyZW4gPSAweDI0YTU7CiAgdC5qc3VwZXJpb3IgPSAweDAyYjI7CiAgdC5rID0gMHgwMDZiOwogIHQua2FiYXNoa2lyY3lyaWxsaWMgPSAweDA0YTE7CiAgdC5rYWJlbmdhbGkgPSAweDA5OTU7CiAgdC5rYWN1dGUgPSAweDFlMzE7CiAgdC5rYWN5cmlsbGljID0gMHgwNDNhOwogIHQua2FkZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDQ5YjsKICB0LmthZGV2YSA9IDB4MDkxNTsKICB0LmthZiA9IDB4MDVkYjsKICB0LmthZmFyYWJpYyA9IDB4MDY0MzsKICB0LmthZmRhZ2VzaCA9IDB4ZmIzYjsKICB0LmthZmRhZ2VzaGhlYnJldyA9IDB4ZmIzYjsKICB0LmthZmZpbmFsYXJhYmljID0gMHhmZWRhOwogIHQua2FmaGVicmV3ID0gMHgwNWRiOwogIHQua2FmaW5pdGlhbGFyYWJpYyA9IDB4ZmVkYjsKICB0LmthZm1lZGlhbGFyYWJpYyA9IDB4ZmVkYzsKICB0LmthZnJhZmVoZWJyZXcgPSAweGZiNGQ7CiAgdC5rYWd1amFyYXRpID0gMHgwYTk1OwogIHQua2FndXJtdWtoaSA9IDB4MGExNTsKICB0LmthaGlyYWdhbmEgPSAweDMwNGI7CiAgdC5rYWhvb2tjeXJpbGxpYyA9IDB4MDRjNDsKICB0Lmtha2F0YWthbmEgPSAweDMwYWI7CiAgdC5rYWthdGFrYW5haGFsZndpZHRoID0gMHhmZjc2OwogIHQua2FwcGEgPSAweDAzYmE7CiAgdC5rYXBwYXN5bWJvbGdyZWVrID0gMHgwM2YwOwogIHQua2FweWVvdW5taWV1bWtvcmVhbiA9IDB4MzE3MTsKICB0LmthcHllb3VucGhpZXVwaGtvcmVhbiA9IDB4MzE4NDsKICB0LmthcHllb3VucGlldXBrb3JlYW4gPSAweDMxNzg7CiAgdC5rYXB5ZW91bnNzYW5ncGlldXBrb3JlYW4gPSAweDMxNzk7CiAgdC5rYXJvcmlpc3F1YXJlID0gMHgzMzBkOwogIHQua2FzaGlkYWF1dG9hcmFiaWMgPSAweDA2NDA7CiAgdC5rYXNoaWRhYXV0b25vc2lkZWJlYXJpbmdhcmFiaWMgPSAweDA2NDA7CiAgdC5rYXNtYWxsa2F0YWthbmEgPSAweDMwZjU7CiAgdC5rYXNxdWFyZSA9IDB4MzM4NDsKICB0Lmthc3JhYXJhYmljID0gMHgwNjUwOwogIHQua2FzcmF0YW5hcmFiaWMgPSAweDA2NGQ7CiAgdC5rYXN0cm9rZWN5cmlsbGljID0gMHgwNDlmOwogIHQua2F0YWhpcmFwcm9sb25nbWFya2hhbGZ3aWR0aCA9IDB4ZmY3MDsKICB0LmthdmVydGljYWxzdHJva2VjeXJpbGxpYyA9IDB4MDQ5ZDsKICB0Lmtib3BvbW9mbyA9IDB4MzEwZTsKICB0LmtjYWxzcXVhcmUgPSAweDMzODk7CiAgdC5rY2Fyb24gPSAweDAxZTk7CiAgdC5rY2VkaWxsYSA9IDB4MDEzNzsKICB0LmtjaXJjbGUgPSAweDI0ZGE7CiAgdC5rY29tbWFhY2NlbnQgPSAweDAxMzc7CiAgdC5rZG90YmVsb3cgPSAweDFlMzM7CiAgdC5rZWhhcm1lbmlhbiA9IDB4MDU4NDsKICB0LmtlaGlyYWdhbmEgPSAweDMwNTE7CiAgdC5rZWthdGFrYW5hID0gMHgzMGIxOwogIHQua2VrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3OTsKICB0LmtlbmFybWVuaWFuID0gMHgwNTZmOwogIHQua2VzbWFsbGthdGFrYW5hID0gMHgzMGY2OwogIHQua2dyZWVubGFuZGljID0gMHgwMTM4OwogIHQua2hhYmVuZ2FsaSA9IDB4MDk5NjsKICB0LmtoYWN5cmlsbGljID0gMHgwNDQ1OwogIHQua2hhZGV2YSA9IDB4MDkxNjsKICB0LmtoYWd1amFyYXRpID0gMHgwYTk2OwogIHQua2hhZ3VybXVraGkgPSAweDBhMTY7CiAgdC5raGFoYXJhYmljID0gMHgwNjJlOwogIHQua2hhaGZpbmFsYXJhYmljID0gMHhmZWE2OwogIHQua2hhaGluaXRpYWxhcmFiaWMgPSAweGZlYTc7CiAgdC5raGFobWVkaWFsYXJhYmljID0gMHhmZWE4OwogIHQua2hlaWNvcHRpYyA9IDB4MDNlNzsKICB0LmtoaGFkZXZhID0gMHgwOTU5OwogIHQua2hoYWd1cm11a2hpID0gMHgwYTU5OwogIHQua2hpZXVraGFjaXJjbGVrb3JlYW4gPSAweDMyNzg7CiAgdC5raGlldWtoYXBhcmVua29yZWFuID0gMHgzMjE4OwogIHQua2hpZXVraGNpcmNsZWtvcmVhbiA9IDB4MzI2YTsKICB0LmtoaWV1a2hrb3JlYW4gPSAweDMxNGI7CiAgdC5raGlldWtocGFyZW5rb3JlYW4gPSAweDMyMGE7CiAgdC5raG9raGFpdGhhaSA9IDB4MGUwMjsKICB0Lmtob2tob250aGFpID0gMHgwZTA1OwogIHQua2hva2h1YXR0aGFpID0gMHgwZTAzOwogIHQua2hva2h3YWl0aGFpID0gMHgwZTA0OwogIHQua2hvbXV0dGhhaSA9IDB4MGU1YjsKICB0Lmtob29rID0gMHgwMTk5OwogIHQua2hvcmFraGFuZ3RoYWkgPSAweDBlMDY7CiAgdC5raHpzcXVhcmUgPSAweDMzOTE7CiAgdC5raWhpcmFnYW5hID0gMHgzMDRkOwogIHQua2lrYXRha2FuYSA9IDB4MzBhZDsKICB0Lmtpa2F0YWthbmFoYWxmd2lkdGggPSAweGZmNzc7CiAgdC5raXJvZ3VyYW11c3F1YXJlID0gMHgzMzE1OwogIHQua2lyb21lZXRvcnVzcXVhcmUgPSAweDMzMTY7CiAgdC5raXJvc3F1YXJlID0gMHgzMzE0OwogIHQua2l5ZW9rYWNpcmNsZWtvcmVhbiA9IDB4MzI2ZTsKICB0LmtpeWVva2FwYXJlbmtvcmVhbiA9IDB4MzIwZTsKICB0LmtpeWVva2NpcmNsZWtvcmVhbiA9IDB4MzI2MDsKICB0LmtpeWVva2tvcmVhbiA9IDB4MzEzMTsKICB0LmtpeWVva3BhcmVua29yZWFuID0gMHgzMjAwOwogIHQua2l5ZW9rc2lvc2tvcmVhbiA9IDB4MzEzMzsKICB0LmtqZWN5cmlsbGljID0gMHgwNDVjOwogIHQua2xpbmViZWxvdyA9IDB4MWUzNTsKICB0Lmtsc3F1YXJlID0gMHgzMzk4OwogIHQua21jdWJlZHNxdWFyZSA9IDB4MzNhNjsKICB0Lmttb25vc3BhY2UgPSAweGZmNGI7CiAgdC5rbXNxdWFyZWRzcXVhcmUgPSAweDMzYTI7CiAgdC5rb2hpcmFnYW5hID0gMHgzMDUzOwogIHQua29obXNxdWFyZSA9IDB4MzNjMDsKICB0Lmtva2FpdGhhaSA9IDB4MGUwMTsKICB0Lmtva2F0YWthbmEgPSAweDMwYjM7CiAgdC5rb2thdGFrYW5haGFsZndpZHRoID0gMHhmZjdhOwogIHQua29vcG9zcXVhcmUgPSAweDMzMWU7CiAgdC5rb3BwYWN5cmlsbGljID0gMHgwNDgxOwogIHQua29yZWFuc3RhbmRhcmRzeW1ib2wgPSAweDMyN2Y7CiAgdC5rb3JvbmlzY21iID0gMHgwMzQzOwogIHQua3BhcmVuID0gMHgyNGE2OwogIHQua3Bhc3F1YXJlID0gMHgzM2FhOwogIHQua3NpY3lyaWxsaWMgPSAweDA0NmY7CiAgdC5rdHNxdWFyZSA9IDB4MzNjZjsKICB0Lmt0dXJuZWQgPSAweDAyOWU7CiAgdC5rdWhpcmFnYW5hID0gMHgzMDRmOwogIHQua3VrYXRha2FuYSA9IDB4MzBhZjsKICB0Lmt1a2F0YWthbmFoYWxmd2lkdGggPSAweGZmNzg7CiAgdC5rdnNxdWFyZSA9IDB4MzNiODsKICB0Lmt3c3F1YXJlID0gMHgzM2JlOwogIHQubCA9IDB4MDA2YzsKICB0LmxhYmVuZ2FsaSA9IDB4MDliMjsKICB0LmxhY3V0ZSA9IDB4MDEzYTsKICB0LmxhZGV2YSA9IDB4MDkzMjsKICB0LmxhZ3VqYXJhdGkgPSAweDBhYjI7CiAgdC5sYWd1cm11a2hpID0gMHgwYTMyOwogIHQubGFra2hhbmd5YW90aGFpID0gMHgwZTQ1OwogIHQubGFtYWxlZmZpbmFsYXJhYmljID0gMHhmZWZjOwogIHQubGFtYWxlZmhhbXphYWJvdmVmaW5hbGFyYWJpYyA9IDB4ZmVmODsKICB0LmxhbWFsZWZoYW16YWFib3ZlaXNvbGF0ZWRhcmFiaWMgPSAweGZlZjc7CiAgdC5sYW1hbGVmaGFtemFiZWxvd2ZpbmFsYXJhYmljID0gMHhmZWZhOwogIHQubGFtYWxlZmhhbXphYmVsb3dpc29sYXRlZGFyYWJpYyA9IDB4ZmVmOTsKICB0LmxhbWFsZWZpc29sYXRlZGFyYWJpYyA9IDB4ZmVmYjsKICB0LmxhbWFsZWZtYWRkYWFib3ZlZmluYWxhcmFiaWMgPSAweGZlZjY7CiAgdC5sYW1hbGVmbWFkZGFhYm92ZWlzb2xhdGVkYXJhYmljID0gMHhmZWY1OwogIHQubGFtYXJhYmljID0gMHgwNjQ0OwogIHQubGFtYmRhID0gMHgwM2JiOwogIHQubGFtYmRhc3Ryb2tlID0gMHgwMTliOwogIHQubGFtZWQgPSAweDA1ZGM7CiAgdC5sYW1lZGRhZ2VzaCA9IDB4ZmIzYzsKICB0LmxhbWVkZGFnZXNoaGVicmV3ID0gMHhmYjNjOwogIHQubGFtZWRoZWJyZXcgPSAweDA1ZGM7CiAgdC5sYW1maW5hbGFyYWJpYyA9IDB4ZmVkZTsKICB0LmxhbWhhaGluaXRpYWxhcmFiaWMgPSAweGZjY2E7CiAgdC5sYW1pbml0aWFsYXJhYmljID0gMHhmZWRmOwogIHQubGFtamVlbWluaXRpYWxhcmFiaWMgPSAweGZjYzk7CiAgdC5sYW1raGFoaW5pdGlhbGFyYWJpYyA9IDB4ZmNjYjsKICB0LmxhbWxhbWhlaGlzb2xhdGVkYXJhYmljID0gMHhmZGYyOwogIHQubGFtbWVkaWFsYXJhYmljID0gMHhmZWUwOwogIHQubGFtbWVlbWhhaGluaXRpYWxhcmFiaWMgPSAweGZkODg7CiAgdC5sYW1tZWVtaW5pdGlhbGFyYWJpYyA9IDB4ZmNjYzsKICB0LmxhcmdlY2lyY2xlID0gMHgyNWVmOwogIHQubGJhciA9IDB4MDE5YTsKICB0LmxiZWx0ID0gMHgwMjZjOwogIHQubGJvcG9tb2ZvID0gMHgzMTBjOwogIHQubGNhcm9uID0gMHgwMTNlOwogIHQubGNlZGlsbGEgPSAweDAxM2M7CiAgdC5sY2lyY2xlID0gMHgyNGRiOwogIHQubGNpcmN1bWZsZXhiZWxvdyA9IDB4MWUzZDsKICB0Lmxjb21tYWFjY2VudCA9IDB4MDEzYzsKICB0Lmxkb3QgPSAweDAxNDA7CiAgdC5sZG90YWNjZW50ID0gMHgwMTQwOwogIHQubGRvdGJlbG93ID0gMHgxZTM3OwogIHQubGRvdGJlbG93bWFjcm9uID0gMHgxZTM5OwogIHQubGVmdGFuZ2xlYWJvdmVjbWIgPSAweDAzMWE7CiAgdC5sZWZ0dGFja2JlbG93Y21iID0gMHgwMzE4OwogIHQubGVzcyA9IDB4MDAzYzsKICB0Lmxlc3NlcXVhbCA9IDB4MjI2NDsKICB0Lmxlc3NlcXVhbG9yZ3JlYXRlciA9IDB4MjJkYTsKICB0Lmxlc3Ntb25vc3BhY2UgPSAweGZmMWM7CiAgdC5sZXNzb3JlcXVpdmFsZW50ID0gMHgyMjcyOwogIHQubGVzc29yZ3JlYXRlciA9IDB4MjI3NjsKICB0Lmxlc3NvdmVyZXF1YWwgPSAweDIyNjY7CiAgdC5sZXNzc21hbGwgPSAweGZlNjQ7CiAgdC5sZXpoID0gMHgwMjZlOwogIHQubGZibG9jayA9IDB4MjU4YzsKICB0Lmxob29rcmV0cm9mbGV4ID0gMHgwMjZkOwogIHQubGlyYSA9IDB4MjBhNDsKICB0Lmxpd25hcm1lbmlhbiA9IDB4MDU2YzsKICB0LmxqID0gMHgwMWM5OwogIHQubGplY3lyaWxsaWMgPSAweDA0NTk7CiAgdC5sbCA9IDB4ZjZjMDsKICB0LmxsYWRldmEgPSAweDA5MzM7CiAgdC5sbGFndWphcmF0aSA9IDB4MGFiMzsKICB0LmxsaW5lYmVsb3cgPSAweDFlM2I7CiAgdC5sbGxhZGV2YSA9IDB4MDkzNDsKICB0Lmxsdm9jYWxpY2JlbmdhbGkgPSAweDA5ZTE7CiAgdC5sbHZvY2FsaWNkZXZhID0gMHgwOTYxOwogIHQubGx2b2NhbGljdm93ZWxzaWduYmVuZ2FsaSA9IDB4MDllMzsKICB0Lmxsdm9jYWxpY3Zvd2Vsc2lnbmRldmEgPSAweDA5NjM7CiAgdC5sbWlkZGxldGlsZGUgPSAweDAyNmI7CiAgdC5sbW9ub3NwYWNlID0gMHhmZjRjOwogIHQubG1zcXVhcmUgPSAweDMzZDA7CiAgdC5sb2NodWxhdGhhaSA9IDB4MGUyYzsKICB0LmxvZ2ljYWxhbmQgPSAweDIyMjc7CiAgdC5sb2dpY2Fsbm90ID0gMHgwMGFjOwogIHQubG9naWNhbG5vdHJldmVyc2VkID0gMHgyMzEwOwogIHQubG9naWNhbG9yID0gMHgyMjI4OwogIHQubG9saW5ndGhhaSA9IDB4MGUyNTsKICB0LmxvbmdzID0gMHgwMTdmOwogIHQubG93bGluZWNlbnRlcmxpbmUgPSAweGZlNGU7CiAgdC5sb3dsaW5lY21iID0gMHgwMzMyOwogIHQubG93bGluZWRhc2hlZCA9IDB4ZmU0ZDsKICB0LmxvemVuZ2UgPSAweDI1Y2E7CiAgdC5scGFyZW4gPSAweDI0YTc7CiAgdC5sc2xhc2ggPSAweDAxNDI7CiAgdC5sc3F1YXJlID0gMHgyMTEzOwogIHQubHN1cGVyaW9yID0gMHhmNmVlOwogIHQubHRzaGFkZSA9IDB4MjU5MTsKICB0Lmx1dGhhaSA9IDB4MGUyNjsKICB0Lmx2b2NhbGljYmVuZ2FsaSA9IDB4MDk4YzsKICB0Lmx2b2NhbGljZGV2YSA9IDB4MDkwYzsKICB0Lmx2b2NhbGljdm93ZWxzaWduYmVuZ2FsaSA9IDB4MDllMjsKICB0Lmx2b2NhbGljdm93ZWxzaWduZGV2YSA9IDB4MDk2MjsKICB0Lmx4c3F1YXJlID0gMHgzM2QzOwogIHQubSA9IDB4MDA2ZDsKICB0Lm1hYmVuZ2FsaSA9IDB4MDlhZTsKICB0Lm1hY3JvbiA9IDB4MDBhZjsKICB0Lm1hY3JvbmJlbG93Y21iID0gMHgwMzMxOwogIHQubWFjcm9uY21iID0gMHgwMzA0OwogIHQubWFjcm9ubG93bW9kID0gMHgwMmNkOwogIHQubWFjcm9ubW9ub3NwYWNlID0gMHhmZmUzOwogIHQubWFjdXRlID0gMHgxZTNmOwogIHQubWFkZXZhID0gMHgwOTJlOwogIHQubWFndWphcmF0aSA9IDB4MGFhZTsKICB0Lm1hZ3VybXVraGkgPSAweDBhMmU7CiAgdC5tYWhhcGFraGhlYnJldyA9IDB4MDVhNDsKICB0Lm1haGFwYWtobGVmdGhlYnJldyA9IDB4MDVhNDsKICB0Lm1haGlyYWdhbmEgPSAweDMwN2U7CiAgdC5tYWljaGF0dGF3YWxvd2xlZnR0aGFpID0gMHhmODk1OwogIHQubWFpY2hhdHRhd2Fsb3dyaWdodHRoYWkgPSAweGY4OTQ7CiAgdC5tYWljaGF0dGF3YXRoYWkgPSAweDBlNGI7CiAgdC5tYWljaGF0dGF3YXVwcGVybGVmdHRoYWkgPSAweGY4OTM7CiAgdC5tYWlla2xvd2xlZnR0aGFpID0gMHhmODhjOwogIHQubWFpZWtsb3dyaWdodHRoYWkgPSAweGY4OGI7CiAgdC5tYWlla3RoYWkgPSAweDBlNDg7CiAgdC5tYWlla3VwcGVybGVmdHRoYWkgPSAweGY4OGE7CiAgdC5tYWloYW5ha2F0bGVmdHRoYWkgPSAweGY4ODQ7CiAgdC5tYWloYW5ha2F0dGhhaSA9IDB4MGUzMTsKICB0Lm1haXRhaWtodWxlZnR0aGFpID0gMHhmODg5OwogIHQubWFpdGFpa2h1dGhhaSA9IDB4MGU0NzsKICB0Lm1haXRob2xvd2xlZnR0aGFpID0gMHhmODhmOwogIHQubWFpdGhvbG93cmlnaHR0aGFpID0gMHhmODhlOwogIHQubWFpdGhvdGhhaSA9IDB4MGU0OTsKICB0Lm1haXRob3VwcGVybGVmdHRoYWkgPSAweGY4OGQ7CiAgdC5tYWl0cmlsb3dsZWZ0dGhhaSA9IDB4Zjg5MjsKICB0Lm1haXRyaWxvd3JpZ2h0dGhhaSA9IDB4Zjg5MTsKICB0Lm1haXRyaXRoYWkgPSAweDBlNGE7CiAgdC5tYWl0cml1cHBlcmxlZnR0aGFpID0gMHhmODkwOwogIHQubWFpeWFtb2t0aGFpID0gMHgwZTQ2OwogIHQubWFrYXRha2FuYSA9IDB4MzBkZTsKICB0Lm1ha2F0YWthbmFoYWxmd2lkdGggPSAweGZmOGY7CiAgdC5tYWxlID0gMHgyNjQyOwogIHQubWFuc3lvbnNxdWFyZSA9IDB4MzM0NzsKICB0Lm1hcWFmaGVicmV3ID0gMHgwNWJlOwogIHQubWFycyA9IDB4MjY0MjsKICB0Lm1hc29yYWNpcmNsZWhlYnJldyA9IDB4MDVhZjsKICB0Lm1hc3F1YXJlID0gMHgzMzgzOwogIHQubWJvcG9tb2ZvID0gMHgzMTA3OwogIHQubWJzcXVhcmUgPSAweDMzZDQ7CiAgdC5tY2lyY2xlID0gMHgyNGRjOwogIHQubWN1YmVkc3F1YXJlID0gMHgzM2E1OwogIHQubWRvdGFjY2VudCA9IDB4MWU0MTsKICB0Lm1kb3RiZWxvdyA9IDB4MWU0MzsKICB0Lm1lZW1hcmFiaWMgPSAweDA2NDU7CiAgdC5tZWVtZmluYWxhcmFiaWMgPSAweGZlZTI7CiAgdC5tZWVtaW5pdGlhbGFyYWJpYyA9IDB4ZmVlMzsKICB0Lm1lZW1tZWRpYWxhcmFiaWMgPSAweGZlZTQ7CiAgdC5tZWVtbWVlbWluaXRpYWxhcmFiaWMgPSAweGZjZDE7CiAgdC5tZWVtbWVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzQ4OwogIHQubWVldG9ydXNxdWFyZSA9IDB4MzM0ZDsKICB0Lm1laGlyYWdhbmEgPSAweDMwODE7CiAgdC5tZWl6aWVyYXNxdWFyZSA9IDB4MzM3ZTsKICB0Lm1la2F0YWthbmEgPSAweDMwZTE7CiAgdC5tZWthdGFrYW5haGFsZndpZHRoID0gMHhmZjkyOwogIHQubWVtID0gMHgwNWRlOwogIHQubWVtZGFnZXNoID0gMHhmYjNlOwogIHQubWVtZGFnZXNoaGVicmV3ID0gMHhmYjNlOwogIHQubWVtaGVicmV3ID0gMHgwNWRlOwogIHQubWVuYXJtZW5pYW4gPSAweDA1NzQ7CiAgdC5tZXJraGFoZWJyZXcgPSAweDA1YTU7CiAgdC5tZXJraGFrZWZ1bGFoZWJyZXcgPSAweDA1YTY7CiAgdC5tZXJraGFrZWZ1bGFsZWZ0aGVicmV3ID0gMHgwNWE2OwogIHQubWVya2hhbGVmdGhlYnJldyA9IDB4MDVhNTsKICB0Lm1ob29rID0gMHgwMjcxOwogIHQubWh6c3F1YXJlID0gMHgzMzkyOwogIHQubWlkZGxlZG90a2F0YWthbmFoYWxmd2lkdGggPSAweGZmNjU7CiAgdC5taWRkb3QgPSAweDAwYjc7CiAgdC5taWV1bWFjaXJjbGVrb3JlYW4gPSAweDMyNzI7CiAgdC5taWV1bWFwYXJlbmtvcmVhbiA9IDB4MzIxMjsKICB0Lm1pZXVtY2lyY2xla29yZWFuID0gMHgzMjY0OwogIHQubWlldW1rb3JlYW4gPSAweDMxNDE7CiAgdC5taWV1bXBhbnNpb3Nrb3JlYW4gPSAweDMxNzA7CiAgdC5taWV1bXBhcmVua29yZWFuID0gMHgzMjA0OwogIHQubWlldW1waWV1cGtvcmVhbiA9IDB4MzE2ZTsKICB0Lm1pZXVtc2lvc2tvcmVhbiA9IDB4MzE2ZjsKICB0Lm1paGlyYWdhbmEgPSAweDMwN2Y7CiAgdC5taWthdGFrYW5hID0gMHgzMGRmOwogIHQubWlrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY5MDsKICB0Lm1pbnVzID0gMHgyMjEyOwogIHQubWludXNiZWxvd2NtYiA9IDB4MDMyMDsKICB0Lm1pbnVzY2lyY2xlID0gMHgyMjk2OwogIHQubWludXNtb2QgPSAweDAyZDc7CiAgdC5taW51c3BsdXMgPSAweDIyMTM7CiAgdC5taW51dGUgPSAweDIwMzI7CiAgdC5taXJpYmFhcnVzcXVhcmUgPSAweDMzNGE7CiAgdC5taXJpc3F1YXJlID0gMHgzMzQ5OwogIHQubWxvbmdsZWd0dXJuZWQgPSAweDAyNzA7CiAgdC5tbHNxdWFyZSA9IDB4MzM5NjsKICB0Lm1tY3ViZWRzcXVhcmUgPSAweDMzYTM7CiAgdC5tbW9ub3NwYWNlID0gMHhmZjRkOwogIHQubW1zcXVhcmVkc3F1YXJlID0gMHgzMzlmOwogIHQubW9oaXJhZ2FuYSA9IDB4MzA4MjsKICB0Lm1vaG1zcXVhcmUgPSAweDMzYzE7CiAgdC5tb2thdGFrYW5hID0gMHgzMGUyOwogIHQubW9rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY5MzsKICB0Lm1vbHNxdWFyZSA9IDB4MzNkNjsKICB0Lm1vbWF0aGFpID0gMHgwZTIxOwogIHQubW92ZXJzc3F1YXJlID0gMHgzM2E3OwogIHQubW92ZXJzc3F1YXJlZHNxdWFyZSA9IDB4MzNhODsKICB0Lm1wYXJlbiA9IDB4MjRhODsKICB0Lm1wYXNxdWFyZSA9IDB4MzNhYjsKICB0Lm1zc3F1YXJlID0gMHgzM2IzOwogIHQubXN1cGVyaW9yID0gMHhmNmVmOwogIHQubXR1cm5lZCA9IDB4MDI2ZjsKICB0Lm11ID0gMHgwMGI1OwogIHQubXUxID0gMHgwMGI1OwogIHQubXVhc3F1YXJlID0gMHgzMzgyOwogIHQubXVjaGdyZWF0ZXIgPSAweDIyNmI7CiAgdC5tdWNobGVzcyA9IDB4MjI2YTsKICB0Lm11ZnNxdWFyZSA9IDB4MzM4YzsKICB0Lm11Z3JlZWsgPSAweDAzYmM7CiAgdC5tdWdzcXVhcmUgPSAweDMzOGQ7CiAgdC5tdWhpcmFnYW5hID0gMHgzMDgwOwogIHQubXVrYXRha2FuYSA9IDB4MzBlMDsKICB0Lm11a2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTE7CiAgdC5tdWxzcXVhcmUgPSAweDMzOTU7CiAgdC5tdWx0aXBseSA9IDB4MDBkNzsKICB0Lm11bXNxdWFyZSA9IDB4MzM5YjsKICB0Lm11bmFoaGVicmV3ID0gMHgwNWEzOwogIHQubXVuYWhsZWZ0aGVicmV3ID0gMHgwNWEzOwogIHQubXVzaWNhbG5vdGUgPSAweDI2NmE7CiAgdC5tdXNpY2Fsbm90ZWRibCA9IDB4MjY2YjsKICB0Lm11c2ljZmxhdHNpZ24gPSAweDI2NmQ7CiAgdC5tdXNpY3NoYXJwc2lnbiA9IDB4MjY2ZjsKICB0Lm11c3NxdWFyZSA9IDB4MzNiMjsKICB0Lm11dnNxdWFyZSA9IDB4MzNiNjsKICB0Lm11d3NxdWFyZSA9IDB4MzNiYzsKICB0Lm12bWVnYXNxdWFyZSA9IDB4MzNiOTsKICB0Lm12c3F1YXJlID0gMHgzM2I3OwogIHQubXdtZWdhc3F1YXJlID0gMHgzM2JmOwogIHQubXdzcXVhcmUgPSAweDMzYmQ7CiAgdC5uID0gMHgwMDZlOwogIHQubmFiZW5nYWxpID0gMHgwOWE4OwogIHQubmFibGEgPSAweDIyMDc7CiAgdC5uYWN1dGUgPSAweDAxNDQ7CiAgdC5uYWRldmEgPSAweDA5Mjg7CiAgdC5uYWd1amFyYXRpID0gMHgwYWE4OwogIHQubmFndXJtdWtoaSA9IDB4MGEyODsKICB0Lm5haGlyYWdhbmEgPSAweDMwNmE7CiAgdC5uYWthdGFrYW5hID0gMHgzMGNhOwogIHQubmFrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4NTsKICB0Lm5hcG9zdHJvcGhlID0gMHgwMTQ5OwogIHQubmFzcXVhcmUgPSAweDMzODE7CiAgdC5uYm9wb21vZm8gPSAweDMxMGI7CiAgdC5uYnNwYWNlID0gMHgwMGEwOwogIHQubmNhcm9uID0gMHgwMTQ4OwogIHQubmNlZGlsbGEgPSAweDAxNDY7CiAgdC5uY2lyY2xlID0gMHgyNGRkOwogIHQubmNpcmN1bWZsZXhiZWxvdyA9IDB4MWU0YjsKICB0Lm5jb21tYWFjY2VudCA9IDB4MDE0NjsKICB0Lm5kb3RhY2NlbnQgPSAweDFlNDU7CiAgdC5uZG90YmVsb3cgPSAweDFlNDc7CiAgdC5uZWhpcmFnYW5hID0gMHgzMDZkOwogIHQubmVrYXRha2FuYSA9IDB4MzBjZDsKICB0Lm5la2F0YWthbmFoYWxmd2lkdGggPSAweGZmODg7CiAgdC5uZXdzaGVxZWxzaWduID0gMHgyMGFhOwogIHQubmZzcXVhcmUgPSAweDMzOGI7CiAgdC5uZ2FiZW5nYWxpID0gMHgwOTk5OwogIHQubmdhZGV2YSA9IDB4MDkxOTsKICB0Lm5nYWd1amFyYXRpID0gMHgwYTk5OwogIHQubmdhZ3VybXVraGkgPSAweDBhMTk7CiAgdC5uZ29uZ3V0aGFpID0gMHgwZTA3OwogIHQubmhpcmFnYW5hID0gMHgzMDkzOwogIHQubmhvb2tsZWZ0ID0gMHgwMjcyOwogIHQubmhvb2tyZXRyb2ZsZXggPSAweDAyNzM7CiAgdC5uaWV1bmFjaXJjbGVrb3JlYW4gPSAweDMyNmY7CiAgdC5uaWV1bmFwYXJlbmtvcmVhbiA9IDB4MzIwZjsKICB0Lm5pZXVuY2lldWNrb3JlYW4gPSAweDMxMzU7CiAgdC5uaWV1bmNpcmNsZWtvcmVhbiA9IDB4MzI2MTsKICB0Lm5pZXVuaGlldWhrb3JlYW4gPSAweDMxMzY7CiAgdC5uaWV1bmtvcmVhbiA9IDB4MzEzNDsKICB0Lm5pZXVucGFuc2lvc2tvcmVhbiA9IDB4MzE2ODsKICB0Lm5pZXVucGFyZW5rb3JlYW4gPSAweDMyMDE7CiAgdC5uaWV1bnNpb3Nrb3JlYW4gPSAweDMxNjc7CiAgdC5uaWV1bnRpa2V1dGtvcmVhbiA9IDB4MzE2NjsKICB0Lm5paGlyYWdhbmEgPSAweDMwNmI7CiAgdC5uaWthdGFrYW5hID0gMHgzMGNiOwogIHQubmlrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4NjsKICB0Lm5pa2hhaGl0bGVmdHRoYWkgPSAweGY4OTk7CiAgdC5uaWtoYWhpdHRoYWkgPSAweDBlNGQ7CiAgdC5uaW5lID0gMHgwMDM5OwogIHQubmluZWFyYWJpYyA9IDB4MDY2OTsKICB0Lm5pbmViZW5nYWxpID0gMHgwOWVmOwogIHQubmluZWNpcmNsZSA9IDB4MjQ2ODsKICB0Lm5pbmVjaXJjbGVpbnZlcnNlc2Fuc3NlcmlmID0gMHgyNzkyOwogIHQubmluZWRldmEgPSAweDA5NmY7CiAgdC5uaW5lZ3VqYXJhdGkgPSAweDBhZWY7CiAgdC5uaW5lZ3VybXVraGkgPSAweDBhNmY7CiAgdC5uaW5laGFja2FyYWJpYyA9IDB4MDY2OTsKICB0Lm5pbmVoYW5nemhvdSA9IDB4MzAyOTsKICB0Lm5pbmVpZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjI4OwogIHQubmluZWluZmVyaW9yID0gMHgyMDg5OwogIHQubmluZW1vbm9zcGFjZSA9IDB4ZmYxOTsKICB0Lm5pbmVvbGRzdHlsZSA9IDB4ZjczOTsKICB0Lm5pbmVwYXJlbiA9IDB4MjQ3YzsKICB0Lm5pbmVwZXJpb2QgPSAweDI0OTA7CiAgdC5uaW5lcGVyc2lhbiA9IDB4MDZmOTsKICB0Lm5pbmVyb21hbiA9IDB4MjE3ODsKICB0Lm5pbmVzdXBlcmlvciA9IDB4MjA3OTsKICB0Lm5pbmV0ZWVuY2lyY2xlID0gMHgyNDcyOwogIHQubmluZXRlZW5wYXJlbiA9IDB4MjQ4NjsKICB0Lm5pbmV0ZWVucGVyaW9kID0gMHgyNDlhOwogIHQubmluZXRoYWkgPSAweDBlNTk7CiAgdC5uaiA9IDB4MDFjYzsKICB0Lm5qZWN5cmlsbGljID0gMHgwNDVhOwogIHQubmthdGFrYW5hID0gMHgzMGYzOwogIHQubmthdGFrYW5haGFsZndpZHRoID0gMHhmZjlkOwogIHQubmxlZ3JpZ2h0bG9uZyA9IDB4MDE5ZTsKICB0Lm5saW5lYmVsb3cgPSAweDFlNDk7CiAgdC5ubW9ub3NwYWNlID0gMHhmZjRlOwogIHQubm1zcXVhcmUgPSAweDMzOWE7CiAgdC5ubmFiZW5nYWxpID0gMHgwOWEzOwogIHQubm5hZGV2YSA9IDB4MDkyMzsKICB0Lm5uYWd1amFyYXRpID0gMHgwYWEzOwogIHQubm5hZ3VybXVraGkgPSAweDBhMjM7CiAgdC5ubm5hZGV2YSA9IDB4MDkyOTsKICB0Lm5vaGlyYWdhbmEgPSAweDMwNmU7CiAgdC5ub2thdGFrYW5hID0gMHgzMGNlOwogIHQubm9rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4OTsKICB0Lm5vbmJyZWFraW5nc3BhY2UgPSAweDAwYTA7CiAgdC5ub25lbnRoYWkgPSAweDBlMTM7CiAgdC5ub251dGhhaSA9IDB4MGUxOTsKICB0Lm5vb25hcmFiaWMgPSAweDA2NDY7CiAgdC5ub29uZmluYWxhcmFiaWMgPSAweGZlZTY7CiAgdC5ub29uZ2h1bm5hYXJhYmljID0gMHgwNmJhOwogIHQubm9vbmdodW5uYWZpbmFsYXJhYmljID0gMHhmYjlmOwogIHQubm9vbmluaXRpYWxhcmFiaWMgPSAweGZlZTc7CiAgdC5ub29uamVlbWluaXRpYWxhcmFiaWMgPSAweGZjZDI7CiAgdC5ub29uamVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzRiOwogIHQubm9vbm1lZGlhbGFyYWJpYyA9IDB4ZmVlODsKICB0Lm5vb25tZWVtaW5pdGlhbGFyYWJpYyA9IDB4ZmNkNTsKICB0Lm5vb25tZWVtaXNvbGF0ZWRhcmFiaWMgPSAweGZjNGU7CiAgdC5ub29ubm9vbmZpbmFsYXJhYmljID0gMHhmYzhkOwogIHQubm90Y29udGFpbnMgPSAweDIyMGM7CiAgdC5ub3RlbGVtZW50ID0gMHgyMjA5OwogIHQubm90ZWxlbWVudG9mID0gMHgyMjA5OwogIHQubm90ZXF1YWwgPSAweDIyNjA7CiAgdC5ub3RncmVhdGVyID0gMHgyMjZmOwogIHQubm90Z3JlYXRlcm5vcmVxdWFsID0gMHgyMjcxOwogIHQubm90Z3JlYXRlcm5vcmxlc3MgPSAweDIyNzk7CiAgdC5ub3RpZGVudGljYWwgPSAweDIyNjI7CiAgdC5ub3RsZXNzID0gMHgyMjZlOwogIHQubm90bGVzc25vcmVxdWFsID0gMHgyMjcwOwogIHQubm90cGFyYWxsZWwgPSAweDIyMjY7CiAgdC5ub3RwcmVjZWRlcyA9IDB4MjI4MDsKICB0Lm5vdHN1YnNldCA9IDB4MjI4NDsKICB0Lm5vdHN1Y2NlZWRzID0gMHgyMjgxOwogIHQubm90c3VwZXJzZXQgPSAweDIyODU7CiAgdC5ub3dhcm1lbmlhbiA9IDB4MDU3NjsKICB0Lm5wYXJlbiA9IDB4MjRhOTsKICB0Lm5zc3F1YXJlID0gMHgzM2IxOwogIHQubnN1cGVyaW9yID0gMHgyMDdmOwogIHQubnRpbGRlID0gMHgwMGYxOwogIHQubnUgPSAweDAzYmQ7CiAgdC5udWhpcmFnYW5hID0gMHgzMDZjOwogIHQubnVrYXRha2FuYSA9IDB4MzBjYzsKICB0Lm51a2F0YWthbmFoYWxmd2lkdGggPSAweGZmODc7CiAgdC5udWt0YWJlbmdhbGkgPSAweDA5YmM7CiAgdC5udWt0YWRldmEgPSAweDA5M2M7CiAgdC5udWt0YWd1amFyYXRpID0gMHgwYWJjOwogIHQubnVrdGFndXJtdWtoaSA9IDB4MGEzYzsKICB0Lm51bWJlcnNpZ24gPSAweDAwMjM7CiAgdC5udW1iZXJzaWdubW9ub3NwYWNlID0gMHhmZjAzOwogIHQubnVtYmVyc2lnbnNtYWxsID0gMHhmZTVmOwogIHQubnVtZXJhbHNpZ25ncmVlayA9IDB4MDM3NDsKICB0Lm51bWVyYWxzaWdubG93ZXJncmVlayA9IDB4MDM3NTsKICB0Lm51bWVybyA9IDB4MjExNjsKICB0Lm51biA9IDB4MDVlMDsKICB0Lm51bmRhZ2VzaCA9IDB4ZmI0MDsKICB0Lm51bmRhZ2VzaGhlYnJldyA9IDB4ZmI0MDsKICB0Lm51bmhlYnJldyA9IDB4MDVlMDsKICB0Lm52c3F1YXJlID0gMHgzM2I1OwogIHQubndzcXVhcmUgPSAweDMzYmI7CiAgdC5ueWFiZW5nYWxpID0gMHgwOTllOwogIHQubnlhZGV2YSA9IDB4MDkxZTsKICB0Lm55YWd1amFyYXRpID0gMHgwYTllOwogIHQubnlhZ3VybXVraGkgPSAweDBhMWU7CiAgdC5vID0gMHgwMDZmOwogIHQub2FjdXRlID0gMHgwMGYzOwogIHQub2FuZ3RoYWkgPSAweDBlMmQ7CiAgdC5vYmFycmVkID0gMHgwMjc1OwogIHQub2JhcnJlZGN5cmlsbGljID0gMHgwNGU5OwogIHQub2JhcnJlZGRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZWI7CiAgdC5vYmVuZ2FsaSA9IDB4MDk5MzsKICB0Lm9ib3BvbW9mbyA9IDB4MzExYjsKICB0Lm9icmV2ZSA9IDB4MDE0ZjsKICB0Lm9jYW5kcmFkZXZhID0gMHgwOTExOwogIHQub2NhbmRyYWd1amFyYXRpID0gMHgwYTkxOwogIHQub2NhbmRyYXZvd2Vsc2lnbmRldmEgPSAweDA5NDk7CiAgdC5vY2FuZHJhdm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhYzk7CiAgdC5vY2Fyb24gPSAweDAxZDI7CiAgdC5vY2lyY2xlID0gMHgyNGRlOwogIHQub2NpcmN1bWZsZXggPSAweDAwZjQ7CiAgdC5vY2lyY3VtZmxleGFjdXRlID0gMHgxZWQxOwogIHQub2NpcmN1bWZsZXhkb3RiZWxvdyA9IDB4MWVkOTsKICB0Lm9jaXJjdW1mbGV4Z3JhdmUgPSAweDFlZDM7CiAgdC5vY2lyY3VtZmxleGhvb2thYm92ZSA9IDB4MWVkNTsKICB0Lm9jaXJjdW1mbGV4dGlsZGUgPSAweDFlZDc7CiAgdC5vY3lyaWxsaWMgPSAweDA0M2U7CiAgdC5vZGJsYWN1dGUgPSAweDAxNTE7CiAgdC5vZGJsZ3JhdmUgPSAweDAyMGQ7CiAgdC5vZGV2YSA9IDB4MDkxMzsKICB0Lm9kaWVyZXNpcyA9IDB4MDBmNjsKICB0Lm9kaWVyZXNpc2N5cmlsbGljID0gMHgwNGU3OwogIHQub2RvdGJlbG93ID0gMHgxZWNkOwogIHQub2UgPSAweDAxNTM7CiAgdC5vZWtvcmVhbiA9IDB4MzE1YTsKICB0Lm9nb25layA9IDB4MDJkYjsKICB0Lm9nb25la2NtYiA9IDB4MDMyODsKICB0Lm9ncmF2ZSA9IDB4MDBmMjsKICB0Lm9ndWphcmF0aSA9IDB4MGE5MzsKICB0Lm9oYXJtZW5pYW4gPSAweDA1ODU7CiAgdC5vaGlyYWdhbmEgPSAweDMwNGE7CiAgdC5vaG9va2Fib3ZlID0gMHgxZWNmOwogIHQub2hvcm4gPSAweDAxYTE7CiAgdC5vaG9ybmFjdXRlID0gMHgxZWRiOwogIHQub2hvcm5kb3RiZWxvdyA9IDB4MWVlMzsKICB0Lm9ob3JuZ3JhdmUgPSAweDFlZGQ7CiAgdC5vaG9ybmhvb2thYm92ZSA9IDB4MWVkZjsKICB0Lm9ob3JudGlsZGUgPSAweDFlZTE7CiAgdC5vaHVuZ2FydW1sYXV0ID0gMHgwMTUxOwogIHQub2kgPSAweDAxYTM7CiAgdC5vaW52ZXJ0ZWRicmV2ZSA9IDB4MDIwZjsKICB0Lm9rYXRha2FuYSA9IDB4MzBhYTsKICB0Lm9rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3NTsKICB0Lm9rb3JlYW4gPSAweDMxNTc7CiAgdC5vbGVoZWJyZXcgPSAweDA1YWI7CiAgdC5vbWFjcm9uID0gMHgwMTRkOwogIHQub21hY3JvbmFjdXRlID0gMHgxZTUzOwogIHQub21hY3JvbmdyYXZlID0gMHgxZTUxOwogIHQub21kZXZhID0gMHgwOTUwOwogIHQub21lZ2EgPSAweDAzYzk7CiAgdC5vbWVnYTEgPSAweDAzZDY7CiAgdC5vbWVnYWN5cmlsbGljID0gMHgwNDYxOwogIHQub21lZ2FsYXRpbmNsb3NlZCA9IDB4MDI3NzsKICB0Lm9tZWdhcm91bmRjeXJpbGxpYyA9IDB4MDQ3YjsKICB0Lm9tZWdhdGl0bG9jeXJpbGxpYyA9IDB4MDQ3ZDsKICB0Lm9tZWdhdG9ub3MgPSAweDAzY2U7CiAgdC5vbWd1amFyYXRpID0gMHgwYWQwOwogIHQub21pY3JvbiA9IDB4MDNiZjsKICB0Lm9taWNyb250b25vcyA9IDB4MDNjYzsKICB0Lm9tb25vc3BhY2UgPSAweGZmNGY7CiAgdC5vbmUgPSAweDAwMzE7CiAgdC5vbmVhcmFiaWMgPSAweDA2NjE7CiAgdC5vbmViZW5nYWxpID0gMHgwOWU3OwogIHQub25lY2lyY2xlID0gMHgyNDYwOwogIHQub25lY2lyY2xlaW52ZXJzZXNhbnNzZXJpZiA9IDB4Mjc4YTsKICB0Lm9uZWRldmEgPSAweDA5Njc7CiAgdC5vbmVkb3RlbmxlYWRlciA9IDB4MjAyNDsKICB0Lm9uZWVpZ2h0aCA9IDB4MjE1YjsKICB0Lm9uZWZpdHRlZCA9IDB4ZjZkYzsKICB0Lm9uZWd1amFyYXRpID0gMHgwYWU3OwogIHQub25lZ3VybXVraGkgPSAweDBhNjc7CiAgdC5vbmVoYWNrYXJhYmljID0gMHgwNjYxOwogIHQub25laGFsZiA9IDB4MDBiZDsKICB0Lm9uZWhhbmd6aG91ID0gMHgzMDIxOwogIHQub25laWRlb2dyYXBoaWNwYXJlbiA9IDB4MzIyMDsKICB0Lm9uZWluZmVyaW9yID0gMHgyMDgxOwogIHQub25lbW9ub3NwYWNlID0gMHhmZjExOwogIHQub25lbnVtZXJhdG9yYmVuZ2FsaSA9IDB4MDlmNDsKICB0Lm9uZW9sZHN0eWxlID0gMHhmNzMxOwogIHQub25lcGFyZW4gPSAweDI0NzQ7CiAgdC5vbmVwZXJpb2QgPSAweDI0ODg7CiAgdC5vbmVwZXJzaWFuID0gMHgwNmYxOwogIHQub25lcXVhcnRlciA9IDB4MDBiYzsKICB0Lm9uZXJvbWFuID0gMHgyMTcwOwogIHQub25lc3VwZXJpb3IgPSAweDAwYjk7CiAgdC5vbmV0aGFpID0gMHgwZTUxOwogIHQub25ldGhpcmQgPSAweDIxNTM7CiAgdC5vb2dvbmVrID0gMHgwMWViOwogIHQub29nb25la21hY3JvbiA9IDB4MDFlZDsKICB0Lm9vZ3VybXVraGkgPSAweDBhMTM7CiAgdC5vb21hdHJhZ3VybXVraGkgPSAweDBhNGI7CiAgdC5vb3BlbiA9IDB4MDI1NDsKICB0Lm9wYXJlbiA9IDB4MjRhYTsKICB0Lm9wZW5idWxsZXQgPSAweDI1ZTY7CiAgdC5vcHRpb24gPSAweDIzMjU7CiAgdC5vcmRmZW1pbmluZSA9IDB4MDBhYTsKICB0Lm9yZG1hc2N1bGluZSA9IDB4MDBiYTsKICB0Lm9ydGhvZ29uYWwgPSAweDIyMWY7CiAgdC5vc2hvcnRkZXZhID0gMHgwOTEyOwogIHQub3Nob3J0dm93ZWxzaWduZGV2YSA9IDB4MDk0YTsKICB0Lm9zbGFzaCA9IDB4MDBmODsKICB0Lm9zbGFzaGFjdXRlID0gMHgwMWZmOwogIHQub3NtYWxsaGlyYWdhbmEgPSAweDMwNDk7CiAgdC5vc21hbGxrYXRha2FuYSA9IDB4MzBhOTsKICB0Lm9zbWFsbGthdGFrYW5haGFsZndpZHRoID0gMHhmZjZiOwogIHQub3N0cm9rZWFjdXRlID0gMHgwMWZmOwogIHQub3N1cGVyaW9yID0gMHhmNmYwOwogIHQub3RjeXJpbGxpYyA9IDB4MDQ3ZjsKICB0Lm90aWxkZSA9IDB4MDBmNTsKICB0Lm90aWxkZWFjdXRlID0gMHgxZTRkOwogIHQub3RpbGRlZGllcmVzaXMgPSAweDFlNGY7CiAgdC5vdWJvcG9tb2ZvID0gMHgzMTIxOwogIHQub3ZlcmxpbmUgPSAweDIwM2U7CiAgdC5vdmVybGluZWNlbnRlcmxpbmUgPSAweGZlNGE7CiAgdC5vdmVybGluZWNtYiA9IDB4MDMwNTsKICB0Lm92ZXJsaW5lZGFzaGVkID0gMHhmZTQ5OwogIHQub3ZlcmxpbmVkYmx3YXZ5ID0gMHhmZTRjOwogIHQub3ZlcmxpbmV3YXZ5ID0gMHhmZTRiOwogIHQub3ZlcnNjb3JlID0gMHgwMGFmOwogIHQub3Zvd2Vsc2lnbmJlbmdhbGkgPSAweDA5Y2I7CiAgdC5vdm93ZWxzaWduZGV2YSA9IDB4MDk0YjsKICB0Lm92b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjYjsKICB0LnAgPSAweDAwNzA7CiAgdC5wYWFtcHNzcXVhcmUgPSAweDMzODA7CiAgdC5wYWFzZW50b3NxdWFyZSA9IDB4MzMyYjsKICB0LnBhYmVuZ2FsaSA9IDB4MDlhYTsKICB0LnBhY3V0ZSA9IDB4MWU1NTsKICB0LnBhZGV2YSA9IDB4MDkyYTsKICB0LnBhZ2Vkb3duID0gMHgyMWRmOwogIHQucGFnZXVwID0gMHgyMWRlOwogIHQucGFndWphcmF0aSA9IDB4MGFhYTsKICB0LnBhZ3VybXVraGkgPSAweDBhMmE7CiAgdC5wYWhpcmFnYW5hID0gMHgzMDcxOwogIHQucGFpeWFubm9pdGhhaSA9IDB4MGUyZjsKICB0LnBha2F0YWthbmEgPSAweDMwZDE7CiAgdC5wYWxhdGFsaXphdGlvbmN5cmlsbGljY21iID0gMHgwNDg0OwogIHQucGFsb2Noa2FjeXJpbGxpYyA9IDB4MDRjMDsKICB0LnBhbnNpb3Nrb3JlYW4gPSAweDMxN2Y7CiAgdC5wYXJhZ3JhcGggPSAweDAwYjY7CiAgdC5wYXJhbGxlbCA9IDB4MjIyNTsKICB0LnBhcmVubGVmdCA9IDB4MDAyODsKICB0LnBhcmVubGVmdGFsdG9uZWFyYWJpYyA9IDB4ZmQzZTsKICB0LnBhcmVubGVmdGJ0ID0gMHhmOGVkOwogIHQucGFyZW5sZWZ0ZXggPSAweGY4ZWM7CiAgdC5wYXJlbmxlZnRpbmZlcmlvciA9IDB4MjA4ZDsKICB0LnBhcmVubGVmdG1vbm9zcGFjZSA9IDB4ZmYwODsKICB0LnBhcmVubGVmdHNtYWxsID0gMHhmZTU5OwogIHQucGFyZW5sZWZ0c3VwZXJpb3IgPSAweDIwN2Q7CiAgdC5wYXJlbmxlZnR0cCA9IDB4ZjhlYjsKICB0LnBhcmVubGVmdHZlcnRpY2FsID0gMHhmZTM1OwogIHQucGFyZW5yaWdodCA9IDB4MDAyOTsKICB0LnBhcmVucmlnaHRhbHRvbmVhcmFiaWMgPSAweGZkM2Y7CiAgdC5wYXJlbnJpZ2h0YnQgPSAweGY4Zjg7CiAgdC5wYXJlbnJpZ2h0ZXggPSAweGY4Zjc7CiAgdC5wYXJlbnJpZ2h0aW5mZXJpb3IgPSAweDIwOGU7CiAgdC5wYXJlbnJpZ2h0bW9ub3NwYWNlID0gMHhmZjA5OwogIHQucGFyZW5yaWdodHNtYWxsID0gMHhmZTVhOwogIHQucGFyZW5yaWdodHN1cGVyaW9yID0gMHgyMDdlOwogIHQucGFyZW5yaWdodHRwID0gMHhmOGY2OwogIHQucGFyZW5yaWdodHZlcnRpY2FsID0gMHhmZTM2OwogIHQucGFydGlhbGRpZmYgPSAweDIyMDI7CiAgdC5wYXNlcWhlYnJldyA9IDB4MDVjMDsKICB0LnBhc2h0YWhlYnJldyA9IDB4MDU5OTsKICB0LnBhc3F1YXJlID0gMHgzM2E5OwogIHQucGF0YWggPSAweDA1Yjc7CiAgdC5wYXRhaDExID0gMHgwNWI3OwogIHQucGF0YWgxZCA9IDB4MDViNzsKICB0LnBhdGFoMmEgPSAweDA1Yjc7CiAgdC5wYXRhaGhlYnJldyA9IDB4MDViNzsKICB0LnBhdGFobmFycm93aGVicmV3ID0gMHgwNWI3OwogIHQucGF0YWhxdWFydGVyaGVicmV3ID0gMHgwNWI3OwogIHQucGF0YWh3aWRlaGVicmV3ID0gMHgwNWI3OwogIHQucGF6ZXJoZWJyZXcgPSAweDA1YTE7CiAgdC5wYm9wb21vZm8gPSAweDMxMDY7CiAgdC5wY2lyY2xlID0gMHgyNGRmOwogIHQucGRvdGFjY2VudCA9IDB4MWU1NzsKICB0LnBlID0gMHgwNWU0OwogIHQucGVjeXJpbGxpYyA9IDB4MDQzZjsKICB0LnBlZGFnZXNoID0gMHhmYjQ0OwogIHQucGVkYWdlc2hoZWJyZXcgPSAweGZiNDQ7CiAgdC5wZWV6aXNxdWFyZSA9IDB4MzMzYjsKICB0LnBlZmluYWxkYWdlc2hoZWJyZXcgPSAweGZiNDM7CiAgdC5wZWhhcmFiaWMgPSAweDA2N2U7CiAgdC5wZWhhcm1lbmlhbiA9IDB4MDU3YTsKICB0LnBlaGVicmV3ID0gMHgwNWU0OwogIHQucGVoZmluYWxhcmFiaWMgPSAweGZiNTc7CiAgdC5wZWhpbml0aWFsYXJhYmljID0gMHhmYjU4OwogIHQucGVoaXJhZ2FuYSA9IDB4MzA3YTsKICB0LnBlaG1lZGlhbGFyYWJpYyA9IDB4ZmI1OTsKICB0LnBla2F0YWthbmEgPSAweDMwZGE7CiAgdC5wZW1pZGRsZWhvb2tjeXJpbGxpYyA9IDB4MDRhNzsKICB0LnBlcmFmZWhlYnJldyA9IDB4ZmI0ZTsKICB0LnBlcmNlbnQgPSAweDAwMjU7CiAgdC5wZXJjZW50YXJhYmljID0gMHgwNjZhOwogIHQucGVyY2VudG1vbm9zcGFjZSA9IDB4ZmYwNTsKICB0LnBlcmNlbnRzbWFsbCA9IDB4ZmU2YTsKICB0LnBlcmlvZCA9IDB4MDAyZTsKICB0LnBlcmlvZGFybWVuaWFuID0gMHgwNTg5OwogIHQucGVyaW9kY2VudGVyZWQgPSAweDAwYjc7CiAgdC5wZXJpb2RoYWxmd2lkdGggPSAweGZmNjE7CiAgdC5wZXJpb2RpbmZlcmlvciA9IDB4ZjZlNzsKICB0LnBlcmlvZG1vbm9zcGFjZSA9IDB4ZmYwZTsKICB0LnBlcmlvZHNtYWxsID0gMHhmZTUyOwogIHQucGVyaW9kc3VwZXJpb3IgPSAweGY2ZTg7CiAgdC5wZXJpc3BvbWVuaWdyZWVrY21iID0gMHgwMzQyOwogIHQucGVycGVuZGljdWxhciA9IDB4MjJhNTsKICB0LnBlcnRob3VzYW5kID0gMHgyMDMwOwogIHQucGVzZXRhID0gMHgyMGE3OwogIHQucGZzcXVhcmUgPSAweDMzOGE7CiAgdC5waGFiZW5nYWxpID0gMHgwOWFiOwogIHQucGhhZGV2YSA9IDB4MDkyYjsKICB0LnBoYWd1amFyYXRpID0gMHgwYWFiOwogIHQucGhhZ3VybXVraGkgPSAweDBhMmI7CiAgdC5waGkgPSAweDAzYzY7CiAgdC5waGkxID0gMHgwM2Q1OwogIHQucGhpZXVwaGFjaXJjbGVrb3JlYW4gPSAweDMyN2E7CiAgdC5waGlldXBoYXBhcmVua29yZWFuID0gMHgzMjFhOwogIHQucGhpZXVwaGNpcmNsZWtvcmVhbiA9IDB4MzI2YzsKICB0LnBoaWV1cGhrb3JlYW4gPSAweDMxNGQ7CiAgdC5waGlldXBocGFyZW5rb3JlYW4gPSAweDMyMGM7CiAgdC5waGlsYXRpbiA9IDB4MDI3ODsKICB0LnBoaW50aHV0aGFpID0gMHgwZTNhOwogIHQucGhpc3ltYm9sZ3JlZWsgPSAweDAzZDU7CiAgdC5waG9vayA9IDB4MDFhNTsKICB0LnBob3BoYW50aGFpID0gMHgwZTFlOwogIHQucGhvcGh1bmd0aGFpID0gMHgwZTFjOwogIHQucGhvc2FtcGhhb3RoYWkgPSAweDBlMjA7CiAgdC5waSA9IDB4MDNjMDsKICB0LnBpZXVwYWNpcmNsZWtvcmVhbiA9IDB4MzI3MzsKICB0LnBpZXVwYXBhcmVua29yZWFuID0gMHgzMjEzOwogIHQucGlldXBjaWV1Y2tvcmVhbiA9IDB4MzE3NjsKICB0LnBpZXVwY2lyY2xla29yZWFuID0gMHgzMjY1OwogIHQucGlldXBraXllb2trb3JlYW4gPSAweDMxNzI7CiAgdC5waWV1cGtvcmVhbiA9IDB4MzE0MjsKICB0LnBpZXVwcGFyZW5rb3JlYW4gPSAweDMyMDU7CiAgdC5waWV1cHNpb3NraXllb2trb3JlYW4gPSAweDMxNzQ7CiAgdC5waWV1cHNpb3Nrb3JlYW4gPSAweDMxNDQ7CiAgdC5waWV1cHNpb3N0aWtldXRrb3JlYW4gPSAweDMxNzU7CiAgdC5waWV1cHRoaWV1dGhrb3JlYW4gPSAweDMxNzc7CiAgdC5waWV1cHRpa2V1dGtvcmVhbiA9IDB4MzE3MzsKICB0LnBpaGlyYWdhbmEgPSAweDMwNzQ7CiAgdC5waWthdGFrYW5hID0gMHgzMGQ0OwogIHQucGlzeW1ib2xncmVlayA9IDB4MDNkNjsKICB0LnBpd3Jhcm1lbmlhbiA9IDB4MDU4MzsKICB0LnBsYW5ja292ZXIycGkgPSAweDIxMGY7CiAgdC5wbGFuY2tvdmVyMnBpMSA9IDB4MjEwZjsKICB0LnBsdXMgPSAweDAwMmI7CiAgdC5wbHVzYmVsb3djbWIgPSAweDAzMWY7CiAgdC5wbHVzY2lyY2xlID0gMHgyMjk1OwogIHQucGx1c21pbnVzID0gMHgwMGIxOwogIHQucGx1c21vZCA9IDB4MDJkNjsKICB0LnBsdXNtb25vc3BhY2UgPSAweGZmMGI7CiAgdC5wbHVzc21hbGwgPSAweGZlNjI7CiAgdC5wbHVzc3VwZXJpb3IgPSAweDIwN2E7CiAgdC5wbW9ub3NwYWNlID0gMHhmZjUwOwogIHQucG1zcXVhcmUgPSAweDMzZDg7CiAgdC5wb2hpcmFnYW5hID0gMHgzMDdkOwogIHQucG9pbnRpbmdpbmRleGRvd253aGl0ZSA9IDB4MjYxZjsKICB0LnBvaW50aW5naW5kZXhsZWZ0d2hpdGUgPSAweDI2MWM7CiAgdC5wb2ludGluZ2luZGV4cmlnaHR3aGl0ZSA9IDB4MjYxZTsKICB0LnBvaW50aW5naW5kZXh1cHdoaXRlID0gMHgyNjFkOwogIHQucG9rYXRha2FuYSA9IDB4MzBkZDsKICB0LnBvcGxhdGhhaSA9IDB4MGUxYjsKICB0LnBvc3RhbG1hcmsgPSAweDMwMTI7CiAgdC5wb3N0YWxtYXJrZmFjZSA9IDB4MzAyMDsKICB0LnBwYXJlbiA9IDB4MjRhYjsKICB0LnByZWNlZGVzID0gMHgyMjdhOwogIHQucHJlc2NyaXB0aW9uID0gMHgyMTFlOwogIHQucHJpbWVtb2QgPSAweDAyYjk7CiAgdC5wcmltZXJldmVyc2VkID0gMHgyMDM1OwogIHQucHJvZHVjdCA9IDB4MjIwZjsKICB0LnByb2plY3RpdmUgPSAweDIzMDU7CiAgdC5wcm9sb25nZWRrYW5hID0gMHgzMGZjOwogIHQucHJvcGVsbG9yID0gMHgyMzE4OwogIHQucHJvcGVyc3Vic2V0ID0gMHgyMjgyOwogIHQucHJvcGVyc3VwZXJzZXQgPSAweDIyODM7CiAgdC5wcm9wb3J0aW9uID0gMHgyMjM3OwogIHQucHJvcG9ydGlvbmFsID0gMHgyMjFkOwogIHQucHNpID0gMHgwM2M4OwogIHQucHNpY3lyaWxsaWMgPSAweDA0NzE7CiAgdC5wc2lsaXBuZXVtYXRhY3lyaWxsaWNjbWIgPSAweDA0ODY7CiAgdC5wc3NxdWFyZSA9IDB4MzNiMDsKICB0LnB1aGlyYWdhbmEgPSAweDMwNzc7CiAgdC5wdWthdGFrYW5hID0gMHgzMGQ3OwogIHQucHZzcXVhcmUgPSAweDMzYjQ7CiAgdC5wd3NxdWFyZSA9IDB4MzNiYTsKICB0LnEgPSAweDAwNzE7CiAgdC5xYWRldmEgPSAweDA5NTg7CiAgdC5xYWRtYWhlYnJldyA9IDB4MDVhODsKICB0LnFhZmFyYWJpYyA9IDB4MDY0MjsKICB0LnFhZmZpbmFsYXJhYmljID0gMHhmZWQ2OwogIHQucWFmaW5pdGlhbGFyYWJpYyA9IDB4ZmVkNzsKICB0LnFhZm1lZGlhbGFyYWJpYyA9IDB4ZmVkODsKICB0LnFhbWF0cyA9IDB4MDViODsKICB0LnFhbWF0czEwID0gMHgwNWI4OwogIHQucWFtYXRzMWEgPSAweDA1Yjg7CiAgdC5xYW1hdHMxYyA9IDB4MDViODsKICB0LnFhbWF0czI3ID0gMHgwNWI4OwogIHQucWFtYXRzMjkgPSAweDA1Yjg7CiAgdC5xYW1hdHMzMyA9IDB4MDViODsKICB0LnFhbWF0c2RlID0gMHgwNWI4OwogIHQucWFtYXRzaGVicmV3ID0gMHgwNWI4OwogIHQucWFtYXRzbmFycm93aGVicmV3ID0gMHgwNWI4OwogIHQucWFtYXRzcWF0YW5oZWJyZXcgPSAweDA1Yjg7CiAgdC5xYW1hdHNxYXRhbm5hcnJvd2hlYnJldyA9IDB4MDViODsKICB0LnFhbWF0c3FhdGFucXVhcnRlcmhlYnJldyA9IDB4MDViODsKICB0LnFhbWF0c3FhdGFud2lkZWhlYnJldyA9IDB4MDViODsKICB0LnFhbWF0c3F1YXJ0ZXJoZWJyZXcgPSAweDA1Yjg7CiAgdC5xYW1hdHN3aWRlaGVicmV3ID0gMHgwNWI4OwogIHQucWFybmV5cGFyYWhlYnJldyA9IDB4MDU5ZjsKICB0LnFib3BvbW9mbyA9IDB4MzExMTsKICB0LnFjaXJjbGUgPSAweDI0ZTA7CiAgdC5xaG9vayA9IDB4MDJhMDsKICB0LnFtb25vc3BhY2UgPSAweGZmNTE7CiAgdC5xb2YgPSAweDA1ZTc7CiAgdC5xb2ZkYWdlc2ggPSAweGZiNDc7CiAgdC5xb2ZkYWdlc2hoZWJyZXcgPSAweGZiNDc7CiAgdC5xb2ZoZWJyZXcgPSAweDA1ZTc7CiAgdC5xcGFyZW4gPSAweDI0YWM7CiAgdC5xdWFydGVybm90ZSA9IDB4MjY2OTsKICB0LnF1YnV0cyA9IDB4MDViYjsKICB0LnF1YnV0czE4ID0gMHgwNWJiOwogIHQucXVidXRzMjUgPSAweDA1YmI7CiAgdC5xdWJ1dHMzMSA9IDB4MDViYjsKICB0LnF1YnV0c2hlYnJldyA9IDB4MDViYjsKICB0LnF1YnV0c25hcnJvd2hlYnJldyA9IDB4MDViYjsKICB0LnF1YnV0c3F1YXJ0ZXJoZWJyZXcgPSAweDA1YmI7CiAgdC5xdWJ1dHN3aWRlaGVicmV3ID0gMHgwNWJiOwogIHQucXVlc3Rpb24gPSAweDAwM2Y7CiAgdC5xdWVzdGlvbmFyYWJpYyA9IDB4MDYxZjsKICB0LnF1ZXN0aW9uYXJtZW5pYW4gPSAweDA1NWU7CiAgdC5xdWVzdGlvbmRvd24gPSAweDAwYmY7CiAgdC5xdWVzdGlvbmRvd25zbWFsbCA9IDB4ZjdiZjsKICB0LnF1ZXN0aW9uZ3JlZWsgPSAweDAzN2U7CiAgdC5xdWVzdGlvbm1vbm9zcGFjZSA9IDB4ZmYxZjsKICB0LnF1ZXN0aW9uc21hbGwgPSAweGY3M2Y7CiAgdC5xdW90ZWRibCA9IDB4MDAyMjsKICB0LnF1b3RlZGJsYmFzZSA9IDB4MjAxZTsKICB0LnF1b3RlZGJsbGVmdCA9IDB4MjAxYzsKICB0LnF1b3RlZGJsbW9ub3NwYWNlID0gMHhmZjAyOwogIHQucXVvdGVkYmxwcmltZSA9IDB4MzAxZTsKICB0LnF1b3RlZGJscHJpbWVyZXZlcnNlZCA9IDB4MzAxZDsKICB0LnF1b3RlZGJscmlnaHQgPSAweDIwMWQ7CiAgdC5xdW90ZWxlZnQgPSAweDIwMTg7CiAgdC5xdW90ZWxlZnRyZXZlcnNlZCA9IDB4MjAxYjsKICB0LnF1b3RlcmV2ZXJzZWQgPSAweDIwMWI7CiAgdC5xdW90ZXJpZ2h0ID0gMHgyMDE5OwogIHQucXVvdGVyaWdodG4gPSAweDAxNDk7CiAgdC5xdW90ZXNpbmdsYmFzZSA9IDB4MjAxYTsKICB0LnF1b3Rlc2luZ2xlID0gMHgwMDI3OwogIHQucXVvdGVzaW5nbGVtb25vc3BhY2UgPSAweGZmMDc7CiAgdC5yID0gMHgwMDcyOwogIHQucmFhcm1lbmlhbiA9IDB4MDU3YzsKICB0LnJhYmVuZ2FsaSA9IDB4MDliMDsKICB0LnJhY3V0ZSA9IDB4MDE1NTsKICB0LnJhZGV2YSA9IDB4MDkzMDsKICB0LnJhZGljYWwgPSAweDIyMWE7CiAgdC5yYWRpY2FsZXggPSAweGY4ZTU7CiAgdC5yYWRvdmVyc3NxdWFyZSA9IDB4MzNhZTsKICB0LnJhZG92ZXJzc3F1YXJlZHNxdWFyZSA9IDB4MzNhZjsKICB0LnJhZHNxdWFyZSA9IDB4MzNhZDsKICB0LnJhZmUgPSAweDA1YmY7CiAgdC5yYWZlaGVicmV3ID0gMHgwNWJmOwogIHQucmFndWphcmF0aSA9IDB4MGFiMDsKICB0LnJhZ3VybXVraGkgPSAweDBhMzA7CiAgdC5yYWhpcmFnYW5hID0gMHgzMDg5OwogIHQucmFrYXRha2FuYSA9IDB4MzBlOTsKICB0LnJha2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTc7CiAgdC5yYWxvd2VyZGlhZ29uYWxiZW5nYWxpID0gMHgwOWYxOwogIHQucmFtaWRkbGVkaWFnb25hbGJlbmdhbGkgPSAweDA5ZjA7CiAgdC5yYW1zaG9ybiA9IDB4MDI2NDsKICB0LnJhdGlvID0gMHgyMjM2OwogIHQucmJvcG9tb2ZvID0gMHgzMTE2OwogIHQucmNhcm9uID0gMHgwMTU5OwogIHQucmNlZGlsbGEgPSAweDAxNTc7CiAgdC5yY2lyY2xlID0gMHgyNGUxOwogIHQucmNvbW1hYWNjZW50ID0gMHgwMTU3OwogIHQucmRibGdyYXZlID0gMHgwMjExOwogIHQucmRvdGFjY2VudCA9IDB4MWU1OTsKICB0LnJkb3RiZWxvdyA9IDB4MWU1YjsKICB0LnJkb3RiZWxvd21hY3JvbiA9IDB4MWU1ZDsKICB0LnJlZmVyZW5jZW1hcmsgPSAweDIwM2I7CiAgdC5yZWZsZXhzdWJzZXQgPSAweDIyODY7CiAgdC5yZWZsZXhzdXBlcnNldCA9IDB4MjI4NzsKICB0LnJlZ2lzdGVyZWQgPSAweDAwYWU7CiAgdC5yZWdpc3RlcnNhbnMgPSAweGY4ZTg7CiAgdC5yZWdpc3RlcnNlcmlmID0gMHhmNmRhOwogIHQucmVoYXJhYmljID0gMHgwNjMxOwogIHQucmVoYXJtZW5pYW4gPSAweDA1ODA7CiAgdC5yZWhmaW5hbGFyYWJpYyA9IDB4ZmVhZTsKICB0LnJlaGlyYWdhbmEgPSAweDMwOGM7CiAgdC5yZWthdGFrYW5hID0gMHgzMGVjOwogIHQucmVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY5YTsKICB0LnJlc2ggPSAweDA1ZTg7CiAgdC5yZXNoZGFnZXNoaGVicmV3ID0gMHhmYjQ4OwogIHQucmVzaGhlYnJldyA9IDB4MDVlODsKICB0LnJldmVyc2VkdGlsZGUgPSAweDIyM2Q7CiAgdC5yZXZpYWhlYnJldyA9IDB4MDU5NzsKICB0LnJldmlhbXVncmFzaGhlYnJldyA9IDB4MDU5NzsKICB0LnJldmxvZ2ljYWxub3QgPSAweDIzMTA7CiAgdC5yZmlzaGhvb2sgPSAweDAyN2U7CiAgdC5yZmlzaGhvb2tyZXZlcnNlZCA9IDB4MDI3ZjsKICB0LnJoYWJlbmdhbGkgPSAweDA5ZGQ7CiAgdC5yaGFkZXZhID0gMHgwOTVkOwogIHQucmhvID0gMHgwM2MxOwogIHQucmhvb2sgPSAweDAyN2Q7CiAgdC5yaG9va3R1cm5lZCA9IDB4MDI3YjsKICB0LnJob29rdHVybmVkc3VwZXJpb3IgPSAweDAyYjU7CiAgdC5yaG9zeW1ib2xncmVlayA9IDB4MDNmMTsKICB0LnJob3RpY2hvb2ttb2QgPSAweDAyZGU7CiAgdC5yaWV1bGFjaXJjbGVrb3JlYW4gPSAweDMyNzE7CiAgdC5yaWV1bGFwYXJlbmtvcmVhbiA9IDB4MzIxMTsKICB0LnJpZXVsY2lyY2xla29yZWFuID0gMHgzMjYzOwogIHQucmlldWxoaWV1aGtvcmVhbiA9IDB4MzE0MDsKICB0LnJpZXVsa2l5ZW9ra29yZWFuID0gMHgzMTNhOwogIHQucmlldWxraXllb2tzaW9za29yZWFuID0gMHgzMTY5OwogIHQucmlldWxrb3JlYW4gPSAweDMxMzk7CiAgdC5yaWV1bG1pZXVta29yZWFuID0gMHgzMTNiOwogIHQucmlldWxwYW5zaW9za29yZWFuID0gMHgzMTZjOwogIHQucmlldWxwYXJlbmtvcmVhbiA9IDB4MzIwMzsKICB0LnJpZXVscGhpZXVwaGtvcmVhbiA9IDB4MzEzZjsKICB0LnJpZXVscGlldXBrb3JlYW4gPSAweDMxM2M7CiAgdC5yaWV1bHBpZXVwc2lvc2tvcmVhbiA9IDB4MzE2YjsKICB0LnJpZXVsc2lvc2tvcmVhbiA9IDB4MzEzZDsKICB0LnJpZXVsdGhpZXV0aGtvcmVhbiA9IDB4MzEzZTsKICB0LnJpZXVsdGlrZXV0a29yZWFuID0gMHgzMTZhOwogIHQucmlldWx5ZW9yaW5oaWV1aGtvcmVhbiA9IDB4MzE2ZDsKICB0LnJpZ2h0YW5nbGUgPSAweDIyMWY7CiAgdC5yaWdodHRhY2tiZWxvd2NtYiA9IDB4MDMxOTsKICB0LnJpZ2h0dHJpYW5nbGUgPSAweDIyYmY7CiAgdC5yaWhpcmFnYW5hID0gMHgzMDhhOwogIHQucmlrYXRha2FuYSA9IDB4MzBlYTsKICB0LnJpa2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTg7CiAgdC5yaW5nID0gMHgwMmRhOwogIHQucmluZ2JlbG93Y21iID0gMHgwMzI1OwogIHQucmluZ2NtYiA9IDB4MDMwYTsKICB0LnJpbmdoYWxmbGVmdCA9IDB4MDJiZjsKICB0LnJpbmdoYWxmbGVmdGFybWVuaWFuID0gMHgwNTU5OwogIHQucmluZ2hhbGZsZWZ0YmVsb3djbWIgPSAweDAzMWM7CiAgdC5yaW5naGFsZmxlZnRjZW50ZXJlZCA9IDB4MDJkMzsKICB0LnJpbmdoYWxmcmlnaHQgPSAweDAyYmU7CiAgdC5yaW5naGFsZnJpZ2h0YmVsb3djbWIgPSAweDAzMzk7CiAgdC5yaW5naGFsZnJpZ2h0Y2VudGVyZWQgPSAweDAyZDI7CiAgdC5yaW52ZXJ0ZWRicmV2ZSA9IDB4MDIxMzsKICB0LnJpdHRvcnVzcXVhcmUgPSAweDMzNTE7CiAgdC5ybGluZWJlbG93ID0gMHgxZTVmOwogIHQucmxvbmdsZWcgPSAweDAyN2M7CiAgdC5ybG9uZ2xlZ3R1cm5lZCA9IDB4MDI3YTsKICB0LnJtb25vc3BhY2UgPSAweGZmNTI7CiAgdC5yb2hpcmFnYW5hID0gMHgzMDhkOwogIHQucm9rYXRha2FuYSA9IDB4MzBlZDsKICB0LnJva2F0YWthbmFoYWxmd2lkdGggPSAweGZmOWI7CiAgdC5yb3J1YXRoYWkgPSAweDBlMjM7CiAgdC5ycGFyZW4gPSAweDI0YWQ7CiAgdC5ycmFiZW5nYWxpID0gMHgwOWRjOwogIHQucnJhZGV2YSA9IDB4MDkzMTsKICB0LnJyYWd1cm11a2hpID0gMHgwYTVjOwogIHQucnJlaGFyYWJpYyA9IDB4MDY5MTsKICB0LnJyZWhmaW5hbGFyYWJpYyA9IDB4ZmI4ZDsKICB0LnJydm9jYWxpY2JlbmdhbGkgPSAweDA5ZTA7CiAgdC5ycnZvY2FsaWNkZXZhID0gMHgwOTYwOwogIHQucnJ2b2NhbGljZ3VqYXJhdGkgPSAweDBhZTA7CiAgdC5ycnZvY2FsaWN2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWM0OwogIHQucnJ2b2NhbGljdm93ZWxzaWduZGV2YSA9IDB4MDk0NDsKICB0LnJydm9jYWxpY3Zvd2Vsc2lnbmd1amFyYXRpID0gMHgwYWM0OwogIHQucnN1cGVyaW9yID0gMHhmNmYxOwogIHQucnRibG9jayA9IDB4MjU5MDsKICB0LnJ0dXJuZWQgPSAweDAyNzk7CiAgdC5ydHVybmVkc3VwZXJpb3IgPSAweDAyYjQ7CiAgdC5ydWhpcmFnYW5hID0gMHgzMDhiOwogIHQucnVrYXRha2FuYSA9IDB4MzBlYjsKICB0LnJ1a2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTk7CiAgdC5ydXBlZW1hcmtiZW5nYWxpID0gMHgwOWYyOwogIHQucnVwZWVzaWduYmVuZ2FsaSA9IDB4MDlmMzsKICB0LnJ1cGlhaCA9IDB4ZjZkZDsKICB0LnJ1dGhhaSA9IDB4MGUyNDsKICB0LnJ2b2NhbGljYmVuZ2FsaSA9IDB4MDk4YjsKICB0LnJ2b2NhbGljZGV2YSA9IDB4MDkwYjsKICB0LnJ2b2NhbGljZ3VqYXJhdGkgPSAweDBhOGI7CiAgdC5ydm9jYWxpY3Zvd2Vsc2lnbmJlbmdhbGkgPSAweDA5YzM7CiAgdC5ydm9jYWxpY3Zvd2Vsc2lnbmRldmEgPSAweDA5NDM7CiAgdC5ydm9jYWxpY3Zvd2Vsc2lnbmd1amFyYXRpID0gMHgwYWMzOwogIHQucyA9IDB4MDA3MzsKICB0LnNhYmVuZ2FsaSA9IDB4MDliODsKICB0LnNhY3V0ZSA9IDB4MDE1YjsKICB0LnNhY3V0ZWRvdGFjY2VudCA9IDB4MWU2NTsKICB0LnNhZGFyYWJpYyA9IDB4MDYzNTsKICB0LnNhZGV2YSA9IDB4MDkzODsKICB0LnNhZGZpbmFsYXJhYmljID0gMHhmZWJhOwogIHQuc2FkaW5pdGlhbGFyYWJpYyA9IDB4ZmViYjsKICB0LnNhZG1lZGlhbGFyYWJpYyA9IDB4ZmViYzsKICB0LnNhZ3VqYXJhdGkgPSAweDBhYjg7CiAgdC5zYWd1cm11a2hpID0gMHgwYTM4OwogIHQuc2FoaXJhZ2FuYSA9IDB4MzA1NTsKICB0LnNha2F0YWthbmEgPSAweDMwYjU7CiAgdC5zYWthdGFrYW5haGFsZndpZHRoID0gMHhmZjdiOwogIHQuc2FsbGFsbGFob3VhbGF5aGV3YXNhbGxhbWFyYWJpYyA9IDB4ZmRmYTsKICB0LnNhbWVraCA9IDB4MDVlMTsKICB0LnNhbWVraGRhZ2VzaCA9IDB4ZmI0MTsKICB0LnNhbWVraGRhZ2VzaGhlYnJldyA9IDB4ZmI0MTsKICB0LnNhbWVraGhlYnJldyA9IDB4MDVlMTsKICB0LnNhcmFhYXRoYWkgPSAweDBlMzI7CiAgdC5zYXJhYWV0aGFpID0gMHgwZTQxOwogIHQuc2FyYWFpbWFpbWFsYWl0aGFpID0gMHgwZTQ0OwogIHQuc2FyYWFpbWFpbXVhbnRoYWkgPSAweDBlNDM7CiAgdC5zYXJhYW10aGFpID0gMHgwZTMzOwogIHQuc2FyYWF0aGFpID0gMHgwZTMwOwogIHQuc2FyYWV0aGFpID0gMHgwZTQwOwogIHQuc2FyYWlpbGVmdHRoYWkgPSAweGY4ODY7CiAgdC5zYXJhaWl0aGFpID0gMHgwZTM1OwogIHQuc2FyYWlsZWZ0dGhhaSA9IDB4Zjg4NTsKICB0LnNhcmFpdGhhaSA9IDB4MGUzNDsKICB0LnNhcmFvdGhhaSA9IDB4MGU0MjsKICB0LnNhcmF1ZWVsZWZ0dGhhaSA9IDB4Zjg4ODsKICB0LnNhcmF1ZWV0aGFpID0gMHgwZTM3OwogIHQuc2FyYXVlbGVmdHRoYWkgPSAweGY4ODc7CiAgdC5zYXJhdWV0aGFpID0gMHgwZTM2OwogIHQuc2FyYXV0aGFpID0gMHgwZTM4OwogIHQuc2FyYXV1dGhhaSA9IDB4MGUzOTsKICB0LnNib3BvbW9mbyA9IDB4MzExOTsKICB0LnNjYXJvbiA9IDB4MDE2MTsKICB0LnNjYXJvbmRvdGFjY2VudCA9IDB4MWU2NzsKICB0LnNjZWRpbGxhID0gMHgwMTVmOwogIHQuc2Nod2EgPSAweDAyNTk7CiAgdC5zY2h3YWN5cmlsbGljID0gMHgwNGQ5OwogIHQuc2Nod2FkaWVyZXNpc2N5cmlsbGljID0gMHgwNGRiOwogIHQuc2Nod2Fob29rID0gMHgwMjVhOwogIHQuc2NpcmNsZSA9IDB4MjRlMjsKICB0LnNjaXJjdW1mbGV4ID0gMHgwMTVkOwogIHQuc2NvbW1hYWNjZW50ID0gMHgwMjE5OwogIHQuc2RvdGFjY2VudCA9IDB4MWU2MTsKICB0LnNkb3RiZWxvdyA9IDB4MWU2MzsKICB0LnNkb3RiZWxvd2RvdGFjY2VudCA9IDB4MWU2OTsKICB0LnNlYWd1bGxiZWxvd2NtYiA9IDB4MDMzYzsKICB0LnNlY29uZCA9IDB4MjAzMzsKICB0LnNlY29uZHRvbmVjaGluZXNlID0gMHgwMmNhOwogIHQuc2VjdGlvbiA9IDB4MDBhNzsKICB0LnNlZW5hcmFiaWMgPSAweDA2MzM7CiAgdC5zZWVuZmluYWxhcmFiaWMgPSAweGZlYjI7CiAgdC5zZWVuaW5pdGlhbGFyYWJpYyA9IDB4ZmViMzsKICB0LnNlZW5tZWRpYWxhcmFiaWMgPSAweGZlYjQ7CiAgdC5zZWdvbCA9IDB4MDViNjsKICB0LnNlZ29sMTMgPSAweDA1YjY7CiAgdC5zZWdvbDFmID0gMHgwNWI2OwogIHQuc2Vnb2wyYyA9IDB4MDViNjsKICB0LnNlZ29saGVicmV3ID0gMHgwNWI2OwogIHQuc2Vnb2xuYXJyb3doZWJyZXcgPSAweDA1YjY7CiAgdC5zZWdvbHF1YXJ0ZXJoZWJyZXcgPSAweDA1YjY7CiAgdC5zZWdvbHRhaGVicmV3ID0gMHgwNTkyOwogIHQuc2Vnb2x3aWRlaGVicmV3ID0gMHgwNWI2OwogIHQuc2VoYXJtZW5pYW4gPSAweDA1N2Q7CiAgdC5zZWhpcmFnYW5hID0gMHgzMDViOwogIHQuc2VrYXRha2FuYSA9IDB4MzBiYjsKICB0LnNla2F0YWthbmFoYWxmd2lkdGggPSAweGZmN2U7CiAgdC5zZW1pY29sb24gPSAweDAwM2I7CiAgdC5zZW1pY29sb25hcmFiaWMgPSAweDA2MWI7CiAgdC5zZW1pY29sb25tb25vc3BhY2UgPSAweGZmMWI7CiAgdC5zZW1pY29sb25zbWFsbCA9IDB4ZmU1NDsKICB0LnNlbWl2b2ljZWRtYXJra2FuYSA9IDB4MzA5YzsKICB0LnNlbWl2b2ljZWRtYXJra2FuYWhhbGZ3aWR0aCA9IDB4ZmY5ZjsKICB0LnNlbnRpc3F1YXJlID0gMHgzMzIyOwogIHQuc2VudG9zcXVhcmUgPSAweDMzMjM7CiAgdC5zZXZlbiA9IDB4MDAzNzsKICB0LnNldmVuYXJhYmljID0gMHgwNjY3OwogIHQuc2V2ZW5iZW5nYWxpID0gMHgwOWVkOwogIHQuc2V2ZW5jaXJjbGUgPSAweDI0NjY7CiAgdC5zZXZlbmNpcmNsZWludmVyc2VzYW5zc2VyaWYgPSAweDI3OTA7CiAgdC5zZXZlbmRldmEgPSAweDA5NmQ7CiAgdC5zZXZlbmVpZ2h0aHMgPSAweDIxNWU7CiAgdC5zZXZlbmd1amFyYXRpID0gMHgwYWVkOwogIHQuc2V2ZW5ndXJtdWtoaSA9IDB4MGE2ZDsKICB0LnNldmVuaGFja2FyYWJpYyA9IDB4MDY2NzsKICB0LnNldmVuaGFuZ3pob3UgPSAweDMwMjc7CiAgdC5zZXZlbmlkZW9ncmFwaGljcGFyZW4gPSAweDMyMjY7CiAgdC5zZXZlbmluZmVyaW9yID0gMHgyMDg3OwogIHQuc2V2ZW5tb25vc3BhY2UgPSAweGZmMTc7CiAgdC5zZXZlbm9sZHN0eWxlID0gMHhmNzM3OwogIHQuc2V2ZW5wYXJlbiA9IDB4MjQ3YTsKICB0LnNldmVucGVyaW9kID0gMHgyNDhlOwogIHQuc2V2ZW5wZXJzaWFuID0gMHgwNmY3OwogIHQuc2V2ZW5yb21hbiA9IDB4MjE3NjsKICB0LnNldmVuc3VwZXJpb3IgPSAweDIwNzc7CiAgdC5zZXZlbnRlZW5jaXJjbGUgPSAweDI0NzA7CiAgdC5zZXZlbnRlZW5wYXJlbiA9IDB4MjQ4NDsKICB0LnNldmVudGVlbnBlcmlvZCA9IDB4MjQ5ODsKICB0LnNldmVudGhhaSA9IDB4MGU1NzsKICB0LnNmdGh5cGhlbiA9IDB4MDBhZDsKICB0LnNoYWFybWVuaWFuID0gMHgwNTc3OwogIHQuc2hhYmVuZ2FsaSA9IDB4MDliNjsKICB0LnNoYWN5cmlsbGljID0gMHgwNDQ4OwogIHQuc2hhZGRhYXJhYmljID0gMHgwNjUxOwogIHQuc2hhZGRhZGFtbWFhcmFiaWMgPSAweGZjNjE7CiAgdC5zaGFkZGFkYW1tYXRhbmFyYWJpYyA9IDB4ZmM1ZTsKICB0LnNoYWRkYWZhdGhhYXJhYmljID0gMHhmYzYwOwogIHQuc2hhZGRha2FzcmFhcmFiaWMgPSAweGZjNjI7CiAgdC5zaGFkZGFrYXNyYXRhbmFyYWJpYyA9IDB4ZmM1ZjsKICB0LnNoYWRlID0gMHgyNTkyOwogIHQuc2hhZGVkYXJrID0gMHgyNTkzOwogIHQuc2hhZGVsaWdodCA9IDB4MjU5MTsKICB0LnNoYWRlbWVkaXVtID0gMHgyNTkyOwogIHQuc2hhZGV2YSA9IDB4MDkzNjsKICB0LnNoYWd1amFyYXRpID0gMHgwYWI2OwogIHQuc2hhZ3VybXVraGkgPSAweDBhMzY7CiAgdC5zaGFsc2hlbGV0aGVicmV3ID0gMHgwNTkzOwogIHQuc2hib3BvbW9mbyA9IDB4MzExNTsKICB0LnNoY2hhY3lyaWxsaWMgPSAweDA0NDk7CiAgdC5zaGVlbmFyYWJpYyA9IDB4MDYzNDsKICB0LnNoZWVuZmluYWxhcmFiaWMgPSAweGZlYjY7CiAgdC5zaGVlbmluaXRpYWxhcmFiaWMgPSAweGZlYjc7CiAgdC5zaGVlbm1lZGlhbGFyYWJpYyA9IDB4ZmViODsKICB0LnNoZWljb3B0aWMgPSAweDAzZTM7CiAgdC5zaGVxZWwgPSAweDIwYWE7CiAgdC5zaGVxZWxoZWJyZXcgPSAweDIwYWE7CiAgdC5zaGV2YSA9IDB4MDViMDsKICB0LnNoZXZhMTE1ID0gMHgwNWIwOwogIHQuc2hldmExNSA9IDB4MDViMDsKICB0LnNoZXZhMjIgPSAweDA1YjA7CiAgdC5zaGV2YTJlID0gMHgwNWIwOwogIHQuc2hldmFoZWJyZXcgPSAweDA1YjA7CiAgdC5zaGV2YW5hcnJvd2hlYnJldyA9IDB4MDViMDsKICB0LnNoZXZhcXVhcnRlcmhlYnJldyA9IDB4MDViMDsKICB0LnNoZXZhd2lkZWhlYnJldyA9IDB4MDViMDsKICB0LnNoaGFjeXJpbGxpYyA9IDB4MDRiYjsKICB0LnNoaW1hY29wdGljID0gMHgwM2VkOwogIHQuc2hpbiA9IDB4MDVlOTsKICB0LnNoaW5kYWdlc2ggPSAweGZiNDk7CiAgdC5zaGluZGFnZXNoaGVicmV3ID0gMHhmYjQ5OwogIHQuc2hpbmRhZ2VzaHNoaW5kb3QgPSAweGZiMmM7CiAgdC5zaGluZGFnZXNoc2hpbmRvdGhlYnJldyA9IDB4ZmIyYzsKICB0LnNoaW5kYWdlc2hzaW5kb3QgPSAweGZiMmQ7CiAgdC5zaGluZGFnZXNoc2luZG90aGVicmV3ID0gMHhmYjJkOwogIHQuc2hpbmRvdGhlYnJldyA9IDB4MDVjMTsKICB0LnNoaW5oZWJyZXcgPSAweDA1ZTk7CiAgdC5zaGluc2hpbmRvdCA9IDB4ZmIyYTsKICB0LnNoaW5zaGluZG90aGVicmV3ID0gMHhmYjJhOwogIHQuc2hpbnNpbmRvdCA9IDB4ZmIyYjsKICB0LnNoaW5zaW5kb3RoZWJyZXcgPSAweGZiMmI7CiAgdC5zaG9vayA9IDB4MDI4MjsKICB0LnNpZ21hID0gMHgwM2MzOwogIHQuc2lnbWExID0gMHgwM2MyOwogIHQuc2lnbWFmaW5hbCA9IDB4MDNjMjsKICB0LnNpZ21hbHVuYXRlc3ltYm9sZ3JlZWsgPSAweDAzZjI7CiAgdC5zaWhpcmFnYW5hID0gMHgzMDU3OwogIHQuc2lrYXRha2FuYSA9IDB4MzBiNzsKICB0LnNpa2F0YWthbmFoYWxmd2lkdGggPSAweGZmN2M7CiAgdC5zaWx1cWhlYnJldyA9IDB4MDViZDsKICB0LnNpbHVxbGVmdGhlYnJldyA9IDB4MDViZDsKICB0LnNpbWlsYXIgPSAweDIyM2M7CiAgdC5zaW5kb3RoZWJyZXcgPSAweDA1YzI7CiAgdC5zaW9zYWNpcmNsZWtvcmVhbiA9IDB4MzI3NDsKICB0LnNpb3NhcGFyZW5rb3JlYW4gPSAweDMyMTQ7CiAgdC5zaW9zY2lldWNrb3JlYW4gPSAweDMxN2U7CiAgdC5zaW9zY2lyY2xla29yZWFuID0gMHgzMjY2OwogIHQuc2lvc2tpeWVva2tvcmVhbiA9IDB4MzE3YTsKICB0LnNpb3Nrb3JlYW4gPSAweDMxNDU7CiAgdC5zaW9zbmlldW5rb3JlYW4gPSAweDMxN2I7CiAgdC5zaW9zcGFyZW5rb3JlYW4gPSAweDMyMDY7CiAgdC5zaW9zcGlldXBrb3JlYW4gPSAweDMxN2Q7CiAgdC5zaW9zdGlrZXV0a29yZWFuID0gMHgzMTdjOwogIHQuc2l4ID0gMHgwMDM2OwogIHQuc2l4YXJhYmljID0gMHgwNjY2OwogIHQuc2l4YmVuZ2FsaSA9IDB4MDllYzsKICB0LnNpeGNpcmNsZSA9IDB4MjQ2NTsKICB0LnNpeGNpcmNsZWludmVyc2VzYW5zc2VyaWYgPSAweDI3OGY7CiAgdC5zaXhkZXZhID0gMHgwOTZjOwogIHQuc2l4Z3VqYXJhdGkgPSAweDBhZWM7CiAgdC5zaXhndXJtdWtoaSA9IDB4MGE2YzsKICB0LnNpeGhhY2thcmFiaWMgPSAweDA2NjY7CiAgdC5zaXhoYW5nemhvdSA9IDB4MzAyNjsKICB0LnNpeGlkZW9ncmFwaGljcGFyZW4gPSAweDMyMjU7CiAgdC5zaXhpbmZlcmlvciA9IDB4MjA4NjsKICB0LnNpeG1vbm9zcGFjZSA9IDB4ZmYxNjsKICB0LnNpeG9sZHN0eWxlID0gMHhmNzM2OwogIHQuc2l4cGFyZW4gPSAweDI0Nzk7CiAgdC5zaXhwZXJpb2QgPSAweDI0OGQ7CiAgdC5zaXhwZXJzaWFuID0gMHgwNmY2OwogIHQuc2l4cm9tYW4gPSAweDIxNzU7CiAgdC5zaXhzdXBlcmlvciA9IDB4MjA3NjsKICB0LnNpeHRlZW5jaXJjbGUgPSAweDI0NmY7CiAgdC5zaXh0ZWVuY3VycmVuY3lkZW5vbWluYXRvcmJlbmdhbGkgPSAweDA5Zjk7CiAgdC5zaXh0ZWVucGFyZW4gPSAweDI0ODM7CiAgdC5zaXh0ZWVucGVyaW9kID0gMHgyNDk3OwogIHQuc2l4dGhhaSA9IDB4MGU1NjsKICB0LnNsYXNoID0gMHgwMDJmOwogIHQuc2xhc2htb25vc3BhY2UgPSAweGZmMGY7CiAgdC5zbG9uZyA9IDB4MDE3ZjsKICB0LnNsb25nZG90YWNjZW50ID0gMHgxZTliOwogIHQuc21pbGVmYWNlID0gMHgyNjNhOwogIHQuc21vbm9zcGFjZSA9IDB4ZmY1MzsKICB0LnNvZnBhc3VxaGVicmV3ID0gMHgwNWMzOwogIHQuc29mdGh5cGhlbiA9IDB4MDBhZDsKICB0LnNvZnRzaWduY3lyaWxsaWMgPSAweDA0NGM7CiAgdC5zb2hpcmFnYW5hID0gMHgzMDVkOwogIHQuc29rYXRha2FuYSA9IDB4MzBiZDsKICB0LnNva2F0YWthbmFoYWxmd2lkdGggPSAweGZmN2Y7CiAgdC5zb2xpZHVzbG9uZ292ZXJsYXljbWIgPSAweDAzMzg7CiAgdC5zb2xpZHVzc2hvcnRvdmVybGF5Y21iID0gMHgwMzM3OwogIHQuc29ydXNpdGhhaSA9IDB4MGUyOTsKICB0LnNvc2FsYXRoYWkgPSAweDBlMjg7CiAgdC5zb3NvdGhhaSA9IDB4MGUwYjsKICB0LnNvc3VhdGhhaSA9IDB4MGUyYTsKICB0LnNwYWNlID0gMHgwMDIwOwogIHQuc3BhY2VoYWNrYXJhYmljID0gMHgwMDIwOwogIHQuc3BhZGUgPSAweDI2NjA7CiAgdC5zcGFkZXN1aXRibGFjayA9IDB4MjY2MDsKICB0LnNwYWRlc3VpdHdoaXRlID0gMHgyNjY0OwogIHQuc3BhcmVuID0gMHgyNGFlOwogIHQuc3F1YXJlYmVsb3djbWIgPSAweDAzM2I7CiAgdC5zcXVhcmVjYyA9IDB4MzNjNDsKICB0LnNxdWFyZWNtID0gMHgzMzlkOwogIHQuc3F1YXJlZGlhZ29uYWxjcm9zc2hhdGNoZmlsbCA9IDB4MjVhOTsKICB0LnNxdWFyZWhvcml6b250YWxmaWxsID0gMHgyNWE0OwogIHQuc3F1YXJla2cgPSAweDMzOGY7CiAgdC5zcXVhcmVrbSA9IDB4MzM5ZTsKICB0LnNxdWFyZWttY2FwaXRhbCA9IDB4MzNjZTsKICB0LnNxdWFyZWxuID0gMHgzM2QxOwogIHQuc3F1YXJlbG9nID0gMHgzM2QyOwogIHQuc3F1YXJlbWcgPSAweDMzOGU7CiAgdC5zcXVhcmVtaWwgPSAweDMzZDU7CiAgdC5zcXVhcmVtbSA9IDB4MzM5YzsKICB0LnNxdWFyZW1zcXVhcmVkID0gMHgzM2ExOwogIHQuc3F1YXJlb3J0aG9nb25hbGNyb3NzaGF0Y2hmaWxsID0gMHgyNWE2OwogIHQuc3F1YXJldXBwZXJsZWZ0dG9sb3dlcnJpZ2h0ZmlsbCA9IDB4MjVhNzsKICB0LnNxdWFyZXVwcGVycmlnaHR0b2xvd2VybGVmdGZpbGwgPSAweDI1YTg7CiAgdC5zcXVhcmV2ZXJ0aWNhbGZpbGwgPSAweDI1YTU7CiAgdC5zcXVhcmV3aGl0ZXdpdGhzbWFsbGJsYWNrID0gMHgyNWEzOwogIHQuc3JzcXVhcmUgPSAweDMzZGI7CiAgdC5zc2FiZW5nYWxpID0gMHgwOWI3OwogIHQuc3NhZGV2YSA9IDB4MDkzNzsKICB0LnNzYWd1amFyYXRpID0gMHgwYWI3OwogIHQuc3NhbmdjaWV1Y2tvcmVhbiA9IDB4MzE0OTsKICB0LnNzYW5naGlldWhrb3JlYW4gPSAweDMxODU7CiAgdC5zc2FuZ2lldW5na29yZWFuID0gMHgzMTgwOwogIHQuc3NhbmdraXllb2trb3JlYW4gPSAweDMxMzI7CiAgdC5zc2FuZ25pZXVua29yZWFuID0gMHgzMTY1OwogIHQuc3NhbmdwaWV1cGtvcmVhbiA9IDB4MzE0MzsKICB0LnNzYW5nc2lvc2tvcmVhbiA9IDB4MzE0NjsKICB0LnNzYW5ndGlrZXV0a29yZWFuID0gMHgzMTM4OwogIHQuc3N1cGVyaW9yID0gMHhmNmYyOwogIHQuc3RlcmxpbmcgPSAweDAwYTM7CiAgdC5zdGVybGluZ21vbm9zcGFjZSA9IDB4ZmZlMTsKICB0LnN0cm9rZWxvbmdvdmVybGF5Y21iID0gMHgwMzM2OwogIHQuc3Ryb2tlc2hvcnRvdmVybGF5Y21iID0gMHgwMzM1OwogIHQuc3Vic2V0ID0gMHgyMjgyOwogIHQuc3Vic2V0bm90ZXF1YWwgPSAweDIyOGE7CiAgdC5zdWJzZXRvcmVxdWFsID0gMHgyMjg2OwogIHQuc3VjY2VlZHMgPSAweDIyN2I7CiAgdC5zdWNodGhhdCA9IDB4MjIwYjsKICB0LnN1aGlyYWdhbmEgPSAweDMwNTk7CiAgdC5zdWthdGFrYW5hID0gMHgzMGI5OwogIHQuc3VrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3ZDsKICB0LnN1a3VuYXJhYmljID0gMHgwNjUyOwogIHQuc3VtbWF0aW9uID0gMHgyMjExOwogIHQuc3VuID0gMHgyNjNjOwogIHQuc3VwZXJzZXQgPSAweDIyODM7CiAgdC5zdXBlcnNldG5vdGVxdWFsID0gMHgyMjhiOwogIHQuc3VwZXJzZXRvcmVxdWFsID0gMHgyMjg3OwogIHQuc3ZzcXVhcmUgPSAweDMzZGM7CiAgdC5zeW91d2FlcmFzcXVhcmUgPSAweDMzN2M7CiAgdC50ID0gMHgwMDc0OwogIHQudGFiZW5nYWxpID0gMHgwOWE0OwogIHQudGFja2Rvd24gPSAweDIyYTQ7CiAgdC50YWNrbGVmdCA9IDB4MjJhMzsKICB0LnRhZGV2YSA9IDB4MDkyNDsKICB0LnRhZ3VqYXJhdGkgPSAweDBhYTQ7CiAgdC50YWd1cm11a2hpID0gMHgwYTI0OwogIHQudGFoYXJhYmljID0gMHgwNjM3OwogIHQudGFoZmluYWxhcmFiaWMgPSAweGZlYzI7CiAgdC50YWhpbml0aWFsYXJhYmljID0gMHhmZWMzOwogIHQudGFoaXJhZ2FuYSA9IDB4MzA1ZjsKICB0LnRhaG1lZGlhbGFyYWJpYyA9IDB4ZmVjNDsKICB0LnRhaXN5b3VlcmFzcXVhcmUgPSAweDMzN2Q7CiAgdC50YWthdGFrYW5hID0gMHgzMGJmOwogIHQudGFrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4MDsKICB0LnRhdHdlZWxhcmFiaWMgPSAweDA2NDA7CiAgdC50YXUgPSAweDAzYzQ7CiAgdC50YXYgPSAweDA1ZWE7CiAgdC50YXZkYWdlcyA9IDB4ZmI0YTsKICB0LnRhdmRhZ2VzaCA9IDB4ZmI0YTsKICB0LnRhdmRhZ2VzaGhlYnJldyA9IDB4ZmI0YTsKICB0LnRhdmhlYnJldyA9IDB4MDVlYTsKICB0LnRiYXIgPSAweDAxNjc7CiAgdC50Ym9wb21vZm8gPSAweDMxMGE7CiAgdC50Y2Fyb24gPSAweDAxNjU7CiAgdC50Y2N1cmwgPSAweDAyYTg7CiAgdC50Y2VkaWxsYSA9IDB4MDE2MzsKICB0LnRjaGVoYXJhYmljID0gMHgwNjg2OwogIHQudGNoZWhmaW5hbGFyYWJpYyA9IDB4ZmI3YjsKICB0LnRjaGVoaW5pdGlhbGFyYWJpYyA9IDB4ZmI3YzsKICB0LnRjaGVobWVkaWFsYXJhYmljID0gMHhmYjdkOwogIHQudGNpcmNsZSA9IDB4MjRlMzsKICB0LnRjaXJjdW1mbGV4YmVsb3cgPSAweDFlNzE7CiAgdC50Y29tbWFhY2NlbnQgPSAweDAxNjM7CiAgdC50ZGllcmVzaXMgPSAweDFlOTc7CiAgdC50ZG90YWNjZW50ID0gMHgxZTZiOwogIHQudGRvdGJlbG93ID0gMHgxZTZkOwogIHQudGVjeXJpbGxpYyA9IDB4MDQ0MjsKICB0LnRlZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0YWQ7CiAgdC50ZWhhcmFiaWMgPSAweDA2MmE7CiAgdC50ZWhmaW5hbGFyYWJpYyA9IDB4ZmU5NjsKICB0LnRlaGhhaGluaXRpYWxhcmFiaWMgPSAweGZjYTI7CiAgdC50ZWhoYWhpc29sYXRlZGFyYWJpYyA9IDB4ZmMwYzsKICB0LnRlaGluaXRpYWxhcmFiaWMgPSAweGZlOTc7CiAgdC50ZWhpcmFnYW5hID0gMHgzMDY2OwogIHQudGVoamVlbWluaXRpYWxhcmFiaWMgPSAweGZjYTE7CiAgdC50ZWhqZWVtaXNvbGF0ZWRhcmFiaWMgPSAweGZjMGI7CiAgdC50ZWhtYXJidXRhYXJhYmljID0gMHgwNjI5OwogIHQudGVobWFyYnV0YWZpbmFsYXJhYmljID0gMHhmZTk0OwogIHQudGVobWVkaWFsYXJhYmljID0gMHhmZTk4OwogIHQudGVobWVlbWluaXRpYWxhcmFiaWMgPSAweGZjYTQ7CiAgdC50ZWhtZWVtaXNvbGF0ZWRhcmFiaWMgPSAweGZjMGU7CiAgdC50ZWhub29uZmluYWxhcmFiaWMgPSAweGZjNzM7CiAgdC50ZWthdGFrYW5hID0gMHgzMGM2OwogIHQudGVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4MzsKICB0LnRlbGVwaG9uZSA9IDB4MjEyMTsKICB0LnRlbGVwaG9uZWJsYWNrID0gMHgyNjBlOwogIHQudGVsaXNoYWdlZG9sYWhlYnJldyA9IDB4MDVhMDsKICB0LnRlbGlzaGFxZXRhbmFoZWJyZXcgPSAweDA1YTk7CiAgdC50ZW5jaXJjbGUgPSAweDI0Njk7CiAgdC50ZW5pZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjI5OwogIHQudGVucGFyZW4gPSAweDI0N2Q7CiAgdC50ZW5wZXJpb2QgPSAweDI0OTE7CiAgdC50ZW5yb21hbiA9IDB4MjE3OTsKICB0LnRlc2ggPSAweDAyYTc7CiAgdC50ZXQgPSAweDA1ZDg7CiAgdC50ZXRkYWdlc2ggPSAweGZiMzg7CiAgdC50ZXRkYWdlc2hoZWJyZXcgPSAweGZiMzg7CiAgdC50ZXRoZWJyZXcgPSAweDA1ZDg7CiAgdC50ZXRzZWN5cmlsbGljID0gMHgwNGI1OwogIHQudGV2aXJoZWJyZXcgPSAweDA1OWI7CiAgdC50ZXZpcmxlZnRoZWJyZXcgPSAweDA1OWI7CiAgdC50aGFiZW5nYWxpID0gMHgwOWE1OwogIHQudGhhZGV2YSA9IDB4MDkyNTsKICB0LnRoYWd1amFyYXRpID0gMHgwYWE1OwogIHQudGhhZ3VybXVraGkgPSAweDBhMjU7CiAgdC50aGFsYXJhYmljID0gMHgwNjMwOwogIHQudGhhbGZpbmFsYXJhYmljID0gMHhmZWFjOwogIHQudGhhbnRoYWtoYXRsb3dsZWZ0dGhhaSA9IDB4Zjg5ODsKICB0LnRoYW50aGFraGF0bG93cmlnaHR0aGFpID0gMHhmODk3OwogIHQudGhhbnRoYWtoYXR0aGFpID0gMHgwZTRjOwogIHQudGhhbnRoYWtoYXR1cHBlcmxlZnR0aGFpID0gMHhmODk2OwogIHQudGhlaGFyYWJpYyA9IDB4MDYyYjsKICB0LnRoZWhmaW5hbGFyYWJpYyA9IDB4ZmU5YTsKICB0LnRoZWhpbml0aWFsYXJhYmljID0gMHhmZTliOwogIHQudGhlaG1lZGlhbGFyYWJpYyA9IDB4ZmU5YzsKICB0LnRoZXJlZXhpc3RzID0gMHgyMjAzOwogIHQudGhlcmVmb3JlID0gMHgyMjM0OwogIHQudGhldGEgPSAweDAzYjg7CiAgdC50aGV0YTEgPSAweDAzZDE7CiAgdC50aGV0YXN5bWJvbGdyZWVrID0gMHgwM2QxOwogIHQudGhpZXV0aGFjaXJjbGVrb3JlYW4gPSAweDMyNzk7CiAgdC50aGlldXRoYXBhcmVua29yZWFuID0gMHgzMjE5OwogIHQudGhpZXV0aGNpcmNsZWtvcmVhbiA9IDB4MzI2YjsKICB0LnRoaWV1dGhrb3JlYW4gPSAweDMxNGM7CiAgdC50aGlldXRocGFyZW5rb3JlYW4gPSAweDMyMGI7CiAgdC50aGlydGVlbmNpcmNsZSA9IDB4MjQ2YzsKICB0LnRoaXJ0ZWVucGFyZW4gPSAweDI0ODA7CiAgdC50aGlydGVlbnBlcmlvZCA9IDB4MjQ5NDsKICB0LnRob25hbmdtb250aG90aGFpID0gMHgwZTExOwogIHQudGhvb2sgPSAweDAxYWQ7CiAgdC50aG9waHV0aGFvdGhhaSA9IDB4MGUxMjsKICB0LnRob3JuID0gMHgwMGZlOwogIHQudGhvdGhhaGFudGhhaSA9IDB4MGUxNzsKICB0LnRob3RoYW50aGFpID0gMHgwZTEwOwogIHQudGhvdGhvbmd0aGFpID0gMHgwZTE4OwogIHQudGhvdGh1bmd0aGFpID0gMHgwZTE2OwogIHQudGhvdXNhbmRjeXJpbGxpYyA9IDB4MDQ4MjsKICB0LnRob3VzYW5kc3NlcGFyYXRvcmFyYWJpYyA9IDB4MDY2YzsKICB0LnRob3VzYW5kc3NlcGFyYXRvcnBlcnNpYW4gPSAweDA2NmM7CiAgdC50aHJlZSA9IDB4MDAzMzsKICB0LnRocmVlYXJhYmljID0gMHgwNjYzOwogIHQudGhyZWViZW5nYWxpID0gMHgwOWU5OwogIHQudGhyZWVjaXJjbGUgPSAweDI0NjI7CiAgdC50aHJlZWNpcmNsZWludmVyc2VzYW5zc2VyaWYgPSAweDI3OGM7CiAgdC50aHJlZWRldmEgPSAweDA5Njk7CiAgdC50aHJlZWVpZ2h0aHMgPSAweDIxNWM7CiAgdC50aHJlZWd1amFyYXRpID0gMHgwYWU5OwogIHQudGhyZWVndXJtdWtoaSA9IDB4MGE2OTsKICB0LnRocmVlaGFja2FyYWJpYyA9IDB4MDY2MzsKICB0LnRocmVlaGFuZ3pob3UgPSAweDMwMjM7CiAgdC50aHJlZWlkZW9ncmFwaGljcGFyZW4gPSAweDMyMjI7CiAgdC50aHJlZWluZmVyaW9yID0gMHgyMDgzOwogIHQudGhyZWVtb25vc3BhY2UgPSAweGZmMTM7CiAgdC50aHJlZW51bWVyYXRvcmJlbmdhbGkgPSAweDA5ZjY7CiAgdC50aHJlZW9sZHN0eWxlID0gMHhmNzMzOwogIHQudGhyZWVwYXJlbiA9IDB4MjQ3NjsKICB0LnRocmVlcGVyaW9kID0gMHgyNDhhOwogIHQudGhyZWVwZXJzaWFuID0gMHgwNmYzOwogIHQudGhyZWVxdWFydGVycyA9IDB4MDBiZTsKICB0LnRocmVlcXVhcnRlcnNlbWRhc2ggPSAweGY2ZGU7CiAgdC50aHJlZXJvbWFuID0gMHgyMTcyOwogIHQudGhyZWVzdXBlcmlvciA9IDB4MDBiMzsKICB0LnRocmVldGhhaSA9IDB4MGU1MzsKICB0LnRoenNxdWFyZSA9IDB4MzM5NDsKICB0LnRpaGlyYWdhbmEgPSAweDMwNjE7CiAgdC50aWthdGFrYW5hID0gMHgzMGMxOwogIHQudGlrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4MTsKICB0LnRpa2V1dGFjaXJjbGVrb3JlYW4gPSAweDMyNzA7CiAgdC50aWtldXRhcGFyZW5rb3JlYW4gPSAweDMyMTA7CiAgdC50aWtldXRjaXJjbGVrb3JlYW4gPSAweDMyNjI7CiAgdC50aWtldXRrb3JlYW4gPSAweDMxMzc7CiAgdC50aWtldXRwYXJlbmtvcmVhbiA9IDB4MzIwMjsKICB0LnRpbGRlID0gMHgwMmRjOwogIHQudGlsZGViZWxvd2NtYiA9IDB4MDMzMDsKICB0LnRpbGRlY21iID0gMHgwMzAzOwogIHQudGlsZGVjb21iID0gMHgwMzAzOwogIHQudGlsZGVkb3VibGVjbWIgPSAweDAzNjA7CiAgdC50aWxkZW9wZXJhdG9yID0gMHgyMjNjOwogIHQudGlsZGVvdmVybGF5Y21iID0gMHgwMzM0OwogIHQudGlsZGV2ZXJ0aWNhbGNtYiA9IDB4MDMzZTsKICB0LnRpbWVzY2lyY2xlID0gMHgyMjk3OwogIHQudGlwZWhhaGVicmV3ID0gMHgwNTk2OwogIHQudGlwZWhhbGVmdGhlYnJldyA9IDB4MDU5NjsKICB0LnRpcHBpZ3VybXVraGkgPSAweDBhNzA7CiAgdC50aXRsb2N5cmlsbGljY21iID0gMHgwNDgzOwogIHQudGl3bmFybWVuaWFuID0gMHgwNTdmOwogIHQudGxpbmViZWxvdyA9IDB4MWU2ZjsKICB0LnRtb25vc3BhY2UgPSAweGZmNTQ7CiAgdC50b2FybWVuaWFuID0gMHgwNTY5OwogIHQudG9oaXJhZ2FuYSA9IDB4MzA2ODsKICB0LnRva2F0YWthbmEgPSAweDMwYzg7CiAgdC50b2thdGFrYW5haGFsZndpZHRoID0gMHhmZjg0OwogIHQudG9uZWJhcmV4dHJhaGlnaG1vZCA9IDB4MDJlNTsKICB0LnRvbmViYXJleHRyYWxvd21vZCA9IDB4MDJlOTsKICB0LnRvbmViYXJoaWdobW9kID0gMHgwMmU2OwogIHQudG9uZWJhcmxvd21vZCA9IDB4MDJlODsKICB0LnRvbmViYXJtaWRtb2QgPSAweDAyZTc7CiAgdC50b25lZml2ZSA9IDB4MDFiZDsKICB0LnRvbmVzaXggPSAweDAxODU7CiAgdC50b25ldHdvID0gMHgwMWE4OwogIHQudG9ub3MgPSAweDAzODQ7CiAgdC50b25zcXVhcmUgPSAweDMzMjc7CiAgdC50b3BhdGFrdGhhaSA9IDB4MGUwZjsKICB0LnRvcnRvaXNlc2hlbGxicmFja2V0bGVmdCA9IDB4MzAxNDsKICB0LnRvcnRvaXNlc2hlbGxicmFja2V0bGVmdHNtYWxsID0gMHhmZTVkOwogIHQudG9ydG9pc2VzaGVsbGJyYWNrZXRsZWZ0dmVydGljYWwgPSAweGZlMzk7CiAgdC50b3J0b2lzZXNoZWxsYnJhY2tldHJpZ2h0ID0gMHgzMDE1OwogIHQudG9ydG9pc2VzaGVsbGJyYWNrZXRyaWdodHNtYWxsID0gMHhmZTVlOwogIHQudG9ydG9pc2VzaGVsbGJyYWNrZXRyaWdodHZlcnRpY2FsID0gMHhmZTNhOwogIHQudG90YW90aGFpID0gMHgwZTE1OwogIHQudHBhbGF0YWxob29rID0gMHgwMWFiOwogIHQudHBhcmVuID0gMHgyNGFmOwogIHQudHJhZGVtYXJrID0gMHgyMTIyOwogIHQudHJhZGVtYXJrc2FucyA9IDB4ZjhlYTsKICB0LnRyYWRlbWFya3NlcmlmID0gMHhmNmRiOwogIHQudHJldHJvZmxleGhvb2sgPSAweDAyODg7CiAgdC50cmlhZ2RuID0gMHgyNWJjOwogIHQudHJpYWdsZiA9IDB4MjVjNDsKICB0LnRyaWFncnQgPSAweDI1YmE7CiAgdC50cmlhZ3VwID0gMHgyNWIyOwogIHQudHMgPSAweDAyYTY7CiAgdC50c2FkaSA9IDB4MDVlNjsKICB0LnRzYWRpZGFnZXNoID0gMHhmYjQ2OwogIHQudHNhZGlkYWdlc2hoZWJyZXcgPSAweGZiNDY7CiAgdC50c2FkaWhlYnJldyA9IDB4MDVlNjsKICB0LnRzZWN5cmlsbGljID0gMHgwNDQ2OwogIHQudHNlcmUgPSAweDA1YjU7CiAgdC50c2VyZTEyID0gMHgwNWI1OwogIHQudHNlcmUxZSA9IDB4MDViNTsKICB0LnRzZXJlMmIgPSAweDA1YjU7CiAgdC50c2VyZWhlYnJldyA9IDB4MDViNTsKICB0LnRzZXJlbmFycm93aGVicmV3ID0gMHgwNWI1OwogIHQudHNlcmVxdWFydGVyaGVicmV3ID0gMHgwNWI1OwogIHQudHNlcmV3aWRlaGVicmV3ID0gMHgwNWI1OwogIHQudHNoZWN5cmlsbGljID0gMHgwNDViOwogIHQudHN1cGVyaW9yID0gMHhmNmYzOwogIHQudHRhYmVuZ2FsaSA9IDB4MDk5ZjsKICB0LnR0YWRldmEgPSAweDA5MWY7CiAgdC50dGFndWphcmF0aSA9IDB4MGE5ZjsKICB0LnR0YWd1cm11a2hpID0gMHgwYTFmOwogIHQudHRlaGFyYWJpYyA9IDB4MDY3OTsKICB0LnR0ZWhmaW5hbGFyYWJpYyA9IDB4ZmI2NzsKICB0LnR0ZWhpbml0aWFsYXJhYmljID0gMHhmYjY4OwogIHQudHRlaG1lZGlhbGFyYWJpYyA9IDB4ZmI2OTsKICB0LnR0aGFiZW5nYWxpID0gMHgwOWEwOwogIHQudHRoYWRldmEgPSAweDA5MjA7CiAgdC50dGhhZ3VqYXJhdGkgPSAweDBhYTA7CiAgdC50dGhhZ3VybXVraGkgPSAweDBhMjA7CiAgdC50dHVybmVkID0gMHgwMjg3OwogIHQudHVoaXJhZ2FuYSA9IDB4MzA2NDsKICB0LnR1a2F0YWthbmEgPSAweDMwYzQ7CiAgdC50dWthdGFrYW5haGFsZndpZHRoID0gMHhmZjgyOwogIHQudHVzbWFsbGhpcmFnYW5hID0gMHgzMDYzOwogIHQudHVzbWFsbGthdGFrYW5hID0gMHgzMGMzOwogIHQudHVzbWFsbGthdGFrYW5haGFsZndpZHRoID0gMHhmZjZmOwogIHQudHdlbHZlY2lyY2xlID0gMHgyNDZiOwogIHQudHdlbHZlcGFyZW4gPSAweDI0N2Y7CiAgdC50d2VsdmVwZXJpb2QgPSAweDI0OTM7CiAgdC50d2VsdmVyb21hbiA9IDB4MjE3YjsKICB0LnR3ZW50eWNpcmNsZSA9IDB4MjQ3MzsKICB0LnR3ZW50eWhhbmd6aG91ID0gMHg1MzQ0OwogIHQudHdlbnR5cGFyZW4gPSAweDI0ODc7CiAgdC50d2VudHlwZXJpb2QgPSAweDI0OWI7CiAgdC50d28gPSAweDAwMzI7CiAgdC50d29hcmFiaWMgPSAweDA2NjI7CiAgdC50d29iZW5nYWxpID0gMHgwOWU4OwogIHQudHdvY2lyY2xlID0gMHgyNDYxOwogIHQudHdvY2lyY2xlaW52ZXJzZXNhbnNzZXJpZiA9IDB4Mjc4YjsKICB0LnR3b2RldmEgPSAweDA5Njg7CiAgdC50d29kb3RlbmxlYWRlciA9IDB4MjAyNTsKICB0LnR3b2RvdGxlYWRlciA9IDB4MjAyNTsKICB0LnR3b2RvdGxlYWRlcnZlcnRpY2FsID0gMHhmZTMwOwogIHQudHdvZ3VqYXJhdGkgPSAweDBhZTg7CiAgdC50d29ndXJtdWtoaSA9IDB4MGE2ODsKICB0LnR3b2hhY2thcmFiaWMgPSAweDA2NjI7CiAgdC50d29oYW5nemhvdSA9IDB4MzAyMjsKICB0LnR3b2lkZW9ncmFwaGljcGFyZW4gPSAweDMyMjE7CiAgdC50d29pbmZlcmlvciA9IDB4MjA4MjsKICB0LnR3b21vbm9zcGFjZSA9IDB4ZmYxMjsKICB0LnR3b251bWVyYXRvcmJlbmdhbGkgPSAweDA5ZjU7CiAgdC50d29vbGRzdHlsZSA9IDB4ZjczMjsKICB0LnR3b3BhcmVuID0gMHgyNDc1OwogIHQudHdvcGVyaW9kID0gMHgyNDg5OwogIHQudHdvcGVyc2lhbiA9IDB4MDZmMjsKICB0LnR3b3JvbWFuID0gMHgyMTcxOwogIHQudHdvc3Ryb2tlID0gMHgwMWJiOwogIHQudHdvc3VwZXJpb3IgPSAweDAwYjI7CiAgdC50d290aGFpID0gMHgwZTUyOwogIHQudHdvdGhpcmRzID0gMHgyMTU0OwogIHQudSA9IDB4MDA3NTsKICB0LnVhY3V0ZSA9IDB4MDBmYTsKICB0LnViYXIgPSAweDAyODk7CiAgdC51YmVuZ2FsaSA9IDB4MDk4OTsKICB0LnVib3BvbW9mbyA9IDB4MzEyODsKICB0LnVicmV2ZSA9IDB4MDE2ZDsKICB0LnVjYXJvbiA9IDB4MDFkNDsKICB0LnVjaXJjbGUgPSAweDI0ZTQ7CiAgdC51Y2lyY3VtZmxleCA9IDB4MDBmYjsKICB0LnVjaXJjdW1mbGV4YmVsb3cgPSAweDFlNzc7CiAgdC51Y3lyaWxsaWMgPSAweDA0NDM7CiAgdC51ZGF0dGFkZXZhID0gMHgwOTUxOwogIHQudWRibGFjdXRlID0gMHgwMTcxOwogIHQudWRibGdyYXZlID0gMHgwMjE1OwogIHQudWRldmEgPSAweDA5MDk7CiAgdC51ZGllcmVzaXMgPSAweDAwZmM7CiAgdC51ZGllcmVzaXNhY3V0ZSA9IDB4MDFkODsKICB0LnVkaWVyZXNpc2JlbG93ID0gMHgxZTczOwogIHQudWRpZXJlc2lzY2Fyb24gPSAweDAxZGE7CiAgdC51ZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRmMTsKICB0LnVkaWVyZXNpc2dyYXZlID0gMHgwMWRjOwogIHQudWRpZXJlc2lzbWFjcm9uID0gMHgwMWQ2OwogIHQudWRvdGJlbG93ID0gMHgxZWU1OwogIHQudWdyYXZlID0gMHgwMGY5OwogIHQudWd1amFyYXRpID0gMHgwYTg5OwogIHQudWd1cm11a2hpID0gMHgwYTA5OwogIHQudWhpcmFnYW5hID0gMHgzMDQ2OwogIHQudWhvb2thYm92ZSA9IDB4MWVlNzsKICB0LnVob3JuID0gMHgwMWIwOwogIHQudWhvcm5hY3V0ZSA9IDB4MWVlOTsKICB0LnVob3JuZG90YmVsb3cgPSAweDFlZjE7CiAgdC51aG9ybmdyYXZlID0gMHgxZWViOwogIHQudWhvcm5ob29rYWJvdmUgPSAweDFlZWQ7CiAgdC51aG9ybnRpbGRlID0gMHgxZWVmOwogIHQudWh1bmdhcnVtbGF1dCA9IDB4MDE3MTsKICB0LnVodW5nYXJ1bWxhdXRjeXJpbGxpYyA9IDB4MDRmMzsKICB0LnVpbnZlcnRlZGJyZXZlID0gMHgwMjE3OwogIHQudWthdGFrYW5hID0gMHgzMGE2OwogIHQudWthdGFrYW5haGFsZndpZHRoID0gMHhmZjczOwogIHQudWtjeXJpbGxpYyA9IDB4MDQ3OTsKICB0LnVrb3JlYW4gPSAweDMxNWM7CiAgdC51bWFjcm9uID0gMHgwMTZiOwogIHQudW1hY3JvbmN5cmlsbGljID0gMHgwNGVmOwogIHQudW1hY3JvbmRpZXJlc2lzID0gMHgxZTdiOwogIHQudW1hdHJhZ3VybXVraGkgPSAweDBhNDE7CiAgdC51bW9ub3NwYWNlID0gMHhmZjU1OwogIHQudW5kZXJzY29yZSA9IDB4MDA1ZjsKICB0LnVuZGVyc2NvcmVkYmwgPSAweDIwMTc7CiAgdC51bmRlcnNjb3JlbW9ub3NwYWNlID0gMHhmZjNmOwogIHQudW5kZXJzY29yZXZlcnRpY2FsID0gMHhmZTMzOwogIHQudW5kZXJzY29yZXdhdnkgPSAweGZlNGY7CiAgdC51bmlvbiA9IDB4MjIyYTsKICB0LnVuaXZlcnNhbCA9IDB4MjIwMDsKICB0LnVvZ29uZWsgPSAweDAxNzM7CiAgdC51cGFyZW4gPSAweDI0YjA7CiAgdC51cGJsb2NrID0gMHgyNTgwOwogIHQudXBwZXJkb3RoZWJyZXcgPSAweDA1YzQ7CiAgdC51cHNpbG9uID0gMHgwM2M1OwogIHQudXBzaWxvbmRpZXJlc2lzID0gMHgwM2NiOwogIHQudXBzaWxvbmRpZXJlc2lzdG9ub3MgPSAweDAzYjA7CiAgdC51cHNpbG9ubGF0aW4gPSAweDAyOGE7CiAgdC51cHNpbG9udG9ub3MgPSAweDAzY2Q7CiAgdC51cHRhY2tiZWxvd2NtYiA9IDB4MDMxZDsKICB0LnVwdGFja21vZCA9IDB4MDJkNDsKICB0LnVyYWd1cm11a2hpID0gMHgwYTczOwogIHQudXJpbmcgPSAweDAxNmY7CiAgdC51c2hvcnRjeXJpbGxpYyA9IDB4MDQ1ZTsKICB0LnVzbWFsbGhpcmFnYW5hID0gMHgzMDQ1OwogIHQudXNtYWxsa2F0YWthbmEgPSAweDMwYTU7CiAgdC51c21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2OTsKICB0LnVzdHJhaWdodGN5cmlsbGljID0gMHgwNGFmOwogIHQudXN0cmFpZ2h0c3Ryb2tlY3lyaWxsaWMgPSAweDA0YjE7CiAgdC51dGlsZGUgPSAweDAxNjk7CiAgdC51dGlsZGVhY3V0ZSA9IDB4MWU3OTsKICB0LnV0aWxkZWJlbG93ID0gMHgxZTc1OwogIHQudXViZW5nYWxpID0gMHgwOThhOwogIHQudXVkZXZhID0gMHgwOTBhOwogIHQudXVndWphcmF0aSA9IDB4MGE4YTsKICB0LnV1Z3VybXVraGkgPSAweDBhMGE7CiAgdC51dW1hdHJhZ3VybXVraGkgPSAweDBhNDI7CiAgdC51dXZvd2Vsc2lnbmJlbmdhbGkgPSAweDA5YzI7CiAgdC51dXZvd2Vsc2lnbmRldmEgPSAweDA5NDI7CiAgdC51dXZvd2Vsc2lnbmd1amFyYXRpID0gMHgwYWMyOwogIHQudXZvd2Vsc2lnbmJlbmdhbGkgPSAweDA5YzE7CiAgdC51dm93ZWxzaWduZGV2YSA9IDB4MDk0MTsKICB0LnV2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjMTsKICB0LnYgPSAweDAwNzY7CiAgdC52YWRldmEgPSAweDA5MzU7CiAgdC52YWd1amFyYXRpID0gMHgwYWI1OwogIHQudmFndXJtdWtoaSA9IDB4MGEzNTsKICB0LnZha2F0YWthbmEgPSAweDMwZjc7CiAgdC52YXYgPSAweDA1ZDU7CiAgdC52YXZkYWdlc2ggPSAweGZiMzU7CiAgdC52YXZkYWdlc2g2NSA9IDB4ZmIzNTsKICB0LnZhdmRhZ2VzaGhlYnJldyA9IDB4ZmIzNTsKICB0LnZhdmhlYnJldyA9IDB4MDVkNTsKICB0LnZhdmhvbGFtID0gMHhmYjRiOwogIHQudmF2aG9sYW1oZWJyZXcgPSAweGZiNGI7CiAgdC52YXZ2YXZoZWJyZXcgPSAweDA1ZjA7CiAgdC52YXZ5b2RoZWJyZXcgPSAweDA1ZjE7CiAgdC52Y2lyY2xlID0gMHgyNGU1OwogIHQudmRvdGJlbG93ID0gMHgxZTdmOwogIHQudmVjeXJpbGxpYyA9IDB4MDQzMjsKICB0LnZlaGFyYWJpYyA9IDB4MDZhNDsKICB0LnZlaGZpbmFsYXJhYmljID0gMHhmYjZiOwogIHQudmVoaW5pdGlhbGFyYWJpYyA9IDB4ZmI2YzsKICB0LnZlaG1lZGlhbGFyYWJpYyA9IDB4ZmI2ZDsKICB0LnZla2F0YWthbmEgPSAweDMwZjk7CiAgdC52ZW51cyA9IDB4MjY0MDsKICB0LnZlcnRpY2FsYmFyID0gMHgwMDdjOwogIHQudmVydGljYWxsaW5lYWJvdmVjbWIgPSAweDAzMGQ7CiAgdC52ZXJ0aWNhbGxpbmViZWxvd2NtYiA9IDB4MDMyOTsKICB0LnZlcnRpY2FsbGluZWxvd21vZCA9IDB4MDJjYzsKICB0LnZlcnRpY2FsbGluZW1vZCA9IDB4MDJjODsKICB0LnZld2FybWVuaWFuID0gMHgwNTdlOwogIHQudmhvb2sgPSAweDAyOGI7CiAgdC52aWthdGFrYW5hID0gMHgzMGY4OwogIHQudmlyYW1hYmVuZ2FsaSA9IDB4MDljZDsKICB0LnZpcmFtYWRldmEgPSAweDA5NGQ7CiAgdC52aXJhbWFndWphcmF0aSA9IDB4MGFjZDsKICB0LnZpc2FyZ2FiZW5nYWxpID0gMHgwOTgzOwogIHQudmlzYXJnYWRldmEgPSAweDA5MDM7CiAgdC52aXNhcmdhZ3VqYXJhdGkgPSAweDBhODM7CiAgdC52bW9ub3NwYWNlID0gMHhmZjU2OwogIHQudm9hcm1lbmlhbiA9IDB4MDU3ODsKICB0LnZvaWNlZGl0ZXJhdGlvbmhpcmFnYW5hID0gMHgzMDllOwogIHQudm9pY2VkaXRlcmF0aW9ua2F0YWthbmEgPSAweDMwZmU7CiAgdC52b2ljZWRtYXJra2FuYSA9IDB4MzA5YjsKICB0LnZvaWNlZG1hcmtrYW5haGFsZndpZHRoID0gMHhmZjllOwogIHQudm9rYXRha2FuYSA9IDB4MzBmYTsKICB0LnZwYXJlbiA9IDB4MjRiMTsKICB0LnZ0aWxkZSA9IDB4MWU3ZDsKICB0LnZ0dXJuZWQgPSAweDAyOGM7CiAgdC52dWhpcmFnYW5hID0gMHgzMDk0OwogIHQudnVrYXRha2FuYSA9IDB4MzBmNDsKICB0LncgPSAweDAwNzc7CiAgdC53YWN1dGUgPSAweDFlODM7CiAgdC53YWVrb3JlYW4gPSAweDMxNTk7CiAgdC53YWhpcmFnYW5hID0gMHgzMDhmOwogIHQud2FrYXRha2FuYSA9IDB4MzBlZjsKICB0Lndha2F0YWthbmFoYWxmd2lkdGggPSAweGZmOWM7CiAgdC53YWtvcmVhbiA9IDB4MzE1ODsKICB0Lndhc21hbGxoaXJhZ2FuYSA9IDB4MzA4ZTsKICB0Lndhc21hbGxrYXRha2FuYSA9IDB4MzBlZTsKICB0LndhdHRvc3F1YXJlID0gMHgzMzU3OwogIHQud2F2ZWRhc2ggPSAweDMwMWM7CiAgdC53YXZ5dW5kZXJzY29yZXZlcnRpY2FsID0gMHhmZTM0OwogIHQud2F3YXJhYmljID0gMHgwNjQ4OwogIHQud2F3ZmluYWxhcmFiaWMgPSAweGZlZWU7CiAgdC53YXdoYW16YWFib3ZlYXJhYmljID0gMHgwNjI0OwogIHQud2F3aGFtemFhYm92ZWZpbmFsYXJhYmljID0gMHhmZTg2OwogIHQud2JzcXVhcmUgPSAweDMzZGQ7CiAgdC53Y2lyY2xlID0gMHgyNGU2OwogIHQud2NpcmN1bWZsZXggPSAweDAxNzU7CiAgdC53ZGllcmVzaXMgPSAweDFlODU7CiAgdC53ZG90YWNjZW50ID0gMHgxZTg3OwogIHQud2RvdGJlbG93ID0gMHgxZTg5OwogIHQud2VoaXJhZ2FuYSA9IDB4MzA5MTsKICB0LndlaWVyc3RyYXNzID0gMHgyMTE4OwogIHQud2VrYXRha2FuYSA9IDB4MzBmMTsKICB0Lndla29yZWFuID0gMHgzMTVlOwogIHQud2Vva29yZWFuID0gMHgzMTVkOwogIHQud2dyYXZlID0gMHgxZTgxOwogIHQud2hpdGVidWxsZXQgPSAweDI1ZTY7CiAgdC53aGl0ZWNpcmNsZSA9IDB4MjVjYjsKICB0LndoaXRlY2lyY2xlaW52ZXJzZSA9IDB4MjVkOTsKICB0LndoaXRlY29ybmVyYnJhY2tldGxlZnQgPSAweDMwMGU7CiAgdC53aGl0ZWNvcm5lcmJyYWNrZXRsZWZ0dmVydGljYWwgPSAweGZlNDM7CiAgdC53aGl0ZWNvcm5lcmJyYWNrZXRyaWdodCA9IDB4MzAwZjsKICB0LndoaXRlY29ybmVyYnJhY2tldHJpZ2h0dmVydGljYWwgPSAweGZlNDQ7CiAgdC53aGl0ZWRpYW1vbmQgPSAweDI1Yzc7CiAgdC53aGl0ZWRpYW1vbmRjb250YWluaW5nYmxhY2tzbWFsbGRpYW1vbmQgPSAweDI1Yzg7CiAgdC53aGl0ZWRvd25wb2ludGluZ3NtYWxsdHJpYW5nbGUgPSAweDI1YmY7CiAgdC53aGl0ZWRvd25wb2ludGluZ3RyaWFuZ2xlID0gMHgyNWJkOwogIHQud2hpdGVsZWZ0cG9pbnRpbmdzbWFsbHRyaWFuZ2xlID0gMHgyNWMzOwogIHQud2hpdGVsZWZ0cG9pbnRpbmd0cmlhbmdsZSA9IDB4MjVjMTsKICB0LndoaXRlbGVudGljdWxhcmJyYWNrZXRsZWZ0ID0gMHgzMDE2OwogIHQud2hpdGVsZW50aWN1bGFyYnJhY2tldHJpZ2h0ID0gMHgzMDE3OwogIHQud2hpdGVyaWdodHBvaW50aW5nc21hbGx0cmlhbmdsZSA9IDB4MjViOTsKICB0LndoaXRlcmlnaHRwb2ludGluZ3RyaWFuZ2xlID0gMHgyNWI3OwogIHQud2hpdGVzbWFsbHNxdWFyZSA9IDB4MjVhYjsKICB0LndoaXRlc21pbGluZ2ZhY2UgPSAweDI2M2E7CiAgdC53aGl0ZXNxdWFyZSA9IDB4MjVhMTsKICB0LndoaXRlc3RhciA9IDB4MjYwNjsKICB0LndoaXRldGVsZXBob25lID0gMHgyNjBmOwogIHQud2hpdGV0b3J0b2lzZXNoZWxsYnJhY2tldGxlZnQgPSAweDMwMTg7CiAgdC53aGl0ZXRvcnRvaXNlc2hlbGxicmFja2V0cmlnaHQgPSAweDMwMTk7CiAgdC53aGl0ZXVwcG9pbnRpbmdzbWFsbHRyaWFuZ2xlID0gMHgyNWI1OwogIHQud2hpdGV1cHBvaW50aW5ndHJpYW5nbGUgPSAweDI1YjM7CiAgdC53aWhpcmFnYW5hID0gMHgzMDkwOwogIHQud2lrYXRha2FuYSA9IDB4MzBmMDsKICB0Lndpa29yZWFuID0gMHgzMTVmOwogIHQud21vbm9zcGFjZSA9IDB4ZmY1NzsKICB0LndvaGlyYWdhbmEgPSAweDMwOTI7CiAgdC53b2thdGFrYW5hID0gMHgzMGYyOwogIHQud29rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2NjsKICB0LndvbiA9IDB4MjBhOTsKICB0Lndvbm1vbm9zcGFjZSA9IDB4ZmZlNjsKICB0Lndvd2FlbnRoYWkgPSAweDBlMjc7CiAgdC53cGFyZW4gPSAweDI0YjI7CiAgdC53cmluZyA9IDB4MWU5ODsKICB0LndzdXBlcmlvciA9IDB4MDJiNzsKICB0Lnd0dXJuZWQgPSAweDAyOGQ7CiAgdC53eW5uID0gMHgwMWJmOwogIHQueCA9IDB4MDA3ODsKICB0LnhhYm92ZWNtYiA9IDB4MDMzZDsKICB0Lnhib3BvbW9mbyA9IDB4MzExMjsKICB0LnhjaXJjbGUgPSAweDI0ZTc7CiAgdC54ZGllcmVzaXMgPSAweDFlOGQ7CiAgdC54ZG90YWNjZW50ID0gMHgxZThiOwogIHQueGVoYXJtZW5pYW4gPSAweDA1NmQ7CiAgdC54aSA9IDB4MDNiZTsKICB0Lnhtb25vc3BhY2UgPSAweGZmNTg7CiAgdC54cGFyZW4gPSAweDI0YjM7CiAgdC54c3VwZXJpb3IgPSAweDAyZTM7CiAgdC55ID0gMHgwMDc5OwogIHQueWFhZG9zcXVhcmUgPSAweDMzNGU7CiAgdC55YWJlbmdhbGkgPSAweDA5YWY7CiAgdC55YWN1dGUgPSAweDAwZmQ7CiAgdC55YWRldmEgPSAweDA5MmY7CiAgdC55YWVrb3JlYW4gPSAweDMxNTI7CiAgdC55YWd1amFyYXRpID0gMHgwYWFmOwogIHQueWFndXJtdWtoaSA9IDB4MGEyZjsKICB0LnlhaGlyYWdhbmEgPSAweDMwODQ7CiAgdC55YWthdGFrYW5hID0gMHgzMGU0OwogIHQueWFrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY5NDsKICB0Lnlha29yZWFuID0gMHgzMTUxOwogIHQueWFtYWtrYW50aGFpID0gMHgwZTRlOwogIHQueWFzbWFsbGhpcmFnYW5hID0gMHgzMDgzOwogIHQueWFzbWFsbGthdGFrYW5hID0gMHgzMGUzOwogIHQueWFzbWFsbGthdGFrYW5haGFsZndpZHRoID0gMHhmZjZjOwogIHQueWF0Y3lyaWxsaWMgPSAweDA0NjM7CiAgdC55Y2lyY2xlID0gMHgyNGU4OwogIHQueWNpcmN1bWZsZXggPSAweDAxNzc7CiAgdC55ZGllcmVzaXMgPSAweDAwZmY7CiAgdC55ZG90YWNjZW50ID0gMHgxZThmOwogIHQueWRvdGJlbG93ID0gMHgxZWY1OwogIHQueWVoYXJhYmljID0gMHgwNjRhOwogIHQueWVoYmFycmVlYXJhYmljID0gMHgwNmQyOwogIHQueWVoYmFycmVlZmluYWxhcmFiaWMgPSAweGZiYWY7CiAgdC55ZWhmaW5hbGFyYWJpYyA9IDB4ZmVmMjsKICB0LnllaGhhbXphYWJvdmVhcmFiaWMgPSAweDA2MjY7CiAgdC55ZWhoYW16YWFib3ZlZmluYWxhcmFiaWMgPSAweGZlOGE7CiAgdC55ZWhoYW16YWFib3ZlaW5pdGlhbGFyYWJpYyA9IDB4ZmU4YjsKICB0LnllaGhhbXphYWJvdmVtZWRpYWxhcmFiaWMgPSAweGZlOGM7CiAgdC55ZWhpbml0aWFsYXJhYmljID0gMHhmZWYzOwogIHQueWVobWVkaWFsYXJhYmljID0gMHhmZWY0OwogIHQueWVobWVlbWluaXRpYWxhcmFiaWMgPSAweGZjZGQ7CiAgdC55ZWhtZWVtaXNvbGF0ZWRhcmFiaWMgPSAweGZjNTg7CiAgdC55ZWhub29uZmluYWxhcmFiaWMgPSAweGZjOTQ7CiAgdC55ZWh0aHJlZWRvdHNiZWxvd2FyYWJpYyA9IDB4MDZkMTsKICB0Lnlla29yZWFuID0gMHgzMTU2OwogIHQueWVuID0gMHgwMGE1OwogIHQueWVubW9ub3NwYWNlID0gMHhmZmU1OwogIHQueWVva29yZWFuID0gMHgzMTU1OwogIHQueWVvcmluaGlldWhrb3JlYW4gPSAweDMxODY7CiAgdC55ZXJhaGJlbnlvbW9oZWJyZXcgPSAweDA1YWE7CiAgdC55ZXJhaGJlbnlvbW9sZWZ0aGVicmV3ID0gMHgwNWFhOwogIHQueWVyaWN5cmlsbGljID0gMHgwNDRiOwogIHQueWVydWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0Zjk7CiAgdC55ZXNpZXVuZ2tvcmVhbiA9IDB4MzE4MTsKICB0Lnllc2lldW5ncGFuc2lvc2tvcmVhbiA9IDB4MzE4MzsKICB0Lnllc2lldW5nc2lvc2tvcmVhbiA9IDB4MzE4MjsKICB0LnlldGl2aGVicmV3ID0gMHgwNTlhOwogIHQueWdyYXZlID0gMHgxZWYzOwogIHQueWhvb2sgPSAweDAxYjQ7CiAgdC55aG9va2Fib3ZlID0gMHgxZWY3OwogIHQueWlhcm1lbmlhbiA9IDB4MDU3NTsKICB0LnlpY3lyaWxsaWMgPSAweDA0NTc7CiAgdC55aWtvcmVhbiA9IDB4MzE2MjsKICB0LnlpbnlhbmcgPSAweDI2MmY7CiAgdC55aXduYXJtZW5pYW4gPSAweDA1ODI7CiAgdC55bW9ub3NwYWNlID0gMHhmZjU5OwogIHQueW9kID0gMHgwNWQ5OwogIHQueW9kZGFnZXNoID0gMHhmYjM5OwogIHQueW9kZGFnZXNoaGVicmV3ID0gMHhmYjM5OwogIHQueW9kaGVicmV3ID0gMHgwNWQ5OwogIHQueW9keW9kaGVicmV3ID0gMHgwNWYyOwogIHQueW9keW9kcGF0YWhoZWJyZXcgPSAweGZiMWY7CiAgdC55b2hpcmFnYW5hID0gMHgzMDg4OwogIHQueW9pa29yZWFuID0gMHgzMTg5OwogIHQueW9rYXRha2FuYSA9IDB4MzBlODsKICB0Lnlva2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTY7CiAgdC55b2tvcmVhbiA9IDB4MzE1YjsKICB0Lnlvc21hbGxoaXJhZ2FuYSA9IDB4MzA4NzsKICB0Lnlvc21hbGxrYXRha2FuYSA9IDB4MzBlNzsKICB0Lnlvc21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2ZTsKICB0LnlvdGdyZWVrID0gMHgwM2YzOwogIHQueW95YWVrb3JlYW4gPSAweDMxODg7CiAgdC55b3lha29yZWFuID0gMHgzMTg3OwogIHQueW95YWt0aGFpID0gMHgwZTIyOwogIHQueW95aW5ndGhhaSA9IDB4MGUwZDsKICB0LnlwYXJlbiA9IDB4MjRiNDsKICB0Lnlwb2dlZ3JhbW1lbmkgPSAweDAzN2E7CiAgdC55cG9nZWdyYW1tZW5pZ3JlZWtjbWIgPSAweDAzNDU7CiAgdC55ciA9IDB4MDFhNjsKICB0LnlyaW5nID0gMHgxZTk5OwogIHQueXN1cGVyaW9yID0gMHgwMmI4OwogIHQueXRpbGRlID0gMHgxZWY5OwogIHQueXR1cm5lZCA9IDB4MDI4ZTsKICB0Lnl1aGlyYWdhbmEgPSAweDMwODY7CiAgdC55dWlrb3JlYW4gPSAweDMxOGM7CiAgdC55dWthdGFrYW5hID0gMHgzMGU2OwogIHQueXVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY5NTsKICB0Lnl1a29yZWFuID0gMHgzMTYwOwogIHQueXVzYmlnY3lyaWxsaWMgPSAweDA0NmI7CiAgdC55dXNiaWdpb3RpZmllZGN5cmlsbGljID0gMHgwNDZkOwogIHQueXVzbGl0dGxlY3lyaWxsaWMgPSAweDA0Njc7CiAgdC55dXNsaXR0bGVpb3RpZmllZGN5cmlsbGljID0gMHgwNDY5OwogIHQueXVzbWFsbGhpcmFnYW5hID0gMHgzMDg1OwogIHQueXVzbWFsbGthdGFrYW5hID0gMHgzMGU1OwogIHQueXVzbWFsbGthdGFrYW5haGFsZndpZHRoID0gMHhmZjZkOwogIHQueXV5ZWtvcmVhbiA9IDB4MzE4YjsKICB0Lnl1eWVva29yZWFuID0gMHgzMThhOwogIHQueXlhYmVuZ2FsaSA9IDB4MDlkZjsKICB0Lnl5YWRldmEgPSAweDA5NWY7CiAgdC56ID0gMHgwMDdhOwogIHQuemFhcm1lbmlhbiA9IDB4MDU2NjsKICB0LnphY3V0ZSA9IDB4MDE3YTsKICB0LnphZGV2YSA9IDB4MDk1YjsKICB0LnphZ3VybXVraGkgPSAweDBhNWI7CiAgdC56YWhhcmFiaWMgPSAweDA2Mzg7CiAgdC56YWhmaW5hbGFyYWJpYyA9IDB4ZmVjNjsKICB0LnphaGluaXRpYWxhcmFiaWMgPSAweGZlYzc7CiAgdC56YWhpcmFnYW5hID0gMHgzMDU2OwogIHQuemFobWVkaWFsYXJhYmljID0gMHhmZWM4OwogIHQuemFpbmFyYWJpYyA9IDB4MDYzMjsKICB0LnphaW5maW5hbGFyYWJpYyA9IDB4ZmViMDsKICB0Lnpha2F0YWthbmEgPSAweDMwYjY7CiAgdC56YXFlZmdhZG9saGVicmV3ID0gMHgwNTk1OwogIHQuemFxZWZxYXRhbmhlYnJldyA9IDB4MDU5NDsKICB0LnphcnFhaGVicmV3ID0gMHgwNTk4OwogIHQuemF5aW4gPSAweDA1ZDY7CiAgdC56YXlpbmRhZ2VzaCA9IDB4ZmIzNjsKICB0LnpheWluZGFnZXNoaGVicmV3ID0gMHhmYjM2OwogIHQuemF5aW5oZWJyZXcgPSAweDA1ZDY7CiAgdC56Ym9wb21vZm8gPSAweDMxMTc7CiAgdC56Y2Fyb24gPSAweDAxN2U7CiAgdC56Y2lyY2xlID0gMHgyNGU5OwogIHQuemNpcmN1bWZsZXggPSAweDFlOTE7CiAgdC56Y3VybCA9IDB4MDI5MTsKICB0Lnpkb3QgPSAweDAxN2M7CiAgdC56ZG90YWNjZW50ID0gMHgwMTdjOwogIHQuemRvdGJlbG93ID0gMHgxZTkzOwogIHQuemVjeXJpbGxpYyA9IDB4MDQzNzsKICB0LnplZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0OTk7CiAgdC56ZWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZGY7CiAgdC56ZWhpcmFnYW5hID0gMHgzMDVjOwogIHQuemVrYXRha2FuYSA9IDB4MzBiYzsKICB0Lnplcm8gPSAweDAwMzA7CiAgdC56ZXJvYXJhYmljID0gMHgwNjYwOwogIHQuemVyb2JlbmdhbGkgPSAweDA5ZTY7CiAgdC56ZXJvZGV2YSA9IDB4MDk2NjsKICB0Lnplcm9ndWphcmF0aSA9IDB4MGFlNjsKICB0Lnplcm9ndXJtdWtoaSA9IDB4MGE2NjsKICB0Lnplcm9oYWNrYXJhYmljID0gMHgwNjYwOwogIHQuemVyb2luZmVyaW9yID0gMHgyMDgwOwogIHQuemVyb21vbm9zcGFjZSA9IDB4ZmYxMDsKICB0Lnplcm9vbGRzdHlsZSA9IDB4ZjczMDsKICB0Lnplcm9wZXJzaWFuID0gMHgwNmYwOwogIHQuemVyb3N1cGVyaW9yID0gMHgyMDcwOwogIHQuemVyb3RoYWkgPSAweDBlNTA7CiAgdC56ZXJvd2lkdGhqb2luZXIgPSAweGZlZmY7CiAgdC56ZXJvd2lkdGhub25qb2luZXIgPSAweDIwMGM7CiAgdC56ZXJvd2lkdGhzcGFjZSA9IDB4MjAwYjsKICB0LnpldGEgPSAweDAzYjY7CiAgdC56aGJvcG9tb2ZvID0gMHgzMTEzOwogIHQuemhlYXJtZW5pYW4gPSAweDA1NmE7CiAgdC56aGVicmV2ZWN5cmlsbGljID0gMHgwNGMyOwogIHQuemhlY3lyaWxsaWMgPSAweDA0MzY7CiAgdC56aGVkZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDQ5NzsKICB0LnpoZWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZGQ7CiAgdC56aWhpcmFnYW5hID0gMHgzMDU4OwogIHQuemlrYXRha2FuYSA9IDB4MzBiODsKICB0Lnppbm9yaGVicmV3ID0gMHgwNWFlOwogIHQuemxpbmViZWxvdyA9IDB4MWU5NTsKICB0Lnptb25vc3BhY2UgPSAweGZmNWE7CiAgdC56b2hpcmFnYW5hID0gMHgzMDVlOwogIHQuem9rYXRha2FuYSA9IDB4MzBiZTsKICB0LnpwYXJlbiA9IDB4MjRiNTsKICB0LnpyZXRyb2ZsZXhob29rID0gMHgwMjkwOwogIHQuenN0cm9rZSA9IDB4MDFiNjsKICB0Lnp1aGlyYWdhbmEgPSAweDMwNWE7CiAgdC56dWthdGFrYW5hID0gMHgzMGJhOwogIHRbIi5ub3RkZWYiXSA9IDB4MDAwMDsKICB0LmFuZ2JyYWNrZXRsZWZ0YmlnID0gMHgyMzI5OwogIHQuYW5nYnJhY2tldGxlZnRCaWcgPSAweDIzMjk7CiAgdC5hbmdicmFja2V0bGVmdGJpZ2cgPSAweDIzMjk7CiAgdC5hbmdicmFja2V0bGVmdEJpZ2cgPSAweDIzMjk7CiAgdC5hbmdicmFja2V0cmlnaHRCaWcgPSAweDIzMmE7CiAgdC5hbmdicmFja2V0cmlnaHRiaWcgPSAweDIzMmE7CiAgdC5hbmdicmFja2V0cmlnaHRCaWdnID0gMHgyMzJhOwogIHQuYW5nYnJhY2tldHJpZ2h0YmlnZyA9IDB4MjMyYTsKICB0LmFycm93aG9va2xlZnQgPSAweDIxYWE7CiAgdC5hcnJvd2hvb2tyaWdodCA9IDB4MjFhOTsKICB0LmFycm93bGVmdHRvcGhhbGYgPSAweDIxYmM7CiAgdC5hcnJvd2xlZnRib3RoYWxmID0gMHgyMWJkOwogIHQuYXJyb3dub3J0aGVhc3QgPSAweDIxOTc7CiAgdC5hcnJvd25vcnRod2VzdCA9IDB4MjE5NjsKICB0LmFycm93cmlnaHR0b3BoYWxmID0gMHgyMWMwOwogIHQuYXJyb3dyaWdodGJvdGhhbGYgPSAweDIxYzE7CiAgdC5hcnJvd3NvdXRoZWFzdCA9IDB4MjE5ODsKICB0LmFycm93c291dGh3ZXN0ID0gMHgyMTk5OwogIHQuYmFja3NsYXNoYmlnID0gMHgyMjE2OwogIHQuYmFja3NsYXNoQmlnID0gMHgyMjE2OwogIHQuYmFja3NsYXNoQmlnZyA9IDB4MjIxNjsKICB0LmJhY2tzbGFzaGJpZ2cgPSAweDIyMTY7CiAgdC5iYXJkYmwgPSAweDIwMTY7CiAgdC5icmFjZWh0aXBkb3dubGVmdCA9IDB4ZmUzNzsKICB0LmJyYWNlaHRpcGRvd25yaWdodCA9IDB4ZmUzNzsKICB0LmJyYWNlaHRpcHVwbGVmdCA9IDB4ZmUzODsKICB0LmJyYWNlaHRpcHVwcmlnaHQgPSAweGZlMzg7CiAgdC5icmFjZWxlZnRCaWcgPSAweDAwN2I7CiAgdC5icmFjZWxlZnRiaWcgPSAweDAwN2I7CiAgdC5icmFjZWxlZnRiaWdnID0gMHgwMDdiOwogIHQuYnJhY2VsZWZ0QmlnZyA9IDB4MDA3YjsKICB0LmJyYWNlcmlnaHRCaWcgPSAweDAwN2Q7CiAgdC5icmFjZXJpZ2h0YmlnID0gMHgwMDdkOwogIHQuYnJhY2VyaWdodGJpZ2cgPSAweDAwN2Q7CiAgdC5icmFjZXJpZ2h0QmlnZyA9IDB4MDA3ZDsKICB0LmJyYWNrZXRsZWZ0YmlnID0gMHgwMDViOwogIHQuYnJhY2tldGxlZnRCaWcgPSAweDAwNWI7CiAgdC5icmFja2V0bGVmdGJpZ2cgPSAweDAwNWI7CiAgdC5icmFja2V0bGVmdEJpZ2cgPSAweDAwNWI7CiAgdC5icmFja2V0cmlnaHRCaWcgPSAweDAwNWQ7CiAgdC5icmFja2V0cmlnaHRiaWcgPSAweDAwNWQ7CiAgdC5icmFja2V0cmlnaHRiaWdnID0gMHgwMDVkOwogIHQuYnJhY2tldHJpZ2h0QmlnZyA9IDB4MDA1ZDsKICB0LmNlaWxpbmdsZWZ0YmlnID0gMHgyMzA4OwogIHQuY2VpbGluZ2xlZnRCaWcgPSAweDIzMDg7CiAgdC5jZWlsaW5nbGVmdEJpZ2cgPSAweDIzMDg7CiAgdC5jZWlsaW5nbGVmdGJpZ2cgPSAweDIzMDg7CiAgdC5jZWlsaW5ncmlnaHRiaWcgPSAweDIzMDk7CiAgdC5jZWlsaW5ncmlnaHRCaWcgPSAweDIzMDk7CiAgdC5jZWlsaW5ncmlnaHRiaWdnID0gMHgyMzA5OwogIHQuY2VpbGluZ3JpZ2h0QmlnZyA9IDB4MjMwOTsKICB0LmNpcmNsZWRvdGRpc3BsYXkgPSAweDIyOTk7CiAgdC5jaXJjbGVkb3R0ZXh0ID0gMHgyMjk5OwogIHQuY2lyY2xlbXVsdGlwbHlkaXNwbGF5ID0gMHgyMjk3OwogIHQuY2lyY2xlbXVsdGlwbHl0ZXh0ID0gMHgyMjk3OwogIHQuY2lyY2xlcGx1c2Rpc3BsYXkgPSAweDIyOTU7CiAgdC5jaXJjbGVwbHVzdGV4dCA9IDB4MjI5NTsKICB0LmNvbnRpbnRlZ3JhbGRpc3BsYXkgPSAweDIyMmU7CiAgdC5jb250aW50ZWdyYWx0ZXh0ID0gMHgyMjJlOwogIHQuY29wcm9kdWN0ZGlzcGxheSA9IDB4MjIxMDsKICB0LmNvcHJvZHVjdHRleHQgPSAweDIyMTA7CiAgdC5mbG9vcmxlZnRCaWcgPSAweDIzMGE7CiAgdC5mbG9vcmxlZnRiaWcgPSAweDIzMGE7CiAgdC5mbG9vcmxlZnRiaWdnID0gMHgyMzBhOwogIHQuZmxvb3JsZWZ0QmlnZyA9IDB4MjMwYTsKICB0LmZsb29ycmlnaHRiaWcgPSAweDIzMGI7CiAgdC5mbG9vcnJpZ2h0QmlnID0gMHgyMzBiOwogIHQuZmxvb3JyaWdodEJpZ2cgPSAweDIzMGI7CiAgdC5mbG9vcnJpZ2h0YmlnZyA9IDB4MjMwYjsKICB0LmhhdHdpZGUgPSAweDAzMDI7CiAgdC5oYXR3aWRlciA9IDB4MDMwMjsKICB0LmhhdHdpZGVzdCA9IDB4MDMwMjsKICB0LmludGVyY2FsID0gMHgxZDQwOwogIHQuaW50ZWdyYWxkaXNwbGF5ID0gMHgyMjJiOwogIHQuaW50ZWdyYWx0ZXh0ID0gMHgyMjJiOwogIHQuaW50ZXJzZWN0aW9uZGlzcGxheSA9IDB4MjJjMjsKICB0LmludGVyc2VjdGlvbnRleHQgPSAweDIyYzI7CiAgdC5sb2dpY2FsYW5kZGlzcGxheSA9IDB4MjIyNzsKICB0LmxvZ2ljYWxhbmR0ZXh0ID0gMHgyMjI3OwogIHQubG9naWNhbG9yZGlzcGxheSA9IDB4MjIyODsKICB0LmxvZ2ljYWxvcnRleHQgPSAweDIyMjg7CiAgdC5wYXJlbmxlZnRCaWcgPSAweDAwMjg7CiAgdC5wYXJlbmxlZnRiaWcgPSAweDAwMjg7CiAgdC5wYXJlbmxlZnRCaWdnID0gMHgwMDI4OwogIHQucGFyZW5sZWZ0YmlnZyA9IDB4MDAyODsKICB0LnBhcmVucmlnaHRCaWcgPSAweDAwMjk7CiAgdC5wYXJlbnJpZ2h0YmlnID0gMHgwMDI5OwogIHQucGFyZW5yaWdodEJpZ2cgPSAweDAwMjk7CiAgdC5wYXJlbnJpZ2h0YmlnZyA9IDB4MDAyOTsKICB0LnByaW1lID0gMHgyMDMyOwogIHQucHJvZHVjdGRpc3BsYXkgPSAweDIyMGY7CiAgdC5wcm9kdWN0dGV4dCA9IDB4MjIwZjsKICB0LnJhZGljYWxiaWcgPSAweDIyMWE7CiAgdC5yYWRpY2FsQmlnID0gMHgyMjFhOwogIHQucmFkaWNhbEJpZ2cgPSAweDIyMWE7CiAgdC5yYWRpY2FsYmlnZyA9IDB4MjIxYTsKICB0LnJhZGljYWxidCA9IDB4MjIxYTsKICB0LnJhZGljYWx0cCA9IDB4MjIxYTsKICB0LnJhZGljYWx2ZXJ0ZXggPSAweDIyMWE7CiAgdC5zbGFzaGJpZyA9IDB4MDAyZjsKICB0LnNsYXNoQmlnID0gMHgwMDJmOwogIHQuc2xhc2hCaWdnID0gMHgwMDJmOwogIHQuc2xhc2hiaWdnID0gMHgwMDJmOwogIHQuc3VtbWF0aW9uZGlzcGxheSA9IDB4MjIxMTsKICB0LnN1bW1hdGlvbnRleHQgPSAweDIyMTE7CiAgdC50aWxkZXdpZGUgPSAweDAyZGM7CiAgdC50aWxkZXdpZGVyID0gMHgwMmRjOwogIHQudGlsZGV3aWRlc3QgPSAweDAyZGM7CiAgdC51bmlvbmRpc3BsYXkgPSAweDIyYzM7CiAgdC51bmlvbm11bHRpZGlzcGxheSA9IDB4MjI4ZTsKICB0LnVuaW9ubXVsdGl0ZXh0ID0gMHgyMjhlOwogIHQudW5pb25zcWRpc3BsYXkgPSAweDIyOTQ7CiAgdC51bmlvbnNxdGV4dCA9IDB4MjI5NDsKICB0LnVuaW9udGV4dCA9IDB4MjJjMzsKICB0LnZleHRlbmRkb3VibGUgPSAweDIyMjU7CiAgdC52ZXh0ZW5kc2luZ2xlID0gMHgyMjIzOwp9KTsKY29uc3QgZ2V0RGluZ2JhdHNHbHlwaHNVbmljb2RlID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgdC5zcGFjZSA9IDB4MDAyMDsKICB0LmExID0gMHgyNzAxOwogIHQuYTIgPSAweDI3MDI7CiAgdC5hMjAyID0gMHgyNzAzOwogIHQuYTMgPSAweDI3MDQ7CiAgdC5hNCA9IDB4MjYwZTsKICB0LmE1ID0gMHgyNzA2OwogIHQuYTExOSA9IDB4MjcwNzsKICB0LmExMTggPSAweDI3MDg7CiAgdC5hMTE3ID0gMHgyNzA5OwogIHQuYTExID0gMHgyNjFiOwogIHQuYTEyID0gMHgyNjFlOwogIHQuYTEzID0gMHgyNzBjOwogIHQuYTE0ID0gMHgyNzBkOwogIHQuYTE1ID0gMHgyNzBlOwogIHQuYTE2ID0gMHgyNzBmOwogIHQuYTEwNSA9IDB4MjcxMDsKICB0LmExNyA9IDB4MjcxMTsKICB0LmExOCA9IDB4MjcxMjsKICB0LmExOSA9IDB4MjcxMzsKICB0LmEyMCA9IDB4MjcxNDsKICB0LmEyMSA9IDB4MjcxNTsKICB0LmEyMiA9IDB4MjcxNjsKICB0LmEyMyA9IDB4MjcxNzsKICB0LmEyNCA9IDB4MjcxODsKICB0LmEyNSA9IDB4MjcxOTsKICB0LmEyNiA9IDB4MjcxYTsKICB0LmEyNyA9IDB4MjcxYjsKICB0LmEyOCA9IDB4MjcxYzsKICB0LmE2ID0gMHgyNzFkOwogIHQuYTcgPSAweDI3MWU7CiAgdC5hOCA9IDB4MjcxZjsKICB0LmE5ID0gMHgyNzIwOwogIHQuYTEwID0gMHgyNzIxOwogIHQuYTI5ID0gMHgyNzIyOwogIHQuYTMwID0gMHgyNzIzOwogIHQuYTMxID0gMHgyNzI0OwogIHQuYTMyID0gMHgyNzI1OwogIHQuYTMzID0gMHgyNzI2OwogIHQuYTM0ID0gMHgyNzI3OwogIHQuYTM1ID0gMHgyNjA1OwogIHQuYTM2ID0gMHgyNzI5OwogIHQuYTM3ID0gMHgyNzJhOwogIHQuYTM4ID0gMHgyNzJiOwogIHQuYTM5ID0gMHgyNzJjOwogIHQuYTQwID0gMHgyNzJkOwogIHQuYTQxID0gMHgyNzJlOwogIHQuYTQyID0gMHgyNzJmOwogIHQuYTQzID0gMHgyNzMwOwogIHQuYTQ0ID0gMHgyNzMxOwogIHQuYTQ1ID0gMHgyNzMyOwogIHQuYTQ2ID0gMHgyNzMzOwogIHQuYTQ3ID0gMHgyNzM0OwogIHQuYTQ4ID0gMHgyNzM1OwogIHQuYTQ5ID0gMHgyNzM2OwogIHQuYTUwID0gMHgyNzM3OwogIHQuYTUxID0gMHgyNzM4OwogIHQuYTUyID0gMHgyNzM5OwogIHQuYTUzID0gMHgyNzNhOwogIHQuYTU0ID0gMHgyNzNiOwogIHQuYTU1ID0gMHgyNzNjOwogIHQuYTU2ID0gMHgyNzNkOwogIHQuYTU3ID0gMHgyNzNlOwogIHQuYTU4ID0gMHgyNzNmOwogIHQuYTU5ID0gMHgyNzQwOwogIHQuYTYwID0gMHgyNzQxOwogIHQuYTYxID0gMHgyNzQyOwogIHQuYTYyID0gMHgyNzQzOwogIHQuYTYzID0gMHgyNzQ0OwogIHQuYTY0ID0gMHgyNzQ1OwogIHQuYTY1ID0gMHgyNzQ2OwogIHQuYTY2ID0gMHgyNzQ3OwogIHQuYTY3ID0gMHgyNzQ4OwogIHQuYTY4ID0gMHgyNzQ5OwogIHQuYTY5ID0gMHgyNzRhOwogIHQuYTcwID0gMHgyNzRiOwogIHQuYTcxID0gMHgyNWNmOwogIHQuYTcyID0gMHgyNzRkOwogIHQuYTczID0gMHgyNWEwOwogIHQuYTc0ID0gMHgyNzRmOwogIHQuYTIwMyA9IDB4Mjc1MDsKICB0LmE3NSA9IDB4Mjc1MTsKICB0LmEyMDQgPSAweDI3NTI7CiAgdC5hNzYgPSAweDI1YjI7CiAgdC5hNzcgPSAweDI1YmM7CiAgdC5hNzggPSAweDI1YzY7CiAgdC5hNzkgPSAweDI3NTY7CiAgdC5hODEgPSAweDI1ZDc7CiAgdC5hODIgPSAweDI3NTg7CiAgdC5hODMgPSAweDI3NTk7CiAgdC5hODQgPSAweDI3NWE7CiAgdC5hOTcgPSAweDI3NWI7CiAgdC5hOTggPSAweDI3NWM7CiAgdC5hOTkgPSAweDI3NWQ7CiAgdC5hMTAwID0gMHgyNzVlOwogIHQuYTEwMSA9IDB4Mjc2MTsKICB0LmExMDIgPSAweDI3NjI7CiAgdC5hMTAzID0gMHgyNzYzOwogIHQuYTEwNCA9IDB4Mjc2NDsKICB0LmExMDYgPSAweDI3NjU7CiAgdC5hMTA3ID0gMHgyNzY2OwogIHQuYTEwOCA9IDB4Mjc2NzsKICB0LmExMTIgPSAweDI2NjM7CiAgdC5hMTExID0gMHgyNjY2OwogIHQuYTExMCA9IDB4MjY2NTsKICB0LmExMDkgPSAweDI2NjA7CiAgdC5hMTIwID0gMHgyNDYwOwogIHQuYTEyMSA9IDB4MjQ2MTsKICB0LmExMjIgPSAweDI0NjI7CiAgdC5hMTIzID0gMHgyNDYzOwogIHQuYTEyNCA9IDB4MjQ2NDsKICB0LmExMjUgPSAweDI0NjU7CiAgdC5hMTI2ID0gMHgyNDY2OwogIHQuYTEyNyA9IDB4MjQ2NzsKICB0LmExMjggPSAweDI0Njg7CiAgdC5hMTI5ID0gMHgyNDY5OwogIHQuYTEzMCA9IDB4Mjc3NjsKICB0LmExMzEgPSAweDI3Nzc7CiAgdC5hMTMyID0gMHgyNzc4OwogIHQuYTEzMyA9IDB4Mjc3OTsKICB0LmExMzQgPSAweDI3N2E7CiAgdC5hMTM1ID0gMHgyNzdiOwogIHQuYTEzNiA9IDB4Mjc3YzsKICB0LmExMzcgPSAweDI3N2Q7CiAgdC5hMTM4ID0gMHgyNzdlOwogIHQuYTEzOSA9IDB4Mjc3ZjsKICB0LmExNDAgPSAweDI3ODA7CiAgdC5hMTQxID0gMHgyNzgxOwogIHQuYTE0MiA9IDB4Mjc4MjsKICB0LmExNDMgPSAweDI3ODM7CiAgdC5hMTQ0ID0gMHgyNzg0OwogIHQuYTE0NSA9IDB4Mjc4NTsKICB0LmExNDYgPSAweDI3ODY7CiAgdC5hMTQ3ID0gMHgyNzg3OwogIHQuYTE0OCA9IDB4Mjc4ODsKICB0LmExNDkgPSAweDI3ODk7CiAgdC5hMTUwID0gMHgyNzhhOwogIHQuYTE1MSA9IDB4Mjc4YjsKICB0LmExNTIgPSAweDI3OGM7CiAgdC5hMTUzID0gMHgyNzhkOwogIHQuYTE1NCA9IDB4Mjc4ZTsKICB0LmExNTUgPSAweDI3OGY7CiAgdC5hMTU2ID0gMHgyNzkwOwogIHQuYTE1NyA9IDB4Mjc5MTsKICB0LmExNTggPSAweDI3OTI7CiAgdC5hMTU5ID0gMHgyNzkzOwogIHQuYTE2MCA9IDB4Mjc5NDsKICB0LmExNjEgPSAweDIxOTI7CiAgdC5hMTYzID0gMHgyMTk0OwogIHQuYTE2NCA9IDB4MjE5NTsKICB0LmExOTYgPSAweDI3OTg7CiAgdC5hMTY1ID0gMHgyNzk5OwogIHQuYTE5MiA9IDB4Mjc5YTsKICB0LmExNjYgPSAweDI3OWI7CiAgdC5hMTY3ID0gMHgyNzljOwogIHQuYTE2OCA9IDB4Mjc5ZDsKICB0LmExNjkgPSAweDI3OWU7CiAgdC5hMTcwID0gMHgyNzlmOwogIHQuYTE3MSA9IDB4MjdhMDsKICB0LmExNzIgPSAweDI3YTE7CiAgdC5hMTczID0gMHgyN2EyOwogIHQuYTE2MiA9IDB4MjdhMzsKICB0LmExNzQgPSAweDI3YTQ7CiAgdC5hMTc1ID0gMHgyN2E1OwogIHQuYTE3NiA9IDB4MjdhNjsKICB0LmExNzcgPSAweDI3YTc7CiAgdC5hMTc4ID0gMHgyN2E4OwogIHQuYTE3OSA9IDB4MjdhOTsKICB0LmExOTMgPSAweDI3YWE7CiAgdC5hMTgwID0gMHgyN2FiOwogIHQuYTE5OSA9IDB4MjdhYzsKICB0LmExODEgPSAweDI3YWQ7CiAgdC5hMjAwID0gMHgyN2FlOwogIHQuYTE4MiA9IDB4MjdhZjsKICB0LmEyMDEgPSAweDI3YjE7CiAgdC5hMTgzID0gMHgyN2IyOwogIHQuYTE4NCA9IDB4MjdiMzsKICB0LmExOTcgPSAweDI3YjQ7CiAgdC5hMTg1ID0gMHgyN2I1OwogIHQuYTE5NCA9IDB4MjdiNjsKICB0LmExOTggPSAweDI3Yjc7CiAgdC5hMTg2ID0gMHgyN2I4OwogIHQuYTE5NSA9IDB4MjdiOTsKICB0LmExODcgPSAweDI3YmE7CiAgdC5hMTg4ID0gMHgyN2JiOwogIHQuYTE4OSA9IDB4MjdiYzsKICB0LmExOTAgPSAweDI3YmQ7CiAgdC5hMTkxID0gMHgyN2JlOwogIHQuYTg5ID0gMHgyNzY4OwogIHQuYTkwID0gMHgyNzY5OwogIHQuYTkzID0gMHgyNzZhOwogIHQuYTk0ID0gMHgyNzZiOwogIHQuYTkxID0gMHgyNzZjOwogIHQuYTkyID0gMHgyNzZkOwogIHQuYTIwNSA9IDB4Mjc2ZTsKICB0LmE4NSA9IDB4Mjc2ZjsKICB0LmEyMDYgPSAweDI3NzA7CiAgdC5hODYgPSAweDI3NzE7CiAgdC5hODcgPSAweDI3NzI7CiAgdC5hODggPSAweDI3NzM7CiAgdC5hOTUgPSAweDI3NzQ7CiAgdC5hOTYgPSAweDI3NzU7CiAgdFsiLm5vdGRlZiJdID0gMHgwMDAwOwp9KTsKCjsvLyAuL3NyYy9jb3JlL3VuaWNvZGUuanMKCmNvbnN0IGdldFNwZWNpYWxQVUFTeW1ib2xzID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgdFs2MzcyMV0gPSAweDAwYTk7CiAgdFs2MzE5M10gPSAweDAwYTk7CiAgdFs2MzcyMF0gPSAweDAwYWU7CiAgdFs2MzE5NF0gPSAweDAwYWU7CiAgdFs2MzcyMl0gPSAweDIxMjI7CiAgdFs2MzE5NV0gPSAweDIxMjI7CiAgdFs2MzcyOV0gPSAweDIzYTc7CiAgdFs2MzczMF0gPSAweDIzYTg7CiAgdFs2MzczMV0gPSAweDIzYTk7CiAgdFs2Mzc0MF0gPSAweDIzYWI7CiAgdFs2Mzc0MV0gPSAweDIzYWM7CiAgdFs2Mzc0Ml0gPSAweDIzYWQ7CiAgdFs2MzcyNl0gPSAweDIzYTE7CiAgdFs2MzcyN10gPSAweDIzYTI7CiAgdFs2MzcyOF0gPSAweDIzYTM7CiAgdFs2MzczN10gPSAweDIzYTQ7CiAgdFs2MzczOF0gPSAweDIzYTU7CiAgdFs2MzczOV0gPSAweDIzYTY7CiAgdFs2MzcyM10gPSAweDIzOWI7CiAgdFs2MzcyNF0gPSAweDIzOWM7CiAgdFs2MzcyNV0gPSAweDIzOWQ7CiAgdFs2MzczNF0gPSAweDIzOWU7CiAgdFs2MzczNV0gPSAweDIzOWY7CiAgdFs2MzczNl0gPSAweDIzYTA7Cn0pOwpmdW5jdGlvbiBtYXBTcGVjaWFsVW5pY29kZVZhbHVlcyhjb2RlKSB7CiAgaWYgKGNvZGUgPj0gMHhmZmYwICYmIGNvZGUgPD0gMHhmZmZmKSB7CiAgICByZXR1cm4gMDsKICB9IGVsc2UgaWYgKGNvZGUgPj0gMHhmNjAwICYmIGNvZGUgPD0gMHhmOGZmKSB7CiAgICByZXR1cm4gZ2V0U3BlY2lhbFBVQVN5bWJvbHMoKVtjb2RlXSB8fCBjb2RlOwogIH0gZWxzZSBpZiAoY29kZSA9PT0gMHgwMGFkKSB7CiAgICByZXR1cm4gMHgwMDJkOwogIH0KICByZXR1cm4gY29kZTsKfQpmdW5jdGlvbiBnZXRVbmljb2RlRm9yR2x5cGgobmFtZSwgZ2x5cGhzVW5pY29kZU1hcCkgewogIGxldCB1bmljb2RlID0gZ2x5cGhzVW5pY29kZU1hcFtuYW1lXTsKICBpZiAodW5pY29kZSAhPT0gdW5kZWZpbmVkKSB7CiAgICByZXR1cm4gdW5pY29kZTsKICB9CiAgaWYgKCFuYW1lKSB7CiAgICByZXR1cm4gLTE7CiAgfQogIGlmIChuYW1lWzBdID09PSAidSIpIHsKICAgIGNvbnN0IG5hbWVMZW4gPSBuYW1lLmxlbmd0aDsKICAgIGxldCBoZXhTdHI7CiAgICBpZiAobmFtZUxlbiA9PT0gNyAmJiBuYW1lWzFdID09PSAibiIgJiYgbmFtZVsyXSA9PT0gImkiKSB7CiAgICAgIGhleFN0ciA9IG5hbWUuc3Vic3RyaW5nKDMpOwogICAgfSBlbHNlIGlmIChuYW1lTGVuID49IDUgJiYgbmFtZUxlbiA8PSA3KSB7CiAgICAgIGhleFN0ciA9IG5hbWUuc3Vic3RyaW5nKDEpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgaWYgKGhleFN0ciA9PT0gaGV4U3RyLnRvVXBwZXJDYXNlKCkpIHsKICAgICAgdW5pY29kZSA9IHBhcnNlSW50KGhleFN0ciwgMTYpOwogICAgICBpZiAodW5pY29kZSA+PSAwKSB7CiAgICAgICAgcmV0dXJuIHVuaWNvZGU7CiAgICAgIH0KICAgIH0KICB9CiAgcmV0dXJuIC0xOwp9CmNvbnN0IFVuaWNvZGVSYW5nZXMgPSBbWzB4MDAwMCwgMHgwMDdmXSwgWzB4MDA4MCwgMHgwMGZmXSwgWzB4MDEwMCwgMHgwMTdmXSwgWzB4MDE4MCwgMHgwMjRmXSwgWzB4MDI1MCwgMHgwMmFmLCAweDFkMDAsIDB4MWQ3ZiwgMHgxZDgwLCAweDFkYmZdLCBbMHgwMmIwLCAweDAyZmYsIDB4YTcwMCwgMHhhNzFmXSwgWzB4MDMwMCwgMHgwMzZmLCAweDFkYzAsIDB4MWRmZl0sIFsweDAzNzAsIDB4MDNmZl0sIFsweDJjODAsIDB4MmNmZl0sIFsweDA0MDAsIDB4MDRmZiwgMHgwNTAwLCAweDA1MmYsIDB4MmRlMCwgMHgyZGZmLCAweGE2NDAsIDB4YTY5Zl0sIFsweDA1MzAsIDB4MDU4Zl0sIFsweDA1OTAsIDB4MDVmZl0sIFsweGE1MDAsIDB4YTYzZl0sIFsweDA2MDAsIDB4MDZmZiwgMHgwNzUwLCAweDA3N2ZdLCBbMHgwN2MwLCAweDA3ZmZdLCBbMHgwOTAwLCAweDA5N2ZdLCBbMHgwOTgwLCAweDA5ZmZdLCBbMHgwYTAwLCAweDBhN2ZdLCBbMHgwYTgwLCAweDBhZmZdLCBbMHgwYjAwLCAweDBiN2ZdLCBbMHgwYjgwLCAweDBiZmZdLCBbMHgwYzAwLCAweDBjN2ZdLCBbMHgwYzgwLCAweDBjZmZdLCBbMHgwZDAwLCAweDBkN2ZdLCBbMHgwZTAwLCAweDBlN2ZdLCBbMHgwZTgwLCAweDBlZmZdLCBbMHgxMGEwLCAweDEwZmYsIDB4MmQwMCwgMHgyZDJmXSwgWzB4MWIwMCwgMHgxYjdmXSwgWzB4MTEwMCwgMHgxMWZmXSwgWzB4MWUwMCwgMHgxZWZmLCAweDJjNjAsIDB4MmM3ZiwgMHhhNzIwLCAweGE3ZmZdLCBbMHgxZjAwLCAweDFmZmZdLCBbMHgyMDAwLCAweDIwNmYsIDB4MmUwMCwgMHgyZTdmXSwgWzB4MjA3MCwgMHgyMDlmXSwgWzB4MjBhMCwgMHgyMGNmXSwgWzB4MjBkMCwgMHgyMGZmXSwgWzB4MjEwMCwgMHgyMTRmXSwgWzB4MjE1MCwgMHgyMThmXSwgWzB4MjE5MCwgMHgyMWZmLCAweDI3ZjAsIDB4MjdmZiwgMHgyOTAwLCAweDI5N2YsIDB4MmIwMCwgMHgyYmZmXSwgWzB4MjIwMCwgMHgyMmZmLCAweDJhMDAsIDB4MmFmZiwgMHgyN2MwLCAweDI3ZWYsIDB4Mjk4MCwgMHgyOWZmXSwgWzB4MjMwMCwgMHgyM2ZmXSwgWzB4MjQwMCwgMHgyNDNmXSwgWzB4MjQ0MCwgMHgyNDVmXSwgWzB4MjQ2MCwgMHgyNGZmXSwgWzB4MjUwMCwgMHgyNTdmXSwgWzB4MjU4MCwgMHgyNTlmXSwgWzB4MjVhMCwgMHgyNWZmXSwgWzB4MjYwMCwgMHgyNmZmXSwgWzB4MjcwMCwgMHgyN2JmXSwgWzB4MzAwMCwgMHgzMDNmXSwgWzB4MzA0MCwgMHgzMDlmXSwgWzB4MzBhMCwgMHgzMGZmLCAweDMxZjAsIDB4MzFmZl0sIFsweDMxMDAsIDB4MzEyZiwgMHgzMWEwLCAweDMxYmZdLCBbMHgzMTMwLCAweDMxOGZdLCBbMHhhODQwLCAweGE4N2ZdLCBbMHgzMjAwLCAweDMyZmZdLCBbMHgzMzAwLCAweDMzZmZdLCBbMHhhYzAwLCAweGQ3YWZdLCBbMHhkODAwLCAweGRmZmZdLCBbMHgxMDkwMCwgMHgxMDkxZl0sIFsweDRlMDAsIDB4OWZmZiwgMHgyZTgwLCAweDJlZmYsIDB4MmYwMCwgMHgyZmRmLCAweDJmZjAsIDB4MmZmZiwgMHgzNDAwLCAweDRkYmYsIDB4MjAwMDAsIDB4MmE2ZGYsIDB4MzE5MCwgMHgzMTlmXSwgWzB4ZTAwMCwgMHhmOGZmXSwgWzB4MzFjMCwgMHgzMWVmLCAweGY5MDAsIDB4ZmFmZiwgMHgyZjgwMCwgMHgyZmExZl0sIFsweGZiMDAsIDB4ZmI0Zl0sIFsweGZiNTAsIDB4ZmRmZl0sIFsweGZlMjAsIDB4ZmUyZl0sIFsweGZlMTAsIDB4ZmUxZl0sIFsweGZlNTAsIDB4ZmU2Zl0sIFsweGZlNzAsIDB4ZmVmZl0sIFsweGZmMDAsIDB4ZmZlZl0sIFsweGZmZjAsIDB4ZmZmZl0sIFsweDBmMDAsIDB4MGZmZl0sIFsweDA3MDAsIDB4MDc0Zl0sIFsweDA3ODAsIDB4MDdiZl0sIFsweDBkODAsIDB4MGRmZl0sIFsweDEwMDAsIDB4MTA5Zl0sIFsweDEyMDAsIDB4MTM3ZiwgMHgxMzgwLCAweDEzOWYsIDB4MmQ4MCwgMHgyZGRmXSwgWzB4MTNhMCwgMHgxM2ZmXSwgWzB4MTQwMCwgMHgxNjdmXSwgWzB4MTY4MCwgMHgxNjlmXSwgWzB4MTZhMCwgMHgxNmZmXSwgWzB4MTc4MCwgMHgxN2ZmXSwgWzB4MTgwMCwgMHgxOGFmXSwgWzB4MjgwMCwgMHgyOGZmXSwgWzB4YTAwMCwgMHhhNDhmXSwgWzB4MTcwMCwgMHgxNzFmLCAweDE3MjAsIDB4MTczZiwgMHgxNzQwLCAweDE3NWYsIDB4MTc2MCwgMHgxNzdmXSwgWzB4MTAzMDAsIDB4MTAzMmZdLCBbMHgxMDMzMCwgMHgxMDM0Zl0sIFsweDEwNDAwLCAweDEwNDRmXSwgWzB4MWQwMDAsIDB4MWQwZmYsIDB4MWQxMDAsIDB4MWQxZmYsIDB4MWQyMDAsIDB4MWQyNGZdLCBbMHgxZDQwMCwgMHgxZDdmZl0sIFsweGZmMDAwLCAweGZmZmZkXSwgWzB4ZmUwMCwgMHhmZTBmLCAweGUwMTAwLCAweGUwMWVmXSwgWzB4ZTAwMDAsIDB4ZTAwN2ZdLCBbMHgxOTAwLCAweDE5NGZdLCBbMHgxOTUwLCAweDE5N2ZdLCBbMHgxOTgwLCAweDE5ZGZdLCBbMHgxYTAwLCAweDFhMWZdLCBbMHgyYzAwLCAweDJjNWZdLCBbMHgyZDMwLCAweDJkN2ZdLCBbMHg0ZGMwLCAweDRkZmZdLCBbMHhhODAwLCAweGE4MmZdLCBbMHgxMDAwMCwgMHgxMDA3ZiwgMHgxMDA4MCwgMHgxMDBmZiwgMHgxMDEwMCwgMHgxMDEzZl0sIFsweDEwMTQwLCAweDEwMThmXSwgWzB4MTAzODAsIDB4MTAzOWZdLCBbMHgxMDNhMCwgMHgxMDNkZl0sIFsweDEwNDUwLCAweDEwNDdmXSwgWzB4MTA0ODAsIDB4MTA0YWZdLCBbMHgxMDgwMCwgMHgxMDgzZl0sIFsweDEwYTAwLCAweDEwYTVmXSwgWzB4MWQzMDAsIDB4MWQzNWZdLCBbMHgxMjAwMCwgMHgxMjNmZiwgMHgxMjQwMCwgMHgxMjQ3Zl0sIFsweDFkMzYwLCAweDFkMzdmXSwgWzB4MWI4MCwgMHgxYmJmXSwgWzB4MWMwMCwgMHgxYzRmXSwgWzB4MWM1MCwgMHgxYzdmXSwgWzB4YTg4MCwgMHhhOGRmXSwgWzB4YTkwMCwgMHhhOTJmXSwgWzB4YTkzMCwgMHhhOTVmXSwgWzB4YWEwMCwgMHhhYTVmXSwgWzB4MTAxOTAsIDB4MTAxY2ZdLCBbMHgxMDFkMCwgMHgxMDFmZl0sIFsweDEwMmEwLCAweDEwMmRmLCAweDEwMjgwLCAweDEwMjlmLCAweDEwOTIwLCAweDEwOTNmXSwgWzB4MWYwMzAsIDB4MWYwOWYsIDB4MWYwMDAsIDB4MWYwMmZdXTsKZnVuY3Rpb24gZ2V0VW5pY29kZVJhbmdlRm9yKHZhbHVlLCBsYXN0UG9zaXRpb24gPSAtMSkgewogIGlmIChsYXN0UG9zaXRpb24gIT09IC0xKSB7CiAgICBjb25zdCByYW5nZSA9IFVuaWNvZGVSYW5nZXNbbGFzdFBvc2l0aW9uXTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHJhbmdlLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgaWYgKHZhbHVlID49IHJhbmdlW2ldICYmIHZhbHVlIDw9IHJhbmdlW2kgKyAxXSkgewogICAgICAgIHJldHVybiBsYXN0UG9zaXRpb247CiAgICAgIH0KICAgIH0KICB9CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gVW5pY29kZVJhbmdlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCByYW5nZSA9IFVuaWNvZGVSYW5nZXNbaV07CiAgICBmb3IgKGxldCBqID0gMCwgamogPSByYW5nZS5sZW5ndGg7IGogPCBqajsgaiArPSAyKSB7CiAgICAgIGlmICh2YWx1ZSA+PSByYW5nZVtqXSAmJiB2YWx1ZSA8PSByYW5nZVtqICsgMV0pIHsKICAgICAgICByZXR1cm4gaTsKICAgICAgfQogICAgfQogIH0KICByZXR1cm4gLTE7Cn0KY29uc3QgU3BlY2lhbENoYXJSZWdFeHAgPSBuZXcgUmVnRXhwKCJeKFxccyl8KFxccHtNbn0pfChcXHB7Q2Z9KSQiLCAidSIpOwpjb25zdCBDYXRlZ29yeUNhY2hlID0gbmV3IE1hcCgpOwpmdW5jdGlvbiBnZXRDaGFyVW5pY29kZUNhdGVnb3J5KGNoYXIpIHsKICBjb25zdCBjYWNoZWRDYXRlZ29yeSA9IENhdGVnb3J5Q2FjaGUuZ2V0KGNoYXIpOwogIGlmIChjYWNoZWRDYXRlZ29yeSkgewogICAgcmV0dXJuIGNhY2hlZENhdGVnb3J5OwogIH0KICBjb25zdCBncm91cHMgPSBjaGFyLm1hdGNoKFNwZWNpYWxDaGFyUmVnRXhwKTsKICBjb25zdCBjYXRlZ29yeSA9IHsKICAgIGlzV2hpdGVzcGFjZTogISFncm91cHM/LlsxXSwKICAgIGlzWmVyb1dpZHRoRGlhY3JpdGljOiAhIWdyb3Vwcz8uWzJdLAogICAgaXNJbnZpc2libGVGb3JtYXRNYXJrOiAhIWdyb3Vwcz8uWzNdCiAgfTsKICBDYXRlZ29yeUNhY2hlLnNldChjaGFyLCBjYXRlZ29yeSk7CiAgcmV0dXJuIGNhdGVnb3J5Owp9CmZ1bmN0aW9uIGNsZWFyVW5pY29kZUNhY2hlcygpIHsKICBDYXRlZ29yeUNhY2hlLmNsZWFyKCk7Cn0KCjsvLyAuL3NyYy9jb3JlL2ZvbnRzX3V0aWxzLmpzCgoKCgoKY29uc3QgU0VBQ19BTkFMWVNJU19FTkFCTEVEID0gdHJ1ZTsKY29uc3QgRm9udEZsYWdzID0gewogIEZpeGVkUGl0Y2g6IDEsCiAgU2VyaWY6IDIsCiAgU3ltYm9saWM6IDQsCiAgU2NyaXB0OiA4LAogIE5vbnN5bWJvbGljOiAzMiwKICBJdGFsaWM6IDY0LAogIEFsbENhcDogNjU1MzYsCiAgU21hbGxDYXA6IDEzMTA3MiwKICBGb3JjZUJvbGQ6IDI2MjE0NAp9Owpjb25zdCBNYWNTdGFuZGFyZEdseXBoT3JkZXJpbmcgPSBbIi5ub3RkZWYiLCAiLm51bGwiLCAibm9ubWFya2luZ3JldHVybiIsICJzcGFjZSIsICJleGNsYW0iLCAicXVvdGVkYmwiLCAibnVtYmVyc2lnbiIsICJkb2xsYXIiLCAicGVyY2VudCIsICJhbXBlcnNhbmQiLCAicXVvdGVzaW5nbGUiLCAicGFyZW5sZWZ0IiwgInBhcmVucmlnaHQiLCAiYXN0ZXJpc2siLCAicGx1cyIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgInNsYXNoIiwgInplcm8iLCAib25lIiwgInR3byIsICJ0aHJlZSIsICJmb3VyIiwgImZpdmUiLCAic2l4IiwgInNldmVuIiwgImVpZ2h0IiwgIm5pbmUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImxlc3MiLCAiZXF1YWwiLCAiZ3JlYXRlciIsICJxdWVzdGlvbiIsICJhdCIsICJBIiwgIkIiLCAiQyIsICJEIiwgIkUiLCAiRiIsICJHIiwgIkgiLCAiSSIsICJKIiwgIksiLCAiTCIsICJNIiwgIk4iLCAiTyIsICJQIiwgIlEiLCAiUiIsICJTIiwgIlQiLCAiVSIsICJWIiwgIlciLCAiWCIsICJZIiwgIloiLCAiYnJhY2tldGxlZnQiLCAiYmFja3NsYXNoIiwgImJyYWNrZXRyaWdodCIsICJhc2NpaWNpcmN1bSIsICJ1bmRlcnNjb3JlIiwgImdyYXZlIiwgImEiLCAiYiIsICJjIiwgImQiLCAiZSIsICJmIiwgImciLCAiaCIsICJpIiwgImoiLCAiayIsICJsIiwgIm0iLCAibiIsICJvIiwgInAiLCAicSIsICJyIiwgInMiLCAidCIsICJ1IiwgInYiLCAidyIsICJ4IiwgInkiLCAieiIsICJicmFjZWxlZnQiLCAiYmFyIiwgImJyYWNlcmlnaHQiLCAiYXNjaWl0aWxkZSIsICJBZGllcmVzaXMiLCAiQXJpbmciLCAiQ2NlZGlsbGEiLCAiRWFjdXRlIiwgIk50aWxkZSIsICJPZGllcmVzaXMiLCAiVWRpZXJlc2lzIiwgImFhY3V0ZSIsICJhZ3JhdmUiLCAiYWNpcmN1bWZsZXgiLCAiYWRpZXJlc2lzIiwgImF0aWxkZSIsICJhcmluZyIsICJjY2VkaWxsYSIsICJlYWN1dGUiLCAiZWdyYXZlIiwgImVjaXJjdW1mbGV4IiwgImVkaWVyZXNpcyIsICJpYWN1dGUiLCAiaWdyYXZlIiwgImljaXJjdW1mbGV4IiwgImlkaWVyZXNpcyIsICJudGlsZGUiLCAib2FjdXRlIiwgIm9ncmF2ZSIsICJvY2lyY3VtZmxleCIsICJvZGllcmVzaXMiLCAib3RpbGRlIiwgInVhY3V0ZSIsICJ1Z3JhdmUiLCAidWNpcmN1bWZsZXgiLCAidWRpZXJlc2lzIiwgImRhZ2dlciIsICJkZWdyZWUiLCAiY2VudCIsICJzdGVybGluZyIsICJzZWN0aW9uIiwgImJ1bGxldCIsICJwYXJhZ3JhcGgiLCAiZ2VybWFuZGJscyIsICJyZWdpc3RlcmVkIiwgImNvcHlyaWdodCIsICJ0cmFkZW1hcmsiLCAiYWN1dGUiLCAiZGllcmVzaXMiLCAibm90ZXF1YWwiLCAiQUUiLCAiT3NsYXNoIiwgImluZmluaXR5IiwgInBsdXNtaW51cyIsICJsZXNzZXF1YWwiLCAiZ3JlYXRlcmVxdWFsIiwgInllbiIsICJtdSIsICJwYXJ0aWFsZGlmZiIsICJzdW1tYXRpb24iLCAicHJvZHVjdCIsICJwaSIsICJpbnRlZ3JhbCIsICJvcmRmZW1pbmluZSIsICJvcmRtYXNjdWxpbmUiLCAiT21lZ2EiLCAiYWUiLCAib3NsYXNoIiwgInF1ZXN0aW9uZG93biIsICJleGNsYW1kb3duIiwgImxvZ2ljYWxub3QiLCAicmFkaWNhbCIsICJmbG9yaW4iLCAiYXBwcm94ZXF1YWwiLCAiRGVsdGEiLCAiZ3VpbGxlbW90bGVmdCIsICJndWlsbGVtb3RyaWdodCIsICJlbGxpcHNpcyIsICJub25icmVha2luZ3NwYWNlIiwgIkFncmF2ZSIsICJBdGlsZGUiLCAiT3RpbGRlIiwgIk9FIiwgIm9lIiwgImVuZGFzaCIsICJlbWRhc2giLCAicXVvdGVkYmxsZWZ0IiwgInF1b3RlZGJscmlnaHQiLCAicXVvdGVsZWZ0IiwgInF1b3RlcmlnaHQiLCAiZGl2aWRlIiwgImxvemVuZ2UiLCAieWRpZXJlc2lzIiwgIllkaWVyZXNpcyIsICJmcmFjdGlvbiIsICJjdXJyZW5jeSIsICJndWlsc2luZ2xsZWZ0IiwgImd1aWxzaW5nbHJpZ2h0IiwgImZpIiwgImZsIiwgImRhZ2dlcmRibCIsICJwZXJpb2RjZW50ZXJlZCIsICJxdW90ZXNpbmdsYmFzZSIsICJxdW90ZWRibGJhc2UiLCAicGVydGhvdXNhbmQiLCAiQWNpcmN1bWZsZXgiLCAiRWNpcmN1bWZsZXgiLCAiQWFjdXRlIiwgIkVkaWVyZXNpcyIsICJFZ3JhdmUiLCAiSWFjdXRlIiwgIkljaXJjdW1mbGV4IiwgIklkaWVyZXNpcyIsICJJZ3JhdmUiLCAiT2FjdXRlIiwgIk9jaXJjdW1mbGV4IiwgImFwcGxlIiwgIk9ncmF2ZSIsICJVYWN1dGUiLCAiVWNpcmN1bWZsZXgiLCAiVWdyYXZlIiwgImRvdGxlc3NpIiwgImNpcmN1bWZsZXgiLCAidGlsZGUiLCAibWFjcm9uIiwgImJyZXZlIiwgImRvdGFjY2VudCIsICJyaW5nIiwgImNlZGlsbGEiLCAiaHVuZ2FydW1sYXV0IiwgIm9nb25layIsICJjYXJvbiIsICJMc2xhc2giLCAibHNsYXNoIiwgIlNjYXJvbiIsICJzY2Fyb24iLCAiWmNhcm9uIiwgInpjYXJvbiIsICJicm9rZW5iYXIiLCAiRXRoIiwgImV0aCIsICJZYWN1dGUiLCAieWFjdXRlIiwgIlRob3JuIiwgInRob3JuIiwgIm1pbnVzIiwgIm11bHRpcGx5IiwgIm9uZXN1cGVyaW9yIiwgInR3b3N1cGVyaW9yIiwgInRocmVlc3VwZXJpb3IiLCAib25laGFsZiIsICJvbmVxdWFydGVyIiwgInRocmVlcXVhcnRlcnMiLCAiZnJhbmMiLCAiR2JyZXZlIiwgImdicmV2ZSIsICJJZG90YWNjZW50IiwgIlNjZWRpbGxhIiwgInNjZWRpbGxhIiwgIkNhY3V0ZSIsICJjYWN1dGUiLCAiQ2Nhcm9uIiwgImNjYXJvbiIsICJkY3JvYXQiXTsKZnVuY3Rpb24gcmVjb3ZlckdseXBoTmFtZShuYW1lLCBnbHlwaHNVbmljb2RlTWFwKSB7CiAgaWYgKGdseXBoc1VuaWNvZGVNYXBbbmFtZV0gIT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuIG5hbWU7CiAgfQogIGNvbnN0IHVuaWNvZGUgPSBnZXRVbmljb2RlRm9yR2x5cGgobmFtZSwgZ2x5cGhzVW5pY29kZU1hcCk7CiAgaWYgKHVuaWNvZGUgIT09IC0xKSB7CiAgICBmb3IgKGNvbnN0IGtleSBpbiBnbHlwaHNVbmljb2RlTWFwKSB7CiAgICAgIGlmIChnbHlwaHNVbmljb2RlTWFwW2tleV0gPT09IHVuaWNvZGUpIHsKICAgICAgICByZXR1cm4ga2V5OwogICAgICB9CiAgICB9CiAgfQogIGluZm8oIlVuYWJsZSB0byByZWNvdmVyIGEgc3RhbmRhcmQgZ2x5cGggbmFtZSBmb3I6ICIgKyBuYW1lKTsKICByZXR1cm4gbmFtZTsKfQpmdW5jdGlvbiB0eXBlMUZvbnRHbHlwaE1hcHBpbmcocHJvcGVydGllcywgYnVpbHRJbkVuY29kaW5nLCBnbHlwaE5hbWVzKSB7CiAgY29uc3QgY2hhckNvZGVUb0dseXBoSWQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIGxldCBnbHlwaElkLCBjaGFyQ29kZSwgYmFzZUVuY29kaW5nOwogIGNvbnN0IGlzU3ltYm9saWNGb250ID0gISEocHJvcGVydGllcy5mbGFncyAmIEZvbnRGbGFncy5TeW1ib2xpYyk7CiAgaWYgKHByb3BlcnRpZXMuaXNJbnRlcm5hbEZvbnQpIHsKICAgIGJhc2VFbmNvZGluZyA9IGJ1aWx0SW5FbmNvZGluZzsKICAgIGZvciAoY2hhckNvZGUgPSAwOyBjaGFyQ29kZSA8IGJhc2VFbmNvZGluZy5sZW5ndGg7IGNoYXJDb2RlKyspIHsKICAgICAgZ2x5cGhJZCA9IGdseXBoTmFtZXMuaW5kZXhPZihiYXNlRW5jb2RpbmdbY2hhckNvZGVdKTsKICAgICAgY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdID0gZ2x5cGhJZCA+PSAwID8gZ2x5cGhJZCA6IDA7CiAgICB9CiAgfSBlbHNlIGlmIChwcm9wZXJ0aWVzLmJhc2VFbmNvZGluZ05hbWUpIHsKICAgIGJhc2VFbmNvZGluZyA9IGdldEVuY29kaW5nKHByb3BlcnRpZXMuYmFzZUVuY29kaW5nTmFtZSk7CiAgICBmb3IgKGNoYXJDb2RlID0gMDsgY2hhckNvZGUgPCBiYXNlRW5jb2RpbmcubGVuZ3RoOyBjaGFyQ29kZSsrKSB7CiAgICAgIGdseXBoSWQgPSBnbHlwaE5hbWVzLmluZGV4T2YoYmFzZUVuY29kaW5nW2NoYXJDb2RlXSk7CiAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IGdseXBoSWQgPj0gMCA/IGdseXBoSWQgOiAwOwogICAgfQogIH0gZWxzZSBpZiAoaXNTeW1ib2xpY0ZvbnQpIHsKICAgIGZvciAoY2hhckNvZGUgaW4gYnVpbHRJbkVuY29kaW5nKSB7CiAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IGJ1aWx0SW5FbmNvZGluZ1tjaGFyQ29kZV07CiAgICB9CiAgfSBlbHNlIHsKICAgIGJhc2VFbmNvZGluZyA9IFN0YW5kYXJkRW5jb2Rpbmc7CiAgICBmb3IgKGNoYXJDb2RlID0gMDsgY2hhckNvZGUgPCBiYXNlRW5jb2RpbmcubGVuZ3RoOyBjaGFyQ29kZSsrKSB7CiAgICAgIGdseXBoSWQgPSBnbHlwaE5hbWVzLmluZGV4T2YoYmFzZUVuY29kaW5nW2NoYXJDb2RlXSk7CiAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IGdseXBoSWQgPj0gMCA/IGdseXBoSWQgOiAwOwogICAgfQogIH0KICBjb25zdCBkaWZmZXJlbmNlcyA9IHByb3BlcnRpZXMuZGlmZmVyZW5jZXM7CiAgbGV0IGdseXBoc1VuaWNvZGVNYXA7CiAgaWYgKGRpZmZlcmVuY2VzKSB7CiAgICBmb3IgKGNoYXJDb2RlIGluIGRpZmZlcmVuY2VzKSB7CiAgICAgIGNvbnN0IGdseXBoTmFtZSA9IGRpZmZlcmVuY2VzW2NoYXJDb2RlXTsKICAgICAgZ2x5cGhJZCA9IGdseXBoTmFtZXMuaW5kZXhPZihnbHlwaE5hbWUpOwogICAgICBpZiAoZ2x5cGhJZCA9PT0gLTEpIHsKICAgICAgICBpZiAoIWdseXBoc1VuaWNvZGVNYXApIHsKICAgICAgICAgIGdseXBoc1VuaWNvZGVNYXAgPSBnZXRHbHlwaHNVbmljb2RlKCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHN0YW5kYXJkR2x5cGhOYW1lID0gcmVjb3ZlckdseXBoTmFtZShnbHlwaE5hbWUsIGdseXBoc1VuaWNvZGVNYXApOwogICAgICAgIGlmIChzdGFuZGFyZEdseXBoTmFtZSAhPT0gZ2x5cGhOYW1lKSB7CiAgICAgICAgICBnbHlwaElkID0gZ2x5cGhOYW1lcy5pbmRleE9mKHN0YW5kYXJkR2x5cGhOYW1lKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdID0gZ2x5cGhJZCA+PSAwID8gZ2x5cGhJZCA6IDA7CiAgICB9CiAgfQogIHJldHVybiBjaGFyQ29kZVRvR2x5cGhJZDsKfQpmdW5jdGlvbiBub3JtYWxpemVGb250TmFtZShuYW1lKSB7CiAgcmV0dXJuIG5hbWUucmVwbGFjZUFsbCgvWyxfXS9nLCAiLSIpLnJlcGxhY2VBbGwoL1xzL2csICIiKTsKfQpjb25zdCBnZXRWZXJ0aWNhbFByZXNlbnRhdGlvbkZvcm0gPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkodCA9PiB7CiAgdFsweDIwMTNdID0gMHhmZTMyOwogIHRbMHgyMDE0XSA9IDB4ZmUzMTsKICB0WzB4MjAyNV0gPSAweGZlMzA7CiAgdFsweDIwMjZdID0gMHhmZTE5OwogIHRbMHgzMDAxXSA9IDB4ZmUxMTsKICB0WzB4MzAwMl0gPSAweGZlMTI7CiAgdFsweDMwMDhdID0gMHhmZTNmOwogIHRbMHgzMDA5XSA9IDB4ZmU0MDsKICB0WzB4MzAwYV0gPSAweGZlM2Q7CiAgdFsweDMwMGJdID0gMHhmZTNlOwogIHRbMHgzMDBjXSA9IDB4ZmU0MTsKICB0WzB4MzAwZF0gPSAweGZlNDI7CiAgdFsweDMwMGVdID0gMHhmZTQzOwogIHRbMHgzMDBmXSA9IDB4ZmU0NDsKICB0WzB4MzAxMF0gPSAweGZlM2I7CiAgdFsweDMwMTFdID0gMHhmZTNjOwogIHRbMHgzMDE0XSA9IDB4ZmUzOTsKICB0WzB4MzAxNV0gPSAweGZlM2E7CiAgdFsweDMwMTZdID0gMHhmZTE3OwogIHRbMHgzMDE3XSA9IDB4ZmUxODsKICB0WzB4ZmU0Zl0gPSAweGZlMzQ7CiAgdFsweGZmMDFdID0gMHhmZTE1OwogIHRbMHhmZjA4XSA9IDB4ZmUzNTsKICB0WzB4ZmYwOV0gPSAweGZlMzY7CiAgdFsweGZmMGNdID0gMHhmZTEwOwogIHRbMHhmZjFhXSA9IDB4ZmUxMzsKICB0WzB4ZmYxYl0gPSAweGZlMTQ7CiAgdFsweGZmMWZdID0gMHhmZTE2OwogIHRbMHhmZjNiXSA9IDB4ZmU0NzsKICB0WzB4ZmYzZF0gPSAweGZlNDg7CiAgdFsweGZmM2ZdID0gMHhmZTMzOwogIHRbMHhmZjViXSA9IDB4ZmUzNzsKICB0WzB4ZmY1ZF0gPSAweGZlMzg7Cn0pOwpjb25zdCBNQVhfU0laRV9UT19DT01QSUxFID0gMTAwMDsKZnVuY3Rpb24gY29tcGlsZVR5cGUzR2x5cGgoewogIGRhdGE6IGltZywKICB3aWR0aCwKICBoZWlnaHQKfSkgewogIGlmICh3aWR0aCA+IE1BWF9TSVpFX1RPX0NPTVBJTEUgfHwgaGVpZ2h0ID4gTUFYX1NJWkVfVE9fQ09NUElMRSkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IFBPSU5UX1RPX1BST0NFU1NfTElNSVQgPSAxMDAwOwogIGNvbnN0IFBPSU5UX1RZUEVTID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDIsIDQsIDAsIDEsIDAsIDUsIDQsIDgsIDEwLCAwLCA4LCAwLCAyLCAxLCAwXSk7CiAgY29uc3Qgd2lkdGgxID0gd2lkdGggKyAxOwogIGNvbnN0IHBvaW50cyA9IG5ldyBVaW50OEFycmF5KHdpZHRoMSAqIChoZWlnaHQgKyAxKSk7CiAgbGV0IGksIGosIGowOwogIGNvbnN0IGxpbmVTaXplID0gd2lkdGggKyA3ICYgfjc7CiAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KGxpbmVTaXplICogaGVpZ2h0KTsKICBsZXQgcG9zID0gMDsKICBmb3IgKGNvbnN0IGVsZW0gb2YgaW1nKSB7CiAgICBsZXQgbWFzayA9IDEyODsKICAgIHdoaWxlIChtYXNrID4gMCkgewogICAgICBkYXRhW3BvcysrXSA9IGVsZW0gJiBtYXNrID8gMCA6IDI1NTsKICAgICAgbWFzayA+Pj0gMTsKICAgIH0KICB9CiAgbGV0IGNvdW50ID0gMDsKICBwb3MgPSAwOwogIGlmIChkYXRhW3Bvc10gIT09IDApIHsKICAgIHBvaW50c1swXSA9IDE7CiAgICArK2NvdW50OwogIH0KICBmb3IgKGogPSAxOyBqIDwgd2lkdGg7IGorKykgewogICAgaWYgKGRhdGFbcG9zXSAhPT0gZGF0YVtwb3MgKyAxXSkgewogICAgICBwb2ludHNbal0gPSBkYXRhW3Bvc10gPyAyIDogMTsKICAgICAgKytjb3VudDsKICAgIH0KICAgIHBvcysrOwogIH0KICBpZiAoZGF0YVtwb3NdICE9PSAwKSB7CiAgICBwb2ludHNbal0gPSAyOwogICAgKytjb3VudDsKICB9CiAgZm9yIChpID0gMTsgaSA8IGhlaWdodDsgaSsrKSB7CiAgICBwb3MgPSBpICogbGluZVNpemU7CiAgICBqMCA9IGkgKiB3aWR0aDE7CiAgICBpZiAoZGF0YVtwb3MgLSBsaW5lU2l6ZV0gIT09IGRhdGFbcG9zXSkgewogICAgICBwb2ludHNbajBdID0gZGF0YVtwb3NdID8gMSA6IDg7CiAgICAgICsrY291bnQ7CiAgICB9CiAgICBsZXQgc3VtID0gKGRhdGFbcG9zXSA/IDQgOiAwKSArIChkYXRhW3BvcyAtIGxpbmVTaXplXSA/IDggOiAwKTsKICAgIGZvciAoaiA9IDE7IGogPCB3aWR0aDsgaisrKSB7CiAgICAgIHN1bSA9IChzdW0gPj4gMikgKyAoZGF0YVtwb3MgKyAxXSA/IDQgOiAwKSArIChkYXRhW3BvcyAtIGxpbmVTaXplICsgMV0gPyA4IDogMCk7CiAgICAgIGlmIChQT0lOVF9UWVBFU1tzdW1dKSB7CiAgICAgICAgcG9pbnRzW2owICsgal0gPSBQT0lOVF9UWVBFU1tzdW1dOwogICAgICAgICsrY291bnQ7CiAgICAgIH0KICAgICAgcG9zKys7CiAgICB9CiAgICBpZiAoZGF0YVtwb3MgLSBsaW5lU2l6ZV0gIT09IGRhdGFbcG9zXSkgewogICAgICBwb2ludHNbajAgKyBqXSA9IGRhdGFbcG9zXSA/IDIgOiA0OwogICAgICArK2NvdW50OwogICAgfQogICAgaWYgKGNvdW50ID4gUE9JTlRfVE9fUFJPQ0VTU19MSU1JVCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9CiAgcG9zID0gbGluZVNpemUgKiAoaGVpZ2h0IC0gMSk7CiAgajAgPSBpICogd2lkdGgxOwogIGlmIChkYXRhW3Bvc10gIT09IDApIHsKICAgIHBvaW50c1tqMF0gPSA4OwogICAgKytjb3VudDsKICB9CiAgZm9yIChqID0gMTsgaiA8IHdpZHRoOyBqKyspIHsKICAgIGlmIChkYXRhW3Bvc10gIT09IGRhdGFbcG9zICsgMV0pIHsKICAgICAgcG9pbnRzW2owICsgal0gPSBkYXRhW3Bvc10gPyA0IDogODsKICAgICAgKytjb3VudDsKICAgIH0KICAgIHBvcysrOwogIH0KICBpZiAoZGF0YVtwb3NdICE9PSAwKSB7CiAgICBwb2ludHNbajAgKyBqXSA9IDQ7CiAgICArK2NvdW50OwogIH0KICBpZiAoY291bnQgPiBQT0lOVF9UT19QUk9DRVNTX0xJTUlUKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY29uc3Qgc3RlcHMgPSBuZXcgSW50MzJBcnJheShbMCwgd2lkdGgxLCAtMSwgMCwgLXdpZHRoMSwgMCwgMCwgMCwgMV0pOwogIGNvbnN0IHBhdGhCdWYgPSBbXTsKICBjb25zdCB7CiAgICBhLAogICAgYiwKICAgIGMsCiAgICBkLAogICAgZSwKICAgIGYKICB9ID0gbmV3IERPTU1hdHJpeCgpLnNjYWxlU2VsZigxIC8gd2lkdGgsIC0xIC8gaGVpZ2h0KS50cmFuc2xhdGVTZWxmKDAsIC1oZWlnaHQpOwogIGZvciAoaSA9IDA7IGNvdW50ICYmIGkgPD0gaGVpZ2h0OyBpKyspIHsKICAgIGxldCBwID0gaSAqIHdpZHRoMTsKICAgIGNvbnN0IGVuZCA9IHAgKyB3aWR0aDsKICAgIHdoaWxlIChwIDwgZW5kICYmICFwb2ludHNbcF0pIHsKICAgICAgcCsrOwogICAgfQogICAgaWYgKHAgPT09IGVuZCkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGxldCB4ID0gcCAlIHdpZHRoMTsKICAgIGxldCB5ID0gaTsKICAgIHBhdGhCdWYucHVzaChEcmF3T1BTLm1vdmVUbywgYSAqIHggKyBjICogeSArIGUsIGIgKiB4ICsgZCAqIHkgKyBmKTsKICAgIGNvbnN0IHAwID0gcDsKICAgIGxldCB0eXBlID0gcG9pbnRzW3BdOwogICAgZG8gewogICAgICBjb25zdCBzdGVwID0gc3RlcHNbdHlwZV07CiAgICAgIGRvIHsKICAgICAgICBwICs9IHN0ZXA7CiAgICAgIH0gd2hpbGUgKCFwb2ludHNbcF0pOwogICAgICBjb25zdCBwcCA9IHBvaW50c1twXTsKICAgICAgaWYgKHBwICE9PSA1ICYmIHBwICE9PSAxMCkgewogICAgICAgIHR5cGUgPSBwcDsKICAgICAgICBwb2ludHNbcF0gPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIHR5cGUgPSBwcCAmIDB4MzMgKiB0eXBlID4+IDQ7CiAgICAgICAgcG9pbnRzW3BdICY9IHR5cGUgPj4gMiB8IHR5cGUgPDwgMjsKICAgICAgfQogICAgICB4ID0gcCAlIHdpZHRoMTsKICAgICAgeSA9IHAgLyB3aWR0aDEgfCAwOwogICAgICBwYXRoQnVmLnB1c2goRHJhd09QUy5saW5lVG8sIGEgKiB4ICsgYyAqIHkgKyBlLCBiICogeCArIGQgKiB5ICsgZik7CiAgICAgIGlmICghcG9pbnRzW3BdKSB7CiAgICAgICAgLS1jb3VudDsKICAgICAgfQogICAgfSB3aGlsZSAocDAgIT09IHApOwogICAgLS1pOwogIH0KICByZXR1cm4gW09QUy5yYXdGaWxsUGF0aCwgW25ldyBGbG9hdDMyQXJyYXkocGF0aEJ1ZildLCBuZXcgRmxvYXQzMkFycmF5KFswLCAwLCB3aWR0aCwgaGVpZ2h0XSldOwp9Cgo7Ly8gLi9zcmMvY29yZS9jaGFyc2V0cy5qcwpjb25zdCBJU09BZG9iZUNoYXJzZXQgPSBbIi5ub3RkZWYiLCAic3BhY2UiLCAiZXhjbGFtIiwgInF1b3RlZGJsIiwgIm51bWJlcnNpZ24iLCAiZG9sbGFyIiwgInBlcmNlbnQiLCAiYW1wZXJzYW5kIiwgInF1b3RlcmlnaHQiLCAicGFyZW5sZWZ0IiwgInBhcmVucmlnaHQiLCAiYXN0ZXJpc2siLCAicGx1cyIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgInNsYXNoIiwgInplcm8iLCAib25lIiwgInR3byIsICJ0aHJlZSIsICJmb3VyIiwgImZpdmUiLCAic2l4IiwgInNldmVuIiwgImVpZ2h0IiwgIm5pbmUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImxlc3MiLCAiZXF1YWwiLCAiZ3JlYXRlciIsICJxdWVzdGlvbiIsICJhdCIsICJBIiwgIkIiLCAiQyIsICJEIiwgIkUiLCAiRiIsICJHIiwgIkgiLCAiSSIsICJKIiwgIksiLCAiTCIsICJNIiwgIk4iLCAiTyIsICJQIiwgIlEiLCAiUiIsICJTIiwgIlQiLCAiVSIsICJWIiwgIlciLCAiWCIsICJZIiwgIloiLCAiYnJhY2tldGxlZnQiLCAiYmFja3NsYXNoIiwgImJyYWNrZXRyaWdodCIsICJhc2NpaWNpcmN1bSIsICJ1bmRlcnNjb3JlIiwgInF1b3RlbGVmdCIsICJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiIsICJnIiwgImgiLCAiaSIsICJqIiwgImsiLCAibCIsICJtIiwgIm4iLCAibyIsICJwIiwgInEiLCAiciIsICJzIiwgInQiLCAidSIsICJ2IiwgInciLCAieCIsICJ5IiwgInoiLCAiYnJhY2VsZWZ0IiwgImJhciIsICJicmFjZXJpZ2h0IiwgImFzY2lpdGlsZGUiLCAiZXhjbGFtZG93biIsICJjZW50IiwgInN0ZXJsaW5nIiwgImZyYWN0aW9uIiwgInllbiIsICJmbG9yaW4iLCAic2VjdGlvbiIsICJjdXJyZW5jeSIsICJxdW90ZXNpbmdsZSIsICJxdW90ZWRibGxlZnQiLCAiZ3VpbGxlbW90bGVmdCIsICJndWlsc2luZ2xsZWZ0IiwgImd1aWxzaW5nbHJpZ2h0IiwgImZpIiwgImZsIiwgImVuZGFzaCIsICJkYWdnZXIiLCAiZGFnZ2VyZGJsIiwgInBlcmlvZGNlbnRlcmVkIiwgInBhcmFncmFwaCIsICJidWxsZXQiLCAicXVvdGVzaW5nbGJhc2UiLCAicXVvdGVkYmxiYXNlIiwgInF1b3RlZGJscmlnaHQiLCAiZ3VpbGxlbW90cmlnaHQiLCAiZWxsaXBzaXMiLCAicGVydGhvdXNhbmQiLCAicXVlc3Rpb25kb3duIiwgImdyYXZlIiwgImFjdXRlIiwgImNpcmN1bWZsZXgiLCAidGlsZGUiLCAibWFjcm9uIiwgImJyZXZlIiwgImRvdGFjY2VudCIsICJkaWVyZXNpcyIsICJyaW5nIiwgImNlZGlsbGEiLCAiaHVuZ2FydW1sYXV0IiwgIm9nb25layIsICJjYXJvbiIsICJlbWRhc2giLCAiQUUiLCAib3JkZmVtaW5pbmUiLCAiTHNsYXNoIiwgIk9zbGFzaCIsICJPRSIsICJvcmRtYXNjdWxpbmUiLCAiYWUiLCAiZG90bGVzc2kiLCAibHNsYXNoIiwgIm9zbGFzaCIsICJvZSIsICJnZXJtYW5kYmxzIiwgIm9uZXN1cGVyaW9yIiwgImxvZ2ljYWxub3QiLCAibXUiLCAidHJhZGVtYXJrIiwgIkV0aCIsICJvbmVoYWxmIiwgInBsdXNtaW51cyIsICJUaG9ybiIsICJvbmVxdWFydGVyIiwgImRpdmlkZSIsICJicm9rZW5iYXIiLCAiZGVncmVlIiwgInRob3JuIiwgInRocmVlcXVhcnRlcnMiLCAidHdvc3VwZXJpb3IiLCAicmVnaXN0ZXJlZCIsICJtaW51cyIsICJldGgiLCAibXVsdGlwbHkiLCAidGhyZWVzdXBlcmlvciIsICJjb3B5cmlnaHQiLCAiQWFjdXRlIiwgIkFjaXJjdW1mbGV4IiwgIkFkaWVyZXNpcyIsICJBZ3JhdmUiLCAiQXJpbmciLCAiQXRpbGRlIiwgIkNjZWRpbGxhIiwgIkVhY3V0ZSIsICJFY2lyY3VtZmxleCIsICJFZGllcmVzaXMiLCAiRWdyYXZlIiwgIklhY3V0ZSIsICJJY2lyY3VtZmxleCIsICJJZGllcmVzaXMiLCAiSWdyYXZlIiwgIk50aWxkZSIsICJPYWN1dGUiLCAiT2NpcmN1bWZsZXgiLCAiT2RpZXJlc2lzIiwgIk9ncmF2ZSIsICJPdGlsZGUiLCAiU2Nhcm9uIiwgIlVhY3V0ZSIsICJVY2lyY3VtZmxleCIsICJVZGllcmVzaXMiLCAiVWdyYXZlIiwgIllhY3V0ZSIsICJZZGllcmVzaXMiLCAiWmNhcm9uIiwgImFhY3V0ZSIsICJhY2lyY3VtZmxleCIsICJhZGllcmVzaXMiLCAiYWdyYXZlIiwgImFyaW5nIiwgImF0aWxkZSIsICJjY2VkaWxsYSIsICJlYWN1dGUiLCAiZWNpcmN1bWZsZXgiLCAiZWRpZXJlc2lzIiwgImVncmF2ZSIsICJpYWN1dGUiLCAiaWNpcmN1bWZsZXgiLCAiaWRpZXJlc2lzIiwgImlncmF2ZSIsICJudGlsZGUiLCAib2FjdXRlIiwgIm9jaXJjdW1mbGV4IiwgIm9kaWVyZXNpcyIsICJvZ3JhdmUiLCAib3RpbGRlIiwgInNjYXJvbiIsICJ1YWN1dGUiLCAidWNpcmN1bWZsZXgiLCAidWRpZXJlc2lzIiwgInVncmF2ZSIsICJ5YWN1dGUiLCAieWRpZXJlc2lzIiwgInpjYXJvbiJdOwpjb25zdCBFeHBlcnRDaGFyc2V0ID0gWyIubm90ZGVmIiwgInNwYWNlIiwgImV4Y2xhbXNtYWxsIiwgIkh1bmdhcnVtbGF1dHNtYWxsIiwgImRvbGxhcm9sZHN0eWxlIiwgImRvbGxhcnN1cGVyaW9yIiwgImFtcGVyc2FuZHNtYWxsIiwgIkFjdXRlc21hbGwiLCAicGFyZW5sZWZ0c3VwZXJpb3IiLCAicGFyZW5yaWdodHN1cGVyaW9yIiwgInR3b2RvdGVubGVhZGVyIiwgIm9uZWRvdGVubGVhZGVyIiwgImNvbW1hIiwgImh5cGhlbiIsICJwZXJpb2QiLCAiZnJhY3Rpb24iLCAiemVyb29sZHN0eWxlIiwgIm9uZW9sZHN0eWxlIiwgInR3b29sZHN0eWxlIiwgInRocmVlb2xkc3R5bGUiLCAiZm91cm9sZHN0eWxlIiwgImZpdmVvbGRzdHlsZSIsICJzaXhvbGRzdHlsZSIsICJzZXZlbm9sZHN0eWxlIiwgImVpZ2h0b2xkc3R5bGUiLCAibmluZW9sZHN0eWxlIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJjb21tYXN1cGVyaW9yIiwgInRocmVlcXVhcnRlcnNlbWRhc2giLCAicGVyaW9kc3VwZXJpb3IiLCAicXVlc3Rpb25zbWFsbCIsICJhc3VwZXJpb3IiLCAiYnN1cGVyaW9yIiwgImNlbnRzdXBlcmlvciIsICJkc3VwZXJpb3IiLCAiZXN1cGVyaW9yIiwgImlzdXBlcmlvciIsICJsc3VwZXJpb3IiLCAibXN1cGVyaW9yIiwgIm5zdXBlcmlvciIsICJvc3VwZXJpb3IiLCAicnN1cGVyaW9yIiwgInNzdXBlcmlvciIsICJ0c3VwZXJpb3IiLCAiZmYiLCAiZmkiLCAiZmwiLCAiZmZpIiwgImZmbCIsICJwYXJlbmxlZnRpbmZlcmlvciIsICJwYXJlbnJpZ2h0aW5mZXJpb3IiLCAiQ2lyY3VtZmxleHNtYWxsIiwgImh5cGhlbnN1cGVyaW9yIiwgIkdyYXZlc21hbGwiLCAiQXNtYWxsIiwgIkJzbWFsbCIsICJDc21hbGwiLCAiRHNtYWxsIiwgIkVzbWFsbCIsICJGc21hbGwiLCAiR3NtYWxsIiwgIkhzbWFsbCIsICJJc21hbGwiLCAiSnNtYWxsIiwgIktzbWFsbCIsICJMc21hbGwiLCAiTXNtYWxsIiwgIk5zbWFsbCIsICJPc21hbGwiLCAiUHNtYWxsIiwgIlFzbWFsbCIsICJSc21hbGwiLCAiU3NtYWxsIiwgIlRzbWFsbCIsICJVc21hbGwiLCAiVnNtYWxsIiwgIldzbWFsbCIsICJYc21hbGwiLCAiWXNtYWxsIiwgIlpzbWFsbCIsICJjb2xvbm1vbmV0YXJ5IiwgIm9uZWZpdHRlZCIsICJydXBpYWgiLCAiVGlsZGVzbWFsbCIsICJleGNsYW1kb3duc21hbGwiLCAiY2VudG9sZHN0eWxlIiwgIkxzbGFzaHNtYWxsIiwgIlNjYXJvbnNtYWxsIiwgIlpjYXJvbnNtYWxsIiwgIkRpZXJlc2lzc21hbGwiLCAiQnJldmVzbWFsbCIsICJDYXJvbnNtYWxsIiwgIkRvdGFjY2VudHNtYWxsIiwgIk1hY3JvbnNtYWxsIiwgImZpZ3VyZWRhc2giLCAiaHlwaGVuaW5mZXJpb3IiLCAiT2dvbmVrc21hbGwiLCAiUmluZ3NtYWxsIiwgIkNlZGlsbGFzbWFsbCIsICJvbmVxdWFydGVyIiwgIm9uZWhhbGYiLCAidGhyZWVxdWFydGVycyIsICJxdWVzdGlvbmRvd25zbWFsbCIsICJvbmVlaWdodGgiLCAidGhyZWVlaWdodGhzIiwgImZpdmVlaWdodGhzIiwgInNldmVuZWlnaHRocyIsICJvbmV0aGlyZCIsICJ0d290aGlyZHMiLCAiemVyb3N1cGVyaW9yIiwgIm9uZXN1cGVyaW9yIiwgInR3b3N1cGVyaW9yIiwgInRocmVlc3VwZXJpb3IiLCAiZm91cnN1cGVyaW9yIiwgImZpdmVzdXBlcmlvciIsICJzaXhzdXBlcmlvciIsICJzZXZlbnN1cGVyaW9yIiwgImVpZ2h0c3VwZXJpb3IiLCAibmluZXN1cGVyaW9yIiwgInplcm9pbmZlcmlvciIsICJvbmVpbmZlcmlvciIsICJ0d29pbmZlcmlvciIsICJ0aHJlZWluZmVyaW9yIiwgImZvdXJpbmZlcmlvciIsICJmaXZlaW5mZXJpb3IiLCAic2l4aW5mZXJpb3IiLCAic2V2ZW5pbmZlcmlvciIsICJlaWdodGluZmVyaW9yIiwgIm5pbmVpbmZlcmlvciIsICJjZW50aW5mZXJpb3IiLCAiZG9sbGFyaW5mZXJpb3IiLCAicGVyaW9kaW5mZXJpb3IiLCAiY29tbWFpbmZlcmlvciIsICJBZ3JhdmVzbWFsbCIsICJBYWN1dGVzbWFsbCIsICJBY2lyY3VtZmxleHNtYWxsIiwgIkF0aWxkZXNtYWxsIiwgIkFkaWVyZXNpc3NtYWxsIiwgIkFyaW5nc21hbGwiLCAiQUVzbWFsbCIsICJDY2VkaWxsYXNtYWxsIiwgIkVncmF2ZXNtYWxsIiwgIkVhY3V0ZXNtYWxsIiwgIkVjaXJjdW1mbGV4c21hbGwiLCAiRWRpZXJlc2lzc21hbGwiLCAiSWdyYXZlc21hbGwiLCAiSWFjdXRlc21hbGwiLCAiSWNpcmN1bWZsZXhzbWFsbCIsICJJZGllcmVzaXNzbWFsbCIsICJFdGhzbWFsbCIsICJOdGlsZGVzbWFsbCIsICJPZ3JhdmVzbWFsbCIsICJPYWN1dGVzbWFsbCIsICJPY2lyY3VtZmxleHNtYWxsIiwgIk90aWxkZXNtYWxsIiwgIk9kaWVyZXNpc3NtYWxsIiwgIk9Fc21hbGwiLCAiT3NsYXNoc21hbGwiLCAiVWdyYXZlc21hbGwiLCAiVWFjdXRlc21hbGwiLCAiVWNpcmN1bWZsZXhzbWFsbCIsICJVZGllcmVzaXNzbWFsbCIsICJZYWN1dGVzbWFsbCIsICJUaG9ybnNtYWxsIiwgIllkaWVyZXNpc3NtYWxsIl07CmNvbnN0IEV4cGVydFN1YnNldENoYXJzZXQgPSBbIi5ub3RkZWYiLCAic3BhY2UiLCAiZG9sbGFyb2xkc3R5bGUiLCAiZG9sbGFyc3VwZXJpb3IiLCAicGFyZW5sZWZ0c3VwZXJpb3IiLCAicGFyZW5yaWdodHN1cGVyaW9yIiwgInR3b2RvdGVubGVhZGVyIiwgIm9uZWRvdGVubGVhZGVyIiwgImNvbW1hIiwgImh5cGhlbiIsICJwZXJpb2QiLCAiZnJhY3Rpb24iLCAiemVyb29sZHN0eWxlIiwgIm9uZW9sZHN0eWxlIiwgInR3b29sZHN0eWxlIiwgInRocmVlb2xkc3R5bGUiLCAiZm91cm9sZHN0eWxlIiwgImZpdmVvbGRzdHlsZSIsICJzaXhvbGRzdHlsZSIsICJzZXZlbm9sZHN0eWxlIiwgImVpZ2h0b2xkc3R5bGUiLCAibmluZW9sZHN0eWxlIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJjb21tYXN1cGVyaW9yIiwgInRocmVlcXVhcnRlcnNlbWRhc2giLCAicGVyaW9kc3VwZXJpb3IiLCAiYXN1cGVyaW9yIiwgImJzdXBlcmlvciIsICJjZW50c3VwZXJpb3IiLCAiZHN1cGVyaW9yIiwgImVzdXBlcmlvciIsICJpc3VwZXJpb3IiLCAibHN1cGVyaW9yIiwgIm1zdXBlcmlvciIsICJuc3VwZXJpb3IiLCAib3N1cGVyaW9yIiwgInJzdXBlcmlvciIsICJzc3VwZXJpb3IiLCAidHN1cGVyaW9yIiwgImZmIiwgImZpIiwgImZsIiwgImZmaSIsICJmZmwiLCAicGFyZW5sZWZ0aW5mZXJpb3IiLCAicGFyZW5yaWdodGluZmVyaW9yIiwgImh5cGhlbnN1cGVyaW9yIiwgImNvbG9ubW9uZXRhcnkiLCAib25lZml0dGVkIiwgInJ1cGlhaCIsICJjZW50b2xkc3R5bGUiLCAiZmlndXJlZGFzaCIsICJoeXBoZW5pbmZlcmlvciIsICJvbmVxdWFydGVyIiwgIm9uZWhhbGYiLCAidGhyZWVxdWFydGVycyIsICJvbmVlaWdodGgiLCAidGhyZWVlaWdodGhzIiwgImZpdmVlaWdodGhzIiwgInNldmVuZWlnaHRocyIsICJvbmV0aGlyZCIsICJ0d290aGlyZHMiLCAiemVyb3N1cGVyaW9yIiwgIm9uZXN1cGVyaW9yIiwgInR3b3N1cGVyaW9yIiwgInRocmVlc3VwZXJpb3IiLCAiZm91cnN1cGVyaW9yIiwgImZpdmVzdXBlcmlvciIsICJzaXhzdXBlcmlvciIsICJzZXZlbnN1cGVyaW9yIiwgImVpZ2h0c3VwZXJpb3IiLCAibmluZXN1cGVyaW9yIiwgInplcm9pbmZlcmlvciIsICJvbmVpbmZlcmlvciIsICJ0d29pbmZlcmlvciIsICJ0aHJlZWluZmVyaW9yIiwgImZvdXJpbmZlcmlvciIsICJmaXZlaW5mZXJpb3IiLCAic2l4aW5mZXJpb3IiLCAic2V2ZW5pbmZlcmlvciIsICJlaWdodGluZmVyaW9yIiwgIm5pbmVpbmZlcmlvciIsICJjZW50aW5mZXJpb3IiLCAiZG9sbGFyaW5mZXJpb3IiLCAicGVyaW9kaW5mZXJpb3IiLCAiY29tbWFpbmZlcmlvciJdOwoKOy8vIC4vc3JjL2NvcmUvY2ZmX3BhcnNlci5qcwoKCgoKY29uc3QgTUFYX1NVQlJfTkVTVElORyA9IDEwOwpjb25zdCBDRkZTdGFuZGFyZFN0cmluZ3MgPSBbIi5ub3RkZWYiLCAic3BhY2UiLCAiZXhjbGFtIiwgInF1b3RlZGJsIiwgIm51bWJlcnNpZ24iLCAiZG9sbGFyIiwgInBlcmNlbnQiLCAiYW1wZXJzYW5kIiwgInF1b3RlcmlnaHQiLCAicGFyZW5sZWZ0IiwgInBhcmVucmlnaHQiLCAiYXN0ZXJpc2siLCAicGx1cyIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgInNsYXNoIiwgInplcm8iLCAib25lIiwgInR3byIsICJ0aHJlZSIsICJmb3VyIiwgImZpdmUiLCAic2l4IiwgInNldmVuIiwgImVpZ2h0IiwgIm5pbmUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImxlc3MiLCAiZXF1YWwiLCAiZ3JlYXRlciIsICJxdWVzdGlvbiIsICJhdCIsICJBIiwgIkIiLCAiQyIsICJEIiwgIkUiLCAiRiIsICJHIiwgIkgiLCAiSSIsICJKIiwgIksiLCAiTCIsICJNIiwgIk4iLCAiTyIsICJQIiwgIlEiLCAiUiIsICJTIiwgIlQiLCAiVSIsICJWIiwgIlciLCAiWCIsICJZIiwgIloiLCAiYnJhY2tldGxlZnQiLCAiYmFja3NsYXNoIiwgImJyYWNrZXRyaWdodCIsICJhc2NpaWNpcmN1bSIsICJ1bmRlcnNjb3JlIiwgInF1b3RlbGVmdCIsICJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiIsICJnIiwgImgiLCAiaSIsICJqIiwgImsiLCAibCIsICJtIiwgIm4iLCAibyIsICJwIiwgInEiLCAiciIsICJzIiwgInQiLCAidSIsICJ2IiwgInciLCAieCIsICJ5IiwgInoiLCAiYnJhY2VsZWZ0IiwgImJhciIsICJicmFjZXJpZ2h0IiwgImFzY2lpdGlsZGUiLCAiZXhjbGFtZG93biIsICJjZW50IiwgInN0ZXJsaW5nIiwgImZyYWN0aW9uIiwgInllbiIsICJmbG9yaW4iLCAic2VjdGlvbiIsICJjdXJyZW5jeSIsICJxdW90ZXNpbmdsZSIsICJxdW90ZWRibGxlZnQiLCAiZ3VpbGxlbW90bGVmdCIsICJndWlsc2luZ2xsZWZ0IiwgImd1aWxzaW5nbHJpZ2h0IiwgImZpIiwgImZsIiwgImVuZGFzaCIsICJkYWdnZXIiLCAiZGFnZ2VyZGJsIiwgInBlcmlvZGNlbnRlcmVkIiwgInBhcmFncmFwaCIsICJidWxsZXQiLCAicXVvdGVzaW5nbGJhc2UiLCAicXVvdGVkYmxiYXNlIiwgInF1b3RlZGJscmlnaHQiLCAiZ3VpbGxlbW90cmlnaHQiLCAiZWxsaXBzaXMiLCAicGVydGhvdXNhbmQiLCAicXVlc3Rpb25kb3duIiwgImdyYXZlIiwgImFjdXRlIiwgImNpcmN1bWZsZXgiLCAidGlsZGUiLCAibWFjcm9uIiwgImJyZXZlIiwgImRvdGFjY2VudCIsICJkaWVyZXNpcyIsICJyaW5nIiwgImNlZGlsbGEiLCAiaHVuZ2FydW1sYXV0IiwgIm9nb25layIsICJjYXJvbiIsICJlbWRhc2giLCAiQUUiLCAib3JkZmVtaW5pbmUiLCAiTHNsYXNoIiwgIk9zbGFzaCIsICJPRSIsICJvcmRtYXNjdWxpbmUiLCAiYWUiLCAiZG90bGVzc2kiLCAibHNsYXNoIiwgIm9zbGFzaCIsICJvZSIsICJnZXJtYW5kYmxzIiwgIm9uZXN1cGVyaW9yIiwgImxvZ2ljYWxub3QiLCAibXUiLCAidHJhZGVtYXJrIiwgIkV0aCIsICJvbmVoYWxmIiwgInBsdXNtaW51cyIsICJUaG9ybiIsICJvbmVxdWFydGVyIiwgImRpdmlkZSIsICJicm9rZW5iYXIiLCAiZGVncmVlIiwgInRob3JuIiwgInRocmVlcXVhcnRlcnMiLCAidHdvc3VwZXJpb3IiLCAicmVnaXN0ZXJlZCIsICJtaW51cyIsICJldGgiLCAibXVsdGlwbHkiLCAidGhyZWVzdXBlcmlvciIsICJjb3B5cmlnaHQiLCAiQWFjdXRlIiwgIkFjaXJjdW1mbGV4IiwgIkFkaWVyZXNpcyIsICJBZ3JhdmUiLCAiQXJpbmciLCAiQXRpbGRlIiwgIkNjZWRpbGxhIiwgIkVhY3V0ZSIsICJFY2lyY3VtZmxleCIsICJFZGllcmVzaXMiLCAiRWdyYXZlIiwgIklhY3V0ZSIsICJJY2lyY3VtZmxleCIsICJJZGllcmVzaXMiLCAiSWdyYXZlIiwgIk50aWxkZSIsICJPYWN1dGUiLCAiT2NpcmN1bWZsZXgiLCAiT2RpZXJlc2lzIiwgIk9ncmF2ZSIsICJPdGlsZGUiLCAiU2Nhcm9uIiwgIlVhY3V0ZSIsICJVY2lyY3VtZmxleCIsICJVZGllcmVzaXMiLCAiVWdyYXZlIiwgIllhY3V0ZSIsICJZZGllcmVzaXMiLCAiWmNhcm9uIiwgImFhY3V0ZSIsICJhY2lyY3VtZmxleCIsICJhZGllcmVzaXMiLCAiYWdyYXZlIiwgImFyaW5nIiwgImF0aWxkZSIsICJjY2VkaWxsYSIsICJlYWN1dGUiLCAiZWNpcmN1bWZsZXgiLCAiZWRpZXJlc2lzIiwgImVncmF2ZSIsICJpYWN1dGUiLCAiaWNpcmN1bWZsZXgiLCAiaWRpZXJlc2lzIiwgImlncmF2ZSIsICJudGlsZGUiLCAib2FjdXRlIiwgIm9jaXJjdW1mbGV4IiwgIm9kaWVyZXNpcyIsICJvZ3JhdmUiLCAib3RpbGRlIiwgInNjYXJvbiIsICJ1YWN1dGUiLCAidWNpcmN1bWZsZXgiLCAidWRpZXJlc2lzIiwgInVncmF2ZSIsICJ5YWN1dGUiLCAieWRpZXJlc2lzIiwgInpjYXJvbiIsICJleGNsYW1zbWFsbCIsICJIdW5nYXJ1bWxhdXRzbWFsbCIsICJkb2xsYXJvbGRzdHlsZSIsICJkb2xsYXJzdXBlcmlvciIsICJhbXBlcnNhbmRzbWFsbCIsICJBY3V0ZXNtYWxsIiwgInBhcmVubGVmdHN1cGVyaW9yIiwgInBhcmVucmlnaHRzdXBlcmlvciIsICJ0d29kb3RlbmxlYWRlciIsICJvbmVkb3RlbmxlYWRlciIsICJ6ZXJvb2xkc3R5bGUiLCAib25lb2xkc3R5bGUiLCAidHdvb2xkc3R5bGUiLCAidGhyZWVvbGRzdHlsZSIsICJmb3Vyb2xkc3R5bGUiLCAiZml2ZW9sZHN0eWxlIiwgInNpeG9sZHN0eWxlIiwgInNldmVub2xkc3R5bGUiLCAiZWlnaHRvbGRzdHlsZSIsICJuaW5lb2xkc3R5bGUiLCAiY29tbWFzdXBlcmlvciIsICJ0aHJlZXF1YXJ0ZXJzZW1kYXNoIiwgInBlcmlvZHN1cGVyaW9yIiwgInF1ZXN0aW9uc21hbGwiLCAiYXN1cGVyaW9yIiwgImJzdXBlcmlvciIsICJjZW50c3VwZXJpb3IiLCAiZHN1cGVyaW9yIiwgImVzdXBlcmlvciIsICJpc3VwZXJpb3IiLCAibHN1cGVyaW9yIiwgIm1zdXBlcmlvciIsICJuc3VwZXJpb3IiLCAib3N1cGVyaW9yIiwgInJzdXBlcmlvciIsICJzc3VwZXJpb3IiLCAidHN1cGVyaW9yIiwgImZmIiwgImZmaSIsICJmZmwiLCAicGFyZW5sZWZ0aW5mZXJpb3IiLCAicGFyZW5yaWdodGluZmVyaW9yIiwgIkNpcmN1bWZsZXhzbWFsbCIsICJoeXBoZW5zdXBlcmlvciIsICJHcmF2ZXNtYWxsIiwgIkFzbWFsbCIsICJCc21hbGwiLCAiQ3NtYWxsIiwgIkRzbWFsbCIsICJFc21hbGwiLCAiRnNtYWxsIiwgIkdzbWFsbCIsICJIc21hbGwiLCAiSXNtYWxsIiwgIkpzbWFsbCIsICJLc21hbGwiLCAiTHNtYWxsIiwgIk1zbWFsbCIsICJOc21hbGwiLCAiT3NtYWxsIiwgIlBzbWFsbCIsICJRc21hbGwiLCAiUnNtYWxsIiwgIlNzbWFsbCIsICJUc21hbGwiLCAiVXNtYWxsIiwgIlZzbWFsbCIsICJXc21hbGwiLCAiWHNtYWxsIiwgIllzbWFsbCIsICJac21hbGwiLCAiY29sb25tb25ldGFyeSIsICJvbmVmaXR0ZWQiLCAicnVwaWFoIiwgIlRpbGRlc21hbGwiLCAiZXhjbGFtZG93bnNtYWxsIiwgImNlbnRvbGRzdHlsZSIsICJMc2xhc2hzbWFsbCIsICJTY2Fyb25zbWFsbCIsICJaY2Fyb25zbWFsbCIsICJEaWVyZXNpc3NtYWxsIiwgIkJyZXZlc21hbGwiLCAiQ2Fyb25zbWFsbCIsICJEb3RhY2NlbnRzbWFsbCIsICJNYWNyb25zbWFsbCIsICJmaWd1cmVkYXNoIiwgImh5cGhlbmluZmVyaW9yIiwgIk9nb25la3NtYWxsIiwgIlJpbmdzbWFsbCIsICJDZWRpbGxhc21hbGwiLCAicXVlc3Rpb25kb3duc21hbGwiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgInplcm9zdXBlcmlvciIsICJmb3Vyc3VwZXJpb3IiLCAiZml2ZXN1cGVyaW9yIiwgInNpeHN1cGVyaW9yIiwgInNldmVuc3VwZXJpb3IiLCAiZWlnaHRzdXBlcmlvciIsICJuaW5lc3VwZXJpb3IiLCAiemVyb2luZmVyaW9yIiwgIm9uZWluZmVyaW9yIiwgInR3b2luZmVyaW9yIiwgInRocmVlaW5mZXJpb3IiLCAiZm91cmluZmVyaW9yIiwgImZpdmVpbmZlcmlvciIsICJzaXhpbmZlcmlvciIsICJzZXZlbmluZmVyaW9yIiwgImVpZ2h0aW5mZXJpb3IiLCAibmluZWluZmVyaW9yIiwgImNlbnRpbmZlcmlvciIsICJkb2xsYXJpbmZlcmlvciIsICJwZXJpb2RpbmZlcmlvciIsICJjb21tYWluZmVyaW9yIiwgIkFncmF2ZXNtYWxsIiwgIkFhY3V0ZXNtYWxsIiwgIkFjaXJjdW1mbGV4c21hbGwiLCAiQXRpbGRlc21hbGwiLCAiQWRpZXJlc2lzc21hbGwiLCAiQXJpbmdzbWFsbCIsICJBRXNtYWxsIiwgIkNjZWRpbGxhc21hbGwiLCAiRWdyYXZlc21hbGwiLCAiRWFjdXRlc21hbGwiLCAiRWNpcmN1bWZsZXhzbWFsbCIsICJFZGllcmVzaXNzbWFsbCIsICJJZ3JhdmVzbWFsbCIsICJJYWN1dGVzbWFsbCIsICJJY2lyY3VtZmxleHNtYWxsIiwgIklkaWVyZXNpc3NtYWxsIiwgIkV0aHNtYWxsIiwgIk50aWxkZXNtYWxsIiwgIk9ncmF2ZXNtYWxsIiwgIk9hY3V0ZXNtYWxsIiwgIk9jaXJjdW1mbGV4c21hbGwiLCAiT3RpbGRlc21hbGwiLCAiT2RpZXJlc2lzc21hbGwiLCAiT0VzbWFsbCIsICJPc2xhc2hzbWFsbCIsICJVZ3JhdmVzbWFsbCIsICJVYWN1dGVzbWFsbCIsICJVY2lyY3VtZmxleHNtYWxsIiwgIlVkaWVyZXNpc3NtYWxsIiwgIllhY3V0ZXNtYWxsIiwgIlRob3Juc21hbGwiLCAiWWRpZXJlc2lzc21hbGwiLCAiMDAxLjAwMCIsICIwMDEuMDAxIiwgIjAwMS4wMDIiLCAiMDAxLjAwMyIsICJCbGFjayIsICJCb2xkIiwgIkJvb2siLCAiTGlnaHQiLCAiTWVkaXVtIiwgIlJlZ3VsYXIiLCAiUm9tYW4iLCAiU2VtaWJvbGQiXTsKY29uc3QgTlVNX1NUQU5EQVJEX0NGRl9TVFJJTkdTID0gMzkxOwpjb25zdCBDaGFyc3RyaW5nVmFsaWRhdGlvbkRhdGEgPSBbbnVsbCwgewogIGlkOiAiaHN0ZW0iLAogIG1pbjogMiwKICBzdGFja0NsZWFyaW5nOiB0cnVlLAogIHN0ZW06IHRydWUKfSwgbnVsbCwgewogIGlkOiAidnN0ZW0iLAogIG1pbjogMiwKICBzdGFja0NsZWFyaW5nOiB0cnVlLAogIHN0ZW06IHRydWUKfSwgewogIGlkOiAidm1vdmV0byIsCiAgbWluOiAxLAogIHN0YWNrQ2xlYXJpbmc6IHRydWUKfSwgewogIGlkOiAicmxpbmV0byIsCiAgbWluOiAyLAogIHJlc2V0U3RhY2s6IHRydWUKfSwgewogIGlkOiAiaGxpbmV0byIsCiAgbWluOiAxLAogIHJlc2V0U3RhY2s6IHRydWUKfSwgewogIGlkOiAidmxpbmV0byIsCiAgbWluOiAxLAogIHJlc2V0U3RhY2s6IHRydWUKfSwgewogIGlkOiAicnJjdXJ2ZXRvIiwKICBtaW46IDYsCiAgcmVzZXRTdGFjazogdHJ1ZQp9LCBudWxsLCB7CiAgaWQ6ICJjYWxsc3ViciIsCiAgbWluOiAxLAogIHVuZGVmU3RhY2s6IHRydWUKfSwgewogIGlkOiAicmV0dXJuIiwKICBtaW46IDAsCiAgdW5kZWZTdGFjazogdHJ1ZQp9LCBudWxsLCBudWxsLCB7CiAgaWQ6ICJlbmRjaGFyIiwKICBtaW46IDAsCiAgc3RhY2tDbGVhcmluZzogdHJ1ZQp9LCBudWxsLCBudWxsLCBudWxsLCB7CiAgaWQ6ICJoc3RlbWhtIiwKICBtaW46IDIsCiAgc3RhY2tDbGVhcmluZzogdHJ1ZSwKICBzdGVtOiB0cnVlCn0sIHsKICBpZDogImhpbnRtYXNrIiwKICBtaW46IDAsCiAgc3RhY2tDbGVhcmluZzogdHJ1ZQp9LCB7CiAgaWQ6ICJjbnRybWFzayIsCiAgbWluOiAwLAogIHN0YWNrQ2xlYXJpbmc6IHRydWUKfSwgewogIGlkOiAicm1vdmV0byIsCiAgbWluOiAyLAogIHN0YWNrQ2xlYXJpbmc6IHRydWUKfSwgewogIGlkOiAiaG1vdmV0byIsCiAgbWluOiAxLAogIHN0YWNrQ2xlYXJpbmc6IHRydWUKfSwgewogIGlkOiAidnN0ZW1obSIsCiAgbWluOiAyLAogIHN0YWNrQ2xlYXJpbmc6IHRydWUsCiAgc3RlbTogdHJ1ZQp9LCB7CiAgaWQ6ICJyY3VydmVsaW5lIiwKICBtaW46IDgsCiAgcmVzZXRTdGFjazogdHJ1ZQp9LCB7CiAgaWQ6ICJybGluZWN1cnZlIiwKICBtaW46IDgsCiAgcmVzZXRTdGFjazogdHJ1ZQp9LCB7CiAgaWQ6ICJ2dmN1cnZldG8iLAogIG1pbjogNCwKICByZXNldFN0YWNrOiB0cnVlCn0sIHsKICBpZDogImhoY3VydmV0byIsCiAgbWluOiA0LAogIHJlc2V0U3RhY2s6IHRydWUKfSwgbnVsbCwgewogIGlkOiAiY2FsbGdzdWJyIiwKICBtaW46IDEsCiAgdW5kZWZTdGFjazogdHJ1ZQp9LCB7CiAgaWQ6ICJ2aGN1cnZldG8iLAogIG1pbjogNCwKICByZXNldFN0YWNrOiB0cnVlCn0sIHsKICBpZDogImh2Y3VydmV0byIsCiAgbWluOiA0LAogIHJlc2V0U3RhY2s6IHRydWUKfV07CmNvbnN0IENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YTEyID0gW251bGwsIG51bGwsIG51bGwsIHsKICBpZDogImFuZCIsCiAgbWluOiAyLAogIHN0YWNrRGVsdGE6IC0xCn0sIHsKICBpZDogIm9yIiwKICBtaW46IDIsCiAgc3RhY2tEZWx0YTogLTEKfSwgewogIGlkOiAibm90IiwKICBtaW46IDEsCiAgc3RhY2tEZWx0YTogMAp9LCBudWxsLCBudWxsLCBudWxsLCB7CiAgaWQ6ICJhYnMiLAogIG1pbjogMSwKICBzdGFja0RlbHRhOiAwCn0sIHsKICBpZDogImFkZCIsCiAgbWluOiAyLAogIHN0YWNrRGVsdGE6IC0xLAogIHN0YWNrRm4oc3RhY2ssIGluZGV4KSB7CiAgICBzdGFja1tpbmRleCAtIDJdID0gc3RhY2tbaW5kZXggLSAyXSArIHN0YWNrW2luZGV4IC0gMV07CiAgfQp9LCB7CiAgaWQ6ICJzdWIiLAogIG1pbjogMiwKICBzdGFja0RlbHRhOiAtMSwKICBzdGFja0ZuKHN0YWNrLCBpbmRleCkgewogICAgc3RhY2tbaW5kZXggLSAyXSA9IHN0YWNrW2luZGV4IC0gMl0gLSBzdGFja1tpbmRleCAtIDFdOwogIH0KfSwgewogIGlkOiAiZGl2IiwKICBtaW46IDIsCiAgc3RhY2tEZWx0YTogLTEsCiAgc3RhY2tGbihzdGFjaywgaW5kZXgpIHsKICAgIHN0YWNrW2luZGV4IC0gMl0gPSBzdGFja1tpbmRleCAtIDJdIC8gc3RhY2tbaW5kZXggLSAxXTsKICB9Cn0sIG51bGwsIHsKICBpZDogIm5lZyIsCiAgbWluOiAxLAogIHN0YWNrRGVsdGE6IDAsCiAgc3RhY2tGbihzdGFjaywgaW5kZXgpIHsKICAgIHN0YWNrW2luZGV4IC0gMV0gPSAtc3RhY2tbaW5kZXggLSAxXTsKICB9Cn0sIHsKICBpZDogImVxIiwKICBtaW46IDIsCiAgc3RhY2tEZWx0YTogLTEKfSwgbnVsbCwgbnVsbCwgewogIGlkOiAiZHJvcCIsCiAgbWluOiAxLAogIHN0YWNrRGVsdGE6IC0xCn0sIG51bGwsIHsKICBpZDogInB1dCIsCiAgbWluOiAyLAogIHN0YWNrRGVsdGE6IC0yCn0sIHsKICBpZDogImdldCIsCiAgbWluOiAxLAogIHN0YWNrRGVsdGE6IDAKfSwgewogIGlkOiAiaWZlbHNlIiwKICBtaW46IDQsCiAgc3RhY2tEZWx0YTogLTMKfSwgewogIGlkOiAicmFuZG9tIiwKICBtaW46IDAsCiAgc3RhY2tEZWx0YTogMQp9LCB7CiAgaWQ6ICJtdWwiLAogIG1pbjogMiwKICBzdGFja0RlbHRhOiAtMSwKICBzdGFja0ZuKHN0YWNrLCBpbmRleCkgewogICAgc3RhY2tbaW5kZXggLSAyXSA9IHN0YWNrW2luZGV4IC0gMl0gKiBzdGFja1tpbmRleCAtIDFdOwogIH0KfSwgbnVsbCwgewogIGlkOiAic3FydCIsCiAgbWluOiAxLAogIHN0YWNrRGVsdGE6IDAKfSwgewogIGlkOiAiZHVwIiwKICBtaW46IDEsCiAgc3RhY2tEZWx0YTogMQp9LCB7CiAgaWQ6ICJleGNoIiwKICBtaW46IDIsCiAgc3RhY2tEZWx0YTogMAp9LCB7CiAgaWQ6ICJpbmRleCIsCiAgbWluOiAyLAogIHN0YWNrRGVsdGE6IDAKfSwgewogIGlkOiAicm9sbCIsCiAgbWluOiAzLAogIHN0YWNrRGVsdGE6IC0yCn0sIG51bGwsIG51bGwsIG51bGwsIHsKICBpZDogImhmbGV4IiwKICBtaW46IDcsCiAgcmVzZXRTdGFjazogdHJ1ZQp9LCB7CiAgaWQ6ICJmbGV4IiwKICBtaW46IDEzLAogIHJlc2V0U3RhY2s6IHRydWUKfSwgewogIGlkOiAiaGZsZXgxIiwKICBtaW46IDksCiAgcmVzZXRTdGFjazogdHJ1ZQp9LCB7CiAgaWQ6ICJmbGV4MSIsCiAgbWluOiAxMSwKICByZXNldFN0YWNrOiB0cnVlCn1dOwpjbGFzcyBDRkZQYXJzZXIgewogIGNvbnN0cnVjdG9yKGZpbGUsIHByb3BlcnRpZXMsIHNlYWNBbmFseXNpc0VuYWJsZWQpIHsKICAgIHRoaXMuYnl0ZXMgPSBmaWxlLmdldEJ5dGVzKCk7CiAgICB0aGlzLnByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzOwogICAgdGhpcy5zZWFjQW5hbHlzaXNFbmFibGVkID0gISFzZWFjQW5hbHlzaXNFbmFibGVkOwogIH0KICBwYXJzZSgpIHsKICAgIGNvbnN0IHByb3BlcnRpZXMgPSB0aGlzLnByb3BlcnRpZXM7CiAgICBjb25zdCBjZmYgPSBuZXcgQ0ZGKCk7CiAgICB0aGlzLmNmZiA9IGNmZjsKICAgIGNvbnN0IGhlYWRlciA9IHRoaXMucGFyc2VIZWFkZXIoKTsKICAgIGNvbnN0IG5hbWVJbmRleCA9IHRoaXMucGFyc2VJbmRleChoZWFkZXIuZW5kUG9zKTsKICAgIGNvbnN0IHRvcERpY3RJbmRleCA9IHRoaXMucGFyc2VJbmRleChuYW1lSW5kZXguZW5kUG9zKTsKICAgIGNvbnN0IHN0cmluZ0luZGV4ID0gdGhpcy5wYXJzZUluZGV4KHRvcERpY3RJbmRleC5lbmRQb3MpOwogICAgY29uc3QgZ2xvYmFsU3VickluZGV4ID0gdGhpcy5wYXJzZUluZGV4KHN0cmluZ0luZGV4LmVuZFBvcyk7CiAgICBjb25zdCB0b3BEaWN0UGFyc2VkID0gdGhpcy5wYXJzZURpY3QodG9wRGljdEluZGV4Lm9iai5nZXQoMCkpOwogICAgY29uc3QgdG9wRGljdCA9IHRoaXMuY3JlYXRlRGljdChDRkZUb3BEaWN0LCB0b3BEaWN0UGFyc2VkLCBjZmYuc3RyaW5ncyk7CiAgICBjZmYuaGVhZGVyID0gaGVhZGVyLm9iajsKICAgIGNmZi5uYW1lcyA9IHRoaXMucGFyc2VOYW1lSW5kZXgobmFtZUluZGV4Lm9iaik7CiAgICBjZmYuc3RyaW5ncyA9IHRoaXMucGFyc2VTdHJpbmdJbmRleChzdHJpbmdJbmRleC5vYmopOwogICAgY2ZmLnRvcERpY3QgPSB0b3BEaWN0OwogICAgY2ZmLmdsb2JhbFN1YnJJbmRleCA9IGdsb2JhbFN1YnJJbmRleC5vYmo7CiAgICB0aGlzLnBhcnNlUHJpdmF0ZURpY3QoY2ZmLnRvcERpY3QpOwogICAgY2ZmLmlzQ0lERm9udCA9IHRvcERpY3QuaGFzTmFtZSgiUk9TIik7CiAgICBjb25zdCBjaGFyU3RyaW5nT2Zmc2V0ID0gdG9wRGljdC5nZXRCeU5hbWUoIkNoYXJTdHJpbmdzIik7CiAgICBjb25zdCBjaGFyU3RyaW5nSW5kZXggPSB0aGlzLnBhcnNlSW5kZXgoY2hhclN0cmluZ09mZnNldCkub2JqOwogICAgY29uc3QgZm9udE1hdHJpeCA9IHRvcERpY3QuZ2V0QnlOYW1lKCJGb250TWF0cml4Iik7CiAgICBpZiAoZm9udE1hdHJpeCkgewogICAgICBwcm9wZXJ0aWVzLmZvbnRNYXRyaXggPSBmb250TWF0cml4OwogICAgfQogICAgY29uc3QgZm9udEJCb3ggPSB0b3BEaWN0LmdldEJ5TmFtZSgiRm9udEJCb3giKTsKICAgIGlmIChmb250QkJveCkgewogICAgICBwcm9wZXJ0aWVzLmFzY2VudCA9IE1hdGgubWF4KGZvbnRCQm94WzNdLCBmb250QkJveFsxXSk7CiAgICAgIHByb3BlcnRpZXMuZGVzY2VudCA9IE1hdGgubWluKGZvbnRCQm94WzFdLCBmb250QkJveFszXSk7CiAgICAgIHByb3BlcnRpZXMuYXNjZW50U2NhbGVkID0gdHJ1ZTsKICAgIH0KICAgIGxldCBjaGFyc2V0LCBlbmNvZGluZzsKICAgIGlmIChjZmYuaXNDSURGb250KSB7CiAgICAgIGNvbnN0IGZkQXJyYXlJbmRleCA9IHRoaXMucGFyc2VJbmRleCh0b3BEaWN0LmdldEJ5TmFtZSgiRkRBcnJheSIpKS5vYmo7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGZkQXJyYXlJbmRleC5jb3VudDsgaSA8IGlpOyArK2kpIHsKICAgICAgICBjb25zdCBkaWN0UmF3ID0gZmRBcnJheUluZGV4LmdldChpKTsKICAgICAgICBjb25zdCBmb250RGljdCA9IHRoaXMuY3JlYXRlRGljdChDRkZUb3BEaWN0LCB0aGlzLnBhcnNlRGljdChkaWN0UmF3KSwgY2ZmLnN0cmluZ3MpOwogICAgICAgIHRoaXMucGFyc2VQcml2YXRlRGljdChmb250RGljdCk7CiAgICAgICAgY2ZmLmZkQXJyYXkucHVzaChmb250RGljdCk7CiAgICAgIH0KICAgICAgZW5jb2RpbmcgPSBudWxsOwogICAgICBjaGFyc2V0ID0gdGhpcy5wYXJzZUNoYXJzZXRzKHRvcERpY3QuZ2V0QnlOYW1lKCJjaGFyc2V0IiksIGNoYXJTdHJpbmdJbmRleC5jb3VudCwgY2ZmLnN0cmluZ3MsIHRydWUpOwogICAgICBjZmYuZmRTZWxlY3QgPSB0aGlzLnBhcnNlRkRTZWxlY3QodG9wRGljdC5nZXRCeU5hbWUoIkZEU2VsZWN0IiksIGNoYXJTdHJpbmdJbmRleC5jb3VudCk7CiAgICB9IGVsc2UgewogICAgICBjaGFyc2V0ID0gdGhpcy5wYXJzZUNoYXJzZXRzKHRvcERpY3QuZ2V0QnlOYW1lKCJjaGFyc2V0IiksIGNoYXJTdHJpbmdJbmRleC5jb3VudCwgY2ZmLnN0cmluZ3MsIGZhbHNlKTsKICAgICAgZW5jb2RpbmcgPSB0aGlzLnBhcnNlRW5jb2RpbmcodG9wRGljdC5nZXRCeU5hbWUoIkVuY29kaW5nIiksIHByb3BlcnRpZXMsIGNmZi5zdHJpbmdzLCBjaGFyc2V0LmNoYXJzZXQpOwogICAgfQogICAgY2ZmLmNoYXJzZXQgPSBjaGFyc2V0OwogICAgY2ZmLmVuY29kaW5nID0gZW5jb2Rpbmc7CiAgICBjb25zdCBjaGFyU3RyaW5nc0FuZFNlYWNzID0gdGhpcy5wYXJzZUNoYXJTdHJpbmdzKHsKICAgICAgY2hhclN0cmluZ3M6IGNoYXJTdHJpbmdJbmRleCwKICAgICAgbG9jYWxTdWJySW5kZXg6IHRvcERpY3QucHJpdmF0ZURpY3Quc3VicnNJbmRleCwKICAgICAgZ2xvYmFsU3VickluZGV4OiBnbG9iYWxTdWJySW5kZXgub2JqLAogICAgICBmZFNlbGVjdDogY2ZmLmZkU2VsZWN0LAogICAgICBmZEFycmF5OiBjZmYuZmRBcnJheSwKICAgICAgcHJpdmF0ZURpY3Q6IHRvcERpY3QucHJpdmF0ZURpY3QKICAgIH0pOwogICAgY2ZmLmNoYXJTdHJpbmdzID0gY2hhclN0cmluZ3NBbmRTZWFjcy5jaGFyU3RyaW5nczsKICAgIGNmZi5zZWFjcyA9IGNoYXJTdHJpbmdzQW5kU2VhY3Muc2VhY3M7CiAgICBjZmYud2lkdGhzID0gY2hhclN0cmluZ3NBbmRTZWFjcy53aWR0aHM7CiAgICByZXR1cm4gY2ZmOwogIH0KICBwYXJzZUhlYWRlcigpIHsKICAgIGxldCBieXRlcyA9IHRoaXMuYnl0ZXM7CiAgICBjb25zdCBieXRlc0xlbmd0aCA9IGJ5dGVzLmxlbmd0aDsKICAgIGxldCBvZmZzZXQgPSAwOwogICAgd2hpbGUgKG9mZnNldCA8IGJ5dGVzTGVuZ3RoICYmIGJ5dGVzW29mZnNldF0gIT09IDEpIHsKICAgICAgKytvZmZzZXQ7CiAgICB9CiAgICBpZiAob2Zmc2V0ID49IGJ5dGVzTGVuZ3RoKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBDRkYgaGVhZGVyIik7CiAgICB9CiAgICBpZiAob2Zmc2V0ICE9PSAwKSB7CiAgICAgIGluZm8oImNmZiBkYXRhIGlzIHNoaWZ0ZWQiKTsKICAgICAgYnl0ZXMgPSBieXRlcy5zdWJhcnJheShvZmZzZXQpOwogICAgICB0aGlzLmJ5dGVzID0gYnl0ZXM7CiAgICB9CiAgICBjb25zdCBtYWpvciA9IGJ5dGVzWzBdOwogICAgY29uc3QgbWlub3IgPSBieXRlc1sxXTsKICAgIGNvbnN0IGhkclNpemUgPSBieXRlc1syXTsKICAgIGNvbnN0IG9mZlNpemUgPSBieXRlc1szXTsKICAgIGNvbnN0IGhlYWRlciA9IG5ldyBDRkZIZWFkZXIobWFqb3IsIG1pbm9yLCBoZHJTaXplLCBvZmZTaXplKTsKICAgIHJldHVybiB7CiAgICAgIG9iajogaGVhZGVyLAogICAgICBlbmRQb3M6IGhkclNpemUKICAgIH07CiAgfQogIHBhcnNlRGljdChkaWN0KSB7CiAgICBsZXQgcG9zID0gMDsKICAgIGZ1bmN0aW9uIHBhcnNlT3BlcmFuZCgpIHsKICAgICAgbGV0IHZhbHVlID0gZGljdFtwb3MrK107CiAgICAgIGlmICh2YWx1ZSA9PT0gMzApIHsKICAgICAgICByZXR1cm4gcGFyc2VGbG9hdE9wZXJhbmQoKTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gMjgpIHsKICAgICAgICB2YWx1ZSA9IHJlYWRJbnQxNihkaWN0LCBwb3MpOwogICAgICAgIHBvcyArPSAyOwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gMjkpIHsKICAgICAgICB2YWx1ZSA9IGRpY3RbcG9zKytdOwogICAgICAgIHZhbHVlID0gdmFsdWUgPDwgOCB8IGRpY3RbcG9zKytdOwogICAgICAgIHZhbHVlID0gdmFsdWUgPDwgOCB8IGRpY3RbcG9zKytdOwogICAgICAgIHZhbHVlID0gdmFsdWUgPDwgOCB8IGRpY3RbcG9zKytdOwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA+PSAzMiAmJiB2YWx1ZSA8PSAyNDYpIHsKICAgICAgICByZXR1cm4gdmFsdWUgLSAxMzk7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gMjQ3ICYmIHZhbHVlIDw9IDI1MCkgewogICAgICAgIHJldHVybiAodmFsdWUgLSAyNDcpICogMjU2ICsgZGljdFtwb3MrK10gKyAxMDg7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gMjUxICYmIHZhbHVlIDw9IDI1NCkgewogICAgICAgIHJldHVybiAtKCh2YWx1ZSAtIDI1MSkgKiAyNTYpIC0gZGljdFtwb3MrK10gLSAxMDg7CiAgICAgIH0KICAgICAgd2FybignQ0ZGUGFyc2VyX3BhcnNlRGljdDogIicgKyB2YWx1ZSArICciIGlzIGEgcmVzZXJ2ZWQgY29tbWFuZC4nKTsKICAgICAgcmV0dXJuIE5hTjsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlRmxvYXRPcGVyYW5kKCkgewogICAgICBsZXQgc3RyID0gIiI7CiAgICAgIGNvbnN0IGVvZiA9IDE1OwogICAgICBjb25zdCBsb29rdXAgPSBbIjAiLCAiMSIsICIyIiwgIjMiLCAiNCIsICI1IiwgIjYiLCAiNyIsICI4IiwgIjkiLCAiLiIsICJFIiwgIkUtIiwgbnVsbCwgIi0iXTsKICAgICAgY29uc3QgbGVuZ3RoID0gZGljdC5sZW5ndGg7CiAgICAgIHdoaWxlIChwb3MgPCBsZW5ndGgpIHsKICAgICAgICBjb25zdCBiID0gZGljdFtwb3MrK107CiAgICAgICAgY29uc3QgYjEgPSBiID4+IDQ7CiAgICAgICAgY29uc3QgYjIgPSBiICYgMTU7CiAgICAgICAgaWYgKGIxID09PSBlb2YpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBzdHIgKz0gbG9va3VwW2IxXTsKICAgICAgICBpZiAoYjIgPT09IGVvZikgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHN0ciArPSBsb29rdXBbYjJdOwogICAgICB9CiAgICAgIHJldHVybiBwYXJzZUZsb2F0KHN0cik7CiAgICB9CiAgICBsZXQgb3BlcmFuZHMgPSBbXTsKICAgIGNvbnN0IGVudHJpZXMgPSBbXTsKICAgIHBvcyA9IDA7CiAgICBjb25zdCBlbmQgPSBkaWN0Lmxlbmd0aDsKICAgIHdoaWxlIChwb3MgPCBlbmQpIHsKICAgICAgbGV0IGIgPSBkaWN0W3Bvc107CiAgICAgIGlmIChiIDw9IDIxKSB7CiAgICAgICAgaWYgKGIgPT09IDEyKSB7CiAgICAgICAgICBiID0gYiA8PCA4IHwgZGljdFsrK3Bvc107CiAgICAgICAgfQogICAgICAgIGVudHJpZXMucHVzaChbYiwgb3BlcmFuZHNdKTsKICAgICAgICBvcGVyYW5kcyA9IFtdOwogICAgICAgICsrcG9zOwogICAgICB9IGVsc2UgewogICAgICAgIG9wZXJhbmRzLnB1c2gocGFyc2VPcGVyYW5kKCkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZW50cmllczsKICB9CiAgcGFyc2VJbmRleChwb3MpIHsKICAgIGNvbnN0IGNmZkluZGV4ID0gbmV3IENGRkluZGV4KCk7CiAgICBjb25zdCBieXRlcyA9IHRoaXMuYnl0ZXM7CiAgICBjb25zdCBjb3VudCA9IGJ5dGVzW3BvcysrXSA8PCA4IHwgYnl0ZXNbcG9zKytdOwogICAgY29uc3Qgb2Zmc2V0cyA9IFtdOwogICAgbGV0IGVuZCA9IHBvczsKICAgIGxldCBpLCBpaTsKICAgIGlmIChjb3VudCAhPT0gMCkgewogICAgICBjb25zdCBvZmZzZXRTaXplID0gYnl0ZXNbcG9zKytdOwogICAgICBjb25zdCBzdGFydFBvcyA9IHBvcyArIChjb3VudCArIDEpICogb2Zmc2V0U2l6ZSAtIDE7CiAgICAgIGZvciAoaSA9IDAsIGlpID0gY291bnQgKyAxOyBpIDwgaWk7ICsraSkgewogICAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgb2Zmc2V0U2l6ZTsgKytqKSB7CiAgICAgICAgICBvZmZzZXQgPDw9IDg7CiAgICAgICAgICBvZmZzZXQgKz0gYnl0ZXNbcG9zKytdOwogICAgICAgIH0KICAgICAgICBvZmZzZXRzLnB1c2goc3RhcnRQb3MgKyBvZmZzZXQpOwogICAgICB9CiAgICAgIGVuZCA9IG9mZnNldHNbY291bnRdOwogICAgfQogICAgZm9yIChpID0gMCwgaWkgPSBvZmZzZXRzLmxlbmd0aCAtIDE7IGkgPCBpaTsgKytpKSB7CiAgICAgIGNvbnN0IG9mZnNldFN0YXJ0ID0gb2Zmc2V0c1tpXTsKICAgICAgY29uc3Qgb2Zmc2V0RW5kID0gb2Zmc2V0c1tpICsgMV07CiAgICAgIGNmZkluZGV4LmFkZChieXRlcy5zdWJhcnJheShvZmZzZXRTdGFydCwgb2Zmc2V0RW5kKSk7CiAgICB9CiAgICByZXR1cm4gewogICAgICBvYmo6IGNmZkluZGV4LAogICAgICBlbmRQb3M6IGVuZAogICAgfTsKICB9CiAgcGFyc2VOYW1lSW5kZXgoaW5kZXgpIHsKICAgIGNvbnN0IG5hbWVzID0gW107CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBpbmRleC5jb3VudDsgaSA8IGlpOyArK2kpIHsKICAgICAgY29uc3QgbmFtZSA9IGluZGV4LmdldChpKTsKICAgICAgbmFtZXMucHVzaChieXRlc1RvU3RyaW5nKG5hbWUpKTsKICAgIH0KICAgIHJldHVybiBuYW1lczsKICB9CiAgcGFyc2VTdHJpbmdJbmRleChpbmRleCkgewogICAgY29uc3Qgc3RyaW5ncyA9IG5ldyBDRkZTdHJpbmdzKCk7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBpbmRleC5jb3VudDsgaSA8IGlpOyArK2kpIHsKICAgICAgY29uc3QgZGF0YSA9IGluZGV4LmdldChpKTsKICAgICAgc3RyaW5ncy5hZGQoYnl0ZXNUb1N0cmluZyhkYXRhKSk7CiAgICB9CiAgICByZXR1cm4gc3RyaW5nczsKICB9CiAgY3JlYXRlRGljdChUeXBlLCBkaWN0LCBzdHJpbmdzKSB7CiAgICBjb25zdCBjZmZEaWN0ID0gbmV3IFR5cGUoc3RyaW5ncyk7CiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBkaWN0KSB7CiAgICAgIGNmZkRpY3Quc2V0QnlLZXkoa2V5LCB2YWx1ZSk7CiAgICB9CiAgICByZXR1cm4gY2ZmRGljdDsKICB9CiAgcGFyc2VDaGFyU3RyaW5nKHN0YXRlLCBkYXRhLCBsb2NhbFN1YnJJbmRleCwgZ2xvYmFsU3VickluZGV4KSB7CiAgICBpZiAoIWRhdGEgfHwgc3RhdGUuY2FsbERlcHRoID4gTUFYX1NVQlJfTkVTVElORykgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBsZXQgc3RhY2tTaXplID0gc3RhdGUuc3RhY2tTaXplOwogICAgY29uc3Qgc3RhY2sgPSBzdGF0ZS5zdGFjazsKICAgIGxldCBsZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgIGZvciAobGV0IGogPSAwOyBqIDwgbGVuZ3RoOykgewogICAgICBjb25zdCB2YWx1ZSA9IGRhdGFbaisrXTsKICAgICAgbGV0IHZhbGlkYXRpb25Db21tYW5kID0gbnVsbDsKICAgICAgaWYgKHZhbHVlID09PSAxMikgewogICAgICAgIGNvbnN0IHEgPSBkYXRhW2orK107CiAgICAgICAgaWYgKHEgPT09IDApIHsKICAgICAgICAgIGRhdGFbaiAtIDJdID0gMTM5OwogICAgICAgICAgZGF0YVtqIC0gMV0gPSAyMjsKICAgICAgICAgIHN0YWNrU2l6ZSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhbGlkYXRpb25Db21tYW5kID0gQ2hhcnN0cmluZ1ZhbGlkYXRpb25EYXRhMTJbcV07CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAyOCkgewogICAgICAgIHN0YWNrW3N0YWNrU2l6ZV0gPSByZWFkSW50MTYoZGF0YSwgaik7CiAgICAgICAgaiArPSAyOwogICAgICAgIHN0YWNrU2l6ZSsrOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAxNCkgewogICAgICAgIGlmIChzdGFja1NpemUgPj0gNCkgewogICAgICAgICAgc3RhY2tTaXplIC09IDQ7CiAgICAgICAgICBpZiAodGhpcy5zZWFjQW5hbHlzaXNFbmFibGVkKSB7CiAgICAgICAgICAgIHN0YXRlLnNlYWMgPSBzdGFjay5zbGljZShzdGFja1NpemUsIHN0YWNrU2l6ZSArIDQpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhbGlkYXRpb25Db21tYW5kID0gQ2hhcnN0cmluZ1ZhbGlkYXRpb25EYXRhW3ZhbHVlXTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA+PSAzMiAmJiB2YWx1ZSA8PSAyNDYpIHsKICAgICAgICBzdGFja1tzdGFja1NpemVdID0gdmFsdWUgLSAxMzk7CiAgICAgICAgc3RhY2tTaXplKys7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gMjQ3ICYmIHZhbHVlIDw9IDI1NCkgewogICAgICAgIHN0YWNrW3N0YWNrU2l6ZV0gPSB2YWx1ZSA8IDI1MSA/ICh2YWx1ZSAtIDI0NyA8PCA4KSArIGRhdGFbal0gKyAxMDggOiAtKHZhbHVlIC0gMjUxIDw8IDgpIC0gZGF0YVtqXSAtIDEwODsKICAgICAgICBqKys7CiAgICAgICAgc3RhY2tTaXplKys7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IDI1NSkgewogICAgICAgIHN0YWNrW3N0YWNrU2l6ZV0gPSAoZGF0YVtqXSA8PCAyNCB8IGRhdGFbaiArIDFdIDw8IDE2IHwgZGF0YVtqICsgMl0gPDwgOCB8IGRhdGFbaiArIDNdKSAvIDY1NTM2OwogICAgICAgIGogKz0gNDsKICAgICAgICBzdGFja1NpemUrKzsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gMTkgfHwgdmFsdWUgPT09IDIwKSB7CiAgICAgICAgc3RhdGUuaGludHMgKz0gc3RhY2tTaXplID4+IDE7CiAgICAgICAgaWYgKHN0YXRlLmhpbnRzID09PSAwKSB7CiAgICAgICAgICBkYXRhLmNvcHlXaXRoaW4oaiAtIDEsIGosIC0xKTsKICAgICAgICAgIGogLT0gMTsKICAgICAgICAgIGxlbmd0aCAtPSAxOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGogKz0gc3RhdGUuaGludHMgKyA3ID4+IDM7CiAgICAgICAgc3RhY2tTaXplICU9IDI7CiAgICAgICAgdmFsaWRhdGlvbkNvbW1hbmQgPSBDaGFyc3RyaW5nVmFsaWRhdGlvbkRhdGFbdmFsdWVdOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAxMCB8fCB2YWx1ZSA9PT0gMjkpIHsKICAgICAgICBjb25zdCBzdWJyc0luZGV4ID0gdmFsdWUgPT09IDEwID8gbG9jYWxTdWJySW5kZXggOiBnbG9iYWxTdWJySW5kZXg7CiAgICAgICAgaWYgKCFzdWJyc0luZGV4KSB7CiAgICAgICAgICB2YWxpZGF0aW9uQ29tbWFuZCA9IENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YVt2YWx1ZV07CiAgICAgICAgICB3YXJuKCJNaXNzaW5nIHN1YnJzSW5kZXggZm9yICIgKyB2YWxpZGF0aW9uQ29tbWFuZC5pZCk7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGxldCBiaWFzID0gMzI3Njg7CiAgICAgICAgaWYgKHN1YnJzSW5kZXguY291bnQgPCAxMjQwKSB7CiAgICAgICAgICBiaWFzID0gMTA3OwogICAgICAgIH0gZWxzZSBpZiAoc3VicnNJbmRleC5jb3VudCA8IDMzOTAwKSB7CiAgICAgICAgICBiaWFzID0gMTEzMTsKICAgICAgICB9CiAgICAgICAgY29uc3Qgc3Vick51bWJlciA9IHN0YWNrWy0tc3RhY2tTaXplXSArIGJpYXM7CiAgICAgICAgaWYgKHN1YnJOdW1iZXIgPCAwIHx8IHN1YnJOdW1iZXIgPj0gc3VicnNJbmRleC5jb3VudCB8fCBpc05hTihzdWJyTnVtYmVyKSkgewogICAgICAgICAgdmFsaWRhdGlvbkNvbW1hbmQgPSBDaGFyc3RyaW5nVmFsaWRhdGlvbkRhdGFbdmFsdWVdOwogICAgICAgICAgd2FybigiT3V0IG9mIGJvdW5kcyBzdWJySW5kZXggZm9yICIgKyB2YWxpZGF0aW9uQ29tbWFuZC5pZCk7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHN0YXRlLnN0YWNrU2l6ZSA9IHN0YWNrU2l6ZTsKICAgICAgICBzdGF0ZS5jYWxsRGVwdGgrKzsKICAgICAgICBjb25zdCB2YWxpZCA9IHRoaXMucGFyc2VDaGFyU3RyaW5nKHN0YXRlLCBzdWJyc0luZGV4LmdldChzdWJyTnVtYmVyKSwgbG9jYWxTdWJySW5kZXgsIGdsb2JhbFN1YnJJbmRleCk7CiAgICAgICAgaWYgKCF2YWxpZCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBzdGF0ZS5jYWxsRGVwdGgtLTsKICAgICAgICBzdGFja1NpemUgPSBzdGF0ZS5zdGFja1NpemU7CiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IDExKSB7CiAgICAgICAgc3RhdGUuc3RhY2tTaXplID0gc3RhY2tTaXplOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAwICYmIGogPT09IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgZGF0YVtqIC0gMV0gPSAxNDsKICAgICAgICB2YWxpZGF0aW9uQ29tbWFuZCA9IENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YVsxNF07CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IDkpIHsKICAgICAgICBkYXRhLmNvcHlXaXRoaW4oaiAtIDEsIGosIC0xKTsKICAgICAgICBqIC09IDE7CiAgICAgICAgbGVuZ3RoIC09IDE7CiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFsaWRhdGlvbkNvbW1hbmQgPSBDaGFyc3RyaW5nVmFsaWRhdGlvbkRhdGFbdmFsdWVdOwogICAgICB9CiAgICAgIGlmICh2YWxpZGF0aW9uQ29tbWFuZCkgewogICAgICAgIGlmICh2YWxpZGF0aW9uQ29tbWFuZC5zdGVtKSB7CiAgICAgICAgICBzdGF0ZS5oaW50cyArPSBzdGFja1NpemUgPj4gMTsKICAgICAgICAgIGlmICh2YWx1ZSA9PT0gMyB8fCB2YWx1ZSA9PT0gMjMpIHsKICAgICAgICAgICAgc3RhdGUuaGFzVlN0ZW1zID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdGUuaGFzVlN0ZW1zICYmICh2YWx1ZSA9PT0gMSB8fCB2YWx1ZSA9PT0gMTgpKSB7CiAgICAgICAgICAgIHdhcm4oIkNGRiBzdGVtIGhpbnRzIGFyZSBpbiB3cm9uZyBvcmRlciIpOwogICAgICAgICAgICBkYXRhW2ogLSAxXSA9IHZhbHVlID09PSAxID8gMyA6IDIzOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIm1pbiIgaW4gdmFsaWRhdGlvbkNvbW1hbmQpIHsKICAgICAgICAgIGlmICghc3RhdGUudW5kZWZTdGFjayAmJiBzdGFja1NpemUgPCB2YWxpZGF0aW9uQ29tbWFuZC5taW4pIHsKICAgICAgICAgICAgd2FybigiTm90IGVub3VnaCBwYXJhbWV0ZXJzIGZvciAiICsgdmFsaWRhdGlvbkNvbW1hbmQuaWQgKyAiOyBhY3R1YWw6ICIgKyBzdGFja1NpemUgKyAiLCBleHBlY3RlZDogIiArIHZhbGlkYXRpb25Db21tYW5kLm1pbik7CiAgICAgICAgICAgIGlmIChzdGFja1NpemUgPT09IDApIHsKICAgICAgICAgICAgICBkYXRhW2ogLSAxXSA9IDE0OwogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlLmZpcnN0U3RhY2tDbGVhcmluZyAmJiB2YWxpZGF0aW9uQ29tbWFuZC5zdGFja0NsZWFyaW5nKSB7CiAgICAgICAgICBzdGF0ZS5maXJzdFN0YWNrQ2xlYXJpbmcgPSBmYWxzZTsKICAgICAgICAgIHN0YWNrU2l6ZSAtPSB2YWxpZGF0aW9uQ29tbWFuZC5taW47CiAgICAgICAgICBpZiAoc3RhY2tTaXplID49IDIgJiYgdmFsaWRhdGlvbkNvbW1hbmQuc3RlbSkgewogICAgICAgICAgICBzdGFja1NpemUgJT0gMjsKICAgICAgICAgIH0gZWxzZSBpZiAoc3RhY2tTaXplID4gMSkgewogICAgICAgICAgICB3YXJuKCJGb3VuZCB0b28gbWFueSBwYXJhbWV0ZXJzIGZvciBzdGFjay1jbGVhcmluZyBjb21tYW5kIik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RhY2tTaXplID4gMCkgewogICAgICAgICAgICBzdGF0ZS53aWR0aCA9IHN0YWNrW3N0YWNrU2l6ZSAtIDFdOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoInN0YWNrRGVsdGEiIGluIHZhbGlkYXRpb25Db21tYW5kKSB7CiAgICAgICAgICBpZiAoInN0YWNrRm4iIGluIHZhbGlkYXRpb25Db21tYW5kKSB7CiAgICAgICAgICAgIHZhbGlkYXRpb25Db21tYW5kLnN0YWNrRm4oc3RhY2ssIHN0YWNrU2l6ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBzdGFja1NpemUgKz0gdmFsaWRhdGlvbkNvbW1hbmQuc3RhY2tEZWx0YTsKICAgICAgICB9IGVsc2UgaWYgKHZhbGlkYXRpb25Db21tYW5kLnN0YWNrQ2xlYXJpbmcpIHsKICAgICAgICAgIHN0YWNrU2l6ZSA9IDA7CiAgICAgICAgfSBlbHNlIGlmICh2YWxpZGF0aW9uQ29tbWFuZC5yZXNldFN0YWNrKSB7CiAgICAgICAgICBzdGFja1NpemUgPSAwOwogICAgICAgICAgc3RhdGUudW5kZWZTdGFjayA9IGZhbHNlOwogICAgICAgIH0gZWxzZSBpZiAodmFsaWRhdGlvbkNvbW1hbmQudW5kZWZTdGFjaykgewogICAgICAgICAgc3RhY2tTaXplID0gMDsKICAgICAgICAgIHN0YXRlLnVuZGVmU3RhY2sgPSB0cnVlOwogICAgICAgICAgc3RhdGUuZmlyc3RTdGFja0NsZWFyaW5nID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAobGVuZ3RoIDwgZGF0YS5sZW5ndGgpIHsKICAgICAgZGF0YS5maWxsKDE0LCBsZW5ndGgpOwogICAgfQogICAgc3RhdGUuc3RhY2tTaXplID0gc3RhY2tTaXplOwogICAgcmV0dXJuIHRydWU7CiAgfQogIHBhcnNlQ2hhclN0cmluZ3MoewogICAgY2hhclN0cmluZ3MsCiAgICBsb2NhbFN1YnJJbmRleCwKICAgIGdsb2JhbFN1YnJJbmRleCwKICAgIGZkU2VsZWN0LAogICAgZmRBcnJheSwKICAgIHByaXZhdGVEaWN0CiAgfSkgewogICAgY29uc3Qgc2VhY3MgPSBbXTsKICAgIGNvbnN0IHdpZHRocyA9IFtdOwogICAgY29uc3QgY291bnQgPSBjaGFyU3RyaW5ncy5jb3VudDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICBjb25zdCBjaGFyc3RyaW5nID0gY2hhclN0cmluZ3MuZ2V0KGkpOwogICAgICBjb25zdCBzdGF0ZSA9IHsKICAgICAgICBjYWxsRGVwdGg6IDAsCiAgICAgICAgc3RhY2tTaXplOiAwLAogICAgICAgIHN0YWNrOiBbXSwKICAgICAgICB1bmRlZlN0YWNrOiB0cnVlLAogICAgICAgIGhpbnRzOiAwLAogICAgICAgIGZpcnN0U3RhY2tDbGVhcmluZzogdHJ1ZSwKICAgICAgICBzZWFjOiBudWxsLAogICAgICAgIHdpZHRoOiBudWxsLAogICAgICAgIGhhc1ZTdGVtczogZmFsc2UKICAgICAgfTsKICAgICAgbGV0IHZhbGlkID0gdHJ1ZTsKICAgICAgbGV0IGxvY2FsU3ViclRvVXNlID0gbnVsbDsKICAgICAgbGV0IHByaXZhdGVEaWN0VG9Vc2UgPSBwcml2YXRlRGljdDsKICAgICAgaWYgKGZkU2VsZWN0ICYmIGZkQXJyYXkubGVuZ3RoKSB7CiAgICAgICAgY29uc3QgZmRJbmRleCA9IGZkU2VsZWN0LmdldEZESW5kZXgoaSk7CiAgICAgICAgaWYgKGZkSW5kZXggPT09IC0xKSB7CiAgICAgICAgICB3YXJuKCJHbHlwaCBpbmRleCBpcyBub3QgaW4gZmQgc2VsZWN0LiIpOwogICAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKGZkSW5kZXggPj0gZmRBcnJheS5sZW5ndGgpIHsKICAgICAgICAgIHdhcm4oIkludmFsaWQgZmQgaW5kZXggZm9yIGdseXBoIGluZGV4LiIpOwogICAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgICBwcml2YXRlRGljdFRvVXNlID0gZmRBcnJheVtmZEluZGV4XS5wcml2YXRlRGljdDsKICAgICAgICAgIGxvY2FsU3ViclRvVXNlID0gcHJpdmF0ZURpY3RUb1VzZS5zdWJyc0luZGV4OwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChsb2NhbFN1YnJJbmRleCkgewogICAgICAgIGxvY2FsU3ViclRvVXNlID0gbG9jYWxTdWJySW5kZXg7CiAgICAgIH0KICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgdmFsaWQgPSB0aGlzLnBhcnNlQ2hhclN0cmluZyhzdGF0ZSwgY2hhcnN0cmluZywgbG9jYWxTdWJyVG9Vc2UsIGdsb2JhbFN1YnJJbmRleCk7CiAgICAgIH0KICAgICAgaWYgKHN0YXRlLndpZHRoICE9PSBudWxsKSB7CiAgICAgICAgY29uc3Qgbm9taW5hbFdpZHRoID0gcHJpdmF0ZURpY3RUb1VzZS5nZXRCeU5hbWUoIm5vbWluYWxXaWR0aFgiKTsKICAgICAgICB3aWR0aHNbaV0gPSBub21pbmFsV2lkdGggKyBzdGF0ZS53aWR0aDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBkZWZhdWx0V2lkdGggPSBwcml2YXRlRGljdFRvVXNlLmdldEJ5TmFtZSgiZGVmYXVsdFdpZHRoWCIpOwogICAgICAgIHdpZHRoc1tpXSA9IGRlZmF1bHRXaWR0aDsKICAgICAgfQogICAgICBpZiAoc3RhdGUuc2VhYyAhPT0gbnVsbCkgewogICAgICAgIHNlYWNzW2ldID0gc3RhdGUuc2VhYzsKICAgICAgfQogICAgICBpZiAoIXZhbGlkKSB7CiAgICAgICAgY2hhclN0cmluZ3Muc2V0KGksIG5ldyBVaW50OEFycmF5KFsxNF0pKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgY2hhclN0cmluZ3MsCiAgICAgIHNlYWNzLAogICAgICB3aWR0aHMKICAgIH07CiAgfQogIGVtcHR5UHJpdmF0ZURpY3Rpb25hcnkocGFyZW50RGljdCkgewogICAgY29uc3QgcHJpdmF0ZURpY3QgPSB0aGlzLmNyZWF0ZURpY3QoQ0ZGUHJpdmF0ZURpY3QsIFtdLCBwYXJlbnREaWN0LnN0cmluZ3MpOwogICAgcGFyZW50RGljdC5zZXRCeUtleSgxOCwgWzAsIDBdKTsKICAgIHBhcmVudERpY3QucHJpdmF0ZURpY3QgPSBwcml2YXRlRGljdDsKICB9CiAgcGFyc2VQcml2YXRlRGljdChwYXJlbnREaWN0KSB7CiAgICBpZiAoIXBhcmVudERpY3QuaGFzTmFtZSgiUHJpdmF0ZSIpKSB7CiAgICAgIHRoaXMuZW1wdHlQcml2YXRlRGljdGlvbmFyeShwYXJlbnREaWN0KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcHJpdmF0ZU9mZnNldCA9IHBhcmVudERpY3QuZ2V0QnlOYW1lKCJQcml2YXRlIik7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkocHJpdmF0ZU9mZnNldCkgfHwgcHJpdmF0ZU9mZnNldC5sZW5ndGggIT09IDIpIHsKICAgICAgcGFyZW50RGljdC5yZW1vdmVCeU5hbWUoIlByaXZhdGUiKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgc2l6ZSA9IHByaXZhdGVPZmZzZXRbMF07CiAgICBjb25zdCBvZmZzZXQgPSBwcml2YXRlT2Zmc2V0WzFdOwogICAgaWYgKHNpemUgPT09IDAgfHwgb2Zmc2V0ID49IHRoaXMuYnl0ZXMubGVuZ3RoKSB7CiAgICAgIHRoaXMuZW1wdHlQcml2YXRlRGljdGlvbmFyeShwYXJlbnREaWN0KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcHJpdmF0ZURpY3RFbmQgPSBvZmZzZXQgKyBzaXplOwogICAgY29uc3QgZGljdERhdGEgPSB0aGlzLmJ5dGVzLnN1YmFycmF5KG9mZnNldCwgcHJpdmF0ZURpY3RFbmQpOwogICAgY29uc3QgZGljdCA9IHRoaXMucGFyc2VEaWN0KGRpY3REYXRhKTsKICAgIGNvbnN0IHByaXZhdGVEaWN0ID0gdGhpcy5jcmVhdGVEaWN0KENGRlByaXZhdGVEaWN0LCBkaWN0LCBwYXJlbnREaWN0LnN0cmluZ3MpOwogICAgcGFyZW50RGljdC5wcml2YXRlRGljdCA9IHByaXZhdGVEaWN0OwogICAgaWYgKHByaXZhdGVEaWN0LmdldEJ5TmFtZSgiRXhwYW5zaW9uRmFjdG9yIikgPT09IDApIHsKICAgICAgcHJpdmF0ZURpY3Quc2V0QnlOYW1lKCJFeHBhbnNpb25GYWN0b3IiLCAwLjA2KTsKICAgIH0KICAgIGlmICghcHJpdmF0ZURpY3QuZ2V0QnlOYW1lKCJTdWJycyIpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHN1YnJzT2Zmc2V0ID0gcHJpdmF0ZURpY3QuZ2V0QnlOYW1lKCJTdWJycyIpOwogICAgY29uc3QgcmVsYXRpdmVPZmZzZXQgPSBvZmZzZXQgKyBzdWJyc09mZnNldDsKICAgIGlmIChzdWJyc09mZnNldCA9PT0gMCB8fCByZWxhdGl2ZU9mZnNldCA+PSB0aGlzLmJ5dGVzLmxlbmd0aCkgewogICAgICB0aGlzLmVtcHR5UHJpdmF0ZURpY3Rpb25hcnkocGFyZW50RGljdCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHN1YnJzSW5kZXggPSB0aGlzLnBhcnNlSW5kZXgocmVsYXRpdmVPZmZzZXQpOwogICAgcHJpdmF0ZURpY3Quc3VicnNJbmRleCA9IHN1YnJzSW5kZXgub2JqOwogIH0KICBwYXJzZUNoYXJzZXRzKHBvcywgbGVuZ3RoLCBzdHJpbmdzLCBjaWQpIHsKICAgIGlmIChwb3MgPT09IDApIHsKICAgICAgcmV0dXJuIG5ldyBDRkZDaGFyc2V0KHRydWUsIENGRkNoYXJzZXRQcmVkZWZpbmVkVHlwZXMuSVNPX0FET0JFLCBJU09BZG9iZUNoYXJzZXQpOwogICAgfSBlbHNlIGlmIChwb3MgPT09IDEpIHsKICAgICAgcmV0dXJuIG5ldyBDRkZDaGFyc2V0KHRydWUsIENGRkNoYXJzZXRQcmVkZWZpbmVkVHlwZXMuRVhQRVJULCBFeHBlcnRDaGFyc2V0KTsKICAgIH0gZWxzZSBpZiAocG9zID09PSAyKSB7CiAgICAgIHJldHVybiBuZXcgQ0ZGQ2hhcnNldCh0cnVlLCBDRkZDaGFyc2V0UHJlZGVmaW5lZFR5cGVzLkVYUEVSVF9TVUJTRVQsIEV4cGVydFN1YnNldENoYXJzZXQpOwogICAgfQogICAgY29uc3QgYnl0ZXMgPSB0aGlzLmJ5dGVzOwogICAgY29uc3Qgc3RhcnQgPSBwb3M7CiAgICBjb25zdCBmb3JtYXQgPSBieXRlc1twb3MrK107CiAgICBjb25zdCBjaGFyc2V0ID0gW2NpZCA/IDAgOiAiLm5vdGRlZiJdOwogICAgbGV0IGlkLCBjb3VudCwgaTsKICAgIGxlbmd0aCAtPSAxOwogICAgc3dpdGNoIChmb3JtYXQpIHsKICAgICAgY2FzZSAwOgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgaWQgPSBieXRlc1twb3MrK10gPDwgOCB8IGJ5dGVzW3BvcysrXTsKICAgICAgICAgIGNoYXJzZXQucHVzaChjaWQgPyBpZCA6IHN0cmluZ3MuZ2V0KGlkKSk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDE6CiAgICAgICAgd2hpbGUgKGNoYXJzZXQubGVuZ3RoIDw9IGxlbmd0aCkgewogICAgICAgICAgaWQgPSBieXRlc1twb3MrK10gPDwgOCB8IGJ5dGVzW3BvcysrXTsKICAgICAgICAgIGNvdW50ID0gYnl0ZXNbcG9zKytdOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8PSBjb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGNoYXJzZXQucHVzaChjaWQgPyBpZCsrIDogc3RyaW5ncy5nZXQoaWQrKykpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAyOgogICAgICAgIHdoaWxlIChjaGFyc2V0Lmxlbmd0aCA8PSBsZW5ndGgpIHsKICAgICAgICAgIGlkID0gYnl0ZXNbcG9zKytdIDw8IDggfCBieXRlc1twb3MrK107CiAgICAgICAgICBjb3VudCA9IGJ5dGVzW3BvcysrXSA8PCA4IHwgYnl0ZXNbcG9zKytdOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8PSBjb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGNoYXJzZXQucHVzaChjaWQgPyBpZCsrIDogc3RyaW5ncy5nZXQoaWQrKykpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlVua25vd24gY2hhcnNldCBmb3JtYXQiKTsKICAgIH0KICAgIGNvbnN0IGVuZCA9IHBvczsKICAgIGNvbnN0IHJhdyA9IGJ5dGVzLnN1YmFycmF5KHN0YXJ0LCBlbmQpOwogICAgcmV0dXJuIG5ldyBDRkZDaGFyc2V0KGZhbHNlLCBmb3JtYXQsIGNoYXJzZXQsIHJhdyk7CiAgfQogIHBhcnNlRW5jb2RpbmcocG9zLCBwcm9wZXJ0aWVzLCBzdHJpbmdzLCBjaGFyc2V0KSB7CiAgICBjb25zdCBlbmNvZGluZyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBjb25zdCBieXRlcyA9IHRoaXMuYnl0ZXM7CiAgICBsZXQgcHJlZGVmaW5lZCA9IGZhbHNlOwogICAgbGV0IGZvcm1hdCwgaSwgaWk7CiAgICBsZXQgcmF3ID0gbnVsbDsKICAgIGZ1bmN0aW9uIHJlYWRTdXBwbGVtZW50KCkgewogICAgICBjb25zdCBzdXBwbGVtZW50c0NvdW50ID0gYnl0ZXNbcG9zKytdOwogICAgICBmb3IgKGkgPSAwOyBpIDwgc3VwcGxlbWVudHNDb3VudDsgaSsrKSB7CiAgICAgICAgY29uc3QgY29kZSA9IGJ5dGVzW3BvcysrXTsKICAgICAgICBjb25zdCBzaWQgPSAoYnl0ZXNbcG9zKytdIDw8IDgpICsgKGJ5dGVzW3BvcysrXSAmIDB4ZmYpOwogICAgICAgIGVuY29kaW5nW2NvZGVdID0gY2hhcnNldC5pbmRleE9mKHN0cmluZ3MuZ2V0KHNpZCkpOwogICAgICB9CiAgICB9CiAgICBpZiAocG9zID09PSAwIHx8IHBvcyA9PT0gMSkgewogICAgICBwcmVkZWZpbmVkID0gdHJ1ZTsKICAgICAgZm9ybWF0ID0gcG9zOwogICAgICBjb25zdCBiYXNlRW5jb2RpbmcgPSBwb3MgPyBFeHBlcnRFbmNvZGluZyA6IFN0YW5kYXJkRW5jb2Rpbmc7CiAgICAgIGZvciAoaSA9IDAsIGlpID0gY2hhcnNldC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgaW5kZXggPSBiYXNlRW5jb2RpbmcuaW5kZXhPZihjaGFyc2V0W2ldKTsKICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgICAgICBlbmNvZGluZ1tpbmRleF0gPSBpOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY29uc3QgZGF0YVN0YXJ0ID0gcG9zOwogICAgICBmb3JtYXQgPSBieXRlc1twb3MrK107CiAgICAgIHN3aXRjaCAoZm9ybWF0ICYgMHg3ZikgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIGNvbnN0IGdseXBoc0NvdW50ID0gYnl0ZXNbcG9zKytdOwogICAgICAgICAgZm9yIChpID0gMTsgaSA8PSBnbHlwaHNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGVuY29kaW5nW2J5dGVzW3BvcysrXV0gPSBpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgY29uc3QgcmFuZ2VzQ291bnQgPSBieXRlc1twb3MrK107CiAgICAgICAgICBsZXQgZ2lkID0gMTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCByYW5nZXNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gYnl0ZXNbcG9zKytdOwogICAgICAgICAgICBjb25zdCBsZWZ0ID0gYnl0ZXNbcG9zKytdOwogICAgICAgICAgICBmb3IgKGxldCBqID0gc3RhcnQ7IGogPD0gc3RhcnQgKyBsZWZ0OyBqKyspIHsKICAgICAgICAgICAgICBlbmNvZGluZ1tqXSA9IGdpZCsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbmtub3duIGVuY29kaW5nIGZvcm1hdDogJHtmb3JtYXR9IGluIENGRmApOwogICAgICB9CiAgICAgIGNvbnN0IGRhdGFFbmQgPSBwb3M7CiAgICAgIGlmIChmb3JtYXQgJiAweDgwKSB7CiAgICAgICAgYnl0ZXNbZGF0YVN0YXJ0XSAmPSAweDdmOwogICAgICAgIHJlYWRTdXBwbGVtZW50KCk7CiAgICAgIH0KICAgICAgcmF3ID0gYnl0ZXMuc3ViYXJyYXkoZGF0YVN0YXJ0LCBkYXRhRW5kKTsKICAgIH0KICAgIGZvcm1hdCAmPSAweDdmOwogICAgcmV0dXJuIG5ldyBDRkZFbmNvZGluZyhwcmVkZWZpbmVkLCBmb3JtYXQsIGVuY29kaW5nLCByYXcpOwogIH0KICBwYXJzZUZEU2VsZWN0KHBvcywgbGVuZ3RoKSB7CiAgICBjb25zdCBieXRlcyA9IHRoaXMuYnl0ZXM7CiAgICBjb25zdCBmb3JtYXQgPSBieXRlc1twb3MrK107CiAgICBjb25zdCBmZFNlbGVjdCA9IFtdOwogICAgbGV0IGk7CiAgICBzd2l0Y2ggKGZvcm1hdCkgewogICAgICBjYXNlIDA6CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICBjb25zdCBpZCA9IGJ5dGVzW3BvcysrXTsKICAgICAgICAgIGZkU2VsZWN0LnB1c2goaWQpOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAzOgogICAgICAgIGNvbnN0IHJhbmdlc0NvdW50ID0gYnl0ZXNbcG9zKytdIDw8IDggfCBieXRlc1twb3MrK107CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHJhbmdlc0NvdW50OyArK2kpIHsKICAgICAgICAgIGxldCBmaXJzdCA9IGJ5dGVzW3BvcysrXSA8PCA4IHwgYnl0ZXNbcG9zKytdOwogICAgICAgICAgaWYgKGkgPT09IDAgJiYgZmlyc3QgIT09IDApIHsKICAgICAgICAgICAgd2FybigicGFyc2VGRFNlbGVjdDogVGhlIGZpcnN0IHJhbmdlIG11c3QgaGF2ZSBhIGZpcnN0IEdJRCBvZiAwIiArICIgLS0gdHJ5aW5nIHRvIHJlY292ZXIuIik7CiAgICAgICAgICAgIGZpcnN0ID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGZkSW5kZXggPSBieXRlc1twb3MrK107CiAgICAgICAgICBjb25zdCBuZXh0ID0gYnl0ZXNbcG9zXSA8PCA4IHwgYnl0ZXNbcG9zICsgMV07CiAgICAgICAgICBmb3IgKGxldCBqID0gZmlyc3Q7IGogPCBuZXh0OyArK2opIHsKICAgICAgICAgICAgZmRTZWxlY3QucHVzaChmZEluZGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcG9zICs9IDI7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBwYXJzZUZEU2VsZWN0OiBVbmtub3duIGZvcm1hdCAiJHtmb3JtYXR9Ii5gKTsKICAgIH0KICAgIGlmIChmZFNlbGVjdC5sZW5ndGggIT09IGxlbmd0aCkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoInBhcnNlRkRTZWxlY3Q6IEludmFsaWQgZm9udCBkYXRhLiIpOwogICAgfQogICAgcmV0dXJuIG5ldyBDRkZGRFNlbGVjdChmb3JtYXQsIGZkU2VsZWN0KTsKICB9Cn0KY2xhc3MgQ0ZGIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMuaGVhZGVyID0gbnVsbDsKICAgIHRoaXMubmFtZXMgPSBbXTsKICAgIHRoaXMudG9wRGljdCA9IG51bGw7CiAgICB0aGlzLnN0cmluZ3MgPSBuZXcgQ0ZGU3RyaW5ncygpOwogICAgdGhpcy5nbG9iYWxTdWJySW5kZXggPSBudWxsOwogICAgdGhpcy5lbmNvZGluZyA9IG51bGw7CiAgICB0aGlzLmNoYXJzZXQgPSBudWxsOwogICAgdGhpcy5jaGFyU3RyaW5ncyA9IG51bGw7CiAgICB0aGlzLmZkQXJyYXkgPSBbXTsKICAgIHRoaXMuZmRTZWxlY3QgPSBudWxsOwogICAgdGhpcy5pc0NJREZvbnQgPSBmYWxzZTsKICB9CiAgZHVwbGljYXRlRmlyc3RHbHlwaCgpIHsKICAgIGlmICh0aGlzLmNoYXJTdHJpbmdzLmNvdW50ID49IDY1NTM1KSB7CiAgICAgIHdhcm4oIk5vdCBlbm91Z2ggc3BhY2UgaW4gY2hhcnN0cmluZ3MgdG8gZHVwbGljYXRlIGZpcnN0IGdseXBoLiIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBnbHlwaFplcm8gPSB0aGlzLmNoYXJTdHJpbmdzLmdldCgwKTsKICAgIHRoaXMuY2hhclN0cmluZ3MuYWRkKGdseXBoWmVybyk7CiAgICBpZiAodGhpcy5pc0NJREZvbnQpIHsKICAgICAgdGhpcy5mZFNlbGVjdC5mZFNlbGVjdC5wdXNoKHRoaXMuZmRTZWxlY3QuZmRTZWxlY3RbMF0pOwogICAgfQogIH0KICBoYXNHbHlwaElkKGlkKSB7CiAgICBpZiAoaWQgPCAwIHx8IGlkID49IHRoaXMuY2hhclN0cmluZ3MuY291bnQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgZ2x5cGggPSB0aGlzLmNoYXJTdHJpbmdzLmdldChpZCk7CiAgICByZXR1cm4gZ2x5cGgubGVuZ3RoID4gMDsKICB9Cn0KY2xhc3MgQ0ZGSGVhZGVyIHsKICBjb25zdHJ1Y3RvcihtYWpvciwgbWlub3IsIGhkclNpemUsIG9mZlNpemUpIHsKICAgIHRoaXMubWFqb3IgPSBtYWpvcjsKICAgIHRoaXMubWlub3IgPSBtaW5vcjsKICAgIHRoaXMuaGRyU2l6ZSA9IGhkclNpemU7CiAgICB0aGlzLm9mZlNpemUgPSBvZmZTaXplOwogIH0KfQpjbGFzcyBDRkZTdHJpbmdzIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMuc3RyaW5ncyA9IFtdOwogIH0KICBnZXQoaW5kZXgpIHsKICAgIGlmIChpbmRleCA+PSAwICYmIGluZGV4IDw9IE5VTV9TVEFOREFSRF9DRkZfU1RSSU5HUyAtIDEpIHsKICAgICAgcmV0dXJuIENGRlN0YW5kYXJkU3RyaW5nc1tpbmRleF07CiAgICB9CiAgICBpZiAoaW5kZXggLSBOVU1fU1RBTkRBUkRfQ0ZGX1NUUklOR1MgPD0gdGhpcy5zdHJpbmdzLmxlbmd0aCkgewogICAgICByZXR1cm4gdGhpcy5zdHJpbmdzW2luZGV4IC0gTlVNX1NUQU5EQVJEX0NGRl9TVFJJTkdTXTsKICAgIH0KICAgIHJldHVybiBDRkZTdGFuZGFyZFN0cmluZ3NbMF07CiAgfQogIGdldFNJRChzdHIpIHsKICAgIGxldCBpbmRleCA9IENGRlN0YW5kYXJkU3RyaW5ncy5pbmRleE9mKHN0cik7CiAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgIHJldHVybiBpbmRleDsKICAgIH0KICAgIGluZGV4ID0gdGhpcy5zdHJpbmdzLmluZGV4T2Yoc3RyKTsKICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgcmV0dXJuIGluZGV4ICsgTlVNX1NUQU5EQVJEX0NGRl9TVFJJTkdTOwogICAgfQogICAgcmV0dXJuIC0xOwogIH0KICBhZGQodmFsdWUpIHsKICAgIHRoaXMuc3RyaW5ncy5wdXNoKHZhbHVlKTsKICB9CiAgZ2V0IGNvdW50KCkgewogICAgcmV0dXJuIHRoaXMuc3RyaW5ncy5sZW5ndGg7CiAgfQp9CmNsYXNzIENGRkluZGV4IHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgdGhpcy5sZW5ndGggPSAwOwogIH0KICBhZGQoZGF0YSkgewogICAgdGhpcy5sZW5ndGggKz0gZGF0YS5sZW5ndGg7CiAgICB0aGlzLm9iamVjdHMucHVzaChkYXRhKTsKICB9CiAgc2V0KGluZGV4LCBkYXRhKSB7CiAgICB0aGlzLmxlbmd0aCArPSBkYXRhLmxlbmd0aCAtIHRoaXMub2JqZWN0c1tpbmRleF0ubGVuZ3RoOwogICAgdGhpcy5vYmplY3RzW2luZGV4XSA9IGRhdGE7CiAgfQogIGdldChpbmRleCkgewogICAgcmV0dXJuIHRoaXMub2JqZWN0c1tpbmRleF07CiAgfQogIGdldCBjb3VudCgpIHsKICAgIHJldHVybiB0aGlzLm9iamVjdHMubGVuZ3RoOwogIH0KfQpjbGFzcyBDRkZEaWN0IHsKICBjb25zdHJ1Y3Rvcih0YWJsZXMsIHN0cmluZ3MpIHsKICAgIHRoaXMua2V5VG9OYW1lTWFwID0gdGFibGVzLmtleVRvTmFtZU1hcDsKICAgIHRoaXMubmFtZVRvS2V5TWFwID0gdGFibGVzLm5hbWVUb0tleU1hcDsKICAgIHRoaXMuZGVmYXVsdHMgPSB0YWJsZXMuZGVmYXVsdHM7CiAgICB0aGlzLnR5cGVzID0gdGFibGVzLnR5cGVzOwogICAgdGhpcy5vcGNvZGVzID0gdGFibGVzLm9wY29kZXM7CiAgICB0aGlzLm9yZGVyID0gdGFibGVzLm9yZGVyOwogICAgdGhpcy5zdHJpbmdzID0gc3RyaW5nczsKICAgIHRoaXMudmFsdWVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICB9CiAgc2V0QnlLZXkoa2V5LCB2YWx1ZSkgewogICAgaWYgKCEoa2V5IGluIHRoaXMua2V5VG9OYW1lTWFwKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZm9yIChjb25zdCB2YWwgb2YgdmFsdWUpIHsKICAgICAgaWYgKGlzTmFOKHZhbCkpIHsKICAgICAgICB3YXJuKGBJbnZhbGlkIENGRkRpY3QgdmFsdWU6ICIke3ZhbHVlfSIgZm9yIGtleSAiJHtrZXl9Ii5gKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQogICAgY29uc3QgdHlwZSA9IHRoaXMudHlwZXNba2V5XTsKICAgIGlmICh0eXBlID09PSAibnVtIiB8fCB0eXBlID09PSAic2lkIiB8fCB0eXBlID09PSAib2Zmc2V0IikgewogICAgICB2YWx1ZSA9IHZhbHVlWzBdOwogICAgfQogICAgdGhpcy52YWx1ZXNba2V5XSA9IHZhbHVlOwogICAgcmV0dXJuIHRydWU7CiAgfQogIHNldEJ5TmFtZShuYW1lLCB2YWx1ZSkgewogICAgaWYgKCEobmFtZSBpbiB0aGlzLm5hbWVUb0tleU1hcCkpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIGRpY3Rpb25hcnkgbmFtZSAiJHtuYW1lfSJgKTsKICAgIH0KICAgIHRoaXMudmFsdWVzW3RoaXMubmFtZVRvS2V5TWFwW25hbWVdXSA9IHZhbHVlOwogIH0KICBoYXNOYW1lKG5hbWUpIHsKICAgIHJldHVybiB0aGlzLm5hbWVUb0tleU1hcFtuYW1lXSBpbiB0aGlzLnZhbHVlczsKICB9CiAgZ2V0QnlOYW1lKG5hbWUpIHsKICAgIGlmICghKG5hbWUgaW4gdGhpcy5uYW1lVG9LZXlNYXApKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBkaWN0aW9uYXJ5IG5hbWUgJHtuYW1lfSJgKTsKICAgIH0KICAgIGNvbnN0IGtleSA9IHRoaXMubmFtZVRvS2V5TWFwW25hbWVdOwogICAgaWYgKCEoa2V5IGluIHRoaXMudmFsdWVzKSkgewogICAgICByZXR1cm4gdGhpcy5kZWZhdWx0c1trZXldOwogICAgfQogICAgcmV0dXJuIHRoaXMudmFsdWVzW2tleV07CiAgfQogIHJlbW92ZUJ5TmFtZShuYW1lKSB7CiAgICBkZWxldGUgdGhpcy52YWx1ZXNbdGhpcy5uYW1lVG9LZXlNYXBbbmFtZV1dOwogIH0KICBzdGF0aWMgY3JlYXRlVGFibGVzKGxheW91dCkgewogICAgY29uc3QgdGFibGVzID0gewogICAgICBrZXlUb05hbWVNYXA6IHt9LAogICAgICBuYW1lVG9LZXlNYXA6IHt9LAogICAgICBkZWZhdWx0czoge30sCiAgICAgIHR5cGVzOiB7fSwKICAgICAgb3Bjb2Rlczoge30sCiAgICAgIG9yZGVyOiBbXQogICAgfTsKICAgIGZvciAoY29uc3QgZW50cnkgb2YgbGF5b3V0KSB7CiAgICAgIGNvbnN0IGtleSA9IEFycmF5LmlzQXJyYXkoZW50cnlbMF0pID8gKGVudHJ5WzBdWzBdIDw8IDgpICsgZW50cnlbMF1bMV0gOiBlbnRyeVswXTsKICAgICAgdGFibGVzLmtleVRvTmFtZU1hcFtrZXldID0gZW50cnlbMV07CiAgICAgIHRhYmxlcy5uYW1lVG9LZXlNYXBbZW50cnlbMV1dID0ga2V5OwogICAgICB0YWJsZXMudHlwZXNba2V5XSA9IGVudHJ5WzJdOwogICAgICB0YWJsZXMuZGVmYXVsdHNba2V5XSA9IGVudHJ5WzNdOwogICAgICB0YWJsZXMub3Bjb2Rlc1trZXldID0gQXJyYXkuaXNBcnJheShlbnRyeVswXSkgPyBlbnRyeVswXSA6IFtlbnRyeVswXV07CiAgICAgIHRhYmxlcy5vcmRlci5wdXNoKGtleSk7CiAgICB9CiAgICByZXR1cm4gdGFibGVzOwogIH0KfQpjb25zdCBDRkZUb3BEaWN0TGF5b3V0ID0gW1tbMTIsIDMwXSwgIlJPUyIsIFsic2lkIiwgInNpZCIsICJudW0iXSwgbnVsbF0sIFtbMTIsIDIwXSwgIlN5bnRoZXRpY0Jhc2UiLCAibnVtIiwgbnVsbF0sIFswLCAidmVyc2lvbiIsICJzaWQiLCBudWxsXSwgWzEsICJOb3RpY2UiLCAic2lkIiwgbnVsbF0sIFtbMTIsIDBdLCAiQ29weXJpZ2h0IiwgInNpZCIsIG51bGxdLCBbMiwgIkZ1bGxOYW1lIiwgInNpZCIsIG51bGxdLCBbMywgIkZhbWlseU5hbWUiLCAic2lkIiwgbnVsbF0sIFs0LCAiV2VpZ2h0IiwgInNpZCIsIG51bGxdLCBbWzEyLCAxXSwgImlzRml4ZWRQaXRjaCIsICJudW0iLCAwXSwgW1sxMiwgMl0sICJJdGFsaWNBbmdsZSIsICJudW0iLCAwXSwgW1sxMiwgM10sICJVbmRlcmxpbmVQb3NpdGlvbiIsICJudW0iLCAtMTAwXSwgW1sxMiwgNF0sICJVbmRlcmxpbmVUaGlja25lc3MiLCAibnVtIiwgNTBdLCBbWzEyLCA1XSwgIlBhaW50VHlwZSIsICJudW0iLCAwXSwgW1sxMiwgNl0sICJDaGFyc3RyaW5nVHlwZSIsICJudW0iLCAyXSwgW1sxMiwgN10sICJGb250TWF0cml4IiwgWyJudW0iLCAibnVtIiwgIm51bSIsICJudW0iLCAibnVtIiwgIm51bSJdLCBbMC4wMDEsIDAsIDAsIDAuMDAxLCAwLCAwXV0sIFsxMywgIlVuaXF1ZUlEIiwgIm51bSIsIG51bGxdLCBbNSwgIkZvbnRCQm94IiwgWyJudW0iLCAibnVtIiwgIm51bSIsICJudW0iXSwgWzAsIDAsIDAsIDBdXSwgW1sxMiwgOF0sICJTdHJva2VXaWR0aCIsICJudW0iLCAwXSwgWzE0LCAiWFVJRCIsICJhcnJheSIsIG51bGxdLCBbMTUsICJjaGFyc2V0IiwgIm9mZnNldCIsIDBdLCBbMTYsICJFbmNvZGluZyIsICJvZmZzZXQiLCAwXSwgWzE3LCAiQ2hhclN0cmluZ3MiLCAib2Zmc2V0IiwgMF0sIFsxOCwgIlByaXZhdGUiLCBbIm9mZnNldCIsICJvZmZzZXQiXSwgbnVsbF0sIFtbMTIsIDIxXSwgIlBvc3RTY3JpcHQiLCAic2lkIiwgbnVsbF0sIFtbMTIsIDIyXSwgIkJhc2VGb250TmFtZSIsICJzaWQiLCBudWxsXSwgW1sxMiwgMjNdLCAiQmFzZUZvbnRCbGVuZCIsICJkZWx0YSIsIG51bGxdLCBbWzEyLCAzMV0sICJDSURGb250VmVyc2lvbiIsICJudW0iLCAwXSwgW1sxMiwgMzJdLCAiQ0lERm9udFJldmlzaW9uIiwgIm51bSIsIDBdLCBbWzEyLCAzM10sICJDSURGb250VHlwZSIsICJudW0iLCAwXSwgW1sxMiwgMzRdLCAiQ0lEQ291bnQiLCAibnVtIiwgODcyMF0sIFtbMTIsIDM1XSwgIlVJREJhc2UiLCAibnVtIiwgbnVsbF0sIFtbMTIsIDM3XSwgIkZEU2VsZWN0IiwgIm9mZnNldCIsIG51bGxdLCBbWzEyLCAzNl0sICJGREFycmF5IiwgIm9mZnNldCIsIG51bGxdLCBbWzEyLCAzOF0sICJGb250TmFtZSIsICJzaWQiLCBudWxsXV07CmNsYXNzIENGRlRvcERpY3QgZXh0ZW5kcyBDRkZEaWN0IHsKICBzdGF0aWMgZ2V0IHRhYmxlcygpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgInRhYmxlcyIsIHRoaXMuY3JlYXRlVGFibGVzKENGRlRvcERpY3RMYXlvdXQpKTsKICB9CiAgY29uc3RydWN0b3Ioc3RyaW5ncykgewogICAgc3VwZXIoQ0ZGVG9wRGljdC50YWJsZXMsIHN0cmluZ3MpOwogICAgdGhpcy5wcml2YXRlRGljdCA9IG51bGw7CiAgfQp9CmNvbnN0IENGRlByaXZhdGVEaWN0TGF5b3V0ID0gW1s2LCAiQmx1ZVZhbHVlcyIsICJkZWx0YSIsIG51bGxdLCBbNywgIk90aGVyQmx1ZXMiLCAiZGVsdGEiLCBudWxsXSwgWzgsICJGYW1pbHlCbHVlcyIsICJkZWx0YSIsIG51bGxdLCBbOSwgIkZhbWlseU90aGVyQmx1ZXMiLCAiZGVsdGEiLCBudWxsXSwgW1sxMiwgOV0sICJCbHVlU2NhbGUiLCAibnVtIiwgMC4wMzk2MjVdLCBbWzEyLCAxMF0sICJCbHVlU2hpZnQiLCAibnVtIiwgN10sIFtbMTIsIDExXSwgIkJsdWVGdXp6IiwgIm51bSIsIDFdLCBbMTAsICJTdGRIVyIsICJudW0iLCBudWxsXSwgWzExLCAiU3RkVlciLCAibnVtIiwgbnVsbF0sIFtbMTIsIDEyXSwgIlN0ZW1TbmFwSCIsICJkZWx0YSIsIG51bGxdLCBbWzEyLCAxM10sICJTdGVtU25hcFYiLCAiZGVsdGEiLCBudWxsXSwgW1sxMiwgMTRdLCAiRm9yY2VCb2xkIiwgIm51bSIsIDBdLCBbWzEyLCAxN10sICJMYW5ndWFnZUdyb3VwIiwgIm51bSIsIDBdLCBbWzEyLCAxOF0sICJFeHBhbnNpb25GYWN0b3IiLCAibnVtIiwgMC4wNl0sIFtbMTIsIDE5XSwgImluaXRpYWxSYW5kb21TZWVkIiwgIm51bSIsIDBdLCBbMjAsICJkZWZhdWx0V2lkdGhYIiwgIm51bSIsIDBdLCBbMjEsICJub21pbmFsV2lkdGhYIiwgIm51bSIsIDBdLCBbMTksICJTdWJycyIsICJvZmZzZXQiLCBudWxsXV07CmNsYXNzIENGRlByaXZhdGVEaWN0IGV4dGVuZHMgQ0ZGRGljdCB7CiAgc3RhdGljIGdldCB0YWJsZXMoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ0YWJsZXMiLCB0aGlzLmNyZWF0ZVRhYmxlcyhDRkZQcml2YXRlRGljdExheW91dCkpOwogIH0KICBjb25zdHJ1Y3RvcihzdHJpbmdzKSB7CiAgICBzdXBlcihDRkZQcml2YXRlRGljdC50YWJsZXMsIHN0cmluZ3MpOwogICAgdGhpcy5zdWJyc0luZGV4ID0gbnVsbDsKICB9Cn0KY29uc3QgQ0ZGQ2hhcnNldFByZWRlZmluZWRUeXBlcyA9IHsKICBJU09fQURPQkU6IDAsCiAgRVhQRVJUOiAxLAogIEVYUEVSVF9TVUJTRVQ6IDIKfTsKY2xhc3MgQ0ZGQ2hhcnNldCB7CiAgY29uc3RydWN0b3IocHJlZGVmaW5lZCwgZm9ybWF0LCBjaGFyc2V0LCByYXcpIHsKICAgIHRoaXMucHJlZGVmaW5lZCA9IHByZWRlZmluZWQ7CiAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdDsKICAgIHRoaXMuY2hhcnNldCA9IGNoYXJzZXQ7CiAgICB0aGlzLnJhdyA9IHJhdzsKICB9Cn0KY2xhc3MgQ0ZGRW5jb2RpbmcgewogIGNvbnN0cnVjdG9yKHByZWRlZmluZWQsIGZvcm1hdCwgZW5jb2RpbmcsIHJhdykgewogICAgdGhpcy5wcmVkZWZpbmVkID0gcHJlZGVmaW5lZDsKICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0OwogICAgdGhpcy5lbmNvZGluZyA9IGVuY29kaW5nOwogICAgdGhpcy5yYXcgPSByYXc7CiAgfQp9CmNsYXNzIENGRkZEU2VsZWN0IHsKICBjb25zdHJ1Y3Rvcihmb3JtYXQsIGZkU2VsZWN0KSB7CiAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdDsKICAgIHRoaXMuZmRTZWxlY3QgPSBmZFNlbGVjdDsKICB9CiAgZ2V0RkRJbmRleChnbHlwaEluZGV4KSB7CiAgICBpZiAoZ2x5cGhJbmRleCA8IDAgfHwgZ2x5cGhJbmRleCA+PSB0aGlzLmZkU2VsZWN0Lmxlbmd0aCkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICByZXR1cm4gdGhpcy5mZFNlbGVjdFtnbHlwaEluZGV4XTsKICB9Cn0KY2xhc3MgQ0ZGT2Zmc2V0VHJhY2tlciB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLm9mZnNldHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIH0KICBpc1RyYWNraW5nKGtleSkgewogICAgcmV0dXJuIGtleSBpbiB0aGlzLm9mZnNldHM7CiAgfQogIHRyYWNrKGtleSwgbG9jYXRpb24pIHsKICAgIGlmIChrZXkgaW4gdGhpcy5vZmZzZXRzKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgQWxyZWFkeSB0cmFja2luZyBsb2NhdGlvbiBvZiAke2tleX1gKTsKICAgIH0KICAgIHRoaXMub2Zmc2V0c1trZXldID0gbG9jYXRpb247CiAgfQogIG9mZnNldCh2YWx1ZSkgewogICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcy5vZmZzZXRzKSB7CiAgICAgIHRoaXMub2Zmc2V0c1trZXldICs9IHZhbHVlOwogICAgfQogIH0KICBzZXRFbnRyeUxvY2F0aW9uKGtleSwgdmFsdWVzLCBvdXRwdXQpIHsKICAgIGlmICghKGtleSBpbiB0aGlzLm9mZnNldHMpKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgTm90IHRyYWNraW5nIGxvY2F0aW9uIG9mICR7a2V5fWApOwogICAgfQogICAgY29uc3QgZGF0YSA9IG91dHB1dC5kYXRhOwogICAgY29uc3QgZGF0YU9mZnNldCA9IHRoaXMub2Zmc2V0c1trZXldOwogICAgY29uc3Qgc2l6ZSA9IDU7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB2YWx1ZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICBjb25zdCBvZmZzZXQwID0gaSAqIHNpemUgKyBkYXRhT2Zmc2V0OwogICAgICBjb25zdCBvZmZzZXQxID0gb2Zmc2V0MCArIDE7CiAgICAgIGNvbnN0IG9mZnNldDIgPSBvZmZzZXQwICsgMjsKICAgICAgY29uc3Qgb2Zmc2V0MyA9IG9mZnNldDAgKyAzOwogICAgICBjb25zdCBvZmZzZXQ0ID0gb2Zmc2V0MCArIDQ7CiAgICAgIGlmIChkYXRhW29mZnNldDBdICE9PSAweDFkIHx8IGRhdGFbb2Zmc2V0MV0gIT09IDAgfHwgZGF0YVtvZmZzZXQyXSAhPT0gMCB8fCBkYXRhW29mZnNldDNdICE9PSAwIHx8IGRhdGFbb2Zmc2V0NF0gIT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIndyaXRpbmcgdG8gYW4gb2Zmc2V0IHRoYXQgaXMgbm90IGVtcHR5Iik7CiAgICAgIH0KICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZXNbaV07CiAgICAgIGRhdGFbb2Zmc2V0MF0gPSAweDFkOwogICAgICBkYXRhW29mZnNldDFdID0gdmFsdWUgPj4gMjQgJiAweGZmOwogICAgICBkYXRhW29mZnNldDJdID0gdmFsdWUgPj4gMTYgJiAweGZmOwogICAgICBkYXRhW29mZnNldDNdID0gdmFsdWUgPj4gOCAmIDB4ZmY7CiAgICAgIGRhdGFbb2Zmc2V0NF0gPSB2YWx1ZSAmIDB4ZmY7CiAgICB9CiAgfQp9CmNsYXNzIENGRkNvbXBpbGVyIHsKICBjb25zdHJ1Y3RvcihjZmYpIHsKICAgIHRoaXMuY2ZmID0gY2ZmOwogIH0KICBjb21waWxlKCkgewogICAgY29uc3QgY2ZmID0gdGhpcy5jZmY7CiAgICBjb25zdCBvdXRwdXQgPSB7CiAgICAgIGRhdGE6IFtdLAogICAgICBsZW5ndGg6IDAsCiAgICAgIGFkZChkYXRhKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHRoaXMuZGF0YS5wdXNoKC4uLmRhdGEpOwogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5kYXRhLmNvbmNhdChkYXRhKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLmRhdGEubGVuZ3RoOwogICAgICB9CiAgICB9OwogICAgY29uc3QgaGVhZGVyID0gdGhpcy5jb21waWxlSGVhZGVyKGNmZi5oZWFkZXIpOwogICAgb3V0cHV0LmFkZChoZWFkZXIpOwogICAgY29uc3QgbmFtZUluZGV4ID0gdGhpcy5jb21waWxlTmFtZUluZGV4KGNmZi5uYW1lcyk7CiAgICBvdXRwdXQuYWRkKG5hbWVJbmRleCk7CiAgICBpZiAoY2ZmLmlzQ0lERm9udCkgewogICAgICBpZiAoY2ZmLnRvcERpY3QuaGFzTmFtZSgiRm9udE1hdHJpeCIpKSB7CiAgICAgICAgY29uc3QgYmFzZSA9IGNmZi50b3BEaWN0LmdldEJ5TmFtZSgiRm9udE1hdHJpeCIpOwogICAgICAgIGNmZi50b3BEaWN0LnJlbW92ZUJ5TmFtZSgiRm9udE1hdHJpeCIpOwogICAgICAgIGZvciAoY29uc3Qgc3ViRGljdCBvZiBjZmYuZmRBcnJheSkgewogICAgICAgICAgbGV0IG1hdHJpeCA9IGJhc2Uuc2xpY2UoMCk7CiAgICAgICAgICBpZiAoc3ViRGljdC5oYXNOYW1lKCJGb250TWF0cml4IikpIHsKICAgICAgICAgICAgbWF0cml4ID0gVXRpbC50cmFuc2Zvcm0obWF0cml4LCBzdWJEaWN0LmdldEJ5TmFtZSgiRm9udE1hdHJpeCIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHN1YkRpY3Quc2V0QnlOYW1lKCJGb250TWF0cml4IiwgbWF0cml4KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHh1aWQgPSBjZmYudG9wRGljdC5nZXRCeU5hbWUoIlhVSUQiKTsKICAgIGlmICh4dWlkPy5sZW5ndGggPiAxNikgewogICAgICBjZmYudG9wRGljdC5yZW1vdmVCeU5hbWUoIlhVSUQiKTsKICAgIH0KICAgIGNmZi50b3BEaWN0LnNldEJ5TmFtZSgiY2hhcnNldCIsIDApOwogICAgbGV0IGNvbXBpbGVkID0gdGhpcy5jb21waWxlVG9wRGljdHMoW2NmZi50b3BEaWN0XSwgb3V0cHV0Lmxlbmd0aCwgY2ZmLmlzQ0lERm9udCk7CiAgICBvdXRwdXQuYWRkKGNvbXBpbGVkLm91dHB1dCk7CiAgICBjb25zdCB0b3BEaWN0VHJhY2tlciA9IGNvbXBpbGVkLnRyYWNrZXJzWzBdOwogICAgY29uc3Qgc3RyaW5nSW5kZXggPSB0aGlzLmNvbXBpbGVTdHJpbmdJbmRleChjZmYuc3RyaW5ncy5zdHJpbmdzKTsKICAgIG91dHB1dC5hZGQoc3RyaW5nSW5kZXgpOwogICAgY29uc3QgZ2xvYmFsU3VickluZGV4ID0gdGhpcy5jb21waWxlSW5kZXgoY2ZmLmdsb2JhbFN1YnJJbmRleCk7CiAgICBvdXRwdXQuYWRkKGdsb2JhbFN1YnJJbmRleCk7CiAgICBpZiAoY2ZmLmVuY29kaW5nICYmIGNmZi50b3BEaWN0Lmhhc05hbWUoIkVuY29kaW5nIikpIHsKICAgICAgaWYgKGNmZi5lbmNvZGluZy5wcmVkZWZpbmVkKSB7CiAgICAgICAgdG9wRGljdFRyYWNrZXIuc2V0RW50cnlMb2NhdGlvbigiRW5jb2RpbmciLCBbY2ZmLmVuY29kaW5nLmZvcm1hdF0sIG91dHB1dCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZW5jb2RpbmcgPSB0aGlzLmNvbXBpbGVFbmNvZGluZyhjZmYuZW5jb2RpbmcpOwogICAgICAgIHRvcERpY3RUcmFja2VyLnNldEVudHJ5TG9jYXRpb24oIkVuY29kaW5nIiwgW291dHB1dC5sZW5ndGhdLCBvdXRwdXQpOwogICAgICAgIG91dHB1dC5hZGQoZW5jb2RpbmcpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBjaGFyc2V0ID0gdGhpcy5jb21waWxlQ2hhcnNldChjZmYuY2hhcnNldCwgY2ZmLmNoYXJTdHJpbmdzLmNvdW50LCBjZmYuc3RyaW5ncywgY2ZmLmlzQ0lERm9udCk7CiAgICB0b3BEaWN0VHJhY2tlci5zZXRFbnRyeUxvY2F0aW9uKCJjaGFyc2V0IiwgW291dHB1dC5sZW5ndGhdLCBvdXRwdXQpOwogICAgb3V0cHV0LmFkZChjaGFyc2V0KTsKICAgIGNvbnN0IGNoYXJTdHJpbmdzID0gdGhpcy5jb21waWxlQ2hhclN0cmluZ3MoY2ZmLmNoYXJTdHJpbmdzKTsKICAgIHRvcERpY3RUcmFja2VyLnNldEVudHJ5TG9jYXRpb24oIkNoYXJTdHJpbmdzIiwgW291dHB1dC5sZW5ndGhdLCBvdXRwdXQpOwogICAgb3V0cHV0LmFkZChjaGFyU3RyaW5ncyk7CiAgICBpZiAoY2ZmLmlzQ0lERm9udCkgewogICAgICB0b3BEaWN0VHJhY2tlci5zZXRFbnRyeUxvY2F0aW9uKCJGRFNlbGVjdCIsIFtvdXRwdXQubGVuZ3RoXSwgb3V0cHV0KTsKICAgICAgY29uc3QgZmRTZWxlY3QgPSB0aGlzLmNvbXBpbGVGRFNlbGVjdChjZmYuZmRTZWxlY3QpOwogICAgICBvdXRwdXQuYWRkKGZkU2VsZWN0KTsKICAgICAgY29tcGlsZWQgPSB0aGlzLmNvbXBpbGVUb3BEaWN0cyhjZmYuZmRBcnJheSwgb3V0cHV0Lmxlbmd0aCwgdHJ1ZSk7CiAgICAgIHRvcERpY3RUcmFja2VyLnNldEVudHJ5TG9jYXRpb24oIkZEQXJyYXkiLCBbb3V0cHV0Lmxlbmd0aF0sIG91dHB1dCk7CiAgICAgIG91dHB1dC5hZGQoY29tcGlsZWQub3V0cHV0KTsKICAgICAgY29uc3QgZm9udERpY3RUcmFja2VycyA9IGNvbXBpbGVkLnRyYWNrZXJzOwogICAgICB0aGlzLmNvbXBpbGVQcml2YXRlRGljdHMoY2ZmLmZkQXJyYXksIGZvbnREaWN0VHJhY2tlcnMsIG91dHB1dCk7CiAgICB9CiAgICB0aGlzLmNvbXBpbGVQcml2YXRlRGljdHMoW2NmZi50b3BEaWN0XSwgW3RvcERpY3RUcmFja2VyXSwgb3V0cHV0KTsKICAgIG91dHB1dC5hZGQoWzBdKTsKICAgIHJldHVybiBvdXRwdXQuZGF0YTsKICB9CiAgZW5jb2RlTnVtYmVyKHZhbHVlKSB7CiAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcih2YWx1ZSkpIHsKICAgICAgcmV0dXJuIHRoaXMuZW5jb2RlSW50ZWdlcih2YWx1ZSk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5lbmNvZGVGbG9hdCh2YWx1ZSk7CiAgfQogIHN0YXRpYyBnZXQgRW5jb2RlRmxvYXRSZWdFeHAoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJFbmNvZGVGbG9hdFJlZ0V4cCIsIC9cLihcZCo/KSg/Ojl7NSwyMH18MHs1LDIwfSlcZHswLDJ9KD86ZSguKyl8JCkvKTsKICB9CiAgZW5jb2RlRmxvYXQobnVtKSB7CiAgICBsZXQgdmFsdWUgPSBudW0udG9TdHJpbmcoKTsKICAgIGNvbnN0IG0gPSBDRkZDb21waWxlci5FbmNvZGVGbG9hdFJlZ0V4cC5leGVjKHZhbHVlKTsKICAgIGlmIChtKSB7CiAgICAgIGNvbnN0IGVwc2lsb24gPSBwYXJzZUZsb2F0KCIxZSIgKyAoKG1bMl0gPyArbVsyXSA6IDApICsgbVsxXS5sZW5ndGgpKTsKICAgICAgdmFsdWUgPSAoTWF0aC5yb3VuZChudW0gKiBlcHNpbG9uKSAvIGVwc2lsb24pLnRvU3RyaW5nKCk7CiAgICB9CiAgICBsZXQgbmliYmxlcyA9ICIiOwogICAgbGV0IGksIGlpOwogICAgZm9yIChpID0gMCwgaWkgPSB2YWx1ZS5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgIGNvbnN0IGEgPSB2YWx1ZVtpXTsKICAgICAgaWYgKGEgPT09ICJlIikgewogICAgICAgIG5pYmJsZXMgKz0gdmFsdWVbKytpXSA9PT0gIi0iID8gImMiIDogImIiOwogICAgICB9IGVsc2UgaWYgKGEgPT09ICIuIikgewogICAgICAgIG5pYmJsZXMgKz0gImEiOwogICAgICB9IGVsc2UgaWYgKGEgPT09ICItIikgewogICAgICAgIG5pYmJsZXMgKz0gImUiOwogICAgICB9IGVsc2UgewogICAgICAgIG5pYmJsZXMgKz0gYTsKICAgICAgfQogICAgfQogICAgbmliYmxlcyArPSBuaWJibGVzLmxlbmd0aCAmIDEgPyAiZiIgOiAiZmYiOwogICAgY29uc3Qgb3V0ID0gWzMwXTsKICAgIGZvciAoaSA9IDAsIGlpID0gbmliYmxlcy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgIG91dC5wdXNoKHBhcnNlSW50KG5pYmJsZXMuc3Vic3RyaW5nKGksIGkgKyAyKSwgMTYpKTsKICAgIH0KICAgIHJldHVybiBvdXQ7CiAgfQogIGVuY29kZUludGVnZXIodmFsdWUpIHsKICAgIGxldCBjb2RlOwogICAgaWYgKHZhbHVlID49IC0xMDcgJiYgdmFsdWUgPD0gMTA3KSB7CiAgICAgIGNvZGUgPSBbdmFsdWUgKyAxMzldOwogICAgfSBlbHNlIGlmICh2YWx1ZSA+PSAxMDggJiYgdmFsdWUgPD0gMTEzMSkgewogICAgICB2YWx1ZSAtPSAxMDg7CiAgICAgIGNvZGUgPSBbKHZhbHVlID4+IDgpICsgMjQ3LCB2YWx1ZSAmIDB4ZmZdOwogICAgfSBlbHNlIGlmICh2YWx1ZSA+PSAtMTEzMSAmJiB2YWx1ZSA8PSAtMTA4KSB7CiAgICAgIHZhbHVlID0gLXZhbHVlIC0gMTA4OwogICAgICBjb2RlID0gWyh2YWx1ZSA+PiA4KSArIDI1MSwgdmFsdWUgJiAweGZmXTsKICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gLTMyNzY4ICYmIHZhbHVlIDw9IDMyNzY3KSB7CiAgICAgIGNvZGUgPSBbMHgxYywgdmFsdWUgPj4gOCAmIDB4ZmYsIHZhbHVlICYgMHhmZl07CiAgICB9IGVsc2UgewogICAgICBjb2RlID0gWzB4MWQsIHZhbHVlID4+IDI0ICYgMHhmZiwgdmFsdWUgPj4gMTYgJiAweGZmLCB2YWx1ZSA+PiA4ICYgMHhmZiwgdmFsdWUgJiAweGZmXTsKICAgIH0KICAgIHJldHVybiBjb2RlOwogIH0KICBjb21waWxlSGVhZGVyKGhlYWRlcikgewogICAgcmV0dXJuIFtoZWFkZXIubWFqb3IsIGhlYWRlci5taW5vciwgNCwgaGVhZGVyLm9mZlNpemVdOwogIH0KICBjb21waWxlTmFtZUluZGV4KG5hbWVzKSB7CiAgICBjb25zdCBuYW1lSW5kZXggPSBuZXcgQ0ZGSW5kZXgoKTsKICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykgewogICAgICBjb25zdCBsZW5ndGggPSBNYXRoLm1pbihuYW1lLmxlbmd0aCwgMTI3KTsKICAgICAgbGV0IHNhbml0aXplZE5hbWUgPSBuZXcgQXJyYXkobGVuZ3RoKTsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBsZW5ndGg7IGorKykgewogICAgICAgIGxldCBjaGFyID0gbmFtZVtqXTsKICAgICAgICBpZiAoY2hhciA8ICIhIiB8fCBjaGFyID4gIn4iIHx8IGNoYXIgPT09ICJbIiB8fCBjaGFyID09PSAiXSIgfHwgY2hhciA9PT0gIigiIHx8IGNoYXIgPT09ICIpIiB8fCBjaGFyID09PSAieyIgfHwgY2hhciA9PT0gIn0iIHx8IGNoYXIgPT09ICI8IiB8fCBjaGFyID09PSAiPiIgfHwgY2hhciA9PT0gIi8iIHx8IGNoYXIgPT09ICIlIikgewogICAgICAgICAgY2hhciA9ICJfIjsKICAgICAgICB9CiAgICAgICAgc2FuaXRpemVkTmFtZVtqXSA9IGNoYXI7CiAgICAgIH0KICAgICAgc2FuaXRpemVkTmFtZSA9IHNhbml0aXplZE5hbWUuam9pbigiIik7CiAgICAgIGlmIChzYW5pdGl6ZWROYW1lID09PSAiIikgewogICAgICAgIHNhbml0aXplZE5hbWUgPSAiQmFkX0ZvbnRfTmFtZSI7CiAgICAgIH0KICAgICAgbmFtZUluZGV4LmFkZChzdHJpbmdUb0J5dGVzKHNhbml0aXplZE5hbWUpKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmNvbXBpbGVJbmRleChuYW1lSW5kZXgpOwogIH0KICBjb21waWxlVG9wRGljdHMoZGljdHMsIGxlbmd0aCwgcmVtb3ZlQ2lkS2V5cykgewogICAgY29uc3QgZm9udERpY3RUcmFja2VycyA9IFtdOwogICAgbGV0IGZkQXJyYXlJbmRleCA9IG5ldyBDRkZJbmRleCgpOwogICAgZm9yIChjb25zdCBmb250RGljdCBvZiBkaWN0cykgewogICAgICBpZiAocmVtb3ZlQ2lkS2V5cykgewogICAgICAgIGZvbnREaWN0LnJlbW92ZUJ5TmFtZSgiQ0lERm9udFZlcnNpb24iKTsKICAgICAgICBmb250RGljdC5yZW1vdmVCeU5hbWUoIkNJREZvbnRSZXZpc2lvbiIpOwogICAgICAgIGZvbnREaWN0LnJlbW92ZUJ5TmFtZSgiQ0lERm9udFR5cGUiKTsKICAgICAgICBmb250RGljdC5yZW1vdmVCeU5hbWUoIkNJRENvdW50Iik7CiAgICAgICAgZm9udERpY3QucmVtb3ZlQnlOYW1lKCJVSURCYXNlIik7CiAgICAgIH0KICAgICAgY29uc3QgZm9udERpY3RUcmFja2VyID0gbmV3IENGRk9mZnNldFRyYWNrZXIoKTsKICAgICAgY29uc3QgZm9udERpY3REYXRhID0gdGhpcy5jb21waWxlRGljdChmb250RGljdCwgZm9udERpY3RUcmFja2VyKTsKICAgICAgZm9udERpY3RUcmFja2Vycy5wdXNoKGZvbnREaWN0VHJhY2tlcik7CiAgICAgIGZkQXJyYXlJbmRleC5hZGQoZm9udERpY3REYXRhKTsKICAgICAgZm9udERpY3RUcmFja2VyLm9mZnNldChsZW5ndGgpOwogICAgfQogICAgZmRBcnJheUluZGV4ID0gdGhpcy5jb21waWxlSW5kZXgoZmRBcnJheUluZGV4LCBmb250RGljdFRyYWNrZXJzKTsKICAgIHJldHVybiB7CiAgICAgIHRyYWNrZXJzOiBmb250RGljdFRyYWNrZXJzLAogICAgICBvdXRwdXQ6IGZkQXJyYXlJbmRleAogICAgfTsKICB9CiAgY29tcGlsZVByaXZhdGVEaWN0cyhkaWN0cywgdHJhY2tlcnMsIG91dHB1dCkgewogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZGljdHMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICBjb25zdCBmb250RGljdCA9IGRpY3RzW2ldOwogICAgICBjb25zdCBwcml2YXRlRGljdCA9IGZvbnREaWN0LnByaXZhdGVEaWN0OwogICAgICBpZiAoIXByaXZhdGVEaWN0IHx8ICFmb250RGljdC5oYXNOYW1lKCJQcml2YXRlIikpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlRoZXJlIG11c3QgYmUgYSBwcml2YXRlIGRpY3Rpb25hcnkuIik7CiAgICAgIH0KICAgICAgY29uc3QgcHJpdmF0ZURpY3RUcmFja2VyID0gbmV3IENGRk9mZnNldFRyYWNrZXIoKTsKICAgICAgY29uc3QgcHJpdmF0ZURpY3REYXRhID0gdGhpcy5jb21waWxlRGljdChwcml2YXRlRGljdCwgcHJpdmF0ZURpY3RUcmFja2VyKTsKICAgICAgbGV0IG91dHB1dExlbmd0aCA9IG91dHB1dC5sZW5ndGg7CiAgICAgIHByaXZhdGVEaWN0VHJhY2tlci5vZmZzZXQob3V0cHV0TGVuZ3RoKTsKICAgICAgaWYgKCFwcml2YXRlRGljdERhdGEubGVuZ3RoKSB7CiAgICAgICAgb3V0cHV0TGVuZ3RoID0gMDsKICAgICAgfQogICAgICB0cmFja2Vyc1tpXS5zZXRFbnRyeUxvY2F0aW9uKCJQcml2YXRlIiwgW3ByaXZhdGVEaWN0RGF0YS5sZW5ndGgsIG91dHB1dExlbmd0aF0sIG91dHB1dCk7CiAgICAgIG91dHB1dC5hZGQocHJpdmF0ZURpY3REYXRhKTsKICAgICAgaWYgKHByaXZhdGVEaWN0LnN1YnJzSW5kZXggJiYgcHJpdmF0ZURpY3QuaGFzTmFtZSgiU3VicnMiKSkgewogICAgICAgIGNvbnN0IHN1YnJzID0gdGhpcy5jb21waWxlSW5kZXgocHJpdmF0ZURpY3Quc3VicnNJbmRleCk7CiAgICAgICAgcHJpdmF0ZURpY3RUcmFja2VyLnNldEVudHJ5TG9jYXRpb24oIlN1YnJzIiwgW3ByaXZhdGVEaWN0RGF0YS5sZW5ndGhdLCBvdXRwdXQpOwogICAgICAgIG91dHB1dC5hZGQoc3VicnMpOwogICAgICB9CiAgICB9CiAgfQogIGNvbXBpbGVEaWN0KGRpY3QsIG9mZnNldFRyYWNrZXIpIHsKICAgIGNvbnN0IG91dCA9IFtdOwogICAgZm9yIChjb25zdCBrZXkgb2YgZGljdC5vcmRlcikgewogICAgICBpZiAoIShrZXkgaW4gZGljdC52YWx1ZXMpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgbGV0IHZhbHVlcyA9IGRpY3QudmFsdWVzW2tleV07CiAgICAgIGxldCB0eXBlcyA9IGRpY3QudHlwZXNba2V5XTsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHR5cGVzKSkgewogICAgICAgIHR5cGVzID0gW3R5cGVzXTsKICAgICAgfQogICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWVzKSkgewogICAgICAgIHZhbHVlcyA9IFt2YWx1ZXNdOwogICAgICB9CiAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaiA9IDAsIGpqID0gdHlwZXMubGVuZ3RoOyBqIDwgamo7ICsraikgewogICAgICAgIGNvbnN0IHR5cGUgPSB0eXBlc1tqXTsKICAgICAgICBjb25zdCB2YWx1ZSA9IHZhbHVlc1tqXTsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgIGNhc2UgIm51bSI6CiAgICAgICAgICBjYXNlICJzaWQiOgogICAgICAgICAgICBvdXQucHVzaCguLi50aGlzLmVuY29kZU51bWJlcih2YWx1ZSkpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgIm9mZnNldCI6CiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBkaWN0LmtleVRvTmFtZU1hcFtrZXldOwogICAgICAgICAgICBpZiAoIW9mZnNldFRyYWNrZXIuaXNUcmFja2luZyhuYW1lKSkgewogICAgICAgICAgICAgIG9mZnNldFRyYWNrZXIudHJhY2sobmFtZSwgb3V0Lmxlbmd0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3V0LnB1c2goMHgxZCwgMCwgMCwgMCwgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiYXJyYXkiOgogICAgICAgICAgY2FzZSAiZGVsdGEiOgogICAgICAgICAgICBvdXQucHVzaCguLi50aGlzLmVuY29kZU51bWJlcih2YWx1ZSkpOwogICAgICAgICAgICBmb3IgKGxldCBrID0gMSwga2sgPSB2YWx1ZXMubGVuZ3RoOyBrIDwga2s7ICsraykgewogICAgICAgICAgICAgIG91dC5wdXNoKC4uLnRoaXMuZW5jb2RlTnVtYmVyKHZhbHVlc1trXSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbmtub3duIGRhdGEgdHlwZSBvZiAke3R5cGV9YCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIG91dC5wdXNoKC4uLmRpY3Qub3Bjb2Rlc1trZXldKTsKICAgIH0KICAgIHJldHVybiBvdXQ7CiAgfQogIGNvbXBpbGVTdHJpbmdJbmRleChzdHJpbmdzKSB7CiAgICBjb25zdCBzdHJpbmdJbmRleCA9IG5ldyBDRkZJbmRleCgpOwogICAgZm9yIChjb25zdCBzdHJpbmcgb2Ygc3RyaW5ncykgewogICAgICBzdHJpbmdJbmRleC5hZGQoc3RyaW5nVG9CeXRlcyhzdHJpbmcpKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmNvbXBpbGVJbmRleChzdHJpbmdJbmRleCk7CiAgfQogIGNvbXBpbGVDaGFyU3RyaW5ncyhjaGFyU3RyaW5ncykgewogICAgY29uc3QgY2hhclN0cmluZ3NJbmRleCA9IG5ldyBDRkZJbmRleCgpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGFyU3RyaW5ncy5jb3VudDsgaSsrKSB7CiAgICAgIGNvbnN0IGdseXBoID0gY2hhclN0cmluZ3MuZ2V0KGkpOwogICAgICBpZiAoZ2x5cGgubGVuZ3RoID09PSAwKSB7CiAgICAgICAgY2hhclN0cmluZ3NJbmRleC5hZGQobmV3IFVpbnQ4QXJyYXkoWzB4OGIsIDB4MGVdKSk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY2hhclN0cmluZ3NJbmRleC5hZGQoZ2x5cGgpOwogICAgfQogICAgcmV0dXJuIHRoaXMuY29tcGlsZUluZGV4KGNoYXJTdHJpbmdzSW5kZXgpOwogIH0KICBjb21waWxlQ2hhcnNldChjaGFyc2V0LCBudW1HbHlwaHMsIHN0cmluZ3MsIGlzQ0lERm9udCkgewogICAgbGV0IG91dDsKICAgIGNvbnN0IG51bUdseXBoc0xlc3NOb3REZWYgPSBudW1HbHlwaHMgLSAxOwogICAgaWYgKGlzQ0lERm9udCkgewogICAgICBjb25zdCBuTGVmdCA9IG51bUdseXBoc0xlc3NOb3REZWYgLSAxOwogICAgICBvdXQgPSBuZXcgVWludDhBcnJheShbMiwgMCwgMSwgbkxlZnQgPj4gOCAmIDB4ZmYsIG5MZWZ0ICYgMHhmZl0pOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgbGVuZ3RoID0gMSArIG51bUdseXBoc0xlc3NOb3REZWYgKiAyOwogICAgICBvdXQgPSBuZXcgVWludDhBcnJheShsZW5ndGgpOwogICAgICBvdXRbMF0gPSAwOwogICAgICBsZXQgY2hhcnNldEluZGV4ID0gMDsKICAgICAgY29uc3QgbnVtQ2hhcnNldHMgPSBjaGFyc2V0LmNoYXJzZXQubGVuZ3RoOwogICAgICBsZXQgd2FybmVkID0gZmFsc2U7CiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgb3V0Lmxlbmd0aDsgaSArPSAyKSB7CiAgICAgICAgbGV0IHNpZCA9IDA7CiAgICAgICAgaWYgKGNoYXJzZXRJbmRleCA8IG51bUNoYXJzZXRzKSB7CiAgICAgICAgICBjb25zdCBuYW1lID0gY2hhcnNldC5jaGFyc2V0W2NoYXJzZXRJbmRleCsrXTsKICAgICAgICAgIHNpZCA9IHN0cmluZ3MuZ2V0U0lEKG5hbWUpOwogICAgICAgICAgaWYgKHNpZCA9PT0gLTEpIHsKICAgICAgICAgICAgc2lkID0gMDsKICAgICAgICAgICAgaWYgKCF3YXJuZWQpIHsKICAgICAgICAgICAgICB3YXJuZWQgPSB0cnVlOwogICAgICAgICAgICAgIHdhcm4oYENvdWxkbid0IGZpbmQgJHtuYW1lfSBpbiBDRkYgc3RyaW5nc2ApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG91dFtpXSA9IHNpZCA+PiA4ICYgMHhmZjsKICAgICAgICBvdXRbaSArIDFdID0gc2lkICYgMHhmZjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRoaXMuY29tcGlsZVR5cGVkQXJyYXkob3V0KTsKICB9CiAgY29tcGlsZUVuY29kaW5nKGVuY29kaW5nKSB7CiAgICByZXR1cm4gdGhpcy5jb21waWxlVHlwZWRBcnJheShlbmNvZGluZy5yYXcpOwogIH0KICBjb21waWxlRkRTZWxlY3QoZmRTZWxlY3QpIHsKICAgIGNvbnN0IGZvcm1hdCA9IGZkU2VsZWN0LmZvcm1hdDsKICAgIGxldCBvdXQsIGk7CiAgICBzd2l0Y2ggKGZvcm1hdCkgewogICAgICBjYXNlIDA6CiAgICAgICAgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoMSArIGZkU2VsZWN0LmZkU2VsZWN0Lmxlbmd0aCk7CiAgICAgICAgb3V0WzBdID0gZm9ybWF0OwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBmZFNlbGVjdC5mZFNlbGVjdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgb3V0W2kgKyAxXSA9IGZkU2VsZWN0LmZkU2VsZWN0W2ldOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAzOgogICAgICAgIGNvbnN0IHN0YXJ0ID0gMDsKICAgICAgICBsZXQgbGFzdEZEID0gZmRTZWxlY3QuZmRTZWxlY3RbMF07CiAgICAgICAgY29uc3QgcmFuZ2VzID0gW2Zvcm1hdCwgMCwgMCwgc3RhcnQgPj4gOCAmIDB4ZmYsIHN0YXJ0ICYgMHhmZiwgbGFzdEZEXTsKICAgICAgICBmb3IgKGkgPSAxOyBpIDwgZmRTZWxlY3QuZmRTZWxlY3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRGRCA9IGZkU2VsZWN0LmZkU2VsZWN0W2ldOwogICAgICAgICAgaWYgKGN1cnJlbnRGRCAhPT0gbGFzdEZEKSB7CiAgICAgICAgICAgIHJhbmdlcy5wdXNoKGkgPj4gOCAmIDB4ZmYsIGkgJiAweGZmLCBjdXJyZW50RkQpOwogICAgICAgICAgICBsYXN0RkQgPSBjdXJyZW50RkQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IG51bVJhbmdlcyA9IChyYW5nZXMubGVuZ3RoIC0gMykgLyAzOwogICAgICAgIHJhbmdlc1sxXSA9IG51bVJhbmdlcyA+PiA4ICYgMHhmZjsKICAgICAgICByYW5nZXNbMl0gPSBudW1SYW5nZXMgJiAweGZmOwogICAgICAgIHJhbmdlcy5wdXNoKGkgPj4gOCAmIDB4ZmYsIGkgJiAweGZmKTsKICAgICAgICBvdXQgPSBuZXcgVWludDhBcnJheShyYW5nZXMpOwogICAgICAgIGJyZWFrOwogICAgfQogICAgcmV0dXJuIHRoaXMuY29tcGlsZVR5cGVkQXJyYXkob3V0KTsKICB9CiAgY29tcGlsZVR5cGVkQXJyYXkoZGF0YSkgewogICAgcmV0dXJuIEFycmF5LmZyb20oZGF0YSk7CiAgfQogIGNvbXBpbGVJbmRleChpbmRleCwgdHJhY2tlcnMgPSBbXSkgewogICAgY29uc3Qgb2JqZWN0cyA9IGluZGV4Lm9iamVjdHM7CiAgICBjb25zdCBjb3VudCA9IG9iamVjdHMubGVuZ3RoOwogICAgaWYgKGNvdW50ID09PSAwKSB7CiAgICAgIHJldHVybiBbMCwgMF07CiAgICB9CiAgICBjb25zdCBkYXRhID0gW2NvdW50ID4+IDggJiAweGZmLCBjb3VudCAmIDB4ZmZdOwogICAgbGV0IGxhc3RPZmZzZXQgPSAxLAogICAgICBpOwogICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyArK2kpIHsKICAgICAgbGFzdE9mZnNldCArPSBvYmplY3RzW2ldLmxlbmd0aDsKICAgIH0KICAgIGxldCBvZmZzZXRTaXplOwogICAgaWYgKGxhc3RPZmZzZXQgPCAweDEwMCkgewogICAgICBvZmZzZXRTaXplID0gMTsKICAgIH0gZWxzZSBpZiAobGFzdE9mZnNldCA8IDB4MTAwMDApIHsKICAgICAgb2Zmc2V0U2l6ZSA9IDI7CiAgICB9IGVsc2UgaWYgKGxhc3RPZmZzZXQgPCAweDEwMDAwMDApIHsKICAgICAgb2Zmc2V0U2l6ZSA9IDM7CiAgICB9IGVsc2UgewogICAgICBvZmZzZXRTaXplID0gNDsKICAgIH0KICAgIGRhdGEucHVzaChvZmZzZXRTaXplKTsKICAgIGxldCByZWxhdGl2ZU9mZnNldCA9IDE7CiAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQgKyAxOyBpKyspIHsKICAgICAgaWYgKG9mZnNldFNpemUgPT09IDEpIHsKICAgICAgICBkYXRhLnB1c2gocmVsYXRpdmVPZmZzZXQgJiAweGZmKTsKICAgICAgfSBlbHNlIGlmIChvZmZzZXRTaXplID09PSAyKSB7CiAgICAgICAgZGF0YS5wdXNoKHJlbGF0aXZlT2Zmc2V0ID4+IDggJiAweGZmLCByZWxhdGl2ZU9mZnNldCAmIDB4ZmYpOwogICAgICB9IGVsc2UgaWYgKG9mZnNldFNpemUgPT09IDMpIHsKICAgICAgICBkYXRhLnB1c2gocmVsYXRpdmVPZmZzZXQgPj4gMTYgJiAweGZmLCByZWxhdGl2ZU9mZnNldCA+PiA4ICYgMHhmZiwgcmVsYXRpdmVPZmZzZXQgJiAweGZmKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkYXRhLnB1c2gocmVsYXRpdmVPZmZzZXQgPj4+IDI0ICYgMHhmZiwgcmVsYXRpdmVPZmZzZXQgPj4gMTYgJiAweGZmLCByZWxhdGl2ZU9mZnNldCA+PiA4ICYgMHhmZiwgcmVsYXRpdmVPZmZzZXQgJiAweGZmKTsKICAgICAgfQogICAgICBpZiAob2JqZWN0c1tpXSkgewogICAgICAgIHJlbGF0aXZlT2Zmc2V0ICs9IG9iamVjdHNbaV0ubGVuZ3RoOwogICAgICB9CiAgICB9CiAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICBpZiAodHJhY2tlcnNbaV0pIHsKICAgICAgICB0cmFja2Vyc1tpXS5vZmZzZXQoZGF0YS5sZW5ndGgpOwogICAgICB9CiAgICAgIGRhdGEucHVzaCguLi5vYmplY3RzW2ldKTsKICAgIH0KICAgIHJldHVybiBkYXRhOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvc3RhbmRhcmRfZm9udHMuanMKCgpjb25zdCBnZXRTdGRGb250TWFwID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgdFsiVGltZXMtUm9tYW4iXSA9ICJUaW1lcy1Sb21hbiI7CiAgdC5IZWx2ZXRpY2EgPSAiSGVsdmV0aWNhIjsKICB0LkNvdXJpZXIgPSAiQ291cmllciI7CiAgdC5TeW1ib2wgPSAiU3ltYm9sIjsKICB0WyJUaW1lcy1Cb2xkIl0gPSAiVGltZXMtQm9sZCI7CiAgdFsiSGVsdmV0aWNhLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQ291cmllci1Cb2xkIl0gPSAiQ291cmllci1Cb2xkIjsKICB0LlphcGZEaW5nYmF0cyA9ICJaYXBmRGluZ2JhdHMiOwogIHRbIlRpbWVzLUl0YWxpYyJdID0gIlRpbWVzLUl0YWxpYyI7CiAgdFsiSGVsdmV0aWNhLU9ibGlxdWUiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdFsiQ291cmllci1PYmxpcXVlIl0gPSAiQ291cmllci1PYmxpcXVlIjsKICB0WyJUaW1lcy1Cb2xkSXRhbGljIl0gPSAiVGltZXMtQm9sZEl0YWxpYyI7CiAgdFsiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJDb3VyaWVyLUJvbGRPYmxpcXVlIl0gPSAiQ291cmllci1Cb2xkT2JsaXF1ZSI7CiAgdC5BcmlhbE5hcnJvdyA9ICJIZWx2ZXRpY2EiOwogIHRbIkFyaWFsTmFycm93LUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQXJpYWxOYXJyb3ctQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgdFsiQXJpYWxOYXJyb3ctSXRhbGljIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogIHQuQXJpYWxCbGFjayA9ICJIZWx2ZXRpY2EiOwogIHRbIkFyaWFsQmxhY2stQm9sZCJdID0gIkhlbHZldGljYS1Cb2xkIjsKICB0WyJBcmlhbEJsYWNrLUJvbGRJdGFsaWMiXSA9ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiOwogIHRbIkFyaWFsQmxhY2stSXRhbGljIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogIHRbIkFyaWFsLUJsYWNrIl0gPSAiSGVsdmV0aWNhIjsKICB0WyJBcmlhbC1CbGFjay1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkFyaWFsLUJsYWNrLUJvbGRJdGFsaWMiXSA9ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiOwogIHRbIkFyaWFsLUJsYWNrLUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0LkFyaWFsID0gIkhlbHZldGljYSI7CiAgdFsiQXJpYWwtQm9sZCJdID0gIkhlbHZldGljYS1Cb2xkIjsKICB0WyJBcmlhbC1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJBcmlhbC1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdC5BcmlhbE1UID0gIkhlbHZldGljYSI7CiAgdFsiQXJpYWwtQm9sZEl0YWxpY01UIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJBcmlhbC1Cb2xkTVQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQXJpYWwtSXRhbGljTVQiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdFsiQXJpYWwtQm9sZEl0YWxpY01ULUJvbGRJdGFsaWMiXSA9ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiOwogIHRbIkFyaWFsLUJvbGRNVC1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkFyaWFsLUl0YWxpY01ULUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0LkFyaWFsVW5pY29kZU1TID0gIkhlbHZldGljYSI7CiAgdFsiQXJpYWxVbmljb2RlTVMtQm9sZCJdID0gIkhlbHZldGljYS1Cb2xkIjsKICB0WyJBcmlhbFVuaWNvZGVNUy1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJBcmlhbFVuaWNvZGVNUy1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdFsiQ291cmllci1Cb2xkSXRhbGljIl0gPSAiQ291cmllci1Cb2xkT2JsaXF1ZSI7CiAgdFsiQ291cmllci1JdGFsaWMiXSA9ICJDb3VyaWVyLU9ibGlxdWUiOwogIHQuQ291cmllck5ldyA9ICJDb3VyaWVyIjsKICB0WyJDb3VyaWVyTmV3LUJvbGQiXSA9ICJDb3VyaWVyLUJvbGQiOwogIHRbIkNvdXJpZXJOZXctQm9sZEl0YWxpYyJdID0gIkNvdXJpZXItQm9sZE9ibGlxdWUiOwogIHRbIkNvdXJpZXJOZXctSXRhbGljIl0gPSAiQ291cmllci1PYmxpcXVlIjsKICB0WyJDb3VyaWVyTmV3UFMtQm9sZEl0YWxpY01UIl0gPSAiQ291cmllci1Cb2xkT2JsaXF1ZSI7CiAgdFsiQ291cmllck5ld1BTLUJvbGRNVCJdID0gIkNvdXJpZXItQm9sZCI7CiAgdFsiQ291cmllck5ld1BTLUl0YWxpY01UIl0gPSAiQ291cmllci1PYmxpcXVlIjsKICB0LkNvdXJpZXJOZXdQU01UID0gIkNvdXJpZXIiOwogIHRbIkhlbHZldGljYS1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJIZWx2ZXRpY2EtSXRhbGljIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogIHRbIkhlbHZldGljYUxUU3RkLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiU3ltYm9sLUJvbGQiXSA9ICJTeW1ib2wiOwogIHRbIlN5bWJvbC1Cb2xkSXRhbGljIl0gPSAiU3ltYm9sIjsKICB0WyJTeW1ib2wtSXRhbGljIl0gPSAiU3ltYm9sIjsKICB0LlRpbWVzTmV3Um9tYW4gPSAiVGltZXMtUm9tYW4iOwogIHRbIlRpbWVzTmV3Um9tYW4tQm9sZCJdID0gIlRpbWVzLUJvbGQiOwogIHRbIlRpbWVzTmV3Um9tYW4tQm9sZEl0YWxpYyJdID0gIlRpbWVzLUJvbGRJdGFsaWMiOwogIHRbIlRpbWVzTmV3Um9tYW4tSXRhbGljIl0gPSAiVGltZXMtSXRhbGljIjsKICB0LlRpbWVzTmV3Um9tYW5QUyA9ICJUaW1lcy1Sb21hbiI7CiAgdFsiVGltZXNOZXdSb21hblBTLUJvbGQiXSA9ICJUaW1lcy1Cb2xkIjsKICB0WyJUaW1lc05ld1JvbWFuUFMtQm9sZEl0YWxpYyJdID0gIlRpbWVzLUJvbGRJdGFsaWMiOwogIHRbIlRpbWVzTmV3Um9tYW5QUy1Cb2xkSXRhbGljTVQiXSA9ICJUaW1lcy1Cb2xkSXRhbGljIjsKICB0WyJUaW1lc05ld1JvbWFuUFMtQm9sZE1UIl0gPSAiVGltZXMtQm9sZCI7CiAgdFsiVGltZXNOZXdSb21hblBTLUl0YWxpYyJdID0gIlRpbWVzLUl0YWxpYyI7CiAgdFsiVGltZXNOZXdSb21hblBTLUl0YWxpY01UIl0gPSAiVGltZXMtSXRhbGljIjsKICB0LlRpbWVzTmV3Um9tYW5QU01UID0gIlRpbWVzLVJvbWFuIjsKICB0WyJUaW1lc05ld1JvbWFuUFNNVC1Cb2xkIl0gPSAiVGltZXMtQm9sZCI7CiAgdFsiVGltZXNOZXdSb21hblBTTVQtQm9sZEl0YWxpYyJdID0gIlRpbWVzLUJvbGRJdGFsaWMiOwogIHRbIlRpbWVzTmV3Um9tYW5QU01ULUl0YWxpYyJdID0gIlRpbWVzLUl0YWxpYyI7Cn0pOwpjb25zdCBnZXRGb250TmFtZVRvRmlsZU1hcCA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHQuQ291cmllciA9ICJGb3hpdEZpeGVkLnBmYiI7CiAgdFsiQ291cmllci1Cb2xkIl0gPSAiRm94aXRGaXhlZEJvbGQucGZiIjsKICB0WyJDb3VyaWVyLUJvbGRPYmxpcXVlIl0gPSAiRm94aXRGaXhlZEJvbGRJdGFsaWMucGZiIjsKICB0WyJDb3VyaWVyLU9ibGlxdWUiXSA9ICJGb3hpdEZpeGVkSXRhbGljLnBmYiI7CiAgdC5IZWx2ZXRpY2EgPSAiTGliZXJhdGlvblNhbnMtUmVndWxhci50dGYiOwogIHRbIkhlbHZldGljYS1Cb2xkIl0gPSAiTGliZXJhdGlvblNhbnMtQm9sZC50dGYiOwogIHRbIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSJdID0gIkxpYmVyYXRpb25TYW5zLUJvbGRJdGFsaWMudHRmIjsKICB0WyJIZWx2ZXRpY2EtT2JsaXF1ZSJdID0gIkxpYmVyYXRpb25TYW5zLUl0YWxpYy50dGYiOwogIHRbIlRpbWVzLVJvbWFuIl0gPSAiRm94aXRTZXJpZi5wZmIiOwogIHRbIlRpbWVzLUJvbGQiXSA9ICJGb3hpdFNlcmlmQm9sZC5wZmIiOwogIHRbIlRpbWVzLUJvbGRJdGFsaWMiXSA9ICJGb3hpdFNlcmlmQm9sZEl0YWxpYy5wZmIiOwogIHRbIlRpbWVzLUl0YWxpYyJdID0gIkZveGl0U2VyaWZJdGFsaWMucGZiIjsKICB0LlN5bWJvbCA9ICJGb3hpdFN5bWJvbC5wZmIiOwogIHQuWmFwZkRpbmdiYXRzID0gIkZveGl0RGluZ2JhdHMucGZiIjsKICB0WyJMaWJlcmF0aW9uU2Fucy1SZWd1bGFyIl0gPSAiTGliZXJhdGlvblNhbnMtUmVndWxhci50dGYiOwogIHRbIkxpYmVyYXRpb25TYW5zLUJvbGQiXSA9ICJMaWJlcmF0aW9uU2Fucy1Cb2xkLnR0ZiI7CiAgdFsiTGliZXJhdGlvblNhbnMtSXRhbGljIl0gPSAiTGliZXJhdGlvblNhbnMtSXRhbGljLnR0ZiI7CiAgdFsiTGliZXJhdGlvblNhbnMtQm9sZEl0YWxpYyJdID0gIkxpYmVyYXRpb25TYW5zLUJvbGRJdGFsaWMudHRmIjsKfSk7CmNvbnN0IGdldE5vblN0ZEZvbnRNYXAgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICB0LkNhbGlicmkgPSAiSGVsdmV0aWNhIjsKICB0WyJDYWxpYnJpLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQ2FsaWJyaS1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJDYWxpYnJpLUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0LkNlbnR1cnlHb3RoaWMgPSAiSGVsdmV0aWNhIjsKICB0WyJDZW50dXJ5R290aGljLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQ2VudHVyeUdvdGhpYy1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJDZW50dXJ5R290aGljLUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0LkNvbWljU2Fuc01TID0gIkNvbWljIFNhbnMgTVMiOwogIHRbIkNvbWljU2Fuc01TLUJvbGQiXSA9ICJDb21pYyBTYW5zIE1TLUJvbGQiOwogIHRbIkNvbWljU2Fuc01TLUJvbGRJdGFsaWMiXSA9ICJDb21pYyBTYW5zIE1TLUJvbGRJdGFsaWMiOwogIHRbIkNvbWljU2Fuc01TLUl0YWxpYyJdID0gIkNvbWljIFNhbnMgTVMtSXRhbGljIjsKICB0LkdpbGxTYW5zTVQgPSAiSGVsdmV0aWNhIjsKICB0WyJHaWxsU2Fuc01ULUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiR2lsbFNhbnNNVC1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJHaWxsU2Fuc01ULUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0LkltcGFjdCA9ICJIZWx2ZXRpY2EiOwogIHRbIkl0Y1N5bWJvbC1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkl0Y1N5bWJvbC1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJJdGNTeW1ib2wtQm9vayJdID0gIkhlbHZldGljYSI7CiAgdFsiSXRjU3ltYm9sLUJvb2tJdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdFsiSXRjU3ltYm9sLU1lZGl1bSJdID0gIkhlbHZldGljYSI7CiAgdFsiSXRjU3ltYm9sLU1lZGl1bUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0Lkx1Y2lkYUNvbnNvbGUgPSAiQ291cmllciI7CiAgdFsiTHVjaWRhQ29uc29sZS1Cb2xkIl0gPSAiQ291cmllci1Cb2xkIjsKICB0WyJMdWNpZGFDb25zb2xlLUJvbGRJdGFsaWMiXSA9ICJDb3VyaWVyLUJvbGRPYmxpcXVlIjsKICB0WyJMdWNpZGFDb25zb2xlLUl0YWxpYyJdID0gIkNvdXJpZXItT2JsaXF1ZSI7CiAgdFsiTHVjaWRhU2Fucy1EZW1pIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIk1TLUdvdGhpYyJdID0gIk1TIEdvdGhpYyI7CiAgdFsiTVMtR290aGljLUJvbGQiXSA9ICJNUyBHb3RoaWMtQm9sZCI7CiAgdFsiTVMtR290aGljLUJvbGRJdGFsaWMiXSA9ICJNUyBHb3RoaWMtQm9sZEl0YWxpYyI7CiAgdFsiTVMtR290aGljLUl0YWxpYyJdID0gIk1TIEdvdGhpYy1JdGFsaWMiOwogIHRbIk1TLU1pbmNobyJdID0gIk1TIE1pbmNobyI7CiAgdFsiTVMtTWluY2hvLUJvbGQiXSA9ICJNUyBNaW5jaG8tQm9sZCI7CiAgdFsiTVMtTWluY2hvLUJvbGRJdGFsaWMiXSA9ICJNUyBNaW5jaG8tQm9sZEl0YWxpYyI7CiAgdFsiTVMtTWluY2hvLUl0YWxpYyJdID0gIk1TIE1pbmNoby1JdGFsaWMiOwogIHRbIk1TLVBHb3RoaWMiXSA9ICJNUyBQR290aGljIjsKICB0WyJNUy1QR290aGljLUJvbGQiXSA9ICJNUyBQR290aGljLUJvbGQiOwogIHRbIk1TLVBHb3RoaWMtQm9sZEl0YWxpYyJdID0gIk1TIFBHb3RoaWMtQm9sZEl0YWxpYyI7CiAgdFsiTVMtUEdvdGhpYy1JdGFsaWMiXSA9ICJNUyBQR290aGljLUl0YWxpYyI7CiAgdFsiTVMtUE1pbmNobyJdID0gIk1TIFBNaW5jaG8iOwogIHRbIk1TLVBNaW5jaG8tQm9sZCJdID0gIk1TIFBNaW5jaG8tQm9sZCI7CiAgdFsiTVMtUE1pbmNoby1Cb2xkSXRhbGljIl0gPSAiTVMgUE1pbmNoby1Cb2xkSXRhbGljIjsKICB0WyJNUy1QTWluY2hvLUl0YWxpYyJdID0gIk1TIFBNaW5jaG8tSXRhbGljIjsKICB0Lk51cHRpYWxTY3JpcHQgPSAiVGltZXMtSXRhbGljIjsKICB0LlNlZ29lVUlTeW1ib2wgPSAiSGVsdmV0aWNhIjsKfSk7CmNvbnN0IGdldFNlcmlmRm9udHMgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICB0WyJBZG9iZSBKZW5zb24iXSA9IHRydWU7CiAgdFsiQWRvYmUgVGV4dCJdID0gdHJ1ZTsKICB0LkFsYmVydHVzID0gdHJ1ZTsKICB0LkFsZHVzID0gdHJ1ZTsKICB0LkFsZXhhbmRyaWEgPSB0cnVlOwogIHQuQWxnZXJpYW4gPSB0cnVlOwogIHRbIkFtZXJpY2FuIFR5cGV3cml0ZXIiXSA9IHRydWU7CiAgdC5BbnRpcXVhID0gdHJ1ZTsKICB0LkFwZXggPSB0cnVlOwogIHQuQXJubyA9IHRydWU7CiAgdC5Bc3RlciA9IHRydWU7CiAgdC5BdXJvcmEgPSB0cnVlOwogIHQuQmFza2VydmlsbGUgPSB0cnVlOwogIHQuQmVsbCA9IHRydWU7CiAgdC5CZW1ibyA9IHRydWU7CiAgdFsiQmVtYm8gU2Nob29sYm9vayJdID0gdHJ1ZTsKICB0LkJlbmd1aWF0ID0gdHJ1ZTsKICB0WyJCZXJrZWxleSBPbGQgU3R5bGUiXSA9IHRydWU7CiAgdFsiQmVybmhhcmQgTW9kZXJuIl0gPSB0cnVlOwogIHRbIkJlcnRob2xkIENpdHkiXSA9IHRydWU7CiAgdC5Cb2RvbmkgPSB0cnVlOwogIHRbIkJhdWVyIEJvZG9uaSJdID0gdHJ1ZTsKICB0WyJCb29rIEFudGlxdWEiXSA9IHRydWU7CiAgdC5Cb29rbWFuID0gdHJ1ZTsKICB0WyJCb3JkZWF1eCBSb21hbiJdID0gdHJ1ZTsKICB0WyJDYWxpZm9ybmlhbiBGQiJdID0gdHJ1ZTsKICB0LkNhbGlzdG8gPSB0cnVlOwogIHQuQ2FsdmVydCA9IHRydWU7CiAgdC5DYXBpdGFscyA9IHRydWU7CiAgdC5DYW1icmlhID0gdHJ1ZTsKICB0LkNhcnRpZXIgPSB0cnVlOwogIHQuQ2FzbG9uID0gdHJ1ZTsKICB0LkNhdHVsbCA9IHRydWU7CiAgdC5DZW50YXVyID0gdHJ1ZTsKICB0WyJDZW50dXJ5IE9sZCBTdHlsZSJdID0gdHJ1ZTsKICB0WyJDZW50dXJ5IFNjaG9vbGJvb2siXSA9IHRydWU7CiAgdC5DaGFwYXJyYWwgPSB0cnVlOwogIHRbIkNoYXJpcyBTSUwiXSA9IHRydWU7CiAgdC5DaGVsdGVuaGFtID0gdHJ1ZTsKICB0WyJDaG9sbGEgU2xhYiJdID0gdHJ1ZTsKICB0LkNsYXJlbmRvbiA9IHRydWU7CiAgdC5DbGVhcmZhY2UgPSB0cnVlOwogIHQuQ29jaGluID0gdHJ1ZTsKICB0LkNvbG9ubmEgPSB0cnVlOwogIHRbIkNvbXB1dGVyIE1vZGVybiJdID0gdHJ1ZTsKICB0WyJDb25jcmV0ZSBSb21hbiJdID0gdHJ1ZTsKICB0LkNvbnN0YW50aWEgPSB0cnVlOwogIHRbIkNvb3BlciBCbGFjayJdID0gdHJ1ZTsKICB0LkNvcm9uYSA9IHRydWU7CiAgdC5FY290eXBlID0gdHJ1ZTsKICB0LkVneXB0aWVubmUgPSB0cnVlOwogIHQuRWxlcGhhbnQgPSB0cnVlOwogIHQuRXhjZWxzaW9yID0gdHJ1ZTsKICB0LkZhaXJmaWVsZCA9IHRydWU7CiAgdFsiRkYgU2NhbGEiXSA9IHRydWU7CiAgdC5Gb2xrYXJkID0gdHJ1ZTsKICB0LkZvb3RsaWdodCA9IHRydWU7CiAgdC5GcmVlU2VyaWYgPSB0cnVlOwogIHRbIkZyaXogUXVhZHJhdGEiXSA9IHRydWU7CiAgdC5HYXJhbW9uZCA9IHRydWU7CiAgdC5HZW50aXVtID0gdHJ1ZTsKICB0Lkdlb3JnaWEgPSB0cnVlOwogIHQuR2xvdWNlc3RlciA9IHRydWU7CiAgdFsiR291ZHkgT2xkIFN0eWxlIl0gPSB0cnVlOwogIHRbIkdvdWR5IFNjaG9vbGJvb2siXSA9IHRydWU7CiAgdFsiR291ZHkgUHJvIEZvbnQiXSA9IHRydWU7CiAgdC5HcmFuam9uID0gdHJ1ZTsKICB0WyJHdWFyZGlhbiBFZ3lwdGlhbiJdID0gdHJ1ZTsKICB0LkhlYXRoZXIgPSB0cnVlOwogIHQuSGVyY3VsZXMgPSB0cnVlOwogIHRbIkhpZ2ggVG93ZXIgVGV4dCJdID0gdHJ1ZTsKICB0Lkhpcm9zaGlnZSA9IHRydWU7CiAgdFsiSG9lZmxlciBUZXh0Il0gPSB0cnVlOwogIHRbIkh1bWFuYSBTZXJpZiJdID0gdHJ1ZTsKICB0LkltcHJpbnQgPSB0cnVlOwogIHRbIklvbmljIE5vLiA1Il0gPSB0cnVlOwogIHQuSmFuc29uID0gdHJ1ZTsKICB0LkpvYW5uYSA9IHRydWU7CiAgdC5Lb3Jpbm5hID0gdHJ1ZTsKICB0LkxleGljb24gPSB0cnVlOwogIHQuTGliZXJhdGlvblNlcmlmID0gdHJ1ZTsKICB0WyJMaWJlcmF0aW9uIFNlcmlmIl0gPSB0cnVlOwogIHRbIkxpbnV4IExpYmVydGluZSJdID0gdHJ1ZTsKICB0LkxpdGVyYXR1cm5heWEgPSB0cnVlOwogIHQuTHVjaWRhID0gdHJ1ZTsKICB0WyJMdWNpZGEgQnJpZ2h0Il0gPSB0cnVlOwogIHQuTWVsaW9yID0gdHJ1ZTsKICB0Lk1lbXBoaXMgPSB0cnVlOwogIHQuTWlsbGVyID0gdHJ1ZTsKICB0Lk1pbmlvbiA9IHRydWU7CiAgdC5Nb2Rlcm4gPSB0cnVlOwogIHRbIk1vbmEgTGlzYSJdID0gdHJ1ZTsKICB0WyJNcnMgRWF2ZXMiXSA9IHRydWU7CiAgdFsiTVMgU2VyaWYiXSA9IHRydWU7CiAgdFsiTXVzZW8gU2xhYiJdID0gdHJ1ZTsKICB0WyJOZXcgWW9yayJdID0gdHJ1ZTsKICB0WyJOaW1idXMgUm9tYW4iXSA9IHRydWU7CiAgdFsiTlBTIFJhd2xpbnNvbiBSb2Fkd2F5Il0gPSB0cnVlOwogIHQuTnVwdGlhbFNjcmlwdCA9IHRydWU7CiAgdC5QYWxhdGlubyA9IHRydWU7CiAgdC5QZXJwZXR1YSA9IHRydWU7CiAgdC5QbGFudGluID0gdHJ1ZTsKICB0WyJQbGFudGluIFNjaG9vbGJvb2siXSA9IHRydWU7CiAgdC5QbGF5YmlsbCA9IHRydWU7CiAgdFsiUG9vciBSaWNoYXJkIl0gPSB0cnVlOwogIHRbIlJhd2xpbnNvbiBSb2Fkd2F5Il0gPSB0cnVlOwogIHQuUmVuYXVsdCA9IHRydWU7CiAgdC5SZXF1aWVtID0gdHJ1ZTsKICB0LlJvY2t3ZWxsID0gdHJ1ZTsKICB0LlJvbWFuID0gdHJ1ZTsKICB0WyJSb3RpcyBTZXJpZiJdID0gdHJ1ZTsKICB0LlNhYm9uID0gdHJ1ZTsKICB0LlNjYWxhID0gdHJ1ZTsKICB0LlNlYWd1bGwgPSB0cnVlOwogIHQuU2lzdGluYSA9IHRydWU7CiAgdC5Tb3V2ZW5pciA9IHRydWU7CiAgdC5TVElYID0gdHJ1ZTsKICB0WyJTdG9uZSBJbmZvcm1hbCJdID0gdHJ1ZTsKICB0WyJTdG9uZSBTZXJpZiJdID0gdHJ1ZTsKICB0LlN5bGZhZW4gPSB0cnVlOwogIHQuVGltZXMgPSB0cnVlOwogIHQuVHJhamFuID0gdHJ1ZTsKICB0WyJUcmluaXTDqSJdID0gdHJ1ZTsKICB0WyJUcnVtcCBNZWRpYWV2YWwiXSA9IHRydWU7CiAgdC5VdG9waWEgPSB0cnVlOwogIHRbIlZhbGUgVHlwZSJdID0gdHJ1ZTsKICB0WyJCaXRzdHJlYW0gVmVyYSJdID0gdHJ1ZTsKICB0WyJWZXJhIFNlcmlmIl0gPSB0cnVlOwogIHQuVmVyc2FpbGxlcyA9IHRydWU7CiAgdC5XYW50ZWQgPSB0cnVlOwogIHQuV2Vpc3MgPSB0cnVlOwogIHRbIldpZGUgTGF0aW4iXSA9IHRydWU7CiAgdC5XaW5kc29yID0gdHJ1ZTsKICB0LlhJVFMgPSB0cnVlOwp9KTsKY29uc3QgZ2V0U3ltYm9sc0ZvbnRzID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgdC5EaW5nYmF0cyA9IHRydWU7CiAgdC5TeW1ib2wgPSB0cnVlOwogIHQuWmFwZkRpbmdiYXRzID0gdHJ1ZTsKICB0LldpbmdkaW5ncyA9IHRydWU7CiAgdFsiV2luZ2RpbmdzLUJvbGQiXSA9IHRydWU7CiAgdFsiV2luZ2RpbmdzLVJlZ3VsYXIiXSA9IHRydWU7Cn0pOwpjb25zdCBnZXRHbHlwaE1hcEZvclN0YW5kYXJkRm9udHMgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICB0WzJdID0gMTA7CiAgdFszXSA9IDMyOwogIHRbNF0gPSAzMzsKICB0WzVdID0gMzQ7CiAgdFs2XSA9IDM1OwogIHRbN10gPSAzNjsKICB0WzhdID0gMzc7CiAgdFs5XSA9IDM4OwogIHRbMTBdID0gMzk7CiAgdFsxMV0gPSA0MDsKICB0WzEyXSA9IDQxOwogIHRbMTNdID0gNDI7CiAgdFsxNF0gPSA0MzsKICB0WzE1XSA9IDQ0OwogIHRbMTZdID0gNDU7CiAgdFsxN10gPSA0NjsKICB0WzE4XSA9IDQ3OwogIHRbMTldID0gNDg7CiAgdFsyMF0gPSA0OTsKICB0WzIxXSA9IDUwOwogIHRbMjJdID0gNTE7CiAgdFsyM10gPSA1MjsKICB0WzI0XSA9IDUzOwogIHRbMjVdID0gNTQ7CiAgdFsyNl0gPSA1NTsKICB0WzI3XSA9IDU2OwogIHRbMjhdID0gNTc7CiAgdFsyOV0gPSA1ODsKICB0WzMwXSA9IDg5NDsKICB0WzMxXSA9IDYwOwogIHRbMzJdID0gNjE7CiAgdFszM10gPSA2MjsKICB0WzM0XSA9IDYzOwogIHRbMzVdID0gNjQ7CiAgdFszNl0gPSA2NTsKICB0WzM3XSA9IDY2OwogIHRbMzhdID0gNjc7CiAgdFszOV0gPSA2ODsKICB0WzQwXSA9IDY5OwogIHRbNDFdID0gNzA7CiAgdFs0Ml0gPSA3MTsKICB0WzQzXSA9IDcyOwogIHRbNDRdID0gNzM7CiAgdFs0NV0gPSA3NDsKICB0WzQ2XSA9IDc1OwogIHRbNDddID0gNzY7CiAgdFs0OF0gPSA3NzsKICB0WzQ5XSA9IDc4OwogIHRbNTBdID0gNzk7CiAgdFs1MV0gPSA4MDsKICB0WzUyXSA9IDgxOwogIHRbNTNdID0gODI7CiAgdFs1NF0gPSA4MzsKICB0WzU1XSA9IDg0OwogIHRbNTZdID0gODU7CiAgdFs1N10gPSA4NjsKICB0WzU4XSA9IDg3OwogIHRbNTldID0gODg7CiAgdFs2MF0gPSA4OTsKICB0WzYxXSA9IDkwOwogIHRbNjJdID0gOTE7CiAgdFs2M10gPSA5MjsKICB0WzY0XSA9IDkzOwogIHRbNjVdID0gOTQ7CiAgdFs2Nl0gPSA5NTsKICB0WzY3XSA9IDk2OwogIHRbNjhdID0gOTc7CiAgdFs2OV0gPSA5ODsKICB0WzcwXSA9IDk5OwogIHRbNzFdID0gMTAwOwogIHRbNzJdID0gMTAxOwogIHRbNzNdID0gMTAyOwogIHRbNzRdID0gMTAzOwogIHRbNzVdID0gMTA0OwogIHRbNzZdID0gMTA1OwogIHRbNzddID0gMTA2OwogIHRbNzhdID0gMTA3OwogIHRbNzldID0gMTA4OwogIHRbODBdID0gMTA5OwogIHRbODFdID0gMTEwOwogIHRbODJdID0gMTExOwogIHRbODNdID0gMTEyOwogIHRbODRdID0gMTEzOwogIHRbODVdID0gMTE0OwogIHRbODZdID0gMTE1OwogIHRbODddID0gMTE2OwogIHRbODhdID0gMTE3OwogIHRbODldID0gMTE4OwogIHRbOTBdID0gMTE5OwogIHRbOTFdID0gMTIwOwogIHRbOTJdID0gMTIxOwogIHRbOTNdID0gMTIyOwogIHRbOTRdID0gMTIzOwogIHRbOTVdID0gMTI0OwogIHRbOTZdID0gMTI1OwogIHRbOTddID0gMTI2OwogIHRbOThdID0gMTk2OwogIHRbOTldID0gMTk3OwogIHRbMTAwXSA9IDE5OTsKICB0WzEwMV0gPSAyMDE7CiAgdFsxMDJdID0gMjA5OwogIHRbMTAzXSA9IDIxNDsKICB0WzEwNF0gPSAyMjA7CiAgdFsxMDVdID0gMjI1OwogIHRbMTA2XSA9IDIyNDsKICB0WzEwN10gPSAyMjY7CiAgdFsxMDhdID0gMjI4OwogIHRbMTA5XSA9IDIyNzsKICB0WzExMF0gPSAyMjk7CiAgdFsxMTFdID0gMjMxOwogIHRbMTEyXSA9IDIzMzsKICB0WzExM10gPSAyMzI7CiAgdFsxMTRdID0gMjM0OwogIHRbMTE1XSA9IDIzNTsKICB0WzExNl0gPSAyMzc7CiAgdFsxMTddID0gMjM2OwogIHRbMTE4XSA9IDIzODsKICB0WzExOV0gPSAyMzk7CiAgdFsxMjBdID0gMjQxOwogIHRbMTIxXSA9IDI0MzsKICB0WzEyMl0gPSAyNDI7CiAgdFsxMjNdID0gMjQ0OwogIHRbMTI0XSA9IDI0NjsKICB0WzEyNV0gPSAyNDU7CiAgdFsxMjZdID0gMjUwOwogIHRbMTI3XSA9IDI0OTsKICB0WzEyOF0gPSAyNTE7CiAgdFsxMjldID0gMjUyOwogIHRbMTMwXSA9IDgyMjQ7CiAgdFsxMzFdID0gMTc2OwogIHRbMTMyXSA9IDE2MjsKICB0WzEzM10gPSAxNjM7CiAgdFsxMzRdID0gMTY3OwogIHRbMTM1XSA9IDgyMjY7CiAgdFsxMzZdID0gMTgyOwogIHRbMTM3XSA9IDIyMzsKICB0WzEzOF0gPSAxNzQ7CiAgdFsxMzldID0gMTY5OwogIHRbMTQwXSA9IDg0ODI7CiAgdFsxNDFdID0gMTgwOwogIHRbMTQyXSA9IDE2ODsKICB0WzE0M10gPSA4ODAwOwogIHRbMTQ0XSA9IDE5ODsKICB0WzE0NV0gPSAyMTY7CiAgdFsxNDZdID0gODczNDsKICB0WzE0N10gPSAxNzc7CiAgdFsxNDhdID0gODgwNDsKICB0WzE0OV0gPSA4ODA1OwogIHRbMTUwXSA9IDE2NTsKICB0WzE1MV0gPSAxODE7CiAgdFsxNTJdID0gODcwNjsKICB0WzE1M10gPSA4NzIxOwogIHRbMTU0XSA9IDg3MTk7CiAgdFsxNTZdID0gODc0NzsKICB0WzE1N10gPSAxNzA7CiAgdFsxNThdID0gMTg2OwogIHRbMTU5XSA9IDg0ODY7CiAgdFsxNjBdID0gMjMwOwogIHRbMTYxXSA9IDI0ODsKICB0WzE2Ml0gPSAxOTE7CiAgdFsxNjNdID0gMTYxOwogIHRbMTY0XSA9IDE3MjsKICB0WzE2NV0gPSA4NzMwOwogIHRbMTY2XSA9IDQwMjsKICB0WzE2N10gPSA4Nzc2OwogIHRbMTY4XSA9IDg3MTA7CiAgdFsxNjldID0gMTcxOwogIHRbMTcwXSA9IDE4NzsKICB0WzE3MV0gPSA4MjMwOwogIHRbMTc5XSA9IDgyMjA7CiAgdFsxODBdID0gODIyMTsKICB0WzE4MV0gPSA4MjE2OwogIHRbMTgyXSA9IDgyMTc7CiAgdFsyMDBdID0gMTkzOwogIHRbMjAzXSA9IDIwNTsKICB0WzIwN10gPSAyMTE7CiAgdFsyMTBdID0gMjE4OwogIHRbMjIzXSA9IDcxMTsKICB0WzIyNF0gPSAzMjE7CiAgdFsyMjVdID0gMzIyOwogIHRbMjI2XSA9IDM1MjsKICB0WzIyN10gPSAzNTM7CiAgdFsyMjhdID0gMzgxOwogIHRbMjI5XSA9IDM4MjsKICB0WzIzM10gPSAyMjE7CiAgdFsyMzRdID0gMjUzOwogIHRbMjUyXSA9IDI2MzsKICB0WzI1M10gPSAyNjg7CiAgdFsyNTRdID0gMjY5OwogIHRbMjU4XSA9IDI1ODsKICB0WzI2MF0gPSAyNjA7CiAgdFsyNjFdID0gMjYxOwogIHRbMjY1XSA9IDI4MDsKICB0WzI2Nl0gPSAyODE7CiAgdFsyNjddID0gMjgyOwogIHRbMjY4XSA9IDI4MzsKICB0WzI2OV0gPSAzMTM7CiAgdFsyNzVdID0gMzIzOwogIHRbMjc2XSA9IDMyNDsKICB0WzI3OF0gPSAzMjg7CiAgdFsyODNdID0gMzQ0OwogIHRbMjg0XSA9IDM0NTsKICB0WzI4NV0gPSAzNDY7CiAgdFsyODZdID0gMzQ3OwogIHRbMjkyXSA9IDM2NzsKICB0WzI5NV0gPSAzNzc7CiAgdFsyOTZdID0gMzc4OwogIHRbMjk4XSA9IDM4MDsKICB0WzMwNV0gPSA5NjM7CiAgdFszMDZdID0gOTY0OwogIHRbMzA3XSA9IDk2NjsKICB0WzMwOF0gPSA4MjE1OwogIHRbMzA5XSA9IDgyNTI7CiAgdFszMTBdID0gODMxOTsKICB0WzMxMV0gPSA4MzU5OwogIHRbMzEyXSA9IDg1OTI7CiAgdFszMTNdID0gODU5MzsKICB0WzMzN10gPSA5NTUyOwogIHRbNDkzXSA9IDEwMzk7CiAgdFs0OTRdID0gMTA0MDsKICB0WzU3MF0gPSAxMDQwOwogIHRbNTcxXSA9IDEwNDE7CiAgdFs1NzJdID0gMTA0MjsKICB0WzU3M10gPSAxMDQzOwogIHRbNTc0XSA9IDEwNDQ7CiAgdFs1NzVdID0gMTA0NTsKICB0WzU3Nl0gPSAxMDQ2OwogIHRbNTc3XSA9IDEwNDc7CiAgdFs1NzhdID0gMTA0ODsKICB0WzU3OV0gPSAxMDQ5OwogIHRbNTgwXSA9IDEwNTA7CiAgdFs1ODFdID0gMTA1MTsKICB0WzU4Ml0gPSAxMDUyOwogIHRbNTgzXSA9IDEwNTM7CiAgdFs1ODRdID0gMTA1NDsKICB0WzU4NV0gPSAxMDU1OwogIHRbNTg2XSA9IDEwNTY7CiAgdFs1ODddID0gMTA1NzsKICB0WzU4OF0gPSAxMDU4OwogIHRbNTg5XSA9IDEwNTk7CiAgdFs1OTBdID0gMTA2MDsKICB0WzU5MV0gPSAxMDYxOwogIHRbNTkyXSA9IDEwNjI7CiAgdFs1OTNdID0gMTA2MzsKICB0WzU5NF0gPSAxMDY0OwogIHRbNTk1XSA9IDEwNjU7CiAgdFs1OTZdID0gMTA2NjsKICB0WzU5N10gPSAxMDY3OwogIHRbNTk4XSA9IDEwNjg7CiAgdFs1OTldID0gMTA2OTsKICB0WzYwMF0gPSAxMDcwOwogIHRbNjcyXSA9IDE0ODg7CiAgdFs2NzNdID0gMTQ4OTsKICB0WzY3NF0gPSAxNDkwOwogIHRbNjc1XSA9IDE0OTE7CiAgdFs2NzZdID0gMTQ5MjsKICB0WzY3N10gPSAxNDkzOwogIHRbNjc4XSA9IDE0OTQ7CiAgdFs2NzldID0gMTQ5NTsKICB0WzY4MF0gPSAxNDk2OwogIHRbNjgxXSA9IDE0OTc7CiAgdFs2ODJdID0gMTQ5ODsKICB0WzY4M10gPSAxNDk5OwogIHRbNjg0XSA9IDE1MDA7CiAgdFs2ODVdID0gMTUwMTsKICB0WzY4Nl0gPSAxNTAyOwogIHRbNjg3XSA9IDE1MDM7CiAgdFs2ODhdID0gMTUwNDsKICB0WzY4OV0gPSAxNTA1OwogIHRbNjkwXSA9IDE1MDY7CiAgdFs2OTFdID0gMTUwNzsKICB0WzY5Ml0gPSAxNTA4OwogIHRbNjkzXSA9IDE1MDk7CiAgdFs2OTRdID0gMTUxMDsKICB0WzY5NV0gPSAxNTExOwogIHRbNjk2XSA9IDE1MTI7CiAgdFs2OTddID0gMTUxMzsKICB0WzY5OF0gPSAxNTE0OwogIHRbNzA1XSA9IDE1MjQ7CiAgdFs3MDZdID0gODM2MjsKICB0WzcxMF0gPSA2NDI4ODsKICB0WzcxMV0gPSA2NDI5ODsKICB0Wzc1OV0gPSAxNjE3OwogIHRbNzYxXSA9IDE3NzY7CiAgdFs3NjNdID0gMTc3ODsKICB0Wzc3NV0gPSAxNjUyOwogIHRbNzc3XSA9IDE3NjQ7CiAgdFs3NzhdID0gMTc4MDsKICB0Wzc3OV0gPSAxNzgxOwogIHRbNzgwXSA9IDE3ODI7CiAgdFs3ODJdID0gNzcxOwogIHRbNzgzXSA9IDY0NzI2OwogIHRbNzg2XSA9IDgzNjM7CiAgdFs3ODhdID0gODUzMjsKICB0Wzc5MF0gPSA3Njg7CiAgdFs3OTFdID0gNzY5OwogIHRbNzkyXSA9IDc2ODsKICB0Wzc5NV0gPSA4MDM7CiAgdFs3OTddID0gNjQzMzY7CiAgdFs3OThdID0gNjQzMzc7CiAgdFs3OTldID0gNjQzNDI7CiAgdFs4MDBdID0gNjQzNDM7CiAgdFs4MDFdID0gNjQzNDQ7CiAgdFs4MDJdID0gNjQzNDU7CiAgdFs4MDNdID0gNjQzNjI7CiAgdFs4MDRdID0gNjQzNjM7CiAgdFs4MDVdID0gNjQzNjQ7CiAgdFsyNDI0XSA9IDc4MjE7CiAgdFsyNDI1XSA9IDc4MjI7CiAgdFsyNDI2XSA9IDc4MjM7CiAgdFsyNDI3XSA9IDc4MjQ7CiAgdFsyNDI4XSA9IDc4MjU7CiAgdFsyNDI5XSA9IDc4MjY7CiAgdFsyNDMwXSA9IDc4Mjc7CiAgdFsyNDMzXSA9IDc2ODI7CiAgdFsyNjc4XSA9IDgwNDU7CiAgdFsyNjc5XSA9IDgwNDY7CiAgdFsyODMwXSA9IDE1NTI7CiAgdFsyODM4XSA9IDY4NjsKICB0WzI4NDBdID0gNzUxOwogIHRbMjg0Ml0gPSA3NTM7CiAgdFsyODQzXSA9IDc1NDsKICB0WzI4NDRdID0gNzU1OwogIHRbMjg0Nl0gPSA3NTc7CiAgdFsyODU2XSA9IDc2NzsKICB0WzI4NTddID0gODQ4OwogIHRbMjg1OF0gPSA4NDk7CiAgdFsyODYyXSA9IDg1MzsKICB0WzI4NjNdID0gODU0OwogIHRbMjg2NF0gPSA4NTU7CiAgdFsyODY1XSA9IDg2MTsKICB0WzI4NjZdID0gODYyOwogIHRbMjkwNl0gPSA3NDYwOwogIHRbMjkwOF0gPSA3NDYyOwogIHRbMjkwOV0gPSA3NDYzOwogIHRbMjkxMF0gPSA3NDY0OwogIHRbMjkxMl0gPSA3NDY2OwogIHRbMjkxM10gPSA3NDY3OwogIHRbMjkxNF0gPSA3NDY4OwogIHRbMjkxNl0gPSA3NDcwOwogIHRbMjkxN10gPSA3NDcxOwogIHRbMjkxOF0gPSA3NDcyOwogIHRbMjkyMF0gPSA3NDc0OwogIHRbMjkyMV0gPSA3NDc1OwogIHRbMjkyMl0gPSA3NDc2OwogIHRbMjkyNF0gPSA3NDc4OwogIHRbMjkyNV0gPSA3NDc5OwogIHRbMjkyNl0gPSA3NDgwOwogIHRbMjkyOF0gPSA3NDgyOwogIHRbMjkyOV0gPSA3NDgzOwogIHRbMjkzMF0gPSA3NDg0OwogIHRbMjkzMl0gPSA3NDg2OwogIHRbMjkzM10gPSA3NDg3OwogIHRbMjkzNF0gPSA3NDg4OwogIHRbMjkzNl0gPSA3NDkwOwogIHRbMjkzN10gPSA3NDkxOwogIHRbMjkzOF0gPSA3NDkyOwogIHRbMjk0MF0gPSA3NDk0OwogIHRbMjk0MV0gPSA3NDk1OwogIHRbMjk0Ml0gPSA3NDk2OwogIHRbMjk0NF0gPSA3NDk4OwogIHRbMjk0Nl0gPSA3NTAwOwogIHRbMjk0OF0gPSA3NTAyOwogIHRbMjk1MF0gPSA3NTA0OwogIHRbMjk1MV0gPSA3NTA1OwogIHRbMjk1Ml0gPSA3NTA2OwogIHRbMjk1NF0gPSA3NTA4OwogIHRbMjk1NV0gPSA3NTA5OwogIHRbMjk1Nl0gPSA3NTEwOwogIHRbMjk1OF0gPSA3NTEyOwogIHRbMjk1OV0gPSA3NTEzOwogIHRbMjk2MF0gPSA3NTE0OwogIHRbMjk2Ml0gPSA3NTE2OwogIHRbMjk2M10gPSA3NTE3OwogIHRbMjk2NF0gPSA3NTE4OwogIHRbMjk2Nl0gPSA3NTIwOwogIHRbMjk2N10gPSA3NTIxOwogIHRbMjk2OF0gPSA3NTIyOwogIHRbMjk3MF0gPSA3NTI0OwogIHRbMjk3MV0gPSA3NTI1OwogIHRbMjk3Ml0gPSA3NTI2OwogIHRbMjk3NF0gPSA3NTI4OwogIHRbMjk3NV0gPSA3NTI5OwogIHRbMjk3Nl0gPSA3NTMwOwogIHRbMjk3OF0gPSAxNTM3OwogIHRbMjk3OV0gPSAxNTM4OwogIHRbMjk4MF0gPSAxNTM5OwogIHRbMjk4Ml0gPSAxNTQ5OwogIHRbMjk4M10gPSAxNTUxOwogIHRbMjk4NF0gPSAxNTUyOwogIHRbMjk4Nl0gPSAxNTU0OwogIHRbMjk4N10gPSAxNTU1OwogIHRbMjk4OF0gPSAxNTU2OwogIHRbMjk5MF0gPSAxNjIzOwogIHRbMjk5MV0gPSAxNjI0OwogIHRbMjk5NV0gPSAxNzc1OwogIHRbMjk5OV0gPSAxNzkxOwogIHRbMzAwMl0gPSA2NDI5MDsKICB0WzMwMDNdID0gNjQyOTE7CiAgdFszMDA0XSA9IDY0MjkyOwogIHRbMzAwNl0gPSA2NDI5NDsKICB0WzMwMDddID0gNjQyOTU7CiAgdFszMDA4XSA9IDY0Mjk2OwogIHRbMzAxMV0gPSAxOTAwOwogIHRbMzAxNF0gPSA4MjIzOwogIHRbMzAxNV0gPSA4MjQ0OwogIHRbMzAxN10gPSA3NTMyOwogIHRbMzAxOF0gPSA3NTMzOwogIHRbMzAxOV0gPSA3NTM0OwogIHRbMzA3NV0gPSA3NTkwOwogIHRbMzA3Nl0gPSA3NTkxOwogIHRbMzA3OV0gPSA3NTk0OwogIHRbMzA4MF0gPSA3NTk1OwogIHRbMzA4M10gPSA3NTk4OwogIHRbMzA4NF0gPSA3NTk5OwogIHRbMzA4N10gPSA3NjAyOwogIHRbMzA4OF0gPSA3NjAzOwogIHRbMzA5MV0gPSA3NjA2OwogIHRbMzA5Ml0gPSA3NjA3OwogIHRbMzA5NV0gPSA3NjEwOwogIHRbMzA5Nl0gPSA3NjExOwogIHRbMzA5OV0gPSA3NjE0OwogIHRbMzEwMF0gPSA3NjE1OwogIHRbMzEwM10gPSA3NjE4OwogIHRbMzEwNF0gPSA3NjE5OwogIHRbMzEwN10gPSA4MzM3OwogIHRbMzEwOF0gPSA4MzM4OwogIHRbMzExNl0gPSAxODg0OwogIHRbMzExOV0gPSAxODg1OwogIHRbMzEyMF0gPSAxODg1OwogIHRbMzEyM10gPSAxODg2OwogIHRbMzEyNF0gPSAxODg2OwogIHRbMzEyN10gPSAxODg3OwogIHRbMzEyOF0gPSAxODg3OwogIHRbMzEzMV0gPSAxODg4OwogIHRbMzEzMl0gPSAxODg4OwogIHRbMzEzNV0gPSAxODg5OwogIHRbMzEzNl0gPSAxODg5OwogIHRbMzEzOV0gPSAxODkwOwogIHRbMzE0MF0gPSAxODkwOwogIHRbMzE0M10gPSAxODkxOwogIHRbMzE0NF0gPSAxODkxOwogIHRbMzE0N10gPSAxODkyOwogIHRbMzE0OF0gPSAxODkyOwogIHRbMzE1M10gPSA1ODA7CiAgdFszMTU0XSA9IDU4MTsKICB0WzMxNTddID0gNTg0OwogIHRbMzE1OF0gPSA1ODU7CiAgdFszMTYxXSA9IDU4ODsKICB0WzMxNjJdID0gNTg5OwogIHRbMzE2NV0gPSA4OTE7CiAgdFszMTY2XSA9IDg5MjsKICB0WzMxNjldID0gMTI3NDsKICB0WzMxNzBdID0gMTI3NTsKICB0WzMxNzNdID0gMTI3ODsKICB0WzMxNzRdID0gMTI3OTsKICB0WzMxODFdID0gNzYyMjsKICB0WzMxODJdID0gNzYyMzsKICB0WzMyODJdID0gMTE3OTk7CiAgdFszMzE2XSA9IDU3ODsKICB0WzMzNzldID0gNDI3ODU7CiAgdFszMzkzXSA9IDExNTk7CiAgdFszNDE2XSA9IDgzNzc7Cn0pOwpjb25zdCBnZXRTdXBwbGVtZW50YWxHbHlwaE1hcEZvckFyaWFsQmxhY2sgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICB0WzIyN10gPSAzMjI7CiAgdFsyNjRdID0gMjYxOwogIHRbMjkxXSA9IDM0NjsKfSk7CmNvbnN0IGdldFN1cHBsZW1lbnRhbEdseXBoTWFwRm9yQ2FsaWJyaSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHRbMV0gPSAzMjsKICB0WzRdID0gNjU7CiAgdFs1XSA9IDE5MjsKICB0WzZdID0gMTkzOwogIHRbOV0gPSAxOTY7CiAgdFsxN10gPSA2NjsKICB0WzE4XSA9IDY3OwogIHRbMjFdID0gMjY4OwogIHRbMjRdID0gNjg7CiAgdFsyOF0gPSA2OTsKICB0WzI5XSA9IDIwMDsKICB0WzMwXSA9IDIwMTsKICB0WzMyXSA9IDI4MjsKICB0WzM4XSA9IDcwOwogIHRbMzldID0gNzE7CiAgdFs0NF0gPSA3MjsKICB0WzQ3XSA9IDczOwogIHRbNDhdID0gMjA0OwogIHRbNDldID0gMjA1OwogIHRbNThdID0gNzQ7CiAgdFs2MF0gPSA3NTsKICB0WzYyXSA9IDc2OwogIHRbNjhdID0gNzc7CiAgdFs2OV0gPSA3ODsKICB0Wzc1XSA9IDc5OwogIHRbNzZdID0gMjEwOwogIHRbODBdID0gMjE0OwogIHRbODddID0gODA7CiAgdFs4OV0gPSA4MTsKICB0WzkwXSA9IDgyOwogIHRbOTJdID0gMzQ0OwogIHRbOTRdID0gODM7CiAgdFs5N10gPSAzNTI7CiAgdFsxMDBdID0gODQ7CiAgdFsxMDRdID0gODU7CiAgdFsxMDldID0gMjIwOwogIHRbMTE1XSA9IDg2OwogIHRbMTE2XSA9IDg3OwogIHRbMTIxXSA9IDg4OwogIHRbMTIyXSA9IDg5OwogIHRbMTI0XSA9IDIyMTsKICB0WzEyN10gPSA5MDsKICB0WzEyOV0gPSAzODE7CiAgdFsyNThdID0gOTc7CiAgdFsyNTldID0gMjI0OwogIHRbMjYwXSA9IDIyNTsKICB0WzI2M10gPSAyMjg7CiAgdFsyNjhdID0gMjYxOwogIHRbMjcxXSA9IDk4OwogIHRbMjcyXSA9IDk5OwogIHRbMjczXSA9IDI2MzsKICB0WzI3NV0gPSAyNjk7CiAgdFsyODJdID0gMTAwOwogIHRbMjg2XSA9IDEwMTsKICB0WzI4N10gPSAyMzI7CiAgdFsyODhdID0gMjMzOwogIHRbMjkwXSA9IDI4MzsKICB0WzI5NV0gPSAyODE7CiAgdFsyOTZdID0gMTAyOwogIHRbMzM2XSA9IDEwMzsKICB0WzM0Nl0gPSAxMDQ7CiAgdFszNDldID0gMTA1OwogIHRbMzUwXSA9IDIzNjsKICB0WzM1MV0gPSAyMzc7CiAgdFszNjFdID0gMTA2OwogIHRbMzY0XSA9IDEwNzsKICB0WzM2N10gPSAxMDg7CiAgdFszNzFdID0gMzIyOwogIHRbMzczXSA9IDEwOTsKICB0WzM3NF0gPSAxMTA7CiAgdFszODFdID0gMTExOwogIHRbMzgyXSA9IDI0MjsKICB0WzM4M10gPSAyNDM7CiAgdFszODZdID0gMjQ2OwogIHRbMzkzXSA9IDExMjsKICB0WzM5NV0gPSAxMTM7CiAgdFszOTZdID0gMTE0OwogIHRbMzk4XSA9IDM0NTsKICB0WzQwMF0gPSAxMTU7CiAgdFs0MDFdID0gMzQ3OwogIHRbNDAzXSA9IDM1MzsKICB0WzQxMF0gPSAxMTY7CiAgdFs0MzddID0gMTE3OwogIHRbNDQyXSA9IDI1MjsKICB0WzQ0OF0gPSAxMTg7CiAgdFs0NDldID0gMTE5OwogIHRbNDU0XSA9IDEyMDsKICB0WzQ1NV0gPSAxMjE7CiAgdFs0NTddID0gMjUzOwogIHRbNDYwXSA9IDEyMjsKICB0WzQ2Ml0gPSAzODI7CiAgdFs0NjNdID0gMzgwOwogIHRbODUzXSA9IDQ0OwogIHRbODU1XSA9IDU4OwogIHRbODU2XSA9IDQ2OwogIHRbODc2XSA9IDQ3OwogIHRbODc4XSA9IDQ1OwogIHRbODgyXSA9IDQ1OwogIHRbODk0XSA9IDQwOwogIHRbODk1XSA9IDQxOwogIHRbODk2XSA9IDkxOwogIHRbODk3XSA9IDkzOwogIHRbOTIzXSA9IDY0OwogIHRbOTQwXSA9IDE2MzsKICB0WzEwMDRdID0gNDg7CiAgdFsxMDA1XSA9IDQ5OwogIHRbMTAwNl0gPSA1MDsKICB0WzEwMDddID0gNTE7CiAgdFsxMDA4XSA9IDUyOwogIHRbMTAwOV0gPSA1MzsKICB0WzEwMTBdID0gNTQ7CiAgdFsxMDExXSA9IDU1OwogIHRbMTAxMl0gPSA1NjsKICB0WzEwMTNdID0gNTc7CiAgdFsxMDgxXSA9IDM3OwogIHRbMTA4NV0gPSA0MzsKICB0WzEwODZdID0gNDU7Cn0pOwpmdW5jdGlvbiBnZXRTdGFuZGFyZEZvbnROYW1lKG5hbWUpIHsKICBjb25zdCBmb250TmFtZSA9IG5vcm1hbGl6ZUZvbnROYW1lKG5hbWUpOwogIGNvbnN0IHN0ZEZvbnRNYXAgPSBnZXRTdGRGb250TWFwKCk7CiAgcmV0dXJuIHN0ZEZvbnRNYXBbZm9udE5hbWVdOwp9CmZ1bmN0aW9uIGlzS25vd25Gb250TmFtZShuYW1lKSB7CiAgY29uc3QgZm9udE5hbWUgPSBub3JtYWxpemVGb250TmFtZShuYW1lKTsKICByZXR1cm4gISEoZ2V0U3RkRm9udE1hcCgpW2ZvbnROYW1lXSB8fCBnZXROb25TdGRGb250TWFwKClbZm9udE5hbWVdIHx8IGdldFNlcmlmRm9udHMoKVtmb250TmFtZV0gfHwgZ2V0U3ltYm9sc0ZvbnRzKClbZm9udE5hbWVdKTsKfQoKOy8vIC4vc3JjL2NvcmUvdG9fdW5pY29kZV9tYXAuanMKCmNsYXNzIFRvVW5pY29kZU1hcCB7CiAgY29uc3RydWN0b3IoY21hcCA9IFtdKSB7CiAgICB0aGlzLl9tYXAgPSBjbWFwOwogIH0KICBnZXQgbGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuX21hcC5sZW5ndGg7CiAgfQogIGZvckVhY2goY2FsbGJhY2spIHsKICAgIGZvciAoY29uc3QgY2hhckNvZGUgaW4gdGhpcy5fbWFwKSB7CiAgICAgIGNhbGxiYWNrKGNoYXJDb2RlLCB0aGlzLl9tYXBbY2hhckNvZGVdLmNvZGVQb2ludEF0KDApKTsKICAgIH0KICB9CiAgaGFzKGkpIHsKICAgIHJldHVybiB0aGlzLl9tYXBbaV0gIT09IHVuZGVmaW5lZDsKICB9CiAgZ2V0KGkpIHsKICAgIHJldHVybiB0aGlzLl9tYXBbaV07CiAgfQogIGNoYXJDb2RlT2YodmFsdWUpIHsKICAgIGNvbnN0IG1hcCA9IHRoaXMuX21hcDsKICAgIGlmIChtYXAubGVuZ3RoIDw9IDB4MTAwMDApIHsKICAgICAgcmV0dXJuIG1hcC5pbmRleE9mKHZhbHVlKTsKICAgIH0KICAgIGZvciAoY29uc3QgY2hhckNvZGUgaW4gbWFwKSB7CiAgICAgIGlmIChtYXBbY2hhckNvZGVdID09PSB2YWx1ZSkgewogICAgICAgIHJldHVybiBjaGFyQ29kZSB8IDA7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAtMTsKICB9CiAgYW1lbmQobWFwKSB7CiAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIG1hcCkgewogICAgICB0aGlzLl9tYXBbY2hhckNvZGVdID0gbWFwW2NoYXJDb2RlXTsKICAgIH0KICB9Cn0KY2xhc3MgSWRlbnRpdHlUb1VuaWNvZGVNYXAgewogIGNvbnN0cnVjdG9yKGZpcnN0Q2hhciwgbGFzdENoYXIpIHsKICAgIHRoaXMuZmlyc3RDaGFyID0gZmlyc3RDaGFyOwogICAgdGhpcy5sYXN0Q2hhciA9IGxhc3RDaGFyOwogIH0KICBnZXQgbGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMubGFzdENoYXIgKyAxIC0gdGhpcy5maXJzdENoYXI7CiAgfQogIGZvckVhY2goY2FsbGJhY2spIHsKICAgIGZvciAobGV0IGkgPSB0aGlzLmZpcnN0Q2hhciwgaWkgPSB0aGlzLmxhc3RDaGFyOyBpIDw9IGlpOyBpKyspIHsKICAgICAgY2FsbGJhY2soaSwgaSk7CiAgICB9CiAgfQogIGhhcyhpKSB7CiAgICByZXR1cm4gdGhpcy5maXJzdENoYXIgPD0gaSAmJiBpIDw9IHRoaXMubGFzdENoYXI7CiAgfQogIGdldChpKSB7CiAgICBpZiAodGhpcy5maXJzdENoYXIgPD0gaSAmJiBpIDw9IHRoaXMubGFzdENoYXIpIHsKICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoaSk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBjaGFyQ29kZU9mKHYpIHsKICAgIHJldHVybiBOdW1iZXIuaXNJbnRlZ2VyKHYpICYmIHYgPj0gdGhpcy5maXJzdENoYXIgJiYgdiA8PSB0aGlzLmxhc3RDaGFyID8gdiA6IC0xOwogIH0KICBhbWVuZChtYXApIHsKICAgIHVucmVhY2hhYmxlKCJTaG91bGQgbm90IGNhbGwgYW1lbmQoKSIpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY2ZmX2ZvbnQuanMKCgoKY2xhc3MgQ0ZGRm9udCB7CiAgY29uc3RydWN0b3IoZmlsZSwgcHJvcGVydGllcykgewogICAgdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllczsKICAgIGNvbnN0IHBhcnNlciA9IG5ldyBDRkZQYXJzZXIoZmlsZSwgcHJvcGVydGllcywgU0VBQ19BTkFMWVNJU19FTkFCTEVEKTsKICAgIHRoaXMuY2ZmID0gcGFyc2VyLnBhcnNlKCk7CiAgICB0aGlzLmNmZi5kdXBsaWNhdGVGaXJzdEdseXBoKCk7CiAgICBjb25zdCBjb21waWxlciA9IG5ldyBDRkZDb21waWxlcih0aGlzLmNmZik7CiAgICB0aGlzLnNlYWNzID0gdGhpcy5jZmYuc2VhY3M7CiAgICB0cnkgewogICAgICB0aGlzLmRhdGEgPSBjb21waWxlci5jb21waWxlKCk7CiAgICB9IGNhdGNoIHsKICAgICAgd2FybigiRmFpbGVkIHRvIGNvbXBpbGUgZm9udCAiICsgcHJvcGVydGllcy5sb2FkZWROYW1lKTsKICAgICAgdGhpcy5kYXRhID0gZmlsZTsKICAgIH0KICAgIHRoaXMuX2NyZWF0ZUJ1aWx0SW5FbmNvZGluZygpOwogIH0KICBnZXQgbnVtR2x5cGhzKCkgewogICAgcmV0dXJuIHRoaXMuY2ZmLmNoYXJTdHJpbmdzLmNvdW50OwogIH0KICBnZXRDaGFyc2V0KCkgewogICAgcmV0dXJuIHRoaXMuY2ZmLmNoYXJzZXQuY2hhcnNldDsKICB9CiAgZ2V0R2x5cGhNYXBwaW5nKCkgewogICAgY29uc3QgY2ZmID0gdGhpcy5jZmY7CiAgICBjb25zdCBwcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzOwogICAgY29uc3QgewogICAgICBjaWRUb0dpZE1hcCwKICAgICAgY01hcAogICAgfSA9IHByb3BlcnRpZXM7CiAgICBjb25zdCBjaGFyc2V0cyA9IGNmZi5jaGFyc2V0LmNoYXJzZXQ7CiAgICBsZXQgY2hhckNvZGVUb0dseXBoSWQ7CiAgICBsZXQgZ2x5cGhJZDsKICAgIGlmIChwcm9wZXJ0aWVzLmNvbXBvc2l0ZSkgewogICAgICBsZXQgaW52Q2lkVG9HaWRNYXA7CiAgICAgIGlmIChjaWRUb0dpZE1hcD8ubGVuZ3RoID4gMCkgewogICAgICAgIGludkNpZFRvR2lkTWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjaWRUb0dpZE1hcC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBnaWQgPSBjaWRUb0dpZE1hcFtpXTsKICAgICAgICAgIGlmIChnaWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpbnZDaWRUb0dpZE1hcFtnaWRdID0gaTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgY2hhckNvZGVUb0dseXBoSWQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBsZXQgY2hhckNvZGU7CiAgICAgIGlmIChjZmYuaXNDSURGb250KSB7CiAgICAgICAgZm9yIChnbHlwaElkID0gMDsgZ2x5cGhJZCA8IGNoYXJzZXRzLmxlbmd0aDsgZ2x5cGhJZCsrKSB7CiAgICAgICAgICBjb25zdCBjaWQgPSBjaGFyc2V0c1tnbHlwaElkXTsKICAgICAgICAgIGNoYXJDb2RlID0gY01hcC5jaGFyQ29kZU9mKGNpZCk7CiAgICAgICAgICBpZiAoaW52Q2lkVG9HaWRNYXA/LltjaGFyQ29kZV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjaGFyQ29kZSA9IGludkNpZFRvR2lkTWFwW2NoYXJDb2RlXTsKICAgICAgICAgIH0KICAgICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IGdseXBoSWQ7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAoZ2x5cGhJZCA9IDA7IGdseXBoSWQgPCBjZmYuY2hhclN0cmluZ3MuY291bnQ7IGdseXBoSWQrKykgewogICAgICAgICAgY2hhckNvZGUgPSBjTWFwLmNoYXJDb2RlT2YoZ2x5cGhJZCk7CiAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gY2hhckNvZGVUb0dseXBoSWQ7CiAgICB9CiAgICBsZXQgZW5jb2RpbmcgPSBjZmYuZW5jb2RpbmcgPyBjZmYuZW5jb2RpbmcuZW5jb2RpbmcgOiBudWxsOwogICAgaWYgKHByb3BlcnRpZXMuaXNJbnRlcm5hbEZvbnQpIHsKICAgICAgZW5jb2RpbmcgPSBwcm9wZXJ0aWVzLmRlZmF1bHRFbmNvZGluZzsKICAgIH0KICAgIGNoYXJDb2RlVG9HbHlwaElkID0gdHlwZTFGb250R2x5cGhNYXBwaW5nKHByb3BlcnRpZXMsIGVuY29kaW5nLCBjaGFyc2V0cyk7CiAgICByZXR1cm4gY2hhckNvZGVUb0dseXBoSWQ7CiAgfQogIGhhc0dseXBoSWQoaWQpIHsKICAgIHJldHVybiB0aGlzLmNmZi5oYXNHbHlwaElkKGlkKTsKICB9CiAgX2NyZWF0ZUJ1aWx0SW5FbmNvZGluZygpIHsKICAgIGNvbnN0IHsKICAgICAgY2hhcnNldCwKICAgICAgZW5jb2RpbmcKICAgIH0gPSB0aGlzLmNmZjsKICAgIGlmICghY2hhcnNldCB8fCAhZW5jb2RpbmcpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgY2hhcnNldHMgPSBjaGFyc2V0LmNoYXJzZXQsCiAgICAgIGVuY29kaW5ncyA9IGVuY29kaW5nLmVuY29kaW5nOwogICAgY29uc3QgbWFwID0gW107CiAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIGVuY29kaW5ncykgewogICAgICBjb25zdCBnbHlwaElkID0gZW5jb2RpbmdzW2NoYXJDb2RlXTsKICAgICAgaWYgKGdseXBoSWQgPj0gMCkgewogICAgICAgIGNvbnN0IGdseXBoTmFtZSA9IGNoYXJzZXRzW2dseXBoSWRdOwogICAgICAgIGlmIChnbHlwaE5hbWUpIHsKICAgICAgICAgIG1hcFtjaGFyQ29kZV0gPSBnbHlwaE5hbWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAobWFwLmxlbmd0aCA+IDApIHsKICAgICAgdGhpcy5wcm9wZXJ0aWVzLmJ1aWx0SW5FbmNvZGluZyA9IG1hcDsKICAgIH0KICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2ZvbnRfcmVuZGVyZXIuanMKCgoKCgoKZnVuY3Rpb24gZ2V0RmxvYXQyMTQoZGF0YSwgb2Zmc2V0KSB7CiAgcmV0dXJuIHJlYWRJbnQxNihkYXRhLCBvZmZzZXQpIC8gMTYzODQ7Cn0KZnVuY3Rpb24gZ2V0U3Vicm91dGluZUJpYXMoc3VicnMpIHsKICBjb25zdCBudW1TdWJycyA9IHN1YnJzLmxlbmd0aDsKICBsZXQgYmlhcyA9IDMyNzY4OwogIGlmIChudW1TdWJycyA8IDEyNDApIHsKICAgIGJpYXMgPSAxMDc7CiAgfSBlbHNlIGlmIChudW1TdWJycyA8IDMzOTAwKSB7CiAgICBiaWFzID0gMTEzMTsKICB9CiAgcmV0dXJuIGJpYXM7Cn0KZnVuY3Rpb24gcGFyc2VDbWFwKGRhdGEsIHN0YXJ0LCBlbmQpIHsKICBjb25zdCBvZmZzZXQgPSByZWFkVWludDE2KGRhdGEsIHN0YXJ0ICsgMikgPT09IDEgPyByZWFkVWludDMyKGRhdGEsIHN0YXJ0ICsgOCkgOiByZWFkVWludDMyKGRhdGEsIHN0YXJ0ICsgMTYpOwogIGNvbnN0IGZvcm1hdCA9IHJlYWRVaW50MTYoZGF0YSwgc3RhcnQgKyBvZmZzZXQpOwogIGxldCByYW5nZXMsIHAsIGk7CiAgaWYgKGZvcm1hdCA9PT0gNCkgewogICAgcmVhZFVpbnQxNihkYXRhLCBzdGFydCArIG9mZnNldCArIDIpOwogICAgY29uc3Qgc2VnQ291bnQgPSByZWFkVWludDE2KGRhdGEsIHN0YXJ0ICsgb2Zmc2V0ICsgNikgPj4gMTsKICAgIHAgPSBzdGFydCArIG9mZnNldCArIDE0OwogICAgcmFuZ2VzID0gW107CiAgICBmb3IgKGkgPSAwOyBpIDwgc2VnQ291bnQ7IGkrKywgcCArPSAyKSB7CiAgICAgIHJhbmdlc1tpXSA9IHsKICAgICAgICBlbmQ6IHJlYWRVaW50MTYoZGF0YSwgcCkKICAgICAgfTsKICAgIH0KICAgIHAgKz0gMjsKICAgIGZvciAoaSA9IDA7IGkgPCBzZWdDb3VudDsgaSsrLCBwICs9IDIpIHsKICAgICAgcmFuZ2VzW2ldLnN0YXJ0ID0gcmVhZFVpbnQxNihkYXRhLCBwKTsKICAgIH0KICAgIGZvciAoaSA9IDA7IGkgPCBzZWdDb3VudDsgaSsrLCBwICs9IDIpIHsKICAgICAgcmFuZ2VzW2ldLmlkRGVsdGEgPSByZWFkVWludDE2KGRhdGEsIHApOwogICAgfQogICAgZm9yIChpID0gMDsgaSA8IHNlZ0NvdW50OyBpKyssIHAgKz0gMikgewogICAgICBsZXQgaWRPZmZzZXQgPSByZWFkVWludDE2KGRhdGEsIHApOwogICAgICBpZiAoaWRPZmZzZXQgPT09IDApIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICByYW5nZXNbaV0uaWRzID0gW107CiAgICAgIGZvciAobGV0IGogPSAwLCBqaiA9IHJhbmdlc1tpXS5lbmQgLSByYW5nZXNbaV0uc3RhcnQgKyAxOyBqIDwgamo7IGorKykgewogICAgICAgIHJhbmdlc1tpXS5pZHNbal0gPSByZWFkVWludDE2KGRhdGEsIHAgKyBpZE9mZnNldCk7CiAgICAgICAgaWRPZmZzZXQgKz0gMjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJhbmdlczsKICB9IGVsc2UgaWYgKGZvcm1hdCA9PT0gMTIpIHsKICAgIGNvbnN0IGdyb3VwcyA9IHJlYWRVaW50MzIoZGF0YSwgc3RhcnQgKyBvZmZzZXQgKyAxMik7CiAgICBwID0gc3RhcnQgKyBvZmZzZXQgKyAxNjsKICAgIHJhbmdlcyA9IFtdOwogICAgZm9yIChpID0gMDsgaSA8IGdyb3VwczsgaSsrKSB7CiAgICAgIHN0YXJ0ID0gcmVhZFVpbnQzMihkYXRhLCBwKTsKICAgICAgcmFuZ2VzLnB1c2goewogICAgICAgIHN0YXJ0LAogICAgICAgIGVuZDogcmVhZFVpbnQzMihkYXRhLCBwICsgNCksCiAgICAgICAgaWREZWx0YTogcmVhZFVpbnQzMihkYXRhLCBwICsgOCkgLSBzdGFydAogICAgICB9KTsKICAgICAgcCArPSAxMjsKICAgIH0KICAgIHJldHVybiByYW5nZXM7CiAgfQogIHRocm93IG5ldyBGb3JtYXRFcnJvcihgdW5zdXBwb3J0ZWQgY21hcDogJHtmb3JtYXR9YCk7Cn0KZnVuY3Rpb24gcGFyc2VDZmYoZGF0YSwgc3RhcnQsIGVuZCwgc2VhY0FuYWx5c2lzRW5hYmxlZCkgewogIGNvbnN0IHByb3BlcnRpZXMgPSB7fTsKICBjb25zdCBwYXJzZXIgPSBuZXcgQ0ZGUGFyc2VyKG5ldyBTdHJlYW0oZGF0YSwgc3RhcnQsIGVuZCAtIHN0YXJ0KSwgcHJvcGVydGllcywgc2VhY0FuYWx5c2lzRW5hYmxlZCk7CiAgY29uc3QgY2ZmID0gcGFyc2VyLnBhcnNlKCk7CiAgcmV0dXJuIHsKICAgIGdseXBoczogY2ZmLmNoYXJTdHJpbmdzLm9iamVjdHMsCiAgICBzdWJyczogY2ZmLnRvcERpY3QucHJpdmF0ZURpY3Q/LnN1YnJzSW5kZXg/Lm9iamVjdHMsCiAgICBnc3VicnM6IGNmZi5nbG9iYWxTdWJySW5kZXg/Lm9iamVjdHMsCiAgICBpc0NGRkNJREZvbnQ6IGNmZi5pc0NJREZvbnQsCiAgICBmZFNlbGVjdDogY2ZmLmZkU2VsZWN0LAogICAgZmRBcnJheTogY2ZmLmZkQXJyYXkKICB9Owp9CmZ1bmN0aW9uIHBhcnNlR2x5ZlRhYmxlKGdseWYsIGxvY2EsIGlzR2x5cGhMb2NhdGlvbnNMb25nKSB7CiAgbGV0IGl0ZW1TaXplLCBpdGVtRGVjb2RlOwogIGlmIChpc0dseXBoTG9jYXRpb25zTG9uZykgewogICAgaXRlbVNpemUgPSA0OwogICAgaXRlbURlY29kZSA9IHJlYWRVaW50MzI7CiAgfSBlbHNlIHsKICAgIGl0ZW1TaXplID0gMjsKICAgIGl0ZW1EZWNvZGUgPSAoZGF0YSwgb2Zmc2V0KSA9PiAyICogcmVhZFVpbnQxNihkYXRhLCBvZmZzZXQpOwogIH0KICBjb25zdCBnbHlwaHMgPSBbXTsKICBsZXQgc3RhcnRPZmZzZXQgPSBpdGVtRGVjb2RlKGxvY2EsIDApOwogIGZvciAobGV0IGogPSBpdGVtU2l6ZTsgaiA8IGxvY2EubGVuZ3RoOyBqICs9IGl0ZW1TaXplKSB7CiAgICBjb25zdCBlbmRPZmZzZXQgPSBpdGVtRGVjb2RlKGxvY2EsIGopOwogICAgZ2x5cGhzLnB1c2goZ2x5Zi5zdWJhcnJheShzdGFydE9mZnNldCwgZW5kT2Zmc2V0KSk7CiAgICBzdGFydE9mZnNldCA9IGVuZE9mZnNldDsKICB9CiAgcmV0dXJuIGdseXBoczsKfQpmdW5jdGlvbiBsb29rdXBDbWFwKHJhbmdlcywgdW5pY29kZSkgewogIGNvbnN0IGNvZGUgPSB1bmljb2RlLmNvZGVQb2ludEF0KDApOwogIGxldCBnaWQgPSAwLAogICAgbCA9IDAsCiAgICByID0gcmFuZ2VzLmxlbmd0aCAtIDE7CiAgd2hpbGUgKGwgPCByKSB7CiAgICBjb25zdCBjID0gbCArIHIgKyAxID4+IDE7CiAgICBpZiAoY29kZSA8IHJhbmdlc1tjXS5zdGFydCkgewogICAgICByID0gYyAtIDE7CiAgICB9IGVsc2UgewogICAgICBsID0gYzsKICAgIH0KICB9CiAgaWYgKHJhbmdlc1tsXS5zdGFydCA8PSBjb2RlICYmIGNvZGUgPD0gcmFuZ2VzW2xdLmVuZCkgewogICAgZ2lkID0gcmFuZ2VzW2xdLmlkRGVsdGEgKyAocmFuZ2VzW2xdLmlkcyA/IHJhbmdlc1tsXS5pZHNbY29kZSAtIHJhbmdlc1tsXS5zdGFydF0gOiBjb2RlKSAmIDB4ZmZmZjsKICB9CiAgcmV0dXJuIHsKICAgIGNoYXJDb2RlOiBjb2RlLAogICAgZ2x5cGhJZDogZ2lkCiAgfTsKfQpmdW5jdGlvbiBjb21waWxlR2x5Zihjb2RlLCBjbWRzLCBmb250KSB7CiAgZnVuY3Rpb24gbW92ZVRvKHgsIHkpIHsKICAgIGlmIChmaXJzdFBvaW50KSB7CiAgICAgIGNtZHMuYWRkKCJMIiwgZmlyc3RQb2ludCk7CiAgICB9CiAgICBmaXJzdFBvaW50ID0gW3gsIHldOwogICAgY21kcy5hZGQoIk0iLCBbeCwgeV0pOwogIH0KICBmdW5jdGlvbiBsaW5lVG8oeCwgeSkgewogICAgY21kcy5hZGQoIkwiLCBbeCwgeV0pOwogIH0KICBmdW5jdGlvbiBxdWFkcmF0aWNDdXJ2ZVRvKHhhLCB5YSwgeCwgeSkgewogICAgY21kcy5hZGQoIlEiLCBbeGEsIHlhLCB4LCB5XSk7CiAgfQogIGxldCBpID0gMDsKICBjb25zdCBudW1iZXJPZkNvbnRvdXJzID0gcmVhZEludDE2KGNvZGUsIGkpOwogIGxldCBmbGFnczsKICBsZXQgZmlyc3RQb2ludCA9IG51bGw7CiAgbGV0IHggPSAwLAogICAgeSA9IDA7CiAgaSArPSAxMDsKICBpZiAobnVtYmVyT2ZDb250b3VycyA8IDApIHsKICAgIGRvIHsKICAgICAgZmxhZ3MgPSByZWFkVWludDE2KGNvZGUsIGkpOwogICAgICBjb25zdCBnbHlwaEluZGV4ID0gcmVhZFVpbnQxNihjb2RlLCBpICsgMik7CiAgICAgIGkgKz0gNDsKICAgICAgbGV0IGFyZzEsIGFyZzI7CiAgICAgIGlmIChmbGFncyAmIDB4MDEpIHsKICAgICAgICBpZiAoZmxhZ3MgJiAweDAyKSB7CiAgICAgICAgICBhcmcxID0gcmVhZEludDE2KGNvZGUsIGkpOwogICAgICAgICAgYXJnMiA9IHJlYWRJbnQxNihjb2RlLCBpICsgMik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFyZzEgPSByZWFkVWludDE2KGNvZGUsIGkpOwogICAgICAgICAgYXJnMiA9IHJlYWRVaW50MTYoY29kZSwgaSArIDIpOwogICAgICAgIH0KICAgICAgICBpICs9IDQ7CiAgICAgIH0gZWxzZSBpZiAoZmxhZ3MgJiAweDAyKSB7CiAgICAgICAgYXJnMSA9IHJlYWRJbnQ4KGNvZGUsIGkrKyk7CiAgICAgICAgYXJnMiA9IHJlYWRJbnQ4KGNvZGUsIGkrKyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYXJnMSA9IGNvZGVbaSsrXTsKICAgICAgICBhcmcyID0gY29kZVtpKytdOwogICAgICB9CiAgICAgIGlmIChmbGFncyAmIDB4MDIpIHsKICAgICAgICB4ID0gYXJnMTsKICAgICAgICB5ID0gYXJnMjsKICAgICAgfSBlbHNlIHsKICAgICAgICB4ID0gMDsKICAgICAgICB5ID0gMDsKICAgICAgfQogICAgICBsZXQgc2NhbGVYID0gMSwKICAgICAgICBzY2FsZVkgPSAxLAogICAgICAgIHNjYWxlMDEgPSAwLAogICAgICAgIHNjYWxlMTAgPSAwOwogICAgICBpZiAoZmxhZ3MgJiAweDA4KSB7CiAgICAgICAgc2NhbGVYID0gc2NhbGVZID0gZ2V0RmxvYXQyMTQoY29kZSwgaSk7CiAgICAgICAgaSArPSAyOwogICAgICB9IGVsc2UgaWYgKGZsYWdzICYgMHg0MCkgewogICAgICAgIHNjYWxlWCA9IGdldEZsb2F0MjE0KGNvZGUsIGkpOwogICAgICAgIHNjYWxlWSA9IGdldEZsb2F0MjE0KGNvZGUsIGkgKyAyKTsKICAgICAgICBpICs9IDQ7CiAgICAgIH0gZWxzZSBpZiAoZmxhZ3MgJiAweDgwKSB7CiAgICAgICAgc2NhbGVYID0gZ2V0RmxvYXQyMTQoY29kZSwgaSk7CiAgICAgICAgc2NhbGUwMSA9IGdldEZsb2F0MjE0KGNvZGUsIGkgKyAyKTsKICAgICAgICBzY2FsZTEwID0gZ2V0RmxvYXQyMTQoY29kZSwgaSArIDQpOwogICAgICAgIHNjYWxlWSA9IGdldEZsb2F0MjE0KGNvZGUsIGkgKyA2KTsKICAgICAgICBpICs9IDg7CiAgICAgIH0KICAgICAgY29uc3Qgc3ViZ2x5cGggPSBmb250LmdseXBoc1tnbHlwaEluZGV4XTsKICAgICAgaWYgKHN1YmdseXBoKSB7CiAgICAgICAgY21kcy5zYXZlKCk7CiAgICAgICAgY21kcy50cmFuc2Zvcm0oW3NjYWxlWCwgc2NhbGUwMSwgc2NhbGUxMCwgc2NhbGVZLCB4LCB5XSk7CiAgICAgICAgaWYgKCEoZmxhZ3MgJiAweDAyKSkge30KICAgICAgICBjb21waWxlR2x5ZihzdWJnbHlwaCwgY21kcywgZm9udCk7CiAgICAgICAgY21kcy5yZXN0b3JlKCk7CiAgICAgIH0KICAgIH0gd2hpbGUgKGZsYWdzICYgMHgyMCk7CiAgfSBlbHNlIHsKICAgIGNvbnN0IGVuZFB0c09mQ29udG91cnMgPSBbXTsKICAgIGxldCBqLCBqajsKICAgIGZvciAoaiA9IDA7IGogPCBudW1iZXJPZkNvbnRvdXJzOyBqKyspIHsKICAgICAgZW5kUHRzT2ZDb250b3Vycy5wdXNoKHJlYWRVaW50MTYoY29kZSwgaSkpOwogICAgICBpICs9IDI7CiAgICB9CiAgICBjb25zdCBpbnN0cnVjdGlvbkxlbmd0aCA9IHJlYWRVaW50MTYoY29kZSwgaSk7CiAgICBpICs9IDIgKyBpbnN0cnVjdGlvbkxlbmd0aDsKICAgIGNvbnN0IG51bWJlck9mUG9pbnRzID0gZW5kUHRzT2ZDb250b3Vycy5hdCgtMSkgKyAxOwogICAgY29uc3QgcG9pbnRzID0gW107CiAgICB3aGlsZSAocG9pbnRzLmxlbmd0aCA8IG51bWJlck9mUG9pbnRzKSB7CiAgICAgIGZsYWdzID0gY29kZVtpKytdOwogICAgICBsZXQgcmVwZWF0ID0gMTsKICAgICAgaWYgKGZsYWdzICYgMHgwOCkgewogICAgICAgIHJlcGVhdCArPSBjb2RlW2krK107CiAgICAgIH0KICAgICAgd2hpbGUgKHJlcGVhdC0tID4gMCkgewogICAgICAgIHBvaW50cy5wdXNoKHsKICAgICAgICAgIGZsYWdzCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIGZvciAoaiA9IDA7IGogPCBudW1iZXJPZlBvaW50czsgaisrKSB7CiAgICAgIHN3aXRjaCAocG9pbnRzW2pdLmZsYWdzICYgMHgxMikgewogICAgICAgIGNhc2UgMHgwMDoKICAgICAgICAgIHggKz0gcmVhZEludDE2KGNvZGUsIGkpOwogICAgICAgICAgaSArPSAyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDAyOgogICAgICAgICAgeCAtPSBjb2RlW2krK107CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4MTI6CiAgICAgICAgICB4ICs9IGNvZGVbaSsrXTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHBvaW50c1tqXS54ID0geDsKICAgIH0KICAgIGZvciAoaiA9IDA7IGogPCBudW1iZXJPZlBvaW50czsgaisrKSB7CiAgICAgIHN3aXRjaCAocG9pbnRzW2pdLmZsYWdzICYgMHgyNCkgewogICAgICAgIGNhc2UgMHgwMDoKICAgICAgICAgIHkgKz0gcmVhZEludDE2KGNvZGUsIGkpOwogICAgICAgICAgaSArPSAyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDA0OgogICAgICAgICAgeSAtPSBjb2RlW2krK107CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4MjQ6CiAgICAgICAgICB5ICs9IGNvZGVbaSsrXTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHBvaW50c1tqXS55ID0geTsKICAgIH0KICAgIGxldCBzdGFydFBvaW50ID0gMDsKICAgIGZvciAoaSA9IDA7IGkgPCBudW1iZXJPZkNvbnRvdXJzOyBpKyspIHsKICAgICAgY29uc3QgZW5kUG9pbnQgPSBlbmRQdHNPZkNvbnRvdXJzW2ldOwogICAgICBjb25zdCBjb250b3VyID0gcG9pbnRzLnNsaWNlKHN0YXJ0UG9pbnQsIGVuZFBvaW50ICsgMSk7CiAgICAgIGlmIChjb250b3VyWzBdLmZsYWdzICYgMSkgewogICAgICAgIGNvbnRvdXIucHVzaChjb250b3VyWzBdKTsKICAgICAgfSBlbHNlIGlmIChjb250b3VyLmF0KC0xKS5mbGFncyAmIDEpIHsKICAgICAgICBjb250b3VyLnVuc2hpZnQoY29udG91ci5hdCgtMSkpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHAgPSB7CiAgICAgICAgICBmbGFnczogMSwKICAgICAgICAgIHg6IChjb250b3VyWzBdLnggKyBjb250b3VyLmF0KC0xKS54KSAvIDIsCiAgICAgICAgICB5OiAoY29udG91clswXS55ICsgY29udG91ci5hdCgtMSkueSkgLyAyCiAgICAgICAgfTsKICAgICAgICBjb250b3VyLnVuc2hpZnQocCk7CiAgICAgICAgY29udG91ci5wdXNoKHApOwogICAgICB9CiAgICAgIG1vdmVUbyhjb250b3VyWzBdLngsIGNvbnRvdXJbMF0ueSk7CiAgICAgIGZvciAoaiA9IDEsIGpqID0gY29udG91ci5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgaWYgKGNvbnRvdXJbal0uZmxhZ3MgJiAxKSB7CiAgICAgICAgICBsaW5lVG8oY29udG91cltqXS54LCBjb250b3VyW2pdLnkpOwogICAgICAgIH0gZWxzZSBpZiAoY29udG91cltqICsgMV0uZmxhZ3MgJiAxKSB7CiAgICAgICAgICBxdWFkcmF0aWNDdXJ2ZVRvKGNvbnRvdXJbal0ueCwgY29udG91cltqXS55LCBjb250b3VyW2ogKyAxXS54LCBjb250b3VyW2ogKyAxXS55KTsKICAgICAgICAgIGorKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhZHJhdGljQ3VydmVUbyhjb250b3VyW2pdLngsIGNvbnRvdXJbal0ueSwgKGNvbnRvdXJbal0ueCArIGNvbnRvdXJbaiArIDFdLngpIC8gMiwgKGNvbnRvdXJbal0ueSArIGNvbnRvdXJbaiArIDFdLnkpIC8gMik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHN0YXJ0UG9pbnQgPSBlbmRQb2ludCArIDE7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGNvbXBpbGVDaGFyU3RyaW5nKGNoYXJTdHJpbmdDb2RlLCBjbWRzLCBmb250LCBnbHlwaElkKSB7CiAgZnVuY3Rpb24gbW92ZVRvKHgsIHkpIHsKICAgIGlmIChmaXJzdFBvaW50KSB7CiAgICAgIGNtZHMuYWRkKCJMIiwgZmlyc3RQb2ludCk7CiAgICB9CiAgICBmaXJzdFBvaW50ID0gW3gsIHldOwogICAgY21kcy5hZGQoIk0iLCBbeCwgeV0pOwogIH0KICBmdW5jdGlvbiBsaW5lVG8oeCwgeSkgewogICAgY21kcy5hZGQoIkwiLCBbeCwgeV0pOwogIH0KICBmdW5jdGlvbiBiZXppZXJDdXJ2ZVRvKHgxLCB5MSwgeDIsIHkyLCB4LCB5KSB7CiAgICBjbWRzLmFkZCgiQyIsIFt4MSwgeTEsIHgyLCB5MiwgeCwgeV0pOwogIH0KICBjb25zdCBzdGFjayA9IFtdOwogIGxldCB4ID0gMCwKICAgIHkgPSAwOwogIGxldCBzdGVtcyA9IDA7CiAgbGV0IGZpcnN0UG9pbnQgPSBudWxsOwogIGZ1bmN0aW9uIHBhcnNlKGNvZGUpIHsKICAgIGxldCBpID0gMDsKICAgIHdoaWxlIChpIDwgY29kZS5sZW5ndGgpIHsKICAgICAgbGV0IHN0YWNrQ2xlYW4gPSBmYWxzZTsKICAgICAgbGV0IHYgPSBjb2RlW2krK107CiAgICAgIGxldCB4YSwgeGIsIHlhLCB5YiwgeTEsIHkyLCB5Mywgbiwgc3VickNvZGU7CiAgICAgIHN3aXRjaCAodikgewogICAgICAgIGNhc2UgMToKICAgICAgICAgIHN0ZW1zICs9IHN0YWNrLmxlbmd0aCA+PiAxOwogICAgICAgICAgc3RhY2tDbGVhbiA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICBzdGVtcyArPSBzdGFjay5sZW5ndGggPj4gMTsKICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA0OgogICAgICAgICAgeSArPSBzdGFjay5wb3AoKTsKICAgICAgICAgIG1vdmVUbyh4LCB5KTsKICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA1OgogICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgeCArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIGxpbmVUbyh4LCB5KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgNjoKICAgICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHggKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgbGluZVRvKHgsIHkpOwogICAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgeSArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICBsaW5lVG8oeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDc6CiAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICB5ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIGxpbmVUbyh4LCB5KTsKICAgICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHggKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgbGluZVRvKHgsIHkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA4OgogICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5ID0geWIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMTA6CiAgICAgICAgICBuID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdWJyQ29kZSA9IG51bGw7CiAgICAgICAgICBpZiAoZm9udC5pc0NGRkNJREZvbnQpIHsKICAgICAgICAgICAgY29uc3QgZmRJbmRleCA9IGZvbnQuZmRTZWxlY3QuZ2V0RkRJbmRleChnbHlwaElkKTsKICAgICAgICAgICAgaWYgKGZkSW5kZXggPj0gMCAmJiBmZEluZGV4IDwgZm9udC5mZEFycmF5Lmxlbmd0aCkgewogICAgICAgICAgICAgIGNvbnN0IGZvbnREaWN0ID0gZm9udC5mZEFycmF5W2ZkSW5kZXhdOwogICAgICAgICAgICAgIGxldCBzdWJyczsKICAgICAgICAgICAgICBpZiAoZm9udERpY3QucHJpdmF0ZURpY3Q/LnN1YnJzSW5kZXgpIHsKICAgICAgICAgICAgICAgIHN1YnJzID0gZm9udERpY3QucHJpdmF0ZURpY3Quc3VicnNJbmRleC5vYmplY3RzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoc3VicnMpIHsKICAgICAgICAgICAgICAgIG4gKz0gZ2V0U3Vicm91dGluZUJpYXMoc3VicnMpOwogICAgICAgICAgICAgICAgc3VickNvZGUgPSBzdWJyc1tuXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgd2FybigiSW52YWxpZCBmZCBpbmRleCBmb3IgZ2x5cGggaW5kZXguIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1YnJDb2RlID0gZm9udC5zdWJyc1tuICsgZm9udC5zdWJyc0JpYXNdOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN1YnJDb2RlKSB7CiAgICAgICAgICAgIHBhcnNlKHN1YnJDb2RlKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMTE6CiAgICAgICAgICByZXR1cm47CiAgICAgICAgY2FzZSAxMjoKICAgICAgICAgIHYgPSBjb2RlW2krK107CiAgICAgICAgICBzd2l0Y2ggKHYpIHsKICAgICAgICAgICAgY2FzZSAzNDoKICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHkxID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5LCB4YiwgeTEsIHgsIHkxKTsKICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeTEsIHhiLCB5LCB4LCB5KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzNToKICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5ID0geWIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeWEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHkgPSB5YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzY6CiAgICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5MSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHkyID0geTEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeTEsIHhiLCB5MiwgeCwgeTIpOwogICAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeTMgPSB5MiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5MiwgeGIsIHkzLCB4LCB5KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzNzoKICAgICAgICAgICAgICBjb25zdCB4MCA9IHgsCiAgICAgICAgICAgICAgICB5MCA9IHk7CiAgICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeCA9IHhiOwogICAgICAgICAgICAgIHkgPSB5YjsKICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoeCAtIHgwKSA+IE1hdGguYWJzKHkgLSB5MCkpIHsKICAgICAgICAgICAgICAgIHggKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgeSArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYHVua25vd24gb3BlcmF0b3I6IDEyICR7dn1gKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoID49IDQpIHsKICAgICAgICAgICAgY29uc3QgYWNoYXIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgY29uc3QgYmNoYXIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgeSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICB4ID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgIGNtZHMuc2F2ZSgpOwogICAgICAgICAgICBjbWRzLnRyYW5zbGF0ZSh4LCB5KTsKICAgICAgICAgICAgbGV0IGNtYXAgPSBsb29rdXBDbWFwKGZvbnQuY21hcCwgU3RyaW5nLmZyb21DaGFyQ29kZShmb250LmdseXBoTmFtZU1hcFtTdGFuZGFyZEVuY29kaW5nW2FjaGFyXV0pKTsKICAgICAgICAgICAgY29tcGlsZUNoYXJTdHJpbmcoZm9udC5nbHlwaHNbY21hcC5nbHlwaElkXSwgY21kcywgZm9udCwgY21hcC5nbHlwaElkKTsKICAgICAgICAgICAgY21kcy5yZXN0b3JlKCk7CiAgICAgICAgICAgIGNtYXAgPSBsb29rdXBDbWFwKGZvbnQuY21hcCwgU3RyaW5nLmZyb21DaGFyQ29kZShmb250LmdseXBoTmFtZU1hcFtTdGFuZGFyZEVuY29kaW5nW2JjaGFyXV0pKTsKICAgICAgICAgICAgY29tcGlsZUNoYXJTdHJpbmcoZm9udC5nbHlwaHNbY21hcC5nbHlwaElkXSwgY21kcywgZm9udCwgY21hcC5nbHlwaElkKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybjsKICAgICAgICBjYXNlIDE4OgogICAgICAgICAgc3RlbXMgKz0gc3RhY2subGVuZ3RoID4+IDE7CiAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMTk6CiAgICAgICAgICBzdGVtcyArPSBzdGFjay5sZW5ndGggPj4gMTsKICAgICAgICAgIGkgKz0gc3RlbXMgKyA3ID4+IDM7CiAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjA6CiAgICAgICAgICBzdGVtcyArPSBzdGFjay5sZW5ndGggPj4gMTsKICAgICAgICAgIGkgKz0gc3RlbXMgKyA3ID4+IDM7CiAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjE6CiAgICAgICAgICB5ICs9IHN0YWNrLnBvcCgpOwogICAgICAgICAgeCArPSBzdGFjay5wb3AoKTsKICAgICAgICAgIG1vdmVUbyh4LCB5KTsKICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyMjoKICAgICAgICAgIHggKz0gc3RhY2sucG9wKCk7CiAgICAgICAgICBtb3ZlVG8oeCwgeSk7CiAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjM6CiAgICAgICAgICBzdGVtcyArPSBzdGFjay5sZW5ndGggPj4gMTsKICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyNDoKICAgICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAyKSB7CiAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICB4ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICB5ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICBsaW5lVG8oeCwgeSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI1OgogICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDYpIHsKICAgICAgICAgICAgeCArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIGxpbmVUbyh4LCB5KTsKICAgICAgICAgIH0KICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICB5ID0geWIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI2OgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCAlIDIpIHsKICAgICAgICAgICAgeCArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgfQogICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgeGEgPSB4OwogICAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHggPSB4YjsKICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI3OgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCAlIDIpIHsKICAgICAgICAgICAgeSArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgfQogICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWEgPSB5OwogICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHkgPSB5YjsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI4OgogICAgICAgICAgc3RhY2sucHVzaChyZWFkSW50MTYoY29kZSwgaSkpOwogICAgICAgICAgaSArPSAyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyOToKICAgICAgICAgIG4gPSBzdGFjay5wb3AoKSArIGZvbnQuZ3N1YnJzQmlhczsKICAgICAgICAgIHN1YnJDb2RlID0gZm9udC5nc3VicnNbbl07CiAgICAgICAgICBpZiAoc3VickNvZGUpIHsKICAgICAgICAgICAgcGFyc2Uoc3VickNvZGUpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzMDoKICAgICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHhhID0geDsKICAgICAgICAgICAgeWEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5ID0geWIgKyAoc3RhY2subGVuZ3RoID09PSAxID8gc3RhY2suc2hpZnQoKSA6IDApOwogICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHlhID0geTsKICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5ID0geWIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB4ID0geGIgKyAoc3RhY2subGVuZ3RoID09PSAxID8gc3RhY2suc2hpZnQoKSA6IDApOwogICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMzE6CiAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YSA9IHk7CiAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeCA9IHhiICsgKHN0YWNrLmxlbmd0aCA9PT0gMSA/IHN0YWNrLnNoaWZ0KCkgOiAwKTsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB4YSA9IHg7CiAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSA9IHliICsgKHN0YWNrLmxlbmd0aCA9PT0gMSA/IHN0YWNrLnNoaWZ0KCkgOiAwKTsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgaWYgKHYgPCAzMikgewogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYHVua25vd24gb3BlcmF0b3I6ICR7dn1gKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh2IDwgMjQ3KSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2godiAtIDEzOSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHYgPCAyNTEpIHsKICAgICAgICAgICAgc3RhY2sucHVzaCgodiAtIDI0NykgKiAyNTYgKyBjb2RlW2krK10gKyAxMDgpOwogICAgICAgICAgfSBlbHNlIGlmICh2IDwgMjU1KSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goLSh2IC0gMjUxKSAqIDI1NiAtIGNvZGVbaSsrXSAtIDEwOCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGFjay5wdXNoKChjb2RlW2ldIDw8IDI0IHwgY29kZVtpICsgMV0gPDwgMTYgfCBjb2RlW2kgKyAyXSA8PCA4IHwgY29kZVtpICsgM10pIC8gNjU1MzYpOwogICAgICAgICAgICBpICs9IDQ7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAoc3RhY2tDbGVhbikgewogICAgICAgIHN0YWNrLmxlbmd0aCA9IDA7CiAgICAgIH0KICAgIH0KICB9CiAgcGFyc2UoY2hhclN0cmluZ0NvZGUpOwp9CmNvbnN0IE5PT1AgPSAiIjsKY2xhc3MgQ29tbWFuZHMgewogIGNtZHMgPSBbXTsKICB0cmFuc2Zvcm1TdGFjayA9IFtdOwogIGN1cnJlbnRUcmFuc2Zvcm0gPSBbMSwgMCwgMCwgMSwgMCwgMF07CiAgYWRkKGNtZCwgYXJncykgewogICAgaWYgKGFyZ3MpIHsKICAgICAgY29uc3QgewogICAgICAgIGN1cnJlbnRUcmFuc2Zvcm0KICAgICAgfSA9IHRoaXM7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGFyZ3MubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICAgIFV0aWwuYXBwbHlUcmFuc2Zvcm0oYXJncywgY3VycmVudFRyYW5zZm9ybSwgaSk7CiAgICAgIH0KICAgICAgdGhpcy5jbWRzLnB1c2goYCR7Y21kfSR7YXJncy5qb2luKCIgIil9YCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmNtZHMucHVzaChjbWQpOwogICAgfQogIH0KICB0cmFuc2Zvcm0odHJhbnNmKSB7CiAgICB0aGlzLmN1cnJlbnRUcmFuc2Zvcm0gPSBVdGlsLnRyYW5zZm9ybSh0aGlzLmN1cnJlbnRUcmFuc2Zvcm0sIHRyYW5zZik7CiAgfQogIHRyYW5zbGF0ZSh4LCB5KSB7CiAgICB0aGlzLnRyYW5zZm9ybShbMSwgMCwgMCwgMSwgeCwgeV0pOwogIH0KICBzYXZlKCkgewogICAgdGhpcy50cmFuc2Zvcm1TdGFjay5wdXNoKHRoaXMuY3VycmVudFRyYW5zZm9ybS5zbGljZSgpKTsKICB9CiAgcmVzdG9yZSgpIHsKICAgIHRoaXMuY3VycmVudFRyYW5zZm9ybSA9IHRoaXMudHJhbnNmb3JtU3RhY2sucG9wKCkgfHwgWzEsIDAsIDAsIDEsIDAsIDBdOwogIH0KICBnZXRTVkcoKSB7CiAgICByZXR1cm4gdGhpcy5jbWRzLmpvaW4oIiIpOwogIH0KfQpjbGFzcyBDb21waWxlZEZvbnQgewogIGNvbnN0cnVjdG9yKGZvbnRNYXRyaXgpIHsKICAgIHRoaXMuZm9udE1hdHJpeCA9IGZvbnRNYXRyaXg7CiAgICB0aGlzLmNvbXBpbGVkR2x5cGhzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHRoaXMuY29tcGlsZWRDaGFyQ29kZVRvR2x5cGhJZCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgfQogIGdldFBhdGhKcyh1bmljb2RlKSB7CiAgICBjb25zdCB7CiAgICAgIGNoYXJDb2RlLAogICAgICBnbHlwaElkCiAgICB9ID0gbG9va3VwQ21hcCh0aGlzLmNtYXAsIHVuaWNvZGUpOwogICAgbGV0IGZuID0gdGhpcy5jb21waWxlZEdseXBoc1tnbHlwaElkXSwKICAgICAgY29tcGlsZUV4OwogICAgaWYgKGZuID09PSB1bmRlZmluZWQpIHsKICAgICAgdHJ5IHsKICAgICAgICBmbiA9IHRoaXMuY29tcGlsZUdseXBoKHRoaXMuZ2x5cGhzW2dseXBoSWRdLCBnbHlwaElkKTsKICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICBmbiA9IE5PT1A7CiAgICAgICAgY29tcGlsZUV4ID0gZXg7CiAgICAgIH0KICAgICAgdGhpcy5jb21waWxlZEdseXBoc1tnbHlwaElkXSA9IGZuOwogICAgfQogICAgdGhpcy5jb21waWxlZENoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA/Pz0gZ2x5cGhJZDsKICAgIGlmIChjb21waWxlRXgpIHsKICAgICAgdGhyb3cgY29tcGlsZUV4OwogICAgfQogICAgcmV0dXJuIGZuOwogIH0KICBjb21waWxlR2x5cGgoY29kZSwgZ2x5cGhJZCkgewogICAgaWYgKCFjb2RlPy5sZW5ndGggfHwgY29kZVswXSA9PT0gMTQpIHsKICAgICAgcmV0dXJuIE5PT1A7CiAgICB9CiAgICBsZXQgZm9udE1hdHJpeCA9IHRoaXMuZm9udE1hdHJpeDsKICAgIGlmICh0aGlzLmlzQ0ZGQ0lERm9udCkgewogICAgICBjb25zdCBmZEluZGV4ID0gdGhpcy5mZFNlbGVjdC5nZXRGREluZGV4KGdseXBoSWQpOwogICAgICBpZiAoZmRJbmRleCA+PSAwICYmIGZkSW5kZXggPCB0aGlzLmZkQXJyYXkubGVuZ3RoKSB7CiAgICAgICAgY29uc3QgZm9udERpY3QgPSB0aGlzLmZkQXJyYXlbZmRJbmRleF07CiAgICAgICAgZm9udE1hdHJpeCA9IGZvbnREaWN0LmdldEJ5TmFtZSgiRm9udE1hdHJpeCIpIHx8IEZPTlRfSURFTlRJVFlfTUFUUklYOwogICAgICB9IGVsc2UgewogICAgICAgIHdhcm4oIkludmFsaWQgZmQgaW5kZXggZm9yIGdseXBoIGluZGV4LiIpOwogICAgICB9CiAgICB9CiAgICBhc3NlcnQoaXNOdW1iZXJBcnJheShmb250TWF0cml4LCA2KSwgIkV4cGVjdGVkIGEgdmFsaWQgZm9udE1hdHJpeC4iKTsKICAgIGNvbnN0IGNtZHMgPSBuZXcgQ29tbWFuZHMoKTsKICAgIGNtZHMudHJhbnNmb3JtKGZvbnRNYXRyaXguc2xpY2UoKSk7CiAgICB0aGlzLmNvbXBpbGVHbHlwaEltcGwoY29kZSwgY21kcywgZ2x5cGhJZCk7CiAgICBjbWRzLmFkZCgiWiIpOwogICAgcmV0dXJuIGNtZHMuZ2V0U1ZHKCk7CiAgfQogIGNvbXBpbGVHbHlwaEltcGwoKSB7CiAgICB1bnJlYWNoYWJsZSgiQ2hpbGRyZW4gY2xhc3NlcyBzaG91bGQgaW1wbGVtZW50IHRoaXMuIik7CiAgfQogIGhhc0J1aWx0UGF0aCh1bmljb2RlKSB7CiAgICBjb25zdCB7CiAgICAgIGNoYXJDb2RlLAogICAgICBnbHlwaElkCiAgICB9ID0gbG9va3VwQ21hcCh0aGlzLmNtYXAsIHVuaWNvZGUpOwogICAgcmV0dXJuIHRoaXMuY29tcGlsZWRHbHlwaHNbZ2x5cGhJZF0gIT09IHVuZGVmaW5lZCAmJiB0aGlzLmNvbXBpbGVkQ2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdICE9PSB1bmRlZmluZWQ7CiAgfQp9CmNsYXNzIFRydWVUeXBlQ29tcGlsZWQgZXh0ZW5kcyBDb21waWxlZEZvbnQgewogIGNvbnN0cnVjdG9yKGdseXBocywgY21hcCwgZm9udE1hdHJpeCkgewogICAgc3VwZXIoZm9udE1hdHJpeCB8fCBbMC4wMDA0ODgsIDAsIDAsIDAuMDAwNDg4LCAwLCAwXSk7CiAgICB0aGlzLmdseXBocyA9IGdseXBoczsKICAgIHRoaXMuY21hcCA9IGNtYXA7CiAgfQogIGNvbXBpbGVHbHlwaEltcGwoY29kZSwgY21kcykgewogICAgY29tcGlsZUdseWYoY29kZSwgY21kcywgdGhpcyk7CiAgfQp9CmNsYXNzIFR5cGUyQ29tcGlsZWQgZXh0ZW5kcyBDb21waWxlZEZvbnQgewogIGNvbnN0cnVjdG9yKGNmZkluZm8sIGNtYXAsIGZvbnRNYXRyaXgpIHsKICAgIHN1cGVyKGZvbnRNYXRyaXggfHwgWzAuMDAxLCAwLCAwLCAwLjAwMSwgMCwgMF0pOwogICAgdGhpcy5nbHlwaHMgPSBjZmZJbmZvLmdseXBoczsKICAgIHRoaXMuZ3N1YnJzID0gY2ZmSW5mby5nc3VicnMgfHwgW107CiAgICB0aGlzLnN1YnJzID0gY2ZmSW5mby5zdWJycyB8fCBbXTsKICAgIHRoaXMuY21hcCA9IGNtYXA7CiAgICB0aGlzLmdseXBoTmFtZU1hcCA9IGdldEdseXBoc1VuaWNvZGUoKTsKICAgIHRoaXMuZ3N1YnJzQmlhcyA9IGdldFN1YnJvdXRpbmVCaWFzKHRoaXMuZ3N1YnJzKTsKICAgIHRoaXMuc3VicnNCaWFzID0gZ2V0U3Vicm91dGluZUJpYXModGhpcy5zdWJycyk7CiAgICB0aGlzLmlzQ0ZGQ0lERm9udCA9IGNmZkluZm8uaXNDRkZDSURGb250OwogICAgdGhpcy5mZFNlbGVjdCA9IGNmZkluZm8uZmRTZWxlY3Q7CiAgICB0aGlzLmZkQXJyYXkgPSBjZmZJbmZvLmZkQXJyYXk7CiAgfQogIGNvbXBpbGVHbHlwaEltcGwoY29kZSwgY21kcywgZ2x5cGhJZCkgewogICAgY29tcGlsZUNoYXJTdHJpbmcoY29kZSwgY21kcywgdGhpcywgZ2x5cGhJZCk7CiAgfQp9CmNsYXNzIEZvbnRSZW5kZXJlckZhY3RvcnkgewogIHN0YXRpYyBjcmVhdGUoZm9udCwgc2VhY0FuYWx5c2lzRW5hYmxlZCkgewogICAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KGZvbnQuZGF0YSk7CiAgICBsZXQgY21hcCwgZ2x5ZiwgbG9jYSwgY2ZmLCBpbmRleFRvTG9jRm9ybWF0LCB1bml0c1BlckVtOwogICAgY29uc3QgbnVtVGFibGVzID0gcmVhZFVpbnQxNihkYXRhLCA0KTsKICAgIGZvciAobGV0IGkgPSAwLCBwID0gMTI7IGkgPCBudW1UYWJsZXM7IGkrKywgcCArPSAxNikgewogICAgICBjb25zdCB0YWcgPSBieXRlc1RvU3RyaW5nKGRhdGEuc3ViYXJyYXkocCwgcCArIDQpKTsKICAgICAgY29uc3Qgb2Zmc2V0ID0gcmVhZFVpbnQzMihkYXRhLCBwICsgOCk7CiAgICAgIGNvbnN0IGxlbmd0aCA9IHJlYWRVaW50MzIoZGF0YSwgcCArIDEyKTsKICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAgICBjYXNlICJjbWFwIjoKICAgICAgICAgIGNtYXAgPSBwYXJzZUNtYXAoZGF0YSwgb2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZ2x5ZiI6CiAgICAgICAgICBnbHlmID0gZGF0YS5zdWJhcnJheShvZmZzZXQsIG9mZnNldCArIGxlbmd0aCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJsb2NhIjoKICAgICAgICAgIGxvY2EgPSBkYXRhLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImhlYWQiOgogICAgICAgICAgdW5pdHNQZXJFbSA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0ICsgMTgpOwogICAgICAgICAgaW5kZXhUb0xvY0Zvcm1hdCA9IHJlYWRVaW50MTYoZGF0YSwgb2Zmc2V0ICsgNTApOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiQ0ZGICI6CiAgICAgICAgICBjZmYgPSBwYXJzZUNmZihkYXRhLCBvZmZzZXQsIG9mZnNldCArIGxlbmd0aCwgc2VhY0FuYWx5c2lzRW5hYmxlZCk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgaWYgKGdseWYpIHsKICAgICAgY29uc3QgZm9udE1hdHJpeCA9ICF1bml0c1BlckVtID8gZm9udC5mb250TWF0cml4IDogWzEgLyB1bml0c1BlckVtLCAwLCAwLCAxIC8gdW5pdHNQZXJFbSwgMCwgMF07CiAgICAgIHJldHVybiBuZXcgVHJ1ZVR5cGVDb21waWxlZChwYXJzZUdseWZUYWJsZShnbHlmLCBsb2NhLCBpbmRleFRvTG9jRm9ybWF0KSwgY21hcCwgZm9udE1hdHJpeCk7CiAgICB9CiAgICByZXR1cm4gbmV3IFR5cGUyQ29tcGlsZWQoY2ZmLCBjbWFwLCBmb250LmZvbnRNYXRyaXgpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvbWV0cmljcy5qcwoKY29uc3QgZ2V0TWV0cmljcyA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHQuQ291cmllciA9IDYwMDsKICB0WyJDb3VyaWVyLUJvbGQiXSA9IDYwMDsKICB0WyJDb3VyaWVyLUJvbGRPYmxpcXVlIl0gPSA2MDA7CiAgdFsiQ291cmllci1PYmxpcXVlIl0gPSA2MDA7CiAgdC5IZWx2ZXRpY2EgPSBnZXRMb29rdXBUYWJsZUZhY3RvcnkoZnVuY3Rpb24gKHQpIHsKICAgIHQuc3BhY2UgPSAyNzg7CiAgICB0LmV4Y2xhbSA9IDI3ODsKICAgIHQucXVvdGVkYmwgPSAzNTU7CiAgICB0Lm51bWJlcnNpZ24gPSA1NTY7CiAgICB0LmRvbGxhciA9IDU1NjsKICAgIHQucGVyY2VudCA9IDg4OTsKICAgIHQuYW1wZXJzYW5kID0gNjY3OwogICAgdC5xdW90ZXJpZ2h0ID0gMjIyOwogICAgdC5wYXJlbmxlZnQgPSAzMzM7CiAgICB0LnBhcmVucmlnaHQgPSAzMzM7CiAgICB0LmFzdGVyaXNrID0gMzg5OwogICAgdC5wbHVzID0gNTg0OwogICAgdC5jb21tYSA9IDI3ODsKICAgIHQuaHlwaGVuID0gMzMzOwogICAgdC5wZXJpb2QgPSAyNzg7CiAgICB0LnNsYXNoID0gMjc4OwogICAgdC56ZXJvID0gNTU2OwogICAgdC5vbmUgPSA1NTY7CiAgICB0LnR3byA9IDU1NjsKICAgIHQudGhyZWUgPSA1NTY7CiAgICB0LmZvdXIgPSA1NTY7CiAgICB0LmZpdmUgPSA1NTY7CiAgICB0LnNpeCA9IDU1NjsKICAgIHQuc2V2ZW4gPSA1NTY7CiAgICB0LmVpZ2h0ID0gNTU2OwogICAgdC5uaW5lID0gNTU2OwogICAgdC5jb2xvbiA9IDI3ODsKICAgIHQuc2VtaWNvbG9uID0gMjc4OwogICAgdC5sZXNzID0gNTg0OwogICAgdC5lcXVhbCA9IDU4NDsKICAgIHQuZ3JlYXRlciA9IDU4NDsKICAgIHQucXVlc3Rpb24gPSA1NTY7CiAgICB0LmF0ID0gMTAxNTsKICAgIHQuQSA9IDY2NzsKICAgIHQuQiA9IDY2NzsKICAgIHQuQyA9IDcyMjsKICAgIHQuRCA9IDcyMjsKICAgIHQuRSA9IDY2NzsKICAgIHQuRiA9IDYxMTsKICAgIHQuRyA9IDc3ODsKICAgIHQuSCA9IDcyMjsKICAgIHQuSSA9IDI3ODsKICAgIHQuSiA9IDUwMDsKICAgIHQuSyA9IDY2NzsKICAgIHQuTCA9IDU1NjsKICAgIHQuTSA9IDgzMzsKICAgIHQuTiA9IDcyMjsKICAgIHQuTyA9IDc3ODsKICAgIHQuUCA9IDY2NzsKICAgIHQuUSA9IDc3ODsKICAgIHQuUiA9IDcyMjsKICAgIHQuUyA9IDY2NzsKICAgIHQuVCA9IDYxMTsKICAgIHQuVSA9IDcyMjsKICAgIHQuViA9IDY2NzsKICAgIHQuVyA9IDk0NDsKICAgIHQuWCA9IDY2NzsKICAgIHQuWSA9IDY2NzsKICAgIHQuWiA9IDYxMTsKICAgIHQuYnJhY2tldGxlZnQgPSAyNzg7CiAgICB0LmJhY2tzbGFzaCA9IDI3ODsKICAgIHQuYnJhY2tldHJpZ2h0ID0gMjc4OwogICAgdC5hc2NpaWNpcmN1bSA9IDQ2OTsKICAgIHQudW5kZXJzY29yZSA9IDU1NjsKICAgIHQucXVvdGVsZWZ0ID0gMjIyOwogICAgdC5hID0gNTU2OwogICAgdC5iID0gNTU2OwogICAgdC5jID0gNTAwOwogICAgdC5kID0gNTU2OwogICAgdC5lID0gNTU2OwogICAgdC5mID0gMjc4OwogICAgdC5nID0gNTU2OwogICAgdC5oID0gNTU2OwogICAgdC5pID0gMjIyOwogICAgdC5qID0gMjIyOwogICAgdC5rID0gNTAwOwogICAgdC5sID0gMjIyOwogICAgdC5tID0gODMzOwogICAgdC5uID0gNTU2OwogICAgdC5vID0gNTU2OwogICAgdC5wID0gNTU2OwogICAgdC5xID0gNTU2OwogICAgdC5yID0gMzMzOwogICAgdC5zID0gNTAwOwogICAgdC50ID0gMjc4OwogICAgdC51ID0gNTU2OwogICAgdC52ID0gNTAwOwogICAgdC53ID0gNzIyOwogICAgdC54ID0gNTAwOwogICAgdC55ID0gNTAwOwogICAgdC56ID0gNTAwOwogICAgdC5icmFjZWxlZnQgPSAzMzQ7CiAgICB0LmJhciA9IDI2MDsKICAgIHQuYnJhY2VyaWdodCA9IDMzNDsKICAgIHQuYXNjaWl0aWxkZSA9IDU4NDsKICAgIHQuZXhjbGFtZG93biA9IDMzMzsKICAgIHQuY2VudCA9IDU1NjsKICAgIHQuc3RlcmxpbmcgPSA1NTY7CiAgICB0LmZyYWN0aW9uID0gMTY3OwogICAgdC55ZW4gPSA1NTY7CiAgICB0LmZsb3JpbiA9IDU1NjsKICAgIHQuc2VjdGlvbiA9IDU1NjsKICAgIHQuY3VycmVuY3kgPSA1NTY7CiAgICB0LnF1b3Rlc2luZ2xlID0gMTkxOwogICAgdC5xdW90ZWRibGxlZnQgPSAzMzM7CiAgICB0Lmd1aWxsZW1vdGxlZnQgPSA1NTY7CiAgICB0Lmd1aWxzaW5nbGxlZnQgPSAzMzM7CiAgICB0Lmd1aWxzaW5nbHJpZ2h0ID0gMzMzOwogICAgdC5maSA9IDUwMDsKICAgIHQuZmwgPSA1MDA7CiAgICB0LmVuZGFzaCA9IDU1NjsKICAgIHQuZGFnZ2VyID0gNTU2OwogICAgdC5kYWdnZXJkYmwgPSA1NTY7CiAgICB0LnBlcmlvZGNlbnRlcmVkID0gMjc4OwogICAgdC5wYXJhZ3JhcGggPSA1Mzc7CiAgICB0LmJ1bGxldCA9IDM1MDsKICAgIHQucXVvdGVzaW5nbGJhc2UgPSAyMjI7CiAgICB0LnF1b3RlZGJsYmFzZSA9IDMzMzsKICAgIHQucXVvdGVkYmxyaWdodCA9IDMzMzsKICAgIHQuZ3VpbGxlbW90cmlnaHQgPSA1NTY7CiAgICB0LmVsbGlwc2lzID0gMTAwMDsKICAgIHQucGVydGhvdXNhbmQgPSAxMDAwOwogICAgdC5xdWVzdGlvbmRvd24gPSA2MTE7CiAgICB0LmdyYXZlID0gMzMzOwogICAgdC5hY3V0ZSA9IDMzMzsKICAgIHQuY2lyY3VtZmxleCA9IDMzMzsKICAgIHQudGlsZGUgPSAzMzM7CiAgICB0Lm1hY3JvbiA9IDMzMzsKICAgIHQuYnJldmUgPSAzMzM7CiAgICB0LmRvdGFjY2VudCA9IDMzMzsKICAgIHQuZGllcmVzaXMgPSAzMzM7CiAgICB0LnJpbmcgPSAzMzM7CiAgICB0LmNlZGlsbGEgPSAzMzM7CiAgICB0Lmh1bmdhcnVtbGF1dCA9IDMzMzsKICAgIHQub2dvbmVrID0gMzMzOwogICAgdC5jYXJvbiA9IDMzMzsKICAgIHQuZW1kYXNoID0gMTAwMDsKICAgIHQuQUUgPSAxMDAwOwogICAgdC5vcmRmZW1pbmluZSA9IDM3MDsKICAgIHQuTHNsYXNoID0gNTU2OwogICAgdC5Pc2xhc2ggPSA3Nzg7CiAgICB0Lk9FID0gMTAwMDsKICAgIHQub3JkbWFzY3VsaW5lID0gMzY1OwogICAgdC5hZSA9IDg4OTsKICAgIHQuZG90bGVzc2kgPSAyNzg7CiAgICB0LmxzbGFzaCA9IDIyMjsKICAgIHQub3NsYXNoID0gNjExOwogICAgdC5vZSA9IDk0NDsKICAgIHQuZ2VybWFuZGJscyA9IDYxMTsKICAgIHQuSWRpZXJlc2lzID0gMjc4OwogICAgdC5lYWN1dGUgPSA1NTY7CiAgICB0LmFicmV2ZSA9IDU1NjsKICAgIHQudWh1bmdhcnVtbGF1dCA9IDU1NjsKICAgIHQuZWNhcm9uID0gNTU2OwogICAgdC5ZZGllcmVzaXMgPSA2Njc7CiAgICB0LmRpdmlkZSA9IDU4NDsKICAgIHQuWWFjdXRlID0gNjY3OwogICAgdC5BY2lyY3VtZmxleCA9IDY2NzsKICAgIHQuYWFjdXRlID0gNTU2OwogICAgdC5VY2lyY3VtZmxleCA9IDcyMjsKICAgIHQueWFjdXRlID0gNTAwOwogICAgdC5zY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0LmVjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5VcmluZyA9IDcyMjsKICAgIHQuVWRpZXJlc2lzID0gNzIyOwogICAgdC5hb2dvbmVrID0gNTU2OwogICAgdC5VYWN1dGUgPSA3MjI7CiAgICB0LnVvZ29uZWsgPSA1NTY7CiAgICB0LkVkaWVyZXNpcyA9IDY2NzsKICAgIHQuRGNyb2F0ID0gNzIyOwogICAgdC5jb21tYWFjY2VudCA9IDI1MDsKICAgIHQuY29weXJpZ2h0ID0gNzM3OwogICAgdC5FbWFjcm9uID0gNjY3OwogICAgdC5jY2Fyb24gPSA1MDA7CiAgICB0LmFyaW5nID0gNTU2OwogICAgdC5OY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LmxhY3V0ZSA9IDIyMjsKICAgIHQuYWdyYXZlID0gNTU2OwogICAgdC5UY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkNhY3V0ZSA9IDcyMjsKICAgIHQuYXRpbGRlID0gNTU2OwogICAgdC5FZG90YWNjZW50ID0gNjY3OwogICAgdC5zY2Fyb24gPSA1MDA7CiAgICB0LnNjZWRpbGxhID0gNTAwOwogICAgdC5pYWN1dGUgPSAyNzg7CiAgICB0LmxvemVuZ2UgPSA0NzE7CiAgICB0LlJjYXJvbiA9IDcyMjsKICAgIHQuR2NvbW1hYWNjZW50ID0gNzc4OwogICAgdC51Y2lyY3VtZmxleCA9IDU1NjsKICAgIHQuYWNpcmN1bWZsZXggPSA1NTY7CiAgICB0LkFtYWNyb24gPSA2Njc7CiAgICB0LnJjYXJvbiA9IDMzMzsKICAgIHQuY2NlZGlsbGEgPSA1MDA7CiAgICB0Llpkb3RhY2NlbnQgPSA2MTE7CiAgICB0LlRob3JuID0gNjY3OwogICAgdC5PbWFjcm9uID0gNzc4OwogICAgdC5SYWN1dGUgPSA3MjI7CiAgICB0LlNhY3V0ZSA9IDY2NzsKICAgIHQuZGNhcm9uID0gNjQzOwogICAgdC5VbWFjcm9uID0gNzIyOwogICAgdC51cmluZyA9IDU1NjsKICAgIHQudGhyZWVzdXBlcmlvciA9IDMzMzsKICAgIHQuT2dyYXZlID0gNzc4OwogICAgdC5BZ3JhdmUgPSA2Njc7CiAgICB0LkFicmV2ZSA9IDY2NzsKICAgIHQubXVsdGlwbHkgPSA1ODQ7CiAgICB0LnVhY3V0ZSA9IDU1NjsKICAgIHQuVGNhcm9uID0gNjExOwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ3NjsKICAgIHQueWRpZXJlc2lzID0gNTAwOwogICAgdC5OYWN1dGUgPSA3MjI7CiAgICB0LmljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5FY2lyY3VtZmxleCA9IDY2NzsKICAgIHQuYWRpZXJlc2lzID0gNTU2OwogICAgdC5lZGllcmVzaXMgPSA1NTY7CiAgICB0LmNhY3V0ZSA9IDUwMDsKICAgIHQubmFjdXRlID0gNTU2OwogICAgdC51bWFjcm9uID0gNTU2OwogICAgdC5OY2Fyb24gPSA3MjI7CiAgICB0LklhY3V0ZSA9IDI3ODsKICAgIHQucGx1c21pbnVzID0gNTg0OwogICAgdC5icm9rZW5iYXIgPSAyNjA7CiAgICB0LnJlZ2lzdGVyZWQgPSA3Mzc7CiAgICB0LkdicmV2ZSA9IDc3ODsKICAgIHQuSWRvdGFjY2VudCA9IDI3ODsKICAgIHQuc3VtbWF0aW9uID0gNjAwOwogICAgdC5FZ3JhdmUgPSA2Njc7CiAgICB0LnJhY3V0ZSA9IDMzMzsKICAgIHQub21hY3JvbiA9IDU1NjsKICAgIHQuWmFjdXRlID0gNjExOwogICAgdC5aY2Fyb24gPSA2MTE7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQuRXRoID0gNzIyOwogICAgdC5DY2VkaWxsYSA9IDcyMjsKICAgIHQubGNvbW1hYWNjZW50ID0gMjIyOwogICAgdC50Y2Fyb24gPSAzMTc7CiAgICB0LmVvZ29uZWsgPSA1NTY7CiAgICB0LlVvZ29uZWsgPSA3MjI7CiAgICB0LkFhY3V0ZSA9IDY2NzsKICAgIHQuQWRpZXJlc2lzID0gNjY3OwogICAgdC5lZ3JhdmUgPSA1NTY7CiAgICB0LnphY3V0ZSA9IDUwMDsKICAgIHQuaW9nb25layA9IDIyMjsKICAgIHQuT2FjdXRlID0gNzc4OwogICAgdC5vYWN1dGUgPSA1NTY7CiAgICB0LmFtYWNyb24gPSA1NTY7CiAgICB0LnNhY3V0ZSA9IDUwMDsKICAgIHQuaWRpZXJlc2lzID0gMjc4OwogICAgdC5PY2lyY3VtZmxleCA9IDc3ODsKICAgIHQuVWdyYXZlID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQudGhvcm4gPSA1NTY7CiAgICB0LnR3b3N1cGVyaW9yID0gMzMzOwogICAgdC5PZGllcmVzaXMgPSA3Nzg7CiAgICB0Lm11ID0gNTU2OwogICAgdC5pZ3JhdmUgPSAyNzg7CiAgICB0Lm9odW5nYXJ1bWxhdXQgPSA1NTY7CiAgICB0LkVvZ29uZWsgPSA2Njc7CiAgICB0LmRjcm9hdCA9IDU1NjsKICAgIHQudGhyZWVxdWFydGVycyA9IDgzNDsKICAgIHQuU2NlZGlsbGEgPSA2Njc7CiAgICB0LmxjYXJvbiA9IDI5OTsKICAgIHQuS2NvbW1hYWNjZW50ID0gNjY3OwogICAgdC5MYWN1dGUgPSA1NTY7CiAgICB0LnRyYWRlbWFyayA9IDEwMDA7CiAgICB0LmVkb3RhY2NlbnQgPSA1NTY7CiAgICB0LklncmF2ZSA9IDI3ODsKICAgIHQuSW1hY3JvbiA9IDI3ODsKICAgIHQuTGNhcm9uID0gNTU2OwogICAgdC5vbmVoYWxmID0gODM0OwogICAgdC5sZXNzZXF1YWwgPSA1NDk7CiAgICB0Lm9jaXJjdW1mbGV4ID0gNTU2OwogICAgdC5udGlsZGUgPSA1NTY7CiAgICB0LlVodW5nYXJ1bWxhdXQgPSA3MjI7CiAgICB0LkVhY3V0ZSA9IDY2NzsKICAgIHQuZW1hY3JvbiA9IDU1NjsKICAgIHQuZ2JyZXZlID0gNTU2OwogICAgdC5vbmVxdWFydGVyID0gODM0OwogICAgdC5TY2Fyb24gPSA2Njc7CiAgICB0LlNjb21tYWFjY2VudCA9IDY2NzsKICAgIHQuT2h1bmdhcnVtbGF1dCA9IDc3ODsKICAgIHQuZGVncmVlID0gNDAwOwogICAgdC5vZ3JhdmUgPSA1NTY7CiAgICB0LkNjYXJvbiA9IDcyMjsKICAgIHQudWdyYXZlID0gNTU2OwogICAgdC5yYWRpY2FsID0gNDUzOwogICAgdC5EY2Fyb24gPSA3MjI7CiAgICB0LnJjb21tYWFjY2VudCA9IDMzMzsKICAgIHQuTnRpbGRlID0gNzIyOwogICAgdC5vdGlsZGUgPSA1NTY7CiAgICB0LlJjb21tYWFjY2VudCA9IDcyMjsKICAgIHQuTGNvbW1hYWNjZW50ID0gNTU2OwogICAgdC5BdGlsZGUgPSA2Njc7CiAgICB0LkFvZ29uZWsgPSA2Njc7CiAgICB0LkFyaW5nID0gNjY3OwogICAgdC5PdGlsZGUgPSA3Nzg7CiAgICB0Lnpkb3RhY2NlbnQgPSA1MDA7CiAgICB0LkVjYXJvbiA9IDY2NzsKICAgIHQuSW9nb25layA9IDI3ODsKICAgIHQua2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5taW51cyA9IDU4NDsKICAgIHQuSWNpcmN1bWZsZXggPSAyNzg7CiAgICB0Lm5jYXJvbiA9IDU1NjsKICAgIHQudGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC5sb2dpY2Fsbm90ID0gNTg0OwogICAgdC5vZGllcmVzaXMgPSA1NTY7CiAgICB0LnVkaWVyZXNpcyA9IDU1NjsKICAgIHQubm90ZXF1YWwgPSA1NDk7CiAgICB0Lmdjb21tYWFjY2VudCA9IDU1NjsKICAgIHQuZXRoID0gNTU2OwogICAgdC56Y2Fyb24gPSA1MDA7CiAgICB0Lm5jb21tYWFjY2VudCA9IDU1NjsKICAgIHQub25lc3VwZXJpb3IgPSAzMzM7CiAgICB0LmltYWNyb24gPSAyNzg7CiAgICB0LkV1cm8gPSA1NTY7CiAgfSk7CiAgdFsiSGVsdmV0aWNhLUJvbGQiXSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI3ODsKICAgIHQuZXhjbGFtID0gMzMzOwogICAgdC5xdW90ZWRibCA9IDQ3NDsKICAgIHQubnVtYmVyc2lnbiA9IDU1NjsKICAgIHQuZG9sbGFyID0gNTU2OwogICAgdC5wZXJjZW50ID0gODg5OwogICAgdC5hbXBlcnNhbmQgPSA3MjI7CiAgICB0LnF1b3RlcmlnaHQgPSAyNzg7CiAgICB0LnBhcmVubGVmdCA9IDMzMzsKICAgIHQucGFyZW5yaWdodCA9IDMzMzsKICAgIHQuYXN0ZXJpc2sgPSAzODk7CiAgICB0LnBsdXMgPSA1ODQ7CiAgICB0LmNvbW1hID0gMjc4OwogICAgdC5oeXBoZW4gPSAzMzM7CiAgICB0LnBlcmlvZCA9IDI3ODsKICAgIHQuc2xhc2ggPSAyNzg7CiAgICB0Lnplcm8gPSA1NTY7CiAgICB0Lm9uZSA9IDU1NjsKICAgIHQudHdvID0gNTU2OwogICAgdC50aHJlZSA9IDU1NjsKICAgIHQuZm91ciA9IDU1NjsKICAgIHQuZml2ZSA9IDU1NjsKICAgIHQuc2l4ID0gNTU2OwogICAgdC5zZXZlbiA9IDU1NjsKICAgIHQuZWlnaHQgPSA1NTY7CiAgICB0Lm5pbmUgPSA1NTY7CiAgICB0LmNvbG9uID0gMzMzOwogICAgdC5zZW1pY29sb24gPSAzMzM7CiAgICB0Lmxlc3MgPSA1ODQ7CiAgICB0LmVxdWFsID0gNTg0OwogICAgdC5ncmVhdGVyID0gNTg0OwogICAgdC5xdWVzdGlvbiA9IDYxMTsKICAgIHQuYXQgPSA5NzU7CiAgICB0LkEgPSA3MjI7CiAgICB0LkIgPSA3MjI7CiAgICB0LkMgPSA3MjI7CiAgICB0LkQgPSA3MjI7CiAgICB0LkUgPSA2Njc7CiAgICB0LkYgPSA2MTE7CiAgICB0LkcgPSA3Nzg7CiAgICB0LkggPSA3MjI7CiAgICB0LkkgPSAyNzg7CiAgICB0LkogPSA1NTY7CiAgICB0LksgPSA3MjI7CiAgICB0LkwgPSA2MTE7CiAgICB0Lk0gPSA4MzM7CiAgICB0Lk4gPSA3MjI7CiAgICB0Lk8gPSA3Nzg7CiAgICB0LlAgPSA2Njc7CiAgICB0LlEgPSA3Nzg7CiAgICB0LlIgPSA3MjI7CiAgICB0LlMgPSA2Njc7CiAgICB0LlQgPSA2MTE7CiAgICB0LlUgPSA3MjI7CiAgICB0LlYgPSA2Njc7CiAgICB0LlcgPSA5NDQ7CiAgICB0LlggPSA2Njc7CiAgICB0LlkgPSA2Njc7CiAgICB0LlogPSA2MTE7CiAgICB0LmJyYWNrZXRsZWZ0ID0gMzMzOwogICAgdC5iYWNrc2xhc2ggPSAyNzg7CiAgICB0LmJyYWNrZXRyaWdodCA9IDMzMzsKICAgIHQuYXNjaWljaXJjdW0gPSA1ODQ7CiAgICB0LnVuZGVyc2NvcmUgPSA1NTY7CiAgICB0LnF1b3RlbGVmdCA9IDI3ODsKICAgIHQuYSA9IDU1NjsKICAgIHQuYiA9IDYxMTsKICAgIHQuYyA9IDU1NjsKICAgIHQuZCA9IDYxMTsKICAgIHQuZSA9IDU1NjsKICAgIHQuZiA9IDMzMzsKICAgIHQuZyA9IDYxMTsKICAgIHQuaCA9IDYxMTsKICAgIHQuaSA9IDI3ODsKICAgIHQuaiA9IDI3ODsKICAgIHQuayA9IDU1NjsKICAgIHQubCA9IDI3ODsKICAgIHQubSA9IDg4OTsKICAgIHQubiA9IDYxMTsKICAgIHQubyA9IDYxMTsKICAgIHQucCA9IDYxMTsKICAgIHQucSA9IDYxMTsKICAgIHQuciA9IDM4OTsKICAgIHQucyA9IDU1NjsKICAgIHQudCA9IDMzMzsKICAgIHQudSA9IDYxMTsKICAgIHQudiA9IDU1NjsKICAgIHQudyA9IDc3ODsKICAgIHQueCA9IDU1NjsKICAgIHQueSA9IDU1NjsKICAgIHQueiA9IDUwMDsKICAgIHQuYnJhY2VsZWZ0ID0gMzg5OwogICAgdC5iYXIgPSAyODA7CiAgICB0LmJyYWNlcmlnaHQgPSAzODk7CiAgICB0LmFzY2lpdGlsZGUgPSA1ODQ7CiAgICB0LmV4Y2xhbWRvd24gPSAzMzM7CiAgICB0LmNlbnQgPSA1NTY7CiAgICB0LnN0ZXJsaW5nID0gNTU2OwogICAgdC5mcmFjdGlvbiA9IDE2NzsKICAgIHQueWVuID0gNTU2OwogICAgdC5mbG9yaW4gPSA1NTY7CiAgICB0LnNlY3Rpb24gPSA1NTY7CiAgICB0LmN1cnJlbmN5ID0gNTU2OwogICAgdC5xdW90ZXNpbmdsZSA9IDIzODsKICAgIHQucXVvdGVkYmxsZWZ0ID0gNTAwOwogICAgdC5ndWlsbGVtb3RsZWZ0ID0gNTU2OwogICAgdC5ndWlsc2luZ2xsZWZ0ID0gMzMzOwogICAgdC5ndWlsc2luZ2xyaWdodCA9IDMzMzsKICAgIHQuZmkgPSA2MTE7CiAgICB0LmZsID0gNjExOwogICAgdC5lbmRhc2ggPSA1NTY7CiAgICB0LmRhZ2dlciA9IDU1NjsKICAgIHQuZGFnZ2VyZGJsID0gNTU2OwogICAgdC5wZXJpb2RjZW50ZXJlZCA9IDI3ODsKICAgIHQucGFyYWdyYXBoID0gNTU2OwogICAgdC5idWxsZXQgPSAzNTA7CiAgICB0LnF1b3Rlc2luZ2xiYXNlID0gMjc4OwogICAgdC5xdW90ZWRibGJhc2UgPSA1MDA7CiAgICB0LnF1b3RlZGJscmlnaHQgPSA1MDA7CiAgICB0Lmd1aWxsZW1vdHJpZ2h0ID0gNTU2OwogICAgdC5lbGxpcHNpcyA9IDEwMDA7CiAgICB0LnBlcnRob3VzYW5kID0gMTAwMDsKICAgIHQucXVlc3Rpb25kb3duID0gNjExOwogICAgdC5ncmF2ZSA9IDMzMzsKICAgIHQuYWN1dGUgPSAzMzM7CiAgICB0LmNpcmN1bWZsZXggPSAzMzM7CiAgICB0LnRpbGRlID0gMzMzOwogICAgdC5tYWNyb24gPSAzMzM7CiAgICB0LmJyZXZlID0gMzMzOwogICAgdC5kb3RhY2NlbnQgPSAzMzM7CiAgICB0LmRpZXJlc2lzID0gMzMzOwogICAgdC5yaW5nID0gMzMzOwogICAgdC5jZWRpbGxhID0gMzMzOwogICAgdC5odW5nYXJ1bWxhdXQgPSAzMzM7CiAgICB0Lm9nb25layA9IDMzMzsKICAgIHQuY2Fyb24gPSAzMzM7CiAgICB0LmVtZGFzaCA9IDEwMDA7CiAgICB0LkFFID0gMTAwMDsKICAgIHQub3JkZmVtaW5pbmUgPSAzNzA7CiAgICB0LkxzbGFzaCA9IDYxMTsKICAgIHQuT3NsYXNoID0gNzc4OwogICAgdC5PRSA9IDEwMDA7CiAgICB0Lm9yZG1hc2N1bGluZSA9IDM2NTsKICAgIHQuYWUgPSA4ODk7CiAgICB0LmRvdGxlc3NpID0gMjc4OwogICAgdC5sc2xhc2ggPSAyNzg7CiAgICB0Lm9zbGFzaCA9IDYxMTsKICAgIHQub2UgPSA5NDQ7CiAgICB0Lmdlcm1hbmRibHMgPSA2MTE7CiAgICB0LklkaWVyZXNpcyA9IDI3ODsKICAgIHQuZWFjdXRlID0gNTU2OwogICAgdC5hYnJldmUgPSA1NTY7CiAgICB0LnVodW5nYXJ1bWxhdXQgPSA2MTE7CiAgICB0LmVjYXJvbiA9IDU1NjsKICAgIHQuWWRpZXJlc2lzID0gNjY3OwogICAgdC5kaXZpZGUgPSA1ODQ7CiAgICB0LllhY3V0ZSA9IDY2NzsKICAgIHQuQWNpcmN1bWZsZXggPSA3MjI7CiAgICB0LmFhY3V0ZSA9IDU1NjsKICAgIHQuVWNpcmN1bWZsZXggPSA3MjI7CiAgICB0LnlhY3V0ZSA9IDU1NjsKICAgIHQuc2NvbW1hYWNjZW50ID0gNTU2OwogICAgdC5lY2lyY3VtZmxleCA9IDU1NjsKICAgIHQuVXJpbmcgPSA3MjI7CiAgICB0LlVkaWVyZXNpcyA9IDcyMjsKICAgIHQuYW9nb25layA9IDU1NjsKICAgIHQuVWFjdXRlID0gNzIyOwogICAgdC51b2dvbmVrID0gNjExOwogICAgdC5FZGllcmVzaXMgPSA2Njc7CiAgICB0LkRjcm9hdCA9IDcyMjsKICAgIHQuY29tbWFhY2NlbnQgPSAyNTA7CiAgICB0LmNvcHlyaWdodCA9IDczNzsKICAgIHQuRW1hY3JvbiA9IDY2NzsKICAgIHQuY2Nhcm9uID0gNTU2OwogICAgdC5hcmluZyA9IDU1NjsKICAgIHQuTmNvbW1hYWNjZW50ID0gNzIyOwogICAgdC5sYWN1dGUgPSAyNzg7CiAgICB0LmFncmF2ZSA9IDU1NjsKICAgIHQuVGNvbW1hYWNjZW50ID0gNjExOwogICAgdC5DYWN1dGUgPSA3MjI7CiAgICB0LmF0aWxkZSA9IDU1NjsKICAgIHQuRWRvdGFjY2VudCA9IDY2NzsKICAgIHQuc2Nhcm9uID0gNTU2OwogICAgdC5zY2VkaWxsYSA9IDU1NjsKICAgIHQuaWFjdXRlID0gMjc4OwogICAgdC5sb3plbmdlID0gNDk0OwogICAgdC5SY2Fyb24gPSA3MjI7CiAgICB0Lkdjb21tYWFjY2VudCA9IDc3ODsKICAgIHQudWNpcmN1bWZsZXggPSA2MTE7CiAgICB0LmFjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5BbWFjcm9uID0gNzIyOwogICAgdC5yY2Fyb24gPSAzODk7CiAgICB0LmNjZWRpbGxhID0gNTU2OwogICAgdC5aZG90YWNjZW50ID0gNjExOwogICAgdC5UaG9ybiA9IDY2NzsKICAgIHQuT21hY3JvbiA9IDc3ODsKICAgIHQuUmFjdXRlID0gNzIyOwogICAgdC5TYWN1dGUgPSA2Njc7CiAgICB0LmRjYXJvbiA9IDc0MzsKICAgIHQuVW1hY3JvbiA9IDcyMjsKICAgIHQudXJpbmcgPSA2MTE7CiAgICB0LnRocmVlc3VwZXJpb3IgPSAzMzM7CiAgICB0Lk9ncmF2ZSA9IDc3ODsKICAgIHQuQWdyYXZlID0gNzIyOwogICAgdC5BYnJldmUgPSA3MjI7CiAgICB0Lm11bHRpcGx5ID0gNTg0OwogICAgdC51YWN1dGUgPSA2MTE7CiAgICB0LlRjYXJvbiA9IDYxMTsKICAgIHQucGFydGlhbGRpZmYgPSA0OTQ7CiAgICB0LnlkaWVyZXNpcyA9IDU1NjsKICAgIHQuTmFjdXRlID0gNzIyOwogICAgdC5pY2lyY3VtZmxleCA9IDI3ODsKICAgIHQuRWNpcmN1bWZsZXggPSA2Njc7CiAgICB0LmFkaWVyZXNpcyA9IDU1NjsKICAgIHQuZWRpZXJlc2lzID0gNTU2OwogICAgdC5jYWN1dGUgPSA1NTY7CiAgICB0Lm5hY3V0ZSA9IDYxMTsKICAgIHQudW1hY3JvbiA9IDYxMTsKICAgIHQuTmNhcm9uID0gNzIyOwogICAgdC5JYWN1dGUgPSAyNzg7CiAgICB0LnBsdXNtaW51cyA9IDU4NDsKICAgIHQuYnJva2VuYmFyID0gMjgwOwogICAgdC5yZWdpc3RlcmVkID0gNzM3OwogICAgdC5HYnJldmUgPSA3Nzg7CiAgICB0Lklkb3RhY2NlbnQgPSAyNzg7CiAgICB0LnN1bW1hdGlvbiA9IDYwMDsKICAgIHQuRWdyYXZlID0gNjY3OwogICAgdC5yYWN1dGUgPSAzODk7CiAgICB0Lm9tYWNyb24gPSA2MTE7CiAgICB0LlphY3V0ZSA9IDYxMTsKICAgIHQuWmNhcm9uID0gNjExOwogICAgdC5ncmVhdGVyZXF1YWwgPSA1NDk7CiAgICB0LkV0aCA9IDcyMjsKICAgIHQuQ2NlZGlsbGEgPSA3MjI7CiAgICB0Lmxjb21tYWFjY2VudCA9IDI3ODsKICAgIHQudGNhcm9uID0gMzg5OwogICAgdC5lb2dvbmVrID0gNTU2OwogICAgdC5Vb2dvbmVrID0gNzIyOwogICAgdC5BYWN1dGUgPSA3MjI7CiAgICB0LkFkaWVyZXNpcyA9IDcyMjsKICAgIHQuZWdyYXZlID0gNTU2OwogICAgdC56YWN1dGUgPSA1MDA7CiAgICB0LmlvZ29uZWsgPSAyNzg7CiAgICB0Lk9hY3V0ZSA9IDc3ODsKICAgIHQub2FjdXRlID0gNjExOwogICAgdC5hbWFjcm9uID0gNTU2OwogICAgdC5zYWN1dGUgPSA1NTY7CiAgICB0LmlkaWVyZXNpcyA9IDI3ODsKICAgIHQuT2NpcmN1bWZsZXggPSA3Nzg7CiAgICB0LlVncmF2ZSA9IDcyMjsKICAgIHQuRGVsdGEgPSA2MTI7CiAgICB0LnRob3JuID0gNjExOwogICAgdC50d29zdXBlcmlvciA9IDMzMzsKICAgIHQuT2RpZXJlc2lzID0gNzc4OwogICAgdC5tdSA9IDYxMTsKICAgIHQuaWdyYXZlID0gMjc4OwogICAgdC5vaHVuZ2FydW1sYXV0ID0gNjExOwogICAgdC5Fb2dvbmVrID0gNjY3OwogICAgdC5kY3JvYXQgPSA2MTE7CiAgICB0LnRocmVlcXVhcnRlcnMgPSA4MzQ7CiAgICB0LlNjZWRpbGxhID0gNjY3OwogICAgdC5sY2Fyb24gPSA0MDA7CiAgICB0Lktjb21tYWFjY2VudCA9IDcyMjsKICAgIHQuTGFjdXRlID0gNjExOwogICAgdC50cmFkZW1hcmsgPSAxMDAwOwogICAgdC5lZG90YWNjZW50ID0gNTU2OwogICAgdC5JZ3JhdmUgPSAyNzg7CiAgICB0LkltYWNyb24gPSAyNzg7CiAgICB0LkxjYXJvbiA9IDYxMTsKICAgIHQub25laGFsZiA9IDgzNDsKICAgIHQubGVzc2VxdWFsID0gNTQ5OwogICAgdC5vY2lyY3VtZmxleCA9IDYxMTsKICAgIHQubnRpbGRlID0gNjExOwogICAgdC5VaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5FYWN1dGUgPSA2Njc7CiAgICB0LmVtYWNyb24gPSA1NTY7CiAgICB0LmdicmV2ZSA9IDYxMTsKICAgIHQub25lcXVhcnRlciA9IDgzNDsKICAgIHQuU2Nhcm9uID0gNjY3OwogICAgdC5TY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0Lk9odW5nYXJ1bWxhdXQgPSA3Nzg7CiAgICB0LmRlZ3JlZSA9IDQwMDsKICAgIHQub2dyYXZlID0gNjExOwogICAgdC5DY2Fyb24gPSA3MjI7CiAgICB0LnVncmF2ZSA9IDYxMTsKICAgIHQucmFkaWNhbCA9IDU0OTsKICAgIHQuRGNhcm9uID0gNzIyOwogICAgdC5yY29tbWFhY2NlbnQgPSAzODk7CiAgICB0Lk50aWxkZSA9IDcyMjsKICAgIHQub3RpbGRlID0gNjExOwogICAgdC5SY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0Lkxjb21tYWFjY2VudCA9IDYxMTsKICAgIHQuQXRpbGRlID0gNzIyOwogICAgdC5Bb2dvbmVrID0gNzIyOwogICAgdC5BcmluZyA9IDcyMjsKICAgIHQuT3RpbGRlID0gNzc4OwogICAgdC56ZG90YWNjZW50ID0gNTAwOwogICAgdC5FY2Fyb24gPSA2Njc7CiAgICB0LklvZ29uZWsgPSAyNzg7CiAgICB0Lmtjb21tYWFjY2VudCA9IDU1NjsKICAgIHQubWludXMgPSA1ODQ7CiAgICB0LkljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5uY2Fyb24gPSA2MTE7CiAgICB0LnRjb21tYWFjY2VudCA9IDMzMzsKICAgIHQubG9naWNhbG5vdCA9IDU4NDsKICAgIHQub2RpZXJlc2lzID0gNjExOwogICAgdC51ZGllcmVzaXMgPSA2MTE7CiAgICB0Lm5vdGVxdWFsID0gNTQ5OwogICAgdC5nY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LmV0aCA9IDYxMTsKICAgIHQuemNhcm9uID0gNTAwOwogICAgdC5uY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0Lm9uZXN1cGVyaW9yID0gMzMzOwogICAgdC5pbWFjcm9uID0gMjc4OwogICAgdC5FdXJvID0gNTU2OwogIH0pOwogIHRbIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSJdID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgICB0LnNwYWNlID0gMjc4OwogICAgdC5leGNsYW0gPSAzMzM7CiAgICB0LnF1b3RlZGJsID0gNDc0OwogICAgdC5udW1iZXJzaWduID0gNTU2OwogICAgdC5kb2xsYXIgPSA1NTY7CiAgICB0LnBlcmNlbnQgPSA4ODk7CiAgICB0LmFtcGVyc2FuZCA9IDcyMjsKICAgIHQucXVvdGVyaWdodCA9IDI3ODsKICAgIHQucGFyZW5sZWZ0ID0gMzMzOwogICAgdC5wYXJlbnJpZ2h0ID0gMzMzOwogICAgdC5hc3RlcmlzayA9IDM4OTsKICAgIHQucGx1cyA9IDU4NDsKICAgIHQuY29tbWEgPSAyNzg7CiAgICB0Lmh5cGhlbiA9IDMzMzsKICAgIHQucGVyaW9kID0gMjc4OwogICAgdC5zbGFzaCA9IDI3ODsKICAgIHQuemVybyA9IDU1NjsKICAgIHQub25lID0gNTU2OwogICAgdC50d28gPSA1NTY7CiAgICB0LnRocmVlID0gNTU2OwogICAgdC5mb3VyID0gNTU2OwogICAgdC5maXZlID0gNTU2OwogICAgdC5zaXggPSA1NTY7CiAgICB0LnNldmVuID0gNTU2OwogICAgdC5laWdodCA9IDU1NjsKICAgIHQubmluZSA9IDU1NjsKICAgIHQuY29sb24gPSAzMzM7CiAgICB0LnNlbWljb2xvbiA9IDMzMzsKICAgIHQubGVzcyA9IDU4NDsKICAgIHQuZXF1YWwgPSA1ODQ7CiAgICB0LmdyZWF0ZXIgPSA1ODQ7CiAgICB0LnF1ZXN0aW9uID0gNjExOwogICAgdC5hdCA9IDk3NTsKICAgIHQuQSA9IDcyMjsKICAgIHQuQiA9IDcyMjsKICAgIHQuQyA9IDcyMjsKICAgIHQuRCA9IDcyMjsKICAgIHQuRSA9IDY2NzsKICAgIHQuRiA9IDYxMTsKICAgIHQuRyA9IDc3ODsKICAgIHQuSCA9IDcyMjsKICAgIHQuSSA9IDI3ODsKICAgIHQuSiA9IDU1NjsKICAgIHQuSyA9IDcyMjsKICAgIHQuTCA9IDYxMTsKICAgIHQuTSA9IDgzMzsKICAgIHQuTiA9IDcyMjsKICAgIHQuTyA9IDc3ODsKICAgIHQuUCA9IDY2NzsKICAgIHQuUSA9IDc3ODsKICAgIHQuUiA9IDcyMjsKICAgIHQuUyA9IDY2NzsKICAgIHQuVCA9IDYxMTsKICAgIHQuVSA9IDcyMjsKICAgIHQuViA9IDY2NzsKICAgIHQuVyA9IDk0NDsKICAgIHQuWCA9IDY2NzsKICAgIHQuWSA9IDY2NzsKICAgIHQuWiA9IDYxMTsKICAgIHQuYnJhY2tldGxlZnQgPSAzMzM7CiAgICB0LmJhY2tzbGFzaCA9IDI3ODsKICAgIHQuYnJhY2tldHJpZ2h0ID0gMzMzOwogICAgdC5hc2NpaWNpcmN1bSA9IDU4NDsKICAgIHQudW5kZXJzY29yZSA9IDU1NjsKICAgIHQucXVvdGVsZWZ0ID0gMjc4OwogICAgdC5hID0gNTU2OwogICAgdC5iID0gNjExOwogICAgdC5jID0gNTU2OwogICAgdC5kID0gNjExOwogICAgdC5lID0gNTU2OwogICAgdC5mID0gMzMzOwogICAgdC5nID0gNjExOwogICAgdC5oID0gNjExOwogICAgdC5pID0gMjc4OwogICAgdC5qID0gMjc4OwogICAgdC5rID0gNTU2OwogICAgdC5sID0gMjc4OwogICAgdC5tID0gODg5OwogICAgdC5uID0gNjExOwogICAgdC5vID0gNjExOwogICAgdC5wID0gNjExOwogICAgdC5xID0gNjExOwogICAgdC5yID0gMzg5OwogICAgdC5zID0gNTU2OwogICAgdC50ID0gMzMzOwogICAgdC51ID0gNjExOwogICAgdC52ID0gNTU2OwogICAgdC53ID0gNzc4OwogICAgdC54ID0gNTU2OwogICAgdC55ID0gNTU2OwogICAgdC56ID0gNTAwOwogICAgdC5icmFjZWxlZnQgPSAzODk7CiAgICB0LmJhciA9IDI4MDsKICAgIHQuYnJhY2VyaWdodCA9IDM4OTsKICAgIHQuYXNjaWl0aWxkZSA9IDU4NDsKICAgIHQuZXhjbGFtZG93biA9IDMzMzsKICAgIHQuY2VudCA9IDU1NjsKICAgIHQuc3RlcmxpbmcgPSA1NTY7CiAgICB0LmZyYWN0aW9uID0gMTY3OwogICAgdC55ZW4gPSA1NTY7CiAgICB0LmZsb3JpbiA9IDU1NjsKICAgIHQuc2VjdGlvbiA9IDU1NjsKICAgIHQuY3VycmVuY3kgPSA1NTY7CiAgICB0LnF1b3Rlc2luZ2xlID0gMjM4OwogICAgdC5xdW90ZWRibGxlZnQgPSA1MDA7CiAgICB0Lmd1aWxsZW1vdGxlZnQgPSA1NTY7CiAgICB0Lmd1aWxzaW5nbGxlZnQgPSAzMzM7CiAgICB0Lmd1aWxzaW5nbHJpZ2h0ID0gMzMzOwogICAgdC5maSA9IDYxMTsKICAgIHQuZmwgPSA2MTE7CiAgICB0LmVuZGFzaCA9IDU1NjsKICAgIHQuZGFnZ2VyID0gNTU2OwogICAgdC5kYWdnZXJkYmwgPSA1NTY7CiAgICB0LnBlcmlvZGNlbnRlcmVkID0gMjc4OwogICAgdC5wYXJhZ3JhcGggPSA1NTY7CiAgICB0LmJ1bGxldCA9IDM1MDsKICAgIHQucXVvdGVzaW5nbGJhc2UgPSAyNzg7CiAgICB0LnF1b3RlZGJsYmFzZSA9IDUwMDsKICAgIHQucXVvdGVkYmxyaWdodCA9IDUwMDsKICAgIHQuZ3VpbGxlbW90cmlnaHQgPSA1NTY7CiAgICB0LmVsbGlwc2lzID0gMTAwMDsKICAgIHQucGVydGhvdXNhbmQgPSAxMDAwOwogICAgdC5xdWVzdGlvbmRvd24gPSA2MTE7CiAgICB0LmdyYXZlID0gMzMzOwogICAgdC5hY3V0ZSA9IDMzMzsKICAgIHQuY2lyY3VtZmxleCA9IDMzMzsKICAgIHQudGlsZGUgPSAzMzM7CiAgICB0Lm1hY3JvbiA9IDMzMzsKICAgIHQuYnJldmUgPSAzMzM7CiAgICB0LmRvdGFjY2VudCA9IDMzMzsKICAgIHQuZGllcmVzaXMgPSAzMzM7CiAgICB0LnJpbmcgPSAzMzM7CiAgICB0LmNlZGlsbGEgPSAzMzM7CiAgICB0Lmh1bmdhcnVtbGF1dCA9IDMzMzsKICAgIHQub2dvbmVrID0gMzMzOwogICAgdC5jYXJvbiA9IDMzMzsKICAgIHQuZW1kYXNoID0gMTAwMDsKICAgIHQuQUUgPSAxMDAwOwogICAgdC5vcmRmZW1pbmluZSA9IDM3MDsKICAgIHQuTHNsYXNoID0gNjExOwogICAgdC5Pc2xhc2ggPSA3Nzg7CiAgICB0Lk9FID0gMTAwMDsKICAgIHQub3JkbWFzY3VsaW5lID0gMzY1OwogICAgdC5hZSA9IDg4OTsKICAgIHQuZG90bGVzc2kgPSAyNzg7CiAgICB0LmxzbGFzaCA9IDI3ODsKICAgIHQub3NsYXNoID0gNjExOwogICAgdC5vZSA9IDk0NDsKICAgIHQuZ2VybWFuZGJscyA9IDYxMTsKICAgIHQuSWRpZXJlc2lzID0gMjc4OwogICAgdC5lYWN1dGUgPSA1NTY7CiAgICB0LmFicmV2ZSA9IDU1NjsKICAgIHQudWh1bmdhcnVtbGF1dCA9IDYxMTsKICAgIHQuZWNhcm9uID0gNTU2OwogICAgdC5ZZGllcmVzaXMgPSA2Njc7CiAgICB0LmRpdmlkZSA9IDU4NDsKICAgIHQuWWFjdXRlID0gNjY3OwogICAgdC5BY2lyY3VtZmxleCA9IDcyMjsKICAgIHQuYWFjdXRlID0gNTU2OwogICAgdC5VY2lyY3VtZmxleCA9IDcyMjsKICAgIHQueWFjdXRlID0gNTU2OwogICAgdC5zY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0LmVjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5VcmluZyA9IDcyMjsKICAgIHQuVWRpZXJlc2lzID0gNzIyOwogICAgdC5hb2dvbmVrID0gNTU2OwogICAgdC5VYWN1dGUgPSA3MjI7CiAgICB0LnVvZ29uZWsgPSA2MTE7CiAgICB0LkVkaWVyZXNpcyA9IDY2NzsKICAgIHQuRGNyb2F0ID0gNzIyOwogICAgdC5jb21tYWFjY2VudCA9IDI1MDsKICAgIHQuY29weXJpZ2h0ID0gNzM3OwogICAgdC5FbWFjcm9uID0gNjY3OwogICAgdC5jY2Fyb24gPSA1NTY7CiAgICB0LmFyaW5nID0gNTU2OwogICAgdC5OY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LmxhY3V0ZSA9IDI3ODsKICAgIHQuYWdyYXZlID0gNTU2OwogICAgdC5UY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkNhY3V0ZSA9IDcyMjsKICAgIHQuYXRpbGRlID0gNTU2OwogICAgdC5FZG90YWNjZW50ID0gNjY3OwogICAgdC5zY2Fyb24gPSA1NTY7CiAgICB0LnNjZWRpbGxhID0gNTU2OwogICAgdC5pYWN1dGUgPSAyNzg7CiAgICB0LmxvemVuZ2UgPSA0OTQ7CiAgICB0LlJjYXJvbiA9IDcyMjsKICAgIHQuR2NvbW1hYWNjZW50ID0gNzc4OwogICAgdC51Y2lyY3VtZmxleCA9IDYxMTsKICAgIHQuYWNpcmN1bWZsZXggPSA1NTY7CiAgICB0LkFtYWNyb24gPSA3MjI7CiAgICB0LnJjYXJvbiA9IDM4OTsKICAgIHQuY2NlZGlsbGEgPSA1NTY7CiAgICB0Llpkb3RhY2NlbnQgPSA2MTE7CiAgICB0LlRob3JuID0gNjY3OwogICAgdC5PbWFjcm9uID0gNzc4OwogICAgdC5SYWN1dGUgPSA3MjI7CiAgICB0LlNhY3V0ZSA9IDY2NzsKICAgIHQuZGNhcm9uID0gNzQzOwogICAgdC5VbWFjcm9uID0gNzIyOwogICAgdC51cmluZyA9IDYxMTsKICAgIHQudGhyZWVzdXBlcmlvciA9IDMzMzsKICAgIHQuT2dyYXZlID0gNzc4OwogICAgdC5BZ3JhdmUgPSA3MjI7CiAgICB0LkFicmV2ZSA9IDcyMjsKICAgIHQubXVsdGlwbHkgPSA1ODQ7CiAgICB0LnVhY3V0ZSA9IDYxMTsKICAgIHQuVGNhcm9uID0gNjExOwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ5NDsKICAgIHQueWRpZXJlc2lzID0gNTU2OwogICAgdC5OYWN1dGUgPSA3MjI7CiAgICB0LmljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5FY2lyY3VtZmxleCA9IDY2NzsKICAgIHQuYWRpZXJlc2lzID0gNTU2OwogICAgdC5lZGllcmVzaXMgPSA1NTY7CiAgICB0LmNhY3V0ZSA9IDU1NjsKICAgIHQubmFjdXRlID0gNjExOwogICAgdC51bWFjcm9uID0gNjExOwogICAgdC5OY2Fyb24gPSA3MjI7CiAgICB0LklhY3V0ZSA9IDI3ODsKICAgIHQucGx1c21pbnVzID0gNTg0OwogICAgdC5icm9rZW5iYXIgPSAyODA7CiAgICB0LnJlZ2lzdGVyZWQgPSA3Mzc7CiAgICB0LkdicmV2ZSA9IDc3ODsKICAgIHQuSWRvdGFjY2VudCA9IDI3ODsKICAgIHQuc3VtbWF0aW9uID0gNjAwOwogICAgdC5FZ3JhdmUgPSA2Njc7CiAgICB0LnJhY3V0ZSA9IDM4OTsKICAgIHQub21hY3JvbiA9IDYxMTsKICAgIHQuWmFjdXRlID0gNjExOwogICAgdC5aY2Fyb24gPSA2MTE7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQuRXRoID0gNzIyOwogICAgdC5DY2VkaWxsYSA9IDcyMjsKICAgIHQubGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC50Y2Fyb24gPSAzODk7CiAgICB0LmVvZ29uZWsgPSA1NTY7CiAgICB0LlVvZ29uZWsgPSA3MjI7CiAgICB0LkFhY3V0ZSA9IDcyMjsKICAgIHQuQWRpZXJlc2lzID0gNzIyOwogICAgdC5lZ3JhdmUgPSA1NTY7CiAgICB0LnphY3V0ZSA9IDUwMDsKICAgIHQuaW9nb25layA9IDI3ODsKICAgIHQuT2FjdXRlID0gNzc4OwogICAgdC5vYWN1dGUgPSA2MTE7CiAgICB0LmFtYWNyb24gPSA1NTY7CiAgICB0LnNhY3V0ZSA9IDU1NjsKICAgIHQuaWRpZXJlc2lzID0gMjc4OwogICAgdC5PY2lyY3VtZmxleCA9IDc3ODsKICAgIHQuVWdyYXZlID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQudGhvcm4gPSA2MTE7CiAgICB0LnR3b3N1cGVyaW9yID0gMzMzOwogICAgdC5PZGllcmVzaXMgPSA3Nzg7CiAgICB0Lm11ID0gNjExOwogICAgdC5pZ3JhdmUgPSAyNzg7CiAgICB0Lm9odW5nYXJ1bWxhdXQgPSA2MTE7CiAgICB0LkVvZ29uZWsgPSA2Njc7CiAgICB0LmRjcm9hdCA9IDYxMTsKICAgIHQudGhyZWVxdWFydGVycyA9IDgzNDsKICAgIHQuU2NlZGlsbGEgPSA2Njc7CiAgICB0LmxjYXJvbiA9IDQwMDsKICAgIHQuS2NvbW1hYWNjZW50ID0gNzIyOwogICAgdC5MYWN1dGUgPSA2MTE7CiAgICB0LnRyYWRlbWFyayA9IDEwMDA7CiAgICB0LmVkb3RhY2NlbnQgPSA1NTY7CiAgICB0LklncmF2ZSA9IDI3ODsKICAgIHQuSW1hY3JvbiA9IDI3ODsKICAgIHQuTGNhcm9uID0gNjExOwogICAgdC5vbmVoYWxmID0gODM0OwogICAgdC5sZXNzZXF1YWwgPSA1NDk7CiAgICB0Lm9jaXJjdW1mbGV4ID0gNjExOwogICAgdC5udGlsZGUgPSA2MTE7CiAgICB0LlVodW5nYXJ1bWxhdXQgPSA3MjI7CiAgICB0LkVhY3V0ZSA9IDY2NzsKICAgIHQuZW1hY3JvbiA9IDU1NjsKICAgIHQuZ2JyZXZlID0gNjExOwogICAgdC5vbmVxdWFydGVyID0gODM0OwogICAgdC5TY2Fyb24gPSA2Njc7CiAgICB0LlNjb21tYWFjY2VudCA9IDY2NzsKICAgIHQuT2h1bmdhcnVtbGF1dCA9IDc3ODsKICAgIHQuZGVncmVlID0gNDAwOwogICAgdC5vZ3JhdmUgPSA2MTE7CiAgICB0LkNjYXJvbiA9IDcyMjsKICAgIHQudWdyYXZlID0gNjExOwogICAgdC5yYWRpY2FsID0gNTQ5OwogICAgdC5EY2Fyb24gPSA3MjI7CiAgICB0LnJjb21tYWFjY2VudCA9IDM4OTsKICAgIHQuTnRpbGRlID0gNzIyOwogICAgdC5vdGlsZGUgPSA2MTE7CiAgICB0LlJjb21tYWFjY2VudCA9IDcyMjsKICAgIHQuTGNvbW1hYWNjZW50ID0gNjExOwogICAgdC5BdGlsZGUgPSA3MjI7CiAgICB0LkFvZ29uZWsgPSA3MjI7CiAgICB0LkFyaW5nID0gNzIyOwogICAgdC5PdGlsZGUgPSA3Nzg7CiAgICB0Lnpkb3RhY2NlbnQgPSA1MDA7CiAgICB0LkVjYXJvbiA9IDY2NzsKICAgIHQuSW9nb25layA9IDI3ODsKICAgIHQua2NvbW1hYWNjZW50ID0gNTU2OwogICAgdC5taW51cyA9IDU4NDsKICAgIHQuSWNpcmN1bWZsZXggPSAyNzg7CiAgICB0Lm5jYXJvbiA9IDYxMTsKICAgIHQudGNvbW1hYWNjZW50ID0gMzMzOwogICAgdC5sb2dpY2Fsbm90ID0gNTg0OwogICAgdC5vZGllcmVzaXMgPSA2MTE7CiAgICB0LnVkaWVyZXNpcyA9IDYxMTsKICAgIHQubm90ZXF1YWwgPSA1NDk7CiAgICB0Lmdjb21tYWFjY2VudCA9IDYxMTsKICAgIHQuZXRoID0gNjExOwogICAgdC56Y2Fyb24gPSA1MDA7CiAgICB0Lm5jb21tYWFjY2VudCA9IDYxMTsKICAgIHQub25lc3VwZXJpb3IgPSAzMzM7CiAgICB0LmltYWNyb24gPSAyNzg7CiAgICB0LkV1cm8gPSA1NTY7CiAgfSk7CiAgdFsiSGVsdmV0aWNhLU9ibGlxdWUiXSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI3ODsKICAgIHQuZXhjbGFtID0gMjc4OwogICAgdC5xdW90ZWRibCA9IDM1NTsKICAgIHQubnVtYmVyc2lnbiA9IDU1NjsKICAgIHQuZG9sbGFyID0gNTU2OwogICAgdC5wZXJjZW50ID0gODg5OwogICAgdC5hbXBlcnNhbmQgPSA2Njc7CiAgICB0LnF1b3RlcmlnaHQgPSAyMjI7CiAgICB0LnBhcmVubGVmdCA9IDMzMzsKICAgIHQucGFyZW5yaWdodCA9IDMzMzsKICAgIHQuYXN0ZXJpc2sgPSAzODk7CiAgICB0LnBsdXMgPSA1ODQ7CiAgICB0LmNvbW1hID0gMjc4OwogICAgdC5oeXBoZW4gPSAzMzM7CiAgICB0LnBlcmlvZCA9IDI3ODsKICAgIHQuc2xhc2ggPSAyNzg7CiAgICB0Lnplcm8gPSA1NTY7CiAgICB0Lm9uZSA9IDU1NjsKICAgIHQudHdvID0gNTU2OwogICAgdC50aHJlZSA9IDU1NjsKICAgIHQuZm91ciA9IDU1NjsKICAgIHQuZml2ZSA9IDU1NjsKICAgIHQuc2l4ID0gNTU2OwogICAgdC5zZXZlbiA9IDU1NjsKICAgIHQuZWlnaHQgPSA1NTY7CiAgICB0Lm5pbmUgPSA1NTY7CiAgICB0LmNvbG9uID0gMjc4OwogICAgdC5zZW1pY29sb24gPSAyNzg7CiAgICB0Lmxlc3MgPSA1ODQ7CiAgICB0LmVxdWFsID0gNTg0OwogICAgdC5ncmVhdGVyID0gNTg0OwogICAgdC5xdWVzdGlvbiA9IDU1NjsKICAgIHQuYXQgPSAxMDE1OwogICAgdC5BID0gNjY3OwogICAgdC5CID0gNjY3OwogICAgdC5DID0gNzIyOwogICAgdC5EID0gNzIyOwogICAgdC5FID0gNjY3OwogICAgdC5GID0gNjExOwogICAgdC5HID0gNzc4OwogICAgdC5IID0gNzIyOwogICAgdC5JID0gMjc4OwogICAgdC5KID0gNTAwOwogICAgdC5LID0gNjY3OwogICAgdC5MID0gNTU2OwogICAgdC5NID0gODMzOwogICAgdC5OID0gNzIyOwogICAgdC5PID0gNzc4OwogICAgdC5QID0gNjY3OwogICAgdC5RID0gNzc4OwogICAgdC5SID0gNzIyOwogICAgdC5TID0gNjY3OwogICAgdC5UID0gNjExOwogICAgdC5VID0gNzIyOwogICAgdC5WID0gNjY3OwogICAgdC5XID0gOTQ0OwogICAgdC5YID0gNjY3OwogICAgdC5ZID0gNjY3OwogICAgdC5aID0gNjExOwogICAgdC5icmFja2V0bGVmdCA9IDI3ODsKICAgIHQuYmFja3NsYXNoID0gMjc4OwogICAgdC5icmFja2V0cmlnaHQgPSAyNzg7CiAgICB0LmFzY2lpY2lyY3VtID0gNDY5OwogICAgdC51bmRlcnNjb3JlID0gNTU2OwogICAgdC5xdW90ZWxlZnQgPSAyMjI7CiAgICB0LmEgPSA1NTY7CiAgICB0LmIgPSA1NTY7CiAgICB0LmMgPSA1MDA7CiAgICB0LmQgPSA1NTY7CiAgICB0LmUgPSA1NTY7CiAgICB0LmYgPSAyNzg7CiAgICB0LmcgPSA1NTY7CiAgICB0LmggPSA1NTY7CiAgICB0LmkgPSAyMjI7CiAgICB0LmogPSAyMjI7CiAgICB0LmsgPSA1MDA7CiAgICB0LmwgPSAyMjI7CiAgICB0Lm0gPSA4MzM7CiAgICB0Lm4gPSA1NTY7CiAgICB0Lm8gPSA1NTY7CiAgICB0LnAgPSA1NTY7CiAgICB0LnEgPSA1NTY7CiAgICB0LnIgPSAzMzM7CiAgICB0LnMgPSA1MDA7CiAgICB0LnQgPSAyNzg7CiAgICB0LnUgPSA1NTY7CiAgICB0LnYgPSA1MDA7CiAgICB0LncgPSA3MjI7CiAgICB0LnggPSA1MDA7CiAgICB0LnkgPSA1MDA7CiAgICB0LnogPSA1MDA7CiAgICB0LmJyYWNlbGVmdCA9IDMzNDsKICAgIHQuYmFyID0gMjYwOwogICAgdC5icmFjZXJpZ2h0ID0gMzM0OwogICAgdC5hc2NpaXRpbGRlID0gNTg0OwogICAgdC5leGNsYW1kb3duID0gMzMzOwogICAgdC5jZW50ID0gNTU2OwogICAgdC5zdGVybGluZyA9IDU1NjsKICAgIHQuZnJhY3Rpb24gPSAxNjc7CiAgICB0LnllbiA9IDU1NjsKICAgIHQuZmxvcmluID0gNTU2OwogICAgdC5zZWN0aW9uID0gNTU2OwogICAgdC5jdXJyZW5jeSA9IDU1NjsKICAgIHQucXVvdGVzaW5nbGUgPSAxOTE7CiAgICB0LnF1b3RlZGJsbGVmdCA9IDMzMzsKICAgIHQuZ3VpbGxlbW90bGVmdCA9IDU1NjsKICAgIHQuZ3VpbHNpbmdsbGVmdCA9IDMzMzsKICAgIHQuZ3VpbHNpbmdscmlnaHQgPSAzMzM7CiAgICB0LmZpID0gNTAwOwogICAgdC5mbCA9IDUwMDsKICAgIHQuZW5kYXNoID0gNTU2OwogICAgdC5kYWdnZXIgPSA1NTY7CiAgICB0LmRhZ2dlcmRibCA9IDU1NjsKICAgIHQucGVyaW9kY2VudGVyZWQgPSAyNzg7CiAgICB0LnBhcmFncmFwaCA9IDUzNzsKICAgIHQuYnVsbGV0ID0gMzUwOwogICAgdC5xdW90ZXNpbmdsYmFzZSA9IDIyMjsKICAgIHQucXVvdGVkYmxiYXNlID0gMzMzOwogICAgdC5xdW90ZWRibHJpZ2h0ID0gMzMzOwogICAgdC5ndWlsbGVtb3RyaWdodCA9IDU1NjsKICAgIHQuZWxsaXBzaXMgPSAxMDAwOwogICAgdC5wZXJ0aG91c2FuZCA9IDEwMDA7CiAgICB0LnF1ZXN0aW9uZG93biA9IDYxMTsKICAgIHQuZ3JhdmUgPSAzMzM7CiAgICB0LmFjdXRlID0gMzMzOwogICAgdC5jaXJjdW1mbGV4ID0gMzMzOwogICAgdC50aWxkZSA9IDMzMzsKICAgIHQubWFjcm9uID0gMzMzOwogICAgdC5icmV2ZSA9IDMzMzsKICAgIHQuZG90YWNjZW50ID0gMzMzOwogICAgdC5kaWVyZXNpcyA9IDMzMzsKICAgIHQucmluZyA9IDMzMzsKICAgIHQuY2VkaWxsYSA9IDMzMzsKICAgIHQuaHVuZ2FydW1sYXV0ID0gMzMzOwogICAgdC5vZ29uZWsgPSAzMzM7CiAgICB0LmNhcm9uID0gMzMzOwogICAgdC5lbWRhc2ggPSAxMDAwOwogICAgdC5BRSA9IDEwMDA7CiAgICB0Lm9yZGZlbWluaW5lID0gMzcwOwogICAgdC5Mc2xhc2ggPSA1NTY7CiAgICB0Lk9zbGFzaCA9IDc3ODsKICAgIHQuT0UgPSAxMDAwOwogICAgdC5vcmRtYXNjdWxpbmUgPSAzNjU7CiAgICB0LmFlID0gODg5OwogICAgdC5kb3RsZXNzaSA9IDI3ODsKICAgIHQubHNsYXNoID0gMjIyOwogICAgdC5vc2xhc2ggPSA2MTE7CiAgICB0Lm9lID0gOTQ0OwogICAgdC5nZXJtYW5kYmxzID0gNjExOwogICAgdC5JZGllcmVzaXMgPSAyNzg7CiAgICB0LmVhY3V0ZSA9IDU1NjsKICAgIHQuYWJyZXZlID0gNTU2OwogICAgdC51aHVuZ2FydW1sYXV0ID0gNTU2OwogICAgdC5lY2Fyb24gPSA1NTY7CiAgICB0LllkaWVyZXNpcyA9IDY2NzsKICAgIHQuZGl2aWRlID0gNTg0OwogICAgdC5ZYWN1dGUgPSA2Njc7CiAgICB0LkFjaXJjdW1mbGV4ID0gNjY3OwogICAgdC5hYWN1dGUgPSA1NTY7CiAgICB0LlVjaXJjdW1mbGV4ID0gNzIyOwogICAgdC55YWN1dGUgPSA1MDA7CiAgICB0LnNjb21tYWFjY2VudCA9IDUwMDsKICAgIHQuZWNpcmN1bWZsZXggPSA1NTY7CiAgICB0LlVyaW5nID0gNzIyOwogICAgdC5VZGllcmVzaXMgPSA3MjI7CiAgICB0LmFvZ29uZWsgPSA1NTY7CiAgICB0LlVhY3V0ZSA9IDcyMjsKICAgIHQudW9nb25layA9IDU1NjsKICAgIHQuRWRpZXJlc2lzID0gNjY3OwogICAgdC5EY3JvYXQgPSA3MjI7CiAgICB0LmNvbW1hYWNjZW50ID0gMjUwOwogICAgdC5jb3B5cmlnaHQgPSA3Mzc7CiAgICB0LkVtYWNyb24gPSA2Njc7CiAgICB0LmNjYXJvbiA9IDUwMDsKICAgIHQuYXJpbmcgPSA1NTY7CiAgICB0Lk5jb21tYWFjY2VudCA9IDcyMjsKICAgIHQubGFjdXRlID0gMjIyOwogICAgdC5hZ3JhdmUgPSA1NTY7CiAgICB0LlRjb21tYWFjY2VudCA9IDYxMTsKICAgIHQuQ2FjdXRlID0gNzIyOwogICAgdC5hdGlsZGUgPSA1NTY7CiAgICB0LkVkb3RhY2NlbnQgPSA2Njc7CiAgICB0LnNjYXJvbiA9IDUwMDsKICAgIHQuc2NlZGlsbGEgPSA1MDA7CiAgICB0LmlhY3V0ZSA9IDI3ODsKICAgIHQubG96ZW5nZSA9IDQ3MTsKICAgIHQuUmNhcm9uID0gNzIyOwogICAgdC5HY29tbWFhY2NlbnQgPSA3Nzg7CiAgICB0LnVjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5hY2lyY3VtZmxleCA9IDU1NjsKICAgIHQuQW1hY3JvbiA9IDY2NzsKICAgIHQucmNhcm9uID0gMzMzOwogICAgdC5jY2VkaWxsYSA9IDUwMDsKICAgIHQuWmRvdGFjY2VudCA9IDYxMTsKICAgIHQuVGhvcm4gPSA2Njc7CiAgICB0Lk9tYWNyb24gPSA3Nzg7CiAgICB0LlJhY3V0ZSA9IDcyMjsKICAgIHQuU2FjdXRlID0gNjY3OwogICAgdC5kY2Fyb24gPSA2NDM7CiAgICB0LlVtYWNyb24gPSA3MjI7CiAgICB0LnVyaW5nID0gNTU2OwogICAgdC50aHJlZXN1cGVyaW9yID0gMzMzOwogICAgdC5PZ3JhdmUgPSA3Nzg7CiAgICB0LkFncmF2ZSA9IDY2NzsKICAgIHQuQWJyZXZlID0gNjY3OwogICAgdC5tdWx0aXBseSA9IDU4NDsKICAgIHQudWFjdXRlID0gNTU2OwogICAgdC5UY2Fyb24gPSA2MTE7CiAgICB0LnBhcnRpYWxkaWZmID0gNDc2OwogICAgdC55ZGllcmVzaXMgPSA1MDA7CiAgICB0Lk5hY3V0ZSA9IDcyMjsKICAgIHQuaWNpcmN1bWZsZXggPSAyNzg7CiAgICB0LkVjaXJjdW1mbGV4ID0gNjY3OwogICAgdC5hZGllcmVzaXMgPSA1NTY7CiAgICB0LmVkaWVyZXNpcyA9IDU1NjsKICAgIHQuY2FjdXRlID0gNTAwOwogICAgdC5uYWN1dGUgPSA1NTY7CiAgICB0LnVtYWNyb24gPSA1NTY7CiAgICB0Lk5jYXJvbiA9IDcyMjsKICAgIHQuSWFjdXRlID0gMjc4OwogICAgdC5wbHVzbWludXMgPSA1ODQ7CiAgICB0LmJyb2tlbmJhciA9IDI2MDsKICAgIHQucmVnaXN0ZXJlZCA9IDczNzsKICAgIHQuR2JyZXZlID0gNzc4OwogICAgdC5JZG90YWNjZW50ID0gMjc4OwogICAgdC5zdW1tYXRpb24gPSA2MDA7CiAgICB0LkVncmF2ZSA9IDY2NzsKICAgIHQucmFjdXRlID0gMzMzOwogICAgdC5vbWFjcm9uID0gNTU2OwogICAgdC5aYWN1dGUgPSA2MTE7CiAgICB0LlpjYXJvbiA9IDYxMTsKICAgIHQuZ3JlYXRlcmVxdWFsID0gNTQ5OwogICAgdC5FdGggPSA3MjI7CiAgICB0LkNjZWRpbGxhID0gNzIyOwogICAgdC5sY29tbWFhY2NlbnQgPSAyMjI7CiAgICB0LnRjYXJvbiA9IDMxNzsKICAgIHQuZW9nb25layA9IDU1NjsKICAgIHQuVW9nb25layA9IDcyMjsKICAgIHQuQWFjdXRlID0gNjY3OwogICAgdC5BZGllcmVzaXMgPSA2Njc7CiAgICB0LmVncmF2ZSA9IDU1NjsKICAgIHQuemFjdXRlID0gNTAwOwogICAgdC5pb2dvbmVrID0gMjIyOwogICAgdC5PYWN1dGUgPSA3Nzg7CiAgICB0Lm9hY3V0ZSA9IDU1NjsKICAgIHQuYW1hY3JvbiA9IDU1NjsKICAgIHQuc2FjdXRlID0gNTAwOwogICAgdC5pZGllcmVzaXMgPSAyNzg7CiAgICB0Lk9jaXJjdW1mbGV4ID0gNzc4OwogICAgdC5VZ3JhdmUgPSA3MjI7CiAgICB0LkRlbHRhID0gNjEyOwogICAgdC50aG9ybiA9IDU1NjsKICAgIHQudHdvc3VwZXJpb3IgPSAzMzM7CiAgICB0Lk9kaWVyZXNpcyA9IDc3ODsKICAgIHQubXUgPSA1NTY7CiAgICB0LmlncmF2ZSA9IDI3ODsKICAgIHQub2h1bmdhcnVtbGF1dCA9IDU1NjsKICAgIHQuRW9nb25layA9IDY2NzsKICAgIHQuZGNyb2F0ID0gNTU2OwogICAgdC50aHJlZXF1YXJ0ZXJzID0gODM0OwogICAgdC5TY2VkaWxsYSA9IDY2NzsKICAgIHQubGNhcm9uID0gMjk5OwogICAgdC5LY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0LkxhY3V0ZSA9IDU1NjsKICAgIHQudHJhZGVtYXJrID0gMTAwMDsKICAgIHQuZWRvdGFjY2VudCA9IDU1NjsKICAgIHQuSWdyYXZlID0gMjc4OwogICAgdC5JbWFjcm9uID0gMjc4OwogICAgdC5MY2Fyb24gPSA1NTY7CiAgICB0Lm9uZWhhbGYgPSA4MzQ7CiAgICB0Lmxlc3NlcXVhbCA9IDU0OTsKICAgIHQub2NpcmN1bWZsZXggPSA1NTY7CiAgICB0Lm50aWxkZSA9IDU1NjsKICAgIHQuVWh1bmdhcnVtbGF1dCA9IDcyMjsKICAgIHQuRWFjdXRlID0gNjY3OwogICAgdC5lbWFjcm9uID0gNTU2OwogICAgdC5nYnJldmUgPSA1NTY7CiAgICB0Lm9uZXF1YXJ0ZXIgPSA4MzQ7CiAgICB0LlNjYXJvbiA9IDY2NzsKICAgIHQuU2NvbW1hYWNjZW50ID0gNjY3OwogICAgdC5PaHVuZ2FydW1sYXV0ID0gNzc4OwogICAgdC5kZWdyZWUgPSA0MDA7CiAgICB0Lm9ncmF2ZSA9IDU1NjsKICAgIHQuQ2Nhcm9uID0gNzIyOwogICAgdC51Z3JhdmUgPSA1NTY7CiAgICB0LnJhZGljYWwgPSA0NTM7CiAgICB0LkRjYXJvbiA9IDcyMjsKICAgIHQucmNvbW1hYWNjZW50ID0gMzMzOwogICAgdC5OdGlsZGUgPSA3MjI7CiAgICB0Lm90aWxkZSA9IDU1NjsKICAgIHQuUmNvbW1hYWNjZW50ID0gNzIyOwogICAgdC5MY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0LkF0aWxkZSA9IDY2NzsKICAgIHQuQW9nb25layA9IDY2NzsKICAgIHQuQXJpbmcgPSA2Njc7CiAgICB0Lk90aWxkZSA9IDc3ODsKICAgIHQuemRvdGFjY2VudCA9IDUwMDsKICAgIHQuRWNhcm9uID0gNjY3OwogICAgdC5Jb2dvbmVrID0gMjc4OwogICAgdC5rY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0Lm1pbnVzID0gNTg0OwogICAgdC5JY2lyY3VtZmxleCA9IDI3ODsKICAgIHQubmNhcm9uID0gNTU2OwogICAgdC50Y29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LmxvZ2ljYWxub3QgPSA1ODQ7CiAgICB0Lm9kaWVyZXNpcyA9IDU1NjsKICAgIHQudWRpZXJlc2lzID0gNTU2OwogICAgdC5ub3RlcXVhbCA9IDU0OTsKICAgIHQuZ2NvbW1hYWNjZW50ID0gNTU2OwogICAgdC5ldGggPSA1NTY7CiAgICB0LnpjYXJvbiA9IDUwMDsKICAgIHQubmNvbW1hYWNjZW50ID0gNTU2OwogICAgdC5vbmVzdXBlcmlvciA9IDMzMzsKICAgIHQuaW1hY3JvbiA9IDI3ODsKICAgIHQuRXVybyA9IDU1NjsKICB9KTsKICB0LlN5bWJvbCA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI1MDsKICAgIHQuZXhjbGFtID0gMzMzOwogICAgdC51bml2ZXJzYWwgPSA3MTM7CiAgICB0Lm51bWJlcnNpZ24gPSA1MDA7CiAgICB0LmV4aXN0ZW50aWFsID0gNTQ5OwogICAgdC5wZXJjZW50ID0gODMzOwogICAgdC5hbXBlcnNhbmQgPSA3Nzg7CiAgICB0LnN1Y2h0aGF0ID0gNDM5OwogICAgdC5wYXJlbmxlZnQgPSAzMzM7CiAgICB0LnBhcmVucmlnaHQgPSAzMzM7CiAgICB0LmFzdGVyaXNrbWF0aCA9IDUwMDsKICAgIHQucGx1cyA9IDU0OTsKICAgIHQuY29tbWEgPSAyNTA7CiAgICB0Lm1pbnVzID0gNTQ5OwogICAgdC5wZXJpb2QgPSAyNTA7CiAgICB0LnNsYXNoID0gMjc4OwogICAgdC56ZXJvID0gNTAwOwogICAgdC5vbmUgPSA1MDA7CiAgICB0LnR3byA9IDUwMDsKICAgIHQudGhyZWUgPSA1MDA7CiAgICB0LmZvdXIgPSA1MDA7CiAgICB0LmZpdmUgPSA1MDA7CiAgICB0LnNpeCA9IDUwMDsKICAgIHQuc2V2ZW4gPSA1MDA7CiAgICB0LmVpZ2h0ID0gNTAwOwogICAgdC5uaW5lID0gNTAwOwogICAgdC5jb2xvbiA9IDI3ODsKICAgIHQuc2VtaWNvbG9uID0gMjc4OwogICAgdC5sZXNzID0gNTQ5OwogICAgdC5lcXVhbCA9IDU0OTsKICAgIHQuZ3JlYXRlciA9IDU0OTsKICAgIHQucXVlc3Rpb24gPSA0NDQ7CiAgICB0LmNvbmdydWVudCA9IDU0OTsKICAgIHQuQWxwaGEgPSA3MjI7CiAgICB0LkJldGEgPSA2Njc7CiAgICB0LkNoaSA9IDcyMjsKICAgIHQuRGVsdGEgPSA2MTI7CiAgICB0LkVwc2lsb24gPSA2MTE7CiAgICB0LlBoaSA9IDc2MzsKICAgIHQuR2FtbWEgPSA2MDM7CiAgICB0LkV0YSA9IDcyMjsKICAgIHQuSW90YSA9IDMzMzsKICAgIHQudGhldGExID0gNjMxOwogICAgdC5LYXBwYSA9IDcyMjsKICAgIHQuTGFtYmRhID0gNjg2OwogICAgdC5NdSA9IDg4OTsKICAgIHQuTnUgPSA3MjI7CiAgICB0Lk9taWNyb24gPSA3MjI7CiAgICB0LlBpID0gNzY4OwogICAgdC5UaGV0YSA9IDc0MTsKICAgIHQuUmhvID0gNTU2OwogICAgdC5TaWdtYSA9IDU5MjsKICAgIHQuVGF1ID0gNjExOwogICAgdC5VcHNpbG9uID0gNjkwOwogICAgdC5zaWdtYTEgPSA0Mzk7CiAgICB0Lk9tZWdhID0gNzY4OwogICAgdC5YaSA9IDY0NTsKICAgIHQuUHNpID0gNzk1OwogICAgdC5aZXRhID0gNjExOwogICAgdC5icmFja2V0bGVmdCA9IDMzMzsKICAgIHQudGhlcmVmb3JlID0gODYzOwogICAgdC5icmFja2V0cmlnaHQgPSAzMzM7CiAgICB0LnBlcnBlbmRpY3VsYXIgPSA2NTg7CiAgICB0LnVuZGVyc2NvcmUgPSA1MDA7CiAgICB0LnJhZGljYWxleCA9IDUwMDsKICAgIHQuYWxwaGEgPSA2MzE7CiAgICB0LmJldGEgPSA1NDk7CiAgICB0LmNoaSA9IDU0OTsKICAgIHQuZGVsdGEgPSA0OTQ7CiAgICB0LmVwc2lsb24gPSA0Mzk7CiAgICB0LnBoaSA9IDUyMTsKICAgIHQuZ2FtbWEgPSA0MTE7CiAgICB0LmV0YSA9IDYwMzsKICAgIHQuaW90YSA9IDMyOTsKICAgIHQucGhpMSA9IDYwMzsKICAgIHQua2FwcGEgPSA1NDk7CiAgICB0LmxhbWJkYSA9IDU0OTsKICAgIHQubXUgPSA1NzY7CiAgICB0Lm51ID0gNTIxOwogICAgdC5vbWljcm9uID0gNTQ5OwogICAgdC5waSA9IDU0OTsKICAgIHQudGhldGEgPSA1MjE7CiAgICB0LnJobyA9IDU0OTsKICAgIHQuc2lnbWEgPSA2MDM7CiAgICB0LnRhdSA9IDQzOTsKICAgIHQudXBzaWxvbiA9IDU3NjsKICAgIHQub21lZ2ExID0gNzEzOwogICAgdC5vbWVnYSA9IDY4NjsKICAgIHQueGkgPSA0OTM7CiAgICB0LnBzaSA9IDY4NjsKICAgIHQuemV0YSA9IDQ5NDsKICAgIHQuYnJhY2VsZWZ0ID0gNDgwOwogICAgdC5iYXIgPSAyMDA7CiAgICB0LmJyYWNlcmlnaHQgPSA0ODA7CiAgICB0LnNpbWlsYXIgPSA1NDk7CiAgICB0LkV1cm8gPSA3NTA7CiAgICB0LlVwc2lsb24xID0gNjIwOwogICAgdC5taW51dGUgPSAyNDc7CiAgICB0Lmxlc3NlcXVhbCA9IDU0OTsKICAgIHQuZnJhY3Rpb24gPSAxNjc7CiAgICB0LmluZmluaXR5ID0gNzEzOwogICAgdC5mbG9yaW4gPSA1MDA7CiAgICB0LmNsdWIgPSA3NTM7CiAgICB0LmRpYW1vbmQgPSA3NTM7CiAgICB0LmhlYXJ0ID0gNzUzOwogICAgdC5zcGFkZSA9IDc1MzsKICAgIHQuYXJyb3dib3RoID0gMTA0MjsKICAgIHQuYXJyb3dsZWZ0ID0gOTg3OwogICAgdC5hcnJvd3VwID0gNjAzOwogICAgdC5hcnJvd3JpZ2h0ID0gOTg3OwogICAgdC5hcnJvd2Rvd24gPSA2MDM7CiAgICB0LmRlZ3JlZSA9IDQwMDsKICAgIHQucGx1c21pbnVzID0gNTQ5OwogICAgdC5zZWNvbmQgPSA0MTE7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQubXVsdGlwbHkgPSA1NDk7CiAgICB0LnByb3BvcnRpb25hbCA9IDcxMzsKICAgIHQucGFydGlhbGRpZmYgPSA0OTQ7CiAgICB0LmJ1bGxldCA9IDQ2MDsKICAgIHQuZGl2aWRlID0gNTQ5OwogICAgdC5ub3RlcXVhbCA9IDU0OTsKICAgIHQuZXF1aXZhbGVuY2UgPSA1NDk7CiAgICB0LmFwcHJveGVxdWFsID0gNTQ5OwogICAgdC5lbGxpcHNpcyA9IDEwMDA7CiAgICB0LmFycm93dmVydGV4ID0gNjAzOwogICAgdC5hcnJvd2hvcml6ZXggPSAxMDAwOwogICAgdC5jYXJyaWFnZXJldHVybiA9IDY1ODsKICAgIHQuYWxlcGggPSA4MjM7CiAgICB0LklmcmFrdHVyID0gNjg2OwogICAgdC5SZnJha3R1ciA9IDc5NTsKICAgIHQud2VpZXJzdHJhc3MgPSA5ODc7CiAgICB0LmNpcmNsZW11bHRpcGx5ID0gNzY4OwogICAgdC5jaXJjbGVwbHVzID0gNzY4OwogICAgdC5lbXB0eXNldCA9IDgyMzsKICAgIHQuaW50ZXJzZWN0aW9uID0gNzY4OwogICAgdC51bmlvbiA9IDc2ODsKICAgIHQucHJvcGVyc3VwZXJzZXQgPSA3MTM7CiAgICB0LnJlZmxleHN1cGVyc2V0ID0gNzEzOwogICAgdC5ub3RzdWJzZXQgPSA3MTM7CiAgICB0LnByb3BlcnN1YnNldCA9IDcxMzsKICAgIHQucmVmbGV4c3Vic2V0ID0gNzEzOwogICAgdC5lbGVtZW50ID0gNzEzOwogICAgdC5ub3RlbGVtZW50ID0gNzEzOwogICAgdC5hbmdsZSA9IDc2ODsKICAgIHQuZ3JhZGllbnQgPSA3MTM7CiAgICB0LnJlZ2lzdGVyc2VyaWYgPSA3OTA7CiAgICB0LmNvcHlyaWdodHNlcmlmID0gNzkwOwogICAgdC50cmFkZW1hcmtzZXJpZiA9IDg5MDsKICAgIHQucHJvZHVjdCA9IDgyMzsKICAgIHQucmFkaWNhbCA9IDU0OTsKICAgIHQuZG90bWF0aCA9IDI1MDsKICAgIHQubG9naWNhbG5vdCA9IDcxMzsKICAgIHQubG9naWNhbGFuZCA9IDYwMzsKICAgIHQubG9naWNhbG9yID0gNjAzOwogICAgdC5hcnJvd2RibGJvdGggPSAxMDQyOwogICAgdC5hcnJvd2RibGxlZnQgPSA5ODc7CiAgICB0LmFycm93ZGJsdXAgPSA2MDM7CiAgICB0LmFycm93ZGJscmlnaHQgPSA5ODc7CiAgICB0LmFycm93ZGJsZG93biA9IDYwMzsKICAgIHQubG96ZW5nZSA9IDQ5NDsKICAgIHQuYW5nbGVsZWZ0ID0gMzI5OwogICAgdC5yZWdpc3RlcnNhbnMgPSA3OTA7CiAgICB0LmNvcHlyaWdodHNhbnMgPSA3OTA7CiAgICB0LnRyYWRlbWFya3NhbnMgPSA3ODY7CiAgICB0LnN1bW1hdGlvbiA9IDcxMzsKICAgIHQucGFyZW5sZWZ0dHAgPSAzODQ7CiAgICB0LnBhcmVubGVmdGV4ID0gMzg0OwogICAgdC5wYXJlbmxlZnRidCA9IDM4NDsKICAgIHQuYnJhY2tldGxlZnR0cCA9IDM4NDsKICAgIHQuYnJhY2tldGxlZnRleCA9IDM4NDsKICAgIHQuYnJhY2tldGxlZnRidCA9IDM4NDsKICAgIHQuYnJhY2VsZWZ0dHAgPSA0OTQ7CiAgICB0LmJyYWNlbGVmdG1pZCA9IDQ5NDsKICAgIHQuYnJhY2VsZWZ0YnQgPSA0OTQ7CiAgICB0LmJyYWNlZXggPSA0OTQ7CiAgICB0LmFuZ2xlcmlnaHQgPSAzMjk7CiAgICB0LmludGVncmFsID0gMjc0OwogICAgdC5pbnRlZ3JhbHRwID0gNjg2OwogICAgdC5pbnRlZ3JhbGV4ID0gNjg2OwogICAgdC5pbnRlZ3JhbGJ0ID0gNjg2OwogICAgdC5wYXJlbnJpZ2h0dHAgPSAzODQ7CiAgICB0LnBhcmVucmlnaHRleCA9IDM4NDsKICAgIHQucGFyZW5yaWdodGJ0ID0gMzg0OwogICAgdC5icmFja2V0cmlnaHR0cCA9IDM4NDsKICAgIHQuYnJhY2tldHJpZ2h0ZXggPSAzODQ7CiAgICB0LmJyYWNrZXRyaWdodGJ0ID0gMzg0OwogICAgdC5icmFjZXJpZ2h0dHAgPSA0OTQ7CiAgICB0LmJyYWNlcmlnaHRtaWQgPSA0OTQ7CiAgICB0LmJyYWNlcmlnaHRidCA9IDQ5NDsKICAgIHQuYXBwbGUgPSA3OTA7CiAgfSk7CiAgdFsiVGltZXMtUm9tYW4iXSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI1MDsKICAgIHQuZXhjbGFtID0gMzMzOwogICAgdC5xdW90ZWRibCA9IDQwODsKICAgIHQubnVtYmVyc2lnbiA9IDUwMDsKICAgIHQuZG9sbGFyID0gNTAwOwogICAgdC5wZXJjZW50ID0gODMzOwogICAgdC5hbXBlcnNhbmQgPSA3Nzg7CiAgICB0LnF1b3RlcmlnaHQgPSAzMzM7CiAgICB0LnBhcmVubGVmdCA9IDMzMzsKICAgIHQucGFyZW5yaWdodCA9IDMzMzsKICAgIHQuYXN0ZXJpc2sgPSA1MDA7CiAgICB0LnBsdXMgPSA1NjQ7CiAgICB0LmNvbW1hID0gMjUwOwogICAgdC5oeXBoZW4gPSAzMzM7CiAgICB0LnBlcmlvZCA9IDI1MDsKICAgIHQuc2xhc2ggPSAyNzg7CiAgICB0Lnplcm8gPSA1MDA7CiAgICB0Lm9uZSA9IDUwMDsKICAgIHQudHdvID0gNTAwOwogICAgdC50aHJlZSA9IDUwMDsKICAgIHQuZm91ciA9IDUwMDsKICAgIHQuZml2ZSA9IDUwMDsKICAgIHQuc2l4ID0gNTAwOwogICAgdC5zZXZlbiA9IDUwMDsKICAgIHQuZWlnaHQgPSA1MDA7CiAgICB0Lm5pbmUgPSA1MDA7CiAgICB0LmNvbG9uID0gMjc4OwogICAgdC5zZW1pY29sb24gPSAyNzg7CiAgICB0Lmxlc3MgPSA1NjQ7CiAgICB0LmVxdWFsID0gNTY0OwogICAgdC5ncmVhdGVyID0gNTY0OwogICAgdC5xdWVzdGlvbiA9IDQ0NDsKICAgIHQuYXQgPSA5MjE7CiAgICB0LkEgPSA3MjI7CiAgICB0LkIgPSA2Njc7CiAgICB0LkMgPSA2Njc7CiAgICB0LkQgPSA3MjI7CiAgICB0LkUgPSA2MTE7CiAgICB0LkYgPSA1NTY7CiAgICB0LkcgPSA3MjI7CiAgICB0LkggPSA3MjI7CiAgICB0LkkgPSAzMzM7CiAgICB0LkogPSAzODk7CiAgICB0LksgPSA3MjI7CiAgICB0LkwgPSA2MTE7CiAgICB0Lk0gPSA4ODk7CiAgICB0Lk4gPSA3MjI7CiAgICB0Lk8gPSA3MjI7CiAgICB0LlAgPSA1NTY7CiAgICB0LlEgPSA3MjI7CiAgICB0LlIgPSA2Njc7CiAgICB0LlMgPSA1NTY7CiAgICB0LlQgPSA2MTE7CiAgICB0LlUgPSA3MjI7CiAgICB0LlYgPSA3MjI7CiAgICB0LlcgPSA5NDQ7CiAgICB0LlggPSA3MjI7CiAgICB0LlkgPSA3MjI7CiAgICB0LlogPSA2MTE7CiAgICB0LmJyYWNrZXRsZWZ0ID0gMzMzOwogICAgdC5iYWNrc2xhc2ggPSAyNzg7CiAgICB0LmJyYWNrZXRyaWdodCA9IDMzMzsKICAgIHQuYXNjaWljaXJjdW0gPSA0Njk7CiAgICB0LnVuZGVyc2NvcmUgPSA1MDA7CiAgICB0LnF1b3RlbGVmdCA9IDMzMzsKICAgIHQuYSA9IDQ0NDsKICAgIHQuYiA9IDUwMDsKICAgIHQuYyA9IDQ0NDsKICAgIHQuZCA9IDUwMDsKICAgIHQuZSA9IDQ0NDsKICAgIHQuZiA9IDMzMzsKICAgIHQuZyA9IDUwMDsKICAgIHQuaCA9IDUwMDsKICAgIHQuaSA9IDI3ODsKICAgIHQuaiA9IDI3ODsKICAgIHQuayA9IDUwMDsKICAgIHQubCA9IDI3ODsKICAgIHQubSA9IDc3ODsKICAgIHQubiA9IDUwMDsKICAgIHQubyA9IDUwMDsKICAgIHQucCA9IDUwMDsKICAgIHQucSA9IDUwMDsKICAgIHQuciA9IDMzMzsKICAgIHQucyA9IDM4OTsKICAgIHQudCA9IDI3ODsKICAgIHQudSA9IDUwMDsKICAgIHQudiA9IDUwMDsKICAgIHQudyA9IDcyMjsKICAgIHQueCA9IDUwMDsKICAgIHQueSA9IDUwMDsKICAgIHQueiA9IDQ0NDsKICAgIHQuYnJhY2VsZWZ0ID0gNDgwOwogICAgdC5iYXIgPSAyMDA7CiAgICB0LmJyYWNlcmlnaHQgPSA0ODA7CiAgICB0LmFzY2lpdGlsZGUgPSA1NDE7CiAgICB0LmV4Y2xhbWRvd24gPSAzMzM7CiAgICB0LmNlbnQgPSA1MDA7CiAgICB0LnN0ZXJsaW5nID0gNTAwOwogICAgdC5mcmFjdGlvbiA9IDE2NzsKICAgIHQueWVuID0gNTAwOwogICAgdC5mbG9yaW4gPSA1MDA7CiAgICB0LnNlY3Rpb24gPSA1MDA7CiAgICB0LmN1cnJlbmN5ID0gNTAwOwogICAgdC5xdW90ZXNpbmdsZSA9IDE4MDsKICAgIHQucXVvdGVkYmxsZWZ0ID0gNDQ0OwogICAgdC5ndWlsbGVtb3RsZWZ0ID0gNTAwOwogICAgdC5ndWlsc2luZ2xsZWZ0ID0gMzMzOwogICAgdC5ndWlsc2luZ2xyaWdodCA9IDMzMzsKICAgIHQuZmkgPSA1NTY7CiAgICB0LmZsID0gNTU2OwogICAgdC5lbmRhc2ggPSA1MDA7CiAgICB0LmRhZ2dlciA9IDUwMDsKICAgIHQuZGFnZ2VyZGJsID0gNTAwOwogICAgdC5wZXJpb2RjZW50ZXJlZCA9IDI1MDsKICAgIHQucGFyYWdyYXBoID0gNDUzOwogICAgdC5idWxsZXQgPSAzNTA7CiAgICB0LnF1b3Rlc2luZ2xiYXNlID0gMzMzOwogICAgdC5xdW90ZWRibGJhc2UgPSA0NDQ7CiAgICB0LnF1b3RlZGJscmlnaHQgPSA0NDQ7CiAgICB0Lmd1aWxsZW1vdHJpZ2h0ID0gNTAwOwogICAgdC5lbGxpcHNpcyA9IDEwMDA7CiAgICB0LnBlcnRob3VzYW5kID0gMTAwMDsKICAgIHQucXVlc3Rpb25kb3duID0gNDQ0OwogICAgdC5ncmF2ZSA9IDMzMzsKICAgIHQuYWN1dGUgPSAzMzM7CiAgICB0LmNpcmN1bWZsZXggPSAzMzM7CiAgICB0LnRpbGRlID0gMzMzOwogICAgdC5tYWNyb24gPSAzMzM7CiAgICB0LmJyZXZlID0gMzMzOwogICAgdC5kb3RhY2NlbnQgPSAzMzM7CiAgICB0LmRpZXJlc2lzID0gMzMzOwogICAgdC5yaW5nID0gMzMzOwogICAgdC5jZWRpbGxhID0gMzMzOwogICAgdC5odW5nYXJ1bWxhdXQgPSAzMzM7CiAgICB0Lm9nb25layA9IDMzMzsKICAgIHQuY2Fyb24gPSAzMzM7CiAgICB0LmVtZGFzaCA9IDEwMDA7CiAgICB0LkFFID0gODg5OwogICAgdC5vcmRmZW1pbmluZSA9IDI3NjsKICAgIHQuTHNsYXNoID0gNjExOwogICAgdC5Pc2xhc2ggPSA3MjI7CiAgICB0Lk9FID0gODg5OwogICAgdC5vcmRtYXNjdWxpbmUgPSAzMTA7CiAgICB0LmFlID0gNjY3OwogICAgdC5kb3RsZXNzaSA9IDI3ODsKICAgIHQubHNsYXNoID0gMjc4OwogICAgdC5vc2xhc2ggPSA1MDA7CiAgICB0Lm9lID0gNzIyOwogICAgdC5nZXJtYW5kYmxzID0gNTAwOwogICAgdC5JZGllcmVzaXMgPSAzMzM7CiAgICB0LmVhY3V0ZSA9IDQ0NDsKICAgIHQuYWJyZXZlID0gNDQ0OwogICAgdC51aHVuZ2FydW1sYXV0ID0gNTAwOwogICAgdC5lY2Fyb24gPSA0NDQ7CiAgICB0LllkaWVyZXNpcyA9IDcyMjsKICAgIHQuZGl2aWRlID0gNTY0OwogICAgdC5ZYWN1dGUgPSA3MjI7CiAgICB0LkFjaXJjdW1mbGV4ID0gNzIyOwogICAgdC5hYWN1dGUgPSA0NDQ7CiAgICB0LlVjaXJjdW1mbGV4ID0gNzIyOwogICAgdC55YWN1dGUgPSA1MDA7CiAgICB0LnNjb21tYWFjY2VudCA9IDM4OTsKICAgIHQuZWNpcmN1bWZsZXggPSA0NDQ7CiAgICB0LlVyaW5nID0gNzIyOwogICAgdC5VZGllcmVzaXMgPSA3MjI7CiAgICB0LmFvZ29uZWsgPSA0NDQ7CiAgICB0LlVhY3V0ZSA9IDcyMjsKICAgIHQudW9nb25layA9IDUwMDsKICAgIHQuRWRpZXJlc2lzID0gNjExOwogICAgdC5EY3JvYXQgPSA3MjI7CiAgICB0LmNvbW1hYWNjZW50ID0gMjUwOwogICAgdC5jb3B5cmlnaHQgPSA3NjA7CiAgICB0LkVtYWNyb24gPSA2MTE7CiAgICB0LmNjYXJvbiA9IDQ0NDsKICAgIHQuYXJpbmcgPSA0NDQ7CiAgICB0Lk5jb21tYWFjY2VudCA9IDcyMjsKICAgIHQubGFjdXRlID0gMjc4OwogICAgdC5hZ3JhdmUgPSA0NDQ7CiAgICB0LlRjb21tYWFjY2VudCA9IDYxMTsKICAgIHQuQ2FjdXRlID0gNjY3OwogICAgdC5hdGlsZGUgPSA0NDQ7CiAgICB0LkVkb3RhY2NlbnQgPSA2MTE7CiAgICB0LnNjYXJvbiA9IDM4OTsKICAgIHQuc2NlZGlsbGEgPSAzODk7CiAgICB0LmlhY3V0ZSA9IDI3ODsKICAgIHQubG96ZW5nZSA9IDQ3MTsKICAgIHQuUmNhcm9uID0gNjY3OwogICAgdC5HY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LnVjaXJjdW1mbGV4ID0gNTAwOwogICAgdC5hY2lyY3VtZmxleCA9IDQ0NDsKICAgIHQuQW1hY3JvbiA9IDcyMjsKICAgIHQucmNhcm9uID0gMzMzOwogICAgdC5jY2VkaWxsYSA9IDQ0NDsKICAgIHQuWmRvdGFjY2VudCA9IDYxMTsKICAgIHQuVGhvcm4gPSA1NTY7CiAgICB0Lk9tYWNyb24gPSA3MjI7CiAgICB0LlJhY3V0ZSA9IDY2NzsKICAgIHQuU2FjdXRlID0gNTU2OwogICAgdC5kY2Fyb24gPSA1ODg7CiAgICB0LlVtYWNyb24gPSA3MjI7CiAgICB0LnVyaW5nID0gNTAwOwogICAgdC50aHJlZXN1cGVyaW9yID0gMzAwOwogICAgdC5PZ3JhdmUgPSA3MjI7CiAgICB0LkFncmF2ZSA9IDcyMjsKICAgIHQuQWJyZXZlID0gNzIyOwogICAgdC5tdWx0aXBseSA9IDU2NDsKICAgIHQudWFjdXRlID0gNTAwOwogICAgdC5UY2Fyb24gPSA2MTE7CiAgICB0LnBhcnRpYWxkaWZmID0gNDc2OwogICAgdC55ZGllcmVzaXMgPSA1MDA7CiAgICB0Lk5hY3V0ZSA9IDcyMjsKICAgIHQuaWNpcmN1bWZsZXggPSAyNzg7CiAgICB0LkVjaXJjdW1mbGV4ID0gNjExOwogICAgdC5hZGllcmVzaXMgPSA0NDQ7CiAgICB0LmVkaWVyZXNpcyA9IDQ0NDsKICAgIHQuY2FjdXRlID0gNDQ0OwogICAgdC5uYWN1dGUgPSA1MDA7CiAgICB0LnVtYWNyb24gPSA1MDA7CiAgICB0Lk5jYXJvbiA9IDcyMjsKICAgIHQuSWFjdXRlID0gMzMzOwogICAgdC5wbHVzbWludXMgPSA1NjQ7CiAgICB0LmJyb2tlbmJhciA9IDIwMDsKICAgIHQucmVnaXN0ZXJlZCA9IDc2MDsKICAgIHQuR2JyZXZlID0gNzIyOwogICAgdC5JZG90YWNjZW50ID0gMzMzOwogICAgdC5zdW1tYXRpb24gPSA2MDA7CiAgICB0LkVncmF2ZSA9IDYxMTsKICAgIHQucmFjdXRlID0gMzMzOwogICAgdC5vbWFjcm9uID0gNTAwOwogICAgdC5aYWN1dGUgPSA2MTE7CiAgICB0LlpjYXJvbiA9IDYxMTsKICAgIHQuZ3JlYXRlcmVxdWFsID0gNTQ5OwogICAgdC5FdGggPSA3MjI7CiAgICB0LkNjZWRpbGxhID0gNjY3OwogICAgdC5sY29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LnRjYXJvbiA9IDMyNjsKICAgIHQuZW9nb25layA9IDQ0NDsKICAgIHQuVW9nb25layA9IDcyMjsKICAgIHQuQWFjdXRlID0gNzIyOwogICAgdC5BZGllcmVzaXMgPSA3MjI7CiAgICB0LmVncmF2ZSA9IDQ0NDsKICAgIHQuemFjdXRlID0gNDQ0OwogICAgdC5pb2dvbmVrID0gMjc4OwogICAgdC5PYWN1dGUgPSA3MjI7CiAgICB0Lm9hY3V0ZSA9IDUwMDsKICAgIHQuYW1hY3JvbiA9IDQ0NDsKICAgIHQuc2FjdXRlID0gMzg5OwogICAgdC5pZGllcmVzaXMgPSAyNzg7CiAgICB0Lk9jaXJjdW1mbGV4ID0gNzIyOwogICAgdC5VZ3JhdmUgPSA3MjI7CiAgICB0LkRlbHRhID0gNjEyOwogICAgdC50aG9ybiA9IDUwMDsKICAgIHQudHdvc3VwZXJpb3IgPSAzMDA7CiAgICB0Lk9kaWVyZXNpcyA9IDcyMjsKICAgIHQubXUgPSA1MDA7CiAgICB0LmlncmF2ZSA9IDI3ODsKICAgIHQub2h1bmdhcnVtbGF1dCA9IDUwMDsKICAgIHQuRW9nb25layA9IDYxMTsKICAgIHQuZGNyb2F0ID0gNTAwOwogICAgdC50aHJlZXF1YXJ0ZXJzID0gNzUwOwogICAgdC5TY2VkaWxsYSA9IDU1NjsKICAgIHQubGNhcm9uID0gMzQ0OwogICAgdC5LY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LkxhY3V0ZSA9IDYxMTsKICAgIHQudHJhZGVtYXJrID0gOTgwOwogICAgdC5lZG90YWNjZW50ID0gNDQ0OwogICAgdC5JZ3JhdmUgPSAzMzM7CiAgICB0LkltYWNyb24gPSAzMzM7CiAgICB0LkxjYXJvbiA9IDYxMTsKICAgIHQub25laGFsZiA9IDc1MDsKICAgIHQubGVzc2VxdWFsID0gNTQ5OwogICAgdC5vY2lyY3VtZmxleCA9IDUwMDsKICAgIHQubnRpbGRlID0gNTAwOwogICAgdC5VaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5FYWN1dGUgPSA2MTE7CiAgICB0LmVtYWNyb24gPSA0NDQ7CiAgICB0LmdicmV2ZSA9IDUwMDsKICAgIHQub25lcXVhcnRlciA9IDc1MDsKICAgIHQuU2Nhcm9uID0gNTU2OwogICAgdC5TY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0Lk9odW5nYXJ1bWxhdXQgPSA3MjI7CiAgICB0LmRlZ3JlZSA9IDQwMDsKICAgIHQub2dyYXZlID0gNTAwOwogICAgdC5DY2Fyb24gPSA2Njc7CiAgICB0LnVncmF2ZSA9IDUwMDsKICAgIHQucmFkaWNhbCA9IDQ1MzsKICAgIHQuRGNhcm9uID0gNzIyOwogICAgdC5yY29tbWFhY2NlbnQgPSAzMzM7CiAgICB0Lk50aWxkZSA9IDcyMjsKICAgIHQub3RpbGRlID0gNTAwOwogICAgdC5SY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0Lkxjb21tYWFjY2VudCA9IDYxMTsKICAgIHQuQXRpbGRlID0gNzIyOwogICAgdC5Bb2dvbmVrID0gNzIyOwogICAgdC5BcmluZyA9IDcyMjsKICAgIHQuT3RpbGRlID0gNzIyOwogICAgdC56ZG90YWNjZW50ID0gNDQ0OwogICAgdC5FY2Fyb24gPSA2MTE7CiAgICB0LklvZ29uZWsgPSAzMzM7CiAgICB0Lmtjb21tYWFjY2VudCA9IDUwMDsKICAgIHQubWludXMgPSA1NjQ7CiAgICB0LkljaXJjdW1mbGV4ID0gMzMzOwogICAgdC5uY2Fyb24gPSA1MDA7CiAgICB0LnRjb21tYWFjY2VudCA9IDI3ODsKICAgIHQubG9naWNhbG5vdCA9IDU2NDsKICAgIHQub2RpZXJlc2lzID0gNTAwOwogICAgdC51ZGllcmVzaXMgPSA1MDA7CiAgICB0Lm5vdGVxdWFsID0gNTQ5OwogICAgdC5nY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0LmV0aCA9IDUwMDsKICAgIHQuemNhcm9uID0gNDQ0OwogICAgdC5uY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0Lm9uZXN1cGVyaW9yID0gMzAwOwogICAgdC5pbWFjcm9uID0gMjc4OwogICAgdC5FdXJvID0gNTAwOwogIH0pOwogIHRbIlRpbWVzLUJvbGQiXSA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI1MDsKICAgIHQuZXhjbGFtID0gMzMzOwogICAgdC5xdW90ZWRibCA9IDU1NTsKICAgIHQubnVtYmVyc2lnbiA9IDUwMDsKICAgIHQuZG9sbGFyID0gNTAwOwogICAgdC5wZXJjZW50ID0gMTAwMDsKICAgIHQuYW1wZXJzYW5kID0gODMzOwogICAgdC5xdW90ZXJpZ2h0ID0gMzMzOwogICAgdC5wYXJlbmxlZnQgPSAzMzM7CiAgICB0LnBhcmVucmlnaHQgPSAzMzM7CiAgICB0LmFzdGVyaXNrID0gNTAwOwogICAgdC5wbHVzID0gNTcwOwogICAgdC5jb21tYSA9IDI1MDsKICAgIHQuaHlwaGVuID0gMzMzOwogICAgdC5wZXJpb2QgPSAyNTA7CiAgICB0LnNsYXNoID0gMjc4OwogICAgdC56ZXJvID0gNTAwOwogICAgdC5vbmUgPSA1MDA7CiAgICB0LnR3byA9IDUwMDsKICAgIHQudGhyZWUgPSA1MDA7CiAgICB0LmZvdXIgPSA1MDA7CiAgICB0LmZpdmUgPSA1MDA7CiAgICB0LnNpeCA9IDUwMDsKICAgIHQuc2V2ZW4gPSA1MDA7CiAgICB0LmVpZ2h0ID0gNTAwOwogICAgdC5uaW5lID0gNTAwOwogICAgdC5jb2xvbiA9IDMzMzsKICAgIHQuc2VtaWNvbG9uID0gMzMzOwogICAgdC5sZXNzID0gNTcwOwogICAgdC5lcXVhbCA9IDU3MDsKICAgIHQuZ3JlYXRlciA9IDU3MDsKICAgIHQucXVlc3Rpb24gPSA1MDA7CiAgICB0LmF0ID0gOTMwOwogICAgdC5BID0gNzIyOwogICAgdC5CID0gNjY3OwogICAgdC5DID0gNzIyOwogICAgdC5EID0gNzIyOwogICAgdC5FID0gNjY3OwogICAgdC5GID0gNjExOwogICAgdC5HID0gNzc4OwogICAgdC5IID0gNzc4OwogICAgdC5JID0gMzg5OwogICAgdC5KID0gNTAwOwogICAgdC5LID0gNzc4OwogICAgdC5MID0gNjY3OwogICAgdC5NID0gOTQ0OwogICAgdC5OID0gNzIyOwogICAgdC5PID0gNzc4OwogICAgdC5QID0gNjExOwogICAgdC5RID0gNzc4OwogICAgdC5SID0gNzIyOwogICAgdC5TID0gNTU2OwogICAgdC5UID0gNjY3OwogICAgdC5VID0gNzIyOwogICAgdC5WID0gNzIyOwogICAgdC5XID0gMTAwMDsKICAgIHQuWCA9IDcyMjsKICAgIHQuWSA9IDcyMjsKICAgIHQuWiA9IDY2NzsKICAgIHQuYnJhY2tldGxlZnQgPSAzMzM7CiAgICB0LmJhY2tzbGFzaCA9IDI3ODsKICAgIHQuYnJhY2tldHJpZ2h0ID0gMzMzOwogICAgdC5hc2NpaWNpcmN1bSA9IDU4MTsKICAgIHQudW5kZXJzY29yZSA9IDUwMDsKICAgIHQucXVvdGVsZWZ0ID0gMzMzOwogICAgdC5hID0gNTAwOwogICAgdC5iID0gNTU2OwogICAgdC5jID0gNDQ0OwogICAgdC5kID0gNTU2OwogICAgdC5lID0gNDQ0OwogICAgdC5mID0gMzMzOwogICAgdC5nID0gNTAwOwogICAgdC5oID0gNTU2OwogICAgdC5pID0gMjc4OwogICAgdC5qID0gMzMzOwogICAgdC5rID0gNTU2OwogICAgdC5sID0gMjc4OwogICAgdC5tID0gODMzOwogICAgdC5uID0gNTU2OwogICAgdC5vID0gNTAwOwogICAgdC5wID0gNTU2OwogICAgdC5xID0gNTU2OwogICAgdC5yID0gNDQ0OwogICAgdC5zID0gMzg5OwogICAgdC50ID0gMzMzOwogICAgdC51ID0gNTU2OwogICAgdC52ID0gNTAwOwogICAgdC53ID0gNzIyOwogICAgdC54ID0gNTAwOwogICAgdC55ID0gNTAwOwogICAgdC56ID0gNDQ0OwogICAgdC5icmFjZWxlZnQgPSAzOTQ7CiAgICB0LmJhciA9IDIyMDsKICAgIHQuYnJhY2VyaWdodCA9IDM5NDsKICAgIHQuYXNjaWl0aWxkZSA9IDUyMDsKICAgIHQuZXhjbGFtZG93biA9IDMzMzsKICAgIHQuY2VudCA9IDUwMDsKICAgIHQuc3RlcmxpbmcgPSA1MDA7CiAgICB0LmZyYWN0aW9uID0gMTY3OwogICAgdC55ZW4gPSA1MDA7CiAgICB0LmZsb3JpbiA9IDUwMDsKICAgIHQuc2VjdGlvbiA9IDUwMDsKICAgIHQuY3VycmVuY3kgPSA1MDA7CiAgICB0LnF1b3Rlc2luZ2xlID0gMjc4OwogICAgdC5xdW90ZWRibGxlZnQgPSA1MDA7CiAgICB0Lmd1aWxsZW1vdGxlZnQgPSA1MDA7CiAgICB0Lmd1aWxzaW5nbGxlZnQgPSAzMzM7CiAgICB0Lmd1aWxzaW5nbHJpZ2h0ID0gMzMzOwogICAgdC5maSA9IDU1NjsKICAgIHQuZmwgPSA1NTY7CiAgICB0LmVuZGFzaCA9IDUwMDsKICAgIHQuZGFnZ2VyID0gNTAwOwogICAgdC5kYWdnZXJkYmwgPSA1MDA7CiAgICB0LnBlcmlvZGNlbnRlcmVkID0gMjUwOwogICAgdC5wYXJhZ3JhcGggPSA1NDA7CiAgICB0LmJ1bGxldCA9IDM1MDsKICAgIHQucXVvdGVzaW5nbGJhc2UgPSAzMzM7CiAgICB0LnF1b3RlZGJsYmFzZSA9IDUwMDsKICAgIHQucXVvdGVkYmxyaWdodCA9IDUwMDsKICAgIHQuZ3VpbGxlbW90cmlnaHQgPSA1MDA7CiAgICB0LmVsbGlwc2lzID0gMTAwMDsKICAgIHQucGVydGhvdXNhbmQgPSAxMDAwOwogICAgdC5xdWVzdGlvbmRvd24gPSA1MDA7CiAgICB0LmdyYXZlID0gMzMzOwogICAgdC5hY3V0ZSA9IDMzMzsKICAgIHQuY2lyY3VtZmxleCA9IDMzMzsKICAgIHQudGlsZGUgPSAzMzM7CiAgICB0Lm1hY3JvbiA9IDMzMzsKICAgIHQuYnJldmUgPSAzMzM7CiAgICB0LmRvdGFjY2VudCA9IDMzMzsKICAgIHQuZGllcmVzaXMgPSAzMzM7CiAgICB0LnJpbmcgPSAzMzM7CiAgICB0LmNlZGlsbGEgPSAzMzM7CiAgICB0Lmh1bmdhcnVtbGF1dCA9IDMzMzsKICAgIHQub2dvbmVrID0gMzMzOwogICAgdC5jYXJvbiA9IDMzMzsKICAgIHQuZW1kYXNoID0gMTAwMDsKICAgIHQuQUUgPSAxMDAwOwogICAgdC5vcmRmZW1pbmluZSA9IDMwMDsKICAgIHQuTHNsYXNoID0gNjY3OwogICAgdC5Pc2xhc2ggPSA3Nzg7CiAgICB0Lk9FID0gMTAwMDsKICAgIHQub3JkbWFzY3VsaW5lID0gMzMwOwogICAgdC5hZSA9IDcyMjsKICAgIHQuZG90bGVzc2kgPSAyNzg7CiAgICB0LmxzbGFzaCA9IDI3ODsKICAgIHQub3NsYXNoID0gNTAwOwogICAgdC5vZSA9IDcyMjsKICAgIHQuZ2VybWFuZGJscyA9IDU1NjsKICAgIHQuSWRpZXJlc2lzID0gMzg5OwogICAgdC5lYWN1dGUgPSA0NDQ7CiAgICB0LmFicmV2ZSA9IDUwMDsKICAgIHQudWh1bmdhcnVtbGF1dCA9IDU1NjsKICAgIHQuZWNhcm9uID0gNDQ0OwogICAgdC5ZZGllcmVzaXMgPSA3MjI7CiAgICB0LmRpdmlkZSA9IDU3MDsKICAgIHQuWWFjdXRlID0gNzIyOwogICAgdC5BY2lyY3VtZmxleCA9IDcyMjsKICAgIHQuYWFjdXRlID0gNTAwOwogICAgdC5VY2lyY3VtZmxleCA9IDcyMjsKICAgIHQueWFjdXRlID0gNTAwOwogICAgdC5zY29tbWFhY2NlbnQgPSAzODk7CiAgICB0LmVjaXJjdW1mbGV4ID0gNDQ0OwogICAgdC5VcmluZyA9IDcyMjsKICAgIHQuVWRpZXJlc2lzID0gNzIyOwogICAgdC5hb2dvbmVrID0gNTAwOwogICAgdC5VYWN1dGUgPSA3MjI7CiAgICB0LnVvZ29uZWsgPSA1NTY7CiAgICB0LkVkaWVyZXNpcyA9IDY2NzsKICAgIHQuRGNyb2F0ID0gNzIyOwogICAgdC5jb21tYWFjY2VudCA9IDI1MDsKICAgIHQuY29weXJpZ2h0ID0gNzQ3OwogICAgdC5FbWFjcm9uID0gNjY3OwogICAgdC5jY2Fyb24gPSA0NDQ7CiAgICB0LmFyaW5nID0gNTAwOwogICAgdC5OY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LmxhY3V0ZSA9IDI3ODsKICAgIHQuYWdyYXZlID0gNTAwOwogICAgdC5UY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0LkNhY3V0ZSA9IDcyMjsKICAgIHQuYXRpbGRlID0gNTAwOwogICAgdC5FZG90YWNjZW50ID0gNjY3OwogICAgdC5zY2Fyb24gPSAzODk7CiAgICB0LnNjZWRpbGxhID0gMzg5OwogICAgdC5pYWN1dGUgPSAyNzg7CiAgICB0LmxvemVuZ2UgPSA0OTQ7CiAgICB0LlJjYXJvbiA9IDcyMjsKICAgIHQuR2NvbW1hYWNjZW50ID0gNzc4OwogICAgdC51Y2lyY3VtZmxleCA9IDU1NjsKICAgIHQuYWNpcmN1bWZsZXggPSA1MDA7CiAgICB0LkFtYWNyb24gPSA3MjI7CiAgICB0LnJjYXJvbiA9IDQ0NDsKICAgIHQuY2NlZGlsbGEgPSA0NDQ7CiAgICB0Llpkb3RhY2NlbnQgPSA2Njc7CiAgICB0LlRob3JuID0gNjExOwogICAgdC5PbWFjcm9uID0gNzc4OwogICAgdC5SYWN1dGUgPSA3MjI7CiAgICB0LlNhY3V0ZSA9IDU1NjsKICAgIHQuZGNhcm9uID0gNjcyOwogICAgdC5VbWFjcm9uID0gNzIyOwogICAgdC51cmluZyA9IDU1NjsKICAgIHQudGhyZWVzdXBlcmlvciA9IDMwMDsKICAgIHQuT2dyYXZlID0gNzc4OwogICAgdC5BZ3JhdmUgPSA3MjI7CiAgICB0LkFicmV2ZSA9IDcyMjsKICAgIHQubXVsdGlwbHkgPSA1NzA7CiAgICB0LnVhY3V0ZSA9IDU1NjsKICAgIHQuVGNhcm9uID0gNjY3OwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ5NDsKICAgIHQueWRpZXJlc2lzID0gNTAwOwogICAgdC5OYWN1dGUgPSA3MjI7CiAgICB0LmljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5FY2lyY3VtZmxleCA9IDY2NzsKICAgIHQuYWRpZXJlc2lzID0gNTAwOwogICAgdC5lZGllcmVzaXMgPSA0NDQ7CiAgICB0LmNhY3V0ZSA9IDQ0NDsKICAgIHQubmFjdXRlID0gNTU2OwogICAgdC51bWFjcm9uID0gNTU2OwogICAgdC5OY2Fyb24gPSA3MjI7CiAgICB0LklhY3V0ZSA9IDM4OTsKICAgIHQucGx1c21pbnVzID0gNTcwOwogICAgdC5icm9rZW5iYXIgPSAyMjA7CiAgICB0LnJlZ2lzdGVyZWQgPSA3NDc7CiAgICB0LkdicmV2ZSA9IDc3ODsKICAgIHQuSWRvdGFjY2VudCA9IDM4OTsKICAgIHQuc3VtbWF0aW9uID0gNjAwOwogICAgdC5FZ3JhdmUgPSA2Njc7CiAgICB0LnJhY3V0ZSA9IDQ0NDsKICAgIHQub21hY3JvbiA9IDUwMDsKICAgIHQuWmFjdXRlID0gNjY3OwogICAgdC5aY2Fyb24gPSA2Njc7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQuRXRoID0gNzIyOwogICAgdC5DY2VkaWxsYSA9IDcyMjsKICAgIHQubGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC50Y2Fyb24gPSA0MTY7CiAgICB0LmVvZ29uZWsgPSA0NDQ7CiAgICB0LlVvZ29uZWsgPSA3MjI7CiAgICB0LkFhY3V0ZSA9IDcyMjsKICAgIHQuQWRpZXJlc2lzID0gNzIyOwogICAgdC5lZ3JhdmUgPSA0NDQ7CiAgICB0LnphY3V0ZSA9IDQ0NDsKICAgIHQuaW9nb25layA9IDI3ODsKICAgIHQuT2FjdXRlID0gNzc4OwogICAgdC5vYWN1dGUgPSA1MDA7CiAgICB0LmFtYWNyb24gPSA1MDA7CiAgICB0LnNhY3V0ZSA9IDM4OTsKICAgIHQuaWRpZXJlc2lzID0gMjc4OwogICAgdC5PY2lyY3VtZmxleCA9IDc3ODsKICAgIHQuVWdyYXZlID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQudGhvcm4gPSA1NTY7CiAgICB0LnR3b3N1cGVyaW9yID0gMzAwOwogICAgdC5PZGllcmVzaXMgPSA3Nzg7CiAgICB0Lm11ID0gNTU2OwogICAgdC5pZ3JhdmUgPSAyNzg7CiAgICB0Lm9odW5nYXJ1bWxhdXQgPSA1MDA7CiAgICB0LkVvZ29uZWsgPSA2Njc7CiAgICB0LmRjcm9hdCA9IDU1NjsKICAgIHQudGhyZWVxdWFydGVycyA9IDc1MDsKICAgIHQuU2NlZGlsbGEgPSA1NTY7CiAgICB0LmxjYXJvbiA9IDM5NDsKICAgIHQuS2NvbW1hYWNjZW50ID0gNzc4OwogICAgdC5MYWN1dGUgPSA2Njc7CiAgICB0LnRyYWRlbWFyayA9IDEwMDA7CiAgICB0LmVkb3RhY2NlbnQgPSA0NDQ7CiAgICB0LklncmF2ZSA9IDM4OTsKICAgIHQuSW1hY3JvbiA9IDM4OTsKICAgIHQuTGNhcm9uID0gNjY3OwogICAgdC5vbmVoYWxmID0gNzUwOwogICAgdC5sZXNzZXF1YWwgPSA1NDk7CiAgICB0Lm9jaXJjdW1mbGV4ID0gNTAwOwogICAgdC5udGlsZGUgPSA1NTY7CiAgICB0LlVodW5nYXJ1bWxhdXQgPSA3MjI7CiAgICB0LkVhY3V0ZSA9IDY2NzsKICAgIHQuZW1hY3JvbiA9IDQ0NDsKICAgIHQuZ2JyZXZlID0gNTAwOwogICAgdC5vbmVxdWFydGVyID0gNzUwOwogICAgdC5TY2Fyb24gPSA1NTY7CiAgICB0LlNjb21tYWFjY2VudCA9IDU1NjsKICAgIHQuT2h1bmdhcnVtbGF1dCA9IDc3ODsKICAgIHQuZGVncmVlID0gNDAwOwogICAgdC5vZ3JhdmUgPSA1MDA7CiAgICB0LkNjYXJvbiA9IDcyMjsKICAgIHQudWdyYXZlID0gNTU2OwogICAgdC5yYWRpY2FsID0gNTQ5OwogICAgdC5EY2Fyb24gPSA3MjI7CiAgICB0LnJjb21tYWFjY2VudCA9IDQ0NDsKICAgIHQuTnRpbGRlID0gNzIyOwogICAgdC5vdGlsZGUgPSA1MDA7CiAgICB0LlJjb21tYWFjY2VudCA9IDcyMjsKICAgIHQuTGNvbW1hYWNjZW50ID0gNjY3OwogICAgdC5BdGlsZGUgPSA3MjI7CiAgICB0LkFvZ29uZWsgPSA3MjI7CiAgICB0LkFyaW5nID0gNzIyOwogICAgdC5PdGlsZGUgPSA3Nzg7CiAgICB0Lnpkb3RhY2NlbnQgPSA0NDQ7CiAgICB0LkVjYXJvbiA9IDY2NzsKICAgIHQuSW9nb25layA9IDM4OTsKICAgIHQua2NvbW1hYWNjZW50ID0gNTU2OwogICAgdC5taW51cyA9IDU3MDsKICAgIHQuSWNpcmN1bWZsZXggPSAzODk7CiAgICB0Lm5jYXJvbiA9IDU1NjsKICAgIHQudGNvbW1hYWNjZW50ID0gMzMzOwogICAgdC5sb2dpY2Fsbm90ID0gNTcwOwogICAgdC5vZGllcmVzaXMgPSA1MDA7CiAgICB0LnVkaWVyZXNpcyA9IDU1NjsKICAgIHQubm90ZXF1YWwgPSA1NDk7CiAgICB0Lmdjb21tYWFjY2VudCA9IDUwMDsKICAgIHQuZXRoID0gNTAwOwogICAgdC56Y2Fyb24gPSA0NDQ7CiAgICB0Lm5jb21tYWFjY2VudCA9IDU1NjsKICAgIHQub25lc3VwZXJpb3IgPSAzMDA7CiAgICB0LmltYWNyb24gPSAyNzg7CiAgICB0LkV1cm8gPSA1MDA7CiAgfSk7CiAgdFsiVGltZXMtQm9sZEl0YWxpYyJdID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgICB0LnNwYWNlID0gMjUwOwogICAgdC5leGNsYW0gPSAzODk7CiAgICB0LnF1b3RlZGJsID0gNTU1OwogICAgdC5udW1iZXJzaWduID0gNTAwOwogICAgdC5kb2xsYXIgPSA1MDA7CiAgICB0LnBlcmNlbnQgPSA4MzM7CiAgICB0LmFtcGVyc2FuZCA9IDc3ODsKICAgIHQucXVvdGVyaWdodCA9IDMzMzsKICAgIHQucGFyZW5sZWZ0ID0gMzMzOwogICAgdC5wYXJlbnJpZ2h0ID0gMzMzOwogICAgdC5hc3RlcmlzayA9IDUwMDsKICAgIHQucGx1cyA9IDU3MDsKICAgIHQuY29tbWEgPSAyNTA7CiAgICB0Lmh5cGhlbiA9IDMzMzsKICAgIHQucGVyaW9kID0gMjUwOwogICAgdC5zbGFzaCA9IDI3ODsKICAgIHQuemVybyA9IDUwMDsKICAgIHQub25lID0gNTAwOwogICAgdC50d28gPSA1MDA7CiAgICB0LnRocmVlID0gNTAwOwogICAgdC5mb3VyID0gNTAwOwogICAgdC5maXZlID0gNTAwOwogICAgdC5zaXggPSA1MDA7CiAgICB0LnNldmVuID0gNTAwOwogICAgdC5laWdodCA9IDUwMDsKICAgIHQubmluZSA9IDUwMDsKICAgIHQuY29sb24gPSAzMzM7CiAgICB0LnNlbWljb2xvbiA9IDMzMzsKICAgIHQubGVzcyA9IDU3MDsKICAgIHQuZXF1YWwgPSA1NzA7CiAgICB0LmdyZWF0ZXIgPSA1NzA7CiAgICB0LnF1ZXN0aW9uID0gNTAwOwogICAgdC5hdCA9IDgzMjsKICAgIHQuQSA9IDY2NzsKICAgIHQuQiA9IDY2NzsKICAgIHQuQyA9IDY2NzsKICAgIHQuRCA9IDcyMjsKICAgIHQuRSA9IDY2NzsKICAgIHQuRiA9IDY2NzsKICAgIHQuRyA9IDcyMjsKICAgIHQuSCA9IDc3ODsKICAgIHQuSSA9IDM4OTsKICAgIHQuSiA9IDUwMDsKICAgIHQuSyA9IDY2NzsKICAgIHQuTCA9IDYxMTsKICAgIHQuTSA9IDg4OTsKICAgIHQuTiA9IDcyMjsKICAgIHQuTyA9IDcyMjsKICAgIHQuUCA9IDYxMTsKICAgIHQuUSA9IDcyMjsKICAgIHQuUiA9IDY2NzsKICAgIHQuUyA9IDU1NjsKICAgIHQuVCA9IDYxMTsKICAgIHQuVSA9IDcyMjsKICAgIHQuViA9IDY2NzsKICAgIHQuVyA9IDg4OTsKICAgIHQuWCA9IDY2NzsKICAgIHQuWSA9IDYxMTsKICAgIHQuWiA9IDYxMTsKICAgIHQuYnJhY2tldGxlZnQgPSAzMzM7CiAgICB0LmJhY2tzbGFzaCA9IDI3ODsKICAgIHQuYnJhY2tldHJpZ2h0ID0gMzMzOwogICAgdC5hc2NpaWNpcmN1bSA9IDU3MDsKICAgIHQudW5kZXJzY29yZSA9IDUwMDsKICAgIHQucXVvdGVsZWZ0ID0gMzMzOwogICAgdC5hID0gNTAwOwogICAgdC5iID0gNTAwOwogICAgdC5jID0gNDQ0OwogICAgdC5kID0gNTAwOwogICAgdC5lID0gNDQ0OwogICAgdC5mID0gMzMzOwogICAgdC5nID0gNTAwOwogICAgdC5oID0gNTU2OwogICAgdC5pID0gMjc4OwogICAgdC5qID0gMjc4OwogICAgdC5rID0gNTAwOwogICAgdC5sID0gMjc4OwogICAgdC5tID0gNzc4OwogICAgdC5uID0gNTU2OwogICAgdC5vID0gNTAwOwogICAgdC5wID0gNTAwOwogICAgdC5xID0gNTAwOwogICAgdC5yID0gMzg5OwogICAgdC5zID0gMzg5OwogICAgdC50ID0gMjc4OwogICAgdC51ID0gNTU2OwogICAgdC52ID0gNDQ0OwogICAgdC53ID0gNjY3OwogICAgdC54ID0gNTAwOwogICAgdC55ID0gNDQ0OwogICAgdC56ID0gMzg5OwogICAgdC5icmFjZWxlZnQgPSAzNDg7CiAgICB0LmJhciA9IDIyMDsKICAgIHQuYnJhY2VyaWdodCA9IDM0ODsKICAgIHQuYXNjaWl0aWxkZSA9IDU3MDsKICAgIHQuZXhjbGFtZG93biA9IDM4OTsKICAgIHQuY2VudCA9IDUwMDsKICAgIHQuc3RlcmxpbmcgPSA1MDA7CiAgICB0LmZyYWN0aW9uID0gMTY3OwogICAgdC55ZW4gPSA1MDA7CiAgICB0LmZsb3JpbiA9IDUwMDsKICAgIHQuc2VjdGlvbiA9IDUwMDsKICAgIHQuY3VycmVuY3kgPSA1MDA7CiAgICB0LnF1b3Rlc2luZ2xlID0gMjc4OwogICAgdC5xdW90ZWRibGxlZnQgPSA1MDA7CiAgICB0Lmd1aWxsZW1vdGxlZnQgPSA1MDA7CiAgICB0Lmd1aWxzaW5nbGxlZnQgPSAzMzM7CiAgICB0Lmd1aWxzaW5nbHJpZ2h0ID0gMzMzOwogICAgdC5maSA9IDU1NjsKICAgIHQuZmwgPSA1NTY7CiAgICB0LmVuZGFzaCA9IDUwMDsKICAgIHQuZGFnZ2VyID0gNTAwOwogICAgdC5kYWdnZXJkYmwgPSA1MDA7CiAgICB0LnBlcmlvZGNlbnRlcmVkID0gMjUwOwogICAgdC5wYXJhZ3JhcGggPSA1MDA7CiAgICB0LmJ1bGxldCA9IDM1MDsKICAgIHQucXVvdGVzaW5nbGJhc2UgPSAzMzM7CiAgICB0LnF1b3RlZGJsYmFzZSA9IDUwMDsKICAgIHQucXVvdGVkYmxyaWdodCA9IDUwMDsKICAgIHQuZ3VpbGxlbW90cmlnaHQgPSA1MDA7CiAgICB0LmVsbGlwc2lzID0gMTAwMDsKICAgIHQucGVydGhvdXNhbmQgPSAxMDAwOwogICAgdC5xdWVzdGlvbmRvd24gPSA1MDA7CiAgICB0LmdyYXZlID0gMzMzOwogICAgdC5hY3V0ZSA9IDMzMzsKICAgIHQuY2lyY3VtZmxleCA9IDMzMzsKICAgIHQudGlsZGUgPSAzMzM7CiAgICB0Lm1hY3JvbiA9IDMzMzsKICAgIHQuYnJldmUgPSAzMzM7CiAgICB0LmRvdGFjY2VudCA9IDMzMzsKICAgIHQuZGllcmVzaXMgPSAzMzM7CiAgICB0LnJpbmcgPSAzMzM7CiAgICB0LmNlZGlsbGEgPSAzMzM7CiAgICB0Lmh1bmdhcnVtbGF1dCA9IDMzMzsKICAgIHQub2dvbmVrID0gMzMzOwogICAgdC5jYXJvbiA9IDMzMzsKICAgIHQuZW1kYXNoID0gMTAwMDsKICAgIHQuQUUgPSA5NDQ7CiAgICB0Lm9yZGZlbWluaW5lID0gMjY2OwogICAgdC5Mc2xhc2ggPSA2MTE7CiAgICB0Lk9zbGFzaCA9IDcyMjsKICAgIHQuT0UgPSA5NDQ7CiAgICB0Lm9yZG1hc2N1bGluZSA9IDMwMDsKICAgIHQuYWUgPSA3MjI7CiAgICB0LmRvdGxlc3NpID0gMjc4OwogICAgdC5sc2xhc2ggPSAyNzg7CiAgICB0Lm9zbGFzaCA9IDUwMDsKICAgIHQub2UgPSA3MjI7CiAgICB0Lmdlcm1hbmRibHMgPSA1MDA7CiAgICB0LklkaWVyZXNpcyA9IDM4OTsKICAgIHQuZWFjdXRlID0gNDQ0OwogICAgdC5hYnJldmUgPSA1MDA7CiAgICB0LnVodW5nYXJ1bWxhdXQgPSA1NTY7CiAgICB0LmVjYXJvbiA9IDQ0NDsKICAgIHQuWWRpZXJlc2lzID0gNjExOwogICAgdC5kaXZpZGUgPSA1NzA7CiAgICB0LllhY3V0ZSA9IDYxMTsKICAgIHQuQWNpcmN1bWZsZXggPSA2Njc7CiAgICB0LmFhY3V0ZSA9IDUwMDsKICAgIHQuVWNpcmN1bWZsZXggPSA3MjI7CiAgICB0LnlhY3V0ZSA9IDQ0NDsKICAgIHQuc2NvbW1hYWNjZW50ID0gMzg5OwogICAgdC5lY2lyY3VtZmxleCA9IDQ0NDsKICAgIHQuVXJpbmcgPSA3MjI7CiAgICB0LlVkaWVyZXNpcyA9IDcyMjsKICAgIHQuYW9nb25layA9IDUwMDsKICAgIHQuVWFjdXRlID0gNzIyOwogICAgdC51b2dvbmVrID0gNTU2OwogICAgdC5FZGllcmVzaXMgPSA2Njc7CiAgICB0LkRjcm9hdCA9IDcyMjsKICAgIHQuY29tbWFhY2NlbnQgPSAyNTA7CiAgICB0LmNvcHlyaWdodCA9IDc0NzsKICAgIHQuRW1hY3JvbiA9IDY2NzsKICAgIHQuY2Nhcm9uID0gNDQ0OwogICAgdC5hcmluZyA9IDUwMDsKICAgIHQuTmNvbW1hYWNjZW50ID0gNzIyOwogICAgdC5sYWN1dGUgPSAyNzg7CiAgICB0LmFncmF2ZSA9IDUwMDsKICAgIHQuVGNvbW1hYWNjZW50ID0gNjExOwogICAgdC5DYWN1dGUgPSA2Njc7CiAgICB0LmF0aWxkZSA9IDUwMDsKICAgIHQuRWRvdGFjY2VudCA9IDY2NzsKICAgIHQuc2Nhcm9uID0gMzg5OwogICAgdC5zY2VkaWxsYSA9IDM4OTsKICAgIHQuaWFjdXRlID0gMjc4OwogICAgdC5sb3plbmdlID0gNDk0OwogICAgdC5SY2Fyb24gPSA2Njc7CiAgICB0Lkdjb21tYWFjY2VudCA9IDcyMjsKICAgIHQudWNpcmN1bWZsZXggPSA1NTY7CiAgICB0LmFjaXJjdW1mbGV4ID0gNTAwOwogICAgdC5BbWFjcm9uID0gNjY3OwogICAgdC5yY2Fyb24gPSAzODk7CiAgICB0LmNjZWRpbGxhID0gNDQ0OwogICAgdC5aZG90YWNjZW50ID0gNjExOwogICAgdC5UaG9ybiA9IDYxMTsKICAgIHQuT21hY3JvbiA9IDcyMjsKICAgIHQuUmFjdXRlID0gNjY3OwogICAgdC5TYWN1dGUgPSA1NTY7CiAgICB0LmRjYXJvbiA9IDYwODsKICAgIHQuVW1hY3JvbiA9IDcyMjsKICAgIHQudXJpbmcgPSA1NTY7CiAgICB0LnRocmVlc3VwZXJpb3IgPSAzMDA7CiAgICB0Lk9ncmF2ZSA9IDcyMjsKICAgIHQuQWdyYXZlID0gNjY3OwogICAgdC5BYnJldmUgPSA2Njc7CiAgICB0Lm11bHRpcGx5ID0gNTcwOwogICAgdC51YWN1dGUgPSA1NTY7CiAgICB0LlRjYXJvbiA9IDYxMTsKICAgIHQucGFydGlhbGRpZmYgPSA0OTQ7CiAgICB0LnlkaWVyZXNpcyA9IDQ0NDsKICAgIHQuTmFjdXRlID0gNzIyOwogICAgdC5pY2lyY3VtZmxleCA9IDI3ODsKICAgIHQuRWNpcmN1bWZsZXggPSA2Njc7CiAgICB0LmFkaWVyZXNpcyA9IDUwMDsKICAgIHQuZWRpZXJlc2lzID0gNDQ0OwogICAgdC5jYWN1dGUgPSA0NDQ7CiAgICB0Lm5hY3V0ZSA9IDU1NjsKICAgIHQudW1hY3JvbiA9IDU1NjsKICAgIHQuTmNhcm9uID0gNzIyOwogICAgdC5JYWN1dGUgPSAzODk7CiAgICB0LnBsdXNtaW51cyA9IDU3MDsKICAgIHQuYnJva2VuYmFyID0gMjIwOwogICAgdC5yZWdpc3RlcmVkID0gNzQ3OwogICAgdC5HYnJldmUgPSA3MjI7CiAgICB0Lklkb3RhY2NlbnQgPSAzODk7CiAgICB0LnN1bW1hdGlvbiA9IDYwMDsKICAgIHQuRWdyYXZlID0gNjY3OwogICAgdC5yYWN1dGUgPSAzODk7CiAgICB0Lm9tYWNyb24gPSA1MDA7CiAgICB0LlphY3V0ZSA9IDYxMTsKICAgIHQuWmNhcm9uID0gNjExOwogICAgdC5ncmVhdGVyZXF1YWwgPSA1NDk7CiAgICB0LkV0aCA9IDcyMjsKICAgIHQuQ2NlZGlsbGEgPSA2Njc7CiAgICB0Lmxjb21tYWFjY2VudCA9IDI3ODsKICAgIHQudGNhcm9uID0gMzY2OwogICAgdC5lb2dvbmVrID0gNDQ0OwogICAgdC5Vb2dvbmVrID0gNzIyOwogICAgdC5BYWN1dGUgPSA2Njc7CiAgICB0LkFkaWVyZXNpcyA9IDY2NzsKICAgIHQuZWdyYXZlID0gNDQ0OwogICAgdC56YWN1dGUgPSAzODk7CiAgICB0LmlvZ29uZWsgPSAyNzg7CiAgICB0Lk9hY3V0ZSA9IDcyMjsKICAgIHQub2FjdXRlID0gNTAwOwogICAgdC5hbWFjcm9uID0gNTAwOwogICAgdC5zYWN1dGUgPSAzODk7CiAgICB0LmlkaWVyZXNpcyA9IDI3ODsKICAgIHQuT2NpcmN1bWZsZXggPSA3MjI7CiAgICB0LlVncmF2ZSA9IDcyMjsKICAgIHQuRGVsdGEgPSA2MTI7CiAgICB0LnRob3JuID0gNTAwOwogICAgdC50d29zdXBlcmlvciA9IDMwMDsKICAgIHQuT2RpZXJlc2lzID0gNzIyOwogICAgdC5tdSA9IDU3NjsKICAgIHQuaWdyYXZlID0gMjc4OwogICAgdC5vaHVuZ2FydW1sYXV0ID0gNTAwOwogICAgdC5Fb2dvbmVrID0gNjY3OwogICAgdC5kY3JvYXQgPSA1MDA7CiAgICB0LnRocmVlcXVhcnRlcnMgPSA3NTA7CiAgICB0LlNjZWRpbGxhID0gNTU2OwogICAgdC5sY2Fyb24gPSAzODI7CiAgICB0Lktjb21tYWFjY2VudCA9IDY2NzsKICAgIHQuTGFjdXRlID0gNjExOwogICAgdC50cmFkZW1hcmsgPSAxMDAwOwogICAgdC5lZG90YWNjZW50ID0gNDQ0OwogICAgdC5JZ3JhdmUgPSAzODk7CiAgICB0LkltYWNyb24gPSAzODk7CiAgICB0LkxjYXJvbiA9IDYxMTsKICAgIHQub25laGFsZiA9IDc1MDsKICAgIHQubGVzc2VxdWFsID0gNTQ5OwogICAgdC5vY2lyY3VtZmxleCA9IDUwMDsKICAgIHQubnRpbGRlID0gNTU2OwogICAgdC5VaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5FYWN1dGUgPSA2Njc7CiAgICB0LmVtYWNyb24gPSA0NDQ7CiAgICB0LmdicmV2ZSA9IDUwMDsKICAgIHQub25lcXVhcnRlciA9IDc1MDsKICAgIHQuU2Nhcm9uID0gNTU2OwogICAgdC5TY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0Lk9odW5nYXJ1bWxhdXQgPSA3MjI7CiAgICB0LmRlZ3JlZSA9IDQwMDsKICAgIHQub2dyYXZlID0gNTAwOwogICAgdC5DY2Fyb24gPSA2Njc7CiAgICB0LnVncmF2ZSA9IDU1NjsKICAgIHQucmFkaWNhbCA9IDU0OTsKICAgIHQuRGNhcm9uID0gNzIyOwogICAgdC5yY29tbWFhY2NlbnQgPSAzODk7CiAgICB0Lk50aWxkZSA9IDcyMjsKICAgIHQub3RpbGRlID0gNTAwOwogICAgdC5SY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0Lkxjb21tYWFjY2VudCA9IDYxMTsKICAgIHQuQXRpbGRlID0gNjY3OwogICAgdC5Bb2dvbmVrID0gNjY3OwogICAgdC5BcmluZyA9IDY2NzsKICAgIHQuT3RpbGRlID0gNzIyOwogICAgdC56ZG90YWNjZW50ID0gMzg5OwogICAgdC5FY2Fyb24gPSA2Njc7CiAgICB0LklvZ29uZWsgPSAzODk7CiAgICB0Lmtjb21tYWFjY2VudCA9IDUwMDsKICAgIHQubWludXMgPSA2MDY7CiAgICB0LkljaXJjdW1mbGV4ID0gMzg5OwogICAgdC5uY2Fyb24gPSA1NTY7CiAgICB0LnRjb21tYWFjY2VudCA9IDI3ODsKICAgIHQubG9naWNhbG5vdCA9IDYwNjsKICAgIHQub2RpZXJlc2lzID0gNTAwOwogICAgdC51ZGllcmVzaXMgPSA1NTY7CiAgICB0Lm5vdGVxdWFsID0gNTQ5OwogICAgdC5nY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0LmV0aCA9IDUwMDsKICAgIHQuemNhcm9uID0gMzg5OwogICAgdC5uY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0Lm9uZXN1cGVyaW9yID0gMzAwOwogICAgdC5pbWFjcm9uID0gMjc4OwogICAgdC5FdXJvID0gNTAwOwogIH0pOwogIHRbIlRpbWVzLUl0YWxpYyJdID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgICB0LnNwYWNlID0gMjUwOwogICAgdC5leGNsYW0gPSAzMzM7CiAgICB0LnF1b3RlZGJsID0gNDIwOwogICAgdC5udW1iZXJzaWduID0gNTAwOwogICAgdC5kb2xsYXIgPSA1MDA7CiAgICB0LnBlcmNlbnQgPSA4MzM7CiAgICB0LmFtcGVyc2FuZCA9IDc3ODsKICAgIHQucXVvdGVyaWdodCA9IDMzMzsKICAgIHQucGFyZW5sZWZ0ID0gMzMzOwogICAgdC5wYXJlbnJpZ2h0ID0gMzMzOwogICAgdC5hc3RlcmlzayA9IDUwMDsKICAgIHQucGx1cyA9IDY3NTsKICAgIHQuY29tbWEgPSAyNTA7CiAgICB0Lmh5cGhlbiA9IDMzMzsKICAgIHQucGVyaW9kID0gMjUwOwogICAgdC5zbGFzaCA9IDI3ODsKICAgIHQuemVybyA9IDUwMDsKICAgIHQub25lID0gNTAwOwogICAgdC50d28gPSA1MDA7CiAgICB0LnRocmVlID0gNTAwOwogICAgdC5mb3VyID0gNTAwOwogICAgdC5maXZlID0gNTAwOwogICAgdC5zaXggPSA1MDA7CiAgICB0LnNldmVuID0gNTAwOwogICAgdC5laWdodCA9IDUwMDsKICAgIHQubmluZSA9IDUwMDsKICAgIHQuY29sb24gPSAzMzM7CiAgICB0LnNlbWljb2xvbiA9IDMzMzsKICAgIHQubGVzcyA9IDY3NTsKICAgIHQuZXF1YWwgPSA2NzU7CiAgICB0LmdyZWF0ZXIgPSA2NzU7CiAgICB0LnF1ZXN0aW9uID0gNTAwOwogICAgdC5hdCA9IDkyMDsKICAgIHQuQSA9IDYxMTsKICAgIHQuQiA9IDYxMTsKICAgIHQuQyA9IDY2NzsKICAgIHQuRCA9IDcyMjsKICAgIHQuRSA9IDYxMTsKICAgIHQuRiA9IDYxMTsKICAgIHQuRyA9IDcyMjsKICAgIHQuSCA9IDcyMjsKICAgIHQuSSA9IDMzMzsKICAgIHQuSiA9IDQ0NDsKICAgIHQuSyA9IDY2NzsKICAgIHQuTCA9IDU1NjsKICAgIHQuTSA9IDgzMzsKICAgIHQuTiA9IDY2NzsKICAgIHQuTyA9IDcyMjsKICAgIHQuUCA9IDYxMTsKICAgIHQuUSA9IDcyMjsKICAgIHQuUiA9IDYxMTsKICAgIHQuUyA9IDUwMDsKICAgIHQuVCA9IDU1NjsKICAgIHQuVSA9IDcyMjsKICAgIHQuViA9IDYxMTsKICAgIHQuVyA9IDgzMzsKICAgIHQuWCA9IDYxMTsKICAgIHQuWSA9IDU1NjsKICAgIHQuWiA9IDU1NjsKICAgIHQuYnJhY2tldGxlZnQgPSAzODk7CiAgICB0LmJhY2tzbGFzaCA9IDI3ODsKICAgIHQuYnJhY2tldHJpZ2h0ID0gMzg5OwogICAgdC5hc2NpaWNpcmN1bSA9IDQyMjsKICAgIHQudW5kZXJzY29yZSA9IDUwMDsKICAgIHQucXVvdGVsZWZ0ID0gMzMzOwogICAgdC5hID0gNTAwOwogICAgdC5iID0gNTAwOwogICAgdC5jID0gNDQ0OwogICAgdC5kID0gNTAwOwogICAgdC5lID0gNDQ0OwogICAgdC5mID0gMjc4OwogICAgdC5nID0gNTAwOwogICAgdC5oID0gNTAwOwogICAgdC5pID0gMjc4OwogICAgdC5qID0gMjc4OwogICAgdC5rID0gNDQ0OwogICAgdC5sID0gMjc4OwogICAgdC5tID0gNzIyOwogICAgdC5uID0gNTAwOwogICAgdC5vID0gNTAwOwogICAgdC5wID0gNTAwOwogICAgdC5xID0gNTAwOwogICAgdC5yID0gMzg5OwogICAgdC5zID0gMzg5OwogICAgdC50ID0gMjc4OwogICAgdC51ID0gNTAwOwogICAgdC52ID0gNDQ0OwogICAgdC53ID0gNjY3OwogICAgdC54ID0gNDQ0OwogICAgdC55ID0gNDQ0OwogICAgdC56ID0gMzg5OwogICAgdC5icmFjZWxlZnQgPSA0MDA7CiAgICB0LmJhciA9IDI3NTsKICAgIHQuYnJhY2VyaWdodCA9IDQwMDsKICAgIHQuYXNjaWl0aWxkZSA9IDU0MTsKICAgIHQuZXhjbGFtZG93biA9IDM4OTsKICAgIHQuY2VudCA9IDUwMDsKICAgIHQuc3RlcmxpbmcgPSA1MDA7CiAgICB0LmZyYWN0aW9uID0gMTY3OwogICAgdC55ZW4gPSA1MDA7CiAgICB0LmZsb3JpbiA9IDUwMDsKICAgIHQuc2VjdGlvbiA9IDUwMDsKICAgIHQuY3VycmVuY3kgPSA1MDA7CiAgICB0LnF1b3Rlc2luZ2xlID0gMjE0OwogICAgdC5xdW90ZWRibGxlZnQgPSA1NTY7CiAgICB0Lmd1aWxsZW1vdGxlZnQgPSA1MDA7CiAgICB0Lmd1aWxzaW5nbGxlZnQgPSAzMzM7CiAgICB0Lmd1aWxzaW5nbHJpZ2h0ID0gMzMzOwogICAgdC5maSA9IDUwMDsKICAgIHQuZmwgPSA1MDA7CiAgICB0LmVuZGFzaCA9IDUwMDsKICAgIHQuZGFnZ2VyID0gNTAwOwogICAgdC5kYWdnZXJkYmwgPSA1MDA7CiAgICB0LnBlcmlvZGNlbnRlcmVkID0gMjUwOwogICAgdC5wYXJhZ3JhcGggPSA1MjM7CiAgICB0LmJ1bGxldCA9IDM1MDsKICAgIHQucXVvdGVzaW5nbGJhc2UgPSAzMzM7CiAgICB0LnF1b3RlZGJsYmFzZSA9IDU1NjsKICAgIHQucXVvdGVkYmxyaWdodCA9IDU1NjsKICAgIHQuZ3VpbGxlbW90cmlnaHQgPSA1MDA7CiAgICB0LmVsbGlwc2lzID0gODg5OwogICAgdC5wZXJ0aG91c2FuZCA9IDEwMDA7CiAgICB0LnF1ZXN0aW9uZG93biA9IDUwMDsKICAgIHQuZ3JhdmUgPSAzMzM7CiAgICB0LmFjdXRlID0gMzMzOwogICAgdC5jaXJjdW1mbGV4ID0gMzMzOwogICAgdC50aWxkZSA9IDMzMzsKICAgIHQubWFjcm9uID0gMzMzOwogICAgdC5icmV2ZSA9IDMzMzsKICAgIHQuZG90YWNjZW50ID0gMzMzOwogICAgdC5kaWVyZXNpcyA9IDMzMzsKICAgIHQucmluZyA9IDMzMzsKICAgIHQuY2VkaWxsYSA9IDMzMzsKICAgIHQuaHVuZ2FydW1sYXV0ID0gMzMzOwogICAgdC5vZ29uZWsgPSAzMzM7CiAgICB0LmNhcm9uID0gMzMzOwogICAgdC5lbWRhc2ggPSA4ODk7CiAgICB0LkFFID0gODg5OwogICAgdC5vcmRmZW1pbmluZSA9IDI3NjsKICAgIHQuTHNsYXNoID0gNTU2OwogICAgdC5Pc2xhc2ggPSA3MjI7CiAgICB0Lk9FID0gOTQ0OwogICAgdC5vcmRtYXNjdWxpbmUgPSAzMTA7CiAgICB0LmFlID0gNjY3OwogICAgdC5kb3RsZXNzaSA9IDI3ODsKICAgIHQubHNsYXNoID0gMjc4OwogICAgdC5vc2xhc2ggPSA1MDA7CiAgICB0Lm9lID0gNjY3OwogICAgdC5nZXJtYW5kYmxzID0gNTAwOwogICAgdC5JZGllcmVzaXMgPSAzMzM7CiAgICB0LmVhY3V0ZSA9IDQ0NDsKICAgIHQuYWJyZXZlID0gNTAwOwogICAgdC51aHVuZ2FydW1sYXV0ID0gNTAwOwogICAgdC5lY2Fyb24gPSA0NDQ7CiAgICB0LllkaWVyZXNpcyA9IDU1NjsKICAgIHQuZGl2aWRlID0gNjc1OwogICAgdC5ZYWN1dGUgPSA1NTY7CiAgICB0LkFjaXJjdW1mbGV4ID0gNjExOwogICAgdC5hYWN1dGUgPSA1MDA7CiAgICB0LlVjaXJjdW1mbGV4ID0gNzIyOwogICAgdC55YWN1dGUgPSA0NDQ7CiAgICB0LnNjb21tYWFjY2VudCA9IDM4OTsKICAgIHQuZWNpcmN1bWZsZXggPSA0NDQ7CiAgICB0LlVyaW5nID0gNzIyOwogICAgdC5VZGllcmVzaXMgPSA3MjI7CiAgICB0LmFvZ29uZWsgPSA1MDA7CiAgICB0LlVhY3V0ZSA9IDcyMjsKICAgIHQudW9nb25layA9IDUwMDsKICAgIHQuRWRpZXJlc2lzID0gNjExOwogICAgdC5EY3JvYXQgPSA3MjI7CiAgICB0LmNvbW1hYWNjZW50ID0gMjUwOwogICAgdC5jb3B5cmlnaHQgPSA3NjA7CiAgICB0LkVtYWNyb24gPSA2MTE7CiAgICB0LmNjYXJvbiA9IDQ0NDsKICAgIHQuYXJpbmcgPSA1MDA7CiAgICB0Lk5jb21tYWFjY2VudCA9IDY2NzsKICAgIHQubGFjdXRlID0gMjc4OwogICAgdC5hZ3JhdmUgPSA1MDA7CiAgICB0LlRjb21tYWFjY2VudCA9IDU1NjsKICAgIHQuQ2FjdXRlID0gNjY3OwogICAgdC5hdGlsZGUgPSA1MDA7CiAgICB0LkVkb3RhY2NlbnQgPSA2MTE7CiAgICB0LnNjYXJvbiA9IDM4OTsKICAgIHQuc2NlZGlsbGEgPSAzODk7CiAgICB0LmlhY3V0ZSA9IDI3ODsKICAgIHQubG96ZW5nZSA9IDQ3MTsKICAgIHQuUmNhcm9uID0gNjExOwogICAgdC5HY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LnVjaXJjdW1mbGV4ID0gNTAwOwogICAgdC5hY2lyY3VtZmxleCA9IDUwMDsKICAgIHQuQW1hY3JvbiA9IDYxMTsKICAgIHQucmNhcm9uID0gMzg5OwogICAgdC5jY2VkaWxsYSA9IDQ0NDsKICAgIHQuWmRvdGFjY2VudCA9IDU1NjsKICAgIHQuVGhvcm4gPSA2MTE7CiAgICB0Lk9tYWNyb24gPSA3MjI7CiAgICB0LlJhY3V0ZSA9IDYxMTsKICAgIHQuU2FjdXRlID0gNTAwOwogICAgdC5kY2Fyb24gPSA1NDQ7CiAgICB0LlVtYWNyb24gPSA3MjI7CiAgICB0LnVyaW5nID0gNTAwOwogICAgdC50aHJlZXN1cGVyaW9yID0gMzAwOwogICAgdC5PZ3JhdmUgPSA3MjI7CiAgICB0LkFncmF2ZSA9IDYxMTsKICAgIHQuQWJyZXZlID0gNjExOwogICAgdC5tdWx0aXBseSA9IDY3NTsKICAgIHQudWFjdXRlID0gNTAwOwogICAgdC5UY2Fyb24gPSA1NTY7CiAgICB0LnBhcnRpYWxkaWZmID0gNDc2OwogICAgdC55ZGllcmVzaXMgPSA0NDQ7CiAgICB0Lk5hY3V0ZSA9IDY2NzsKICAgIHQuaWNpcmN1bWZsZXggPSAyNzg7CiAgICB0LkVjaXJjdW1mbGV4ID0gNjExOwogICAgdC5hZGllcmVzaXMgPSA1MDA7CiAgICB0LmVkaWVyZXNpcyA9IDQ0NDsKICAgIHQuY2FjdXRlID0gNDQ0OwogICAgdC5uYWN1dGUgPSA1MDA7CiAgICB0LnVtYWNyb24gPSA1MDA7CiAgICB0Lk5jYXJvbiA9IDY2NzsKICAgIHQuSWFjdXRlID0gMzMzOwogICAgdC5wbHVzbWludXMgPSA2NzU7CiAgICB0LmJyb2tlbmJhciA9IDI3NTsKICAgIHQucmVnaXN0ZXJlZCA9IDc2MDsKICAgIHQuR2JyZXZlID0gNzIyOwogICAgdC5JZG90YWNjZW50ID0gMzMzOwogICAgdC5zdW1tYXRpb24gPSA2MDA7CiAgICB0LkVncmF2ZSA9IDYxMTsKICAgIHQucmFjdXRlID0gMzg5OwogICAgdC5vbWFjcm9uID0gNTAwOwogICAgdC5aYWN1dGUgPSA1NTY7CiAgICB0LlpjYXJvbiA9IDU1NjsKICAgIHQuZ3JlYXRlcmVxdWFsID0gNTQ5OwogICAgdC5FdGggPSA3MjI7CiAgICB0LkNjZWRpbGxhID0gNjY3OwogICAgdC5sY29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LnRjYXJvbiA9IDMwMDsKICAgIHQuZW9nb25layA9IDQ0NDsKICAgIHQuVW9nb25layA9IDcyMjsKICAgIHQuQWFjdXRlID0gNjExOwogICAgdC5BZGllcmVzaXMgPSA2MTE7CiAgICB0LmVncmF2ZSA9IDQ0NDsKICAgIHQuemFjdXRlID0gMzg5OwogICAgdC5pb2dvbmVrID0gMjc4OwogICAgdC5PYWN1dGUgPSA3MjI7CiAgICB0Lm9hY3V0ZSA9IDUwMDsKICAgIHQuYW1hY3JvbiA9IDUwMDsKICAgIHQuc2FjdXRlID0gMzg5OwogICAgdC5pZGllcmVzaXMgPSAyNzg7CiAgICB0Lk9jaXJjdW1mbGV4ID0gNzIyOwogICAgdC5VZ3JhdmUgPSA3MjI7CiAgICB0LkRlbHRhID0gNjEyOwogICAgdC50aG9ybiA9IDUwMDsKICAgIHQudHdvc3VwZXJpb3IgPSAzMDA7CiAgICB0Lk9kaWVyZXNpcyA9IDcyMjsKICAgIHQubXUgPSA1MDA7CiAgICB0LmlncmF2ZSA9IDI3ODsKICAgIHQub2h1bmdhcnVtbGF1dCA9IDUwMDsKICAgIHQuRW9nb25layA9IDYxMTsKICAgIHQuZGNyb2F0ID0gNTAwOwogICAgdC50aHJlZXF1YXJ0ZXJzID0gNzUwOwogICAgdC5TY2VkaWxsYSA9IDUwMDsKICAgIHQubGNhcm9uID0gMzAwOwogICAgdC5LY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0LkxhY3V0ZSA9IDU1NjsKICAgIHQudHJhZGVtYXJrID0gOTgwOwogICAgdC5lZG90YWNjZW50ID0gNDQ0OwogICAgdC5JZ3JhdmUgPSAzMzM7CiAgICB0LkltYWNyb24gPSAzMzM7CiAgICB0LkxjYXJvbiA9IDYxMTsKICAgIHQub25laGFsZiA9IDc1MDsKICAgIHQubGVzc2VxdWFsID0gNTQ5OwogICAgdC5vY2lyY3VtZmxleCA9IDUwMDsKICAgIHQubnRpbGRlID0gNTAwOwogICAgdC5VaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5FYWN1dGUgPSA2MTE7CiAgICB0LmVtYWNyb24gPSA0NDQ7CiAgICB0LmdicmV2ZSA9IDUwMDsKICAgIHQub25lcXVhcnRlciA9IDc1MDsKICAgIHQuU2Nhcm9uID0gNTAwOwogICAgdC5TY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0Lk9odW5nYXJ1bWxhdXQgPSA3MjI7CiAgICB0LmRlZ3JlZSA9IDQwMDsKICAgIHQub2dyYXZlID0gNTAwOwogICAgdC5DY2Fyb24gPSA2Njc7CiAgICB0LnVncmF2ZSA9IDUwMDsKICAgIHQucmFkaWNhbCA9IDQ1MzsKICAgIHQuRGNhcm9uID0gNzIyOwogICAgdC5yY29tbWFhY2NlbnQgPSAzODk7CiAgICB0Lk50aWxkZSA9IDY2NzsKICAgIHQub3RpbGRlID0gNTAwOwogICAgdC5SY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0Lkxjb21tYWFjY2VudCA9IDU1NjsKICAgIHQuQXRpbGRlID0gNjExOwogICAgdC5Bb2dvbmVrID0gNjExOwogICAgdC5BcmluZyA9IDYxMTsKICAgIHQuT3RpbGRlID0gNzIyOwogICAgdC56ZG90YWNjZW50ID0gMzg5OwogICAgdC5FY2Fyb24gPSA2MTE7CiAgICB0LklvZ29uZWsgPSAzMzM7CiAgICB0Lmtjb21tYWFjY2VudCA9IDQ0NDsKICAgIHQubWludXMgPSA2NzU7CiAgICB0LkljaXJjdW1mbGV4ID0gMzMzOwogICAgdC5uY2Fyb24gPSA1MDA7CiAgICB0LnRjb21tYWFjY2VudCA9IDI3ODsKICAgIHQubG9naWNhbG5vdCA9IDY3NTsKICAgIHQub2RpZXJlc2lzID0gNTAwOwogICAgdC51ZGllcmVzaXMgPSA1MDA7CiAgICB0Lm5vdGVxdWFsID0gNTQ5OwogICAgdC5nY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0LmV0aCA9IDUwMDsKICAgIHQuemNhcm9uID0gMzg5OwogICAgdC5uY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0Lm9uZXN1cGVyaW9yID0gMzAwOwogICAgdC5pbWFjcm9uID0gMjc4OwogICAgdC5FdXJvID0gNTAwOwogIH0pOwogIHQuWmFwZkRpbmdiYXRzID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgICB0LnNwYWNlID0gMjc4OwogICAgdC5hMSA9IDk3NDsKICAgIHQuYTIgPSA5NjE7CiAgICB0LmEyMDIgPSA5NzQ7CiAgICB0LmEzID0gOTgwOwogICAgdC5hNCA9IDcxOTsKICAgIHQuYTUgPSA3ODk7CiAgICB0LmExMTkgPSA3OTA7CiAgICB0LmExMTggPSA3OTE7CiAgICB0LmExMTcgPSA2OTA7CiAgICB0LmExMSA9IDk2MDsKICAgIHQuYTEyID0gOTM5OwogICAgdC5hMTMgPSA1NDk7CiAgICB0LmExNCA9IDg1NTsKICAgIHQuYTE1ID0gOTExOwogICAgdC5hMTYgPSA5MzM7CiAgICB0LmExMDUgPSA5MTE7CiAgICB0LmExNyA9IDk0NTsKICAgIHQuYTE4ID0gOTc0OwogICAgdC5hMTkgPSA3NTU7CiAgICB0LmEyMCA9IDg0NjsKICAgIHQuYTIxID0gNzYyOwogICAgdC5hMjIgPSA3NjE7CiAgICB0LmEyMyA9IDU3MTsKICAgIHQuYTI0ID0gNjc3OwogICAgdC5hMjUgPSA3NjM7CiAgICB0LmEyNiA9IDc2MDsKICAgIHQuYTI3ID0gNzU5OwogICAgdC5hMjggPSA3NTQ7CiAgICB0LmE2ID0gNDk0OwogICAgdC5hNyA9IDU1MjsKICAgIHQuYTggPSA1Mzc7CiAgICB0LmE5ID0gNTc3OwogICAgdC5hMTAgPSA2OTI7CiAgICB0LmEyOSA9IDc4NjsKICAgIHQuYTMwID0gNzg4OwogICAgdC5hMzEgPSA3ODg7CiAgICB0LmEzMiA9IDc5MDsKICAgIHQuYTMzID0gNzkzOwogICAgdC5hMzQgPSA3OTQ7CiAgICB0LmEzNSA9IDgxNjsKICAgIHQuYTM2ID0gODIzOwogICAgdC5hMzcgPSA3ODk7CiAgICB0LmEzOCA9IDg0MTsKICAgIHQuYTM5ID0gODIzOwogICAgdC5hNDAgPSA4MzM7CiAgICB0LmE0MSA9IDgxNjsKICAgIHQuYTQyID0gODMxOwogICAgdC5hNDMgPSA5MjM7CiAgICB0LmE0NCA9IDc0NDsKICAgIHQuYTQ1ID0gNzIzOwogICAgdC5hNDYgPSA3NDk7CiAgICB0LmE0NyA9IDc5MDsKICAgIHQuYTQ4ID0gNzkyOwogICAgdC5hNDkgPSA2OTU7CiAgICB0LmE1MCA9IDc3NjsKICAgIHQuYTUxID0gNzY4OwogICAgdC5hNTIgPSA3OTI7CiAgICB0LmE1MyA9IDc1OTsKICAgIHQuYTU0ID0gNzA3OwogICAgdC5hNTUgPSA3MDg7CiAgICB0LmE1NiA9IDY4MjsKICAgIHQuYTU3ID0gNzAxOwogICAgdC5hNTggPSA4MjY7CiAgICB0LmE1OSA9IDgxNTsKICAgIHQuYTYwID0gNzg5OwogICAgdC5hNjEgPSA3ODk7CiAgICB0LmE2MiA9IDcwNzsKICAgIHQuYTYzID0gNjg3OwogICAgdC5hNjQgPSA2OTY7CiAgICB0LmE2NSA9IDY4OTsKICAgIHQuYTY2ID0gNzg2OwogICAgdC5hNjcgPSA3ODc7CiAgICB0LmE2OCA9IDcxMzsKICAgIHQuYTY5ID0gNzkxOwogICAgdC5hNzAgPSA3ODU7CiAgICB0LmE3MSA9IDc5MTsKICAgIHQuYTcyID0gODczOwogICAgdC5hNzMgPSA3NjE7CiAgICB0LmE3NCA9IDc2MjsKICAgIHQuYTIwMyA9IDc2MjsKICAgIHQuYTc1ID0gNzU5OwogICAgdC5hMjA0ID0gNzU5OwogICAgdC5hNzYgPSA4OTI7CiAgICB0LmE3NyA9IDg5MjsKICAgIHQuYTc4ID0gNzg4OwogICAgdC5hNzkgPSA3ODQ7CiAgICB0LmE4MSA9IDQzODsKICAgIHQuYTgyID0gMTM4OwogICAgdC5hODMgPSAyNzc7CiAgICB0LmE4NCA9IDQxNTsKICAgIHQuYTk3ID0gMzkyOwogICAgdC5hOTggPSAzOTI7CiAgICB0LmE5OSA9IDY2ODsKICAgIHQuYTEwMCA9IDY2ODsKICAgIHQuYTg5ID0gMzkwOwogICAgdC5hOTAgPSAzOTA7CiAgICB0LmE5MyA9IDMxNzsKICAgIHQuYTk0ID0gMzE3OwogICAgdC5hOTEgPSAyNzY7CiAgICB0LmE5MiA9IDI3NjsKICAgIHQuYTIwNSA9IDUwOTsKICAgIHQuYTg1ID0gNTA5OwogICAgdC5hMjA2ID0gNDEwOwogICAgdC5hODYgPSA0MTA7CiAgICB0LmE4NyA9IDIzNDsKICAgIHQuYTg4ID0gMjM0OwogICAgdC5hOTUgPSAzMzQ7CiAgICB0LmE5NiA9IDMzNDsKICAgIHQuYTEwMSA9IDczMjsKICAgIHQuYTEwMiA9IDU0NDsKICAgIHQuYTEwMyA9IDU0NDsKICAgIHQuYTEwNCA9IDkxMDsKICAgIHQuYTEwNiA9IDY2NzsKICAgIHQuYTEwNyA9IDc2MDsKICAgIHQuYTEwOCA9IDc2MDsKICAgIHQuYTExMiA9IDc3NjsKICAgIHQuYTExMSA9IDU5NTsKICAgIHQuYTExMCA9IDY5NDsKICAgIHQuYTEwOSA9IDYyNjsKICAgIHQuYTEyMCA9IDc4ODsKICAgIHQuYTEyMSA9IDc4ODsKICAgIHQuYTEyMiA9IDc4ODsKICAgIHQuYTEyMyA9IDc4ODsKICAgIHQuYTEyNCA9IDc4ODsKICAgIHQuYTEyNSA9IDc4ODsKICAgIHQuYTEyNiA9IDc4ODsKICAgIHQuYTEyNyA9IDc4ODsKICAgIHQuYTEyOCA9IDc4ODsKICAgIHQuYTEyOSA9IDc4ODsKICAgIHQuYTEzMCA9IDc4ODsKICAgIHQuYTEzMSA9IDc4ODsKICAgIHQuYTEzMiA9IDc4ODsKICAgIHQuYTEzMyA9IDc4ODsKICAgIHQuYTEzNCA9IDc4ODsKICAgIHQuYTEzNSA9IDc4ODsKICAgIHQuYTEzNiA9IDc4ODsKICAgIHQuYTEzNyA9IDc4ODsKICAgIHQuYTEzOCA9IDc4ODsKICAgIHQuYTEzOSA9IDc4ODsKICAgIHQuYTE0MCA9IDc4ODsKICAgIHQuYTE0MSA9IDc4ODsKICAgIHQuYTE0MiA9IDc4ODsKICAgIHQuYTE0MyA9IDc4ODsKICAgIHQuYTE0NCA9IDc4ODsKICAgIHQuYTE0NSA9IDc4ODsKICAgIHQuYTE0NiA9IDc4ODsKICAgIHQuYTE0NyA9IDc4ODsKICAgIHQuYTE0OCA9IDc4ODsKICAgIHQuYTE0OSA9IDc4ODsKICAgIHQuYTE1MCA9IDc4ODsKICAgIHQuYTE1MSA9IDc4ODsKICAgIHQuYTE1MiA9IDc4ODsKICAgIHQuYTE1MyA9IDc4ODsKICAgIHQuYTE1NCA9IDc4ODsKICAgIHQuYTE1NSA9IDc4ODsKICAgIHQuYTE1NiA9IDc4ODsKICAgIHQuYTE1NyA9IDc4ODsKICAgIHQuYTE1OCA9IDc4ODsKICAgIHQuYTE1OSA9IDc4ODsKICAgIHQuYTE2MCA9IDg5NDsKICAgIHQuYTE2MSA9IDgzODsKICAgIHQuYTE2MyA9IDEwMTY7CiAgICB0LmExNjQgPSA0NTg7CiAgICB0LmExOTYgPSA3NDg7CiAgICB0LmExNjUgPSA5MjQ7CiAgICB0LmExOTIgPSA3NDg7CiAgICB0LmExNjYgPSA5MTg7CiAgICB0LmExNjcgPSA5Mjc7CiAgICB0LmExNjggPSA5Mjg7CiAgICB0LmExNjkgPSA5Mjg7CiAgICB0LmExNzAgPSA4MzQ7CiAgICB0LmExNzEgPSA4NzM7CiAgICB0LmExNzIgPSA4Mjg7CiAgICB0LmExNzMgPSA5MjQ7CiAgICB0LmExNjIgPSA5MjQ7CiAgICB0LmExNzQgPSA5MTc7CiAgICB0LmExNzUgPSA5MzA7CiAgICB0LmExNzYgPSA5MzE7CiAgICB0LmExNzcgPSA0NjM7CiAgICB0LmExNzggPSA4ODM7CiAgICB0LmExNzkgPSA4MzY7CiAgICB0LmExOTMgPSA4MzY7CiAgICB0LmExODAgPSA4Njc7CiAgICB0LmExOTkgPSA4Njc7CiAgICB0LmExODEgPSA2OTY7CiAgICB0LmEyMDAgPSA2OTY7CiAgICB0LmExODIgPSA4NzQ7CiAgICB0LmEyMDEgPSA4NzQ7CiAgICB0LmExODMgPSA3NjA7CiAgICB0LmExODQgPSA5NDY7CiAgICB0LmExOTcgPSA3NzE7CiAgICB0LmExODUgPSA4NjU7CiAgICB0LmExOTQgPSA3NzE7CiAgICB0LmExOTggPSA4ODg7CiAgICB0LmExODYgPSA5Njc7CiAgICB0LmExOTUgPSA4ODg7CiAgICB0LmExODcgPSA4MzE7CiAgICB0LmExODggPSA4NzM7CiAgICB0LmExODkgPSA5Mjc7CiAgICB0LmExOTAgPSA5NzA7CiAgICB0LmExOTEgPSA5MTg7CiAgfSk7Cn0pOwpjb25zdCBnZXRGb250QmFzaWNNZXRyaWNzID0gZ2V0TG9va3VwVGFibGVGYWN0b3J5KGZ1bmN0aW9uICh0KSB7CiAgdC5Db3VyaWVyID0gewogICAgYXNjZW50OiA2MjksCiAgICBkZXNjZW50OiAtMTU3LAogICAgY2FwSGVpZ2h0OiA1NjIsCiAgICB4SGVpZ2h0OiAtNDI2CiAgfTsKICB0WyJDb3VyaWVyLUJvbGQiXSA9IHsKICAgIGFzY2VudDogNjI5LAogICAgZGVzY2VudDogLTE1NywKICAgIGNhcEhlaWdodDogNTYyLAogICAgeEhlaWdodDogNDM5CiAgfTsKICB0WyJDb3VyaWVyLU9ibGlxdWUiXSA9IHsKICAgIGFzY2VudDogNjI5LAogICAgZGVzY2VudDogLTE1NywKICAgIGNhcEhlaWdodDogNTYyLAogICAgeEhlaWdodDogNDI2CiAgfTsKICB0WyJDb3VyaWVyLUJvbGRPYmxpcXVlIl0gPSB7CiAgICBhc2NlbnQ6IDYyOSwKICAgIGRlc2NlbnQ6IC0xNTcsCiAgICBjYXBIZWlnaHQ6IDU2MiwKICAgIHhIZWlnaHQ6IDQyNgogIH07CiAgdC5IZWx2ZXRpY2EgPSB7CiAgICBhc2NlbnQ6IDcxOCwKICAgIGRlc2NlbnQ6IC0yMDcsCiAgICBjYXBIZWlnaHQ6IDcxOCwKICAgIHhIZWlnaHQ6IDUyMwogIH07CiAgdFsiSGVsdmV0aWNhLUJvbGQiXSA9IHsKICAgIGFzY2VudDogNzE4LAogICAgZGVzY2VudDogLTIwNywKICAgIGNhcEhlaWdodDogNzE4LAogICAgeEhlaWdodDogNTMyCiAgfTsKICB0WyJIZWx2ZXRpY2EtT2JsaXF1ZSJdID0gewogICAgYXNjZW50OiA3MTgsCiAgICBkZXNjZW50OiAtMjA3LAogICAgY2FwSGVpZ2h0OiA3MTgsCiAgICB4SGVpZ2h0OiA1MjMKICB9OwogIHRbIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSJdID0gewogICAgYXNjZW50OiA3MTgsCiAgICBkZXNjZW50OiAtMjA3LAogICAgY2FwSGVpZ2h0OiA3MTgsCiAgICB4SGVpZ2h0OiA1MzIKICB9OwogIHRbIlRpbWVzLVJvbWFuIl0gPSB7CiAgICBhc2NlbnQ6IDY4MywKICAgIGRlc2NlbnQ6IC0yMTcsCiAgICBjYXBIZWlnaHQ6IDY2MiwKICAgIHhIZWlnaHQ6IDQ1MAogIH07CiAgdFsiVGltZXMtQm9sZCJdID0gewogICAgYXNjZW50OiA2ODMsCiAgICBkZXNjZW50OiAtMjE3LAogICAgY2FwSGVpZ2h0OiA2NzYsCiAgICB4SGVpZ2h0OiA0NjEKICB9OwogIHRbIlRpbWVzLUl0YWxpYyJdID0gewogICAgYXNjZW50OiA2ODMsCiAgICBkZXNjZW50OiAtMjE3LAogICAgY2FwSGVpZ2h0OiA2NTMsCiAgICB4SGVpZ2h0OiA0NDEKICB9OwogIHRbIlRpbWVzLUJvbGRJdGFsaWMiXSA9IHsKICAgIGFzY2VudDogNjgzLAogICAgZGVzY2VudDogLTIxNywKICAgIGNhcEhlaWdodDogNjY5LAogICAgeEhlaWdodDogNDYyCiAgfTsKICB0LlN5bWJvbCA9IHsKICAgIGFzY2VudDogTWF0aC5OYU4sCiAgICBkZXNjZW50OiBNYXRoLk5hTiwKICAgIGNhcEhlaWdodDogTWF0aC5OYU4sCiAgICB4SGVpZ2h0OiBNYXRoLk5hTgogIH07CiAgdC5aYXBmRGluZ2JhdHMgPSB7CiAgICBhc2NlbnQ6IE1hdGguTmFOLAogICAgZGVzY2VudDogTWF0aC5OYU4sCiAgICBjYXBIZWlnaHQ6IE1hdGguTmFOLAogICAgeEhlaWdodDogTWF0aC5OYU4KICB9Owp9KTsKCjsvLyAuL3NyYy9jb3JlL2dseWYuanMKY29uc3QgT05fQ1VSVkVfUE9JTlQgPSAxIDw8IDA7CmNvbnN0IFhfU0hPUlRfVkVDVE9SID0gMSA8PCAxOwpjb25zdCBZX1NIT1JUX1ZFQ1RPUiA9IDEgPDwgMjsKY29uc3QgUkVQRUFUX0ZMQUcgPSAxIDw8IDM7CmNvbnN0IFhfSVNfU0FNRV9PUl9QT1NJVElWRV9YX1NIT1JUX1ZFQ1RPUiA9IDEgPDwgNDsKY29uc3QgWV9JU19TQU1FX09SX1BPU0lUSVZFX1lfU0hPUlRfVkVDVE9SID0gMSA8PCA1Owpjb25zdCBPVkVSTEFQX1NJTVBMRSA9IDEgPDwgNjsKY29uc3QgQVJHXzFfQU5EXzJfQVJFX1dPUkRTID0gMSA8PCAwOwpjb25zdCBBUkdTX0FSRV9YWV9WQUxVRVMgPSAxIDw8IDE7CmNvbnN0IFdFX0hBVkVfQV9TQ0FMRSA9IDEgPDwgMzsKY29uc3QgTU9SRV9DT01QT05FTlRTID0gMSA8PCA1Owpjb25zdCBXRV9IQVZFX0FOX1hfQU5EX1lfU0NBTEUgPSAxIDw8IDY7CmNvbnN0IFdFX0hBVkVfQV9UV09fQllfVFdPID0gMSA8PCA3Owpjb25zdCBXRV9IQVZFX0lOU1RSVUNUSU9OUyA9IDEgPDwgODsKY2xhc3MgR2x5ZlRhYmxlIHsKICBjb25zdHJ1Y3Rvcih7CiAgICBnbHlmVGFibGUsCiAgICBpc0dseXBoTG9jYXRpb25zTG9uZywKICAgIGxvY2FUYWJsZSwKICAgIG51bUdseXBocwogIH0pIHsKICAgIHRoaXMuZ2x5cGhzID0gW107CiAgICBjb25zdCBsb2NhID0gbmV3IERhdGFWaWV3KGxvY2FUYWJsZS5idWZmZXIsIGxvY2FUYWJsZS5ieXRlT2Zmc2V0LCBsb2NhVGFibGUuYnl0ZUxlbmd0aCk7CiAgICBjb25zdCBnbHlmID0gbmV3IERhdGFWaWV3KGdseWZUYWJsZS5idWZmZXIsIGdseWZUYWJsZS5ieXRlT2Zmc2V0LCBnbHlmVGFibGUuYnl0ZUxlbmd0aCk7CiAgICBjb25zdCBvZmZzZXRTaXplID0gaXNHbHlwaExvY2F0aW9uc0xvbmcgPyA0IDogMjsKICAgIGxldCBwcmV2ID0gaXNHbHlwaExvY2F0aW9uc0xvbmcgPyBsb2NhLmdldFVpbnQzMigwKSA6IDIgKiBsb2NhLmdldFVpbnQxNigwKTsKICAgIGxldCBwb3MgPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1HbHlwaHM7IGkrKykgewogICAgICBwb3MgKz0gb2Zmc2V0U2l6ZTsKICAgICAgY29uc3QgbmV4dCA9IGlzR2x5cGhMb2NhdGlvbnNMb25nID8gbG9jYS5nZXRVaW50MzIocG9zKSA6IDIgKiBsb2NhLmdldFVpbnQxNihwb3MpOwogICAgICBpZiAobmV4dCA9PT0gcHJldikgewogICAgICAgIHRoaXMuZ2x5cGhzLnB1c2gobmV3IEdseXBoKHt9KSk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgZ2x5cGggPSBHbHlwaC5wYXJzZShwcmV2LCBnbHlmKTsKICAgICAgdGhpcy5nbHlwaHMucHVzaChnbHlwaCk7CiAgICAgIHByZXYgPSBuZXh0OwogICAgfQogIH0KICBnZXRTaXplKCkgewogICAgcmV0dXJuIE1hdGguc3VtUHJlY2lzZSh0aGlzLmdseXBocy5tYXAoZyA9PiBnLmdldFNpemUoKSArIDMgJiB+MykpOwogIH0KICB3cml0ZSgpIHsKICAgIGNvbnN0IHRvdGFsU2l6ZSA9IHRoaXMuZ2V0U2l6ZSgpOwogICAgY29uc3QgZ2x5ZlRhYmxlID0gbmV3IERhdGFWaWV3KG5ldyBBcnJheUJ1ZmZlcih0b3RhbFNpemUpKTsKICAgIGNvbnN0IGlzTG9jYXRpb25Mb25nID0gdG90YWxTaXplID4gMHgxZmZmZTsKICAgIGNvbnN0IG9mZnNldFNpemUgPSBpc0xvY2F0aW9uTG9uZyA/IDQgOiAyOwogICAgY29uc3QgbG9jYVRhYmxlID0gbmV3IERhdGFWaWV3KG5ldyBBcnJheUJ1ZmZlcigodGhpcy5nbHlwaHMubGVuZ3RoICsgMSkgKiBvZmZzZXRTaXplKSk7CiAgICBpZiAoaXNMb2NhdGlvbkxvbmcpIHsKICAgICAgbG9jYVRhYmxlLnNldFVpbnQzMigwLCAwKTsKICAgIH0gZWxzZSB7CiAgICAgIGxvY2FUYWJsZS5zZXRVaW50MTYoMCwgMCk7CiAgICB9CiAgICBsZXQgcG9zID0gMDsKICAgIGxldCBsb2NhSW5kZXggPSAwOwogICAgZm9yIChjb25zdCBnbHlwaCBvZiB0aGlzLmdseXBocykgewogICAgICBwb3MgKz0gZ2x5cGgud3JpdGUocG9zLCBnbHlmVGFibGUpOwogICAgICBwb3MgPSBwb3MgKyAzICYgfjM7CiAgICAgIGxvY2FJbmRleCArPSBvZmZzZXRTaXplOwogICAgICBpZiAoaXNMb2NhdGlvbkxvbmcpIHsKICAgICAgICBsb2NhVGFibGUuc2V0VWludDMyKGxvY2FJbmRleCwgcG9zKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsb2NhVGFibGUuc2V0VWludDE2KGxvY2FJbmRleCwgcG9zID4+IDEpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICBpc0xvY2F0aW9uTG9uZywKICAgICAgbG9jYTogbmV3IFVpbnQ4QXJyYXkobG9jYVRhYmxlLmJ1ZmZlciksCiAgICAgIGdseWY6IG5ldyBVaW50OEFycmF5KGdseWZUYWJsZS5idWZmZXIpCiAgICB9OwogIH0KICBzY2FsZShmYWN0b3JzKSB7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB0aGlzLmdseXBocy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIHRoaXMuZ2x5cGhzW2ldLnNjYWxlKGZhY3RvcnNbaV0pOwogICAgfQogIH0KfQpjbGFzcyBHbHlwaCB7CiAgY29uc3RydWN0b3IoewogICAgaGVhZGVyID0gbnVsbCwKICAgIHNpbXBsZSA9IG51bGwsCiAgICBjb21wb3NpdGVzID0gbnVsbAogIH0pIHsKICAgIHRoaXMuaGVhZGVyID0gaGVhZGVyOwogICAgdGhpcy5zaW1wbGUgPSBzaW1wbGU7CiAgICB0aGlzLmNvbXBvc2l0ZXMgPSBjb21wb3NpdGVzOwogIH0KICBzdGF0aWMgcGFyc2UocG9zLCBnbHlmKSB7CiAgICBjb25zdCBbcmVhZCwgaGVhZGVyXSA9IEdseXBoSGVhZGVyLnBhcnNlKHBvcywgZ2x5Zik7CiAgICBwb3MgKz0gcmVhZDsKICAgIGlmIChoZWFkZXIubnVtYmVyT2ZDb250b3VycyA8IDApIHsKICAgICAgY29uc3QgY29tcG9zaXRlcyA9IFtdOwogICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgIGNvbnN0IFtuLCBjb21wb3NpdGVdID0gQ29tcG9zaXRlR2x5cGgucGFyc2UocG9zLCBnbHlmKTsKICAgICAgICBwb3MgKz0gbjsKICAgICAgICBjb21wb3NpdGVzLnB1c2goY29tcG9zaXRlKTsKICAgICAgICBpZiAoIShjb21wb3NpdGUuZmxhZ3MgJiBNT1JFX0NPTVBPTkVOVFMpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG5ldyBHbHlwaCh7CiAgICAgICAgaGVhZGVyLAogICAgICAgIGNvbXBvc2l0ZXMKICAgICAgfSk7CiAgICB9CiAgICBjb25zdCBzaW1wbGUgPSBTaW1wbGVHbHlwaC5wYXJzZShwb3MsIGdseWYsIGhlYWRlci5udW1iZXJPZkNvbnRvdXJzKTsKICAgIHJldHVybiBuZXcgR2x5cGgoewogICAgICBoZWFkZXIsCiAgICAgIHNpbXBsZQogICAgfSk7CiAgfQogIGdldFNpemUoKSB7CiAgICBpZiAoIXRoaXMuaGVhZGVyKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgY29uc3Qgc2l6ZSA9IHRoaXMuc2ltcGxlID8gdGhpcy5zaW1wbGUuZ2V0U2l6ZSgpIDogTWF0aC5zdW1QcmVjaXNlKHRoaXMuY29tcG9zaXRlcy5tYXAoYyA9PiBjLmdldFNpemUoKSkpOwogICAgcmV0dXJuIHRoaXMuaGVhZGVyLmdldFNpemUoKSArIHNpemU7CiAgfQogIHdyaXRlKHBvcywgYnVmKSB7CiAgICBpZiAoIXRoaXMuaGVhZGVyKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgY29uc3Qgc3BvcyA9IHBvczsKICAgIHBvcyArPSB0aGlzLmhlYWRlci53cml0ZShwb3MsIGJ1Zik7CiAgICBpZiAodGhpcy5zaW1wbGUpIHsKICAgICAgcG9zICs9IHRoaXMuc2ltcGxlLndyaXRlKHBvcywgYnVmKTsKICAgIH0gZWxzZSB7CiAgICAgIGZvciAoY29uc3QgY29tcG9zaXRlIG9mIHRoaXMuY29tcG9zaXRlcykgewogICAgICAgIHBvcyArPSBjb21wb3NpdGUud3JpdGUocG9zLCBidWYpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcG9zIC0gc3BvczsKICB9CiAgc2NhbGUoZmFjdG9yKSB7CiAgICBpZiAoIXRoaXMuaGVhZGVyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHhNaWRkbGUgPSAodGhpcy5oZWFkZXIueE1pbiArIHRoaXMuaGVhZGVyLnhNYXgpIC8gMjsKICAgIHRoaXMuaGVhZGVyLnNjYWxlKHhNaWRkbGUsIGZhY3Rvcik7CiAgICBpZiAodGhpcy5zaW1wbGUpIHsKICAgICAgdGhpcy5zaW1wbGUuc2NhbGUoeE1pZGRsZSwgZmFjdG9yKTsKICAgIH0gZWxzZSB7CiAgICAgIGZvciAoY29uc3QgY29tcG9zaXRlIG9mIHRoaXMuY29tcG9zaXRlcykgewogICAgICAgIGNvbXBvc2l0ZS5zY2FsZSh4TWlkZGxlLCBmYWN0b3IpOwogICAgICB9CiAgICB9CiAgfQp9CmNsYXNzIEdseXBoSGVhZGVyIHsKICBjb25zdHJ1Y3Rvcih7CiAgICBudW1iZXJPZkNvbnRvdXJzLAogICAgeE1pbiwKICAgIHlNaW4sCiAgICB4TWF4LAogICAgeU1heAogIH0pIHsKICAgIHRoaXMubnVtYmVyT2ZDb250b3VycyA9IG51bWJlck9mQ29udG91cnM7CiAgICB0aGlzLnhNaW4gPSB4TWluOwogICAgdGhpcy55TWluID0geU1pbjsKICAgIHRoaXMueE1heCA9IHhNYXg7CiAgICB0aGlzLnlNYXggPSB5TWF4OwogIH0KICBzdGF0aWMgcGFyc2UocG9zLCBnbHlmKSB7CiAgICByZXR1cm4gWzEwLCBuZXcgR2x5cGhIZWFkZXIoewogICAgICBudW1iZXJPZkNvbnRvdXJzOiBnbHlmLmdldEludDE2KHBvcyksCiAgICAgIHhNaW46IGdseWYuZ2V0SW50MTYocG9zICsgMiksCiAgICAgIHlNaW46IGdseWYuZ2V0SW50MTYocG9zICsgNCksCiAgICAgIHhNYXg6IGdseWYuZ2V0SW50MTYocG9zICsgNiksCiAgICAgIHlNYXg6IGdseWYuZ2V0SW50MTYocG9zICsgOCkKICAgIH0pXTsKICB9CiAgZ2V0U2l6ZSgpIHsKICAgIHJldHVybiAxMDsKICB9CiAgd3JpdGUocG9zLCBidWYpIHsKICAgIGJ1Zi5zZXRJbnQxNihwb3MsIHRoaXMubnVtYmVyT2ZDb250b3Vycyk7CiAgICBidWYuc2V0SW50MTYocG9zICsgMiwgdGhpcy54TWluKTsKICAgIGJ1Zi5zZXRJbnQxNihwb3MgKyA0LCB0aGlzLnlNaW4pOwogICAgYnVmLnNldEludDE2KHBvcyArIDYsIHRoaXMueE1heCk7CiAgICBidWYuc2V0SW50MTYocG9zICsgOCwgdGhpcy55TWF4KTsKICAgIHJldHVybiAxMDsKICB9CiAgc2NhbGUoeCwgZmFjdG9yKSB7CiAgICB0aGlzLnhNaW4gPSBNYXRoLnJvdW5kKHggKyAodGhpcy54TWluIC0geCkgKiBmYWN0b3IpOwogICAgdGhpcy54TWF4ID0gTWF0aC5yb3VuZCh4ICsgKHRoaXMueE1heCAtIHgpICogZmFjdG9yKTsKICB9Cn0KY2xhc3MgQ29udG91ciB7CiAgY29uc3RydWN0b3IoewogICAgZmxhZ3MsCiAgICB4Q29vcmRpbmF0ZXMsCiAgICB5Q29vcmRpbmF0ZXMKICB9KSB7CiAgICB0aGlzLnhDb29yZGluYXRlcyA9IHhDb29yZGluYXRlczsKICAgIHRoaXMueUNvb3JkaW5hdGVzID0geUNvb3JkaW5hdGVzOwogICAgdGhpcy5mbGFncyA9IGZsYWdzOwogIH0KfQpjbGFzcyBTaW1wbGVHbHlwaCB7CiAgY29uc3RydWN0b3IoewogICAgY29udG91cnMsCiAgICBpbnN0cnVjdGlvbnMKICB9KSB7CiAgICB0aGlzLmNvbnRvdXJzID0gY29udG91cnM7CiAgICB0aGlzLmluc3RydWN0aW9ucyA9IGluc3RydWN0aW9uczsKICB9CiAgc3RhdGljIHBhcnNlKHBvcywgZ2x5ZiwgbnVtYmVyT2ZDb250b3VycykgewogICAgY29uc3QgZW5kUHRzT2ZDb250b3VycyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1iZXJPZkNvbnRvdXJzOyBpKyspIHsKICAgICAgY29uc3QgZW5kUHQgPSBnbHlmLmdldFVpbnQxNihwb3MpOwogICAgICBwb3MgKz0gMjsKICAgICAgZW5kUHRzT2ZDb250b3Vycy5wdXNoKGVuZFB0KTsKICAgIH0KICAgIGNvbnN0IG51bWJlck9mUHQgPSBlbmRQdHNPZkNvbnRvdXJzW251bWJlck9mQ29udG91cnMgLSAxXSArIDE7CiAgICBjb25zdCBpbnN0cnVjdGlvbkxlbmd0aCA9IGdseWYuZ2V0VWludDE2KHBvcyk7CiAgICBwb3MgKz0gMjsKICAgIGNvbnN0IGluc3RydWN0aW9ucyA9IG5ldyBVaW50OEFycmF5KGdseWYpLnNsaWNlKHBvcywgcG9zICsgaW5zdHJ1Y3Rpb25MZW5ndGgpOwogICAgcG9zICs9IGluc3RydWN0aW9uTGVuZ3RoOwogICAgY29uc3QgZmxhZ3MgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtYmVyT2ZQdDsgcG9zKyssIGkrKykgewogICAgICBsZXQgZmxhZyA9IGdseWYuZ2V0VWludDgocG9zKTsKICAgICAgZmxhZ3MucHVzaChmbGFnKTsKICAgICAgaWYgKGZsYWcgJiBSRVBFQVRfRkxBRykgewogICAgICAgIGNvbnN0IGNvdW50ID0gZ2x5Zi5nZXRVaW50OCgrK3Bvcyk7CiAgICAgICAgZmxhZyBePSBSRVBFQVRfRkxBRzsKICAgICAgICBmb3IgKGxldCBtID0gMDsgbSA8IGNvdW50OyBtKyspIHsKICAgICAgICAgIGZsYWdzLnB1c2goZmxhZyk7CiAgICAgICAgfQogICAgICAgIGkgKz0gY291bnQ7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGFsbFhDb29yZGluYXRlcyA9IFtdOwogICAgbGV0IHhDb29yZGluYXRlcyA9IFtdOwogICAgbGV0IHlDb29yZGluYXRlcyA9IFtdOwogICAgbGV0IHBvaW50RmxhZ3MgPSBbXTsKICAgIGNvbnN0IGNvbnRvdXJzID0gW107CiAgICBsZXQgZW5kUHRzT2ZDb250b3Vyc0luZGV4ID0gMDsKICAgIGxldCBsYXN0Q29vcmRpbmF0ZSA9IDA7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bWJlck9mUHQ7IGkrKykgewogICAgICBjb25zdCBmbGFnID0gZmxhZ3NbaV07CiAgICAgIGlmIChmbGFnICYgWF9TSE9SVF9WRUNUT1IpIHsKICAgICAgICBjb25zdCB4ID0gZ2x5Zi5nZXRVaW50OChwb3MrKyk7CiAgICAgICAgbGFzdENvb3JkaW5hdGUgKz0gZmxhZyAmIFhfSVNfU0FNRV9PUl9QT1NJVElWRV9YX1NIT1JUX1ZFQ1RPUiA/IHggOiAteDsKICAgICAgICB4Q29vcmRpbmF0ZXMucHVzaChsYXN0Q29vcmRpbmF0ZSk7CiAgICAgIH0gZWxzZSBpZiAoZmxhZyAmIFhfSVNfU0FNRV9PUl9QT1NJVElWRV9YX1NIT1JUX1ZFQ1RPUikgewogICAgICAgIHhDb29yZGluYXRlcy5wdXNoKGxhc3RDb29yZGluYXRlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsYXN0Q29vcmRpbmF0ZSArPSBnbHlmLmdldEludDE2KHBvcyk7CiAgICAgICAgcG9zICs9IDI7CiAgICAgICAgeENvb3JkaW5hdGVzLnB1c2gobGFzdENvb3JkaW5hdGUpOwogICAgICB9CiAgICAgIGlmIChlbmRQdHNPZkNvbnRvdXJzW2VuZFB0c09mQ29udG91cnNJbmRleF0gPT09IGkpIHsKICAgICAgICBlbmRQdHNPZkNvbnRvdXJzSW5kZXgrKzsKICAgICAgICBhbGxYQ29vcmRpbmF0ZXMucHVzaCh4Q29vcmRpbmF0ZXMpOwogICAgICAgIHhDb29yZGluYXRlcyA9IFtdOwogICAgICB9CiAgICB9CiAgICBsYXN0Q29vcmRpbmF0ZSA9IDA7CiAgICBlbmRQdHNPZkNvbnRvdXJzSW5kZXggPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1iZXJPZlB0OyBpKyspIHsKICAgICAgY29uc3QgZmxhZyA9IGZsYWdzW2ldOwogICAgICBpZiAoZmxhZyAmIFlfU0hPUlRfVkVDVE9SKSB7CiAgICAgICAgY29uc3QgeSA9IGdseWYuZ2V0VWludDgocG9zKyspOwogICAgICAgIGxhc3RDb29yZGluYXRlICs9IGZsYWcgJiBZX0lTX1NBTUVfT1JfUE9TSVRJVkVfWV9TSE9SVF9WRUNUT1IgPyB5IDogLXk7CiAgICAgICAgeUNvb3JkaW5hdGVzLnB1c2gobGFzdENvb3JkaW5hdGUpOwogICAgICB9IGVsc2UgaWYgKGZsYWcgJiBZX0lTX1NBTUVfT1JfUE9TSVRJVkVfWV9TSE9SVF9WRUNUT1IpIHsKICAgICAgICB5Q29vcmRpbmF0ZXMucHVzaChsYXN0Q29vcmRpbmF0ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGFzdENvb3JkaW5hdGUgKz0gZ2x5Zi5nZXRJbnQxNihwb3MpOwogICAgICAgIHBvcyArPSAyOwogICAgICAgIHlDb29yZGluYXRlcy5wdXNoKGxhc3RDb29yZGluYXRlKTsKICAgICAgfQogICAgICBwb2ludEZsYWdzLnB1c2goZmxhZyAmIE9OX0NVUlZFX1BPSU5UIHwgZmxhZyAmIE9WRVJMQVBfU0lNUExFKTsKICAgICAgaWYgKGVuZFB0c09mQ29udG91cnNbZW5kUHRzT2ZDb250b3Vyc0luZGV4XSA9PT0gaSkgewogICAgICAgIHhDb29yZGluYXRlcyA9IGFsbFhDb29yZGluYXRlc1tlbmRQdHNPZkNvbnRvdXJzSW5kZXhdOwogICAgICAgIGVuZFB0c09mQ29udG91cnNJbmRleCsrOwogICAgICAgIGNvbnRvdXJzLnB1c2gobmV3IENvbnRvdXIoewogICAgICAgICAgZmxhZ3M6IHBvaW50RmxhZ3MsCiAgICAgICAgICB4Q29vcmRpbmF0ZXMsCiAgICAgICAgICB5Q29vcmRpbmF0ZXMKICAgICAgICB9KSk7CiAgICAgICAgeUNvb3JkaW5hdGVzID0gW107CiAgICAgICAgcG9pbnRGbGFncyA9IFtdOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbmV3IFNpbXBsZUdseXBoKHsKICAgICAgY29udG91cnMsCiAgICAgIGluc3RydWN0aW9ucwogICAgfSk7CiAgfQogIGdldFNpemUoKSB7CiAgICBsZXQgc2l6ZSA9IHRoaXMuY29udG91cnMubGVuZ3RoICogMiArIDIgKyB0aGlzLmluc3RydWN0aW9ucy5sZW5ndGg7CiAgICBsZXQgbGFzdFggPSAwOwogICAgbGV0IGxhc3RZID0gMDsKICAgIGZvciAoY29uc3QgY29udG91ciBvZiB0aGlzLmNvbnRvdXJzKSB7CiAgICAgIHNpemUgKz0gY29udG91ci5mbGFncy5sZW5ndGg7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGNvbnRvdXIueENvb3JkaW5hdGVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCB4ID0gY29udG91ci54Q29vcmRpbmF0ZXNbaV07CiAgICAgICAgY29uc3QgeSA9IGNvbnRvdXIueUNvb3JkaW5hdGVzW2ldOwogICAgICAgIGxldCBhYnMgPSBNYXRoLmFicyh4IC0gbGFzdFgpOwogICAgICAgIGlmIChhYnMgPiAyNTUpIHsKICAgICAgICAgIHNpemUgKz0gMjsKICAgICAgICB9IGVsc2UgaWYgKGFicyA+IDApIHsKICAgICAgICAgIHNpemUgKz0gMTsKICAgICAgICB9CiAgICAgICAgbGFzdFggPSB4OwogICAgICAgIGFicyA9IE1hdGguYWJzKHkgLSBsYXN0WSk7CiAgICAgICAgaWYgKGFicyA+IDI1NSkgewogICAgICAgICAgc2l6ZSArPSAyOwogICAgICAgIH0gZWxzZSBpZiAoYWJzID4gMCkgewogICAgICAgICAgc2l6ZSArPSAxOwogICAgICAgIH0KICAgICAgICBsYXN0WSA9IHk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaXplOwogIH0KICB3cml0ZShwb3MsIGJ1ZikgewogICAgY29uc3Qgc3BvcyA9IHBvczsKICAgIGNvbnN0IHhDb29yZGluYXRlcyA9IFtdOwogICAgY29uc3QgeUNvb3JkaW5hdGVzID0gW107CiAgICBjb25zdCBmbGFncyA9IFtdOwogICAgbGV0IGxhc3RYID0gMDsKICAgIGxldCBsYXN0WSA9IDA7CiAgICBmb3IgKGNvbnN0IGNvbnRvdXIgb2YgdGhpcy5jb250b3VycykgewogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjb250b3VyLnhDb29yZGluYXRlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgbGV0IGZsYWcgPSBjb250b3VyLmZsYWdzW2ldOwogICAgICAgIGNvbnN0IHggPSBjb250b3VyLnhDb29yZGluYXRlc1tpXTsKICAgICAgICBsZXQgZGVsdGEgPSB4IC0gbGFzdFg7CiAgICAgICAgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgICBmbGFnIHw9IFhfSVNfU0FNRV9PUl9QT1NJVElWRV9YX1NIT1JUX1ZFQ1RPUjsKICAgICAgICAgIHhDb29yZGluYXRlcy5wdXNoKDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBhYnMgPSBNYXRoLmFicyhkZWx0YSk7CiAgICAgICAgICBpZiAoYWJzIDw9IDI1NSkgewogICAgICAgICAgICBmbGFnIHw9IGRlbHRhID49IDAgPyBYX1NIT1JUX1ZFQ1RPUiB8IFhfSVNfU0FNRV9PUl9QT1NJVElWRV9YX1NIT1JUX1ZFQ1RPUiA6IFhfU0hPUlRfVkVDVE9SOwogICAgICAgICAgICB4Q29vcmRpbmF0ZXMucHVzaChhYnMpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgeENvb3JkaW5hdGVzLnB1c2goZGVsdGEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsYXN0WCA9IHg7CiAgICAgICAgY29uc3QgeSA9IGNvbnRvdXIueUNvb3JkaW5hdGVzW2ldOwogICAgICAgIGRlbHRhID0geSAtIGxhc3RZOwogICAgICAgIGlmIChkZWx0YSA9PT0gMCkgewogICAgICAgICAgZmxhZyB8PSBZX0lTX1NBTUVfT1JfUE9TSVRJVkVfWV9TSE9SVF9WRUNUT1I7CiAgICAgICAgICB5Q29vcmRpbmF0ZXMucHVzaCgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3QgYWJzID0gTWF0aC5hYnMoZGVsdGEpOwogICAgICAgICAgaWYgKGFicyA8PSAyNTUpIHsKICAgICAgICAgICAgZmxhZyB8PSBkZWx0YSA+PSAwID8gWV9TSE9SVF9WRUNUT1IgfCBZX0lTX1NBTUVfT1JfUE9TSVRJVkVfWV9TSE9SVF9WRUNUT1IgOiBZX1NIT1JUX1ZFQ1RPUjsKICAgICAgICAgICAgeUNvb3JkaW5hdGVzLnB1c2goYWJzKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHlDb29yZGluYXRlcy5wdXNoKGRlbHRhKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbGFzdFkgPSB5OwogICAgICAgIGZsYWdzLnB1c2goZmxhZyk7CiAgICAgIH0KICAgICAgYnVmLnNldFVpbnQxNihwb3MsIHhDb29yZGluYXRlcy5sZW5ndGggLSAxKTsKICAgICAgcG9zICs9IDI7CiAgICB9CiAgICBidWYuc2V0VWludDE2KHBvcywgdGhpcy5pbnN0cnVjdGlvbnMubGVuZ3RoKTsKICAgIHBvcyArPSAyOwogICAgaWYgKHRoaXMuaW5zdHJ1Y3Rpb25zLmxlbmd0aCkgewogICAgICBuZXcgVWludDhBcnJheShidWYuYnVmZmVyLCAwLCBidWYuYnVmZmVyLmJ5dGVMZW5ndGgpLnNldCh0aGlzLmluc3RydWN0aW9ucywgcG9zKTsKICAgICAgcG9zICs9IHRoaXMuaW5zdHJ1Y3Rpb25zLmxlbmd0aDsKICAgIH0KICAgIGZvciAoY29uc3QgZmxhZyBvZiBmbGFncykgewogICAgICBidWYuc2V0VWludDgocG9zKyssIGZsYWcpOwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGlpID0geENvb3JkaW5hdGVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgeCA9IHhDb29yZGluYXRlc1tpXTsKICAgICAgY29uc3QgZmxhZyA9IGZsYWdzW2ldOwogICAgICBpZiAoZmxhZyAmIFhfU0hPUlRfVkVDVE9SKSB7CiAgICAgICAgYnVmLnNldFVpbnQ4KHBvcysrLCB4KTsKICAgICAgfSBlbHNlIGlmICghKGZsYWcgJiBYX0lTX1NBTUVfT1JfUE9TSVRJVkVfWF9TSE9SVF9WRUNUT1IpKSB7CiAgICAgICAgYnVmLnNldEludDE2KHBvcywgeCk7CiAgICAgICAgcG9zICs9IDI7CiAgICAgIH0KICAgIH0KICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHlDb29yZGluYXRlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IHkgPSB5Q29vcmRpbmF0ZXNbaV07CiAgICAgIGNvbnN0IGZsYWcgPSBmbGFnc1tpXTsKICAgICAgaWYgKGZsYWcgJiBZX1NIT1JUX1ZFQ1RPUikgewogICAgICAgIGJ1Zi5zZXRVaW50OChwb3MrKywgeSk7CiAgICAgIH0gZWxzZSBpZiAoIShmbGFnICYgWV9JU19TQU1FX09SX1BPU0lUSVZFX1lfU0hPUlRfVkVDVE9SKSkgewogICAgICAgIGJ1Zi5zZXRJbnQxNihwb3MsIHkpOwogICAgICAgIHBvcyArPSAyOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcG9zIC0gc3BvczsKICB9CiAgc2NhbGUoeCwgZmFjdG9yKSB7CiAgICBmb3IgKGNvbnN0IGNvbnRvdXIgb2YgdGhpcy5jb250b3VycykgewogICAgICBpZiAoY29udG91ci54Q29vcmRpbmF0ZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gY29udG91ci54Q29vcmRpbmF0ZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvbnRvdXIueENvb3JkaW5hdGVzW2ldID0gTWF0aC5yb3VuZCh4ICsgKGNvbnRvdXIueENvb3JkaW5hdGVzW2ldIC0geCkgKiBmYWN0b3IpOwogICAgICB9CiAgICB9CiAgfQp9CmNsYXNzIENvbXBvc2l0ZUdseXBoIHsKICBjb25zdHJ1Y3Rvcih7CiAgICBmbGFncywKICAgIGdseXBoSW5kZXgsCiAgICBhcmd1bWVudDEsCiAgICBhcmd1bWVudDIsCiAgICB0cmFuc2YsCiAgICBpbnN0cnVjdGlvbnMKICB9KSB7CiAgICB0aGlzLmZsYWdzID0gZmxhZ3M7CiAgICB0aGlzLmdseXBoSW5kZXggPSBnbHlwaEluZGV4OwogICAgdGhpcy5hcmd1bWVudDEgPSBhcmd1bWVudDE7CiAgICB0aGlzLmFyZ3VtZW50MiA9IGFyZ3VtZW50MjsKICAgIHRoaXMudHJhbnNmID0gdHJhbnNmOwogICAgdGhpcy5pbnN0cnVjdGlvbnMgPSBpbnN0cnVjdGlvbnM7CiAgfQogIHN0YXRpYyBwYXJzZShwb3MsIGdseWYpIHsKICAgIGNvbnN0IHNwb3MgPSBwb3M7CiAgICBjb25zdCB0cmFuc2YgPSBbXTsKICAgIGxldCBmbGFncyA9IGdseWYuZ2V0VWludDE2KHBvcyk7CiAgICBjb25zdCBnbHlwaEluZGV4ID0gZ2x5Zi5nZXRVaW50MTYocG9zICsgMik7CiAgICBwb3MgKz0gNDsKICAgIGxldCBhcmd1bWVudDEsIGFyZ3VtZW50MjsKICAgIGlmIChmbGFncyAmIEFSR18xX0FORF8yX0FSRV9XT1JEUykgewogICAgICBpZiAoZmxhZ3MgJiBBUkdTX0FSRV9YWV9WQUxVRVMpIHsKICAgICAgICBhcmd1bWVudDEgPSBnbHlmLmdldEludDE2KHBvcyk7CiAgICAgICAgYXJndW1lbnQyID0gZ2x5Zi5nZXRJbnQxNihwb3MgKyAyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhcmd1bWVudDEgPSBnbHlmLmdldFVpbnQxNihwb3MpOwogICAgICAgIGFyZ3VtZW50MiA9IGdseWYuZ2V0VWludDE2KHBvcyArIDIpOwogICAgICB9CiAgICAgIHBvcyArPSA0OwogICAgICBmbGFncyBePSBBUkdfMV9BTkRfMl9BUkVfV09SRFM7CiAgICB9IGVsc2UgewogICAgICBpZiAoZmxhZ3MgJiBBUkdTX0FSRV9YWV9WQUxVRVMpIHsKICAgICAgICBhcmd1bWVudDEgPSBnbHlmLmdldEludDgocG9zKTsKICAgICAgICBhcmd1bWVudDIgPSBnbHlmLmdldEludDgocG9zICsgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYXJndW1lbnQxID0gZ2x5Zi5nZXRVaW50OChwb3MpOwogICAgICAgIGFyZ3VtZW50MiA9IGdseWYuZ2V0VWludDgocG9zICsgMSk7CiAgICAgIH0KICAgICAgcG9zICs9IDI7CiAgICB9CiAgICBpZiAoZmxhZ3MgJiBXRV9IQVZFX0FfU0NBTEUpIHsKICAgICAgdHJhbnNmLnB1c2goZ2x5Zi5nZXRVaW50MTYocG9zKSk7CiAgICAgIHBvcyArPSAyOwogICAgfSBlbHNlIGlmIChmbGFncyAmIFdFX0hBVkVfQU5fWF9BTkRfWV9TQ0FMRSkgewogICAgICB0cmFuc2YucHVzaChnbHlmLmdldFVpbnQxNihwb3MpLCBnbHlmLmdldFVpbnQxNihwb3MgKyAyKSk7CiAgICAgIHBvcyArPSA0OwogICAgfSBlbHNlIGlmIChmbGFncyAmIFdFX0hBVkVfQV9UV09fQllfVFdPKSB7CiAgICAgIHRyYW5zZi5wdXNoKGdseWYuZ2V0VWludDE2KHBvcyksIGdseWYuZ2V0VWludDE2KHBvcyArIDIpLCBnbHlmLmdldFVpbnQxNihwb3MgKyA0KSwgZ2x5Zi5nZXRVaW50MTYocG9zICsgNikpOwogICAgICBwb3MgKz0gODsKICAgIH0KICAgIGxldCBpbnN0cnVjdGlvbnMgPSBudWxsOwogICAgaWYgKGZsYWdzICYgV0VfSEFWRV9JTlNUUlVDVElPTlMpIHsKICAgICAgY29uc3QgaW5zdHJ1Y3Rpb25MZW5ndGggPSBnbHlmLmdldFVpbnQxNihwb3MpOwogICAgICBwb3MgKz0gMjsKICAgICAgaW5zdHJ1Y3Rpb25zID0gbmV3IFVpbnQ4QXJyYXkoZ2x5Zikuc2xpY2UocG9zLCBwb3MgKyBpbnN0cnVjdGlvbkxlbmd0aCk7CiAgICAgIHBvcyArPSBpbnN0cnVjdGlvbkxlbmd0aDsKICAgIH0KICAgIHJldHVybiBbcG9zIC0gc3BvcywgbmV3IENvbXBvc2l0ZUdseXBoKHsKICAgICAgZmxhZ3MsCiAgICAgIGdseXBoSW5kZXgsCiAgICAgIGFyZ3VtZW50MSwKICAgICAgYXJndW1lbnQyLAogICAgICB0cmFuc2YsCiAgICAgIGluc3RydWN0aW9ucwogICAgfSldOwogIH0KICBnZXRTaXplKCkgewogICAgbGV0IHNpemUgPSAyICsgMiArIHRoaXMudHJhbnNmLmxlbmd0aCAqIDI7CiAgICBpZiAodGhpcy5mbGFncyAmIFdFX0hBVkVfSU5TVFJVQ1RJT05TKSB7CiAgICAgIHNpemUgKz0gMiArIHRoaXMuaW5zdHJ1Y3Rpb25zLmxlbmd0aDsKICAgIH0KICAgIHNpemUgKz0gMjsKICAgIGlmICh0aGlzLmZsYWdzICYgMikgewogICAgICBpZiAoISh0aGlzLmFyZ3VtZW50MSA+PSAtMTI4ICYmIHRoaXMuYXJndW1lbnQxIDw9IDEyNyAmJiB0aGlzLmFyZ3VtZW50MiA+PSAtMTI4ICYmIHRoaXMuYXJndW1lbnQyIDw9IDEyNykpIHsKICAgICAgICBzaXplICs9IDI7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoISh0aGlzLmFyZ3VtZW50MSA+PSAwICYmIHRoaXMuYXJndW1lbnQxIDw9IDI1NSAmJiB0aGlzLmFyZ3VtZW50MiA+PSAwICYmIHRoaXMuYXJndW1lbnQyIDw9IDI1NSkpIHsKICAgICAgc2l6ZSArPSAyOwogICAgfQogICAgcmV0dXJuIHNpemU7CiAgfQogIHdyaXRlKHBvcywgYnVmKSB7CiAgICBjb25zdCBzcG9zID0gcG9zOwogICAgaWYgKHRoaXMuZmxhZ3MgJiBBUkdTX0FSRV9YWV9WQUxVRVMpIHsKICAgICAgaWYgKCEodGhpcy5hcmd1bWVudDEgPj0gLTEyOCAmJiB0aGlzLmFyZ3VtZW50MSA8PSAxMjcgJiYgdGhpcy5hcmd1bWVudDIgPj0gLTEyOCAmJiB0aGlzLmFyZ3VtZW50MiA8PSAxMjcpKSB7CiAgICAgICAgdGhpcy5mbGFncyB8PSBBUkdfMV9BTkRfMl9BUkVfV09SRFM7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoISh0aGlzLmFyZ3VtZW50MSA+PSAwICYmIHRoaXMuYXJndW1lbnQxIDw9IDI1NSAmJiB0aGlzLmFyZ3VtZW50MiA+PSAwICYmIHRoaXMuYXJndW1lbnQyIDw9IDI1NSkpIHsKICAgICAgdGhpcy5mbGFncyB8PSBBUkdfMV9BTkRfMl9BUkVfV09SRFM7CiAgICB9CiAgICBidWYuc2V0VWludDE2KHBvcywgdGhpcy5mbGFncyk7CiAgICBidWYuc2V0VWludDE2KHBvcyArIDIsIHRoaXMuZ2x5cGhJbmRleCk7CiAgICBwb3MgKz0gNDsKICAgIGlmICh0aGlzLmZsYWdzICYgQVJHXzFfQU5EXzJfQVJFX1dPUkRTKSB7CiAgICAgIGlmICh0aGlzLmZsYWdzICYgQVJHU19BUkVfWFlfVkFMVUVTKSB7CiAgICAgICAgYnVmLnNldEludDE2KHBvcywgdGhpcy5hcmd1bWVudDEpOwogICAgICAgIGJ1Zi5zZXRJbnQxNihwb3MgKyAyLCB0aGlzLmFyZ3VtZW50Mik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnVmLnNldFVpbnQxNihwb3MsIHRoaXMuYXJndW1lbnQxKTsKICAgICAgICBidWYuc2V0VWludDE2KHBvcyArIDIsIHRoaXMuYXJndW1lbnQyKTsKICAgICAgfQogICAgICBwb3MgKz0gNDsKICAgIH0gZWxzZSB7CiAgICAgIGJ1Zi5zZXRVaW50OChwb3MsIHRoaXMuYXJndW1lbnQxKTsKICAgICAgYnVmLnNldFVpbnQ4KHBvcyArIDEsIHRoaXMuYXJndW1lbnQyKTsKICAgICAgcG9zICs9IDI7CiAgICB9CiAgICBpZiAodGhpcy5mbGFncyAmIFdFX0hBVkVfSU5TVFJVQ1RJT05TKSB7CiAgICAgIGJ1Zi5zZXRVaW50MTYocG9zLCB0aGlzLmluc3RydWN0aW9ucy5sZW5ndGgpOwogICAgICBwb3MgKz0gMjsKICAgICAgaWYgKHRoaXMuaW5zdHJ1Y3Rpb25zLmxlbmd0aCkgewogICAgICAgIG5ldyBVaW50OEFycmF5KGJ1Zi5idWZmZXIsIDAsIGJ1Zi5idWZmZXIuYnl0ZUxlbmd0aCkuc2V0KHRoaXMuaW5zdHJ1Y3Rpb25zLCBwb3MpOwogICAgICAgIHBvcyArPSB0aGlzLmluc3RydWN0aW9ucy5sZW5ndGg7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBwb3MgLSBzcG9zOwogIH0KICBzY2FsZSh4LCBmYWN0b3IpIHt9Cn0KCjsvLyAuL3NyYy9jb3JlL29wZW50eXBlX2ZpbGVfYnVpbGRlci5qcwoKCmZ1bmN0aW9uIHdyaXRlSW50MTYoZGVzdCwgb2Zmc2V0LCBudW0pIHsKICBkZXN0W29mZnNldF0gPSBudW0gPj4gOCAmIDB4ZmY7CiAgZGVzdFtvZmZzZXQgKyAxXSA9IG51bSAmIDB4ZmY7Cn0KZnVuY3Rpb24gd3JpdGVJbnQzMihkZXN0LCBvZmZzZXQsIG51bSkgewogIGRlc3Rbb2Zmc2V0XSA9IG51bSA+PiAyNCAmIDB4ZmY7CiAgZGVzdFtvZmZzZXQgKyAxXSA9IG51bSA+PiAxNiAmIDB4ZmY7CiAgZGVzdFtvZmZzZXQgKyAyXSA9IG51bSA+PiA4ICYgMHhmZjsKICBkZXN0W29mZnNldCArIDNdID0gbnVtICYgMHhmZjsKfQpmdW5jdGlvbiB3cml0ZURhdGEoZGVzdCwgb2Zmc2V0LCBkYXRhKSB7CiAgaWYgKGRhdGEgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7CiAgICBkZXN0LnNldChkYXRhLCBvZmZzZXQpOwogIH0gZWxzZSBpZiAodHlwZW9mIGRhdGEgPT09ICJzdHJpbmciKSB7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBkYXRhLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgZGVzdFtvZmZzZXQrK10gPSBkYXRhLmNoYXJDb2RlQXQoaSkgJiAweGZmOwogICAgfQogIH0gZWxzZSB7CiAgICBmb3IgKGNvbnN0IG51bSBvZiBkYXRhKSB7CiAgICAgIGRlc3Rbb2Zmc2V0KytdID0gbnVtICYgMHhmZjsKICAgIH0KICB9Cn0KY29uc3QgT1RGX0hFQURFUl9TSVpFID0gMTI7CmNvbnN0IE9URl9UQUJMRV9FTlRSWV9TSVpFID0gMTY7CmNsYXNzIE9wZW5UeXBlRmlsZUJ1aWxkZXIgewogIGNvbnN0cnVjdG9yKHNmbnQpIHsKICAgIHRoaXMuc2ZudCA9IHNmbnQ7CiAgICB0aGlzLnRhYmxlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgfQogIHN0YXRpYyBnZXRTZWFyY2hQYXJhbXMoZW50cmllc0NvdW50LCBlbnRyeVNpemUpIHsKICAgIGxldCBtYXhQb3dlcjIgPSAxLAogICAgICBsb2cyID0gMDsKICAgIHdoaWxlICgobWF4UG93ZXIyIF4gZW50cmllc0NvdW50KSA+IG1heFBvd2VyMikgewogICAgICBtYXhQb3dlcjIgPDw9IDE7CiAgICAgIGxvZzIrKzsKICAgIH0KICAgIGNvbnN0IHNlYXJjaFJhbmdlID0gbWF4UG93ZXIyICogZW50cnlTaXplOwogICAgcmV0dXJuIHsKICAgICAgcmFuZ2U6IHNlYXJjaFJhbmdlLAogICAgICBlbnRyeTogbG9nMiwKICAgICAgcmFuZ2VTaGlmdDogZW50cnlTaXplICogZW50cmllc0NvdW50IC0gc2VhcmNoUmFuZ2UKICAgIH07CiAgfQogIHRvQXJyYXkoKSB7CiAgICBsZXQgc2ZudCA9IHRoaXMuc2ZudDsKICAgIGNvbnN0IHRhYmxlcyA9IHRoaXMudGFibGVzOwogICAgY29uc3QgdGFibGVzTmFtZXMgPSBPYmplY3Qua2V5cyh0YWJsZXMpOwogICAgdGFibGVzTmFtZXMuc29ydCgpOwogICAgY29uc3QgbnVtVGFibGVzID0gdGFibGVzTmFtZXMubGVuZ3RoOwogICAgbGV0IGksIGosIGpqLCB0YWJsZSwgdGFibGVOYW1lOwogICAgbGV0IG9mZnNldCA9IE9URl9IRUFERVJfU0laRSArIG51bVRhYmxlcyAqIE9URl9UQUJMRV9FTlRSWV9TSVpFOwogICAgY29uc3QgdGFibGVPZmZzZXRzID0gW29mZnNldF07CiAgICBmb3IgKGkgPSAwOyBpIDwgbnVtVGFibGVzOyBpKyspIHsKICAgICAgdGFibGUgPSB0YWJsZXNbdGFibGVzTmFtZXNbaV1dOwogICAgICBjb25zdCBwYWRkZWRMZW5ndGggPSAodGFibGUubGVuZ3RoICsgMyAmIH4zKSA+Pj4gMDsKICAgICAgb2Zmc2V0ICs9IHBhZGRlZExlbmd0aDsKICAgICAgdGFibGVPZmZzZXRzLnB1c2gob2Zmc2V0KTsKICAgIH0KICAgIGNvbnN0IGZpbGUgPSBuZXcgVWludDhBcnJheShvZmZzZXQpOwogICAgZm9yIChpID0gMDsgaSA8IG51bVRhYmxlczsgaSsrKSB7CiAgICAgIHRhYmxlID0gdGFibGVzW3RhYmxlc05hbWVzW2ldXTsKICAgICAgd3JpdGVEYXRhKGZpbGUsIHRhYmxlT2Zmc2V0c1tpXSwgdGFibGUpOwogICAgfQogICAgaWYgKHNmbnQgPT09ICJ0cnVlIikgewogICAgICBzZm50ID0gc3RyaW5nMzIoMHgwMDAxMDAwMCk7CiAgICB9CiAgICBmaWxlWzBdID0gc2ZudC5jaGFyQ29kZUF0KDApICYgMHhmZjsKICAgIGZpbGVbMV0gPSBzZm50LmNoYXJDb2RlQXQoMSkgJiAweGZmOwogICAgZmlsZVsyXSA9IHNmbnQuY2hhckNvZGVBdCgyKSAmIDB4ZmY7CiAgICBmaWxlWzNdID0gc2ZudC5jaGFyQ29kZUF0KDMpICYgMHhmZjsKICAgIHdyaXRlSW50MTYoZmlsZSwgNCwgbnVtVGFibGVzKTsKICAgIGNvbnN0IHNlYXJjaFBhcmFtcyA9IE9wZW5UeXBlRmlsZUJ1aWxkZXIuZ2V0U2VhcmNoUGFyYW1zKG51bVRhYmxlcywgMTYpOwogICAgd3JpdGVJbnQxNihmaWxlLCA2LCBzZWFyY2hQYXJhbXMucmFuZ2UpOwogICAgd3JpdGVJbnQxNihmaWxlLCA4LCBzZWFyY2hQYXJhbXMuZW50cnkpOwogICAgd3JpdGVJbnQxNihmaWxlLCAxMCwgc2VhcmNoUGFyYW1zLnJhbmdlU2hpZnQpOwogICAgb2Zmc2V0ID0gT1RGX0hFQURFUl9TSVpFOwogICAgZm9yIChpID0gMDsgaSA8IG51bVRhYmxlczsgaSsrKSB7CiAgICAgIHRhYmxlTmFtZSA9IHRhYmxlc05hbWVzW2ldOwogICAgICBmaWxlW29mZnNldF0gPSB0YWJsZU5hbWUuY2hhckNvZGVBdCgwKSAmIDB4ZmY7CiAgICAgIGZpbGVbb2Zmc2V0ICsgMV0gPSB0YWJsZU5hbWUuY2hhckNvZGVBdCgxKSAmIDB4ZmY7CiAgICAgIGZpbGVbb2Zmc2V0ICsgMl0gPSB0YWJsZU5hbWUuY2hhckNvZGVBdCgyKSAmIDB4ZmY7CiAgICAgIGZpbGVbb2Zmc2V0ICsgM10gPSB0YWJsZU5hbWUuY2hhckNvZGVBdCgzKSAmIDB4ZmY7CiAgICAgIGxldCBjaGVja3N1bSA9IDA7CiAgICAgIGZvciAoaiA9IHRhYmxlT2Zmc2V0c1tpXSwgamogPSB0YWJsZU9mZnNldHNbaSArIDFdOyBqIDwgamo7IGogKz0gNCkgewogICAgICAgIGNvbnN0IHF1YWQgPSByZWFkVWludDMyKGZpbGUsIGopOwogICAgICAgIGNoZWNrc3VtID0gY2hlY2tzdW0gKyBxdWFkID4+PiAwOwogICAgICB9CiAgICAgIHdyaXRlSW50MzIoZmlsZSwgb2Zmc2V0ICsgNCwgY2hlY2tzdW0pOwogICAgICB3cml0ZUludDMyKGZpbGUsIG9mZnNldCArIDgsIHRhYmxlT2Zmc2V0c1tpXSk7CiAgICAgIHdyaXRlSW50MzIoZmlsZSwgb2Zmc2V0ICsgMTIsIHRhYmxlc1t0YWJsZU5hbWVdLmxlbmd0aCk7CiAgICAgIG9mZnNldCArPSBPVEZfVEFCTEVfRU5UUllfU0laRTsKICAgIH0KICAgIHJldHVybiBmaWxlOwogIH0KICBhZGRUYWJsZSh0YWcsIGRhdGEpIHsKICAgIGlmICh0YWcgaW4gdGhpcy50YWJsZXMpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJUYWJsZSAiICsgdGFnICsgIiBhbHJlYWR5IGV4aXN0cyIpOwogICAgfQogICAgdGhpcy50YWJsZXNbdGFnXSA9IGRhdGE7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS90eXBlMV9wYXJzZXIuanMKCgoKCmNvbnN0IEhJTlRJTkdfRU5BQkxFRCA9IGZhbHNlOwpjb25zdCBDT01NQU5EX01BUCA9IHsKICBoc3RlbTogWzFdLAogIHZzdGVtOiBbM10sCiAgdm1vdmV0bzogWzRdLAogIHJsaW5ldG86IFs1XSwKICBobGluZXRvOiBbNl0sCiAgdmxpbmV0bzogWzddLAogIHJyY3VydmV0bzogWzhdLAogIGNhbGxzdWJyOiBbMTBdLAogIGZsZXg6IFsxMiwgMzVdLAogIGRyb3A6IFsxMiwgMThdLAogIGVuZGNoYXI6IFsxNF0sCiAgcm1vdmV0bzogWzIxXSwKICBobW92ZXRvOiBbMjJdLAogIHZoY3VydmV0bzogWzMwXSwKICBodmN1cnZldG86IFszMV0KfTsKY2xhc3MgVHlwZTFDaGFyU3RyaW5nIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMud2lkdGggPSAwOwogICAgdGhpcy5sc2IgPSAwOwogICAgdGhpcy5mbGV4aW5nID0gZmFsc2U7CiAgICB0aGlzLm91dHB1dCA9IFtdOwogICAgdGhpcy5zdGFjayA9IFtdOwogIH0KICBjb252ZXJ0KGVuY29kZWQsIHN1YnJzLCBzZWFjQW5hbHlzaXNFbmFibGVkKSB7CiAgICBjb25zdCBjb3VudCA9IGVuY29kZWQubGVuZ3RoOwogICAgbGV0IGVycm9yID0gZmFsc2U7CiAgICBsZXQgd3gsIHNieCwgc3Vick51bWJlcjsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICBsZXQgdmFsdWUgPSBlbmNvZGVkW2ldOwogICAgICBpZiAodmFsdWUgPCAzMikgewogICAgICAgIGlmICh2YWx1ZSA9PT0gMTIpIHsKICAgICAgICAgIHZhbHVlID0gKHZhbHVlIDw8IDgpICsgZW5jb2RlZFsrK2ldOwogICAgICAgIH0KICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIGlmICghSElOVElOR19FTkFCTEVEKSB7CiAgICAgICAgICAgICAgdGhpcy5zdGFjayA9IFtdOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgyLCBDT01NQU5EX01BUC5oc3RlbSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBpZiAoIUhJTlRJTkdfRU5BQkxFRCkgewogICAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMiwgQ09NTUFORF9NQVAudnN0ZW0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgaWYgKHRoaXMuZmxleGluZykgewogICAgICAgICAgICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA8IDEpIHsKICAgICAgICAgICAgICAgIGVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBkeSA9IHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKDAsIGR5KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMSwgQ09NTUFORF9NQVAudm1vdmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMiwgQ09NTUFORF9NQVAucmxpbmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMSwgQ09NTUFORF9NQVAuaGxpbmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMSwgQ09NTUFORF9NQVAudmxpbmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoNiwgQ09NTUFORF9NQVAucnJjdXJ2ZXRvKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN1YnJOdW1iZXIgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICBpZiAoIXN1YnJzW3N1YnJOdW1iZXJdKSB7CiAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVycm9yID0gdGhpcy5jb252ZXJ0KHN1YnJzW3N1YnJOdW1iZXJdLCBzdWJycywgc2VhY0FuYWx5c2lzRW5hYmxlZCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgcmV0dXJuIGVycm9yOwogICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoIDwgMikgewogICAgICAgICAgICAgIGVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB3eCA9IHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgIHNieCA9IHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgIHRoaXMubHNiID0gc2J4OwogICAgICAgICAgICB0aGlzLndpZHRoID0gd3g7CiAgICAgICAgICAgIHRoaXMuc3RhY2sucHVzaCh3eCwgc2J4KTsKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDIsIENPTU1BTkRfTUFQLmhtb3ZldG8pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgIHRoaXMub3V0cHV0LnB1c2goQ09NTUFORF9NQVAuZW5kY2hhclswXSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgaWYgKHRoaXMuZmxleGluZykgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgyLCBDT01NQU5EX01BUC5ybW92ZXRvKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICBpZiAodGhpcy5mbGV4aW5nKSB7CiAgICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKDApOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgxLCBDT01NQU5EX01BUC5obW92ZXRvKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoNCwgQ09NTUFORF9NQVAudmhjdXJ2ZXRvKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDMxOgogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoNCwgQ09NTUFORF9NQVAuaHZjdXJ2ZXRvKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDA6CiAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDE6CiAgICAgICAgICAgIGlmICghSElOVElOR19FTkFCTEVEKSB7CiAgICAgICAgICAgICAgdGhpcy5zdGFjayA9IFtdOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgyLCBDT01NQU5EX01BUC52c3RlbSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAoMTIgPDwgOCkgKyAyOgogICAgICAgICAgICBpZiAoIUhJTlRJTkdfRU5BQkxFRCkgewogICAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMiwgQ09NTUFORF9NQVAuaHN0ZW0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgKDEyIDw8IDgpICsgNjoKICAgICAgICAgICAgaWYgKHNlYWNBbmFseXNpc0VuYWJsZWQpIHsKICAgICAgICAgICAgICBjb25zdCBhc2IgPSB0aGlzLnN0YWNrLmF0KC01KTsKICAgICAgICAgICAgICB0aGlzLnNlYWMgPSB0aGlzLnN0YWNrLnNwbGljZSgtNCwgNCk7CiAgICAgICAgICAgICAgdGhpcy5zZWFjWzBdICs9IHRoaXMubHNiIC0gYXNiOwogICAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgwLCBDT01NQU5EX01BUC5lbmRjaGFyKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoNCwgQ09NTUFORF9NQVAuZW5kY2hhcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDc6CiAgICAgICAgICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA8IDQpIHsKICAgICAgICAgICAgICBlcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgd3ggPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICBjb25zdCBzYnkgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICBzYnggPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICB0aGlzLmxzYiA9IHNieDsKICAgICAgICAgICAgdGhpcy53aWR0aCA9IHd4OwogICAgICAgICAgICB0aGlzLnN0YWNrLnB1c2god3gsIHNieCwgc2J5KTsKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDMsIENPTU1BTkRfTUFQLnJtb3ZldG8pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgKDEyIDw8IDgpICsgMTI6CiAgICAgICAgICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICBlcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgbnVtMiA9IHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgIGNvbnN0IG51bTEgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICB0aGlzLnN0YWNrLnB1c2gobnVtMSAvIG51bTIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgKDEyIDw8IDgpICsgMTY6CiAgICAgICAgICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICBlcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3Vick51bWJlciA9IHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgIGNvbnN0IG51bUFyZ3MgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICBpZiAoc3Vick51bWJlciA9PT0gMCAmJiBudW1BcmdzID09PSAzKSB7CiAgICAgICAgICAgICAgY29uc3QgZmxleEFyZ3MgPSB0aGlzLnN0YWNrLnNwbGljZSgtMTcsIDE3KTsKICAgICAgICAgICAgICB0aGlzLnN0YWNrLnB1c2goZmxleEFyZ3NbMl0gKyBmbGV4QXJnc1swXSwgZmxleEFyZ3NbM10gKyBmbGV4QXJnc1sxXSwgZmxleEFyZ3NbNF0sIGZsZXhBcmdzWzVdLCBmbGV4QXJnc1s2XSwgZmxleEFyZ3NbN10sIGZsZXhBcmdzWzhdLCBmbGV4QXJnc1s5XSwgZmxleEFyZ3NbMTBdLCBmbGV4QXJnc1sxMV0sIGZsZXhBcmdzWzEyXSwgZmxleEFyZ3NbMTNdLCBmbGV4QXJnc1sxNF0pOwogICAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgxMywgQ09NTUFORF9NQVAuZmxleCwgdHJ1ZSk7CiAgICAgICAgICAgICAgdGhpcy5mbGV4aW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKGZsZXhBcmdzWzE1XSwgZmxleEFyZ3NbMTZdKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdWJyTnVtYmVyID09PSAxICYmIG51bUFyZ3MgPT09IDApIHsKICAgICAgICAgICAgICB0aGlzLmZsZXhpbmcgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAoMTIgPDwgOCkgKyAxNzoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDMzOgogICAgICAgICAgICB0aGlzLnN0YWNrID0gW107CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgd2FybignVW5rbm93biB0eXBlIDEgY2hhcnN0cmluZyBjb21tYW5kIG9mICInICsgdmFsdWUgKyAnIicpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPD0gMjQ2KSB7CiAgICAgICAgdmFsdWUgLT0gMTM5OwogICAgICB9IGVsc2UgaWYgKHZhbHVlIDw9IDI1MCkgewogICAgICAgIHZhbHVlID0gKHZhbHVlIC0gMjQ3KSAqIDI1NiArIGVuY29kZWRbKytpXSArIDEwODsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA8PSAyNTQpIHsKICAgICAgICB2YWx1ZSA9IC0oKHZhbHVlIC0gMjUxKSAqIDI1NikgLSBlbmNvZGVkWysraV0gLSAxMDg7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFsdWUgPSAoZW5jb2RlZFsrK2ldICYgMHhmZikgPDwgMjQgfCAoZW5jb2RlZFsrK2ldICYgMHhmZikgPDwgMTYgfCAoZW5jb2RlZFsrK2ldICYgMHhmZikgPDwgOCB8IChlbmNvZGVkWysraV0gJiAweGZmKSA8PCAwOwogICAgICB9CiAgICAgIHRoaXMuc3RhY2sucHVzaCh2YWx1ZSk7CiAgICB9CiAgICByZXR1cm4gZXJyb3I7CiAgfQogIGV4ZWN1dGVDb21tYW5kKGhvd01hbnlBcmdzLCBjb21tYW5kLCBrZWVwU3RhY2spIHsKICAgIGNvbnN0IHN0YWNrTGVuZ3RoID0gdGhpcy5zdGFjay5sZW5ndGg7CiAgICBpZiAoaG93TWFueUFyZ3MgPiBzdGFja0xlbmd0aCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGNvbnN0IHN0YXJ0ID0gc3RhY2tMZW5ndGggLSBob3dNYW55QXJnczsKICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IHN0YWNrTGVuZ3RoOyBpKyspIHsKICAgICAgbGV0IHZhbHVlID0gdGhpcy5zdGFja1tpXTsKICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIodmFsdWUpKSB7CiAgICAgICAgdGhpcy5vdXRwdXQucHVzaCgyOCwgdmFsdWUgPj4gOCAmIDB4ZmYsIHZhbHVlICYgMHhmZik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFsdWUgPSA2NTUzNiAqIHZhbHVlIHwgMDsKICAgICAgICB0aGlzLm91dHB1dC5wdXNoKDI1NSwgdmFsdWUgPj4gMjQgJiAweGZmLCB2YWx1ZSA+PiAxNiAmIDB4ZmYsIHZhbHVlID4+IDggJiAweGZmLCB2YWx1ZSAmIDB4ZmYpOwogICAgICB9CiAgICB9CiAgICB0aGlzLm91dHB1dC5wdXNoKC4uLmNvbW1hbmQpOwogICAgaWYgKGtlZXBTdGFjaykgewogICAgICB0aGlzLnN0YWNrLnNwbGljZShzdGFydCwgaG93TWFueUFyZ3MpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5zdGFjay5sZW5ndGggPSAwOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KfQpjb25zdCBFRVhFQ19FTkNSWVBUX0tFWSA9IDU1NjY1Owpjb25zdCBDSEFSX1NUUlNfRU5DUllQVF9LRVkgPSA0MzMwOwpmdW5jdGlvbiBpc0hleERpZ2l0KGNvZGUpIHsKICByZXR1cm4gY29kZSA+PSA0OCAmJiBjb2RlIDw9IDU3IHx8IGNvZGUgPj0gNjUgJiYgY29kZSA8PSA3MCB8fCBjb2RlID49IDk3ICYmIGNvZGUgPD0gMTAyOwp9CmZ1bmN0aW9uIGRlY3J5cHQoZGF0YSwga2V5LCBkaXNjYXJkTnVtYmVyKSB7CiAgaWYgKGRpc2NhcmROdW1iZXIgPj0gZGF0YS5sZW5ndGgpIHsKICAgIHJldHVybiBuZXcgVWludDhBcnJheSgwKTsKICB9CiAgY29uc3QgYzEgPSA1Mjg0NSwKICAgIGMyID0gMjI3MTk7CiAgbGV0IHIgPSBrZXkgfCAwLAogICAgaSwKICAgIGo7CiAgZm9yIChpID0gMDsgaSA8IGRpc2NhcmROdW1iZXI7IGkrKykgewogICAgciA9IChkYXRhW2ldICsgcikgKiBjMSArIGMyICYgKDEgPDwgMTYpIC0gMTsKICB9CiAgY29uc3QgY291bnQgPSBkYXRhLmxlbmd0aCAtIGRpc2NhcmROdW1iZXI7CiAgY29uc3QgZGVjcnlwdGVkID0gbmV3IFVpbnQ4QXJyYXkoY291bnQpOwogIGZvciAoaSA9IGRpc2NhcmROdW1iZXIsIGogPSAwOyBqIDwgY291bnQ7IGkrKywgaisrKSB7CiAgICBjb25zdCB2YWx1ZSA9IGRhdGFbaV07CiAgICBkZWNyeXB0ZWRbal0gPSB2YWx1ZSBeIHIgPj4gODsKICAgIHIgPSAodmFsdWUgKyByKSAqIGMxICsgYzIgJiAoMSA8PCAxNikgLSAxOwogIH0KICByZXR1cm4gZGVjcnlwdGVkOwp9CmZ1bmN0aW9uIGRlY3J5cHRBc2NpaShkYXRhLCBrZXksIGRpc2NhcmROdW1iZXIpIHsKICBjb25zdCBjMSA9IDUyODQ1LAogICAgYzIgPSAyMjcxOTsKICBsZXQgciA9IGtleSB8IDA7CiAgY29uc3QgY291bnQgPSBkYXRhLmxlbmd0aCwKICAgIG1heWJlTGVuZ3RoID0gY291bnQgPj4+IDE7CiAgY29uc3QgZGVjcnlwdGVkID0gbmV3IFVpbnQ4QXJyYXkobWF5YmVMZW5ndGgpOwogIGxldCBpLCBqOwogIGZvciAoaSA9IDAsIGogPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgY29uc3QgZGlnaXQxID0gZGF0YVtpXTsKICAgIGlmICghaXNIZXhEaWdpdChkaWdpdDEpKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaSsrOwogICAgbGV0IGRpZ2l0MjsKICAgIHdoaWxlIChpIDwgY291bnQgJiYgIWlzSGV4RGlnaXQoZGlnaXQyID0gZGF0YVtpXSkpIHsKICAgICAgaSsrOwogICAgfQogICAgaWYgKGkgPCBjb3VudCkgewogICAgICBjb25zdCB2YWx1ZSA9IHBhcnNlSW50KFN0cmluZy5mcm9tQ2hhckNvZGUoZGlnaXQxLCBkaWdpdDIpLCAxNik7CiAgICAgIGRlY3J5cHRlZFtqKytdID0gdmFsdWUgXiByID4+IDg7CiAgICAgIHIgPSAodmFsdWUgKyByKSAqIGMxICsgYzIgJiAoMSA8PCAxNikgLSAxOwogICAgfQogIH0KICByZXR1cm4gZGVjcnlwdGVkLnNsaWNlKGRpc2NhcmROdW1iZXIsIGopOwp9CmZ1bmN0aW9uIGlzU3BlY2lhbChjKSB7CiAgcmV0dXJuIGMgPT09IDB4MmYgfHwgYyA9PT0gMHg1YiB8fCBjID09PSAweDVkIHx8IGMgPT09IDB4N2IgfHwgYyA9PT0gMHg3ZCB8fCBjID09PSAweDI4IHx8IGMgPT09IDB4Mjk7Cn0KY2xhc3MgVHlwZTFQYXJzZXIgewogIGNvbnN0cnVjdG9yKHN0cmVhbSwgZW5jcnlwdGVkLCBzZWFjQW5hbHlzaXNFbmFibGVkKSB7CiAgICBpZiAoZW5jcnlwdGVkKSB7CiAgICAgIGNvbnN0IGRhdGEgPSBzdHJlYW0uZ2V0Qnl0ZXMoKTsKICAgICAgY29uc3QgaXNCaW5hcnkgPSAhKChpc0hleERpZ2l0KGRhdGFbMF0pIHx8IGlzV2hpdGVTcGFjZShkYXRhWzBdKSkgJiYgaXNIZXhEaWdpdChkYXRhWzFdKSAmJiBpc0hleERpZ2l0KGRhdGFbMl0pICYmIGlzSGV4RGlnaXQoZGF0YVszXSkgJiYgaXNIZXhEaWdpdChkYXRhWzRdKSAmJiBpc0hleERpZ2l0KGRhdGFbNV0pICYmIGlzSGV4RGlnaXQoZGF0YVs2XSkgJiYgaXNIZXhEaWdpdChkYXRhWzddKSk7CiAgICAgIHN0cmVhbSA9IG5ldyBTdHJlYW0oaXNCaW5hcnkgPyBkZWNyeXB0KGRhdGEsIEVFWEVDX0VOQ1JZUFRfS0VZLCA0KSA6IGRlY3J5cHRBc2NpaShkYXRhLCBFRVhFQ19FTkNSWVBUX0tFWSwgNCkpOwogICAgfQogICAgdGhpcy5zZWFjQW5hbHlzaXNFbmFibGVkID0gISFzZWFjQW5hbHlzaXNFbmFibGVkOwogICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07CiAgICB0aGlzLm5leHRDaGFyKCk7CiAgfQogIHJlYWROdW1iZXJBcnJheSgpIHsKICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgIGNvbnN0IGFycmF5ID0gW107CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBjb25zdCB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgaWYgKHRva2VuID09PSBudWxsIHx8IHRva2VuID09PSAiXSIgfHwgdG9rZW4gPT09ICJ9IikgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGFycmF5LnB1c2gocGFyc2VGbG9hdCh0b2tlbiB8fCAwKSk7CiAgICB9CiAgICByZXR1cm4gYXJyYXk7CiAgfQogIHJlYWROdW1iZXIoKSB7CiAgICBjb25zdCB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgIHJldHVybiBwYXJzZUZsb2F0KHRva2VuIHx8IDApOwogIH0KICByZWFkSW50KCkgewogICAgY29uc3QgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CiAgICByZXR1cm4gcGFyc2VJbnQodG9rZW4gfHwgMCwgMTApIHwgMDsKICB9CiAgcmVhZEJvb2xlYW4oKSB7CiAgICBjb25zdCB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgIHJldHVybiB0b2tlbiA9PT0gInRydWUiID8gMSA6IDA7CiAgfQogIG5leHRDaGFyKCkgewogICAgcmV0dXJuIHRoaXMuY3VycmVudENoYXIgPSB0aGlzLnN0cmVhbS5nZXRCeXRlKCk7CiAgfQogIHByZXZDaGFyKCkgewogICAgdGhpcy5zdHJlYW0uc2tpcCgtMik7CiAgICByZXR1cm4gdGhpcy5jdXJyZW50Q2hhciA9IHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICB9CiAgZ2V0VG9rZW4oKSB7CiAgICBsZXQgY29tbWVudCA9IGZhbHNlOwogICAgbGV0IGNoID0gdGhpcy5jdXJyZW50Q2hhcjsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGlmIChjaCA9PT0gLTEpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBpZiAoY29tbWVudCkgewogICAgICAgIGlmIChjaCA9PT0gMHgwYSB8fCBjaCA9PT0gMHgwZCkgewogICAgICAgICAgY29tbWVudCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHgyNSkgewogICAgICAgIGNvbW1lbnQgPSB0cnVlOwogICAgICB9IGVsc2UgaWYgKCFpc1doaXRlU3BhY2UoY2gpKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICB9CiAgICBpZiAoaXNTcGVjaWFsKGNoKSkgewogICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTsKICAgIH0KICAgIGxldCB0b2tlbiA9ICIiOwogICAgZG8gewogICAgICB0b2tlbiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTsKICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICB9IHdoaWxlIChjaCA+PSAwICYmICFpc1doaXRlU3BhY2UoY2gpICYmICFpc1NwZWNpYWwoY2gpKTsKICAgIHJldHVybiB0b2tlbjsKICB9CiAgcmVhZENoYXJTdHJpbmdzKGJ5dGVzLCBsZW5JVikgewogICAgaWYgKGxlbklWID09PSAtMSkgewogICAgICByZXR1cm4gYnl0ZXM7CiAgICB9CiAgICByZXR1cm4gZGVjcnlwdChieXRlcywgQ0hBUl9TVFJTX0VOQ1JZUFRfS0VZLCBsZW5JVik7CiAgfQogIGV4dHJhY3RGb250UHJvZ3JhbShwcm9wZXJ0aWVzKSB7CiAgICBjb25zdCBzdHJlYW0gPSB0aGlzLnN0cmVhbTsKICAgIGNvbnN0IHN1YnJzID0gW10sCiAgICAgIGNoYXJzdHJpbmdzID0gW107CiAgICBjb25zdCBwcml2YXRlRGF0YSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBwcml2YXRlRGF0YS5sZW5JViA9IDQ7CiAgICBjb25zdCBwcm9ncmFtID0gewogICAgICBzdWJyczogW10sCiAgICAgIGNoYXJzdHJpbmdzOiBbXSwKICAgICAgcHJvcGVydGllczogewogICAgICAgIHByaXZhdGVEYXRhCiAgICAgIH0KICAgIH07CiAgICBsZXQgdG9rZW4sIGxlbmd0aCwgZGF0YSwgbGVuSVY7CiAgICB3aGlsZSAoKHRva2VuID0gdGhpcy5nZXRUb2tlbigpKSAhPT0gbnVsbCkgewogICAgICBpZiAodG9rZW4gIT09ICIvIikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwogICAgICBzd2l0Y2ggKHRva2VuKSB7CiAgICAgICAgY2FzZSAiQ2hhclN0cmluZ3MiOgogICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICAgIGlmICh0b2tlbiA9PT0gbnVsbCB8fCB0b2tlbiA9PT0gImVuZCIpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodG9rZW4gIT09ICIvIikgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGdseXBoID0gdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICBsZW5ndGggPSB0aGlzLnJlYWRJbnQoKTsKICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICBkYXRhID0gbGVuZ3RoID4gMCA/IHN0cmVhbS5nZXRCeXRlcyhsZW5ndGgpIDogbmV3IFVpbnQ4QXJyYXkoMCk7CiAgICAgICAgICAgIGxlbklWID0gcHJvZ3JhbS5wcm9wZXJ0aWVzLnByaXZhdGVEYXRhLmxlbklWOwogICAgICAgICAgICBjb25zdCBlbmNvZGVkID0gdGhpcy5yZWFkQ2hhclN0cmluZ3MoZGF0YSwgbGVuSVYpOwogICAgICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgIHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICBpZiAodG9rZW4gPT09ICJub2FjY2VzcyIpIHsKICAgICAgICAgICAgICB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodG9rZW4gPT09ICIvIikgewogICAgICAgICAgICAgIHRoaXMucHJldkNoYXIoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjaGFyc3RyaW5ncy5wdXNoKHsKICAgICAgICAgICAgICBnbHlwaCwKICAgICAgICAgICAgICBlbmNvZGVkCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiU3VicnMiOgogICAgICAgICAgdGhpcy5yZWFkSW50KCk7CiAgICAgICAgICB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICB3aGlsZSAodGhpcy5nZXRUb2tlbigpID09PSAiZHVwIikgewogICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMucmVhZEludCgpOwogICAgICAgICAgICBsZW5ndGggPSB0aGlzLnJlYWRJbnQoKTsKICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICBkYXRhID0gbGVuZ3RoID4gMCA/IHN0cmVhbS5nZXRCeXRlcyhsZW5ndGgpIDogbmV3IFVpbnQ4QXJyYXkoMCk7CiAgICAgICAgICAgIGxlbklWID0gcHJvZ3JhbS5wcm9wZXJ0aWVzLnByaXZhdGVEYXRhLmxlbklWOwogICAgICAgICAgICBjb25zdCBlbmNvZGVkID0gdGhpcy5yZWFkQ2hhclN0cmluZ3MoZGF0YSwgbGVuSVYpOwogICAgICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgIHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICBpZiAodG9rZW4gPT09ICJub2FjY2VzcyIpIHsKICAgICAgICAgICAgICB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3VicnNbaW5kZXhdID0gZW5jb2RlZDsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkJsdWVWYWx1ZXMiOgogICAgICAgIGNhc2UgIk90aGVyQmx1ZXMiOgogICAgICAgIGNhc2UgIkZhbWlseUJsdWVzIjoKICAgICAgICBjYXNlICJGYW1pbHlPdGhlckJsdWVzIjoKICAgICAgICAgIGNvbnN0IGJsdWVBcnJheSA9IHRoaXMucmVhZE51bWJlckFycmF5KCk7CiAgICAgICAgICBpZiAoYmx1ZUFycmF5Lmxlbmd0aCA+IDAgJiYgYmx1ZUFycmF5Lmxlbmd0aCAlIDIgPT09IDAgJiYgSElOVElOR19FTkFCTEVEKSB7CiAgICAgICAgICAgIHByb2dyYW0ucHJvcGVydGllcy5wcml2YXRlRGF0YVt0b2tlbl0gPSBibHVlQXJyYXk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJTdGVtU25hcEgiOgogICAgICAgIGNhc2UgIlN0ZW1TbmFwViI6CiAgICAgICAgICBwcm9ncmFtLnByb3BlcnRpZXMucHJpdmF0ZURhdGFbdG9rZW5dID0gdGhpcy5yZWFkTnVtYmVyQXJyYXkoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlN0ZEhXIjoKICAgICAgICBjYXNlICJTdGRWVyI6CiAgICAgICAgICBwcm9ncmFtLnByb3BlcnRpZXMucHJpdmF0ZURhdGFbdG9rZW5dID0gdGhpcy5yZWFkTnVtYmVyQXJyYXkoKVswXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkJsdWVTaGlmdCI6CiAgICAgICAgY2FzZSAibGVuSVYiOgogICAgICAgIGNhc2UgIkJsdWVGdXp6IjoKICAgICAgICBjYXNlICJCbHVlU2NhbGUiOgogICAgICAgIGNhc2UgIkxhbmd1YWdlR3JvdXAiOgogICAgICAgICAgcHJvZ3JhbS5wcm9wZXJ0aWVzLnByaXZhdGVEYXRhW3Rva2VuXSA9IHRoaXMucmVhZE51bWJlcigpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiRXhwYW5zaW9uRmFjdG9yIjoKICAgICAgICAgIHByb2dyYW0ucHJvcGVydGllcy5wcml2YXRlRGF0YVt0b2tlbl0gPSB0aGlzLnJlYWROdW1iZXIoKSB8fCAwLjA2OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiRm9yY2VCb2xkIjoKICAgICAgICAgIHByb2dyYW0ucHJvcGVydGllcy5wcml2YXRlRGF0YVt0b2tlbl0gPSB0aGlzLnJlYWRCb29sZWFuKCk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgZm9yIChjb25zdCB7CiAgICAgIGVuY29kZWQsCiAgICAgIGdseXBoCiAgICB9IG9mIGNoYXJzdHJpbmdzKSB7CiAgICAgIGNvbnN0IGNoYXJTdHJpbmcgPSBuZXcgVHlwZTFDaGFyU3RyaW5nKCk7CiAgICAgIGNvbnN0IGVycm9yID0gY2hhclN0cmluZy5jb252ZXJ0KGVuY29kZWQsIHN1YnJzLCB0aGlzLnNlYWNBbmFseXNpc0VuYWJsZWQpOwogICAgICBsZXQgb3V0cHV0ID0gY2hhclN0cmluZy5vdXRwdXQ7CiAgICAgIGlmIChlcnJvcikgewogICAgICAgIG91dHB1dCA9IFsxNF07CiAgICAgIH0KICAgICAgY29uc3QgY2hhclN0cmluZ09iamVjdCA9IHsKICAgICAgICBnbHlwaE5hbWU6IGdseXBoLAogICAgICAgIGNoYXJzdHJpbmc6IG91dHB1dCwKICAgICAgICB3aWR0aDogY2hhclN0cmluZy53aWR0aCwKICAgICAgICBsc2I6IGNoYXJTdHJpbmcubHNiLAogICAgICAgIHNlYWM6IGNoYXJTdHJpbmcuc2VhYwogICAgICB9OwogICAgICBpZiAoZ2x5cGggPT09ICIubm90ZGVmIikgewogICAgICAgIHByb2dyYW0uY2hhcnN0cmluZ3MudW5zaGlmdChjaGFyU3RyaW5nT2JqZWN0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwcm9ncmFtLmNoYXJzdHJpbmdzLnB1c2goY2hhclN0cmluZ09iamVjdCk7CiAgICAgIH0KICAgICAgaWYgKHByb3BlcnRpZXMuYnVpbHRJbkVuY29kaW5nKSB7CiAgICAgICAgY29uc3QgaW5kZXggPSBwcm9wZXJ0aWVzLmJ1aWx0SW5FbmNvZGluZy5pbmRleE9mKGdseXBoKTsKICAgICAgICBpZiAoaW5kZXggPiAtMSAmJiBwcm9wZXJ0aWVzLndpZHRoc1tpbmRleF0gPT09IHVuZGVmaW5lZCAmJiBpbmRleCA+PSBwcm9wZXJ0aWVzLmZpcnN0Q2hhciAmJiBpbmRleCA8PSBwcm9wZXJ0aWVzLmxhc3RDaGFyKSB7CiAgICAgICAgICBwcm9wZXJ0aWVzLndpZHRoc1tpbmRleF0gPSBjaGFyU3RyaW5nLndpZHRoOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHByb2dyYW07CiAgfQogIGV4dHJhY3RGb250SGVhZGVyKHByb3BlcnRpZXMpIHsKICAgIGxldCB0b2tlbjsKICAgIHdoaWxlICgodG9rZW4gPSB0aGlzLmdldFRva2VuKCkpICE9PSBudWxsKSB7CiAgICAgIGlmICh0b2tlbiAhPT0gIi8iKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CiAgICAgIHN3aXRjaCAodG9rZW4pIHsKICAgICAgICBjYXNlICJGb250TWF0cml4IjoKICAgICAgICAgIGNvbnN0IG1hdHJpeCA9IHRoaXMucmVhZE51bWJlckFycmF5KCk7CiAgICAgICAgICBwcm9wZXJ0aWVzLmZvbnRNYXRyaXggPSBtYXRyaXg7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJFbmNvZGluZyI6CiAgICAgICAgICBjb25zdCBlbmNvZGluZ0FyZyA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgIGxldCBlbmNvZGluZzsKICAgICAgICAgIGlmICghL15cZCskLy50ZXN0KGVuY29kaW5nQXJnKSkgewogICAgICAgICAgICBlbmNvZGluZyA9IGdldEVuY29kaW5nKGVuY29kaW5nQXJnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVuY29kaW5nID0gW107CiAgICAgICAgICAgIGNvbnN0IHNpemUgPSBwYXJzZUludChlbmNvZGluZ0FyZywgMTApIHwgMDsKICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHNpemU7IGorKykgewogICAgICAgICAgICAgIHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICAgIHdoaWxlICh0b2tlbiAhPT0gImR1cCIgJiYgdG9rZW4gIT09ICJkZWYiKSB7CiAgICAgICAgICAgICAgICB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgICAgIGlmICh0b2tlbiA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh0b2tlbiA9PT0gImRlZiIpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMucmVhZEludCgpOwogICAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgICBjb25zdCBnbHlwaCA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgICBlbmNvZGluZ1tpbmRleF0gPSBnbHlwaDsKICAgICAgICAgICAgICB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHByb3BlcnRpZXMuYnVpbHRJbkVuY29kaW5nID0gZW5jb2Rpbmc7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJGb250QkJveCI6CiAgICAgICAgICBjb25zdCBmb250QkJveCA9IHRoaXMucmVhZE51bWJlckFycmF5KCk7CiAgICAgICAgICBwcm9wZXJ0aWVzLmFzY2VudCA9IE1hdGgubWF4KGZvbnRCQm94WzNdLCBmb250QkJveFsxXSk7CiAgICAgICAgICBwcm9wZXJ0aWVzLmRlc2NlbnQgPSBNYXRoLm1pbihmb250QkJveFsxXSwgZm9udEJCb3hbM10pOwogICAgICAgICAgcHJvcGVydGllcy5hc2NlbnRTY2FsZWQgPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3R5cGUxX2ZvbnQuanMKCgoKCgoKZnVuY3Rpb24gZmluZEJsb2NrKHN0cmVhbUJ5dGVzLCBzaWduYXR1cmUsIHN0YXJ0SW5kZXgpIHsKICBjb25zdCBzdHJlYW1CeXRlc0xlbmd0aCA9IHN0cmVhbUJ5dGVzLmxlbmd0aDsKICBjb25zdCBzaWduYXR1cmVMZW5ndGggPSBzaWduYXR1cmUubGVuZ3RoOwogIGNvbnN0IHNjYW5MZW5ndGggPSBzdHJlYW1CeXRlc0xlbmd0aCAtIHNpZ25hdHVyZUxlbmd0aDsKICBsZXQgaSA9IHN0YXJ0SW5kZXgsCiAgICBmb3VuZCA9IGZhbHNlOwogIHdoaWxlIChpIDwgc2Nhbkxlbmd0aCkgewogICAgbGV0IGogPSAwOwogICAgd2hpbGUgKGogPCBzaWduYXR1cmVMZW5ndGggJiYgc3RyZWFtQnl0ZXNbaSArIGpdID09PSBzaWduYXR1cmVbal0pIHsKICAgICAgaisrOwogICAgfQogICAgaWYgKGogPj0gc2lnbmF0dXJlTGVuZ3RoKSB7CiAgICAgIGkgKz0gajsKICAgICAgd2hpbGUgKGkgPCBzdHJlYW1CeXRlc0xlbmd0aCAmJiBpc1doaXRlU3BhY2Uoc3RyZWFtQnl0ZXNbaV0pKSB7CiAgICAgICAgaSsrOwogICAgICB9CiAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpKys7CiAgfQogIHJldHVybiB7CiAgICBmb3VuZCwKICAgIGxlbmd0aDogaQogIH07Cn0KZnVuY3Rpb24gZ2V0SGVhZGVyQmxvY2soc3RyZWFtLCBzdWdnZXN0ZWRMZW5ndGgpIHsKICBjb25zdCBFRVhFQ19TSUdOQVRVUkUgPSBbMHg2NSwgMHg2NSwgMHg3OCwgMHg2NSwgMHg2M107CiAgY29uc3Qgc3RyZWFtU3RhcnRQb3MgPSBzdHJlYW0ucG9zOwogIGxldCBoZWFkZXJCeXRlcywgaGVhZGVyQnl0ZXNMZW5ndGgsIGJsb2NrOwogIHRyeSB7CiAgICBoZWFkZXJCeXRlcyA9IHN0cmVhbS5nZXRCeXRlcyhzdWdnZXN0ZWRMZW5ndGgpOwogICAgaGVhZGVyQnl0ZXNMZW5ndGggPSBoZWFkZXJCeXRlcy5sZW5ndGg7CiAgfSBjYXRjaCB7fQogIGlmIChoZWFkZXJCeXRlc0xlbmd0aCA9PT0gc3VnZ2VzdGVkTGVuZ3RoKSB7CiAgICBibG9jayA9IGZpbmRCbG9jayhoZWFkZXJCeXRlcywgRUVYRUNfU0lHTkFUVVJFLCBzdWdnZXN0ZWRMZW5ndGggLSAyICogRUVYRUNfU0lHTkFUVVJFLmxlbmd0aCk7CiAgICBpZiAoYmxvY2suZm91bmQgJiYgYmxvY2subGVuZ3RoID09PSBzdWdnZXN0ZWRMZW5ndGgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBzdHJlYW06IG5ldyBTdHJlYW0oaGVhZGVyQnl0ZXMpLAogICAgICAgIGxlbmd0aDogc3VnZ2VzdGVkTGVuZ3RoCiAgICAgIH07CiAgICB9CiAgfQogIHdhcm4oJ0ludmFsaWQgIkxlbmd0aDEiIHByb3BlcnR5IGluIFR5cGUxIGZvbnQgLS0gdHJ5aW5nIHRvIHJlY292ZXIuJyk7CiAgc3RyZWFtLnBvcyA9IHN0cmVhbVN0YXJ0UG9zOwogIGNvbnN0IFNDQU5fQkxPQ0tfTEVOR1RIID0gMjA0ODsKICBsZXQgYWN0dWFsTGVuZ3RoOwogIHdoaWxlICh0cnVlKSB7CiAgICBjb25zdCBzY2FuQnl0ZXMgPSBzdHJlYW0ucGVla0J5dGVzKFNDQU5fQkxPQ0tfTEVOR1RIKTsKICAgIGJsb2NrID0gZmluZEJsb2NrKHNjYW5CeXRlcywgRUVYRUNfU0lHTkFUVVJFLCAwKTsKICAgIGlmIChibG9jay5sZW5ndGggPT09IDApIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBzdHJlYW0ucG9zICs9IGJsb2NrLmxlbmd0aDsKICAgIGlmIChibG9jay5mb3VuZCkgewogICAgICBhY3R1YWxMZW5ndGggPSBzdHJlYW0ucG9zIC0gc3RyZWFtU3RhcnRQb3M7CiAgICAgIGJyZWFrOwogICAgfQogIH0KICBzdHJlYW0ucG9zID0gc3RyZWFtU3RhcnRQb3M7CiAgaWYgKGFjdHVhbExlbmd0aCkgewogICAgcmV0dXJuIHsKICAgICAgc3RyZWFtOiBuZXcgU3RyZWFtKHN0cmVhbS5nZXRCeXRlcyhhY3R1YWxMZW5ndGgpKSwKICAgICAgbGVuZ3RoOiBhY3R1YWxMZW5ndGgKICAgIH07CiAgfQogIHdhcm4oJ1VuYWJsZSB0byByZWNvdmVyICJMZW5ndGgxIiBwcm9wZXJ0eSBpbiBUeXBlMSBmb250IC0tIHVzaW5nIGFzIGlzLicpOwogIHJldHVybiB7CiAgICBzdHJlYW06IG5ldyBTdHJlYW0oc3RyZWFtLmdldEJ5dGVzKHN1Z2dlc3RlZExlbmd0aCkpLAogICAgbGVuZ3RoOiBzdWdnZXN0ZWRMZW5ndGgKICB9Owp9CmZ1bmN0aW9uIGdldEVleGVjQmxvY2soc3RyZWFtLCBzdWdnZXN0ZWRMZW5ndGgpIHsKICBjb25zdCBlZXhlY0J5dGVzID0gc3RyZWFtLmdldEJ5dGVzKCk7CiAgaWYgKGVleGVjQnl0ZXMubGVuZ3RoID09PSAwKSB7CiAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoImdldEVleGVjQmxvY2sgLSBubyBmb250IHByb2dyYW0gZm91bmQuIik7CiAgfQogIHJldHVybiB7CiAgICBzdHJlYW06IG5ldyBTdHJlYW0oZWV4ZWNCeXRlcyksCiAgICBsZW5ndGg6IGVleGVjQnl0ZXMubGVuZ3RoCiAgfTsKfQpjbGFzcyBUeXBlMUZvbnQgewogIGNvbnN0cnVjdG9yKG5hbWUsIGZpbGUsIHByb3BlcnRpZXMpIHsKICAgIGNvbnN0IFBGQl9IRUFERVJfU0laRSA9IDY7CiAgICBsZXQgaGVhZGVyQmxvY2tMZW5ndGggPSBwcm9wZXJ0aWVzLmxlbmd0aDE7CiAgICBsZXQgZWV4ZWNCbG9ja0xlbmd0aCA9IHByb3BlcnRpZXMubGVuZ3RoMjsKICAgIGxldCBwZmJIZWFkZXIgPSBmaWxlLnBlZWtCeXRlcyhQRkJfSEVBREVSX1NJWkUpOwogICAgY29uc3QgcGZiSGVhZGVyUHJlc2VudCA9IHBmYkhlYWRlclswXSA9PT0gMHg4MCAmJiBwZmJIZWFkZXJbMV0gPT09IDB4MDE7CiAgICBpZiAocGZiSGVhZGVyUHJlc2VudCkgewogICAgICBmaWxlLnNraXAoUEZCX0hFQURFUl9TSVpFKTsKICAgICAgaGVhZGVyQmxvY2tMZW5ndGggPSBwZmJIZWFkZXJbNV0gPDwgMjQgfCBwZmJIZWFkZXJbNF0gPDwgMTYgfCBwZmJIZWFkZXJbM10gPDwgOCB8IHBmYkhlYWRlclsyXTsKICAgIH0KICAgIGNvbnN0IGhlYWRlckJsb2NrID0gZ2V0SGVhZGVyQmxvY2soZmlsZSwgaGVhZGVyQmxvY2tMZW5ndGgpOwogICAgY29uc3QgaGVhZGVyQmxvY2tQYXJzZXIgPSBuZXcgVHlwZTFQYXJzZXIoaGVhZGVyQmxvY2suc3RyZWFtLCBmYWxzZSwgU0VBQ19BTkFMWVNJU19FTkFCTEVEKTsKICAgIGhlYWRlckJsb2NrUGFyc2VyLmV4dHJhY3RGb250SGVhZGVyKHByb3BlcnRpZXMpOwogICAgaWYgKHBmYkhlYWRlclByZXNlbnQpIHsKICAgICAgcGZiSGVhZGVyID0gZmlsZS5nZXRCeXRlcyhQRkJfSEVBREVSX1NJWkUpOwogICAgICBlZXhlY0Jsb2NrTGVuZ3RoID0gcGZiSGVhZGVyWzVdIDw8IDI0IHwgcGZiSGVhZGVyWzRdIDw8IDE2IHwgcGZiSGVhZGVyWzNdIDw8IDggfCBwZmJIZWFkZXJbMl07CiAgICB9CiAgICBjb25zdCBlZXhlY0Jsb2NrID0gZ2V0RWV4ZWNCbG9jayhmaWxlLCBlZXhlY0Jsb2NrTGVuZ3RoKTsKICAgIGNvbnN0IGVleGVjQmxvY2tQYXJzZXIgPSBuZXcgVHlwZTFQYXJzZXIoZWV4ZWNCbG9jay5zdHJlYW0sIHRydWUsIFNFQUNfQU5BTFlTSVNfRU5BQkxFRCk7CiAgICBjb25zdCBkYXRhID0gZWV4ZWNCbG9ja1BhcnNlci5leHRyYWN0Rm9udFByb2dyYW0ocHJvcGVydGllcyk7CiAgICBmb3IgKGNvbnN0IGtleSBpbiBkYXRhLnByb3BlcnRpZXMpIHsKICAgICAgcHJvcGVydGllc1trZXldID0gZGF0YS5wcm9wZXJ0aWVzW2tleV07CiAgICB9CiAgICBjb25zdCBjaGFyc3RyaW5ncyA9IGRhdGEuY2hhcnN0cmluZ3M7CiAgICBjb25zdCB0eXBlMkNoYXJzdHJpbmdzID0gdGhpcy5nZXRUeXBlMkNoYXJzdHJpbmdzKGNoYXJzdHJpbmdzKTsKICAgIGNvbnN0IHN1YnJzID0gdGhpcy5nZXRUeXBlMlN1YnJzKGRhdGEuc3VicnMpOwogICAgdGhpcy5jaGFyc3RyaW5ncyA9IGNoYXJzdHJpbmdzOwogICAgdGhpcy5kYXRhID0gdGhpcy53cmFwKG5hbWUsIHR5cGUyQ2hhcnN0cmluZ3MsIHRoaXMuY2hhcnN0cmluZ3MsIHN1YnJzLCBwcm9wZXJ0aWVzKTsKICAgIHRoaXMuc2VhY3MgPSB0aGlzLmdldFNlYWNzKGRhdGEuY2hhcnN0cmluZ3MpOwogIH0KICBnZXQgbnVtR2x5cGhzKCkgewogICAgcmV0dXJuIHRoaXMuY2hhcnN0cmluZ3MubGVuZ3RoICsgMTsKICB9CiAgZ2V0Q2hhcnNldCgpIHsKICAgIGNvbnN0IGNoYXJzZXQgPSBbIi5ub3RkZWYiXTsKICAgIGZvciAoY29uc3QgewogICAgICBnbHlwaE5hbWUKICAgIH0gb2YgdGhpcy5jaGFyc3RyaW5ncykgewogICAgICBjaGFyc2V0LnB1c2goZ2x5cGhOYW1lKTsKICAgIH0KICAgIHJldHVybiBjaGFyc2V0OwogIH0KICBnZXRHbHlwaE1hcHBpbmcocHJvcGVydGllcykgewogICAgY29uc3QgY2hhcnN0cmluZ3MgPSB0aGlzLmNoYXJzdHJpbmdzOwogICAgaWYgKHByb3BlcnRpZXMuY29tcG9zaXRlKSB7CiAgICAgIGNvbnN0IGNoYXJDb2RlVG9HbHlwaElkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgZm9yIChsZXQgZ2x5cGhJZCA9IDAsIGNoYXJzdHJpbmdzTGVuID0gY2hhcnN0cmluZ3MubGVuZ3RoOyBnbHlwaElkIDwgY2hhcnN0cmluZ3NMZW47IGdseXBoSWQrKykgewogICAgICAgIGNvbnN0IGNoYXJDb2RlID0gcHJvcGVydGllcy5jTWFwLmNoYXJDb2RlT2YoZ2x5cGhJZCk7CiAgICAgICAgY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdID0gZ2x5cGhJZCArIDE7CiAgICAgIH0KICAgICAgcmV0dXJuIGNoYXJDb2RlVG9HbHlwaElkOwogICAgfQogICAgY29uc3QgZ2x5cGhOYW1lcyA9IFsiLm5vdGRlZiJdOwogICAgbGV0IGJ1aWx0SW5FbmNvZGluZywgZ2x5cGhJZDsKICAgIGZvciAoZ2x5cGhJZCA9IDA7IGdseXBoSWQgPCBjaGFyc3RyaW5ncy5sZW5ndGg7IGdseXBoSWQrKykgewogICAgICBnbHlwaE5hbWVzLnB1c2goY2hhcnN0cmluZ3NbZ2x5cGhJZF0uZ2x5cGhOYW1lKTsKICAgIH0KICAgIGNvbnN0IGVuY29kaW5nID0gcHJvcGVydGllcy5idWlsdEluRW5jb2Rpbmc7CiAgICBpZiAoZW5jb2RpbmcpIHsKICAgICAgYnVpbHRJbkVuY29kaW5nID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgZm9yIChjb25zdCBjaGFyQ29kZSBpbiBlbmNvZGluZykgewogICAgICAgIGdseXBoSWQgPSBnbHlwaE5hbWVzLmluZGV4T2YoZW5jb2RpbmdbY2hhckNvZGVdKTsKICAgICAgICBpZiAoZ2x5cGhJZCA+PSAwKSB7CiAgICAgICAgICBidWlsdEluRW5jb2RpbmdbY2hhckNvZGVdID0gZ2x5cGhJZDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0eXBlMUZvbnRHbHlwaE1hcHBpbmcocHJvcGVydGllcywgYnVpbHRJbkVuY29kaW5nLCBnbHlwaE5hbWVzKTsKICB9CiAgaGFzR2x5cGhJZChpZCkgewogICAgaWYgKGlkIDwgMCB8fCBpZCA+PSB0aGlzLm51bUdseXBocykgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoaWQgPT09IDApIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBjb25zdCBnbHlwaCA9IHRoaXMuY2hhcnN0cmluZ3NbaWQgLSAxXTsKICAgIHJldHVybiBnbHlwaC5jaGFyc3RyaW5nLmxlbmd0aCA+IDA7CiAgfQogIGdldFNlYWNzKGNoYXJzdHJpbmdzKSB7CiAgICBjb25zdCBzZWFjTWFwID0gW107CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjaGFyc3RyaW5ncy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IGNoYXJzdHJpbmcgPSBjaGFyc3RyaW5nc1tpXTsKICAgICAgaWYgKGNoYXJzdHJpbmcuc2VhYykgewogICAgICAgIHNlYWNNYXBbaSArIDFdID0gY2hhcnN0cmluZy5zZWFjOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2VhY01hcDsKICB9CiAgZ2V0VHlwZTJDaGFyc3RyaW5ncyh0eXBlMUNoYXJzdHJpbmdzKSB7CiAgICBjb25zdCB0eXBlMkNoYXJzdHJpbmdzID0gW107CiAgICBmb3IgKGNvbnN0IHR5cGUxQ2hhcnN0cmluZyBvZiB0eXBlMUNoYXJzdHJpbmdzKSB7CiAgICAgIHR5cGUyQ2hhcnN0cmluZ3MucHVzaCh0eXBlMUNoYXJzdHJpbmcuY2hhcnN0cmluZyk7CiAgICB9CiAgICByZXR1cm4gdHlwZTJDaGFyc3RyaW5nczsKICB9CiAgZ2V0VHlwZTJTdWJycyh0eXBlMVN1YnJzKSB7CiAgICBsZXQgYmlhcyA9IDA7CiAgICBjb25zdCBjb3VudCA9IHR5cGUxU3VicnMubGVuZ3RoOwogICAgaWYgKGNvdW50IDwgMTEzMykgewogICAgICBiaWFzID0gMTA3OwogICAgfSBlbHNlIGlmIChjb3VudCA8IDMzNzY5KSB7CiAgICAgIGJpYXMgPSAxMTMxOwogICAgfSBlbHNlIHsKICAgICAgYmlhcyA9IDMyNzY4OwogICAgfQogICAgY29uc3QgdHlwZTJTdWJycyA9IFtdOwogICAgbGV0IGk7CiAgICBmb3IgKGkgPSAwOyBpIDwgYmlhczsgaSsrKSB7CiAgICAgIHR5cGUyU3VicnMucHVzaChbMHgwYl0pOwogICAgfQogICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgdHlwZTJTdWJycy5wdXNoKHR5cGUxU3VicnNbaV0pOwogICAgfQogICAgcmV0dXJuIHR5cGUyU3VicnM7CiAgfQogIHdyYXAobmFtZSwgZ2x5cGhzLCBjaGFyc3RyaW5ncywgc3VicnMsIHByb3BlcnRpZXMpIHsKICAgIGNvbnN0IGNmZiA9IG5ldyBDRkYoKTsKICAgIGNmZi5oZWFkZXIgPSBuZXcgQ0ZGSGVhZGVyKDEsIDAsIDQsIDQpOwogICAgY2ZmLm5hbWVzID0gW25hbWVdOwogICAgY29uc3QgdG9wRGljdCA9IG5ldyBDRkZUb3BEaWN0KCk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgidmVyc2lvbiIsIDM5MSk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiTm90aWNlIiwgMzkyKTsKICAgIHRvcERpY3Quc2V0QnlOYW1lKCJGdWxsTmFtZSIsIDM5Myk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiRmFtaWx5TmFtZSIsIDM5NCk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiV2VpZ2h0IiwgMzk1KTsKICAgIHRvcERpY3Quc2V0QnlOYW1lKCJFbmNvZGluZyIsIG51bGwpOwogICAgdG9wRGljdC5zZXRCeU5hbWUoIkZvbnRNYXRyaXgiLCBwcm9wZXJ0aWVzLmZvbnRNYXRyaXgpOwogICAgdG9wRGljdC5zZXRCeU5hbWUoIkZvbnRCQm94IiwgcHJvcGVydGllcy5iYm94KTsKICAgIHRvcERpY3Quc2V0QnlOYW1lKCJjaGFyc2V0IiwgbnVsbCk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiQ2hhclN0cmluZ3MiLCBudWxsKTsKICAgIHRvcERpY3Quc2V0QnlOYW1lKCJQcml2YXRlIiwgbnVsbCk7CiAgICBjZmYudG9wRGljdCA9IHRvcERpY3Q7CiAgICBjb25zdCBzdHJpbmdzID0gbmV3IENGRlN0cmluZ3MoKTsKICAgIHN0cmluZ3MuYWRkKCJWZXJzaW9uIDAuMTEiKTsKICAgIHN0cmluZ3MuYWRkKCJTZWUgb3JpZ2luYWwgbm90aWNlIik7CiAgICBzdHJpbmdzLmFkZChuYW1lKTsKICAgIHN0cmluZ3MuYWRkKG5hbWUpOwogICAgc3RyaW5ncy5hZGQoIk1lZGl1bSIpOwogICAgY2ZmLnN0cmluZ3MgPSBzdHJpbmdzOwogICAgY2ZmLmdsb2JhbFN1YnJJbmRleCA9IG5ldyBDRkZJbmRleCgpOwogICAgY29uc3QgY291bnQgPSBnbHlwaHMubGVuZ3RoOwogICAgY29uc3QgY2hhcnNldEFycmF5ID0gWyIubm90ZGVmIl07CiAgICBsZXQgaSwgaWk7CiAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICBjb25zdCBnbHlwaE5hbWUgPSBjaGFyc3RyaW5nc1tpXS5nbHlwaE5hbWU7CiAgICAgIGNvbnN0IGluZGV4ID0gQ0ZGU3RhbmRhcmRTdHJpbmdzLmluZGV4T2YoZ2x5cGhOYW1lKTsKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIHN0cmluZ3MuYWRkKGdseXBoTmFtZSk7CiAgICAgIH0KICAgICAgY2hhcnNldEFycmF5LnB1c2goZ2x5cGhOYW1lKTsKICAgIH0KICAgIGNmZi5jaGFyc2V0ID0gbmV3IENGRkNoYXJzZXQoZmFsc2UsIDAsIGNoYXJzZXRBcnJheSk7CiAgICBjb25zdCBjaGFyU3RyaW5nc0luZGV4ID0gbmV3IENGRkluZGV4KCk7CiAgICBjaGFyU3RyaW5nc0luZGV4LmFkZChbMHg4YiwgMHgwZV0pOwogICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgY2hhclN0cmluZ3NJbmRleC5hZGQoZ2x5cGhzW2ldKTsKICAgIH0KICAgIGNmZi5jaGFyU3RyaW5ncyA9IGNoYXJTdHJpbmdzSW5kZXg7CiAgICBjb25zdCBwcml2YXRlRGljdCA9IG5ldyBDRkZQcml2YXRlRGljdCgpOwogICAgcHJpdmF0ZURpY3Quc2V0QnlOYW1lKCJTdWJycyIsIG51bGwpOwogICAgY29uc3QgZmllbGRzID0gWyJCbHVlVmFsdWVzIiwgIk90aGVyQmx1ZXMiLCAiRmFtaWx5Qmx1ZXMiLCAiRmFtaWx5T3RoZXJCbHVlcyIsICJTdGVtU25hcEgiLCAiU3RlbVNuYXBWIiwgIkJsdWVTaGlmdCIsICJCbHVlRnV6eiIsICJCbHVlU2NhbGUiLCAiTGFuZ3VhZ2VHcm91cCIsICJFeHBhbnNpb25GYWN0b3IiLCAiRm9yY2VCb2xkIiwgIlN0ZEhXIiwgIlN0ZFZXIl07CiAgICBmb3IgKGkgPSAwLCBpaSA9IGZpZWxkcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IGZpZWxkID0gZmllbGRzW2ldOwogICAgICBpZiAoIShmaWVsZCBpbiBwcm9wZXJ0aWVzLnByaXZhdGVEYXRhKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHZhbHVlID0gcHJvcGVydGllcy5wcml2YXRlRGF0YVtmaWVsZF07CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICAgIGZvciAobGV0IGogPSB2YWx1ZS5sZW5ndGggLSAxOyBqID4gMDsgai0tKSB7CiAgICAgICAgICB2YWx1ZVtqXSAtPSB2YWx1ZVtqIC0gMV07CiAgICAgICAgfQogICAgICB9CiAgICAgIHByaXZhdGVEaWN0LnNldEJ5TmFtZShmaWVsZCwgdmFsdWUpOwogICAgfQogICAgY2ZmLnRvcERpY3QucHJpdmF0ZURpY3QgPSBwcml2YXRlRGljdDsKICAgIGNvbnN0IHN1YnJJbmRleCA9IG5ldyBDRkZJbmRleCgpOwogICAgZm9yIChpID0gMCwgaWkgPSBzdWJycy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIHN1YnJJbmRleC5hZGQoc3VicnNbaV0pOwogICAgfQogICAgcHJpdmF0ZURpY3Quc3VicnNJbmRleCA9IHN1YnJJbmRleDsKICAgIGNvbnN0IGNvbXBpbGVyID0gbmV3IENGRkNvbXBpbGVyKGNmZik7CiAgICByZXR1cm4gY29tcGlsZXIuY29tcGlsZSgpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvZm9udHMuanMKCgoKCgoKCgoKCgoKCgoKCgpjb25zdCBQUklWQVRFX1VTRV9BUkVBUyA9IFtbMHhlMDAwLCAweGY4ZmZdLCBbMHgxMDAwMDAsIDB4MTBmZmZkXV07CmNvbnN0IFBERl9HTFlQSF9TUEFDRV9VTklUUyA9IDEwMDA7CmNvbnN0IEVYUE9SVF9EQVRBX1BST1BFUlRJRVMgPSBbImFzY2VudCIsICJiYm94IiwgImJsYWNrIiwgImJvbGQiLCAiY2hhclByb2NPcGVyYXRvckxpc3QiLCAiY3NzRm9udEluZm8iLCAiZGF0YSIsICJkZWZhdWx0Vk1ldHJpY3MiLCAiZGVmYXVsdFdpZHRoIiwgImRlc2NlbnQiLCAiZGlzYWJsZUZvbnRGYWNlIiwgImZhbGxiYWNrTmFtZSIsICJmb250RXh0cmFQcm9wZXJ0aWVzIiwgImZvbnRNYXRyaXgiLCAiaXNJbnZhbGlkUERGanNGb250IiwgImlzVHlwZTNGb250IiwgIml0YWxpYyIsICJsb2FkZWROYW1lIiwgIm1pbWV0eXBlIiwgIm1pc3NpbmdGaWxlIiwgIm5hbWUiLCAicmVtZWFzdXJlIiwgInN5c3RlbUZvbnRJbmZvIiwgInZlcnRpY2FsIl07CmNvbnN0IEVYUE9SVF9EQVRBX0VYVFJBX1BST1BFUlRJRVMgPSBbImNNYXAiLCAiY29tcG9zaXRlIiwgImRlZmF1bHRFbmNvZGluZyIsICJkaWZmZXJlbmNlcyIsICJpc01vbm9zcGFjZSIsICJpc1NlcmlmRm9udCIsICJpc1N5bWJvbGljRm9udCIsICJzZWFjTWFwIiwgInN1YnR5cGUiLCAidG9Gb250Q2hhciIsICJ0b1VuaWNvZGUiLCAidHlwZSIsICJ2bWV0cmljcyIsICJ3aWR0aHMiXTsKZnVuY3Rpb24gYWRqdXN0V2lkdGhzKHByb3BlcnRpZXMpIHsKICBpZiAoIXByb3BlcnRpZXMuZm9udE1hdHJpeCkgewogICAgcmV0dXJuOwogIH0KICBpZiAocHJvcGVydGllcy5mb250TWF0cml4WzBdID09PSBGT05UX0lERU5USVRZX01BVFJJWFswXSkgewogICAgcmV0dXJuOwogIH0KICBjb25zdCBzY2FsZSA9IDAuMDAxIC8gcHJvcGVydGllcy5mb250TWF0cml4WzBdOwogIGNvbnN0IGdseXBoc1dpZHRocyA9IHByb3BlcnRpZXMud2lkdGhzOwogIGZvciAoY29uc3QgZ2x5cGggaW4gZ2x5cGhzV2lkdGhzKSB7CiAgICBnbHlwaHNXaWR0aHNbZ2x5cGhdICo9IHNjYWxlOwogIH0KICBwcm9wZXJ0aWVzLmRlZmF1bHRXaWR0aCAqPSBzY2FsZTsKfQpmdW5jdGlvbiBhZGp1c3RUcnVlVHlwZVRvVW5pY29kZShwcm9wZXJ0aWVzLCBpc1N5bWJvbGljRm9udCwgbmFtZVJlY29yZHMpIHsKICBpZiAocHJvcGVydGllcy5pc0ludGVybmFsRm9udCkgewogICAgcmV0dXJuOwogIH0KICBpZiAocHJvcGVydGllcy5oYXNJbmNsdWRlZFRvVW5pY29kZU1hcCkgewogICAgcmV0dXJuOwogIH0KICBpZiAocHJvcGVydGllcy5oYXNFbmNvZGluZykgewogICAgcmV0dXJuOwogIH0KICBpZiAocHJvcGVydGllcy50b1VuaWNvZGUgaW5zdGFuY2VvZiBJZGVudGl0eVRvVW5pY29kZU1hcCkgewogICAgcmV0dXJuOwogIH0KICBpZiAoIWlzU3ltYm9saWNGb250KSB7CiAgICByZXR1cm47CiAgfQogIGlmIChuYW1lUmVjb3Jkcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybjsKICB9CiAgaWYgKHByb3BlcnRpZXMuZGVmYXVsdEVuY29kaW5nID09PSBXaW5BbnNpRW5jb2RpbmcpIHsKICAgIHJldHVybjsKICB9CiAgZm9yIChjb25zdCByIG9mIG5hbWVSZWNvcmRzKSB7CiAgICBpZiAoIWlzV2luTmFtZVJlY29yZChyKSkgewogICAgICByZXR1cm47CiAgICB9CiAgfQogIGNvbnN0IGVuY29kaW5nID0gV2luQW5zaUVuY29kaW5nOwogIGNvbnN0IHRvVW5pY29kZSA9IFtdLAogICAgZ2x5cGhzVW5pY29kZU1hcCA9IGdldEdseXBoc1VuaWNvZGUoKTsKICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIGVuY29kaW5nKSB7CiAgICBjb25zdCBnbHlwaE5hbWUgPSBlbmNvZGluZ1tjaGFyQ29kZV07CiAgICBpZiAoZ2x5cGhOYW1lID09PSAiIikgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IHVuaWNvZGUgPSBnbHlwaHNVbmljb2RlTWFwW2dseXBoTmFtZV07CiAgICBpZiAodW5pY29kZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgdG9Vbmljb2RlW2NoYXJDb2RlXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUodW5pY29kZSk7CiAgfQogIGlmICh0b1VuaWNvZGUubGVuZ3RoID4gMCkgewogICAgcHJvcGVydGllcy50b1VuaWNvZGUuYW1lbmQodG9Vbmljb2RlKTsKICB9Cn0KZnVuY3Rpb24gYWRqdXN0VHlwZTFUb1VuaWNvZGUocHJvcGVydGllcywgYnVpbHRJbkVuY29kaW5nKSB7CiAgaWYgKHByb3BlcnRpZXMuaXNJbnRlcm5hbEZvbnQpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKHByb3BlcnRpZXMuaGFzSW5jbHVkZWRUb1VuaWNvZGVNYXApIHsKICAgIHJldHVybjsKICB9CiAgaWYgKGJ1aWx0SW5FbmNvZGluZyA9PT0gcHJvcGVydGllcy5kZWZhdWx0RW5jb2RpbmcpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKHByb3BlcnRpZXMudG9Vbmljb2RlIGluc3RhbmNlb2YgSWRlbnRpdHlUb1VuaWNvZGVNYXApIHsKICAgIHJldHVybjsKICB9CiAgY29uc3QgdG9Vbmljb2RlID0gW10sCiAgICBnbHlwaHNVbmljb2RlTWFwID0gZ2V0R2x5cGhzVW5pY29kZSgpOwogIGZvciAoY29uc3QgY2hhckNvZGUgaW4gYnVpbHRJbkVuY29kaW5nKSB7CiAgICBpZiAocHJvcGVydGllcy5oYXNFbmNvZGluZykgewogICAgICBpZiAocHJvcGVydGllcy5iYXNlRW5jb2RpbmdOYW1lIHx8IHByb3BlcnRpZXMuZGlmZmVyZW5jZXNbY2hhckNvZGVdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgfQogICAgY29uc3QgZ2x5cGhOYW1lID0gYnVpbHRJbkVuY29kaW5nW2NoYXJDb2RlXTsKICAgIGNvbnN0IHVuaWNvZGUgPSBnZXRVbmljb2RlRm9yR2x5cGgoZ2x5cGhOYW1lLCBnbHlwaHNVbmljb2RlTWFwKTsKICAgIGlmICh1bmljb2RlICE9PSAtMSkgewogICAgICB0b1VuaWNvZGVbY2hhckNvZGVdID0gU3RyaW5nLmZyb21DaGFyQ29kZSh1bmljb2RlKTsKICAgIH0KICB9CiAgaWYgKHRvVW5pY29kZS5sZW5ndGggPiAwKSB7CiAgICBwcm9wZXJ0aWVzLnRvVW5pY29kZS5hbWVuZCh0b1VuaWNvZGUpOwogIH0KfQpmdW5jdGlvbiBhbWVuZEZhbGxiYWNrVG9Vbmljb2RlKHByb3BlcnRpZXMpIHsKICBpZiAoIXByb3BlcnRpZXMuZmFsbGJhY2tUb1VuaWNvZGUpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKHByb3BlcnRpZXMudG9Vbmljb2RlIGluc3RhbmNlb2YgSWRlbnRpdHlUb1VuaWNvZGVNYXApIHsKICAgIHJldHVybjsKICB9CiAgY29uc3QgdG9Vbmljb2RlID0gW107CiAgZm9yIChjb25zdCBjaGFyQ29kZSBpbiBwcm9wZXJ0aWVzLmZhbGxiYWNrVG9Vbmljb2RlKSB7CiAgICBpZiAocHJvcGVydGllcy50b1VuaWNvZGUuaGFzKGNoYXJDb2RlKSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIHRvVW5pY29kZVtjaGFyQ29kZV0gPSBwcm9wZXJ0aWVzLmZhbGxiYWNrVG9Vbmljb2RlW2NoYXJDb2RlXTsKICB9CiAgaWYgKHRvVW5pY29kZS5sZW5ndGggPiAwKSB7CiAgICBwcm9wZXJ0aWVzLnRvVW5pY29kZS5hbWVuZCh0b1VuaWNvZGUpOwogIH0KfQpjbGFzcyBmb250c19HbHlwaCB7CiAgY29uc3RydWN0b3Iob3JpZ2luYWxDaGFyQ29kZSwgZm9udENoYXIsIHVuaWNvZGUsIGFjY2VudCwgd2lkdGgsIHZtZXRyaWMsIG9wZXJhdG9yTGlzdElkLCBpc1NwYWNlLCBpc0luRm9udCkgewogICAgdGhpcy5vcmlnaW5hbENoYXJDb2RlID0gb3JpZ2luYWxDaGFyQ29kZTsKICAgIHRoaXMuZm9udENoYXIgPSBmb250Q2hhcjsKICAgIHRoaXMudW5pY29kZSA9IHVuaWNvZGU7CiAgICB0aGlzLmFjY2VudCA9IGFjY2VudDsKICAgIHRoaXMud2lkdGggPSB3aWR0aDsKICAgIHRoaXMudm1ldHJpYyA9IHZtZXRyaWM7CiAgICB0aGlzLm9wZXJhdG9yTGlzdElkID0gb3BlcmF0b3JMaXN0SWQ7CiAgICB0aGlzLmlzU3BhY2UgPSBpc1NwYWNlOwogICAgdGhpcy5pc0luRm9udCA9IGlzSW5Gb250OwogIH0KICBnZXQgY2F0ZWdvcnkoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJjYXRlZ29yeSIsIGdldENoYXJVbmljb2RlQ2F0ZWdvcnkodGhpcy51bmljb2RlKSwgdHJ1ZSk7CiAgfQp9CmZ1bmN0aW9uIGludDE2KGIwLCBiMSkgewogIHJldHVybiAoYjAgPDwgOCkgKyBiMTsKfQpmdW5jdGlvbiB3cml0ZVNpZ25lZEludDE2KGJ5dGVzLCBpbmRleCwgdmFsdWUpIHsKICBieXRlc1tpbmRleCArIDFdID0gdmFsdWU7CiAgYnl0ZXNbaW5kZXhdID0gdmFsdWUgPj4+IDg7Cn0KZnVuY3Rpb24gc2lnbmVkSW50MTYoYjAsIGIxKSB7CiAgY29uc3QgdmFsdWUgPSAoYjAgPDwgOCkgKyBiMTsKICByZXR1cm4gdmFsdWUgJiAxIDw8IDE1ID8gdmFsdWUgLSAweDEwMDAwIDogdmFsdWU7Cn0KZnVuY3Rpb24gd3JpdGVVaW50MzIoYnl0ZXMsIGluZGV4LCB2YWx1ZSkgewogIGJ5dGVzW2luZGV4ICsgM10gPSB2YWx1ZSAmIDB4ZmY7CiAgYnl0ZXNbaW5kZXggKyAyXSA9IHZhbHVlID4+PiA4OwogIGJ5dGVzW2luZGV4ICsgMV0gPSB2YWx1ZSA+Pj4gMTY7CiAgYnl0ZXNbaW5kZXhdID0gdmFsdWUgPj4+IDI0Owp9CmZ1bmN0aW9uIGludDMyKGIwLCBiMSwgYjIsIGIzKSB7CiAgcmV0dXJuIChiMCA8PCAyNCkgKyAoYjEgPDwgMTYpICsgKGIyIDw8IDgpICsgYjM7Cn0KZnVuY3Rpb24gc3RyaW5nMTYodmFsdWUpIHsKICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSh2YWx1ZSA+PiA4ICYgMHhmZiwgdmFsdWUgJiAweGZmKTsKfQpmdW5jdGlvbiBzYWZlU3RyaW5nMTYodmFsdWUpIHsKICBpZiAodmFsdWUgPiAweDdmZmYpIHsKICAgIHZhbHVlID0gMHg3ZmZmOwogIH0gZWxzZSBpZiAodmFsdWUgPCAtMHg4MDAwKSB7CiAgICB2YWx1ZSA9IC0weDgwMDA7CiAgfQogIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHZhbHVlID4+IDggJiAweGZmLCB2YWx1ZSAmIDB4ZmYpOwp9CmZ1bmN0aW9uIGlzVHJ1ZVR5cGVGaWxlKGZpbGUpIHsKICBjb25zdCBoZWFkZXIgPSBmaWxlLnBlZWtCeXRlcyg0KTsKICByZXR1cm4gcmVhZFVpbnQzMihoZWFkZXIsIDApID09PSAweDAwMDEwMDAwIHx8IGJ5dGVzVG9TdHJpbmcoaGVhZGVyKSA9PT0gInRydWUiOwp9CmZ1bmN0aW9uIGlzVHJ1ZVR5cGVDb2xsZWN0aW9uRmlsZShmaWxlKSB7CiAgY29uc3QgaGVhZGVyID0gZmlsZS5wZWVrQnl0ZXMoNCk7CiAgcmV0dXJuIGJ5dGVzVG9TdHJpbmcoaGVhZGVyKSA9PT0gInR0Y2YiOwp9CmZ1bmN0aW9uIGlzT3BlblR5cGVGaWxlKGZpbGUpIHsKICBjb25zdCBoZWFkZXIgPSBmaWxlLnBlZWtCeXRlcyg0KTsKICByZXR1cm4gYnl0ZXNUb1N0cmluZyhoZWFkZXIpID09PSAiT1RUTyI7Cn0KZnVuY3Rpb24gaXNUeXBlMUZpbGUoZmlsZSkgewogIGNvbnN0IGhlYWRlciA9IGZpbGUucGVla0J5dGVzKDIpOwogIGlmIChoZWFkZXJbMF0gPT09IDB4MjUgJiYgaGVhZGVyWzFdID09PSAweDIxKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgaWYgKGhlYWRlclswXSA9PT0gMHg4MCAmJiBoZWFkZXJbMV0gPT09IDB4MDEpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICByZXR1cm4gZmFsc2U7Cn0KZnVuY3Rpb24gaXNDRkZGaWxlKGZpbGUpIHsKICBjb25zdCBoZWFkZXIgPSBmaWxlLnBlZWtCeXRlcyg0KTsKICBpZiAoaGVhZGVyWzBdID49IDEgJiYgaGVhZGVyWzNdID49IDEgJiYgaGVhZGVyWzNdIDw9IDQpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICByZXR1cm4gZmFsc2U7Cn0KZnVuY3Rpb24gZ2V0Rm9udEZpbGVUeXBlKGZpbGUsIHsKICB0eXBlLAogIHN1YnR5cGUsCiAgY29tcG9zaXRlCn0pIHsKICBsZXQgZmlsZVR5cGUsIGZpbGVTdWJ0eXBlOwogIGlmIChpc1RydWVUeXBlRmlsZShmaWxlKSB8fCBpc1RydWVUeXBlQ29sbGVjdGlvbkZpbGUoZmlsZSkpIHsKICAgIGZpbGVUeXBlID0gY29tcG9zaXRlID8gIkNJREZvbnRUeXBlMiIgOiAiVHJ1ZVR5cGUiOwogIH0gZWxzZSBpZiAoaXNPcGVuVHlwZUZpbGUoZmlsZSkpIHsKICAgIGZpbGVUeXBlID0gY29tcG9zaXRlID8gIkNJREZvbnRUeXBlMiIgOiAiT3BlblR5cGUiOwogIH0gZWxzZSBpZiAoaXNUeXBlMUZpbGUoZmlsZSkpIHsKICAgIGlmIChjb21wb3NpdGUpIHsKICAgICAgZmlsZVR5cGUgPSAiQ0lERm9udFR5cGUwIjsKICAgIH0gZWxzZSB7CiAgICAgIGZpbGVUeXBlID0gdHlwZSA9PT0gIk1NVHlwZTEiID8gIk1NVHlwZTEiIDogIlR5cGUxIjsKICAgIH0KICB9IGVsc2UgaWYgKGlzQ0ZGRmlsZShmaWxlKSkgewogICAgaWYgKGNvbXBvc2l0ZSkgewogICAgICBmaWxlVHlwZSA9ICJDSURGb250VHlwZTAiOwogICAgICBmaWxlU3VidHlwZSA9ICJDSURGb250VHlwZTBDIjsKICAgIH0gZWxzZSB7CiAgICAgIGZpbGVUeXBlID0gdHlwZSA9PT0gIk1NVHlwZTEiID8gIk1NVHlwZTEiIDogIlR5cGUxIjsKICAgICAgZmlsZVN1YnR5cGUgPSAiVHlwZTFDIjsKICAgIH0KICB9IGVsc2UgewogICAgd2FybigiZ2V0Rm9udEZpbGVUeXBlOiBVbmFibGUgdG8gZGV0ZWN0IGNvcnJlY3QgZm9udCBmaWxlIFR5cGUvU3VidHlwZS4iKTsKICAgIGZpbGVUeXBlID0gdHlwZTsKICAgIGZpbGVTdWJ0eXBlID0gc3VidHlwZTsKICB9CiAgcmV0dXJuIFtmaWxlVHlwZSwgZmlsZVN1YnR5cGVdOwp9CmZ1bmN0aW9uIGFwcGx5U3RhbmRhcmRGb250R2x5cGhNYXAobWFwLCBnbHlwaE1hcCkgewogIGZvciAoY29uc3QgY2hhckNvZGUgaW4gZ2x5cGhNYXApIHsKICAgIG1hcFsrY2hhckNvZGVdID0gZ2x5cGhNYXBbY2hhckNvZGVdOwogIH0KfQpmdW5jdGlvbiBidWlsZFRvRm9udENoYXIoZW5jb2RpbmcsIGdseXBoc1VuaWNvZGVNYXAsIGRpZmZlcmVuY2VzKSB7CiAgY29uc3QgdG9Gb250Q2hhciA9IFtdOwogIGxldCB1bmljb2RlOwogIGZvciAobGV0IGkgPSAwLCBpaSA9IGVuY29kaW5nLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIHVuaWNvZGUgPSBnZXRVbmljb2RlRm9yR2x5cGgoZW5jb2RpbmdbaV0sIGdseXBoc1VuaWNvZGVNYXApOwogICAgaWYgKHVuaWNvZGUgIT09IC0xKSB7CiAgICAgIHRvRm9udENoYXJbaV0gPSB1bmljb2RlOwogICAgfQogIH0KICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIGRpZmZlcmVuY2VzKSB7CiAgICB1bmljb2RlID0gZ2V0VW5pY29kZUZvckdseXBoKGRpZmZlcmVuY2VzW2NoYXJDb2RlXSwgZ2x5cGhzVW5pY29kZU1hcCk7CiAgICBpZiAodW5pY29kZSAhPT0gLTEpIHsKICAgICAgdG9Gb250Q2hhclsrY2hhckNvZGVdID0gdW5pY29kZTsKICAgIH0KICB9CiAgcmV0dXJuIHRvRm9udENoYXI7Cn0KZnVuY3Rpb24gaXNNYWNOYW1lUmVjb3JkKHIpIHsKICByZXR1cm4gci5wbGF0Zm9ybSA9PT0gMSAmJiByLmVuY29kaW5nID09PSAwICYmIHIubGFuZ3VhZ2UgPT09IDA7Cn0KZnVuY3Rpb24gaXNXaW5OYW1lUmVjb3JkKHIpIHsKICByZXR1cm4gci5wbGF0Zm9ybSA9PT0gMyAmJiByLmVuY29kaW5nID09PSAxICYmIHIubGFuZ3VhZ2UgPT09IDB4NDA5Owp9CmZ1bmN0aW9uIGNvbnZlcnRDaWRTdHJpbmcoY2hhckNvZGUsIGNpZCwgc2hvdWxkVGhyb3cgPSBmYWxzZSkgewogIHN3aXRjaCAoY2lkLmxlbmd0aCkgewogICAgY2FzZSAxOgogICAgICByZXR1cm4gY2lkLmNoYXJDb2RlQXQoMCk7CiAgICBjYXNlIDI6CiAgICAgIHJldHVybiBjaWQuY2hhckNvZGVBdCgwKSA8PCA4IHwgY2lkLmNoYXJDb2RlQXQoMSk7CiAgfQogIGNvbnN0IG1zZyA9IGBVbnN1cHBvcnRlZCBDSUQgc3RyaW5nIChjaGFyQ29kZSAke2NoYXJDb2RlfSk6ICIke2NpZH0iLmA7CiAgaWYgKHNob3VsZFRocm93KSB7CiAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IobXNnKTsKICB9CiAgd2Fybihtc2cpOwogIHJldHVybiBjaWQ7Cn0KZnVuY3Rpb24gYWRqdXN0TWFwcGluZyhjaGFyQ29kZVRvR2x5cGhJZCwgaGFzR2x5cGgsIG5ld0dseXBoWmVyb0lkLCB0b1VuaWNvZGUpIHsKICBjb25zdCBuZXdNYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIGNvbnN0IHRvVW5pY29kZUV4dHJhTWFwID0gbmV3IE1hcCgpOwogIGNvbnN0IHRvRm9udENoYXIgPSBbXTsKICBjb25zdCB1c2VkR2x5cGhJZHMgPSBuZXcgU2V0KCk7CiAgbGV0IHByaXZhdGVVc2VBcmVhSW5kZXggPSAwOwogIGNvbnN0IHByaXZhdGVVc2VPZmZldFN0YXJ0ID0gUFJJVkFURV9VU0VfQVJFQVNbcHJpdmF0ZVVzZUFyZWFJbmRleF1bMF07CiAgbGV0IG5leHRBdmFpbGFibGVGb250Q2hhckNvZGUgPSBwcml2YXRlVXNlT2ZmZXRTdGFydDsKICBsZXQgcHJpdmF0ZVVzZU9mZmV0RW5kID0gUFJJVkFURV9VU0VfQVJFQVNbcHJpdmF0ZVVzZUFyZWFJbmRleF1bMV07CiAgY29uc3QgaXNJblByaXZhdGVBcmVhID0gY29kZSA9PiBQUklWQVRFX1VTRV9BUkVBU1swXVswXSA8PSBjb2RlICYmIGNvZGUgPD0gUFJJVkFURV9VU0VfQVJFQVNbMF1bMV0gfHwgUFJJVkFURV9VU0VfQVJFQVNbMV1bMF0gPD0gY29kZSAmJiBjb2RlIDw9IFBSSVZBVEVfVVNFX0FSRUFTWzFdWzFdOwogIGxldCBMSUdBVFVSRV9UT19VTklDT0RFID0gbnVsbDsKICBmb3IgKGNvbnN0IG9yaWdpbmFsQ2hhckNvZGUgaW4gY2hhckNvZGVUb0dseXBoSWQpIHsKICAgIGxldCBnbHlwaElkID0gY2hhckNvZGVUb0dseXBoSWRbb3JpZ2luYWxDaGFyQ29kZV07CiAgICBpZiAoIWhhc0dseXBoKGdseXBoSWQpKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKG5leHRBdmFpbGFibGVGb250Q2hhckNvZGUgPiBwcml2YXRlVXNlT2ZmZXRFbmQpIHsKICAgICAgcHJpdmF0ZVVzZUFyZWFJbmRleCsrOwogICAgICBpZiAocHJpdmF0ZVVzZUFyZWFJbmRleCA+PSBQUklWQVRFX1VTRV9BUkVBUy5sZW5ndGgpIHsKICAgICAgICB3YXJuKCJSYW4gb3V0IG9mIHNwYWNlIGluIGZvbnQgcHJpdmF0ZSB1c2UgYXJlYS4iKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBuZXh0QXZhaWxhYmxlRm9udENoYXJDb2RlID0gUFJJVkFURV9VU0VfQVJFQVNbcHJpdmF0ZVVzZUFyZWFJbmRleF1bMF07CiAgICAgIHByaXZhdGVVc2VPZmZldEVuZCA9IFBSSVZBVEVfVVNFX0FSRUFTW3ByaXZhdGVVc2VBcmVhSW5kZXhdWzFdOwogICAgfQogICAgY29uc3QgZm9udENoYXJDb2RlID0gbmV4dEF2YWlsYWJsZUZvbnRDaGFyQ29kZSsrOwogICAgaWYgKGdseXBoSWQgPT09IDApIHsKICAgICAgZ2x5cGhJZCA9IG5ld0dseXBoWmVyb0lkOwogICAgfQogICAgbGV0IHVuaWNvZGUgPSB0b1VuaWNvZGUuZ2V0KG9yaWdpbmFsQ2hhckNvZGUpOwogICAgaWYgKHR5cGVvZiB1bmljb2RlID09PSAic3RyaW5nIikgewogICAgICBpZiAodW5pY29kZS5sZW5ndGggPT09IDEpIHsKICAgICAgICB1bmljb2RlID0gdW5pY29kZS5jb2RlUG9pbnRBdCgwKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIUxJR0FUVVJFX1RPX1VOSUNPREUpIHsKICAgICAgICAgIExJR0FUVVJFX1RPX1VOSUNPREUgPSBuZXcgTWFwKCk7CiAgICAgICAgICBmb3IgKGxldCBpID0gMHhmYjAwOyBpIDw9IDB4ZmI0ZjsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGkpLm5vcm1hbGl6ZSgiTkZLRCIpOwogICAgICAgICAgICBpZiAobm9ybWFsaXplZC5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgTElHQVRVUkVfVE9fVU5JQ09ERS5zZXQobm9ybWFsaXplZCwgaSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdW5pY29kZSA9IExJR0FUVVJFX1RPX1VOSUNPREUuZ2V0KHVuaWNvZGUpIHx8IHVuaWNvZGUuY29kZVBvaW50QXQoMCk7CiAgICAgIH0KICAgIH0KICAgIGlmICh1bmljb2RlICYmICFpc0luUHJpdmF0ZUFyZWEodW5pY29kZSkgJiYgIXVzZWRHbHlwaElkcy5oYXMoZ2x5cGhJZCkpIHsKICAgICAgdG9Vbmljb2RlRXh0cmFNYXAuc2V0KHVuaWNvZGUsIGdseXBoSWQpOwogICAgICB1c2VkR2x5cGhJZHMuYWRkKGdseXBoSWQpOwogICAgfQogICAgbmV3TWFwW2ZvbnRDaGFyQ29kZV0gPSBnbHlwaElkOwogICAgdG9Gb250Q2hhcltvcmlnaW5hbENoYXJDb2RlXSA9IGZvbnRDaGFyQ29kZTsKICB9CiAgcmV0dXJuIHsKICAgIHRvRm9udENoYXIsCiAgICBjaGFyQ29kZVRvR2x5cGhJZDogbmV3TWFwLAogICAgdG9Vbmljb2RlRXh0cmFNYXAsCiAgICBuZXh0QXZhaWxhYmxlRm9udENoYXJDb2RlCiAgfTsKfQpmdW5jdGlvbiBnZXRSYW5nZXMoZ2x5cGhzLCB0b1VuaWNvZGVFeHRyYU1hcCwgbnVtR2x5cGhzKSB7CiAgY29uc3QgY29kZXMgPSBbXTsKICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIGdseXBocykgewogICAgaWYgKGdseXBoc1tjaGFyQ29kZV0gPj0gbnVtR2x5cGhzKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgY29kZXMucHVzaCh7CiAgICAgIGZvbnRDaGFyQ29kZTogY2hhckNvZGUgfCAwLAogICAgICBnbHlwaElkOiBnbHlwaHNbY2hhckNvZGVdCiAgICB9KTsKICB9CiAgaWYgKHRvVW5pY29kZUV4dHJhTWFwKSB7CiAgICBmb3IgKGNvbnN0IFt1bmljb2RlLCBnbHlwaElkXSBvZiB0b1VuaWNvZGVFeHRyYU1hcCkgewogICAgICBpZiAoZ2x5cGhJZCA+PSBudW1HbHlwaHMpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb2Rlcy5wdXNoKHsKICAgICAgICBmb250Q2hhckNvZGU6IHVuaWNvZGUsCiAgICAgICAgZ2x5cGhJZAogICAgICB9KTsKICAgIH0KICB9CiAgaWYgKGNvZGVzLmxlbmd0aCA9PT0gMCkgewogICAgY29kZXMucHVzaCh7CiAgICAgIGZvbnRDaGFyQ29kZTogMCwKICAgICAgZ2x5cGhJZDogMAogICAgfSk7CiAgfQogIGNvZGVzLnNvcnQoKGEsIGIpID0+IGEuZm9udENoYXJDb2RlIC0gYi5mb250Q2hhckNvZGUpOwogIGNvbnN0IHJhbmdlcyA9IFtdOwogIGNvbnN0IGxlbmd0aCA9IGNvZGVzLmxlbmd0aDsKICBmb3IgKGxldCBuID0gMDsgbiA8IGxlbmd0aDspIHsKICAgIGNvbnN0IHN0YXJ0ID0gY29kZXNbbl0uZm9udENoYXJDb2RlOwogICAgY29uc3QgY29kZUluZGljZXMgPSBbY29kZXNbbl0uZ2x5cGhJZF07CiAgICArK247CiAgICBsZXQgZW5kID0gc3RhcnQ7CiAgICB3aGlsZSAobiA8IGxlbmd0aCAmJiBlbmQgKyAxID09PSBjb2Rlc1tuXS5mb250Q2hhckNvZGUpIHsKICAgICAgY29kZUluZGljZXMucHVzaChjb2Rlc1tuXS5nbHlwaElkKTsKICAgICAgKytlbmQ7CiAgICAgICsrbjsKICAgICAgaWYgKGVuZCA9PT0gMHhmZmZmKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJhbmdlcy5wdXNoKFtzdGFydCwgZW5kLCBjb2RlSW5kaWNlc10pOwogIH0KICByZXR1cm4gcmFuZ2VzOwp9CmZ1bmN0aW9uIGNyZWF0ZUNtYXBUYWJsZShnbHlwaHMsIHRvVW5pY29kZUV4dHJhTWFwLCBudW1HbHlwaHMpIHsKICBjb25zdCByYW5nZXMgPSBnZXRSYW5nZXMoZ2x5cGhzLCB0b1VuaWNvZGVFeHRyYU1hcCwgbnVtR2x5cGhzKTsKICBjb25zdCBudW1UYWJsZXMgPSByYW5nZXMuYXQoLTEpWzFdID4gMHhmZmZmID8gMiA6IDE7CiAgbGV0IGNtYXAgPSAiXHgwMFx4MDAiICsgc3RyaW5nMTYobnVtVGFibGVzKSArICJceDAwXHgwMyIgKyAiXHgwMFx4MDEiICsgc3RyaW5nMzIoNCArIG51bVRhYmxlcyAqIDgpOwogIGxldCBpLCBpaSwgaiwgamo7CiAgZm9yIChpID0gcmFuZ2VzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICBpZiAocmFuZ2VzW2ldWzBdIDw9IDB4ZmZmZikgewogICAgICBicmVhazsKICAgIH0KICB9CiAgY29uc3QgYm1wTGVuZ3RoID0gaSArIDE7CiAgaWYgKHJhbmdlc1tpXVswXSA8IDB4ZmZmZiAmJiByYW5nZXNbaV1bMV0gPT09IDB4ZmZmZikgewogICAgcmFuZ2VzW2ldWzFdID0gMHhmZmZlOwogIH0KICBjb25zdCB0cmFpbGluZ1Jhbmdlc0NvdW50ID0gcmFuZ2VzW2ldWzFdIDwgMHhmZmZmID8gMSA6IDA7CiAgY29uc3Qgc2VnQ291bnQgPSBibXBMZW5ndGggKyB0cmFpbGluZ1Jhbmdlc0NvdW50OwogIGNvbnN0IHNlYXJjaFBhcmFtcyA9IE9wZW5UeXBlRmlsZUJ1aWxkZXIuZ2V0U2VhcmNoUGFyYW1zKHNlZ0NvdW50LCAyKTsKICBsZXQgc3RhcnRDb3VudCA9ICIiOwogIGxldCBlbmRDb3VudCA9ICIiOwogIGxldCBpZERlbHRhcyA9ICIiOwogIGxldCBpZFJhbmdlT2Zmc2V0cyA9ICIiOwogIGxldCBnbHlwaHNJZHMgPSAiIjsKICBsZXQgYmlhcyA9IDA7CiAgbGV0IHJhbmdlLCBzdGFydCwgZW5kLCBjb2RlczsKICBmb3IgKGkgPSAwLCBpaSA9IGJtcExlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIHJhbmdlID0gcmFuZ2VzW2ldOwogICAgc3RhcnQgPSByYW5nZVswXTsKICAgIGVuZCA9IHJhbmdlWzFdOwogICAgc3RhcnRDb3VudCArPSBzdHJpbmcxNihzdGFydCk7CiAgICBlbmRDb3VudCArPSBzdHJpbmcxNihlbmQpOwogICAgY29kZXMgPSByYW5nZVsyXTsKICAgIGxldCBjb250aWd1b3VzID0gdHJ1ZTsKICAgIGZvciAoaiA9IDEsIGpqID0gY29kZXMubGVuZ3RoOyBqIDwgamo7ICsraikgewogICAgICBpZiAoY29kZXNbal0gIT09IGNvZGVzW2ogLSAxXSArIDEpIHsKICAgICAgICBjb250aWd1b3VzID0gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmICghY29udGlndW91cykgewogICAgICBjb25zdCBvZmZzZXQgPSAoc2VnQ291bnQgLSBpKSAqIDIgKyBiaWFzICogMjsKICAgICAgYmlhcyArPSBlbmQgLSBzdGFydCArIDE7CiAgICAgIGlkRGVsdGFzICs9IHN0cmluZzE2KDApOwogICAgICBpZFJhbmdlT2Zmc2V0cyArPSBzdHJpbmcxNihvZmZzZXQpOwogICAgICBmb3IgKGogPSAwLCBqaiA9IGNvZGVzLmxlbmd0aDsgaiA8IGpqOyArK2opIHsKICAgICAgICBnbHlwaHNJZHMgKz0gc3RyaW5nMTYoY29kZXNbal0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb25zdCBzdGFydENvZGUgPSBjb2Rlc1swXTsKICAgICAgaWREZWx0YXMgKz0gc3RyaW5nMTYoc3RhcnRDb2RlIC0gc3RhcnQgJiAweGZmZmYpOwogICAgICBpZFJhbmdlT2Zmc2V0cyArPSBzdHJpbmcxNigwKTsKICAgIH0KICB9CiAgaWYgKHRyYWlsaW5nUmFuZ2VzQ291bnQgPiAwKSB7CiAgICBlbmRDb3VudCArPSAiXHhGRlx4RkYiOwogICAgc3RhcnRDb3VudCArPSAiXHhGRlx4RkYiOwogICAgaWREZWx0YXMgKz0gIlx4MDBceDAxIjsKICAgIGlkUmFuZ2VPZmZzZXRzICs9ICJceDAwXHgwMCI7CiAgfQogIGNvbnN0IGZvcm1hdDMxNCA9ICJceDAwXHgwMCIgKyBzdHJpbmcxNigyICogc2VnQ291bnQpICsgc3RyaW5nMTYoc2VhcmNoUGFyYW1zLnJhbmdlKSArIHN0cmluZzE2KHNlYXJjaFBhcmFtcy5lbnRyeSkgKyBzdHJpbmcxNihzZWFyY2hQYXJhbXMucmFuZ2VTaGlmdCkgKyBlbmRDb3VudCArICJceDAwXHgwMCIgKyBzdGFydENvdW50ICsgaWREZWx0YXMgKyBpZFJhbmdlT2Zmc2V0cyArIGdseXBoc0lkczsKICBsZXQgZm9ybWF0MzEwMTIgPSAiIjsKICBsZXQgaGVhZGVyMzEwMTIgPSAiIjsKICBpZiAobnVtVGFibGVzID4gMSkgewogICAgY21hcCArPSAiXHgwMFx4MDMiICsgIlx4MDBceDBBIiArIHN0cmluZzMyKDQgKyBudW1UYWJsZXMgKiA4ICsgNCArIGZvcm1hdDMxNC5sZW5ndGgpOwogICAgZm9ybWF0MzEwMTIgPSAiIjsKICAgIGZvciAoaSA9IDAsIGlpID0gcmFuZ2VzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgcmFuZ2UgPSByYW5nZXNbaV07CiAgICAgIHN0YXJ0ID0gcmFuZ2VbMF07CiAgICAgIGNvZGVzID0gcmFuZ2VbMl07CiAgICAgIGxldCBjb2RlID0gY29kZXNbMF07CiAgICAgIGZvciAoaiA9IDEsIGpqID0gY29kZXMubGVuZ3RoOyBqIDwgamo7ICsraikgewogICAgICAgIGlmIChjb2Rlc1tqXSAhPT0gY29kZXNbaiAtIDFdICsgMSkgewogICAgICAgICAgZW5kID0gcmFuZ2VbMF0gKyBqIC0gMTsKICAgICAgICAgIGZvcm1hdDMxMDEyICs9IHN0cmluZzMyKHN0YXJ0KSArIHN0cmluZzMyKGVuZCkgKyBzdHJpbmczMihjb2RlKTsKICAgICAgICAgIHN0YXJ0ID0gZW5kICsgMTsKICAgICAgICAgIGNvZGUgPSBjb2Rlc1tqXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZm9ybWF0MzEwMTIgKz0gc3RyaW5nMzIoc3RhcnQpICsgc3RyaW5nMzIocmFuZ2VbMV0pICsgc3RyaW5nMzIoY29kZSk7CiAgICB9CiAgICBoZWFkZXIzMTAxMiA9ICJceDAwXHgwQyIgKyAiXHgwMFx4MDAiICsgc3RyaW5nMzIoZm9ybWF0MzEwMTIubGVuZ3RoICsgMTYpICsgIlx4MDBceDAwXHgwMFx4MDAiICsgc3RyaW5nMzIoZm9ybWF0MzEwMTIubGVuZ3RoIC8gMTIpOwogIH0KICByZXR1cm4gY21hcCArICJceDAwXHgwNCIgKyBzdHJpbmcxNihmb3JtYXQzMTQubGVuZ3RoICsgNCkgKyBmb3JtYXQzMTQgKyBoZWFkZXIzMTAxMiArIGZvcm1hdDMxMDEyOwp9CmZ1bmN0aW9uIHZhbGlkYXRlT1MyVGFibGUob3MyLCBmaWxlKSB7CiAgZmlsZS5wb3MgPSAoZmlsZS5zdGFydCB8fCAwKSArIG9zMi5vZmZzZXQ7CiAgY29uc3QgdmVyc2lvbiA9IGZpbGUuZ2V0VWludDE2KCk7CiAgZmlsZS5za2lwKDYwKTsKICBjb25zdCBzZWxlY3Rpb24gPSBmaWxlLmdldFVpbnQxNigpOwogIGlmICh2ZXJzaW9uIDwgNCAmJiBzZWxlY3Rpb24gJiAweDAzMDApIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgY29uc3QgZmlyc3RDaGFyID0gZmlsZS5nZXRVaW50MTYoKTsKICBjb25zdCBsYXN0Q2hhciA9IGZpbGUuZ2V0VWludDE2KCk7CiAgaWYgKGZpcnN0Q2hhciA+IGxhc3RDaGFyKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGZpbGUuc2tpcCg2KTsKICBjb25zdCB1c1dpbkFzY2VudCA9IGZpbGUuZ2V0VWludDE2KCk7CiAgaWYgKHVzV2luQXNjZW50ID09PSAwKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIG9zMi5kYXRhWzhdID0gb3MyLmRhdGFbOV0gPSAwOwogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIGNyZWF0ZU9TMlRhYmxlKHByb3BlcnRpZXMsIGNoYXJzdHJpbmdzLCBvdmVycmlkZSkgewogIG92ZXJyaWRlIHx8PSB7CiAgICB1bml0c1BlckVtOiAwLAogICAgeU1heDogMCwKICAgIHlNaW46IDAsCiAgICBhc2NlbnQ6IDAsCiAgICBkZXNjZW50OiAwCiAgfTsKICBsZXQgdWxVbmljb2RlUmFuZ2UxID0gMDsKICBsZXQgdWxVbmljb2RlUmFuZ2UyID0gMDsKICBsZXQgdWxVbmljb2RlUmFuZ2UzID0gMDsKICBsZXQgdWxVbmljb2RlUmFuZ2U0ID0gMDsKICBsZXQgZmlyc3RDaGFySW5kZXggPSBudWxsOwogIGxldCBsYXN0Q2hhckluZGV4ID0gMDsKICBsZXQgcG9zaXRpb24gPSAtMTsKICBpZiAoY2hhcnN0cmluZ3MpIHsKICAgIGZvciAobGV0IGNvZGUgaW4gY2hhcnN0cmluZ3MpIHsKICAgICAgY29kZSB8PSAwOwogICAgICBpZiAoZmlyc3RDaGFySW5kZXggPiBjb2RlIHx8ICFmaXJzdENoYXJJbmRleCkgewogICAgICAgIGZpcnN0Q2hhckluZGV4ID0gY29kZTsKICAgICAgfQogICAgICBpZiAobGFzdENoYXJJbmRleCA8IGNvZGUpIHsKICAgICAgICBsYXN0Q2hhckluZGV4ID0gY29kZTsKICAgICAgfQogICAgICBwb3NpdGlvbiA9IGdldFVuaWNvZGVSYW5nZUZvcihjb2RlLCBwb3NpdGlvbik7CiAgICAgIGlmIChwb3NpdGlvbiA8IDMyKSB7CiAgICAgICAgdWxVbmljb2RlUmFuZ2UxIHw9IDEgPDwgcG9zaXRpb247CiAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPCA2NCkgewogICAgICAgIHVsVW5pY29kZVJhbmdlMiB8PSAxIDw8IHBvc2l0aW9uIC0gMzI7CiAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPCA5NikgewogICAgICAgIHVsVW5pY29kZVJhbmdlMyB8PSAxIDw8IHBvc2l0aW9uIC0gNjQ7CiAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPCAxMjMpIHsKICAgICAgICB1bFVuaWNvZGVSYW5nZTQgfD0gMSA8PCBwb3NpdGlvbiAtIDk2OwogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiVW5pY29kZSByYW5nZXMgQml0cyA+IDEyMyBhcmUgcmVzZXJ2ZWQgZm9yIGludGVybmFsIHVzYWdlIik7CiAgICAgIH0KICAgIH0KICAgIGlmIChsYXN0Q2hhckluZGV4ID4gMHhmZmZmKSB7CiAgICAgIGxhc3RDaGFySW5kZXggPSAweGZmZmY7CiAgICB9CiAgfSBlbHNlIHsKICAgIGZpcnN0Q2hhckluZGV4ID0gMDsKICAgIGxhc3RDaGFySW5kZXggPSAyNTU7CiAgfQogIGNvbnN0IGJib3ggPSBwcm9wZXJ0aWVzLmJib3ggfHwgWzAsIDAsIDAsIDBdOwogIGNvbnN0IHVuaXRzUGVyRW0gPSBvdmVycmlkZS51bml0c1BlckVtIHx8IChwcm9wZXJ0aWVzLmZvbnRNYXRyaXggPyAxIC8gTWF0aC5tYXgoLi4ucHJvcGVydGllcy5mb250TWF0cml4LnNsaWNlKDAsIDQpLm1hcChNYXRoLmFicykpIDogMTAwMCk7CiAgY29uc3Qgc2NhbGUgPSBwcm9wZXJ0aWVzLmFzY2VudFNjYWxlZCA/IDEuMCA6IHVuaXRzUGVyRW0gLyBQREZfR0xZUEhfU1BBQ0VfVU5JVFM7CiAgY29uc3QgdHlwb0FzY2VudCA9IG92ZXJyaWRlLmFzY2VudCB8fCBNYXRoLnJvdW5kKHNjYWxlICogKHByb3BlcnRpZXMuYXNjZW50IHx8IGJib3hbM10pKTsKICBsZXQgdHlwb0Rlc2NlbnQgPSBvdmVycmlkZS5kZXNjZW50IHx8IE1hdGgucm91bmQoc2NhbGUgKiAocHJvcGVydGllcy5kZXNjZW50IHx8IGJib3hbMV0pKTsKICBpZiAodHlwb0Rlc2NlbnQgPiAwICYmIHByb3BlcnRpZXMuZGVzY2VudCA+IDAgJiYgYmJveFsxXSA8IDApIHsKICAgIHR5cG9EZXNjZW50ID0gLXR5cG9EZXNjZW50OwogIH0KICBjb25zdCB3aW5Bc2NlbnQgPSBvdmVycmlkZS55TWF4IHx8IHR5cG9Bc2NlbnQ7CiAgY29uc3Qgd2luRGVzY2VudCA9IC1vdmVycmlkZS55TWluIHx8IC10eXBvRGVzY2VudDsKICByZXR1cm4gIlx4MDBceDAzIiArICJceDAyXHgyNCIgKyAiXHgwMVx4RjQiICsgIlx4MDBceDA1IiArICJceDAwXHgwMCIgKyAiXHgwMlx4OEEiICsgIlx4MDJceEJCIiArICJceDAwXHgwMCIgKyAiXHgwMFx4OEMiICsgIlx4MDJceDhBIiArICJceDAyXHhCQiIgKyAiXHgwMFx4MDAiICsgIlx4MDFceERGIiArICJceDAwXHgzMSIgKyAiXHgwMVx4MDIiICsgIlx4MDBceDAwIiArICJceDAwXHgwMFx4MDYiICsgU3RyaW5nLmZyb21DaGFyQ29kZShwcm9wZXJ0aWVzLmZpeGVkUGl0Y2ggPyAweDA5IDogMHgwMCkgKyAiXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwIiArIHN0cmluZzMyKHVsVW5pY29kZVJhbmdlMSkgKyBzdHJpbmczMih1bFVuaWNvZGVSYW5nZTIpICsgc3RyaW5nMzIodWxVbmljb2RlUmFuZ2UzKSArIHN0cmluZzMyKHVsVW5pY29kZVJhbmdlNCkgKyAiXHgyQVx4MzJceDMxXHgyQSIgKyBzdHJpbmcxNihwcm9wZXJ0aWVzLml0YWxpY0FuZ2xlID8gMSA6IDApICsgc3RyaW5nMTYoZmlyc3RDaGFySW5kZXggfHwgcHJvcGVydGllcy5maXJzdENoYXIpICsgc3RyaW5nMTYobGFzdENoYXJJbmRleCB8fCBwcm9wZXJ0aWVzLmxhc3RDaGFyKSArIHN0cmluZzE2KHR5cG9Bc2NlbnQpICsgc3RyaW5nMTYodHlwb0Rlc2NlbnQpICsgIlx4MDBceDY0IiArIHN0cmluZzE2KHdpbkFzY2VudCkgKyBzdHJpbmcxNih3aW5EZXNjZW50KSArICJceDAwXHgwMFx4MDBceDAwIiArICJceDAwXHgwMFx4MDBceDAwIiArIHN0cmluZzE2KHByb3BlcnRpZXMueEhlaWdodCkgKyBzdHJpbmcxNihwcm9wZXJ0aWVzLmNhcEhlaWdodCkgKyBzdHJpbmcxNigwKSArIHN0cmluZzE2KGZpcnN0Q2hhckluZGV4IHx8IHByb3BlcnRpZXMuZmlyc3RDaGFyKSArICJceDAwXHgwMyI7Cn0KZnVuY3Rpb24gY3JlYXRlUG9zdFRhYmxlKHByb3BlcnRpZXMpIHsKICBjb25zdCBhbmdsZSA9IE1hdGguZmxvb3IocHJvcGVydGllcy5pdGFsaWNBbmdsZSAqIDIgKiogMTYpOwogIHJldHVybiAiXHgwMFx4MDNceDAwXHgwMCIgKyBzdHJpbmczMihhbmdsZSkgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIiArIHN0cmluZzMyKHByb3BlcnRpZXMuZml4ZWRQaXRjaCA/IDEgOiAwKSArICJceDAwXHgwMFx4MDBceDAwIiArICJceDAwXHgwMFx4MDBceDAwIiArICJceDAwXHgwMFx4MDBceDAwIiArICJceDAwXHgwMFx4MDBceDAwIjsKfQpmdW5jdGlvbiBjcmVhdGVQb3N0c2NyaXB0TmFtZShuYW1lKSB7CiAgcmV0dXJuIG5hbWUucmVwbGFjZUFsbCgvW15ceDIxLVx4N0VdfFtbXF0oKXt9PD4vJV0vZywgIiIpLnNsaWNlKDAsIDYzKTsKfQpmdW5jdGlvbiBjcmVhdGVOYW1lVGFibGUobmFtZSwgcHJvdG8pIHsKICBpZiAoIXByb3RvKSB7CiAgICBwcm90byA9IFtbXSwgW11dOwogIH0KICBjb25zdCBzdHJpbmdzID0gW3Byb3RvWzBdWzBdIHx8ICJPcmlnaW5hbCBsaWNlbmNlIiwgcHJvdG9bMF1bMV0gfHwgbmFtZSwgcHJvdG9bMF1bMl0gfHwgIlVua25vd24iLCBwcm90b1swXVszXSB8fCAidW5pcXVlSUQiLCBwcm90b1swXVs0XSB8fCBuYW1lLCBwcm90b1swXVs1XSB8fCAiVmVyc2lvbiAwLjExIiwgcHJvdG9bMF1bNl0gfHwgY3JlYXRlUG9zdHNjcmlwdE5hbWUobmFtZSksIHByb3RvWzBdWzddIHx8ICJVbmtub3duIiwgcHJvdG9bMF1bOF0gfHwgIlVua25vd24iLCBwcm90b1swXVs5XSB8fCAiVW5rbm93biJdOwogIGNvbnN0IHN0cmluZ3NVbmljb2RlID0gW107CiAgbGV0IGksIGlpLCBqLCBqaiwgc3RyOwogIGZvciAoaSA9IDAsIGlpID0gc3RyaW5ncy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBzdHIgPSBwcm90b1sxXVtpXSB8fCBzdHJpbmdzW2ldOwogICAgY29uc3Qgc3RyQnVmVW5pY29kZSA9IFtdOwogICAgZm9yIChqID0gMCwgamogPSBzdHIubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICBzdHJCdWZVbmljb2RlLnB1c2goc3RyaW5nMTYoc3RyLmNoYXJDb2RlQXQoaikpKTsKICAgIH0KICAgIHN0cmluZ3NVbmljb2RlLnB1c2goc3RyQnVmVW5pY29kZS5qb2luKCIiKSk7CiAgfQogIGNvbnN0IG5hbWVzID0gW3N0cmluZ3MsIHN0cmluZ3NVbmljb2RlXTsKICBjb25zdCBwbGF0Zm9ybXMgPSBbIlx4MDBceDAxIiwgIlx4MDBceDAzIl07CiAgY29uc3QgZW5jb2RpbmdzID0gWyJceDAwXHgwMCIsICJceDAwXHgwMSJdOwogIGNvbnN0IGxhbmd1YWdlcyA9IFsiXHgwMFx4MDAiLCAiXHgwNFx4MDkiXTsKICBjb25zdCBuYW1lc1JlY29yZENvdW50ID0gc3RyaW5ncy5sZW5ndGggKiBwbGF0Zm9ybXMubGVuZ3RoOwogIGxldCBuYW1lVGFibGUgPSAiXHgwMFx4MDAiICsgc3RyaW5nMTYobmFtZXNSZWNvcmRDb3VudCkgKyBzdHJpbmcxNihuYW1lc1JlY29yZENvdW50ICogMTIgKyA2KTsKICBsZXQgc3RyT2Zmc2V0ID0gMDsKICBmb3IgKGkgPSAwLCBpaSA9IHBsYXRmb3Jtcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCBzdHJzID0gbmFtZXNbaV07CiAgICBmb3IgKGogPSAwLCBqaiA9IHN0cnMubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICBzdHIgPSBzdHJzW2pdOwogICAgICBjb25zdCBuYW1lUmVjb3JkID0gcGxhdGZvcm1zW2ldICsgZW5jb2RpbmdzW2ldICsgbGFuZ3VhZ2VzW2ldICsgc3RyaW5nMTYoaikgKyBzdHJpbmcxNihzdHIubGVuZ3RoKSArIHN0cmluZzE2KHN0ck9mZnNldCk7CiAgICAgIG5hbWVUYWJsZSArPSBuYW1lUmVjb3JkOwogICAgICBzdHJPZmZzZXQgKz0gc3RyLmxlbmd0aDsKICAgIH0KICB9CiAgbmFtZVRhYmxlICs9IHN0cmluZ3Muam9pbigiIikgKyBzdHJpbmdzVW5pY29kZS5qb2luKCIiKTsKICByZXR1cm4gbmFtZVRhYmxlOwp9CmNsYXNzIEZvbnQgewogIGNvbnN0cnVjdG9yKG5hbWUsIGZpbGUsIHByb3BlcnRpZXMsIGV2YWx1YXRvck9wdGlvbnMpIHsKICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICB0aGlzLnBzTmFtZSA9IG51bGw7CiAgICB0aGlzLm1pbWV0eXBlID0gbnVsbDsKICAgIHRoaXMuZGlzYWJsZUZvbnRGYWNlID0gZXZhbHVhdG9yT3B0aW9ucy5kaXNhYmxlRm9udEZhY2U7CiAgICB0aGlzLmZvbnRFeHRyYVByb3BlcnRpZXMgPSBldmFsdWF0b3JPcHRpb25zLmZvbnRFeHRyYVByb3BlcnRpZXM7CiAgICB0aGlzLmxvYWRlZE5hbWUgPSBwcm9wZXJ0aWVzLmxvYWRlZE5hbWU7CiAgICB0aGlzLmlzVHlwZTNGb250ID0gcHJvcGVydGllcy5pc1R5cGUzRm9udDsKICAgIHRoaXMubWlzc2luZ0ZpbGUgPSBmYWxzZTsKICAgIHRoaXMuY3NzRm9udEluZm8gPSBwcm9wZXJ0aWVzLmNzc0ZvbnRJbmZvOwogICAgdGhpcy5fY2hhcnNDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB0aGlzLl9nbHlwaENhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGxldCBpc1NlcmlmRm9udCA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBGb250RmxhZ3MuU2VyaWYpOwogICAgaWYgKCFpc1NlcmlmRm9udCAmJiAhcHJvcGVydGllcy5pc1NpbXVsYXRlZEZsYWdzKSB7CiAgICAgIGNvbnN0IGJhc2VOYW1lID0gbmFtZS5yZXBsYWNlQWxsKC9bLF9dL2csICItIikuc3BsaXQoIi0iLCAxKVswXSwKICAgICAgICBzZXJpZkZvbnRzID0gZ2V0U2VyaWZGb250cygpOwogICAgICBmb3IgKGNvbnN0IG5hbWVQYXJ0IG9mIGJhc2VOYW1lLnNwbGl0KCIrIikpIHsKICAgICAgICBpZiAoc2VyaWZGb250c1tuYW1lUGFydF0pIHsKICAgICAgICAgIGlzU2VyaWZGb250ID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdGhpcy5pc1NlcmlmRm9udCA9IGlzU2VyaWZGb250OwogICAgdGhpcy5pc1N5bWJvbGljRm9udCA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBGb250RmxhZ3MuU3ltYm9saWMpOwogICAgdGhpcy5pc01vbm9zcGFjZSA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBGb250RmxhZ3MuRml4ZWRQaXRjaCk7CiAgICBsZXQgewogICAgICB0eXBlLAogICAgICBzdWJ0eXBlCiAgICB9ID0gcHJvcGVydGllczsKICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICB0aGlzLnN1YnR5cGUgPSBzdWJ0eXBlOwogICAgdGhpcy5zeXN0ZW1Gb250SW5mbyA9IHByb3BlcnRpZXMuc3lzdGVtRm9udEluZm87CiAgICBjb25zdCBtYXRjaGVzID0gbmFtZS5tYXRjaCgvXkludmFsaWRQREZqc0ZvbnRfKC4qKV9cZCskLyk7CiAgICB0aGlzLmlzSW52YWxpZFBERmpzRm9udCA9ICEhbWF0Y2hlczsKICAgIGlmICh0aGlzLmlzSW52YWxpZFBERmpzRm9udCkgewogICAgICB0aGlzLmZhbGxiYWNrTmFtZSA9IG1hdGNoZXNbMV07CiAgICB9IGVsc2UgaWYgKHRoaXMuaXNNb25vc3BhY2UpIHsKICAgICAgdGhpcy5mYWxsYmFja05hbWUgPSAibW9ub3NwYWNlIjsKICAgIH0gZWxzZSBpZiAodGhpcy5pc1NlcmlmRm9udCkgewogICAgICB0aGlzLmZhbGxiYWNrTmFtZSA9ICJzZXJpZiI7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmZhbGxiYWNrTmFtZSA9ICJzYW5zLXNlcmlmIjsKICAgIH0KICAgIGlmICh0aGlzLnN5c3RlbUZvbnRJbmZvPy5ndWVzc0ZhbGxiYWNrKSB7CiAgICAgIHRoaXMuc3lzdGVtRm9udEluZm8uZ3Vlc3NGYWxsYmFjayA9IGZhbHNlOwogICAgICB0aGlzLnN5c3RlbUZvbnRJbmZvLmNzcyArPSBgLCR7dGhpcy5mYWxsYmFja05hbWV9YDsKICAgIH0KICAgIHRoaXMuZGlmZmVyZW5jZXMgPSBwcm9wZXJ0aWVzLmRpZmZlcmVuY2VzOwogICAgdGhpcy53aWR0aHMgPSBwcm9wZXJ0aWVzLndpZHRoczsKICAgIHRoaXMuZGVmYXVsdFdpZHRoID0gcHJvcGVydGllcy5kZWZhdWx0V2lkdGg7CiAgICB0aGlzLmNvbXBvc2l0ZSA9IHByb3BlcnRpZXMuY29tcG9zaXRlOwogICAgdGhpcy5jTWFwID0gcHJvcGVydGllcy5jTWFwOwogICAgdGhpcy5jYXBIZWlnaHQgPSBwcm9wZXJ0aWVzLmNhcEhlaWdodCAvIFBERl9HTFlQSF9TUEFDRV9VTklUUzsKICAgIHRoaXMuYXNjZW50ID0gcHJvcGVydGllcy5hc2NlbnQgLyBQREZfR0xZUEhfU1BBQ0VfVU5JVFM7CiAgICB0aGlzLmRlc2NlbnQgPSBwcm9wZXJ0aWVzLmRlc2NlbnQgLyBQREZfR0xZUEhfU1BBQ0VfVU5JVFM7CiAgICB0aGlzLmxpbmVIZWlnaHQgPSB0aGlzLmFzY2VudCAtIHRoaXMuZGVzY2VudDsKICAgIHRoaXMuZm9udE1hdHJpeCA9IHByb3BlcnRpZXMuZm9udE1hdHJpeDsKICAgIHRoaXMuYmJveCA9IHByb3BlcnRpZXMuYmJveDsKICAgIHRoaXMuZGVmYXVsdEVuY29kaW5nID0gcHJvcGVydGllcy5kZWZhdWx0RW5jb2Rpbmc7CiAgICB0aGlzLnRvVW5pY29kZSA9IHByb3BlcnRpZXMudG9Vbmljb2RlOwogICAgdGhpcy50b0ZvbnRDaGFyID0gW107CiAgICBpZiAocHJvcGVydGllcy50eXBlID09PSAiVHlwZTMiKSB7CiAgICAgIGZvciAobGV0IGNoYXJDb2RlID0gMDsgY2hhckNvZGUgPCAyNTY7IGNoYXJDb2RlKyspIHsKICAgICAgICB0aGlzLnRvRm9udENoYXJbY2hhckNvZGVdID0gdGhpcy5kaWZmZXJlbmNlc1tjaGFyQ29kZV0gfHwgcHJvcGVydGllcy5kZWZhdWx0RW5jb2RpbmdbY2hhckNvZGVdOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuY2lkRW5jb2RpbmcgPSBwcm9wZXJ0aWVzLmNpZEVuY29kaW5nIHx8ICIiOwogICAgdGhpcy52ZXJ0aWNhbCA9ICEhcHJvcGVydGllcy52ZXJ0aWNhbDsKICAgIGlmICh0aGlzLnZlcnRpY2FsKSB7CiAgICAgIHRoaXMudm1ldHJpY3MgPSBwcm9wZXJ0aWVzLnZtZXRyaWNzOwogICAgICB0aGlzLmRlZmF1bHRWTWV0cmljcyA9IHByb3BlcnRpZXMuZGVmYXVsdFZNZXRyaWNzOwogICAgfQogICAgaWYgKCFmaWxlIHx8IGZpbGUuaXNFbXB0eSkgewogICAgICBpZiAoZmlsZSkgewogICAgICAgIHdhcm4oJ0ZvbnQgZmlsZSBpcyBlbXB0eSBpbiAiJyArIG5hbWUgKyAnIiAoJyArIHRoaXMubG9hZGVkTmFtZSArICIpIik7CiAgICAgIH0KICAgICAgdGhpcy5mYWxsYmFja1RvU3lzdGVtRm9udChwcm9wZXJ0aWVzKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgW3R5cGUsIHN1YnR5cGVdID0gZ2V0Rm9udEZpbGVUeXBlKGZpbGUsIHByb3BlcnRpZXMpOwogICAgaWYgKHR5cGUgIT09IHRoaXMudHlwZSB8fCBzdWJ0eXBlICE9PSB0aGlzLnN1YnR5cGUpIHsKICAgICAgaW5mbygiSW5jb25zaXN0ZW50IGZvbnQgZmlsZSBUeXBlL1N1YlR5cGUsIGV4cGVjdGVkOiAiICsgYCR7dGhpcy50eXBlfS8ke3RoaXMuc3VidHlwZX0gYnV0IGZvdW5kOiAke3R5cGV9LyR7c3VidHlwZX0uYCk7CiAgICB9CiAgICBsZXQgZGF0YTsKICAgIHRyeSB7CiAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgIGNhc2UgIk1NVHlwZTEiOgogICAgICAgICAgaW5mbygiTU1UeXBlMSBmb250ICgiICsgbmFtZSArICIpLCBmYWxsaW5nIGJhY2sgdG8gVHlwZTEuIik7CiAgICAgICAgY2FzZSAiVHlwZTEiOgogICAgICAgIGNhc2UgIkNJREZvbnRUeXBlMCI6CiAgICAgICAgICB0aGlzLm1pbWV0eXBlID0gImZvbnQvb3BlbnR5cGUiOwogICAgICAgICAgY29uc3QgY2ZmID0gc3VidHlwZSA9PT0gIlR5cGUxQyIgfHwgc3VidHlwZSA9PT0gIkNJREZvbnRUeXBlMEMiID8gbmV3IENGRkZvbnQoZmlsZSwgcHJvcGVydGllcykgOiBuZXcgVHlwZTFGb250KG5hbWUsIGZpbGUsIHByb3BlcnRpZXMpOwogICAgICAgICAgYWRqdXN0V2lkdGhzKHByb3BlcnRpZXMpOwogICAgICAgICAgZGF0YSA9IHRoaXMuY29udmVydChuYW1lLCBjZmYsIHByb3BlcnRpZXMpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiT3BlblR5cGUiOgogICAgICAgIGNhc2UgIlRydWVUeXBlIjoKICAgICAgICBjYXNlICJDSURGb250VHlwZTIiOgogICAgICAgICAgdGhpcy5taW1ldHlwZSA9ICJmb250L29wZW50eXBlIjsKICAgICAgICAgIGRhdGEgPSB0aGlzLmNoZWNrQW5kUmVwYWlyKG5hbWUsIGZpbGUsIHByb3BlcnRpZXMpOwogICAgICAgICAgYWRqdXN0V2lkdGhzKHByb3BlcnRpZXMpOwogICAgICAgICAgaWYgKHRoaXMuaXNPcGVuVHlwZSkgewogICAgICAgICAgICB0eXBlID0gIk9wZW5UeXBlIjsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEZvbnQgJHt0eXBlfSBpcyBub3Qgc3VwcG9ydGVkYCk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgd2FybihlKTsKICAgICAgdGhpcy5mYWxsYmFja1RvU3lzdGVtRm9udChwcm9wZXJ0aWVzKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgYW1lbmRGYWxsYmFja1RvVW5pY29kZShwcm9wZXJ0aWVzKTsKICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgdGhpcy5zdWJ0eXBlID0gc3VidHlwZTsKICAgIHRoaXMuZm9udE1hdHJpeCA9IHByb3BlcnRpZXMuZm9udE1hdHJpeDsKICAgIHRoaXMud2lkdGhzID0gcHJvcGVydGllcy53aWR0aHM7CiAgICB0aGlzLmRlZmF1bHRXaWR0aCA9IHByb3BlcnRpZXMuZGVmYXVsdFdpZHRoOwogICAgdGhpcy50b1VuaWNvZGUgPSBwcm9wZXJ0aWVzLnRvVW5pY29kZTsKICAgIHRoaXMuc2VhY01hcCA9IHByb3BlcnRpZXMuc2VhY01hcDsKICB9CiAgZ2V0IHJlbmRlcmVyKCkgewogICAgY29uc3QgcmVuZGVyZXIgPSBGb250UmVuZGVyZXJGYWN0b3J5LmNyZWF0ZSh0aGlzLCBTRUFDX0FOQUxZU0lTX0VOQUJMRUQpOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAicmVuZGVyZXIiLCByZW5kZXJlcik7CiAgfQogIGV4cG9ydERhdGEoKSB7CiAgICBjb25zdCBleHBvcnREYXRhUHJvcHMgPSB0aGlzLmZvbnRFeHRyYVByb3BlcnRpZXMgPyBbLi4uRVhQT1JUX0RBVEFfUFJPUEVSVElFUywgLi4uRVhQT1JUX0RBVEFfRVhUUkFfUFJPUEVSVElFU10gOiBFWFBPUlRfREFUQV9QUk9QRVJUSUVTOwogICAgY29uc3QgZGF0YSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBmb3IgKGNvbnN0IHByb3Agb2YgZXhwb3J0RGF0YVByb3BzKSB7CiAgICAgIGNvbnN0IHZhbHVlID0gdGhpc1twcm9wXTsKICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBkYXRhW3Byb3BdID0gdmFsdWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkYXRhOwogIH0KICBmYWxsYmFja1RvU3lzdGVtRm9udChwcm9wZXJ0aWVzKSB7CiAgICB0aGlzLm1pc3NpbmdGaWxlID0gdHJ1ZTsKICAgIGNvbnN0IHsKICAgICAgbmFtZSwKICAgICAgdHlwZQogICAgfSA9IHRoaXM7CiAgICBsZXQgZm9udE5hbWUgPSBub3JtYWxpemVGb250TmFtZShuYW1lKTsKICAgIGNvbnN0IHN0ZEZvbnRNYXAgPSBnZXRTdGRGb250TWFwKCksCiAgICAgIG5vblN0ZEZvbnRNYXAgPSBnZXROb25TdGRGb250TWFwKCk7CiAgICBjb25zdCBpc1N0YW5kYXJkRm9udCA9ICEhc3RkRm9udE1hcFtmb250TmFtZV07CiAgICBjb25zdCBpc01hcHBlZFRvU3RhbmRhcmRGb250ID0gISEobm9uU3RkRm9udE1hcFtmb250TmFtZV0gJiYgc3RkRm9udE1hcFtub25TdGRGb250TWFwW2ZvbnROYW1lXV0pOwogICAgZm9udE5hbWUgPSBzdGRGb250TWFwW2ZvbnROYW1lXSB8fCBub25TdGRGb250TWFwW2ZvbnROYW1lXSB8fCBmb250TmFtZTsKICAgIGNvbnN0IGZvbnRCYXNpY01ldHJpY3NNYXAgPSBnZXRGb250QmFzaWNNZXRyaWNzKCk7CiAgICBjb25zdCBtZXRyaWNzID0gZm9udEJhc2ljTWV0cmljc01hcFtmb250TmFtZV07CiAgICBpZiAobWV0cmljcykgewogICAgICBpZiAoaXNOYU4odGhpcy5hc2NlbnQpKSB7CiAgICAgICAgdGhpcy5hc2NlbnQgPSBtZXRyaWNzLmFzY2VudCAvIFBERl9HTFlQSF9TUEFDRV9VTklUUzsKICAgICAgfQogICAgICBpZiAoaXNOYU4odGhpcy5kZXNjZW50KSkgewogICAgICAgIHRoaXMuZGVzY2VudCA9IG1ldHJpY3MuZGVzY2VudCAvIFBERl9HTFlQSF9TUEFDRV9VTklUUzsKICAgICAgfQogICAgICBpZiAoaXNOYU4odGhpcy5jYXBIZWlnaHQpKSB7CiAgICAgICAgdGhpcy5jYXBIZWlnaHQgPSBtZXRyaWNzLmNhcEhlaWdodCAvIFBERl9HTFlQSF9TUEFDRV9VTklUUzsKICAgICAgfQogICAgfQogICAgdGhpcy5ib2xkID0gL2JvbGQvZ2kudGVzdChmb250TmFtZSk7CiAgICB0aGlzLml0YWxpYyA9IC9vYmxpcXVlfGl0YWxpYy9naS50ZXN0KGZvbnROYW1lKTsKICAgIHRoaXMuYmxhY2sgPSAvQmxhY2svZy50ZXN0KG5hbWUpOwogICAgY29uc3QgaXNOYXJyb3cgPSAvTmFycm93L2cudGVzdChuYW1lKTsKICAgIHRoaXMucmVtZWFzdXJlID0gKCFpc1N0YW5kYXJkRm9udCB8fCBpc05hcnJvdykgJiYgT2JqZWN0LmtleXModGhpcy53aWR0aHMpLmxlbmd0aCA+IDA7CiAgICBpZiAoKGlzU3RhbmRhcmRGb250IHx8IGlzTWFwcGVkVG9TdGFuZGFyZEZvbnQpICYmIHR5cGUgPT09ICJDSURGb250VHlwZTIiICYmIHRoaXMuY2lkRW5jb2Rpbmcuc3RhcnRzV2l0aCgiSWRlbnRpdHktIikpIHsKICAgICAgY29uc3QgY2lkVG9HaWRNYXAgPSBwcm9wZXJ0aWVzLmNpZFRvR2lkTWFwOwogICAgICBjb25zdCBtYXAgPSBbXTsKICAgICAgYXBwbHlTdGFuZGFyZEZvbnRHbHlwaE1hcChtYXAsIGdldEdseXBoTWFwRm9yU3RhbmRhcmRGb250cygpKTsKICAgICAgaWYgKC9BcmlhbC0/QmxhY2svaS50ZXN0KG5hbWUpKSB7CiAgICAgICAgYXBwbHlTdGFuZGFyZEZvbnRHbHlwaE1hcChtYXAsIGdldFN1cHBsZW1lbnRhbEdseXBoTWFwRm9yQXJpYWxCbGFjaygpKTsKICAgICAgfSBlbHNlIGlmICgvQ2FsaWJyaS9pLnRlc3QobmFtZSkpIHsKICAgICAgICBhcHBseVN0YW5kYXJkRm9udEdseXBoTWFwKG1hcCwgZ2V0U3VwcGxlbWVudGFsR2x5cGhNYXBGb3JDYWxpYnJpKCkpOwogICAgICB9CiAgICAgIGlmIChjaWRUb0dpZE1hcCkgewogICAgICAgIGZvciAoY29uc3QgY2hhckNvZGUgaW4gbWFwKSB7CiAgICAgICAgICBjb25zdCBjaWQgPSBtYXBbY2hhckNvZGVdOwogICAgICAgICAgaWYgKGNpZFRvR2lkTWFwW2NpZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBtYXBbK2NoYXJDb2RlXSA9IGNpZFRvR2lkTWFwW2NpZF07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChjaWRUb0dpZE1hcC5sZW5ndGggIT09IHRoaXMudG9Vbmljb2RlLmxlbmd0aCAmJiBwcm9wZXJ0aWVzLmhhc0luY2x1ZGVkVG9Vbmljb2RlTWFwICYmIHRoaXMudG9Vbmljb2RlIGluc3RhbmNlb2YgSWRlbnRpdHlUb1VuaWNvZGVNYXApIHsKICAgICAgICAgIHRoaXMudG9Vbmljb2RlLmZvckVhY2goZnVuY3Rpb24gKGNoYXJDb2RlLCB1bmljb2RlQ2hhckNvZGUpIHsKICAgICAgICAgICAgY29uc3QgY2lkID0gbWFwW2NoYXJDb2RlXTsKICAgICAgICAgICAgaWYgKGNpZFRvR2lkTWFwW2NpZF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIG1hcFsrY2hhckNvZGVdID0gdW5pY29kZUNoYXJDb2RlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCEodGhpcy50b1VuaWNvZGUgaW5zdGFuY2VvZiBJZGVudGl0eVRvVW5pY29kZU1hcCkpIHsKICAgICAgICB0aGlzLnRvVW5pY29kZS5mb3JFYWNoKGZ1bmN0aW9uIChjaGFyQ29kZSwgdW5pY29kZUNoYXJDb2RlKSB7CiAgICAgICAgICBtYXBbK2NoYXJDb2RlXSA9IHVuaWNvZGVDaGFyQ29kZTsKICAgICAgICB9KTsKICAgICAgfQogICAgICB0aGlzLnRvRm9udENoYXIgPSBtYXA7CiAgICAgIHRoaXMudG9Vbmljb2RlID0gbmV3IFRvVW5pY29kZU1hcChtYXApOwogICAgfSBlbHNlIGlmICgvU3ltYm9sL2kudGVzdChmb250TmFtZSkpIHsKICAgICAgdGhpcy50b0ZvbnRDaGFyID0gYnVpbGRUb0ZvbnRDaGFyKFN5bWJvbFNldEVuY29kaW5nLCBnZXRHbHlwaHNVbmljb2RlKCksIHRoaXMuZGlmZmVyZW5jZXMpOwogICAgfSBlbHNlIGlmICgvRGluZ2JhdHMvaS50ZXN0KGZvbnROYW1lKSkgewogICAgICB0aGlzLnRvRm9udENoYXIgPSBidWlsZFRvRm9udENoYXIoWmFwZkRpbmdiYXRzRW5jb2RpbmcsIGdldERpbmdiYXRzR2x5cGhzVW5pY29kZSgpLCB0aGlzLmRpZmZlcmVuY2VzKTsKICAgIH0gZWxzZSBpZiAoaXNTdGFuZGFyZEZvbnQgfHwgaXNNYXBwZWRUb1N0YW5kYXJkRm9udCkgewogICAgICBjb25zdCBtYXAgPSBidWlsZFRvRm9udENoYXIodGhpcy5kZWZhdWx0RW5jb2RpbmcsIGdldEdseXBoc1VuaWNvZGUoKSwgdGhpcy5kaWZmZXJlbmNlcyk7CiAgICAgIGlmICh0eXBlID09PSAiQ0lERm9udFR5cGUyIiAmJiAhdGhpcy5jaWRFbmNvZGluZy5zdGFydHNXaXRoKCJJZGVudGl0eS0iKSAmJiAhKHRoaXMudG9Vbmljb2RlIGluc3RhbmNlb2YgSWRlbnRpdHlUb1VuaWNvZGVNYXApKSB7CiAgICAgICAgdGhpcy50b1VuaWNvZGUuZm9yRWFjaChmdW5jdGlvbiAoY2hhckNvZGUsIHVuaWNvZGVDaGFyQ29kZSkgewogICAgICAgICAgbWFwWytjaGFyQ29kZV0gPSB1bmljb2RlQ2hhckNvZGU7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgdGhpcy50b0ZvbnRDaGFyID0gbWFwOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgZ2x5cGhzVW5pY29kZU1hcCA9IGdldEdseXBoc1VuaWNvZGUoKTsKICAgICAgY29uc3QgbWFwID0gW107CiAgICAgIHRoaXMudG9Vbmljb2RlLmZvckVhY2goKGNoYXJDb2RlLCB1bmljb2RlQ2hhckNvZGUpID0+IHsKICAgICAgICBpZiAoIXRoaXMuY29tcG9zaXRlKSB7CiAgICAgICAgICBjb25zdCBnbHlwaE5hbWUgPSB0aGlzLmRpZmZlcmVuY2VzW2NoYXJDb2RlXSB8fCB0aGlzLmRlZmF1bHRFbmNvZGluZ1tjaGFyQ29kZV07CiAgICAgICAgICBjb25zdCB1bmljb2RlID0gZ2V0VW5pY29kZUZvckdseXBoKGdseXBoTmFtZSwgZ2x5cGhzVW5pY29kZU1hcCk7CiAgICAgICAgICBpZiAodW5pY29kZSAhPT0gLTEpIHsKICAgICAgICAgICAgdW5pY29kZUNoYXJDb2RlID0gdW5pY29kZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbWFwWytjaGFyQ29kZV0gPSB1bmljb2RlQ2hhckNvZGU7CiAgICAgIH0pOwogICAgICBpZiAodGhpcy5jb21wb3NpdGUgJiYgdGhpcy50b1VuaWNvZGUgaW5zdGFuY2VvZiBJZGVudGl0eVRvVW5pY29kZU1hcCkgewogICAgICAgIGlmICgvVGFob21hfFZlcmRhbmEvaS50ZXN0KG5hbWUpKSB7CiAgICAgICAgICBhcHBseVN0YW5kYXJkRm9udEdseXBoTWFwKG1hcCwgZ2V0R2x5cGhNYXBGb3JTdGFuZGFyZEZvbnRzKCkpOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnRvRm9udENoYXIgPSBtYXA7CiAgICB9CiAgICBhbWVuZEZhbGxiYWNrVG9Vbmljb2RlKHByb3BlcnRpZXMpOwogICAgdGhpcy5sb2FkZWROYW1lID0gZm9udE5hbWUuc3BsaXQoIi0iLCAxKVswXTsKICB9CiAgY2hlY2tBbmRSZXBhaXIobmFtZSwgZm9udCwgcHJvcGVydGllcykgewogICAgY29uc3QgVkFMSURfVEFCTEVTID0gWyJPUy8yIiwgImNtYXAiLCAiaGVhZCIsICJoaGVhIiwgImhtdHgiLCAibWF4cCIsICJuYW1lIiwgInBvc3QiLCAibG9jYSIsICJnbHlmIiwgImZwZ20iLCAicHJlcCIsICJjdnQgIiwgIkNGRiAiXTsKICAgIGZ1bmN0aW9uIHJlYWRUYWJsZXMoZmlsZSwgbnVtVGFibGVzKSB7CiAgICAgIGNvbnN0IHRhYmxlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIHRhYmxlc1siT1MvMiJdID0gbnVsbDsKICAgICAgdGFibGVzLmNtYXAgPSBudWxsOwogICAgICB0YWJsZXMuaGVhZCA9IG51bGw7CiAgICAgIHRhYmxlcy5oaGVhID0gbnVsbDsKICAgICAgdGFibGVzLmhtdHggPSBudWxsOwogICAgICB0YWJsZXMubWF4cCA9IG51bGw7CiAgICAgIHRhYmxlcy5uYW1lID0gbnVsbDsKICAgICAgdGFibGVzLnBvc3QgPSBudWxsOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVRhYmxlczsgaSsrKSB7CiAgICAgICAgY29uc3QgdGFibGUgPSByZWFkVGFibGVFbnRyeShmaWxlKTsKICAgICAgICBpZiAoIVZBTElEX1RBQkxFUy5pbmNsdWRlcyh0YWJsZS50YWcpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHRhYmxlLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHRhYmxlc1t0YWJsZS50YWddID0gdGFibGU7CiAgICAgIH0KICAgICAgcmV0dXJuIHRhYmxlczsKICAgIH0KICAgIGZ1bmN0aW9uIHJlYWRUYWJsZUVudHJ5KGZpbGUpIHsKICAgICAgY29uc3QgdGFnID0gZmlsZS5nZXRTdHJpbmcoNCk7CiAgICAgIGNvbnN0IGNoZWNrc3VtID0gZmlsZS5nZXRJbnQzMigpID4+PiAwOwogICAgICBjb25zdCBvZmZzZXQgPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgIGNvbnN0IGxlbmd0aCA9IGZpbGUuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgY29uc3QgcHJldmlvdXNQb3NpdGlvbiA9IGZpbGUucG9zOwogICAgICBmaWxlLnBvcyA9IGZpbGUuc3RhcnQgfHwgMDsKICAgICAgZmlsZS5za2lwKG9mZnNldCk7CiAgICAgIGNvbnN0IGRhdGEgPSBmaWxlLmdldEJ5dGVzKGxlbmd0aCk7CiAgICAgIGZpbGUucG9zID0gcHJldmlvdXNQb3NpdGlvbjsKICAgICAgaWYgKHRhZyA9PT0gImhlYWQiKSB7CiAgICAgICAgZGF0YVs4XSA9IGRhdGFbOV0gPSBkYXRhWzEwXSA9IGRhdGFbMTFdID0gMDsKICAgICAgICBkYXRhWzE3XSB8PSAweDIwOwogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgdGFnLAogICAgICAgIGNoZWNrc3VtLAogICAgICAgIGxlbmd0aCwKICAgICAgICBvZmZzZXQsCiAgICAgICAgZGF0YQogICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gcmVhZE9wZW5UeXBlSGVhZGVyKHR0ZikgewogICAgICByZXR1cm4gewogICAgICAgIHZlcnNpb246IHR0Zi5nZXRTdHJpbmcoNCksCiAgICAgICAgbnVtVGFibGVzOiB0dGYuZ2V0VWludDE2KCksCiAgICAgICAgc2VhcmNoUmFuZ2U6IHR0Zi5nZXRVaW50MTYoKSwKICAgICAgICBlbnRyeVNlbGVjdG9yOiB0dGYuZ2V0VWludDE2KCksCiAgICAgICAgcmFuZ2VTaGlmdDogdHRmLmdldFVpbnQxNigpCiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiByZWFkVHJ1ZVR5cGVDb2xsZWN0aW9uSGVhZGVyKHR0YykgewogICAgICBjb25zdCB0dGNUYWcgPSB0dGMuZ2V0U3RyaW5nKDQpOwogICAgICBhc3NlcnQodHRjVGFnID09PSAidHRjZiIsICJNdXN0IGJlIGEgVHJ1ZVR5cGUgQ29sbGVjdGlvbiBmb250LiIpOwogICAgICBjb25zdCBtYWpvclZlcnNpb24gPSB0dGMuZ2V0VWludDE2KCk7CiAgICAgIGNvbnN0IG1pbm9yVmVyc2lvbiA9IHR0Yy5nZXRVaW50MTYoKTsKICAgICAgY29uc3QgbnVtRm9udHMgPSB0dGMuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgY29uc3Qgb2Zmc2V0VGFibGUgPSBbXTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1Gb250czsgaSsrKSB7CiAgICAgICAgb2Zmc2V0VGFibGUucHVzaCh0dGMuZ2V0SW50MzIoKSA+Pj4gMCk7CiAgICAgIH0KICAgICAgY29uc3QgaGVhZGVyID0gewogICAgICAgIHR0Y1RhZywKICAgICAgICBtYWpvclZlcnNpb24sCiAgICAgICAgbWlub3JWZXJzaW9uLAogICAgICAgIG51bUZvbnRzLAogICAgICAgIG9mZnNldFRhYmxlCiAgICAgIH07CiAgICAgIHN3aXRjaCAobWFqb3JWZXJzaW9uKSB7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcmV0dXJuIGhlYWRlcjsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBoZWFkZXIuZHNpZ1RhZyA9IHR0Yy5nZXRJbnQzMigpID4+PiAwOwogICAgICAgICAgaGVhZGVyLmRzaWdMZW5ndGggPSB0dGMuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgICAgIGhlYWRlci5kc2lnT2Zmc2V0ID0gdHRjLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICByZXR1cm4gaGVhZGVyOwogICAgICB9CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBUcnVlVHlwZSBDb2xsZWN0aW9uIG1ham9yVmVyc2lvbjogJHttYWpvclZlcnNpb259LmApOwogICAgfQogICAgZnVuY3Rpb24gcmVhZFRydWVUeXBlQ29sbGVjdGlvbkRhdGEodHRjLCBmb250TmFtZSkgewogICAgICBjb25zdCB7CiAgICAgICAgbnVtRm9udHMsCiAgICAgICAgb2Zmc2V0VGFibGUKICAgICAgfSA9IHJlYWRUcnVlVHlwZUNvbGxlY3Rpb25IZWFkZXIodHRjKTsKICAgICAgY29uc3QgZm9udE5hbWVQYXJ0cyA9IGZvbnROYW1lLnNwbGl0KCIrIik7CiAgICAgIGxldCBmYWxsYmFja0RhdGE7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtRm9udHM7IGkrKykgewogICAgICAgIHR0Yy5wb3MgPSAodHRjLnN0YXJ0IHx8IDApICsgb2Zmc2V0VGFibGVbaV07CiAgICAgICAgY29uc3QgcG90ZW50aWFsSGVhZGVyID0gcmVhZE9wZW5UeXBlSGVhZGVyKHR0Yyk7CiAgICAgICAgY29uc3QgcG90ZW50aWFsVGFibGVzID0gcmVhZFRhYmxlcyh0dGMsIHBvdGVudGlhbEhlYWRlci5udW1UYWJsZXMpOwogICAgICAgIGlmICghcG90ZW50aWFsVGFibGVzLm5hbWUpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcignVHJ1ZVR5cGUgQ29sbGVjdGlvbiBmb250IG11c3QgY29udGFpbiBhICJuYW1lIiB0YWJsZS4nKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgW25hbWVUYWJsZV0gPSByZWFkTmFtZVRhYmxlKHBvdGVudGlhbFRhYmxlcy5uYW1lKTsKICAgICAgICBmb3IgKGxldCBqID0gMCwgamogPSBuYW1lVGFibGUubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgZm9yIChsZXQgayA9IDAsIGtrID0gbmFtZVRhYmxlW2pdLmxlbmd0aDsgayA8IGtrOyBrKyspIHsKICAgICAgICAgICAgY29uc3QgbmFtZUVudHJ5ID0gbmFtZVRhYmxlW2pdW2tdPy5yZXBsYWNlQWxsKC9ccy9nLCAiIik7CiAgICAgICAgICAgIGlmICghbmFtZUVudHJ5KSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG5hbWVFbnRyeSA9PT0gZm9udE5hbWUpIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaGVhZGVyOiBwb3RlbnRpYWxIZWFkZXIsCiAgICAgICAgICAgICAgICB0YWJsZXM6IHBvdGVudGlhbFRhYmxlcwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZvbnROYW1lUGFydHMubGVuZ3RoIDwgMikgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoY29uc3QgcGFydCBvZiBmb250TmFtZVBhcnRzKSB7CiAgICAgICAgICAgICAgaWYgKG5hbWVFbnRyeSA9PT0gcGFydCkgewogICAgICAgICAgICAgICAgZmFsbGJhY2tEYXRhID0gewogICAgICAgICAgICAgICAgICBuYW1lOiBwYXJ0LAogICAgICAgICAgICAgICAgICBoZWFkZXI6IHBvdGVudGlhbEhlYWRlciwKICAgICAgICAgICAgICAgICAgdGFibGVzOiBwb3RlbnRpYWxUYWJsZXMKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChmYWxsYmFja0RhdGEpIHsKICAgICAgICB3YXJuKGBUcnVlVHlwZSBDb2xsZWN0aW9uIGRvZXMgbm90IGNvbnRhaW4gIiR7Zm9udE5hbWV9IiBmb250LCBgICsgYGZhbGxpbmcgYmFjayB0byAiJHtmYWxsYmFja0RhdGEubmFtZX0iIGZvbnQgaW5zdGVhZC5gKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaGVhZGVyOiBmYWxsYmFja0RhdGEuaGVhZGVyLAogICAgICAgICAgdGFibGVzOiBmYWxsYmFja0RhdGEudGFibGVzCiAgICAgICAgfTsKICAgICAgfQogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYFRydWVUeXBlIENvbGxlY3Rpb24gZG9lcyBub3QgY29udGFpbiAiJHtmb250TmFtZX0iIGZvbnQuYCk7CiAgICB9CiAgICBmdW5jdGlvbiByZWFkQ21hcFRhYmxlKGNtYXAsIGZpbGUsIGlzU3ltYm9saWNGb250LCBoYXNFbmNvZGluZykgewogICAgICBpZiAoIWNtYXApIHsKICAgICAgICB3YXJuKCJObyBjbWFwIHRhYmxlIGF2YWlsYWJsZS4iKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgcGxhdGZvcm1JZDogLTEsCiAgICAgICAgICBlbmNvZGluZ0lkOiAtMSwKICAgICAgICAgIG1hcHBpbmdzOiBbXSwKICAgICAgICAgIGhhc1Nob3J0Q21hcDogZmFsc2UKICAgICAgICB9OwogICAgICB9CiAgICAgIGxldCBzZWdtZW50OwogICAgICBsZXQgc3RhcnQgPSAoZmlsZS5zdGFydCB8fCAwKSArIGNtYXAub2Zmc2V0OwogICAgICBmaWxlLnBvcyA9IHN0YXJ0OwogICAgICBmaWxlLnNraXAoMik7CiAgICAgIGNvbnN0IG51bVRhYmxlcyA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgIGxldCBwb3RlbnRpYWxUYWJsZTsKICAgICAgbGV0IGNhbkJyZWFrID0gZmFsc2U7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVGFibGVzOyBpKyspIHsKICAgICAgICBjb25zdCBwbGF0Zm9ybUlkID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICBjb25zdCBlbmNvZGluZ0lkID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICBjb25zdCBvZmZzZXQgPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgbGV0IHVzZVRhYmxlID0gZmFsc2U7CiAgICAgICAgaWYgKHBvdGVudGlhbFRhYmxlPy5wbGF0Zm9ybUlkID09PSBwbGF0Zm9ybUlkICYmIHBvdGVudGlhbFRhYmxlPy5lbmNvZGluZ0lkID09PSBlbmNvZGluZ0lkKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHBsYXRmb3JtSWQgPT09IDAgJiYgKGVuY29kaW5nSWQgPT09IDAgfHwgZW5jb2RpbmdJZCA9PT0gMSB8fCBlbmNvZGluZ0lkID09PSAzKSkgewogICAgICAgICAgdXNlVGFibGUgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAocGxhdGZvcm1JZCA9PT0gMSAmJiBlbmNvZGluZ0lkID09PSAwKSB7CiAgICAgICAgICB1c2VUYWJsZSA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChwbGF0Zm9ybUlkID09PSAzICYmIGVuY29kaW5nSWQgPT09IDEgJiYgKGhhc0VuY29kaW5nIHx8ICFwb3RlbnRpYWxUYWJsZSkpIHsKICAgICAgICAgIHVzZVRhYmxlID0gdHJ1ZTsKICAgICAgICAgIGlmICghaXNTeW1ib2xpY0ZvbnQpIHsKICAgICAgICAgICAgY2FuQnJlYWsgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoaXNTeW1ib2xpY0ZvbnQgJiYgcGxhdGZvcm1JZCA9PT0gMyAmJiBlbmNvZGluZ0lkID09PSAwKSB7CiAgICAgICAgICB1c2VUYWJsZSA9IHRydWU7CiAgICAgICAgICBsZXQgY29ycmVjdGx5U29ydGVkID0gdHJ1ZTsKICAgICAgICAgIGlmIChpIDwgbnVtVGFibGVzIC0gMSkgewogICAgICAgICAgICBjb25zdCBuZXh0Qnl0ZXMgPSBmaWxlLnBlZWtCeXRlcygyKSwKICAgICAgICAgICAgICBuZXh0UGxhdGZvcm1JZCA9IGludDE2KG5leHRCeXRlc1swXSwgbmV4dEJ5dGVzWzFdKTsKICAgICAgICAgICAgaWYgKG5leHRQbGF0Zm9ybUlkIDwgcGxhdGZvcm1JZCkgewogICAgICAgICAgICAgIGNvcnJlY3RseVNvcnRlZCA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY29ycmVjdGx5U29ydGVkKSB7CiAgICAgICAgICAgIGNhbkJyZWFrID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHVzZVRhYmxlKSB7CiAgICAgICAgICBwb3RlbnRpYWxUYWJsZSA9IHsKICAgICAgICAgICAgcGxhdGZvcm1JZCwKICAgICAgICAgICAgZW5jb2RpbmdJZCwKICAgICAgICAgICAgb2Zmc2V0CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBpZiAoY2FuQnJlYWspIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocG90ZW50aWFsVGFibGUpIHsKICAgICAgICBmaWxlLnBvcyA9IHN0YXJ0ICsgcG90ZW50aWFsVGFibGUub2Zmc2V0OwogICAgICB9CiAgICAgIGlmICghcG90ZW50aWFsVGFibGUgfHwgZmlsZS5wZWVrQnl0ZSgpID09PSAtMSkgewogICAgICAgIHdhcm4oIkNvdWxkIG5vdCBmaW5kIGEgcHJlZmVycmVkIGNtYXAgdGFibGUuIik7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHBsYXRmb3JtSWQ6IC0xLAogICAgICAgICAgZW5jb2RpbmdJZDogLTEsCiAgICAgICAgICBtYXBwaW5nczogW10sCiAgICAgICAgICBoYXNTaG9ydENtYXA6IGZhbHNlCiAgICAgICAgfTsKICAgICAgfQogICAgICBjb25zdCBmb3JtYXQgPSBmaWxlLmdldFVpbnQxNigpOwogICAgICBsZXQgaGFzU2hvcnRDbWFwID0gZmFsc2U7CiAgICAgIGNvbnN0IG1hcHBpbmdzID0gW107CiAgICAgIGxldCBqLCBnbHlwaElkOwogICAgICBpZiAoZm9ybWF0ID09PSAwKSB7CiAgICAgICAgZmlsZS5za2lwKDIgKyAyKTsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgMjU2OyBqKyspIHsKICAgICAgICAgIGNvbnN0IGluZGV4ID0gZmlsZS5nZXRCeXRlKCk7CiAgICAgICAgICBpZiAoIWluZGV4KSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgbWFwcGluZ3MucHVzaCh7CiAgICAgICAgICAgIGNoYXJDb2RlOiBqLAogICAgICAgICAgICBnbHlwaElkOiBpbmRleAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGhhc1Nob3J0Q21hcCA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09PSAyKSB7CiAgICAgICAgZmlsZS5za2lwKDIgKyAyKTsKICAgICAgICBjb25zdCBzdWJIZWFkZXJLZXlzID0gW107CiAgICAgICAgbGV0IG1heFN1YkhlYWRlcktleSA9IDA7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7IGkrKykgewogICAgICAgICAgY29uc3Qgc3ViSGVhZGVyS2V5ID0gZmlsZS5nZXRVaW50MTYoKSA+PiAzOwogICAgICAgICAgc3ViSGVhZGVyS2V5cy5wdXNoKHN1YkhlYWRlcktleSk7CiAgICAgICAgICBtYXhTdWJIZWFkZXJLZXkgPSBNYXRoLm1heChzdWJIZWFkZXJLZXksIG1heFN1YkhlYWRlcktleSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHN1YkhlYWRlcnMgPSBbXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBtYXhTdWJIZWFkZXJLZXk7IGkrKykgewogICAgICAgICAgc3ViSGVhZGVycy5wdXNoKHsKICAgICAgICAgICAgZmlyc3RDb2RlOiBmaWxlLmdldFVpbnQxNigpLAogICAgICAgICAgICBlbnRyeUNvdW50OiBmaWxlLmdldFVpbnQxNigpLAogICAgICAgICAgICBpZERlbHRhOiBzaWduZWRJbnQxNihmaWxlLmdldEJ5dGUoKSwgZmlsZS5nZXRCeXRlKCkpLAogICAgICAgICAgICBpZFJhbmdlUG9zOiBmaWxlLnBvcyArIGZpbGUuZ2V0VWludDE2KCkKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI1NjsgaSsrKSB7CiAgICAgICAgICBpZiAoc3ViSGVhZGVyS2V5c1tpXSA9PT0gMCkgewogICAgICAgICAgICBmaWxlLnBvcyA9IHN1YkhlYWRlcnNbMF0uaWRSYW5nZVBvcyArIDIgKiBpOwogICAgICAgICAgICBnbHlwaElkID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICAgICAgbWFwcGluZ3MucHVzaCh7CiAgICAgICAgICAgICAgY2hhckNvZGU6IGksCiAgICAgICAgICAgICAgZ2x5cGhJZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHMgPSBzdWJIZWFkZXJzW3N1YkhlYWRlcktleXNbaV1dOwogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgcy5lbnRyeUNvdW50OyBqKyspIHsKICAgICAgICAgICAgICBjb25zdCBjaGFyQ29kZSA9IChpIDw8IDgpICsgaiArIHMuZmlyc3RDb2RlOwogICAgICAgICAgICAgIGZpbGUucG9zID0gcy5pZFJhbmdlUG9zICsgMiAqIGo7CiAgICAgICAgICAgICAgZ2x5cGhJZCA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgICAgICAgICAgaWYgKGdseXBoSWQgIT09IDApIHsKICAgICAgICAgICAgICAgIGdseXBoSWQgPSAoZ2x5cGhJZCArIHMuaWREZWx0YSkgJSA2NTUzNjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbWFwcGluZ3MucHVzaCh7CiAgICAgICAgICAgICAgICBjaGFyQ29kZSwKICAgICAgICAgICAgICAgIGdseXBoSWQKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT09IDQpIHsKICAgICAgICBmaWxlLnNraXAoMiArIDIpOwogICAgICAgIGNvbnN0IHNlZ0NvdW50ID0gZmlsZS5nZXRVaW50MTYoKSA+PiAxOwogICAgICAgIGZpbGUuc2tpcCg2KTsKICAgICAgICBjb25zdCBzZWdtZW50cyA9IFtdOwogICAgICAgIGxldCBzZWdJbmRleDsKICAgICAgICBmb3IgKHNlZ0luZGV4ID0gMDsgc2VnSW5kZXggPCBzZWdDb3VudDsgc2VnSW5kZXgrKykgewogICAgICAgICAgc2VnbWVudHMucHVzaCh7CiAgICAgICAgICAgIGVuZDogZmlsZS5nZXRVaW50MTYoKQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGZpbGUuc2tpcCgyKTsKICAgICAgICBmb3IgKHNlZ0luZGV4ID0gMDsgc2VnSW5kZXggPCBzZWdDb3VudDsgc2VnSW5kZXgrKykgewogICAgICAgICAgc2VnbWVudHNbc2VnSW5kZXhdLnN0YXJ0ID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICB9CiAgICAgICAgZm9yIChzZWdJbmRleCA9IDA7IHNlZ0luZGV4IDwgc2VnQ291bnQ7IHNlZ0luZGV4KyspIHsKICAgICAgICAgIHNlZ21lbnRzW3NlZ0luZGV4XS5kZWx0YSA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgICAgfQogICAgICAgIGxldCBvZmZzZXRzQ291bnQgPSAwLAogICAgICAgICAgb2Zmc2V0SW5kZXg7CiAgICAgICAgZm9yIChzZWdJbmRleCA9IDA7IHNlZ0luZGV4IDwgc2VnQ291bnQ7IHNlZ0luZGV4KyspIHsKICAgICAgICAgIHNlZ21lbnQgPSBzZWdtZW50c1tzZWdJbmRleF07CiAgICAgICAgICBjb25zdCByYW5nZU9mZnNldCA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgICAgICBpZiAoIXJhbmdlT2Zmc2V0KSB7CiAgICAgICAgICAgIHNlZ21lbnQub2Zmc2V0SW5kZXggPSAtMTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBvZmZzZXRJbmRleCA9IChyYW5nZU9mZnNldCA+PiAxKSAtIChzZWdDb3VudCAtIHNlZ0luZGV4KTsKICAgICAgICAgIHNlZ21lbnQub2Zmc2V0SW5kZXggPSBvZmZzZXRJbmRleDsKICAgICAgICAgIG9mZnNldHNDb3VudCA9IE1hdGgubWF4KG9mZnNldHNDb3VudCwgb2Zmc2V0SW5kZXggKyBzZWdtZW50LmVuZCAtIHNlZ21lbnQuc3RhcnQgKyAxKTsKICAgICAgICB9CiAgICAgICAgY29uc3Qgb2Zmc2V0cyA9IFtdOwogICAgICAgIGZvciAoaiA9IDA7IGogPCBvZmZzZXRzQ291bnQ7IGorKykgewogICAgICAgICAgb2Zmc2V0cy5wdXNoKGZpbGUuZ2V0VWludDE2KCkpOwogICAgICAgIH0KICAgICAgICBmb3IgKHNlZ0luZGV4ID0gMDsgc2VnSW5kZXggPCBzZWdDb3VudDsgc2VnSW5kZXgrKykgewogICAgICAgICAgc2VnbWVudCA9IHNlZ21lbnRzW3NlZ0luZGV4XTsKICAgICAgICAgIHN0YXJ0ID0gc2VnbWVudC5zdGFydDsKICAgICAgICAgIGNvbnN0IGVuZCA9IHNlZ21lbnQuZW5kOwogICAgICAgICAgY29uc3QgZGVsdGEgPSBzZWdtZW50LmRlbHRhOwogICAgICAgICAgb2Zmc2V0SW5kZXggPSBzZWdtZW50Lm9mZnNldEluZGV4OwogICAgICAgICAgZm9yIChqID0gc3RhcnQ7IGogPD0gZW5kOyBqKyspIHsKICAgICAgICAgICAgaWYgKGogPT09IDB4ZmZmZikgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGdseXBoSWQgPSBvZmZzZXRJbmRleCA8IDAgPyBqIDogb2Zmc2V0c1tvZmZzZXRJbmRleCArIGogLSBzdGFydF07CiAgICAgICAgICAgIGdseXBoSWQgPSBnbHlwaElkICsgZGVsdGEgJiAweGZmZmY7CiAgICAgICAgICAgIG1hcHBpbmdzLnB1c2goewogICAgICAgICAgICAgIGNoYXJDb2RlOiBqLAogICAgICAgICAgICAgIGdseXBoSWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PT0gNikgewogICAgICAgIGZpbGUuc2tpcCgyICsgMik7CiAgICAgICAgY29uc3QgZmlyc3RDb2RlID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICBjb25zdCBlbnRyeUNvdW50ID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgZW50cnlDb3VudDsgaisrKSB7CiAgICAgICAgICBnbHlwaElkID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICAgIGNvbnN0IGNoYXJDb2RlID0gZmlyc3RDb2RlICsgajsKICAgICAgICAgIG1hcHBpbmdzLnB1c2goewogICAgICAgICAgICBjaGFyQ29kZSwKICAgICAgICAgICAgZ2x5cGhJZAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PT0gMTIpIHsKICAgICAgICBmaWxlLnNraXAoMiArIDQgKyA0KTsKICAgICAgICBjb25zdCBuR3JvdXBzID0gZmlsZS5nZXRJbnQzMigpID4+PiAwOwogICAgICAgIGZvciAoaiA9IDA7IGogPCBuR3JvdXBzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHN0YXJ0Q2hhckNvZGUgPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICBjb25zdCBlbmRDaGFyQ29kZSA9IGZpbGUuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgICAgIGxldCBnbHlwaENvZGUgPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICBmb3IgKGxldCBjaGFyQ29kZSA9IHN0YXJ0Q2hhckNvZGU7IGNoYXJDb2RlIDw9IGVuZENoYXJDb2RlOyBjaGFyQ29kZSsrKSB7CiAgICAgICAgICAgIG1hcHBpbmdzLnB1c2goewogICAgICAgICAgICAgIGNoYXJDb2RlLAogICAgICAgICAgICAgIGdseXBoSWQ6IGdseXBoQ29kZSsrCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKCJjbWFwIHRhYmxlIGhhcyB1bnN1cHBvcnRlZCBmb3JtYXQ6ICIgKyBmb3JtYXQpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBwbGF0Zm9ybUlkOiAtMSwKICAgICAgICAgIGVuY29kaW5nSWQ6IC0xLAogICAgICAgICAgbWFwcGluZ3M6IFtdLAogICAgICAgICAgaGFzU2hvcnRDbWFwOiBmYWxzZQogICAgICAgIH07CiAgICAgIH0KICAgICAgbWFwcGluZ3Muc29ydCgoYSwgYikgPT4gYS5jaGFyQ29kZSAtIGIuY2hhckNvZGUpOwogICAgICBjb25zdCBmaW5hbE1hcHBpbmdzID0gW10sCiAgICAgICAgc2VlbkNoYXJDb2RlcyA9IG5ldyBTZXQoKTsKICAgICAgZm9yIChjb25zdCBtYXAgb2YgbWFwcGluZ3MpIHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBjaGFyQ29kZQogICAgICAgIH0gPSBtYXA7CiAgICAgICAgaWYgKHNlZW5DaGFyQ29kZXMuaGFzKGNoYXJDb2RlKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHNlZW5DaGFyQ29kZXMuYWRkKGNoYXJDb2RlKTsKICAgICAgICBmaW5hbE1hcHBpbmdzLnB1c2gobWFwKTsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIHBsYXRmb3JtSWQ6IHBvdGVudGlhbFRhYmxlLnBsYXRmb3JtSWQsCiAgICAgICAgZW5jb2RpbmdJZDogcG90ZW50aWFsVGFibGUuZW5jb2RpbmdJZCwKICAgICAgICBtYXBwaW5nczogZmluYWxNYXBwaW5ncywKICAgICAgICBoYXNTaG9ydENtYXAKICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIHNhbml0aXplTWV0cmljcyhmaWxlLCBoZWFkZXIsIG1ldHJpY3MsIGhlYWRUYWJsZSwgbnVtR2x5cGhzLCBkdXBGaXJzdEVudHJ5KSB7CiAgICAgIGlmICghaGVhZGVyKSB7CiAgICAgICAgaWYgKG1ldHJpY3MpIHsKICAgICAgICAgIG1ldHJpY3MuZGF0YSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBmaWxlLnBvcyA9IChmaWxlLnN0YXJ0IHx8IDApICsgaGVhZGVyLm9mZnNldDsKICAgICAgZmlsZS5wb3MgKz0gNDsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgY29uc3QgY2FyZXRPZmZzZXQgPSBmaWxlLmdldFVpbnQxNigpOwogICAgICBmaWxlLnBvcyArPSA4OwogICAgICBmaWxlLnBvcyArPSAyOwogICAgICBsZXQgbnVtT2ZNZXRyaWNzID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgaWYgKGNhcmV0T2Zmc2V0ICE9PSAwKSB7CiAgICAgICAgY29uc3QgbWFjU3R5bGUgPSBpbnQxNihoZWFkVGFibGUuZGF0YVs0NF0sIGhlYWRUYWJsZS5kYXRhWzQ1XSk7CiAgICAgICAgaWYgKCEobWFjU3R5bGUgJiAyKSkgewogICAgICAgICAgaGVhZGVyLmRhdGFbMjJdID0gMDsKICAgICAgICAgIGhlYWRlci5kYXRhWzIzXSA9IDA7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChudW1PZk1ldHJpY3MgPiBudW1HbHlwaHMpIHsKICAgICAgICBpbmZvKGBUaGUgbnVtT2ZNZXRyaWNzICgke251bU9mTWV0cmljc30pIHNob3VsZCBub3QgYmUgYCArIGBncmVhdGVyIHRoYW4gdGhlIG51bUdseXBocyAoJHtudW1HbHlwaHN9KS5gKTsKICAgICAgICBudW1PZk1ldHJpY3MgPSBudW1HbHlwaHM7CiAgICAgICAgaGVhZGVyLmRhdGFbMzRdID0gKG51bU9mTWV0cmljcyAmIDB4ZmYwMCkgPj4gODsKICAgICAgICBoZWFkZXIuZGF0YVszNV0gPSBudW1PZk1ldHJpY3MgJiAweDAwZmY7CiAgICAgIH0KICAgICAgY29uc3QgbnVtT2ZTaWRlYmVhcmluZ3MgPSBudW1HbHlwaHMgLSBudW1PZk1ldHJpY3M7CiAgICAgIGNvbnN0IG51bU1pc3NpbmcgPSBudW1PZlNpZGViZWFyaW5ncyAtIChtZXRyaWNzLmxlbmd0aCAtIG51bU9mTWV0cmljcyAqIDQgPj4gMSk7CiAgICAgIGlmIChudW1NaXNzaW5nID4gMCkgewogICAgICAgIGNvbnN0IGVudHJpZXMgPSBuZXcgVWludDhBcnJheShtZXRyaWNzLmxlbmd0aCArIG51bU1pc3NpbmcgKiAyKTsKICAgICAgICBlbnRyaWVzLnNldChtZXRyaWNzLmRhdGEpOwogICAgICAgIGlmIChkdXBGaXJzdEVudHJ5KSB7CiAgICAgICAgICBlbnRyaWVzW21ldHJpY3MubGVuZ3RoXSA9IG1ldHJpY3MuZGF0YVsyXTsKICAgICAgICAgIGVudHJpZXNbbWV0cmljcy5sZW5ndGggKyAxXSA9IG1ldHJpY3MuZGF0YVszXTsKICAgICAgICB9CiAgICAgICAgbWV0cmljcy5kYXRhID0gZW50cmllczsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc2FuaXRpemVHbHlwaChzb3VyY2UsIHNvdXJjZVN0YXJ0LCBzb3VyY2VFbmQsIGRlc3QsIGRlc3RTdGFydCwgaGludHNWYWxpZCkgewogICAgICBjb25zdCBnbHlwaFByb2ZpbGUgPSB7CiAgICAgICAgbGVuZ3RoOiAwLAogICAgICAgIHNpemVPZkluc3RydWN0aW9uczogMAogICAgICB9OwogICAgICBpZiAoc291cmNlU3RhcnQgPCAwIHx8IHNvdXJjZVN0YXJ0ID49IHNvdXJjZS5sZW5ndGggfHwgc291cmNlRW5kID4gc291cmNlLmxlbmd0aCB8fCBzb3VyY2VFbmQgLSBzb3VyY2VTdGFydCA8PSAxMikgewogICAgICAgIHJldHVybiBnbHlwaFByb2ZpbGU7CiAgICAgIH0KICAgICAgY29uc3QgZ2x5ZiA9IHNvdXJjZS5zdWJhcnJheShzb3VyY2VTdGFydCwgc291cmNlRW5kKTsKICAgICAgY29uc3QgeE1pbiA9IHNpZ25lZEludDE2KGdseWZbMl0sIGdseWZbM10pOwogICAgICBjb25zdCB5TWluID0gc2lnbmVkSW50MTYoZ2x5Zls0XSwgZ2x5Zls1XSk7CiAgICAgIGNvbnN0IHhNYXggPSBzaWduZWRJbnQxNihnbHlmWzZdLCBnbHlmWzddKTsKICAgICAgY29uc3QgeU1heCA9IHNpZ25lZEludDE2KGdseWZbOF0sIGdseWZbOV0pOwogICAgICBpZiAoeE1pbiA+IHhNYXgpIHsKICAgICAgICB3cml0ZVNpZ25lZEludDE2KGdseWYsIDIsIHhNYXgpOwogICAgICAgIHdyaXRlU2lnbmVkSW50MTYoZ2x5ZiwgNiwgeE1pbik7CiAgICAgIH0KICAgICAgaWYgKHlNaW4gPiB5TWF4KSB7CiAgICAgICAgd3JpdGVTaWduZWRJbnQxNihnbHlmLCA0LCB5TWF4KTsKICAgICAgICB3cml0ZVNpZ25lZEludDE2KGdseWYsIDgsIHlNaW4pOwogICAgICB9CiAgICAgIGNvbnN0IGNvbnRvdXJzQ291bnQgPSBzaWduZWRJbnQxNihnbHlmWzBdLCBnbHlmWzFdKTsKICAgICAgaWYgKGNvbnRvdXJzQ291bnQgPCAwKSB7CiAgICAgICAgaWYgKGNvbnRvdXJzQ291bnQgPCAtMSkgewogICAgICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgICAgICB9CiAgICAgICAgZGVzdC5zZXQoZ2x5ZiwgZGVzdFN0YXJ0KTsKICAgICAgICBnbHlwaFByb2ZpbGUubGVuZ3RoID0gZ2x5Zi5sZW5ndGg7CiAgICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgICAgfQogICAgICBsZXQgaSwKICAgICAgICBqID0gMTAsCiAgICAgICAgZmxhZ3NDb3VudCA9IDA7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBjb250b3Vyc0NvdW50OyBpKyspIHsKICAgICAgICBjb25zdCBlbmRQb2ludCA9IGdseWZbal0gPDwgOCB8IGdseWZbaiArIDFdOwogICAgICAgIGZsYWdzQ291bnQgPSBlbmRQb2ludCArIDE7CiAgICAgICAgaiArPSAyOwogICAgICB9CiAgICAgIGNvbnN0IGluc3RydWN0aW9uc1N0YXJ0ID0gajsKICAgICAgY29uc3QgaW5zdHJ1Y3Rpb25zTGVuZ3RoID0gZ2x5ZltqXSA8PCA4IHwgZ2x5ZltqICsgMV07CiAgICAgIGdseXBoUHJvZmlsZS5zaXplT2ZJbnN0cnVjdGlvbnMgPSBpbnN0cnVjdGlvbnNMZW5ndGg7CiAgICAgIGogKz0gMiArIGluc3RydWN0aW9uc0xlbmd0aDsKICAgICAgY29uc3QgaW5zdHJ1Y3Rpb25zRW5kID0gajsKICAgICAgbGV0IGNvb3JkaW5hdGVzTGVuZ3RoID0gMDsKICAgICAgZm9yIChpID0gMDsgaSA8IGZsYWdzQ291bnQ7IGkrKykgewogICAgICAgIGNvbnN0IGZsYWcgPSBnbHlmW2orK107CiAgICAgICAgaWYgKGZsYWcgJiAweGMwKSB7CiAgICAgICAgICBnbHlmW2ogLSAxXSA9IGZsYWcgJiAweDNmOwogICAgICAgIH0KICAgICAgICBsZXQgeExlbmd0aCA9IDI7CiAgICAgICAgaWYgKGZsYWcgJiAyKSB7CiAgICAgICAgICB4TGVuZ3RoID0gMTsKICAgICAgICB9IGVsc2UgaWYgKGZsYWcgJiAxNikgewogICAgICAgICAgeExlbmd0aCA9IDA7CiAgICAgICAgfQogICAgICAgIGxldCB5TGVuZ3RoID0gMjsKICAgICAgICBpZiAoZmxhZyAmIDQpIHsKICAgICAgICAgIHlMZW5ndGggPSAxOwogICAgICAgIH0gZWxzZSBpZiAoZmxhZyAmIDMyKSB7CiAgICAgICAgICB5TGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgICAgY29uc3QgeHlMZW5ndGggPSB4TGVuZ3RoICsgeUxlbmd0aDsKICAgICAgICBjb29yZGluYXRlc0xlbmd0aCArPSB4eUxlbmd0aDsKICAgICAgICBpZiAoZmxhZyAmIDgpIHsKICAgICAgICAgIGNvbnN0IHJlcGVhdCA9IGdseWZbaisrXTsKICAgICAgICAgIGlmIChyZXBlYXQgPT09IDApIHsKICAgICAgICAgICAgZ2x5ZltqIC0gMV0gXj0gODsKICAgICAgICAgIH0KICAgICAgICAgIGkgKz0gcmVwZWF0OwogICAgICAgICAgY29vcmRpbmF0ZXNMZW5ndGggKz0gcmVwZWF0ICogeHlMZW5ndGg7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChjb29yZGluYXRlc0xlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybiBnbHlwaFByb2ZpbGU7CiAgICAgIH0KICAgICAgbGV0IGdseXBoRGF0YUxlbmd0aCA9IGogKyBjb29yZGluYXRlc0xlbmd0aDsKICAgICAgaWYgKGdseXBoRGF0YUxlbmd0aCA+IGdseWYubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgICAgfQogICAgICBpZiAoIWhpbnRzVmFsaWQgJiYgaW5zdHJ1Y3Rpb25zTGVuZ3RoID4gMCkgewogICAgICAgIGRlc3Quc2V0KGdseWYuc3ViYXJyYXkoMCwgaW5zdHJ1Y3Rpb25zU3RhcnQpLCBkZXN0U3RhcnQpOwogICAgICAgIGRlc3Quc2V0KFswLCAwXSwgZGVzdFN0YXJ0ICsgaW5zdHJ1Y3Rpb25zU3RhcnQpOwogICAgICAgIGRlc3Quc2V0KGdseWYuc3ViYXJyYXkoaW5zdHJ1Y3Rpb25zRW5kLCBnbHlwaERhdGFMZW5ndGgpLCBkZXN0U3RhcnQgKyBpbnN0cnVjdGlvbnNTdGFydCArIDIpOwogICAgICAgIGdseXBoRGF0YUxlbmd0aCAtPSBpbnN0cnVjdGlvbnNMZW5ndGg7CiAgICAgICAgaWYgKGdseWYubGVuZ3RoIC0gZ2x5cGhEYXRhTGVuZ3RoID4gMykgewogICAgICAgICAgZ2x5cGhEYXRhTGVuZ3RoID0gZ2x5cGhEYXRhTGVuZ3RoICsgMyAmIH4zOwogICAgICAgIH0KICAgICAgICBnbHlwaFByb2ZpbGUubGVuZ3RoID0gZ2x5cGhEYXRhTGVuZ3RoOwogICAgICAgIHJldHVybiBnbHlwaFByb2ZpbGU7CiAgICAgIH0KICAgICAgaWYgKGdseWYubGVuZ3RoIC0gZ2x5cGhEYXRhTGVuZ3RoID4gMykgewogICAgICAgIGdseXBoRGF0YUxlbmd0aCA9IGdseXBoRGF0YUxlbmd0aCArIDMgJiB+MzsKICAgICAgICBkZXN0LnNldChnbHlmLnN1YmFycmF5KDAsIGdseXBoRGF0YUxlbmd0aCksIGRlc3RTdGFydCk7CiAgICAgICAgZ2x5cGhQcm9maWxlLmxlbmd0aCA9IGdseXBoRGF0YUxlbmd0aDsKICAgICAgICByZXR1cm4gZ2x5cGhQcm9maWxlOwogICAgICB9CiAgICAgIGRlc3Quc2V0KGdseWYsIGRlc3RTdGFydCk7CiAgICAgIGdseXBoUHJvZmlsZS5sZW5ndGggPSBnbHlmLmxlbmd0aDsKICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgIH0KICAgIGZ1bmN0aW9uIHNhbml0aXplSGVhZChoZWFkLCBudW1HbHlwaHMsIGxvY2FMZW5ndGgpIHsKICAgICAgY29uc3QgZGF0YSA9IGhlYWQuZGF0YTsKICAgICAgY29uc3QgdmVyc2lvbiA9IGludDMyKGRhdGFbMF0sIGRhdGFbMV0sIGRhdGFbMl0sIGRhdGFbM10pOwogICAgICBpZiAodmVyc2lvbiA+PiAxNiAhPT0gMSkgewogICAgICAgIGluZm8oIkF0dGVtcHRpbmcgdG8gZml4IGludmFsaWQgdmVyc2lvbiBpbiBoZWFkIHRhYmxlOiAiICsgdmVyc2lvbik7CiAgICAgICAgZGF0YVswXSA9IDA7CiAgICAgICAgZGF0YVsxXSA9IDE7CiAgICAgICAgZGF0YVsyXSA9IDA7CiAgICAgICAgZGF0YVszXSA9IDA7CiAgICAgIH0KICAgICAgY29uc3QgaW5kZXhUb0xvY0Zvcm1hdCA9IGludDE2KGRhdGFbNTBdLCBkYXRhWzUxXSk7CiAgICAgIGlmIChpbmRleFRvTG9jRm9ybWF0IDwgMCB8fCBpbmRleFRvTG9jRm9ybWF0ID4gMSkgewogICAgICAgIGluZm8oIkF0dGVtcHRpbmcgdG8gZml4IGludmFsaWQgaW5kZXhUb0xvY0Zvcm1hdCBpbiBoZWFkIHRhYmxlOiAiICsgaW5kZXhUb0xvY0Zvcm1hdCk7CiAgICAgICAgY29uc3QgbnVtR2x5cGhzUGx1c09uZSA9IG51bUdseXBocyArIDE7CiAgICAgICAgaWYgKGxvY2FMZW5ndGggPT09IG51bUdseXBoc1BsdXNPbmUgPDwgMSkgewogICAgICAgICAgZGF0YVs1MF0gPSAwOwogICAgICAgICAgZGF0YVs1MV0gPSAwOwogICAgICAgIH0gZWxzZSBpZiAobG9jYUxlbmd0aCA9PT0gbnVtR2x5cGhzUGx1c09uZSA8PCAyKSB7CiAgICAgICAgICBkYXRhWzUwXSA9IDA7CiAgICAgICAgICBkYXRhWzUxXSA9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiQ291bGQgbm90IGZpeCBpbmRleFRvTG9jRm9ybWF0OiAiICsgaW5kZXhUb0xvY0Zvcm1hdCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBzYW5pdGl6ZUdseXBoTG9jYXRpb25zKGxvY2EsIGdseWYsIG51bUdseXBocywgaXNHbHlwaExvY2F0aW9uc0xvbmcsIGhpbnRzVmFsaWQsIGR1cEZpcnN0RW50cnksIG1heFNpemVPZkluc3RydWN0aW9ucykgewogICAgICBsZXQgaXRlbVNpemUsIGl0ZW1EZWNvZGUsIGl0ZW1FbmNvZGU7CiAgICAgIGlmIChpc0dseXBoTG9jYXRpb25zTG9uZykgewogICAgICAgIGl0ZW1TaXplID0gNDsKICAgICAgICBpdGVtRGVjb2RlID0gZnVuY3Rpb24gZm9udEl0ZW1EZWNvZGVMb25nKGRhdGEsIG9mZnNldCkgewogICAgICAgICAgcmV0dXJuIGRhdGFbb2Zmc2V0XSA8PCAyNCB8IGRhdGFbb2Zmc2V0ICsgMV0gPDwgMTYgfCBkYXRhW29mZnNldCArIDJdIDw8IDggfCBkYXRhW29mZnNldCArIDNdOwogICAgICAgIH07CiAgICAgICAgaXRlbUVuY29kZSA9IGZ1bmN0aW9uIGZvbnRJdGVtRW5jb2RlTG9uZyhkYXRhLCBvZmZzZXQsIHZhbHVlKSB7CiAgICAgICAgICBkYXRhW29mZnNldF0gPSB2YWx1ZSA+Pj4gMjQgJiAweGZmOwogICAgICAgICAgZGF0YVtvZmZzZXQgKyAxXSA9IHZhbHVlID4+IDE2ICYgMHhmZjsKICAgICAgICAgIGRhdGFbb2Zmc2V0ICsgMl0gPSB2YWx1ZSA+PiA4ICYgMHhmZjsKICAgICAgICAgIGRhdGFbb2Zmc2V0ICsgM10gPSB2YWx1ZSAmIDB4ZmY7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpdGVtU2l6ZSA9IDI7CiAgICAgICAgaXRlbURlY29kZSA9IGZ1bmN0aW9uIGZvbnRJdGVtRGVjb2RlKGRhdGEsIG9mZnNldCkgewogICAgICAgICAgcmV0dXJuIGRhdGFbb2Zmc2V0XSA8PCA5IHwgZGF0YVtvZmZzZXQgKyAxXSA8PCAxOwogICAgICAgIH07CiAgICAgICAgaXRlbUVuY29kZSA9IGZ1bmN0aW9uIGZvbnRJdGVtRW5jb2RlKGRhdGEsIG9mZnNldCwgdmFsdWUpIHsKICAgICAgICAgIGRhdGFbb2Zmc2V0XSA9IHZhbHVlID4+IDkgJiAweGZmOwogICAgICAgICAgZGF0YVtvZmZzZXQgKyAxXSA9IHZhbHVlID4+IDEgJiAweGZmOwogICAgICAgIH07CiAgICAgIH0KICAgICAgY29uc3QgbnVtR2x5cGhzT3V0ID0gZHVwRmlyc3RFbnRyeSA/IG51bUdseXBocyArIDEgOiBudW1HbHlwaHM7CiAgICAgIGNvbnN0IGxvY2FEYXRhU2l6ZSA9IGl0ZW1TaXplICogKDEgKyBudW1HbHlwaHNPdXQpOwogICAgICBjb25zdCBsb2NhRGF0YSA9IG5ldyBVaW50OEFycmF5KGxvY2FEYXRhU2l6ZSk7CiAgICAgIGxvY2FEYXRhLnNldChsb2NhLmRhdGEuc3ViYXJyYXkoMCwgbG9jYURhdGFTaXplKSk7CiAgICAgIGxvY2EuZGF0YSA9IGxvY2FEYXRhOwogICAgICBjb25zdCBvbGRHbHlmRGF0YSA9IGdseWYuZGF0YTsKICAgICAgY29uc3Qgb2xkR2x5ZkRhdGFMZW5ndGggPSBvbGRHbHlmRGF0YS5sZW5ndGg7CiAgICAgIGNvbnN0IG5ld0dseWZEYXRhID0gbmV3IFVpbnQ4QXJyYXkob2xkR2x5ZkRhdGFMZW5ndGgpOwogICAgICBsZXQgaSwgajsKICAgICAgY29uc3QgbG9jYUVudHJpZXMgPSBbXTsKICAgICAgZm9yIChpID0gMCwgaiA9IDA7IGkgPCBudW1HbHlwaHMgKyAxOyBpKyssIGogKz0gaXRlbVNpemUpIHsKICAgICAgICBsZXQgb2Zmc2V0ID0gaXRlbURlY29kZShsb2NhRGF0YSwgaik7CiAgICAgICAgaWYgKG9mZnNldCA+IG9sZEdseWZEYXRhTGVuZ3RoKSB7CiAgICAgICAgICBvZmZzZXQgPSBvbGRHbHlmRGF0YUxlbmd0aDsKICAgICAgICB9CiAgICAgICAgbG9jYUVudHJpZXMucHVzaCh7CiAgICAgICAgICBpbmRleDogaSwKICAgICAgICAgIG9mZnNldCwKICAgICAgICAgIGVuZE9mZnNldDogMAogICAgICAgIH0pOwogICAgICB9CiAgICAgIGxvY2FFbnRyaWVzLnNvcnQoKGEsIGIpID0+IGEub2Zmc2V0IC0gYi5vZmZzZXQpOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtR2x5cGhzOyBpKyspIHsKICAgICAgICBsb2NhRW50cmllc1tpXS5lbmRPZmZzZXQgPSBsb2NhRW50cmllc1tpICsgMV0ub2Zmc2V0OwogICAgICB9CiAgICAgIGxvY2FFbnRyaWVzLnNvcnQoKGEsIGIpID0+IGEuaW5kZXggLSBiLmluZGV4KTsKICAgICAgZm9yIChpID0gMDsgaSA8IG51bUdseXBoczsgaSsrKSB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgb2Zmc2V0LAogICAgICAgICAgZW5kT2Zmc2V0CiAgICAgICAgfSA9IGxvY2FFbnRyaWVzW2ldOwogICAgICAgIGlmIChvZmZzZXQgIT09IDAgfHwgZW5kT2Zmc2V0ICE9PSAwKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgY29uc3QgbmV4dE9mZnNldCA9IGxvY2FFbnRyaWVzW2kgKyAxXS5vZmZzZXQ7CiAgICAgICAgaWYgKG5leHRPZmZzZXQgPT09IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBsb2NhRW50cmllc1tpXS5lbmRPZmZzZXQgPSBuZXh0T2Zmc2V0OwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNvbnN0IGxhc3QgPSBsb2NhRW50cmllcy5hdCgtMik7CiAgICAgIGlmIChsYXN0Lm9mZnNldCAhPT0gMCAmJiBsYXN0LmVuZE9mZnNldCA9PT0gMCkgewogICAgICAgIGxhc3QuZW5kT2Zmc2V0ID0gb2xkR2x5ZkRhdGFMZW5ndGg7CiAgICAgIH0KICAgICAgY29uc3QgbWlzc2luZ0dseXBocyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIGxldCB3cml0ZU9mZnNldCA9IDA7CiAgICAgIGl0ZW1FbmNvZGUobG9jYURhdGEsIDAsIHdyaXRlT2Zmc2V0KTsKICAgICAgZm9yIChpID0gMCwgaiA9IGl0ZW1TaXplOyBpIDwgbnVtR2x5cGhzOyBpKyssIGogKz0gaXRlbVNpemUpIHsKICAgICAgICBjb25zdCBnbHlwaFByb2ZpbGUgPSBzYW5pdGl6ZUdseXBoKG9sZEdseWZEYXRhLCBsb2NhRW50cmllc1tpXS5vZmZzZXQsIGxvY2FFbnRyaWVzW2ldLmVuZE9mZnNldCwgbmV3R2x5ZkRhdGEsIHdyaXRlT2Zmc2V0LCBoaW50c1ZhbGlkKTsKICAgICAgICBjb25zdCBuZXdMZW5ndGggPSBnbHlwaFByb2ZpbGUubGVuZ3RoOwogICAgICAgIGlmIChuZXdMZW5ndGggPT09IDApIHsKICAgICAgICAgIG1pc3NpbmdHbHlwaHNbaV0gPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2x5cGhQcm9maWxlLnNpemVPZkluc3RydWN0aW9ucyA+IG1heFNpemVPZkluc3RydWN0aW9ucykgewogICAgICAgICAgbWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zID0gZ2x5cGhQcm9maWxlLnNpemVPZkluc3RydWN0aW9uczsKICAgICAgICB9CiAgICAgICAgd3JpdGVPZmZzZXQgKz0gbmV3TGVuZ3RoOwogICAgICAgIGl0ZW1FbmNvZGUobG9jYURhdGEsIGosIHdyaXRlT2Zmc2V0KTsKICAgICAgfQogICAgICBpZiAod3JpdGVPZmZzZXQgPT09IDApIHsKICAgICAgICBjb25zdCBzaW1wbGVHbHlwaCA9IG5ldyBVaW50OEFycmF5KFswLCAxLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA0OSwgMF0pOwogICAgICAgIGZvciAoaSA9IDAsIGogPSBpdGVtU2l6ZTsgaSA8IG51bUdseXBoc091dDsgaSsrLCBqICs9IGl0ZW1TaXplKSB7CiAgICAgICAgICBpdGVtRW5jb2RlKGxvY2FEYXRhLCBqLCBzaW1wbGVHbHlwaC5sZW5ndGgpOwogICAgICAgIH0KICAgICAgICBnbHlmLmRhdGEgPSBzaW1wbGVHbHlwaDsKICAgICAgfSBlbHNlIGlmIChkdXBGaXJzdEVudHJ5KSB7CiAgICAgICAgY29uc3QgZmlyc3RFbnRyeUxlbmd0aCA9IGl0ZW1EZWNvZGUobG9jYURhdGEsIGl0ZW1TaXplKTsKICAgICAgICBpZiAobmV3R2x5ZkRhdGEubGVuZ3RoID4gZmlyc3RFbnRyeUxlbmd0aCArIHdyaXRlT2Zmc2V0KSB7CiAgICAgICAgICBnbHlmLmRhdGEgPSBuZXdHbHlmRGF0YS5zdWJhcnJheSgwLCBmaXJzdEVudHJ5TGVuZ3RoICsgd3JpdGVPZmZzZXQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBnbHlmLmRhdGEgPSBuZXcgVWludDhBcnJheShmaXJzdEVudHJ5TGVuZ3RoICsgd3JpdGVPZmZzZXQpOwogICAgICAgICAgZ2x5Zi5kYXRhLnNldChuZXdHbHlmRGF0YS5zdWJhcnJheSgwLCB3cml0ZU9mZnNldCkpOwogICAgICAgIH0KICAgICAgICBnbHlmLmRhdGEuc2V0KG5ld0dseWZEYXRhLnN1YmFycmF5KDAsIGZpcnN0RW50cnlMZW5ndGgpLCB3cml0ZU9mZnNldCk7CiAgICAgICAgaXRlbUVuY29kZShsb2NhLmRhdGEsIGxvY2FEYXRhLmxlbmd0aCAtIGl0ZW1TaXplLCB3cml0ZU9mZnNldCArIGZpcnN0RW50cnlMZW5ndGgpOwogICAgICB9IGVsc2UgewogICAgICAgIGdseWYuZGF0YSA9IG5ld0dseWZEYXRhLnN1YmFycmF5KDAsIHdyaXRlT2Zmc2V0KTsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIG1pc3NpbmdHbHlwaHMsCiAgICAgICAgbWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zCiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiByZWFkUG9zdFNjcmlwdFRhYmxlKHBvc3QsIHByb3BlcnRpZXNPYmosIG1heHBOdW1HbHlwaHMpIHsKICAgICAgY29uc3Qgc3RhcnQgPSAoZm9udC5zdGFydCB8fCAwKSArIHBvc3Qub2Zmc2V0OwogICAgICBmb250LnBvcyA9IHN0YXJ0OwogICAgICBjb25zdCBsZW5ndGggPSBwb3N0Lmxlbmd0aCwKICAgICAgICBlbmQgPSBzdGFydCArIGxlbmd0aDsKICAgICAgY29uc3QgdmVyc2lvbiA9IGZvbnQuZ2V0SW50MzIoKTsKICAgICAgZm9udC5za2lwKDI4KTsKICAgICAgbGV0IGdseXBoTmFtZXM7CiAgICAgIGxldCB2YWxpZCA9IHRydWU7CiAgICAgIGxldCBpOwogICAgICBzd2l0Y2ggKHZlcnNpb24pIHsKICAgICAgICBjYXNlIDB4MDAwMTAwMDA6CiAgICAgICAgICBnbHlwaE5hbWVzID0gTWFjU3RhbmRhcmRHbHlwaE9yZGVyaW5nOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDAwMDIwMDAwOgogICAgICAgICAgY29uc3QgbnVtR2x5cGhzID0gZm9udC5nZXRVaW50MTYoKTsKICAgICAgICAgIGlmIChudW1HbHlwaHMgIT09IG1heHBOdW1HbHlwaHMpIHsKICAgICAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBnbHlwaE5hbWVJbmRleGVzID0gW107CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtR2x5cGhzOyArK2kpIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSBmb250LmdldFVpbnQxNigpOwogICAgICAgICAgICBpZiAoaW5kZXggPj0gMzI3NjgpIHsKICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGdseXBoTmFtZUluZGV4ZXMucHVzaChpbmRleCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXZhbGlkKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgY3VzdG9tTmFtZXMgPSBbXSwKICAgICAgICAgICAgc3RyQnVmID0gW107CiAgICAgICAgICB3aGlsZSAoZm9udC5wb3MgPCBlbmQpIHsKICAgICAgICAgICAgY29uc3Qgc3RyaW5nTGVuZ3RoID0gZm9udC5nZXRCeXRlKCk7CiAgICAgICAgICAgIHN0ckJ1Zi5sZW5ndGggPSBzdHJpbmdMZW5ndGg7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzdHJpbmdMZW5ndGg7ICsraSkgewogICAgICAgICAgICAgIHN0ckJ1ZltpXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZm9udC5nZXRCeXRlKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN1c3RvbU5hbWVzLnB1c2goc3RyQnVmLmpvaW4oIiIpKTsKICAgICAgICAgIH0KICAgICAgICAgIGdseXBoTmFtZXMgPSBbXTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1HbHlwaHM7ICsraSkgewogICAgICAgICAgICBjb25zdCBqID0gZ2x5cGhOYW1lSW5kZXhlc1tpXTsKICAgICAgICAgICAgaWYgKGogPCAyNTgpIHsKICAgICAgICAgICAgICBnbHlwaE5hbWVzLnB1c2goTWFjU3RhbmRhcmRHbHlwaE9yZGVyaW5nW2pdKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBnbHlwaE5hbWVzLnB1c2goY3VzdG9tTmFtZXNbaiAtIDI1OF0pOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDAwMDMwMDAwOgogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHdhcm4oIlVua25vd24vdW5zdXBwb3J0ZWQgcG9zdCB0YWJsZSB2ZXJzaW9uICIgKyB2ZXJzaW9uKTsKICAgICAgICAgIHZhbGlkID0gZmFsc2U7CiAgICAgICAgICBpZiAocHJvcGVydGllc09iai5kZWZhdWx0RW5jb2RpbmcpIHsKICAgICAgICAgICAgZ2x5cGhOYW1lcyA9IHByb3BlcnRpZXNPYmouZGVmYXVsdEVuY29kaW5nOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgcHJvcGVydGllc09iai5nbHlwaE5hbWVzID0gZ2x5cGhOYW1lczsKICAgICAgcmV0dXJuIHZhbGlkOwogICAgfQogICAgZnVuY3Rpb24gcmVhZE5hbWVUYWJsZShuYW1lVGFibGUpIHsKICAgICAgY29uc3Qgc3RhcnQgPSAoZm9udC5zdGFydCB8fCAwKSArIG5hbWVUYWJsZS5vZmZzZXQ7CiAgICAgIGZvbnQucG9zID0gc3RhcnQ7CiAgICAgIGNvbnN0IG5hbWVzID0gW1tdLCBbXV0sCiAgICAgICAgcmVjb3JkcyA9IFtdOwogICAgICBjb25zdCBsZW5ndGggPSBuYW1lVGFibGUubGVuZ3RoLAogICAgICAgIGVuZCA9IHN0YXJ0ICsgbGVuZ3RoOwogICAgICBjb25zdCBmb3JtYXQgPSBmb250LmdldFVpbnQxNigpOwogICAgICBjb25zdCBGT1JNQVRfMF9IRUFERVJfTEVOR1RIID0gNjsKICAgICAgaWYgKGZvcm1hdCAhPT0gMCB8fCBsZW5ndGggPCBGT1JNQVRfMF9IRUFERVJfTEVOR1RIKSB7CiAgICAgICAgcmV0dXJuIFtuYW1lcywgcmVjb3Jkc107CiAgICAgIH0KICAgICAgY29uc3QgbnVtUmVjb3JkcyA9IGZvbnQuZ2V0VWludDE2KCk7CiAgICAgIGNvbnN0IHN0cmluZ3NTdGFydCA9IGZvbnQuZ2V0VWludDE2KCk7CiAgICAgIGNvbnN0IE5BTUVfUkVDT1JEX0xFTkdUSCA9IDEyOwogICAgICBsZXQgaSwgaWk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1SZWNvcmRzICYmIGZvbnQucG9zICsgTkFNRV9SRUNPUkRfTEVOR1RIIDw9IGVuZDsgaSsrKSB7CiAgICAgICAgY29uc3QgciA9IHsKICAgICAgICAgIHBsYXRmb3JtOiBmb250LmdldFVpbnQxNigpLAogICAgICAgICAgZW5jb2Rpbmc6IGZvbnQuZ2V0VWludDE2KCksCiAgICAgICAgICBsYW5ndWFnZTogZm9udC5nZXRVaW50MTYoKSwKICAgICAgICAgIG5hbWU6IGZvbnQuZ2V0VWludDE2KCksCiAgICAgICAgICBsZW5ndGg6IGZvbnQuZ2V0VWludDE2KCksCiAgICAgICAgICBvZmZzZXQ6IGZvbnQuZ2V0VWludDE2KCkKICAgICAgICB9OwogICAgICAgIGlmIChpc01hY05hbWVSZWNvcmQocikgfHwgaXNXaW5OYW1lUmVjb3JkKHIpKSB7CiAgICAgICAgICByZWNvcmRzLnB1c2gocik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAoaSA9IDAsIGlpID0gcmVjb3Jkcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgcmVjb3JkID0gcmVjb3Jkc1tpXTsKICAgICAgICBpZiAocmVjb3JkLmxlbmd0aCA8PSAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgcG9zID0gc3RhcnQgKyBzdHJpbmdzU3RhcnQgKyByZWNvcmQub2Zmc2V0OwogICAgICAgIGlmIChwb3MgKyByZWNvcmQubGVuZ3RoID4gZW5kKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgZm9udC5wb3MgPSBwb3M7CiAgICAgICAgY29uc3QgbmFtZUluZGV4ID0gcmVjb3JkLm5hbWU7CiAgICAgICAgaWYgKHJlY29yZC5lbmNvZGluZykgewogICAgICAgICAgbGV0IHN0ciA9ICIiOwogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIGpqID0gcmVjb3JkLmxlbmd0aDsgaiA8IGpqOyBqICs9IDIpIHsKICAgICAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoZm9udC5nZXRVaW50MTYoKSk7CiAgICAgICAgICB9CiAgICAgICAgICBuYW1lc1sxXVtuYW1lSW5kZXhdID0gc3RyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBuYW1lc1swXVtuYW1lSW5kZXhdID0gZm9udC5nZXRTdHJpbmcocmVjb3JkLmxlbmd0aCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBbbmFtZXMsIHJlY29yZHNdOwogICAgfQogICAgY29uc3QgVFRPcHNTdGFja0RlbHRhcyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAtMiwgLTIsIC0yLCAtMiwgMCwgMCwgLTIsIC01LCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIDAsIDAsIC0xLCAwLCAtMSwgLTEsIC0xLCAtMSwgMSwgLTEsIC05OTksIDAsIDEsIDAsIC0xLCAtMiwgMCwgLTEsIC0yLCAtMSwgLTEsIDAsIC0xLCAtMSwgMCwgMCwgLTk5OSwgLTk5OSwgLTEsIC0xLCAtMSwgLTEsIC0yLCAtOTk5LCAtMiwgLTIsIC05OTksIDAsIC0yLCAtMiwgMCwgMCwgLTIsIDAsIC0yLCAwLCAwLCAwLCAtMiwgLTEsIC0xLCAxLCAxLCAwLCAwLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgMCwgMCwgLTEsIDAsIC0xLCAtMSwgMCwgLTk5OSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgLTIsIC05OTksIC05OTksIC05OTksIC05OTksIC05OTksIC0xLCAtMSwgLTIsIC0yLCAwLCAwLCAwLCAwLCAtMSwgLTEsIC05OTksIC0yLCAtMiwgMCwgMCwgLTEsIC0yLCAtMiwgMCwgMCwgMCwgLTEsIC0xLCAtMSwgLTJdOwogICAgZnVuY3Rpb24gc2FuaXRpemVUVFByb2dyYW0odGFibGUsIHR0Q29udGV4dCkgewogICAgICBsZXQgZGF0YSA9IHRhYmxlLmRhdGE7CiAgICAgIGxldCBpID0gMCwKICAgICAgICBqLAogICAgICAgIG4sCiAgICAgICAgYiwKICAgICAgICBmdW5jSWQsCiAgICAgICAgcGMsCiAgICAgICAgbGFzdEVuZGYgPSAwLAogICAgICAgIGxhc3REZWZmID0gMDsKICAgICAgY29uc3Qgc3RhY2sgPSBbXTsKICAgICAgY29uc3QgY2FsbHN0YWNrID0gW107CiAgICAgIGNvbnN0IGZ1bmN0aW9uc0NhbGxlZCA9IFtdOwogICAgICBsZXQgdG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zID0gdHRDb250ZXh0LnRvb0NvbXBsZXhUb0ZvbGxvd0Z1bmN0aW9uczsKICAgICAgbGV0IGluRkRFRiA9IGZhbHNlLAogICAgICAgIGlmTGV2ZWwgPSAwLAogICAgICAgIGluRUxTRSA9IDA7CiAgICAgIGZvciAobGV0IGlpID0gZGF0YS5sZW5ndGg7IGkgPCBpaTspIHsKICAgICAgICBjb25zdCBvcCA9IGRhdGFbaSsrXTsKICAgICAgICBpZiAob3AgPT09IDB4NDApIHsKICAgICAgICAgIG4gPSBkYXRhW2krK107CiAgICAgICAgICBpZiAoaW5GREVGIHx8IGluRUxTRSkgewogICAgICAgICAgICBpICs9IG47CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgbjsgaisrKSB7CiAgICAgICAgICAgICAgc3RhY2sucHVzaChkYXRhW2krK10pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHg0MSkgewogICAgICAgICAgbiA9IGRhdGFbaSsrXTsKICAgICAgICAgIGlmIChpbkZERUYgfHwgaW5FTFNFKSB7CiAgICAgICAgICAgIGkgKz0gbiAqIDI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgbjsgaisrKSB7CiAgICAgICAgICAgICAgYiA9IGRhdGFbaSsrXTsKICAgICAgICAgICAgICBzdGFjay5wdXNoKGIgPDwgOCB8IGRhdGFbaSsrXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKChvcCAmIDB4ZjgpID09PSAweGIwKSB7CiAgICAgICAgICBuID0gb3AgLSAweGIwICsgMTsKICAgICAgICAgIGlmIChpbkZERUYgfHwgaW5FTFNFKSB7CiAgICAgICAgICAgIGkgKz0gbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBuOyBqKyspIHsKICAgICAgICAgICAgICBzdGFjay5wdXNoKGRhdGFbaSsrXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKChvcCAmIDB4ZjgpID09PSAweGI4KSB7CiAgICAgICAgICBuID0gb3AgLSAweGI4ICsgMTsKICAgICAgICAgIGlmIChpbkZERUYgfHwgaW5FTFNFKSB7CiAgICAgICAgICAgIGkgKz0gbiAqIDI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgbjsgaisrKSB7CiAgICAgICAgICAgICAgYiA9IGRhdGFbaSsrXTsKICAgICAgICAgICAgICBzdGFjay5wdXNoKHNpZ25lZEludDE2KGIsIGRhdGFbaSsrXSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHgyYiAmJiAhdG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zKSB7CiAgICAgICAgICBpZiAoIWluRkRFRiAmJiAhaW5FTFNFKSB7CiAgICAgICAgICAgIGZ1bmNJZCA9IHN0YWNrLmF0KC0xKTsKICAgICAgICAgICAgaWYgKGlzTmFOKGZ1bmNJZCkpIHsKICAgICAgICAgICAgICBpbmZvKCJUVDogQ0FMTCBlbXB0eSBzdGFjayAob3IgaW52YWxpZCBlbnRyeSkuIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdHRDb250ZXh0LmZ1bmN0aW9uc1VzZWRbZnVuY0lkXSA9IHRydWU7CiAgICAgICAgICAgICAgaWYgKGZ1bmNJZCBpbiB0dENvbnRleHQuZnVuY3Rpb25zU3RhY2tEZWx0YXMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld1N0YWNrTGVuZ3RoID0gc3RhY2subGVuZ3RoICsgdHRDb250ZXh0LmZ1bmN0aW9uc1N0YWNrRGVsdGFzW2Z1bmNJZF07CiAgICAgICAgICAgICAgICBpZiAobmV3U3RhY2tMZW5ndGggPCAwKSB7CiAgICAgICAgICAgICAgICAgIHdhcm4oIlRUOiBDQUxMIGludmFsaWQgZnVuY3Rpb25zIHN0YWNrIGRlbHRhLiIpOwogICAgICAgICAgICAgICAgICB0dENvbnRleHQuaGludHNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGFjay5sZW5ndGggPSBuZXdTdGFja0xlbmd0aDsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZ1bmNJZCBpbiB0dENvbnRleHQuZnVuY3Rpb25zRGVmaW5lZCAmJiAhZnVuY3Rpb25zQ2FsbGVkLmluY2x1ZGVzKGZ1bmNJZCkpIHsKICAgICAgICAgICAgICAgIGNhbGxzdGFjay5wdXNoKHsKICAgICAgICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgICAgICAgaSwKICAgICAgICAgICAgICAgICAgc3RhY2tUb3A6IHN0YWNrLmxlbmd0aCAtIDEKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZnVuY3Rpb25zQ2FsbGVkLnB1c2goZnVuY0lkKTsKICAgICAgICAgICAgICAgIHBjID0gdHRDb250ZXh0LmZ1bmN0aW9uc0RlZmluZWRbZnVuY0lkXTsKICAgICAgICAgICAgICAgIGlmICghcGMpIHsKICAgICAgICAgICAgICAgICAgd2FybigiVFQ6IENBTEwgbm9uLWV4aXN0ZW50IGZ1bmN0aW9uIik7CiAgICAgICAgICAgICAgICAgIHR0Q29udGV4dC5oaW50c1ZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRhdGEgPSBwYy5kYXRhOwogICAgICAgICAgICAgICAgaSA9IHBjLmk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHgyYyAmJiAhdG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zKSB7CiAgICAgICAgICBpZiAoaW5GREVGIHx8IGluRUxTRSkgewogICAgICAgICAgICB3YXJuKCJUVDogbmVzdGVkIEZERUZzIG5vdCBhbGxvd2VkIik7CiAgICAgICAgICAgIHRvb0NvbXBsZXhUb0ZvbGxvd0Z1bmN0aW9ucyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBpbkZERUYgPSB0cnVlOwogICAgICAgICAgbGFzdERlZmYgPSBpOwogICAgICAgICAgZnVuY0lkID0gc3RhY2sucG9wKCk7CiAgICAgICAgICB0dENvbnRleHQuZnVuY3Rpb25zRGVmaW5lZFtmdW5jSWRdID0gewogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBpCiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSBpZiAob3AgPT09IDB4MmQpIHsKICAgICAgICAgIGlmIChpbkZERUYpIHsKICAgICAgICAgICAgaW5GREVGID0gZmFsc2U7CiAgICAgICAgICAgIGxhc3RFbmRmID0gaTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBjID0gY2FsbHN0YWNrLnBvcCgpOwogICAgICAgICAgICBpZiAoIXBjKSB7CiAgICAgICAgICAgICAgd2FybigiVFQ6IEVOREYgYmFkIHN0YWNrIik7CiAgICAgICAgICAgICAgdHRDb250ZXh0LmhpbnRzVmFsaWQgPSBmYWxzZTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY0lkID0gZnVuY3Rpb25zQ2FsbGVkLnBvcCgpOwogICAgICAgICAgICBkYXRhID0gcGMuZGF0YTsKICAgICAgICAgICAgaSA9IHBjLmk7CiAgICAgICAgICAgIHR0Q29udGV4dC5mdW5jdGlvbnNTdGFja0RlbHRhc1tmdW5jSWRdID0gc3RhY2subGVuZ3RoIC0gcGMuc3RhY2tUb3A7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHg4OSkgewogICAgICAgICAgaWYgKGluRkRFRiB8fCBpbkVMU0UpIHsKICAgICAgICAgICAgd2FybigiVFQ6IG5lc3RlZCBJREVGcyBub3QgYWxsb3dlZCIpOwogICAgICAgICAgICB0b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnMgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaW5GREVGID0gdHJ1ZTsKICAgICAgICAgIGxhc3REZWZmID0gaTsKICAgICAgICB9IGVsc2UgaWYgKG9wID09PSAweDU4KSB7CiAgICAgICAgICArK2lmTGV2ZWw7CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHgxYikgewogICAgICAgICAgaW5FTFNFID0gaWZMZXZlbDsKICAgICAgICB9IGVsc2UgaWYgKG9wID09PSAweDU5KSB7CiAgICAgICAgICBpZiAoaW5FTFNFID09PSBpZkxldmVsKSB7CiAgICAgICAgICAgIGluRUxTRSA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICAtLWlmTGV2ZWw7CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHgxYykgewogICAgICAgICAgaWYgKCFpbkZERUYgJiYgIWluRUxTRSkgewogICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBzdGFjay5hdCgtMSk7CiAgICAgICAgICAgIGlmIChvZmZzZXQgPiAwKSB7CiAgICAgICAgICAgICAgaSArPSBvZmZzZXQgLSAxOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghaW5GREVGICYmICFpbkVMU0UpIHsKICAgICAgICAgIGxldCBzdGFja0RlbHRhID0gMDsKICAgICAgICAgIGlmIChvcCA8PSAweDhlKSB7CiAgICAgICAgICAgIHN0YWNrRGVsdGEgPSBUVE9wc1N0YWNrRGVsdGFzW29wXTsKICAgICAgICAgIH0gZWxzZSBpZiAob3AgPj0gMHhjMCAmJiBvcCA8PSAweGRmKSB7CiAgICAgICAgICAgIHN0YWNrRGVsdGEgPSAtMTsKICAgICAgICAgIH0gZWxzZSBpZiAob3AgPj0gMHhlMCkgewogICAgICAgICAgICBzdGFja0RlbHRhID0gLTI7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAob3AgPj0gMHg3MSAmJiBvcCA8PSAweDc1KSB7CiAgICAgICAgICAgIG4gPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgaWYgKCFpc05hTihuKSkgewogICAgICAgICAgICAgIHN0YWNrRGVsdGEgPSAtbiAqIDI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHdoaWxlIChzdGFja0RlbHRhIDwgMCAmJiBzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgICBzdGFja0RlbHRhKys7CiAgICAgICAgICB9CiAgICAgICAgICB3aGlsZSAoc3RhY2tEZWx0YSA+IDApIHsKICAgICAgICAgICAgc3RhY2sucHVzaChOYU4pOwogICAgICAgICAgICBzdGFja0RlbHRhLS07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHR0Q29udGV4dC50b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnMgPSB0b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnM7CiAgICAgIGNvbnN0IGNvbnRlbnQgPSBbZGF0YV07CiAgICAgIGlmIChpID4gZGF0YS5sZW5ndGgpIHsKICAgICAgICBjb250ZW50LnB1c2gobmV3IFVpbnQ4QXJyYXkoaSAtIGRhdGEubGVuZ3RoKSk7CiAgICAgIH0KICAgICAgaWYgKGxhc3REZWZmID4gbGFzdEVuZGYpIHsKICAgICAgICB3YXJuKCJUVDogY29tcGxlbWVudGluZyBhIG1pc3NpbmcgZnVuY3Rpb24gdGFpbCIpOwogICAgICAgIGNvbnRlbnQucHVzaChuZXcgVWludDhBcnJheShbMHgyMiwgMHgyZF0pKTsKICAgICAgfQogICAgICBmb2xkVFRUYWJsZSh0YWJsZSwgY29udGVudCk7CiAgICB9CiAgICBmdW5jdGlvbiBjaGVja0ludmFsaWRGdW5jdGlvbnModHRDb250ZXh0LCBtYXhGdW5jdGlvbkRlZnMpIHsKICAgICAgaWYgKHR0Q29udGV4dC50b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHR0Q29udGV4dC5mdW5jdGlvbnNEZWZpbmVkLmxlbmd0aCA+IG1heEZ1bmN0aW9uRGVmcykgewogICAgICAgIHdhcm4oIlRUOiBtb3JlIGZ1bmN0aW9ucyBkZWZpbmVkIHRoYW4gZXhwZWN0ZWQiKTsKICAgICAgICB0dENvbnRleHQuaGludHNWYWxpZCA9IGZhbHNlOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBmb3IgKGxldCBqID0gMCwgamogPSB0dENvbnRleHQuZnVuY3Rpb25zVXNlZC5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgaWYgKGogPiBtYXhGdW5jdGlvbkRlZnMpIHsKICAgICAgICAgIHdhcm4oIlRUOiBpbnZhbGlkIGZ1bmN0aW9uIGlkOiAiICsgaik7CiAgICAgICAgICB0dENvbnRleHQuaGludHNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAodHRDb250ZXh0LmZ1bmN0aW9uc1VzZWRbal0gJiYgIXR0Q29udGV4dC5mdW5jdGlvbnNEZWZpbmVkW2pdKSB7CiAgICAgICAgICB3YXJuKCJUVDogdW5kZWZpbmVkIGZ1bmN0aW9uOiAiICsgaik7CiAgICAgICAgICB0dENvbnRleHQuaGludHNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gZm9sZFRUVGFibGUodGFibGUsIGNvbnRlbnQpIHsKICAgICAgaWYgKGNvbnRlbnQubGVuZ3RoID4gMSkgewogICAgICAgIGxldCBuZXdMZW5ndGggPSAwOwogICAgICAgIGxldCBqLCBqajsKICAgICAgICBmb3IgKGogPSAwLCBqaiA9IGNvbnRlbnQubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgbmV3TGVuZ3RoICs9IGNvbnRlbnRbal0ubGVuZ3RoOwogICAgICAgIH0KICAgICAgICBuZXdMZW5ndGggPSBuZXdMZW5ndGggKyAzICYgfjM7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkobmV3TGVuZ3RoKTsKICAgICAgICBsZXQgcG9zID0gMDsKICAgICAgICBmb3IgKGogPSAwLCBqaiA9IGNvbnRlbnQubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgcmVzdWx0LnNldChjb250ZW50W2pdLCBwb3MpOwogICAgICAgICAgcG9zICs9IGNvbnRlbnRbal0ubGVuZ3RoOwogICAgICAgIH0KICAgICAgICB0YWJsZS5kYXRhID0gcmVzdWx0OwogICAgICAgIHRhYmxlLmxlbmd0aCA9IG5ld0xlbmd0aDsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc2FuaXRpemVUVFByb2dyYW1zKGZwZ20sIHByZXAsIGN2dCwgbWF4RnVuY3Rpb25EZWZzKSB7CiAgICAgIGNvbnN0IHR0Q29udGV4dCA9IHsKICAgICAgICBmdW5jdGlvbnNEZWZpbmVkOiBbXSwKICAgICAgICBmdW5jdGlvbnNVc2VkOiBbXSwKICAgICAgICBmdW5jdGlvbnNTdGFja0RlbHRhczogW10sCiAgICAgICAgdG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zOiBmYWxzZSwKICAgICAgICBoaW50c1ZhbGlkOiB0cnVlCiAgICAgIH07CiAgICAgIGlmIChmcGdtKSB7CiAgICAgICAgc2FuaXRpemVUVFByb2dyYW0oZnBnbSwgdHRDb250ZXh0KTsKICAgICAgfQogICAgICBpZiAocHJlcCkgewogICAgICAgIHNhbml0aXplVFRQcm9ncmFtKHByZXAsIHR0Q29udGV4dCk7CiAgICAgIH0KICAgICAgaWYgKGZwZ20pIHsKICAgICAgICBjaGVja0ludmFsaWRGdW5jdGlvbnModHRDb250ZXh0LCBtYXhGdW5jdGlvbkRlZnMpOwogICAgICB9CiAgICAgIGlmIChjdnQgJiYgY3Z0Lmxlbmd0aCAmIDEpIHsKICAgICAgICBjb25zdCBjdnREYXRhID0gbmV3IFVpbnQ4QXJyYXkoY3Z0Lmxlbmd0aCArIDEpOwogICAgICAgIGN2dERhdGEuc2V0KGN2dC5kYXRhKTsKICAgICAgICBjdnQuZGF0YSA9IGN2dERhdGE7CiAgICAgIH0KICAgICAgcmV0dXJuIHR0Q29udGV4dC5oaW50c1ZhbGlkOwogICAgfQogICAgZm9udCA9IG5ldyBTdHJlYW0obmV3IFVpbnQ4QXJyYXkoZm9udC5nZXRCeXRlcygpKSk7CiAgICBsZXQgaGVhZGVyLCB0YWJsZXM7CiAgICBpZiAoaXNUcnVlVHlwZUNvbGxlY3Rpb25GaWxlKGZvbnQpKSB7CiAgICAgIGNvbnN0IHR0Y0RhdGEgPSByZWFkVHJ1ZVR5cGVDb2xsZWN0aW9uRGF0YShmb250LCB0aGlzLm5hbWUpOwogICAgICBoZWFkZXIgPSB0dGNEYXRhLmhlYWRlcjsKICAgICAgdGFibGVzID0gdHRjRGF0YS50YWJsZXM7CiAgICB9IGVsc2UgewogICAgICBoZWFkZXIgPSByZWFkT3BlblR5cGVIZWFkZXIoZm9udCk7CiAgICAgIHRhYmxlcyA9IHJlYWRUYWJsZXMoZm9udCwgaGVhZGVyLm51bVRhYmxlcyk7CiAgICB9CiAgICBsZXQgY2ZmLCBjZmZGaWxlOwogICAgY29uc3QgaXNUcnVlVHlwZSA9ICF0YWJsZXNbIkNGRiAiXTsKICAgIGlmICghaXNUcnVlVHlwZSkgewogICAgICBjb25zdCBpc0NvbXBvc2l0ZSA9IHByb3BlcnRpZXMuY29tcG9zaXRlICYmIChwcm9wZXJ0aWVzLmNpZFRvR2lkTWFwPy5sZW5ndGggPiAwIHx8ICEocHJvcGVydGllcy5jTWFwIGluc3RhbmNlb2YgSWRlbnRpdHlDTWFwKSk7CiAgICAgIGlmIChoZWFkZXIudmVyc2lvbiA9PT0gIk9UVE8iICYmICFpc0NvbXBvc2l0ZSB8fCAhdGFibGVzLmhlYWQgfHwgIXRhYmxlcy5oaGVhIHx8ICF0YWJsZXMubWF4cCB8fCAhdGFibGVzLnBvc3QpIHsKICAgICAgICBjZmZGaWxlID0gbmV3IFN0cmVhbSh0YWJsZXNbIkNGRiAiXS5kYXRhKTsKICAgICAgICBjZmYgPSBuZXcgQ0ZGRm9udChjZmZGaWxlLCBwcm9wZXJ0aWVzKTsKICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0KG5hbWUsIGNmZiwgcHJvcGVydGllcyk7CiAgICAgIH0KICAgICAgZGVsZXRlIHRhYmxlcy5nbHlmOwogICAgICBkZWxldGUgdGFibGVzLmxvY2E7CiAgICAgIGRlbGV0ZSB0YWJsZXMuZnBnbTsKICAgICAgZGVsZXRlIHRhYmxlcy5wcmVwOwogICAgICBkZWxldGUgdGFibGVzWyJjdnQgIl07CiAgICAgIHRoaXMuaXNPcGVuVHlwZSA9IHRydWU7CiAgICB9IGVsc2UgewogICAgICBpZiAoIXRhYmxlcy5sb2NhKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCdSZXF1aXJlZCAibG9jYSIgdGFibGUgaXMgbm90IGZvdW5kJyk7CiAgICAgIH0KICAgICAgaWYgKCF0YWJsZXMuZ2x5ZikgewogICAgICAgIHdhcm4oJ1JlcXVpcmVkICJnbHlmIiB0YWJsZSBpcyBub3QgZm91bmQgLS0gdHJ5aW5nIHRvIHJlY292ZXIuJyk7CiAgICAgICAgdGFibGVzLmdseWYgPSB7CiAgICAgICAgICB0YWc6ICJnbHlmIiwKICAgICAgICAgIGRhdGE6IG5ldyBVaW50OEFycmF5KDApCiAgICAgICAgfTsKICAgICAgfQogICAgICB0aGlzLmlzT3BlblR5cGUgPSBmYWxzZTsKICAgIH0KICAgIGlmICghdGFibGVzLm1heHApIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCdSZXF1aXJlZCAibWF4cCIgdGFibGUgaXMgbm90IGZvdW5kJyk7CiAgICB9CiAgICBmb250LnBvcyA9IChmb250LnN0YXJ0IHx8IDApICsgdGFibGVzLm1heHAub2Zmc2V0OwogICAgbGV0IHZlcnNpb24gPSBmb250LmdldEludDMyKCk7CiAgICBjb25zdCBudW1HbHlwaHMgPSBmb250LmdldFVpbnQxNigpOwogICAgaWYgKHZlcnNpb24gIT09IDB4MDAwMTAwMDAgJiYgdmVyc2lvbiAhPT0gMHgwMDAwNTAwMCkgewogICAgICBpZiAodGFibGVzLm1heHAubGVuZ3RoID09PSA2KSB7CiAgICAgICAgdmVyc2lvbiA9IDB4MDAwNTAwMDsKICAgICAgfSBlbHNlIGlmICh0YWJsZXMubWF4cC5sZW5ndGggPj0gMzIpIHsKICAgICAgICB2ZXJzaW9uID0gMHgwMDAxMDAwMDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYCJtYXhwIiB0YWJsZSBoYXMgYSB3cm9uZyB2ZXJzaW9uIG51bWJlcmApOwogICAgICB9CiAgICAgIHdyaXRlVWludDMyKHRhYmxlcy5tYXhwLmRhdGEsIDAsIHZlcnNpb24pOwogICAgfQogICAgaWYgKHByb3BlcnRpZXMuc2NhbGVGYWN0b3JzPy5sZW5ndGggPT09IG51bUdseXBocyAmJiBpc1RydWVUeXBlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBzY2FsZUZhY3RvcnMKICAgICAgfSA9IHByb3BlcnRpZXM7CiAgICAgIGNvbnN0IGlzR2x5cGhMb2NhdGlvbnNMb25nID0gaW50MTYodGFibGVzLmhlYWQuZGF0YVs1MF0sIHRhYmxlcy5oZWFkLmRhdGFbNTFdKTsKICAgICAgY29uc3QgZ2x5cGhzID0gbmV3IEdseWZUYWJsZSh7CiAgICAgICAgZ2x5ZlRhYmxlOiB0YWJsZXMuZ2x5Zi5kYXRhLAogICAgICAgIGlzR2x5cGhMb2NhdGlvbnNMb25nLAogICAgICAgIGxvY2FUYWJsZTogdGFibGVzLmxvY2EuZGF0YSwKICAgICAgICBudW1HbHlwaHMKICAgICAgfSk7CiAgICAgIGdseXBocy5zY2FsZShzY2FsZUZhY3RvcnMpOwogICAgICBjb25zdCB7CiAgICAgICAgZ2x5ZiwKICAgICAgICBsb2NhLAogICAgICAgIGlzTG9jYXRpb25Mb25nCiAgICAgIH0gPSBnbHlwaHMud3JpdGUoKTsKICAgICAgdGFibGVzLmdseWYuZGF0YSA9IGdseWY7CiAgICAgIHRhYmxlcy5sb2NhLmRhdGEgPSBsb2NhOwogICAgICBpZiAoaXNMb2NhdGlvbkxvbmcgIT09ICEhaXNHbHlwaExvY2F0aW9uc0xvbmcpIHsKICAgICAgICB0YWJsZXMuaGVhZC5kYXRhWzUwXSA9IDA7CiAgICAgICAgdGFibGVzLmhlYWQuZGF0YVs1MV0gPSBpc0xvY2F0aW9uTG9uZyA/IDEgOiAwOwogICAgICB9CiAgICAgIGNvbnN0IG1ldHJpY3MgPSB0YWJsZXMuaG10eC5kYXRhOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUdseXBoczsgaSsrKSB7CiAgICAgICAgY29uc3QgaiA9IDQgKiBpOwogICAgICAgIGNvbnN0IGFkdmFuY2VXaWR0aCA9IE1hdGgucm91bmQoc2NhbGVGYWN0b3JzW2ldICogaW50MTYobWV0cmljc1tqXSwgbWV0cmljc1tqICsgMV0pKTsKICAgICAgICBtZXRyaWNzW2pdID0gYWR2YW5jZVdpZHRoID4+IDggJiAweGZmOwogICAgICAgIG1ldHJpY3NbaiArIDFdID0gYWR2YW5jZVdpZHRoICYgMHhmZjsKICAgICAgICBjb25zdCBsc2IgPSBNYXRoLnJvdW5kKHNjYWxlRmFjdG9yc1tpXSAqIHNpZ25lZEludDE2KG1ldHJpY3NbaiArIDJdLCBtZXRyaWNzW2ogKyAzXSkpOwogICAgICAgIHdyaXRlU2lnbmVkSW50MTYobWV0cmljcywgaiArIDIsIGxzYik7CiAgICAgIH0KICAgIH0KICAgIGxldCBudW1HbHlwaHNPdXQgPSBudW1HbHlwaHMgKyAxOwogICAgbGV0IGR1cEZpcnN0RW50cnkgPSB0cnVlOwogICAgaWYgKG51bUdseXBoc091dCA+IDB4ZmZmZikgewogICAgICBkdXBGaXJzdEVudHJ5ID0gZmFsc2U7CiAgICAgIG51bUdseXBoc091dCA9IG51bUdseXBoczsKICAgICAgd2FybigiTm90IGVub3VnaCBzcGFjZSBpbiBnbHlmcyB0byBkdXBsaWNhdGUgZmlyc3QgZ2x5cGguIik7CiAgICB9CiAgICBsZXQgbWF4RnVuY3Rpb25EZWZzID0gMDsKICAgIGxldCBtYXhTaXplT2ZJbnN0cnVjdGlvbnMgPSAwOwogICAgaWYgKHZlcnNpb24gPj0gMHgwMDAxMDAwMCAmJiB0YWJsZXMubWF4cC5sZW5ndGggPj0gMzIpIHsKICAgICAgZm9udC5wb3MgKz0gODsKICAgICAgY29uc3QgbWF4Wm9uZXMgPSBmb250LmdldFVpbnQxNigpOwogICAgICBpZiAobWF4Wm9uZXMgPiAyKSB7CiAgICAgICAgdGFibGVzLm1heHAuZGF0YVsxNF0gPSAwOwogICAgICAgIHRhYmxlcy5tYXhwLmRhdGFbMTVdID0gMjsKICAgICAgfQogICAgICBmb250LnBvcyArPSA0OwogICAgICBtYXhGdW5jdGlvbkRlZnMgPSBmb250LmdldFVpbnQxNigpOwogICAgICBmb250LnBvcyArPSA0OwogICAgICBtYXhTaXplT2ZJbnN0cnVjdGlvbnMgPSBmb250LmdldFVpbnQxNigpOwogICAgfQogICAgdGFibGVzLm1heHAuZGF0YVs0XSA9IG51bUdseXBoc091dCA+PiA4OwogICAgdGFibGVzLm1heHAuZGF0YVs1XSA9IG51bUdseXBoc091dCAmIDI1NTsKICAgIGNvbnN0IGhpbnRzVmFsaWQgPSBzYW5pdGl6ZVRUUHJvZ3JhbXModGFibGVzLmZwZ20sIHRhYmxlcy5wcmVwLCB0YWJsZXNbImN2dCAiXSwgbWF4RnVuY3Rpb25EZWZzKTsKICAgIGlmICghaGludHNWYWxpZCkgewogICAgICBkZWxldGUgdGFibGVzLmZwZ207CiAgICAgIGRlbGV0ZSB0YWJsZXMucHJlcDsKICAgICAgZGVsZXRlIHRhYmxlc1siY3Z0ICJdOwogICAgfQogICAgc2FuaXRpemVNZXRyaWNzKGZvbnQsIHRhYmxlcy5oaGVhLCB0YWJsZXMuaG10eCwgdGFibGVzLmhlYWQsIG51bUdseXBoc091dCwgZHVwRmlyc3RFbnRyeSk7CiAgICBpZiAoIXRhYmxlcy5oZWFkKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcignUmVxdWlyZWQgImhlYWQiIHRhYmxlIGlzIG5vdCBmb3VuZCcpOwogICAgfQogICAgc2FuaXRpemVIZWFkKHRhYmxlcy5oZWFkLCBudW1HbHlwaHMsIGlzVHJ1ZVR5cGUgPyB0YWJsZXMubG9jYS5sZW5ndGggOiAwKTsKICAgIGxldCBtaXNzaW5nR2x5cGhzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGlmIChpc1RydWVUeXBlKSB7CiAgICAgIGNvbnN0IGlzR2x5cGhMb2NhdGlvbnNMb25nID0gaW50MTYodGFibGVzLmhlYWQuZGF0YVs1MF0sIHRhYmxlcy5oZWFkLmRhdGFbNTFdKTsKICAgICAgY29uc3QgZ2x5cGhzSW5mbyA9IHNhbml0aXplR2x5cGhMb2NhdGlvbnModGFibGVzLmxvY2EsIHRhYmxlcy5nbHlmLCBudW1HbHlwaHMsIGlzR2x5cGhMb2NhdGlvbnNMb25nLCBoaW50c1ZhbGlkLCBkdXBGaXJzdEVudHJ5LCBtYXhTaXplT2ZJbnN0cnVjdGlvbnMpOwogICAgICBtaXNzaW5nR2x5cGhzID0gZ2x5cGhzSW5mby5taXNzaW5nR2x5cGhzOwogICAgICBpZiAodmVyc2lvbiA+PSAweDAwMDEwMDAwICYmIHRhYmxlcy5tYXhwLmxlbmd0aCA+PSAzMikgewogICAgICAgIHRhYmxlcy5tYXhwLmRhdGFbMjZdID0gZ2x5cGhzSW5mby5tYXhTaXplT2ZJbnN0cnVjdGlvbnMgPj4gODsKICAgICAgICB0YWJsZXMubWF4cC5kYXRhWzI3XSA9IGdseXBoc0luZm8ubWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zICYgMjU1OwogICAgICB9CiAgICB9CiAgICBpZiAoIXRhYmxlcy5oaGVhKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcignUmVxdWlyZWQgImhoZWEiIHRhYmxlIGlzIG5vdCBmb3VuZCcpOwogICAgfQogICAgaWYgKHRhYmxlcy5oaGVhLmRhdGFbMTBdID09PSAwICYmIHRhYmxlcy5oaGVhLmRhdGFbMTFdID09PSAwKSB7CiAgICAgIHRhYmxlcy5oaGVhLmRhdGFbMTBdID0gMHhmZjsKICAgICAgdGFibGVzLmhoZWEuZGF0YVsxMV0gPSAweGZmOwogICAgfQogICAgY29uc3QgbWV0cmljc092ZXJyaWRlID0gewogICAgICB1bml0c1BlckVtOiBpbnQxNih0YWJsZXMuaGVhZC5kYXRhWzE4XSwgdGFibGVzLmhlYWQuZGF0YVsxOV0pLAogICAgICB5TWF4OiBzaWduZWRJbnQxNih0YWJsZXMuaGVhZC5kYXRhWzQyXSwgdGFibGVzLmhlYWQuZGF0YVs0M10pLAogICAgICB5TWluOiBzaWduZWRJbnQxNih0YWJsZXMuaGVhZC5kYXRhWzM4XSwgdGFibGVzLmhlYWQuZGF0YVszOV0pLAogICAgICBhc2NlbnQ6IHNpZ25lZEludDE2KHRhYmxlcy5oaGVhLmRhdGFbNF0sIHRhYmxlcy5oaGVhLmRhdGFbNV0pLAogICAgICBkZXNjZW50OiBzaWduZWRJbnQxNih0YWJsZXMuaGhlYS5kYXRhWzZdLCB0YWJsZXMuaGhlYS5kYXRhWzddKSwKICAgICAgbGluZUdhcDogc2lnbmVkSW50MTYodGFibGVzLmhoZWEuZGF0YVs4XSwgdGFibGVzLmhoZWEuZGF0YVs5XSkKICAgIH07CiAgICB0aGlzLmFzY2VudCA9IG1ldHJpY3NPdmVycmlkZS5hc2NlbnQgLyBtZXRyaWNzT3ZlcnJpZGUudW5pdHNQZXJFbTsKICAgIHRoaXMuZGVzY2VudCA9IG1ldHJpY3NPdmVycmlkZS5kZXNjZW50IC8gbWV0cmljc092ZXJyaWRlLnVuaXRzUGVyRW07CiAgICB0aGlzLmxpbmVHYXAgPSBtZXRyaWNzT3ZlcnJpZGUubGluZUdhcCAvIG1ldHJpY3NPdmVycmlkZS51bml0c1BlckVtOwogICAgaWYgKHRoaXMuY3NzRm9udEluZm8/LmxpbmVIZWlnaHQpIHsKICAgICAgdGhpcy5saW5lSGVpZ2h0ID0gdGhpcy5jc3NGb250SW5mby5tZXRyaWNzLmxpbmVIZWlnaHQ7CiAgICAgIHRoaXMubGluZUdhcCA9IHRoaXMuY3NzRm9udEluZm8ubWV0cmljcy5saW5lR2FwOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5saW5lSGVpZ2h0ID0gdGhpcy5hc2NlbnQgLSB0aGlzLmRlc2NlbnQgKyB0aGlzLmxpbmVHYXA7CiAgICB9CiAgICBpZiAodGFibGVzLnBvc3QpIHsKICAgICAgcmVhZFBvc3RTY3JpcHRUYWJsZSh0YWJsZXMucG9zdCwgcHJvcGVydGllcywgbnVtR2x5cGhzKTsKICAgIH0KICAgIHRhYmxlcy5wb3N0ID0gewogICAgICB0YWc6ICJwb3N0IiwKICAgICAgZGF0YTogY3JlYXRlUG9zdFRhYmxlKHByb3BlcnRpZXMpCiAgICB9OwogICAgY29uc3QgY2hhckNvZGVUb0dseXBoSWQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgZnVuY3Rpb24gaGFzR2x5cGgoZ2x5cGhJZCkgewogICAgICByZXR1cm4gIW1pc3NpbmdHbHlwaHNbZ2x5cGhJZF07CiAgICB9CiAgICBpZiAocHJvcGVydGllcy5jb21wb3NpdGUpIHsKICAgICAgY29uc3QgY2lkVG9HaWRNYXAgPSBwcm9wZXJ0aWVzLmNpZFRvR2lkTWFwIHx8IFtdOwogICAgICBjb25zdCBpc0NpZFRvR2lkTWFwRW1wdHkgPSBjaWRUb0dpZE1hcC5sZW5ndGggPT09IDA7CiAgICAgIHByb3BlcnRpZXMuY01hcC5mb3JFYWNoKGZ1bmN0aW9uIChjaGFyQ29kZSwgY2lkKSB7CiAgICAgICAgaWYgKHR5cGVvZiBjaWQgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICBjaWQgPSBjb252ZXJ0Q2lkU3RyaW5nKGNoYXJDb2RlLCBjaWQsIHRydWUpOwogICAgICAgIH0KICAgICAgICBpZiAoY2lkID4gMHhmZmZmKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIk1heCBzaXplIG9mIENJRCBpcyA2NSw1MzUiKTsKICAgICAgICB9CiAgICAgICAgbGV0IGdseXBoSWQgPSAtMTsKICAgICAgICBpZiAoaXNDaWRUb0dpZE1hcEVtcHR5KSB7CiAgICAgICAgICBnbHlwaElkID0gY2lkOwogICAgICAgIH0gZWxzZSBpZiAoY2lkVG9HaWRNYXBbY2lkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBnbHlwaElkID0gY2lkVG9HaWRNYXBbY2lkXTsKICAgICAgICB9CiAgICAgICAgaWYgKGdseXBoSWQgPj0gMCAmJiBnbHlwaElkIDwgbnVtR2x5cGhzICYmIGhhc0dseXBoKGdseXBoSWQpKSB7CiAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBjbWFwVGFibGUgPSByZWFkQ21hcFRhYmxlKHRhYmxlcy5jbWFwLCBmb250LCB0aGlzLmlzU3ltYm9saWNGb250LCBwcm9wZXJ0aWVzLmhhc0VuY29kaW5nKTsKICAgICAgY29uc3QgY21hcFBsYXRmb3JtSWQgPSBjbWFwVGFibGUucGxhdGZvcm1JZDsKICAgICAgY29uc3QgY21hcEVuY29kaW5nSWQgPSBjbWFwVGFibGUuZW5jb2RpbmdJZDsKICAgICAgY29uc3QgY21hcE1hcHBpbmdzID0gY21hcFRhYmxlLm1hcHBpbmdzOwogICAgICBsZXQgYmFzZUVuY29kaW5nID0gW10sCiAgICAgICAgZm9yY2VQb3N0VGFibGUgPSBmYWxzZTsKICAgICAgaWYgKHByb3BlcnRpZXMuaGFzRW5jb2RpbmcgJiYgKHByb3BlcnRpZXMuYmFzZUVuY29kaW5nTmFtZSA9PT0gIk1hY1JvbWFuRW5jb2RpbmciIHx8IHByb3BlcnRpZXMuYmFzZUVuY29kaW5nTmFtZSA9PT0gIldpbkFuc2lFbmNvZGluZyIpKSB7CiAgICAgICAgYmFzZUVuY29kaW5nID0gZ2V0RW5jb2RpbmcocHJvcGVydGllcy5iYXNlRW5jb2RpbmdOYW1lKTsKICAgICAgfQogICAgICBpZiAocHJvcGVydGllcy5oYXNFbmNvZGluZyAmJiAhdGhpcy5pc1N5bWJvbGljRm9udCAmJiAoY21hcFBsYXRmb3JtSWQgPT09IDMgJiYgY21hcEVuY29kaW5nSWQgPT09IDEgfHwgY21hcFBsYXRmb3JtSWQgPT09IDEgJiYgY21hcEVuY29kaW5nSWQgPT09IDApKSB7CiAgICAgICAgY29uc3QgZ2x5cGhzVW5pY29kZU1hcCA9IGdldEdseXBoc1VuaWNvZGUoKTsKICAgICAgICBmb3IgKGxldCBjaGFyQ29kZSA9IDA7IGNoYXJDb2RlIDwgMjU2OyBjaGFyQ29kZSsrKSB7CiAgICAgICAgICBsZXQgZ2x5cGhOYW1lOwogICAgICAgICAgaWYgKHRoaXMuZGlmZmVyZW5jZXNbY2hhckNvZGVdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgZ2x5cGhOYW1lID0gdGhpcy5kaWZmZXJlbmNlc1tjaGFyQ29kZV07CiAgICAgICAgICB9IGVsc2UgaWYgKGJhc2VFbmNvZGluZy5sZW5ndGggJiYgYmFzZUVuY29kaW5nW2NoYXJDb2RlXSAhPT0gIiIpIHsKICAgICAgICAgICAgZ2x5cGhOYW1lID0gYmFzZUVuY29kaW5nW2NoYXJDb2RlXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGdseXBoTmFtZSA9IFN0YW5kYXJkRW5jb2RpbmdbY2hhckNvZGVdOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFnbHlwaE5hbWUpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBzdGFuZGFyZEdseXBoTmFtZSA9IHJlY292ZXJHbHlwaE5hbWUoZ2x5cGhOYW1lLCBnbHlwaHNVbmljb2RlTWFwKTsKICAgICAgICAgIGxldCB1bmljb2RlT3JDaGFyQ29kZTsKICAgICAgICAgIGlmIChjbWFwUGxhdGZvcm1JZCA9PT0gMyAmJiBjbWFwRW5jb2RpbmdJZCA9PT0gMSkgewogICAgICAgICAgICB1bmljb2RlT3JDaGFyQ29kZSA9IGdseXBoc1VuaWNvZGVNYXBbc3RhbmRhcmRHbHlwaE5hbWVdOwogICAgICAgICAgfSBlbHNlIGlmIChjbWFwUGxhdGZvcm1JZCA9PT0gMSAmJiBjbWFwRW5jb2RpbmdJZCA9PT0gMCkgewogICAgICAgICAgICB1bmljb2RlT3JDaGFyQ29kZSA9IE1hY1JvbWFuRW5jb2RpbmcuaW5kZXhPZihzdGFuZGFyZEdseXBoTmFtZSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodW5pY29kZU9yQ2hhckNvZGUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZiAoIXByb3BlcnRpZXMuZ2x5cGhOYW1lcyAmJiBwcm9wZXJ0aWVzLmhhc0luY2x1ZGVkVG9Vbmljb2RlTWFwICYmICEodGhpcy50b1VuaWNvZGUgaW5zdGFuY2VvZiBJZGVudGl0eVRvVW5pY29kZU1hcCkpIHsKICAgICAgICAgICAgICBjb25zdCB1bmljb2RlID0gdGhpcy50b1VuaWNvZGUuZ2V0KGNoYXJDb2RlKTsKICAgICAgICAgICAgICBpZiAodW5pY29kZSkgewogICAgICAgICAgICAgICAgdW5pY29kZU9yQ2hhckNvZGUgPSB1bmljb2RlLmNvZGVQb2ludEF0KDApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodW5pY29kZU9yQ2hhckNvZGUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKGNvbnN0IG1hcHBpbmcgb2YgY21hcE1hcHBpbmdzKSB7CiAgICAgICAgICAgIGlmIChtYXBwaW5nLmNoYXJDb2RlICE9PSB1bmljb2RlT3JDaGFyQ29kZSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IG1hcHBpbmcuZ2x5cGhJZDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGNtYXBQbGF0Zm9ybUlkID09PSAwKSB7CiAgICAgICAgZm9yIChjb25zdCBtYXBwaW5nIG9mIGNtYXBNYXBwaW5ncykgewogICAgICAgICAgY2hhckNvZGVUb0dseXBoSWRbbWFwcGluZy5jaGFyQ29kZV0gPSBtYXBwaW5nLmdseXBoSWQ7CiAgICAgICAgfQogICAgICAgIGZvcmNlUG9zdFRhYmxlID0gdHJ1ZTsKICAgICAgfSBlbHNlIGlmIChjbWFwUGxhdGZvcm1JZCA9PT0gMyAmJiBjbWFwRW5jb2RpbmdJZCA9PT0gMCkgewogICAgICAgIGZvciAoY29uc3QgbWFwcGluZyBvZiBjbWFwTWFwcGluZ3MpIHsKICAgICAgICAgIGxldCBjaGFyQ29kZSA9IG1hcHBpbmcuY2hhckNvZGU7CiAgICAgICAgICBpZiAoY2hhckNvZGUgPj0gMHhmMDAwICYmIGNoYXJDb2RlIDw9IDB4ZjBmZikgewogICAgICAgICAgICBjaGFyQ29kZSAmPSAweGZmOwogICAgICAgICAgfQogICAgICAgICAgY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdID0gbWFwcGluZy5nbHlwaElkOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKGNvbnN0IG1hcHBpbmcgb2YgY21hcE1hcHBpbmdzKSB7CiAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFttYXBwaW5nLmNoYXJDb2RlXSA9IG1hcHBpbmcuZ2x5cGhJZDsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHByb3BlcnRpZXMuZ2x5cGhOYW1lcyAmJiAoYmFzZUVuY29kaW5nLmxlbmd0aCB8fCB0aGlzLmRpZmZlcmVuY2VzLmxlbmd0aCkpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI1NjsgKytpKSB7CiAgICAgICAgICBpZiAoIWZvcmNlUG9zdFRhYmxlICYmIGNoYXJDb2RlVG9HbHlwaElkW2ldICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBnbHlwaE5hbWUgPSB0aGlzLmRpZmZlcmVuY2VzW2ldIHx8IGJhc2VFbmNvZGluZ1tpXTsKICAgICAgICAgIGlmICghZ2x5cGhOYW1lKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgZ2x5cGhJZCA9IHByb3BlcnRpZXMuZ2x5cGhOYW1lcy5pbmRleE9mKGdseXBoTmFtZSk7CiAgICAgICAgICBpZiAoZ2x5cGhJZCA+IDAgJiYgaGFzR2x5cGgoZ2x5cGhJZCkpIHsKICAgICAgICAgICAgY2hhckNvZGVUb0dseXBoSWRbaV0gPSBnbHlwaElkOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKGNoYXJDb2RlVG9HbHlwaElkLmxlbmd0aCA9PT0gMCkgewogICAgICBjaGFyQ29kZVRvR2x5cGhJZFswXSA9IDA7CiAgICB9CiAgICBsZXQgZ2x5cGhaZXJvSWQgPSBudW1HbHlwaHNPdXQgLSAxOwogICAgaWYgKCFkdXBGaXJzdEVudHJ5KSB7CiAgICAgIGdseXBoWmVyb0lkID0gMDsKICAgIH0KICAgIGlmICghcHJvcGVydGllcy5jc3NGb250SW5mbykgewogICAgICBjb25zdCBuZXdNYXBwaW5nID0gYWRqdXN0TWFwcGluZyhjaGFyQ29kZVRvR2x5cGhJZCwgaGFzR2x5cGgsIGdseXBoWmVyb0lkLCB0aGlzLnRvVW5pY29kZSk7CiAgICAgIHRoaXMudG9Gb250Q2hhciA9IG5ld01hcHBpbmcudG9Gb250Q2hhcjsKICAgICAgdGFibGVzLmNtYXAgPSB7CiAgICAgICAgdGFnOiAiY21hcCIsCiAgICAgICAgZGF0YTogY3JlYXRlQ21hcFRhYmxlKG5ld01hcHBpbmcuY2hhckNvZGVUb0dseXBoSWQsIG5ld01hcHBpbmcudG9Vbmljb2RlRXh0cmFNYXAsIG51bUdseXBoc091dCkKICAgICAgfTsKICAgICAgaWYgKCF0YWJsZXNbIk9TLzIiXSB8fCAhdmFsaWRhdGVPUzJUYWJsZSh0YWJsZXNbIk9TLzIiXSwgZm9udCkpIHsKICAgICAgICB0YWJsZXNbIk9TLzIiXSA9IHsKICAgICAgICAgIHRhZzogIk9TLzIiLAogICAgICAgICAgZGF0YTogY3JlYXRlT1MyVGFibGUocHJvcGVydGllcywgbmV3TWFwcGluZy5jaGFyQ29kZVRvR2x5cGhJZCwgbWV0cmljc092ZXJyaWRlKQogICAgICAgIH07CiAgICAgIH0KICAgIH0KICAgIGlmICghaXNUcnVlVHlwZSkgewogICAgICB0cnkgewogICAgICAgIGNmZkZpbGUgPSBuZXcgU3RyZWFtKHRhYmxlc1siQ0ZGICJdLmRhdGEpOwogICAgICAgIGNvbnN0IHBhcnNlciA9IG5ldyBDRkZQYXJzZXIoY2ZmRmlsZSwgcHJvcGVydGllcywgU0VBQ19BTkFMWVNJU19FTkFCTEVEKTsKICAgICAgICBjZmYgPSBwYXJzZXIucGFyc2UoKTsKICAgICAgICBjZmYuZHVwbGljYXRlRmlyc3RHbHlwaCgpOwogICAgICAgIGNvbnN0IGNvbXBpbGVyID0gbmV3IENGRkNvbXBpbGVyKGNmZik7CiAgICAgICAgdGFibGVzWyJDRkYgIl0uZGF0YSA9IGNvbXBpbGVyLmNvbXBpbGUoKTsKICAgICAgfSBjYXRjaCB7CiAgICAgICAgd2FybigiRmFpbGVkIHRvIGNvbXBpbGUgZm9udCAiICsgcHJvcGVydGllcy5sb2FkZWROYW1lKTsKICAgICAgfQogICAgfQogICAgaWYgKCF0YWJsZXMubmFtZSkgewogICAgICB0YWJsZXMubmFtZSA9IHsKICAgICAgICB0YWc6ICJuYW1lIiwKICAgICAgICBkYXRhOiBjcmVhdGVOYW1lVGFibGUodGhpcy5uYW1lKQogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgW25hbWVQcm90b3R5cGUsIG5hbWVSZWNvcmRzXSA9IHJlYWROYW1lVGFibGUodGFibGVzLm5hbWUpOwogICAgICB0YWJsZXMubmFtZS5kYXRhID0gY3JlYXRlTmFtZVRhYmxlKG5hbWUsIG5hbWVQcm90b3R5cGUpOwogICAgICB0aGlzLnBzTmFtZSA9IG5hbWVQcm90b3R5cGVbMF1bNl0gfHwgbnVsbDsKICAgICAgaWYgKCFwcm9wZXJ0aWVzLmNvbXBvc2l0ZSkgewogICAgICAgIGFkanVzdFRydWVUeXBlVG9Vbmljb2RlKHByb3BlcnRpZXMsIHRoaXMuaXNTeW1ib2xpY0ZvbnQsIG5hbWVSZWNvcmRzKTsKICAgICAgfQogICAgfQogICAgY29uc3QgYnVpbGRlciA9IG5ldyBPcGVuVHlwZUZpbGVCdWlsZGVyKGhlYWRlci52ZXJzaW9uKTsKICAgIGZvciAoY29uc3QgdGFibGVUYWcgaW4gdGFibGVzKSB7CiAgICAgIGJ1aWxkZXIuYWRkVGFibGUodGFibGVUYWcsIHRhYmxlc1t0YWJsZVRhZ10uZGF0YSk7CiAgICB9CiAgICByZXR1cm4gYnVpbGRlci50b0FycmF5KCk7CiAgfQogIGNvbnZlcnQoZm9udE5hbWUsIGZvbnQsIHByb3BlcnRpZXMpIHsKICAgIHByb3BlcnRpZXMuZml4ZWRQaXRjaCA9IGZhbHNlOwogICAgaWYgKHByb3BlcnRpZXMuYnVpbHRJbkVuY29kaW5nKSB7CiAgICAgIGFkanVzdFR5cGUxVG9Vbmljb2RlKHByb3BlcnRpZXMsIHByb3BlcnRpZXMuYnVpbHRJbkVuY29kaW5nKTsKICAgIH0KICAgIGxldCBnbHlwaFplcm9JZCA9IDE7CiAgICBpZiAoZm9udCBpbnN0YW5jZW9mIENGRkZvbnQpIHsKICAgICAgZ2x5cGhaZXJvSWQgPSBmb250Lm51bUdseXBocyAtIDE7CiAgICB9CiAgICBjb25zdCBtYXBwaW5nID0gZm9udC5nZXRHbHlwaE1hcHBpbmcocHJvcGVydGllcyk7CiAgICBsZXQgbmV3TWFwcGluZyA9IG51bGw7CiAgICBsZXQgbmV3Q2hhckNvZGVUb0dseXBoSWQgPSBtYXBwaW5nOwogICAgbGV0IHRvVW5pY29kZUV4dHJhTWFwID0gbnVsbDsKICAgIGlmICghcHJvcGVydGllcy5jc3NGb250SW5mbykgewogICAgICBuZXdNYXBwaW5nID0gYWRqdXN0TWFwcGluZyhtYXBwaW5nLCBmb250Lmhhc0dseXBoSWQuYmluZChmb250KSwgZ2x5cGhaZXJvSWQsIHRoaXMudG9Vbmljb2RlKTsKICAgICAgdGhpcy50b0ZvbnRDaGFyID0gbmV3TWFwcGluZy50b0ZvbnRDaGFyOwogICAgICBuZXdDaGFyQ29kZVRvR2x5cGhJZCA9IG5ld01hcHBpbmcuY2hhckNvZGVUb0dseXBoSWQ7CiAgICAgIHRvVW5pY29kZUV4dHJhTWFwID0gbmV3TWFwcGluZy50b1VuaWNvZGVFeHRyYU1hcDsKICAgIH0KICAgIGNvbnN0IG51bUdseXBocyA9IGZvbnQubnVtR2x5cGhzOwogICAgZnVuY3Rpb24gZ2V0Q2hhckNvZGVzKGNoYXJDb2RlVG9HbHlwaElkLCBnbHlwaElkKSB7CiAgICAgIGxldCBjaGFyQ29kZXMgPSBudWxsOwogICAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIGNoYXJDb2RlVG9HbHlwaElkKSB7CiAgICAgICAgaWYgKGdseXBoSWQgPT09IGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSkgewogICAgICAgICAgKGNoYXJDb2RlcyB8fD0gW10pLnB1c2goY2hhckNvZGUgfCAwKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGNoYXJDb2RlczsKICAgIH0KICAgIGZ1bmN0aW9uIGNyZWF0ZUNoYXJDb2RlKGNoYXJDb2RlVG9HbHlwaElkLCBnbHlwaElkKSB7CiAgICAgIGZvciAoY29uc3QgY2hhckNvZGUgaW4gY2hhckNvZGVUb0dseXBoSWQpIHsKICAgICAgICBpZiAoZ2x5cGhJZCA9PT0gY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdKSB7CiAgICAgICAgICByZXR1cm4gY2hhckNvZGUgfCAwOwogICAgICAgIH0KICAgICAgfQogICAgICBuZXdNYXBwaW5nLmNoYXJDb2RlVG9HbHlwaElkW25ld01hcHBpbmcubmV4dEF2YWlsYWJsZUZvbnRDaGFyQ29kZV0gPSBnbHlwaElkOwogICAgICByZXR1cm4gbmV3TWFwcGluZy5uZXh0QXZhaWxhYmxlRm9udENoYXJDb2RlKys7CiAgICB9CiAgICBjb25zdCBzZWFjcyA9IGZvbnQuc2VhY3M7CiAgICBpZiAobmV3TWFwcGluZyAmJiBTRUFDX0FOQUxZU0lTX0VOQUJMRUQgJiYgc2VhY3M/Lmxlbmd0aCkgewogICAgICBjb25zdCBtYXRyaXggPSBwcm9wZXJ0aWVzLmZvbnRNYXRyaXggfHwgRk9OVF9JREVOVElUWV9NQVRSSVg7CiAgICAgIGNvbnN0IGNoYXJzZXQgPSBmb250LmdldENoYXJzZXQoKTsKICAgICAgY29uc3Qgc2VhY01hcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIGZvciAobGV0IGdseXBoSWQgaW4gc2VhY3MpIHsKICAgICAgICBnbHlwaElkIHw9IDA7CiAgICAgICAgY29uc3Qgc2VhYyA9IHNlYWNzW2dseXBoSWRdOwogICAgICAgIGNvbnN0IGJhc2VHbHlwaE5hbWUgPSBTdGFuZGFyZEVuY29kaW5nW3NlYWNbMl1dOwogICAgICAgIGNvbnN0IGFjY2VudEdseXBoTmFtZSA9IFN0YW5kYXJkRW5jb2Rpbmdbc2VhY1szXV07CiAgICAgICAgY29uc3QgYmFzZUdseXBoSWQgPSBjaGFyc2V0LmluZGV4T2YoYmFzZUdseXBoTmFtZSk7CiAgICAgICAgY29uc3QgYWNjZW50R2x5cGhJZCA9IGNoYXJzZXQuaW5kZXhPZihhY2NlbnRHbHlwaE5hbWUpOwogICAgICAgIGlmIChiYXNlR2x5cGhJZCA8IDAgfHwgYWNjZW50R2x5cGhJZCA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBhY2NlbnRPZmZzZXQgPSB7CiAgICAgICAgICB4OiBzZWFjWzBdICogbWF0cml4WzBdICsgc2VhY1sxXSAqIG1hdHJpeFsyXSArIG1hdHJpeFs0XSwKICAgICAgICAgIHk6IHNlYWNbMF0gKiBtYXRyaXhbMV0gKyBzZWFjWzFdICogbWF0cml4WzNdICsgbWF0cml4WzVdCiAgICAgICAgfTsKICAgICAgICBjb25zdCBjaGFyQ29kZXMgPSBnZXRDaGFyQ29kZXMobWFwcGluZywgZ2x5cGhJZCk7CiAgICAgICAgaWYgKCFjaGFyQ29kZXMpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIG9mIGNoYXJDb2RlcykgewogICAgICAgICAgY29uc3QgY2hhckNvZGVUb0dseXBoSWQgPSBuZXdNYXBwaW5nLmNoYXJDb2RlVG9HbHlwaElkOwogICAgICAgICAgY29uc3QgYmFzZUZvbnRDaGFyQ29kZSA9IGNyZWF0ZUNoYXJDb2RlKGNoYXJDb2RlVG9HbHlwaElkLCBiYXNlR2x5cGhJZCk7CiAgICAgICAgICBjb25zdCBhY2NlbnRGb250Q2hhckNvZGUgPSBjcmVhdGVDaGFyQ29kZShjaGFyQ29kZVRvR2x5cGhJZCwgYWNjZW50R2x5cGhJZCk7CiAgICAgICAgICBzZWFjTWFwW2NoYXJDb2RlXSA9IHsKICAgICAgICAgICAgYmFzZUZvbnRDaGFyQ29kZSwKICAgICAgICAgICAgYWNjZW50Rm9udENoYXJDb2RlLAogICAgICAgICAgICBhY2NlbnRPZmZzZXQKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CiAgICAgIHByb3BlcnRpZXMuc2VhY01hcCA9IHNlYWNNYXA7CiAgICB9CiAgICBjb25zdCB1bml0c1BlckVtID0gcHJvcGVydGllcy5mb250TWF0cml4ID8gMSAvIE1hdGgubWF4KC4uLnByb3BlcnRpZXMuZm9udE1hdHJpeC5zbGljZSgwLCA0KS5tYXAoTWF0aC5hYnMpKSA6IDEwMDA7CiAgICBjb25zdCBidWlsZGVyID0gbmV3IE9wZW5UeXBlRmlsZUJ1aWxkZXIoIlx4NEZceDU0XHg1NFx4NEYiKTsKICAgIGJ1aWxkZXIuYWRkVGFibGUoIkNGRiAiLCBmb250LmRhdGEpOwogICAgYnVpbGRlci5hZGRUYWJsZSgiT1MvMiIsIGNyZWF0ZU9TMlRhYmxlKHByb3BlcnRpZXMsIG5ld0NoYXJDb2RlVG9HbHlwaElkKSk7CiAgICBidWlsZGVyLmFkZFRhYmxlKCJjbWFwIiwgY3JlYXRlQ21hcFRhYmxlKG5ld0NoYXJDb2RlVG9HbHlwaElkLCB0b1VuaWNvZGVFeHRyYU1hcCwgbnVtR2x5cGhzKSk7CiAgICBidWlsZGVyLmFkZFRhYmxlKCJoZWFkIiwgIlx4MDBceDAxXHgwMFx4MDAiICsgIlx4MDBceDAwXHgxMFx4MDAiICsgIlx4MDBceDAwXHgwMFx4MDAiICsgIlx4NUZceDBGXHgzQ1x4RjUiICsgIlx4MDBceDAwIiArIHNhZmVTdHJpbmcxNih1bml0c1BlckVtKSArICJceDAwXHgwMFx4MDBceDAwXHg5ZVx4MGJceDdlXHgyNyIgKyAiXHgwMFx4MDBceDAwXHgwMFx4OWVceDBiXHg3ZVx4MjciICsgIlx4MDBceDAwIiArIHNhZmVTdHJpbmcxNihwcm9wZXJ0aWVzLmRlc2NlbnQpICsgIlx4MEZceEZGIiArIHNhZmVTdHJpbmcxNihwcm9wZXJ0aWVzLmFzY2VudCkgKyBzdHJpbmcxNihwcm9wZXJ0aWVzLml0YWxpY0FuZ2xlID8gMiA6IDApICsgIlx4MDBceDExIiArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIik7CiAgICBidWlsZGVyLmFkZFRhYmxlKCJoaGVhIiwgIlx4MDBceDAxXHgwMFx4MDAiICsgc2FmZVN0cmluZzE2KHByb3BlcnRpZXMuYXNjZW50KSArIHNhZmVTdHJpbmcxNihwcm9wZXJ0aWVzLmRlc2NlbnQpICsgIlx4MDBceDAwIiArICJceEZGXHhGRiIgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyBzYWZlU3RyaW5nMTYocHJvcGVydGllcy5jYXBIZWlnaHQpICsgc2FmZVN0cmluZzE2KE1hdGgudGFuKHByb3BlcnRpZXMuaXRhbGljQW5nbGUpICogcHJvcGVydGllcy54SGVpZ2h0KSArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIiArIHN0cmluZzE2KG51bUdseXBocykpOwogICAgYnVpbGRlci5hZGRUYWJsZSgiaG10eCIsIGZ1bmN0aW9uIGZvbnRGaWVsZHNIbXR4KCkgewogICAgICBjb25zdCBjaGFyc3RyaW5ncyA9IGZvbnQuY2hhcnN0cmluZ3M7CiAgICAgIGNvbnN0IGNmZldpZHRocyA9IGZvbnQuY2ZmID8gZm9udC5jZmYud2lkdGhzIDogbnVsbDsKICAgICAgbGV0IGhtdHggPSAiXHgwMFx4MDBceDAwXHgwMCI7CiAgICAgIGZvciAobGV0IGkgPSAxLCBpaSA9IG51bUdseXBoczsgaSA8IGlpOyBpKyspIHsKICAgICAgICBsZXQgd2lkdGggPSAwOwogICAgICAgIGlmIChjaGFyc3RyaW5ncykgewogICAgICAgICAgY29uc3QgY2hhcnN0cmluZyA9IGNoYXJzdHJpbmdzW2kgLSAxXTsKICAgICAgICAgIHdpZHRoID0gIndpZHRoIiBpbiBjaGFyc3RyaW5nID8gY2hhcnN0cmluZy53aWR0aCA6IDA7CiAgICAgICAgfSBlbHNlIGlmIChjZmZXaWR0aHMpIHsKICAgICAgICAgIHdpZHRoID0gTWF0aC5jZWlsKGNmZldpZHRoc1tpXSB8fCAwKTsKICAgICAgICB9CiAgICAgICAgaG10eCArPSBzdHJpbmcxNih3aWR0aCkgKyBzdHJpbmcxNigwKTsKICAgICAgfQogICAgICByZXR1cm4gaG10eDsKICAgIH0oKSk7CiAgICBidWlsZGVyLmFkZFRhYmxlKCJtYXhwIiwgIlx4MDBceDAwXHg1MFx4MDAiICsgc3RyaW5nMTYobnVtR2x5cGhzKSk7CiAgICBidWlsZGVyLmFkZFRhYmxlKCJuYW1lIiwgY3JlYXRlTmFtZVRhYmxlKGZvbnROYW1lKSk7CiAgICBidWlsZGVyLmFkZFRhYmxlKCJwb3N0IiwgY3JlYXRlUG9zdFRhYmxlKHByb3BlcnRpZXMpKTsKICAgIHJldHVybiBidWlsZGVyLnRvQXJyYXkoKTsKICB9CiAgZ2V0IF9zcGFjZVdpZHRoKCkgewogICAgY29uc3QgcG9zc2libGVTcGFjZVJlcGxhY2VtZW50cyA9IFsic3BhY2UiLCAibWludXMiLCAib25lIiwgImkiLCAiSSJdOwogICAgbGV0IHdpZHRoOwogICAgZm9yIChjb25zdCBnbHlwaE5hbWUgb2YgcG9zc2libGVTcGFjZVJlcGxhY2VtZW50cykgewogICAgICBpZiAoZ2x5cGhOYW1lIGluIHRoaXMud2lkdGhzKSB7CiAgICAgICAgd2lkdGggPSB0aGlzLndpZHRoc1tnbHlwaE5hbWVdOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNvbnN0IGdseXBoc1VuaWNvZGVNYXAgPSBnZXRHbHlwaHNVbmljb2RlKCk7CiAgICAgIGNvbnN0IGdseXBoVW5pY29kZSA9IGdseXBoc1VuaWNvZGVNYXBbZ2x5cGhOYW1lXTsKICAgICAgbGV0IGNoYXJjb2RlID0gMDsKICAgICAgaWYgKHRoaXMuY29tcG9zaXRlICYmIHRoaXMuY01hcC5jb250YWlucyhnbHlwaFVuaWNvZGUpKSB7CiAgICAgICAgY2hhcmNvZGUgPSB0aGlzLmNNYXAubG9va3VwKGdseXBoVW5pY29kZSk7CiAgICAgICAgaWYgKHR5cGVvZiBjaGFyY29kZSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIGNoYXJjb2RlID0gY29udmVydENpZFN0cmluZyhnbHlwaFVuaWNvZGUsIGNoYXJjb2RlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCFjaGFyY29kZSAmJiB0aGlzLnRvVW5pY29kZSkgewogICAgICAgIGNoYXJjb2RlID0gdGhpcy50b1VuaWNvZGUuY2hhckNvZGVPZihnbHlwaFVuaWNvZGUpOwogICAgICB9CiAgICAgIGlmIChjaGFyY29kZSA8PSAwKSB7CiAgICAgICAgY2hhcmNvZGUgPSBnbHlwaFVuaWNvZGU7CiAgICAgIH0KICAgICAgd2lkdGggPSB0aGlzLndpZHRoc1tjaGFyY29kZV07CiAgICAgIGlmICh3aWR0aCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJfc3BhY2VXaWR0aCIsIHdpZHRoIHx8IHRoaXMuZGVmYXVsdFdpZHRoKTsKICB9CiAgX2NoYXJUb0dseXBoKGNoYXJjb2RlLCBpc1NwYWNlID0gZmFsc2UpIHsKICAgIGxldCBnbHlwaCA9IHRoaXMuX2dseXBoQ2FjaGVbY2hhcmNvZGVdOwogICAgaWYgKGdseXBoPy5pc1NwYWNlID09PSBpc1NwYWNlKSB7CiAgICAgIHJldHVybiBnbHlwaDsKICAgIH0KICAgIGxldCBmb250Q2hhckNvZGUsIHdpZHRoLCBvcGVyYXRvckxpc3RJZDsKICAgIGxldCB3aWR0aENvZGUgPSBjaGFyY29kZTsKICAgIGlmICh0aGlzLmNNYXA/LmNvbnRhaW5zKGNoYXJjb2RlKSkgewogICAgICB3aWR0aENvZGUgPSB0aGlzLmNNYXAubG9va3VwKGNoYXJjb2RlKTsKICAgICAgaWYgKHR5cGVvZiB3aWR0aENvZGUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgd2lkdGhDb2RlID0gY29udmVydENpZFN0cmluZyhjaGFyY29kZSwgd2lkdGhDb2RlKTsKICAgICAgfQogICAgfQogICAgd2lkdGggPSB0aGlzLndpZHRoc1t3aWR0aENvZGVdOwogICAgaWYgKHR5cGVvZiB3aWR0aCAhPT0gIm51bWJlciIpIHsKICAgICAgd2lkdGggPSB0aGlzLmRlZmF1bHRXaWR0aDsKICAgIH0KICAgIGNvbnN0IHZtZXRyaWMgPSB0aGlzLnZtZXRyaWNzPy5bd2lkdGhDb2RlXTsKICAgIGxldCB1bmljb2RlID0gdGhpcy50b1VuaWNvZGUuZ2V0KGNoYXJjb2RlKSB8fCBjaGFyY29kZTsKICAgIGlmICh0eXBlb2YgdW5pY29kZSA9PT0gIm51bWJlciIpIHsKICAgICAgdW5pY29kZSA9IFN0cmluZy5mcm9tQ2hhckNvZGUodW5pY29kZSk7CiAgICB9CiAgICBsZXQgaXNJbkZvbnQgPSB0aGlzLnRvRm9udENoYXJbY2hhcmNvZGVdICE9PSB1bmRlZmluZWQ7CiAgICBmb250Q2hhckNvZGUgPSB0aGlzLnRvRm9udENoYXJbY2hhcmNvZGVdIHx8IGNoYXJjb2RlOwogICAgaWYgKHRoaXMubWlzc2luZ0ZpbGUpIHsKICAgICAgY29uc3QgZ2x5cGhOYW1lID0gdGhpcy5kaWZmZXJlbmNlc1tjaGFyY29kZV0gfHwgdGhpcy5kZWZhdWx0RW5jb2RpbmdbY2hhcmNvZGVdOwogICAgICBpZiAoKGdseXBoTmFtZSA9PT0gIi5ub3RkZWYiIHx8IGdseXBoTmFtZSA9PT0gIiIpICYmIHRoaXMudHlwZSA9PT0gIlR5cGUxIikgewogICAgICAgIGZvbnRDaGFyQ29kZSA9IDB4MjA7CiAgICAgICAgaWYgKGdseXBoTmFtZSA9PT0gIiIpIHsKICAgICAgICAgIHdpZHRoIHx8PSB0aGlzLl9zcGFjZVdpZHRoOwogICAgICAgICAgdW5pY29kZSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZm9udENoYXJDb2RlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZm9udENoYXJDb2RlID0gbWFwU3BlY2lhbFVuaWNvZGVWYWx1ZXMoZm9udENoYXJDb2RlKTsKICAgIH0KICAgIGlmICh0aGlzLmlzVHlwZTNGb250KSB7CiAgICAgIG9wZXJhdG9yTGlzdElkID0gZm9udENoYXJDb2RlOwogICAgfQogICAgbGV0IGFjY2VudCA9IG51bGw7CiAgICBpZiAodGhpcy5zZWFjTWFwPy5bY2hhcmNvZGVdKSB7CiAgICAgIGlzSW5Gb250ID0gdHJ1ZTsKICAgICAgY29uc3Qgc2VhYyA9IHRoaXMuc2VhY01hcFtjaGFyY29kZV07CiAgICAgIGZvbnRDaGFyQ29kZSA9IHNlYWMuYmFzZUZvbnRDaGFyQ29kZTsKICAgICAgYWNjZW50ID0gewogICAgICAgIGZvbnRDaGFyOiBTdHJpbmcuZnJvbUNvZGVQb2ludChzZWFjLmFjY2VudEZvbnRDaGFyQ29kZSksCiAgICAgICAgb2Zmc2V0OiBzZWFjLmFjY2VudE9mZnNldAogICAgICB9OwogICAgfQogICAgbGV0IGZvbnRDaGFyID0gIiI7CiAgICBpZiAodHlwZW9mIGZvbnRDaGFyQ29kZSA9PT0gIm51bWJlciIpIHsKICAgICAgaWYgKGZvbnRDaGFyQ29kZSA8PSAweDEwZmZmZikgewogICAgICAgIGZvbnRDaGFyID0gU3RyaW5nLmZyb21Db2RlUG9pbnQoZm9udENoYXJDb2RlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKGBjaGFyVG9HbHlwaCAtIGludmFsaWQgZm9udENoYXJDb2RlOiAke2ZvbnRDaGFyQ29kZX1gKTsKICAgICAgfQogICAgfQogICAgaWYgKHRoaXMubWlzc2luZ0ZpbGUgJiYgdGhpcy52ZXJ0aWNhbCAmJiBmb250Q2hhci5sZW5ndGggPT09IDEpIHsKICAgICAgY29uc3QgdmVydGljYWwgPSBnZXRWZXJ0aWNhbFByZXNlbnRhdGlvbkZvcm0oKVtmb250Q2hhci5jaGFyQ29kZUF0KDApXTsKICAgICAgaWYgKHZlcnRpY2FsKSB7CiAgICAgICAgZm9udENoYXIgPSB1bmljb2RlID0gU3RyaW5nLmZyb21DaGFyQ29kZSh2ZXJ0aWNhbCk7CiAgICAgIH0KICAgIH0KICAgIGdseXBoID0gbmV3IGZvbnRzX0dseXBoKGNoYXJjb2RlLCBmb250Q2hhciwgdW5pY29kZSwgYWNjZW50LCB3aWR0aCwgdm1ldHJpYywgb3BlcmF0b3JMaXN0SWQsIGlzU3BhY2UsIGlzSW5Gb250KTsKICAgIHJldHVybiB0aGlzLl9nbHlwaENhY2hlW2NoYXJjb2RlXSA9IGdseXBoOwogIH0KICBjaGFyc1RvR2x5cGhzKGNoYXJzKSB7CiAgICBsZXQgZ2x5cGhzID0gdGhpcy5fY2hhcnNDYWNoZVtjaGFyc107CiAgICBpZiAoZ2x5cGhzKSB7CiAgICAgIHJldHVybiBnbHlwaHM7CiAgICB9CiAgICBnbHlwaHMgPSBbXTsKICAgIGlmICh0aGlzLmNNYXApIHsKICAgICAgY29uc3QgYyA9IE9iamVjdC5jcmVhdGUobnVsbCksCiAgICAgICAgaWkgPSBjaGFycy5sZW5ndGg7CiAgICAgIGxldCBpID0gMDsKICAgICAgd2hpbGUgKGkgPCBpaSkgewogICAgICAgIHRoaXMuY01hcC5yZWFkQ2hhckNvZGUoY2hhcnMsIGksIGMpOwogICAgICAgIGNvbnN0IHsKICAgICAgICAgIGNoYXJjb2RlLAogICAgICAgICAgbGVuZ3RoCiAgICAgICAgfSA9IGM7CiAgICAgICAgaSArPSBsZW5ndGg7CiAgICAgICAgY29uc3QgZ2x5cGggPSB0aGlzLl9jaGFyVG9HbHlwaChjaGFyY29kZSwgbGVuZ3RoID09PSAxICYmIGNoYXJzLmNoYXJDb2RlQXQoaSAtIDEpID09PSAweDIwKTsKICAgICAgICBnbHlwaHMucHVzaChnbHlwaCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGNoYXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICBjb25zdCBjaGFyY29kZSA9IGNoYXJzLmNoYXJDb2RlQXQoaSk7CiAgICAgICAgY29uc3QgZ2x5cGggPSB0aGlzLl9jaGFyVG9HbHlwaChjaGFyY29kZSwgY2hhcmNvZGUgPT09IDB4MjApOwogICAgICAgIGdseXBocy5wdXNoKGdseXBoKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRoaXMuX2NoYXJzQ2FjaGVbY2hhcnNdID0gZ2x5cGhzOwogIH0KICBnZXRDaGFyUG9zaXRpb25zKGNoYXJzKSB7CiAgICBjb25zdCBwb3NpdGlvbnMgPSBbXTsKICAgIGlmICh0aGlzLmNNYXApIHsKICAgICAgY29uc3QgYyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIGxldCBpID0gMDsKICAgICAgd2hpbGUgKGkgPCBjaGFycy5sZW5ndGgpIHsKICAgICAgICB0aGlzLmNNYXAucmVhZENoYXJDb2RlKGNoYXJzLCBpLCBjKTsKICAgICAgICBjb25zdCBsZW5ndGggPSBjLmxlbmd0aDsKICAgICAgICBwb3NpdGlvbnMucHVzaChbaSwgaSArIGxlbmd0aF0pOwogICAgICAgIGkgKz0gbGVuZ3RoOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjaGFycy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgcG9zaXRpb25zLnB1c2goW2ksIGkgKyAxXSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBwb3NpdGlvbnM7CiAgfQogIGdldCBnbHlwaENhY2hlVmFsdWVzKCkgewogICAgcmV0dXJuIE9iamVjdC52YWx1ZXModGhpcy5fZ2x5cGhDYWNoZSk7CiAgfQogIGVuY29kZVN0cmluZyhzdHIpIHsKICAgIGNvbnN0IGJ1ZmZlcnMgPSBbXTsKICAgIGNvbnN0IGN1cnJlbnRCdWYgPSBbXTsKICAgIGNvbnN0IGhhc0N1cnJlbnRCdWZFcnJvcnMgPSAoKSA9PiBidWZmZXJzLmxlbmd0aCAlIDIgPT09IDE7CiAgICBjb25zdCBnZXRDaGFyQ29kZSA9IHRoaXMudG9Vbmljb2RlIGluc3RhbmNlb2YgSWRlbnRpdHlUb1VuaWNvZGVNYXAgPyB1bmljb2RlID0+IHRoaXMudG9Vbmljb2RlLmNoYXJDb2RlT2YodW5pY29kZSkgOiB1bmljb2RlID0+IHRoaXMudG9Vbmljb2RlLmNoYXJDb2RlT2YoU3RyaW5nLmZyb21Db2RlUG9pbnQodW5pY29kZSkpOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3RyLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgdW5pY29kZSA9IHN0ci5jb2RlUG9pbnRBdChpKTsKICAgICAgaWYgKHVuaWNvZGUgPiAweGQ3ZmYgJiYgKHVuaWNvZGUgPCAweGUwMDAgfHwgdW5pY29kZSA+IDB4ZmZmZCkpIHsKICAgICAgICBpKys7CiAgICAgIH0KICAgICAgaWYgKHRoaXMudG9Vbmljb2RlKSB7CiAgICAgICAgY29uc3QgY2hhckNvZGUgPSBnZXRDaGFyQ29kZSh1bmljb2RlKTsKICAgICAgICBpZiAoY2hhckNvZGUgIT09IC0xKSB7CiAgICAgICAgICBpZiAoaGFzQ3VycmVudEJ1ZkVycm9ycygpKSB7CiAgICAgICAgICAgIGJ1ZmZlcnMucHVzaChjdXJyZW50QnVmLmpvaW4oIiIpKTsKICAgICAgICAgICAgY3VycmVudEJ1Zi5sZW5ndGggPSAwOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgY2hhckNvZGVMZW5ndGggPSB0aGlzLmNNYXAgPyB0aGlzLmNNYXAuZ2V0Q2hhckNvZGVMZW5ndGgoY2hhckNvZGUpIDogMTsKICAgICAgICAgIGZvciAobGV0IGogPSBjaGFyQ29kZUxlbmd0aCAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICAgIGN1cnJlbnRCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGNoYXJDb2RlID4+IDggKiBqICYgMHhmZikpOwogICAgICAgICAgfQogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICghaGFzQ3VycmVudEJ1ZkVycm9ycygpKSB7CiAgICAgICAgYnVmZmVycy5wdXNoKGN1cnJlbnRCdWYuam9pbigiIikpOwogICAgICAgIGN1cnJlbnRCdWYubGVuZ3RoID0gMDsKICAgICAgfQogICAgICBjdXJyZW50QnVmLnB1c2goU3RyaW5nLmZyb21Db2RlUG9pbnQodW5pY29kZSkpOwogICAgfQogICAgYnVmZmVycy5wdXNoKGN1cnJlbnRCdWYuam9pbigiIikpOwogICAgcmV0dXJuIGJ1ZmZlcnM7CiAgfQp9CmNsYXNzIEVycm9yRm9udCB7CiAgY29uc3RydWN0b3IoZXJyb3IpIHsKICAgIHRoaXMuZXJyb3IgPSBlcnJvcjsKICAgIHRoaXMubG9hZGVkTmFtZSA9ICJnX2ZvbnRfZXJyb3IiOwogICAgdGhpcy5taXNzaW5nRmlsZSA9IHRydWU7CiAgfQogIGNoYXJzVG9HbHlwaHMoKSB7CiAgICByZXR1cm4gW107CiAgfQogIGVuY29kZVN0cmluZyhjaGFycykgewogICAgcmV0dXJuIFtjaGFyc107CiAgfQogIGV4cG9ydERhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBlcnJvcjogdGhpcy5lcnJvcgogICAgfTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3BhdHRlcm4uanMKCgoKCmNvbnN0IFNoYWRpbmdUeXBlID0gewogIEZVTkNUSU9OX0JBU0VEOiAxLAogIEFYSUFMOiAyLAogIFJBRElBTDogMywKICBGUkVFX0ZPUk1fTUVTSDogNCwKICBMQVRUSUNFX0ZPUk1fTUVTSDogNSwKICBDT09OU19QQVRDSF9NRVNIOiA2LAogIFRFTlNPUl9QQVRDSF9NRVNIOiA3Cn07CmNsYXNzIFBhdHRlcm4gewogIGNvbnN0cnVjdG9yKCkgewogICAgdW5yZWFjaGFibGUoIkNhbm5vdCBpbml0aWFsaXplIFBhdHRlcm4uIik7CiAgfQogIHN0YXRpYyBwYXJzZVNoYWRpbmcoc2hhZGluZywgeHJlZiwgcmVzLCBwZGZGdW5jdGlvbkZhY3RvcnksIGdsb2JhbENvbG9yU3BhY2VDYWNoZSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUpIHsKICAgIGNvbnN0IGRpY3QgPSBzaGFkaW5nIGluc3RhbmNlb2YgQmFzZVN0cmVhbSA/IHNoYWRpbmcuZGljdCA6IHNoYWRpbmc7CiAgICBjb25zdCB0eXBlID0gZGljdC5nZXQoIlNoYWRpbmdUeXBlIik7CiAgICB0cnkgewogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlIFNoYWRpbmdUeXBlLkFYSUFMOgogICAgICAgIGNhc2UgU2hhZGluZ1R5cGUuUkFESUFMOgogICAgICAgICAgcmV0dXJuIG5ldyBSYWRpYWxBeGlhbFNoYWRpbmcoZGljdCwgeHJlZiwgcmVzLCBwZGZGdW5jdGlvbkZhY3RvcnksIGdsb2JhbENvbG9yU3BhY2VDYWNoZSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUpOwogICAgICAgIGNhc2UgU2hhZGluZ1R5cGUuRlJFRV9GT1JNX01FU0g6CiAgICAgICAgY2FzZSBTaGFkaW5nVHlwZS5MQVRUSUNFX0ZPUk1fTUVTSDoKICAgICAgICBjYXNlIFNoYWRpbmdUeXBlLkNPT05TX1BBVENIX01FU0g6CiAgICAgICAgY2FzZSBTaGFkaW5nVHlwZS5URU5TT1JfUEFUQ0hfTUVTSDoKICAgICAgICAgIHJldHVybiBuZXcgTWVzaFNoYWRpbmcoc2hhZGluZywgeHJlZiwgcmVzLCBwZGZGdW5jdGlvbkZhY3RvcnksIGdsb2JhbENvbG9yU3BhY2VDYWNoZSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUpOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlVuc3VwcG9ydGVkIFNoYWRpbmdUeXBlOiAiICsgdHlwZSk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgd2FybihleCk7CiAgICAgIHJldHVybiBuZXcgRHVtbXlTaGFkaW5nKCk7CiAgICB9CiAgfQp9CmNsYXNzIEJhc2VTaGFkaW5nIHsKICBzdGF0aWMgU01BTExfTlVNQkVSID0gMWUtNjsKICBnZXRJUigpIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYGdldElSYCBjYWxsZWQuIik7CiAgfQp9CmNsYXNzIFJhZGlhbEF4aWFsU2hhZGluZyBleHRlbmRzIEJhc2VTaGFkaW5nIHsKICBjb25zdHJ1Y3RvcihkaWN0LCB4cmVmLCByZXNvdXJjZXMsIHBkZkZ1bmN0aW9uRmFjdG9yeSwgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLCBsb2NhbENvbG9yU3BhY2VDYWNoZSkgewogICAgc3VwZXIoKTsKICAgIHRoaXMuc2hhZGluZ1R5cGUgPSBkaWN0LmdldCgiU2hhZGluZ1R5cGUiKTsKICAgIGxldCBjb29yZHNMZW4gPSAwOwogICAgaWYgKHRoaXMuc2hhZGluZ1R5cGUgPT09IFNoYWRpbmdUeXBlLkFYSUFMKSB7CiAgICAgIGNvb3Jkc0xlbiA9IDQ7CiAgICB9IGVsc2UgaWYgKHRoaXMuc2hhZGluZ1R5cGUgPT09IFNoYWRpbmdUeXBlLlJBRElBTCkgewogICAgICBjb29yZHNMZW4gPSA2OwogICAgfQogICAgdGhpcy5jb29yZHNBcnIgPSBkaWN0LmdldEFycmF5KCJDb29yZHMiKTsKICAgIGlmICghaXNOdW1iZXJBcnJheSh0aGlzLmNvb3Jkc0FyciwgY29vcmRzTGVuKSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlJhZGlhbEF4aWFsU2hhZGluZzogSW52YWxpZCAvQ29vcmRzIGFycmF5LiIpOwogICAgfQogICAgY29uc3QgY3MgPSBDb2xvclNwYWNlVXRpbHMucGFyc2UoewogICAgICBjczogZGljdC5nZXRSYXcoIkNTIikgfHwgZGljdC5nZXRSYXcoIkNvbG9yU3BhY2UiKSwKICAgICAgeHJlZiwKICAgICAgcmVzb3VyY2VzLAogICAgICBwZGZGdW5jdGlvbkZhY3RvcnksCiAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUKICAgIH0pOwogICAgdGhpcy5iYm94ID0gbG9va3VwTm9ybWFsUmVjdChkaWN0LmdldEFycmF5KCJCQm94IiksIG51bGwpOwogICAgbGV0IHQwID0gMC4wLAogICAgICB0MSA9IDEuMDsKICAgIGNvbnN0IGRvbWFpbkFyciA9IGRpY3QuZ2V0QXJyYXkoIkRvbWFpbiIpOwogICAgaWYgKGlzTnVtYmVyQXJyYXkoZG9tYWluQXJyLCAyKSkgewogICAgICBbdDAsIHQxXSA9IGRvbWFpbkFycjsKICAgIH0KICAgIGxldCBleHRlbmRTdGFydCA9IGZhbHNlLAogICAgICBleHRlbmRFbmQgPSBmYWxzZTsKICAgIGNvbnN0IGV4dGVuZEFyciA9IGRpY3QuZ2V0QXJyYXkoIkV4dGVuZCIpOwogICAgaWYgKGlzQm9vbGVhbkFycmF5KGV4dGVuZEFyciwgMikpIHsKICAgICAgW2V4dGVuZFN0YXJ0LCBleHRlbmRFbmRdID0gZXh0ZW5kQXJyOwogICAgfQogICAgaWYgKHRoaXMuc2hhZGluZ1R5cGUgPT09IFNoYWRpbmdUeXBlLlJBRElBTCAmJiAoIWV4dGVuZFN0YXJ0IHx8ICFleHRlbmRFbmQpKSB7CiAgICAgIGNvbnN0IFt4MSwgeTEsIHIxLCB4MiwgeTIsIHIyXSA9IHRoaXMuY29vcmRzQXJyOwogICAgICBjb25zdCBkaXN0YW5jZSA9IE1hdGguaHlwb3QoeDEgLSB4MiwgeTEgLSB5Mik7CiAgICAgIGlmIChyMSA8PSByMiArIGRpc3RhbmNlICYmIHIyIDw9IHIxICsgZGlzdGFuY2UpIHsKICAgICAgICB3YXJuKCJVbnN1cHBvcnRlZCByYWRpYWwgZ3JhZGllbnQuIik7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuZXh0ZW5kU3RhcnQgPSBleHRlbmRTdGFydDsKICAgIHRoaXMuZXh0ZW5kRW5kID0gZXh0ZW5kRW5kOwogICAgY29uc3QgZm5PYmogPSBkaWN0LmdldFJhdygiRnVuY3Rpb24iKTsKICAgIGNvbnN0IGZuID0gcGRmRnVuY3Rpb25GYWN0b3J5LmNyZWF0ZShmbk9iaiwgdHJ1ZSk7CiAgICBjb25zdCBOVU1CRVJfT0ZfU0FNUExFUyA9IDg0MDsKICAgIGNvbnN0IHN0ZXAgPSAodDEgLSB0MCkgLyBOVU1CRVJfT0ZfU0FNUExFUzsKICAgIGNvbnN0IGNvbG9yU3RvcHMgPSB0aGlzLmNvbG9yU3RvcHMgPSBbXTsKICAgIGlmICh0MCA+PSB0MSB8fCBzdGVwIDw9IDApIHsKICAgICAgaW5mbygiQmFkIHNoYWRpbmcgZG9tYWluLiIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBjb2xvciA9IG5ldyBGbG9hdDMyQXJyYXkoY3MubnVtQ29tcHMpLAogICAgICByYXRpbyA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7CiAgICBsZXQgaUJhc2UgPSAwOwogICAgcmF0aW9bMF0gPSB0MDsKICAgIGZuKHJhdGlvLCAwLCBjb2xvciwgMCk7CiAgICBjb25zdCByZ2JCdWZmZXIgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoMyk7CiAgICBjcy5nZXRSZ2IoY29sb3IsIDAsIHJnYkJ1ZmZlcik7CiAgICBsZXQgW3JCYXNlLCBnQmFzZSwgYkJhc2VdID0gcmdiQnVmZmVyOwogICAgY29sb3JTdG9wcy5wdXNoKFswLCBVdGlsLm1ha2VIZXhDb2xvcihyQmFzZSwgZ0Jhc2UsIGJCYXNlKV0pOwogICAgbGV0IGlQcmV2ID0gMTsKICAgIHJhdGlvWzBdID0gdDAgKyBzdGVwOwogICAgZm4ocmF0aW8sIDAsIGNvbG9yLCAwKTsKICAgIGNzLmdldFJnYihjb2xvciwgMCwgcmdiQnVmZmVyKTsKICAgIGxldCBbclByZXYsIGdQcmV2LCBiUHJldl0gPSByZ2JCdWZmZXI7CiAgICBsZXQgbWF4U2xvcGVSID0gclByZXYgLSByQmFzZSArIDE7CiAgICBsZXQgbWF4U2xvcGVHID0gZ1ByZXYgLSBnQmFzZSArIDE7CiAgICBsZXQgbWF4U2xvcGVCID0gYlByZXYgLSBiQmFzZSArIDE7CiAgICBsZXQgbWluU2xvcGVSID0gclByZXYgLSByQmFzZSAtIDE7CiAgICBsZXQgbWluU2xvcGVHID0gZ1ByZXYgLSBnQmFzZSAtIDE7CiAgICBsZXQgbWluU2xvcGVCID0gYlByZXYgLSBiQmFzZSAtIDE7CiAgICBmb3IgKGxldCBpID0gMjsgaSA8IE5VTUJFUl9PRl9TQU1QTEVTOyBpKyspIHsKICAgICAgcmF0aW9bMF0gPSB0MCArIGkgKiBzdGVwOwogICAgICBmbihyYXRpbywgMCwgY29sb3IsIDApOwogICAgICBjcy5nZXRSZ2IoY29sb3IsIDAsIHJnYkJ1ZmZlcik7CiAgICAgIGNvbnN0IFtyLCBnLCBiXSA9IHJnYkJ1ZmZlcjsKICAgICAgY29uc3QgcnVuID0gaSAtIGlCYXNlOwogICAgICBtYXhTbG9wZVIgPSBNYXRoLm1pbihtYXhTbG9wZVIsIChyIC0gckJhc2UgKyAxKSAvIHJ1bik7CiAgICAgIG1heFNsb3BlRyA9IE1hdGgubWluKG1heFNsb3BlRywgKGcgLSBnQmFzZSArIDEpIC8gcnVuKTsKICAgICAgbWF4U2xvcGVCID0gTWF0aC5taW4obWF4U2xvcGVCLCAoYiAtIGJCYXNlICsgMSkgLyBydW4pOwogICAgICBtaW5TbG9wZVIgPSBNYXRoLm1heChtaW5TbG9wZVIsIChyIC0gckJhc2UgLSAxKSAvIHJ1bik7CiAgICAgIG1pblNsb3BlRyA9IE1hdGgubWF4KG1pblNsb3BlRywgKGcgLSBnQmFzZSAtIDEpIC8gcnVuKTsKICAgICAgbWluU2xvcGVCID0gTWF0aC5tYXgobWluU2xvcGVCLCAoYiAtIGJCYXNlIC0gMSkgLyBydW4pOwogICAgICBjb25zdCBzbG9wZXNFeGlzdCA9IG1pblNsb3BlUiA8PSBtYXhTbG9wZVIgJiYgbWluU2xvcGVHIDw9IG1heFNsb3BlRyAmJiBtaW5TbG9wZUIgPD0gbWF4U2xvcGVCOwogICAgICBpZiAoIXNsb3Blc0V4aXN0KSB7CiAgICAgICAgY29uc3QgY3NzQ29sb3IgPSBVdGlsLm1ha2VIZXhDb2xvcihyUHJldiwgZ1ByZXYsIGJQcmV2KTsKICAgICAgICBjb2xvclN0b3BzLnB1c2goW2lQcmV2IC8gTlVNQkVSX09GX1NBTVBMRVMsIGNzc0NvbG9yXSk7CiAgICAgICAgbWF4U2xvcGVSID0gciAtIHJQcmV2ICsgMTsKICAgICAgICBtYXhTbG9wZUcgPSBnIC0gZ1ByZXYgKyAxOwogICAgICAgIG1heFNsb3BlQiA9IGIgLSBiUHJldiArIDE7CiAgICAgICAgbWluU2xvcGVSID0gciAtIHJQcmV2IC0gMTsKICAgICAgICBtaW5TbG9wZUcgPSBnIC0gZ1ByZXYgLSAxOwogICAgICAgIG1pblNsb3BlQiA9IGIgLSBiUHJldiAtIDE7CiAgICAgICAgaUJhc2UgPSBpUHJldjsKICAgICAgICByQmFzZSA9IHJQcmV2OwogICAgICAgIGdCYXNlID0gZ1ByZXY7CiAgICAgICAgYkJhc2UgPSBiUHJldjsKICAgICAgfQogICAgICBpUHJldiA9IGk7CiAgICAgIHJQcmV2ID0gcjsKICAgICAgZ1ByZXYgPSBnOwogICAgICBiUHJldiA9IGI7CiAgICB9CiAgICBjb2xvclN0b3BzLnB1c2goWzEsIFV0aWwubWFrZUhleENvbG9yKHJQcmV2LCBnUHJldiwgYlByZXYpXSk7CiAgICBsZXQgYmFja2dyb3VuZCA9ICJ0cmFuc3BhcmVudCI7CiAgICBpZiAoZGljdC5oYXMoIkJhY2tncm91bmQiKSkgewogICAgICBiYWNrZ3JvdW5kID0gY3MuZ2V0UmdiSGV4KGRpY3QuZ2V0KCJCYWNrZ3JvdW5kIiksIDApOwogICAgfQogICAgaWYgKCFleHRlbmRTdGFydCkgewogICAgICBjb2xvclN0b3BzLnVuc2hpZnQoWzAsIGJhY2tncm91bmRdKTsKICAgICAgY29sb3JTdG9wc1sxXVswXSArPSBCYXNlU2hhZGluZy5TTUFMTF9OVU1CRVI7CiAgICB9CiAgICBpZiAoIWV4dGVuZEVuZCkgewogICAgICBjb2xvclN0b3BzLmF0KC0xKVswXSAtPSBCYXNlU2hhZGluZy5TTUFMTF9OVU1CRVI7CiAgICAgIGNvbG9yU3RvcHMucHVzaChbMSwgYmFja2dyb3VuZF0pOwogICAgfQogICAgdGhpcy5jb2xvclN0b3BzID0gY29sb3JTdG9wczsKICB9CiAgZ2V0SVIoKSB7CiAgICBjb25zdCB7CiAgICAgIGNvb3Jkc0FyciwKICAgICAgc2hhZGluZ1R5cGUKICAgIH0gPSB0aGlzOwogICAgbGV0IHR5cGUsIHAwLCBwMSwgcjAsIHIxOwogICAgaWYgKHNoYWRpbmdUeXBlID09PSBTaGFkaW5nVHlwZS5BWElBTCkgewogICAgICBwMCA9IFtjb29yZHNBcnJbMF0sIGNvb3Jkc0FyclsxXV07CiAgICAgIHAxID0gW2Nvb3Jkc0FyclsyXSwgY29vcmRzQXJyWzNdXTsKICAgICAgcjAgPSBudWxsOwogICAgICByMSA9IG51bGw7CiAgICAgIHR5cGUgPSAiYXhpYWwiOwogICAgfSBlbHNlIGlmIChzaGFkaW5nVHlwZSA9PT0gU2hhZGluZ1R5cGUuUkFESUFMKSB7CiAgICAgIHAwID0gW2Nvb3Jkc0FyclswXSwgY29vcmRzQXJyWzFdXTsKICAgICAgcDEgPSBbY29vcmRzQXJyWzNdLCBjb29yZHNBcnJbNF1dOwogICAgICByMCA9IGNvb3Jkc0FyclsyXTsKICAgICAgcjEgPSBjb29yZHNBcnJbNV07CiAgICAgIHR5cGUgPSAicmFkaWFsIjsKICAgIH0gZWxzZSB7CiAgICAgIHVucmVhY2hhYmxlKGBnZXRQYXR0ZXJuIHR5cGUgdW5rbm93bjogJHtzaGFkaW5nVHlwZX1gKTsKICAgIH0KICAgIHJldHVybiBbIlJhZGlhbEF4aWFsIiwgdHlwZSwgdGhpcy5iYm94LCB0aGlzLmNvbG9yU3RvcHMsIHAwLCBwMSwgcjAsIHIxXTsKICB9Cn0KY2xhc3MgTWVzaFN0cmVhbVJlYWRlciB7CiAgY29uc3RydWN0b3Ioc3RyZWFtLCBjb250ZXh0KSB7CiAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7CiAgICB0aGlzLmJ1ZmZlciA9IDA7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IDA7CiAgICBjb25zdCBudW1Db21wcyA9IGNvbnRleHQubnVtQ29tcHM7CiAgICB0aGlzLnRtcENvbXBzQnVmID0gbmV3IEZsb2F0MzJBcnJheShudW1Db21wcyk7CiAgICBjb25zdCBjc051bUNvbXBzID0gY29udGV4dC5jb2xvclNwYWNlLm51bUNvbXBzOwogICAgdGhpcy50bXBDc0NvbXBzQnVmID0gY29udGV4dC5jb2xvckZuID8gbmV3IEZsb2F0MzJBcnJheShjc051bUNvbXBzKSA6IHRoaXMudG1wQ29tcHNCdWY7CiAgfQogIGdldCBoYXNEYXRhKCkgewogICAgaWYgKHRoaXMuc3RyZWFtLmVuZCkgewogICAgICByZXR1cm4gdGhpcy5zdHJlYW0ucG9zIDwgdGhpcy5zdHJlYW0uZW5kOwogICAgfQogICAgaWYgKHRoaXMuYnVmZmVyTGVuZ3RoID4gMCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGNvbnN0IG5leHRCeXRlID0gdGhpcy5zdHJlYW0uZ2V0Qnl0ZSgpOwogICAgaWYgKG5leHRCeXRlIDwgMCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB0aGlzLmJ1ZmZlciA9IG5leHRCeXRlOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSA4OwogICAgcmV0dXJuIHRydWU7CiAgfQogIHJlYWRCaXRzKG4pIHsKICAgIGNvbnN0IHsKICAgICAgc3RyZWFtCiAgICB9ID0gdGhpczsKICAgIGxldCB7CiAgICAgIGJ1ZmZlciwKICAgICAgYnVmZmVyTGVuZ3RoCiAgICB9ID0gdGhpczsKICAgIGlmIChuID09PSAzMikgewogICAgICBpZiAoYnVmZmVyTGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHN0cmVhbS5nZXRJbnQzMigpID4+PiAwOwogICAgICB9CiAgICAgIGJ1ZmZlciA9IGJ1ZmZlciA8PCAyNCB8IHN0cmVhbS5nZXRCeXRlKCkgPDwgMTYgfCBzdHJlYW0uZ2V0Qnl0ZSgpIDw8IDggfCBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICBjb25zdCBuZXh0Qnl0ZSA9IHN0cmVhbS5nZXRCeXRlKCk7CiAgICAgIHRoaXMuYnVmZmVyID0gbmV4dEJ5dGUgJiAoMSA8PCBidWZmZXJMZW5ndGgpIC0gMTsKICAgICAgcmV0dXJuIChidWZmZXIgPDwgOCAtIGJ1ZmZlckxlbmd0aCB8IChuZXh0Qnl0ZSAmIDB4ZmYpID4+IGJ1ZmZlckxlbmd0aCkgPj4+IDA7CiAgICB9CiAgICBpZiAobiA9PT0gOCAmJiBidWZmZXJMZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHN0cmVhbS5nZXRCeXRlKCk7CiAgICB9CiAgICB3aGlsZSAoYnVmZmVyTGVuZ3RoIDwgbikgewogICAgICBidWZmZXIgPSBidWZmZXIgPDwgOCB8IHN0cmVhbS5nZXRCeXRlKCk7CiAgICAgIGJ1ZmZlckxlbmd0aCArPSA4OwogICAgfQogICAgYnVmZmVyTGVuZ3RoIC09IG47CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IGJ1ZmZlckxlbmd0aDsKICAgIHRoaXMuYnVmZmVyID0gYnVmZmVyICYgKDEgPDwgYnVmZmVyTGVuZ3RoKSAtIDE7CiAgICByZXR1cm4gYnVmZmVyID4+IGJ1ZmZlckxlbmd0aDsKICB9CiAgYWxpZ24oKSB7CiAgICB0aGlzLmJ1ZmZlciA9IDA7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IDA7CiAgfQogIHJlYWRGbGFnKCkgewogICAgcmV0dXJuIHRoaXMucmVhZEJpdHModGhpcy5jb250ZXh0LmJpdHNQZXJGbGFnKTsKICB9CiAgcmVhZENvb3JkaW5hdGUoKSB7CiAgICBjb25zdCB7CiAgICAgIGJpdHNQZXJDb29yZGluYXRlLAogICAgICBkZWNvZGUKICAgIH0gPSB0aGlzLmNvbnRleHQ7CiAgICBjb25zdCB4aSA9IHRoaXMucmVhZEJpdHMoYml0c1BlckNvb3JkaW5hdGUpOwogICAgY29uc3QgeWkgPSB0aGlzLnJlYWRCaXRzKGJpdHNQZXJDb29yZGluYXRlKTsKICAgIGNvbnN0IHNjYWxlID0gYml0c1BlckNvb3JkaW5hdGUgPCAzMiA/IDEgLyAoKDEgPDwgYml0c1BlckNvb3JkaW5hdGUpIC0gMSkgOiAyLjMyODMwNjQzNjUzODY5NjNlLTEwOwogICAgcmV0dXJuIFt4aSAqIHNjYWxlICogKGRlY29kZVsxXSAtIGRlY29kZVswXSkgKyBkZWNvZGVbMF0sIHlpICogc2NhbGUgKiAoZGVjb2RlWzNdIC0gZGVjb2RlWzJdKSArIGRlY29kZVsyXV07CiAgfQogIHJlYWRDb21wb25lbnRzKCkgewogICAgY29uc3QgewogICAgICBiaXRzUGVyQ29tcG9uZW50LAogICAgICBjb2xvckZuLAogICAgICBjb2xvclNwYWNlLAogICAgICBkZWNvZGUsCiAgICAgIG51bUNvbXBzCiAgICB9ID0gdGhpcy5jb250ZXh0OwogICAgY29uc3Qgc2NhbGUgPSBiaXRzUGVyQ29tcG9uZW50IDwgMzIgPyAxIC8gKCgxIDw8IGJpdHNQZXJDb21wb25lbnQpIC0gMSkgOiAyLjMyODMwNjQzNjUzODY5NjNlLTEwOwogICAgY29uc3QgY29tcG9uZW50cyA9IHRoaXMudG1wQ29tcHNCdWY7CiAgICBmb3IgKGxldCBpID0gMCwgaiA9IDQ7IGkgPCBudW1Db21wczsgaSsrLCBqICs9IDIpIHsKICAgICAgY29uc3QgY2kgPSB0aGlzLnJlYWRCaXRzKGJpdHNQZXJDb21wb25lbnQpOwogICAgICBjb21wb25lbnRzW2ldID0gY2kgKiBzY2FsZSAqIChkZWNvZGVbaiArIDFdIC0gZGVjb2RlW2pdKSArIGRlY29kZVtqXTsKICAgIH0KICAgIGNvbnN0IGNvbG9yID0gdGhpcy50bXBDc0NvbXBzQnVmOwogICAgY29sb3JGbj8uKGNvbXBvbmVudHMsIDAsIGNvbG9yLCAwKTsKICAgIHJldHVybiBjb2xvclNwYWNlLmdldFJnYihjb2xvciwgMCk7CiAgfQp9CmxldCBiQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwpmdW5jdGlvbiBidWlsZEIoY291bnQpIHsKICBjb25zdCBsdXQgPSBbXTsKICBmb3IgKGxldCBpID0gMDsgaSA8PSBjb3VudDsgaSsrKSB7CiAgICBjb25zdCB0ID0gaSAvIGNvdW50LAogICAgICB0XyA9IDEgLSB0OwogICAgbHV0LnB1c2gobmV3IEZsb2F0MzJBcnJheShbdF8gKiogMywgMyAqIHQgKiB0XyAqKiAyLCAzICogdCAqKiAyICogdF8sIHQgKiogM10pKTsKICB9CiAgcmV0dXJuIGx1dDsKfQpmdW5jdGlvbiBnZXRCKGNvdW50KSB7CiAgcmV0dXJuIGJDYWNoZVtjb3VudF0gfHw9IGJ1aWxkQihjb3VudCk7Cn0KZnVuY3Rpb24gY2xlYXJQYXR0ZXJuQ2FjaGVzKCkgewogIGJDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7Cn0KY2xhc3MgTWVzaFNoYWRpbmcgZXh0ZW5kcyBCYXNlU2hhZGluZyB7CiAgc3RhdGljIE1JTl9TUExJVF9QQVRDSF9DSFVOS1NfQU1PVU5UID0gMzsKICBzdGF0aWMgTUFYX1NQTElUX1BBVENIX0NIVU5LU19BTU9VTlQgPSAyMDsKICBzdGF0aWMgVFJJQU5HTEVfREVOU0lUWSA9IDIwOwogIGNvbnN0cnVjdG9yKHN0cmVhbSwgeHJlZiwgcmVzb3VyY2VzLCBwZGZGdW5jdGlvbkZhY3RvcnksIGdsb2JhbENvbG9yU3BhY2VDYWNoZSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUpIHsKICAgIHN1cGVyKCk7CiAgICBpZiAoIShzdHJlYW0gaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIk1lc2ggZGF0YSBpcyBub3QgYSBzdHJlYW0iKTsKICAgIH0KICAgIGNvbnN0IGRpY3QgPSBzdHJlYW0uZGljdDsKICAgIHRoaXMuc2hhZGluZ1R5cGUgPSBkaWN0LmdldCgiU2hhZGluZ1R5cGUiKTsKICAgIHRoaXMuYmJveCA9IGxvb2t1cE5vcm1hbFJlY3QoZGljdC5nZXRBcnJheSgiQkJveCIpLCBudWxsKTsKICAgIGNvbnN0IGNzID0gQ29sb3JTcGFjZVV0aWxzLnBhcnNlKHsKICAgICAgY3M6IGRpY3QuZ2V0UmF3KCJDUyIpIHx8IGRpY3QuZ2V0UmF3KCJDb2xvclNwYWNlIiksCiAgICAgIHhyZWYsCiAgICAgIHJlc291cmNlcywKICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICB9KTsKICAgIHRoaXMuYmFja2dyb3VuZCA9IGRpY3QuaGFzKCJCYWNrZ3JvdW5kIikgPyBjcy5nZXRSZ2IoZGljdC5nZXQoIkJhY2tncm91bmQiKSwgMCkgOiBudWxsOwogICAgY29uc3QgZm5PYmogPSBkaWN0LmdldFJhdygiRnVuY3Rpb24iKTsKICAgIGNvbnN0IGZuID0gZm5PYmogPyBwZGZGdW5jdGlvbkZhY3RvcnkuY3JlYXRlKGZuT2JqLCB0cnVlKSA6IG51bGw7CiAgICB0aGlzLmNvb3JkcyA9IFtdOwogICAgdGhpcy5jb2xvcnMgPSBbXTsKICAgIHRoaXMuZmlndXJlcyA9IFtdOwogICAgY29uc3QgZGVjb2RlQ29udGV4dCA9IHsKICAgICAgYml0c1BlckNvb3JkaW5hdGU6IGRpY3QuZ2V0KCJCaXRzUGVyQ29vcmRpbmF0ZSIpLAogICAgICBiaXRzUGVyQ29tcG9uZW50OiBkaWN0LmdldCgiQml0c1BlckNvbXBvbmVudCIpLAogICAgICBiaXRzUGVyRmxhZzogZGljdC5nZXQoIkJpdHNQZXJGbGFnIiksCiAgICAgIGRlY29kZTogZGljdC5nZXRBcnJheSgiRGVjb2RlIiksCiAgICAgIGNvbG9yRm46IGZuLAogICAgICBjb2xvclNwYWNlOiBjcywKICAgICAgbnVtQ29tcHM6IGZuID8gMSA6IGNzLm51bUNvbXBzCiAgICB9OwogICAgY29uc3QgcmVhZGVyID0gbmV3IE1lc2hTdHJlYW1SZWFkZXIoc3RyZWFtLCBkZWNvZGVDb250ZXh0KTsKICAgIGxldCBwYXRjaE1lc2ggPSBmYWxzZTsKICAgIHN3aXRjaCAodGhpcy5zaGFkaW5nVHlwZSkgewogICAgICBjYXNlIFNoYWRpbmdUeXBlLkZSRUVfRk9STV9NRVNIOgogICAgICAgIHRoaXMuX2RlY29kZVR5cGU0U2hhZGluZyhyZWFkZXIpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFNoYWRpbmdUeXBlLkxBVFRJQ0VfRk9STV9NRVNIOgogICAgICAgIGNvbnN0IHZlcnRpY2VzUGVyUm93ID0gZGljdC5nZXQoIlZlcnRpY2VzUGVyUm93IikgfCAwOwogICAgICAgIGlmICh2ZXJ0aWNlc1BlclJvdyA8IDIpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBWZXJ0aWNlc1BlclJvdyIpOwogICAgICAgIH0KICAgICAgICB0aGlzLl9kZWNvZGVUeXBlNVNoYWRpbmcocmVhZGVyLCB2ZXJ0aWNlc1BlclJvdyk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgU2hhZGluZ1R5cGUuQ09PTlNfUEFUQ0hfTUVTSDoKICAgICAgICB0aGlzLl9kZWNvZGVUeXBlNlNoYWRpbmcocmVhZGVyKTsKICAgICAgICBwYXRjaE1lc2ggPSB0cnVlOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFNoYWRpbmdUeXBlLlRFTlNPUl9QQVRDSF9NRVNIOgogICAgICAgIHRoaXMuX2RlY29kZVR5cGU3U2hhZGluZyhyZWFkZXIpOwogICAgICAgIHBhdGNoTWVzaCA9IHRydWU7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdW5yZWFjaGFibGUoIlVuc3VwcG9ydGVkIG1lc2ggdHlwZS4iKTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGlmIChwYXRjaE1lc2gpIHsKICAgICAgdGhpcy5fdXBkYXRlQm91bmRzKCk7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHRoaXMuZmlndXJlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgdGhpcy5fYnVpbGRGaWd1cmVGcm9tUGF0Y2goaSk7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuX3VwZGF0ZUJvdW5kcygpOwogICAgdGhpcy5fcGFja0RhdGEoKTsKICB9CiAgX2RlY29kZVR5cGU0U2hhZGluZyhyZWFkZXIpIHsKICAgIGNvbnN0IGNvb3JkcyA9IHRoaXMuY29vcmRzOwogICAgY29uc3QgY29sb3JzID0gdGhpcy5jb2xvcnM7CiAgICBjb25zdCBvcGVyYXRvcnMgPSBbXTsKICAgIGNvbnN0IHBzID0gW107CiAgICBsZXQgdmVydGljZXNMZWZ0ID0gMDsKICAgIHdoaWxlIChyZWFkZXIuaGFzRGF0YSkgewogICAgICBjb25zdCBmID0gcmVhZGVyLnJlYWRGbGFnKCk7CiAgICAgIGNvbnN0IGNvb3JkID0gcmVhZGVyLnJlYWRDb29yZGluYXRlKCk7CiAgICAgIGNvbnN0IGNvbG9yID0gcmVhZGVyLnJlYWRDb21wb25lbnRzKCk7CiAgICAgIGlmICh2ZXJ0aWNlc0xlZnQgPT09IDApIHsKICAgICAgICBpZiAoISgwIDw9IGYgJiYgZiA8PSAyKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJVbmtub3duIHR5cGU0IGZsYWciKTsKICAgICAgICB9CiAgICAgICAgc3dpdGNoIChmKSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHZlcnRpY2VzTGVmdCA9IDM7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBwcy5wdXNoKHBzLmF0KC0yKSwgcHMuYXQoLTEpKTsKICAgICAgICAgICAgdmVydGljZXNMZWZ0ID0gMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHBzLnB1c2gocHMuYXQoLTMpLCBwcy5hdCgtMSkpOwogICAgICAgICAgICB2ZXJ0aWNlc0xlZnQgPSAxOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgb3BlcmF0b3JzLnB1c2goZik7CiAgICAgIH0KICAgICAgcHMucHVzaChjb29yZHMubGVuZ3RoKTsKICAgICAgY29vcmRzLnB1c2goY29vcmQpOwogICAgICBjb2xvcnMucHVzaChjb2xvcik7CiAgICAgIHZlcnRpY2VzTGVmdC0tOwogICAgICByZWFkZXIuYWxpZ24oKTsKICAgIH0KICAgIHRoaXMuZmlndXJlcy5wdXNoKHsKICAgICAgdHlwZTogInRyaWFuZ2xlcyIsCiAgICAgIGNvb3JkczogbmV3IEludDMyQXJyYXkocHMpLAogICAgICBjb2xvcnM6IG5ldyBJbnQzMkFycmF5KHBzKQogICAgfSk7CiAgfQogIF9kZWNvZGVUeXBlNVNoYWRpbmcocmVhZGVyLCB2ZXJ0aWNlc1BlclJvdykgewogICAgY29uc3QgY29vcmRzID0gdGhpcy5jb29yZHM7CiAgICBjb25zdCBjb2xvcnMgPSB0aGlzLmNvbG9yczsKICAgIGNvbnN0IHBzID0gW107CiAgICB3aGlsZSAocmVhZGVyLmhhc0RhdGEpIHsKICAgICAgY29uc3QgY29vcmQgPSByZWFkZXIucmVhZENvb3JkaW5hdGUoKTsKICAgICAgY29uc3QgY29sb3IgPSByZWFkZXIucmVhZENvbXBvbmVudHMoKTsKICAgICAgcHMucHVzaChjb29yZHMubGVuZ3RoKTsKICAgICAgY29vcmRzLnB1c2goY29vcmQpOwogICAgICBjb2xvcnMucHVzaChjb2xvcik7CiAgICB9CiAgICB0aGlzLmZpZ3VyZXMucHVzaCh7CiAgICAgIHR5cGU6ICJsYXR0aWNlIiwKICAgICAgY29vcmRzOiBuZXcgSW50MzJBcnJheShwcyksCiAgICAgIGNvbG9yczogbmV3IEludDMyQXJyYXkocHMpLAogICAgICB2ZXJ0aWNlc1BlclJvdwogICAgfSk7CiAgfQogIF9kZWNvZGVUeXBlNlNoYWRpbmcocmVhZGVyKSB7CiAgICBjb25zdCBjb29yZHMgPSB0aGlzLmNvb3JkczsKICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuY29sb3JzOwogICAgY29uc3QgcHMgPSBuZXcgSW50MzJBcnJheSgxNik7CiAgICBjb25zdCBjcyA9IG5ldyBJbnQzMkFycmF5KDQpOwogICAgd2hpbGUgKHJlYWRlci5oYXNEYXRhKSB7CiAgICAgIGNvbnN0IGYgPSByZWFkZXIucmVhZEZsYWcoKTsKICAgICAgaWYgKCEoMCA8PSBmICYmIGYgPD0gMykpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlVua25vd24gdHlwZTYgZmxhZyIpOwogICAgICB9CiAgICAgIGNvbnN0IHBpID0gY29vcmRzLmxlbmd0aDsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZiAhPT0gMCA/IDggOiAxMjsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb29yZHMucHVzaChyZWFkZXIucmVhZENvb3JkaW5hdGUoKSk7CiAgICAgIH0KICAgICAgY29uc3QgY2kgPSBjb2xvcnMubGVuZ3RoOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBmICE9PSAwID8gMiA6IDQ7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29sb3JzLnB1c2gocmVhZGVyLnJlYWRDb21wb25lbnRzKCkpOwogICAgICB9CiAgICAgIGxldCB0bXAxLCB0bXAyLCB0bXAzLCB0bXA0OwogICAgICBzd2l0Y2ggKGYpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBwc1sxMl0gPSBwaSArIDM7CiAgICAgICAgICBwc1sxM10gPSBwaSArIDQ7CiAgICAgICAgICBwc1sxNF0gPSBwaSArIDU7CiAgICAgICAgICBwc1sxNV0gPSBwaSArIDY7CiAgICAgICAgICBwc1s4XSA9IHBpICsgMjsKICAgICAgICAgIHBzWzExXSA9IHBpICsgNzsKICAgICAgICAgIHBzWzRdID0gcGkgKyAxOwogICAgICAgICAgcHNbN10gPSBwaSArIDg7CiAgICAgICAgICBwc1swXSA9IHBpOwogICAgICAgICAgcHNbMV0gPSBwaSArIDExOwogICAgICAgICAgcHNbMl0gPSBwaSArIDEwOwogICAgICAgICAgcHNbM10gPSBwaSArIDk7CiAgICAgICAgICBjc1syXSA9IGNpICsgMTsKICAgICAgICAgIGNzWzNdID0gY2kgKyAyOwogICAgICAgICAgY3NbMF0gPSBjaTsKICAgICAgICAgIGNzWzFdID0gY2kgKyAzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgdG1wMSA9IHBzWzEyXTsKICAgICAgICAgIHRtcDIgPSBwc1sxM107CiAgICAgICAgICB0bXAzID0gcHNbMTRdOwogICAgICAgICAgdG1wNCA9IHBzWzE1XTsKICAgICAgICAgIHBzWzEyXSA9IHRtcDQ7CiAgICAgICAgICBwc1sxM10gPSBwaSArIDA7CiAgICAgICAgICBwc1sxNF0gPSBwaSArIDE7CiAgICAgICAgICBwc1sxNV0gPSBwaSArIDI7CiAgICAgICAgICBwc1s4XSA9IHRtcDM7CiAgICAgICAgICBwc1sxMV0gPSBwaSArIDM7CiAgICAgICAgICBwc1s0XSA9IHRtcDI7CiAgICAgICAgICBwc1s3XSA9IHBpICsgNDsKICAgICAgICAgIHBzWzBdID0gdG1wMTsKICAgICAgICAgIHBzWzFdID0gcGkgKyA3OwogICAgICAgICAgcHNbMl0gPSBwaSArIDY7CiAgICAgICAgICBwc1szXSA9IHBpICsgNTsKICAgICAgICAgIHRtcDEgPSBjc1syXTsKICAgICAgICAgIHRtcDIgPSBjc1szXTsKICAgICAgICAgIGNzWzJdID0gdG1wMjsKICAgICAgICAgIGNzWzNdID0gY2k7CiAgICAgICAgICBjc1swXSA9IHRtcDE7CiAgICAgICAgICBjc1sxXSA9IGNpICsgMTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHRtcDEgPSBwc1sxNV07CiAgICAgICAgICB0bXAyID0gcHNbMTFdOwogICAgICAgICAgcHNbMTJdID0gcHNbM107CiAgICAgICAgICBwc1sxM10gPSBwaSArIDA7CiAgICAgICAgICBwc1sxNF0gPSBwaSArIDE7CiAgICAgICAgICBwc1sxNV0gPSBwaSArIDI7CiAgICAgICAgICBwc1s4XSA9IHBzWzddOwogICAgICAgICAgcHNbMTFdID0gcGkgKyAzOwogICAgICAgICAgcHNbNF0gPSB0bXAyOwogICAgICAgICAgcHNbN10gPSBwaSArIDQ7CiAgICAgICAgICBwc1swXSA9IHRtcDE7CiAgICAgICAgICBwc1sxXSA9IHBpICsgNzsKICAgICAgICAgIHBzWzJdID0gcGkgKyA2OwogICAgICAgICAgcHNbM10gPSBwaSArIDU7CiAgICAgICAgICB0bXAxID0gY3NbM107CiAgICAgICAgICBjc1syXSA9IGNzWzFdOwogICAgICAgICAgY3NbM10gPSBjaTsKICAgICAgICAgIGNzWzBdID0gdG1wMTsKICAgICAgICAgIGNzWzFdID0gY2kgKyAxOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzOgogICAgICAgICAgcHNbMTJdID0gcHNbMF07CiAgICAgICAgICBwc1sxM10gPSBwaSArIDA7CiAgICAgICAgICBwc1sxNF0gPSBwaSArIDE7CiAgICAgICAgICBwc1sxNV0gPSBwaSArIDI7CiAgICAgICAgICBwc1s4XSA9IHBzWzFdOwogICAgICAgICAgcHNbMTFdID0gcGkgKyAzOwogICAgICAgICAgcHNbNF0gPSBwc1syXTsKICAgICAgICAgIHBzWzddID0gcGkgKyA0OwogICAgICAgICAgcHNbMF0gPSBwc1szXTsKICAgICAgICAgIHBzWzFdID0gcGkgKyA3OwogICAgICAgICAgcHNbMl0gPSBwaSArIDY7CiAgICAgICAgICBwc1szXSA9IHBpICsgNTsKICAgICAgICAgIGNzWzJdID0gY3NbMF07CiAgICAgICAgICBjc1szXSA9IGNpOwogICAgICAgICAgY3NbMF0gPSBjc1sxXTsKICAgICAgICAgIGNzWzFdID0gY2kgKyAxOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgcHNbNV0gPSBjb29yZHMubGVuZ3RoOwogICAgICBjb29yZHMucHVzaChbKC00ICogY29vcmRzW3BzWzBdXVswXSAtIGNvb3Jkc1twc1sxNV1dWzBdICsgNiAqIChjb29yZHNbcHNbNF1dWzBdICsgY29vcmRzW3BzWzFdXVswXSkgLSAyICogKGNvb3Jkc1twc1sxMl1dWzBdICsgY29vcmRzW3BzWzNdXVswXSkgKyAzICogKGNvb3Jkc1twc1sxM11dWzBdICsgY29vcmRzW3BzWzddXVswXSkpIC8gOSwgKC00ICogY29vcmRzW3BzWzBdXVsxXSAtIGNvb3Jkc1twc1sxNV1dWzFdICsgNiAqIChjb29yZHNbcHNbNF1dWzFdICsgY29vcmRzW3BzWzFdXVsxXSkgLSAyICogKGNvb3Jkc1twc1sxMl1dWzFdICsgY29vcmRzW3BzWzNdXVsxXSkgKyAzICogKGNvb3Jkc1twc1sxM11dWzFdICsgY29vcmRzW3BzWzddXVsxXSkpIC8gOV0pOwogICAgICBwc1s2XSA9IGNvb3Jkcy5sZW5ndGg7CiAgICAgIGNvb3Jkcy5wdXNoKFsoLTQgKiBjb29yZHNbcHNbM11dWzBdIC0gY29vcmRzW3BzWzEyXV1bMF0gKyA2ICogKGNvb3Jkc1twc1syXV1bMF0gKyBjb29yZHNbcHNbN11dWzBdKSAtIDIgKiAoY29vcmRzW3BzWzBdXVswXSArIGNvb3Jkc1twc1sxNV1dWzBdKSArIDMgKiAoY29vcmRzW3BzWzRdXVswXSArIGNvb3Jkc1twc1sxNF1dWzBdKSkgLyA5LCAoLTQgKiBjb29yZHNbcHNbM11dWzFdIC0gY29vcmRzW3BzWzEyXV1bMV0gKyA2ICogKGNvb3Jkc1twc1syXV1bMV0gKyBjb29yZHNbcHNbN11dWzFdKSAtIDIgKiAoY29vcmRzW3BzWzBdXVsxXSArIGNvb3Jkc1twc1sxNV1dWzFdKSArIDMgKiAoY29vcmRzW3BzWzRdXVsxXSArIGNvb3Jkc1twc1sxNF1dWzFdKSkgLyA5XSk7CiAgICAgIHBzWzldID0gY29vcmRzLmxlbmd0aDsKICAgICAgY29vcmRzLnB1c2goWygtNCAqIGNvb3Jkc1twc1sxMl1dWzBdIC0gY29vcmRzW3BzWzNdXVswXSArIDYgKiAoY29vcmRzW3BzWzhdXVswXSArIGNvb3Jkc1twc1sxM11dWzBdKSAtIDIgKiAoY29vcmRzW3BzWzBdXVswXSArIGNvb3Jkc1twc1sxNV1dWzBdKSArIDMgKiAoY29vcmRzW3BzWzExXV1bMF0gKyBjb29yZHNbcHNbMV1dWzBdKSkgLyA5LCAoLTQgKiBjb29yZHNbcHNbMTJdXVsxXSAtIGNvb3Jkc1twc1szXV1bMV0gKyA2ICogKGNvb3Jkc1twc1s4XV1bMV0gKyBjb29yZHNbcHNbMTNdXVsxXSkgLSAyICogKGNvb3Jkc1twc1swXV1bMV0gKyBjb29yZHNbcHNbMTVdXVsxXSkgKyAzICogKGNvb3Jkc1twc1sxMV1dWzFdICsgY29vcmRzW3BzWzFdXVsxXSkpIC8gOV0pOwogICAgICBwc1sxMF0gPSBjb29yZHMubGVuZ3RoOwogICAgICBjb29yZHMucHVzaChbKC00ICogY29vcmRzW3BzWzE1XV1bMF0gLSBjb29yZHNbcHNbMF1dWzBdICsgNiAqIChjb29yZHNbcHNbMTFdXVswXSArIGNvb3Jkc1twc1sxNF1dWzBdKSAtIDIgKiAoY29vcmRzW3BzWzEyXV1bMF0gKyBjb29yZHNbcHNbM11dWzBdKSArIDMgKiAoY29vcmRzW3BzWzJdXVswXSArIGNvb3Jkc1twc1s4XV1bMF0pKSAvIDksICgtNCAqIGNvb3Jkc1twc1sxNV1dWzFdIC0gY29vcmRzW3BzWzBdXVsxXSArIDYgKiAoY29vcmRzW3BzWzExXV1bMV0gKyBjb29yZHNbcHNbMTRdXVsxXSkgLSAyICogKGNvb3Jkc1twc1sxMl1dWzFdICsgY29vcmRzW3BzWzNdXVsxXSkgKyAzICogKGNvb3Jkc1twc1syXV1bMV0gKyBjb29yZHNbcHNbOF1dWzFdKSkgLyA5XSk7CiAgICAgIHRoaXMuZmlndXJlcy5wdXNoKHsKICAgICAgICB0eXBlOiAicGF0Y2giLAogICAgICAgIGNvb3JkczogbmV3IEludDMyQXJyYXkocHMpLAogICAgICAgIGNvbG9yczogbmV3IEludDMyQXJyYXkoY3MpCiAgICAgIH0pOwogICAgfQogIH0KICBfZGVjb2RlVHlwZTdTaGFkaW5nKHJlYWRlcikgewogICAgY29uc3QgY29vcmRzID0gdGhpcy5jb29yZHM7CiAgICBjb25zdCBjb2xvcnMgPSB0aGlzLmNvbG9yczsKICAgIGNvbnN0IHBzID0gbmV3IEludDMyQXJyYXkoMTYpOwogICAgY29uc3QgY3MgPSBuZXcgSW50MzJBcnJheSg0KTsKICAgIHdoaWxlIChyZWFkZXIuaGFzRGF0YSkgewogICAgICBjb25zdCBmID0gcmVhZGVyLnJlYWRGbGFnKCk7CiAgICAgIGlmICghKDAgPD0gZiAmJiBmIDw9IDMpKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJVbmtub3duIHR5cGU3IGZsYWciKTsKICAgICAgfQogICAgICBjb25zdCBwaSA9IGNvb3Jkcy5sZW5ndGg7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGYgIT09IDAgPyAxMiA6IDE2OyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvb3Jkcy5wdXNoKHJlYWRlci5yZWFkQ29vcmRpbmF0ZSgpKTsKICAgICAgfQogICAgICBjb25zdCBjaSA9IGNvbG9ycy5sZW5ndGg7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGYgIT09IDAgPyAyIDogNDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb2xvcnMucHVzaChyZWFkZXIucmVhZENvbXBvbmVudHMoKSk7CiAgICAgIH0KICAgICAgbGV0IHRtcDEsIHRtcDIsIHRtcDMsIHRtcDQ7CiAgICAgIHN3aXRjaCAoZikgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHBzWzEyXSA9IHBpICsgMzsKICAgICAgICAgIHBzWzEzXSA9IHBpICsgNDsKICAgICAgICAgIHBzWzE0XSA9IHBpICsgNTsKICAgICAgICAgIHBzWzE1XSA9IHBpICsgNjsKICAgICAgICAgIHBzWzhdID0gcGkgKyAyOwogICAgICAgICAgcHNbOV0gPSBwaSArIDEzOwogICAgICAgICAgcHNbMTBdID0gcGkgKyAxNDsKICAgICAgICAgIHBzWzExXSA9IHBpICsgNzsKICAgICAgICAgIHBzWzRdID0gcGkgKyAxOwogICAgICAgICAgcHNbNV0gPSBwaSArIDEyOwogICAgICAgICAgcHNbNl0gPSBwaSArIDE1OwogICAgICAgICAgcHNbN10gPSBwaSArIDg7CiAgICAgICAgICBwc1swXSA9IHBpOwogICAgICAgICAgcHNbMV0gPSBwaSArIDExOwogICAgICAgICAgcHNbMl0gPSBwaSArIDEwOwogICAgICAgICAgcHNbM10gPSBwaSArIDk7CiAgICAgICAgICBjc1syXSA9IGNpICsgMTsKICAgICAgICAgIGNzWzNdID0gY2kgKyAyOwogICAgICAgICAgY3NbMF0gPSBjaTsKICAgICAgICAgIGNzWzFdID0gY2kgKyAzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgdG1wMSA9IHBzWzEyXTsKICAgICAgICAgIHRtcDIgPSBwc1sxM107CiAgICAgICAgICB0bXAzID0gcHNbMTRdOwogICAgICAgICAgdG1wNCA9IHBzWzE1XTsKICAgICAgICAgIHBzWzEyXSA9IHRtcDQ7CiAgICAgICAgICBwc1sxM10gPSBwaSArIDA7CiAgICAgICAgICBwc1sxNF0gPSBwaSArIDE7CiAgICAgICAgICBwc1sxNV0gPSBwaSArIDI7CiAgICAgICAgICBwc1s4XSA9IHRtcDM7CiAgICAgICAgICBwc1s5XSA9IHBpICsgOTsKICAgICAgICAgIHBzWzEwXSA9IHBpICsgMTA7CiAgICAgICAgICBwc1sxMV0gPSBwaSArIDM7CiAgICAgICAgICBwc1s0XSA9IHRtcDI7CiAgICAgICAgICBwc1s1XSA9IHBpICsgODsKICAgICAgICAgIHBzWzZdID0gcGkgKyAxMTsKICAgICAgICAgIHBzWzddID0gcGkgKyA0OwogICAgICAgICAgcHNbMF0gPSB0bXAxOwogICAgICAgICAgcHNbMV0gPSBwaSArIDc7CiAgICAgICAgICBwc1syXSA9IHBpICsgNjsKICAgICAgICAgIHBzWzNdID0gcGkgKyA1OwogICAgICAgICAgdG1wMSA9IGNzWzJdOwogICAgICAgICAgdG1wMiA9IGNzWzNdOwogICAgICAgICAgY3NbMl0gPSB0bXAyOwogICAgICAgICAgY3NbM10gPSBjaTsKICAgICAgICAgIGNzWzBdID0gdG1wMTsKICAgICAgICAgIGNzWzFdID0gY2kgKyAxOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyOgogICAgICAgICAgdG1wMSA9IHBzWzE1XTsKICAgICAgICAgIHRtcDIgPSBwc1sxMV07CiAgICAgICAgICBwc1sxMl0gPSBwc1szXTsKICAgICAgICAgIHBzWzEzXSA9IHBpICsgMDsKICAgICAgICAgIHBzWzE0XSA9IHBpICsgMTsKICAgICAgICAgIHBzWzE1XSA9IHBpICsgMjsKICAgICAgICAgIHBzWzhdID0gcHNbN107CiAgICAgICAgICBwc1s5XSA9IHBpICsgOTsKICAgICAgICAgIHBzWzEwXSA9IHBpICsgMTA7CiAgICAgICAgICBwc1sxMV0gPSBwaSArIDM7CiAgICAgICAgICBwc1s0XSA9IHRtcDI7CiAgICAgICAgICBwc1s1XSA9IHBpICsgODsKICAgICAgICAgIHBzWzZdID0gcGkgKyAxMTsKICAgICAgICAgIHBzWzddID0gcGkgKyA0OwogICAgICAgICAgcHNbMF0gPSB0bXAxOwogICAgICAgICAgcHNbMV0gPSBwaSArIDc7CiAgICAgICAgICBwc1syXSA9IHBpICsgNjsKICAgICAgICAgIHBzWzNdID0gcGkgKyA1OwogICAgICAgICAgdG1wMSA9IGNzWzNdOwogICAgICAgICAgY3NbMl0gPSBjc1sxXTsKICAgICAgICAgIGNzWzNdID0gY2k7CiAgICAgICAgICBjc1swXSA9IHRtcDE7CiAgICAgICAgICBjc1sxXSA9IGNpICsgMTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMzoKICAgICAgICAgIHBzWzEyXSA9IHBzWzBdOwogICAgICAgICAgcHNbMTNdID0gcGkgKyAwOwogICAgICAgICAgcHNbMTRdID0gcGkgKyAxOwogICAgICAgICAgcHNbMTVdID0gcGkgKyAyOwogICAgICAgICAgcHNbOF0gPSBwc1sxXTsKICAgICAgICAgIHBzWzldID0gcGkgKyA5OwogICAgICAgICAgcHNbMTBdID0gcGkgKyAxMDsKICAgICAgICAgIHBzWzExXSA9IHBpICsgMzsKICAgICAgICAgIHBzWzRdID0gcHNbMl07CiAgICAgICAgICBwc1s1XSA9IHBpICsgODsKICAgICAgICAgIHBzWzZdID0gcGkgKyAxMTsKICAgICAgICAgIHBzWzddID0gcGkgKyA0OwogICAgICAgICAgcHNbMF0gPSBwc1szXTsKICAgICAgICAgIHBzWzFdID0gcGkgKyA3OwogICAgICAgICAgcHNbMl0gPSBwaSArIDY7CiAgICAgICAgICBwc1szXSA9IHBpICsgNTsKICAgICAgICAgIGNzWzJdID0gY3NbMF07CiAgICAgICAgICBjc1szXSA9IGNpOwogICAgICAgICAgY3NbMF0gPSBjc1sxXTsKICAgICAgICAgIGNzWzFdID0gY2kgKyAxOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgdGhpcy5maWd1cmVzLnB1c2goewogICAgICAgIHR5cGU6ICJwYXRjaCIsCiAgICAgICAgY29vcmRzOiBuZXcgSW50MzJBcnJheShwcyksCiAgICAgICAgY29sb3JzOiBuZXcgSW50MzJBcnJheShjcykKICAgICAgfSk7CiAgICB9CiAgfQogIF9idWlsZEZpZ3VyZUZyb21QYXRjaChpbmRleCkgewogICAgY29uc3QgZmlndXJlID0gdGhpcy5maWd1cmVzW2luZGV4XTsKICAgIGFzc2VydChmaWd1cmUudHlwZSA9PT0gInBhdGNoIiwgIlVuZXhwZWN0ZWQgcGF0Y2ggbWVzaCBmaWd1cmUiKTsKICAgIGNvbnN0IGNvb3JkcyA9IHRoaXMuY29vcmRzLAogICAgICBjb2xvcnMgPSB0aGlzLmNvbG9yczsKICAgIGNvbnN0IHBpID0gZmlndXJlLmNvb3JkczsKICAgIGNvbnN0IGNpID0gZmlndXJlLmNvbG9yczsKICAgIGNvbnN0IGZpZ3VyZU1pblggPSBNYXRoLm1pbihjb29yZHNbcGlbMF1dWzBdLCBjb29yZHNbcGlbM11dWzBdLCBjb29yZHNbcGlbMTJdXVswXSwgY29vcmRzW3BpWzE1XV1bMF0pOwogICAgY29uc3QgZmlndXJlTWluWSA9IE1hdGgubWluKGNvb3Jkc1twaVswXV1bMV0sIGNvb3Jkc1twaVszXV1bMV0sIGNvb3Jkc1twaVsxMl1dWzFdLCBjb29yZHNbcGlbMTVdXVsxXSk7CiAgICBjb25zdCBmaWd1cmVNYXhYID0gTWF0aC5tYXgoY29vcmRzW3BpWzBdXVswXSwgY29vcmRzW3BpWzNdXVswXSwgY29vcmRzW3BpWzEyXV1bMF0sIGNvb3Jkc1twaVsxNV1dWzBdKTsKICAgIGNvbnN0IGZpZ3VyZU1heFkgPSBNYXRoLm1heChjb29yZHNbcGlbMF1dWzFdLCBjb29yZHNbcGlbM11dWzFdLCBjb29yZHNbcGlbMTJdXVsxXSwgY29vcmRzW3BpWzE1XV1bMV0pOwogICAgbGV0IHNwbGl0WEJ5ID0gTWF0aC5jZWlsKChmaWd1cmVNYXhYIC0gZmlndXJlTWluWCkgKiBNZXNoU2hhZGluZy5UUklBTkdMRV9ERU5TSVRZIC8gKHRoaXMuYm91bmRzWzJdIC0gdGhpcy5ib3VuZHNbMF0pKTsKICAgIHNwbGl0WEJ5ID0gTWF0aENsYW1wKHNwbGl0WEJ5LCBNZXNoU2hhZGluZy5NSU5fU1BMSVRfUEFUQ0hfQ0hVTktTX0FNT1VOVCwgTWVzaFNoYWRpbmcuTUFYX1NQTElUX1BBVENIX0NIVU5LU19BTU9VTlQpOwogICAgbGV0IHNwbGl0WUJ5ID0gTWF0aC5jZWlsKChmaWd1cmVNYXhZIC0gZmlndXJlTWluWSkgKiBNZXNoU2hhZGluZy5UUklBTkdMRV9ERU5TSVRZIC8gKHRoaXMuYm91bmRzWzNdIC0gdGhpcy5ib3VuZHNbMV0pKTsKICAgIHNwbGl0WUJ5ID0gTWF0aENsYW1wKHNwbGl0WUJ5LCBNZXNoU2hhZGluZy5NSU5fU1BMSVRfUEFUQ0hfQ0hVTktTX0FNT1VOVCwgTWVzaFNoYWRpbmcuTUFYX1NQTElUX1BBVENIX0NIVU5LU19BTU9VTlQpOwogICAgY29uc3QgdmVydGljZXNQZXJSb3cgPSBzcGxpdFhCeSArIDE7CiAgICBjb25zdCBmaWd1cmVDb29yZHMgPSBuZXcgSW50MzJBcnJheSgoc3BsaXRZQnkgKyAxKSAqIHZlcnRpY2VzUGVyUm93KTsKICAgIGNvbnN0IGZpZ3VyZUNvbG9ycyA9IG5ldyBJbnQzMkFycmF5KChzcGxpdFlCeSArIDEpICogdmVydGljZXNQZXJSb3cpOwogICAgbGV0IGsgPSAwOwogICAgY29uc3QgY2wgPSBuZXcgVWludDhBcnJheSgzKSwKICAgICAgY3IgPSBuZXcgVWludDhBcnJheSgzKTsKICAgIGNvbnN0IGMwID0gY29sb3JzW2NpWzBdXSwKICAgICAgYzEgPSBjb2xvcnNbY2lbMV1dLAogICAgICBjMiA9IGNvbG9yc1tjaVsyXV0sCiAgICAgIGMzID0gY29sb3JzW2NpWzNdXTsKICAgIGNvbnN0IGJSb3cgPSBnZXRCKHNwbGl0WUJ5KSwKICAgICAgYkNvbCA9IGdldEIoc3BsaXRYQnkpOwogICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDw9IHNwbGl0WUJ5OyByb3crKykgewogICAgICBjbFswXSA9IChjMFswXSAqIChzcGxpdFlCeSAtIHJvdykgKyBjMlswXSAqIHJvdykgLyBzcGxpdFlCeSB8IDA7CiAgICAgIGNsWzFdID0gKGMwWzFdICogKHNwbGl0WUJ5IC0gcm93KSArIGMyWzFdICogcm93KSAvIHNwbGl0WUJ5IHwgMDsKICAgICAgY2xbMl0gPSAoYzBbMl0gKiAoc3BsaXRZQnkgLSByb3cpICsgYzJbMl0gKiByb3cpIC8gc3BsaXRZQnkgfCAwOwogICAgICBjclswXSA9IChjMVswXSAqIChzcGxpdFlCeSAtIHJvdykgKyBjM1swXSAqIHJvdykgLyBzcGxpdFlCeSB8IDA7CiAgICAgIGNyWzFdID0gKGMxWzFdICogKHNwbGl0WUJ5IC0gcm93KSArIGMzWzFdICogcm93KSAvIHNwbGl0WUJ5IHwgMDsKICAgICAgY3JbMl0gPSAoYzFbMl0gKiAoc3BsaXRZQnkgLSByb3cpICsgYzNbMl0gKiByb3cpIC8gc3BsaXRZQnkgfCAwOwogICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPD0gc3BsaXRYQnk7IGNvbCsrLCBrKyspIHsKICAgICAgICBpZiAoKHJvdyA9PT0gMCB8fCByb3cgPT09IHNwbGl0WUJ5KSAmJiAoY29sID09PSAwIHx8IGNvbCA9PT0gc3BsaXRYQnkpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgbGV0IHggPSAwLAogICAgICAgICAgeSA9IDA7CiAgICAgICAgbGV0IHEgPSAwOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IDM7IGkrKykgewogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPD0gMzsgaisrLCBxKyspIHsKICAgICAgICAgICAgY29uc3QgbSA9IGJSb3dbcm93XVtpXSAqIGJDb2xbY29sXVtqXTsKICAgICAgICAgICAgeCArPSBjb29yZHNbcGlbcV1dWzBdICogbTsKICAgICAgICAgICAgeSArPSBjb29yZHNbcGlbcV1dWzFdICogbTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmlndXJlQ29vcmRzW2tdID0gY29vcmRzLmxlbmd0aDsKICAgICAgICBjb29yZHMucHVzaChbeCwgeV0pOwogICAgICAgIGZpZ3VyZUNvbG9yc1trXSA9IGNvbG9ycy5sZW5ndGg7CiAgICAgICAgY29uc3QgbmV3Q29sb3IgPSBuZXcgVWludDhBcnJheSgzKTsKICAgICAgICBuZXdDb2xvclswXSA9IChjbFswXSAqIChzcGxpdFhCeSAtIGNvbCkgKyBjclswXSAqIGNvbCkgLyBzcGxpdFhCeSB8IDA7CiAgICAgICAgbmV3Q29sb3JbMV0gPSAoY2xbMV0gKiAoc3BsaXRYQnkgLSBjb2wpICsgY3JbMV0gKiBjb2wpIC8gc3BsaXRYQnkgfCAwOwogICAgICAgIG5ld0NvbG9yWzJdID0gKGNsWzJdICogKHNwbGl0WEJ5IC0gY29sKSArIGNyWzJdICogY29sKSAvIHNwbGl0WEJ5IHwgMDsKICAgICAgICBjb2xvcnMucHVzaChuZXdDb2xvcik7CiAgICAgIH0KICAgIH0KICAgIGZpZ3VyZUNvb3Jkc1swXSA9IHBpWzBdOwogICAgZmlndXJlQ29sb3JzWzBdID0gY2lbMF07CiAgICBmaWd1cmVDb29yZHNbc3BsaXRYQnldID0gcGlbM107CiAgICBmaWd1cmVDb2xvcnNbc3BsaXRYQnldID0gY2lbMV07CiAgICBmaWd1cmVDb29yZHNbdmVydGljZXNQZXJSb3cgKiBzcGxpdFlCeV0gPSBwaVsxMl07CiAgICBmaWd1cmVDb2xvcnNbdmVydGljZXNQZXJSb3cgKiBzcGxpdFlCeV0gPSBjaVsyXTsKICAgIGZpZ3VyZUNvb3Jkc1t2ZXJ0aWNlc1BlclJvdyAqIHNwbGl0WUJ5ICsgc3BsaXRYQnldID0gcGlbMTVdOwogICAgZmlndXJlQ29sb3JzW3ZlcnRpY2VzUGVyUm93ICogc3BsaXRZQnkgKyBzcGxpdFhCeV0gPSBjaVszXTsKICAgIHRoaXMuZmlndXJlc1tpbmRleF0gPSB7CiAgICAgIHR5cGU6ICJsYXR0aWNlIiwKICAgICAgY29vcmRzOiBmaWd1cmVDb29yZHMsCiAgICAgIGNvbG9yczogZmlndXJlQ29sb3JzLAogICAgICB2ZXJ0aWNlc1BlclJvdwogICAgfTsKICB9CiAgX3VwZGF0ZUJvdW5kcygpIHsKICAgIGxldCBtaW5YID0gdGhpcy5jb29yZHNbMF1bMF0sCiAgICAgIG1pblkgPSB0aGlzLmNvb3Jkc1swXVsxXSwKICAgICAgbWF4WCA9IG1pblgsCiAgICAgIG1heFkgPSBtaW5ZOwogICAgZm9yIChsZXQgaSA9IDEsIGlpID0gdGhpcy5jb29yZHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCB4ID0gdGhpcy5jb29yZHNbaV1bMF0sCiAgICAgICAgeSA9IHRoaXMuY29vcmRzW2ldWzFdOwogICAgICBtaW5YID0gbWluWCA+IHggPyB4IDogbWluWDsKICAgICAgbWluWSA9IG1pblkgPiB5ID8geSA6IG1pblk7CiAgICAgIG1heFggPSBtYXhYIDwgeCA/IHggOiBtYXhYOwogICAgICBtYXhZID0gbWF4WSA8IHkgPyB5IDogbWF4WTsKICAgIH0KICAgIHRoaXMuYm91bmRzID0gW21pblgsIG1pblksIG1heFgsIG1heFldOwogIH0KICBfcGFja0RhdGEoKSB7CiAgICBsZXQgaSwgaWksIGosIGpqOwogICAgY29uc3QgY29vcmRzID0gdGhpcy5jb29yZHM7CiAgICBjb25zdCBjb29yZHNQYWNrZWQgPSBuZXcgRmxvYXQzMkFycmF5KGNvb3Jkcy5sZW5ndGggKiAyKTsKICAgIGZvciAoaSA9IDAsIGogPSAwLCBpaSA9IGNvb3Jkcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IHh5ID0gY29vcmRzW2ldOwogICAgICBjb29yZHNQYWNrZWRbaisrXSA9IHh5WzBdOwogICAgICBjb29yZHNQYWNrZWRbaisrXSA9IHh5WzFdOwogICAgfQogICAgdGhpcy5jb29yZHMgPSBjb29yZHNQYWNrZWQ7CiAgICBjb25zdCBjb2xvcnMgPSB0aGlzLmNvbG9yczsKICAgIGNvbnN0IGNvbG9yc1BhY2tlZCA9IG5ldyBVaW50OEFycmF5KGNvbG9ycy5sZW5ndGggKiAzKTsKICAgIGZvciAoaSA9IDAsIGogPSAwLCBpaSA9IGNvbG9ycy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IGMgPSBjb2xvcnNbaV07CiAgICAgIGNvbG9yc1BhY2tlZFtqKytdID0gY1swXTsKICAgICAgY29sb3JzUGFja2VkW2orK10gPSBjWzFdOwogICAgICBjb2xvcnNQYWNrZWRbaisrXSA9IGNbMl07CiAgICB9CiAgICB0aGlzLmNvbG9ycyA9IGNvbG9yc1BhY2tlZDsKICAgIGNvbnN0IGZpZ3VyZXMgPSB0aGlzLmZpZ3VyZXM7CiAgICBmb3IgKGkgPSAwLCBpaSA9IGZpZ3VyZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBmaWd1cmUgPSBmaWd1cmVzW2ldLAogICAgICAgIHBzID0gZmlndXJlLmNvb3JkcywKICAgICAgICBjcyA9IGZpZ3VyZS5jb2xvcnM7CiAgICAgIGZvciAoaiA9IDAsIGpqID0gcHMubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgIHBzW2pdICo9IDI7CiAgICAgICAgY3Nbal0gKj0gMzsKICAgICAgfQogICAgfQogIH0KICBnZXRJUigpIHsKICAgIGNvbnN0IHsKICAgICAgYm91bmRzCiAgICB9ID0gdGhpczsKICAgIGlmIChib3VuZHNbMl0gLSBib3VuZHNbMF0gPT09IDAgfHwgYm91bmRzWzNdIC0gYm91bmRzWzFdID09PSAwKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBNZXNoU2hhZGluZyBib3VuZHM6IFske2JvdW5kc31dLmApOwogICAgfQogICAgcmV0dXJuIFsiTWVzaCIsIHRoaXMuc2hhZGluZ1R5cGUsIHRoaXMuY29vcmRzLCB0aGlzLmNvbG9ycywgdGhpcy5maWd1cmVzLCBib3VuZHMsIHRoaXMuYmJveCwgdGhpcy5iYWNrZ3JvdW5kXTsKICB9Cn0KY2xhc3MgRHVtbXlTaGFkaW5nIGV4dGVuZHMgQmFzZVNoYWRpbmcgewogIGdldElSKCkgewogICAgcmV0dXJuIFsiRHVtbXkiXTsKICB9Cn0KZnVuY3Rpb24gZ2V0VGlsaW5nUGF0dGVybklSKG9wZXJhdG9yTGlzdCwgZGljdCwgY29sb3IpIHsKICBjb25zdCBtYXRyaXggPSBsb29rdXBNYXRyaXgoZGljdC5nZXRBcnJheSgiTWF0cml4IiksIElERU5USVRZX01BVFJJWCk7CiAgY29uc3QgYmJveCA9IGxvb2t1cE5vcm1hbFJlY3QoZGljdC5nZXRBcnJheSgiQkJveCIpLCBudWxsKTsKICBpZiAoIWJib3ggfHwgYmJveFsyXSAtIGJib3hbMF0gPT09IDAgfHwgYmJveFszXSAtIGJib3hbMV0gPT09IDApIHsKICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBnZXRUaWxpbmdQYXR0ZXJuSVIgL0JCb3ggYXJyYXkuYCk7CiAgfQogIGNvbnN0IHhzdGVwID0gZGljdC5nZXQoIlhTdGVwIik7CiAgaWYgKHR5cGVvZiB4c3RlcCAhPT0gIm51bWJlciIpIHsKICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBnZXRUaWxpbmdQYXR0ZXJuSVIgL1hTdGVwIHZhbHVlLmApOwogIH0KICBjb25zdCB5c3RlcCA9IGRpY3QuZ2V0KCJZU3RlcCIpOwogIGlmICh0eXBlb2YgeXN0ZXAgIT09ICJudW1iZXIiKSB7CiAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgZ2V0VGlsaW5nUGF0dGVybklSIC9ZU3RlcCB2YWx1ZS5gKTsKICB9CiAgY29uc3QgcGFpbnRUeXBlID0gZGljdC5nZXQoIlBhaW50VHlwZSIpOwogIGlmICghTnVtYmVyLmlzSW50ZWdlcihwYWludFR5cGUpKSB7CiAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgZ2V0VGlsaW5nUGF0dGVybklSIC9QYWludFR5cGUgdmFsdWUuYCk7CiAgfQogIGNvbnN0IHRpbGluZ1R5cGUgPSBkaWN0LmdldCgiVGlsaW5nVHlwZSIpOwogIGlmICghTnVtYmVyLmlzSW50ZWdlcih0aWxpbmdUeXBlKSkgewogICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBJbnZhbGlkIGdldFRpbGluZ1BhdHRlcm5JUiAvVGlsaW5nVHlwZSB2YWx1ZS5gKTsKICB9CiAgcmV0dXJuIFsiVGlsaW5nUGF0dGVybiIsIGNvbG9yLCBvcGVyYXRvckxpc3QsIG1hdHJpeCwgYmJveCwgeHN0ZXAsIHlzdGVwLCBwYWludFR5cGUsIHRpbGluZ1R5cGVdOwp9Cgo7Ly8gLi9zcmMvY29yZS9jYWxpYnJpX2ZhY3RvcnMuanMKY29uc3QgQ2FsaWJyaUJvbGRGYWN0b3JzID0gWzEuMzg3NywgMSwgMSwgMSwgMC45NzgwMSwgMC45MjQ4MiwgMC44OTU1MiwgMC45MTEzMywgMC44MTk4OCwgMC45NzU2NiwgMC45ODE1MiwgMC45MzU0OCwgMC45MzU0OCwgMS4yNzk4LCAwLjg1Mjg0LCAwLjkyNzk0LCAxLCAwLjk2MTM0LCAxLjU0NjU3LCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjgyODQ1LCAwLjgyODQ1LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjc1ODU5LCAwLjkyMTM4LCAwLjgzOTA4LCAwLjc3NjIsIDAuNzMyOTMsIDAuODcyODksIDAuNzMxMzMsIDAuNzUxNCwgMC44MTkyMSwgMC44NzM1NiwgMC45NTk1OCwgMC41OTUyNiwgMC43NTcyNywgMC42OTIyNSwgMS4wNDkyNCwgMC45MTIxLCAwLjg2OTQzLCAwLjc5Nzk1LCAwLjg4MTk4LCAwLjc3OTU4LCAwLjcwODY0LCAwLjgxMDU1LCAwLjkwMzk5LCAwLjg4NjUzLCAwLjk2MDE3LCAwLjgyNTc3LCAwLjc3ODkyLCAwLjc4MjU3LCAwLjk3NTA3LCAxLjU0NjU3LCAwLjk3NTA3LCAwLjg1Mjg0LCAwLjg5NTUyLCAwLjkwMTc2LCAwLjg4NzYyLCAwLjg3ODUsIDAuNzUyNDEsIDAuODc4NSwgMC45MDUxOCwgMC45NTAxNSwgMC43NzYxOCwgMC44Nzg1LCAwLjg4NDAxLCAwLjkxOTE2LCAwLjg2MzA0LCAwLjg4NDAxLCAwLjkxNDg4LCAwLjg3ODUsIDAuODgwMSwgMC44Nzg1LCAwLjg3ODUsIDAuOTEzNDMsIDAuNzE3MywgMS4wNDEwNiwgMC44Nzg1LCAwLjg1MDc1LCAwLjk1Nzk0LCAwLjgyNjE2LCAwLjg1MTYyLCAwLjc5NDkyLCAwLjg4MzMxLCAxLjY5ODA4LCAwLjg4MzMxLCAwLjg1Mjg0LCAwLjk3ODAxLCAwLjg5NTUyLCAwLjkxMTMzLCAwLjg5NTUyLCAwLjkxMTMzLCAxLjc4MDEsIDAuODk1NTIsIDEuMjQ0ODcsIDEuMTMyNTQsIDEuMTI0MDEsIDAuOTY4MzksIDAuODUyODQsIDAuNjg3ODcsIDAuNzA2NDUsIDAuODU1OTIsIDAuOTA3NDcsIDEuMDE0NjYsIDEuMDA4OCwgMC45MDMyMywgMSwgMS4wNzQ2MywgMSwgMC45MTA1NiwgMC43NTgwNiwgMS4xOTExOCwgMC45NjgzOSwgMC43ODg2NCwgMC44Mjg0NSwgMC44NDEzMywgMC43NTg1OSwgMC44MzkwOCwgMC44MzkwOCwgMC44MzkwOCwgMC44MzkwOCwgMC44MzkwOCwgMC44MzkwOCwgMC43NzUzOSwgMC43MzI5MywgMC43MzEzMywgMC43MzEzMywgMC43MzEzMywgMC43MzEzMywgMC45NTk1OCwgMC45NTk1OCwgMC45NTk1OCwgMC45NTk1OCwgMC44ODUwNiwgMC45MTIxLCAwLjg2OTQzLCAwLjg2OTQzLCAwLjg2OTQzLCAwLjg2OTQzLCAwLjg2OTQzLCAwLjg1Mjg0LCAwLjg3NTA4LCAwLjkwMzk5LCAwLjkwMzk5LCAwLjkwMzk5LCAwLjkwMzk5LCAwLjc3ODkyLCAwLjc5Nzk1LCAwLjkwODA3LCAwLjg4NzYyLCAwLjg4NzYyLCAwLjg4NzYyLCAwLjg4NzYyLCAwLjg4NzYyLCAwLjg4NzYyLCAwLjg3MTUsIDAuNzUyNDEsIDAuOTA1MTgsIDAuOTA1MTgsIDAuOTA1MTgsIDAuOTA1MTgsIDAuODg0MDEsIDAuODg0MDEsIDAuODg0MDEsIDAuODg0MDEsIDAuODc4NSwgMC44Nzg1LCAwLjg4MDEsIDAuODgwMSwgMC44ODAxLCAwLjg4MDEsIDAuODgwMSwgMC45MDc0NywgMC44OTA0OSwgMC44Nzg1LCAwLjg3ODUsIDAuODc4NSwgMC44Nzg1LCAwLjg1MTYyLCAwLjg3ODUsIDAuODUxNjIsIDAuODM5MDgsIDAuODg3NjIsIDAuODM5MDgsIDAuODg3NjIsIDAuODM5MDgsIDAuODg3NjIsIDAuNzMyOTMsIDAuNzUyNDEsIDAuNzMyOTMsIDAuNzUyNDEsIDAuNzMyOTMsIDAuNzUyNDEsIDAuNzMyOTMsIDAuNzUyNDEsIDAuODcyODksIDAuODMwMTYsIDAuODg1MDYsIDAuOTMxMjUsIDAuNzMxMzMsIDAuOTA1MTgsIDAuNzMxMzMsIDAuOTA1MTgsIDAuNzMxMzMsIDAuOTA1MTgsIDAuNzMxMzMsIDAuOTA1MTgsIDAuNzMxMzMsIDAuOTA1MTgsIDAuODE5MjEsIDAuNzc2MTgsIDAuODE5MjEsIDAuNzc2MTgsIDAuODE5MjEsIDAuNzc2MTgsIDEsIDEsIDAuODczNTYsIDAuODc4NSwgMC45MTA3NSwgMC44OTYwOCwgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC43NjIyOSwgMC45MDE2NywgMC41OTUyNiwgMC45MTkxNiwgMSwgMSwgMC44NjMwNCwgMC42OTIyNSwgMC44ODQwMSwgMSwgMSwgMC43MDQyNCwgMC43OTQ2OCwgMC45MTkyNiwgMC44ODE3NSwgMC43MDgyMywgMC45NDkwMywgMC45MTIxLCAwLjg3ODUsIDEsIDEsIDAuOTEyMSwgMC44Nzg1LCAwLjg3ODAyLCAwLjg4NjU2LCAwLjg3ODUsIDAuODY5NDMsIDAuODgwMSwgMC44Njk0MywgMC44ODAxLCAwLjg2OTQzLCAwLjg4MDEsIDAuODc0MDIsIDAuODkyOTEsIDAuNzc5NTgsIDAuOTEzNDMsIDEsIDEsIDAuNzc5NTgsIDAuOTEzNDMsIDAuNzA4NjQsIDAuNzE3MywgMC43MDg2NCwgMC43MTczLCAwLjcwODY0LCAwLjcxNzMsIDAuNzA4NjQsIDAuNzE3MywgMSwgMSwgMC44MTA1NSwgMC43NTg0MSwgMC44MTA1NSwgMS4wNjQ1MiwgMC45MDM5OSwgMC44Nzg1LCAwLjkwMzk5LCAwLjg3ODUsIDAuOTAzOTksIDAuODc4NSwgMC45MDM5OSwgMC44Nzg1LCAwLjkwMzk5LCAwLjg3ODUsIDAuOTAzOTksIDAuODc4NSwgMC45NjAxNywgMC45NTc5NCwgMC43Nzg5MiwgMC44NTE2MiwgMC43Nzg5MiwgMC43ODI1NywgMC43OTQ5MiwgMC43ODI1NywgMC43OTQ5MiwgMC43ODI1NywgMC43OTQ5MiwgMC45Mjk3LCAwLjU2ODkyLCAwLjgzOTA4LCAwLjg4NzYyLCAwLjc3NTM5LCAwLjg3MTUsIDAuODc1MDgsIDAuODkwNDksIDEsIDEsIDAuODEwNTUsIDEuMDQxMDYsIDEuMjA1MjgsIDEuMjA1MjgsIDEsIDEuMTU1NDMsIDAuNzA2NzQsIDAuOTgzODcsIDAuOTQ3MjEsIDEuMzM0MzEsIDEuNDU4OTQsIDAuOTUxNjEsIDEuMDYzMDMsIDAuODM5MDgsIDAuODAzNTIsIDAuNTcxODQsIDAuNjk2NSwgMC41NjI4OSwgMC44MjAwMSwgMC41NjAyOSwgMC44MTIzNSwgMS4wMjk4OCwgMC44MzkwOCwgMC43NzYyLCAwLjY4MTU2LCAwLjgwMzY3LCAwLjczMTMzLCAwLjc4MjU3LCAwLjg3MzU2LCAwLjg2OTQzLCAwLjk1OTU4LCAwLjc1NzI3LCAwLjg5MDE5LCAxLjA0OTI0LCAwLjkxMjEsIDAuNzY0OCwgMC44Njk0MywgMC44NzM1NiwgMC43OTc5NSwgMC43ODI3NSwgMC44MTA1NSwgMC43Nzg5MiwgMC45NzYyLCAwLjgyNTc3LCAwLjk5ODE5LCAwLjg0ODk2LCAwLjk1OTU4LCAwLjc3ODkyLCAwLjk2MTA4LCAxLjAxNDA3LCAwLjg5MDQ5LCAxLjAyOTg4LCAwLjk0MjExLCAwLjk2MTA4LCAwLjg5MzYsIDAuODQwMjEsIDAuODc4NDIsIDAuOTYzOTksIDAuNzkxMDksIDAuODkwNDksIDEuMDA4MTMsIDEuMDI5ODgsIDAuODYwNzcsIDAuODc0NDUsIDAuOTIwOTksIDAuODQ3MjMsIDAuODY1MTMsIDAuODgwMSwgMC43NTYzOCwgMC44NTcxNCwgMC43ODIxNiwgMC43OTU4NiwgMC44Nzk2NSwgMC45NDIxMSwgMC45Nzc0NywgMC43ODI4NywgMC45NzkyNiwgMC44NDk3MSwgMS4wMjk4OCwgMC45NDIxMSwgMC44ODAxLCAwLjk0MjExLCAwLjg0OTcxLCAwLjczMTMzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkwMjY0LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkwNTE4LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkwNTQ4LCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk2MDE3LCAwLjk1Nzk0LCAwLjk2MDE3LCAwLjk1Nzk0LCAwLjk2MDE3LCAwLjk1Nzk0LCAwLjc3ODkyLCAwLjg1MTYyLCAxLCAxLCAwLjg5NTUyLCAwLjkwNTI3LCAxLCAwLjkwMzYzLCAwLjkyNzk0LCAwLjkyNzk0LCAwLjkyNzk0LCAwLjkyNzk0LCAwLjg3MDEyLCAwLjg3MDEyLCAwLjg3MDEyLCAwLjg5NTUyLCAwLjg5NTUyLCAxLjQyMjU5LCAwLjcxMTQzLCAxLjA2MTUyLCAxLCAxLCAxLjAzMzcyLCAxLjAzMzcyLCAwLjk3MTcxLCAxLjQ5NTYsIDIuMjgwNywgMC45MzgzNSwgMC44MzQwNiwgMC45MTEzMywgMC44NDEwNywgMC45MTEzMywgMSwgMSwgMSwgMC43MjAyMSwgMSwgMS4yMzEwOCwgMC44MzQ4OSwgMC44ODUyNSwgMC44ODUyNSwgMC44MTQ5OSwgMC45MDUyNywgMS44MTA1NSwgMC45MDUyNywgMS44MTA1NSwgMS4zMTAwNiwgMS41MzcxMSwgMC45NDQzNCwgMS4wODY5NiwgMSwgMC45NTAxOCwgMC43NzE5MiwgMC44NTI4NCwgMC45MDc0NywgMS4xNzUzNCwgMC42OTgyNSwgMC45NzE2LCAxLjM3MDc3LCAwLjkwNzQ3LCAwLjkwNzQ3LCAwLjg1MzU2LCAwLjkwNzQ3LCAwLjkwNzQ3LCAxLjQ0OTQ3LCAwLjg1Mjg0LCAwLjg5NDEsIDAuODk0MSwgMC43MDU3MiwgMC44LCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk5ODYyLCAwLjk5ODYyLCAxLCAxLCAxLCAxLCAxLCAxLjA4MDA0LCAwLjkxMDI3LCAxLCAxLCAxLCAwLjk5ODYyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkwNzI3LCAwLjkwNzI3LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKY29uc3QgQ2FsaWJyaUJvbGRNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMjIwNywKICBsaW5lR2FwOiAwLjIyMDcKfTsKY29uc3QgQ2FsaWJyaUJvbGRJdGFsaWNGYWN0b3JzID0gWzEuMzg3NywgMSwgMSwgMSwgMC45NzgwMSwgMC45MjQ4MiwgMC44OTU1MiwgMC45MTEzMywgMC44MTk4OCwgMC45NzU2NiwgMC45ODE1MiwgMC45MzU0OCwgMC45MzU0OCwgMS4yNzk4LCAwLjg1Mjg0LCAwLjkyNzk0LCAxLCAwLjk2MTM0LCAxLjU2MjM5LCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjgyODQ1LCAwLjgyODQ1LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjc1ODU5LCAwLjkyMTM4LCAwLjgzOTA4LCAwLjc3NjIsIDAuNzE4MDUsIDAuODcyODksIDAuNzMxMzMsIDAuNzUxNCwgMC44MTkyMSwgMC44NzM1NiwgMC45NTk1OCwgMC41OTUyNiwgMC43NTcyNywgMC42OTIyNSwgMS4wNDkyNCwgMC45MDg3MiwgMC44NTkzOCwgMC43OTc5NSwgMC44NzA2OCwgMC43Nzk1OCwgMC42OTc2NiwgMC44MTA1NSwgMC45MDM5OSwgMC44ODY1MywgMC45NjA2OCwgMC44MjU3NywgMC43Nzg5MiwgMC43ODI1NywgMC45NzUwNywgMS41MjksIDAuOTc1MDcsIDAuODUyODQsIDAuODk1NTIsIDAuOTAxNzYsIDAuOTQ5MDgsIDAuODY0MTEsIDAuNzQwMTIsIDAuODY0MTEsIDAuODgzMjMsIDAuOTUwMTUsIDAuODY0MTEsIDAuODYzMzEsIDAuODg0MDEsIDAuOTE5MTYsIDAuODYzMDQsIDAuODg0MDEsIDAuOTAzOSwgMC44NjMzMSwgMC44NjMzMSwgMC44NjQxMSwgMC44NjQxMSwgMC45MDQ2NCwgMC43MDg1MiwgMS4wNDEwNiwgMC44NjMzMSwgMC44NDM3MiwgMC45NTc5NCwgMC44MjYxNiwgMC44NDU0OCwgMC43OTQ5MiwgMC44ODMzMSwgMS42OTgwOCwgMC44ODMzMSwgMC44NTI4NCwgMC45NzgwMSwgMC44OTU1MiwgMC45MTEzMywgMC44OTU1MiwgMC45MTEzMywgMS43ODAxLCAwLjg5NTUyLCAxLjI0NDg3LCAxLjEzMjU0LCAxLjE5MTI5LCAwLjk2ODM5LCAwLjg1Mjg0LCAwLjY4Nzg3LCAwLjcwNjQ1LCAwLjg1NTkyLCAwLjkwNzQ3LCAxLjAxNDY2LCAxLjAwODgsIDAuOTAzMjMsIDEsIDEuMDc0NjMsIDEsIDAuOTEwNTYsIDAuNzU4MDYsIDEuMTkxMTgsIDAuOTY4MzksIDAuNzg4NjQsIDAuODI4NDUsIDAuODQxMzMsIDAuNzU4NTksIDAuODM5MDgsIDAuODM5MDgsIDAuODM5MDgsIDAuODM5MDgsIDAuODM5MDgsIDAuODM5MDgsIDAuNzc1MzksIDAuNzE4MDUsIDAuNzMxMzMsIDAuNzMxMzMsIDAuNzMxMzMsIDAuNzMxMzMsIDAuOTU5NTgsIDAuOTU5NTgsIDAuOTU5NTgsIDAuOTU5NTgsIDAuODg1MDYsIDAuOTA4NzIsIDAuODU5MzgsIDAuODU5MzgsIDAuODU5MzgsIDAuODU5MzgsIDAuODU5MzgsIDAuODUyODQsIDAuODcwNjgsIDAuOTAzOTksIDAuOTAzOTksIDAuOTAzOTksIDAuOTAzOTksIDAuNzc4OTIsIDAuNzk3OTUsIDAuOTA4MDcsIDAuOTQ5MDgsIDAuOTQ5MDgsIDAuOTQ5MDgsIDAuOTQ5MDgsIDAuOTQ5MDgsIDAuOTQ5MDgsIDAuODU4ODcsIDAuNzQwMTIsIDAuODgzMjMsIDAuODgzMjMsIDAuODgzMjMsIDAuODgzMjMsIDAuODg0MDEsIDAuODg0MDEsIDAuODg0MDEsIDAuODg0MDEsIDAuODc4NSwgMC44NjMzMSwgMC44NjMzMSwgMC44NjMzMSwgMC44NjMzMSwgMC44NjMzMSwgMC44NjMzMSwgMC45MDc0NywgMC44OTA0OSwgMC44NjMzMSwgMC44NjMzMSwgMC44NjMzMSwgMC44NjMzMSwgMC44NDU0OCwgMC44NjQxMSwgMC44NDU0OCwgMC44MzkwOCwgMC45NDkwOCwgMC44MzkwOCwgMC45NDkwOCwgMC44MzkwOCwgMC45NDkwOCwgMC43MTgwNSwgMC43NDAxMiwgMC43MTgwNSwgMC43NDAxMiwgMC43MTgwNSwgMC43NDAxMiwgMC43MTgwNSwgMC43NDAxMiwgMC44NzI4OSwgMC43OTUzOCwgMC44ODUwNiwgMC45MjcyNiwgMC43MzEzMywgMC44ODMyMywgMC43MzEzMywgMC44ODMyMywgMC43MzEzMywgMC44ODMyMywgMC43MzEzMywgMC44ODMyMywgMC43MzEzMywgMC44ODMyMywgMC44MTkyMSwgMC44NjQxMSwgMC44MTkyMSwgMC44NjQxMSwgMC44MTkyMSwgMC44NjQxMSwgMSwgMSwgMC44NzM1NiwgMC44NjMzMSwgMC45MTA3NSwgMC44Nzc3LCAwLjk1OTU4LCAwLjg4NDAxLCAwLjk1OTU4LCAwLjg4NDAxLCAwLjk1OTU4LCAwLjg4NDAxLCAwLjk1OTU4LCAwLjg4NDAxLCAwLjk1OTU4LCAwLjg4NDAxLCAwLjc2NDY3LCAwLjkwMTY3LCAwLjU5NTI2LCAwLjkxOTE2LCAxLCAxLCAwLjg2MzA0LCAwLjY5MjI1LCAwLjg4NDAxLCAxLCAxLCAwLjcwNDI0LCAwLjc3MzEyLCAwLjkxOTI2LCAwLjg4MTc1LCAwLjcwODIzLCAwLjk0OTAzLCAwLjkwODcyLCAwLjg2MzMxLCAxLCAxLCAwLjkwODcyLCAwLjg2MzMxLCAwLjg2OTA2LCAwLjg4MTE2LCAwLjg2MzMxLCAwLjg1OTM4LCAwLjg2MzMxLCAwLjg1OTM4LCAwLjg2MzMxLCAwLjg1OTM4LCAwLjg2MzMxLCAwLjg3NDAyLCAwLjg2NTQ5LCAwLjc3OTU4LCAwLjkwNDY0LCAxLCAxLCAwLjc3OTU4LCAwLjkwNDY0LCAwLjY5NzY2LCAwLjcwODUyLCAwLjY5NzY2LCAwLjcwODUyLCAwLjY5NzY2LCAwLjcwODUyLCAwLjY5NzY2LCAwLjcwODUyLCAxLCAxLCAwLjgxMDU1LCAwLjc1ODQxLCAwLjgxMDU1LCAxLjA2NDUyLCAwLjkwMzk5LCAwLjg2MzMxLCAwLjkwMzk5LCAwLjg2MzMxLCAwLjkwMzk5LCAwLjg2MzMxLCAwLjkwMzk5LCAwLjg2MzMxLCAwLjkwMzk5LCAwLjg2MzMxLCAwLjkwMzk5LCAwLjg2MzMxLCAwLjk2MDY4LCAwLjk1Nzk0LCAwLjc3ODkyLCAwLjg0NTQ4LCAwLjc3ODkyLCAwLjc4MjU3LCAwLjc5NDkyLCAwLjc4MjU3LCAwLjc5NDkyLCAwLjc4MjU3LCAwLjc5NDkyLCAwLjkyOTcsIDAuNTY4OTIsIDAuODM5MDgsIDAuOTQ5MDgsIDAuNzc1MzksIDAuODU4ODcsIDAuODcwNjgsIDAuODkwNDksIDEsIDEsIDAuODEwNTUsIDEuMDQxMDYsIDEuMjA1MjgsIDEuMjA1MjgsIDEsIDEuMTU1NDMsIDAuNzAwODgsIDAuOTgzODcsIDAuOTQ3MjEsIDEuMzM0MzEsIDEuNDU4OTQsIDAuOTUxNjEsIDEuNDgzODcsIDAuODM5MDgsIDAuODAzNTIsIDAuNTcxMTgsIDAuNjk2NSwgMC41NjM0NywgMC43OTE3OSwgMC41NTg1MywgMC44MDM0NiwgMS4wMjk4OCwgMC44MzkwOCwgMC43NzYyLCAwLjY3MTc0LCAwLjg2MDM2LCAwLjczMTMzLCAwLjc4MjU3LCAwLjg3MzU2LCAwLjg2NDQxLCAwLjk1OTU4LCAwLjc1NzI3LCAwLjg5MDE5LCAxLjA0OTI0LCAwLjkwODcyLCAwLjc0ODg5LCAwLjg1OTM4LCAwLjg3ODkxLCAwLjc5Nzk1LCAwLjc5NTcsIDAuODEwNTUsIDAuNzc4OTIsIDAuOTc0NDcsIDAuODI1NzcsIDAuOTc0NjYsIDAuODcxNzksIDAuOTU5NTgsIDAuNzc4OTIsIDAuOTQyNTIsIDAuOTU2MTIsIDAuODc1MywgMS4wMjk4OCwgMC45MjczMywgMC45NDI1MiwgMC44NzQxMSwgMC44NDAyMSwgMC44NzI4LCAwLjk1NjEyLCAwLjc0MDgxLCAwLjg3NTMsIDEuMDIxODksIDEuMDI5ODgsIDAuODQ4MTQsIDAuODc0NDUsIDAuOTE4MjIsIDAuODQ3MjMsIDAuODU2NjgsIDAuODYzMzEsIDAuODEzNDQsIDAuODc1ODEsIDAuNzY0MjIsIDAuODIwNDYsIDAuOTYwNTcsIDAuOTI3MzMsIDAuOTkzNzUsIDAuNzgwMjIsIDAuOTU0NTIsIDAuODYwMTUsIDEuMDI5ODgsIDAuOTI3MzMsIDAuODYzMzEsIDAuOTI3MzMsIDAuODYwMTUsIDAuNzMxMzMsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTA2MzEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuODgzMjMsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuODUxNzQsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTYwNjgsIDAuOTU3OTQsIDAuOTYwNjgsIDAuOTU3OTQsIDAuOTYwNjgsIDAuOTU3OTQsIDAuNzc4OTIsIDAuODQ1NDgsIDEsIDEsIDAuODk1NTIsIDAuOTA1MjcsIDEsIDAuOTAzNjMsIDAuOTI3OTQsIDAuOTI3OTQsIDAuOTI3OTQsIDAuODk4MDcsIDAuODcwMTIsIDAuODcwMTIsIDAuODcwMTIsIDAuODk1NTIsIDAuODk1NTIsIDEuNDIyNTksIDAuNzEwOTQsIDEuMDYxNTIsIDEsIDEsIDEuMDMzNzIsIDEuMDMzNzIsIDAuOTcxNzEsIDEuNDk1NiwgMi4yODA3LCAwLjkyOTcyLCAwLjgzNDA2LCAwLjkxMTMzLCAwLjgzMzI2LCAwLjkxMTMzLCAxLCAxLCAxLCAwLjcyMDIxLCAxLCAxLjIzMTA4LCAwLjgzNDg5LCAwLjg4NTI1LCAwLjg4NTI1LCAwLjgxNDk5LCAwLjkwNjE2LCAxLjgxMDU1LCAwLjkwNTI3LCAxLjgxMDU1LCAxLjMxMDcsIDEuNTM3MTEsIDAuOTQ0MzQsIDEuMDg2OTYsIDEsIDAuOTUwMTgsIDAuNzcxOTIsIDAuODUyODQsIDAuOTA3NDcsIDEuMTc1MzQsIDAuNjk4MjUsIDAuOTcxNiwgMS4zNzA3NywgMC45MDc0NywgMC45MDc0NywgMC44NTM1NiwgMC45MDc0NywgMC45MDc0NywgMS40NDk0NywgMC44NTI4NCwgMC44OTQxLCAwLjg5NDEsIDAuNzA1NzIsIDAuOCwgMC43MDU3MiwgMC43MDU3MiwgMC43MDU3MiwgMC43MDU3MiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45OTg2MiwgMC45OTg2MiwgMSwgMSwgMSwgMSwgMSwgMS4wODAwNCwgMC45MTAyNywgMSwgMSwgMSwgMC45OTg2MiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45MDcyNywgMC45MDcyNywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IENhbGlicmlCb2xkSXRhbGljTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIyMDcsCiAgbGluZUdhcDogMC4yMjA3Cn07CmNvbnN0IENhbGlicmlJdGFsaWNGYWN0b3JzID0gWzEuMzg3NywgMSwgMSwgMSwgMS4xNzIyMywgMS4xMjkzLCAwLjg5NTUyLCAwLjkxMTMzLCAwLjgwMzk1LCAxLjAyMjY5LCAxLjE1NjAxLCAwLjkxMDU2LCAwLjkxMDU2LCAxLjI3OTgsIDAuODUyODQsIDAuODk4MDcsIDEsIDAuOTA4NjEsIDEuMzk1NDMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTYzMDksIDAuOTYzMDksIDAuODUyODQsIDAuODUyODQsIDAuODUyODQsIDAuODMzMTksIDAuODgwNzEsIDAuODY3NSwgMC44MTU1MiwgMC43MjM0NiwgMC44NTE5MywgMC43MzIwNiwgMC43NTIyLCAwLjgxMTA1LCAwLjg2Mjc1LCAwLjkwNjg1LCAwLjYzNzcsIDAuNzc4OTIsIDAuNzU1OTMsIDEuMDI2MzgsIDAuODkyNDksIDAuODQxMTgsIDAuNzc0NTIsIDAuODUzNzQsIDAuNzUxODYsIDAuNjc3ODksIDAuNzk3NzYsIDAuODg4NDQsIDAuODUwNjYsIDAuOTQzMDksIDAuNzc4MTgsIDAuNzMwNiwgMC43NjY1OSwgMS4xMDM2OSwgMS4zODMxMywgMS4xMDM2OSwgMS4wNjEzOSwgMC44OTU1MiwgMC44NzM5LCAwLjkyNDUsIDAuOTI0NSwgMC44MzIwMywgMC45MjQ1LCAwLjg1ODY1LCAxLjA5ODQyLCAwLjkyNDUsIDAuOTI0NSwgMS4wMzI5NywgMS4wNzY5MiwgMC45MDkxOCwgMS4wMzI5NywgMC45NDk1OSwgMC45MjQ1LCAwLjkyMjc0LCAwLjkyNDUsIDAuOTI0NSwgMS4wMjkzMywgMC43NzgzMiwgMS4yMDU2MiwgMC45MjQ1LCAwLjg5MTYsIDAuOTg5ODYsIDAuODY2MjEsIDAuODk0NTMsIDAuNzkwMDQsIDAuOTQxNTIsIDEuNzcyNTYsIDAuOTQxNTIsIDAuODUyODQsIDAuOTc4MDEsIDAuODk1NTIsIDAuOTExMzMsIDAuODk1NTIsIDAuOTExMzMsIDEuOTE3MjksIDAuODk1NTIsIDEuMTc4ODksIDEuMTMyNTQsIDEuMTYzNTksIDAuOTIwOTgsIDAuODUyODQsIDAuNjg3ODcsIDAuNzEzNTMsIDAuODQ3MzcsIDAuOTA3NDcsIDEuMDA4OCwgMS4wMDQ0LCAwLjg3NjgzLCAxLCAxLjA5MDkxLCAxLCAwLjkyMjI5LCAwLjczOSwgMS4xNTY0MiwgMC45MjA5OCwgMC43NjI4OCwgMC44MDUwNCwgMC44MDk3MiwgMC43NTg1OSwgMC44Njc1LCAwLjg2NzUsIDAuODY3NSwgMC44Njc1LCAwLjg2NzUsIDAuODY3NSwgMC43NjMxOCwgMC43MjM0NiwgMC43MzIwNiwgMC43MzIwNiwgMC43MzIwNiwgMC43MzIwNiwgMC45MDY4NSwgMC45MDY4NSwgMC45MDY4NSwgMC45MDY4NSwgMC44NjQ3NywgMC44OTI0OSwgMC44NDExOCwgMC44NDExOCwgMC44NDExOCwgMC44NDExOCwgMC44NDExOCwgMC44NTI4NCwgMC44NDU1NywgMC44ODg0NCwgMC44ODg0NCwgMC44ODg0NCwgMC44ODg0NCwgMC43MzA2LCAwLjc3NDUyLCAwLjg2MzMxLCAwLjkyNDUsIDAuOTI0NSwgMC45MjQ1LCAwLjkyNDUsIDAuOTI0NSwgMC45MjQ1LCAwLjg0ODQzLCAwLjgzMjAzLCAwLjg1ODY1LCAwLjg1ODY1LCAwLjg1ODY1LCAwLjg1ODY1LCAwLjgyNjAxLCAwLjgyNjAxLCAwLjgyNjAxLCAwLjgyNjAxLCAwLjk0NDY5LCAwLjkyNDUsIDAuOTIyNzQsIDAuOTIyNzQsIDAuOTIyNzQsIDAuOTIyNzQsIDAuOTIyNzQsIDAuOTA3NDcsIDAuODY2NTEsIDAuOTI0NSwgMC45MjQ1LCAwLjkyNDUsIDAuOTI0NSwgMC44OTQ1MywgMC45MjQ1LCAwLjg5NDUzLCAwLjg2NzUsIDAuOTI0NSwgMC44Njc1LCAwLjkyNDUsIDAuODY3NSwgMC45MjQ1LCAwLjcyMzQ2LCAwLjgzMjAzLCAwLjcyMzQ2LCAwLjgzMjAzLCAwLjcyMzQ2LCAwLjgzMjAzLCAwLjcyMzQ2LCAwLjgzMjAzLCAwLjg1MTkzLCAwLjg4NzUsIDAuODY0NzcsIDAuOTkwMzQsIDAuNzMyMDYsIDAuODU4NjUsIDAuNzMyMDYsIDAuODU4NjUsIDAuNzMyMDYsIDAuODU4NjUsIDAuNzMyMDYsIDAuODU4NjUsIDAuNzMyMDYsIDAuODU4NjUsIDAuODExMDUsIDAuOTI0NSwgMC44MTEwNSwgMC45MjQ1LCAwLjgxMTA1LCAwLjkyNDUsIDEsIDEsIDAuODYyNzUsIDAuOTI0NSwgMC45MDg3MiwgMC45MzU5MSwgMC45MDY4NSwgMC44MjYwMSwgMC45MDY4NSwgMC44MjYwMSwgMC45MDY4NSwgMC44MjYwMSwgMC45MDY4NSwgMS4wMzI5NywgMC45MDY4NSwgMC44MjYwMSwgMC43Nzg5NiwgMS4wNTYxMSwgMC42Mzc3LCAxLjA3NjkyLCAxLCAxLCAwLjkwOTE4LCAwLjc1NTkzLCAxLjAzMjk3LCAxLCAxLCAwLjc2MDMyLCAwLjkzNzUsIDAuOTgxNTYsIDAuOTM0MDcsIDAuNzcyNjEsIDEuMTE0MjksIDAuODkyNDksIDAuOTI0NSwgMSwgMSwgMC44OTI0OSwgMC45MjQ1LCAwLjkyNTM0LCAwLjg2Njk4LCAwLjkyNDUsIDAuODQxMTgsIDAuOTIyNzQsIDAuODQxMTgsIDAuOTIyNzQsIDAuODQxMTgsIDAuOTIyNzQsIDAuODY2NywgMC44NjI5MSwgMC43NTE4NiwgMS4wMjkzMywgMSwgMSwgMC43NTE4NiwgMS4wMjkzMywgMC42Nzc4OSwgMC43NzgzMiwgMC42Nzc4OSwgMC43NzgzMiwgMC42Nzc4OSwgMC43NzgzMiwgMC42Nzc4OSwgMC43NzgzMiwgMSwgMSwgMC43OTc3NiwgMC45NzY1NSwgMC43OTc3NiwgMS4yMzAyMywgMC44ODg0NCwgMC45MjQ1LCAwLjg4ODQ0LCAwLjkyNDUsIDAuODg4NDQsIDAuOTI0NSwgMC44ODg0NCwgMC45MjQ1LCAwLjg4ODQ0LCAwLjkyNDUsIDAuODg4NDQsIDAuOTI0NSwgMC45NDMwOSwgMC45ODk4NiwgMC43MzA2LCAwLjg5NDUzLCAwLjczMDYsIDAuNzY2NTksIDAuNzkwMDQsIDAuNzY2NTksIDAuNzkwMDQsIDAuNzY2NTksIDAuNzkwMDQsIDEuMDkyMzEsIDAuNTQ4NzMsIDAuODY3NSwgMC45MjQ1LCAwLjc2MzE4LCAwLjg0ODQzLCAwLjg0NTU3LCAwLjg2NjUxLCAxLCAxLCAwLjc5Nzc2LCAxLjIwNTYyLCAxLjE4NjIyLCAxLjE4NjIyLCAxLCAxLjE0MzcsIDAuNjcwMDksIDAuOTYzMzQsIDAuOTM2OTUsIDEuMzUxOTEsIDEuNDA5MDksIDAuOTUxNjEsIDEuNDgzODcsIDAuODY3NSwgMC45MDg2MSwgMC42MTkyLCAwLjczNjMsIDAuNjQ4MjQsIDAuODI0MTEsIDAuNTYzMjEsIDAuODU2OTYsIDEuMjM1MTYsIDAuODY3NSwgMC44MTU1MiwgMC43Mjg2LCAwLjg0MTM0LCAwLjczMjA2LCAwLjc2NjU5LCAwLjg2Mjc1LCAwLjg0MzY5LCAwLjkwNjg1LCAwLjc3ODkyLCAwLjg1ODcxLCAxLjAyNjM4LCAwLjg5MjQ5LCAwLjc1ODI4LCAwLjg0MTE4LCAwLjg1OTg0LCAwLjc3NDUyLCAwLjc2NDY2LCAwLjc5Nzc2LCAwLjczMDYsIDAuOTA3ODIsIDAuNzc4MTgsIDAuOTAzLCAwLjg3MjkxLCAwLjkwNjg1LCAwLjczMDYsIDAuOTkwNTgsIDEuMDM2NjcsIDAuOTQ2MzUsIDEuMjM1MTYsIDAuOTg0OSwgMC45OTA1OCwgMC45MjM5MywgMC44OTE2LCAwLjk0MiwgMS4wMzY2NywgMC43NTAyNiwgMC45NDYzNSwgMS4wMjk3LCAxLjIzNTE2LCAwLjkwOTE4LCAwLjk0MDQ4LCAwLjk4MjE3LCAwLjg5NzQ2LCAwLjg0MTUzLCAwLjkyMjc0LCAwLjgyNTA3LCAwLjg4ODMyLCAwLjg0NDM4LCAwLjg4MTc4LCAxLjAzNTI1LCAwLjk4NDksIDEuMDAyMjUsIDAuNzgwODYsIDAuOTcyNDgsIDAuODk0MDQsIDEuMjM1MTYsIDAuOTg0OSwgMC45MjI3NCwgMC45ODQ5LCAwLjg5NDA0LCAwLjczMjA2LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjg5NjkzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjg1ODY1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkwOTMzLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk0MzA5LCAwLjk4OTg2LCAwLjk0MzA5LCAwLjk4OTg2LCAwLjk0MzA5LCAwLjk4OTg2LCAwLjczMDYsIDAuODk0NTMsIDEsIDEsIDAuODk1NTIsIDAuOTA1MjcsIDEsIDAuOTAxODYsIDEuMTIzMDgsIDEuMTIzMDgsIDEuMTIzMDgsIDEuMTIzMDgsIDEuMjU2NiwgMS4yNTY2LCAxLjI1NjYsIDAuODk1NTIsIDAuODk1NTIsIDEuNDIyNTksIDAuNjg5OTQsIDEuMDM4MDksIDEsIDEsIDEuMDE3NiwgMS4wMTc2LCAxLjExNTIzLCAxLjQ5NTYsIDIuMDE0NjIsIDAuOTc4NTgsIDAuODI2MTYsIDAuOTExMzMsIDAuODM0MzcsIDAuOTExMzMsIDEsIDEsIDEsIDAuNzA1MDgsIDEsIDEuMjMxMDgsIDAuNzk4MDEsIDAuODQ0MjYsIDAuODQ0MjYsIDAuNzc0LCAwLjkwNTcyLCAxLjgxMDU1LCAwLjkwNzQ5LCAxLjgxMDU1LCAxLjI4ODA5LCAxLjU1NDY5LCAwLjk0NDM0LCAxLjA3ODA2LCAxLCAwLjk3MDk0LCAwLjc1ODksIDAuODUyODQsIDAuOTA3NDcsIDEuMTk2NTgsIDAuNjk4MjUsIDAuOTc2MjIsIDEuMzM1MTIsIDAuOTA3NDcsIDAuOTA3NDcsIDAuODUyODQsIDAuOTA3NDcsIDAuOTA3NDcsIDEuNDQ5NDcsIDAuODUyODQsIDAuODk0MSwgMC44OTQxLCAwLjcwNTcyLCAwLjgsIDAuNzA1NzIsIDAuNzA1NzIsIDAuNzA1NzIsIDAuNzA1NzIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTk4NjIsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEuMDMzNiwgMC45MTAyNywgMSwgMSwgMSwgMC45OTg2MiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wNTg1OSwgMS4wNTg1OSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IENhbGlicmlJdGFsaWNNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMjIwNywKICBsaW5lR2FwOiAwLjIyMDcKfTsKY29uc3QgQ2FsaWJyaVJlZ3VsYXJGYWN0b3JzID0gWzEuMzg3NywgMSwgMSwgMSwgMS4xNzIyMywgMS4xMjkzLCAwLjg5NTUyLCAwLjkxMTMzLCAwLjgwMzk1LCAxLjAyMjY5LCAxLjE1NjAxLCAwLjkxMDU2LCAwLjkxMDU2LCAxLjI3OTgsIDAuODUyODQsIDAuODk4MDcsIDEsIDAuOTA4NjEsIDEuMzkwMTYsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTYzMDksIDAuOTYzMDksIDAuODUyODQsIDAuODUyODQsIDAuODUyODQsIDAuODMzMTksIDAuODgwNzEsIDAuODY3NSwgMC44MTU1MiwgMC43MzgzNCwgMC44NTE5MywgMC43MzIwNiwgMC43NTIyLCAwLjgxMTA1LCAwLjg2Mjc1LCAwLjkwNjg1LCAwLjYzNzcsIDAuNzc4OTIsIDAuNzU1OTMsIDEuMDI2MzgsIDAuODkzODUsIDAuODUxMjIsIDAuNzc0NTIsIDAuODY1MDMsIDAuNzUxODYsIDAuNjg4ODcsIDAuNzk3NzYsIDAuODg4NDQsIDAuODUwNjYsIDAuOTQyNTgsIDAuNzc4MTgsIDAuNzMwNiwgMC43NjY1OSwgMS4xMDM2OSwgMS4zOTAxNiwgMS4xMDM2OSwgMS4wNjEzOSwgMC44OTU1MiwgMC44NzM5LCAwLjg2MTI4LCAwLjk0NDY5LCAwLjg0NTcsIDAuOTQ0NjksIDAuODk0NjQsIDEuMDk4NDIsIDAuODQ2MzYsIDAuOTQ0NjksIDEuMDMyOTcsIDEuMDc2OTIsIDAuOTA5MTgsIDEuMDMyOTcsIDAuOTU4OTcsIDAuOTQ0NjksIDAuOTQ4MiwgMC45NDQ2OSwgMC45NDQ2OSwgMS4wNDY5MiwgMC43ODIyMywgMS4yMDU2MiwgMC45NDQ2OSwgMC45MDMzMiwgMC45ODk4NiwgMC44NjYyMSwgMC45MDUyNywgMC43OTAwNCwgMC45NDE1MiwgMS43NzI1NiwgMC45NDE1MiwgMC44NTI4NCwgMC45NzgwMSwgMC44OTU1MiwgMC45MTEzMywgMC44OTU1MiwgMC45MTEzMywgMS45MTcyOSwgMC44OTU1MiwgMS4xNzg4OSwgMS4xMzI1NCwgMS4wODcwNywgMC45MjA5OCwgMC44NTI4NCwgMC42ODc4NywgMC43MTM1MywgMC44NDczNywgMC45MDc0NywgMS4wMDg4LCAxLjAwNDQsIDAuODc2ODMsIDEsIDEuMDkwOTEsIDEsIDAuOTIyMjksIDAuNzM5LCAxLjE1NjQyLCAwLjkyMDk4LCAwLjc2Mjg4LCAwLjgwNTA0LCAwLjgwOTcyLCAwLjc1ODU5LCAwLjg2NzUsIDAuODY3NSwgMC44Njc1LCAwLjg2NzUsIDAuODY3NSwgMC44Njc1LCAwLjc2MzE4LCAwLjczODM0LCAwLjczMjA2LCAwLjczMjA2LCAwLjczMjA2LCAwLjczMjA2LCAwLjkwNjg1LCAwLjkwNjg1LCAwLjkwNjg1LCAwLjkwNjg1LCAwLjg2NDc3LCAwLjg5Mzg1LCAwLjg1MTIyLCAwLjg1MTIyLCAwLjg1MTIyLCAwLjg1MTIyLCAwLjg1MTIyLCAwLjg1Mjg0LCAwLjg1MzExLCAwLjg4ODQ0LCAwLjg4ODQ0LCAwLjg4ODQ0LCAwLjg4ODQ0LCAwLjczMDYsIDAuNzc0NTIsIDAuODYzMzEsIDAuODYxMjgsIDAuODYxMjgsIDAuODYxMjgsIDAuODYxMjgsIDAuODYxMjgsIDAuODYxMjgsIDAuODY5MywgMC44NDU3LCAwLjg5NDY0LCAwLjg5NDY0LCAwLjg5NDY0LCAwLjg5NDY0LCAwLjgyNjAxLCAwLjgyNjAxLCAwLjgyNjAxLCAwLjgyNjAxLCAwLjk0NDY5LCAwLjk0NDY5LCAwLjk0ODIsIDAuOTQ4MiwgMC45NDgyLCAwLjk0ODIsIDAuOTQ4MiwgMC45MDc0NywgMC44NjY1MSwgMC45NDQ2OSwgMC45NDQ2OSwgMC45NDQ2OSwgMC45NDQ2OSwgMC45MDUyNywgMC45NDQ2OSwgMC45MDUyNywgMC44Njc1LCAwLjg2MTI4LCAwLjg2NzUsIDAuODYxMjgsIDAuODY3NSwgMC44NjEyOCwgMC43MzgzNCwgMC44NDU3LCAwLjczODM0LCAwLjg0NTcsIDAuNzM4MzQsIDAuODQ1NywgMC43MzgzNCwgMC44NDU3LCAwLjg1MTkzLCAwLjkyNDU0LCAwLjg2NDc3LCAwLjk5MjEsIDAuNzMyMDYsIDAuODk0NjQsIDAuNzMyMDYsIDAuODk0NjQsIDAuNzMyMDYsIDAuODk0NjQsIDAuNzMyMDYsIDAuODk0NjQsIDAuNzMyMDYsIDAuODk0NjQsIDAuODExMDUsIDAuODQ2MzYsIDAuODExMDUsIDAuODQ2MzYsIDAuODExMDUsIDAuODQ2MzYsIDEsIDEsIDAuODYyNzUsIDAuOTQ0NjksIDAuOTA4NzIsIDAuOTU3ODYsIDAuOTA2ODUsIDAuODI2MDEsIDAuOTA2ODUsIDAuODI2MDEsIDAuOTA2ODUsIDAuODI2MDEsIDAuOTA2ODUsIDEuMDMyOTcsIDAuOTA2ODUsIDAuODI2MDEsIDAuNzc3NDEsIDEuMDU2MTEsIDAuNjM3NywgMS4wNzY5MiwgMSwgMSwgMC45MDkxOCwgMC43NTU5MywgMS4wMzI5NywgMSwgMSwgMC43NjAzMiwgMC45MDQ1MiwgMC45ODE1NiwgMS4xMTg0MiwgMC43NzI2MSwgMS4xMTQyOSwgMC44OTM4NSwgMC45NDQ2OSwgMSwgMSwgMC44OTM4NSwgMC45NDQ2OSwgMC45NTg3NywgMC44NjkwMSwgMC45NDQ2OSwgMC44NTEyMiwgMC45NDgyLCAwLjg1MTIyLCAwLjk0ODIsIDAuODUxMjIsIDAuOTQ4MiwgMC44NjY3LCAwLjkwMDE2LCAwLjc1MTg2LCAxLjA0NjkyLCAxLCAxLCAwLjc1MTg2LCAxLjA0NjkyLCAwLjY4ODg3LCAwLjc4MjIzLCAwLjY4ODg3LCAwLjc4MjIzLCAwLjY4ODg3LCAwLjc4MjIzLCAwLjY4ODg3LCAwLjc4MjIzLCAxLCAxLCAwLjc5Nzc2LCAwLjkyMTg4LCAwLjc5Nzc2LCAxLjIzMDIzLCAwLjg4ODQ0LCAwLjk0NDY5LCAwLjg4ODQ0LCAwLjk0NDY5LCAwLjg4ODQ0LCAwLjk0NDY5LCAwLjg4ODQ0LCAwLjk0NDY5LCAwLjg4ODQ0LCAwLjk0NDY5LCAwLjg4ODQ0LCAwLjk0NDY5LCAwLjk0MjU4LCAwLjk4OTg2LCAwLjczMDYsIDAuOTA1MjcsIDAuNzMwNiwgMC43NjY1OSwgMC43OTAwNCwgMC43NjY1OSwgMC43OTAwNCwgMC43NjY1OSwgMC43OTAwNCwgMS4wOTIzMSwgMC41NDg3MywgMC44Njc1LCAwLjg2MTI4LCAwLjc2MzE4LCAwLjg2OTMsIDAuODUzMTEsIDAuODY2NTEsIDEsIDEsIDAuNzk3NzYsIDEuMjA1NjIsIDEuMTg2MjIsIDEuMTg2MjIsIDEsIDEuMTQzNywgMC42Nzc0MiwgMC45NjMzNCwgMC45MzY5NSwgMS4zNTE5MSwgMS40MDkwOSwgMC45NTE2MSwgMS40ODM4NywgMC44NjY4NiwgMC45MDg2MSwgMC42MjI2NywgMC43NDM1OSwgMC42NTY0OSwgMC44NTQ5OCwgMC41Njk2MywgMC44ODI1NCwgMS4yMzUxNiwgMC44Njc1LCAwLjgxNTUyLCAwLjc1NDQzLCAwLjg0NTAzLCAwLjczMjA2LCAwLjc2NjU5LCAwLjg2Mjc1LCAwLjg1MTIyLCAwLjkwNjg1LCAwLjc3ODkyLCAwLjg1NzQ2LCAxLjAyNjM4LCAwLjg5Mzg1LCAwLjc1NjU3LCAwLjg1MTIyLCAwLjg2Mjc1LCAwLjc3NDUyLCAwLjc0MTcxLCAwLjc5Nzc2LCAwLjczMDYsIDAuOTUxNjUsIDAuNzc4MTgsIDAuODk3NzIsIDAuODg4MzEsIDAuOTA2ODUsIDAuNzMwNiwgMC45ODE0MiwgMS4wMjE5MSwgMC45NjU3NiwgMS4yMzUxNiwgMC45OTAxOCwgMC45ODE0MiwgMC45MjM2LCAwLjg5MjU4LCAwLjk0MDM1LCAxLjAyMTkxLCAwLjc4ODQ4LCAwLjk2NTc2LCAwLjk1NjEsIDEuMjM1MTYsIDAuOTA5MTgsIDAuOTI1NzgsIDAuOTU0MjQsIDAuODk3NDYsIDAuODM5NjksIDAuOTQ4MiwgMC44MDExMywgMC44OTQ0MiwgMC44NTIwOCwgMC44NjE1NSwgMC45ODAyMiwgMC45OTAxOCwgMS4wMDQ1MiwgMC44MTIwOSwgMC45OTI0NywgMC44OTE4MSwgMS4yMzUxNiwgMC45OTAxOCwgMC45NDgyLCAwLjk5MDE4LCAwLjg5MTgxLCAwLjczMjA2LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjg4ODQ0LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjg5NDY0LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk2NzY2LCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk0MjU4LCAwLjk4OTg2LCAwLjk0MjU4LCAwLjk4OTg2LCAwLjk0MjU4LCAwLjk4OTg2LCAwLjczMDYsIDAuOTA1MjcsIDEsIDEsIDAuODk1NTIsIDAuOTA1MjcsIDEsIDAuOTAxODYsIDEuMTIzMDgsIDEuMTIzMDgsIDEuMTIzMDgsIDEuMTIzMDgsIDEuMjU2NiwgMS4yNTY2LCAxLjI1NjYsIDAuODk1NTIsIDAuODk1NTIsIDEuNDIyNTksIDAuNjkwNDMsIDEuMDM4MDksIDEsIDEsIDEuMDE3NiwgMS4wMTc2LCAxLjExNTIzLCAxLjQ5NTYsIDIuMDE0NjIsIDAuOTkzMzEsIDAuODI2MTYsIDAuOTExMzMsIDAuODQyODYsIDAuOTExMzMsIDEsIDEsIDEsIDAuNzA1MDgsIDEsIDEuMjMxMDgsIDAuNzk4MDEsIDAuODQ0MjYsIDAuODQ0MjYsIDAuNzc0LCAwLjkwNTI3LCAxLjgxMDU1LCAwLjkwNTI3LCAxLjgxMDU1LCAxLjI4ODA5LCAxLjU1NDY5LCAwLjk0NDM0LCAxLjA3ODA2LCAxLCAwLjk3MDk0LCAwLjc1ODksIDAuODUyODQsIDAuOTA3NDcsIDEuMTk2NTgsIDAuNjk4MjUsIDAuOTc2MjIsIDEuMzM1MTIsIDAuOTA3NDcsIDAuOTA3NDcsIDAuODUzNTYsIDAuOTA3NDcsIDAuOTA3NDcsIDEuNDQ5NDcsIDAuODUyODQsIDAuODk0MSwgMC44OTQxLCAwLjcwNTcyLCAwLjgsIDAuNzA1NzIsIDAuNzA1NzIsIDAuNzA1NzIsIDAuNzA1NzIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTk4NjIsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEuMDMzNiwgMC45MTAyNywgMSwgMSwgMSwgMC45OTg2MiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wNTg1OSwgMS4wNTg1OSwgMSwgMSwgMSwgMS4wNzE4NSwgMC45OTQxMywgMC45NjMzNCwgMS4wODA2NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IENhbGlicmlSZWd1bGFyTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIyMDcsCiAgbGluZUdhcDogMC4yMjA3Cn07Cgo7Ly8gLi9zcmMvY29yZS9oZWx2ZXRpY2FfZmFjdG9ycy5qcwpjb25zdCBIZWx2ZXRpY2FCb2xkRmFjdG9ycyA9IFswLjc2MTE2LCAxLCAxLCAxLjAwMDYsIDAuOTk5OTgsIDAuOTk5NzQsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5ODIsIDAuOTk5NzcsIDEuMDAwODcsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5NTksIDEuMDAwMDMsIDEuMDAwNiwgMC45OTk5OCwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5OTgsIDEsIDEuMDAwMDMsIDEuMDAwMDMsIDEuMDAwMDMsIDEuMDAwMjYsIDAuOTk5OSwgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAyNiwgMS4wMDAyMiwgMC45OTk3NywgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTk5LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDAxLCAxLjAwMDIyLCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDE2LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDI2LCAwLjk5OTk4LCAxLjAwMDYsIDAuOTk5OTgsIDEuMDAwMDMsIDAuOTk5NzMsIDAuOTk5OTgsIDAuOTk5NzMsIDEuMDAwMjYsIDAuOTk5NzMsIDEuMDAwMjYsIDAuOTk5NzMsIDAuOTk5OTgsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTczLCAxLjAwMDYsIDAuOTk5ODIsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDAuOTk5NTksIDAuOTk5NzMsIDAuOTk5OTgsIDEuMDAwMjYsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDAuOTk5NzMsIDEsIDAuOTk5NTksIDEuMDAwNzcsIDAuOTk5NTksIDEuMDAwMDMsIDAuOTk5OTgsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNzcsIDAuOTk5NzMsIDAuOTk5OTgsIDEuMDAwMjUsIDAuOTk5NjgsIDAuOTk5NzMsIDEuMDAwMDMsIDEuMDAwMjUsIDAuNjAyOTksIDEuMDAwMjQsIDEuMDY0MDksIDEsIDEsIDAuOTk5OTgsIDEsIDAuOTk5NzMsIDEuMDAwNiwgMC45OTk5OCwgMSwgMC45OTkzNiwgMC45OTk3MywgMS4wMDAwMiwgMS4wMDAwMiwgMS4wMDAwMiwgMS4wMDAyNiwgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMSwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTc3LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDAzLCAxLjAwMDIyLCAwLjk5OTc3LCAwLjk5OTc3LCAwLjk5OTc3LCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTgyLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDY0MDksIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDAuOTk5NzMsIDEuMDAwMjYsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDEuMDMzNzQsIDAuOTk5NzcsIDEuMDAwMjYsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA0MiwgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDAyNiwgMS4wMzgyOCwgMS4wMDAyNiwgMC45OTk5OSwgMS4wMDAyNiwgMS4wMDA2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTMsIDAuOTk5OCwgMS4wMDAyNiwgMS4wMDAyMiwgMS4wMDAyNiwgMS4wMDAyMiwgMS4wMDAyNiwgMS4wMDAyMiwgMS4wMDAyNiwgMSwgMS4wMDAxNiwgMC45OTk3NywgMC45OTk1OSwgMC45OTk3NywgMC45OTk1OSwgMC45OTk3NywgMC45OTk1OSwgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAyNiwgMC45OTk5OCwgMS4wMDAyNiwgMC44MTIxLCAxLjAwMDI2LCAwLjk5OTk4LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAxLjAwMDE2LCAxLjAwMDIyLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAxLjAwMDI2LCAxLCAxLjAwMDI2LCAxLCAxLjAwMDI2LCAxLCAxLjAwMDYsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDEsIDAuOTk5ODIsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjYsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDEuMDAwMzQsIDAuOTk5NzcsIDEsIDAuOTk5OTcsIDEuMDAwMjYsIDEuMDAwNzgsIDEuMDAwMzYsIDAuOTk5NzMsIDEuMDAwMTMsIDEuMDAwNiwgMC45OTk3NywgMC45OTk3NywgMC45OTk4OCwgMC44NTE0OCwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDA2LCAwLjk5OTc3LCAxLjAwMDAxLCAwLjk5OTk5LCAwLjk5OTc3LCAxLjAwMDY5LCAxLjAwMDIyLCAwLjk5OTc3LCAxLjAwMDAxLCAwLjk5OTg0LCAxLjAwMDI2LCAxLjAwMDAxLCAxLjAwMDI0LCAxLjAwMDAxLCAwLjk5OTksIDEsIDEuMDAwNiwgMS4wMDAwMSwgMS4wMDA0MSwgMC45OTk2MiwgMS4wMDAyNiwgMS4wMDA2LCAwLjk5OTk1LCAxLjAwMDQxLCAwLjk5OTQyLCAwLjk5OTczLCAwLjk5OTI3LCAxLjAwMDgyLCAwLjk5OTAyLCAxLjAwMDI2LCAxLjAwMDg3LCAxLjAwMDYsIDEuMDAwNjksIDAuOTk5NzMsIDAuOTk4NjcsIDAuOTk5NzMsIDAuOTk5MywgMS4wMDAyNiwgMS4wMDA0OSwgMS4wMDA1NiwgMSwgMC45OTk4OCwgMC45OTkzNSwgMC45OTk5NSwgMC45OTk1NCwgMS4wMDA1NSwgMC45OTk0NSwgMS4wMDAzMiwgMS4wMDA2LCAwLjk5OTk1LCAxLjAwMDI2LCAwLjk5OTk1LCAxLjAwMDMyLCAxLjAwMDAxLCAxLjAwMDA4LCAwLjk5OTcxLCAxLjAwMDE5LCAwLjk5OTQsIDEuMDAwMDEsIDEuMDAwNiwgMS4wMDA0NCwgMC45OTk3MywgMS4wMDAyMywgMS4wMDA0NywgMSwgMC45OTk0MiwgMC45OTU2MSwgMC45OTk4OSwgMS4wMDAzNSwgMC45OTk3NywgMS4wMDAzNSwgMC45OTk3NywgMS4wMDAxOSwgMC45OTk0NCwgMS4wMDAwMSwgMS4wMDAyMSwgMC45OTkyNiwgMS4wMDAzNSwgMS4wMDAzNSwgMC45OTk0MiwgMS4wMDA0OCwgMC45OTk5OSwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAzNSwgMS4wMDAwMSwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk4OSwgMS4wMDA1NywgMS4wMDAwMSwgMC45OTkzNiwgMS4wMDA1MiwgMS4wMDAxMiwgMC45OTk5NiwgMS4wMDA0MywgMSwgMS4wMDAzNSwgMC45OTk0LCAwLjk5OTc2LCAxLjAwMDM1LCAwLjk5OTczLCAxLjAwMDUyLCAxLjAwMDQxLCAxLjAwMTE5LCAxLjAwMDM3LCAwLjk5OTczLCAxLjAwMDAyLCAwLjk5OTg2LCAxLjAwMDQxLCAxLjAwMDQxLCAwLjk5OTAyLCAwLjk5OTYsIDEuMDAwMzQsIDAuOTk5OTksIDEuMDAwMjYsIDAuOTk5OTksIDEuMDAwMjYsIDAuOTk5NzMsIDEuMDAwNTIsIDAuOTk5NzMsIDEsIDAuOTk5NzMsIDEuMDAwNDEsIDEuMDAwNzUsIDAuOTk5NCwgMS4wMDAzLCAwLjk5OTk5LCAxLCAxLjAwMDQxLCAwLjk5OTU1LCAxLCAwLjk5OTE1LCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDI2LCAxLjAwMTE5LCAwLjk5OTU1LCAwLjk5OTczLCAxLjAwMDYsIDAuOTk5MTEsIDEuMDAwNiwgMS4wMDAyNiwgMC45OTk3MiwgMS4wMDAyNiwgMC45OTkwMiwgMS4wMDA0MSwgMC45OTk3MywgMC45OTk5OSwgMSwgMSwgMS4wMDAzOCwgMS4wMDA1LCAxLjAwMDE2LCAxLjAwMDIyLCAxLjAwMDE2LCAxLjAwMDIyLCAxLjAwMDE2LCAxLjAwMDIyLCAxLjAwMDAxLCAwLjk5OTczLCAxLCAxLCAwLjk5OTczLCAxLCAxLCAwLjk5OTU1LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEsIDEsIDEsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzIsIDEsIDEsIDEuMDAxMDYsIDAuOTk5OTksIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTksIDAuOTk5OTgsIDEuNjY0NzUsIDEsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwMjMsIDAuOTk5NzMsIDAuOTk5NzEsIDEuMDAwNDcsIDEuMDAwMjMsIDEsIDAuOTk5OTEsIDAuOTk5ODQsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTk5NzIsIDEsIDEuMjA5ODUsIDEuMzk3MTMsIDEuMDAwMDMsIDEuMDAwMzEsIDEuMDAwMTUsIDEsIDAuOTk1NjEsIDEuMDAwMjcsIDEuMDAwMzEsIDEuMDAwMzEsIDAuOTk5MTUsIDEuMDAwMzEsIDEuMDAwMzEsIDAuOTk5OTksIDEuMDAwMDMsIDAuOTk5OTksIDAuOTk5OTksIDEuNDExNDQsIDEuNiwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MDU3OSwgMS40MDU3OSwgMS4zNjYyNSwgMC45OTk5OSwgMSwgMC45OTg2MSwgMC45OTg2MSwgMSwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMC45OTk3MiwgMC45OTk5OSwgMC45OTk5OSwgMC45OTk5OSwgMC45OTk5OSwgMS40MDQ4MywgMSwgMC45OTk3NywgMS4wMDA1NCwgMSwgMSwgMC45OTk1MywgMC45OTk2MiwgMS4wMDA0MiwgMC45OTk1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKY29uc3QgSGVsdmV0aWNhQm9sZE1ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4yLAogIGxpbmVHYXA6IDAuMgp9Owpjb25zdCBIZWx2ZXRpY2FCb2xkSXRhbGljRmFjdG9ycyA9IFswLjc2MTE2LCAxLCAxLCAxLjAwMDYsIDAuOTk5OTgsIDAuOTk5NzQsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5ODIsIDAuOTk5NzcsIDEuMDAwODcsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5NTksIDEuMDAwMDMsIDEuMDAwNiwgMC45OTk5OCwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5OTgsIDEsIDEuMDAwMDMsIDEuMDAwMDMsIDEuMDAwMDMsIDEuMDAwMjYsIDAuOTk5OSwgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAyNiwgMS4wMDAyMiwgMC45OTk3NywgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTk5LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDAxLCAxLjAwMDIyLCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDE2LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDI2LCAwLjk5OTk4LCAxLjAwMDYsIDAuOTk5OTgsIDEuMDAwMDMsIDAuOTk5NzMsIDAuOTk5OTgsIDAuOTk5NzMsIDEuMDAwMjYsIDAuOTk5NzMsIDEuMDAwMjYsIDAuOTk5NzMsIDAuOTk5OTgsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTczLCAxLjAwMDYsIDAuOTk5ODIsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDAuOTk5NTksIDAuOTk5NzMsIDAuOTk5OTgsIDEuMDAwMjYsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDAuOTk5NzMsIDEsIDAuOTk5NTksIDEuMDAwNzcsIDAuOTk5NTksIDEuMDAwMDMsIDAuOTk5OTgsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNzcsIDAuOTk5NzMsIDAuOTk5OTgsIDEuMDAwMjUsIDAuOTk5NjgsIDAuOTk5NzMsIDEuMDAwMDMsIDEuMDAwMjUsIDAuNjAyOTksIDEuMDAwMjQsIDEuMDY0MDksIDEsIDEsIDAuOTk5OTgsIDEsIDAuOTk5NzMsIDEuMDAwNiwgMC45OTk5OCwgMSwgMC45OTkzNiwgMC45OTk3MywgMS4wMDAwMiwgMS4wMDAwMiwgMS4wMDAwMiwgMS4wMDAyNiwgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMSwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTc3LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDAzLCAxLjAwMDIyLCAwLjk5OTc3LCAwLjk5OTc3LCAwLjk5OTc3LCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTgyLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDY0MDksIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDAuOTk5NzMsIDEuMDAwMjYsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDEuMDA0NCwgMC45OTk3NywgMS4wMDAyNiwgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAyMiwgMS4wMDAyNiwgMS4wMDAyMiwgMS4wMDAyNiwgMS4wMDAyMiwgMS4wMDAyNiwgMS4wMDAyMiwgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTcxLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDYsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDAyNiwgMS4wMDA2LCAxLjAwMDI2LCAxLjAxMDExLCAxLjAwMDI2LCAwLjk5OTk5LCAxLjAwMDI2LCAxLjAwMDYsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5MywgMC45OTk4LCAxLjAwMDI2LCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDIyLCAxLjAwMDI2LCAxLCAxLjAwMDE2LCAwLjk5OTc3LCAwLjk5OTU5LCAwLjk5OTc3LCAwLjk5OTU5LCAwLjk5OTc3LCAwLjk5OTU5LCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTk4LCAxLjAwMDI2LCAwLjgxMjEsIDEuMDAwMjYsIDAuOTk5OTgsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjYsIDEuMDAwMTYsIDEuMDAwMjIsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDEuMDAwMjYsIDEsIDEuMDAwMjYsIDEsIDEuMDAwMjYsIDEsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3NywgMC45OTk3MywgMSwgMC45OTk4MiwgMS4wMDAyMiwgMS4wMDAyNiwgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAyNiwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk3NywgMSwgMSwgMS4wMDAyNiwgMC45OTk2OSwgMC45OTk3MiwgMC45OTk4MSwgMC45OTk4LCAxLjAwMDYsIDAuOTk5NzcsIDAuOTk5NzcsIDEuMDAwMjIsIDAuOTExNTUsIDEuMDAwMDEsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwNiwgMC45OTk3NywgMS4wMDAwMSwgMC45OTk5OSwgMC45OTk3NywgMC45OTk2NiwgMS4wMDAyMiwgMS4wMDAzMiwgMS4wMDAwMSwgMC45OTk0NCwgMS4wMDAyNiwgMS4wMDAwMSwgMC45OTk2OCwgMS4wMDAwMSwgMS4wMDA0NywgMSwgMS4wMDA2LCAxLjAwMDAxLCAwLjk5OTgxLCAxLjAwMTAxLCAxLjAwMDI2LCAxLjAwMDYsIDAuOTk5NDgsIDAuOTk5ODEsIDEuMDAwNjQsIDAuOTk5NzMsIDAuOTk5NDIsIDEuMDAxMDEsIDEuMDAwNjEsIDEuMDAwMjYsIDEuMDAwNjksIDEuMDAwNiwgMS4wMDAxNCwgMC45OTk3MywgMS4wMTMyMiwgMC45OTk3MywgMS4wMDA2NSwgMS4wMDAyNiwgMS4wMDAxMiwgMC45OTkyMywgMSwgMS4wMDA2NCwgMS4wMDA3NiwgMC45OTk0OCwgMS4wMDA1NSwgMS4wMDA2MywgMS4wMDAwNywgMC45OTk0MywgMS4wMDA2LCAwLjk5OTQ4LCAxLjAwMDI2LCAwLjk5OTQ4LCAwLjk5OTQzLCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDI5LCAxLjAwMDM4LCAxLjAwMDM1LCAxLjAwMDAxLCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3OCwgMS4wMDAwMSwgMS4wMDA1NywgMC45OTk4OSwgMC45OTk2NywgMC45OTk2NCwgMC45OTk2NywgMC45OTk3NywgMC45OTk5OSwgMC45OTk3NywgMS4wMDAzOCwgMC45OTk3NywgMS4wMDAwMSwgMC45OTk3MywgMS4wMDA2NiwgMC45OTk2NywgMC45OTk2NywgMS4wMDA0MSwgMC45OTk5OCwgMC45OTk5OSwgMC45OTk3NywgMS4wMDAyMiwgMC45OTk2NywgMS4wMDAwMSwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk2NCwgMS4wMDAzMSwgMS4wMDAwMSwgMC45OTk5OSwgMC45OTk5OSwgMSwgMS4wMDAyMywgMSwgMSwgMC45OTk5OSwgMS4wMDAzNSwgMS4wMDAwMSwgMC45OTk5OSwgMC45OTk3MywgMC45OTk3NywgMC45OTk5OSwgMS4wMDA1OCwgMC45OTk3MywgMC45OTk3MywgMC45OTk1NSwgMC45OTk1LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDMyLCAwLjk5OTg5LCAxLjAwMDM0LCAwLjk5OTk5LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk5OTczLCAwLjQ1OTk4LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTk5LCAwLjk5OTgyLCAwLjk5OTk0LCAwLjk5OTk2LCAxLCAxLjAwMDQyLCAxLjAwMDQ0LCAxLjAwMDI5LCAxLjAwMDIzLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTQ5LCAxLjAwMDAyLCAwLjk5OTczLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTc1LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDMyLCAwLjk4Njg1LCAwLjk5OTczLCAxLjAwMDI2LCAxLCAxLCAwLjk5OTY2LCAxLjAwMDQ0LCAxLjAwMDE2LCAxLjAwMDIyLCAxLjAwMDE2LCAxLjAwMDIyLCAxLjAwMDE2LCAxLjAwMDIyLCAxLjAwMDAxLCAwLjk5OTczLCAxLCAxLCAwLjk5OTczLCAxLCAxLCAwLjk5OTU1LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEsIDEsIDEsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzIsIDEsIDEsIDEuMDAxMDYsIDAuOTk5OTksIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTksIDAuOTk5OTgsIDEuNjY0NzUsIDEsIDAuOTk5NzMsIDAuOTk5NzMsIDEsIDAuOTk5NzMsIDAuOTk5NzEsIDAuOTk5NzgsIDEsIDEsIDAuOTk5OTEsIDAuOTk5ODQsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwOTgsIDEsIDEsIDEsIDEuMDAwNDksIDEsIDEsIDAuOTk5NzIsIDEsIDEuMjA5ODUsIDEuMzk3MTMsIDEuMDAwMDMsIDEuMDAwMzEsIDEuMDAwMTUsIDEsIDAuOTk1NjEsIDEuMDAwMjcsIDEuMDAwMzEsIDEuMDAwMzEsIDAuOTk5MTUsIDEuMDAwMzEsIDEuMDAwMzEsIDAuOTk5OTksIDEuMDAwMDMsIDAuOTk5OTksIDAuOTk5OTksIDEuNDExNDQsIDEuNiwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MTE0NCwgMS40MDU3OSwgMS40MDU3OSwgMS4zNjYyNSwgMC45OTk5OSwgMSwgMC45OTg2MSwgMC45OTg2MSwgMSwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMC45OTk3MiwgMC45OTk5OSwgMC45OTk5OSwgMC45OTk5OSwgMC45OTk5OSwgMS40MDQ4MywgMSwgMC45OTk3NywgMS4wMDA1NCwgMSwgMSwgMC45OTk1MywgMC45OTk2MiwgMS4wMDA0MiwgMC45OTk1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKY29uc3QgSGVsdmV0aWNhQm9sZEl0YWxpY01ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4zNSwKICBsaW5lR2FwOiAwLjIKfTsKY29uc3QgSGVsdmV0aWNhSXRhbGljRmFjdG9ycyA9IFswLjc2MTE2LCAxLCAxLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDAwNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk4MiwgMS4wMDAwMSwgMS4wMDA0MywgMC45OTk5OCwgMC45OTk5OCwgMC45OTk1OSwgMS4wMDAwMywgMS4wMDA2LCAwLjk5OTk4LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAxLCAxLjAwMDAzLCAxLjAwMDAzLCAxLjAwMDAzLCAwLjk5OTczLCAwLjk5OTg3LCAxLjAwMDAxLCAxLjAwMDAxLCAwLjk5OTc3LCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDI2LCAxLjAwMDIyLCAwLjk5OTc3LCAxLjAwMDYsIDEsIDEuMDAwMDEsIDAuOTk5NzMsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwMDEsIDEuMDAwMjIsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMTYsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NDksIDAuOTk5NzMsIDAuOTk5OTgsIDAuOTk5NzMsIDAuOTk5NzMsIDEsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3MywgMC45OTkyNCwgMC45OTkyNCwgMSwgMC45OTkyNCwgMC45OTk5OSwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk5OCwgMSwgMS4wMDA2LCAwLjk5OTczLCAxLCAwLjk5OTc3LCAxLCAxLCAxLCAxLjAwMDA1LCAxLjAwMDksIDEuMDAwMDUsIDEuMDAwMDMsIDAuOTk5OTgsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwOSwgMC45OTk3MywgMC45OTk5OCwgMS4wMDAyNSwgMC45OTk2OCwgMC45OTk3MywgMS4wMDAwMywgMS4wMDAyNSwgMC42MDI5OSwgMS4wMDAyNCwgMS4wNjQwOSwgMSwgMSwgMC45OTk5OCwgMSwgMC45OTk4LCAxLjAwMDYsIDAuOTk5OTgsIDEsIDAuOTk5MzYsIDAuOTk5NzMsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMjYsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3NywgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAwMywgMS4wMDAyMiwgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk4MiwgMSwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjA2NDA5LCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLCAwLjk5OTczLCAxLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLjAyODgsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTkyNCwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NDYsIDEuMDAwMzQsIDEsIDAuOTk5MjQsIDEuMDAwMDEsIDEsIDEsIDAuOTk5NzMsIDAuOTk5MjQsIDAuOTk5NzMsIDAuOTk5MjQsIDAuOTk5NzMsIDEuMDYzMTEsIDAuOTk5NzMsIDEuMDAwMjQsIDAuOTk5NzMsIDAuOTk5MjQsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwNDEsIDAuOTk5OCwgMC45OTk3MywgMS4wMDAyMiwgMC45OTk3MywgMS4wMDAyMiwgMC45OTk3MywgMS4wMDAyMiwgMC45OTk3MywgMSwgMS4wMDAxNiwgMC45OTk3NywgMC45OTk5OCwgMC45OTk3NywgMC45OTk5OCwgMC45OTk3NywgMC45OTk5OCwgMS4wMDAwMSwgMSwgMS4wMDAwMSwgMSwgMS4wMDAwMSwgMSwgMS4wMDAwMSwgMSwgMS4wMDAyNiwgMS4wMDA2LCAxLjAwMDI2LCAwLjg5NTQ3LCAxLjAwMDI2LCAxLjAwMDYsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEuMDAwMjYsIDEsIDEuMDAwMjYsIDEsIDEuMDAwMjYsIDEsIDAuOTk5MjQsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEsIDAuOTk5ODIsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMDEsIDEsIDEuMDAwMjYsIDEuMDAwNiwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMS4wMDAwMSwgMSwgMS4wMDA1NCwgMC45OTk3NywgMS4wMDA4NCwgMS4wMDAwNywgMC45OTk3MywgMS4wMDAxMywgMC45OTkyNCwgMS4wMDAwMSwgMS4wMDAwMSwgMC45OTk0NSwgMC45MTIyMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDA2LCAxLjAwMDAxLCAxLjAwMDAxLCAwLjk5OTk5LCAwLjk5OTc3LCAwLjk5OTMzLCAxLjAwMDIyLCAxLjAwMDU0LCAxLjAwMDAxLCAxLjAwMDY1LCAxLjAwMDI2LCAxLjAwMDAxLCAxLjAwMDEsIDEuMDAwMDEsIDEuMDAwNTIsIDEsIDEuMDAwNiwgMS4wMDAwMSwgMC45OTk0NSwgMC45OTg5NywgMC45OTk2OCwgMC45OTkyNCwgMS4wMDAzNiwgMC45OTk0NSwgMC45OTk0OSwgMSwgMS4wMDA2LCAwLjk5ODk3LCAwLjk5OTE4LCAwLjk5OTY4LCAwLjk5OTExLCAwLjk5OTI0LCAxLCAwLjk5OTYyLCAxLjAxNDg3LCAxLCAxLjAwMDUsIDAuOTk5NzMsIDEuMDAwMTIsIDEuMDAwNDMsIDEsIDAuOTk5OTUsIDAuOTk5OTQsIDEuMDAwMzYsIDAuOTk5NDcsIDEuMDAwMTksIDEuMDAwNjMsIDEuMDAwMjUsIDAuOTk5MjQsIDEuMDAwMzYsIDAuOTk5NzMsIDEuMDAwMzYsIDEuMDAwMjUsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMjcsIDEuMDAwMSwgMS4wMDA2OCwgMS4wMDAwMSwgMS4wMDA2LCAxLjAwMDYsIDEsIDEuMDAwMDgsIDAuOTk5NTcsIDAuOTk5NzIsIDAuOTk5NCwgMC45OTk1NCwgMC45OTk3NSwgMS4wMDA1MSwgMS4wMDAwMSwgMS4wMDAxOSwgMS4wMDAwMSwgMS4wMDAxLCAwLjk5OTg2LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDM4LCAwLjk5OTU0LCAwLjk5OTU0LCAwLjk5OTQsIDEuMDAwNjYsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwNTQsIDEuMDAwMDEsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5NzUsIDEuMDAwMSwgMS4wMDAwMSwgMC45OTk5MywgMC45OTk1LCAwLjk5OTU1LCAxLjAwMDE2LCAwLjk5OTc4LCAwLjk5OTc0LCAxLjAwMDE5LCAxLjAwMDIyLCAwLjk5OTU1LCAxLjAwMDUzLCAwLjk5OTczLCAxLjAwMDg5LCAxLjAwMDA1LCAwLjk5OTY3LCAxLjAwMDQ4LCAwLjk5OTczLCAxLjAwMDAyLCAxLjAwMDM0LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTY0LCAxLjAwMDA2LCAxLjAwMDY2LCAwLjk5OTQ3LCAwLjk5OTczLCAwLjk4ODk0LCAwLjk5OTczLCAxLCAwLjQ0ODk4LCAxLCAwLjk5OTQ2LCAxLCAxLjAwMDM5LCAxLjAwMDgyLCAwLjk5OTkxLCAwLjk5OTkxLCAwLjk5OTg1LCAxLjAwMDIyLCAxLjAwMDIzLCAxLjAwMDYxLCAxLjAwMDA2LCAwLjk5OTY2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDE5LCAxLjAwMDgsIDEsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5ODMsIDEuMDAwNDQsIDAuOTk5NzMsIDAuOTk5NjQsIDAuOTgzMzIsIDEsIDAuOTk5NzMsIDEsIDEsIDAuOTk5NjIsIDAuOTk4OTUsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMDEsIDEsIDEsIDEsIDAuOTk5NzMsIDEsIDEsIDAuOTk5NTUsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzIsIDEsIDEsIDEuMDAyNjcsIDAuOTk5OTksIDAuOTk5OTgsIDAuOTk5OTgsIDEsIDAuOTk5OTgsIDEuNjY0NzUsIDEsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwMjMsIDAuOTk5NzMsIDEuMDA0MjMsIDAuOTk5MjUsIDAuOTk5OTksIDEsIDAuOTk5OTEsIDAuOTk5ODQsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwNDksIDEsIDEuMDAyNDUsIDEsIDEsIDEsIDEsIDAuOTYzMjksIDEsIDEuMjA5ODUsIDEuMzk3MTMsIDEuMDAwMDMsIDAuODI1NCwgMS4wMDAxNSwgMSwgMS4wMDAzNSwgMS4wMDAyNywgMS4wMDAzMSwgMS4wMDAzMSwgMS4wMDAwMywgMS4wMDAzMSwgMS4wMDAzMSwgMC45OTk5OSwgMS4wMDAwMywgMC45OTk5OSwgMC45OTk5OSwgMS40MTE0NCwgMS42LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQwNTc5LCAxLjQwNTc5LCAxLjM2NjI1LCAwLjk5OTk5LCAxLCAwLjk5ODYxLCAwLjk5ODYxLCAxLCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk1MzE3LCAwLjk5OTk5LCAwLjk5OTk5LCAwLjk5OTk5LCAwLjk5OTk5LCAxLjQwNDgzLCAxLCAwLjk5OTc3LCAxLjAwMDU0LCAxLCAxLCAwLjk5OTUzLCAwLjk5OTYyLCAxLjAwMDQyLCAwLjk5OTUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBIZWx2ZXRpY2FJdGFsaWNNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMzUsCiAgbGluZUdhcDogMC4yCn07CmNvbnN0IEhlbHZldGljYVJlZ3VsYXJGYWN0b3JzID0gWzAuNzYxMTYsIDEsIDEsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDA2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTgyLCAxLjAwMDAxLCAxLjAwMDQzLCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTU5LCAxLjAwMDAzLCAxLjAwMDYsIDAuOTk5OTgsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDYsIDEsIDEuMDAwMDMsIDEuMDAwMDMsIDEuMDAwMDMsIDAuOTk5NzMsIDAuOTk5ODcsIDEuMDAwMDEsIDEuMDAwMDEsIDAuOTk5NzcsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMjYsIDEuMDAwMjIsIDAuOTk5NzcsIDEuMDAwNiwgMSwgMS4wMDAwMSwgMC45OTk3MywgMC45OTk5OSwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAwMSwgMS4wMDAyMiwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAxNiwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk0OSwgMC45OTk3MywgMC45OTk5OCwgMC45OTk3MywgMC45OTk3MywgMSwgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTI0LCAwLjk5OTI0LCAxLCAwLjk5OTI0LCAwLjk5OTk5LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTk4LCAxLCAxLjAwMDYsIDAuOTk5NzMsIDEsIDAuOTk5NzcsIDEsIDEsIDEsIDEuMDAwMDUsIDEuMDAwOSwgMS4wMDAwNSwgMS4wMDAwMywgMC45OTk5OCwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA5LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI1LCAwLjk5OTY4LCAwLjk5OTczLCAxLjAwMDAzLCAxLjAwMDI1LCAwLjYwMjk5LCAxLjAwMDI0LCAxLjA2NDA5LCAxLCAxLCAwLjk5OTk4LCAxLCAwLjk5OTgsIDEuMDAwNiwgMC45OTk5OCwgMSwgMC45OTkzNiwgMC45OTk3MywgMS4wMDAwMiwgMS4wMDAwMiwgMS4wMDAwMiwgMS4wMDAyNiwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMSwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTc3LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDAzLCAxLjAwMDIyLCAwLjk5OTc3LCAwLjk5OTc3LCAwLjk5OTc3LCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTgyLCAxLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDY0MDksIDEuMDAwMjYsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEsIDAuOTk5NzMsIDEsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDAuOTk5NzcsIDEsIDAuOTk5NzcsIDEsIDAuOTk5NzcsIDEsIDAuOTk5NzcsIDEsIDAuOTk5NzcsIDEuMDQ1OTYsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTkyNCwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwMTksIDEuMDAwMzQsIDEsIDAuOTk5MjQsIDEuMDAwMDEsIDEsIDEsIDAuOTk5NzMsIDAuOTk5MjQsIDAuOTk5NzMsIDAuOTk5MjQsIDAuOTk5NzMsIDEuMDI1NzIsIDAuOTk5NzMsIDEuMDAwMDUsIDAuOTk5NzMsIDAuOTk5MjQsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5OTksIDAuOTk5OCwgMC45OTk3MywgMS4wMDAyMiwgMC45OTk3MywgMS4wMDAyMiwgMC45OTk3MywgMS4wMDAyMiwgMC45OTk3MywgMSwgMS4wMDAxNiwgMC45OTk3NywgMC45OTk5OCwgMC45OTk3NywgMC45OTk5OCwgMC45OTk3NywgMC45OTk5OCwgMS4wMDAwMSwgMSwgMS4wMDAwMSwgMSwgMS4wMDAwMSwgMSwgMS4wMDAwMSwgMSwgMS4wMDAyNiwgMS4wMDA2LCAxLjAwMDI2LCAwLjg0NTMzLCAxLjAwMDI2LCAxLjAwMDYsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEuMDAwMjYsIDEsIDEuMDAwMjYsIDEsIDEuMDAwMjYsIDEsIDAuOTk5MjQsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEsIDAuOTk5ODIsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMDEsIDEsIDEuMDAwMjYsIDEuMDAwNiwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTkyOCwgMSwgMC45OTk3NywgMS4wMDAxMywgMS4wMDA1NSwgMC45OTk0NywgMC45OTk0NSwgMC45OTk0MSwgMC45OTkyNCwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDA0LCAwLjkxNjIxLCAxLjAwMDAxLCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDYsIDEuMDAwMDEsIDEuMDAwMDUsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMTUsIDEuMDAwMjIsIDAuOTk5NzcsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjYsIDEuMDAwMDEsIDEuMDAwMTksIDEuMDAwMDEsIDAuOTk5NDYsIDEsIDEuMDAwNiwgMS4wMDAwMSwgMC45OTk3OCwgMS4wMDA0NSwgMC45OTk3MywgMC45OTkyNCwgMS4wMDAyMywgMC45OTk3OCwgMC45OTk2NiwgMSwgMS4wMDA2NSwgMS4wMDA0NSwgMS4wMDAxOSwgMC45OTk3MywgMC45OTk3MywgMC45OTkyNCwgMSwgMSwgMC45NjQ5OSwgMSwgMS4wMDA1NSwgMC45OTk3MywgMS4wMDAwOCwgMS4wMDAyNywgMSwgMC45OTk3LCAwLjk5OTk1LCAxLjAwMDIzLCAwLjk5OTMzLCAxLjAwMDE5LCAxLjAwMDE1LCAxLjAwMDMxLCAwLjk5OTI0LCAxLjAwMDIzLCAwLjk5OTczLCAxLjAwMDIzLCAxLjAwMDMxLCAxLjAwMDAxLCAwLjk5OTI4LCAxLjAwMDI5LCAxLjAwMDkyLCAxLjAwMDM1LCAxLjAwMDAxLCAxLjAwMDYsIDEuMDAwNiwgMSwgMC45OTk4OCwgMC45OTk3NSwgMSwgMS4wMDA4MiwgMC45OTU2MSwgMC45OTk2LCAxLjAwMDM1LCAxLjAwMDAxLCAwLjk5OTYyLCAxLjAwMDAxLCAxLjAwMDkyLCAwLjk5OTY0LCAxLjAwMDAxLCAwLjk5OTYzLCAwLjk5OTk5LCAxLjAwMDM1LCAxLjAwMDM1LCAxLjAwMDgyLCAwLjk5OTYyLCAwLjk5OTk5LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDM1LCAxLjAwMDAxLCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTYsIDAuOTk5NjcsIDEuMDAwMDEsIDEuMDAwMzQsIDEuMDAwNzQsIDEuMDAwNTQsIDEuMDAwNTMsIDEuMDAwNjMsIDAuOTk5NzEsIDAuOTk5NjIsIDEuMDAwMzUsIDAuOTk5NzUsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwNDMsIDAuOTk5NTMsIDEuMDAwNywgMC45OTkxNSwgMC45OTk3MywgMS4wMDAwOCwgMC45OTg5MiwgMS4wMDA3MywgMS4wMDA3MywgMS4wMDExNCwgMC45OTkxNSwgMS4wMDA3MywgMC45OTk1NSwgMC45OTk3MywgMS4wMDA5MiwgMC45OTk3MywgMSwgMC45OTk5OCwgMSwgMS4wMDAzLCAxLCAxLjAwMDQzLCAxLjAwMDAxLCAwLjk5OTY5LCAxLjAwMDMsIDEsIDEuMDAwMzUsIDEuMDAwMDEsIDAuOTk5NSwgMSwgMS4wMDA5MiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA3LCAwLjk5OTUsIDEsIDAuOTk5MjQsIDEuMDAwNiwgMC45OTkyNCwgMC45OTk3MiwgMS4wMDA2MiwgMC45OTk3MywgMS4wMDExNCwgMS4wMDA3MywgMSwgMC45OTk1NSwgMSwgMSwgMS4wMDA0NywgMC45OTk2OCwgMS4wMDAxNiwgMC45OTk3NywgMS4wMDAxNiwgMC45OTk3NywgMS4wMDAxNiwgMC45OTk3NywgMS4wMDAwMSwgMSwgMSwgMSwgMC45OTk3MywgMSwgMSwgMC45OTk1NSwgMC45OTkyNCwgMC45OTkyNCwgMC45OTkyNCwgMC45OTkyNCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MiwgMSwgMSwgMS4wMDI2NywgMC45OTk5OSwgMC45OTk5OCwgMC45OTk5OCwgMSwgMC45OTk5OCwgMS42NjQ3NSwgMSwgMC45OTk3MywgMC45OTk3MywgMS4wMDAyMywgMC45OTk3MywgMC45OTk3MSwgMC45OTkyNSwgMS4wMDAyMywgMSwgMC45OTk5MSwgMC45OTk4NCwgMS4wMDAwMiwgMS4wMDAwMiwgMS4wMDAwMiwgMS4wMDAwMiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45NjMyOSwgMSwgMS4yMDk4NSwgMS4zOTcxMywgMS4wMDAwMywgMC44MjU0LCAxLjAwMDE1LCAxLCAxLjAwMDM1LCAxLjAwMDI3LCAxLjAwMDMxLCAxLjAwMDMxLCAwLjk5OTE1LCAxLjAwMDMxLCAxLjAwMDMxLCAwLjk5OTk5LCAxLjAwMDAzLCAwLjk5OTk5LCAwLjk5OTk5LCAxLjQxMTQ0LCAxLjYsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDA1NzksIDEuNDA1NzksIDEuMzY2MjUsIDAuOTk5OTksIDEsIDAuOTk4NjEsIDAuOTk4NjEsIDEsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDAuOTUzMTcsIDAuOTk5OTksIDAuOTk5OTksIDAuOTk5OTksIDAuOTk5OTksIDEuNDA0ODMsIDEsIDAuOTk5NzcsIDEuMDAwNTQsIDEsIDEsIDAuOTk5NTMsIDAuOTk5NjIsIDEuMDAwNDIsIDAuOTk5NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IEhlbHZldGljYVJlZ3VsYXJNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMiwKICBsaW5lR2FwOiAwLjIKfTsKCjsvLyAuL3NyYy9jb3JlL2xpYmVyYXRpb25zYW5zX3dpZHRocy5qcwpjb25zdCBMaWJlcmF0aW9uU2Fuc0JvbGRXaWR0aHMgPSBbMzY1LCAwLCAzMzMsIDI3OCwgMzMzLCA0NzQsIDU1NiwgNTU2LCA4ODksIDcyMiwgMjM4LCAzMzMsIDMzMywgMzg5LCA1ODQsIDI3OCwgMzMzLCAyNzgsIDI3OCwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCAzMzMsIDMzMywgNTg0LCA1ODQsIDU4NCwgNjExLCA5NzUsIDcyMiwgNzIyLCA3MjIsIDcyMiwgNjY3LCA2MTEsIDc3OCwgNzIyLCAyNzgsIDU1NiwgNzIyLCA2MTEsIDgzMywgNzIyLCA3NzgsIDY2NywgNzc4LCA3MjIsIDY2NywgNjExLCA3MjIsIDY2NywgOTQ0LCA2NjcsIDY2NywgNjExLCAzMzMsIDI3OCwgMzMzLCA1ODQsIDU1NiwgMzMzLCA1NTYsIDYxMSwgNTU2LCA2MTEsIDU1NiwgMzMzLCA2MTEsIDYxMSwgMjc4LCAyNzgsIDU1NiwgMjc4LCA4ODksIDYxMSwgNjExLCA2MTEsIDYxMSwgMzg5LCA1NTYsIDMzMywgNjExLCA1NTYsIDc3OCwgNTU2LCA1NTYsIDUwMCwgMzg5LCAyODAsIDM4OSwgNTg0LCAzMzMsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMjgwLCA1NTYsIDMzMywgNzM3LCAzNzAsIDU1NiwgNTg0LCA3MzcsIDU1MiwgNDAwLCA1NDksIDMzMywgMzMzLCAzMzMsIDU3NiwgNTU2LCAyNzgsIDMzMywgMzMzLCAzNjUsIDU1NiwgODM0LCA4MzQsIDgzNCwgNjExLCA3MjIsIDcyMiwgNzIyLCA3MjIsIDcyMiwgNzIyLCAxMDAwLCA3MjIsIDY2NywgNjY3LCA2NjcsIDY2NywgMjc4LCAyNzgsIDI3OCwgMjc4LCA3MjIsIDcyMiwgNzc4LCA3NzgsIDc3OCwgNzc4LCA3NzgsIDU4NCwgNzc4LCA3MjIsIDcyMiwgNzIyLCA3MjIsIDY2NywgNjY3LCA2MTEsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDg4OSwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNjExLCA2MTEsIDYxMSwgNjExLCA2MTEsIDYxMSwgNjExLCA1NDksIDYxMSwgNjExLCA2MTEsIDYxMSwgNjExLCA1NTYsIDYxMSwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA3MTksIDcyMiwgNjExLCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDc3OCwgNjExLCA3NzgsIDYxMSwgNzc4LCA2MTEsIDc3OCwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNzg1LCA1NTYsIDU1NiwgMjc4LCA3MjIsIDU1NiwgNTU2LCA2MTEsIDI3OCwgNjExLCAyNzgsIDYxMSwgMzg1LCA2MTEsIDQ3OSwgNjExLCAyNzgsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcwOCwgNzIzLCA2MTEsIDc3OCwgNjExLCA3NzgsIDYxMSwgNzc4LCA2MTEsIDEwMDAsIDk0NCwgNzIyLCAzODksIDcyMiwgMzg5LCA3MjIsIDM4OSwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDYxMSwgMzMzLCA2MTEsIDQ3OSwgNjExLCAzMzMsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDk0NCwgNzc4LCA2NjcsIDU1NiwgNjY3LCA2MTEsIDUwMCwgNjExLCA1MDAsIDYxMSwgNTAwLCAyNzgsIDU1NiwgNzIyLCA1NTYsIDEwMDAsIDg4OSwgNzc4LCA2MTEsIDY2NywgNTU2LCA2MTEsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCA0NjUsIDcyMiwgMzMzLCA4NTMsIDkwNiwgNDc0LCA4MjUsIDkyNywgODM4LCAyNzgsIDcyMiwgNzIyLCA2MDEsIDcxOSwgNjY3LCA2MTEsIDcyMiwgNzc4LCAyNzgsIDcyMiwgNjY3LCA4MzMsIDcyMiwgNjQ0LCA3NzgsIDcyMiwgNjY3LCA2MDAsIDYxMSwgNjY3LCA4MjEsIDY2NywgODA5LCA4MDIsIDI3OCwgNjY3LCA2MTUsIDQ1MSwgNjExLCAyNzgsIDU4MiwgNjE1LCA2MTAsIDU1NiwgNjA2LCA0NzUsIDQ2MCwgNjExLCA1NDEsIDI3OCwgNTU4LCA1NTYsIDYxMiwgNTU2LCA0NDUsIDYxMSwgNzY2LCA2MTksIDUyMCwgNjg0LCA0NDYsIDU4MiwgNzE1LCA1NzYsIDc1MywgODQ1LCAyNzgsIDU4MiwgNjExLCA1ODIsIDg0NSwgNjY3LCA2NjksIDg4NSwgNTY3LCA3MTEsIDY2NywgMjc4LCAyNzYsIDU1NiwgMTA5NCwgMTA2MiwgODc1LCA2MTAsIDcyMiwgNjIyLCA3MTksIDcyMiwgNzE5LCA3MjIsIDU2NywgNzEyLCA2NjcsIDkwNCwgNjI2LCA3MTksIDcxOSwgNjEwLCA3MDIsIDgzMywgNzIyLCA3NzgsIDcxOSwgNjY3LCA3MjIsIDYxMSwgNjIyLCA4NTQsIDY2NywgNzMwLCA3MDMsIDEwMDUsIDEwMTksIDg3MCwgOTc5LCA3MTksIDcxMSwgMTAzMSwgNzE5LCA1NTYsIDYxOCwgNjE1LCA0MTcsIDYzNSwgNTU2LCA3MDksIDQ5NywgNjE1LCA2MTUsIDUwMCwgNjM1LCA3NDAsIDYwNCwgNjExLCA2MDQsIDYxMSwgNTU2LCA0OTAsIDU1NiwgODc1LCA1NTYsIDYxNSwgNTgxLCA4MzMsIDg0NCwgNzI5LCA4NTQsIDYxNSwgNTUyLCA4NTQsIDU4MywgNTU2LCA1NTYsIDYxMSwgNDE3LCA1NTIsIDU1NiwgMjc4LCAyODEsIDI3OCwgOTY5LCA5MDYsIDYxMSwgNTAwLCA2MTUsIDU1NiwgNjA0LCA3NzgsIDYxMSwgNDg3LCA0NDcsIDk0NCwgNzc4LCA5NDQsIDc3OCwgOTQ0LCA3NzgsIDY2NywgNTU2LCAzMzMsIDMzMywgNTU2LCAxMDAwLCAxMDAwLCA1NTIsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNTAwLCA1MDAsIDUwMCwgNTU2LCA1NTYsIDM1MCwgMTAwMCwgMTAwMCwgMjQwLCA0NzksIDMzMywgMzMzLCA2MDQsIDMzMywgMTY3LCAzOTYsIDU1NiwgNTU2LCAxMDk0LCA1NTYsIDg4NSwgNDg5LCAxMTE1LCAxMDAwLCA3NjgsIDYwMCwgODM0LCA4MzQsIDgzNCwgODM0LCAxMDAwLCA1MDAsIDEwMDAsIDUwMCwgMTAwMCwgNTAwLCA1MDAsIDQ5NCwgNjEyLCA4MjMsIDcxMywgNTg0LCA1NDksIDcxMywgOTc5LCA3MjIsIDI3NCwgNTQ5LCA1NDksIDU4MywgNTQ5LCA1NDksIDYwNCwgNTg0LCA2MDQsIDYwNCwgNzA4LCA2MjUsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcyOSwgNjA0LCA2MDQsIDM1NCwgMzU0LCAxMDAwLCA5OTAsIDk5MCwgOTkwLCA5OTAsIDQ5NCwgNjA0LCA2MDQsIDYwNCwgNjA0LCAzNTQsIDEwMjEsIDEwNTIsIDkxNywgNzUwLCA3NTAsIDUzMSwgNjU2LCA1OTQsIDUxMCwgNTAwLCA3NTAsIDc1MCwgNjExLCA2MTEsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAyMjIsIDIyMiwgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzNdOwpjb25zdCBMaWJlcmF0aW9uU2Fuc0JvbGRNYXBwaW5nID0gWy0xLCAtMSwgLTEsIDMyLCAzMywgMzQsIDM1LCAzNiwgMzcsIDM4LCAzOSwgNDAsIDQxLCA0MiwgNDMsIDQ0LCA0NSwgNDYsIDQ3LCA0OCwgNDksIDUwLCA1MSwgNTIsIDUzLCA1NCwgNTUsIDU2LCA1NywgNTgsIDU5LCA2MCwgNjEsIDYyLCA2MywgNjQsIDY1LCA2NiwgNjcsIDY4LCA2OSwgNzAsIDcxLCA3MiwgNzMsIDc0LCA3NSwgNzYsIDc3LCA3OCwgNzksIDgwLCA4MSwgODIsIDgzLCA4NCwgODUsIDg2LCA4NywgODgsIDg5LCA5MCwgOTEsIDkyLCA5MywgOTQsIDk1LCA5NiwgOTcsIDk4LCA5OSwgMTAwLCAxMDEsIDEwMiwgMTAzLCAxMDQsIDEwNSwgMTA2LCAxMDcsIDEwOCwgMTA5LCAxMTAsIDExMSwgMTEyLCAxMTMsIDExNCwgMTE1LCAxMTYsIDExNywgMTE4LCAxMTksIDEyMCwgMTIxLCAxMjIsIDEyMywgMTI0LCAxMjUsIDEyNiwgMTYxLCAxNjIsIDE2MywgMTY0LCAxNjUsIDE2NiwgMTY3LCAxNjgsIDE2OSwgMTcwLCAxNzEsIDE3MiwgMTc0LCAxNzUsIDE3NiwgMTc3LCAxNzgsIDE3OSwgMTgwLCAxODEsIDE4MiwgMTgzLCAxODQsIDE4NSwgMTg2LCAxODcsIDE4OCwgMTg5LCAxOTAsIDE5MSwgMTkyLCAxOTMsIDE5NCwgMTk1LCAxOTYsIDE5NywgMTk4LCAxOTksIDIwMCwgMjAxLCAyMDIsIDIwMywgMjA0LCAyMDUsIDIwNiwgMjA3LCAyMDgsIDIwOSwgMjEwLCAyMTEsIDIxMiwgMjEzLCAyMTQsIDIxNSwgMjE2LCAyMTcsIDIxOCwgMjE5LCAyMjAsIDIyMSwgMjIyLCAyMjMsIDIyNCwgMjI1LCAyMjYsIDIyNywgMjI4LCAyMjksIDIzMCwgMjMxLCAyMzIsIDIzMywgMjM0LCAyMzUsIDIzNiwgMjM3LCAyMzgsIDIzOSwgMjQwLCAyNDEsIDI0MiwgMjQzLCAyNDQsIDI0NSwgMjQ2LCAyNDcsIDI0OCwgMjQ5LCAyNTAsIDI1MSwgMjUyLCAyNTMsIDI1NCwgMjU1LCAyNTYsIDI1NywgMjU4LCAyNTksIDI2MCwgMjYxLCAyNjIsIDI2MywgMjY0LCAyNjUsIDI2NiwgMjY3LCAyNjgsIDI2OSwgMjcwLCAyNzEsIDI3MiwgMjczLCAyNzQsIDI3NSwgMjc2LCAyNzcsIDI3OCwgMjc5LCAyODAsIDI4MSwgMjgyLCAyODMsIDI4NCwgMjg1LCAyODYsIDI4NywgMjg4LCAyODksIDI5MCwgMjkxLCAyOTIsIDI5MywgMjk0LCAyOTUsIDI5NiwgMjk3LCAyOTgsIDI5OSwgMzAwLCAzMDEsIDMwMiwgMzAzLCAzMDQsIDMwNSwgMzA2LCAzMDcsIDMwOCwgMzA5LCAzMTAsIDMxMSwgMzEyLCAzMTMsIDMxNCwgMzE1LCAzMTYsIDMxNywgMzE4LCAzMTksIDMyMCwgMzIxLCAzMjIsIDMyMywgMzI0LCAzMjUsIDMyNiwgMzI3LCAzMjgsIDMyOSwgMzMwLCAzMzEsIDMzMiwgMzMzLCAzMzQsIDMzNSwgMzM2LCAzMzcsIDMzOCwgMzM5LCAzNDAsIDM0MSwgMzQyLCAzNDMsIDM0NCwgMzQ1LCAzNDYsIDM0NywgMzQ4LCAzNDksIDM1MCwgMzUxLCAzNTIsIDM1MywgMzU0LCAzNTUsIDM1NiwgMzU3LCAzNTgsIDM1OSwgMzYwLCAzNjEsIDM2MiwgMzYzLCAzNjQsIDM2NSwgMzY2LCAzNjcsIDM2OCwgMzY5LCAzNzAsIDM3MSwgMzcyLCAzNzMsIDM3NCwgMzc1LCAzNzYsIDM3NywgMzc4LCAzNzksIDM4MCwgMzgxLCAzODIsIDM4MywgNDAyLCA1MDYsIDUwNywgNTA4LCA1MDksIDUxMCwgNTExLCA1MzYsIDUzNywgNTM4LCA1MzksIDcxMCwgNzExLCA3MTMsIDcyOCwgNzI5LCA3MzAsIDczMSwgNzMyLCA3MzMsIDkwMCwgOTAxLCA5MDIsIDkwMywgOTA0LCA5MDUsIDkwNiwgOTA4LCA5MTAsIDkxMSwgOTEyLCA5MTMsIDkxNCwgOTE1LCA5MTYsIDkxNywgOTE4LCA5MTksIDkyMCwgOTIxLCA5MjIsIDkyMywgOTI0LCA5MjUsIDkyNiwgOTI3LCA5MjgsIDkyOSwgOTMxLCA5MzIsIDkzMywgOTM0LCA5MzUsIDkzNiwgOTM3LCA5MzgsIDkzOSwgOTQwLCA5NDEsIDk0MiwgOTQzLCA5NDQsIDk0NSwgOTQ2LCA5NDcsIDk0OCwgOTQ5LCA5NTAsIDk1MSwgOTUyLCA5NTMsIDk1NCwgOTU1LCA5NTYsIDk1NywgOTU4LCA5NTksIDk2MCwgOTYxLCA5NjIsIDk2MywgOTY0LCA5NjUsIDk2NiwgOTY3LCA5NjgsIDk2OSwgOTcwLCA5NzEsIDk3MiwgOTczLCA5NzQsIDEwMjQsIDEwMjUsIDEwMjYsIDEwMjcsIDEwMjgsIDEwMjksIDEwMzAsIDEwMzEsIDEwMzIsIDEwMzMsIDEwMzQsIDEwMzUsIDEwMzYsIDEwMzcsIDEwMzgsIDEwMzksIDEwNDAsIDEwNDEsIDEwNDIsIDEwNDMsIDEwNDQsIDEwNDUsIDEwNDYsIDEwNDcsIDEwNDgsIDEwNDksIDEwNTAsIDEwNTEsIDEwNTIsIDEwNTMsIDEwNTQsIDEwNTUsIDEwNTYsIDEwNTcsIDEwNTgsIDEwNTksIDEwNjAsIDEwNjEsIDEwNjIsIDEwNjMsIDEwNjQsIDEwNjUsIDEwNjYsIDEwNjcsIDEwNjgsIDEwNjksIDEwNzAsIDEwNzEsIDEwNzIsIDEwNzMsIDEwNzQsIDEwNzUsIDEwNzYsIDEwNzcsIDEwNzgsIDEwNzksIDEwODAsIDEwODEsIDEwODIsIDEwODMsIDEwODQsIDEwODUsIDEwODYsIDEwODcsIDEwODgsIDEwODksIDEwOTAsIDEwOTEsIDEwOTIsIDEwOTMsIDEwOTQsIDEwOTUsIDEwOTYsIDEwOTcsIDEwOTgsIDEwOTksIDExMDAsIDExMDEsIDExMDIsIDExMDMsIDExMDQsIDExMDUsIDExMDYsIDExMDcsIDExMDgsIDExMDksIDExMTAsIDExMTEsIDExMTIsIDExMTMsIDExMTQsIDExMTUsIDExMTYsIDExMTcsIDExMTgsIDExMTksIDExMzgsIDExMzksIDExNjgsIDExNjksIDc4MDgsIDc4MDksIDc4MTAsIDc4MTEsIDc4MTIsIDc4MTMsIDc5MjIsIDc5MjMsIDgyMDgsIDgyMDksIDgyMTEsIDgyMTIsIDgyMTMsIDgyMTUsIDgyMTYsIDgyMTcsIDgyMTgsIDgyMTksIDgyMjAsIDgyMjEsIDgyMjIsIDgyMjQsIDgyMjUsIDgyMjYsIDgyMzAsIDgyNDAsIDgyNDIsIDgyNDMsIDgyNDksIDgyNTAsIDgyNTIsIDgyNTQsIDgyNjAsIDgzMTksIDgzNTUsIDgzNTYsIDgzNTksIDgzNjQsIDg0NTMsIDg0NjcsIDg0NzAsIDg0ODIsIDg0ODYsIDg0OTQsIDg1MzksIDg1NDAsIDg1NDEsIDg1NDIsIDg1OTIsIDg1OTMsIDg1OTQsIDg1OTUsIDg1OTYsIDg1OTcsIDg2MTYsIDg3MDYsIDg3MTAsIDg3MTksIDg3MjEsIDg3MjIsIDg3MzAsIDg3MzQsIDg3MzUsIDg3NDUsIDg3NDcsIDg3NzYsIDg4MDAsIDg4MDEsIDg4MDQsIDg4MDUsIDg5NjIsIDg5NzYsIDg5OTIsIDg5OTMsIDk0NzIsIDk0NzQsIDk0ODQsIDk0ODgsIDk0OTIsIDk0OTYsIDk1MDAsIDk1MDgsIDk1MTYsIDk1MjQsIDk1MzIsIDk1NTIsIDk1NTMsIDk1NTQsIDk1NTUsIDk1NTYsIDk1NTcsIDk1NTgsIDk1NTksIDk1NjAsIDk1NjEsIDk1NjIsIDk1NjMsIDk1NjQsIDk1NjUsIDk1NjYsIDk1NjcsIDk1NjgsIDk1NjksIDk1NzAsIDk1NzEsIDk1NzIsIDk1NzMsIDk1NzQsIDk1NzUsIDk1NzYsIDk1NzcsIDk1NzgsIDk1NzksIDk1ODAsIDk2MDAsIDk2MDQsIDk2MDgsIDk2MTIsIDk2MTYsIDk2MTcsIDk2MTgsIDk2MTksIDk2MzIsIDk2MzMsIDk2NDIsIDk2NDMsIDk2NDQsIDk2NTAsIDk2NTgsIDk2NjAsIDk2NjgsIDk2NzQsIDk2NzUsIDk2NzksIDk2ODgsIDk2ODksIDk3MDIsIDk3ODYsIDk3ODcsIDk3ODgsIDk3OTIsIDk3OTQsIDk4MjQsIDk4MjcsIDk4MjksIDk4MzAsIDk4MzQsIDk4MzUsIDk4MzYsIDYxNDQxLCA2MTQ0MiwgNjE0NDUsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMV07CmNvbnN0IExpYmVyYXRpb25TYW5zQm9sZEl0YWxpY1dpZHRocyA9IFszNjUsIDAsIDMzMywgMjc4LCAzMzMsIDQ3NCwgNTU2LCA1NTYsIDg4OSwgNzIyLCAyMzgsIDMzMywgMzMzLCAzODksIDU4NCwgMjc4LCAzMzMsIDI3OCwgMjc4LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDMzMywgMzMzLCA1ODQsIDU4NCwgNTg0LCA2MTEsIDk3NSwgNzIyLCA3MjIsIDcyMiwgNzIyLCA2NjcsIDYxMSwgNzc4LCA3MjIsIDI3OCwgNTU2LCA3MjIsIDYxMSwgODMzLCA3MjIsIDc3OCwgNjY3LCA3NzgsIDcyMiwgNjY3LCA2MTEsIDcyMiwgNjY3LCA5NDQsIDY2NywgNjY3LCA2MTEsIDMzMywgMjc4LCAzMzMsIDU4NCwgNTU2LCAzMzMsIDU1NiwgNjExLCA1NTYsIDYxMSwgNTU2LCAzMzMsIDYxMSwgNjExLCAyNzgsIDI3OCwgNTU2LCAyNzgsIDg4OSwgNjExLCA2MTEsIDYxMSwgNjExLCAzODksIDU1NiwgMzMzLCA2MTEsIDU1NiwgNzc4LCA1NTYsIDU1NiwgNTAwLCAzODksIDI4MCwgMzg5LCA1ODQsIDMzMywgNTU2LCA1NTYsIDU1NiwgNTU2LCAyODAsIDU1NiwgMzMzLCA3MzcsIDM3MCwgNTU2LCA1ODQsIDczNywgNTUyLCA0MDAsIDU0OSwgMzMzLCAzMzMsIDMzMywgNTc2LCA1NTYsIDI3OCwgMzMzLCAzMzMsIDM2NSwgNTU2LCA4MzQsIDgzNCwgODM0LCA2MTEsIDcyMiwgNzIyLCA3MjIsIDcyMiwgNzIyLCA3MjIsIDEwMDAsIDcyMiwgNjY3LCA2NjcsIDY2NywgNjY3LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDcyMiwgNzIyLCA3NzgsIDc3OCwgNzc4LCA3NzgsIDc3OCwgNTg0LCA3NzgsIDcyMiwgNzIyLCA3MjIsIDcyMiwgNjY3LCA2NjcsIDYxMSwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgODg5LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMjc4LCAyNzgsIDI3OCwgMjc4LCA2MTEsIDYxMSwgNjExLCA2MTEsIDYxMSwgNjExLCA2MTEsIDU0OSwgNjExLCA2MTEsIDYxMSwgNjExLCA2MTEsIDU1NiwgNjExLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDc0MCwgNzIyLCA2MTEsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNzc4LCA2MTEsIDc3OCwgNjExLCA3NzgsIDYxMSwgNzc4LCA2MTEsIDcyMiwgNjExLCA3MjIsIDYxMSwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCA3ODIsIDU1NiwgNTU2LCAyNzgsIDcyMiwgNTU2LCA1NTYsIDYxMSwgMjc4LCA2MTEsIDI3OCwgNjExLCAzOTYsIDYxMSwgNDc5LCA2MTEsIDI3OCwgNzIyLCA2MTEsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzA4LCA3MjMsIDYxMSwgNzc4LCA2MTEsIDc3OCwgNjExLCA3NzgsIDYxMSwgMTAwMCwgOTQ0LCA3MjIsIDM4OSwgNzIyLCAzODksIDcyMiwgMzg5LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjExLCAzMzMsIDYxMSwgNDc5LCA2MTEsIDMzMywgNzIyLCA2MTEsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcyMiwgNjExLCA3MjIsIDYxMSwgOTQ0LCA3NzgsIDY2NywgNTU2LCA2NjcsIDYxMSwgNTAwLCA2MTEsIDUwMCwgNjExLCA1MDAsIDI3OCwgNTU2LCA3MjIsIDU1NiwgMTAwMCwgODg5LCA3NzgsIDYxMSwgNjY3LCA1NTYsIDYxMSwgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgNzIyLCAzMzMsIDg1NCwgOTA2LCA0NzMsIDg0NCwgOTMwLCA4NDcsIDI3OCwgNzIyLCA3MjIsIDYxMCwgNjcxLCA2NjcsIDYxMSwgNzIyLCA3NzgsIDI3OCwgNzIyLCA2NjcsIDgzMywgNzIyLCA2NTcsIDc3OCwgNzE4LCA2NjcsIDU5MCwgNjExLCA2NjcsIDgyMiwgNjY3LCA4MjksIDc4MSwgMjc4LCA2NjcsIDYyMCwgNDc5LCA2MTEsIDI3OCwgNTkxLCA2MjAsIDYyMSwgNTU2LCA2MTAsIDQ3OSwgNDkyLCA2MTEsIDU1OCwgMjc4LCA1NjYsIDU1NiwgNjAzLCA1NTYsIDQ1MCwgNjExLCA3MTIsIDYwNSwgNTMyLCA2NjQsIDQwOSwgNTkxLCA3MDQsIDU3OCwgNzczLCA4MzQsIDI3OCwgNTkxLCA2MTEsIDU5MSwgODM0LCA2NjcsIDY2NywgODg2LCA2MTQsIDcxOSwgNjY3LCAyNzgsIDI3OCwgNTU2LCAxMDk0LCAxMDQyLCA4NTQsIDYyMiwgNzE5LCA2NzcsIDcxOSwgNzIyLCA3MDgsIDcyMiwgNjE0LCA3MjIsIDY2NywgOTI3LCA2NDMsIDcxOSwgNzE5LCA2MTUsIDY4NywgODMzLCA3MjIsIDc3OCwgNzE5LCA2NjcsIDcyMiwgNjExLCA2NzcsIDc4MSwgNjY3LCA3MjksIDcwOCwgOTc5LCA5ODksIDg1NCwgMTAwMCwgNzA4LCA3MTksIDEwNDIsIDcyOSwgNTU2LCA2MTksIDYwNCwgNTM0LCA2MTgsIDU1NiwgNzM2LCA1MTAsIDYxMSwgNjExLCA1MDcsIDYyMiwgNzQwLCA2MDQsIDYxMSwgNjExLCA2MTEsIDU1NiwgODg5LCA1NTYsIDg4NSwgNTU2LCA2NDYsIDU4MywgODg5LCA5MzUsIDcwNywgODU0LCA1OTQsIDU1MiwgODY1LCA1ODksIDU1NiwgNTU2LCA2MTEsIDQ2OSwgNTYzLCA1NTYsIDI3OCwgMjc4LCAyNzgsIDk2OSwgOTA2LCA2MTEsIDUwNywgNjE5LCA1NTYsIDYxMSwgNzc4LCA2MTEsIDU3NSwgNDY3LCA5NDQsIDc3OCwgOTQ0LCA3NzgsIDk0NCwgNzc4LCA2NjcsIDU1NiwgMzMzLCAzMzMsIDU1NiwgMTAwMCwgMTAwMCwgNTUyLCAyNzgsIDI3OCwgMjc4LCAyNzgsIDUwMCwgNTAwLCA1MDAsIDU1NiwgNTU2LCAzNTAsIDEwMDAsIDEwMDAsIDI0MCwgNDc5LCAzMzMsIDMzMywgNjA0LCAzMzMsIDE2NywgMzk2LCA1NTYsIDU1NiwgMTEwNCwgNTU2LCA4ODUsIDUxNiwgMTE0NiwgMTAwMCwgNzY4LCA2MDAsIDgzNCwgODM0LCA4MzQsIDgzNCwgOTk5LCA1MDAsIDEwMDAsIDUwMCwgMTAwMCwgNTAwLCA1MDAsIDQ5NCwgNjEyLCA4MjMsIDcxMywgNTg0LCA1NDksIDcxMywgOTc5LCA3MjIsIDI3NCwgNTQ5LCA1NDksIDU4MywgNTQ5LCA1NDksIDYwNCwgNTg0LCA2MDQsIDYwNCwgNzA4LCA2MjUsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcyOSwgNjA0LCA2MDQsIDM1NCwgMzU0LCAxMDAwLCA5OTAsIDk5MCwgOTkwLCA5OTAsIDQ5NCwgNjA0LCA2MDQsIDYwNCwgNjA0LCAzNTQsIDEwMjEsIDEwNTIsIDkxNywgNzUwLCA3NTAsIDUzMSwgNjU2LCA1OTQsIDUxMCwgNTAwLCA3NTAsIDc1MCwgNjExLCA2MTEsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAyMjIsIDIyMiwgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzNdOwpjb25zdCBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNNYXBwaW5nID0gWy0xLCAtMSwgLTEsIDMyLCAzMywgMzQsIDM1LCAzNiwgMzcsIDM4LCAzOSwgNDAsIDQxLCA0MiwgNDMsIDQ0LCA0NSwgNDYsIDQ3LCA0OCwgNDksIDUwLCA1MSwgNTIsIDUzLCA1NCwgNTUsIDU2LCA1NywgNTgsIDU5LCA2MCwgNjEsIDYyLCA2MywgNjQsIDY1LCA2NiwgNjcsIDY4LCA2OSwgNzAsIDcxLCA3MiwgNzMsIDc0LCA3NSwgNzYsIDc3LCA3OCwgNzksIDgwLCA4MSwgODIsIDgzLCA4NCwgODUsIDg2LCA4NywgODgsIDg5LCA5MCwgOTEsIDkyLCA5MywgOTQsIDk1LCA5NiwgOTcsIDk4LCA5OSwgMTAwLCAxMDEsIDEwMiwgMTAzLCAxMDQsIDEwNSwgMTA2LCAxMDcsIDEwOCwgMTA5LCAxMTAsIDExMSwgMTEyLCAxMTMsIDExNCwgMTE1LCAxMTYsIDExNywgMTE4LCAxMTksIDEyMCwgMTIxLCAxMjIsIDEyMywgMTI0LCAxMjUsIDEyNiwgMTYxLCAxNjIsIDE2MywgMTY0LCAxNjUsIDE2NiwgMTY3LCAxNjgsIDE2OSwgMTcwLCAxNzEsIDE3MiwgMTc0LCAxNzUsIDE3NiwgMTc3LCAxNzgsIDE3OSwgMTgwLCAxODEsIDE4MiwgMTgzLCAxODQsIDE4NSwgMTg2LCAxODcsIDE4OCwgMTg5LCAxOTAsIDE5MSwgMTkyLCAxOTMsIDE5NCwgMTk1LCAxOTYsIDE5NywgMTk4LCAxOTksIDIwMCwgMjAxLCAyMDIsIDIwMywgMjA0LCAyMDUsIDIwNiwgMjA3LCAyMDgsIDIwOSwgMjEwLCAyMTEsIDIxMiwgMjEzLCAyMTQsIDIxNSwgMjE2LCAyMTcsIDIxOCwgMjE5LCAyMjAsIDIyMSwgMjIyLCAyMjMsIDIyNCwgMjI1LCAyMjYsIDIyNywgMjI4LCAyMjksIDIzMCwgMjMxLCAyMzIsIDIzMywgMjM0LCAyMzUsIDIzNiwgMjM3LCAyMzgsIDIzOSwgMjQwLCAyNDEsIDI0MiwgMjQzLCAyNDQsIDI0NSwgMjQ2LCAyNDcsIDI0OCwgMjQ5LCAyNTAsIDI1MSwgMjUyLCAyNTMsIDI1NCwgMjU1LCAyNTYsIDI1NywgMjU4LCAyNTksIDI2MCwgMjYxLCAyNjIsIDI2MywgMjY0LCAyNjUsIDI2NiwgMjY3LCAyNjgsIDI2OSwgMjcwLCAyNzEsIDI3MiwgMjczLCAyNzQsIDI3NSwgMjc2LCAyNzcsIDI3OCwgMjc5LCAyODAsIDI4MSwgMjgyLCAyODMsIDI4NCwgMjg1LCAyODYsIDI4NywgMjg4LCAyODksIDI5MCwgMjkxLCAyOTIsIDI5MywgMjk0LCAyOTUsIDI5NiwgMjk3LCAyOTgsIDI5OSwgMzAwLCAzMDEsIDMwMiwgMzAzLCAzMDQsIDMwNSwgMzA2LCAzMDcsIDMwOCwgMzA5LCAzMTAsIDMxMSwgMzEyLCAzMTMsIDMxNCwgMzE1LCAzMTYsIDMxNywgMzE4LCAzMTksIDMyMCwgMzIxLCAzMjIsIDMyMywgMzI0LCAzMjUsIDMyNiwgMzI3LCAzMjgsIDMyOSwgMzMwLCAzMzEsIDMzMiwgMzMzLCAzMzQsIDMzNSwgMzM2LCAzMzcsIDMzOCwgMzM5LCAzNDAsIDM0MSwgMzQyLCAzNDMsIDM0NCwgMzQ1LCAzNDYsIDM0NywgMzQ4LCAzNDksIDM1MCwgMzUxLCAzNTIsIDM1MywgMzU0LCAzNTUsIDM1NiwgMzU3LCAzNTgsIDM1OSwgMzYwLCAzNjEsIDM2MiwgMzYzLCAzNjQsIDM2NSwgMzY2LCAzNjcsIDM2OCwgMzY5LCAzNzAsIDM3MSwgMzcyLCAzNzMsIDM3NCwgMzc1LCAzNzYsIDM3NywgMzc4LCAzNzksIDM4MCwgMzgxLCAzODIsIDM4MywgNDAyLCA1MDYsIDUwNywgNTA4LCA1MDksIDUxMCwgNTExLCA1MzYsIDUzNywgNTM4LCA1MzksIDcxMCwgNzExLCA3MTMsIDcyOCwgNzI5LCA3MzAsIDczMSwgNzMyLCA3MzMsIDkwMCwgOTAxLCA5MDIsIDkwMywgOTA0LCA5MDUsIDkwNiwgOTA4LCA5MTAsIDkxMSwgOTEyLCA5MTMsIDkxNCwgOTE1LCA5MTYsIDkxNywgOTE4LCA5MTksIDkyMCwgOTIxLCA5MjIsIDkyMywgOTI0LCA5MjUsIDkyNiwgOTI3LCA5MjgsIDkyOSwgOTMxLCA5MzIsIDkzMywgOTM0LCA5MzUsIDkzNiwgOTM3LCA5MzgsIDkzOSwgOTQwLCA5NDEsIDk0MiwgOTQzLCA5NDQsIDk0NSwgOTQ2LCA5NDcsIDk0OCwgOTQ5LCA5NTAsIDk1MSwgOTUyLCA5NTMsIDk1NCwgOTU1LCA5NTYsIDk1NywgOTU4LCA5NTksIDk2MCwgOTYxLCA5NjIsIDk2MywgOTY0LCA5NjUsIDk2NiwgOTY3LCA5NjgsIDk2OSwgOTcwLCA5NzEsIDk3MiwgOTczLCA5NzQsIDEwMjQsIDEwMjUsIDEwMjYsIDEwMjcsIDEwMjgsIDEwMjksIDEwMzAsIDEwMzEsIDEwMzIsIDEwMzMsIDEwMzQsIDEwMzUsIDEwMzYsIDEwMzcsIDEwMzgsIDEwMzksIDEwNDAsIDEwNDEsIDEwNDIsIDEwNDMsIDEwNDQsIDEwNDUsIDEwNDYsIDEwNDcsIDEwNDgsIDEwNDksIDEwNTAsIDEwNTEsIDEwNTIsIDEwNTMsIDEwNTQsIDEwNTUsIDEwNTYsIDEwNTcsIDEwNTgsIDEwNTksIDEwNjAsIDEwNjEsIDEwNjIsIDEwNjMsIDEwNjQsIDEwNjUsIDEwNjYsIDEwNjcsIDEwNjgsIDEwNjksIDEwNzAsIDEwNzEsIDEwNzIsIDEwNzMsIDEwNzQsIDEwNzUsIDEwNzYsIDEwNzcsIDEwNzgsIDEwNzksIDEwODAsIDEwODEsIDEwODIsIDEwODMsIDEwODQsIDEwODUsIDEwODYsIDEwODcsIDEwODgsIDEwODksIDEwOTAsIDEwOTEsIDEwOTIsIDEwOTMsIDEwOTQsIDEwOTUsIDEwOTYsIDEwOTcsIDEwOTgsIDEwOTksIDExMDAsIDExMDEsIDExMDIsIDExMDMsIDExMDQsIDExMDUsIDExMDYsIDExMDcsIDExMDgsIDExMDksIDExMTAsIDExMTEsIDExMTIsIDExMTMsIDExMTQsIDExMTUsIDExMTYsIDExMTcsIDExMTgsIDExMTksIDExMzgsIDExMzksIDExNjgsIDExNjksIDc4MDgsIDc4MDksIDc4MTAsIDc4MTEsIDc4MTIsIDc4MTMsIDc5MjIsIDc5MjMsIDgyMDgsIDgyMDksIDgyMTEsIDgyMTIsIDgyMTMsIDgyMTUsIDgyMTYsIDgyMTcsIDgyMTgsIDgyMTksIDgyMjAsIDgyMjEsIDgyMjIsIDgyMjQsIDgyMjUsIDgyMjYsIDgyMzAsIDgyNDAsIDgyNDIsIDgyNDMsIDgyNDksIDgyNTAsIDgyNTIsIDgyNTQsIDgyNjAsIDgzMTksIDgzNTUsIDgzNTYsIDgzNTksIDgzNjQsIDg0NTMsIDg0NjcsIDg0NzAsIDg0ODIsIDg0ODYsIDg0OTQsIDg1MzksIDg1NDAsIDg1NDEsIDg1NDIsIDg1OTIsIDg1OTMsIDg1OTQsIDg1OTUsIDg1OTYsIDg1OTcsIDg2MTYsIDg3MDYsIDg3MTAsIDg3MTksIDg3MjEsIDg3MjIsIDg3MzAsIDg3MzQsIDg3MzUsIDg3NDUsIDg3NDcsIDg3NzYsIDg4MDAsIDg4MDEsIDg4MDQsIDg4MDUsIDg5NjIsIDg5NzYsIDg5OTIsIDg5OTMsIDk0NzIsIDk0NzQsIDk0ODQsIDk0ODgsIDk0OTIsIDk0OTYsIDk1MDAsIDk1MDgsIDk1MTYsIDk1MjQsIDk1MzIsIDk1NTIsIDk1NTMsIDk1NTQsIDk1NTUsIDk1NTYsIDk1NTcsIDk1NTgsIDk1NTksIDk1NjAsIDk1NjEsIDk1NjIsIDk1NjMsIDk1NjQsIDk1NjUsIDk1NjYsIDk1NjcsIDk1NjgsIDk1NjksIDk1NzAsIDk1NzEsIDk1NzIsIDk1NzMsIDk1NzQsIDk1NzUsIDk1NzYsIDk1NzcsIDk1NzgsIDk1NzksIDk1ODAsIDk2MDAsIDk2MDQsIDk2MDgsIDk2MTIsIDk2MTYsIDk2MTcsIDk2MTgsIDk2MTksIDk2MzIsIDk2MzMsIDk2NDIsIDk2NDMsIDk2NDQsIDk2NTAsIDk2NTgsIDk2NjAsIDk2NjgsIDk2NzQsIDk2NzUsIDk2NzksIDk2ODgsIDk2ODksIDk3MDIsIDk3ODYsIDk3ODcsIDk3ODgsIDk3OTIsIDk3OTQsIDk4MjQsIDk4MjcsIDk4MjksIDk4MzAsIDk4MzQsIDk4MzUsIDk4MzYsIDYxNDQxLCA2MTQ0MiwgNjE0NDUsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMV07CmNvbnN0IExpYmVyYXRpb25TYW5zSXRhbGljV2lkdGhzID0gWzM2NSwgMCwgMzMzLCAyNzgsIDI3OCwgMzU1LCA1NTYsIDU1NiwgODg5LCA2NjcsIDE5MSwgMzMzLCAzMzMsIDM4OSwgNTg0LCAyNzgsIDMzMywgMjc4LCAyNzgsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMjc4LCAyNzgsIDU4NCwgNTg0LCA1ODQsIDU1NiwgMTAxNSwgNjY3LCA2NjcsIDcyMiwgNzIyLCA2NjcsIDYxMSwgNzc4LCA3MjIsIDI3OCwgNTAwLCA2NjcsIDU1NiwgODMzLCA3MjIsIDc3OCwgNjY3LCA3NzgsIDcyMiwgNjY3LCA2MTEsIDcyMiwgNjY3LCA5NDQsIDY2NywgNjY3LCA2MTEsIDI3OCwgMjc4LCAyNzgsIDQ2OSwgNTU2LCAzMzMsIDU1NiwgNTU2LCA1MDAsIDU1NiwgNTU2LCAyNzgsIDU1NiwgNTU2LCAyMjIsIDIyMiwgNTAwLCAyMjIsIDgzMywgNTU2LCA1NTYsIDU1NiwgNTU2LCAzMzMsIDUwMCwgMjc4LCA1NTYsIDUwMCwgNzIyLCA1MDAsIDUwMCwgNTAwLCAzMzQsIDI2MCwgMzM0LCA1ODQsIDMzMywgNTU2LCA1NTYsIDU1NiwgNTU2LCAyNjAsIDU1NiwgMzMzLCA3MzcsIDM3MCwgNTU2LCA1ODQsIDczNywgNTUyLCA0MDAsIDU0OSwgMzMzLCAzMzMsIDMzMywgNTc2LCA1MzcsIDI3OCwgMzMzLCAzMzMsIDM2NSwgNTU2LCA4MzQsIDgzNCwgODM0LCA2MTEsIDY2NywgNjY3LCA2NjcsIDY2NywgNjY3LCA2NjcsIDEwMDAsIDcyMiwgNjY3LCA2NjcsIDY2NywgNjY3LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDcyMiwgNzIyLCA3NzgsIDc3OCwgNzc4LCA3NzgsIDc3OCwgNTg0LCA3NzgsIDcyMiwgNzIyLCA3MjIsIDcyMiwgNjY3LCA2NjcsIDYxMSwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgODg5LCA1MDAsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMjc4LCAyNzgsIDI3OCwgMjc4LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU0OSwgNjExLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDUwMCwgNTU2LCA1MDAsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDcyMiwgNTAwLCA3MjIsIDUwMCwgNzIyLCA1MDAsIDcyMiwgNTAwLCA3MjIsIDYyNSwgNzIyLCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNzc4LCA1NTYsIDc3OCwgNTU2LCA3NzgsIDU1NiwgNzc4LCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyMjIsIDI3OCwgMjc4LCA3MzMsIDQ0NCwgNTAwLCAyMjIsIDY2NywgNTAwLCA1MDAsIDU1NiwgMjIyLCA1NTYsIDIyMiwgNTU2LCAyODEsIDU1NiwgNDAwLCA1NTYsIDIyMiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNjE1LCA3MjMsIDU1NiwgNzc4LCA1NTYsIDc3OCwgNTU2LCA3NzgsIDU1NiwgMTAwMCwgOTQ0LCA3MjIsIDMzMywgNzIyLCAzMzMsIDcyMiwgMzMzLCA2NjcsIDUwMCwgNjY3LCA1MDAsIDY2NywgNTAwLCA2NjcsIDUwMCwgNjExLCAyNzgsIDYxMSwgMzU0LCA2MTEsIDI3OCwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgOTQ0LCA3MjIsIDY2NywgNTAwLCA2NjcsIDYxMSwgNTAwLCA2MTEsIDUwMCwgNjExLCA1MDAsIDIyMiwgNTU2LCA2NjcsIDU1NiwgMTAwMCwgODg5LCA3NzgsIDYxMSwgNjY3LCA1MDAsIDYxMSwgMjc4LCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgNjY3LCAyNzgsIDc4OSwgODQ2LCAzODksIDc5NCwgODY1LCA3NzUsIDIyMiwgNjY3LCA2NjcsIDU3MCwgNjcxLCA2NjcsIDYxMSwgNzIyLCA3NzgsIDI3OCwgNjY3LCA2NjcsIDgzMywgNzIyLCA2NDgsIDc3OCwgNzI1LCA2NjcsIDYwMCwgNjExLCA2NjcsIDgzNywgNjY3LCA4MzEsIDc2MSwgMjc4LCA2NjcsIDU3MCwgNDM5LCA1NTUsIDIyMiwgNTUwLCA1NzAsIDU3MSwgNTAwLCA1NTYsIDQzOSwgNDYzLCA1NTUsIDU0MiwgMjIyLCA1MDAsIDQ5MiwgNTQ4LCA1MDAsIDQ0NywgNTU2LCA2NzAsIDU3MywgNDg2LCA2MDMsIDM3NCwgNTUwLCA2NTIsIDU0NiwgNzI4LCA3NzksIDIyMiwgNTUwLCA1NTYsIDU1MCwgNzc5LCA2NjcsIDY2NywgODQzLCA1NDQsIDcwOCwgNjY3LCAyNzgsIDI3OCwgNTAwLCAxMDY2LCA5ODIsIDg0NCwgNTg5LCA3MTUsIDYzOSwgNzI0LCA2NjcsIDY1MSwgNjY3LCA1NDQsIDcwNCwgNjY3LCA5MTcsIDYxNCwgNzE1LCA3MTUsIDU4OSwgNjg2LCA4MzMsIDcyMiwgNzc4LCA3MjUsIDY2NywgNzIyLCA2MTEsIDYzOSwgNzk1LCA2NjcsIDcyNywgNjczLCA5MjAsIDkyMywgODA1LCA4ODYsIDY1MSwgNjk0LCAxMDIyLCA2ODIsIDU1NiwgNTYyLCA1MjIsIDQ5MywgNTUzLCA1NTYsIDY4OCwgNDY1LCA1NTYsIDU1NiwgNDcyLCA1NjQsIDY4NiwgNTUwLCA1NTYsIDU1NiwgNTU2LCA1MDAsIDgzMywgNTAwLCA4MzUsIDUwMCwgNTcyLCA1MTgsIDgzMCwgODUxLCA2MjEsIDczNiwgNTI2LCA0OTIsIDc1MiwgNTM0LCA1NTYsIDU1NiwgNTU2LCAzNzgsIDQ5NiwgNTAwLCAyMjIsIDIyMiwgMjIyLCA5MTAsIDgyOCwgNTU2LCA0NzIsIDU2NSwgNTAwLCA1NTYsIDc3OCwgNTU2LCA0OTIsIDMzOSwgOTQ0LCA3MjIsIDk0NCwgNzIyLCA5NDQsIDcyMiwgNjY3LCA1MDAsIDMzMywgMzMzLCA1NTYsIDEwMDAsIDEwMDAsIDU1MiwgMjIyLCAyMjIsIDIyMiwgMjIyLCAzMzMsIDMzMywgMzMzLCA1NTYsIDU1NiwgMzUwLCAxMDAwLCAxMDAwLCAxODgsIDM1NCwgMzMzLCAzMzMsIDUwMCwgMzMzLCAxNjcsIDM2NSwgNTU2LCA1NTYsIDEwOTQsIDU1NiwgODg1LCAzMjMsIDEwODMsIDEwMDAsIDc2OCwgNjAwLCA4MzQsIDgzNCwgODM0LCA4MzQsIDEwMDAsIDUwMCwgOTk4LCA1MDAsIDEwMDAsIDUwMCwgNTAwLCA0OTQsIDYxMiwgODIzLCA3MTMsIDU4NCwgNTQ5LCA3MTMsIDk3OSwgNzE5LCAyNzQsIDU0OSwgNTQ5LCA1ODQsIDU0OSwgNTQ5LCA2MDQsIDU4NCwgNjA0LCA2MDQsIDcwOCwgNjI1LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MjksIDYwNCwgNjA0LCAzNTQsIDM1NCwgMTAwMCwgOTkwLCA5OTAsIDk5MCwgOTkwLCA0OTQsIDYwNCwgNjA0LCA2MDQsIDYwNCwgMzU0LCAxMDIxLCAxMDUyLCA5MTcsIDc1MCwgNzUwLCA1MzEsIDY1NiwgNTk0LCA1MTAsIDUwMCwgNzUwLCA3NTAsIDUwMCwgNTAwLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMjIyLCAyMjIsIDI5NCwgMjk0LCAzMjQsIDMyNCwgMzE2LCAzMjgsIDM5OCwgMjg1XTsKY29uc3QgTGliZXJhdGlvblNhbnNJdGFsaWNNYXBwaW5nID0gWy0xLCAtMSwgLTEsIDMyLCAzMywgMzQsIDM1LCAzNiwgMzcsIDM4LCAzOSwgNDAsIDQxLCA0MiwgNDMsIDQ0LCA0NSwgNDYsIDQ3LCA0OCwgNDksIDUwLCA1MSwgNTIsIDUzLCA1NCwgNTUsIDU2LCA1NywgNTgsIDU5LCA2MCwgNjEsIDYyLCA2MywgNjQsIDY1LCA2NiwgNjcsIDY4LCA2OSwgNzAsIDcxLCA3MiwgNzMsIDc0LCA3NSwgNzYsIDc3LCA3OCwgNzksIDgwLCA4MSwgODIsIDgzLCA4NCwgODUsIDg2LCA4NywgODgsIDg5LCA5MCwgOTEsIDkyLCA5MywgOTQsIDk1LCA5NiwgOTcsIDk4LCA5OSwgMTAwLCAxMDEsIDEwMiwgMTAzLCAxMDQsIDEwNSwgMTA2LCAxMDcsIDEwOCwgMTA5LCAxMTAsIDExMSwgMTEyLCAxMTMsIDExNCwgMTE1LCAxMTYsIDExNywgMTE4LCAxMTksIDEyMCwgMTIxLCAxMjIsIDEyMywgMTI0LCAxMjUsIDEyNiwgMTYxLCAxNjIsIDE2MywgMTY0LCAxNjUsIDE2NiwgMTY3LCAxNjgsIDE2OSwgMTcwLCAxNzEsIDE3MiwgMTc0LCAxNzUsIDE3NiwgMTc3LCAxNzgsIDE3OSwgMTgwLCAxODEsIDE4MiwgMTgzLCAxODQsIDE4NSwgMTg2LCAxODcsIDE4OCwgMTg5LCAxOTAsIDE5MSwgMTkyLCAxOTMsIDE5NCwgMTk1LCAxOTYsIDE5NywgMTk4LCAxOTksIDIwMCwgMjAxLCAyMDIsIDIwMywgMjA0LCAyMDUsIDIwNiwgMjA3LCAyMDgsIDIwOSwgMjEwLCAyMTEsIDIxMiwgMjEzLCAyMTQsIDIxNSwgMjE2LCAyMTcsIDIxOCwgMjE5LCAyMjAsIDIyMSwgMjIyLCAyMjMsIDIyNCwgMjI1LCAyMjYsIDIyNywgMjI4LCAyMjksIDIzMCwgMjMxLCAyMzIsIDIzMywgMjM0LCAyMzUsIDIzNiwgMjM3LCAyMzgsIDIzOSwgMjQwLCAyNDEsIDI0MiwgMjQzLCAyNDQsIDI0NSwgMjQ2LCAyNDcsIDI0OCwgMjQ5LCAyNTAsIDI1MSwgMjUyLCAyNTMsIDI1NCwgMjU1LCAyNTYsIDI1NywgMjU4LCAyNTksIDI2MCwgMjYxLCAyNjIsIDI2MywgMjY0LCAyNjUsIDI2NiwgMjY3LCAyNjgsIDI2OSwgMjcwLCAyNzEsIDI3MiwgMjczLCAyNzQsIDI3NSwgMjc2LCAyNzcsIDI3OCwgMjc5LCAyODAsIDI4MSwgMjgyLCAyODMsIDI4NCwgMjg1LCAyODYsIDI4NywgMjg4LCAyODksIDI5MCwgMjkxLCAyOTIsIDI5MywgMjk0LCAyOTUsIDI5NiwgMjk3LCAyOTgsIDI5OSwgMzAwLCAzMDEsIDMwMiwgMzAzLCAzMDQsIDMwNSwgMzA2LCAzMDcsIDMwOCwgMzA5LCAzMTAsIDMxMSwgMzEyLCAzMTMsIDMxNCwgMzE1LCAzMTYsIDMxNywgMzE4LCAzMTksIDMyMCwgMzIxLCAzMjIsIDMyMywgMzI0LCAzMjUsIDMyNiwgMzI3LCAzMjgsIDMyOSwgMzMwLCAzMzEsIDMzMiwgMzMzLCAzMzQsIDMzNSwgMzM2LCAzMzcsIDMzOCwgMzM5LCAzNDAsIDM0MSwgMzQyLCAzNDMsIDM0NCwgMzQ1LCAzNDYsIDM0NywgMzQ4LCAzNDksIDM1MCwgMzUxLCAzNTIsIDM1MywgMzU0LCAzNTUsIDM1NiwgMzU3LCAzNTgsIDM1OSwgMzYwLCAzNjEsIDM2MiwgMzYzLCAzNjQsIDM2NSwgMzY2LCAzNjcsIDM2OCwgMzY5LCAzNzAsIDM3MSwgMzcyLCAzNzMsIDM3NCwgMzc1LCAzNzYsIDM3NywgMzc4LCAzNzksIDM4MCwgMzgxLCAzODIsIDM4MywgNDAyLCA1MDYsIDUwNywgNTA4LCA1MDksIDUxMCwgNTExLCA1MzYsIDUzNywgNTM4LCA1MzksIDcxMCwgNzExLCA3MTMsIDcyOCwgNzI5LCA3MzAsIDczMSwgNzMyLCA3MzMsIDkwMCwgOTAxLCA5MDIsIDkwMywgOTA0LCA5MDUsIDkwNiwgOTA4LCA5MTAsIDkxMSwgOTEyLCA5MTMsIDkxNCwgOTE1LCA5MTYsIDkxNywgOTE4LCA5MTksIDkyMCwgOTIxLCA5MjIsIDkyMywgOTI0LCA5MjUsIDkyNiwgOTI3LCA5MjgsIDkyOSwgOTMxLCA5MzIsIDkzMywgOTM0LCA5MzUsIDkzNiwgOTM3LCA5MzgsIDkzOSwgOTQwLCA5NDEsIDk0MiwgOTQzLCA5NDQsIDk0NSwgOTQ2LCA5NDcsIDk0OCwgOTQ5LCA5NTAsIDk1MSwgOTUyLCA5NTMsIDk1NCwgOTU1LCA5NTYsIDk1NywgOTU4LCA5NTksIDk2MCwgOTYxLCA5NjIsIDk2MywgOTY0LCA5NjUsIDk2NiwgOTY3LCA5NjgsIDk2OSwgOTcwLCA5NzEsIDk3MiwgOTczLCA5NzQsIDEwMjQsIDEwMjUsIDEwMjYsIDEwMjcsIDEwMjgsIDEwMjksIDEwMzAsIDEwMzEsIDEwMzIsIDEwMzMsIDEwMzQsIDEwMzUsIDEwMzYsIDEwMzcsIDEwMzgsIDEwMzksIDEwNDAsIDEwNDEsIDEwNDIsIDEwNDMsIDEwNDQsIDEwNDUsIDEwNDYsIDEwNDcsIDEwNDgsIDEwNDksIDEwNTAsIDEwNTEsIDEwNTIsIDEwNTMsIDEwNTQsIDEwNTUsIDEwNTYsIDEwNTcsIDEwNTgsIDEwNTksIDEwNjAsIDEwNjEsIDEwNjIsIDEwNjMsIDEwNjQsIDEwNjUsIDEwNjYsIDEwNjcsIDEwNjgsIDEwNjksIDEwNzAsIDEwNzEsIDEwNzIsIDEwNzMsIDEwNzQsIDEwNzUsIDEwNzYsIDEwNzcsIDEwNzgsIDEwNzksIDEwODAsIDEwODEsIDEwODIsIDEwODMsIDEwODQsIDEwODUsIDEwODYsIDEwODcsIDEwODgsIDEwODksIDEwOTAsIDEwOTEsIDEwOTIsIDEwOTMsIDEwOTQsIDEwOTUsIDEwOTYsIDEwOTcsIDEwOTgsIDEwOTksIDExMDAsIDExMDEsIDExMDIsIDExMDMsIDExMDQsIDExMDUsIDExMDYsIDExMDcsIDExMDgsIDExMDksIDExMTAsIDExMTEsIDExMTIsIDExMTMsIDExMTQsIDExMTUsIDExMTYsIDExMTcsIDExMTgsIDExMTksIDExMzgsIDExMzksIDExNjgsIDExNjksIDc4MDgsIDc4MDksIDc4MTAsIDc4MTEsIDc4MTIsIDc4MTMsIDc5MjIsIDc5MjMsIDgyMDgsIDgyMDksIDgyMTEsIDgyMTIsIDgyMTMsIDgyMTUsIDgyMTYsIDgyMTcsIDgyMTgsIDgyMTksIDgyMjAsIDgyMjEsIDgyMjIsIDgyMjQsIDgyMjUsIDgyMjYsIDgyMzAsIDgyNDAsIDgyNDIsIDgyNDMsIDgyNDksIDgyNTAsIDgyNTIsIDgyNTQsIDgyNjAsIDgzMTksIDgzNTUsIDgzNTYsIDgzNTksIDgzNjQsIDg0NTMsIDg0NjcsIDg0NzAsIDg0ODIsIDg0ODYsIDg0OTQsIDg1MzksIDg1NDAsIDg1NDEsIDg1NDIsIDg1OTIsIDg1OTMsIDg1OTQsIDg1OTUsIDg1OTYsIDg1OTcsIDg2MTYsIDg3MDYsIDg3MTAsIDg3MTksIDg3MjEsIDg3MjIsIDg3MzAsIDg3MzQsIDg3MzUsIDg3NDUsIDg3NDcsIDg3NzYsIDg4MDAsIDg4MDEsIDg4MDQsIDg4MDUsIDg5NjIsIDg5NzYsIDg5OTIsIDg5OTMsIDk0NzIsIDk0NzQsIDk0ODQsIDk0ODgsIDk0OTIsIDk0OTYsIDk1MDAsIDk1MDgsIDk1MTYsIDk1MjQsIDk1MzIsIDk1NTIsIDk1NTMsIDk1NTQsIDk1NTUsIDk1NTYsIDk1NTcsIDk1NTgsIDk1NTksIDk1NjAsIDk1NjEsIDk1NjIsIDk1NjMsIDk1NjQsIDk1NjUsIDk1NjYsIDk1NjcsIDk1NjgsIDk1NjksIDk1NzAsIDk1NzEsIDk1NzIsIDk1NzMsIDk1NzQsIDk1NzUsIDk1NzYsIDk1NzcsIDk1NzgsIDk1NzksIDk1ODAsIDk2MDAsIDk2MDQsIDk2MDgsIDk2MTIsIDk2MTYsIDk2MTcsIDk2MTgsIDk2MTksIDk2MzIsIDk2MzMsIDk2NDIsIDk2NDMsIDk2NDQsIDk2NTAsIDk2NTgsIDk2NjAsIDk2NjgsIDk2NzQsIDk2NzUsIDk2NzksIDk2ODgsIDk2ODksIDk3MDIsIDk3ODYsIDk3ODcsIDk3ODgsIDk3OTIsIDk3OTQsIDk4MjQsIDk4MjcsIDk4MjksIDk4MzAsIDk4MzQsIDk4MzUsIDk4MzYsIDYxNDQxLCA2MTQ0MiwgNjE0NDUsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMV07CmNvbnN0IExpYmVyYXRpb25TYW5zUmVndWxhcldpZHRocyA9IFszNjUsIDAsIDMzMywgMjc4LCAyNzgsIDM1NSwgNTU2LCA1NTYsIDg4OSwgNjY3LCAxOTEsIDMzMywgMzMzLCAzODksIDU4NCwgMjc4LCAzMzMsIDI3OCwgMjc4LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI3OCwgMjc4LCA1ODQsIDU4NCwgNTg0LCA1NTYsIDEwMTUsIDY2NywgNjY3LCA3MjIsIDcyMiwgNjY3LCA2MTEsIDc3OCwgNzIyLCAyNzgsIDUwMCwgNjY3LCA1NTYsIDgzMywgNzIyLCA3NzgsIDY2NywgNzc4LCA3MjIsIDY2NywgNjExLCA3MjIsIDY2NywgOTQ0LCA2NjcsIDY2NywgNjExLCAyNzgsIDI3OCwgMjc4LCA0NjksIDU1NiwgMzMzLCA1NTYsIDU1NiwgNTAwLCA1NTYsIDU1NiwgMjc4LCA1NTYsIDU1NiwgMjIyLCAyMjIsIDUwMCwgMjIyLCA4MzMsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMzMzLCA1MDAsIDI3OCwgNTU2LCA1MDAsIDcyMiwgNTAwLCA1MDAsIDUwMCwgMzM0LCAyNjAsIDMzNCwgNTg0LCAzMzMsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMjYwLCA1NTYsIDMzMywgNzM3LCAzNzAsIDU1NiwgNTg0LCA3MzcsIDU1MiwgNDAwLCA1NDksIDMzMywgMzMzLCAzMzMsIDU3NiwgNTM3LCAyNzgsIDMzMywgMzMzLCAzNjUsIDU1NiwgODM0LCA4MzQsIDgzNCwgNjExLCA2NjcsIDY2NywgNjY3LCA2NjcsIDY2NywgNjY3LCAxMDAwLCA3MjIsIDY2NywgNjY3LCA2NjcsIDY2NywgMjc4LCAyNzgsIDI3OCwgMjc4LCA3MjIsIDcyMiwgNzc4LCA3NzgsIDc3OCwgNzc4LCA3NzgsIDU4NCwgNzc4LCA3MjIsIDcyMiwgNzIyLCA3MjIsIDY2NywgNjY3LCA2MTEsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDg4OSwgNTAwLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NDksIDYxMSwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1MDAsIDU1NiwgNTAwLCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA3MjIsIDUwMCwgNzIyLCA1MDAsIDcyMiwgNTAwLCA3MjIsIDUwMCwgNzIyLCA2MTUsIDcyMiwgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDc3OCwgNTU2LCA3NzgsIDU1NiwgNzc4LCA1NTYsIDc3OCwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjIyLCAyNzgsIDI3OCwgNzM1LCA0NDQsIDUwMCwgMjIyLCA2NjcsIDUwMCwgNTAwLCA1NTYsIDIyMiwgNTU2LCAyMjIsIDU1NiwgMjkyLCA1NTYsIDMzNCwgNTU2LCAyMjIsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDYwNCwgNzIzLCA1NTYsIDc3OCwgNTU2LCA3NzgsIDU1NiwgNzc4LCA1NTYsIDEwMDAsIDk0NCwgNzIyLCAzMzMsIDcyMiwgMzMzLCA3MjIsIDMzMywgNjY3LCA1MDAsIDY2NywgNTAwLCA2NjcsIDUwMCwgNjY3LCA1MDAsIDYxMSwgMjc4LCA2MTEsIDM3NSwgNjExLCAyNzgsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDk0NCwgNzIyLCA2NjcsIDUwMCwgNjY3LCA2MTEsIDUwMCwgNjExLCA1MDAsIDYxMSwgNTAwLCAyMjIsIDU1NiwgNjY3LCA1NTYsIDEwMDAsIDg4OSwgNzc4LCA2MTEsIDY2NywgNTAwLCA2MTEsIDI3OCwgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDY2NywgMjc4LCA3ODQsIDgzOCwgMzg0LCA3NzQsIDg1NSwgNzUyLCAyMjIsIDY2NywgNjY3LCA1NTEsIDY2OCwgNjY3LCA2MTEsIDcyMiwgNzc4LCAyNzgsIDY2NywgNjY4LCA4MzMsIDcyMiwgNjUwLCA3NzgsIDcyMiwgNjY3LCA2MTgsIDYxMSwgNjY3LCA3OTgsIDY2NywgODM1LCA3NDgsIDI3OCwgNjY3LCA1NzgsIDQ0NiwgNTU2LCAyMjIsIDU0NywgNTc4LCA1NzUsIDUwMCwgNTU3LCA0NDYsIDQ0MSwgNTU2LCA1NTYsIDIyMiwgNTAwLCA1MDAsIDU3NiwgNTAwLCA0NDgsIDU1NiwgNjkwLCA1NjksIDQ4MiwgNjE3LCAzOTUsIDU0NywgNjQ4LCA1MjUsIDcxMywgNzgxLCAyMjIsIDU0NywgNTU2LCA1NDcsIDc4MSwgNjY3LCA2NjcsIDg2NSwgNTQyLCA3MTksIDY2NywgMjc4LCAyNzgsIDUwMCwgMTA1NywgMTAxMCwgODU0LCA1ODMsIDcyMiwgNjM1LCA3MTksIDY2NywgNjU2LCA2NjcsIDU0MiwgNjc3LCA2NjcsIDkyMywgNjA0LCA3MTksIDcxOSwgNTgzLCA2NTYsIDgzMywgNzIyLCA3NzgsIDcxOSwgNjY3LCA3MjIsIDYxMSwgNjM1LCA3NjAsIDY2NywgNzQwLCA2NjcsIDkxNywgOTM4LCA3OTIsIDg4NSwgNjU2LCA3MTksIDEwMTAsIDcyMiwgNTU2LCA1NzMsIDUzMSwgMzY1LCA1ODMsIDU1NiwgNjY5LCA0NTgsIDU1OSwgNTU5LCA0MzgsIDU4MywgNjg4LCA1NTIsIDU1NiwgNTQyLCA1NTYsIDUwMCwgNDU4LCA1MDAsIDgyMywgNTAwLCA1NzMsIDUyMSwgODAyLCA4MjMsIDYyNSwgNzE5LCA1MjEsIDUxMCwgNzUwLCA1NDIsIDU1NiwgNTU2LCA1NTYsIDM2NSwgNTEwLCA1MDAsIDIyMiwgMjc4LCAyMjIsIDkwNiwgODEyLCA1NTYsIDQzOCwgNTU5LCA1MDAsIDU1MiwgNzc4LCA1NTYsIDQ4OSwgNDExLCA5NDQsIDcyMiwgOTQ0LCA3MjIsIDk0NCwgNzIyLCA2NjcsIDUwMCwgMzMzLCAzMzMsIDU1NiwgMTAwMCwgMTAwMCwgNTUyLCAyMjIsIDIyMiwgMjIyLCAyMjIsIDMzMywgMzMzLCAzMzMsIDU1NiwgNTU2LCAzNTAsIDEwMDAsIDEwMDAsIDE4OCwgMzU0LCAzMzMsIDMzMywgNTAwLCAzMzMsIDE2NywgMzY1LCA1NTYsIDU1NiwgMTA5NCwgNTU2LCA4ODUsIDMyMywgMTA3MywgMTAwMCwgNzY4LCA2MDAsIDgzNCwgODM0LCA4MzQsIDgzNCwgMTAwMCwgNTAwLCAxMDAwLCA1MDAsIDEwMDAsIDUwMCwgNTAwLCA0OTQsIDYxMiwgODIzLCA3MTMsIDU4NCwgNTQ5LCA3MTMsIDk3OSwgNzE5LCAyNzQsIDU0OSwgNTQ5LCA1ODMsIDU0OSwgNTQ5LCA2MDQsIDU4NCwgNjA0LCA2MDQsIDcwOCwgNjI1LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MjksIDYwNCwgNjA0LCAzNTQsIDM1NCwgMTAwMCwgOTkwLCA5OTAsIDk5MCwgOTkwLCA0OTQsIDYwNCwgNjA0LCA2MDQsIDYwNCwgMzU0LCAxMDIxLCAxMDUyLCA5MTcsIDc1MCwgNzUwLCA1MzEsIDY1NiwgNTk0LCA1MTAsIDUwMCwgNzUwLCA3NTAsIDUwMCwgNTAwLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMjIyLCAyMjIsIDI5NCwgMjk0LCAzMjQsIDMyNCwgMzE2LCAzMjgsIDM5OCwgMjg1XTsKY29uc3QgTGliZXJhdGlvblNhbnNSZWd1bGFyTWFwcGluZyA9IFstMSwgLTEsIC0xLCAzMiwgMzMsIDM0LCAzNSwgMzYsIDM3LCAzOCwgMzksIDQwLCA0MSwgNDIsIDQzLCA0NCwgNDUsIDQ2LCA0NywgNDgsIDQ5LCA1MCwgNTEsIDUyLCA1MywgNTQsIDU1LCA1NiwgNTcsIDU4LCA1OSwgNjAsIDYxLCA2MiwgNjMsIDY0LCA2NSwgNjYsIDY3LCA2OCwgNjksIDcwLCA3MSwgNzIsIDczLCA3NCwgNzUsIDc2LCA3NywgNzgsIDc5LCA4MCwgODEsIDgyLCA4MywgODQsIDg1LCA4NiwgODcsIDg4LCA4OSwgOTAsIDkxLCA5MiwgOTMsIDk0LCA5NSwgOTYsIDk3LCA5OCwgOTksIDEwMCwgMTAxLCAxMDIsIDEwMywgMTA0LCAxMDUsIDEwNiwgMTA3LCAxMDgsIDEwOSwgMTEwLCAxMTEsIDExMiwgMTEzLCAxMTQsIDExNSwgMTE2LCAxMTcsIDExOCwgMTE5LCAxMjAsIDEyMSwgMTIyLCAxMjMsIDEyNCwgMTI1LCAxMjYsIDE2MSwgMTYyLCAxNjMsIDE2NCwgMTY1LCAxNjYsIDE2NywgMTY4LCAxNjksIDE3MCwgMTcxLCAxNzIsIDE3NCwgMTc1LCAxNzYsIDE3NywgMTc4LCAxNzksIDE4MCwgMTgxLCAxODIsIDE4MywgMTg0LCAxODUsIDE4NiwgMTg3LCAxODgsIDE4OSwgMTkwLCAxOTEsIDE5MiwgMTkzLCAxOTQsIDE5NSwgMTk2LCAxOTcsIDE5OCwgMTk5LCAyMDAsIDIwMSwgMjAyLCAyMDMsIDIwNCwgMjA1LCAyMDYsIDIwNywgMjA4LCAyMDksIDIxMCwgMjExLCAyMTIsIDIxMywgMjE0LCAyMTUsIDIxNiwgMjE3LCAyMTgsIDIxOSwgMjIwLCAyMjEsIDIyMiwgMjIzLCAyMjQsIDIyNSwgMjI2LCAyMjcsIDIyOCwgMjI5LCAyMzAsIDIzMSwgMjMyLCAyMzMsIDIzNCwgMjM1LCAyMzYsIDIzNywgMjM4LCAyMzksIDI0MCwgMjQxLCAyNDIsIDI0MywgMjQ0LCAyNDUsIDI0NiwgMjQ3LCAyNDgsIDI0OSwgMjUwLCAyNTEsIDI1MiwgMjUzLCAyNTQsIDI1NSwgMjU2LCAyNTcsIDI1OCwgMjU5LCAyNjAsIDI2MSwgMjYyLCAyNjMsIDI2NCwgMjY1LCAyNjYsIDI2NywgMjY4LCAyNjksIDI3MCwgMjcxLCAyNzIsIDI3MywgMjc0LCAyNzUsIDI3NiwgMjc3LCAyNzgsIDI3OSwgMjgwLCAyODEsIDI4MiwgMjgzLCAyODQsIDI4NSwgMjg2LCAyODcsIDI4OCwgMjg5LCAyOTAsIDI5MSwgMjkyLCAyOTMsIDI5NCwgMjk1LCAyOTYsIDI5NywgMjk4LCAyOTksIDMwMCwgMzAxLCAzMDIsIDMwMywgMzA0LCAzMDUsIDMwNiwgMzA3LCAzMDgsIDMwOSwgMzEwLCAzMTEsIDMxMiwgMzEzLCAzMTQsIDMxNSwgMzE2LCAzMTcsIDMxOCwgMzE5LCAzMjAsIDMyMSwgMzIyLCAzMjMsIDMyNCwgMzI1LCAzMjYsIDMyNywgMzI4LCAzMjksIDMzMCwgMzMxLCAzMzIsIDMzMywgMzM0LCAzMzUsIDMzNiwgMzM3LCAzMzgsIDMzOSwgMzQwLCAzNDEsIDM0MiwgMzQzLCAzNDQsIDM0NSwgMzQ2LCAzNDcsIDM0OCwgMzQ5LCAzNTAsIDM1MSwgMzUyLCAzNTMsIDM1NCwgMzU1LCAzNTYsIDM1NywgMzU4LCAzNTksIDM2MCwgMzYxLCAzNjIsIDM2MywgMzY0LCAzNjUsIDM2NiwgMzY3LCAzNjgsIDM2OSwgMzcwLCAzNzEsIDM3MiwgMzczLCAzNzQsIDM3NSwgMzc2LCAzNzcsIDM3OCwgMzc5LCAzODAsIDM4MSwgMzgyLCAzODMsIDQwMiwgNTA2LCA1MDcsIDUwOCwgNTA5LCA1MTAsIDUxMSwgNTM2LCA1MzcsIDUzOCwgNTM5LCA3MTAsIDcxMSwgNzEzLCA3MjgsIDcyOSwgNzMwLCA3MzEsIDczMiwgNzMzLCA5MDAsIDkwMSwgOTAyLCA5MDMsIDkwNCwgOTA1LCA5MDYsIDkwOCwgOTEwLCA5MTEsIDkxMiwgOTEzLCA5MTQsIDkxNSwgOTE2LCA5MTcsIDkxOCwgOTE5LCA5MjAsIDkyMSwgOTIyLCA5MjMsIDkyNCwgOTI1LCA5MjYsIDkyNywgOTI4LCA5MjksIDkzMSwgOTMyLCA5MzMsIDkzNCwgOTM1LCA5MzYsIDkzNywgOTM4LCA5MzksIDk0MCwgOTQxLCA5NDIsIDk0MywgOTQ0LCA5NDUsIDk0NiwgOTQ3LCA5NDgsIDk0OSwgOTUwLCA5NTEsIDk1MiwgOTUzLCA5NTQsIDk1NSwgOTU2LCA5NTcsIDk1OCwgOTU5LCA5NjAsIDk2MSwgOTYyLCA5NjMsIDk2NCwgOTY1LCA5NjYsIDk2NywgOTY4LCA5NjksIDk3MCwgOTcxLCA5NzIsIDk3MywgOTc0LCAxMDI0LCAxMDI1LCAxMDI2LCAxMDI3LCAxMDI4LCAxMDI5LCAxMDMwLCAxMDMxLCAxMDMyLCAxMDMzLCAxMDM0LCAxMDM1LCAxMDM2LCAxMDM3LCAxMDM4LCAxMDM5LCAxMDQwLCAxMDQxLCAxMDQyLCAxMDQzLCAxMDQ0LCAxMDQ1LCAxMDQ2LCAxMDQ3LCAxMDQ4LCAxMDQ5LCAxMDUwLCAxMDUxLCAxMDUyLCAxMDUzLCAxMDU0LCAxMDU1LCAxMDU2LCAxMDU3LCAxMDU4LCAxMDU5LCAxMDYwLCAxMDYxLCAxMDYyLCAxMDYzLCAxMDY0LCAxMDY1LCAxMDY2LCAxMDY3LCAxMDY4LCAxMDY5LCAxMDcwLCAxMDcxLCAxMDcyLCAxMDczLCAxMDc0LCAxMDc1LCAxMDc2LCAxMDc3LCAxMDc4LCAxMDc5LCAxMDgwLCAxMDgxLCAxMDgyLCAxMDgzLCAxMDg0LCAxMDg1LCAxMDg2LCAxMDg3LCAxMDg4LCAxMDg5LCAxMDkwLCAxMDkxLCAxMDkyLCAxMDkzLCAxMDk0LCAxMDk1LCAxMDk2LCAxMDk3LCAxMDk4LCAxMDk5LCAxMTAwLCAxMTAxLCAxMTAyLCAxMTAzLCAxMTA0LCAxMTA1LCAxMTA2LCAxMTA3LCAxMTA4LCAxMTA5LCAxMTEwLCAxMTExLCAxMTEyLCAxMTEzLCAxMTE0LCAxMTE1LCAxMTE2LCAxMTE3LCAxMTE4LCAxMTE5LCAxMTM4LCAxMTM5LCAxMTY4LCAxMTY5LCA3ODA4LCA3ODA5LCA3ODEwLCA3ODExLCA3ODEyLCA3ODEzLCA3OTIyLCA3OTIzLCA4MjA4LCA4MjA5LCA4MjExLCA4MjEyLCA4MjEzLCA4MjE1LCA4MjE2LCA4MjE3LCA4MjE4LCA4MjE5LCA4MjIwLCA4MjIxLCA4MjIyLCA4MjI0LCA4MjI1LCA4MjI2LCA4MjMwLCA4MjQwLCA4MjQyLCA4MjQzLCA4MjQ5LCA4MjUwLCA4MjUyLCA4MjU0LCA4MjYwLCA4MzE5LCA4MzU1LCA4MzU2LCA4MzU5LCA4MzY0LCA4NDUzLCA4NDY3LCA4NDcwLCA4NDgyLCA4NDg2LCA4NDk0LCA4NTM5LCA4NTQwLCA4NTQxLCA4NTQyLCA4NTkyLCA4NTkzLCA4NTk0LCA4NTk1LCA4NTk2LCA4NTk3LCA4NjE2LCA4NzA2LCA4NzEwLCA4NzE5LCA4NzIxLCA4NzIyLCA4NzMwLCA4NzM0LCA4NzM1LCA4NzQ1LCA4NzQ3LCA4Nzc2LCA4ODAwLCA4ODAxLCA4ODA0LCA4ODA1LCA4OTYyLCA4OTc2LCA4OTkyLCA4OTkzLCA5NDcyLCA5NDc0LCA5NDg0LCA5NDg4LCA5NDkyLCA5NDk2LCA5NTAwLCA5NTA4LCA5NTE2LCA5NTI0LCA5NTMyLCA5NTUyLCA5NTUzLCA5NTU0LCA5NTU1LCA5NTU2LCA5NTU3LCA5NTU4LCA5NTU5LCA5NTYwLCA5NTYxLCA5NTYyLCA5NTYzLCA5NTY0LCA5NTY1LCA5NTY2LCA5NTY3LCA5NTY4LCA5NTY5LCA5NTcwLCA5NTcxLCA5NTcyLCA5NTczLCA5NTc0LCA5NTc1LCA5NTc2LCA5NTc3LCA5NTc4LCA5NTc5LCA5NTgwLCA5NjAwLCA5NjA0LCA5NjA4LCA5NjEyLCA5NjE2LCA5NjE3LCA5NjE4LCA5NjE5LCA5NjMyLCA5NjMzLCA5NjQyLCA5NjQzLCA5NjQ0LCA5NjUwLCA5NjU4LCA5NjYwLCA5NjY4LCA5Njc0LCA5Njc1LCA5Njc5LCA5Njg4LCA5Njg5LCA5NzAyLCA5Nzg2LCA5Nzg3LCA5Nzg4LCA5NzkyLCA5Nzk0LCA5ODI0LCA5ODI3LCA5ODI5LCA5ODMwLCA5ODM0LCA5ODM1LCA5ODM2LCA2MTQ0MSwgNjE0NDIsIDYxNDQ1LCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTFdOwoKOy8vIC4vc3JjL2NvcmUvbXlyaWFkcHJvX2ZhY3RvcnMuanMKY29uc3QgTXlyaWFkUHJvQm9sZEZhY3RvcnMgPSBbMS4zNjg5OCwgMSwgMSwgMC43MjcwNiwgMC44MDQ3OSwgMC44MzczNCwgMC45ODg5NCwgMC45OTc5MywgMC45ODk3LCAwLjkzODg0LCAwLjg2MjA5LCAwLjk0MjkyLCAwLjk0MjkyLCAxLjE2NjYxLCAxLjAyMDU4LCAwLjkzNTgyLCAwLjk2Njk0LCAwLjkzNTgyLCAxLjE5MTM3LCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjc4MDc2LCAwLjc4MDc2LCAxLjAyMDU4LCAxLjAyMDU4LCAxLjAyMDU4LCAwLjcyODUxLCAwLjc4OTY2LCAwLjkwODM4LCAwLjgzNjM3LCAwLjgyMzkxLCAwLjk2Mzc2LCAwLjgwMDYxLCAwLjg2Mjc1LCAwLjg3NjgsIDAuOTU0MDcsIDEuMDI1OCwgMC43MzkwMSwgMC44NTAyMiwgMC44MzY1NSwgMS4wMTU2LCAwLjk1NTQ2LCAwLjkyMTc5LCAwLjg3MTA3LCAwLjkyMTc5LCAwLjgyMTE0LCAwLjgwOTYsIDAuODk3MTMsIDAuOTQ0MzgsIDAuOTUzNTMsIDAuOTQwODMsIDAuOTE5MDUsIDAuOTA0MDYsIDAuOTQ0NiwgMC45NDI5MiwgMS4xODc3NywgMC45NDI5MiwgMS4wMjA1OCwgMC44OTkwMywgMC45MDA4OCwgMC45NDkzOCwgMC45Nzg5OCwgMC44MTA5MywgMC45NzU3MSwgMC45NDkzOCwgMS4wMjQsIDAuOTU3NywgMC45NTkzMywgMC45ODYyMSwgMS4wNDc0LCAwLjk3NDU1LCAwLjk4OTgxLCAwLjk2NzIsIDAuOTU5MzMsIDAuOTQ0NiwgMC45Nzg5OCwgMC45NzQwNywgMC45NzY0NiwgMC43ODAzNiwgMS4xMDIwOCwgMC45NTQ0MiwgMC45NTI5OCwgMC45NzU3OSwgMC45MzMyLCAwLjk0MDM5LCAwLjkzOCwgMC44MDY4NywgMS4wMTE0OSwgMC44MDY4NywgMS4wMjA1OCwgMC44MDQ3OSwgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMS4wMTE0OSwgMS4wMDg3MiwgMC45MDA4OCwgMC45MTg4MiwgMS4wMjEzLCAwLjgzNjEsIDEuMDIwNTgsIDAuNjIyOTUsIDAuNTQzMjQsIDAuODkwMjIsIDEuMDg1OTUsIDEsIDEsIDAuOTAwODgsIDEsIDAuOTc0NTUsIDAuOTM1ODIsIDAuOTAwODgsIDEsIDEuMDU2ODYsIDAuODM2MSwgMC45OTY0MiwgMC45OTY0MiwgMC45OTY0MiwgMC43Mjg1MSwgMC45MDgzOCwgMC45MDgzOCwgMC45MDgzOCwgMC45MDgzOCwgMC45MDgzOCwgMC45MDgzOCwgMC44NjgsIDAuODIzOTEsIDAuODAwNjEsIDAuODAwNjEsIDAuODAwNjEsIDAuODAwNjEsIDEuMDI1OCwgMS4wMjU4LCAxLjAyNTgsIDEuMDI1OCwgMC45NzQ4NCwgMC45NTU0NiwgMC45MjE3OSwgMC45MjE3OSwgMC45MjE3OSwgMC45MjE3OSwgMC45MjE3OSwgMS4wMjA1OCwgMC45MjE3OSwgMC45NDQzOCwgMC45NDQzOCwgMC45NDQzOCwgMC45NDQzOCwgMC45MDQwNiwgMC44Njk1OCwgMC45ODIyNSwgMC45NDkzOCwgMC45NDkzOCwgMC45NDkzOCwgMC45NDkzOCwgMC45NDkzOCwgMC45NDkzOCwgMC45MDMxLCAwLjgxMDkzLCAwLjk0OTM4LCAwLjk0OTM4LCAwLjk0OTM4LCAwLjk0OTM4LCAwLjk4NjIxLCAwLjk4NjIxLCAwLjk4NjIxLCAwLjk4NjIxLCAwLjkzOTY5LCAwLjk1OTMzLCAwLjk0NDYsIDAuOTQ0NiwgMC45NDQ2LCAwLjk0NDYsIDAuOTQ0NiwgMS4wODU5NSwgMC45NDQ2LCAwLjk1NDQyLCAwLjk1NDQyLCAwLjk1NDQyLCAwLjk1NDQyLCAwLjk0MDM5LCAwLjk3ODk4LCAwLjk0MDM5LCAwLjkwODM4LCAwLjk0OTM4LCAwLjkwODM4LCAwLjk0OTM4LCAwLjkwODM4LCAwLjk0OTM4LCAwLjgyMzkxLCAwLjgxMDkzLCAwLjgyMzkxLCAwLjgxMDkzLCAwLjgyMzkxLCAwLjgxMDkzLCAwLjgyMzkxLCAwLjgxMDkzLCAwLjk2Mzc2LCAwLjg0MzEzLCAwLjk3NDg0LCAwLjk3NTcxLCAwLjgwMDYxLCAwLjk0OTM4LCAwLjgwMDYxLCAwLjk0OTM4LCAwLjgwMDYxLCAwLjk0OTM4LCAwLjgwMDYxLCAwLjk0OTM4LCAwLjgwMDYxLCAwLjk0OTM4LCAwLjg3NjgsIDAuOTU3NywgMC44NzY4LCAwLjk1NzcsIDAuODc2OCwgMC45NTc3LCAxLCAxLCAwLjk1NDA3LCAwLjk1OTMzLCAwLjk3MDY5LCAwLjk1OTMzLCAxLjAyNTgsIDAuOTg2MjEsIDEuMDI1OCwgMC45ODYyMSwgMS4wMjU4LCAwLjk4NjIxLCAxLjAyNTgsIDAuOTg2MjEsIDEuMDI1OCwgMC45ODYyMSwgMC44ODcsIDEuMDE1OTEsIDAuNzM5MDEsIDEuMDQ3NCwgMSwgMSwgMC45NzQ1NSwgMC44MzY1NSwgMC45ODk4MSwgMSwgMSwgMC44MzY1NSwgMC43Mzk3NywgMC44MzY1NSwgMC43MzkwMywgMC44NDYzOCwgMS4wMzMsIDAuOTU1NDYsIDAuOTU5MzMsIDEsIDEsIDAuOTU1NDYsIDAuOTU5MzMsIDAuODI3MSwgMC45NTQxNywgMC45NTkzMywgMC45MjE3OSwgMC45NDQ2LCAwLjkyMTc5LCAwLjk0NDYsIDAuOTIxNzksIDAuOTQ0NiwgMC45MzYsIDAuOTE5NjQsIDAuODIxMTQsIDAuOTc2NDYsIDEsIDEsIDAuODIxMTQsIDAuOTc2NDYsIDAuODA5NiwgMC43ODAzNiwgMC44MDk2LCAwLjc4MDM2LCAxLCAxLCAwLjgwOTYsIDAuNzgwMzYsIDEsIDEsIDAuODk3MTMsIDAuNzc0NTIsIDAuODk3MTMsIDEuMTAyMDgsIDAuOTQ0MzgsIDAuOTU0NDIsIDAuOTQ0MzgsIDAuOTU0NDIsIDAuOTQ0MzgsIDAuOTU0NDIsIDAuOTQ0MzgsIDAuOTU0NDIsIDAuOTQ0MzgsIDAuOTU0NDIsIDAuOTQ0MzgsIDAuOTU0NDIsIDAuOTQwODMsIDAuOTc1NzksIDAuOTA0MDYsIDAuOTQwMzksIDAuOTA0MDYsIDAuOTQ0NiwgMC45MzgsIDAuOTQ0NiwgMC45MzgsIDAuOTQ0NiwgMC45MzgsIDEsIDAuOTk3OTMsIDAuOTA4MzgsIDAuOTQ5MzgsIDAuODY4LCAwLjkwMzEsIDAuOTIxNzksIDAuOTQ0NiwgMSwgMSwgMC44OTcxMywgMS4xMDIwOCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDk4OSwgMC45MzU4LCAwLjkxOTQ1LCAwLjgzMTgxLCAwLjc1MjYxLCAwLjg3OTkyLCAwLjgyOTc2LCAwLjk2MDM0LCAwLjgzNjg5LCAwLjk3MjY4LCAxLjAwNzgsIDAuOTA4MzgsIDAuODM2MzcsIDAuODAxOSwgMC45MDE1NywgMC44MDA2MSwgMC45NDQ2LCAwLjk1NDA3LCAwLjkyNDM2LCAxLjAyNTgsIDAuODUwMjIsIDAuOTcxNTMsIDEuMDE1NiwgMC45NTU0NiwgMC44OTE5MiwgMC45MjE3OSwgMC45MjM2MSwgMC44NzEwNywgMC45NjMxOCwgMC44OTcxMywgMC45MzcwNCwgMC45NTYzOCwgMC45MTkwNSwgMC45MTcwOSwgMC45Mjc5NiwgMS4wMjU4LCAwLjkzNzA0LCAwLjk0ODM2LCAxLjAzNzMsIDAuOTU5MzMsIDEuMDA3OCwgMC45NTg3MSwgMC45NDgzNiwgMC45NjE3NCwgMC45MjYwMSwgMC45NDk4LCAwLjk4NjA3LCAwLjk1Nzc2LCAwLjk1OTMzLCAxLjA1NDUzLCAxLjAwNzgsIDAuOTgyNzUsIDAuOTMxNCwgMC45NTYxNywgMC45MTcwMSwgMS4wNTk5MywgMC45NDQ2LCAwLjc4MzY3LCAwLjk1NTMsIDEsIDAuODY4MzIsIDEuMDEyOCwgMC45NTg3MSwgMC45OTM5NCwgMC44NzU0OCwgMC45NjM2MSwgMC44Njc3NCwgMS4wMDc4LCAwLjk1ODcxLCAwLjk0NDYsIDAuOTU4NzEsIDAuODY3NzQsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTQwODMsIDAuOTc1NzksIDAuOTQwODMsIDAuOTc1NzksIDAuOTQwODMsIDAuOTc1NzksIDAuOTA0MDYsIDAuOTQwMzksIDAuOTY2OTQsIDEsIDAuODk5MDMsIDEsIDEsIDEsIDAuOTM1ODIsIDAuOTM1ODIsIDAuOTM1ODIsIDEsIDAuOTA4LCAwLjkwOCwgMC45MTgsIDAuOTQyMTksIDAuOTQyMTksIDAuOTY1NDQsIDEsIDEuMjg1LCAxLCAxLCAwLjgxMDc5LCAwLjgxMDc5LCAxLCAxLCAwLjc0ODU0LCAxLCAxLCAxLCAxLCAwLjk5NzkzLCAxLCAxLCAxLCAwLjY1LCAxLCAxLjM2MTQ1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjE3MTczLCAxLCAwLjgwNTM1LCAwLjc2MTY5LCAxLjAyMDU4LCAxLjA3MzIsIDEuMDU0ODYsIDEsIDEsIDEuMzA2OTIsIDEuMDg1OTUsIDEuMDg1OTUsIDEsIDEuMDg1OTUsIDEuMDg1OTUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMTYxNjEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBNeXJpYWRQcm9Cb2xkTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIsCiAgbGluZUdhcDogMC4yCn07CmNvbnN0IE15cmlhZFByb0JvbGRJdGFsaWNGYWN0b3JzID0gWzEuMzY4OTgsIDEsIDEsIDAuNjYyMjcsIDAuODA3NzksIDAuODE2MjUsIDAuOTcyNzYsIDAuOTcyNzYsIDAuOTc3MzMsIDAuOTIyMjIsIDAuODMyNjYsIDAuOTQyOTIsIDAuOTQyOTIsIDEuMTYxNDgsIDEuMDIwNTgsIDAuOTM1ODIsIDAuOTY2OTQsIDAuOTM1ODIsIDEuMTczMzcsIDAuOTcyNzYsIDAuOTcyNzYsIDAuOTcyNzYsIDAuOTcyNzYsIDAuOTcyNzYsIDAuOTcyNzYsIDAuOTcyNzYsIDAuOTcyNzYsIDAuOTcyNzYsIDAuOTcyNzYsIDAuNzgwNzYsIDAuNzgwNzYsIDEuMDIwNTgsIDEuMDIwNTgsIDEuMDIwNTgsIDAuNzE1NDEsIDAuNzY4MTMsIDAuODU1NzYsIDAuODA1OTEsIDAuODA3MjksIDAuOTQyOTksIDAuNzc1MTIsIDAuODM2NTUsIDAuODY1MjMsIDAuOTIyMjIsIDAuOTg2MjEsIDAuNzE3NDMsIDAuODE2OTgsIDAuNzk3MjYsIDAuOTg1NTgsIDAuOTIyMjIsIDAuOTA2MzcsIDAuODM4MDksIDAuOTA2MzcsIDAuODA3MjksIDAuNzY0NjMsIDAuODYyNzUsIDAuOTA2OTksIDAuOTE2MDUsIDAuOTE1NCwgMC44NTMwOCwgMC44NTQ1OCwgMC45MDUzMSwgMC45NDI5MiwgMS4yMTI5NiwgMC45NDI5MiwgMS4wMjA1OCwgMC44OTkwMywgMS4xODYxNiwgMC45OTYxMywgMC45MTY3NywgMC43ODIxNiwgMC45MTY3NywgMC45MDA4MywgMC45ODc5NiwgMC45MTM1LCAwLjkyMTY4LCAwLjk1MzgxLCAwLjk4OTgxLCAwLjk1Mjk4LCAwLjk1MzgxLCAwLjkzNDU5LCAwLjkyMTY4LCAwLjkxNTEzLCAwLjkyMDA0LCAwLjkxNjc3LCAwLjk1MDc3LCAwLjc0OCwgMS4wNDUwMiwgMC45MTY3NywgMC45MjA2MSwgMC45NDIzNiwgMC44OTU0NCwgMC44OTM2NCwgMC45LCAwLjgwNjg3LCAwLjg1NzgsIDAuODA2ODcsIDEuMDIwNTgsIDAuODA3NzksIDAuOTcyNzYsIDAuOTcyNzYsIDAuOTcyNzYsIDAuOTcyNzYsIDAuODU3OCwgMC45OTk3MywgMS4xODYxNiwgMC45MTMzOSwgMS4wODA3NCwgMC44Mjg5MSwgMS4wMjA1OCwgMC41NTUwOSwgMC43MTUyNiwgMC44OTAyMiwgMS4wODU5NSwgMSwgMSwgMS4xODYxNiwgMSwgMC45NjczNiwgMC45MzU4MiwgMS4xODYxNiwgMSwgMS4wNDg2NCwgMC44MjcxMSwgMC45OTA0MywgMC45OTA0MywgMC45OTA0MywgMC43MTU0MSwgMC44NTU3NiwgMC44NTU3NiwgMC44NTU3NiwgMC44NTU3NiwgMC44NTU3NiwgMC44NTU3NiwgMC44NDUsIDAuODA3MjksIDAuNzc1MTIsIDAuNzc1MTIsIDAuNzc1MTIsIDAuNzc1MTIsIDAuOTg2MjEsIDAuOTg2MjEsIDAuOTg2MjEsIDAuOTg2MjEsIDAuOTU5NjEsIDAuOTIyMjIsIDAuOTA2MzcsIDAuOTA2MzcsIDAuOTA2MzcsIDAuOTA2MzcsIDAuOTA2MzcsIDEuMDIwNTgsIDAuOTAyNTEsIDAuOTA2OTksIDAuOTA2OTksIDAuOTA2OTksIDAuOTA2OTksIDAuODU0NTgsIDAuODM2NTksIDAuOTQ5NTEsIDAuOTk2MTMsIDAuOTk2MTMsIDAuOTk2MTMsIDAuOTk2MTMsIDAuOTk2MTMsIDAuOTk2MTMsIDAuODU4MTEsIDAuNzgyMTYsIDAuOTAwODMsIDAuOTAwODMsIDAuOTAwODMsIDAuOTAwODMsIDAuOTUzODEsIDAuOTUzODEsIDAuOTUzODEsIDAuOTUzODEsIDAuOTEzNSwgMC45MjE2OCwgMC45MTUxMywgMC45MTUxMywgMC45MTUxMywgMC45MTUxMywgMC45MTUxMywgMS4wODU5NSwgMC45MTY3NywgMC45MTY3NywgMC45MTY3NywgMC45MTY3NywgMC45MTY3NywgMC44OTM2NCwgMC45MjMzMiwgMC44OTM2NCwgMC44NTU3NiwgMC45OTYxMywgMC44NTU3NiwgMC45OTYxMywgMC44NTU3NiwgMC45OTYxMywgMC44MDcyOSwgMC43ODIxNiwgMC44MDcyOSwgMC43ODIxNiwgMC44MDcyOSwgMC43ODIxNiwgMC44MDcyOSwgMC43ODIxNiwgMC45NDI5OSwgMC43Njc4MywgMC45NTk2MSwgMC45MTY3NywgMC43NzUxMiwgMC45MDA4MywgMC43NzUxMiwgMC45MDA4MywgMC43NzUxMiwgMC45MDA4MywgMC43NzUxMiwgMC45MDA4MywgMC43NzUxMiwgMC45MDA4MywgMC44NjUyMywgMC45MTM1LCAwLjg2NTIzLCAwLjkxMzUsIDAuODY1MjMsIDAuOTEzNSwgMSwgMSwgMC45MjIyMiwgMC45MjE2OCwgMC45MjIyMiwgMC45MjE2OCwgMC45ODYyMSwgMC45NTM4MSwgMC45ODYyMSwgMC45NTM4MSwgMC45ODYyMSwgMC45NTM4MSwgMC45ODYyMSwgMC45NTM4MSwgMC45ODYyMSwgMC45NTM4MSwgMC44NjAzNiwgMC45NzA5NiwgMC43MTc0MywgMC45ODk4MSwgMSwgMSwgMC45NTI5OCwgMC43OTcyNiwgMC45NTM4MSwgMSwgMSwgMC43OTcyNiwgMC42ODk0LCAwLjc5NzI2LCAwLjc0MzIxLCAwLjgxNjkxLCAxLjAwMDYsIDAuOTIyMjIsIDAuOTIxNjgsIDEsIDEsIDAuOTIyMjIsIDAuOTIxNjgsIDAuNzk0NjQsIDAuOTIwOTgsIDAuOTIxNjgsIDAuOTA2MzcsIDAuOTE1MTMsIDAuOTA2MzcsIDAuOTE1MTMsIDAuOTA2MzcsIDAuOTE1MTMsIDAuOTA5LCAwLjg3NTE0LCAwLjgwNzI5LCAwLjk1MDc3LCAxLCAxLCAwLjgwNzI5LCAwLjk1MDc3LCAwLjc2NDYzLCAwLjc0OCwgMC43NjQ2MywgMC43NDgsIDEsIDEsIDAuNzY0NjMsIDAuNzQ4LCAxLCAxLCAwLjg2Mjc1LCAwLjcyNjUxLCAwLjg2Mjc1LCAxLjA0NTAyLCAwLjkwNjk5LCAwLjkxNjc3LCAwLjkwNjk5LCAwLjkxNjc3LCAwLjkwNjk5LCAwLjkxNjc3LCAwLjkwNjk5LCAwLjkxNjc3LCAwLjkwNjk5LCAwLjkxNjc3LCAwLjkwNjk5LCAwLjkxNjc3LCAwLjkxNTQsIDAuOTQyMzYsIDAuODU0NTgsIDAuODkzNjQsIDAuODU0NTgsIDAuOTA1MzEsIDAuOSwgMC45MDUzMSwgMC45LCAwLjkwNTMxLCAwLjksIDEsIDAuOTcyNzYsIDAuODU1NzYsIDAuOTk2MTMsIDAuODQ1LCAwLjg1ODExLCAwLjkwMjUxLCAwLjkxNjc3LCAxLCAxLCAwLjg2Mjc1LCAxLjA0NTAyLCAxLjE4NjE2LCAxLjE4NjE2LCAxLjE4NjE2LCAxLjE4NjE2LCAxLjE4NjE2LCAxLjE4NjE2LCAxLjE4NjE2LCAxLjE4NjE2LCAxLjE4NjE2LCAxLjAwODk5LCAxLjMwNjI4LCAwLjg1NTc2LCAwLjgwMTc4LCAwLjY2ODYyLCAwLjc5MjcsIDAuNjkzMjMsIDAuODgxMjcsIDAuNzI0NTksIDAuODk3MTEsIDAuOTUzODEsIDAuODU1NzYsIDAuODA1OTEsIDAuNzgwNSwgMC45NDcyOSwgMC43NzUxMiwgMC45MDUzMSwgMC45MjIyMiwgMC45MDYzNywgMC45ODYyMSwgMC44MTY5OCwgMC45MjY1NSwgMC45ODU1OCwgMC45MjIyMiwgMC44NTM1OSwgMC45MDYzNywgMC45MDk3NiwgMC44MzgwOSwgMC45NDUyMywgMC44NjI3NSwgMC44MzUwOSwgMC45MzE1NywgMC44NTMwOCwgMC44MzM5MiwgMC45MjM0NiwgMC45ODYyMSwgMC44MzUwOSwgMC45Mjg4NiwgMC45MTMyNCwgMC45MjE2OCwgMC45NTM4MSwgMC45MDY0NiwgMC45Mjg4NiwgMC45MDU1NywgMC44Njg0NywgMC45MDI3NiwgMC45MTMyNCwgMC44Njg0MiwgMC45MjE2OCwgMC45OTUzMSwgMC45NTM4MSwgMC45MjI0LCAwLjg1NDA4LCAwLjkyNjk5LCAwLjg2ODQ3LCAxLjAwNTEsIDAuOTE1MTMsIDAuODA0ODcsIDAuOTM0ODEsIDEsIDAuODgxNTksIDEuMDUyMTQsIDAuOTA2NDYsIDAuOTczNTUsIDAuODE1MzksIDAuODkzOTgsIDAuODU5MjMsIDAuOTUzODEsIDAuOTA2NDYsIDAuOTE1MTMsIDAuOTA2NDYsIDAuODU5MjMsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTE1NCwgMC45NDIzNiwgMC45MTU0LCAwLjk0MjM2LCAwLjkxNTQsIDAuOTQyMzYsIDAuODU0NTgsIDAuODkzNjQsIDAuOTY2OTQsIDEsIDAuODk5MDMsIDEsIDEsIDEsIDAuOTE3ODIsIDAuOTE3ODIsIDAuOTE3ODIsIDEsIDAuODk2LCAwLjg5NiwgMC44OTYsIDAuOTMzMiwgMC45MzMyLCAwLjk1OTczLCAxLCAxLjI2LCAxLCAxLCAwLjgwNDc5LCAwLjgwMTc4LCAxLCAxLCAwLjg1NjMzLCAxLCAxLCAxLCAxLCAwLjk3Mjc2LCAxLCAxLCAxLCAwLjY5OCwgMSwgMS4zNjE0NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4xNDU0MiwgMSwgMC43OTE5OSwgMC43ODY5NCwgMS4wMjA1OCwgMS4wMzQ5MywgMS4wNTQ4NiwgMSwgMSwgMS4yMzAyNiwgMS4wODU5NSwgMS4wODU5NSwgMSwgMS4wODU5NSwgMS4wODU5NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4yMDAwNiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IE15cmlhZFByb0JvbGRJdGFsaWNNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMiwKICBsaW5lR2FwOiAwLjIKfTsKY29uc3QgTXlyaWFkUHJvSXRhbGljRmFjdG9ycyA9IFsxLjM2ODk4LCAxLCAxLCAwLjY1NTA3LCAwLjg0OTQzLCAwLjg1NjM5LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg2OTM2LCAwLjg4MzA3LCAwLjg2OTQ4LCAwLjg1MjgzLCAwLjg1MjgzLCAxLjA2MzgzLCAxLjAyMDU4LCAwLjc1OTQ1LCAwLjkyMTksIDAuNzU5NDUsIDEuMTczMzcsIDAuODg0NjUsIDAuODg0NjUsIDAuODg0NjUsIDAuODg0NjUsIDAuODg0NjUsIDAuODg0NjUsIDAuODg0NjUsIDAuODg0NjUsIDAuODg0NjUsIDAuODg0NjUsIDAuNzU5NDUsIDAuNzU5NDUsIDEuMDIwNTgsIDEuMDIwNTgsIDEuMDIwNTgsIDAuNjkwNDYsIDAuNzA5MjYsIDAuODUxNTgsIDAuNzc4MTIsIDAuNzY4NTIsIDAuODk1OTEsIDAuNzA0NjYsIDAuNzYxMjUsIDAuODAwOTQsIDAuODY4MjIsIDAuODM4NjQsIDAuNzI4LCAwLjc3MjEyLCAwLjc5NDc1LCAwLjkzNjM3LCAwLjg3NTE0LCAwLjg1ODgsIDAuNzYwMTMsIDAuODU4OCwgMC43MjQyMSwgMC42OTg2NiwgMC43NzU5OCwgMC44NTk5MSwgMC44MDgxMSwgMC44NzgzMiwgMC43ODExMiwgMC43NzUxMiwgMC44NTYyLCAxLjAyMjIsIDEuMTg0MTcsIDEuMDIyMiwgMS4yNzAxNCwgMC44OTkwMywgMS4xNTAxMiwgMC45Mzg1OSwgMC45NDM5OSwgMC44NDYsIDAuOTQzOTksIDAuODE0NTMsIDEuMDE4NiwgMC45NDIxOSwgMC45NjAxNywgMS4wMzA3NSwgMS4wMjE3NSwgMC45MTIsIDEuMDMwNzUsIDAuOTY5OTgsIDAuOTYwMTcsIDAuOTM4NTksIDAuOTQzOTksIDAuOTQzOTksIDAuOTU0OTMsIDAuNzQ2LCAxLjEyNjU4LCAwLjk0NTc4LCAwLjkxLCAwLjk3OSwgMC44ODIsIDAuODgyLCAwLjgzLCAwLjg1MDM0LCAwLjgzNTM3LCAwLjg1MDM0LCAxLjAyMDU4LCAwLjcwODY5LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjg4NDY1LCAwLjgzNTM3LCAwLjkwMDgzLCAxLjE1MDEyLCAwLjkxNjEsIDAuOTQ1NjUsIDAuNzM1NDEsIDEuMDIwNTgsIDAuNTM2MDksIDAuNjkzNTMsIDAuNzk1MTksIDEuMDg1OTUsIDEsIDEsIDEuMTUwMTIsIDEsIDAuOTE5NzQsIDAuNzU5NDUsIDEuMTUwMTIsIDEsIDAuOTQ0NiwgMC43MzM2MSwgMC45MDA1LCAwLjkwMDUsIDAuOTAwNSwgMC42Mjg2NCwgMC44NTE1OCwgMC44NTE1OCwgMC44NTE1OCwgMC44NTE1OCwgMC44NTE1OCwgMC44NTE1OCwgMC43NzMsIDAuNzY4NTIsIDAuNzA0NjYsIDAuNzA0NjYsIDAuNzA0NjYsIDAuNzA0NjYsIDAuODM4NjQsIDAuODM4NjQsIDAuODM4NjQsIDAuODM4NjQsIDAuOTA1NjEsIDAuODc1MTQsIDAuODU4OCwgMC44NTg4LCAwLjg1ODgsIDAuODU4OCwgMC44NTg4LCAxLjAyMDU4LCAwLjg1NzUxLCAwLjg1OTkxLCAwLjg1OTkxLCAwLjg1OTkxLCAwLjg1OTkxLCAwLjc3NTEyLCAwLjc2MDEzLCAwLjg4MDc1LCAwLjkzODU5LCAwLjkzODU5LCAwLjkzODU5LCAwLjkzODU5LCAwLjkzODU5LCAwLjkzODU5LCAwLjgwNzUsIDAuODQ2LCAwLjgxNDUzLCAwLjgxNDUzLCAwLjgxNDUzLCAwLjgxNDUzLCAwLjgyNDI0LCAwLjgyNDI0LCAwLjgyNDI0LCAwLjgyNDI0LCAwLjkyNzgsIDAuOTYwMTcsIDAuOTM4NTksIDAuOTM4NTksIDAuOTM4NTksIDAuOTM4NTksIDAuOTM4NTksIDEuMDg1OTUsIDAuODU2MiwgMC45NDU3OCwgMC45NDU3OCwgMC45NDU3OCwgMC45NDU3OCwgMC44ODIsIDAuOTQ1NzgsIDAuODgyLCAwLjg1MTU4LCAwLjkzODU5LCAwLjg1MTU4LCAwLjkzODU5LCAwLjg1MTU4LCAwLjkzODU5LCAwLjc2ODUyLCAwLjg0NiwgMC43Njg1MiwgMC44NDYsIDAuNzY4NTIsIDAuODQ2LCAwLjc2ODUyLCAwLjg0NiwgMC44OTU5MSwgMC44NTQ0LCAwLjkwNTYxLCAwLjk0Mzk5LCAwLjcwNDY2LCAwLjgxNDUzLCAwLjcwNDY2LCAwLjgxNDUzLCAwLjcwNDY2LCAwLjgxNDUzLCAwLjcwNDY2LCAwLjgxNDUzLCAwLjcwNDY2LCAwLjgxNDUzLCAwLjgwMDk0LCAwLjk0MjE5LCAwLjgwMDk0LCAwLjk0MjE5LCAwLjgwMDk0LCAwLjk0MjE5LCAxLCAxLCAwLjg2ODIyLCAwLjk2MDE3LCAwLjg2ODIyLCAwLjk2MDE3LCAwLjgzODY0LCAwLjgyNDI0LCAwLjgzODY0LCAwLjgyNDI0LCAwLjgzODY0LCAwLjgyNDI0LCAwLjgzODY0LCAxLjAzMDc1LCAwLjgzODY0LCAwLjgyNDI0LCAwLjgxNDAyLCAxLjAyNzM4LCAwLjcyOCwgMS4wMjE3NSwgMSwgMSwgMC45MTIsIDAuNzk0NzUsIDEuMDMwNzUsIDEsIDEsIDAuNzk0NzUsIDAuODM5MTEsIDAuNzk0NzUsIDAuNjYyNjYsIDAuODA1NTMsIDEuMDY2NzYsIDAuODc1MTQsIDAuOTYwMTcsIDEsIDEsIDAuODc1MTQsIDAuOTYwMTcsIDAuODY4NjUsIDAuODczOTYsIDAuOTYwMTcsIDAuODU4OCwgMC45Mzg1OSwgMC44NTg4LCAwLjkzODU5LCAwLjg1ODgsIDAuOTM4NTksIDAuODY3LCAwLjg0NzU5LCAwLjcyNDIxLCAwLjk1NDkzLCAxLCAxLCAwLjcyNDIxLCAwLjk1NDkzLCAwLjY5ODY2LCAwLjc0NiwgMC42OTg2NiwgMC43NDYsIDEsIDEsIDAuNjk4NjYsIDAuNzQ2LCAxLCAxLCAwLjc3NTk4LCAwLjg4NDE3LCAwLjc3NTk4LCAxLjEyNjU4LCAwLjg1OTkxLCAwLjk0NTc4LCAwLjg1OTkxLCAwLjk0NTc4LCAwLjg1OTkxLCAwLjk0NTc4LCAwLjg1OTkxLCAwLjk0NTc4LCAwLjg1OTkxLCAwLjk0NTc4LCAwLjg1OTkxLCAwLjk0NTc4LCAwLjg3ODMyLCAwLjk3OSwgMC43NzUxMiwgMC44ODIsIDAuNzc1MTIsIDAuODU2MiwgMC44MywgMC44NTYyLCAwLjgzLCAwLjg1NjIsIDAuODMsIDEsIDAuODg0NjUsIDAuODUxNTgsIDAuOTM4NTksIDAuNzczLCAwLjgwNzUsIDAuODU3NTEsIDAuODU2MiwgMSwgMSwgMC43NzU5OCwgMS4xMjY1OCwgMS4xNTAxMiwgMS4xNTAxMiwgMS4xNTAxMiwgMS4xNTAxMiwgMS4xNTAxMiwgMS4xNTMxMywgMS4xNTAxMiwgMS4xNTAxMiwgMS4xNTAxMiwgMS4wODEwNiwgMS4wMzkwMSwgMC44NTE1OCwgMC43NzAyNSwgMC42MjI2NCwgMC43NjQ2LCAwLjY1MzUxLCAwLjg2MDI2LCAwLjY5NDYxLCAwLjg5OTQ3LCAxLjAzMDc1LCAwLjg1MTU4LCAwLjc3ODEyLCAwLjc2NDQ5LCAwLjg4ODM2LCAwLjcwNDY2LCAwLjg1NjIsIDAuODY4MjIsIDAuODU4OCwgMC44Mzg2NCwgMC43NzIxMiwgMC44NTMwOCwgMC45MzYzNywgMC44NzUxNCwgMC44MjM1MiwgMC44NTg4LCAwLjg1NzAxLCAwLjc2MDEzLCAwLjg5MDU4LCAwLjc3NTk4LCAwLjgxNTYsIDAuODI1NjUsIDAuNzgxMTIsIDAuNzc4OTksIDAuODkzODYsIDAuODM4NjQsIDAuODE1NiwgMC45NDg2LCAwLjkyMzg4LCAwLjk2MTg2LCAxLjAzMDc1LCAwLjkxMTIzLCAwLjk0ODYsIDAuOTMyOTgsIDAuODc4LCAwLjkzOTQyLCAwLjkyMzg4LCAwLjg0NTk2LCAwLjk2MTg2LCAwLjk1MTE5LCAxLjAzMDc1LCAwLjkyMiwgMC44ODc4NywgMC45NTgyOSwgMC44OCwgMC45MzU1OSwgMC45Mzg1OSwgMC43ODgxNSwgMC45Mzc1OCwgMSwgMC44OTIxNywgMS4wMzczNywgMC45MTEyMywgMC45Mzk2OSwgMC43NzQ4NywgMC44NTc2OSwgMC44Njc5OSwgMS4wMzA3NSwgMC45MTEyMywgMC45Mzg1OSwgMC45MTEyMywgMC44Njc5OSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44NzgzMiwgMC45NzksIDAuODc4MzIsIDAuOTc5LCAwLjg3ODMyLCAwLjk3OSwgMC43NzUxMiwgMC44ODIsIDAuOTIxOSwgMSwgMC44OTkwMywgMSwgMSwgMSwgMC44NzMyMSwgMC44NzMyMSwgMC44NzMyMSwgMSwgMS4wMjcsIDEuMDI3LCAxLjAyNywgMC44Njg0NywgMC44Njg0NywgMC43OTEyMSwgMSwgMS4xMjQsIDEsIDEsIDAuNzM1NzIsIDAuNzM1NzIsIDEsIDEsIDAuODUwMzQsIDEsIDEsIDEsIDEsIDAuODg0NjUsIDEsIDEsIDEsIDAuNjY5LCAxLCAxLjM2MTQ1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjA0ODI4LCAxLCAwLjc0OTQ4LCAwLjc1MTg3LCAxLjAyMDU4LCAwLjk4MzkxLCAxLjAyMTE5LCAxLCAxLCAxLjA2MjMzLCAxLjA4NTk1LCAxLjA4NTk1LCAxLCAxLjA4NTk1LCAxLjA4NTk1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjA1MjMzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKY29uc3QgTXlyaWFkUHJvSXRhbGljTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIsCiAgbGluZUdhcDogMC4yCn07CmNvbnN0IE15cmlhZFByb1JlZ3VsYXJGYWN0b3JzID0gWzEuMzY4OTgsIDEsIDEsIDAuNzYzMDUsIDAuODI3ODQsIDAuOTQ5MzUsIDAuODkzNjQsIDAuOTIyNDEsIDAuODkwNzMsIDAuOTA3MDYsIDAuOTg0NzIsIDAuODUyODMsIDAuODUyODMsIDEuMDY2NCwgMS4wMjA1OCwgMC43NDUwNSwgMC45MjE5LCAwLjc0NTA1LCAxLjIzNDU2LCAwLjkyMjQxLCAwLjkyMjQxLCAwLjkyMjQxLCAwLjkyMjQxLCAwLjkyMjQxLCAwLjkyMjQxLCAwLjkyMjQxLCAwLjkyMjQxLCAwLjkyMjQxLCAwLjkyMjQxLCAwLjc0NTA1LCAwLjc0NTA1LCAxLjAyMDU4LCAxLjAyMDU4LCAxLjAyMDU4LCAwLjczMDAyLCAwLjcyNjAxLCAwLjkxNzU1LCAwLjgxMjYsIDAuODAzMTQsIDAuOTIyMjIsIDAuNzM3NjQsIDAuNzk3MjYsIDAuODMwNTEsIDAuOTAyODQsIDAuODYwMjMsIDAuNzQsIDAuODEyNiwgMC44NDg2OSwgMC45NjUxOCwgMC45MTExNSwgMC44ODU4LCAwLjc5NzYxLCAwLjg4NTgsIDAuNzQ0OTgsIDAuNzM5MTQsIDAuODEzNjMsIDAuODk1OTEsIDAuODM2NTksIDAuODk2MzMsIDAuODU2MDgsIDAuODExMSwgMC45MDUzMSwgMS4wMjIyLCAxLjIyNzM2LCAxLjAyMjIsIDEuMjcwMTQsIDAuODk5MDMsIDAuOTAwODgsIDAuODY2NjcsIDEuMDIzMSwgMC44OTYsIDEuMDE0MTEsIDAuOTAwODMsIDEuMDUwOTksIDEuMDA1MTIsIDAuOTk3OTMsIDEuMDUzMjYsIDEuMDkzNzcsIDAuOTM4LCAxLjA2MjI2LCAxLjAwMTE5LCAwLjk5NzkzLCAwLjk4NzE0LCAxLjAyMzEsIDEuMDEyMzEsIDAuOTgxOTYsIDAuNzkyLCAxLjE5MTM3LCAwLjk5MDc0LCAwLjk2MiwgMS4wMTkxNSwgMC45MjYsIDAuOTQyLCAwLjg1NiwgMC44NTAzNCwgMC45MjAwNiwgMC44NTAzNCwgMS4wMjA1OCwgMC42OTA2NywgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjI0MSwgMC45MjAwNiwgMC45MzMyLCAwLjkwMDg4LCAwLjkxODgyLCAwLjkzNDg0LCAwLjc1MzM5LCAxLjAyMDU4LCAwLjU2ODY2LCAwLjU0MzI0LCAwLjc5NTE5LCAxLjA4NTk1LCAxLCAxLCAwLjkwMDg4LCAxLCAwLjk1MzI1LCAwLjc0NTA1LCAwLjkwMDg4LCAxLCAwLjk3MTk4LCAwLjc1MzM5LCAwLjkxMDA5LCAwLjkxMDA5LCAwLjkxMDA5LCAwLjY2NDY2LCAwLjkxNzU1LCAwLjkxNzU1LCAwLjkxNzU1LCAwLjkxNzU1LCAwLjkxNzU1LCAwLjkxNzU1LCAwLjc4OCwgMC44MDMxNCwgMC43Mzc2NCwgMC43Mzc2NCwgMC43Mzc2NCwgMC43Mzc2NCwgMC44NjAyMywgMC44NjAyMywgMC44NjAyMywgMC44NjAyMywgMC45MjkxNSwgMC45MTExNSwgMC44ODU4LCAwLjg4NTgsIDAuODg1OCwgMC44ODU4LCAwLjg4NTgsIDEuMDIwNTgsIDAuODg1OCwgMC44OTU5MSwgMC44OTU5MSwgMC44OTU5MSwgMC44OTU5MSwgMC44MTExLCAwLjc5NjExLCAwLjg5NzEzLCAwLjg2NjY3LCAwLjg2NjY3LCAwLjg2NjY3LCAwLjg2NjY3LCAwLjg2NjY3LCAwLjg2NjY3LCAwLjg2OTM2LCAwLjg5NiwgMC45MDA4MywgMC45MDA4MywgMC45MDA4MywgMC45MDA4MywgMC44NDIyNCwgMC44NDIyNCwgMC44NDIyNCwgMC44NDIyNCwgMC45NzI3NiwgMC45OTc5MywgMC45ODcxNCwgMC45ODcxNCwgMC45ODcxNCwgMC45ODcxNCwgMC45ODcxNCwgMS4wODU5NSwgMC44OTg3NiwgMC45OTA3NCwgMC45OTA3NCwgMC45OTA3NCwgMC45OTA3NCwgMC45NDIsIDEuMDIzMSwgMC45NDIsIDAuOTE3NTUsIDAuODY2NjcsIDAuOTE3NTUsIDAuODY2NjcsIDAuOTE3NTUsIDAuODY2NjcsIDAuODAzMTQsIDAuODk2LCAwLjgwMzE0LCAwLjg5NiwgMC44MDMxNCwgMC44OTYsIDAuODAzMTQsIDAuODk2LCAwLjkyMjIyLCAwLjkzMzcyLCAwLjkyOTE1LCAxLjAxNDExLCAwLjczNzY0LCAwLjkwMDgzLCAwLjczNzY0LCAwLjkwMDgzLCAwLjczNzY0LCAwLjkwMDgzLCAwLjczNzY0LCAwLjkwMDgzLCAwLjczNzY0LCAwLjkwMDgzLCAwLjgzMDUxLCAxLjAwNTEyLCAwLjgzMDUxLCAxLjAwNTEyLCAwLjgzMDUxLCAxLjAwNTEyLCAxLCAxLCAwLjkwMjg0LCAwLjk5NzkzLCAwLjkwOTc2LCAwLjk5NzkzLCAwLjg2MDIzLCAwLjg0MjI0LCAwLjg2MDIzLCAwLjg0MjI0LCAwLjg2MDIzLCAwLjg0MjI0LCAwLjg2MDIzLCAxLjA1MzI2LCAwLjg2MDIzLCAwLjg0MjI0LCAwLjgyODczLCAxLjA3NDY5LCAwLjc0LCAxLjA5Mzc3LCAxLCAxLCAwLjkzOCwgMC44NDg2OSwgMS4wNjIyNiwgMSwgMSwgMC44NDg2OSwgMC44MzcwNCwgMC44NDg2OSwgMC44MTQ0MSwgMC44NTU4OCwgMS4wODkyNywgMC45MTExNSwgMC45OTc5MywgMSwgMSwgMC45MTExNSwgMC45OTc5MywgMC45MTg4NywgMC45MDk5MSwgMC45OTc5MywgMC44ODU4LCAwLjk4NzE0LCAwLjg4NTgsIDAuOTg3MTQsIDAuODg1OCwgMC45ODcxNCwgMC44OTQsIDAuOTE0MzQsIDAuNzQ0OTgsIDAuOTgxOTYsIDEsIDEsIDAuNzQ0OTgsIDAuOTgxOTYsIDAuNzM5MTQsIDAuNzkyLCAwLjczOTE0LCAwLjc5MiwgMSwgMSwgMC43MzkxNCwgMC43OTIsIDEsIDEsIDAuODEzNjMsIDAuOTA0LCAwLjgxMzYzLCAxLjE5MTM3LCAwLjg5NTkxLCAwLjk5MDc0LCAwLjg5NTkxLCAwLjk5MDc0LCAwLjg5NTkxLCAwLjk5MDc0LCAwLjg5NTkxLCAwLjk5MDc0LCAwLjg5NTkxLCAwLjk5MDc0LCAwLjg5NTkxLCAwLjk5MDc0LCAwLjg5NjMzLCAxLjAxOTE1LCAwLjgxMTEsIDAuOTQyLCAwLjgxMTEsIDAuOTA1MzEsIDAuODU2LCAwLjkwNTMxLCAwLjg1NiwgMC45MDUzMSwgMC44NTYsIDEsIDAuOTIyNDEsIDAuOTE3NTUsIDAuODY2NjcsIDAuNzg4LCAwLjg2OTM2LCAwLjg4NTgsIDAuODk4NzYsIDEsIDEsIDAuODEzNjMsIDEuMTkxMzcsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAwODgsIDAuOTAzODgsIDEuMDM5MDEsIDAuOTIxMzgsIDAuNzgxMDUsIDAuNzE1NCwgMC44NjE2OSwgMC44MDUxMywgMC45NDAwNywgMC44MjUyOCwgMC45ODYxMiwgMS4wNjIyNiwgMC45MTc1NSwgMC44MTI2LCAwLjgxODg0LCAwLjkyODE5LCAwLjczNzY0LCAwLjkwNTMxLCAwLjkwMjg0LCAwLjg4NTgsIDAuODYwMjMsIDAuODEyNiwgMC45MTE3MiwgMC45NjUxOCwgMC45MTExNSwgMC44MzA4OSwgMC44ODU4LCAwLjg3NzkxLCAwLjc5NzYxLCAwLjg5Mjk3LCAwLjgxMzYzLCAwLjg4MTU3LCAwLjg5OTkyLCAwLjg1NjA4LCAwLjgxOTkyLCAwLjk0MzA3LCAwLjg2MDIzLCAwLjg4MTU3LCAwLjk1MzA4LCAwLjk4Njk5LCAwLjk5NzkzLCAxLjA2MjI2LCAwLjk1ODE3LCAwLjk1MzA4LCAwLjk3MzU4LCAwLjkyOCwgMC45ODA4OCwgMC45ODY5OSwgMC45Mjc2MSwgMC45OTc5MywgMC45NjAxNywgMS4wNjIyNiwgMC45ODYsIDAuOTQ0LCAwLjk1OTc4LCAwLjkzOCwgMC45NjcwNSwgMC45ODcxNCwgMC44MDQ0MiwgMC45ODk3MiwgMSwgMC44OTc2MiwgMS4wNDU1MiwgMC45NTgxNywgMC45OTAwNywgMC44NzA2NCwgMC45MTg3OSwgMC44ODg4OCwgMS4wNjIyNiwgMC45NTgxNywgMC45ODcxNCwgMC45NTgxNywgMC44ODg4OCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44OTYzMywgMS4wMTkxNSwgMC44OTYzMywgMS4wMTkxNSwgMC44OTYzMywgMS4wMTkxNSwgMC44MTExLCAwLjk0MiwgMC45MjE5LCAxLCAwLjg5OTAzLCAxLCAxLCAxLCAwLjkzMTczLCAwLjkzMTczLCAwLjkzMTczLCAxLCAxLjA2MzA0LCAxLjA2MzA0LCAxLjA2OTA0LCAwLjg5OTAzLCAwLjg5OTAzLCAwLjgwNTQ5LCAxLCAxLjE1NiwgMSwgMSwgMC43NjU3NSwgMC43NjU3NSwgMSwgMSwgMC43MjQ1OCwgMSwgMSwgMSwgMSwgMC45MjI0MSwgMSwgMSwgMSwgMC42MTksIDEsIDEuMzYxNDUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDcyNTcsIDEsIDAuNzQ3MDUsIDAuNzExMTksIDEuMDIwNTgsIDEuMDI0LCAxLjAyMTE5LCAxLCAxLCAxLjE1MzYsIDEuMDg1OTUsIDEuMDg1OTUsIDEsIDEuMDg1OTUsIDEuMDg1OTUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDU2MzgsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBNeXJpYWRQcm9SZWd1bGFyTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIsCiAgbGluZUdhcDogMC4yCn07Cgo7Ly8gLi9zcmMvY29yZS9zZWdvZXVpX2ZhY3RvcnMuanMKY29uc3QgU2Vnb2V1aUJvbGRGYWN0b3JzID0gWzEuNzY3MzgsIDEsIDEsIDAuOTkyOTcsIDAuOTgyNCwgMS4wNDAxNiwgMS4wNjQ5NywgMS4wMzQyNCwgMC45NzUyOSwgMS4xNzY0NywgMS4yMzIwMywgMS4xMDg1LCAxLjEwODUsIDEuMTY5MzksIDEuMjEwNywgMC45NzU0LCAxLjIxNDA4LCAwLjk3NTQsIDEuNTk1NzgsIDEuMDM0MjQsIDEuMDM0MjQsIDEuMDM0MjQsIDEuMDM0MjQsIDEuMDM0MjQsIDEuMDM0MjQsIDEuMDM0MjQsIDEuMDM0MjQsIDEuMDM0MjQsIDEuMDM0MjQsIDAuODEzNzgsIDAuODEzNzgsIDEuMjEwNywgMS4yMTA3LCAxLjIxMDcsIDAuNzE3MDMsIDAuOTc4NDcsIDAuOTczNjMsIDAuODg3NzYsIDAuODY0MSwgMS4wMjA5NiwgMC43OTc5NSwgMC44NTEzMiwgMC45MTQsIDEuMDYwODUsIDEuMTQwNiwgMC44MDA3LCAwLjg5ODU4LCAwLjgzNjkzLCAxLjE0ODg5LCAxLjA5Mzk4LCAwLjk3NDg5LCAwLjkyMDk0LCAwLjk3NDg5LCAwLjkwMzk5LCAwLjg0MDQxLCAwLjk1OTIzLCAxLjAwMTM1LCAxLCAxLjA2NDY3LCAwLjk4MjQzLCAwLjkwOTk2LCAwLjk5MzYxLCAxLjEwODUsIDEuNTY5NDIsIDEuMTA4NSwgMS4yMTA3LCAwLjc0NjI3LCAwLjk0MjgyLCAwLjk2NzUyLCAxLjAxNTE5LCAwLjg2MzA0LCAxLjAxMzU5LCAwLjk3Mjc4LCAxLjE1MTAzLCAxLjAxMzU5LCAwLjk4NTYxLCAxLjAyMjg1LCAxLjAyMjg1LCAxLjAwNTI3LCAxLjAyMjg1LCAxLjAzMDIsIDAuOTkwNDEsIDEuMDAwOCwgMS4wMTUxOSwgMS4wMTM1OSwgMS4wMjI1OCwgMC43OTEwNCwgMS4xNjg2MiwgMC45OTA0MSwgMC45NzQ1NCwgMS4wMjUxMSwgMC45OTI5OCwgMC45Njc1MiwgMC45NTgwMSwgMC45NDg1NiwgMS4xNjU3OSwgMC45NDg1NiwgMS4yMTA3LCAwLjk4MjQsIDEuMDM0MjQsIDEuMDM0MjQsIDEsIDEuMDM0MjQsIDEuMTY1NzksIDAuODcyNywgMS4zODcxLCAxLjE4NjIyLCAxLjEwODE4LCAxLjA0NDc4LCAxLjIxMDcsIDEuMTg2MjIsIDAuNzUxNTUsIDAuOTQ5OTQsIDEuMjg4MjYsIDEuMjE0MDgsIDEuMjE0MDgsIDAuOTEwNTYsIDEsIDAuOTE1NzIsIDAuOTc1NCwgMC42NDY2MywgMS4xODMyOCwgMS4yNDg2NiwgMS4wNDQ3OCwgMS4xNDE2OSwgMS4xNTc0OSwgMS4xNzM4OSwgMC43MTcwMywgMC45NzM2MywgMC45NzM2MywgMC45NzM2MywgMC45NzM2MywgMC45NzM2MywgMC45NzM2MywgMC45MzUwNiwgMC44NjQxLCAwLjc5Nzk1LCAwLjc5Nzk1LCAwLjc5Nzk1LCAwLjc5Nzk1LCAxLjE0MDYsIDEuMTQwNiwgMS4xNDA2LCAxLjE0MDYsIDEuMDIwOTYsIDEuMDkzOTgsIDAuOTc0MjYsIDAuOTc0MjYsIDAuOTc0MjYsIDAuOTc0MjYsIDAuOTc0MjYsIDEuMjEwNywgMC45NzQ4OSwgMS4wMDEzNSwgMS4wMDEzNSwgMS4wMDEzNSwgMS4wMDEzNSwgMC45MDk5NiwgMC45MjA5NCwgMS4wMjc5OCwgMC45Njc1MiwgMC45Njc1MiwgMC45Njc1MiwgMC45Njc1MiwgMC45Njc1MiwgMC45Njc1MiwgMC45MzEzNiwgMC44NjMwNCwgMC45NzI3OCwgMC45NzI3OCwgMC45NzI3OCwgMC45NzI3OCwgMS4wMjI4NSwgMS4wMjI4NSwgMS4wMjI4NSwgMS4wMjI4NSwgMC45NzEyMiwgMC45OTA0MSwgMSwgMSwgMSwgMSwgMSwgMS4yODgyNiwgMS4wMDA4LCAwLjk5MDQxLCAwLjk5MDQxLCAwLjk5MDQxLCAwLjk5MDQxLCAwLjk2NzUyLCAxLjAxNTE5LCAwLjk2NzUyLCAwLjk3MzYzLCAwLjk2NzUyLCAwLjk3MzYzLCAwLjk2NzUyLCAwLjk3MzYzLCAwLjk2NzUyLCAwLjg2NDEsIDAuODYzMDQsIDAuODY0MSwgMC44NjMwNCwgMC44NjQxLCAwLjg2MzA0LCAwLjg2NDEsIDAuODYzMDQsIDEuMDIwOTYsIDEuMDMwNTcsIDEuMDIwOTYsIDEuMDM1MTcsIDAuNzk3OTUsIDAuOTcyNzgsIDAuNzk3OTUsIDAuOTcyNzgsIDAuNzk3OTUsIDAuOTcyNzgsIDAuNzk3OTUsIDAuOTcyNzgsIDAuNzk3OTUsIDAuOTcyNzgsIDAuOTE0LCAxLjAxMzU5LCAwLjkxNCwgMS4wMTM1OSwgMC45MTQsIDEuMDEzNTksIDEsIDEsIDEuMDYwODUsIDAuOTg1NjEsIDEuMDYwODUsIDEuMDA4NzksIDEuMTQwNiwgMS4wMjI4NSwgMS4xNDA2LCAxLjAyMjg1LCAxLjE0MDYsIDEuMDIyODUsIDEuMTQwNiwgMS4wMjI4NSwgMS4xNDA2LCAxLjAyMjg1LCAwLjk3MTM4LCAxLjA4NjkyLCAwLjgwMDcsIDEuMDIyODUsIDEsIDEsIDEuMDA1MjcsIDAuODM2OTMsIDEuMDIyODUsIDEsIDEsIDAuODM2OTMsIDAuOTQ1NSwgMC44MzY5MywgMC45MDQxOCwgMC44MzY5MywgMS4xMzAwNSwgMS4wOTM5OCwgMC45OTA0MSwgMSwgMSwgMS4wOTM5OCwgMC45OTA0MSwgMC45NjY5MiwgMS4wOTI1MSwgMC45OTA0MSwgMC45NzQ4OSwgMS4wMDA4LCAwLjk3NDg5LCAxLjAwMDgsIDAuOTc0ODksIDEuMDAwOCwgMC45Mzk5NCwgMC45NzkzMSwgMC45MDM5OSwgMS4wMjI1OCwgMSwgMSwgMC45MDM5OSwgMS4wMjI1OCwgMC44NDA0MSwgMC43OTEwNCwgMC44NDA0MSwgMC43OTEwNCwgMC44NDA0MSwgMC43OTEwNCwgMC44NDA0MSwgMC43OTEwNCwgMSwgMSwgMC45NTkyMywgMS4wNzAzNCwgMC45NTkyMywgMS4xNjg2MiwgMS4wMDEzNSwgMC45OTA0MSwgMS4wMDEzNSwgMC45OTA0MSwgMS4wMDEzNSwgMC45OTA0MSwgMS4wMDEzNSwgMC45OTA0MSwgMS4wMDEzNSwgMC45OTA0MSwgMS4wMDEzNSwgMC45OTA0MSwgMS4wNjQ2NywgMS4wMjUxMSwgMC45MDk5NiwgMC45Njc1MiwgMC45MDk5NiwgMC45OTM2MSwgMC45NTgwMSwgMC45OTM2MSwgMC45NTgwMSwgMC45OTM2MSwgMC45NTgwMSwgMS4wNzczMywgMS4wMzQyNCwgMC45NzM2MywgMC45Njc1MiwgMC45MzUwNiwgMC45MzEzNiwgMC45NzQ4OSwgMS4wMDA4LCAxLCAxLCAwLjk1OTIzLCAxLjE2ODYyLCAxLjE1MTAzLCAxLjE1MTAzLCAxLjAxMTczLCAxLjAzOTU5LCAwLjc1OTUzLCAwLjgxMzc4LCAwLjc5OTEyLCAxLjE1MTAzLCAxLjIxOTk0LCAwLjk1MTYxLCAwLjg3ODE1LCAxLjAxMTQ5LCAwLjgxNTI1LCAwLjc2NzYsIDAuOTgxNjcsIDEuMDExMzQsIDEuMDI1NDYsIDAuODQwOTcsIDEuMDMwODksIDEuMTgxMDIsIDAuOTczNjMsIDAuODg3NzYsIDAuODUxMzQsIDAuOTc4MjYsIDAuNzk3OTUsIDAuOTkzNjEsIDEuMDYwODUsIDAuOTc0ODksIDEuMTQwNiwgMC44OTg1OCwgMS4wMzg4LCAxLjE0ODg5LCAxLjA5Mzk4LCAwLjg2MDM5LCAwLjk3NDg5LCAxLjA1OTUsIDAuOTIwOTQsIDAuOTQ3OTMsIDAuOTU5MjMsIDAuOTA5OTYsIDAuOTkzNDYsIDAuOTgyNDMsIDEuMDIxMTIsIDAuOTU0OTMsIDEuMTQwNiwgMC45MDk5NiwgMS4wMzU3NCwgMS4wMjU5NywgMS4wMDA4LCAxLjE4MTAyLCAxLjA2NjI4LCAxLjAzNTc0LCAxLjAxOTIsIDEuMDE5MzIsIDEuMDA4ODYsIDAuOTc1MzEsIDEuMDEwNiwgMS4wMDA4LCAxLjEzMTg5LCAxLjE4MTAyLCAxLjAyMjc3LCAwLjk4NjgzLCAxLjAwMTYsIDAuOTk1NjEsIDEuMDcyMzcsIDEuMDAwOCwgMC45MDQzNCwgMC45OTkyMSwgMC45MzgwMywgMC44OTY1LCAxLjIzMDg1LCAxLjA2NjI4LCAxLjA0OTgzLCAwLjk2MjY4LCAxLjA0OTksIDAuOTg0MzksIDEuMTgxMDIsIDEuMDY2MjgsIDEuMDAwOCwgMS4wNjYyOCwgMC45ODQzOSwgMC43OTc5NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wOTQ2NiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45NzI3OCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wMjA2NSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wNjQ2NywgMS4wMjUxMSwgMS4wNjQ2NywgMS4wMjUxMSwgMS4wNjQ2NywgMS4wMjUxMSwgMC45MDk5NiwgMC45Njc1MiwgMSwgMS4yMTQwOCwgMC44OTkwMywgMSwgMSwgMC43NTE1NSwgMS4wNDM5NCwgMS4wNDM5NCwgMS4wNDM5NCwgMS4wNDM5NCwgMC45ODYzMywgMC45ODYzMywgMC45ODYzMywgMC43MzA0NywgMC43MzA0NywgMS4yMDY0MiwgMC45MTIxMSwgMS4yNTYzNSwgMS4yMjIsIDEuMDI5NTYsIDEuMDMzNzIsIDEuMDMzNzIsIDAuOTYwMzksIDEuMjQ2MzMsIDEsIDEuMTI0NTQsIDAuOTM1MDMsIDEuMDM0MjQsIDEuMTk2ODcsIDEuMDM0MjQsIDEsIDEsIDEsIDAuNzcxLCAxLCAxLCAxLjE1NzQ5LCAxLjE1NzQ5LCAxLjE1NzQ5LCAxLjEwOTQ4LCAwLjg2Mjc5LCAwLjk0NDM0LCAwLjg2Mjc5LCAwLjk0NDM0LCAwLjg2MTgyLCAxLCAxLCAxLjE2ODk3LCAxLCAwLjk2MDg1LCAwLjkwMTM3LCAxLjIxMDcsIDEuMTg0MTYsIDEuMTM5NzMsIDAuNjk4MjUsIDAuOTcxNiwgMi4xMDMzOSwgMS4yOTAwNCwgMS4yOTAwNCwgMS4yMTE3MiwgMS4yOTAwNCwgMS4yOTAwNCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS40MjYwMywgMSwgMC45OTg2MiwgMC45OTg2MiwgMSwgMC44NzAyNSwgMC44NzAyNSwgMC44NzAyNSwgMC44NzAyNSwgMS4xODg3NCwgMS40MjYwMywgMSwgMS40MjYwMywgMS40MjYwMywgMC45OTg2MiwgMSwgMSwgMSwgMSwgMSwgMS4yODg2LCAxLjA0MzE1LCAxLjE1Mjk2LCAxLjM0MTYzLCAxLCAxLCAxLCAxLjA5MTkzLCAxLjA5MTkzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKY29uc3QgU2Vnb2V1aUJvbGRNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMzMwMDgsCiAgbGluZUdhcDogMAp9Owpjb25zdCBTZWdvZXVpQm9sZEl0YWxpY0ZhY3RvcnMgPSBbMS43NjczOCwgMSwgMSwgMC45ODk0NiwgMS4wMzk1OSwgMS4wNDAxNiwgMS4wMjgwOSwgMS4wMzYsIDAuOTc2MzksIDEuMTA5NTMsIDEuMjMyMDMsIDEuMTExNDQsIDEuMTExNDQsIDEuMTY5MzksIDEuMjEyMzcsIDAuOTc1NCwgMS4yMTI2MSwgMC45NzU0LCAxLjU5NzU0LCAxLjAzNiwgMS4wMzYsIDEuMDM2LCAxLjAzNiwgMS4wMzYsIDEuMDM2LCAxLjAzNiwgMS4wMzYsIDEuMDM2LCAxLjAzNiwgMC44MTM3OCwgMC44MTM3OCwgMS4yMTIzNywgMS4yMTIzNywgMS4yMTIzNywgMC43MzU0MSwgMC45Nzg0NywgMC45NzM2MywgMC44OTcyMywgMC44Nzg5NywgMS4wNDI2LCAwLjc5NDI5LCAwLjg1MjkyLCAwLjkxMTQ5LCAxLjA1ODE1LCAxLjE0MDYsIDAuNzk2MzEsIDAuOTAxMjgsIDAuODM4NTMsIDEuMDQzOTYsIDEuMTA2MTUsIDAuOTc1NTIsIDAuOTQ0MzYsIDAuOTc1NTIsIDAuODg2NDEsIDAuODA1MjcsIDAuOTYwODMsIDEuMDAxMzUsIDEsIDEuMDY3NzcsIDAuOTgxNywgMC45MTE0MiwgMC45OTM2MSwgMS4xMTE0NCwgMS41NzI5MywgMS4xMTE0NCwgMS4yMTIzNywgMC43NDYyNywgMS4zMTgxOCwgMS4wNjU4NSwgMC45NzA0MiwgMC44MzA1NSwgMC45NzA0MiwgMC45MzUwMywgMS4xMjYxLCAwLjk3MDQyLCAwLjk3OTIyLCAxLjE0MjM2LCAwLjk0NTUyLCAxLjAxMDU0LCAxLjE0MjM2LCAxLjAyNDcxLCAwLjk3OTIyLCAwLjk0MTY1LCAwLjk3MDQyLCAwLjk3MDQyLCAxLjAyNzYsIDAuNzg5MjksIDEuMTI2MSwgMC45NzkyMiwgMC45NTg3NCwgMS4wMjE5NywgMC45ODUwNywgMC45Njc1MiwgMC45NzE2OCwgMC45NTEwNywgMS4xNjU3OSwgMC45NTEwNywgMS4yMTIzNywgMS4wMzk1OSwgMS4wMzYsIDEuMDM2LCAxLCAxLjAzNiwgMS4xNjU3OSwgMC44NzM1NywgMS4zMTgxOCwgMS4xODc1NCwgMS4yNjc4MSwgMS4wNTM1NiwgMS4yMTIzNywgMS4xODYyMiwgMC43OTQ4NywgMC45NDk5NCwgMS4yOTAwNCwgMS4yNDA0NywgMS4yNDA0NywgMS4zMTgxOCwgMSwgMC45MTQ4NCwgMC45NzU0LCAxLjMxODE4LCAxLjEzNDksIDEuMjQ4NjYsIDEuMDUzNTYsIDEuMTM5MzQsIDEuMTU1NzQsIDEuMTczODksIDAuNzM1NDEsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTQzODUsIDAuODc4OTcsIDAuNzk0MjksIDAuNzk0MjksIDAuNzk0MjksIDAuNzk0MjksIDEuMTQwNiwgMS4xNDA2LCAxLjE0MDYsIDEuMTQwNiwgMS4wNDI2LCAxLjEwNjE1LCAwLjk3NTUyLCAwLjk3NTUyLCAwLjk3NTUyLCAwLjk3NTUyLCAwLjk3NTUyLCAxLjIxMjM3LCAwLjk3NTUyLCAxLjAwMTM1LCAxLjAwMTM1LCAxLjAwMTM1LCAxLjAwMTM1LCAwLjkxMTQyLCAwLjk0NDM2LCAwLjk4NzIxLCAxLjA2NTg1LCAxLjA2NTg1LCAxLjA2NTg1LCAxLjA2NTg1LCAxLjA2NTg1LCAxLjA2NTg1LCAwLjk2NzA1LCAwLjgzMDU1LCAwLjkzNTAzLCAwLjkzNTAzLCAwLjkzNTAzLCAwLjkzNTAzLCAxLjE0MjM2LCAxLjE0MjM2LCAxLjE0MjM2LCAxLjE0MjM2LCAwLjkzMTI1LCAwLjk3OTIyLCAwLjk0MTY1LCAwLjk0MTY1LCAwLjk0MTY1LCAwLjk0MTY1LCAwLjk0MTY1LCAxLjI5MDA0LCAwLjk0MTY1LCAwLjk3OTIyLCAwLjk3OTIyLCAwLjk3OTIyLCAwLjk3OTIyLCAwLjk2NzUyLCAwLjk3MDQyLCAwLjk2NzUyLCAwLjk3MzYzLCAxLjA2NTg1LCAwLjk3MzYzLCAxLjA2NTg1LCAwLjk3MzYzLCAxLjA2NTg1LCAwLjg3ODk3LCAwLjgzMDU1LCAwLjg3ODk3LCAwLjgzMDU1LCAwLjg3ODk3LCAwLjgzMDU1LCAwLjg3ODk3LCAwLjgzMDU1LCAxLjA0MjYsIDEuMDAzMywgMS4wNDI2LCAwLjk3MDQyLCAwLjc5NDI5LCAwLjkzNTAzLCAwLjc5NDI5LCAwLjkzNTAzLCAwLjc5NDI5LCAwLjkzNTAzLCAwLjc5NDI5LCAwLjkzNTAzLCAwLjc5NDI5LCAwLjkzNTAzLCAwLjkxMTQ5LCAwLjk3MDQyLCAwLjkxMTQ5LCAwLjk3MDQyLCAwLjkxMTQ5LCAwLjk3MDQyLCAxLCAxLCAxLjA1ODE1LCAwLjk3OTIyLCAxLjA1ODE1LCAwLjk3OTIyLCAxLjE0MDYsIDEuMTQyMzYsIDEuMTQwNiwgMS4xNDIzNiwgMS4xNDA2LCAxLjE0MjM2LCAxLjE0MDYsIDEuMTQyMzYsIDEuMTQwNiwgMS4xNDIzNiwgMC45NzQ0MSwgMS4wNDMwMiwgMC43OTYzMSwgMS4wMTU4MiwgMSwgMSwgMS4wMTA1NCwgMC44Mzg1MywgMS4xNDIzNiwgMSwgMSwgMC44Mzg1MywgMS4wOTEyNSwgMC44Mzg1MywgMC45MDQxOCwgMC44Mzg1MywgMS4xOTUwOCwgMS4xMDYxNSwgMC45NzkyMiwgMSwgMSwgMS4xMDYxNSwgMC45NzkyMiwgMS4wMTAzNCwgMS4xMDQ2NiwgMC45NzkyMiwgMC45NzU1MiwgMC45NDE2NSwgMC45NzU1MiwgMC45NDE2NSwgMC45NzU1MiwgMC45NDE2NSwgMC45MTYwMiwgMC45MTk4MSwgMC44ODY0MSwgMS4wMjc2LCAxLCAxLCAwLjg4NjQxLCAxLjAyNzYsIDAuODA1MjcsIDAuNzg5MjksIDAuODA1MjcsIDAuNzg5MjksIDAuODA1MjcsIDAuNzg5MjksIDAuODA1MjcsIDAuNzg5MjksIDEsIDEsIDAuOTYwODMsIDEuMDU0MDMsIDAuOTU5MjMsIDEuMTY4NjIsIDEuMDAxMzUsIDAuOTc5MjIsIDEuMDAxMzUsIDAuOTc5MjIsIDEuMDAxMzUsIDAuOTc5MjIsIDEuMDAxMzUsIDAuOTc5MjIsIDEuMDAxMzUsIDAuOTc5MjIsIDEuMDAxMzUsIDAuOTc5MjIsIDEuMDY3NzcsIDEuMDIxOTcsIDAuOTExNDIsIDAuOTY3NTIsIDAuOTExNDIsIDAuOTkzNjEsIDAuOTcxNjgsIDAuOTkzNjEsIDAuOTcxNjgsIDAuOTkzNjEsIDAuOTcxNjgsIDEuMjMxOTksIDEuMDM2LCAwLjk3MzYzLCAxLjA2NTg1LCAwLjk0Mzg1LCAwLjk2NzA1LCAwLjk3NTUyLCAwLjk0MTY1LCAxLCAxLCAwLjk2MDgzLCAxLjEyNjEsIDEuMzE4MTgsIDEuMzE4MTgsIDEuMzE4MTgsIDEuMzE4MTgsIDEuMzE4MTgsIDEuMzE4MTgsIDEuMzE4MTgsIDEuMzE4MTgsIDEuMzE4MTgsIDAuOTUxNjEsIDEuMjcxMjYsIDEuMDA4MTEsIDAuODMyODQsIDAuNzc3MDIsIDAuOTkxMzcsIDAuOTUyNTMsIDEuMDM0NywgMC44NjE0MiwgMS4wNzIwNSwgMS4xNDIzNiwgMC45NzM2MywgMC44OTcyMywgMC44Njg2OSwgMS4wOTgxOCwgMC43OTQyOSwgMC45OTM2MSwgMS4wNTgxNSwgMC45NzU1MiwgMS4xNDA2LCAwLjkwMTI4LCAxLjA2NjYyLCAxLjA0Mzk2LCAxLjEwNjE1LCAwLjg0OTE4LCAwLjk3NTUyLCAxLjA0Njk0LCAwLjk0NDM2LCAwLjk4MDE1LCAwLjk2MDgzLCAwLjkxMTQyLCAxLjAwMzU2LCAwLjk4MTcsIDEuMDE5NDUsIDAuOTg5OTksIDEuMTQwNiwgMC45MTE0MiwgMS4wNDk2MSwgMC45ODk4LCAxLjAwNjM5LCAxLjE0MjM2LCAxLjA3NTE0LCAxLjA0OTYxLCAwLjk5NjA3LCAxLjAyODk3LCAxLjAwOCwgMC45ODk4LCAwLjk1MTM0LCAxLjAwNjM5LCAxLjExMTIxLCAxLjE0MjM2LCAxLjAwNTE4LCAwLjk3OTgxLCAxLjAyMTg2LCAxLCAxLjA4NTc4LCAwLjk0MTY1LCAwLjk5MzE0LCAwLjk4Mzg3LCAwLjkzMDI4LCAwLjkzMzc3LCAxLjM1MTI1LCAxLjA3NTE0LCAxLjEwNjg3LCAwLjkzNDkxLCAxLjA0MjMyLCAxLjAwMzUxLCAxLjE0MjM2LCAxLjA3NTE0LCAwLjk0MTY1LCAxLjA3NTE0LCAxLjAwMzUxLCAwLjc5NDI5LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjA5MDk3LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkzNTAzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk2NjA5LCAxLCAxLCAxLCAxLCAxLCAxLCAxLjA2Nzc3LCAxLjAyMTk3LCAxLjA2Nzc3LCAxLjAyMTk3LCAxLjA2Nzc3LCAxLjAyMTk3LCAwLjkxMTQyLCAwLjk2NzUyLCAxLCAxLjIxMjYxLCAwLjg5OTAzLCAxLCAxLCAwLjc1MTU1LCAxLjA0NzQ1LCAxLjA0NzQ1LCAxLjA0NzQ1LCAxLjA0Mzk0LCAwLjk4NjMzLCAwLjk4NjMzLCAwLjk4NjMzLCAwLjcyOTU5LCAwLjcyOTU5LCAxLjIwNTAyLCAwLjkxNDA2LCAxLjI2NTE0LCAxLjIyMiwgMS4wMjk1NiwgMS4wMzM3MiwgMS4wMzM3MiwgMC45NjAzOSwgMS4yNDYzMywgMSwgMS4wOTEyNSwgMC45MzMyNywgMS4wMzMzNiwgMS4xNjU0MSwgMS4wMzYsIDEsIDEsIDEsIDAuNzcxLCAxLCAxLCAxLjE1NTc0LCAxLjE1NTc0LCAxLjE1NTc0LCAxLjE1NTc0LCAwLjg2MzY0LCAwLjk0NDM0LCAwLjg2Mjc5LCAwLjk0NDM0LCAwLjg2MjI0LCAxLCAxLCAxLjE2Nzk4LCAxLCAwLjk2MDg1LCAwLjkwMDY4LCAxLjIxMjM3LCAxLjE4NDE2LCAxLjEzOTA0LCAwLjY5ODI1LCAwLjk3MTYsIDIuMTAzMzksIDEuMjkwMDQsIDEuMjkwMDQsIDEuMjEzMzksIDEuMjkwMDQsIDEuMjkwMDQsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuNDI2MDMsIDEsIDAuOTk4NjIsIDAuOTk4NjIsIDEsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDEuMTg3NzUsIDEuNDI2MDMsIDEsIDEuNDI2MDMsIDEuNDI2MDMsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEuMjg4NiwgMS4wNDMxNSwgMS4xNTI5NiwgMS4zNDE2MywgMSwgMSwgMSwgMS4xMzI2OSwgMS4xMzI2OSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmNvbnN0IFNlZ29ldWlCb2xkSXRhbGljTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjMzMDA4LAogIGxpbmVHYXA6IDAKfTsKY29uc3QgU2Vnb2V1aUl0YWxpY0ZhY3RvcnMgPSBbMS43NjczOCwgMSwgMSwgMC45ODk0NiwgMS4xNDc2MywgMS4wNTM2NSwgMS4wNjIzNCwgMC45NjkyNywgMC45MjU4NiwgMS4xNTM3MywgMS4xODQxNCwgMC45MTM0OSwgMC45MTM0OSwgMS4wNzQwMywgMS4xNzMwOCwgMC43ODM4MywgMS4yMDA4OCwgMC43ODM4MywgMS40MjUzMSwgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC45NjkyNywgMC43ODM4MywgMC43ODM4MywgMS4xNzMwOCwgMS4xNzMwOCwgMS4xNzMwOCwgMC43NzM0OSwgMC45NDU2NSwgMC45NDcyOSwgMC44NTk0NCwgMC44ODUwNiwgMC45ODU4LCAwLjc0ODE3LCAwLjgwMDE2LCAwLjg4NDQ5LCAwLjk4MDM5LCAwLjk1NzgyLCAwLjY5MjM4LCAwLjg5ODk4LCAwLjgzMjMxLCAwLjk4MTgzLCAxLjAzOTg5LCAwLjk2OTI0LCAwLjg2MjM3LCAwLjk2OTI0LCAwLjgwNTk1LCAwLjc0NTI0LCAwLjg2MDkxLCAwLjk1NDAyLCAwLjk0MTQzLCAwLjk4NDQ4LCAwLjg4NTgsIDAuODMwODksIDAuOTMyODUsIDEuMDk0OSwgMS4zOTAxNiwgMS4wOTQ5LCAxLjQ1OTk0LCAwLjc0NjI3LCAxLjA0ODM5LCAwLjk3NDU0LCAwLjk3NDU0LCAwLjg3MjA3LCAwLjk3NDU0LCAwLjg3NTMzLCAxLjA2MTUxLCAwLjk3NDU0LCAxLjAwMTc2LCAxLjE2NDg0LCAxLjA4MTMyLCAwLjk4MDQ3LCAxLjE2NDg0LCAxLjAyOTg5LCAxLjAxMDU0LCAwLjk2MjI1LCAwLjk3NDU0LCAwLjk3NDU0LCAxLjA2NTk4LCAwLjc5MDA0LCAxLjE2MzQ0LCAxLjAwMzUxLCAwLjk0NjI5LCAwLjk5NzMsIDAuOTEwMTYsIDAuOTY3NzcsIDAuOTA0MywgMC45MTA4MiwgMC45MjQ4MSwgMC45MTA4MiwgMS4xNzMwOCwgMC45NTc0OCwgMC45NjkyNywgMC45NjkyNywgMSwgMC45NjkyNywgMC45MjQ4MSwgMC44MDU5NywgMS4wNDgzOSwgMS4yMzM5MywgMS4xNzgxLCAwLjkyNDUsIDEuMTczMDgsIDEuMjA4MDgsIDAuNjMyMTgsIDAuOTQyNjEsIDEuMjQ4MjIsIDEuMDk5NzEsIDEuMDk5NzEsIDEuMDQ4MzksIDEsIDAuODUyNzMsIDAuNzgwMzIsIDEuMDQ4MzksIDEuMDk5NzEsIDEuMjIzMjYsIDAuOTI0NSwgMS4wOTgzNiwgMS4xMzUyNSwgMS4xNTIyMiwgMC43MDQyNCwgMC45NDcyOSwgMC45NDcyOSwgMC45NDcyOSwgMC45NDcyOSwgMC45NDcyOSwgMC45NDcyOSwgMC44NTQ5OCwgMC44ODUwNiwgMC43NDgxNywgMC43NDgxNywgMC43NDgxNywgMC43NDgxNywgMC45NTc4MiwgMC45NTc4MiwgMC45NTc4MiwgMC45NTc4MiwgMC45ODU4LCAxLjAzOTg5LCAwLjk2OTI0LCAwLjk2OTI0LCAwLjk2OTI0LCAwLjk2OTI0LCAwLjk2OTI0LCAxLjE3MzA4LCAwLjk2OTI0LCAwLjk1NDAyLCAwLjk1NDAyLCAwLjk1NDAyLCAwLjk1NDAyLCAwLjgzMDg5LCAwLjg2MjM3LCAwLjg4NDA5LCAwLjk3NDU0LCAwLjk3NDU0LCAwLjk3NDU0LCAwLjk3NDU0LCAwLjk3NDU0LCAwLjk3NDU0LCAwLjkyOTE2LCAwLjg3MjA3LCAwLjg3NTMzLCAwLjg3NTMzLCAwLjg3NTMzLCAwLjg3NTMzLCAwLjkzMTQ2LCAwLjkzMTQ2LCAwLjkzMTQ2LCAwLjkzMTQ2LCAwLjkzODU0LCAxLjAxMDU0LCAwLjk2MjI1LCAwLjk2MjI1LCAwLjk2MjI1LCAwLjk2MjI1LCAwLjk2MjI1LCAxLjI0ODIyLCAwLjg3NjEsIDEuMDAzNTEsIDEuMDAzNTEsIDEuMDAzNTEsIDEuMDAzNTEsIDAuOTY3NzcsIDAuOTc0NTQsIDAuOTY3NzcsIDAuOTQ3MjksIDAuOTc0NTQsIDAuOTQ3MjksIDAuOTc0NTQsIDAuOTQ3MjksIDAuOTc0NTQsIDAuODg1MDYsIDAuODcyMDcsIDAuODg1MDYsIDAuODcyMDcsIDAuODg1MDYsIDAuODcyMDcsIDAuODg1MDYsIDAuODcyMDcsIDAuOTg1OCwgMC45NTM5MSwgMC45ODU4LCAwLjk3NDU0LCAwLjc0ODE3LCAwLjg3NTMzLCAwLjc0ODE3LCAwLjg3NTMzLCAwLjc0ODE3LCAwLjg3NTMzLCAwLjc0ODE3LCAwLjg3NTMzLCAwLjc0ODE3LCAwLjg3NTMzLCAwLjg4NDQ5LCAwLjk3NDU0LCAwLjg4NDQ5LCAwLjk3NDU0LCAwLjg4NDQ5LCAwLjk3NDU0LCAxLCAxLCAwLjk4MDM5LCAxLjAwMTc2LCAwLjk4MDM5LCAxLjAwMTc2LCAwLjk1NzgyLCAwLjkzMTQ2LCAwLjk1NzgyLCAwLjkzMTQ2LCAwLjk1NzgyLCAwLjkzMTQ2LCAwLjk1NzgyLCAxLjE2NDg0LCAwLjk1NzgyLCAwLjkzMTQ2LCAwLjg0NDIxLCAxLjEyNzYxLCAwLjY5MjM4LCAxLjA4MTMyLCAxLCAxLCAwLjk4MDQ3LCAwLjgzMjMxLCAxLjE2NDg0LCAxLCAxLCAwLjg0NzIzLCAxLjA0ODYxLCAwLjg0NzIzLCAwLjc4NzU1LCAwLjgzMjMxLCAxLjIzNzM2LCAxLjAzOTg5LCAxLjAxMDU0LCAxLCAxLCAxLjAzOTg5LCAxLjAxMDU0LCAwLjk4NTcsIDEuMDM4NDksIDEuMDEwNTQsIDAuOTY5MjQsIDAuOTYyMjUsIDAuOTY5MjQsIDAuOTYyMjUsIDAuOTY5MjQsIDAuOTYyMjUsIDAuOTIzODMsIDAuOTAxNzEsIDAuODA1OTUsIDEuMDY1OTgsIDEsIDEsIDAuODA1OTUsIDEuMDY1OTgsIDAuNzQ1MjQsIDAuNzkwMDQsIDAuNzQ1MjQsIDAuNzkwMDQsIDAuNzQ1MjQsIDAuNzkwMDQsIDAuNzQ1MjQsIDAuNzkwMDQsIDEsIDEsIDAuODYwOTEsIDEuMDI3NTksIDAuODU3NzEsIDEuMTYzNDQsIDAuOTU0MDIsIDEuMDAzNTEsIDAuOTU0MDIsIDEuMDAzNTEsIDAuOTU0MDIsIDEuMDAzNTEsIDAuOTU0MDIsIDEuMDAzNTEsIDAuOTU0MDIsIDEuMDAzNTEsIDAuOTU0MDIsIDEuMDAzNTEsIDAuOTg0NDgsIDAuOTk3MywgMC44MzA4OSwgMC45Njc3NywgMC44MzA4OSwgMC45MzI4NSwgMC45MDQzLCAwLjkzMjg1LCAwLjkwNDMsIDAuOTMyODUsIDAuOTA0MywgMS4zMTg2OCwgMC45NjkyNywgMC45NDcyOSwgMC45NzQ1NCwgMC44NTQ5OCwgMC45MjkxNiwgMC45NjkyNCwgMC44NzYxLCAxLCAxLCAwLjg2MDkxLCAxLjE2MzQ0LCAxLjA0ODM5LCAxLjA0ODM5LCAxLjA0ODM5LCAxLjA0ODM5LCAxLjA0ODM5LCAxLjA0ODM5LCAxLjA0ODM5LCAxLjA0ODM5LCAxLjA0ODM5LCAwLjgxOTY1LCAwLjgxOTY1LCAwLjk0NzI5LCAwLjc4MDMyLCAwLjcxMDIyLCAwLjkwODgzLCAwLjg0MTcxLCAwLjk5ODc3LCAwLjc3NTk2LCAxLjA1NzM0LCAxLjIsIDAuOTQ3MjksIDAuODU5NDQsIDAuODI3OTEsIDAuOTYwNywgMC43NDgxNywgMC45MzI4NSwgMC45ODAzOSwgMC45NjkyNCwgMC45NTc4MiwgMC44OTg5OCwgMC45ODMxNiwgMC45ODE4MywgMS4wMzk4OSwgMC43ODYxNCwgMC45NjkyNCwgMC45NzY0MiwgMC44NjIzNywgMC44NjA3NSwgMC44NjA5MSwgMC44MzA4OSwgMC45MDA4MiwgMC44ODU4LCAwLjk3Mjk2LCAxLjAxMjg0LCAwLjk1NzgyLCAwLjgzMDg5LCAxLjA5NzYsIDEuMDQsIDEuMDMzNDIsIDEuMiwgMS4wNjc1LCAxLjA5NzYsIDAuOTgyMDUsIDEuMDM4MDksIDEuMDUwOTcsIDEuMDQsIDAuOTUzNjQsIDEuMDMzNDIsIDEuMDU0MDEsIDEuMiwgMS4wMjE0OCwgMS4wMTE5LCAxLjA0NzI0LCAxLjAxMjcsIDEuMDI3MzIsIDAuOTYyMjUsIDAuODk2NSwgMC45Nzc4MywgMC45MzU3NCwgMC45NDgxOCwgMS4zMDY3OSwgMS4wNjc1LCAxLjExODI2LCAwLjk5ODIxLCAxLjA1NTcsIDEuMDMyNiwgMS4yLCAxLjA2NzUsIDAuOTYyMjUsIDEuMDY3NSwgMS4wMzI2LCAwLjc0ODE3LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjAzNzU0LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjg3NTMzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk4NzA1LCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk4NDQ4LCAwLjk5NzMsIDAuOTg0NDgsIDAuOTk3MywgMC45ODQ0OCwgMC45OTczLCAwLjgzMDg5LCAwLjk2Nzc3LCAxLCAxLjIwMDg4LCAwLjg5OTAzLCAxLCAxLCAwLjc1MTU1LCAwLjk0OTQ1LCAwLjk0OTQ1LCAwLjk0OTQ1LCAwLjk0OTQ1LCAxLjEyMzE3LCAxLjEyMzE3LCAxLjEyMzE3LCAwLjY3NjAzLCAwLjY3NjAzLCAxLjE1NjIxLCAwLjczNTg0LCAxLjIxMTkxLCAxLjIyMTM1LCAxLjA2NDgzLCAwLjk0ODY4LCAwLjk0ODY4LCAwLjk1OTk2LCAxLjI0NjMzLCAxLCAxLjA3NDk3LCAwLjg3NzA5LCAwLjk2OTI3LCAxLjAxNDczLCAwLjk2OTI3LCAxLCAxLCAxLCAwLjc3Mjk1LCAxLCAxLCAxLjA5ODM2LCAxLjA5ODM2LCAxLjA5ODM2LCAxLjAxNTIyLCAwLjg2MzIxLCAwLjk0NDM0LCAwLjg2NDksIDAuOTQ0MzQsIDAuODYxODIsIDEsIDEsIDEuMDgzLCAxLCAwLjkxNTc4LCAwLjg2NDM4LCAxLjE3MzA4LCAxLjE4NDE2LCAxLjE0NTg5LCAwLjY5ODI1LCAwLjk3NjIyLCAxLjk2NzkxLCAxLjI0ODIyLCAxLjI0ODIyLCAxLjE3MzA4LCAxLjI0ODIyLCAxLjI0ODIyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjQyNjAzLCAxLCAwLjk5ODYyLCAwLjk5ODYyLCAxLCAwLjg3MDI1LCAwLjg3MDI1LCAwLjg3MDI1LCAwLjg3MDI1LCAxLjE3OTg0LCAxLjQyNjAzLCAxLCAxLjQyNjAzLCAxLjQyNjAzLCAwLjk5ODYyLCAxLCAxLCAxLCAxLCAxLCAxLjI4ODYsIDEuMDQzMTUsIDEuMTUyOTYsIDEuMzQxNjMsIDEsIDEsIDEsIDEuMTA3NDIsIDEuMTA3NDIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpjb25zdCBTZWdvZXVpSXRhbGljTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjMzMDA4LAogIGxpbmVHYXA6IDAKfTsKY29uc3QgU2Vnb2V1aVJlZ3VsYXJGYWN0b3JzID0gWzEuNzY3MzgsIDEsIDEsIDAuOTg1OTQsIDEuMDIyODUsIDEuMTA0NTQsIDEuMDYyMzQsIDAuOTY5MjcsIDAuOTIwMzcsIDEuMTk5ODUsIDEuMjA0NiwgMC45MDYxNiwgMC45MDYxNiwgMS4wNzE1MiwgMS4xNzE0LCAwLjc4MDMyLCAxLjIwMDg4LCAwLjc4MDMyLCAxLjQwMjQ2LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjc4MDMyLCAwLjc4MDMyLCAxLjE3MTQsIDEuMTcxNCwgMS4xNzE0LCAwLjgwNTk3LCAwLjk0MDg0LCAwLjk2NzA2LCAwLjg1OTQ0LCAwLjg1NzM0LCAwLjk3MDkzLCAwLjc1ODQyLCAwLjc5OTM2LCAwLjg4MTk4LCAwLjk4MzEsIDAuOTU3ODIsIDAuNzEzODcsIDAuODY5NjksIDAuODQ2MzYsIDEuMDc3OTYsIDEuMDM1ODQsIDAuOTY5MjQsIDAuODM5NjgsIDAuOTY5MjQsIDAuODI4MjYsIDAuNzk2NDksIDAuODU3NzEsIDAuOTUxMzIsIDAuOTMxMTksIDAuOTg5NjUsIDAuODg0MzMsIDAuODI4NywgMC45MzM2NSwgMS4wODYxMiwgMS4zNjM4LCAxLjA4NjEyLCAxLjQ1Nzg2LCAwLjc0NjI3LCAwLjgwNDk5LCAwLjkxNDg0LCAxLjA1NzA3LCAwLjkyMzgzLCAxLjA1ODgyLCAwLjk0MDMsIDEuMTI2NTQsIDEuMDU4ODIsIDEuMDE3NTYsIDEuMDkwMTEsIDEuMDkwMTEsIDAuOTk0MTQsIDEuMDkwMTEsIDEuMDM0LCAxLjAxNzU2LCAxLjA1MzU2LCAxLjA1NzA3LCAxLjA1ODgyLCAxLjA0Mzk5LCAwLjg0ODYzLCAxLjIxOTY4LCAxLjAxNzU2LCAwLjk1ODAxLCAxLjAwMDY4LCAwLjkxNzk3LCAwLjk2Nzc3LCAwLjkwNDMsIDAuOTAzNTEsIDAuOTIxMDUsIDAuOTAzNTEsIDEuMTcxNCwgMC44NTMzNywgMC45NjkyNywgMC45NjkyNywgMC45OTkxMiwgMC45NjkyNywgMC45MjEwNSwgMC44MDU5NywgMS4yNDM0LCAxLjIwODA4LCAxLjA1OTM3LCAwLjkwOTU3LCAxLjE3MTQsIDEuMjA4MDgsIDAuNzUxNTUsIDAuOTQyNjEsIDEuMjQ2NDQsIDEuMDk5NzEsIDEuMDk5NzEsIDAuODQ3NTEsIDEsIDAuODUyNzMsIDAuNzgwMzIsIDAuNjE1ODQsIDEuMDU0MjUsIDEuMTc5MTQsIDAuOTA5NTcsIDEuMDg2NjUsIDEuMTE1OTMsIDEuMTQxNjksIDAuNzMzODEsIDAuOTY3MDYsIDAuOTY3MDYsIDAuOTY3MDYsIDAuOTY3MDYsIDAuOTY3MDYsIDAuOTY3MDYsIDAuODYwMzUsIDAuODU3MzQsIDAuNzU4NDIsIDAuNzU4NDIsIDAuNzU4NDIsIDAuNzU4NDIsIDAuOTU3ODIsIDAuOTU3ODIsIDAuOTU3ODIsIDAuOTU3ODIsIDAuOTcwOTMsIDEuMDM1ODQsIDAuOTY5MjQsIDAuOTY5MjQsIDAuOTY5MjQsIDAuOTY5MjQsIDAuOTY5MjQsIDEuMTcxNCwgMC45NjkyNCwgMC45NTEzMiwgMC45NTEzMiwgMC45NTEzMiwgMC45NTEzMiwgMC44Mjg3LCAwLjgzOTY4LCAwLjg5MDQ5LCAwLjkxNDg0LCAwLjkxNDg0LCAwLjkxNDg0LCAwLjkxNDg0LCAwLjkxNDg0LCAwLjkxNDg0LCAwLjkzNTc1LCAwLjkyMzgzLCAwLjk0MDMsIDAuOTQwMywgMC45NDAzLCAwLjk0MDMsIDAuODcxNywgMC44NzE3LCAwLjg3MTcsIDAuODcxNywgMS4wMDUyNywgMS4wMTc1NiwgMS4wNTM1NiwgMS4wNTM1NiwgMS4wNTM1NiwgMS4wNTM1NiwgMS4wNTM1NiwgMS4yNDY0NCwgMC45NTkyMywgMS4wMTc1NiwgMS4wMTc1NiwgMS4wMTc1NiwgMS4wMTc1NiwgMC45Njc3NywgMS4wNTcwNywgMC45Njc3NywgMC45NjcwNiwgMC45MTQ4NCwgMC45NjcwNiwgMC45MTQ4NCwgMC45NjcwNiwgMC45MTQ4NCwgMC44NTczNCwgMC45MjM4MywgMC44NTczNCwgMC45MjM4MywgMC44NTczNCwgMC45MjM4MywgMC44NTczNCwgMC45MjM4MywgMC45NzA5MywgMS4wOTY5LCAwLjk3MDkzLCAxLjA1ODgyLCAwLjc1ODQyLCAwLjk0MDMsIDAuNzU4NDIsIDAuOTQwMywgMC43NTg0MiwgMC45NDAzLCAwLjc1ODQyLCAwLjk0MDMsIDAuNzU4NDIsIDAuOTQwMywgMC44ODE5OCwgMS4wNTg4MiwgMC44ODE5OCwgMS4wNTg4MiwgMC44ODE5OCwgMS4wNTg4MiwgMSwgMSwgMC45ODMxLCAxLjAxNzU2LCAwLjk4MzEsIDEuMDE3NTYsIDAuOTU3ODIsIDAuODcxNywgMC45NTc4MiwgMC44NzE3LCAwLjk1NzgyLCAwLjg3MTcsIDAuOTU3ODIsIDEuMDkwMTEsIDAuOTU3ODIsIDAuODcxNywgMC44NDc4NCwgMS4xMTU1MSwgMC43MTM4NywgMS4wOTAxMSwgMSwgMSwgMC45OTQxNCwgMC44NDYzNiwgMS4wOTAxMSwgMSwgMSwgMC44NDYzNiwgMS4wNTM2LCAwLjg0NjM2LCAwLjk0Mjk4LCAwLjg0NjM2LCAxLjIzMjk3LCAxLjAzNTg0LCAxLjAxNzU2LCAxLCAxLCAxLjAzNTg0LCAxLjAxNzU2LCAxLjAwMzIzLCAxLjAzNDQ0LCAxLjAxNzU2LCAwLjk2OTI0LCAxLjA1MzU2LCAwLjk2OTI0LCAxLjA1MzU2LCAwLjk2OTI0LCAxLjA1MzU2LCAwLjkzMDY2LCAwLjk4MjkzLCAwLjgyODI2LCAxLjA0Mzk5LCAxLCAxLCAwLjgyODI2LCAxLjA0Mzk5LCAwLjc5NjQ5LCAwLjg0ODYzLCAwLjc5NjQ5LCAwLjg0ODYzLCAwLjc5NjQ5LCAwLjg0ODYzLCAwLjc5NjQ5LCAwLjg0ODYzLCAxLCAxLCAwLjg1NzcxLCAxLjE3MzE4LCAwLjg1NzcxLCAxLjIxOTY4LCAwLjk1MTMyLCAxLjAxNzU2LCAwLjk1MTMyLCAxLjAxNzU2LCAwLjk1MTMyLCAxLjAxNzU2LCAwLjk1MTMyLCAxLjAxNzU2LCAwLjk1MTMyLCAxLjAxNzU2LCAwLjk1MTMyLCAxLjAxNzU2LCAwLjk4OTY1LCAxLjAwMDY4LCAwLjgyODcsIDAuOTY3NzcsIDAuODI4NywgMC45MzM2NSwgMC45MDQzLCAwLjkzMzY1LCAwLjkwNDMsIDAuOTMzNjUsIDAuOTA0MywgMS4wODU3MSwgMC45NjkyNywgMC45NjcwNiwgMC45MTQ4NCwgMC44NjAzNSwgMC45MzU3NSwgMC45NjkyNCwgMC45NTkyMywgMSwgMSwgMC44NTc3MSwgMS4yMTk2OCwgMS4xMTQzNywgMS4xMTQzNywgMC45MzEwOSwgMC45MTIwMiwgMC42MDQxMSwgMC44NDE2NCwgMC41NTU3MiwgMS4wMTE3MywgMC45NzM2MSwgMC44MTgxOCwgMC44MTgxOCwgMC45NjYzNSwgMC43ODAzMiwgMC43MjcyNywgMC45MjM2NiwgMC45ODYwMSwgMS4wMzQwNSwgMC43Nzk2OCwgMS4wOTc5OSwgMS4yLCAwLjk2NzA2LCAwLjg1OTQ0LCAwLjg1NjM4LCAwLjk2NDkxLCAwLjc1ODQyLCAwLjkzMzY1LCAwLjk4MzEsIDAuOTY5MjQsIDAuOTU3ODIsIDAuODY5NjksIDAuOTQxNTIsIDEuMDc3OTYsIDEuMDM1ODQsIDAuNzg0MzcsIDAuOTY5MjQsIDAuOTg3MTUsIDAuODM5NjgsIDAuODM0OTEsIDAuODU3NzEsIDAuODI4NywgMC45NDQ5MiwgMC44ODQzMywgMC45Mjg3LCAxLjAwOTgsIDAuOTU3ODIsIDAuODI4NywgMS4wNjI1LCAwLjk4MjQ4LCAxLjAzNDI0LCAxLjIsIDEuMDEwNzEsIDEuMDYyNSwgMC45NTI0NiwgMS4wMzgwOSwgMS4wNDkxMiwgMC45ODI0OCwgMS4wMDIyMSwgMS4wMzQyNCwgMS4wNTQ0MywgMS4yLCAxLjA0Nzg1LCAwLjk5NjA5LCAxLjAwMTY5LCAxLjA1MTc2LCAwLjk5MzQ2LCAxLjA1MzU2LCAwLjkwODcsIDEuMDMwMDQsIDAuOTU1NDIsIDAuOTMxMTcsIDEuMjMzNjIsIDEuMDEwNzEsIDEuMDc4MzEsIDEuMDI1MTIsIDEuMDUyMDUsIDEuMDM1MDIsIDEuMiwgMS4wMTA3MSwgMS4wNTM1NiwgMS4wMTA3MSwgMS4wMzUwMiwgMC43NTg0MiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wMzcxOSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45NDAzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjA0MDIxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk4OTY1LCAxLjAwMDY4LCAwLjk4OTY1LCAxLjAwMDY4LCAwLjk4OTY1LCAxLjAwMDY4LCAwLjgyODcsIDAuOTY3NzcsIDEsIDEuMjAwODgsIDAuODk5MDMsIDEsIDEsIDAuNzUxNTUsIDEuMDMwNzcsIDEuMDMwNzcsIDEuMDMwNzcsIDEuMDMwNzcsIDEuMTMxOTYsIDEuMTMxOTYsIDEuMTMxOTYsIDAuNjc0MjgsIDAuNjc0MjgsIDEuMTYwMzksIDAuNzMyOTEsIDEuMjA5OTYsIDEuMjIxMzUsIDEuMDY0ODMsIDAuOTQ4NjgsIDAuOTQ4NjgsIDAuOTU5OTYsIDEuMjQ2MzMsIDEsIDEuMDc0OTcsIDAuODc3OTYsIDAuOTY5MjcsIDEuMDE1MTgsIDAuOTY5MjcsIDEsIDEsIDEsIDAuNzcyOTUsIDEsIDEsIDEuMTA1MzksIDEuMTA1MzksIDEuMTEzNTgsIDEuMDY5NjcsIDAuODYyNzksIDAuOTQ0MzQsIDAuODYyNzksIDAuOTQ0MzQsIDAuODYxODIsIDEsIDEsIDEuMDgzLCAxLCAwLjkxNTc4LCAwLjg2NTA3LCAxLjE3MTQsIDEuMTg0MTYsIDEuMTQ1ODksIDAuNjk4MjUsIDAuOTc2MjIsIDEuOTY5NywgMS4yNDgyMiwgMS4yNDgyMiwgMS4xNzIzOCwgMS4yNDgyMiwgMS4yNDgyMiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS40MjYwMywgMSwgMC45OTg2MiwgMC45OTg2MiwgMSwgMC44NzAyNSwgMC44NzAyNSwgMC44NzAyNSwgMC44NzAyNSwgMS4xODA4MywgMS40MjYwMywgMSwgMS40MjYwMywgMS40MjYwMywgMC45OTg2MiwgMSwgMSwgMSwgMSwgMSwgMS4yODg2LCAxLjA0MzE1LCAxLjE1Mjk2LCAxLjM0MTYzLCAxLCAxLCAxLCAxLjEwOTM4LCAxLjEwOTM4LCAxLCAxLCAxLCAxLjA1NDI1LCAxLjA5OTcxLCAxLjA5OTcxLCAxLjA5OTcxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKY29uc3QgU2Vnb2V1aVJlZ3VsYXJNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMzMwMDgsCiAgbGluZUdhcDogMAp9OwoKOy8vIC4vc3JjL2NvcmUveGZhX2ZvbnRzLmpzCgoKCgoKCgoKY29uc3QgZ2V0WEZBRm9udE1hcCA9IGdldExvb2t1cFRhYmxlRmFjdG9yeShmdW5jdGlvbiAodCkgewogIHRbIk15cmlhZFByby1SZWd1bGFyIl0gPSB0WyJQZGZKUy1GYWxsYmFjay1SZWd1bGFyIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtUmVndWxhciIsCiAgICBmYWN0b3JzOiBNeXJpYWRQcm9SZWd1bGFyRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zUmVndWxhcldpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJNYXBwaW5nLAogICAgbWV0cmljczogTXlyaWFkUHJvUmVndWxhck1ldHJpY3MKICB9OwogIHRbIk15cmlhZFByby1Cb2xkIl0gPSB0WyJQZGZKUy1GYWxsYmFjay1Cb2xkIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZCIsCiAgICBmYWN0b3JzOiBNeXJpYWRQcm9Cb2xkRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zQm9sZFdpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0JvbGRNYXBwaW5nLAogICAgbWV0cmljczogTXlyaWFkUHJvQm9sZE1ldHJpY3MKICB9OwogIHRbIk15cmlhZFByby1JdCJdID0gdFsiTXlyaWFkUHJvLUl0YWxpYyJdID0gdFsiUGRmSlMtRmFsbGJhY2stSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtSXRhbGljIiwKICAgIGZhY3RvcnM6IE15cmlhZFByb0l0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0l0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0l0YWxpY01hcHBpbmcsCiAgICBtZXRyaWNzOiBNeXJpYWRQcm9JdGFsaWNNZXRyaWNzCiAgfTsKICB0WyJNeXJpYWRQcm8tQm9sZEl0Il0gPSB0WyJNeXJpYWRQcm8tQm9sZEl0YWxpYyJdID0gdFsiUGRmSlMtRmFsbGJhY2stQm9sZEl0YWxpYyJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUJvbGRJdGFsaWMiLAogICAgZmFjdG9yczogTXlyaWFkUHJvQm9sZEl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNCb2xkSXRhbGljTWFwcGluZywKICAgIG1ldHJpY3M6IE15cmlhZFByb0JvbGRJdGFsaWNNZXRyaWNzCiAgfTsKICB0LkFyaWFsTVQgPSB0LkFyaWFsID0gdFsiQXJpYWwtUmVndWxhciJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLVJlZ3VsYXIiLAogICAgYmFzZVdpZHRoczogTGliZXJhdGlvblNhbnNSZWd1bGFyV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IExpYmVyYXRpb25TYW5zUmVndWxhck1hcHBpbmcKICB9OwogIHRbIkFyaWFsLUJvbGRNVCJdID0gdFsiQXJpYWwtQm9sZCJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUJvbGQiLAogICAgYmFzZVdpZHRoczogTGliZXJhdGlvblNhbnNCb2xkV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IExpYmVyYXRpb25TYW5zQm9sZE1hcHBpbmcKICB9OwogIHRbIkFyaWFsLUl0YWxpY01UIl0gPSB0WyJBcmlhbC1JdGFsaWMiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1JdGFsaWMiLAogICAgYmFzZVdpZHRoczogTGliZXJhdGlvblNhbnNJdGFsaWNXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogTGliZXJhdGlvblNhbnNJdGFsaWNNYXBwaW5nCiAgfTsKICB0WyJBcmlhbC1Cb2xkSXRhbGljTVQiXSA9IHRbIkFyaWFsLUJvbGRJdGFsaWMiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1Cb2xkSXRhbGljIiwKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zQm9sZEl0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNNYXBwaW5nCiAgfTsKICB0WyJDYWxpYnJpLVJlZ3VsYXIiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1SZWd1bGFyIiwKICAgIGZhY3RvcnM6IENhbGlicmlSZWd1bGFyRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zUmVndWxhcldpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJNYXBwaW5nLAogICAgbWV0cmljczogQ2FsaWJyaVJlZ3VsYXJNZXRyaWNzCiAgfTsKICB0WyJDYWxpYnJpLUJvbGQiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1Cb2xkIiwKICAgIGZhY3RvcnM6IENhbGlicmlCb2xkRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zQm9sZFdpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0JvbGRNYXBwaW5nLAogICAgbWV0cmljczogQ2FsaWJyaUJvbGRNZXRyaWNzCiAgfTsKICB0WyJDYWxpYnJpLUl0YWxpYyJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUl0YWxpYyIsCiAgICBmYWN0b3JzOiBDYWxpYnJpSXRhbGljRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zSXRhbGljV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IExpYmVyYXRpb25TYW5zSXRhbGljTWFwcGluZywKICAgIG1ldHJpY3M6IENhbGlicmlJdGFsaWNNZXRyaWNzCiAgfTsKICB0WyJDYWxpYnJpLUJvbGRJdGFsaWMiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1Cb2xkSXRhbGljIiwKICAgIGZhY3RvcnM6IENhbGlicmlCb2xkSXRhbGljRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zQm9sZEl0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNNYXBwaW5nLAogICAgbWV0cmljczogQ2FsaWJyaUJvbGRJdGFsaWNNZXRyaWNzCiAgfTsKICB0WyJTZWdvZXVpLVJlZ3VsYXIiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1SZWd1bGFyIiwKICAgIGZhY3RvcnM6IFNlZ29ldWlSZWd1bGFyRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zUmVndWxhcldpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJNYXBwaW5nLAogICAgbWV0cmljczogU2Vnb2V1aVJlZ3VsYXJNZXRyaWNzCiAgfTsKICB0WyJTZWdvZXVpLUJvbGQiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1Cb2xkIiwKICAgIGZhY3RvcnM6IFNlZ29ldWlCb2xkRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zQm9sZFdpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0JvbGRNYXBwaW5nLAogICAgbWV0cmljczogU2Vnb2V1aUJvbGRNZXRyaWNzCiAgfTsKICB0WyJTZWdvZXVpLUl0YWxpYyJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUl0YWxpYyIsCiAgICBmYWN0b3JzOiBTZWdvZXVpSXRhbGljRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zSXRhbGljV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IExpYmVyYXRpb25TYW5zSXRhbGljTWFwcGluZywKICAgIG1ldHJpY3M6IFNlZ29ldWlJdGFsaWNNZXRyaWNzCiAgfTsKICB0WyJTZWdvZXVpLUJvbGRJdGFsaWMiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1Cb2xkSXRhbGljIiwKICAgIGZhY3RvcnM6IFNlZ29ldWlCb2xkSXRhbGljRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zQm9sZEl0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNNYXBwaW5nLAogICAgbWV0cmljczogU2Vnb2V1aUJvbGRJdGFsaWNNZXRyaWNzCiAgfTsKICB0WyJIZWx2ZXRpY2EtUmVndWxhciJdID0gdC5IZWx2ZXRpY2EgPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtUmVndWxhciIsCiAgICBmYWN0b3JzOiBIZWx2ZXRpY2FSZWd1bGFyRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zUmVndWxhcldpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJNYXBwaW5nLAogICAgbWV0cmljczogSGVsdmV0aWNhUmVndWxhck1ldHJpY3MKICB9OwogIHRbIkhlbHZldGljYS1Cb2xkIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZCIsCiAgICBmYWN0b3JzOiBIZWx2ZXRpY2FCb2xkRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zQm9sZFdpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0JvbGRNYXBwaW5nLAogICAgbWV0cmljczogSGVsdmV0aWNhQm9sZE1ldHJpY3MKICB9OwogIHRbIkhlbHZldGljYS1JdGFsaWMiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1JdGFsaWMiLAogICAgZmFjdG9yczogSGVsdmV0aWNhSXRhbGljRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zSXRhbGljV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IExpYmVyYXRpb25TYW5zSXRhbGljTWFwcGluZywKICAgIG1ldHJpY3M6IEhlbHZldGljYUl0YWxpY01ldHJpY3MKICB9OwogIHRbIkhlbHZldGljYS1Cb2xkSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZEl0YWxpYyIsCiAgICBmYWN0b3JzOiBIZWx2ZXRpY2FCb2xkSXRhbGljRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IExpYmVyYXRpb25TYW5zQm9sZEl0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNNYXBwaW5nLAogICAgbWV0cmljczogSGVsdmV0aWNhQm9sZEl0YWxpY01ldHJpY3MKICB9Owp9KTsKZnVuY3Rpb24gZ2V0WGZhRm9udE5hbWUobmFtZSkgewogIGNvbnN0IGZvbnROYW1lID0gbm9ybWFsaXplRm9udE5hbWUobmFtZSk7CiAgY29uc3QgZm9udE1hcCA9IGdldFhGQUZvbnRNYXAoKTsKICByZXR1cm4gZm9udE1hcFtmb250TmFtZV07Cn0KZnVuY3Rpb24gZ2V0WGZhRm9udFdpZHRocyhuYW1lKSB7CiAgY29uc3QgaW5mbyA9IGdldFhmYUZvbnROYW1lKG5hbWUpOwogIGlmICghaW5mbykgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IHsKICAgIGJhc2VXaWR0aHMsCiAgICBiYXNlTWFwcGluZywKICAgIGZhY3RvcnMKICB9ID0gaW5mbzsKICBjb25zdCByZXNjYWxlZEJhc2VXaWR0aHMgPSAhZmFjdG9ycyA/IGJhc2VXaWR0aHMgOiBiYXNlV2lkdGhzLm1hcCgodywgaSkgPT4gdyAqIGZhY3RvcnNbaV0pOwogIGxldCBjdXJyZW50Q29kZSA9IC0yOwogIGxldCBjdXJyZW50QXJyYXk7CiAgY29uc3QgbmV3V2lkdGhzID0gW107CiAgZm9yIChjb25zdCBbdW5pY29kZSwgZ2x5cGhJbmRleF0gb2YgYmFzZU1hcHBpbmcubWFwKChjaGFyVW5pY29kZSwgaW5kZXgpID0+IFtjaGFyVW5pY29kZSwgaW5kZXhdKS5zb3J0KChbdW5pY29kZTFdLCBbdW5pY29kZTJdKSA9PiB1bmljb2RlMSAtIHVuaWNvZGUyKSkgewogICAgaWYgKHVuaWNvZGUgPT09IC0xKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKHVuaWNvZGUgPT09IGN1cnJlbnRDb2RlICsgMSkgewogICAgICBjdXJyZW50QXJyYXkucHVzaChyZXNjYWxlZEJhc2VXaWR0aHNbZ2x5cGhJbmRleF0pOwogICAgICBjdXJyZW50Q29kZSArPSAxOwogICAgfSBlbHNlIHsKICAgICAgY3VycmVudENvZGUgPSB1bmljb2RlOwogICAgICBjdXJyZW50QXJyYXkgPSBbcmVzY2FsZWRCYXNlV2lkdGhzW2dseXBoSW5kZXhdXTsKICAgICAgbmV3V2lkdGhzLnB1c2godW5pY29kZSwgY3VycmVudEFycmF5KTsKICAgIH0KICB9CiAgcmV0dXJuIG5ld1dpZHRoczsKfQpmdW5jdGlvbiBnZXRYZmFGb250RGljdChuYW1lKSB7CiAgY29uc3Qgd2lkdGhzID0gZ2V0WGZhRm9udFdpZHRocyhuYW1lKTsKICBjb25zdCBkaWN0ID0gbmV3IERpY3QobnVsbCk7CiAgZGljdC5zZXQoIkJhc2VGb250IiwgTmFtZS5nZXQobmFtZSkpOwogIGRpY3Quc2V0KCJUeXBlIiwgTmFtZS5nZXQoIkZvbnQiKSk7CiAgZGljdC5zZXQoIlN1YnR5cGUiLCBOYW1lLmdldCgiQ0lERm9udFR5cGUyIikpOwogIGRpY3Quc2V0KCJFbmNvZGluZyIsIE5hbWUuZ2V0KCJJZGVudGl0eS1IIikpOwogIGRpY3Quc2V0KCJDSURUb0dJRE1hcCIsIE5hbWUuZ2V0KCJJZGVudGl0eSIpKTsKICBkaWN0LnNldCgiVyIsIHdpZHRocyk7CiAgZGljdC5zZXQoIkZpcnN0Q2hhciIsIHdpZHRoc1swXSk7CiAgZGljdC5zZXQoIkxhc3RDaGFyIiwgd2lkdGhzLmF0KC0yKSArIHdpZHRocy5hdCgtMSkubGVuZ3RoIC0gMSk7CiAgY29uc3QgZGVzY3JpcHRvciA9IG5ldyBEaWN0KG51bGwpOwogIGRpY3Quc2V0KCJGb250RGVzY3JpcHRvciIsIGRlc2NyaXB0b3IpOwogIGNvbnN0IHN5c3RlbUluZm8gPSBuZXcgRGljdChudWxsKTsKICBzeXN0ZW1JbmZvLnNldCgiT3JkZXJpbmciLCAiSWRlbnRpdHkiKTsKICBzeXN0ZW1JbmZvLnNldCgiUmVnaXN0cnkiLCAiQWRvYmUiKTsKICBzeXN0ZW1JbmZvLnNldCgiU3VwcGxlbWVudCIsIDApOwogIGRpY3Quc2V0KCJDSURTeXN0ZW1JbmZvIiwgc3lzdGVtSW5mbyk7CiAgcmV0dXJuIGRpY3Q7Cn0KCjsvLyAuL3NyYy9jb3JlL3BzX3BhcnNlci5qcwoKCgpjbGFzcyBQb3N0U2NyaXB0UGFyc2VyIHsKICBjb25zdHJ1Y3RvcihsZXhlcikgewogICAgdGhpcy5sZXhlciA9IGxleGVyOwogICAgdGhpcy5vcGVyYXRvcnMgPSBbXTsKICAgIHRoaXMudG9rZW4gPSBudWxsOwogICAgdGhpcy5wcmV2ID0gbnVsbDsKICB9CiAgbmV4dFRva2VuKCkgewogICAgdGhpcy5wcmV2ID0gdGhpcy50b2tlbjsKICAgIHRoaXMudG9rZW4gPSB0aGlzLmxleGVyLmdldFRva2VuKCk7CiAgfQogIGFjY2VwdCh0eXBlKSB7CiAgICBpZiAodGhpcy50b2tlbi50eXBlID09PSB0eXBlKSB7CiAgICAgIHRoaXMubmV4dFRva2VuKCk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KICBleHBlY3QodHlwZSkgewogICAgaWYgKHRoaXMuYWNjZXB0KHR5cGUpKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbmV4cGVjdGVkIHN5bWJvbDogZm91bmQgJHt0aGlzLnRva2VuLnR5cGV9IGV4cGVjdGVkICR7dHlwZX0uYCk7CiAgfQogIHBhcnNlKCkgewogICAgdGhpcy5uZXh0VG9rZW4oKTsKICAgIHRoaXMuZXhwZWN0KFBvc3RTY3JpcHRUb2tlblR5cGVzLkxCUkFDRSk7CiAgICB0aGlzLnBhcnNlQmxvY2soKTsKICAgIHRoaXMuZXhwZWN0KFBvc3RTY3JpcHRUb2tlblR5cGVzLlJCUkFDRSk7CiAgICByZXR1cm4gdGhpcy5vcGVyYXRvcnM7CiAgfQogIHBhcnNlQmxvY2soKSB7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBpZiAodGhpcy5hY2NlcHQoUG9zdFNjcmlwdFRva2VuVHlwZXMuTlVNQkVSKSkgewogICAgICAgIHRoaXMub3BlcmF0b3JzLnB1c2godGhpcy5wcmV2LnZhbHVlKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmFjY2VwdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5PUEVSQVRPUikpIHsKICAgICAgICB0aGlzLm9wZXJhdG9ycy5wdXNoKHRoaXMucHJldi52YWx1ZSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5hY2NlcHQoUG9zdFNjcmlwdFRva2VuVHlwZXMuTEJSQUNFKSkgewogICAgICAgIHRoaXMucGFyc2VDb25kaXRpb24oKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KICB9CiAgcGFyc2VDb25kaXRpb24oKSB7CiAgICBjb25zdCBjb25kaXRpb25Mb2NhdGlvbiA9IHRoaXMub3BlcmF0b3JzLmxlbmd0aDsKICAgIHRoaXMub3BlcmF0b3JzLnB1c2gobnVsbCwgbnVsbCk7CiAgICB0aGlzLnBhcnNlQmxvY2soKTsKICAgIHRoaXMuZXhwZWN0KFBvc3RTY3JpcHRUb2tlblR5cGVzLlJCUkFDRSk7CiAgICBpZiAodGhpcy5hY2NlcHQoUG9zdFNjcmlwdFRva2VuVHlwZXMuSUYpKSB7CiAgICAgIHRoaXMub3BlcmF0b3JzW2NvbmRpdGlvbkxvY2F0aW9uXSA9IHRoaXMub3BlcmF0b3JzLmxlbmd0aDsKICAgICAgdGhpcy5vcGVyYXRvcnNbY29uZGl0aW9uTG9jYXRpb24gKyAxXSA9ICJqeiI7CiAgICB9IGVsc2UgaWYgKHRoaXMuYWNjZXB0KFBvc3RTY3JpcHRUb2tlblR5cGVzLkxCUkFDRSkpIHsKICAgICAgY29uc3QganVtcExvY2F0aW9uID0gdGhpcy5vcGVyYXRvcnMubGVuZ3RoOwogICAgICB0aGlzLm9wZXJhdG9ycy5wdXNoKG51bGwsIG51bGwpOwogICAgICBjb25zdCBlbmRPZlRydWUgPSB0aGlzLm9wZXJhdG9ycy5sZW5ndGg7CiAgICAgIHRoaXMucGFyc2VCbG9jaygpOwogICAgICB0aGlzLmV4cGVjdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5SQlJBQ0UpOwogICAgICB0aGlzLmV4cGVjdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5JRkVMU0UpOwogICAgICB0aGlzLm9wZXJhdG9yc1tqdW1wTG9jYXRpb25dID0gdGhpcy5vcGVyYXRvcnMubGVuZ3RoOwogICAgICB0aGlzLm9wZXJhdG9yc1tqdW1wTG9jYXRpb24gKyAxXSA9ICJqIjsKICAgICAgdGhpcy5vcGVyYXRvcnNbY29uZGl0aW9uTG9jYXRpb25dID0gZW5kT2ZUcnVlOwogICAgICB0aGlzLm9wZXJhdG9yc1tjb25kaXRpb25Mb2NhdGlvbiArIDFdID0gImp6IjsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiUFMgRnVuY3Rpb246IGVycm9yIHBhcnNpbmcgY29uZGl0aW9uYWwuIik7CiAgICB9CiAgfQp9CmNvbnN0IFBvc3RTY3JpcHRUb2tlblR5cGVzID0gewogIExCUkFDRTogMCwKICBSQlJBQ0U6IDEsCiAgTlVNQkVSOiAyLAogIE9QRVJBVE9SOiAzLAogIElGOiA0LAogIElGRUxTRTogNQp9OwpjbGFzcyBQb3N0U2NyaXB0VG9rZW4gewogIHN0YXRpYyBnZXQgb3BDYWNoZSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgIm9wQ2FjaGUiLCBPYmplY3QuY3JlYXRlKG51bGwpKTsKICB9CiAgY29uc3RydWN0b3IodHlwZSwgdmFsdWUpIHsKICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgfQogIHN0YXRpYyBnZXRPcGVyYXRvcihvcCkgewogICAgcmV0dXJuIFBvc3RTY3JpcHRUb2tlbi5vcENhY2hlW29wXSB8fD0gbmV3IFBvc3RTY3JpcHRUb2tlbihQb3N0U2NyaXB0VG9rZW5UeXBlcy5PUEVSQVRPUiwgb3ApOwogIH0KICBzdGF0aWMgZ2V0IExCUkFDRSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgIkxCUkFDRSIsIG5ldyBQb3N0U2NyaXB0VG9rZW4oUG9zdFNjcmlwdFRva2VuVHlwZXMuTEJSQUNFLCAieyIpKTsKICB9CiAgc3RhdGljIGdldCBSQlJBQ0UoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJSQlJBQ0UiLCBuZXcgUG9zdFNjcmlwdFRva2VuKFBvc3RTY3JpcHRUb2tlblR5cGVzLlJCUkFDRSwgIn0iKSk7CiAgfQogIHN0YXRpYyBnZXQgSUYoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJJRiIsIG5ldyBQb3N0U2NyaXB0VG9rZW4oUG9zdFNjcmlwdFRva2VuVHlwZXMuSUYsICJJRiIpKTsKICB9CiAgc3RhdGljIGdldCBJRkVMU0UoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJJRkVMU0UiLCBuZXcgUG9zdFNjcmlwdFRva2VuKFBvc3RTY3JpcHRUb2tlblR5cGVzLklGRUxTRSwgIklGRUxTRSIpKTsKICB9Cn0KY2xhc3MgUG9zdFNjcmlwdExleGVyIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0pIHsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy5uZXh0Q2hhcigpOwogICAgdGhpcy5zdHJCdWYgPSBbXTsKICB9CiAgbmV4dENoYXIoKSB7CiAgICByZXR1cm4gdGhpcy5jdXJyZW50Q2hhciA9IHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICB9CiAgZ2V0VG9rZW4oKSB7CiAgICBsZXQgY29tbWVudCA9IGZhbHNlOwogICAgbGV0IGNoID0gdGhpcy5jdXJyZW50Q2hhcjsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGlmIChjaCA8IDApIHsKICAgICAgICByZXR1cm4gRU9GOwogICAgICB9CiAgICAgIGlmIChjb21tZW50KSB7CiAgICAgICAgaWYgKGNoID09PSAweDBhIHx8IGNoID09PSAweDBkKSB7CiAgICAgICAgICBjb21tZW50ID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGNoID09PSAweDI1KSB7CiAgICAgICAgY29tbWVudCA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAoIWlzV2hpdGVTcGFjZShjaCkpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgIH0KICAgIHN3aXRjaCAoY2ggfCAwKSB7CiAgICAgIGNhc2UgMHgzMDoKICAgICAgY2FzZSAweDMxOgogICAgICBjYXNlIDB4MzI6CiAgICAgIGNhc2UgMHgzMzoKICAgICAgY2FzZSAweDM0OgogICAgICBjYXNlIDB4MzU6CiAgICAgIGNhc2UgMHgzNjoKICAgICAgY2FzZSAweDM3OgogICAgICBjYXNlIDB4Mzg6CiAgICAgIGNhc2UgMHgzOToKICAgICAgY2FzZSAweDJiOgogICAgICBjYXNlIDB4MmQ6CiAgICAgIGNhc2UgMHgyZToKICAgICAgICByZXR1cm4gbmV3IFBvc3RTY3JpcHRUb2tlbihQb3N0U2NyaXB0VG9rZW5UeXBlcy5OVU1CRVIsIHRoaXMuZ2V0TnVtYmVyKCkpOwogICAgICBjYXNlIDB4N2I6CiAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIHJldHVybiBQb3N0U2NyaXB0VG9rZW4uTEJSQUNFOwogICAgICBjYXNlIDB4N2Q6CiAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIHJldHVybiBQb3N0U2NyaXB0VG9rZW4uUkJSQUNFOwogICAgfQogICAgY29uc3Qgc3RyQnVmID0gdGhpcy5zdHJCdWY7CiAgICBzdHJCdWYubGVuZ3RoID0gMDsKICAgIHN0ckJ1ZlswXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgd2hpbGUgKChjaCA9IHRoaXMubmV4dENoYXIoKSkgPj0gMCAmJiAoY2ggPj0gMHg0MSAmJiBjaCA8PSAweDVhIHx8IGNoID49IDB4NjEgJiYgY2ggPD0gMHg3YSkpIHsKICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaCkpOwogICAgfQogICAgY29uc3Qgc3RyID0gc3RyQnVmLmpvaW4oIiIpOwogICAgc3dpdGNoIChzdHIudG9Mb3dlckNhc2UoKSkgewogICAgICBjYXNlICJpZiI6CiAgICAgICAgcmV0dXJuIFBvc3RTY3JpcHRUb2tlbi5JRjsKICAgICAgY2FzZSAiaWZlbHNlIjoKICAgICAgICByZXR1cm4gUG9zdFNjcmlwdFRva2VuLklGRUxTRTsKICAgICAgZGVmYXVsdDoKICAgICAgICByZXR1cm4gUG9zdFNjcmlwdFRva2VuLmdldE9wZXJhdG9yKHN0cik7CiAgICB9CiAgfQogIGdldE51bWJlcigpIHsKICAgIGxldCBjaCA9IHRoaXMuY3VycmVudENoYXI7CiAgICBjb25zdCBzdHJCdWYgPSB0aGlzLnN0ckJ1ZjsKICAgIHN0ckJ1Zi5sZW5ndGggPSAwOwogICAgc3RyQnVmWzBdID0gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7CiAgICB3aGlsZSAoKGNoID0gdGhpcy5uZXh0Q2hhcigpKSA+PSAwKSB7CiAgICAgIGlmIChjaCA+PSAweDMwICYmIGNoIDw9IDB4MzkgfHwgY2ggPT09IDB4MmQgfHwgY2ggPT09IDB4MmUpIHsKICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHZhbHVlID0gcGFyc2VGbG9hdChzdHJCdWYuam9pbigiIikpOwogICAgaWYgKGlzTmFOKHZhbHVlKSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgZmxvYXRpbmcgcG9pbnQgbnVtYmVyOiAke3ZhbHVlfWApOwogICAgfQogICAgcmV0dXJuIHZhbHVlOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvaW1hZ2VfdXRpbHMuanMKCgpjbGFzcyBCYXNlTG9jYWxDYWNoZSB7CiAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgdGhpcy5fb25seVJlZnMgPSBvcHRpb25zPy5vbmx5UmVmcyA9PT0gdHJ1ZTsKICAgIGlmICghdGhpcy5fb25seVJlZnMpIHsKICAgICAgdGhpcy5fbmFtZVJlZk1hcCA9IG5ldyBNYXAoKTsKICAgICAgdGhpcy5faW1hZ2VNYXAgPSBuZXcgTWFwKCk7CiAgICB9CiAgICB0aGlzLl9pbWFnZUNhY2hlID0gbmV3IFJlZlNldENhY2hlKCk7CiAgfQogIGdldEJ5TmFtZShuYW1lKSB7CiAgICBpZiAodGhpcy5fb25seVJlZnMpIHsKICAgICAgdW5yZWFjaGFibGUoIlNob3VsZCBub3QgY2FsbCBgZ2V0QnlOYW1lYCBtZXRob2QuIik7CiAgICB9CiAgICBjb25zdCByZWYgPSB0aGlzLl9uYW1lUmVmTWFwLmdldChuYW1lKTsKICAgIGlmIChyZWYpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0QnlSZWYocmVmKTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9pbWFnZU1hcC5nZXQobmFtZSkgfHwgbnVsbDsKICB9CiAgZ2V0QnlSZWYocmVmKSB7CiAgICByZXR1cm4gdGhpcy5faW1hZ2VDYWNoZS5nZXQocmVmKSB8fCBudWxsOwogIH0KICBzZXQobmFtZSwgcmVmLCBkYXRhKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBzZXRgIGNhbGxlZC4iKTsKICB9Cn0KY2xhc3MgTG9jYWxJbWFnZUNhY2hlIGV4dGVuZHMgQmFzZUxvY2FsQ2FjaGUgewogIHNldChuYW1lLCByZWYgPSBudWxsLCBkYXRhKSB7CiAgICBpZiAodHlwZW9mIG5hbWUgIT09ICJzdHJpbmciKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignTG9jYWxJbWFnZUNhY2hlLnNldCAtIGV4cGVjdGVkICJuYW1lIiBhcmd1bWVudC4nKTsKICAgIH0KICAgIGlmIChyZWYpIHsKICAgICAgaWYgKHRoaXMuX2ltYWdlQ2FjaGUuaGFzKHJlZikpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5fbmFtZVJlZk1hcC5zZXQobmFtZSwgcmVmKTsKICAgICAgdGhpcy5faW1hZ2VDYWNoZS5wdXQocmVmLCBkYXRhKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuX2ltYWdlTWFwLmhhcyhuYW1lKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9pbWFnZU1hcC5zZXQobmFtZSwgZGF0YSk7CiAgfQp9CmNsYXNzIExvY2FsQ29sb3JTcGFjZUNhY2hlIGV4dGVuZHMgQmFzZUxvY2FsQ2FjaGUgewogIHNldChuYW1lID0gbnVsbCwgcmVmID0gbnVsbCwgZGF0YSkgewogICAgaWYgKHR5cGVvZiBuYW1lICE9PSAic3RyaW5nIiAmJiAhcmVmKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignTG9jYWxDb2xvclNwYWNlQ2FjaGUuc2V0IC0gZXhwZWN0ZWQgIm5hbWUiIGFuZC9vciAicmVmIiBhcmd1bWVudC4nKTsKICAgIH0KICAgIGlmIChyZWYpIHsKICAgICAgaWYgKHRoaXMuX2ltYWdlQ2FjaGUuaGFzKHJlZikpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKG5hbWUgIT09IG51bGwpIHsKICAgICAgICB0aGlzLl9uYW1lUmVmTWFwLnNldChuYW1lLCByZWYpOwogICAgICB9CiAgICAgIHRoaXMuX2ltYWdlQ2FjaGUucHV0KHJlZiwgZGF0YSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9pbWFnZU1hcC5oYXMobmFtZSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5faW1hZ2VNYXAuc2V0KG5hbWUsIGRhdGEpOwogIH0KfQpjbGFzcyBMb2NhbEZ1bmN0aW9uQ2FjaGUgZXh0ZW5kcyBCYXNlTG9jYWxDYWNoZSB7CiAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgc3VwZXIoewogICAgICBvbmx5UmVmczogdHJ1ZQogICAgfSk7CiAgfQogIHNldChuYW1lID0gbnVsbCwgcmVmLCBkYXRhKSB7CiAgICBpZiAoIXJlZikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvY2FsRnVuY3Rpb25DYWNoZS5zZXQgLSBleHBlY3RlZCAicmVmIiBhcmd1bWVudC4nKTsKICAgIH0KICAgIGlmICh0aGlzLl9pbWFnZUNhY2hlLmhhcyhyZWYpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX2ltYWdlQ2FjaGUucHV0KHJlZiwgZGF0YSk7CiAgfQp9CmNsYXNzIExvY2FsR1N0YXRlQ2FjaGUgZXh0ZW5kcyBCYXNlTG9jYWxDYWNoZSB7CiAgc2V0KG5hbWUsIHJlZiA9IG51bGwsIGRhdGEpIHsKICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gInN0cmluZyIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdMb2NhbEdTdGF0ZUNhY2hlLnNldCAtIGV4cGVjdGVkICJuYW1lIiBhcmd1bWVudC4nKTsKICAgIH0KICAgIGlmIChyZWYpIHsKICAgICAgaWYgKHRoaXMuX2ltYWdlQ2FjaGUuaGFzKHJlZikpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5fbmFtZVJlZk1hcC5zZXQobmFtZSwgcmVmKTsKICAgICAgdGhpcy5faW1hZ2VDYWNoZS5wdXQocmVmLCBkYXRhKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuX2ltYWdlTWFwLmhhcyhuYW1lKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9pbWFnZU1hcC5zZXQobmFtZSwgZGF0YSk7CiAgfQp9CmNsYXNzIExvY2FsVGlsaW5nUGF0dGVybkNhY2hlIGV4dGVuZHMgQmFzZUxvY2FsQ2FjaGUgewogIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgIHN1cGVyKHsKICAgICAgb25seVJlZnM6IHRydWUKICAgIH0pOwogIH0KICBzZXQobmFtZSA9IG51bGwsIHJlZiwgZGF0YSkgewogICAgaWYgKCFyZWYpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdMb2NhbFRpbGluZ1BhdHRlcm5DYWNoZS5zZXQgLSBleHBlY3RlZCAicmVmIiBhcmd1bWVudC4nKTsKICAgIH0KICAgIGlmICh0aGlzLl9pbWFnZUNhY2hlLmhhcyhyZWYpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX2ltYWdlQ2FjaGUucHV0KHJlZiwgZGF0YSk7CiAgfQp9CmNsYXNzIFJlZ2lvbmFsSW1hZ2VDYWNoZSBleHRlbmRzIEJhc2VMb2NhbENhY2hlIHsKICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICBzdXBlcih7CiAgICAgIG9ubHlSZWZzOiB0cnVlCiAgICB9KTsKICB9CiAgc2V0KG5hbWUgPSBudWxsLCByZWYsIGRhdGEpIHsKICAgIGlmICghcmVmKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignUmVnaW9uYWxJbWFnZUNhY2hlLnNldCAtIGV4cGVjdGVkICJyZWYiIGFyZ3VtZW50LicpOwogICAgfQogICAgaWYgKHRoaXMuX2ltYWdlQ2FjaGUuaGFzKHJlZikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5faW1hZ2VDYWNoZS5wdXQocmVmLCBkYXRhKTsKICB9Cn0KY2xhc3MgR2xvYmFsQ29sb3JTcGFjZUNhY2hlIGV4dGVuZHMgQmFzZUxvY2FsQ2FjaGUgewogIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgIHN1cGVyKHsKICAgICAgb25seVJlZnM6IHRydWUKICAgIH0pOwogIH0KICBzZXQobmFtZSA9IG51bGwsIHJlZiwgZGF0YSkgewogICAgaWYgKCFyZWYpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdHbG9iYWxDb2xvclNwYWNlQ2FjaGUuc2V0IC0gZXhwZWN0ZWQgInJlZiIgYXJndW1lbnQuJyk7CiAgICB9CiAgICBpZiAodGhpcy5faW1hZ2VDYWNoZS5oYXMocmVmKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9pbWFnZUNhY2hlLnB1dChyZWYsIGRhdGEpOwogIH0KICBjbGVhcigpIHsKICAgIHRoaXMuX2ltYWdlQ2FjaGUuY2xlYXIoKTsKICB9Cn0KY2xhc3MgR2xvYmFsSW1hZ2VDYWNoZSB7CiAgc3RhdGljIE5VTV9QQUdFU19USFJFU0hPTEQgPSAyOwogIHN0YXRpYyBNSU5fSU1BR0VTX1RPX0NBQ0hFID0gMTA7CiAgc3RhdGljIE1BWF9CWVRFX1NJWkUgPSA1ZTc7CiAgI2RlY29kZUZhaWxlZFNldCA9IG5ldyBSZWZTZXQoKTsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMuX3JlZkNhY2hlID0gbmV3IFJlZlNldENhY2hlKCk7CiAgICB0aGlzLl9pbWFnZUNhY2hlID0gbmV3IFJlZlNldENhY2hlKCk7CiAgfQogIGdldCAjYnl0ZVNpemUoKSB7CiAgICBsZXQgYnl0ZVNpemUgPSAwOwogICAgZm9yIChjb25zdCBpbWFnZURhdGEgb2YgdGhpcy5faW1hZ2VDYWNoZSkgewogICAgICBieXRlU2l6ZSArPSBpbWFnZURhdGEuYnl0ZVNpemU7CiAgICB9CiAgICByZXR1cm4gYnl0ZVNpemU7CiAgfQogIGdldCAjY2FjaGVMaW1pdFJlYWNoZWQoKSB7CiAgICBpZiAodGhpcy5faW1hZ2VDYWNoZS5zaXplIDwgR2xvYmFsSW1hZ2VDYWNoZS5NSU5fSU1BR0VTX1RPX0NBQ0hFKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzLiNieXRlU2l6ZSA8IEdsb2JhbEltYWdlQ2FjaGUuTUFYX0JZVEVfU0laRSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgc2hvdWxkQ2FjaGUocmVmLCBwYWdlSW5kZXgpIHsKICAgIGxldCBwYWdlSW5kZXhTZXQgPSB0aGlzLl9yZWZDYWNoZS5nZXQocmVmKTsKICAgIGlmICghcGFnZUluZGV4U2V0KSB7CiAgICAgIHBhZ2VJbmRleFNldCA9IG5ldyBTZXQoKTsKICAgICAgdGhpcy5fcmVmQ2FjaGUucHV0KHJlZiwgcGFnZUluZGV4U2V0KTsKICAgIH0KICAgIHBhZ2VJbmRleFNldC5hZGQocGFnZUluZGV4KTsKICAgIGlmIChwYWdlSW5kZXhTZXQuc2l6ZSA8IEdsb2JhbEltYWdlQ2FjaGUuTlVNX1BBR0VTX1RIUkVTSE9MRCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoIXRoaXMuX2ltYWdlQ2FjaGUuaGFzKHJlZikgJiYgdGhpcy4jY2FjaGVMaW1pdFJlYWNoZWQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogIGFkZERlY29kZUZhaWxlZChyZWYpIHsKICAgIHRoaXMuI2RlY29kZUZhaWxlZFNldC5wdXQocmVmKTsKICB9CiAgaGFzRGVjb2RlRmFpbGVkKHJlZikgewogICAgcmV0dXJuIHRoaXMuI2RlY29kZUZhaWxlZFNldC5oYXMocmVmKTsKICB9CiAgYWRkQnl0ZVNpemUocmVmLCBieXRlU2l6ZSkgewogICAgY29uc3QgaW1hZ2VEYXRhID0gdGhpcy5faW1hZ2VDYWNoZS5nZXQocmVmKTsKICAgIGlmICghaW1hZ2VEYXRhKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChpbWFnZURhdGEuYnl0ZVNpemUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaW1hZ2VEYXRhLmJ5dGVTaXplID0gYnl0ZVNpemU7CiAgfQogIGdldERhdGEocmVmLCBwYWdlSW5kZXgpIHsKICAgIGNvbnN0IHBhZ2VJbmRleFNldCA9IHRoaXMuX3JlZkNhY2hlLmdldChyZWYpOwogICAgaWYgKCFwYWdlSW5kZXhTZXQpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpZiAocGFnZUluZGV4U2V0LnNpemUgPCBHbG9iYWxJbWFnZUNhY2hlLk5VTV9QQUdFU19USFJFU0hPTEQpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBpbWFnZURhdGEgPSB0aGlzLl9pbWFnZUNhY2hlLmdldChyZWYpOwogICAgaWYgKCFpbWFnZURhdGEpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBwYWdlSW5kZXhTZXQuYWRkKHBhZ2VJbmRleCk7CiAgICByZXR1cm4gaW1hZ2VEYXRhOwogIH0KICBzZXREYXRhKHJlZiwgZGF0YSkgewogICAgaWYgKCF0aGlzLl9yZWZDYWNoZS5oYXMocmVmKSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0dsb2JhbEltYWdlQ2FjaGUuc2V0RGF0YSAtIGV4cGVjdGVkICJzaG91bGRDYWNoZSIgdG8gaGF2ZSBiZWVuIGNhbGxlZC4nKTsKICAgIH0KICAgIGlmICh0aGlzLl9pbWFnZUNhY2hlLmhhcyhyZWYpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLiNjYWNoZUxpbWl0UmVhY2hlZCkgewogICAgICB3YXJuKCJHbG9iYWxJbWFnZUNhY2hlLnNldERhdGEgLSBjYWNoZSBsaW1pdCByZWFjaGVkLiIpOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9pbWFnZUNhY2hlLnB1dChyZWYsIGRhdGEpOwogIH0KICBjbGVhcihvbmx5RGF0YSA9IGZhbHNlKSB7CiAgICBpZiAoIW9ubHlEYXRhKSB7CiAgICAgIHRoaXMuI2RlY29kZUZhaWxlZFNldC5jbGVhcigpOwogICAgICB0aGlzLl9yZWZDYWNoZS5jbGVhcigpOwogICAgfQogICAgdGhpcy5faW1hZ2VDYWNoZS5jbGVhcigpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvZnVuY3Rpb24uanMKCgoKCgoKY2xhc3MgUERGRnVuY3Rpb25GYWN0b3J5IHsKICBjb25zdHJ1Y3Rvcih7CiAgICB4cmVmLAogICAgaXNFdmFsU3VwcG9ydGVkID0gdHJ1ZQogIH0pIHsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLmlzRXZhbFN1cHBvcnRlZCA9IGlzRXZhbFN1cHBvcnRlZCAhPT0gZmFsc2U7CiAgfQogIGNyZWF0ZShmbiwgcGFyc2VBcnJheSA9IGZhbHNlKSB7CiAgICBsZXQgZm5SZWYsIHBhcnNlZEZuOwogICAgaWYgKGZuIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgIGZuUmVmID0gZm47CiAgICB9IGVsc2UgaWYgKGZuIGluc3RhbmNlb2YgRGljdCkgewogICAgICBmblJlZiA9IGZuLm9iaklkOwogICAgfSBlbHNlIGlmIChmbiBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgZm5SZWYgPSBmbi5kaWN0Py5vYmpJZDsKICAgIH0KICAgIGlmIChmblJlZikgewogICAgICBjb25zdCBjYWNoZWRGbiA9IHRoaXMuX2xvY2FsRnVuY3Rpb25DYWNoZS5nZXRCeVJlZihmblJlZik7CiAgICAgIGlmIChjYWNoZWRGbikgewogICAgICAgIHJldHVybiBjYWNoZWRGbjsKICAgICAgfQogICAgfQogICAgY29uc3QgZm5PYmogPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihmbik7CiAgICBpZiAoQXJyYXkuaXNBcnJheShmbk9iaikpIHsKICAgICAgaWYgKCFwYXJzZUFycmF5KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQREZGdW5jdGlvbkZhY3RvcnkuY3JlYXRlIC0gZXhwZWN0ZWQgInBhcnNlQXJyYXkiIGFyZ3VtZW50LicpOwogICAgICB9CiAgICAgIHBhcnNlZEZuID0gUERGRnVuY3Rpb24ucGFyc2VBcnJheSh0aGlzLCBmbk9iaik7CiAgICB9IGVsc2UgewogICAgICBwYXJzZWRGbiA9IFBERkZ1bmN0aW9uLnBhcnNlKHRoaXMsIGZuT2JqKTsKICAgIH0KICAgIGlmIChmblJlZikgewogICAgICB0aGlzLl9sb2NhbEZ1bmN0aW9uQ2FjaGUuc2V0KG51bGwsIGZuUmVmLCBwYXJzZWRGbik7CiAgICB9CiAgICByZXR1cm4gcGFyc2VkRm47CiAgfQogIGdldCBfbG9jYWxGdW5jdGlvbkNhY2hlKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiX2xvY2FsRnVuY3Rpb25DYWNoZSIsIG5ldyBMb2NhbEZ1bmN0aW9uQ2FjaGUoKSk7CiAgfQp9CmZ1bmN0aW9uIHRvTnVtYmVyQXJyYXkoYXJyKSB7CiAgaWYgKCFBcnJheS5pc0FycmF5KGFycikpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBpZiAoIWlzTnVtYmVyQXJyYXkoYXJyLCBudWxsKSkgewogICAgcmV0dXJuIGFyci5tYXAoeCA9PiAreCk7CiAgfQogIHJldHVybiBhcnI7Cn0KY2xhc3MgUERGRnVuY3Rpb24gewogIHN0YXRpYyBnZXRTYW1wbGVBcnJheShzaXplLCBvdXRwdXRTaXplLCBicHMsIHN0cmVhbSkgewogICAgbGV0IGksIGlpOwogICAgbGV0IGxlbmd0aCA9IDE7CiAgICBmb3IgKGkgPSAwLCBpaSA9IHNpemUubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBsZW5ndGggKj0gc2l6ZVtpXTsKICAgIH0KICAgIGxlbmd0aCAqPSBvdXRwdXRTaXplOwogICAgY29uc3QgYXJyYXkgPSBuZXcgQXJyYXkobGVuZ3RoKTsKICAgIGxldCBjb2RlU2l6ZSA9IDA7CiAgICBsZXQgY29kZUJ1ZiA9IDA7CiAgICBjb25zdCBzYW1wbGVNdWwgPSAxLjAgLyAoMi4wICoqIGJwcyAtIDEpOwogICAgY29uc3Qgc3RyQnl0ZXMgPSBzdHJlYW0uZ2V0Qnl0ZXMoKGxlbmd0aCAqIGJwcyArIDcpIC8gOCk7CiAgICBsZXQgc3RySWR4ID0gMDsKICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB3aGlsZSAoY29kZVNpemUgPCBicHMpIHsKICAgICAgICBjb2RlQnVmIDw8PSA4OwogICAgICAgIGNvZGVCdWYgfD0gc3RyQnl0ZXNbc3RySWR4KytdOwogICAgICAgIGNvZGVTaXplICs9IDg7CiAgICAgIH0KICAgICAgY29kZVNpemUgLT0gYnBzOwogICAgICBhcnJheVtpXSA9IChjb2RlQnVmID4+IGNvZGVTaXplKSAqIHNhbXBsZU11bDsKICAgICAgY29kZUJ1ZiAmPSAoMSA8PCBjb2RlU2l6ZSkgLSAxOwogICAgfQogICAgcmV0dXJuIGFycmF5OwogIH0KICBzdGF0aWMgcGFyc2UoZmFjdG9yeSwgZm4pIHsKICAgIGNvbnN0IGRpY3QgPSBmbi5kaWN0IHx8IGZuOwogICAgY29uc3QgdHlwZU51bSA9IGRpY3QuZ2V0KCJGdW5jdGlvblR5cGUiKTsKICAgIHN3aXRjaCAodHlwZU51bSkgewogICAgICBjYXNlIDA6CiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0U2FtcGxlZChmYWN0b3J5LCBmbiwgZGljdCk7CiAgICAgIGNhc2UgMToKICAgICAgICBicmVhazsKICAgICAgY2FzZSAyOgogICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdEludGVycG9sYXRlZChmYWN0b3J5LCBkaWN0KTsKICAgICAgY2FzZSAzOgogICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdFN0aWNoZWQoZmFjdG9yeSwgZGljdCk7CiAgICAgIGNhc2UgNDoKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RQb3N0U2NyaXB0KGZhY3RvcnksIGZuLCBkaWN0KTsKICAgIH0KICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiVW5rbm93biB0eXBlIG9mIGZ1bmN0aW9uIik7CiAgfQogIHN0YXRpYyBwYXJzZUFycmF5KGZhY3RvcnksIGZuT2JqKSB7CiAgICBjb25zdCB7CiAgICAgIHhyZWYKICAgIH0gPSBmYWN0b3J5OwogICAgY29uc3QgZm5BcnJheSA9IFtdOwogICAgZm9yIChjb25zdCBmbiBvZiBmbk9iaikgewogICAgICBmbkFycmF5LnB1c2godGhpcy5wYXJzZShmYWN0b3J5LCB4cmVmLmZldGNoSWZSZWYoZm4pKSk7CiAgICB9CiAgICByZXR1cm4gZnVuY3Rpb24gKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGZuQXJyYXkubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGZuQXJyYXlbaV0oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQgKyBpKTsKICAgICAgfQogICAgfTsKICB9CiAgc3RhdGljIGNvbnN0cnVjdFNhbXBsZWQoZmFjdG9yeSwgZm4sIGRpY3QpIHsKICAgIGZ1bmN0aW9uIHRvTXVsdGlBcnJheShhcnIpIHsKICAgICAgY29uc3QgaW5wdXRMZW5ndGggPSBhcnIubGVuZ3RoOwogICAgICBjb25zdCBvdXQgPSBbXTsKICAgICAgbGV0IGluZGV4ID0gMDsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dExlbmd0aDsgaSArPSAyKSB7CiAgICAgICAgb3V0W2luZGV4KytdID0gW2FycltpXSwgYXJyW2kgKyAxXV07CiAgICAgIH0KICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIGZ1bmN0aW9uIGludGVycG9sYXRlKHgsIHhtaW4sIHhtYXgsIHltaW4sIHltYXgpIHsKICAgICAgcmV0dXJuIHltaW4gKyAoeCAtIHhtaW4pICogKCh5bWF4IC0geW1pbikgLyAoeG1heCAtIHhtaW4pKTsKICAgIH0KICAgIGxldCBkb21haW4gPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIkRvbWFpbiIpKTsKICAgIGxldCByYW5nZSA9IHRvTnVtYmVyQXJyYXkoZGljdC5nZXRBcnJheSgiUmFuZ2UiKSk7CiAgICBpZiAoIWRvbWFpbiB8fCAhcmFuZ2UpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJObyBkb21haW4gb3IgcmFuZ2UiKTsKICAgIH0KICAgIGNvbnN0IGlucHV0U2l6ZSA9IGRvbWFpbi5sZW5ndGggLyAyOwogICAgY29uc3Qgb3V0cHV0U2l6ZSA9IHJhbmdlLmxlbmd0aCAvIDI7CiAgICBkb21haW4gPSB0b011bHRpQXJyYXkoZG9tYWluKTsKICAgIHJhbmdlID0gdG9NdWx0aUFycmF5KHJhbmdlKTsKICAgIGNvbnN0IHNpemUgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIlNpemUiKSk7CiAgICBjb25zdCBicHMgPSBkaWN0LmdldCgiQml0c1BlclNhbXBsZSIpOwogICAgY29uc3Qgb3JkZXIgPSBkaWN0LmdldCgiT3JkZXIiKSB8fCAxOwogICAgaWYgKG9yZGVyICE9PSAxKSB7CiAgICAgIGluZm8oIk5vIHN1cHBvcnQgZm9yIGN1YmljIHNwbGluZSBpbnRlcnBvbGF0aW9uOiAiICsgb3JkZXIpOwogICAgfQogICAgbGV0IGVuY29kZSA9IHRvTnVtYmVyQXJyYXkoZGljdC5nZXRBcnJheSgiRW5jb2RlIikpOwogICAgaWYgKCFlbmNvZGUpIHsKICAgICAgZW5jb2RlID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXRTaXplOyArK2kpIHsKICAgICAgICBlbmNvZGUucHVzaChbMCwgc2l6ZVtpXSAtIDFdKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZW5jb2RlID0gdG9NdWx0aUFycmF5KGVuY29kZSk7CiAgICB9CiAgICBsZXQgZGVjb2RlID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJEZWNvZGUiKSk7CiAgICBkZWNvZGUgPSAhZGVjb2RlID8gcmFuZ2UgOiB0b011bHRpQXJyYXkoZGVjb2RlKTsKICAgIGNvbnN0IHNhbXBsZXMgPSB0aGlzLmdldFNhbXBsZUFycmF5KHNpemUsIG91dHB1dFNpemUsIGJwcywgZm4pOwogICAgcmV0dXJuIGZ1bmN0aW9uIGNvbnN0cnVjdFNhbXBsZWRGbihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICBjb25zdCBjdWJlVmVydGljZXMgPSAxIDw8IGlucHV0U2l6ZTsKICAgICAgY29uc3QgY3ViZU4gPSBuZXcgRmxvYXQ2NEFycmF5KGN1YmVWZXJ0aWNlcykuZmlsbCgxKTsKICAgICAgY29uc3QgY3ViZVZlcnRleCA9IG5ldyBVaW50MzJBcnJheShjdWJlVmVydGljZXMpOwogICAgICBsZXQgaSwgajsKICAgICAgbGV0IGsgPSBvdXRwdXRTaXplLAogICAgICAgIHBvcyA9IDE7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBpbnB1dFNpemU7ICsraSkgewogICAgICAgIGNvbnN0IGRvbWFpbl8yaSA9IGRvbWFpbltpXVswXTsKICAgICAgICBjb25zdCBkb21haW5fMmlfMSA9IGRvbWFpbltpXVsxXTsKICAgICAgICBjb25zdCB4aSA9IE1hdGhDbGFtcChzcmNbc3JjT2Zmc2V0ICsgaV0sIGRvbWFpbl8yaSwgZG9tYWluXzJpXzEpOwogICAgICAgIGxldCBlID0gaW50ZXJwb2xhdGUoeGksIGRvbWFpbl8yaSwgZG9tYWluXzJpXzEsIGVuY29kZVtpXVswXSwgZW5jb2RlW2ldWzFdKTsKICAgICAgICBjb25zdCBzaXplX2kgPSBzaXplW2ldOwogICAgICAgIGUgPSBNYXRoQ2xhbXAoZSwgMCwgc2l6ZV9pIC0gMSk7CiAgICAgICAgY29uc3QgZTAgPSBlIDwgc2l6ZV9pIC0gMSA/IE1hdGguZmxvb3IoZSkgOiBlIC0gMTsKICAgICAgICBjb25zdCBuMCA9IGUwICsgMSAtIGU7CiAgICAgICAgY29uc3QgbjEgPSBlIC0gZTA7CiAgICAgICAgY29uc3Qgb2Zmc2V0MCA9IGUwICogazsKICAgICAgICBjb25zdCBvZmZzZXQxID0gb2Zmc2V0MCArIGs7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IGN1YmVWZXJ0aWNlczsgaisrKSB7CiAgICAgICAgICBpZiAoaiAmIHBvcykgewogICAgICAgICAgICBjdWJlTltqXSAqPSBuMTsKICAgICAgICAgICAgY3ViZVZlcnRleFtqXSArPSBvZmZzZXQxOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3ViZU5bal0gKj0gbjA7CiAgICAgICAgICAgIGN1YmVWZXJ0ZXhbal0gKz0gb2Zmc2V0MDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgayAqPSBzaXplX2k7CiAgICAgICAgcG9zIDw8PSAxOwogICAgICB9CiAgICAgIGZvciAoaiA9IDA7IGogPCBvdXRwdXRTaXplOyArK2opIHsKICAgICAgICBsZXQgcmogPSAwOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjdWJlVmVydGljZXM7IGkrKykgewogICAgICAgICAgcmogKz0gc2FtcGxlc1tjdWJlVmVydGV4W2ldICsgal0gKiBjdWJlTltpXTsKICAgICAgICB9CiAgICAgICAgcmogPSBpbnRlcnBvbGF0ZShyaiwgMCwgMSwgZGVjb2RlW2pdWzBdLCBkZWNvZGVbal1bMV0pOwogICAgICAgIGRlc3RbZGVzdE9mZnNldCArIGpdID0gTWF0aENsYW1wKHJqLCByYW5nZVtqXVswXSwgcmFuZ2Vbal1bMV0pOwogICAgICB9CiAgICB9OwogIH0KICBzdGF0aWMgY29uc3RydWN0SW50ZXJwb2xhdGVkKGZhY3RvcnksIGRpY3QpIHsKICAgIGNvbnN0IGMwID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJDMCIpKSB8fCBbMF07CiAgICBjb25zdCBjMSA9IHRvTnVtYmVyQXJyYXkoZGljdC5nZXRBcnJheSgiQzEiKSkgfHwgWzFdOwogICAgY29uc3QgbiA9IGRpY3QuZ2V0KCJOIik7CiAgICBjb25zdCBkaWZmID0gW107CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjMC5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgIGRpZmYucHVzaChjMVtpXSAtIGMwW2ldKTsKICAgIH0KICAgIGNvbnN0IGxlbmd0aCA9IGRpZmYubGVuZ3RoOwogICAgcmV0dXJuIGZ1bmN0aW9uIGNvbnN0cnVjdEludGVycG9sYXRlZEZuKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICAgIGNvbnN0IHggPSBuID09PSAxID8gc3JjW3NyY09mZnNldF0gOiBzcmNbc3JjT2Zmc2V0XSAqKiBuOwogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGxlbmd0aDsgKytqKSB7CiAgICAgICAgZGVzdFtkZXN0T2Zmc2V0ICsgal0gPSBjMFtqXSArIHggKiBkaWZmW2pdOwogICAgICB9CiAgICB9OwogIH0KICBzdGF0aWMgY29uc3RydWN0U3RpY2hlZChmYWN0b3J5LCBkaWN0KSB7CiAgICBjb25zdCBkb21haW4gPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIkRvbWFpbiIpKTsKICAgIGlmICghZG9tYWluKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTm8gZG9tYWluIik7CiAgICB9CiAgICBjb25zdCBpbnB1dFNpemUgPSBkb21haW4ubGVuZ3RoIC8gMjsKICAgIGlmIChpbnB1dFNpemUgIT09IDEpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJCYWQgZG9tYWluIGZvciBzdGljaGVkIGZ1bmN0aW9uIik7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIHhyZWYKICAgIH0gPSBmYWN0b3J5OwogICAgY29uc3QgZm5zID0gW107CiAgICBmb3IgKGNvbnN0IGZuIG9mIGRpY3QuZ2V0KCJGdW5jdGlvbnMiKSkgewogICAgICBmbnMucHVzaCh0aGlzLnBhcnNlKGZhY3RvcnksIHhyZWYuZmV0Y2hJZlJlZihmbikpKTsKICAgIH0KICAgIGNvbnN0IGJvdW5kcyA9IHRvTnVtYmVyQXJyYXkoZGljdC5nZXRBcnJheSgiQm91bmRzIikpOwogICAgY29uc3QgZW5jb2RlID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJFbmNvZGUiKSk7CiAgICBjb25zdCB0bXBCdWYgPSBuZXcgRmxvYXQzMkFycmF5KDEpOwogICAgcmV0dXJuIGZ1bmN0aW9uIGNvbnN0cnVjdFN0aWNoZWRGbihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICBjb25zdCB2ID0gTWF0aENsYW1wKHNyY1tzcmNPZmZzZXRdLCBkb21haW5bMF0sIGRvbWFpblsxXSk7CiAgICAgIGNvbnN0IGxlbmd0aCA9IGJvdW5kcy5sZW5ndGg7CiAgICAgIGxldCBpOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgICAgICBpZiAodiA8IGJvdW5kc1tpXSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGxldCBkbWluID0gZG9tYWluWzBdOwogICAgICBpZiAoaSA+IDApIHsKICAgICAgICBkbWluID0gYm91bmRzW2kgLSAxXTsKICAgICAgfQogICAgICBsZXQgZG1heCA9IGRvbWFpblsxXTsKICAgICAgaWYgKGkgPCBib3VuZHMubGVuZ3RoKSB7CiAgICAgICAgZG1heCA9IGJvdW5kc1tpXTsKICAgICAgfQogICAgICBjb25zdCBybWluID0gZW5jb2RlWzIgKiBpXTsKICAgICAgY29uc3Qgcm1heCA9IGVuY29kZVsyICogaSArIDFdOwogICAgICB0bXBCdWZbMF0gPSBkbWluID09PSBkbWF4ID8gcm1pbiA6IHJtaW4gKyAodiAtIGRtaW4pICogKHJtYXggLSBybWluKSAvIChkbWF4IC0gZG1pbik7CiAgICAgIGZuc1tpXSh0bXBCdWYsIDAsIGRlc3QsIGRlc3RPZmZzZXQpOwogICAgfTsKICB9CiAgc3RhdGljIGNvbnN0cnVjdFBvc3RTY3JpcHQoZmFjdG9yeSwgZm4sIGRpY3QpIHsKICAgIGNvbnN0IGRvbWFpbiA9IHRvTnVtYmVyQXJyYXkoZGljdC5nZXRBcnJheSgiRG9tYWluIikpOwogICAgY29uc3QgcmFuZ2UgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIlJhbmdlIikpOwogICAgaWYgKCFkb21haW4pIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJObyBkb21haW4uIik7CiAgICB9CiAgICBpZiAoIXJhbmdlKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTm8gcmFuZ2UuIik7CiAgICB9CiAgICBjb25zdCBsZXhlciA9IG5ldyBQb3N0U2NyaXB0TGV4ZXIoZm4pOwogICAgY29uc3QgcGFyc2VyID0gbmV3IFBvc3RTY3JpcHRQYXJzZXIobGV4ZXIpOwogICAgY29uc3QgY29kZSA9IHBhcnNlci5wYXJzZSgpOwogICAgaWYgKGZhY3RvcnkuaXNFdmFsU3VwcG9ydGVkICYmIEZlYXR1cmVUZXN0LmlzRXZhbFN1cHBvcnRlZCkgewogICAgICBjb25zdCBjb21waWxlZCA9IG5ldyBQb3N0U2NyaXB0Q29tcGlsZXIoKS5jb21waWxlKGNvZGUsIGRvbWFpbiwgcmFuZ2UpOwogICAgICBpZiAoY29tcGlsZWQpIHsKICAgICAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKCJzcmMiLCAic3JjT2Zmc2V0IiwgImRlc3QiLCAiZGVzdE9mZnNldCIsIGNvbXBpbGVkKTsKICAgICAgfQogICAgfQogICAgaW5mbygiVW5hYmxlIHRvIGNvbXBpbGUgUFMgZnVuY3Rpb24iKTsKICAgIGNvbnN0IG51bU91dHB1dHMgPSByYW5nZS5sZW5ndGggPj4gMTsKICAgIGNvbnN0IG51bUlucHV0cyA9IGRvbWFpbi5sZW5ndGggPj4gMTsKICAgIGNvbnN0IGV2YWx1YXRvciA9IG5ldyBQb3N0U2NyaXB0RXZhbHVhdG9yKGNvZGUpOwogICAgY29uc3QgY2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgY29uc3QgTUFYX0NBQ0hFX1NJWkUgPSAyMDQ4ICogNDsKICAgIGxldCBjYWNoZV9hdmFpbGFibGUgPSBNQVhfQ0FDSEVfU0laRTsKICAgIGNvbnN0IHRtcEJ1ZiA9IG5ldyBGbG9hdDMyQXJyYXkobnVtSW5wdXRzKTsKICAgIHJldHVybiBmdW5jdGlvbiBjb25zdHJ1Y3RQb3N0U2NyaXB0Rm4oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgICAgbGV0IGksIHZhbHVlOwogICAgICBsZXQga2V5ID0gIiI7CiAgICAgIGNvbnN0IGlucHV0ID0gdG1wQnVmOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtSW5wdXRzOyBpKyspIHsKICAgICAgICB2YWx1ZSA9IHNyY1tzcmNPZmZzZXQgKyBpXTsKICAgICAgICBpbnB1dFtpXSA9IHZhbHVlOwogICAgICAgIGtleSArPSB2YWx1ZSArICJfIjsKICAgICAgfQogICAgICBjb25zdCBjYWNoZWRWYWx1ZSA9IGNhY2hlW2tleV07CiAgICAgIGlmIChjYWNoZWRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgZGVzdC5zZXQoY2FjaGVkVmFsdWUsIGRlc3RPZmZzZXQpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBvdXRwdXQgPSBuZXcgRmxvYXQzMkFycmF5KG51bU91dHB1dHMpOwogICAgICBjb25zdCBzdGFjayA9IGV2YWx1YXRvci5leGVjdXRlKGlucHV0KTsKICAgICAgY29uc3Qgc3RhY2tJbmRleCA9IHN0YWNrLmxlbmd0aCAtIG51bU91dHB1dHM7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1PdXRwdXRzOyBpKyspIHsKICAgICAgICB2YWx1ZSA9IHN0YWNrW3N0YWNrSW5kZXggKyBpXTsKICAgICAgICBsZXQgYm91bmQgPSByYW5nZVtpICogMl07CiAgICAgICAgaWYgKHZhbHVlIDwgYm91bmQpIHsKICAgICAgICAgIHZhbHVlID0gYm91bmQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJvdW5kID0gcmFuZ2VbaSAqIDIgKyAxXTsKICAgICAgICAgIGlmICh2YWx1ZSA+IGJvdW5kKSB7CiAgICAgICAgICAgIHZhbHVlID0gYm91bmQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG91dHB1dFtpXSA9IHZhbHVlOwogICAgICB9CiAgICAgIGlmIChjYWNoZV9hdmFpbGFibGUgPiAwKSB7CiAgICAgICAgY2FjaGVfYXZhaWxhYmxlLS07CiAgICAgICAgY2FjaGVba2V5XSA9IG91dHB1dDsKICAgICAgfQogICAgICBkZXN0LnNldChvdXRwdXQsIGRlc3RPZmZzZXQpOwogICAgfTsKICB9Cn0KZnVuY3Rpb24gaXNQREZGdW5jdGlvbih2KSB7CiAgbGV0IGZuRGljdDsKICBpZiAodiBpbnN0YW5jZW9mIERpY3QpIHsKICAgIGZuRGljdCA9IHY7CiAgfSBlbHNlIGlmICh2IGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgZm5EaWN0ID0gdi5kaWN0OwogIH0gZWxzZSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIHJldHVybiBmbkRpY3QuaGFzKCJGdW5jdGlvblR5cGUiKTsKfQpjbGFzcyBQb3N0U2NyaXB0U3RhY2sgewogIHN0YXRpYyBNQVhfU1RBQ0tfU0laRSA9IDEwMDsKICBjb25zdHJ1Y3Rvcihpbml0aWFsU3RhY2spIHsKICAgIHRoaXMuc3RhY2sgPSBpbml0aWFsU3RhY2sgPyBBcnJheS5mcm9tKGluaXRpYWxTdGFjaykgOiBbXTsKICB9CiAgcHVzaCh2YWx1ZSkgewogICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoID49IFBvc3RTY3JpcHRTdGFjay5NQVhfU1RBQ0tfU0laRSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlBvc3RTY3JpcHQgZnVuY3Rpb24gc3RhY2sgb3ZlcmZsb3cuIik7CiAgICB9CiAgICB0aGlzLnN0YWNrLnB1c2godmFsdWUpOwogIH0KICBwb3AoKSB7CiAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPD0gMCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlBvc3RTY3JpcHQgZnVuY3Rpb24gc3RhY2sgdW5kZXJmbG93LiIpOwogICAgfQogICAgcmV0dXJuIHRoaXMuc3RhY2sucG9wKCk7CiAgfQogIGNvcHkobikgewogICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoICsgbiA+PSBQb3N0U2NyaXB0U3RhY2suTUFYX1NUQUNLX1NJWkUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJQb3N0U2NyaXB0IGZ1bmN0aW9uIHN0YWNrIG92ZXJmbG93LiIpOwogICAgfQogICAgY29uc3Qgc3RhY2sgPSB0aGlzLnN0YWNrOwogICAgZm9yIChsZXQgaSA9IHN0YWNrLmxlbmd0aCAtIG4sIGogPSBuIC0gMTsgaiA+PSAwOyBqLS0sIGkrKykgewogICAgICBzdGFjay5wdXNoKHN0YWNrW2ldKTsKICAgIH0KICB9CiAgaW5kZXgobikgewogICAgdGhpcy5wdXNoKHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSBuIC0gMV0pOwogIH0KICByb2xsKG4sIHApIHsKICAgIGNvbnN0IHN0YWNrID0gdGhpcy5zdGFjazsKICAgIGNvbnN0IGwgPSBzdGFjay5sZW5ndGggLSBuOwogICAgY29uc3QgciA9IHN0YWNrLmxlbmd0aCAtIDE7CiAgICBjb25zdCBjID0gbCArIChwIC0gTWF0aC5mbG9vcihwIC8gbikgKiBuKTsKICAgIGZvciAobGV0IGkgPSBsLCBqID0gcjsgaSA8IGo7IGkrKywgai0tKSB7CiAgICAgIGNvbnN0IHQgPSBzdGFja1tpXTsKICAgICAgc3RhY2tbaV0gPSBzdGFja1tqXTsKICAgICAgc3RhY2tbal0gPSB0OwogICAgfQogICAgZm9yIChsZXQgaSA9IGwsIGogPSBjIC0gMTsgaSA8IGo7IGkrKywgai0tKSB7CiAgICAgIGNvbnN0IHQgPSBzdGFja1tpXTsKICAgICAgc3RhY2tbaV0gPSBzdGFja1tqXTsKICAgICAgc3RhY2tbal0gPSB0OwogICAgfQogICAgZm9yIChsZXQgaSA9IGMsIGogPSByOyBpIDwgajsgaSsrLCBqLS0pIHsKICAgICAgY29uc3QgdCA9IHN0YWNrW2ldOwogICAgICBzdGFja1tpXSA9IHN0YWNrW2pdOwogICAgICBzdGFja1tqXSA9IHQ7CiAgICB9CiAgfQp9CmNsYXNzIFBvc3RTY3JpcHRFdmFsdWF0b3IgewogIGNvbnN0cnVjdG9yKG9wZXJhdG9ycykgewogICAgdGhpcy5vcGVyYXRvcnMgPSBvcGVyYXRvcnM7CiAgfQogIGV4ZWN1dGUoaW5pdGlhbFN0YWNrKSB7CiAgICBjb25zdCBzdGFjayA9IG5ldyBQb3N0U2NyaXB0U3RhY2soaW5pdGlhbFN0YWNrKTsKICAgIGxldCBjb3VudGVyID0gMDsKICAgIGNvbnN0IG9wZXJhdG9ycyA9IHRoaXMub3BlcmF0b3JzOwogICAgY29uc3QgbGVuZ3RoID0gb3BlcmF0b3JzLmxlbmd0aDsKICAgIGxldCBvcGVyYXRvciwgYSwgYjsKICAgIHdoaWxlIChjb3VudGVyIDwgbGVuZ3RoKSB7CiAgICAgIG9wZXJhdG9yID0gb3BlcmF0b3JzW2NvdW50ZXIrK107CiAgICAgIGlmICh0eXBlb2Ygb3BlcmF0b3IgPT09ICJudW1iZXIiKSB7CiAgICAgICAgc3RhY2sucHVzaChvcGVyYXRvcik7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc3dpdGNoIChvcGVyYXRvcikgewogICAgICAgIGNhc2UgImp6IjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGlmICghYSkgewogICAgICAgICAgICBjb3VudGVyID0gYjsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImoiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgY291bnRlciA9IGE7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJhYnMiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChNYXRoLmFicyhhKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJhZGQiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChhICsgYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJhbmQiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgaWYgKHR5cGVvZiBhID09PSAiYm9vbGVhbiIgJiYgdHlwZW9mIGIgPT09ICJib29sZWFuIikgewogICAgICAgICAgICBzdGFjay5wdXNoKGEgJiYgYik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGFjay5wdXNoKGEgJiBiKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImF0YW4iOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IE1hdGguYXRhbjIoYSwgYikgLyBNYXRoLlBJICogMTgwOwogICAgICAgICAgaWYgKGEgPCAwKSB7CiAgICAgICAgICAgIGEgKz0gMzYwOwogICAgICAgICAgfQogICAgICAgICAgc3RhY2sucHVzaChhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImJpdHNoaWZ0IjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGlmIChhID4gMCkgewogICAgICAgICAgICBzdGFjay5wdXNoKGEgPDwgYik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGFjay5wdXNoKGEgPj4gYik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjZWlsaW5nIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5jZWlsKGEpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImNvcHkiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2suY29weShhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImNvcyI6CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKE1hdGguY29zKGEgJSAzNjAgLyAxODAgKiBNYXRoLlBJKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjdmkiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpIHwgMDsKICAgICAgICAgIHN0YWNrLnB1c2goYSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjdnIiOgogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZGl2IjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSAvIGIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZHVwIjoKICAgICAgICAgIHN0YWNrLmNvcHkoMSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJlcSI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgPT09IGIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZXhjaCI6CiAgICAgICAgICBzdGFjay5yb2xsKDIsIDEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZXhwIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSAqKiBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImZhbHNlIjoKICAgICAgICAgIHN0YWNrLnB1c2goZmFsc2UpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZmxvb3IiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChNYXRoLmZsb29yKGEpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImdlIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSA+PSBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImd0IjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSA+IGIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiaWRpdiI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgLyBiIHwgMCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJpbmRleCI6CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5pbmRleChhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImxlIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSA8PSBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImxuIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5sb2coYSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibG9nIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5sb2cxMChhKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJsdCI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgPCBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIm1vZCI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgJSBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIm11bCI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgKiBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIm5lIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSAhPT0gYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJuZWciOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaCgtYSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJub3QiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgaWYgKHR5cGVvZiBhID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgc3RhY2sucHVzaCghYSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGFjay5wdXNoKH5hKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIm9yIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGlmICh0eXBlb2YgYSA9PT0gImJvb2xlYW4iICYmIHR5cGVvZiBiID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhIHx8IGIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhIHwgYik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJwb3AiOgogICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJyb2xsIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnJvbGwoYSwgYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJyb3VuZCI6CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKE1hdGgucm91bmQoYSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAic2luIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5zaW4oYSAlIDM2MCAvIDE4MCAqIE1hdGguUEkpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInNxcnQiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChNYXRoLnNxcnQoYSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAic3ViIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSAtIGIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAidHJ1ZSI6CiAgICAgICAgICBzdGFjay5wdXNoKHRydWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAidHJ1bmNhdGUiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IGEgPCAwID8gTWF0aC5jZWlsKGEpIDogTWF0aC5mbG9vcihhKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJ4b3IiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgaWYgKHR5cGVvZiBhID09PSAiYm9vbGVhbiIgJiYgdHlwZW9mIGIgPT09ICJib29sZWFuIikgewogICAgICAgICAgICBzdGFjay5wdXNoKGEgIT09IGIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhIF4gYik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbmtub3duIG9wZXJhdG9yICR7b3BlcmF0b3J9YCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzdGFjay5zdGFjazsKICB9Cn0KY2xhc3MgQXN0Tm9kZSB7CiAgY29uc3RydWN0b3IodHlwZSkgewogICAgdGhpcy50eXBlID0gdHlwZTsKICB9CiAgdmlzaXQodmlzaXRvcikgewogICAgdW5yZWFjaGFibGUoImFic3RyYWN0IG1ldGhvZCIpOwogIH0KfQpjbGFzcyBBc3RBcmd1bWVudCBleHRlbmRzIEFzdE5vZGUgewogIGNvbnN0cnVjdG9yKGluZGV4LCBtaW4sIG1heCkgewogICAgc3VwZXIoImFyZ3MiKTsKICAgIHRoaXMuaW5kZXggPSBpbmRleDsKICAgIHRoaXMubWluID0gbWluOwogICAgdGhpcy5tYXggPSBtYXg7CiAgfQogIHZpc2l0KHZpc2l0b3IpIHsKICAgIHZpc2l0b3IudmlzaXRBcmd1bWVudCh0aGlzKTsKICB9Cn0KY2xhc3MgQXN0TGl0ZXJhbCBleHRlbmRzIEFzdE5vZGUgewogIGNvbnN0cnVjdG9yKG51bWJlcikgewogICAgc3VwZXIoImxpdGVyYWwiKTsKICAgIHRoaXMubnVtYmVyID0gbnVtYmVyOwogICAgdGhpcy5taW4gPSBudW1iZXI7CiAgICB0aGlzLm1heCA9IG51bWJlcjsKICB9CiAgdmlzaXQodmlzaXRvcikgewogICAgdmlzaXRvci52aXNpdExpdGVyYWwodGhpcyk7CiAgfQp9CmNsYXNzIEFzdEJpbmFyeU9wZXJhdGlvbiBleHRlbmRzIEFzdE5vZGUgewogIGNvbnN0cnVjdG9yKG9wLCBhcmcxLCBhcmcyLCBtaW4sIG1heCkgewogICAgc3VwZXIoImJpbmFyeSIpOwogICAgdGhpcy5vcCA9IG9wOwogICAgdGhpcy5hcmcxID0gYXJnMTsKICAgIHRoaXMuYXJnMiA9IGFyZzI7CiAgICB0aGlzLm1pbiA9IG1pbjsKICAgIHRoaXMubWF4ID0gbWF4OwogIH0KICB2aXNpdCh2aXNpdG9yKSB7CiAgICB2aXNpdG9yLnZpc2l0QmluYXJ5T3BlcmF0aW9uKHRoaXMpOwogIH0KfQpjbGFzcyBBc3RNaW4gZXh0ZW5kcyBBc3ROb2RlIHsKICBjb25zdHJ1Y3RvcihhcmcsIG1heCkgewogICAgc3VwZXIoIm1heCIpOwogICAgdGhpcy5hcmcgPSBhcmc7CiAgICB0aGlzLm1pbiA9IGFyZy5taW47CiAgICB0aGlzLm1heCA9IG1heDsKICB9CiAgdmlzaXQodmlzaXRvcikgewogICAgdmlzaXRvci52aXNpdE1pbih0aGlzKTsKICB9Cn0KY2xhc3MgQXN0VmFyaWFibGUgZXh0ZW5kcyBBc3ROb2RlIHsKICBjb25zdHJ1Y3RvcihpbmRleCwgbWluLCBtYXgpIHsKICAgIHN1cGVyKCJ2YXIiKTsKICAgIHRoaXMuaW5kZXggPSBpbmRleDsKICAgIHRoaXMubWluID0gbWluOwogICAgdGhpcy5tYXggPSBtYXg7CiAgfQogIHZpc2l0KHZpc2l0b3IpIHsKICAgIHZpc2l0b3IudmlzaXRWYXJpYWJsZSh0aGlzKTsKICB9Cn0KY2xhc3MgQXN0VmFyaWFibGVEZWZpbml0aW9uIGV4dGVuZHMgQXN0Tm9kZSB7CiAgY29uc3RydWN0b3IodmFyaWFibGUsIGFyZykgewogICAgc3VwZXIoImRlZmluaXRpb24iKTsKICAgIHRoaXMudmFyaWFibGUgPSB2YXJpYWJsZTsKICAgIHRoaXMuYXJnID0gYXJnOwogIH0KICB2aXNpdCh2aXNpdG9yKSB7CiAgICB2aXNpdG9yLnZpc2l0VmFyaWFibGVEZWZpbml0aW9uKHRoaXMpOwogIH0KfQpjbGFzcyBFeHByZXNzaW9uQnVpbGRlclZpc2l0b3IgewogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5wYXJ0cyA9IFtdOwogIH0KICB2aXNpdEFyZ3VtZW50KGFyZykgewogICAgdGhpcy5wYXJ0cy5wdXNoKCJNYXRoLm1heCgiLCBhcmcubWluLCAiLCBNYXRoLm1pbigiLCBhcmcubWF4LCAiLCBzcmNbc3JjT2Zmc2V0ICsgIiwgYXJnLmluZGV4LCAiXSkpIik7CiAgfQogIHZpc2l0VmFyaWFibGUodmFyaWFibGUpIHsKICAgIHRoaXMucGFydHMucHVzaCgidiIsIHZhcmlhYmxlLmluZGV4KTsKICB9CiAgdmlzaXRMaXRlcmFsKGxpdGVyYWwpIHsKICAgIHRoaXMucGFydHMucHVzaChsaXRlcmFsLm51bWJlcik7CiAgfQogIHZpc2l0QmluYXJ5T3BlcmF0aW9uKG9wZXJhdGlvbikgewogICAgdGhpcy5wYXJ0cy5wdXNoKCIoIik7CiAgICBvcGVyYXRpb24uYXJnMS52aXNpdCh0aGlzKTsKICAgIHRoaXMucGFydHMucHVzaCgiICIsIG9wZXJhdGlvbi5vcCwgIiAiKTsKICAgIG9wZXJhdGlvbi5hcmcyLnZpc2l0KHRoaXMpOwogICAgdGhpcy5wYXJ0cy5wdXNoKCIpIik7CiAgfQogIHZpc2l0VmFyaWFibGVEZWZpbml0aW9uKGRlZmluaXRpb24pIHsKICAgIHRoaXMucGFydHMucHVzaCgidmFyICIpOwogICAgZGVmaW5pdGlvbi52YXJpYWJsZS52aXNpdCh0aGlzKTsKICAgIHRoaXMucGFydHMucHVzaCgiID0gIik7CiAgICBkZWZpbml0aW9uLmFyZy52aXNpdCh0aGlzKTsKICAgIHRoaXMucGFydHMucHVzaCgiOyIpOwogIH0KICB2aXNpdE1pbihtYXgpIHsKICAgIHRoaXMucGFydHMucHVzaCgiTWF0aC5taW4oIik7CiAgICBtYXguYXJnLnZpc2l0KHRoaXMpOwogICAgdGhpcy5wYXJ0cy5wdXNoKCIsICIsIG1heC5tYXgsICIpIik7CiAgfQogIHRvU3RyaW5nKCkgewogICAgcmV0dXJuIHRoaXMucGFydHMuam9pbigiIik7CiAgfQp9CmZ1bmN0aW9uIGJ1aWxkQWRkT3BlcmF0aW9uKG51bTEsIG51bTIpIHsKICBpZiAobnVtMi50eXBlID09PSAibGl0ZXJhbCIgJiYgbnVtMi5udW1iZXIgPT09IDApIHsKICAgIHJldHVybiBudW0xOwogIH0KICBpZiAobnVtMS50eXBlID09PSAibGl0ZXJhbCIgJiYgbnVtMS5udW1iZXIgPT09IDApIHsKICAgIHJldHVybiBudW0yOwogIH0KICBpZiAobnVtMi50eXBlID09PSAibGl0ZXJhbCIgJiYgbnVtMS50eXBlID09PSAibGl0ZXJhbCIpIHsKICAgIHJldHVybiBuZXcgQXN0TGl0ZXJhbChudW0xLm51bWJlciArIG51bTIubnVtYmVyKTsKICB9CiAgcmV0dXJuIG5ldyBBc3RCaW5hcnlPcGVyYXRpb24oIisiLCBudW0xLCBudW0yLCBudW0xLm1pbiArIG51bTIubWluLCBudW0xLm1heCArIG51bTIubWF4KTsKfQpmdW5jdGlvbiBidWlsZE11bE9wZXJhdGlvbihudW0xLCBudW0yKSB7CiAgaWYgKG51bTIudHlwZSA9PT0gImxpdGVyYWwiKSB7CiAgICBpZiAobnVtMi5udW1iZXIgPT09IDApIHsKICAgICAgcmV0dXJuIG5ldyBBc3RMaXRlcmFsKDApOwogICAgfSBlbHNlIGlmIChudW0yLm51bWJlciA9PT0gMSkgewogICAgICByZXR1cm4gbnVtMTsKICAgIH0gZWxzZSBpZiAobnVtMS50eXBlID09PSAibGl0ZXJhbCIpIHsKICAgICAgcmV0dXJuIG5ldyBBc3RMaXRlcmFsKG51bTEubnVtYmVyICogbnVtMi5udW1iZXIpOwogICAgfQogIH0KICBpZiAobnVtMS50eXBlID09PSAibGl0ZXJhbCIpIHsKICAgIGlmIChudW0xLm51bWJlciA9PT0gMCkgewogICAgICByZXR1cm4gbmV3IEFzdExpdGVyYWwoMCk7CiAgICB9IGVsc2UgaWYgKG51bTEubnVtYmVyID09PSAxKSB7CiAgICAgIHJldHVybiBudW0yOwogICAgfQogIH0KICBjb25zdCBtaW4gPSBNYXRoLm1pbihudW0xLm1pbiAqIG51bTIubWluLCBudW0xLm1pbiAqIG51bTIubWF4LCBudW0xLm1heCAqIG51bTIubWluLCBudW0xLm1heCAqIG51bTIubWF4KTsKICBjb25zdCBtYXggPSBNYXRoLm1heChudW0xLm1pbiAqIG51bTIubWluLCBudW0xLm1pbiAqIG51bTIubWF4LCBudW0xLm1heCAqIG51bTIubWluLCBudW0xLm1heCAqIG51bTIubWF4KTsKICByZXR1cm4gbmV3IEFzdEJpbmFyeU9wZXJhdGlvbigiKiIsIG51bTEsIG51bTIsIG1pbiwgbWF4KTsKfQpmdW5jdGlvbiBidWlsZFN1Yk9wZXJhdGlvbihudW0xLCBudW0yKSB7CiAgaWYgKG51bTIudHlwZSA9PT0gImxpdGVyYWwiKSB7CiAgICBpZiAobnVtMi5udW1iZXIgPT09IDApIHsKICAgICAgcmV0dXJuIG51bTE7CiAgICB9IGVsc2UgaWYgKG51bTEudHlwZSA9PT0gImxpdGVyYWwiKSB7CiAgICAgIHJldHVybiBuZXcgQXN0TGl0ZXJhbChudW0xLm51bWJlciAtIG51bTIubnVtYmVyKTsKICAgIH0KICB9CiAgaWYgKG51bTIudHlwZSA9PT0gImJpbmFyeSIgJiYgbnVtMi5vcCA9PT0gIi0iICYmIG51bTEudHlwZSA9PT0gImxpdGVyYWwiICYmIG51bTEubnVtYmVyID09PSAxICYmIG51bTIuYXJnMS50eXBlID09PSAibGl0ZXJhbCIgJiYgbnVtMi5hcmcxLm51bWJlciA9PT0gMSkgewogICAgcmV0dXJuIG51bTIuYXJnMjsKICB9CiAgcmV0dXJuIG5ldyBBc3RCaW5hcnlPcGVyYXRpb24oIi0iLCBudW0xLCBudW0yLCBudW0xLm1pbiAtIG51bTIubWF4LCBudW0xLm1heCAtIG51bTIubWluKTsKfQpmdW5jdGlvbiBidWlsZE1pbk9wZXJhdGlvbihudW0xLCBtYXgpIHsKICBpZiAobnVtMS5taW4gPj0gbWF4KSB7CiAgICByZXR1cm4gbmV3IEFzdExpdGVyYWwobWF4KTsKICB9IGVsc2UgaWYgKG51bTEubWF4IDw9IG1heCkgewogICAgcmV0dXJuIG51bTE7CiAgfQogIHJldHVybiBuZXcgQXN0TWluKG51bTEsIG1heCk7Cn0KY2xhc3MgUG9zdFNjcmlwdENvbXBpbGVyIHsKICBjb21waWxlKGNvZGUsIGRvbWFpbiwgcmFuZ2UpIHsKICAgIGNvbnN0IHN0YWNrID0gW107CiAgICBjb25zdCBpbnN0cnVjdGlvbnMgPSBbXTsKICAgIGNvbnN0IGlucHV0U2l6ZSA9IGRvbWFpbi5sZW5ndGggPj4gMSwKICAgICAgb3V0cHV0U2l6ZSA9IHJhbmdlLmxlbmd0aCA+PiAxOwogICAgbGV0IGxhc3RSZWdpc3RlciA9IDA7CiAgICBsZXQgbiwgajsKICAgIGxldCBudW0xLCBudW0yLCBhc3QxLCBhc3QyLCB0bXBWYXIsIGl0ZW07CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlucHV0U2l6ZTsgaSsrKSB7CiAgICAgIHN0YWNrLnB1c2gobmV3IEFzdEFyZ3VtZW50KGksIGRvbWFpbltpICogMl0sIGRvbWFpbltpICogMiArIDFdKSk7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjb2RlLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgaXRlbSA9IGNvZGVbaV07CiAgICAgIGlmICh0eXBlb2YgaXRlbSA9PT0gIm51bWJlciIpIHsKICAgICAgICBzdGFjay5wdXNoKG5ldyBBc3RMaXRlcmFsKGl0ZW0pKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBzd2l0Y2ggKGl0ZW0pIHsKICAgICAgICBjYXNlICJhZGQiOgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBudW0yID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBudW0xID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGJ1aWxkQWRkT3BlcmF0aW9uKG51bTEsIG51bTIpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImN2ciI6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoIDwgMSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIm11bCI6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoIDwgMikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIG51bTIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIG51bTEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYnVpbGRNdWxPcGVyYXRpb24obnVtMSwgbnVtMikpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAic3ViIjoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgbnVtMiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgbnVtMSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChidWlsZFN1Yk9wZXJhdGlvbihudW0xLCBudW0yKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJleGNoIjoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgYXN0MSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYXN0MiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChhc3QxLCBhc3QyKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInBvcCI6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoIDwgMSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiaW5kZXgiOgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDEpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBudW0xID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBpZiAobnVtMS50eXBlICE9PSAibGl0ZXJhbCIpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBuID0gbnVtMS5udW1iZXI7CiAgICAgICAgICBpZiAobiA8IDAgfHwgIU51bWJlci5pc0ludGVnZXIobikgfHwgc3RhY2subGVuZ3RoIDwgbikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGFzdDEgPSBzdGFja1tzdGFjay5sZW5ndGggLSBuIC0gMV07CiAgICAgICAgICBpZiAoYXN0MS50eXBlID09PSAibGl0ZXJhbCIgfHwgYXN0MS50eXBlID09PSAidmFyIikgewogICAgICAgICAgICBzdGFjay5wdXNoKGFzdDEpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHRtcFZhciA9IG5ldyBBc3RWYXJpYWJsZShsYXN0UmVnaXN0ZXIrKywgYXN0MS5taW4sIGFzdDEubWF4KTsKICAgICAgICAgIHN0YWNrW3N0YWNrLmxlbmd0aCAtIG4gLSAxXSA9IHRtcFZhcjsKICAgICAgICAgIHN0YWNrLnB1c2godG1wVmFyKTsKICAgICAgICAgIGluc3RydWN0aW9ucy5wdXNoKG5ldyBBc3RWYXJpYWJsZURlZmluaXRpb24odG1wVmFyLCBhc3QxKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJkdXAiOgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDEpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodHlwZW9mIGNvZGVbaSArIDFdID09PSAibnVtYmVyIiAmJiBjb2RlW2kgKyAyXSA9PT0gImd0IiAmJiBjb2RlW2kgKyAzXSA9PT0gaSArIDcgJiYgY29kZVtpICsgNF0gPT09ICJqeiIgJiYgY29kZVtpICsgNV0gPT09ICJwb3AiICYmIGNvZGVbaSArIDZdID09PSBjb2RlW2kgKyAxXSkgewogICAgICAgICAgICBudW0xID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgIHN0YWNrLnB1c2goYnVpbGRNaW5PcGVyYXRpb24obnVtMSwgY29kZVtpICsgMV0pKTsKICAgICAgICAgICAgaSArPSA2OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGFzdDEgPSBzdGFjay5hdCgtMSk7CiAgICAgICAgICBpZiAoYXN0MS50eXBlID09PSAibGl0ZXJhbCIgfHwgYXN0MS50eXBlID09PSAidmFyIikgewogICAgICAgICAgICBzdGFjay5wdXNoKGFzdDEpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHRtcFZhciA9IG5ldyBBc3RWYXJpYWJsZShsYXN0UmVnaXN0ZXIrKywgYXN0MS5taW4sIGFzdDEubWF4KTsKICAgICAgICAgIHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdID0gdG1wVmFyOwogICAgICAgICAgc3RhY2sucHVzaCh0bXBWYXIpOwogICAgICAgICAgaW5zdHJ1Y3Rpb25zLnB1c2gobmV3IEFzdFZhcmlhYmxlRGVmaW5pdGlvbih0bXBWYXIsIGFzdDEpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInJvbGwiOgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBudW0yID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBudW0xID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBpZiAobnVtMi50eXBlICE9PSAibGl0ZXJhbCIgfHwgbnVtMS50eXBlICE9PSAibGl0ZXJhbCIpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBqID0gbnVtMi5udW1iZXI7CiAgICAgICAgICBuID0gbnVtMS5udW1iZXI7CiAgICAgICAgICBpZiAobiA8PSAwIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKG4pIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKGopIHx8IHN0YWNrLmxlbmd0aCA8IG4pIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBqID0gKGogJSBuICsgbikgJSBuOwogICAgICAgICAgaWYgKGogPT09IDApIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBzdGFjay5wdXNoKC4uLnN0YWNrLnNwbGljZShzdGFjay5sZW5ndGggLSBuLCBuIC0gaikpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9CiAgICBpZiAoc3RhY2subGVuZ3RoICE9PSBvdXRwdXRTaXplKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgcmVzdWx0ID0gW107CiAgICBmb3IgKGNvbnN0IGluc3RydWN0aW9uIG9mIGluc3RydWN0aW9ucykgewogICAgICBjb25zdCBzdGF0ZW1lbnRCdWlsZGVyID0gbmV3IEV4cHJlc3Npb25CdWlsZGVyVmlzaXRvcigpOwogICAgICBpbnN0cnVjdGlvbi52aXNpdChzdGF0ZW1lbnRCdWlsZGVyKTsKICAgICAgcmVzdWx0LnB1c2goc3RhdGVtZW50QnVpbGRlci50b1N0cmluZygpKTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHN0YWNrLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgZXhwciA9IHN0YWNrW2ldLAogICAgICAgIHN0YXRlbWVudEJ1aWxkZXIgPSBuZXcgRXhwcmVzc2lvbkJ1aWxkZXJWaXNpdG9yKCk7CiAgICAgIGV4cHIudmlzaXQoc3RhdGVtZW50QnVpbGRlcik7CiAgICAgIGNvbnN0IG1pbiA9IHJhbmdlW2kgKiAyXSwKICAgICAgICBtYXggPSByYW5nZVtpICogMiArIDFdOwogICAgICBjb25zdCBvdXQgPSBbc3RhdGVtZW50QnVpbGRlci50b1N0cmluZygpXTsKICAgICAgaWYgKG1pbiA+IGV4cHIubWluKSB7CiAgICAgICAgb3V0LnVuc2hpZnQoIk1hdGgubWF4KCIsIG1pbiwgIiwgIik7CiAgICAgICAgb3V0LnB1c2goIikiKTsKICAgICAgfQogICAgICBpZiAobWF4IDwgZXhwci5tYXgpIHsKICAgICAgICBvdXQudW5zaGlmdCgiTWF0aC5taW4oIiwgbWF4LCAiLCAiKTsKICAgICAgICBvdXQucHVzaCgiKSIpOwogICAgICB9CiAgICAgIG91dC51bnNoaWZ0KCJkZXN0W2Rlc3RPZmZzZXQgKyAiLCBpLCAiXSA9ICIpOwogICAgICBvdXQucHVzaCgiOyIpOwogICAgICByZXN1bHQucHVzaChvdXQuam9pbigiIikpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdC5qb2luKCJcbiIpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvYmlkaS5qcwoKY29uc3QgYmFzZVR5cGVzID0gWyJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJTIiwgIkIiLCAiUyIsICJXUyIsICJCIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkIiLCAiQiIsICJCIiwgIlMiLCAiV1MiLCAiT04iLCAiT04iLCAiRVQiLCAiRVQiLCAiRVQiLCAiT04iLCAiT04iLCAiT04iLCAiT04iLCAiT04iLCAiRVMiLCAiQ1MiLCAiRVMiLCAiQ1MiLCAiQ1MiLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiQ1MiLCAiT04iLCAiT04iLCAiT04iLCAiT04iLCAiT04iLCAiT04iLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkJOIiwgIkNTIiwgIk9OIiwgIkVUIiwgIkVUIiwgIkVUIiwgIkVUIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIkwiLCAiT04iLCAiT04iLCAiQk4iLCAiT04iLCAiT04iLCAiRVQiLCAiRVQiLCAiRU4iLCAiRU4iLCAiT04iLCAiTCIsICJPTiIsICJPTiIsICJPTiIsICJFTiIsICJMIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJPTiIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIk9OIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCJdOwpjb25zdCBhcmFiaWNUeXBlcyA9IFsiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiT04iLCAiT04iLCAiQUwiLCAiRVQiLCAiRVQiLCAiQUwiLCAiQ1MiLCAiQUwiLCAiT04iLCAiT04iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJBTCIsICJBTCIsICIiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiQU4iLCAiRVQiLCAiQU4iLCAiQU4iLCAiQUwiLCAiQUwiLCAiQUwiLCAiTlNNIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJBTiIsICJPTiIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJBTCIsICJBTCIsICJOU00iLCAiTlNNIiwgIk9OIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJBTCIsICJBTCIsICJFTiIsICJFTiIsICJFTiIsICJFTiIsICJFTiIsICJFTiIsICJFTiIsICJFTiIsICJFTiIsICJFTiIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCJdOwpmdW5jdGlvbiBpc09kZChpKSB7CiAgcmV0dXJuIChpICYgMSkgIT09IDA7Cn0KZnVuY3Rpb24gaXNFdmVuKGkpIHsKICByZXR1cm4gKGkgJiAxKSA9PT0gMDsKfQpmdW5jdGlvbiBmaW5kVW5lcXVhbChhcnIsIHN0YXJ0LCB2YWx1ZSkgewogIGxldCBqLCBqajsKICBmb3IgKGogPSBzdGFydCwgamogPSBhcnIubGVuZ3RoOyBqIDwgamo7ICsraikgewogICAgaWYgKGFycltqXSAhPT0gdmFsdWUpIHsKICAgICAgcmV0dXJuIGo7CiAgICB9CiAgfQogIHJldHVybiBqOwp9CmZ1bmN0aW9uIHJldmVyc2VWYWx1ZXMoYXJyLCBzdGFydCwgZW5kKSB7CiAgZm9yIChsZXQgaSA9IHN0YXJ0LCBqID0gZW5kIC0gMTsgaSA8IGo7ICsraSwgLS1qKSB7CiAgICBjb25zdCB0ZW1wID0gYXJyW2ldOwogICAgYXJyW2ldID0gYXJyW2pdOwogICAgYXJyW2pdID0gdGVtcDsKICB9Cn0KZnVuY3Rpb24gY3JlYXRlQmlkaVRleHQoc3RyLCBpc0xUUiwgdmVydGljYWwgPSBmYWxzZSkgewogIGxldCBkaXIgPSAibHRyIjsKICBpZiAodmVydGljYWwpIHsKICAgIGRpciA9ICJ0dGIiOwogIH0gZWxzZSBpZiAoIWlzTFRSKSB7CiAgICBkaXIgPSAicnRsIjsKICB9CiAgcmV0dXJuIHsKICAgIHN0ciwKICAgIGRpcgogIH07Cn0KY29uc3QgY2hhcnMgPSBbXTsKY29uc3QgdHlwZXMgPSBbXTsKZnVuY3Rpb24gYmlkaShzdHIsIHN0YXJ0TGV2ZWwgPSAtMSwgdmVydGljYWwgPSBmYWxzZSkgewogIGxldCBpc0xUUiA9IHRydWU7CiAgY29uc3Qgc3RyTGVuZ3RoID0gc3RyLmxlbmd0aDsKICBpZiAoc3RyTGVuZ3RoID09PSAwIHx8IHZlcnRpY2FsKSB7CiAgICByZXR1cm4gY3JlYXRlQmlkaVRleHQoc3RyLCBpc0xUUiwgdmVydGljYWwpOwogIH0KICBjaGFycy5sZW5ndGggPSBzdHJMZW5ndGg7CiAgdHlwZXMubGVuZ3RoID0gc3RyTGVuZ3RoOwogIGxldCBudW1CaWRpID0gMDsKICBsZXQgaSwgaWk7CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICBjaGFyc1tpXSA9IHN0ci5jaGFyQXQoaSk7CiAgICBjb25zdCBjaGFyQ29kZSA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgbGV0IGNoYXJUeXBlID0gIkwiOwogICAgaWYgKGNoYXJDb2RlIDw9IDB4MDBmZikgewogICAgICBjaGFyVHlwZSA9IGJhc2VUeXBlc1tjaGFyQ29kZV07CiAgICB9IGVsc2UgaWYgKDB4MDU5MCA8PSBjaGFyQ29kZSAmJiBjaGFyQ29kZSA8PSAweDA1ZjQpIHsKICAgICAgY2hhclR5cGUgPSAiUiI7CiAgICB9IGVsc2UgaWYgKDB4MDYwMCA8PSBjaGFyQ29kZSAmJiBjaGFyQ29kZSA8PSAweDA2ZmYpIHsKICAgICAgY2hhclR5cGUgPSBhcmFiaWNUeXBlc1tjaGFyQ29kZSAmIDB4ZmZdOwogICAgICBpZiAoIWNoYXJUeXBlKSB7CiAgICAgICAgd2FybigiQmlkaTogaW52YWxpZCBVbmljb2RlIGNoYXJhY3RlciAiICsgY2hhckNvZGUudG9TdHJpbmcoMTYpKTsKICAgICAgfQogICAgfSBlbHNlIGlmICgweDA3MDAgPD0gY2hhckNvZGUgJiYgY2hhckNvZGUgPD0gMHgwOGFjIHx8IDB4ZmI1MCA8PSBjaGFyQ29kZSAmJiBjaGFyQ29kZSA8PSAweGZkZmYgfHwgMHhmZTcwIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDw9IDB4ZmVmZikgewogICAgICBjaGFyVHlwZSA9ICJBTCI7CiAgICB9CiAgICBpZiAoY2hhclR5cGUgPT09ICJSIiB8fCBjaGFyVHlwZSA9PT0gIkFMIiB8fCBjaGFyVHlwZSA9PT0gIkFOIikgewogICAgICBudW1CaWRpKys7CiAgICB9CiAgICB0eXBlc1tpXSA9IGNoYXJUeXBlOwogIH0KICBpZiAobnVtQmlkaSA9PT0gMCkgewogICAgaXNMVFIgPSB0cnVlOwogICAgcmV0dXJuIGNyZWF0ZUJpZGlUZXh0KHN0ciwgaXNMVFIpOwogIH0KICBpZiAoc3RhcnRMZXZlbCA9PT0gLTEpIHsKICAgIGlmIChudW1CaWRpIC8gc3RyTGVuZ3RoIDwgMC4zICYmIHN0ckxlbmd0aCA+IDQpIHsKICAgICAgaXNMVFIgPSB0cnVlOwogICAgICBzdGFydExldmVsID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGlzTFRSID0gZmFsc2U7CiAgICAgIHN0YXJ0TGV2ZWwgPSAxOwogICAgfQogIH0KICBjb25zdCBsZXZlbHMgPSBbXTsKICBmb3IgKGkgPSAwOyBpIDwgc3RyTGVuZ3RoOyArK2kpIHsKICAgIGxldmVsc1tpXSA9IHN0YXJ0TGV2ZWw7CiAgfQogIGNvbnN0IGUgPSBpc09kZChzdGFydExldmVsKSA/ICJSIiA6ICJMIjsKICBjb25zdCBzb3IgPSBlOwogIGNvbnN0IGVvciA9IHNvcjsKICBsZXQgbGFzdFR5cGUgPSBzb3I7CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICBpZiAodHlwZXNbaV0gPT09ICJOU00iKSB7CiAgICAgIHR5cGVzW2ldID0gbGFzdFR5cGU7CiAgICB9IGVsc2UgewogICAgICBsYXN0VHlwZSA9IHR5cGVzW2ldOwogICAgfQogIH0KICBsYXN0VHlwZSA9IHNvcjsKICBsZXQgdDsKICBmb3IgKGkgPSAwOyBpIDwgc3RyTGVuZ3RoOyArK2kpIHsKICAgIHQgPSB0eXBlc1tpXTsKICAgIGlmICh0ID09PSAiRU4iKSB7CiAgICAgIHR5cGVzW2ldID0gbGFzdFR5cGUgPT09ICJBTCIgPyAiQU4iIDogIkVOIjsKICAgIH0gZWxzZSBpZiAodCA9PT0gIlIiIHx8IHQgPT09ICJMIiB8fCB0ID09PSAiQUwiKSB7CiAgICAgIGxhc3RUeXBlID0gdDsKICAgIH0KICB9CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICB0ID0gdHlwZXNbaV07CiAgICBpZiAodCA9PT0gIkFMIikgewogICAgICB0eXBlc1tpXSA9ICJSIjsKICAgIH0KICB9CiAgZm9yIChpID0gMTsgaSA8IHN0ckxlbmd0aCAtIDE7ICsraSkgewogICAgaWYgKHR5cGVzW2ldID09PSAiRVMiICYmIHR5cGVzW2kgLSAxXSA9PT0gIkVOIiAmJiB0eXBlc1tpICsgMV0gPT09ICJFTiIpIHsKICAgICAgdHlwZXNbaV0gPSAiRU4iOwogICAgfQogICAgaWYgKHR5cGVzW2ldID09PSAiQ1MiICYmICh0eXBlc1tpIC0gMV0gPT09ICJFTiIgfHwgdHlwZXNbaSAtIDFdID09PSAiQU4iKSAmJiB0eXBlc1tpICsgMV0gPT09IHR5cGVzW2kgLSAxXSkgewogICAgICB0eXBlc1tpXSA9IHR5cGVzW2kgLSAxXTsKICAgIH0KICB9CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICBpZiAodHlwZXNbaV0gPT09ICJFTiIpIHsKICAgICAgZm9yIChsZXQgaiA9IGkgLSAxOyBqID49IDA7IC0taikgewogICAgICAgIGlmICh0eXBlc1tqXSAhPT0gIkVUIikgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHR5cGVzW2pdID0gIkVOIjsKICAgICAgfQogICAgICBmb3IgKGxldCBqID0gaSArIDE7IGogPCBzdHJMZW5ndGg7ICsraikgewogICAgICAgIGlmICh0eXBlc1tqXSAhPT0gIkVUIikgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHR5cGVzW2pdID0gIkVOIjsKICAgICAgfQogICAgfQogIH0KICBmb3IgKGkgPSAwOyBpIDwgc3RyTGVuZ3RoOyArK2kpIHsKICAgIHQgPSB0eXBlc1tpXTsKICAgIGlmICh0ID09PSAiV1MiIHx8IHQgPT09ICJFUyIgfHwgdCA9PT0gIkVUIiB8fCB0ID09PSAiQ1MiKSB7CiAgICAgIHR5cGVzW2ldID0gIk9OIjsKICAgIH0KICB9CiAgbGFzdFR5cGUgPSBzb3I7CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICB0ID0gdHlwZXNbaV07CiAgICBpZiAodCA9PT0gIkVOIikgewogICAgICB0eXBlc1tpXSA9IGxhc3RUeXBlID09PSAiTCIgPyAiTCIgOiAiRU4iOwogICAgfSBlbHNlIGlmICh0ID09PSAiUiIgfHwgdCA9PT0gIkwiKSB7CiAgICAgIGxhc3RUeXBlID0gdDsKICAgIH0KICB9CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICBpZiAodHlwZXNbaV0gPT09ICJPTiIpIHsKICAgICAgY29uc3QgZW5kID0gZmluZFVuZXF1YWwodHlwZXMsIGkgKyAxLCAiT04iKTsKICAgICAgbGV0IGJlZm9yZSA9IHNvcjsKICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgYmVmb3JlID0gdHlwZXNbaSAtIDFdOwogICAgICB9CiAgICAgIGxldCBhZnRlciA9IGVvcjsKICAgICAgaWYgKGVuZCArIDEgPCBzdHJMZW5ndGgpIHsKICAgICAgICBhZnRlciA9IHR5cGVzW2VuZCArIDFdOwogICAgICB9CiAgICAgIGlmIChiZWZvcmUgIT09ICJMIikgewogICAgICAgIGJlZm9yZSA9ICJSIjsKICAgICAgfQogICAgICBpZiAoYWZ0ZXIgIT09ICJMIikgewogICAgICAgIGFmdGVyID0gIlIiOwogICAgICB9CiAgICAgIGlmIChiZWZvcmUgPT09IGFmdGVyKSB7CiAgICAgICAgdHlwZXMuZmlsbChiZWZvcmUsIGksIGVuZCk7CiAgICAgIH0KICAgICAgaSA9IGVuZCAtIDE7CiAgICB9CiAgfQogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgaWYgKHR5cGVzW2ldID09PSAiT04iKSB7CiAgICAgIHR5cGVzW2ldID0gZTsKICAgIH0KICB9CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICB0ID0gdHlwZXNbaV07CiAgICBpZiAoaXNFdmVuKGxldmVsc1tpXSkpIHsKICAgICAgaWYgKHQgPT09ICJSIikgewogICAgICAgIGxldmVsc1tpXSArPSAxOwogICAgICB9IGVsc2UgaWYgKHQgPT09ICJBTiIgfHwgdCA9PT0gIkVOIikgewogICAgICAgIGxldmVsc1tpXSArPSAyOwogICAgICB9CiAgICB9IGVsc2UgaWYgKHQgPT09ICJMIiB8fCB0ID09PSAiQU4iIHx8IHQgPT09ICJFTiIpIHsKICAgICAgbGV2ZWxzW2ldICs9IDE7CiAgICB9CiAgfQogIGxldCBoaWdoZXN0TGV2ZWwgPSAtMTsKICBsZXQgbG93ZXN0T2RkTGV2ZWwgPSA5OTsKICBsZXQgbGV2ZWw7CiAgZm9yIChpID0gMCwgaWkgPSBsZXZlbHMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgbGV2ZWwgPSBsZXZlbHNbaV07CiAgICBpZiAoaGlnaGVzdExldmVsIDwgbGV2ZWwpIHsKICAgICAgaGlnaGVzdExldmVsID0gbGV2ZWw7CiAgICB9CiAgICBpZiAobG93ZXN0T2RkTGV2ZWwgPiBsZXZlbCAmJiBpc09kZChsZXZlbCkpIHsKICAgICAgbG93ZXN0T2RkTGV2ZWwgPSBsZXZlbDsKICAgIH0KICB9CiAgZm9yIChsZXZlbCA9IGhpZ2hlc3RMZXZlbDsgbGV2ZWwgPj0gbG93ZXN0T2RkTGV2ZWw7IC0tbGV2ZWwpIHsKICAgIGxldCBzdGFydCA9IC0xOwogICAgZm9yIChpID0gMCwgaWkgPSBsZXZlbHMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICBpZiAobGV2ZWxzW2ldIDwgbGV2ZWwpIHsKICAgICAgICBpZiAoc3RhcnQgPj0gMCkgewogICAgICAgICAgcmV2ZXJzZVZhbHVlcyhjaGFycywgc3RhcnQsIGkpOwogICAgICAgICAgc3RhcnQgPSAtMTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoc3RhcnQgPCAwKSB7CiAgICAgICAgc3RhcnQgPSBpOwogICAgICB9CiAgICB9CiAgICBpZiAoc3RhcnQgPj0gMCkgewogICAgICByZXZlcnNlVmFsdWVzKGNoYXJzLCBzdGFydCwgbGV2ZWxzLmxlbmd0aCk7CiAgICB9CiAgfQogIGZvciAoaSA9IDAsIGlpID0gY2hhcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgY29uc3QgY2ggPSBjaGFyc1tpXTsKICAgIGlmIChjaCA9PT0gIjwiIHx8IGNoID09PSAiPiIpIHsKICAgICAgY2hhcnNbaV0gPSAiIjsKICAgIH0KICB9CiAgcmV0dXJuIGNyZWF0ZUJpZGlUZXh0KGNoYXJzLmpvaW4oIiIpLCBpc0xUUik7Cn0KCjsvLyAuL3NyYy9jb3JlL2ZvbnRfc3Vic3RpdHV0aW9ucy5qcwoKCgpjb25zdCBOT1JNQUwgPSB7CiAgc3R5bGU6ICJub3JtYWwiLAogIHdlaWdodDogIm5vcm1hbCIKfTsKY29uc3QgQk9MRCA9IHsKICBzdHlsZTogIm5vcm1hbCIsCiAgd2VpZ2h0OiAiYm9sZCIKfTsKY29uc3QgSVRBTElDID0gewogIHN0eWxlOiAiaXRhbGljIiwKICB3ZWlnaHQ6ICJub3JtYWwiCn07CmNvbnN0IEJPTERJVEFMSUMgPSB7CiAgc3R5bGU6ICJpdGFsaWMiLAogIHdlaWdodDogImJvbGQiCn07CmNvbnN0IHN1YnN0aXR1dGlvbk1hcCA9IG5ldyBNYXAoW1siVGltZXMtUm9tYW4iLCB7CiAgbG9jYWw6IFsiVGltZXMgTmV3IFJvbWFuIiwgIlRpbWVzLVJvbWFuIiwgIlRpbWVzIiwgIkxpYmVyYXRpb24gU2VyaWYiLCAiTmltYnVzIFJvbWFuIiwgIk5pbWJ1cyBSb21hbiBMIiwgIlRpbm9zIiwgIlRob3JuZGFsZSIsICJUZVggR3lyZSBUZXJtZXMiLCAiRnJlZVNlcmlmIiwgIkxpbnV4IExpYmVydGluZSBPIiwgIkxpYmVydGludXMgU2VyaWYiLCAiRGVqYVZ1IFNlcmlmIiwgIkJpdHN0cmVhbSBWZXJhIFNlcmlmIiwgIlVidW50dSJdLAogIHN0eWxlOiBOT1JNQUwsCiAgdWx0aW1hdGU6ICJzZXJpZiIKfV0sIFsiVGltZXMtQm9sZCIsIHsKICBhbGlhczogIlRpbWVzLVJvbWFuIiwKICBzdHlsZTogQk9MRCwKICB1bHRpbWF0ZTogInNlcmlmIgp9XSwgWyJUaW1lcy1JdGFsaWMiLCB7CiAgYWxpYXM6ICJUaW1lcy1Sb21hbiIsCiAgc3R5bGU6IElUQUxJQywKICB1bHRpbWF0ZTogInNlcmlmIgp9XSwgWyJUaW1lcy1Cb2xkSXRhbGljIiwgewogIGFsaWFzOiAiVGltZXMtUm9tYW4iLAogIHN0eWxlOiBCT0xESVRBTElDLAogIHVsdGltYXRlOiAic2VyaWYiCn1dLCBbIkhlbHZldGljYSIsIHsKICBsb2NhbDogWyJIZWx2ZXRpY2EiLCAiSGVsdmV0aWNhIE5ldWUiLCAiQXJpYWwiLCAiQXJpYWwgTm92YSIsICJMaWJlcmF0aW9uIFNhbnMiLCAiQXJpbW8iLCAiTmltYnVzIFNhbnMiLCAiTmltYnVzIFNhbnMgTCIsICJBMDMwIiwgIlRlWCBHeXJlIEhlcm9zIiwgIkZyZWVTYW5zIiwgIkRlamFWdSBTYW5zIiwgIkFsYmFueSIsICJCaXRzdHJlYW0gVmVyYSBTYW5zIiwgIkFyaWFsIFVuaWNvZGUgTVMiLCAiTWljcm9zb2Z0IFNhbnMgU2VyaWYiLCAiQXBwbGUgU3ltYm9scyIsICJDYW50YXJlbGwiXSwKICBwYXRoOiAiTGliZXJhdGlvblNhbnMtUmVndWxhci50dGYiLAogIHN0eWxlOiBOT1JNQUwsCiAgdWx0aW1hdGU6ICJzYW5zLXNlcmlmIgp9XSwgWyJIZWx2ZXRpY2EtQm9sZCIsIHsKICBhbGlhczogIkhlbHZldGljYSIsCiAgcGF0aDogIkxpYmVyYXRpb25TYW5zLUJvbGQudHRmIiwKICBzdHlsZTogQk9MRCwKICB1bHRpbWF0ZTogInNhbnMtc2VyaWYiCn1dLCBbIkhlbHZldGljYS1PYmxpcXVlIiwgewogIGFsaWFzOiAiSGVsdmV0aWNhIiwKICBwYXRoOiAiTGliZXJhdGlvblNhbnMtSXRhbGljLnR0ZiIsCiAgc3R5bGU6IElUQUxJQywKICB1bHRpbWF0ZTogInNhbnMtc2VyaWYiCn1dLCBbIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSIsIHsKICBhbGlhczogIkhlbHZldGljYSIsCiAgcGF0aDogIkxpYmVyYXRpb25TYW5zLUJvbGRJdGFsaWMudHRmIiwKICBzdHlsZTogQk9MRElUQUxJQywKICB1bHRpbWF0ZTogInNhbnMtc2VyaWYiCn1dLCBbIkNvdXJpZXIiLCB7CiAgbG9jYWw6IFsiQ291cmllciIsICJDb3VyaWVyIE5ldyIsICJMaWJlcmF0aW9uIE1vbm8iLCAiTmltYnVzIE1vbm8iLCAiTmltYnVzIE1vbm8gTCIsICJDb3VzaW5lIiwgIkN1bWJlcmxhbmQiLCAiVGVYIEd5cmUgQ3Vyc29yIiwgIkZyZWVNb25vIiwgIkxpbnV4IExpYmVydGluZSBNb25vIE8iLCAiTGliZXJ0aW51cyBNb25vIl0sCiAgc3R5bGU6IE5PUk1BTCwKICB1bHRpbWF0ZTogIm1vbm9zcGFjZSIKfV0sIFsiQ291cmllci1Cb2xkIiwgewogIGFsaWFzOiAiQ291cmllciIsCiAgc3R5bGU6IEJPTEQsCiAgdWx0aW1hdGU6ICJtb25vc3BhY2UiCn1dLCBbIkNvdXJpZXItT2JsaXF1ZSIsIHsKICBhbGlhczogIkNvdXJpZXIiLAogIHN0eWxlOiBJVEFMSUMsCiAgdWx0aW1hdGU6ICJtb25vc3BhY2UiCn1dLCBbIkNvdXJpZXItQm9sZE9ibGlxdWUiLCB7CiAgYWxpYXM6ICJDb3VyaWVyIiwKICBzdHlsZTogQk9MRElUQUxJQywKICB1bHRpbWF0ZTogIm1vbm9zcGFjZSIKfV0sIFsiQXJpYWxCbGFjayIsIHsKICBsb2NhbDogWyJBcmlhbCBCbGFjayJdLAogIHN0eWxlOiB7CiAgICBzdHlsZTogIm5vcm1hbCIsCiAgICB3ZWlnaHQ6ICI5MDAiCiAgfSwKICBmYWxsYmFjazogIkhlbHZldGljYS1Cb2xkIgp9XSwgWyJBcmlhbEJsYWNrLUJvbGQiLCB7CiAgYWxpYXM6ICJBcmlhbEJsYWNrIgp9XSwgWyJBcmlhbEJsYWNrLUl0YWxpYyIsIHsKICBhbGlhczogIkFyaWFsQmxhY2siLAogIHN0eWxlOiB7CiAgICBzdHlsZTogIml0YWxpYyIsCiAgICB3ZWlnaHQ6ICI5MDAiCiAgfSwKICBmYWxsYmFjazogIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSIKfV0sIFsiQXJpYWxCbGFjay1Cb2xkSXRhbGljIiwgewogIGFsaWFzOiAiQXJpYWxCbGFjay1JdGFsaWMiCn1dLCBbIkFyaWFsTmFycm93IiwgewogIGxvY2FsOiBbIkFyaWFsIE5hcnJvdyIsICJMaWJlcmF0aW9uIFNhbnMgTmFycm93IiwgIkhlbHZldGljYSBDb25kZW5zZWQiLCAiTmltYnVzIFNhbnMgTmFycm93IiwgIlRlWCBHeXJlIEhlcm9zIENuIl0sCiAgc3R5bGU6IE5PUk1BTCwKICBmYWxsYmFjazogIkhlbHZldGljYSIKfV0sIFsiQXJpYWxOYXJyb3ctQm9sZCIsIHsKICBhbGlhczogIkFyaWFsTmFycm93IiwKICBzdHlsZTogQk9MRCwKICBmYWxsYmFjazogIkhlbHZldGljYS1Cb2xkIgp9XSwgWyJBcmlhbE5hcnJvdy1JdGFsaWMiLCB7CiAgYWxpYXM6ICJBcmlhbE5hcnJvdyIsCiAgc3R5bGU6IElUQUxJQywKICBmYWxsYmFjazogIkhlbHZldGljYS1PYmxpcXVlIgp9XSwgWyJBcmlhbE5hcnJvdy1Cb2xkSXRhbGljIiwgewogIGFsaWFzOiAiQXJpYWxOYXJyb3ciLAogIHN0eWxlOiBCT0xESVRBTElDLAogIGZhbGxiYWNrOiAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIgp9XSwgWyJDYWxpYnJpIiwgewogIGxvY2FsOiBbIkNhbGlicmkiLCAiQ2FybGl0byJdLAogIHN0eWxlOiBOT1JNQUwsCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EiCn1dLCBbIkNhbGlicmktQm9sZCIsIHsKICBhbGlhczogIkNhbGlicmkiLAogIHN0eWxlOiBCT0xELAogIGZhbGxiYWNrOiAiSGVsdmV0aWNhLUJvbGQiCn1dLCBbIkNhbGlicmktSXRhbGljIiwgewogIGFsaWFzOiAiQ2FsaWJyaSIsCiAgc3R5bGU6IElUQUxJQywKICBmYWxsYmFjazogIkhlbHZldGljYS1PYmxpcXVlIgp9XSwgWyJDYWxpYnJpLUJvbGRJdGFsaWMiLCB7CiAgYWxpYXM6ICJDYWxpYnJpIiwKICBzdHlsZTogQk9MRElUQUxJQywKICBmYWxsYmFjazogIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSIKfV0sIFsiV2luZ2RpbmdzIiwgewogIGxvY2FsOiBbIldpbmdkaW5ncyIsICJVUlcgRGluZ2JhdHMiXSwKICBzdHlsZTogTk9STUFMCn1dLCBbIldpbmdkaW5ncy1SZWd1bGFyIiwgewogIGFsaWFzOiAiV2luZ2RpbmdzIgp9XSwgWyJXaW5nZGluZ3MtQm9sZCIsIHsKICBhbGlhczogIldpbmdkaW5ncyIKfV1dKTsKY29uc3QgZm9udEFsaWFzZXMgPSBuZXcgTWFwKFtbIkFyaWFsLUJsYWNrIiwgIkFyaWFsQmxhY2siXV0pOwpmdW5jdGlvbiBnZXRTdHlsZVRvQXBwZW5kKHN0eWxlKSB7CiAgc3dpdGNoIChzdHlsZSkgewogICAgY2FzZSBCT0xEOgogICAgICByZXR1cm4gIkJvbGQiOwogICAgY2FzZSBJVEFMSUM6CiAgICAgIHJldHVybiAiSXRhbGljIjsKICAgIGNhc2UgQk9MRElUQUxJQzoKICAgICAgcmV0dXJuICJCb2xkIEl0YWxpYyI7CiAgICBkZWZhdWx0OgogICAgICBpZiAoc3R5bGU/LndlaWdodCA9PT0gImJvbGQiKSB7CiAgICAgICAgcmV0dXJuICJCb2xkIjsKICAgICAgfQogICAgICBpZiAoc3R5bGU/LnN0eWxlID09PSAiaXRhbGljIikgewogICAgICAgIHJldHVybiAiSXRhbGljIjsKICAgICAgfQogIH0KICByZXR1cm4gIiI7Cn0KZnVuY3Rpb24gZ2V0RmFtaWx5TmFtZShzdHIpIHsKICBjb25zdCBrZXl3b3JkcyA9IG5ldyBTZXQoWyJ0aGluIiwgImV4dHJhbGlnaHQiLCAidWx0cmFsaWdodCIsICJkZW1pbGlnaHQiLCAic2VtaWxpZ2h0IiwgImxpZ2h0IiwgImJvb2siLCAicmVndWxhciIsICJub3JtYWwiLCAibWVkaXVtIiwgImRlbWlib2xkIiwgInNlbWlib2xkIiwgImJvbGQiLCAiZXh0cmFib2xkIiwgInVsdHJhYm9sZCIsICJibGFjayIsICJoZWF2eSIsICJleHRyYWJsYWNrIiwgInVsdHJhYmxhY2siLCAicm9tYW4iLCAiaXRhbGljIiwgIm9ibGlxdWUiLCAidWx0cmFjb25kZW5zZWQiLCAiZXh0cmFjb25kZW5zZWQiLCAiY29uZGVuc2VkIiwgInNlbWljb25kZW5zZWQiLCAibm9ybWFsIiwgInNlbWlleHBhbmRlZCIsICJleHBhbmRlZCIsICJleHRyYWV4cGFuZGVkIiwgInVsdHJhZXhwYW5kZWQiLCAiYm9sZGl0YWxpYyJdKTsKICByZXR1cm4gc3RyLnNwbGl0KC9bLSAsK10rL2cpLmZpbHRlcih0b2sgPT4gIWtleXdvcmRzLmhhcyh0b2sudG9Mb3dlckNhc2UoKSkpLmpvaW4oIiAiKTsKfQpmdW5jdGlvbiBnZW5lcmF0ZUZvbnQoewogIGFsaWFzLAogIGxvY2FsLAogIHBhdGgsCiAgZmFsbGJhY2ssCiAgc3R5bGUsCiAgdWx0aW1hdGUKfSwgc3JjLCBsb2NhbEZvbnRQYXRoLCB1c2VGYWxsYmFjayA9IHRydWUsIHVzZVBhdGggPSB0cnVlLCBhcHBlbmQgPSAiIikgewogIGNvbnN0IHJlc3VsdCA9IHsKICAgIHN0eWxlOiBudWxsLAogICAgdWx0aW1hdGU6IG51bGwKICB9OwogIGlmIChsb2NhbCkgewogICAgY29uc3QgZXh0cmEgPSBhcHBlbmQgPyBgICR7YXBwZW5kfWAgOiAiIjsKICAgIGZvciAoY29uc3QgbmFtZSBvZiBsb2NhbCkgewogICAgICBzcmMucHVzaChgbG9jYWwoJHtuYW1lfSR7ZXh0cmF9KWApOwogICAgfQogIH0KICBpZiAoYWxpYXMpIHsKICAgIGNvbnN0IHN1YnN0aXR1dGlvbiA9IHN1YnN0aXR1dGlvbk1hcC5nZXQoYWxpYXMpOwogICAgY29uc3QgYWxpYXNBcHBlbmQgPSBhcHBlbmQgfHwgZ2V0U3R5bGVUb0FwcGVuZChzdHlsZSk7CiAgICBPYmplY3QuYXNzaWduKHJlc3VsdCwgZ2VuZXJhdGVGb250KHN1YnN0aXR1dGlvbiwgc3JjLCBsb2NhbEZvbnRQYXRoLCB1c2VGYWxsYmFjayAmJiAhZmFsbGJhY2ssIHVzZVBhdGggJiYgIXBhdGgsIGFsaWFzQXBwZW5kKSk7CiAgfQogIGlmIChzdHlsZSkgewogICAgcmVzdWx0LnN0eWxlID0gc3R5bGU7CiAgfQogIGlmICh1bHRpbWF0ZSkgewogICAgcmVzdWx0LnVsdGltYXRlID0gdWx0aW1hdGU7CiAgfQogIGlmICh1c2VGYWxsYmFjayAmJiBmYWxsYmFjaykgewogICAgY29uc3QgZmFsbGJhY2tJbmZvID0gc3Vic3RpdHV0aW9uTWFwLmdldChmYWxsYmFjayk7CiAgICBjb25zdCB7CiAgICAgIHVsdGltYXRlOiBmYWxsYmFja1VsdGltYXRlCiAgICB9ID0gZ2VuZXJhdGVGb250KGZhbGxiYWNrSW5mbywgc3JjLCBsb2NhbEZvbnRQYXRoLCB1c2VGYWxsYmFjaywgdXNlUGF0aCAmJiAhcGF0aCwgYXBwZW5kKTsKICAgIHJlc3VsdC51bHRpbWF0ZSB8fD0gZmFsbGJhY2tVbHRpbWF0ZTsKICB9CiAgaWYgKHVzZVBhdGggJiYgcGF0aCAmJiBsb2NhbEZvbnRQYXRoKSB7CiAgICBzcmMucHVzaChgdXJsKCR7bG9jYWxGb250UGF0aH0ke3BhdGh9KWApOwogIH0KICByZXR1cm4gcmVzdWx0Owp9CmZ1bmN0aW9uIGdldEZvbnRTdWJzdGl0dXRpb24oc3lzdGVtRm9udENhY2hlLCBpZEZhY3RvcnksIGxvY2FsRm9udFBhdGgsIGJhc2VGb250TmFtZSwgc3RhbmRhcmRGb250TmFtZSwgdHlwZSkgewogIGlmIChiYXNlRm9udE5hbWUuc3RhcnRzV2l0aCgiSW52YWxpZFBERmpzRm9udF8iKSkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGlmICgodHlwZSA9PT0gIlRydWVUeXBlIiB8fCB0eXBlID09PSAiVHlwZTEiKSAmJiAvXltBLVpdezZ9XCsvLnRlc3QoYmFzZUZvbnROYW1lKSkgewogICAgYmFzZUZvbnROYW1lID0gYmFzZUZvbnROYW1lLnNsaWNlKDcpOwogIH0KICBiYXNlRm9udE5hbWUgPSBub3JtYWxpemVGb250TmFtZShiYXNlRm9udE5hbWUpOwogIGNvbnN0IGtleSA9IGJhc2VGb250TmFtZTsKICBsZXQgc3Vic3RpdHV0aW9uSW5mbyA9IHN5c3RlbUZvbnRDYWNoZS5nZXQoa2V5KTsKICBpZiAoc3Vic3RpdHV0aW9uSW5mbykgewogICAgcmV0dXJuIHN1YnN0aXR1dGlvbkluZm87CiAgfQogIGxldCBzdWJzdGl0dXRpb24gPSBzdWJzdGl0dXRpb25NYXAuZ2V0KGJhc2VGb250TmFtZSk7CiAgaWYgKCFzdWJzdGl0dXRpb24pIHsKICAgIGZvciAoY29uc3QgW2FsaWFzLCBzdWJzdF0gb2YgZm9udEFsaWFzZXMpIHsKICAgICAgaWYgKGJhc2VGb250TmFtZS5zdGFydHNXaXRoKGFsaWFzKSkgewogICAgICAgIGJhc2VGb250TmFtZSA9IGAke3N1YnN0fSR7YmFzZUZvbnROYW1lLnN1YnN0cmluZyhhbGlhcy5sZW5ndGgpfWA7CiAgICAgICAgc3Vic3RpdHV0aW9uID0gc3Vic3RpdHV0aW9uTWFwLmdldChiYXNlRm9udE5hbWUpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQogIGxldCBtdXN0QWRkQmFzZUZvbnQgPSBmYWxzZTsKICBpZiAoIXN1YnN0aXR1dGlvbikgewogICAgc3Vic3RpdHV0aW9uID0gc3Vic3RpdHV0aW9uTWFwLmdldChzdGFuZGFyZEZvbnROYW1lKTsKICAgIG11c3RBZGRCYXNlRm9udCA9IHRydWU7CiAgfQogIGNvbnN0IGxvYWRlZE5hbWUgPSBgJHtpZEZhY3RvcnkuZ2V0RG9jSWQoKX1fcyR7aWRGYWN0b3J5LmNyZWF0ZUZvbnRJZCgpfWA7CiAgaWYgKCFzdWJzdGl0dXRpb24pIHsKICAgIGlmICghdmFsaWRhdGVGb250TmFtZShiYXNlRm9udE5hbWUpKSB7CiAgICAgIHdhcm4oYENhbm5vdCBzdWJzdGl0dXRlIHRoZSBmb250IGJlY2F1c2Ugb2YgaXRzIG5hbWU6ICR7YmFzZUZvbnROYW1lfWApOwogICAgICBzeXN0ZW1Gb250Q2FjaGUuc2V0KGtleSwgbnVsbCk7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgYm9sZCA9IC9ib2xkL2dpLnRlc3QoYmFzZUZvbnROYW1lKTsKICAgIGNvbnN0IGl0YWxpYyA9IC9vYmxpcXVlfGl0YWxpYy9naS50ZXN0KGJhc2VGb250TmFtZSk7CiAgICBjb25zdCBzdHlsZSA9IGJvbGQgJiYgaXRhbGljICYmIEJPTERJVEFMSUMgfHwgYm9sZCAmJiBCT0xEIHx8IGl0YWxpYyAmJiBJVEFMSUMgfHwgTk9STUFMOwogICAgc3Vic3RpdHV0aW9uSW5mbyA9IHsKICAgICAgY3NzOiBgIiR7Z2V0RmFtaWx5TmFtZShiYXNlRm9udE5hbWUpfSIsJHtsb2FkZWROYW1lfWAsCiAgICAgIGd1ZXNzRmFsbGJhY2s6IHRydWUsCiAgICAgIGxvYWRlZE5hbWUsCiAgICAgIGJhc2VGb250TmFtZSwKICAgICAgc3JjOiBgbG9jYWwoJHtiYXNlRm9udE5hbWV9KWAsCiAgICAgIHN0eWxlCiAgICB9OwogICAgc3lzdGVtRm9udENhY2hlLnNldChrZXksIHN1YnN0aXR1dGlvbkluZm8pOwogICAgcmV0dXJuIHN1YnN0aXR1dGlvbkluZm87CiAgfQogIGNvbnN0IHNyYyA9IFtdOwogIGlmIChtdXN0QWRkQmFzZUZvbnQgJiYgdmFsaWRhdGVGb250TmFtZShiYXNlRm9udE5hbWUpKSB7CiAgICBzcmMucHVzaChgbG9jYWwoJHtiYXNlRm9udE5hbWV9KWApOwogIH0KICBjb25zdCB7CiAgICBzdHlsZSwKICAgIHVsdGltYXRlCiAgfSA9IGdlbmVyYXRlRm9udChzdWJzdGl0dXRpb24sIHNyYywgbG9jYWxGb250UGF0aCk7CiAgY29uc3QgZ3Vlc3NGYWxsYmFjayA9IHVsdGltYXRlID09PSBudWxsOwogIGNvbnN0IGZhbGxiYWNrID0gZ3Vlc3NGYWxsYmFjayA/ICIiIDogYCwke3VsdGltYXRlfWA7CiAgc3Vic3RpdHV0aW9uSW5mbyA9IHsKICAgIGNzczogYCIke2dldEZhbWlseU5hbWUoYmFzZUZvbnROYW1lKX0iLCR7bG9hZGVkTmFtZX0ke2ZhbGxiYWNrfWAsCiAgICBndWVzc0ZhbGxiYWNrLAogICAgbG9hZGVkTmFtZSwKICAgIGJhc2VGb250TmFtZSwKICAgIHNyYzogc3JjLmpvaW4oIiwiKSwKICAgIHN0eWxlCiAgfTsKICBzeXN0ZW1Gb250Q2FjaGUuc2V0KGtleSwgc3Vic3RpdHV0aW9uSW5mbyk7CiAgcmV0dXJuIHN1YnN0aXR1dGlvbkluZm87Cn0KCjsvLyAuL3NyYy9zaGFyZWQvbXVybXVyaGFzaDMuanMKY29uc3QgU0VFRCA9IDB4YzNkMmUxZjA7CmNvbnN0IE1BU0tfSElHSCA9IDB4ZmZmZjAwMDA7CmNvbnN0IE1BU0tfTE9XID0gMHhmZmZmOwpjbGFzcyBNdXJtdXJIYXNoM182NCB7CiAgY29uc3RydWN0b3Ioc2VlZCkgewogICAgdGhpcy5oMSA9IHNlZWQgPyBzZWVkICYgMHhmZmZmZmZmZiA6IFNFRUQ7CiAgICB0aGlzLmgyID0gc2VlZCA/IHNlZWQgJiAweGZmZmZmZmZmIDogU0VFRDsKICB9CiAgdXBkYXRlKGlucHV0KSB7CiAgICBsZXQgZGF0YSwgbGVuZ3RoOwogICAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gInN0cmluZyIpIHsKICAgICAgZGF0YSA9IG5ldyBVaW50OEFycmF5KGlucHV0Lmxlbmd0aCAqIDIpOwogICAgICBsZW5ndGggPSAwOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBpbnB1dC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgY29kZSA9IGlucHV0LmNoYXJDb2RlQXQoaSk7CiAgICAgICAgaWYgKGNvZGUgPD0gMHhmZikgewogICAgICAgICAgZGF0YVtsZW5ndGgrK10gPSBjb2RlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkYXRhW2xlbmd0aCsrXSA9IGNvZGUgPj4+IDg7CiAgICAgICAgICBkYXRhW2xlbmd0aCsrXSA9IGNvZGUgJiAweGZmOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmIChBcnJheUJ1ZmZlci5pc1ZpZXcoaW5wdXQpKSB7CiAgICAgIGRhdGEgPSBpbnB1dC5zbGljZSgpOwogICAgICBsZW5ndGggPSBkYXRhLmJ5dGVMZW5ndGg7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgZGF0YSBmb3JtYXQsIG11c3QgYmUgYSBzdHJpbmcgb3IgVHlwZWRBcnJheS4iKTsKICAgIH0KICAgIGNvbnN0IGJsb2NrQ291bnRzID0gbGVuZ3RoID4+IDI7CiAgICBjb25zdCB0YWlsTGVuZ3RoID0gbGVuZ3RoIC0gYmxvY2tDb3VudHMgKiA0OwogICAgY29uc3QgZGF0YVVpbnQzMiA9IG5ldyBVaW50MzJBcnJheShkYXRhLmJ1ZmZlciwgMCwgYmxvY2tDb3VudHMpOwogICAgbGV0IGsxID0gMCwKICAgICAgazIgPSAwOwogICAgbGV0IGgxID0gdGhpcy5oMSwKICAgICAgaDIgPSB0aGlzLmgyOwogICAgY29uc3QgQzEgPSAweGNjOWUyZDUxLAogICAgICBDMiA9IDB4MWI4NzM1OTM7CiAgICBjb25zdCBDMV9MT1cgPSBDMSAmIE1BU0tfTE9XLAogICAgICBDMl9MT1cgPSBDMiAmIE1BU0tfTE9XOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9ja0NvdW50czsgaSsrKSB7CiAgICAgIGlmIChpICYgMSkgewogICAgICAgIGsxID0gZGF0YVVpbnQzMltpXTsKICAgICAgICBrMSA9IGsxICogQzEgJiBNQVNLX0hJR0ggfCBrMSAqIEMxX0xPVyAmIE1BU0tfTE9XOwogICAgICAgIGsxID0gazEgPDwgMTUgfCBrMSA+Pj4gMTc7CiAgICAgICAgazEgPSBrMSAqIEMyICYgTUFTS19ISUdIIHwgazEgKiBDMl9MT1cgJiBNQVNLX0xPVzsKICAgICAgICBoMSBePSBrMTsKICAgICAgICBoMSA9IGgxIDw8IDEzIHwgaDEgPj4+IDE5OwogICAgICAgIGgxID0gaDEgKiA1ICsgMHhlNjU0NmI2NDsKICAgICAgfSBlbHNlIHsKICAgICAgICBrMiA9IGRhdGFVaW50MzJbaV07CiAgICAgICAgazIgPSBrMiAqIEMxICYgTUFTS19ISUdIIHwgazIgKiBDMV9MT1cgJiBNQVNLX0xPVzsKICAgICAgICBrMiA9IGsyIDw8IDE1IHwgazIgPj4+IDE3OwogICAgICAgIGsyID0gazIgKiBDMiAmIE1BU0tfSElHSCB8IGsyICogQzJfTE9XICYgTUFTS19MT1c7CiAgICAgICAgaDIgXj0gazI7CiAgICAgICAgaDIgPSBoMiA8PCAxMyB8IGgyID4+PiAxOTsKICAgICAgICBoMiA9IGgyICogNSArIDB4ZTY1NDZiNjQ7CiAgICAgIH0KICAgIH0KICAgIGsxID0gMDsKICAgIHN3aXRjaCAodGFpbExlbmd0aCkgewogICAgICBjYXNlIDM6CiAgICAgICAgazEgXj0gZGF0YVtibG9ja0NvdW50cyAqIDQgKyAyXSA8PCAxNjsKICAgICAgY2FzZSAyOgogICAgICAgIGsxIF49IGRhdGFbYmxvY2tDb3VudHMgKiA0ICsgMV0gPDwgODsKICAgICAgY2FzZSAxOgogICAgICAgIGsxIF49IGRhdGFbYmxvY2tDb3VudHMgKiA0XTsKICAgICAgICBrMSA9IGsxICogQzEgJiBNQVNLX0hJR0ggfCBrMSAqIEMxX0xPVyAmIE1BU0tfTE9XOwogICAgICAgIGsxID0gazEgPDwgMTUgfCBrMSA+Pj4gMTc7CiAgICAgICAgazEgPSBrMSAqIEMyICYgTUFTS19ISUdIIHwgazEgKiBDMl9MT1cgJiBNQVNLX0xPVzsKICAgICAgICBpZiAoYmxvY2tDb3VudHMgJiAxKSB7CiAgICAgICAgICBoMSBePSBrMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaDIgXj0gazE7CiAgICAgICAgfQogICAgfQogICAgdGhpcy5oMSA9IGgxOwogICAgdGhpcy5oMiA9IGgyOwogIH0KICBoZXhkaWdlc3QoKSB7CiAgICBsZXQgaDEgPSB0aGlzLmgxLAogICAgICBoMiA9IHRoaXMuaDI7CiAgICBoMSBePSBoMiA+Pj4gMTsKICAgIGgxID0gaDEgKiAweGVkNTU4Y2NkICYgTUFTS19ISUdIIHwgaDEgKiAweDhjY2QgJiBNQVNLX0xPVzsKICAgIGgyID0gaDIgKiAweGZmNTFhZmQ3ICYgTUFTS19ISUdIIHwgKChoMiA8PCAxNiB8IGgxID4+PiAxNikgKiAweGFmZDdlZDU1ICYgTUFTS19ISUdIKSA+Pj4gMTY7CiAgICBoMSBePSBoMiA+Pj4gMTsKICAgIGgxID0gaDEgKiAweDFhODVlYzUzICYgTUFTS19ISUdIIHwgaDEgKiAweGVjNTMgJiBNQVNLX0xPVzsKICAgIGgyID0gaDIgKiAweGM0Y2ViOWZlICYgTUFTS19ISUdIIHwgKChoMiA8PCAxNiB8IGgxID4+PiAxNikgKiAweGI5ZmUxYTg1ICYgTUFTS19ISUdIKSA+Pj4gMTY7CiAgICBoMSBePSBoMiA+Pj4gMTsKICAgIHJldHVybiAoaDEgPj4+IDApLnRvU3RyaW5nKDE2KS5wYWRTdGFydCg4LCAiMCIpICsgKGgyID4+PiAwKS50b1N0cmluZygxNikucGFkU3RhcnQoOCwgIjAiKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2ltYWdlLmpzCgoKCgoKCgoKCgpmdW5jdGlvbiByZXNpemVJbWFnZU1hc2soc3JjLCBicGMsIHcxLCBoMSwgdzIsIGgyKSB7CiAgY29uc3QgbGVuZ3RoID0gdzIgKiBoMjsKICBsZXQgZGVzdDsKICBpZiAoYnBjIDw9IDgpIHsKICAgIGRlc3QgPSBuZXcgVWludDhBcnJheShsZW5ndGgpOwogIH0gZWxzZSBpZiAoYnBjIDw9IDE2KSB7CiAgICBkZXN0ID0gbmV3IFVpbnQxNkFycmF5KGxlbmd0aCk7CiAgfSBlbHNlIHsKICAgIGRlc3QgPSBuZXcgVWludDMyQXJyYXkobGVuZ3RoKTsKICB9CiAgY29uc3QgeFJhdGlvID0gdzEgLyB3MjsKICBjb25zdCB5UmF0aW8gPSBoMSAvIGgyOwogIGxldCBpLAogICAgaiwKICAgIHB5LAogICAgbmV3SW5kZXggPSAwLAogICAgb2xkSW5kZXg7CiAgY29uc3QgeFNjYWxlZCA9IG5ldyBVaW50MTZBcnJheSh3Mik7CiAgY29uc3QgdzFTY2FubGluZSA9IHcxOwogIGZvciAoaSA9IDA7IGkgPCB3MjsgaSsrKSB7CiAgICB4U2NhbGVkW2ldID0gTWF0aC5mbG9vcihpICogeFJhdGlvKTsKICB9CiAgZm9yIChpID0gMDsgaSA8IGgyOyBpKyspIHsKICAgIHB5ID0gTWF0aC5mbG9vcihpICogeVJhdGlvKSAqIHcxU2NhbmxpbmU7CiAgICBmb3IgKGogPSAwOyBqIDwgdzI7IGorKykgewogICAgICBvbGRJbmRleCA9IHB5ICsgeFNjYWxlZFtqXTsKICAgICAgZGVzdFtuZXdJbmRleCsrXSA9IHNyY1tvbGRJbmRleF07CiAgICB9CiAgfQogIHJldHVybiBkZXN0Owp9CmNsYXNzIFBERkltYWdlIHsKICBjb25zdHJ1Y3Rvcih7CiAgICB4cmVmLAogICAgcmVzLAogICAgaW1hZ2UsCiAgICBpc0lubGluZSA9IGZhbHNlLAogICAgc21hc2sgPSBudWxsLAogICAgbWFzayA9IG51bGwsCiAgICBpc01hc2sgPSBmYWxzZSwKICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgfSkgewogICAgdGhpcy5pbWFnZSA9IGltYWdlOwogICAgY29uc3QgZGljdCA9IGltYWdlLmRpY3Q7CiAgICBjb25zdCBmaWx0ZXIgPSBkaWN0LmdldCgiRiIsICJGaWx0ZXIiKTsKICAgIGxldCBmaWx0ZXJOYW1lOwogICAgaWYgKGZpbHRlciBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgZmlsdGVyTmFtZSA9IGZpbHRlci5uYW1lOwogICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGZpbHRlcikpIHsKICAgICAgY29uc3QgZmlsdGVyWmVybyA9IHhyZWYuZmV0Y2hJZlJlZihmaWx0ZXJbMF0pOwogICAgICBpZiAoZmlsdGVyWmVybyBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICBmaWx0ZXJOYW1lID0gZmlsdGVyWmVyby5uYW1lOwogICAgICB9CiAgICB9CiAgICBzd2l0Y2ggKGZpbHRlck5hbWUpIHsKICAgICAgY2FzZSAiSlBYRGVjb2RlIjoKICAgICAgICAoewogICAgICAgICAgd2lkdGg6IGltYWdlLndpZHRoLAogICAgICAgICAgaGVpZ2h0OiBpbWFnZS5oZWlnaHQsCiAgICAgICAgICBjb21wb25lbnRzQ291bnQ6IGltYWdlLm51bUNvbXBzLAogICAgICAgICAgYml0c1BlckNvbXBvbmVudDogaW1hZ2UuYml0c1BlckNvbXBvbmVudAogICAgICAgIH0gPSBKcHhJbWFnZS5wYXJzZUltYWdlUHJvcGVydGllcyhpbWFnZS5zdHJlYW0pKTsKICAgICAgICBpbWFnZS5zdHJlYW0ucmVzZXQoKTsKICAgICAgICBjb25zdCByZWR1Y2VQb3dlciA9IEltYWdlUmVzaXplci5nZXRSZWR1Y2VQb3dlckZvckpQWChpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5udW1Db21wcyk7CiAgICAgICAgdGhpcy5qcHhEZWNvZGVyT3B0aW9ucyA9IHsKICAgICAgICAgIG51bUNvbXBvbmVudHM6IDAsCiAgICAgICAgICBpc0luZGV4ZWRDb2xvcm1hcDogZmFsc2UsCiAgICAgICAgICBzbWFza0luRGF0YTogZGljdC5oYXMoIlNNYXNrSW5EYXRhIiksCiAgICAgICAgICByZWR1Y2VQb3dlcgogICAgICAgIH07CiAgICAgICAgaWYgKHJlZHVjZVBvd2VyKSB7CiAgICAgICAgICBjb25zdCBmYWN0b3IgPSAyICoqIHJlZHVjZVBvd2VyOwogICAgICAgICAgaW1hZ2Uud2lkdGggPSBNYXRoLmNlaWwoaW1hZ2Uud2lkdGggLyBmYWN0b3IpOwogICAgICAgICAgaW1hZ2UuaGVpZ2h0ID0gTWF0aC5jZWlsKGltYWdlLmhlaWdodCAvIGZhY3Rvcik7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJKQklHMkRlY29kZSI6CiAgICAgICAgaW1hZ2UuYml0c1BlckNvbXBvbmVudCA9IDE7CiAgICAgICAgaW1hZ2UubnVtQ29tcHMgPSAxOwogICAgICAgIGJyZWFrOwogICAgfQogICAgbGV0IHdpZHRoID0gZGljdC5nZXQoIlciLCAiV2lkdGgiKTsKICAgIGxldCBoZWlnaHQgPSBkaWN0LmdldCgiSCIsICJIZWlnaHQiKTsKICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGltYWdlLndpZHRoKSAmJiBpbWFnZS53aWR0aCA+IDAgJiYgTnVtYmVyLmlzSW50ZWdlcihpbWFnZS5oZWlnaHQpICYmIGltYWdlLmhlaWdodCA+IDAgJiYgKGltYWdlLndpZHRoICE9PSB3aWR0aCB8fCBpbWFnZS5oZWlnaHQgIT09IGhlaWdodCkpIHsKICAgICAgd2FybigiUERGSW1hZ2UgLSB1c2luZyB0aGUgV2lkdGgvSGVpZ2h0IG9mIHRoZSBpbWFnZSBkYXRhLCAiICsgInJhdGhlciB0aGFuIHRoZSBpbWFnZSBkaWN0aW9uYXJ5LiIpOwogICAgICB3aWR0aCA9IGltYWdlLndpZHRoOwogICAgICBoZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CiAgICB9IGVsc2UgewogICAgICBjb25zdCB2YWxpZFdpZHRoID0gdHlwZW9mIHdpZHRoID09PSAibnVtYmVyIiAmJiB3aWR0aCA+IDAsCiAgICAgICAgdmFsaWRIZWlnaHQgPSB0eXBlb2YgaGVpZ2h0ID09PSAibnVtYmVyIiAmJiBoZWlnaHQgPiAwOwogICAgICBpZiAoIXZhbGlkV2lkdGggfHwgIXZhbGlkSGVpZ2h0KSB7CiAgICAgICAgaWYgKCFpbWFnZS5mYWxsYmFja0RpbXMpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBpbWFnZSB3aWR0aDogJHt3aWR0aH0gb3IgaGVpZ2h0OiAke2hlaWdodH1gKTsKICAgICAgICB9CiAgICAgICAgd2FybigiUERGSW1hZ2UgLSB1c2luZyB0aGUgV2lkdGgvSGVpZ2h0IG9mIHRoZSBwYXJlbnQgaW1hZ2UsIGZvciBTTWFzay9NYXNrIGRhdGEuIik7CiAgICAgICAgaWYgKCF2YWxpZFdpZHRoKSB7CiAgICAgICAgICB3aWR0aCA9IGltYWdlLmZhbGxiYWNrRGltcy53aWR0aDsKICAgICAgICB9CiAgICAgICAgaWYgKCF2YWxpZEhlaWdodCkgewogICAgICAgICAgaGVpZ2h0ID0gaW1hZ2UuZmFsbGJhY2tEaW1zLmhlaWdodDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRoaXMud2lkdGggPSB3aWR0aDsKICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgdGhpcy5pbnRlcnBvbGF0ZSA9IGRpY3QuZ2V0KCJJIiwgIkludGVycG9sYXRlIik7CiAgICB0aGlzLmltYWdlTWFzayA9IGRpY3QuZ2V0KCJJTSIsICJJbWFnZU1hc2siKSB8fCBmYWxzZTsKICAgIHRoaXMubWF0dGUgPSBkaWN0LmdldCgiTWF0dGUiKSB8fCBmYWxzZTsKICAgIGxldCBiaXRzUGVyQ29tcG9uZW50ID0gaW1hZ2UuYml0c1BlckNvbXBvbmVudDsKICAgIGlmICghYml0c1BlckNvbXBvbmVudCkgewogICAgICBiaXRzUGVyQ29tcG9uZW50ID0gZGljdC5nZXQoIkJQQyIsICJCaXRzUGVyQ29tcG9uZW50Iik7CiAgICAgIGlmICghYml0c1BlckNvbXBvbmVudCkgewogICAgICAgIGlmICh0aGlzLmltYWdlTWFzaykgewogICAgICAgICAgYml0c1BlckNvbXBvbmVudCA9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgQml0cyBwZXIgY29tcG9uZW50IG1pc3NpbmcgaW4gaW1hZ2U6ICR7dGhpcy5pbWFnZU1hc2t9YCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICB0aGlzLmJwYyA9IGJpdHNQZXJDb21wb25lbnQ7CiAgICBpZiAoIXRoaXMuaW1hZ2VNYXNrKSB7CiAgICAgIGxldCBjb2xvclNwYWNlID0gZGljdC5nZXRSYXcoIkNTIikgfHwgZGljdC5nZXRSYXcoIkNvbG9yU3BhY2UiKTsKICAgICAgY29uc3QgaGFzQ29sb3JTcGFjZSA9ICEhY29sb3JTcGFjZTsKICAgICAgaWYgKCFoYXNDb2xvclNwYWNlKSB7CiAgICAgICAgaWYgKHRoaXMuanB4RGVjb2Rlck9wdGlvbnMpIHsKICAgICAgICAgIGNvbG9yU3BhY2UgPSBOYW1lLmdldCgiRGV2aWNlUkdCQSIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzd2l0Y2ggKGltYWdlLm51bUNvbXBzKSB7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICBjb2xvclNwYWNlID0gTmFtZS5nZXQoIkRldmljZUdyYXkiKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIGNvbG9yU3BhY2UgPSBOYW1lLmdldCgiRGV2aWNlUkdCIik7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjb2xvclNwYWNlID0gTmFtZS5nZXQoIkRldmljZUNNWUsiKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEltYWdlcyB3aXRoICR7aW1hZ2UubnVtQ29tcHN9IGNvbG9yIGNvbXBvbmVudHMgbm90IHN1cHBvcnRlZC5gKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy5qcHhEZWNvZGVyT3B0aW9ucz8uc21hc2tJbkRhdGEpIHsKICAgICAgICBjb2xvclNwYWNlID0gTmFtZS5nZXQoIkRldmljZVJHQkEiKTsKICAgICAgfQogICAgICB0aGlzLmNvbG9yU3BhY2UgPSBDb2xvclNwYWNlVXRpbHMucGFyc2UoewogICAgICAgIGNzOiBjb2xvclNwYWNlLAogICAgICAgIHhyZWYsCiAgICAgICAgcmVzb3VyY2VzOiBpc0lubGluZSA/IHJlcyA6IG51bGwsCiAgICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgICB9KTsKICAgICAgdGhpcy5udW1Db21wcyA9IHRoaXMuY29sb3JTcGFjZS5udW1Db21wczsKICAgICAgaWYgKHRoaXMuanB4RGVjb2Rlck9wdGlvbnMpIHsKICAgICAgICB0aGlzLmpweERlY29kZXJPcHRpb25zLm51bUNvbXBvbmVudHMgPSBoYXNDb2xvclNwYWNlID8gdGhpcy5udW1Db21wcyA6IDA7CiAgICAgICAgdGhpcy5qcHhEZWNvZGVyT3B0aW9ucy5pc0luZGV4ZWRDb2xvcm1hcCA9IHRoaXMuY29sb3JTcGFjZS5uYW1lID09PSAiSW5kZXhlZCI7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuZGVjb2RlID0gZGljdC5nZXRBcnJheSgiRCIsICJEZWNvZGUiKTsKICAgIHRoaXMubmVlZHNEZWNvZGUgPSBmYWxzZTsKICAgIGlmICh0aGlzLmRlY29kZSAmJiAodGhpcy5jb2xvclNwYWNlICYmICF0aGlzLmNvbG9yU3BhY2UuaXNEZWZhdWx0RGVjb2RlKHRoaXMuZGVjb2RlLCBiaXRzUGVyQ29tcG9uZW50KSB8fCBpc01hc2sgJiYgIUNvbG9yU3BhY2UuaXNEZWZhdWx0RGVjb2RlKHRoaXMuZGVjb2RlLCAxKSkpIHsKICAgICAgdGhpcy5uZWVkc0RlY29kZSA9IHRydWU7CiAgICAgIGNvbnN0IG1heCA9ICgxIDw8IGJpdHNQZXJDb21wb25lbnQpIC0gMTsKICAgICAgdGhpcy5kZWNvZGVDb2VmZmljaWVudHMgPSBbXTsKICAgICAgdGhpcy5kZWNvZGVBZGRlbmRzID0gW107CiAgICAgIGNvbnN0IGlzSW5kZXhlZCA9IHRoaXMuY29sb3JTcGFjZT8ubmFtZSA9PT0gIkluZGV4ZWQiOwogICAgICBmb3IgKGxldCBpID0gMCwgaiA9IDA7IGkgPCB0aGlzLmRlY29kZS5sZW5ndGg7IGkgKz0gMiwgKytqKSB7CiAgICAgICAgY29uc3QgZG1pbiA9IHRoaXMuZGVjb2RlW2ldOwogICAgICAgIGNvbnN0IGRtYXggPSB0aGlzLmRlY29kZVtpICsgMV07CiAgICAgICAgdGhpcy5kZWNvZGVDb2VmZmljaWVudHNbal0gPSBpc0luZGV4ZWQgPyAoZG1heCAtIGRtaW4pIC8gbWF4IDogZG1heCAtIGRtaW47CiAgICAgICAgdGhpcy5kZWNvZGVBZGRlbmRzW2pdID0gaXNJbmRleGVkID8gZG1pbiA6IG1heCAqIGRtaW47CiAgICAgIH0KICAgIH0KICAgIGlmIChzbWFzaykgewogICAgICBzbWFzay5mYWxsYmFja0RpbXMgPz89IHsKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQKICAgICAgfTsKICAgICAgdGhpcy5zbWFzayA9IG5ldyBQREZJbWFnZSh7CiAgICAgICAgeHJlZiwKICAgICAgICByZXMsCiAgICAgICAgaW1hZ2U6IHNtYXNrLAogICAgICAgIGlzSW5saW5lLAogICAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICAgICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKG1hc2spIHsKICAgICAgaWYgKG1hc2sgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgICAgY29uc3QgbWFza0RpY3QgPSBtYXNrLmRpY3QsCiAgICAgICAgICBpbWFnZU1hc2sgPSBtYXNrRGljdC5nZXQoIklNIiwgIkltYWdlTWFzayIpOwogICAgICAgIGlmICghaW1hZ2VNYXNrKSB7CiAgICAgICAgICB3YXJuKCJJZ25vcmluZyAvTWFzayBpbiBpbWFnZSB3aXRob3V0IC9JbWFnZU1hc2suIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1hc2suZmFsbGJhY2tEaW1zID8/PSB7CiAgICAgICAgICAgIHdpZHRoLAogICAgICAgICAgICBoZWlnaHQKICAgICAgICAgIH07CiAgICAgICAgICB0aGlzLm1hc2sgPSBuZXcgUERGSW1hZ2UoewogICAgICAgICAgICB4cmVmLAogICAgICAgICAgICByZXMsCiAgICAgICAgICAgIGltYWdlOiBtYXNrLAogICAgICAgICAgICBpc0lubGluZSwKICAgICAgICAgICAgaXNNYXNrOiB0cnVlLAogICAgICAgICAgICBwZGZGdW5jdGlvbkZhY3RvcnksCiAgICAgICAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgICAgICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm1hc2sgPSBtYXNrOwogICAgICB9CiAgICB9CiAgfQogIHN0YXRpYyBhc3luYyBidWlsZEltYWdlKHsKICAgIHhyZWYsCiAgICByZXMsCiAgICBpbWFnZSwKICAgIGlzSW5saW5lID0gZmFsc2UsCiAgICBwZGZGdW5jdGlvbkZhY3RvcnksCiAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogIH0pIHsKICAgIGNvbnN0IGltYWdlRGF0YSA9IGltYWdlOwogICAgbGV0IHNtYXNrRGF0YSA9IG51bGw7CiAgICBsZXQgbWFza0RhdGEgPSBudWxsOwogICAgY29uc3Qgc21hc2sgPSBpbWFnZS5kaWN0LmdldCgiU01hc2siKTsKICAgIGNvbnN0IG1hc2sgPSBpbWFnZS5kaWN0LmdldCgiTWFzayIpOwogICAgaWYgKHNtYXNrKSB7CiAgICAgIGlmIChzbWFzayBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgICBzbWFza0RhdGEgPSBzbWFzazsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKCJVbnN1cHBvcnRlZCAvU01hc2sgZm9ybWF0LiIpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKG1hc2spIHsKICAgICAgaWYgKG1hc2sgaW5zdGFuY2VvZiBCYXNlU3RyZWFtIHx8IEFycmF5LmlzQXJyYXkobWFzaykpIHsKICAgICAgICBtYXNrRGF0YSA9IG1hc2s7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2FybigiVW5zdXBwb3J0ZWQgL01hc2sgZm9ybWF0LiIpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbmV3IFBERkltYWdlKHsKICAgICAgeHJlZiwKICAgICAgcmVzLAogICAgICBpbWFnZTogaW1hZ2VEYXRhLAogICAgICBpc0lubGluZSwKICAgICAgc21hc2s6IHNtYXNrRGF0YSwKICAgICAgbWFzazogbWFza0RhdGEsCiAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgfSk7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVNYXNrKHsKICAgIGltYWdlLAogICAgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgPSBmYWxzZQogIH0pIHsKICAgIGNvbnN0IHsKICAgICAgZGljdAogICAgfSA9IGltYWdlOwogICAgY29uc3Qgd2lkdGggPSBkaWN0LmdldCgiVyIsICJXaWR0aCIpOwogICAgY29uc3QgaGVpZ2h0ID0gZGljdC5nZXQoIkgiLCAiSGVpZ2h0Iik7CiAgICBjb25zdCBpbnRlcnBvbGF0ZSA9IGRpY3QuZ2V0KCJJIiwgIkludGVycG9sYXRlIik7CiAgICBjb25zdCBkZWNvZGUgPSBkaWN0LmdldEFycmF5KCJEIiwgIkRlY29kZSIpOwogICAgY29uc3QgaW52ZXJzZURlY29kZSA9IGRlY29kZT8uWzBdID4gMDsKICAgIGNvbnN0IGNvbXB1dGVkTGVuZ3RoID0gKHdpZHRoICsgNyA+PiAzKSAqIGhlaWdodDsKICAgIGNvbnN0IGltZ0FycmF5ID0gaW1hZ2UuZ2V0Qnl0ZXMoY29tcHV0ZWRMZW5ndGgpOwogICAgY29uc3QgaXNTaW5nbGVPcGFxdWVQaXhlbCA9IHdpZHRoID09PSAxICYmIGhlaWdodCA9PT0gMSAmJiBpbnZlcnNlRGVjb2RlID09PSAoaW1nQXJyYXkubGVuZ3RoID09PSAwIHx8ICEhKGltZ0FycmF5WzBdICYgMTI4KSk7CiAgICBpZiAoaXNTaW5nbGVPcGFxdWVQaXhlbCkgewogICAgICByZXR1cm4gewogICAgICAgIGlzU2luZ2xlT3BhcXVlUGl4ZWwKICAgICAgfTsKICAgIH0KICAgIGlmIChpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCkgewogICAgICBpZiAoSW1hZ2VSZXNpemVyLm5lZWRzVG9CZVJlc2l6ZWQod2lkdGgsIGhlaWdodCkpIHsKICAgICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHdpZHRoICogaGVpZ2h0ICogNCk7CiAgICAgICAgY29udmVydEJsYWNrQW5kV2hpdGVUb1JHQkEoewogICAgICAgICAgc3JjOiBpbWdBcnJheSwKICAgICAgICAgIGRlc3Q6IGRhdGEsCiAgICAgICAgICB3aWR0aCwKICAgICAgICAgIGhlaWdodCwKICAgICAgICAgIG5vbkJsYWNrQ29sb3I6IDAsCiAgICAgICAgICBpbnZlcnNlRGVjb2RlCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIEltYWdlUmVzaXplci5jcmVhdGVJbWFnZSh7CiAgICAgICAgICBraW5kOiBJbWFnZUtpbmQuUkdCQV8zMkJQUCwKICAgICAgICAgIGRhdGEsCiAgICAgICAgICB3aWR0aCwKICAgICAgICAgIGhlaWdodCwKICAgICAgICAgIGludGVycG9sYXRlCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgY29uc3QgY2FudmFzID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsKICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICAgIGNvbnN0IGltZ0RhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKHdpZHRoLCBoZWlnaHQpOwogICAgICBjb252ZXJ0QmxhY2tBbmRXaGl0ZVRvUkdCQSh7CiAgICAgICAgc3JjOiBpbWdBcnJheSwKICAgICAgICBkZXN0OiBpbWdEYXRhLmRhdGEsCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0LAogICAgICAgIG5vbkJsYWNrQ29sb3I6IDAsCiAgICAgICAgaW52ZXJzZURlY29kZQogICAgICB9KTsKICAgICAgY3R4LnB1dEltYWdlRGF0YShpbWdEYXRhLCAwLCAwKTsKICAgICAgY29uc3QgYml0bWFwID0gY2FudmFzLnRyYW5zZmVyVG9JbWFnZUJpdG1hcCgpOwogICAgICByZXR1cm4gewogICAgICAgIGRhdGE6IG51bGwsCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0LAogICAgICAgIGludGVycG9sYXRlLAogICAgICAgIGJpdG1hcAogICAgICB9OwogICAgfQogICAgY29uc3QgYWN0dWFsTGVuZ3RoID0gaW1nQXJyYXkuYnl0ZUxlbmd0aDsKICAgIGNvbnN0IGhhdmVGdWxsRGF0YSA9IGNvbXB1dGVkTGVuZ3RoID09PSBhY3R1YWxMZW5ndGg7CiAgICBsZXQgZGF0YTsKICAgIGlmIChpbWFnZSBpbnN0YW5jZW9mIERlY29kZVN0cmVhbSAmJiAoIWludmVyc2VEZWNvZGUgfHwgaGF2ZUZ1bGxEYXRhKSkgewogICAgICBkYXRhID0gaW1nQXJyYXk7CiAgICB9IGVsc2UgaWYgKCFpbnZlcnNlRGVjb2RlKSB7CiAgICAgIGRhdGEgPSBuZXcgVWludDhBcnJheShpbWdBcnJheSk7CiAgICB9IGVsc2UgewogICAgICBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoY29tcHV0ZWRMZW5ndGgpOwogICAgICBkYXRhLnNldChpbWdBcnJheSk7CiAgICAgIGRhdGEuZmlsbCgweGZmLCBhY3R1YWxMZW5ndGgpOwogICAgfQogICAgaWYgKGludmVyc2VEZWNvZGUpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhY3R1YWxMZW5ndGg7IGkrKykgewogICAgICAgIGRhdGFbaV0gXj0gMHhmZjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgZGF0YSwKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodCwKICAgICAgaW50ZXJwb2xhdGUKICAgIH07CiAgfQogIGdldCBkcmF3V2lkdGgoKSB7CiAgICByZXR1cm4gTWF0aC5tYXgodGhpcy53aWR0aCwgdGhpcy5zbWFzaz8ud2lkdGggfHwgMCwgdGhpcy5tYXNrPy53aWR0aCB8fCAwKTsKICB9CiAgZ2V0IGRyYXdIZWlnaHQoKSB7CiAgICByZXR1cm4gTWF0aC5tYXgodGhpcy5oZWlnaHQsIHRoaXMuc21hc2s/LmhlaWdodCB8fCAwLCB0aGlzLm1hc2s/LmhlaWdodCB8fCAwKTsKICB9CiAgZGVjb2RlQnVmZmVyKGJ1ZmZlcikgewogICAgY29uc3QgYnBjID0gdGhpcy5icGM7CiAgICBjb25zdCBudW1Db21wcyA9IHRoaXMubnVtQ29tcHM7CiAgICBjb25zdCBkZWNvZGVBZGRlbmRzID0gdGhpcy5kZWNvZGVBZGRlbmRzOwogICAgY29uc3QgZGVjb2RlQ29lZmZpY2llbnRzID0gdGhpcy5kZWNvZGVDb2VmZmljaWVudHM7CiAgICBjb25zdCBtYXggPSAoMSA8PCBicGMpIC0gMTsKICAgIGxldCBpLCBpaTsKICAgIGlmIChicGMgPT09IDEpIHsKICAgICAgZm9yIChpID0gMCwgaWkgPSBidWZmZXIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGJ1ZmZlcltpXSA9ICshYnVmZmVyW2ldOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBpbmRleCA9IDA7CiAgICBmb3IgKGkgPSAwLCBpaSA9IHRoaXMud2lkdGggKiB0aGlzLmhlaWdodDsgaSA8IGlpOyBpKyspIHsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBudW1Db21wczsgaisrKSB7CiAgICAgICAgYnVmZmVyW2luZGV4XSA9IE1hdGhDbGFtcChkZWNvZGVBZGRlbmRzW2pdICsgYnVmZmVyW2luZGV4XSAqIGRlY29kZUNvZWZmaWNpZW50c1tqXSwgMCwgbWF4KTsKICAgICAgICBpbmRleCsrOwogICAgICB9CiAgICB9CiAgfQogIGdldENvbXBvbmVudHMoYnVmZmVyKSB7CiAgICBjb25zdCBicGMgPSB0aGlzLmJwYzsKICAgIGlmIChicGMgPT09IDgpIHsKICAgICAgcmV0dXJuIGJ1ZmZlcjsKICAgIH0KICAgIGNvbnN0IHdpZHRoID0gdGhpcy53aWR0aDsKICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuaGVpZ2h0OwogICAgY29uc3QgbnVtQ29tcHMgPSB0aGlzLm51bUNvbXBzOwogICAgY29uc3QgbGVuZ3RoID0gd2lkdGggKiBoZWlnaHQgKiBudW1Db21wczsKICAgIGxldCBidWZmZXJQb3MgPSAwOwogICAgbGV0IG91dHB1dDsKICAgIGlmIChicGMgPD0gOCkgewogICAgICBvdXRwdXQgPSBuZXcgVWludDhBcnJheShsZW5ndGgpOwogICAgfSBlbHNlIGlmIChicGMgPD0gMTYpIHsKICAgICAgb3V0cHV0ID0gbmV3IFVpbnQxNkFycmF5KGxlbmd0aCk7CiAgICB9IGVsc2UgewogICAgICBvdXRwdXQgPSBuZXcgVWludDMyQXJyYXkobGVuZ3RoKTsKICAgIH0KICAgIGNvbnN0IHJvd0NvbXBzID0gd2lkdGggKiBudW1Db21wczsKICAgIGNvbnN0IG1heCA9ICgxIDw8IGJwYykgLSAxOwogICAgbGV0IGkgPSAwLAogICAgICBpaSwKICAgICAgYnVmOwogICAgaWYgKGJwYyA9PT0gMSkgewogICAgICBsZXQgbWFzaywgbG9vcDFFbmQsIGxvb3AyRW5kOwogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGhlaWdodDsgaisrKSB7CiAgICAgICAgbG9vcDFFbmQgPSBpICsgKHJvd0NvbXBzICYgfjcpOwogICAgICAgIGxvb3AyRW5kID0gaSArIHJvd0NvbXBzOwogICAgICAgIHdoaWxlIChpIDwgbG9vcDFFbmQpIHsKICAgICAgICAgIGJ1ZiA9IGJ1ZmZlcltidWZmZXJQb3MrK107CiAgICAgICAgICBvdXRwdXRbaV0gPSBidWYgPj4gNyAmIDE7CiAgICAgICAgICBvdXRwdXRbaSArIDFdID0gYnVmID4+IDYgJiAxOwogICAgICAgICAgb3V0cHV0W2kgKyAyXSA9IGJ1ZiA+PiA1ICYgMTsKICAgICAgICAgIG91dHB1dFtpICsgM10gPSBidWYgPj4gNCAmIDE7CiAgICAgICAgICBvdXRwdXRbaSArIDRdID0gYnVmID4+IDMgJiAxOwogICAgICAgICAgb3V0cHV0W2kgKyA1XSA9IGJ1ZiA+PiAyICYgMTsKICAgICAgICAgIG91dHB1dFtpICsgNl0gPSBidWYgPj4gMSAmIDE7CiAgICAgICAgICBvdXRwdXRbaSArIDddID0gYnVmICYgMTsKICAgICAgICAgIGkgKz0gODsKICAgICAgICB9CiAgICAgICAgaWYgKGkgPCBsb29wMkVuZCkgewogICAgICAgICAgYnVmID0gYnVmZmVyW2J1ZmZlclBvcysrXTsKICAgICAgICAgIG1hc2sgPSAxMjg7CiAgICAgICAgICB3aGlsZSAoaSA8IGxvb3AyRW5kKSB7CiAgICAgICAgICAgIG91dHB1dFtpKytdID0gKyEhKGJ1ZiAmIG1hc2spOwogICAgICAgICAgICBtYXNrID4+PSAxOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbGV0IGJpdHMgPSAwOwogICAgICBidWYgPSAwOwogICAgICBmb3IgKGkgPSAwLCBpaSA9IGxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICBpZiAoaSAlIHJvd0NvbXBzID09PSAwKSB7CiAgICAgICAgICBidWYgPSAwOwogICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgfQogICAgICAgIHdoaWxlIChiaXRzIDwgYnBjKSB7CiAgICAgICAgICBidWYgPSBidWYgPDwgOCB8IGJ1ZmZlcltidWZmZXJQb3MrK107CiAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHJlbWFpbmluZ0JpdHMgPSBiaXRzIC0gYnBjOwogICAgICAgIGxldCB2YWx1ZSA9IGJ1ZiA+PiByZW1haW5pbmdCaXRzOwogICAgICAgIGlmICh2YWx1ZSA8IDApIHsKICAgICAgICAgIHZhbHVlID0gMDsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID4gbWF4KSB7CiAgICAgICAgICB2YWx1ZSA9IG1heDsKICAgICAgICB9CiAgICAgICAgb3V0cHV0W2ldID0gdmFsdWU7CiAgICAgICAgYnVmICY9ICgxIDw8IHJlbWFpbmluZ0JpdHMpIC0gMTsKICAgICAgICBiaXRzID0gcmVtYWluaW5nQml0czsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG91dHB1dDsKICB9CiAgYXN5bmMgZmlsbE9wYWNpdHkocmdiYUJ1Ziwgd2lkdGgsIGhlaWdodCwgYWN0dWFsSGVpZ2h0LCBpbWFnZSkgewogICAgY29uc3Qgc21hc2sgPSB0aGlzLnNtYXNrOwogICAgY29uc3QgbWFzayA9IHRoaXMubWFzazsKICAgIGxldCBhbHBoYUJ1Ziwgc3csIHNoLCBpLCBpaSwgajsKICAgIGlmIChzbWFzaykgewogICAgICBzdyA9IHNtYXNrLndpZHRoOwogICAgICBzaCA9IHNtYXNrLmhlaWdodDsKICAgICAgYWxwaGFCdWYgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoc3cgKiBzaCk7CiAgICAgIGF3YWl0IHNtYXNrLmZpbGxHcmF5QnVmZmVyKGFscGhhQnVmKTsKICAgICAgaWYgKHN3ICE9PSB3aWR0aCB8fCBzaCAhPT0gaGVpZ2h0KSB7CiAgICAgICAgYWxwaGFCdWYgPSByZXNpemVJbWFnZU1hc2soYWxwaGFCdWYsIHNtYXNrLmJwYywgc3csIHNoLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgfQogICAgfSBlbHNlIGlmIChtYXNrKSB7CiAgICAgIGlmIChtYXNrIGluc3RhbmNlb2YgUERGSW1hZ2UpIHsKICAgICAgICBzdyA9IG1hc2sud2lkdGg7CiAgICAgICAgc2ggPSBtYXNrLmhlaWdodDsKICAgICAgICBhbHBoYUJ1ZiA9IG5ldyBVaW50OENsYW1wZWRBcnJheShzdyAqIHNoKTsKICAgICAgICBtYXNrLm51bUNvbXBzID0gMTsKICAgICAgICBhd2FpdCBtYXNrLmZpbGxHcmF5QnVmZmVyKGFscGhhQnVmKTsKICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHN3ICogc2g7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgICBhbHBoYUJ1ZltpXSA9IDI1NSAtIGFscGhhQnVmW2ldOwogICAgICAgIH0KICAgICAgICBpZiAoc3cgIT09IHdpZHRoIHx8IHNoICE9PSBoZWlnaHQpIHsKICAgICAgICAgIGFscGhhQnVmID0gcmVzaXplSW1hZ2VNYXNrKGFscGhhQnVmLCBtYXNrLmJwYywgc3csIHNoLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShtYXNrKSkgewogICAgICAgIGFscGhhQnVmID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHdpZHRoICogaGVpZ2h0KTsKICAgICAgICBjb25zdCBudW1Db21wcyA9IHRoaXMubnVtQ29tcHM7CiAgICAgICAgZm9yIChpID0gMCwgaWkgPSB3aWR0aCAqIGhlaWdodDsgaSA8IGlpOyArK2kpIHsKICAgICAgICAgIGxldCBvcGFjaXR5ID0gMDsKICAgICAgICAgIGNvbnN0IGltYWdlT2Zmc2V0ID0gaSAqIG51bUNvbXBzOwogICAgICAgICAgZm9yIChqID0gMDsgaiA8IG51bUNvbXBzOyArK2opIHsKICAgICAgICAgICAgY29uc3QgY29sb3IgPSBpbWFnZVtpbWFnZU9mZnNldCArIGpdOwogICAgICAgICAgICBjb25zdCBtYXNrT2Zmc2V0ID0gaiAqIDI7CiAgICAgICAgICAgIGlmIChjb2xvciA8IG1hc2tbbWFza09mZnNldF0gfHwgY29sb3IgPiBtYXNrW21hc2tPZmZzZXQgKyAxXSkgewogICAgICAgICAgICAgIG9wYWNpdHkgPSAyNTU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGFscGhhQnVmW2ldID0gb3BhY2l0eTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJVbmtub3duIG1hc2sgZm9ybWF0LiIpOwogICAgICB9CiAgICB9CiAgICBpZiAoYWxwaGFCdWYpIHsKICAgICAgZm9yIChpID0gMCwgaiA9IDMsIGlpID0gd2lkdGggKiBhY3R1YWxIZWlnaHQ7IGkgPCBpaTsgKytpLCBqICs9IDQpIHsKICAgICAgICByZ2JhQnVmW2pdID0gYWxwaGFCdWZbaV07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGZvciAoaSA9IDAsIGogPSAzLCBpaSA9IHdpZHRoICogYWN0dWFsSGVpZ2h0OyBpIDwgaWk7ICsraSwgaiArPSA0KSB7CiAgICAgICAgcmdiYUJ1ZltqXSA9IDI1NTsKICAgICAgfQogICAgfQogIH0KICB1bmRvUHJlYmxlbmQoYnVmZmVyLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICBjb25zdCBtYXR0ZSA9IHRoaXMuc21hc2s/Lm1hdHRlOwogICAgaWYgKCFtYXR0ZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBtYXR0ZVJnYiA9IHRoaXMuY29sb3JTcGFjZS5nZXRSZ2IobWF0dGUsIDApOwogICAgY29uc3QgbWF0dGVSID0gbWF0dGVSZ2JbMF07CiAgICBjb25zdCBtYXR0ZUcgPSBtYXR0ZVJnYlsxXTsKICAgIGNvbnN0IG1hdHRlQiA9IG1hdHRlUmdiWzJdOwogICAgY29uc3QgbGVuZ3RoID0gd2lkdGggKiBoZWlnaHQgKiA0OwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gNCkgewogICAgICBjb25zdCBhbHBoYSA9IGJ1ZmZlcltpICsgM107CiAgICAgIGlmIChhbHBoYSA9PT0gMCkgewogICAgICAgIGJ1ZmZlcltpXSA9IDI1NTsKICAgICAgICBidWZmZXJbaSArIDFdID0gMjU1OwogICAgICAgIGJ1ZmZlcltpICsgMl0gPSAyNTU7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgayA9IDI1NSAvIGFscGhhOwogICAgICBidWZmZXJbaV0gPSAoYnVmZmVyW2ldIC0gbWF0dGVSKSAqIGsgKyBtYXR0ZVI7CiAgICAgIGJ1ZmZlcltpICsgMV0gPSAoYnVmZmVyW2kgKyAxXSAtIG1hdHRlRykgKiBrICsgbWF0dGVHOwogICAgICBidWZmZXJbaSArIDJdID0gKGJ1ZmZlcltpICsgMl0gLSBtYXR0ZUIpICogayArIG1hdHRlQjsKICAgIH0KICB9CiAgYXN5bmMgY3JlYXRlSW1hZ2VEYXRhKGZvcmNlUkdCQSA9IGZhbHNlLCBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCA9IGZhbHNlKSB7CiAgICBjb25zdCBkcmF3V2lkdGggPSB0aGlzLmRyYXdXaWR0aDsKICAgIGNvbnN0IGRyYXdIZWlnaHQgPSB0aGlzLmRyYXdIZWlnaHQ7CiAgICBjb25zdCBpbWdEYXRhID0gewogICAgICB3aWR0aDogZHJhd1dpZHRoLAogICAgICBoZWlnaHQ6IGRyYXdIZWlnaHQsCiAgICAgIGludGVycG9sYXRlOiB0aGlzLmludGVycG9sYXRlLAogICAgICBraW5kOiAwLAogICAgICBkYXRhOiBudWxsCiAgICB9OwogICAgY29uc3QgbnVtQ29tcHMgPSB0aGlzLm51bUNvbXBzOwogICAgY29uc3Qgb3JpZ2luYWxXaWR0aCA9IHRoaXMud2lkdGg7CiAgICBjb25zdCBvcmlnaW5hbEhlaWdodCA9IHRoaXMuaGVpZ2h0OwogICAgY29uc3QgYnBjID0gdGhpcy5icGM7CiAgICBjb25zdCByb3dCeXRlcyA9IG9yaWdpbmFsV2lkdGggKiBudW1Db21wcyAqIGJwYyArIDcgPj4gMzsKICAgIGNvbnN0IG11c3RCZVJlc2l6ZWQgPSBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCAmJiBJbWFnZVJlc2l6ZXIubmVlZHNUb0JlUmVzaXplZChkcmF3V2lkdGgsIGRyYXdIZWlnaHQpOwogICAgaWYgKCF0aGlzLnNtYXNrICYmICF0aGlzLm1hc2sgJiYgdGhpcy5jb2xvclNwYWNlLm5hbWUgPT09ICJEZXZpY2VSR0JBIikgewogICAgICBpbWdEYXRhLmtpbmQgPSBJbWFnZUtpbmQuUkdCQV8zMkJQUDsKICAgICAgY29uc3QgaW1nQXJyYXkgPSBpbWdEYXRhLmRhdGEgPSBhd2FpdCB0aGlzLmdldEltYWdlQnl0ZXMob3JpZ2luYWxIZWlnaHQgKiBvcmlnaW5hbFdpZHRoICogNCwge30pOwogICAgICBpZiAoaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpIHsKICAgICAgICBpZiAoIW11c3RCZVJlc2l6ZWQpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUJpdG1hcChJbWFnZUtpbmQuUkdCQV8zMkJQUCwgZHJhd1dpZHRoLCBkcmF3SGVpZ2h0LCBpbWdBcnJheSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBJbWFnZVJlc2l6ZXIuY3JlYXRlSW1hZ2UoaW1nRGF0YSwgZmFsc2UpOwogICAgICB9CiAgICAgIHJldHVybiBpbWdEYXRhOwogICAgfQogICAgaWYgKCFmb3JjZVJHQkEpIHsKICAgICAgbGV0IGtpbmQ7CiAgICAgIGlmICh0aGlzLmNvbG9yU3BhY2UubmFtZSA9PT0gIkRldmljZUdyYXkiICYmIGJwYyA9PT0gMSkgewogICAgICAgIGtpbmQgPSBJbWFnZUtpbmQuR1JBWVNDQUxFXzFCUFA7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5jb2xvclNwYWNlLm5hbWUgPT09ICJEZXZpY2VSR0IiICYmIGJwYyA9PT0gOCAmJiAhdGhpcy5uZWVkc0RlY29kZSkgewogICAgICAgIGtpbmQgPSBJbWFnZUtpbmQuUkdCXzI0QlBQOwogICAgICB9CiAgICAgIGlmIChraW5kICYmICF0aGlzLnNtYXNrICYmICF0aGlzLm1hc2sgJiYgZHJhd1dpZHRoID09PSBvcmlnaW5hbFdpZHRoICYmIGRyYXdIZWlnaHQgPT09IG9yaWdpbmFsSGVpZ2h0KSB7CiAgICAgICAgY29uc3QgaW1hZ2UgPSBhd2FpdCB0aGlzLiNnZXRJbWFnZShvcmlnaW5hbFdpZHRoLCBvcmlnaW5hbEhlaWdodCk7CiAgICAgICAgaWYgKGltYWdlKSB7CiAgICAgICAgICByZXR1cm4gaW1hZ2U7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLmdldEltYWdlQnl0ZXMob3JpZ2luYWxIZWlnaHQgKiByb3dCeXRlcywge30pOwogICAgICAgIGlmIChpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCkgewogICAgICAgICAgaWYgKG11c3RCZVJlc2l6ZWQpIHsKICAgICAgICAgICAgcmV0dXJuIEltYWdlUmVzaXplci5jcmVhdGVJbWFnZSh7CiAgICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgICBraW5kLAogICAgICAgICAgICAgIHdpZHRoOiBkcmF3V2lkdGgsCiAgICAgICAgICAgICAgaGVpZ2h0OiBkcmF3SGVpZ2h0LAogICAgICAgICAgICAgIGludGVycG9sYXRlOiB0aGlzLmludGVycG9sYXRlCiAgICAgICAgICAgIH0sIHRoaXMubmVlZHNEZWNvZGUpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlQml0bWFwKGtpbmQsIG9yaWdpbmFsV2lkdGgsIG9yaWdpbmFsSGVpZ2h0LCBkYXRhKTsKICAgICAgICB9CiAgICAgICAgaW1nRGF0YS5raW5kID0ga2luZDsKICAgICAgICBpbWdEYXRhLmRhdGEgPSBkYXRhOwogICAgICAgIGlmICh0aGlzLm5lZWRzRGVjb2RlKSB7CiAgICAgICAgICBhc3NlcnQoa2luZCA9PT0gSW1hZ2VLaW5kLkdSQVlTQ0FMRV8xQlBQLCAiUERGSW1hZ2UuY3JlYXRlSW1hZ2VEYXRhOiBUaGUgaW1hZ2UgbXVzdCBiZSBncmF5c2NhbGUuIik7CiAgICAgICAgICBjb25zdCBidWZmZXIgPSBpbWdEYXRhLmRhdGE7CiAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBidWZmZXIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICBidWZmZXJbaV0gXj0gMHhmZjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGltZ0RhdGE7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuaW1hZ2UgaW5zdGFuY2VvZiBKcGVnU3RyZWFtICYmICF0aGlzLnNtYXNrICYmICF0aGlzLm1hc2sgJiYgIXRoaXMubmVlZHNEZWNvZGUpIHsKICAgICAgICBsZXQgaW1hZ2VMZW5ndGggPSBvcmlnaW5hbEhlaWdodCAqIHJvd0J5dGVzOwogICAgICAgIGlmIChpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCAmJiAhbXVzdEJlUmVzaXplZCkgewogICAgICAgICAgbGV0IGlzSGFuZGxlZCA9IGZhbHNlOwogICAgICAgICAgc3dpdGNoICh0aGlzLmNvbG9yU3BhY2UubmFtZSkgewogICAgICAgICAgICBjYXNlICJEZXZpY2VHcmF5IjoKICAgICAgICAgICAgICBpbWFnZUxlbmd0aCAqPSA0OwogICAgICAgICAgICAgIGlzSGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIkRldmljZVJHQiI6CiAgICAgICAgICAgICAgaW1hZ2VMZW5ndGggPSBpbWFnZUxlbmd0aCAvIDMgKiA0OwogICAgICAgICAgICAgIGlzSGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIkRldmljZUNNWUsiOgogICAgICAgICAgICAgIGlzSGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaXNIYW5kbGVkKSB7CiAgICAgICAgICAgIGNvbnN0IGltYWdlID0gYXdhaXQgdGhpcy4jZ2V0SW1hZ2UoZHJhd1dpZHRoLCBkcmF3SGVpZ2h0KTsKICAgICAgICAgICAgaWYgKGltYWdlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGltYWdlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHJnYmEgPSBhd2FpdCB0aGlzLmdldEltYWdlQnl0ZXMoaW1hZ2VMZW5ndGgsIHsKICAgICAgICAgICAgICBkcmF3V2lkdGgsCiAgICAgICAgICAgICAgZHJhd0hlaWdodCwKICAgICAgICAgICAgICBmb3JjZVJHQkE6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUJpdG1hcChJbWFnZUtpbmQuUkdCQV8zMkJQUCwgZHJhd1dpZHRoLCBkcmF3SGVpZ2h0LCByZ2JhKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3dpdGNoICh0aGlzLmNvbG9yU3BhY2UubmFtZSkgewogICAgICAgICAgICBjYXNlICJEZXZpY2VHcmF5IjoKICAgICAgICAgICAgICBpbWFnZUxlbmd0aCAqPSAzOwogICAgICAgICAgICBjYXNlICJEZXZpY2VSR0IiOgogICAgICAgICAgICBjYXNlICJEZXZpY2VDTVlLIjoKICAgICAgICAgICAgICBpbWdEYXRhLmtpbmQgPSBJbWFnZUtpbmQuUkdCXzI0QlBQOwogICAgICAgICAgICAgIGltZ0RhdGEuZGF0YSA9IGF3YWl0IHRoaXMuZ2V0SW1hZ2VCeXRlcyhpbWFnZUxlbmd0aCwgewogICAgICAgICAgICAgICAgZHJhd1dpZHRoLAogICAgICAgICAgICAgICAgZHJhd0hlaWdodCwKICAgICAgICAgICAgICAgIGZvcmNlUkdCOiB0cnVlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgaWYgKG11c3RCZVJlc2l6ZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBJbWFnZVJlc2l6ZXIuY3JlYXRlSW1hZ2UoaW1nRGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBpbWdEYXRhOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY29uc3QgaW1nQXJyYXkgPSBhd2FpdCB0aGlzLmdldEltYWdlQnl0ZXMob3JpZ2luYWxIZWlnaHQgKiByb3dCeXRlcywgewogICAgICBpbnRlcm5hbDogdHJ1ZQogICAgfSk7CiAgICBjb25zdCBhY3R1YWxIZWlnaHQgPSAwIHwgaW1nQXJyYXkubGVuZ3RoIC8gcm93Qnl0ZXMgKiBkcmF3SGVpZ2h0IC8gb3JpZ2luYWxIZWlnaHQ7CiAgICBjb25zdCBjb21wcyA9IHRoaXMuZ2V0Q29tcG9uZW50cyhpbWdBcnJheSk7CiAgICBsZXQgYWxwaGEwMSwgbWF5YmVVbmRvUHJlYmxlbmQ7CiAgICBsZXQgY2FudmFzLCBjdHgsIGNhbnZhc0ltZ0RhdGEsIGRhdGE7CiAgICBpZiAoaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgJiYgIW11c3RCZVJlc2l6ZWQpIHsKICAgICAgY2FudmFzID0gbmV3IE9mZnNjcmVlbkNhbnZhcyhkcmF3V2lkdGgsIGRyYXdIZWlnaHQpOwogICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgY2FudmFzSW1nRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEoZHJhd1dpZHRoLCBkcmF3SGVpZ2h0KTsKICAgICAgZGF0YSA9IGNhbnZhc0ltZ0RhdGEuZGF0YTsKICAgIH0KICAgIGltZ0RhdGEua2luZCA9IEltYWdlS2luZC5SR0JBXzMyQlBQOwogICAgaWYgKCFmb3JjZVJHQkEgJiYgIXRoaXMuc21hc2sgJiYgIXRoaXMubWFzaykgewogICAgICBpZiAoIWlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkIHx8IG11c3RCZVJlc2l6ZWQpIHsKICAgICAgICBpbWdEYXRhLmtpbmQgPSBJbWFnZUtpbmQuUkdCXzI0QlBQOwogICAgICAgIGRhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoZHJhd1dpZHRoICogZHJhd0hlaWdodCAqIDMpOwogICAgICAgIGFscGhhMDEgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGFyciA9IG5ldyBVaW50MzJBcnJheShkYXRhLmJ1ZmZlcik7CiAgICAgICAgYXJyLmZpbGwoRmVhdHVyZVRlc3QuaXNMaXR0bGVFbmRpYW4gPyAweGZmMDAwMDAwIDogMHgwMDAwMDBmZik7CiAgICAgICAgYWxwaGEwMSA9IDE7CiAgICAgIH0KICAgICAgbWF5YmVVbmRvUHJlYmxlbmQgPSBmYWxzZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgfHwgbXVzdEJlUmVzaXplZCkgewogICAgICAgIGRhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoZHJhd1dpZHRoICogZHJhd0hlaWdodCAqIDQpOwogICAgICB9CiAgICAgIGFscGhhMDEgPSAxOwogICAgICBtYXliZVVuZG9QcmVibGVuZCA9IHRydWU7CiAgICAgIGF3YWl0IHRoaXMuZmlsbE9wYWNpdHkoZGF0YSwgZHJhd1dpZHRoLCBkcmF3SGVpZ2h0LCBhY3R1YWxIZWlnaHQsIGNvbXBzKTsKICAgIH0KICAgIGlmICh0aGlzLm5lZWRzRGVjb2RlKSB7CiAgICAgIHRoaXMuZGVjb2RlQnVmZmVyKGNvbXBzKTsKICAgIH0KICAgIHRoaXMuY29sb3JTcGFjZS5maWxsUmdiKGRhdGEsIG9yaWdpbmFsV2lkdGgsIG9yaWdpbmFsSGVpZ2h0LCBkcmF3V2lkdGgsIGRyYXdIZWlnaHQsIGFjdHVhbEhlaWdodCwgYnBjLCBjb21wcywgYWxwaGEwMSk7CiAgICBpZiAobWF5YmVVbmRvUHJlYmxlbmQpIHsKICAgICAgdGhpcy51bmRvUHJlYmxlbmQoZGF0YSwgZHJhd1dpZHRoLCBhY3R1YWxIZWlnaHQpOwogICAgfQogICAgaWYgKGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkICYmICFtdXN0QmVSZXNpemVkKSB7CiAgICAgIGN0eC5wdXRJbWFnZURhdGEoY2FudmFzSW1nRGF0YSwgMCwgMCk7CiAgICAgIGNvbnN0IGJpdG1hcCA9IGNhbnZhcy50cmFuc2ZlclRvSW1hZ2VCaXRtYXAoKTsKICAgICAgcmV0dXJuIHsKICAgICAgICBkYXRhOiBudWxsLAogICAgICAgIHdpZHRoOiBkcmF3V2lkdGgsCiAgICAgICAgaGVpZ2h0OiBkcmF3SGVpZ2h0LAogICAgICAgIGJpdG1hcCwKICAgICAgICBpbnRlcnBvbGF0ZTogdGhpcy5pbnRlcnBvbGF0ZQogICAgICB9OwogICAgfQogICAgaW1nRGF0YS5kYXRhID0gZGF0YTsKICAgIGlmIChtdXN0QmVSZXNpemVkKSB7CiAgICAgIHJldHVybiBJbWFnZVJlc2l6ZXIuY3JlYXRlSW1hZ2UoaW1nRGF0YSk7CiAgICB9CiAgICByZXR1cm4gaW1nRGF0YTsKICB9CiAgYXN5bmMgZmlsbEdyYXlCdWZmZXIoYnVmZmVyKSB7CiAgICBjb25zdCBudW1Db21wcyA9IHRoaXMubnVtQ29tcHM7CiAgICBpZiAobnVtQ29tcHMgIT09IDEpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBSZWFkaW5nIGdyYXkgc2NhbGUgZnJvbSBhIGNvbG9yIGltYWdlOiAke251bUNvbXBzfWApOwogICAgfQogICAgY29uc3Qgd2lkdGggPSB0aGlzLndpZHRoOwogICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7CiAgICBjb25zdCBicGMgPSB0aGlzLmJwYzsKICAgIGNvbnN0IHJvd0J5dGVzID0gd2lkdGggKiBudW1Db21wcyAqIGJwYyArIDcgPj4gMzsKICAgIGNvbnN0IGltZ0FycmF5ID0gYXdhaXQgdGhpcy5nZXRJbWFnZUJ5dGVzKGhlaWdodCAqIHJvd0J5dGVzLCB7CiAgICAgIGludGVybmFsOiB0cnVlCiAgICB9KTsKICAgIGNvbnN0IGNvbXBzID0gdGhpcy5nZXRDb21wb25lbnRzKGltZ0FycmF5KTsKICAgIGxldCBpLCBsZW5ndGg7CiAgICBpZiAoYnBjID09PSAxKSB7CiAgICAgIGxlbmd0aCA9IHdpZHRoICogaGVpZ2h0OwogICAgICBpZiAodGhpcy5uZWVkc0RlY29kZSkgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgYnVmZmVyW2ldID0gY29tcHNbaV0gLSAxICYgMjU1OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGJ1ZmZlcltpXSA9IC1jb21wc1tpXSAmIDI1NTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMubmVlZHNEZWNvZGUpIHsKICAgICAgdGhpcy5kZWNvZGVCdWZmZXIoY29tcHMpOwogICAgfQogICAgbGVuZ3RoID0gd2lkdGggKiBoZWlnaHQ7CiAgICBjb25zdCBzY2FsZSA9IDI1NSAvICgoMSA8PCBicGMpIC0gMSk7CiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgICAgYnVmZmVyW2ldID0gc2NhbGUgKiBjb21wc1tpXTsKICAgIH0KICB9CiAgY3JlYXRlQml0bWFwKGtpbmQsIHdpZHRoLCBoZWlnaHQsIHNyYykgewogICAgY29uc3QgY2FudmFzID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsKICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgbGV0IGltZ0RhdGE7CiAgICBpZiAoa2luZCA9PT0gSW1hZ2VLaW5kLlJHQkFfMzJCUFApIHsKICAgICAgaW1nRGF0YSA9IG5ldyBJbWFnZURhdGEoc3JjLCB3aWR0aCwgaGVpZ2h0KTsKICAgIH0gZWxzZSB7CiAgICAgIGltZ0RhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKHdpZHRoLCBoZWlnaHQpOwogICAgICBjb252ZXJ0VG9SR0JBKHsKICAgICAgICBraW5kLAogICAgICAgIHNyYywKICAgICAgICBkZXN0OiBuZXcgVWludDMyQXJyYXkoaW1nRGF0YS5kYXRhLmJ1ZmZlciksCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0LAogICAgICAgIGludmVyc2VEZWNvZGU6IHRoaXMubmVlZHNEZWNvZGUKICAgICAgfSk7CiAgICB9CiAgICBjdHgucHV0SW1hZ2VEYXRhKGltZ0RhdGEsIDAsIDApOwogICAgY29uc3QgYml0bWFwID0gY2FudmFzLnRyYW5zZmVyVG9JbWFnZUJpdG1hcCgpOwogICAgcmV0dXJuIHsKICAgICAgZGF0YTogbnVsbCwKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodCwKICAgICAgYml0bWFwLAogICAgICBpbnRlcnBvbGF0ZTogdGhpcy5pbnRlcnBvbGF0ZQogICAgfTsKICB9CiAgYXN5bmMgI2dldEltYWdlKHdpZHRoLCBoZWlnaHQpIHsKICAgIGNvbnN0IGJpdG1hcCA9IGF3YWl0IHRoaXMuaW1hZ2UuZ2V0VHJhbnNmZXJhYmxlSW1hZ2UoKTsKICAgIGlmICghYml0bWFwKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgZGF0YTogbnVsbCwKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodCwKICAgICAgYml0bWFwLAogICAgICBpbnRlcnBvbGF0ZTogdGhpcy5pbnRlcnBvbGF0ZQogICAgfTsKICB9CiAgYXN5bmMgZ2V0SW1hZ2VCeXRlcyhsZW5ndGgsIHsKICAgIGRyYXdXaWR0aCwKICAgIGRyYXdIZWlnaHQsCiAgICBmb3JjZVJHQkEgPSBmYWxzZSwKICAgIGZvcmNlUkdCID0gZmFsc2UsCiAgICBpbnRlcm5hbCA9IGZhbHNlCiAgfSkgewogICAgdGhpcy5pbWFnZS5yZXNldCgpOwogICAgdGhpcy5pbWFnZS5kcmF3V2lkdGggPSBkcmF3V2lkdGggfHwgdGhpcy53aWR0aDsKICAgIHRoaXMuaW1hZ2UuZHJhd0hlaWdodCA9IGRyYXdIZWlnaHQgfHwgdGhpcy5oZWlnaHQ7CiAgICB0aGlzLmltYWdlLmZvcmNlUkdCQSA9ICEhZm9yY2VSR0JBOwogICAgdGhpcy5pbWFnZS5mb3JjZVJHQiA9ICEhZm9yY2VSR0I7CiAgICBjb25zdCBpbWFnZUJ5dGVzID0gYXdhaXQgdGhpcy5pbWFnZS5nZXRJbWFnZURhdGEobGVuZ3RoLCB0aGlzLmpweERlY29kZXJPcHRpb25zKTsKICAgIGlmIChpbnRlcm5hbCB8fCB0aGlzLmltYWdlIGluc3RhbmNlb2YgRGVjb2RlU3RyZWFtKSB7CiAgICAgIHJldHVybiBpbWFnZUJ5dGVzOwogICAgfQogICAgYXNzZXJ0KGltYWdlQnl0ZXMgaW5zdGFuY2VvZiBVaW50OEFycmF5LCAnUERGSW1hZ2UuZ2V0SW1hZ2VCeXRlczogVW5zdXBwb3J0ZWQgImltYWdlQnl0ZXMiIHR5cGUuJyk7CiAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaW1hZ2VCeXRlcyk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9ldmFsdWF0b3IuanMKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpjb25zdCBEZWZhdWx0UGFydGlhbEV2YWx1YXRvck9wdGlvbnMgPSBPYmplY3QuZnJlZXplKHsKICBtYXhJbWFnZVNpemU6IC0xLAogIGRpc2FibGVGb250RmFjZTogZmFsc2UsCiAgaWdub3JlRXJyb3JzOiBmYWxzZSwKICBpc0V2YWxTdXBwb3J0ZWQ6IHRydWUsCiAgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQ6IGZhbHNlLAogIGlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkOiBmYWxzZSwKICBjYW52YXNNYXhBcmVhSW5CeXRlczogLTEsCiAgZm9udEV4dHJhUHJvcGVydGllczogZmFsc2UsCiAgdXNlU3lzdGVtRm9udHM6IHRydWUsCiAgdXNlV2FzbTogdHJ1ZSwKICB1c2VXb3JrZXJGZXRjaDogdHJ1ZSwKICBjTWFwVXJsOiBudWxsLAogIGljY1VybDogbnVsbCwKICBzdGFuZGFyZEZvbnREYXRhVXJsOiBudWxsLAogIHdhc21Vcmw6IG51bGwKfSk7CmNvbnN0IFBhdHRlcm5UeXBlID0gewogIFRJTElORzogMSwKICBTSEFESU5HOiAyCn07CmNvbnN0IFRFWFRfQ0hVTktfQkFUQ0hfU0laRSA9IDEwOwpjb25zdCBkZWZlcnJlZCA9IFByb21pc2UucmVzb2x2ZSgpOwpmdW5jdGlvbiBub3JtYWxpemVCbGVuZE1vZGUodmFsdWUsIHBhcnNpbmdBcnJheSA9IGZhbHNlKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICBmb3IgKGNvbnN0IHZhbCBvZiB2YWx1ZSkgewogICAgICBjb25zdCBtYXliZUJNID0gbm9ybWFsaXplQmxlbmRNb2RlKHZhbCwgdHJ1ZSk7CiAgICAgIGlmIChtYXliZUJNKSB7CiAgICAgICAgcmV0dXJuIG1heWJlQk07CiAgICAgIH0KICAgIH0KICAgIHdhcm4oYFVuc3VwcG9ydGVkIGJsZW5kIG1vZGUgQXJyYXk6ICR7dmFsdWV9YCk7CiAgICByZXR1cm4gInNvdXJjZS1vdmVyIjsKICB9CiAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgaWYgKHBhcnNpbmdBcnJheSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHJldHVybiAic291cmNlLW92ZXIiOwogIH0KICBzd2l0Y2ggKHZhbHVlLm5hbWUpIHsKICAgIGNhc2UgIk5vcm1hbCI6CiAgICBjYXNlICJDb21wYXRpYmxlIjoKICAgICAgcmV0dXJuICJzb3VyY2Utb3ZlciI7CiAgICBjYXNlICJNdWx0aXBseSI6CiAgICAgIHJldHVybiAibXVsdGlwbHkiOwogICAgY2FzZSAiU2NyZWVuIjoKICAgICAgcmV0dXJuICJzY3JlZW4iOwogICAgY2FzZSAiT3ZlcmxheSI6CiAgICAgIHJldHVybiAib3ZlcmxheSI7CiAgICBjYXNlICJEYXJrZW4iOgogICAgICByZXR1cm4gImRhcmtlbiI7CiAgICBjYXNlICJMaWdodGVuIjoKICAgICAgcmV0dXJuICJsaWdodGVuIjsKICAgIGNhc2UgIkNvbG9yRG9kZ2UiOgogICAgICByZXR1cm4gImNvbG9yLWRvZGdlIjsKICAgIGNhc2UgIkNvbG9yQnVybiI6CiAgICAgIHJldHVybiAiY29sb3ItYnVybiI7CiAgICBjYXNlICJIYXJkTGlnaHQiOgogICAgICByZXR1cm4gImhhcmQtbGlnaHQiOwogICAgY2FzZSAiU29mdExpZ2h0IjoKICAgICAgcmV0dXJuICJzb2Z0LWxpZ2h0IjsKICAgIGNhc2UgIkRpZmZlcmVuY2UiOgogICAgICByZXR1cm4gImRpZmZlcmVuY2UiOwogICAgY2FzZSAiRXhjbHVzaW9uIjoKICAgICAgcmV0dXJuICJleGNsdXNpb24iOwogICAgY2FzZSAiSHVlIjoKICAgICAgcmV0dXJuICJodWUiOwogICAgY2FzZSAiU2F0dXJhdGlvbiI6CiAgICAgIHJldHVybiAic2F0dXJhdGlvbiI7CiAgICBjYXNlICJDb2xvciI6CiAgICAgIHJldHVybiAiY29sb3IiOwogICAgY2FzZSAiTHVtaW5vc2l0eSI6CiAgICAgIHJldHVybiAibHVtaW5vc2l0eSI7CiAgfQogIGlmIChwYXJzaW5nQXJyYXkpIHsKICAgIHJldHVybiBudWxsOwogIH0KICB3YXJuKGBVbnN1cHBvcnRlZCBibGVuZCBtb2RlOiAke3ZhbHVlLm5hbWV9YCk7CiAgcmV0dXJuICJzb3VyY2Utb3ZlciI7Cn0KZnVuY3Rpb24gYWRkQ2FjaGVkSW1hZ2VPcHMob3BMaXN0LCB7CiAgb2JqSWQsCiAgZm4sCiAgYXJncywKICBvcHRpb25hbENvbnRlbnQsCiAgaGFzTWFzawp9KSB7CiAgaWYgKG9iaklkKSB7CiAgICBvcExpc3QuYWRkRGVwZW5kZW5jeShvYmpJZCk7CiAgfQogIG9wTGlzdC5hZGRJbWFnZU9wcyhmbiwgYXJncywgb3B0aW9uYWxDb250ZW50LCBoYXNNYXNrKTsKICBpZiAoZm4gPT09IE9QUy5wYWludEltYWdlTWFza1hPYmplY3QgJiYgYXJnc1swXT8uY291bnQgPiAwKSB7CiAgICBhcmdzWzBdLmNvdW50Kys7CiAgfQp9CmNsYXNzIFRpbWVTbG90TWFuYWdlciB7CiAgc3RhdGljIFRJTUVfU0xPVF9EVVJBVElPTl9NUyA9IDIwOwogIHN0YXRpYyBDSEVDS19USU1FX0VWRVJZID0gMTAwOwogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5yZXNldCgpOwogIH0KICBjaGVjaygpIHsKICAgIGlmICgrK3RoaXMuY2hlY2tlZCA8IFRpbWVTbG90TWFuYWdlci5DSEVDS19USU1FX0VWRVJZKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRoaXMuY2hlY2tlZCA9IDA7CiAgICByZXR1cm4gdGhpcy5lbmRUaW1lIDw9IERhdGUubm93KCk7CiAgfQogIHJlc2V0KCkgewogICAgdGhpcy5lbmRUaW1lID0gRGF0ZS5ub3coKSArIFRpbWVTbG90TWFuYWdlci5USU1FX1NMT1RfRFVSQVRJT05fTVM7CiAgICB0aGlzLmNoZWNrZWQgPSAwOwogIH0KfQpjbGFzcyBQYXJ0aWFsRXZhbHVhdG9yIHsKICBjb25zdHJ1Y3Rvcih7CiAgICB4cmVmLAogICAgaGFuZGxlciwKICAgIHBhZ2VJbmRleCwKICAgIGlkRmFjdG9yeSwKICAgIGZvbnRDYWNoZSwKICAgIGJ1aWx0SW5DTWFwQ2FjaGUsCiAgICBzdGFuZGFyZEZvbnREYXRhQ2FjaGUsCiAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICBnbG9iYWxJbWFnZUNhY2hlLAogICAgc3lzdGVtRm9udENhY2hlLAogICAgb3B0aW9ucyA9IG51bGwKICB9KSB7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy5oYW5kbGVyID0gaGFuZGxlcjsKICAgIHRoaXMucGFnZUluZGV4ID0gcGFnZUluZGV4OwogICAgdGhpcy5pZEZhY3RvcnkgPSBpZEZhY3Rvcnk7CiAgICB0aGlzLmZvbnRDYWNoZSA9IGZvbnRDYWNoZTsKICAgIHRoaXMuYnVpbHRJbkNNYXBDYWNoZSA9IGJ1aWx0SW5DTWFwQ2FjaGU7CiAgICB0aGlzLnN0YW5kYXJkRm9udERhdGFDYWNoZSA9IHN0YW5kYXJkRm9udERhdGFDYWNoZTsKICAgIHRoaXMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlID0gZ2xvYmFsQ29sb3JTcGFjZUNhY2hlOwogICAgdGhpcy5nbG9iYWxJbWFnZUNhY2hlID0gZ2xvYmFsSW1hZ2VDYWNoZTsKICAgIHRoaXMuc3lzdGVtRm9udENhY2hlID0gc3lzdGVtRm9udENhY2hlOwogICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCBEZWZhdWx0UGFydGlhbEV2YWx1YXRvck9wdGlvbnM7CiAgICB0aGlzLnR5cGUzRm9udFJlZnMgPSBudWxsOwogICAgdGhpcy5fcmVnaW9uYWxJbWFnZUNhY2hlID0gbmV3IFJlZ2lvbmFsSW1hZ2VDYWNoZSgpOwogICAgdGhpcy5fZmV0Y2hCdWlsdEluQ01hcEJvdW5kID0gdGhpcy5mZXRjaEJ1aWx0SW5DTWFwLmJpbmQodGhpcyk7CiAgfQogIGdldCBfcGRmRnVuY3Rpb25GYWN0b3J5KCkgewogICAgY29uc3QgcGRmRnVuY3Rpb25GYWN0b3J5ID0gbmV3IFBERkZ1bmN0aW9uRmFjdG9yeSh7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgaXNFdmFsU3VwcG9ydGVkOiB0aGlzLm9wdGlvbnMuaXNFdmFsU3VwcG9ydGVkCiAgICB9KTsKICAgIHJldHVybiBzaGFkb3codGhpcywgIl9wZGZGdW5jdGlvbkZhY3RvcnkiLCBwZGZGdW5jdGlvbkZhY3RvcnkpOwogIH0KICBnZXQgcGFyc2luZ1R5cGUzRm9udCgpIHsKICAgIHJldHVybiAhIXRoaXMudHlwZTNGb250UmVmczsKICB9CiAgY2xvbmUobmV3T3B0aW9ucyA9IG51bGwpIHsKICAgIGNvbnN0IG5ld0V2YWx1YXRvciA9IE9iamVjdC5jcmVhdGUodGhpcyk7CiAgICBuZXdFdmFsdWF0b3Iub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShudWxsKSwgdGhpcy5vcHRpb25zLCBuZXdPcHRpb25zKTsKICAgIHJldHVybiBuZXdFdmFsdWF0b3I7CiAgfQogIGhhc0JsZW5kTW9kZXMocmVzb3VyY2VzLCBub25CbGVuZE1vZGVzU2V0KSB7CiAgICBpZiAoIShyZXNvdXJjZXMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAocmVzb3VyY2VzLm9iaklkICYmIG5vbkJsZW5kTW9kZXNTZXQuaGFzKHJlc291cmNlcy5vYmpJZCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgcHJvY2Vzc2VkID0gbmV3IFJlZlNldChub25CbGVuZE1vZGVzU2V0KTsKICAgIGlmIChyZXNvdXJjZXMub2JqSWQpIHsKICAgICAgcHJvY2Vzc2VkLnB1dChyZXNvdXJjZXMub2JqSWQpOwogICAgfQogICAgY29uc3Qgbm9kZXMgPSBbcmVzb3VyY2VzXSwKICAgICAgeHJlZiA9IHRoaXMueHJlZjsKICAgIHdoaWxlIChub2Rlcy5sZW5ndGgpIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzLnNoaWZ0KCk7CiAgICAgIGNvbnN0IGdyYXBoaWNTdGF0ZXMgPSBub2RlLmdldCgiRXh0R1N0YXRlIik7CiAgICAgIGlmIChncmFwaGljU3RhdGVzIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgIGZvciAobGV0IGdyYXBoaWNTdGF0ZSBvZiBncmFwaGljU3RhdGVzLmdldFJhd1ZhbHVlcygpKSB7CiAgICAgICAgICBpZiAoZ3JhcGhpY1N0YXRlIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgIGlmIChwcm9jZXNzZWQuaGFzKGdyYXBoaWNTdGF0ZSkpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGdyYXBoaWNTdGF0ZSA9IHhyZWYuZmV0Y2goZ3JhcGhpY1N0YXRlKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgICBwcm9jZXNzZWQucHV0KGdyYXBoaWNTdGF0ZSk7CiAgICAgICAgICAgICAgaW5mbyhgaGFzQmxlbmRNb2RlcyAtIGlnbm9yaW5nIEV4dEdTdGF0ZTogIiR7ZXh9Ii5gKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKCEoZ3JhcGhpY1N0YXRlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZ3JhcGhpY1N0YXRlLm9iaklkKSB7CiAgICAgICAgICAgIHByb2Nlc3NlZC5wdXQoZ3JhcGhpY1N0YXRlLm9iaklkKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGJtID0gZ3JhcGhpY1N0YXRlLmdldCgiQk0iKTsKICAgICAgICAgIGlmIChibSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgaWYgKGJtLm5hbWUgIT09ICJOb3JtYWwiKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYm0gIT09IHVuZGVmaW5lZCAmJiBBcnJheS5pc0FycmF5KGJtKSkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgYm0pIHsKICAgICAgICAgICAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIE5hbWUgJiYgZWxlbWVudC5uYW1lICE9PSAiTm9ybWFsIikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHhPYmplY3RzID0gbm9kZS5nZXQoIlhPYmplY3QiKTsKICAgICAgaWYgKCEoeE9iamVjdHMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAobGV0IHhPYmplY3Qgb2YgeE9iamVjdHMuZ2V0UmF3VmFsdWVzKCkpIHsKICAgICAgICBpZiAoeE9iamVjdCBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgaWYgKHByb2Nlc3NlZC5oYXMoeE9iamVjdCkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB4T2JqZWN0ID0geHJlZi5mZXRjaCh4T2JqZWN0KTsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIHByb2Nlc3NlZC5wdXQoeE9iamVjdCk7CiAgICAgICAgICAgIGluZm8oYGhhc0JsZW5kTW9kZXMgLSBpZ25vcmluZyBYT2JqZWN0OiAiJHtleH0iLmApOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCEoeE9iamVjdCBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHhPYmplY3QuZGljdC5vYmpJZCkgewogICAgICAgICAgcHJvY2Vzc2VkLnB1dCh4T2JqZWN0LmRpY3Qub2JqSWQpOwogICAgICAgIH0KICAgICAgICBjb25zdCB4UmVzb3VyY2VzID0geE9iamVjdC5kaWN0LmdldCgiUmVzb3VyY2VzIik7CiAgICAgICAgaWYgKCEoeFJlc291cmNlcyBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHhSZXNvdXJjZXMub2JqSWQgJiYgcHJvY2Vzc2VkLmhhcyh4UmVzb3VyY2VzLm9iaklkKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIG5vZGVzLnB1c2goeFJlc291cmNlcyk7CiAgICAgICAgaWYgKHhSZXNvdXJjZXMub2JqSWQpIHsKICAgICAgICAgIHByb2Nlc3NlZC5wdXQoeFJlc291cmNlcy5vYmpJZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IHJlZiBvZiBwcm9jZXNzZWQpIHsKICAgICAgbm9uQmxlbmRNb2Rlc1NldC5wdXQocmVmKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgYXN5bmMgZmV0Y2hCdWlsdEluQ01hcChuYW1lKSB7CiAgICBjb25zdCBjYWNoZWREYXRhID0gdGhpcy5idWlsdEluQ01hcENhY2hlLmdldChuYW1lKTsKICAgIGlmIChjYWNoZWREYXRhKSB7CiAgICAgIHJldHVybiBjYWNoZWREYXRhOwogICAgfQogICAgbGV0IGRhdGE7CiAgICBpZiAodGhpcy5vcHRpb25zLnVzZVdvcmtlckZldGNoKSB7CiAgICAgIGRhdGEgPSB7CiAgICAgICAgY01hcERhdGE6IGF3YWl0IGZldGNoQmluYXJ5RGF0YShgJHt0aGlzLm9wdGlvbnMuY01hcFVybH0ke25hbWV9LmJjbWFwYCksCiAgICAgICAgaXNDb21wcmVzc2VkOiB0cnVlCiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICBkYXRhID0gYXdhaXQgdGhpcy5oYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiRmV0Y2hCaW5hcnlEYXRhIiwgewogICAgICAgIHR5cGU6ICJjTWFwUmVhZGVyRmFjdG9yeSIsCiAgICAgICAgbmFtZQogICAgICB9KTsKICAgIH0KICAgIHRoaXMuYnVpbHRJbkNNYXBDYWNoZS5zZXQobmFtZSwgZGF0YSk7CiAgICByZXR1cm4gZGF0YTsKICB9CiAgYXN5bmMgZmV0Y2hTdGFuZGFyZEZvbnREYXRhKG5hbWUpIHsKICAgIGNvbnN0IGNhY2hlZERhdGEgPSB0aGlzLnN0YW5kYXJkRm9udERhdGFDYWNoZS5nZXQobmFtZSk7CiAgICBpZiAoY2FjaGVkRGF0YSkgewogICAgICByZXR1cm4gbmV3IFN0cmVhbShjYWNoZWREYXRhKTsKICAgIH0KICAgIGlmICh0aGlzLm9wdGlvbnMudXNlU3lzdGVtRm9udHMgJiYgbmFtZSAhPT0gIlN5bWJvbCIgJiYgbmFtZSAhPT0gIlphcGZEaW5nYmF0cyIpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBzdGFuZGFyZEZvbnROYW1lVG9GaWxlTmFtZSA9IGdldEZvbnROYW1lVG9GaWxlTWFwKCksCiAgICAgIGZpbGVuYW1lID0gc3RhbmRhcmRGb250TmFtZVRvRmlsZU5hbWVbbmFtZV07CiAgICBsZXQgZGF0YTsKICAgIHRyeSB7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMudXNlV29ya2VyRmV0Y2gpIHsKICAgICAgICBkYXRhID0gYXdhaXQgZmV0Y2hCaW5hcnlEYXRhKGAke3RoaXMub3B0aW9ucy5zdGFuZGFyZEZvbnREYXRhVXJsfSR7ZmlsZW5hbWV9YCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGF0YSA9IGF3YWl0IHRoaXMuaGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkZldGNoQmluYXJ5RGF0YSIsIHsKICAgICAgICAgIHR5cGU6ICJzdGFuZGFyZEZvbnREYXRhRmFjdG9yeSIsCiAgICAgICAgICBmaWxlbmFtZQogICAgICAgIH0pOwogICAgICB9CiAgICB9IGNhdGNoIChleCkgewogICAgICB3YXJuKGV4KTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICB0aGlzLnN0YW5kYXJkRm9udERhdGFDYWNoZS5zZXQobmFtZSwgZGF0YSk7CiAgICByZXR1cm4gbmV3IFN0cmVhbShkYXRhKTsKICB9CiAgYXN5bmMgYnVpbGRGb3JtWE9iamVjdChyZXNvdXJjZXMsIHhvYmosIHNtYXNrLCBvcGVyYXRvckxpc3QsIHRhc2ssIGluaXRpYWxTdGF0ZSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIHNlZW5SZWZzKSB7CiAgICBjb25zdCB7CiAgICAgIGRpY3QKICAgIH0gPSB4b2JqOwogICAgY29uc3QgbWF0cml4ID0gbG9va3VwTWF0cml4KGRpY3QuZ2V0QXJyYXkoIk1hdHJpeCIpLCBudWxsKTsKICAgIGNvbnN0IGJib3ggPSBsb29rdXBOb3JtYWxSZWN0KGRpY3QuZ2V0QXJyYXkoIkJCb3giKSwgbnVsbCk7CiAgICBsZXQgb3B0aW9uYWxDb250ZW50LCBncm91cE9wdGlvbnM7CiAgICBpZiAoZGljdC5oYXMoIk9DIikpIHsKICAgICAgb3B0aW9uYWxDb250ZW50ID0gYXdhaXQgdGhpcy5wYXJzZU1hcmtlZENvbnRlbnRQcm9wcyhkaWN0LmdldCgiT0MiKSwgcmVzb3VyY2VzKTsKICAgIH0KICAgIGlmIChvcHRpb25hbENvbnRlbnQgIT09IHVuZGVmaW5lZCkgewogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLmJlZ2luTWFya2VkQ29udGVudFByb3BzLCBbIk9DIiwgb3B0aW9uYWxDb250ZW50XSk7CiAgICB9CiAgICBjb25zdCBncm91cCA9IGRpY3QuZ2V0KCJHcm91cCIpOwogICAgaWYgKGdyb3VwKSB7CiAgICAgIGdyb3VwT3B0aW9ucyA9IHsKICAgICAgICBtYXRyaXgsCiAgICAgICAgYmJveCwKICAgICAgICBzbWFzaywKICAgICAgICBpc29sYXRlZDogZmFsc2UsCiAgICAgICAga25vY2tvdXQ6IGZhbHNlCiAgICAgIH07CiAgICAgIGNvbnN0IGdyb3VwU3VidHlwZSA9IGdyb3VwLmdldCgiUyIpOwogICAgICBsZXQgY29sb3JTcGFjZSA9IG51bGw7CiAgICAgIGlmIChpc05hbWUoZ3JvdXBTdWJ0eXBlLCAiVHJhbnNwYXJlbmN5IikpIHsKICAgICAgICBncm91cE9wdGlvbnMuaXNvbGF0ZWQgPSBncm91cC5nZXQoIkkiKSB8fCBmYWxzZTsKICAgICAgICBncm91cE9wdGlvbnMua25vY2tvdXQgPSBncm91cC5nZXQoIksiKSB8fCBmYWxzZTsKICAgICAgICBpZiAoZ3JvdXAuaGFzKCJDUyIpKSB7CiAgICAgICAgICBjb25zdCBjcyA9IHRoaXMuX2dldENvbG9yU3BhY2UoZ3JvdXAuZ2V0UmF3KCJDUyIpLCByZXNvdXJjZXMsIGxvY2FsQ29sb3JTcGFjZUNhY2hlKTsKICAgICAgICAgIGNvbG9yU3BhY2UgPSBjcyBpbnN0YW5jZW9mIENvbG9yU3BhY2UgPyBjcyA6IGF3YWl0IHRoaXMuX2hhbmRsZUNvbG9yU3BhY2UoY3MpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc21hc2s/LmJhY2tkcm9wKSB7CiAgICAgICAgY29sb3JTcGFjZSB8fD0gQ29sb3JTcGFjZVV0aWxzLnJnYjsKICAgICAgICBzbWFzay5iYWNrZHJvcCA9IGNvbG9yU3BhY2UuZ2V0UmdiSGV4KHNtYXNrLmJhY2tkcm9wLCAwKTsKICAgICAgfQogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLmJlZ2luR3JvdXAsIFtncm91cE9wdGlvbnNdKTsKICAgIH0KICAgIGNvbnN0IGYzMm1hdHJpeCA9IG1hdHJpeCAmJiBuZXcgRmxvYXQzMkFycmF5KG1hdHJpeCk7CiAgICBjb25zdCBmMzJiYm94ID0gIWdyb3VwICYmIGJib3ggJiYgbmV3IEZsb2F0MzJBcnJheShiYm94KSB8fCBudWxsOwogICAgY29uc3QgYXJncyA9IFtmMzJtYXRyaXgsIGYzMmJib3hdOwogICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5wYWludEZvcm1YT2JqZWN0QmVnaW4sIGFyZ3MpOwogICAgY29uc3QgbG9jYWxSZXNvdXJjZXMgPSBkaWN0LmdldCgiUmVzb3VyY2VzIik7CiAgICBhd2FpdCB0aGlzLmdldE9wZXJhdG9yTGlzdCh7CiAgICAgIHN0cmVhbTogeG9iaiwKICAgICAgdGFzaywKICAgICAgcmVzb3VyY2VzOiBsb2NhbFJlc291cmNlcyBpbnN0YW5jZW9mIERpY3QgPyBsb2NhbFJlc291cmNlcyA6IHJlc291cmNlcywKICAgICAgb3BlcmF0b3JMaXN0LAogICAgICBpbml0aWFsU3RhdGUsCiAgICAgIHByZXZSZWZzOiBzZWVuUmVmcwogICAgfSk7CiAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLnBhaW50Rm9ybVhPYmplY3RFbmQsIFtdKTsKICAgIGlmIChncm91cCkgewogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLmVuZEdyb3VwLCBbZ3JvdXBPcHRpb25zXSk7CiAgICB9CiAgICBpZiAob3B0aW9uYWxDb250ZW50ICE9PSB1bmRlZmluZWQpIHsKICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5lbmRNYXJrZWRDb250ZW50LCBbXSk7CiAgICB9CiAgfQogIF9zZW5kSW1nRGF0YShvYmpJZCwgaW1nRGF0YSwgY2FjaGVHbG9iYWxseSA9IGZhbHNlKSB7CiAgICBjb25zdCB0cmFuc2ZlcnMgPSBpbWdEYXRhID8gW2ltZ0RhdGEuYml0bWFwIHx8IGltZ0RhdGEuZGF0YS5idWZmZXJdIDogbnVsbDsKICAgIGlmICh0aGlzLnBhcnNpbmdUeXBlM0ZvbnQgfHwgY2FjaGVHbG9iYWxseSkgewogICAgICByZXR1cm4gdGhpcy5oYW5kbGVyLnNlbmQoImNvbW1vbm9iaiIsIFtvYmpJZCwgIkltYWdlIiwgaW1nRGF0YV0sIHRyYW5zZmVycyk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5oYW5kbGVyLnNlbmQoIm9iaiIsIFtvYmpJZCwgdGhpcy5wYWdlSW5kZXgsICJJbWFnZSIsIGltZ0RhdGFdLCB0cmFuc2ZlcnMpOwogIH0KICBhc3luYyBidWlsZFBhaW50SW1hZ2VYT2JqZWN0KHsKICAgIHJlc291cmNlcywKICAgIGltYWdlLAogICAgaXNJbmxpbmUgPSBmYWxzZSwKICAgIG9wZXJhdG9yTGlzdCwKICAgIGNhY2hlS2V5LAogICAgbG9jYWxJbWFnZUNhY2hlLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUKICB9KSB7CiAgICBjb25zdCB7CiAgICAgIG1heEltYWdlU2l6ZSwKICAgICAgaWdub3JlRXJyb3JzLAogICAgICBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZAogICAgfSA9IHRoaXMub3B0aW9uczsKICAgIGNvbnN0IHsKICAgICAgZGljdAogICAgfSA9IGltYWdlOwogICAgY29uc3QgaW1hZ2VSZWYgPSBkaWN0Lm9iaklkOwogICAgY29uc3QgdyA9IGRpY3QuZ2V0KCJXIiwgIldpZHRoIik7CiAgICBjb25zdCBoID0gZGljdC5nZXQoIkgiLCAiSGVpZ2h0Iik7CiAgICBpZiAoISh3ICYmIHR5cGVvZiB3ID09PSAibnVtYmVyIikgfHwgIShoICYmIHR5cGVvZiBoID09PSAibnVtYmVyIikpIHsKICAgICAgd2FybigiSW1hZ2UgZGltZW5zaW9ucyBhcmUgbWlzc2luZywgb3Igbm90IG51bWJlcnMuIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChtYXhJbWFnZVNpemUgIT09IC0xICYmIHcgKiBoID4gbWF4SW1hZ2VTaXplKSB7CiAgICAgIGNvbnN0IG1zZyA9ICJJbWFnZSBleGNlZWRlZCBtYXhpbXVtIGFsbG93ZWQgc2l6ZSBhbmQgd2FzIHJlbW92ZWQuIjsKICAgICAgaWYgKCFpZ25vcmVFcnJvcnMpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTsKICAgICAgfQogICAgICB3YXJuKG1zZyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBvcHRpb25hbENvbnRlbnQ7CiAgICBpZiAoZGljdC5oYXMoIk9DIikpIHsKICAgICAgb3B0aW9uYWxDb250ZW50ID0gYXdhaXQgdGhpcy5wYXJzZU1hcmtlZENvbnRlbnRQcm9wcyhkaWN0LmdldCgiT0MiKSwgcmVzb3VyY2VzKTsKICAgIH0KICAgIGNvbnN0IGltYWdlTWFzayA9IGRpY3QuZ2V0KCJJTSIsICJJbWFnZU1hc2siKSB8fCBmYWxzZTsKICAgIGxldCBpbWdEYXRhLCBmbiwgYXJnczsKICAgIGlmIChpbWFnZU1hc2spIHsKICAgICAgaW1nRGF0YSA9IGF3YWl0IFBERkltYWdlLmNyZWF0ZU1hc2soewogICAgICAgIGltYWdlLAogICAgICAgIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkOiBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCAmJiAhdGhpcy5wYXJzaW5nVHlwZTNGb250CiAgICAgIH0pOwogICAgICBpZiAoaW1nRGF0YS5pc1NpbmdsZU9wYXF1ZVBpeGVsKSB7CiAgICAgICAgZm4gPSBPUFMucGFpbnRTb2xpZENvbG9ySW1hZ2VNYXNrOwogICAgICAgIGFyZ3MgPSBbXTsKICAgICAgICBvcGVyYXRvckxpc3QuYWRkSW1hZ2VPcHMoZm4sIGFyZ3MsIG9wdGlvbmFsQ29udGVudCk7CiAgICAgICAgaWYgKGNhY2hlS2V5KSB7CiAgICAgICAgICBjb25zdCBjYWNoZURhdGEgPSB7CiAgICAgICAgICAgIGZuLAogICAgICAgICAgICBhcmdzLAogICAgICAgICAgICBvcHRpb25hbENvbnRlbnQKICAgICAgICAgIH07CiAgICAgICAgICBsb2NhbEltYWdlQ2FjaGUuc2V0KGNhY2hlS2V5LCBpbWFnZVJlZiwgY2FjaGVEYXRhKTsKICAgICAgICAgIGlmIChpbWFnZVJlZikgewogICAgICAgICAgICB0aGlzLl9yZWdpb25hbEltYWdlQ2FjaGUuc2V0KG51bGwsIGltYWdlUmVmLCBjYWNoZURhdGEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMucGFyc2luZ1R5cGUzRm9udCkgewogICAgICAgIGFyZ3MgPSBjb21waWxlVHlwZTNHbHlwaChpbWdEYXRhKTsKICAgICAgICBpZiAoYXJncykgewogICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZEltYWdlT3BzKE9QUy5jb25zdHJ1Y3RQYXRoLCBhcmdzLCBvcHRpb25hbENvbnRlbnQpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB3YXJuKCJDYW5ub3QgY29tcGlsZSBUeXBlMyBnbHlwaC4iKTsKICAgICAgICBvcGVyYXRvckxpc3QuYWRkSW1hZ2VPcHMoT1BTLnBhaW50SW1hZ2VNYXNrWE9iamVjdCwgW2ltZ0RhdGFdLCBvcHRpb25hbENvbnRlbnQpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBvYmpJZCA9IGBtYXNrXyR7dGhpcy5pZEZhY3RvcnkuY3JlYXRlT2JqSWQoKX1gOwogICAgICBvcGVyYXRvckxpc3QuYWRkRGVwZW5kZW5jeShvYmpJZCk7CiAgICAgIGltZ0RhdGEuZGF0YUxlbiA9IGltZ0RhdGEuYml0bWFwID8gaW1nRGF0YS53aWR0aCAqIGltZ0RhdGEuaGVpZ2h0ICogNCA6IGltZ0RhdGEuZGF0YS5sZW5ndGg7CiAgICAgIHRoaXMuX3NlbmRJbWdEYXRhKG9iaklkLCBpbWdEYXRhKTsKICAgICAgZm4gPSBPUFMucGFpbnRJbWFnZU1hc2tYT2JqZWN0OwogICAgICBhcmdzID0gW3sKICAgICAgICBkYXRhOiBvYmpJZCwKICAgICAgICB3aWR0aDogaW1nRGF0YS53aWR0aCwKICAgICAgICBoZWlnaHQ6IGltZ0RhdGEuaGVpZ2h0LAogICAgICAgIGludGVycG9sYXRlOiBpbWdEYXRhLmludGVycG9sYXRlLAogICAgICAgIGNvdW50OiAxCiAgICAgIH1dOwogICAgICBvcGVyYXRvckxpc3QuYWRkSW1hZ2VPcHMoZm4sIGFyZ3MsIG9wdGlvbmFsQ29udGVudCk7CiAgICAgIGlmIChjYWNoZUtleSkgewogICAgICAgIGNvbnN0IGNhY2hlRGF0YSA9IHsKICAgICAgICAgIG9iaklkLAogICAgICAgICAgZm4sCiAgICAgICAgICBhcmdzLAogICAgICAgICAgb3B0aW9uYWxDb250ZW50CiAgICAgICAgfTsKICAgICAgICBsb2NhbEltYWdlQ2FjaGUuc2V0KGNhY2hlS2V5LCBpbWFnZVJlZiwgY2FjaGVEYXRhKTsKICAgICAgICBpZiAoaW1hZ2VSZWYpIHsKICAgICAgICAgIHRoaXMuX3JlZ2lvbmFsSW1hZ2VDYWNoZS5zZXQobnVsbCwgaW1hZ2VSZWYsIGNhY2hlRGF0YSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IFNNQUxMX0lNQUdFX0RJTUVOU0lPTlMgPSAyMDA7CiAgICBjb25zdCBoYXNNYXNrID0gZGljdC5oYXMoIlNNYXNrIikgfHwgZGljdC5oYXMoIk1hc2siKTsKICAgIGlmIChpc0lubGluZSAmJiB3ICsgaCA8IFNNQUxMX0lNQUdFX0RJTUVOU0lPTlMgJiYgIWhhc01hc2spIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBpbWFnZU9iaiA9IG5ldyBQREZJbWFnZSh7CiAgICAgICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgICAgICByZXM6IHJlc291cmNlcywKICAgICAgICAgIGltYWdlLAogICAgICAgICAgaXNJbmxpbmUsCiAgICAgICAgICBwZGZGdW5jdGlvbkZhY3Rvcnk6IHRoaXMuX3BkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZTogdGhpcy5nbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgICAgIH0pOwogICAgICAgIGltZ0RhdGEgPSBhd2FpdCBpbWFnZU9iai5jcmVhdGVJbWFnZURhdGEodHJ1ZSwgZmFsc2UpOwogICAgICAgIG9wZXJhdG9yTGlzdC5hZGRJbWFnZU9wcyhPUFMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3QsIFtpbWdEYXRhXSwgb3B0aW9uYWxDb250ZW50KTsKICAgICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgICAgY29uc3QgbXNnID0gYFVuYWJsZSB0byBkZWNvZGUgaW5saW5lIGltYWdlOiAiJHtyZWFzb259Ii5gOwogICAgICAgIGlmICghaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTsKICAgICAgICB9CiAgICAgICAgd2Fybihtc2cpOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBvYmpJZCA9IGBpbWdfJHt0aGlzLmlkRmFjdG9yeS5jcmVhdGVPYmpJZCgpfWAsCiAgICAgIGNhY2hlR2xvYmFsbHkgPSBmYWxzZSwKICAgICAgZ2xvYmFsQ2FjaGVEYXRhID0gbnVsbDsKICAgIGlmICh0aGlzLnBhcnNpbmdUeXBlM0ZvbnQpIHsKICAgICAgb2JqSWQgPSBgJHt0aGlzLmlkRmFjdG9yeS5nZXREb2NJZCgpfV90eXBlM18ke29iaklkfWA7CiAgICB9IGVsc2UgaWYgKGNhY2hlS2V5ICYmIGltYWdlUmVmKSB7CiAgICAgIGNhY2hlR2xvYmFsbHkgPSB0aGlzLmdsb2JhbEltYWdlQ2FjaGUuc2hvdWxkQ2FjaGUoaW1hZ2VSZWYsIHRoaXMucGFnZUluZGV4KTsKICAgICAgaWYgKGNhY2hlR2xvYmFsbHkpIHsKICAgICAgICBhc3NlcnQoIWlzSW5saW5lLCAiQ2Fubm90IGNhY2hlIGFuIGlubGluZSBpbWFnZSBnbG9iYWxseS4iKTsKICAgICAgICBvYmpJZCA9IGAke3RoaXMuaWRGYWN0b3J5LmdldERvY0lkKCl9XyR7b2JqSWR9YDsKICAgICAgfQogICAgfQogICAgb3BlcmF0b3JMaXN0LmFkZERlcGVuZGVuY3kob2JqSWQpOwogICAgZm4gPSBPUFMucGFpbnRJbWFnZVhPYmplY3Q7CiAgICBhcmdzID0gW29iaklkLCB3LCBoXTsKICAgIG9wZXJhdG9yTGlzdC5hZGRJbWFnZU9wcyhmbiwgYXJncywgb3B0aW9uYWxDb250ZW50LCBoYXNNYXNrKTsKICAgIGlmIChjYWNoZUdsb2JhbGx5KSB7CiAgICAgIGdsb2JhbENhY2hlRGF0YSA9IHsKICAgICAgICBvYmpJZCwKICAgICAgICBmbiwKICAgICAgICBhcmdzLAogICAgICAgIG9wdGlvbmFsQ29udGVudCwKICAgICAgICBoYXNNYXNrLAogICAgICAgIGJ5dGVTaXplOiAwCiAgICAgIH07CiAgICAgIGlmICh0aGlzLmdsb2JhbEltYWdlQ2FjaGUuaGFzRGVjb2RlRmFpbGVkKGltYWdlUmVmKSkgewogICAgICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZS5zZXREYXRhKGltYWdlUmVmLCBnbG9iYWxDYWNoZURhdGEpOwogICAgICAgIHRoaXMuX3NlbmRJbWdEYXRhKG9iaklkLCBudWxsLCBjYWNoZUdsb2JhbGx5KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHcgKiBoID4gMjUwMDAwIHx8IGhhc01hc2spIHsKICAgICAgICBjb25zdCBsb2NhbExlbmd0aCA9IGF3YWl0IHRoaXMuaGFuZGxlci5zZW5kV2l0aFByb21pc2UoImNvbW1vbm9iaiIsIFtvYmpJZCwgIkNvcHlMb2NhbEltYWdlIiwgewogICAgICAgICAgaW1hZ2VSZWYKICAgICAgICB9XSk7CiAgICAgICAgaWYgKGxvY2FsTGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmdsb2JhbEltYWdlQ2FjaGUuc2V0RGF0YShpbWFnZVJlZiwgZ2xvYmFsQ2FjaGVEYXRhKTsKICAgICAgICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZS5hZGRCeXRlU2l6ZShpbWFnZVJlZiwgbG9jYWxMZW5ndGgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgUERGSW1hZ2UuYnVpbGRJbWFnZSh7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgcmVzOiByZXNvdXJjZXMsCiAgICAgIGltYWdlLAogICAgICBpc0lubGluZSwKICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5OiB0aGlzLl9wZGZGdW5jdGlvbkZhY3RvcnksCiAgICAgIGdsb2JhbENvbG9yU3BhY2VDYWNoZTogdGhpcy5nbG9iYWxDb2xvclNwYWNlQ2FjaGUsCiAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICB9KS50aGVuKGFzeW5jIGltYWdlT2JqID0+IHsKICAgICAgaW1nRGF0YSA9IGF3YWl0IGltYWdlT2JqLmNyZWF0ZUltYWdlRGF0YShmYWxzZSwgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpOwogICAgICBpbWdEYXRhLmRhdGFMZW4gPSBpbWdEYXRhLmJpdG1hcCA/IGltZ0RhdGEud2lkdGggKiBpbWdEYXRhLmhlaWdodCAqIDQgOiBpbWdEYXRhLmRhdGEubGVuZ3RoOwogICAgICBpbWdEYXRhLnJlZiA9IGltYWdlUmVmOwogICAgICBpZiAoY2FjaGVHbG9iYWxseSkgewogICAgICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZS5hZGRCeXRlU2l6ZShpbWFnZVJlZiwgaW1nRGF0YS5kYXRhTGVuKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5fc2VuZEltZ0RhdGEob2JqSWQsIGltZ0RhdGEsIGNhY2hlR2xvYmFsbHkpOwogICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgd2FybihgVW5hYmxlIHRvIGRlY29kZSBpbWFnZSAiJHtvYmpJZH0iOiAiJHtyZWFzb259Ii5gKTsKICAgICAgaWYgKGltYWdlUmVmKSB7CiAgICAgICAgdGhpcy5nbG9iYWxJbWFnZUNhY2hlLmFkZERlY29kZUZhaWxlZChpbWFnZVJlZik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3NlbmRJbWdEYXRhKG9iaklkLCBudWxsLCBjYWNoZUdsb2JhbGx5KTsKICAgIH0pOwogICAgaWYgKGNhY2hlS2V5KSB7CiAgICAgIGNvbnN0IGNhY2hlRGF0YSA9IHsKICAgICAgICBvYmpJZCwKICAgICAgICBmbiwKICAgICAgICBhcmdzLAogICAgICAgIG9wdGlvbmFsQ29udGVudCwKICAgICAgICBoYXNNYXNrCiAgICAgIH07CiAgICAgIGxvY2FsSW1hZ2VDYWNoZS5zZXQoY2FjaGVLZXksIGltYWdlUmVmLCBjYWNoZURhdGEpOwogICAgICBpZiAoaW1hZ2VSZWYpIHsKICAgICAgICB0aGlzLl9yZWdpb25hbEltYWdlQ2FjaGUuc2V0KG51bGwsIGltYWdlUmVmLCBjYWNoZURhdGEpOwogICAgICAgIGlmIChjYWNoZUdsb2JhbGx5KSB7CiAgICAgICAgICBhc3NlcnQoZ2xvYmFsQ2FjaGVEYXRhLCAiVGhlIGdsb2JhbCBjYWNoZS1kYXRhIG11c3QgYmUgYXZhaWxhYmxlLiIpOwogICAgICAgICAgdGhpcy5nbG9iYWxJbWFnZUNhY2hlLnNldERhdGEoaW1hZ2VSZWYsIGdsb2JhbENhY2hlRGF0YSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIGhhbmRsZVNNYXNrKHNtYXNrLCByZXNvdXJjZXMsIG9wZXJhdG9yTGlzdCwgdGFzaywgc3RhdGVNYW5hZ2VyLCBsb2NhbENvbG9yU3BhY2VDYWNoZSwgc2VlblJlZnMpIHsKICAgIGNvbnN0IHNtYXNrQ29udGVudCA9IHNtYXNrLmdldCgiRyIpOwogICAgY29uc3Qgc21hc2tPcHRpb25zID0gewogICAgICBzdWJ0eXBlOiBzbWFzay5nZXQoIlMiKS5uYW1lLAogICAgICBiYWNrZHJvcDogc21hc2suZ2V0KCJCQyIpCiAgICB9OwogICAgY29uc3QgdHJhbnNmZXJPYmogPSBzbWFzay5nZXQoIlRSIik7CiAgICBpZiAoaXNQREZGdW5jdGlvbih0cmFuc2Zlck9iaikpIHsKICAgICAgY29uc3QgdHJhbnNmZXJGbiA9IHRoaXMuX3BkZkZ1bmN0aW9uRmFjdG9yeS5jcmVhdGUodHJhbnNmZXJPYmopOwogICAgICBjb25zdCB0cmFuc2Zlck1hcCA9IG5ldyBVaW50OEFycmF5KDI1Nik7CiAgICAgIGNvbnN0IHRtcCA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKICAgICAgICB0bXBbMF0gPSBpIC8gMjU1OwogICAgICAgIHRyYW5zZmVyRm4odG1wLCAwLCB0bXAsIDApOwogICAgICAgIHRyYW5zZmVyTWFwW2ldID0gdG1wWzBdICogMjU1IHwgMDsKICAgICAgfQogICAgICBzbWFza09wdGlvbnMudHJhbnNmZXJNYXAgPSB0cmFuc2Zlck1hcDsKICAgIH0KICAgIHJldHVybiB0aGlzLmJ1aWxkRm9ybVhPYmplY3QocmVzb3VyY2VzLCBzbWFza0NvbnRlbnQsIHNtYXNrT3B0aW9ucywgb3BlcmF0b3JMaXN0LCB0YXNrLCBzdGF0ZU1hbmFnZXIuc3RhdGUuY2xvbmUoewogICAgICBuZXdQYXRoOiB0cnVlCiAgICB9KSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIHNlZW5SZWZzKTsKICB9CiAgaGFuZGxlVHJhbnNmZXJGdW5jdGlvbih0cikgewogICAgbGV0IHRyYW5zZmVyQXJyYXk7CiAgICBpZiAoQXJyYXkuaXNBcnJheSh0cikpIHsKICAgICAgdHJhbnNmZXJBcnJheSA9IHRyOwogICAgfSBlbHNlIGlmIChpc1BERkZ1bmN0aW9uKHRyKSkgewogICAgICB0cmFuc2ZlckFycmF5ID0gW3RyXTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgdHJhbnNmZXJNYXBzID0gW107CiAgICBsZXQgbnVtRm5zID0gMCwKICAgICAgbnVtRWZmZWN0ZnVsRm5zID0gMDsKICAgIGZvciAoY29uc3QgZW50cnkgb2YgdHJhbnNmZXJBcnJheSkgewogICAgICBjb25zdCB0cmFuc2Zlck9iaiA9IHRoaXMueHJlZi5mZXRjaElmUmVmKGVudHJ5KTsKICAgICAgbnVtRm5zKys7CiAgICAgIGlmIChpc05hbWUodHJhbnNmZXJPYmosICJJZGVudGl0eSIpKSB7CiAgICAgICAgdHJhbnNmZXJNYXBzLnB1c2gobnVsbCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSBpZiAoIWlzUERGRnVuY3Rpb24odHJhbnNmZXJPYmopKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3QgdHJhbnNmZXJGbiA9IHRoaXMuX3BkZkZ1bmN0aW9uRmFjdG9yeS5jcmVhdGUodHJhbnNmZXJPYmopOwogICAgICBjb25zdCB0cmFuc2Zlck1hcCA9IG5ldyBVaW50OEFycmF5KDI1NiksCiAgICAgICAgdG1wID0gbmV3IEZsb2F0MzJBcnJheSgxKTsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAyNTY7IGorKykgewogICAgICAgIHRtcFswXSA9IGogLyAyNTU7CiAgICAgICAgdHJhbnNmZXJGbih0bXAsIDAsIHRtcCwgMCk7CiAgICAgICAgdHJhbnNmZXJNYXBbal0gPSB0bXBbMF0gKiAyNTUgfCAwOwogICAgICB9CiAgICAgIHRyYW5zZmVyTWFwcy5wdXNoKHRyYW5zZmVyTWFwKTsKICAgICAgbnVtRWZmZWN0ZnVsRm5zKys7CiAgICB9CiAgICBpZiAoIShudW1GbnMgPT09IDEgfHwgbnVtRm5zID09PSA0KSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChudW1FZmZlY3RmdWxGbnMgPT09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICByZXR1cm4gdHJhbnNmZXJNYXBzOwogIH0KICBoYW5kbGVUaWxpbmdUeXBlKGZuLCBjb2xvciwgcmVzb3VyY2VzLCBwYXR0ZXJuLCBwYXR0ZXJuRGljdCwgb3BlcmF0b3JMaXN0LCB0YXNrLCBsb2NhbFRpbGluZ1BhdHRlcm5DYWNoZSkgewogICAgY29uc3QgdGlsaW5nT3BMaXN0ID0gbmV3IE9wZXJhdG9yTGlzdCgpOwogICAgY29uc3QgcGF0dGVyblJlc291cmNlcyA9IERpY3QubWVyZ2UoewogICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgIGRpY3RBcnJheTogW3BhdHRlcm5EaWN0LmdldCgiUmVzb3VyY2VzIiksIHJlc291cmNlc10KICAgIH0pOwogICAgcmV0dXJuIHRoaXMuZ2V0T3BlcmF0b3JMaXN0KHsKICAgICAgc3RyZWFtOiBwYXR0ZXJuLAogICAgICB0YXNrLAogICAgICByZXNvdXJjZXM6IHBhdHRlcm5SZXNvdXJjZXMsCiAgICAgIG9wZXJhdG9yTGlzdDogdGlsaW5nT3BMaXN0CiAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgY29uc3Qgb3BlcmF0b3JMaXN0SVIgPSB0aWxpbmdPcExpc3QuZ2V0SVIoKTsKICAgICAgY29uc3QgdGlsaW5nUGF0dGVybklSID0gZ2V0VGlsaW5nUGF0dGVybklSKG9wZXJhdG9yTGlzdElSLCBwYXR0ZXJuRGljdCwgY29sb3IpOwogICAgICBvcGVyYXRvckxpc3QuYWRkRGVwZW5kZW5jaWVzKHRpbGluZ09wTGlzdC5kZXBlbmRlbmNpZXMpOwogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIHRpbGluZ1BhdHRlcm5JUik7CiAgICAgIGlmIChwYXR0ZXJuRGljdC5vYmpJZCkgewogICAgICAgIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLnNldChudWxsLCBwYXR0ZXJuRGljdC5vYmpJZCwgewogICAgICAgICAgb3BlcmF0b3JMaXN0SVIsCiAgICAgICAgICBkaWN0OiBwYXR0ZXJuRGljdAogICAgICAgIH0pOwogICAgICB9CiAgICB9KS5jYXRjaChyZWFzb24gPT4gewogICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICB3YXJuKGBoYW5kbGVUaWxpbmdUeXBlIC0gaWdub3JpbmcgcGF0dGVybjogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRocm93IHJlYXNvbjsKICAgIH0pOwogIH0KICBhc3luYyBoYW5kbGVTZXRGb250KHJlc291cmNlcywgZm9udEFyZ3MsIGZvbnRSZWYsIG9wZXJhdG9yTGlzdCwgdGFzaywgc3RhdGUsIGZhbGxiYWNrRm9udERpY3QgPSBudWxsLCBjc3NGb250SW5mbyA9IG51bGwpIHsKICAgIGNvbnN0IGZvbnROYW1lID0gZm9udEFyZ3M/LlswXSBpbnN0YW5jZW9mIE5hbWUgPyBmb250QXJnc1swXS5uYW1lIDogbnVsbDsKICAgIGNvbnN0IHRyYW5zbGF0ZWQgPSBhd2FpdCB0aGlzLmxvYWRGb250KGZvbnROYW1lLCBmb250UmVmLCByZXNvdXJjZXMsIHRhc2ssIGZhbGxiYWNrRm9udERpY3QsIGNzc0ZvbnRJbmZvKTsKICAgIGlmICh0cmFuc2xhdGVkLmZvbnQuaXNUeXBlM0ZvbnQpIHsKICAgICAgb3BlcmF0b3JMaXN0LmFkZERlcGVuZGVuY2llcyh0cmFuc2xhdGVkLnR5cGUzRGVwZW5kZW5jaWVzKTsKICAgIH0KICAgIHN0YXRlLmZvbnQgPSB0cmFuc2xhdGVkLmZvbnQ7CiAgICB0cmFuc2xhdGVkLnNlbmQodGhpcy5oYW5kbGVyKTsKICAgIHJldHVybiB0cmFuc2xhdGVkLmxvYWRlZE5hbWU7CiAgfQogIGhhbmRsZVRleHQoY2hhcnMsIHN0YXRlKSB7CiAgICBjb25zdCBmb250ID0gc3RhdGUuZm9udDsKICAgIGNvbnN0IGdseXBocyA9IGZvbnQuY2hhcnNUb0dseXBocyhjaGFycyk7CiAgICBpZiAoZm9udC5kYXRhKSB7CiAgICAgIGNvbnN0IGlzQWRkVG9QYXRoU2V0ID0gISEoc3RhdGUudGV4dFJlbmRlcmluZ01vZGUgJiBUZXh0UmVuZGVyaW5nTW9kZS5BRERfVE9fUEFUSF9GTEFHKTsKICAgICAgaWYgKGlzQWRkVG9QYXRoU2V0IHx8IHN0YXRlLmZpbGxDb2xvclNwYWNlLm5hbWUgPT09ICJQYXR0ZXJuIiB8fCBmb250LmRpc2FibGVGb250RmFjZSkgewogICAgICAgIFBhcnRpYWxFdmFsdWF0b3IuYnVpbGRGb250UGF0aHMoZm9udCwgZ2x5cGhzLCB0aGlzLmhhbmRsZXIsIHRoaXMub3B0aW9ucyk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBnbHlwaHM7CiAgfQogIGVuc3VyZVN0YXRlRm9udChzdGF0ZSkgewogICAgaWYgKHN0YXRlLmZvbnQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcmVhc29uID0gbmV3IEZvcm1hdEVycm9yKCJNaXNzaW5nIHNldEZvbnQgKFRmKSBvcGVyYXRvciBiZWZvcmUgdGV4dCByZW5kZXJpbmcgb3BlcmF0b3IuIik7CiAgICBpZiAodGhpcy5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICB3YXJuKGBlbnN1cmVTdGF0ZUZvbnQ6ICIke3JlYXNvbn0iLmApOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aHJvdyByZWFzb247CiAgfQogIGFzeW5jIHNldEdTdGF0ZSh7CiAgICByZXNvdXJjZXMsCiAgICBnU3RhdGUsCiAgICBvcGVyYXRvckxpc3QsCiAgICBjYWNoZUtleSwKICAgIHRhc2ssCiAgICBzdGF0ZU1hbmFnZXIsCiAgICBsb2NhbEdTdGF0ZUNhY2hlLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUsCiAgICBzZWVuUmVmcwogIH0pIHsKICAgIGNvbnN0IGdTdGF0ZVJlZiA9IGdTdGF0ZS5vYmpJZDsKICAgIGxldCBpc1NpbXBsZUdTdGF0ZSA9IHRydWU7CiAgICBjb25zdCBnU3RhdGVPYmogPSBbXTsKICAgIGxldCBwcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBnU3RhdGUpIHsKICAgICAgc3dpdGNoIChrZXkpIHsKICAgICAgICBjYXNlICJUeXBlIjoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkxXIjoKICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgIHdhcm4oYEludmFsaWQgTFcgKGxpbmUgd2lkdGgpOiAke3ZhbHVlfWApOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGdTdGF0ZU9iai5wdXNoKFtrZXksIE1hdGguYWJzKHZhbHVlKV0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiTEMiOgogICAgICAgIGNhc2UgIkxKIjoKICAgICAgICBjYXNlICJNTCI6CiAgICAgICAgY2FzZSAiRCI6CiAgICAgICAgY2FzZSAiUkkiOgogICAgICAgIGNhc2UgIkZMIjoKICAgICAgICBjYXNlICJDQSI6CiAgICAgICAgY2FzZSAiY2EiOgogICAgICAgICAgZ1N0YXRlT2JqLnB1c2goW2tleSwgdmFsdWVdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkZvbnQiOgogICAgICAgICAgaXNTaW1wbGVHU3RhdGUgPSBmYWxzZTsKICAgICAgICAgIHByb21pc2UgPSBwcm9taXNlLnRoZW4oKCkgPT4gdGhpcy5oYW5kbGVTZXRGb250KHJlc291cmNlcywgbnVsbCwgdmFsdWVbMF0sIG9wZXJhdG9yTGlzdCwgdGFzaywgc3RhdGVNYW5hZ2VyLnN0YXRlKS50aGVuKGZ1bmN0aW9uIChsb2FkZWROYW1lKSB7CiAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGREZXBlbmRlbmN5KGxvYWRlZE5hbWUpOwogICAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCBbbG9hZGVkTmFtZSwgdmFsdWVbMV1dXSk7CiAgICAgICAgICB9KSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJCTSI6CiAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCBub3JtYWxpemVCbGVuZE1vZGUodmFsdWUpXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJTTWFzayI6CiAgICAgICAgICBpZiAoaXNOYW1lKHZhbHVlLCAiTm9uZSIpKSB7CiAgICAgICAgICAgIGdTdGF0ZU9iai5wdXNoKFtrZXksIGZhbHNlXSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgICAgICBpc1NpbXBsZUdTdGF0ZSA9IGZhbHNlOwogICAgICAgICAgICBwcm9taXNlID0gcHJvbWlzZS50aGVuKCgpID0+IHRoaXMuaGFuZGxlU01hc2sodmFsdWUsIHJlc291cmNlcywgb3BlcmF0b3JMaXN0LCB0YXNrLCBzdGF0ZU1hbmFnZXIsIGxvY2FsQ29sb3JTcGFjZUNhY2hlLCBzZWVuUmVmcykpOwogICAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCB0cnVlXSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3YXJuKCJVbnN1cHBvcnRlZCBTTWFzayB0eXBlIik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJUUiI6CiAgICAgICAgICBjb25zdCB0cmFuc2Zlck1hcHMgPSB0aGlzLmhhbmRsZVRyYW5zZmVyRnVuY3Rpb24odmFsdWUpOwogICAgICAgICAgZ1N0YXRlT2JqLnB1c2goW2tleSwgdHJhbnNmZXJNYXBzXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJPUCI6CiAgICAgICAgY2FzZSAib3AiOgogICAgICAgIGNhc2UgIk9QTSI6CiAgICAgICAgY2FzZSAiQkciOgogICAgICAgIGNhc2UgIkJHMiI6CiAgICAgICAgY2FzZSAiVUNSIjoKICAgICAgICBjYXNlICJVQ1IyIjoKICAgICAgICBjYXNlICJUUjIiOgogICAgICAgIGNhc2UgIkhUIjoKICAgICAgICBjYXNlICJTTSI6CiAgICAgICAgY2FzZSAiU0EiOgogICAgICAgIGNhc2UgIkFJUyI6CiAgICAgICAgY2FzZSAiVEsiOgogICAgICAgICAgaW5mbygiZ3JhcGhpYyBzdGF0ZSBvcGVyYXRvciAiICsga2V5KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBpbmZvKCJVbmtub3duIGdyYXBoaWMgc3RhdGUgb3BlcmF0b3IgIiArIGtleSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgYXdhaXQgcHJvbWlzZTsKICAgIGlmIChnU3RhdGVPYmoubGVuZ3RoID4gMCkgewogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLnNldEdTdGF0ZSwgW2dTdGF0ZU9ial0pOwogICAgfQogICAgaWYgKGlzU2ltcGxlR1N0YXRlKSB7CiAgICAgIGxvY2FsR1N0YXRlQ2FjaGUuc2V0KGNhY2hlS2V5LCBnU3RhdGVSZWYsIGdTdGF0ZU9iaik7CiAgICB9CiAgfQogIGxvYWRGb250KGZvbnROYW1lLCBmb250LCByZXNvdXJjZXMsIHRhc2ssIGZhbGxiYWNrRm9udERpY3QgPSBudWxsLCBjc3NGb250SW5mbyA9IG51bGwpIHsKICAgIGNvbnN0IGVycm9yRm9udCA9IGFzeW5jICgpID0+IG5ldyBUcmFuc2xhdGVkRm9udCh7CiAgICAgIGxvYWRlZE5hbWU6ICJnX2ZvbnRfZXJyb3IiLAogICAgICBmb250OiBuZXcgRXJyb3JGb250KGBGb250ICIke2ZvbnROYW1lfSIgaXMgbm90IGF2YWlsYWJsZS5gKSwKICAgICAgZGljdDogZm9udAogICAgfSk7CiAgICBsZXQgZm9udFJlZjsKICAgIGlmIChmb250KSB7CiAgICAgIGlmIChmb250IGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgZm9udFJlZiA9IGZvbnQ7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGZvbnRSZXMgPSByZXNvdXJjZXMuZ2V0KCJGb250Iik7CiAgICAgIGlmIChmb250UmVzKSB7CiAgICAgICAgZm9udFJlZiA9IGZvbnRSZXMuZ2V0UmF3KGZvbnROYW1lKTsKICAgICAgfQogICAgfQogICAgaWYgKGZvbnRSZWYpIHsKICAgICAgaWYgKHRoaXMudHlwZTNGb250UmVmcz8uaGFzKGZvbnRSZWYpKSB7CiAgICAgICAgcmV0dXJuIGVycm9yRm9udCgpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmZvbnRDYWNoZS5oYXMoZm9udFJlZikpIHsKICAgICAgICByZXR1cm4gdGhpcy5mb250Q2FjaGUuZ2V0KGZvbnRSZWYpOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgZm9udCA9IHRoaXMueHJlZi5mZXRjaElmUmVmKGZvbnRSZWYpOwogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIHdhcm4oYGxvYWRGb250IC0gbG9va3VwIGZhaWxlZDogIiR7ZXh9Ii5gKTsKICAgICAgfQogICAgfQogICAgaWYgKCEoZm9udCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIGlmICghdGhpcy5vcHRpb25zLmlnbm9yZUVycm9ycyAmJiAhdGhpcy5wYXJzaW5nVHlwZTNGb250KSB7CiAgICAgICAgd2FybihgRm9udCAiJHtmb250TmFtZX0iIGlzIG5vdCBhdmFpbGFibGUuYCk7CiAgICAgICAgcmV0dXJuIGVycm9yRm9udCgpOwogICAgICB9CiAgICAgIHdhcm4oYEZvbnQgIiR7Zm9udE5hbWV9IiBpcyBub3QgYXZhaWxhYmxlIC0tIGF0dGVtcHRpbmcgdG8gZmFsbGJhY2sgdG8gYSBkZWZhdWx0IGZvbnQuYCk7CiAgICAgIGZvbnQgPSBmYWxsYmFja0ZvbnREaWN0IHx8IFBhcnRpYWxFdmFsdWF0b3IuZmFsbGJhY2tGb250RGljdDsKICAgIH0KICAgIGlmIChmb250LmNhY2hlS2V5ICYmIHRoaXMuZm9udENhY2hlLmhhcyhmb250LmNhY2hlS2V5KSkgewogICAgICByZXR1cm4gdGhpcy5mb250Q2FjaGUuZ2V0KGZvbnQuY2FjaGVLZXkpOwogICAgfQogICAgY29uc3QgewogICAgICBwcm9taXNlLAogICAgICByZXNvbHZlCiAgICB9ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICBsZXQgcHJlRXZhbHVhdGVkRm9udDsKICAgIHRyeSB7CiAgICAgIHByZUV2YWx1YXRlZEZvbnQgPSB0aGlzLnByZUV2YWx1YXRlRm9udChmb250KTsKICAgICAgcHJlRXZhbHVhdGVkRm9udC5jc3NGb250SW5mbyA9IGNzc0ZvbnRJbmZvOwogICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgIHdhcm4oYGxvYWRGb250IC0gcHJlRXZhbHVhdGVGb250IGZhaWxlZDogIiR7cmVhc29ufSIuYCk7CiAgICAgIHJldHVybiBlcnJvckZvbnQoKTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgZGVzY3JpcHRvciwKICAgICAgaGFzaAogICAgfSA9IHByZUV2YWx1YXRlZEZvbnQ7CiAgICBjb25zdCBmb250UmVmSXNSZWYgPSBmb250UmVmIGluc3RhbmNlb2YgUmVmOwogICAgbGV0IGZvbnRJRDsKICAgIGlmIChoYXNoICYmIGRlc2NyaXB0b3IgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIGNvbnN0IGZvbnRBbGlhc2VzID0gZGVzY3JpcHRvci5mb250QWxpYXNlcyB8fD0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgaWYgKGZvbnRBbGlhc2VzW2hhc2hdKSB7CiAgICAgICAgY29uc3QgYWxpYXNGb250UmVmID0gZm9udEFsaWFzZXNbaGFzaF0uYWxpYXNSZWY7CiAgICAgICAgaWYgKGZvbnRSZWZJc1JlZiAmJiBhbGlhc0ZvbnRSZWYgJiYgdGhpcy5mb250Q2FjaGUuaGFzKGFsaWFzRm9udFJlZikpIHsKICAgICAgICAgIHRoaXMuZm9udENhY2hlLnB1dEFsaWFzKGZvbnRSZWYsIGFsaWFzRm9udFJlZik7CiAgICAgICAgICByZXR1cm4gdGhpcy5mb250Q2FjaGUuZ2V0KGZvbnRSZWYpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBmb250QWxpYXNlc1toYXNoXSA9IHsKICAgICAgICAgIGZvbnRJRDogdGhpcy5pZEZhY3RvcnkuY3JlYXRlRm9udElkKCkKICAgICAgICB9OwogICAgICB9CiAgICAgIGlmIChmb250UmVmSXNSZWYpIHsKICAgICAgICBmb250QWxpYXNlc1toYXNoXS5hbGlhc1JlZiA9IGZvbnRSZWY7CiAgICAgIH0KICAgICAgZm9udElEID0gZm9udEFsaWFzZXNbaGFzaF0uZm9udElEOwogICAgfSBlbHNlIHsKICAgICAgZm9udElEID0gdGhpcy5pZEZhY3RvcnkuY3JlYXRlRm9udElkKCk7CiAgICB9CiAgICBhc3NlcnQoZm9udElEPy5zdGFydHNXaXRoKCJmIiksICdUaGUgImZvbnRJRCIgbXVzdCBiZSAoY29ycmVjdGx5KSBkZWZpbmVkLicpOwogICAgaWYgKGZvbnRSZWZJc1JlZikgewogICAgICB0aGlzLmZvbnRDYWNoZS5wdXQoZm9udFJlZiwgcHJvbWlzZSk7CiAgICB9IGVsc2UgewogICAgICBmb250LmNhY2hlS2V5ID0gYGNhY2hlS2V5XyR7Zm9udElEfWA7CiAgICAgIHRoaXMuZm9udENhY2hlLnB1dChmb250LmNhY2hlS2V5LCBwcm9taXNlKTsKICAgIH0KICAgIGZvbnQubG9hZGVkTmFtZSA9IGAke3RoaXMuaWRGYWN0b3J5LmdldERvY0lkKCl9XyR7Zm9udElEfWA7CiAgICB0aGlzLnRyYW5zbGF0ZUZvbnQocHJlRXZhbHVhdGVkRm9udCkudGhlbihhc3luYyB0cmFuc2xhdGVkRm9udCA9PiB7CiAgICAgIGNvbnN0IHRyYW5zbGF0ZWQgPSBuZXcgVHJhbnNsYXRlZEZvbnQoewogICAgICAgIGxvYWRlZE5hbWU6IGZvbnQubG9hZGVkTmFtZSwKICAgICAgICBmb250OiB0cmFuc2xhdGVkRm9udCwKICAgICAgICBkaWN0OiBmb250CiAgICAgIH0pOwogICAgICBpZiAodHJhbnNsYXRlZEZvbnQuaXNUeXBlM0ZvbnQpIHsKICAgICAgICB0cnkgewogICAgICAgICAgYXdhaXQgdHJhbnNsYXRlZC5sb2FkVHlwZTNEYXRhKHRoaXMsIHJlc291cmNlcywgdGFzayk7CiAgICAgICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFR5cGUzIGZvbnQgbG9hZCBlcnJvcjogJHtyZWFzb259YCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJlc29sdmUodHJhbnNsYXRlZCk7CiAgICB9KS5jYXRjaChyZWFzb24gPT4gewogICAgICB3YXJuKGBsb2FkRm9udCAtIHRyYW5zbGF0ZUZvbnQgZmFpbGVkOiAiJHtyZWFzb259Ii5gKTsKICAgICAgcmVzb2x2ZShuZXcgVHJhbnNsYXRlZEZvbnQoewogICAgICAgIGxvYWRlZE5hbWU6IGZvbnQubG9hZGVkTmFtZSwKICAgICAgICBmb250OiBuZXcgRXJyb3JGb250KHJlYXNvbj8ubWVzc2FnZSksCiAgICAgICAgZGljdDogZm9udAogICAgICB9KSk7CiAgICB9KTsKICAgIHJldHVybiBwcm9taXNlOwogIH0KICBidWlsZFBhdGgoZm4sIGFyZ3MsIHN0YXRlKSB7CiAgICBjb25zdCB7CiAgICAgIHBhdGhNaW5NYXg6IG1pbk1heCwKICAgICAgcGF0aEJ1ZmZlcgogICAgfSA9IHN0YXRlOwogICAgc3dpdGNoIChmbiB8IDApIHsKICAgICAgY2FzZSBPUFMucmVjdGFuZ2xlOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHggPSBzdGF0ZS5jdXJyZW50UG9pbnRYID0gYXJnc1swXTsKICAgICAgICAgIGNvbnN0IHkgPSBzdGF0ZS5jdXJyZW50UG9pbnRZID0gYXJnc1sxXTsKICAgICAgICAgIGNvbnN0IHdpZHRoID0gYXJnc1syXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IGFyZ3NbM107CiAgICAgICAgICBjb25zdCB4dyA9IHggKyB3aWR0aDsKICAgICAgICAgIGNvbnN0IHloID0geSArIGhlaWdodDsKICAgICAgICAgIGlmICh3aWR0aCA9PT0gMCB8fCBoZWlnaHQgPT09IDApIHsKICAgICAgICAgICAgcGF0aEJ1ZmZlci5wdXNoKERyYXdPUFMubW92ZVRvLCB4LCB5LCBEcmF3T1BTLmxpbmVUbywgeHcsIHloLCBEcmF3T1BTLmNsb3NlUGF0aCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwYXRoQnVmZmVyLnB1c2goRHJhd09QUy5tb3ZlVG8sIHgsIHksIERyYXdPUFMubGluZVRvLCB4dywgeSwgRHJhd09QUy5saW5lVG8sIHh3LCB5aCwgRHJhd09QUy5saW5lVG8sIHgsIHloLCBEcmF3T1BTLmNsb3NlUGF0aCk7CiAgICAgICAgICB9CiAgICAgICAgICBVdGlsLnJlY3RCb3VuZGluZ0JveCh4LCB5LCB4dywgeWgsIG1pbk1heCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgT1BTLm1vdmVUbzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCB4ID0gc3RhdGUuY3VycmVudFBvaW50WCA9IGFyZ3NbMF07CiAgICAgICAgICBjb25zdCB5ID0gc3RhdGUuY3VycmVudFBvaW50WSA9IGFyZ3NbMV07CiAgICAgICAgICBwYXRoQnVmZmVyLnB1c2goRHJhd09QUy5tb3ZlVG8sIHgsIHkpOwogICAgICAgICAgVXRpbC5wb2ludEJvdW5kaW5nQm94KHgsIHksIG1pbk1heCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgT1BTLmxpbmVUbzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCB4ID0gc3RhdGUuY3VycmVudFBvaW50WCA9IGFyZ3NbMF07CiAgICAgICAgICBjb25zdCB5ID0gc3RhdGUuY3VycmVudFBvaW50WSA9IGFyZ3NbMV07CiAgICAgICAgICBwYXRoQnVmZmVyLnB1c2goRHJhd09QUy5saW5lVG8sIHgsIHkpOwogICAgICAgICAgVXRpbC5wb2ludEJvdW5kaW5nQm94KHgsIHksIG1pbk1heCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgT1BTLmN1cnZlVG86CiAgICAgICAgewogICAgICAgICAgY29uc3Qgc3RhcnRYID0gc3RhdGUuY3VycmVudFBvaW50WDsKICAgICAgICAgIGNvbnN0IHN0YXJ0WSA9IHN0YXRlLmN1cnJlbnRQb2ludFk7CiAgICAgICAgICBjb25zdCBbeDEsIHkxLCB4MiwgeTIsIHgsIHldID0gYXJnczsKICAgICAgICAgIHN0YXRlLmN1cnJlbnRQb2ludFggPSB4OwogICAgICAgICAgc3RhdGUuY3VycmVudFBvaW50WSA9IHk7CiAgICAgICAgICBwYXRoQnVmZmVyLnB1c2goRHJhd09QUy5jdXJ2ZVRvLCB4MSwgeTEsIHgyLCB5MiwgeCwgeSk7CiAgICAgICAgICBVdGlsLmJlemllckJvdW5kaW5nQm94KHN0YXJ0WCwgc3RhcnRZLCB4MSwgeTEsIHgyLCB5MiwgeCwgeSwgbWluTWF4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSBPUFMuY3VydmVUbzI6CiAgICAgICAgewogICAgICAgICAgY29uc3Qgc3RhcnRYID0gc3RhdGUuY3VycmVudFBvaW50WDsKICAgICAgICAgIGNvbnN0IHN0YXJ0WSA9IHN0YXRlLmN1cnJlbnRQb2ludFk7CiAgICAgICAgICBjb25zdCBbeDEsIHkxLCB4LCB5XSA9IGFyZ3M7CiAgICAgICAgICBzdGF0ZS5jdXJyZW50UG9pbnRYID0geDsKICAgICAgICAgIHN0YXRlLmN1cnJlbnRQb2ludFkgPSB5OwogICAgICAgICAgcGF0aEJ1ZmZlci5wdXNoKERyYXdPUFMuY3VydmVUbywgc3RhcnRYLCBzdGFydFksIHgxLCB5MSwgeCwgeSk7CiAgICAgICAgICBVdGlsLmJlemllckJvdW5kaW5nQm94KHN0YXJ0WCwgc3RhcnRZLCBzdGFydFgsIHN0YXJ0WSwgeDEsIHkxLCB4LCB5LCBtaW5NYXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlIE9QUy5jdXJ2ZVRvMzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBzdGFydFggPSBzdGF0ZS5jdXJyZW50UG9pbnRYOwogICAgICAgICAgY29uc3Qgc3RhcnRZID0gc3RhdGUuY3VycmVudFBvaW50WTsKICAgICAgICAgIGNvbnN0IFt4MSwgeTEsIHgsIHldID0gYXJnczsKICAgICAgICAgIHN0YXRlLmN1cnJlbnRQb2ludFggPSB4OwogICAgICAgICAgc3RhdGUuY3VycmVudFBvaW50WSA9IHk7CiAgICAgICAgICBwYXRoQnVmZmVyLnB1c2goRHJhd09QUy5jdXJ2ZVRvLCB4MSwgeTEsIHgsIHksIHgsIHkpOwogICAgICAgICAgVXRpbC5iZXppZXJCb3VuZGluZ0JveChzdGFydFgsIHN0YXJ0WSwgeDEsIHkxLCB4LCB5LCB4LCB5LCBtaW5NYXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlIE9QUy5jbG9zZVBhdGg6CiAgICAgICAgcGF0aEJ1ZmZlci5wdXNoKERyYXdPUFMuY2xvc2VQYXRoKTsKICAgICAgICBicmVhazsKICAgIH0KICB9CiAgX2dldENvbG9yU3BhY2UoY3MsIHJlc291cmNlcywgbG9jYWxDb2xvclNwYWNlQ2FjaGUpIHsKICAgIHJldHVybiBDb2xvclNwYWNlVXRpbHMucGFyc2UoewogICAgICBjcywKICAgICAgeHJlZjogdGhpcy54cmVmLAogICAgICByZXNvdXJjZXMsCiAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeTogdGhpcy5fcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGU6IHRoaXMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgYXN5bmNJZk5vdENhY2hlZDogdHJ1ZQogICAgfSk7CiAgfQogIGFzeW5jIF9oYW5kbGVDb2xvclNwYWNlKGNzUHJvbWlzZSkgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIGF3YWl0IGNzUHJvbWlzZTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICB3YXJuKGBfaGFuZGxlQ29sb3JTcGFjZSAtIGlnbm9yaW5nIENvbG9yU3BhY2U6ICIke2V4fSIuYCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgdGhyb3cgZXg7CiAgICB9CiAgfQogIHBhcnNlU2hhZGluZyh7CiAgICBzaGFkaW5nLAogICAgcmVzb3VyY2VzLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUsCiAgICBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUKICB9KSB7CiAgICBsZXQgaWQgPSBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUuZ2V0KHNoYWRpbmcpOwogICAgaWYgKGlkKSB7CiAgICAgIHJldHVybiBpZDsKICAgIH0KICAgIGxldCBwYXR0ZXJuSVI7CiAgICB0cnkgewogICAgICBjb25zdCBzaGFkaW5nRmlsbCA9IFBhdHRlcm4ucGFyc2VTaGFkaW5nKHNoYWRpbmcsIHRoaXMueHJlZiwgcmVzb3VyY2VzLCB0aGlzLl9wZGZGdW5jdGlvbkZhY3RvcnksIHRoaXMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLCBsb2NhbENvbG9yU3BhY2VDYWNoZSk7CiAgICAgIHBhdHRlcm5JUiA9IHNoYWRpbmdGaWxsLmdldElSKCk7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICB3YXJuKGBwYXJzZVNoYWRpbmcgLSBpZ25vcmluZyBzaGFkaW5nOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUuc2V0KHNoYWRpbmcsIG51bGwpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHRocm93IHJlYXNvbjsKICAgIH0KICAgIGlkID0gYHBhdHRlcm5fJHt0aGlzLmlkRmFjdG9yeS5jcmVhdGVPYmpJZCgpfWA7CiAgICBpZiAodGhpcy5wYXJzaW5nVHlwZTNGb250KSB7CiAgICAgIGlkID0gYCR7dGhpcy5pZEZhY3RvcnkuZ2V0RG9jSWQoKX1fdHlwZTNfJHtpZH1gOwogICAgfQogICAgbG9jYWxTaGFkaW5nUGF0dGVybkNhY2hlLnNldChzaGFkaW5nLCBpZCk7CiAgICBpZiAodGhpcy5wYXJzaW5nVHlwZTNGb250KSB7CiAgICAgIHRoaXMuaGFuZGxlci5zZW5kKCJjb21tb25vYmoiLCBbaWQsICJQYXR0ZXJuIiwgcGF0dGVybklSXSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmhhbmRsZXIuc2VuZCgib2JqIiwgW2lkLCB0aGlzLnBhZ2VJbmRleCwgIlBhdHRlcm4iLCBwYXR0ZXJuSVJdKTsKICAgIH0KICAgIHJldHVybiBpZDsKICB9CiAgaGFuZGxlQ29sb3JOKG9wZXJhdG9yTGlzdCwgZm4sIGFyZ3MsIGNzLCBwYXR0ZXJucywgcmVzb3VyY2VzLCB0YXNrLCBsb2NhbENvbG9yU3BhY2VDYWNoZSwgbG9jYWxUaWxpbmdQYXR0ZXJuQ2FjaGUsIGxvY2FsU2hhZGluZ1BhdHRlcm5DYWNoZSkgewogICAgY29uc3QgcGF0dGVybk5hbWUgPSBhcmdzLnBvcCgpOwogICAgaWYgKHBhdHRlcm5OYW1lIGluc3RhbmNlb2YgTmFtZSkgewogICAgICBjb25zdCByYXdQYXR0ZXJuID0gcGF0dGVybnMuZ2V0UmF3KHBhdHRlcm5OYW1lLm5hbWUpOwogICAgICBjb25zdCBsb2NhbFRpbGluZ1BhdHRlcm4gPSByYXdQYXR0ZXJuIGluc3RhbmNlb2YgUmVmICYmIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLmdldEJ5UmVmKHJhd1BhdHRlcm4pOwogICAgICBpZiAobG9jYWxUaWxpbmdQYXR0ZXJuKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IGNvbG9yID0gY3MuYmFzZSA/IGNzLmJhc2UuZ2V0UmdiSGV4KGFyZ3MsIDApIDogbnVsbDsKICAgICAgICAgIGNvbnN0IHRpbGluZ1BhdHRlcm5JUiA9IGdldFRpbGluZ1BhdHRlcm5JUihsb2NhbFRpbGluZ1BhdHRlcm4ub3BlcmF0b3JMaXN0SVIsIGxvY2FsVGlsaW5nUGF0dGVybi5kaWN0LCBjb2xvcik7CiAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIHRpbGluZ1BhdHRlcm5JUik7CiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH0gY2F0Y2gge30KICAgICAgfQogICAgICBjb25zdCBwYXR0ZXJuID0gdGhpcy54cmVmLmZldGNoSWZSZWYocmF3UGF0dGVybik7CiAgICAgIGlmIChwYXR0ZXJuKSB7CiAgICAgICAgY29uc3QgZGljdCA9IHBhdHRlcm4gaW5zdGFuY2VvZiBCYXNlU3RyZWFtID8gcGF0dGVybi5kaWN0IDogcGF0dGVybjsKICAgICAgICBjb25zdCB0eXBlTnVtID0gZGljdC5nZXQoIlBhdHRlcm5UeXBlIik7CiAgICAgICAgaWYgKHR5cGVOdW0gPT09IFBhdHRlcm5UeXBlLlRJTElORykgewogICAgICAgICAgY29uc3QgY29sb3IgPSBjcy5iYXNlID8gY3MuYmFzZS5nZXRSZ2JIZXgoYXJncywgMCkgOiBudWxsOwogICAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlVGlsaW5nVHlwZShmbiwgY29sb3IsIHJlc291cmNlcywgcGF0dGVybiwgZGljdCwgb3BlcmF0b3JMaXN0LCB0YXNrLCBsb2NhbFRpbGluZ1BhdHRlcm5DYWNoZSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlTnVtID09PSBQYXR0ZXJuVHlwZS5TSEFESU5HKSB7CiAgICAgICAgICBjb25zdCBzaGFkaW5nID0gZGljdC5nZXQoIlNoYWRpbmciKTsKICAgICAgICAgIGNvbnN0IG9iaklkID0gdGhpcy5wYXJzZVNoYWRpbmcoewogICAgICAgICAgICBzaGFkaW5nLAogICAgICAgICAgICByZXNvdXJjZXMsCiAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlLAogICAgICAgICAgICBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKG9iaklkKSB7CiAgICAgICAgICAgIGNvbnN0IG1hdHJpeCA9IGxvb2t1cE1hdHJpeChkaWN0LmdldEFycmF5KCJNYXRyaXgiKSwgbnVsbCk7CiAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChmbiwgWyJTaGFkaW5nIiwgb2JqSWQsIG1hdHJpeF0pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbmtub3duIFBhdHRlcm5UeXBlOiAke3R5cGVOdW19YCk7CiAgICAgIH0KICAgIH0KICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgVW5rbm93biBQYXR0ZXJuTmFtZTogJHtwYXR0ZXJuTmFtZX1gKTsKICB9CiAgX3BhcnNlVmlzaWJpbGl0eUV4cHJlc3Npb24oYXJyYXksIG5lc3RpbmdDb3VudGVyLCBjdXJyZW50UmVzdWx0KSB7CiAgICBjb25zdCBNQVhfTkVTVElORyA9IDEwOwogICAgaWYgKCsrbmVzdGluZ0NvdW50ZXIgPiBNQVhfTkVTVElORykgewogICAgICB3YXJuKCJWaXNpYmlsaXR5IGV4cHJlc3Npb24gaXMgdG9vIGRlZXBseSBuZXN0ZWQiKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgY29uc3Qgb3BlcmF0b3IgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihhcnJheVswXSk7CiAgICBpZiAobGVuZ3RoIDwgMiB8fCAhKG9wZXJhdG9yIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgd2FybigiSW52YWxpZCB2aXNpYmlsaXR5IGV4cHJlc3Npb24iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3dpdGNoIChvcGVyYXRvci5uYW1lKSB7CiAgICAgIGNhc2UgIkFuZCI6CiAgICAgIGNhc2UgIk9yIjoKICAgICAgY2FzZSAiTm90IjoKICAgICAgICBjdXJyZW50UmVzdWx0LnB1c2gob3BlcmF0b3IubmFtZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgd2FybihgSW52YWxpZCBvcGVyYXRvciAke29wZXJhdG9yLm5hbWV9IGluIHZpc2liaWxpdHkgZXhwcmVzc2lvbmApOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAobGV0IGkgPSAxOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgcmF3ID0gYXJyYXlbaV07CiAgICAgIGNvbnN0IG9iamVjdCA9IHRoaXMueHJlZi5mZXRjaElmUmVmKHJhdyk7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KG9iamVjdCkpIHsKICAgICAgICBjb25zdCBuZXN0ZWRSZXN1bHQgPSBbXTsKICAgICAgICBjdXJyZW50UmVzdWx0LnB1c2gobmVzdGVkUmVzdWx0KTsKICAgICAgICB0aGlzLl9wYXJzZVZpc2liaWxpdHlFeHByZXNzaW9uKG9iamVjdCwgbmVzdGluZ0NvdW50ZXIsIG5lc3RlZFJlc3VsdCk7CiAgICAgIH0gZWxzZSBpZiAocmF3IGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgY3VycmVudFJlc3VsdC5wdXNoKHJhdy50b1N0cmluZygpKTsKICAgICAgfQogICAgfQogIH0KICBhc3luYyBwYXJzZU1hcmtlZENvbnRlbnRQcm9wcyhjb250ZW50UHJvcGVydGllcywgcmVzb3VyY2VzKSB7CiAgICBsZXQgb3B0aW9uYWxDb250ZW50OwogICAgaWYgKGNvbnRlbnRQcm9wZXJ0aWVzIGluc3RhbmNlb2YgTmFtZSkgewogICAgICBjb25zdCBwcm9wZXJ0aWVzID0gcmVzb3VyY2VzLmdldCgiUHJvcGVydGllcyIpOwogICAgICBvcHRpb25hbENvbnRlbnQgPSBwcm9wZXJ0aWVzLmdldChjb250ZW50UHJvcGVydGllcy5uYW1lKTsKICAgIH0gZWxzZSBpZiAoY29udGVudFByb3BlcnRpZXMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIG9wdGlvbmFsQ29udGVudCA9IGNvbnRlbnRQcm9wZXJ0aWVzOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJPcHRpb25hbCBjb250ZW50IHByb3BlcnRpZXMgbWFsZm9ybWVkLiIpOwogICAgfQogICAgY29uc3Qgb3B0aW9uYWxDb250ZW50VHlwZSA9IG9wdGlvbmFsQ29udGVudC5nZXQoIlR5cGUiKT8ubmFtZTsKICAgIGlmIChvcHRpb25hbENvbnRlbnRUeXBlID09PSAiT0NHIikgewogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6IG9wdGlvbmFsQ29udGVudFR5cGUsCiAgICAgICAgaWQ6IG9wdGlvbmFsQ29udGVudC5vYmpJZAogICAgICB9OwogICAgfSBlbHNlIGlmIChvcHRpb25hbENvbnRlbnRUeXBlID09PSAiT0NNRCIpIHsKICAgICAgY29uc3QgZXhwcmVzc2lvbiA9IG9wdGlvbmFsQ29udGVudC5nZXQoIlZFIik7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGV4cHJlc3Npb24pKSB7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gW107CiAgICAgICAgdGhpcy5fcGFyc2VWaXNpYmlsaXR5RXhwcmVzc2lvbihleHByZXNzaW9uLCAwLCByZXN1bHQpOwogICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdHlwZTogIk9DTUQiLAogICAgICAgICAgICBleHByZXNzaW9uOiByZXN1bHQKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IG9wdGlvbmFsQ29udGVudEdyb3VwcyA9IG9wdGlvbmFsQ29udGVudC5nZXQoIk9DR3MiKTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkob3B0aW9uYWxDb250ZW50R3JvdXBzKSB8fCBvcHRpb25hbENvbnRlbnRHcm91cHMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgY29uc3QgZ3JvdXBJZHMgPSBbXTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvcHRpb25hbENvbnRlbnRHcm91cHMpKSB7CiAgICAgICAgICBmb3IgKGNvbnN0IG9jZyBvZiBvcHRpb25hbENvbnRlbnRHcm91cHMpIHsKICAgICAgICAgICAgZ3JvdXBJZHMucHVzaChvY2cudG9TdHJpbmcoKSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGdyb3VwSWRzLnB1c2gob3B0aW9uYWxDb250ZW50R3JvdXBzLm9iaklkKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6IG9wdGlvbmFsQ29udGVudFR5cGUsCiAgICAgICAgICBpZHM6IGdyb3VwSWRzLAogICAgICAgICAgcG9saWN5OiBvcHRpb25hbENvbnRlbnQuZ2V0KCJQIikgaW5zdGFuY2VvZiBOYW1lID8gb3B0aW9uYWxDb250ZW50LmdldCgiUCIpLm5hbWUgOiBudWxsLAogICAgICAgICAgZXhwcmVzc2lvbjogbnVsbAogICAgICAgIH07CiAgICAgIH0gZWxzZSBpZiAob3B0aW9uYWxDb250ZW50R3JvdXBzIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6IG9wdGlvbmFsQ29udGVudFR5cGUsCiAgICAgICAgICBpZDogb3B0aW9uYWxDb250ZW50R3JvdXBzLnRvU3RyaW5nKCkKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgZ2V0T3BlcmF0b3JMaXN0KHsKICAgIHN0cmVhbSwKICAgIHRhc2ssCiAgICByZXNvdXJjZXMsCiAgICBvcGVyYXRvckxpc3QsCiAgICBpbml0aWFsU3RhdGUgPSBudWxsLAogICAgZmFsbGJhY2tGb250RGljdCA9IG51bGwsCiAgICBwcmV2UmVmcyA9IG51bGwKICB9KSB7CiAgICBjb25zdCBvYmpJZCA9IHN0cmVhbS5kaWN0Py5vYmpJZDsKICAgIGNvbnN0IHNlZW5SZWZzID0gbmV3IFJlZlNldChwcmV2UmVmcyk7CiAgICBpZiAob2JqSWQpIHsKICAgICAgaWYgKHByZXZSZWZzPy5oYXMob2JqSWQpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBjaXJjdWxhciByZWZlcmVuY2U6ICR7b2JqSWR9YCk7CiAgICAgIH0KICAgICAgc2VlblJlZnMucHV0KG9iaklkKTsKICAgIH0KICAgIHJlc291cmNlcyB8fD0gRGljdC5lbXB0eTsKICAgIGluaXRpYWxTdGF0ZSB8fD0gbmV3IEV2YWxTdGF0ZSgpOwogICAgaWYgKCFvcGVyYXRvckxpc3QpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdnZXRPcGVyYXRvckxpc3Q6IG1pc3NpbmcgIm9wZXJhdG9yTGlzdCIgcGFyYW1ldGVyJyk7CiAgICB9CiAgICBjb25zdCBzZWxmID0gdGhpczsKICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWY7CiAgICBjb25zdCBsb2NhbEltYWdlQ2FjaGUgPSBuZXcgTG9jYWxJbWFnZUNhY2hlKCk7CiAgICBjb25zdCBsb2NhbENvbG9yU3BhY2VDYWNoZSA9IG5ldyBMb2NhbENvbG9yU3BhY2VDYWNoZSgpOwogICAgY29uc3QgbG9jYWxHU3RhdGVDYWNoZSA9IG5ldyBMb2NhbEdTdGF0ZUNhY2hlKCk7CiAgICBjb25zdCBsb2NhbFRpbGluZ1BhdHRlcm5DYWNoZSA9IG5ldyBMb2NhbFRpbGluZ1BhdHRlcm5DYWNoZSgpOwogICAgY29uc3QgbG9jYWxTaGFkaW5nUGF0dGVybkNhY2hlID0gbmV3IE1hcCgpOwogICAgY29uc3QgeG9ianMgPSByZXNvdXJjZXMuZ2V0KCJYT2JqZWN0IikgfHwgRGljdC5lbXB0eTsKICAgIGNvbnN0IHBhdHRlcm5zID0gcmVzb3VyY2VzLmdldCgiUGF0dGVybiIpIHx8IERpY3QuZW1wdHk7CiAgICBjb25zdCBzdGF0ZU1hbmFnZXIgPSBuZXcgU3RhdGVNYW5hZ2VyKGluaXRpYWxTdGF0ZSk7CiAgICBjb25zdCBwcmVwcm9jZXNzb3IgPSBuZXcgRXZhbHVhdG9yUHJlcHJvY2Vzc29yKHN0cmVhbSwgeHJlZiwgc3RhdGVNYW5hZ2VyKTsKICAgIGNvbnN0IHRpbWVTbG90TWFuYWdlciA9IG5ldyBUaW1lU2xvdE1hbmFnZXIoKTsKICAgIGZ1bmN0aW9uIGNsb3NlUGVuZGluZ1Jlc3RvcmVPUFMoYXJndW1lbnQpIHsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gcHJlcHJvY2Vzc29yLnNhdmVkU3RhdGVzRGVwdGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5yZXN0b3JlLCBbXSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiBwcm9taXNlQm9keShyZXNvbHZlLCByZWplY3QpIHsKICAgICAgY29uc3QgbmV4dCA9IGZ1bmN0aW9uIChwcm9taXNlKSB7CiAgICAgICAgUHJvbWlzZS5hbGwoW3Byb21pc2UsIG9wZXJhdG9yTGlzdC5yZWFkeV0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcHJvbWlzZUJvZHkocmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIHJlamVjdChleCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgcmVqZWN0KTsKICAgICAgfTsKICAgICAgdGFzay5lbnN1cmVOb3RUZXJtaW5hdGVkKCk7CiAgICAgIHRpbWVTbG90TWFuYWdlci5yZXNldCgpOwogICAgICBjb25zdCBvcGVyYXRpb24gPSB7fTsKICAgICAgbGV0IHN0b3AsIGksIGlpLCBjcywgbmFtZSwgaXNWYWxpZE5hbWU7CiAgICAgIHdoaWxlICghKHN0b3AgPSB0aW1lU2xvdE1hbmFnZXIuY2hlY2soKSkpIHsKICAgICAgICBvcGVyYXRpb24uYXJncyA9IG51bGw7CiAgICAgICAgaWYgKCFwcmVwcm9jZXNzb3IucmVhZChvcGVyYXRpb24pKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgbGV0IGFyZ3MgPSBvcGVyYXRpb24uYXJnczsKICAgICAgICBsZXQgZm4gPSBvcGVyYXRpb24uZm47CiAgICAgICAgc3dpdGNoIChmbiB8IDApIHsKICAgICAgICAgIGNhc2UgT1BTLnBhaW50WE9iamVjdDoKICAgICAgICAgICAgaXNWYWxpZE5hbWUgPSBhcmdzWzBdIGluc3RhbmNlb2YgTmFtZTsKICAgICAgICAgICAgbmFtZSA9IGFyZ3NbMF0ubmFtZTsKICAgICAgICAgICAgaWYgKGlzVmFsaWROYW1lKSB7CiAgICAgICAgICAgICAgY29uc3QgbG9jYWxJbWFnZSA9IGxvY2FsSW1hZ2VDYWNoZS5nZXRCeU5hbWUobmFtZSk7CiAgICAgICAgICAgICAgaWYgKGxvY2FsSW1hZ2UpIHsKICAgICAgICAgICAgICAgIGFkZENhY2hlZEltYWdlT3BzKG9wZXJhdG9yTGlzdCwgbG9jYWxJbWFnZSk7CiAgICAgICAgICAgICAgICBhcmdzID0gbnVsbDsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0KG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlWE9iamVjdCwgcmVqZWN0WE9iamVjdCkgewogICAgICAgICAgICAgIGlmICghaXNWYWxpZE5hbWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiWE9iamVjdCBtdXN0IGJlIHJlZmVycmVkIHRvIGJ5IG5hbWUuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGxldCB4b2JqID0geG9ianMuZ2V0UmF3KG5hbWUpOwogICAgICAgICAgICAgIGlmICh4b2JqIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjYWNoZWRJbWFnZSA9IGxvY2FsSW1hZ2VDYWNoZS5nZXRCeVJlZih4b2JqKSB8fCBzZWxmLl9yZWdpb25hbEltYWdlQ2FjaGUuZ2V0QnlSZWYoeG9iaikgfHwgc2VsZi5nbG9iYWxJbWFnZUNhY2hlLmdldERhdGEoeG9iaiwgc2VsZi5wYWdlSW5kZXgpOwogICAgICAgICAgICAgICAgaWYgKGNhY2hlZEltYWdlKSB7CiAgICAgICAgICAgICAgICAgIGFkZENhY2hlZEltYWdlT3BzKG9wZXJhdG9yTGlzdCwgY2FjaGVkSW1hZ2UpOwogICAgICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB4b2JqID0geHJlZi5mZXRjaCh4b2JqKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKCEoeG9iaiBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlhPYmplY3Qgc2hvdWxkIGJlIGEgc3RyZWFtIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB4b2JqLmRpY3QuZ2V0KCJTdWJ0eXBlIik7CiAgICAgICAgICAgICAgaWYgKCEodHlwZSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlhPYmplY3Qgc2hvdWxkIGhhdmUgYSBOYW1lIHN1YnR5cGUiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHR5cGUubmFtZSA9PT0gIkZvcm0iKSB7CiAgICAgICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc2F2ZSgpOwogICAgICAgICAgICAgICAgc2VsZi5idWlsZEZvcm1YT2JqZWN0KHJlc291cmNlcywgeG9iaiwgbnVsbCwgb3BlcmF0b3JMaXN0LCB0YXNrLCBzdGF0ZU1hbmFnZXIuc3RhdGUuY2xvbmUoewogICAgICAgICAgICAgICAgICBuZXdQYXRoOiB0cnVlCiAgICAgICAgICAgICAgICB9KSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIHNlZW5SZWZzKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnJlc3RvcmUoKTsKICAgICAgICAgICAgICAgICAgcmVzb2x2ZVhPYmplY3QoKTsKICAgICAgICAgICAgICAgIH0sIHJlamVjdFhPYmplY3QpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZS5uYW1lID09PSAiSW1hZ2UiKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkUGFpbnRJbWFnZVhPYmplY3QoewogICAgICAgICAgICAgICAgICByZXNvdXJjZXMsCiAgICAgICAgICAgICAgICAgIGltYWdlOiB4b2JqLAogICAgICAgICAgICAgICAgICBvcGVyYXRvckxpc3QsCiAgICAgICAgICAgICAgICAgIGNhY2hlS2V5OiBuYW1lLAogICAgICAgICAgICAgICAgICBsb2NhbEltYWdlQ2FjaGUsCiAgICAgICAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICAgICAgICAgICAgICB9KS50aGVuKHJlc29sdmVYT2JqZWN0LCByZWplY3RYT2JqZWN0KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUubmFtZSA9PT0gIlBTIikgewogICAgICAgICAgICAgICAgaW5mbygiSWdub3JlZCBYT2JqZWN0IHN1YnR5cGUgUFMiKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBVbmhhbmRsZWQgWE9iamVjdCBzdWJ0eXBlICR7dHlwZS5uYW1lfWApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgICB3YXJuKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBYT2JqZWN0OiAiJHtyZWFzb259Ii5gKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhyb3cgcmVhc29uOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIGNhc2UgT1BTLnNldEZvbnQ6CiAgICAgICAgICAgIGNvbnN0IGZvbnRTaXplID0gYXJnc1sxXTsKICAgICAgICAgICAgbmV4dChzZWxmLmhhbmRsZVNldEZvbnQocmVzb3VyY2VzLCBhcmdzLCBudWxsLCBvcGVyYXRvckxpc3QsIHRhc2ssIHN0YXRlTWFuYWdlci5zdGF0ZSwgZmFsbGJhY2tGb250RGljdCkudGhlbihmdW5jdGlvbiAobG9hZGVkTmFtZSkgewogICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGREZXBlbmRlbmN5KGxvYWRlZE5hbWUpOwogICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChPUFMuc2V0Rm9udCwgW2xvYWRlZE5hbWUsIGZvbnRTaXplXSk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY2FzZSBPUFMuZW5kSW5saW5lSW1hZ2U6CiAgICAgICAgICAgIGNvbnN0IGNhY2hlS2V5ID0gYXJnc1swXS5jYWNoZUtleTsKICAgICAgICAgICAgaWYgKGNhY2hlS2V5KSB7CiAgICAgICAgICAgICAgY29uc3QgbG9jYWxJbWFnZSA9IGxvY2FsSW1hZ2VDYWNoZS5nZXRCeU5hbWUoY2FjaGVLZXkpOwogICAgICAgICAgICAgIGlmIChsb2NhbEltYWdlKSB7CiAgICAgICAgICAgICAgICBhZGRDYWNoZWRJbWFnZU9wcyhvcGVyYXRvckxpc3QsIGxvY2FsSW1hZ2UpOwogICAgICAgICAgICAgICAgYXJncyA9IG51bGw7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV4dChzZWxmLmJ1aWxkUGFpbnRJbWFnZVhPYmplY3QoewogICAgICAgICAgICAgIHJlc291cmNlcywKICAgICAgICAgICAgICBpbWFnZTogYXJnc1swXSwKICAgICAgICAgICAgICBpc0lubGluZTogdHJ1ZSwKICAgICAgICAgICAgICBvcGVyYXRvckxpc3QsCiAgICAgICAgICAgICAgY2FjaGVLZXksCiAgICAgICAgICAgICAgbG9jYWxJbWFnZUNhY2hlLAogICAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY2FzZSBPUFMuc2hvd1RleHQ6CiAgICAgICAgICAgIGlmICghc3RhdGVNYW5hZ2VyLnN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgICBzZWxmLmVuc3VyZVN0YXRlRm9udChzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFyZ3NbMF0gPSBzZWxmLmhhbmRsZVRleHQoYXJnc1swXSwgc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zaG93U3BhY2VkVGV4dDoKICAgICAgICAgICAgaWYgKCFzdGF0ZU1hbmFnZXIuc3RhdGUuZm9udCkgewogICAgICAgICAgICAgIHNlbGYuZW5zdXJlU3RhdGVGb250KHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgY29tYmluZWRHbHlwaHMgPSBbXSwKICAgICAgICAgICAgICBzdGF0ZSA9IHN0YXRlTWFuYWdlci5zdGF0ZTsKICAgICAgICAgICAgZm9yIChjb25zdCBhcnJJdGVtIG9mIGFyZ3NbMF0pIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIGFyckl0ZW0gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICBjb21iaW5lZEdseXBocy5wdXNoKC4uLnNlbGYuaGFuZGxlVGV4dChhcnJJdGVtLCBzdGF0ZSkpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGFyckl0ZW0gPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICBjb21iaW5lZEdseXBocy5wdXNoKGFyckl0ZW0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBhcmdzWzBdID0gY29tYmluZWRHbHlwaHM7CiAgICAgICAgICAgIGZuID0gT1BTLnNob3dUZXh0OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLm5leHRMaW5lU2hvd1RleHQ6CiAgICAgICAgICAgIGlmICghc3RhdGVNYW5hZ2VyLnN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgICBzZWxmLmVuc3VyZVN0YXRlRm9udChzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChPUFMubmV4dExpbmUpOwogICAgICAgICAgICBhcmdzWzBdID0gc2VsZi5oYW5kbGVUZXh0KGFyZ3NbMF0sIHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgIGZuID0gT1BTLnNob3dUZXh0OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLm5leHRMaW5lU2V0U3BhY2luZ1Nob3dUZXh0OgogICAgICAgICAgICBpZiAoIXN0YXRlTWFuYWdlci5zdGF0ZS5mb250KSB7CiAgICAgICAgICAgICAgc2VsZi5lbnN1cmVTdGF0ZUZvbnQoc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLm5leHRMaW5lKTsKICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5zZXRXb3JkU3BhY2luZywgW2FyZ3Muc2hpZnQoKV0pOwogICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLnNldENoYXJTcGFjaW5nLCBbYXJncy5zaGlmdCgpXSk7CiAgICAgICAgICAgIGFyZ3NbMF0gPSBzZWxmLmhhbmRsZVRleHQoYXJnc1swXSwgc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgZm4gPSBPUFMuc2hvd1RleHQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0VGV4dFJlbmRlcmluZ01vZGU6CiAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS50ZXh0UmVuZGVyaW5nTW9kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0RmlsbENvbG9yU3BhY2U6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb25zdCBmaWxsQ1MgPSBzZWxmLl9nZXRDb2xvclNwYWNlKGFyZ3NbMF0sIHJlc291cmNlcywgbG9jYWxDb2xvclNwYWNlQ2FjaGUpOwogICAgICAgICAgICAgIGlmIChmaWxsQ1MgaW5zdGFuY2VvZiBDb2xvclNwYWNlKSB7CiAgICAgICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc3RhdGUuZmlsbENvbG9yU3BhY2UgPSBmaWxsQ1M7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbmV4dChzZWxmLl9oYW5kbGVDb2xvclNwYWNlKGZpbGxDUykudGhlbihjb2xvclNwYWNlID0+IHsKICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5maWxsQ29sb3JTcGFjZSA9IGNvbG9yU3BhY2UgfHwgQ29sb3JTcGFjZVV0aWxzLmdyYXk7CiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgY2FzZSBPUFMuc2V0U3Ryb2tlQ29sb3JTcGFjZToKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnN0IHN0cm9rZUNTID0gc2VsZi5fZ2V0Q29sb3JTcGFjZShhcmdzWzBdLCByZXNvdXJjZXMsIGxvY2FsQ29sb3JTcGFjZUNhY2hlKTsKICAgICAgICAgICAgICBpZiAoc3Ryb2tlQ1MgaW5zdGFuY2VvZiBDb2xvclNwYWNlKSB7CiAgICAgICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc3RhdGUuc3Ryb2tlQ29sb3JTcGFjZSA9IHN0cm9rZUNTOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIG5leHQoc2VsZi5faGFuZGxlQ29sb3JTcGFjZShzdHJva2VDUykudGhlbihjb2xvclNwYWNlID0+IHsKICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5zdHJva2VDb2xvclNwYWNlID0gY29sb3JTcGFjZSB8fCBDb2xvclNwYWNlVXRpbHMuZ3JheTsKICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsQ29sb3I6CiAgICAgICAgICAgIGNzID0gc3RhdGVNYW5hZ2VyLnN0YXRlLmZpbGxDb2xvclNwYWNlOwogICAgICAgICAgICBhcmdzID0gW2NzLmdldFJnYkhleChhcmdzLCAwKV07CiAgICAgICAgICAgIGZuID0gT1BTLnNldEZpbGxSR0JDb2xvcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRTdHJva2VDb2xvcjoKICAgICAgICAgICAgY3MgPSBzdGF0ZU1hbmFnZXIuc3RhdGUuc3Ryb2tlQ29sb3JTcGFjZTsKICAgICAgICAgICAgYXJncyA9IFtjcy5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBmbiA9IE9QUy5zZXRTdHJva2VSR0JDb2xvcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsR3JheToKICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLmZpbGxDb2xvclNwYWNlID0gQ29sb3JTcGFjZVV0aWxzLmdyYXk7CiAgICAgICAgICAgIGFyZ3MgPSBbQ29sb3JTcGFjZVV0aWxzLmdyYXkuZ2V0UmdiSGV4KGFyZ3MsIDApXTsKICAgICAgICAgICAgZm4gPSBPUFMuc2V0RmlsbFJHQkNvbG9yOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldFN0cm9rZUdyYXk6CiAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5zdHJva2VDb2xvclNwYWNlID0gQ29sb3JTcGFjZVV0aWxzLmdyYXk7CiAgICAgICAgICAgIGFyZ3MgPSBbQ29sb3JTcGFjZVV0aWxzLmdyYXkuZ2V0UmdiSGV4KGFyZ3MsIDApXTsKICAgICAgICAgICAgZm4gPSBPUFMuc2V0U3Ryb2tlUkdCQ29sb3I7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0RmlsbENNWUtDb2xvcjoKICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLmZpbGxDb2xvclNwYWNlID0gQ29sb3JTcGFjZVV0aWxzLmNteWs7CiAgICAgICAgICAgIGFyZ3MgPSBbQ29sb3JTcGFjZVV0aWxzLmNteWsuZ2V0UmdiSGV4KGFyZ3MsIDApXTsKICAgICAgICAgICAgZm4gPSBPUFMuc2V0RmlsbFJHQkNvbG9yOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldFN0cm9rZUNNWUtDb2xvcjoKICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLnN0cm9rZUNvbG9yU3BhY2UgPSBDb2xvclNwYWNlVXRpbHMuY215azsKICAgICAgICAgICAgYXJncyA9IFtDb2xvclNwYWNlVXRpbHMuY215ay5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBmbiA9IE9QUy5zZXRTdHJva2VSR0JDb2xvcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsUkdCQ29sb3I6CiAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5maWxsQ29sb3JTcGFjZSA9IENvbG9yU3BhY2VVdGlscy5yZ2I7CiAgICAgICAgICAgIGFyZ3MgPSBbQ29sb3JTcGFjZVV0aWxzLnJnYi5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldFN0cm9rZVJHQkNvbG9yOgogICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc3RhdGUuc3Ryb2tlQ29sb3JTcGFjZSA9IENvbG9yU3BhY2VVdGlscy5yZ2I7CiAgICAgICAgICAgIGFyZ3MgPSBbQ29sb3JTcGFjZVV0aWxzLnJnYi5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEZpbGxDb2xvck46CiAgICAgICAgICAgIGNzID0gc3RhdGVNYW5hZ2VyLnN0YXRlLnBhdHRlcm5GaWxsQ29sb3JTcGFjZTsKICAgICAgICAgICAgaWYgKCFjcykgewogICAgICAgICAgICAgIGlmIChpc051bWJlckFycmF5KGFyZ3MsIG51bGwpKSB7CiAgICAgICAgICAgICAgICBhcmdzID0gW0NvbG9yU3BhY2VVdGlscy5ncmF5LmdldFJnYkhleChhcmdzLCAwKV07CiAgICAgICAgICAgICAgICBmbiA9IE9QUy5zZXRGaWxsUkdCQ29sb3I7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYXJncyA9IFtdOwogICAgICAgICAgICAgIGZuID0gT1BTLnNldEZpbGxUcmFuc3BhcmVudDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY3MubmFtZSA9PT0gIlBhdHRlcm4iKSB7CiAgICAgICAgICAgICAgbmV4dChzZWxmLmhhbmRsZUNvbG9yTihvcGVyYXRvckxpc3QsIE9QUy5zZXRGaWxsQ29sb3JOLCBhcmdzLCBjcywgcGF0dGVybnMsIHJlc291cmNlcywgdGFzaywgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLCBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUpKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXJncyA9IFtjcy5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBmbiA9IE9QUy5zZXRGaWxsUkdCQ29sb3I7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0U3Ryb2tlQ29sb3JOOgogICAgICAgICAgICBjcyA9IHN0YXRlTWFuYWdlci5zdGF0ZS5wYXR0ZXJuU3Ryb2tlQ29sb3JTcGFjZTsKICAgICAgICAgICAgaWYgKCFjcykgewogICAgICAgICAgICAgIGlmIChpc051bWJlckFycmF5KGFyZ3MsIG51bGwpKSB7CiAgICAgICAgICAgICAgICBhcmdzID0gW0NvbG9yU3BhY2VVdGlscy5ncmF5LmdldFJnYkhleChhcmdzLCAwKV07CiAgICAgICAgICAgICAgICBmbiA9IE9QUy5zZXRTdHJva2VSR0JDb2xvcjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBhcmdzID0gW107CiAgICAgICAgICAgICAgZm4gPSBPUFMuc2V0U3Ryb2tlVHJhbnNwYXJlbnQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNzLm5hbWUgPT09ICJQYXR0ZXJuIikgewogICAgICAgICAgICAgIG5leHQoc2VsZi5oYW5kbGVDb2xvck4ob3BlcmF0b3JMaXN0LCBPUFMuc2V0U3Ryb2tlQ29sb3JOLCBhcmdzLCBjcywgcGF0dGVybnMsIHJlc291cmNlcywgdGFzaywgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLCBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUpKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXJncyA9IFtjcy5nZXRSZ2JIZXgoYXJncywgMCldOwogICAgICAgICAgICBmbiA9IE9QUy5zZXRTdHJva2VSR0JDb2xvcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zaGFkaW5nRmlsbDoKICAgICAgICAgICAgbGV0IHNoYWRpbmc7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgY29uc3Qgc2hhZGluZ1JlcyA9IHJlc291cmNlcy5nZXQoIlNoYWRpbmciKTsKICAgICAgICAgICAgICBpZiAoIXNoYWRpbmdSZXMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTm8gc2hhZGluZyByZXNvdXJjZSBmb3VuZCIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzaGFkaW5nID0gc2hhZGluZ1Jlcy5nZXQoYXJnc1swXS5uYW1lKTsKICAgICAgICAgICAgICBpZiAoIXNoYWRpbmcpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiTm8gc2hhZGluZyBvYmplY3QgZm91bmQiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKHJlYXNvbikgewogICAgICAgICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBBYm9ydEV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgICB3YXJuKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBTaGFkaW5nOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcGF0dGVybklkID0gc2VsZi5wYXJzZVNoYWRpbmcoewogICAgICAgICAgICAgIHNoYWRpbmcsCiAgICAgICAgICAgICAgcmVzb3VyY2VzLAogICAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlLAogICAgICAgICAgICAgIGxvY2FsU2hhZGluZ1BhdHRlcm5DYWNoZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKCFwYXR0ZXJuSWQpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhcmdzID0gW3BhdHRlcm5JZF07CiAgICAgICAgICAgIGZuID0gT1BTLnNoYWRpbmdGaWxsOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEdTdGF0ZToKICAgICAgICAgICAgaXNWYWxpZE5hbWUgPSBhcmdzWzBdIGluc3RhbmNlb2YgTmFtZTsKICAgICAgICAgICAgbmFtZSA9IGFyZ3NbMF0ubmFtZTsKICAgICAgICAgICAgaWYgKGlzVmFsaWROYW1lKSB7CiAgICAgICAgICAgICAgY29uc3QgbG9jYWxHU3RhdGVPYmogPSBsb2NhbEdTdGF0ZUNhY2hlLmdldEJ5TmFtZShuYW1lKTsKICAgICAgICAgICAgICBpZiAobG9jYWxHU3RhdGVPYmopIHsKICAgICAgICAgICAgICAgIGlmIChsb2NhbEdTdGF0ZU9iai5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChPUFMuc2V0R1N0YXRlLCBbbG9jYWxHU3RhdGVPYmpdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGFyZ3MgPSBudWxsOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIG5leHQobmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmVHU3RhdGUsIHJlamVjdEdTdGF0ZSkgewogICAgICAgICAgICAgIGlmICghaXNWYWxpZE5hbWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiR1N0YXRlIG11c3QgYmUgcmVmZXJyZWQgdG8gYnkgbmFtZS4iKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgZXh0R1N0YXRlID0gcmVzb3VyY2VzLmdldCgiRXh0R1N0YXRlIik7CiAgICAgICAgICAgICAgaWYgKCEoZXh0R1N0YXRlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiRXh0R1N0YXRlIHNob3VsZCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGdTdGF0ZSA9IGV4dEdTdGF0ZS5nZXQobmFtZSk7CiAgICAgICAgICAgICAgaWYgKCEoZ1N0YXRlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiR1N0YXRlIHNob3VsZCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHNlbGYuc2V0R1N0YXRlKHsKICAgICAgICAgICAgICAgIHJlc291cmNlcywKICAgICAgICAgICAgICAgIGdTdGF0ZSwKICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdCwKICAgICAgICAgICAgICAgIGNhY2hlS2V5OiBuYW1lLAogICAgICAgICAgICAgICAgdGFzaywKICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlciwKICAgICAgICAgICAgICAgIGxvY2FsR1N0YXRlQ2FjaGUsCiAgICAgICAgICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgICAgICAgICAgIHNlZW5SZWZzCiAgICAgICAgICAgICAgfSkudGhlbihyZXNvbHZlR1N0YXRlLCByZWplY3RHU3RhdGUpOwogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgICB3YXJuKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBFeHRHU3RhdGU6ICIke3JlYXNvbn0iLmApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY2FzZSBPUFMuc2V0TGluZVdpZHRoOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29uc3QgW3RoaWNrbmVzc10gPSBhcmdzOwogICAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpY2tuZXNzICE9PSAibnVtYmVyIikgewogICAgICAgICAgICAgICAgd2FybihgSW52YWxpZCBzZXRMaW5lV2lkdGg6ICR7dGhpY2tuZXNzfWApOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGFyZ3NbMF0gPSBNYXRoLmFicyh0aGlja25lc3MpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIE9QUy5tb3ZlVG86CiAgICAgICAgICBjYXNlIE9QUy5saW5lVG86CiAgICAgICAgICBjYXNlIE9QUy5jdXJ2ZVRvOgogICAgICAgICAgY2FzZSBPUFMuY3VydmVUbzI6CiAgICAgICAgICBjYXNlIE9QUy5jdXJ2ZVRvMzoKICAgICAgICAgIGNhc2UgT1BTLmNsb3NlUGF0aDoKICAgICAgICAgIGNhc2UgT1BTLnJlY3RhbmdsZToKICAgICAgICAgICAgc2VsZi5idWlsZFBhdGgoZm4sIGFyZ3MsIHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgY2FzZSBPUFMuc3Ryb2tlOgogICAgICAgICAgY2FzZSBPUFMuY2xvc2VTdHJva2U6CiAgICAgICAgICBjYXNlIE9QUy5maWxsOgogICAgICAgICAgY2FzZSBPUFMuZW9GaWxsOgogICAgICAgICAgY2FzZSBPUFMuZmlsbFN0cm9rZToKICAgICAgICAgIGNhc2UgT1BTLmVvRmlsbFN0cm9rZToKICAgICAgICAgIGNhc2UgT1BTLmNsb3NlRmlsbFN0cm9rZToKICAgICAgICAgIGNhc2UgT1BTLmNsb3NlRU9GaWxsU3Ryb2tlOgogICAgICAgICAgY2FzZSBPUFMuZW5kUGF0aDoKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICAgIHN0YXRlOiB7CiAgICAgICAgICAgICAgICAgIHBhdGhCdWZmZXIsCiAgICAgICAgICAgICAgICAgIHBhdGhNaW5NYXgKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9ID0gc3RhdGVNYW5hZ2VyOwogICAgICAgICAgICAgIGlmIChmbiA9PT0gT1BTLmNsb3NlU3Ryb2tlIHx8IGZuID09PSBPUFMuY2xvc2VGaWxsU3Ryb2tlIHx8IGZuID09PSBPUFMuY2xvc2VFT0ZpbGxTdHJva2UpIHsKICAgICAgICAgICAgICAgIHBhdGhCdWZmZXIucHVzaChEcmF3T1BTLmNsb3NlUGF0aCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChwYXRoQnVmZmVyLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5jb25zdHJ1Y3RQYXRoLCBbZm4sIFtudWxsXSwgbnVsbF0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoT1BTLmNvbnN0cnVjdFBhdGgsIFtmbiwgW25ldyBGbG9hdDMyQXJyYXkocGF0aEJ1ZmZlcildLCBwYXRoTWluTWF4LnNsaWNlKCldKTsKICAgICAgICAgICAgICAgIHBhdGhCdWZmZXIubGVuZ3RoID0gMDsKICAgICAgICAgICAgICAgIHBhdGhNaW5NYXguc2V0KFtJbmZpbml0eSwgSW5maW5pdHksIC1JbmZpbml0eSwgLUluZmluaXR5XSwgMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIE9QUy5zZXRUZXh0TWF0cml4OgogICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIFtuZXcgRmxvYXQzMkFycmF5KGFyZ3MpXSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgY2FzZSBPUFMubWFya1BvaW50OgogICAgICAgICAgY2FzZSBPUFMubWFya1BvaW50UHJvcHM6CiAgICAgICAgICBjYXNlIE9QUy5iZWdpbkNvbXBhdDoKICAgICAgICAgIGNhc2UgT1BTLmVuZENvbXBhdDoKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICBjYXNlIE9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wczoKICAgICAgICAgICAgaWYgKCEoYXJnc1swXSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgICAgICAgd2FybihgRXhwZWN0ZWQgbmFtZSBmb3IgYmVnaW5NYXJrZWRDb250ZW50UHJvcHMgYXJnMD0ke2FyZ3NbMF19YCk7CiAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKE9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wcywgWyJPQyIsIG51bGxdKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYXJnc1swXS5uYW1lID09PSAiT0MiKSB7CiAgICAgICAgICAgICAgbmV4dChzZWxmLnBhcnNlTWFya2VkQ29udGVudFByb3BzKGFyZ3NbMV0sIHJlc291cmNlcykudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChPUFMuYmVnaW5NYXJrZWRDb250ZW50UHJvcHMsIFsiT0MiLCBkYXRhXSk7CiAgICAgICAgICAgICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBBYm9ydEV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgICAgICAgICAgICB3YXJuKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBiZWdpbk1hcmtlZENvbnRlbnRQcm9wczogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChPUFMuYmVnaW5NYXJrZWRDb250ZW50UHJvcHMsIFsiT0MiLCBudWxsXSk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRocm93IHJlYXNvbjsKICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFyZ3MgPSBbYXJnc1swXS5uYW1lLCBhcmdzWzFdIGluc3RhbmNlb2YgRGljdCA/IGFyZ3NbMV0uZ2V0KCJNQ0lEIikgOiBudWxsXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5iZWdpbk1hcmtlZENvbnRlbnQ6CiAgICAgICAgICBjYXNlIE9QUy5lbmRNYXJrZWRDb250ZW50OgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgaWYgKGFyZ3MgIT09IG51bGwpIHsKICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGFyZ3MubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGFyZ3NbaV0gaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoaSA8IGlpKSB7CiAgICAgICAgICAgICAgICB3YXJuKCJnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBvcGVyYXRvcjogIiArIGZuKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIGFyZ3MpOwogICAgICB9CiAgICAgIGlmIChzdG9wKSB7CiAgICAgICAgbmV4dChkZWZlcnJlZCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNsb3NlUGVuZGluZ1Jlc3RvcmVPUFMoKTsKICAgICAgcmVzb2x2ZSgpOwogICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgd2FybihgZ2V0T3BlcmF0b3JMaXN0IC0gaWdub3JpbmcgZXJyb3JzIGR1cmluZyAiJHt0YXNrLm5hbWV9IiBgICsgYHRhc2s6ICIke3JlYXNvbn0iLmApOwogICAgICAgIGNsb3NlUGVuZGluZ1Jlc3RvcmVPUFMoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhyb3cgcmVhc29uOwogICAgfSk7CiAgfQogIGdldFRleHRDb250ZW50KHsKICAgIHN0cmVhbSwKICAgIHRhc2ssCiAgICByZXNvdXJjZXMsCiAgICBzdGF0ZU1hbmFnZXIgPSBudWxsLAogICAgaW5jbHVkZU1hcmtlZENvbnRlbnQgPSBmYWxzZSwKICAgIHNpbmssCiAgICBzZWVuU3R5bGVzID0gbmV3IFNldCgpLAogICAgdmlld0JveCwKICAgIGxhbmcgPSBudWxsLAogICAgbWFya2VkQ29udGVudERhdGEgPSBudWxsLAogICAgZGlzYWJsZU5vcm1hbGl6YXRpb24gPSBmYWxzZSwKICAgIGtlZXBXaGl0ZVNwYWNlID0gZmFsc2UsCiAgICBwcmV2UmVmcyA9IG51bGwsCiAgICBpbnRlcnNlY3RvciA9IG51bGwKICB9KSB7CiAgICBjb25zdCBvYmpJZCA9IHN0cmVhbS5kaWN0Py5vYmpJZDsKICAgIGNvbnN0IHNlZW5SZWZzID0gbmV3IFJlZlNldChwcmV2UmVmcyk7CiAgICBpZiAob2JqSWQpIHsKICAgICAgaWYgKHByZXZSZWZzPy5oYXMob2JqSWQpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBnZXRUZXh0Q29udGVudCAtIGlnbm9yaW5nIGNpcmN1bGFyIHJlZmVyZW5jZTogJHtvYmpJZH1gKTsKICAgICAgfQogICAgICBzZWVuUmVmcy5wdXQob2JqSWQpOwogICAgfQogICAgcmVzb3VyY2VzIHx8PSBEaWN0LmVtcHR5OwogICAgc3RhdGVNYW5hZ2VyIHx8PSBuZXcgU3RhdGVNYW5hZ2VyKG5ldyBUZXh0U3RhdGUoKSk7CiAgICBpZiAoaW5jbHVkZU1hcmtlZENvbnRlbnQpIHsKICAgICAgbWFya2VkQ29udGVudERhdGEgfHw9IHsKICAgICAgICBsZXZlbDogMAogICAgICB9OwogICAgfQogICAgY29uc3QgdGV4dENvbnRlbnQgPSB7CiAgICAgIGl0ZW1zOiBbXSwKICAgICAgc3R5bGVzOiBPYmplY3QuY3JlYXRlKG51bGwpLAogICAgICBsYW5nCiAgICB9OwogICAgY29uc3QgdGV4dENvbnRlbnRJdGVtID0gewogICAgICBpbml0aWFsaXplZDogZmFsc2UsCiAgICAgIHN0cjogW10sCiAgICAgIHRvdGFsV2lkdGg6IDAsCiAgICAgIHRvdGFsSGVpZ2h0OiAwLAogICAgICB3aWR0aDogMCwKICAgICAgaGVpZ2h0OiAwLAogICAgICB2ZXJ0aWNhbDogZmFsc2UsCiAgICAgIHByZXZUcmFuc2Zvcm06IG51bGwsCiAgICAgIHRleHRBZHZhbmNlU2NhbGU6IDAsCiAgICAgIHNwYWNlSW5GbG93TWluOiAwLAogICAgICBzcGFjZUluRmxvd01heDogMCwKICAgICAgdHJhY2tpbmdTcGFjZU1pbjogSW5maW5pdHksCiAgICAgIG5lZ2F0aXZlU3BhY2VNYXg6IC1JbmZpbml0eSwKICAgICAgbm90QVNwYWNlOiAtSW5maW5pdHksCiAgICAgIHRyYW5zZm9ybTogbnVsbCwKICAgICAgZm9udE5hbWU6IG51bGwsCiAgICAgIGhhc0VPTDogZmFsc2UKICAgIH07CiAgICBjb25zdCB0d29MYXN0Q2hhcnMgPSBbIiAiLCAiICJdOwogICAgbGV0IHR3b0xhc3RDaGFyc1BvcyA9IDA7CiAgICBmdW5jdGlvbiBzYXZlTGFzdENoYXIoY2hhcikgewogICAgICBjb25zdCBuZXh0UG9zID0gKHR3b0xhc3RDaGFyc1BvcyArIDEpICUgMjsKICAgICAgY29uc3QgcmV0ID0gdHdvTGFzdENoYXJzW3R3b0xhc3RDaGFyc1Bvc10gIT09ICIgIiAmJiB0d29MYXN0Q2hhcnNbbmV4dFBvc10gPT09ICIgIjsKICAgICAgdHdvTGFzdENoYXJzW3R3b0xhc3RDaGFyc1Bvc10gPSBjaGFyOwogICAgICB0d29MYXN0Q2hhcnNQb3MgPSBuZXh0UG9zOwogICAgICByZXR1cm4gIWtlZXBXaGl0ZVNwYWNlICYmIHJldDsKICAgIH0KICAgIGZ1bmN0aW9uIHNob3VsZEFkZFdoaXRlcHNhY2UoKSB7CiAgICAgIHJldHVybiAha2VlcFdoaXRlU3BhY2UgJiYgdHdvTGFzdENoYXJzW3R3b0xhc3RDaGFyc1Bvc10gIT09ICIgIiAmJiB0d29MYXN0Q2hhcnNbKHR3b0xhc3RDaGFyc1BvcyArIDEpICUgMl0gPT09ICIgIjsKICAgIH0KICAgIGZ1bmN0aW9uIHJlc2V0TGFzdENoYXJzKCkgewogICAgICB0d29MYXN0Q2hhcnNbMF0gPSB0d29MYXN0Q2hhcnNbMV0gPSAiICI7CiAgICAgIHR3b0xhc3RDaGFyc1BvcyA9IDA7CiAgICB9CiAgICBjb25zdCBUUkFDS0lOR19TUEFDRV9GQUNUT1IgPSAwLjEwMjsKICAgIGNvbnN0IE5PVF9BX1NQQUNFX0ZBQ1RPUiA9IDAuMDM7CiAgICBjb25zdCBORUdBVElWRV9TUEFDRV9GQUNUT1IgPSAtMC4yOwogICAgY29uc3QgU1BBQ0VfSU5fRkxPV19NSU5fRkFDVE9SID0gMC4xMDI7CiAgICBjb25zdCBTUEFDRV9JTl9GTE9XX01BWF9GQUNUT1IgPSAwLjY7CiAgICBjb25zdCBWRVJUSUNBTF9TSElGVF9SQVRJTyA9IDAuMjU7CiAgICBjb25zdCBzZWxmID0gdGhpczsKICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWY7CiAgICBjb25zdCBzaG93U3BhY2VkVGV4dEJ1ZmZlciA9IFtdOwogICAgbGV0IHhvYmpzID0gbnVsbDsKICAgIGNvbnN0IGVtcHR5WE9iamVjdENhY2hlID0gbmV3IExvY2FsSW1hZ2VDYWNoZSgpOwogICAgY29uc3QgZW1wdHlHU3RhdGVDYWNoZSA9IG5ldyBMb2NhbEdTdGF0ZUNhY2hlKCk7CiAgICBjb25zdCBwcmVwcm9jZXNzb3IgPSBuZXcgRXZhbHVhdG9yUHJlcHJvY2Vzc29yKHN0cmVhbSwgeHJlZiwgc3RhdGVNYW5hZ2VyKTsKICAgIGxldCB0ZXh0U3RhdGU7CiAgICBmdW5jdGlvbiBwdXNoV2hpdGVzcGFjZSh7CiAgICAgIHdpZHRoID0gMCwKICAgICAgaGVpZ2h0ID0gMCwKICAgICAgdHJhbnNmb3JtID0gdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm0sCiAgICAgIGZvbnROYW1lID0gdGV4dENvbnRlbnRJdGVtLmZvbnROYW1lCiAgICB9KSB7CiAgICAgIGludGVyc2VjdG9yPy5hZGRFeHRyYUNoYXIoIiAiKTsKICAgICAgdGV4dENvbnRlbnQuaXRlbXMucHVzaCh7CiAgICAgICAgc3RyOiAiICIsCiAgICAgICAgZGlyOiAibHRyIiwKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgdHJhbnNmb3JtLAogICAgICAgIGZvbnROYW1lLAogICAgICAgIGhhc0VPTDogZmFsc2UKICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRDdXJyZW50VGV4dFRyYW5zZm9ybSgpIHsKICAgICAgY29uc3QgZm9udCA9IHRleHRTdGF0ZS5mb250OwogICAgICBjb25zdCB0c20gPSBbdGV4dFN0YXRlLmZvbnRTaXplICogdGV4dFN0YXRlLnRleHRIU2NhbGUsIDAsIDAsIHRleHRTdGF0ZS5mb250U2l6ZSwgMCwgdGV4dFN0YXRlLnRleHRSaXNlXTsKICAgICAgaWYgKGZvbnQuaXNUeXBlM0ZvbnQgJiYgKHRleHRTdGF0ZS5mb250U2l6ZSA8PSAxIHx8IGZvbnQuaXNDaGFyQkJveCkgJiYgIWlzQXJyYXlFcXVhbCh0ZXh0U3RhdGUuZm9udE1hdHJpeCwgRk9OVF9JREVOVElUWV9NQVRSSVgpKSB7CiAgICAgICAgY29uc3QgZ2x5cGhIZWlnaHQgPSBmb250LmJib3hbM10gLSBmb250LmJib3hbMV07CiAgICAgICAgaWYgKGdseXBoSGVpZ2h0ID4gMCkgewogICAgICAgICAgdHNtWzNdICo9IGdseXBoSGVpZ2h0ICogdGV4dFN0YXRlLmZvbnRNYXRyaXhbM107CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBVdGlsLnRyYW5zZm9ybSh0ZXh0U3RhdGUuY3RtLCBVdGlsLnRyYW5zZm9ybSh0ZXh0U3RhdGUudGV4dE1hdHJpeCwgdHNtKSk7CiAgICB9CiAgICBmdW5jdGlvbiBlbnN1cmVUZXh0Q29udGVudEl0ZW0oKSB7CiAgICAgIGlmICh0ZXh0Q29udGVudEl0ZW0uaW5pdGlhbGl6ZWQpIHsKICAgICAgICByZXR1cm4gdGV4dENvbnRlbnRJdGVtOwogICAgICB9CiAgICAgIGNvbnN0IHsKICAgICAgICBmb250LAogICAgICAgIGxvYWRlZE5hbWUKICAgICAgfSA9IHRleHRTdGF0ZTsKICAgICAgaWYgKCFzZWVuU3R5bGVzLmhhcyhsb2FkZWROYW1lKSkgewogICAgICAgIHNlZW5TdHlsZXMuYWRkKGxvYWRlZE5hbWUpOwogICAgICAgIHRleHRDb250ZW50LnN0eWxlc1tsb2FkZWROYW1lXSA9IHsKICAgICAgICAgIGZvbnRGYW1pbHk6IGZvbnQuZmFsbGJhY2tOYW1lLAogICAgICAgICAgYXNjZW50OiBmb250LmFzY2VudCwKICAgICAgICAgIGRlc2NlbnQ6IGZvbnQuZGVzY2VudCwKICAgICAgICAgIHZlcnRpY2FsOiBmb250LnZlcnRpY2FsCiAgICAgICAgfTsKICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmZvbnRFeHRyYVByb3BlcnRpZXMgJiYgZm9udC5zeXN0ZW1Gb250SW5mbykgewogICAgICAgICAgY29uc3Qgc3R5bGUgPSB0ZXh0Q29udGVudC5zdHlsZXNbbG9hZGVkTmFtZV07CiAgICAgICAgICBzdHlsZS5mb250U3Vic3RpdHV0aW9uID0gZm9udC5zeXN0ZW1Gb250SW5mby5jc3M7CiAgICAgICAgICBzdHlsZS5mb250U3Vic3RpdHV0aW9uTG9hZGVkTmFtZSA9IGZvbnQuc3lzdGVtRm9udEluZm8ubG9hZGVkTmFtZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGV4dENvbnRlbnRJdGVtLmZvbnROYW1lID0gbG9hZGVkTmFtZTsKICAgICAgY29uc3QgdHJtID0gdGV4dENvbnRlbnRJdGVtLnRyYW5zZm9ybSA9IGdldEN1cnJlbnRUZXh0VHJhbnNmb3JtKCk7CiAgICAgIGlmICghZm9udC52ZXJ0aWNhbCkgewogICAgICAgIHRleHRDb250ZW50SXRlbS53aWR0aCA9IHRleHRDb250ZW50SXRlbS50b3RhbFdpZHRoID0gMDsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ID0gdGV4dENvbnRlbnRJdGVtLnRvdGFsSGVpZ2h0ID0gTWF0aC5oeXBvdCh0cm1bMl0sIHRybVszXSk7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLnZlcnRpY2FsID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLndpZHRoID0gdGV4dENvbnRlbnRJdGVtLnRvdGFsV2lkdGggPSBNYXRoLmh5cG90KHRybVswXSwgdHJtWzFdKTsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ID0gdGV4dENvbnRlbnRJdGVtLnRvdGFsSGVpZ2h0ID0gMDsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0udmVydGljYWwgPSB0cnVlOwogICAgICB9CiAgICAgIGNvbnN0IHNjYWxlTGluZVggPSBNYXRoLmh5cG90KHRleHRTdGF0ZS50ZXh0TGluZU1hdHJpeFswXSwgdGV4dFN0YXRlLnRleHRMaW5lTWF0cml4WzFdKTsKICAgICAgY29uc3Qgc2NhbGVDdG1YID0gTWF0aC5oeXBvdCh0ZXh0U3RhdGUuY3RtWzBdLCB0ZXh0U3RhdGUuY3RtWzFdKTsKICAgICAgdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGUgPSBzY2FsZUN0bVggKiBzY2FsZUxpbmVYOwogICAgICBjb25zdCB7CiAgICAgICAgZm9udFNpemUKICAgICAgfSA9IHRleHRTdGF0ZTsKICAgICAgdGV4dENvbnRlbnRJdGVtLnRyYWNraW5nU3BhY2VNaW4gPSBmb250U2l6ZSAqIFRSQUNLSU5HX1NQQUNFX0ZBQ1RPUjsKICAgICAgdGV4dENvbnRlbnRJdGVtLm5vdEFTcGFjZSA9IGZvbnRTaXplICogTk9UX0FfU1BBQ0VfRkFDVE9SOwogICAgICB0ZXh0Q29udGVudEl0ZW0ubmVnYXRpdmVTcGFjZU1heCA9IGZvbnRTaXplICogTkVHQVRJVkVfU1BBQ0VfRkFDVE9SOwogICAgICB0ZXh0Q29udGVudEl0ZW0uc3BhY2VJbkZsb3dNaW4gPSBmb250U2l6ZSAqIFNQQUNFX0lOX0ZMT1dfTUlOX0ZBQ1RPUjsKICAgICAgdGV4dENvbnRlbnRJdGVtLnNwYWNlSW5GbG93TWF4ID0gZm9udFNpemUgKiBTUEFDRV9JTl9GTE9XX01BWF9GQUNUT1I7CiAgICAgIHRleHRDb250ZW50SXRlbS5oYXNFT0wgPSBmYWxzZTsKICAgICAgdGV4dENvbnRlbnRJdGVtLmluaXRpYWxpemVkID0gdHJ1ZTsKICAgICAgcmV0dXJuIHRleHRDb250ZW50SXRlbTsKICAgIH0KICAgIGZ1bmN0aW9uIHVwZGF0ZUFkdmFuY2VTY2FsZSgpIHsKICAgICAgaWYgKCF0ZXh0Q29udGVudEl0ZW0uaW5pdGlhbGl6ZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3Qgc2NhbGVMaW5lWCA9IE1hdGguaHlwb3QodGV4dFN0YXRlLnRleHRMaW5lTWF0cml4WzBdLCB0ZXh0U3RhdGUudGV4dExpbmVNYXRyaXhbMV0pOwogICAgICBjb25zdCBzY2FsZUN0bVggPSBNYXRoLmh5cG90KHRleHRTdGF0ZS5jdG1bMF0sIHRleHRTdGF0ZS5jdG1bMV0pOwogICAgICBjb25zdCBzY2FsZUZhY3RvciA9IHNjYWxlQ3RtWCAqIHNjYWxlTGluZVg7CiAgICAgIGlmIChzY2FsZUZhY3RvciA9PT0gdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCF0ZXh0Q29udGVudEl0ZW0udmVydGljYWwpIHsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0udG90YWxXaWR0aCArPSB0ZXh0Q29udGVudEl0ZW0ud2lkdGggKiB0ZXh0Q29udGVudEl0ZW0udGV4dEFkdmFuY2VTY2FsZTsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0ud2lkdGggPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIHRleHRDb250ZW50SXRlbS50b3RhbEhlaWdodCArPSB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ICogdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGU7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLmhlaWdodCA9IDA7CiAgICAgIH0KICAgICAgdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGUgPSBzY2FsZUZhY3RvcjsKICAgIH0KICAgIGZ1bmN0aW9uIHJ1bkJpZGlUcmFuc2Zvcm0odGV4dENodW5rKSB7CiAgICAgIGxldCB0ZXh0ID0gdGV4dENodW5rLnN0ci5qb2luKCIiKTsKICAgICAgaWYgKCFkaXNhYmxlTm9ybWFsaXphdGlvbikgewogICAgICAgIHRleHQgPSBub3JtYWxpemVVbmljb2RlKHRleHQpOwogICAgICB9CiAgICAgIGNvbnN0IGJpZGlSZXN1bHQgPSBiaWRpKHRleHQsIC0xLCB0ZXh0Q2h1bmsudmVydGljYWwpOwogICAgICByZXR1cm4gewogICAgICAgIHN0cjogYmlkaVJlc3VsdC5zdHIsCiAgICAgICAgZGlyOiBiaWRpUmVzdWx0LmRpciwKICAgICAgICB3aWR0aDogTWF0aC5hYnModGV4dENodW5rLnRvdGFsV2lkdGgpLAogICAgICAgIGhlaWdodDogTWF0aC5hYnModGV4dENodW5rLnRvdGFsSGVpZ2h0KSwKICAgICAgICB0cmFuc2Zvcm06IHRleHRDaHVuay50cmFuc2Zvcm0sCiAgICAgICAgZm9udE5hbWU6IHRleHRDaHVuay5mb250TmFtZSwKICAgICAgICBoYXNFT0w6IHRleHRDaHVuay5oYXNFT0wKICAgICAgfTsKICAgIH0KICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVNldEZvbnQoZm9udE5hbWUsIGZvbnRSZWYpIHsKICAgICAgY29uc3QgdHJhbnNsYXRlZCA9IGF3YWl0IHNlbGYubG9hZEZvbnQoZm9udE5hbWUsIGZvbnRSZWYsIHJlc291cmNlcywgdGFzayk7CiAgICAgIHRleHRTdGF0ZS5sb2FkZWROYW1lID0gdHJhbnNsYXRlZC5sb2FkZWROYW1lOwogICAgICB0ZXh0U3RhdGUuZm9udCA9IHRyYW5zbGF0ZWQuZm9udDsKICAgICAgdGV4dFN0YXRlLmZvbnRNYXRyaXggPSB0cmFuc2xhdGVkLmZvbnQuZm9udE1hdHJpeCB8fCBGT05UX0lERU5USVRZX01BVFJJWDsKICAgIH0KICAgIGZ1bmN0aW9uIGFwcGx5SW52ZXJzZVJvdGF0aW9uKHgsIHksIG1hdHJpeCkgewogICAgICBjb25zdCBzY2FsZSA9IE1hdGguaHlwb3QobWF0cml4WzBdLCBtYXRyaXhbMV0pOwogICAgICByZXR1cm4gWyhtYXRyaXhbMF0gKiB4ICsgbWF0cml4WzFdICogeSkgLyBzY2FsZSwgKG1hdHJpeFsyXSAqIHggKyBtYXRyaXhbM10gKiB5KSAvIHNjYWxlXTsKICAgIH0KICAgIGZ1bmN0aW9uIGNvbXBhcmVXaXRoTGFzdFBvc2l0aW9uKGdseXBoV2lkdGgpIHsKICAgICAgY29uc3QgY3VycmVudFRyYW5zZm9ybSA9IGdldEN1cnJlbnRUZXh0VHJhbnNmb3JtKCk7CiAgICAgIGxldCBwb3NYID0gY3VycmVudFRyYW5zZm9ybVs0XTsKICAgICAgbGV0IHBvc1kgPSBjdXJyZW50VHJhbnNmb3JtWzVdOwogICAgICBpZiAodGV4dFN0YXRlLmZvbnQ/LnZlcnRpY2FsKSB7CiAgICAgICAgaWYgKHBvc1ggPCB2aWV3Qm94WzBdIHx8IHBvc1ggPiB2aWV3Qm94WzJdIHx8IHBvc1kgKyBnbHlwaFdpZHRoIDwgdmlld0JveFsxXSB8fCBwb3NZID4gdmlld0JveFszXSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwb3NYICsgZ2x5cGhXaWR0aCA8IHZpZXdCb3hbMF0gfHwgcG9zWCA+IHZpZXdCb3hbMl0gfHwgcG9zWSA8IHZpZXdCb3hbMV0gfHwgcG9zWSA+IHZpZXdCb3hbM10pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCF0ZXh0U3RhdGUuZm9udCB8fCAhdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm0pIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBsZXQgbGFzdFBvc1ggPSB0ZXh0Q29udGVudEl0ZW0ucHJldlRyYW5zZm9ybVs0XTsKICAgICAgbGV0IGxhc3RQb3NZID0gdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm1bNV07CiAgICAgIGlmIChsYXN0UG9zWCA9PT0gcG9zWCAmJiBsYXN0UG9zWSA9PT0gcG9zWSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGxldCByb3RhdGUgPSAtMTsKICAgICAgaWYgKGN1cnJlbnRUcmFuc2Zvcm1bMF0gJiYgY3VycmVudFRyYW5zZm9ybVsxXSA9PT0gMCAmJiBjdXJyZW50VHJhbnNmb3JtWzJdID09PSAwKSB7CiAgICAgICAgcm90YXRlID0gY3VycmVudFRyYW5zZm9ybVswXSA+IDAgPyAwIDogMTgwOwogICAgICB9IGVsc2UgaWYgKGN1cnJlbnRUcmFuc2Zvcm1bMV0gJiYgY3VycmVudFRyYW5zZm9ybVswXSA9PT0gMCAmJiBjdXJyZW50VHJhbnNmb3JtWzNdID09PSAwKSB7CiAgICAgICAgcm90YXRlID0gY3VycmVudFRyYW5zZm9ybVsxXSA+IDAgPyA5MCA6IDI3MDsKICAgICAgfQogICAgICBzd2l0Y2ggKHJvdGF0ZSkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgOTA6CiAgICAgICAgICBbcG9zWCwgcG9zWV0gPSBbcG9zWSwgcG9zWF07CiAgICAgICAgICBbbGFzdFBvc1gsIGxhc3RQb3NZXSA9IFtsYXN0UG9zWSwgbGFzdFBvc1hdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxODA6CiAgICAgICAgICBbcG9zWCwgcG9zWSwgbGFzdFBvc1gsIGxhc3RQb3NZXSA9IFstcG9zWCwgLXBvc1ksIC1sYXN0UG9zWCwgLWxhc3RQb3NZXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjcwOgogICAgICAgICAgW3Bvc1gsIHBvc1ldID0gWy1wb3NZLCAtcG9zWF07CiAgICAgICAgICBbbGFzdFBvc1gsIGxhc3RQb3NZXSA9IFstbGFzdFBvc1ksIC1sYXN0UG9zWF07CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgW3Bvc1gsIHBvc1ldID0gYXBwbHlJbnZlcnNlUm90YXRpb24ocG9zWCwgcG9zWSwgY3VycmVudFRyYW5zZm9ybSk7CiAgICAgICAgICBbbGFzdFBvc1gsIGxhc3RQb3NZXSA9IGFwcGx5SW52ZXJzZVJvdGF0aW9uKGxhc3RQb3NYLCBsYXN0UG9zWSwgdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm0pOwogICAgICB9CiAgICAgIGlmICh0ZXh0U3RhdGUuZm9udC52ZXJ0aWNhbCkgewogICAgICAgIGNvbnN0IGFkdmFuY2VZID0gKGxhc3RQb3NZIC0gcG9zWSkgLyB0ZXh0Q29udGVudEl0ZW0udGV4dEFkdmFuY2VTY2FsZTsKICAgICAgICBjb25zdCBhZHZhbmNlWCA9IHBvc1ggLSBsYXN0UG9zWDsKICAgICAgICBjb25zdCB0ZXh0T3JpZW50YXRpb24gPSBNYXRoLnNpZ24odGV4dENvbnRlbnRJdGVtLmhlaWdodCk7CiAgICAgICAgaWYgKGFkdmFuY2VZIDwgdGV4dE9yaWVudGF0aW9uICogdGV4dENvbnRlbnRJdGVtLm5lZ2F0aXZlU3BhY2VNYXgpIHsKICAgICAgICAgIGlmIChNYXRoLmFicyhhZHZhbmNlWCkgPiAwLjUgKiB0ZXh0Q29udGVudEl0ZW0ud2lkdGgpIHsKICAgICAgICAgICAgYXBwZW5kRU9MKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKE1hdGguYWJzKGFkdmFuY2VYKSA+IHRleHRDb250ZW50SXRlbS53aWR0aCkgewogICAgICAgICAgYXBwZW5kRU9MKCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGFkdmFuY2VZIDw9IHRleHRPcmllbnRhdGlvbiAqIHRleHRDb250ZW50SXRlbS5ub3RBU3BhY2UpIHsKICAgICAgICAgIHJlc2V0TGFzdENoYXJzKCk7CiAgICAgICAgfQogICAgICAgIGlmIChhZHZhbmNlWSA8PSB0ZXh0T3JpZW50YXRpb24gKiB0ZXh0Q29udGVudEl0ZW0udHJhY2tpbmdTcGFjZU1pbikgewogICAgICAgICAgaWYgKHNob3VsZEFkZFdoaXRlcHNhY2UoKSkgewogICAgICAgICAgICByZXNldExhc3RDaGFycygpOwogICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICBwdXNoV2hpdGVzcGFjZSh7CiAgICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLmFicyhhZHZhbmNlWSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ICs9IGFkdmFuY2VZOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoIWFkZEZha2VTcGFjZXMoYWR2YW5jZVksIHRleHRDb250ZW50SXRlbS5wcmV2VHJhbnNmb3JtLCB0ZXh0T3JpZW50YXRpb24pKSB7CiAgICAgICAgICBpZiAodGV4dENvbnRlbnRJdGVtLnN0ci5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgICAgICAgcHVzaFdoaXRlc3BhY2UoewogICAgICAgICAgICAgIGhlaWdodDogTWF0aC5hYnMoYWR2YW5jZVkpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGV4dENvbnRlbnRJdGVtLmhlaWdodCArPSBhZHZhbmNlWTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKE1hdGguYWJzKGFkdmFuY2VYKSA+IHRleHRDb250ZW50SXRlbS53aWR0aCAqIFZFUlRJQ0FMX1NISUZUX1JBVElPKSB7CiAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBjb25zdCBhZHZhbmNlWCA9IChwb3NYIC0gbGFzdFBvc1gpIC8gdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGU7CiAgICAgIGNvbnN0IGFkdmFuY2VZID0gcG9zWSAtIGxhc3RQb3NZOwogICAgICBjb25zdCB0ZXh0T3JpZW50YXRpb24gPSBNYXRoLnNpZ24odGV4dENvbnRlbnRJdGVtLndpZHRoKTsKICAgICAgaWYgKGFkdmFuY2VYIDwgdGV4dE9yaWVudGF0aW9uICogdGV4dENvbnRlbnRJdGVtLm5lZ2F0aXZlU3BhY2VNYXgpIHsKICAgICAgICBpZiAoTWF0aC5hYnMoYWR2YW5jZVkpID4gMC41ICogdGV4dENvbnRlbnRJdGVtLmhlaWdodCkgewogICAgICAgICAgYXBwZW5kRU9MKCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGlmIChNYXRoLmFicyhhZHZhbmNlWSkgPiB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0KSB7CiAgICAgICAgYXBwZW5kRU9MKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKGFkdmFuY2VYIDw9IHRleHRPcmllbnRhdGlvbiAqIHRleHRDb250ZW50SXRlbS5ub3RBU3BhY2UpIHsKICAgICAgICByZXNldExhc3RDaGFycygpOwogICAgICB9CiAgICAgIGlmIChhZHZhbmNlWCA8PSB0ZXh0T3JpZW50YXRpb24gKiB0ZXh0Q29udGVudEl0ZW0udHJhY2tpbmdTcGFjZU1pbikgewogICAgICAgIGlmIChzaG91bGRBZGRXaGl0ZXBzYWNlKCkpIHsKICAgICAgICAgIHJlc2V0TGFzdENoYXJzKCk7CiAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgcHVzaFdoaXRlc3BhY2UoewogICAgICAgICAgICB3aWR0aDogTWF0aC5hYnMoYWR2YW5jZVgpCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGV4dENvbnRlbnRJdGVtLndpZHRoICs9IGFkdmFuY2VYOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghYWRkRmFrZVNwYWNlcyhhZHZhbmNlWCwgdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm0sIHRleHRPcmllbnRhdGlvbikpIHsKICAgICAgICBpZiAodGV4dENvbnRlbnRJdGVtLnN0ci5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHJlc2V0TGFzdENoYXJzKCk7CiAgICAgICAgICBwdXNoV2hpdGVzcGFjZSh7CiAgICAgICAgICAgIHdpZHRoOiBNYXRoLmFicyhhZHZhbmNlWCkKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0ZXh0Q29udGVudEl0ZW0ud2lkdGggKz0gYWR2YW5jZVg7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChNYXRoLmFicyhhZHZhbmNlWSkgPiB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ICogVkVSVElDQUxfU0hJRlRfUkFUSU8pIHsKICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gYnVpbGRUZXh0Q29udGVudEl0ZW0oewogICAgICBjaGFycywKICAgICAgZXh0cmFTcGFjaW5nCiAgICB9KSB7CiAgICAgIGNvbnN0IGZvbnQgPSB0ZXh0U3RhdGUuZm9udDsKICAgICAgaWYgKCFjaGFycykgewogICAgICAgIGNvbnN0IGNoYXJTcGFjaW5nID0gdGV4dFN0YXRlLmNoYXJTcGFjaW5nICsgZXh0cmFTcGFjaW5nOwogICAgICAgIGlmIChjaGFyU3BhY2luZykgewogICAgICAgICAgaWYgKCFmb250LnZlcnRpY2FsKSB7CiAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TWF0cml4KGNoYXJTcGFjaW5nICogdGV4dFN0YXRlLnRleHRIU2NhbGUsIDApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRNYXRyaXgoMCwgLWNoYXJTcGFjaW5nKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGtlZXBXaGl0ZVNwYWNlKSB7CiAgICAgICAgICBjb21wYXJlV2l0aExhc3RQb3NpdGlvbigwKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IGdseXBocyA9IGZvbnQuY2hhcnNUb0dseXBocyhjaGFycyk7CiAgICAgIGNvbnN0IHNjYWxlID0gdGV4dFN0YXRlLmZvbnRNYXRyaXhbMF0gKiB0ZXh0U3RhdGUuZm9udFNpemU7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGdseXBocy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgZ2x5cGggPSBnbHlwaHNbaV07CiAgICAgICAgY29uc3QgewogICAgICAgICAgY2F0ZWdvcnkKICAgICAgICB9ID0gZ2x5cGg7CiAgICAgICAgaWYgKGNhdGVnb3J5LmlzSW52aXNpYmxlRm9ybWF0TWFyaykgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGxldCBjaGFyU3BhY2luZyA9IHRleHRTdGF0ZS5jaGFyU3BhY2luZyArIChpICsgMSA9PT0gaWkgPyBleHRyYVNwYWNpbmcgOiAwKTsKICAgICAgICBsZXQgZ2x5cGhXaWR0aCA9IGdseXBoLndpZHRoOwogICAgICAgIGlmIChmb250LnZlcnRpY2FsKSB7CiAgICAgICAgICBnbHlwaFdpZHRoID0gZ2x5cGgudm1ldHJpYyA/IGdseXBoLnZtZXRyaWNbMF0gOiAtZ2x5cGhXaWR0aDsKICAgICAgICB9CiAgICAgICAgbGV0IHNjYWxlZERpbSA9IGdseXBoV2lkdGggKiBzY2FsZTsKICAgICAgICBpZiAoIWtlZXBXaGl0ZVNwYWNlICYmIGNhdGVnb3J5LmlzV2hpdGVzcGFjZSkgewogICAgICAgICAgaWYgKCFmb250LnZlcnRpY2FsKSB7CiAgICAgICAgICAgIGNoYXJTcGFjaW5nICs9IHNjYWxlZERpbSArIHRleHRTdGF0ZS53b3JkU3BhY2luZzsKICAgICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRNYXRyaXgoY2hhclNwYWNpbmcgKiB0ZXh0U3RhdGUudGV4dEhTY2FsZSwgMCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjaGFyU3BhY2luZyArPSAtc2NhbGVkRGltICsgdGV4dFN0YXRlLndvcmRTcGFjaW5nOwogICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dE1hdHJpeCgwLCAtY2hhclNwYWNpbmcpOwogICAgICAgICAgfQogICAgICAgICAgc2F2ZUxhc3RDaGFyKCIgIik7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFjYXRlZ29yeS5pc1plcm9XaWR0aERpYWNyaXRpYyAmJiAhY29tcGFyZVdpdGhMYXN0UG9zaXRpb24oc2NhbGVkRGltKSkgewogICAgICAgICAgaWYgKCFmb250LnZlcnRpY2FsKSB7CiAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TWF0cml4KHNjYWxlZERpbSAqIHRleHRTdGF0ZS50ZXh0SFNjYWxlLCAwKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TWF0cml4KDAsIHNjYWxlZERpbSk7CiAgICAgICAgICB9CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgdGV4dENodW5rID0gZW5zdXJlVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgaWYgKGNhdGVnb3J5LmlzWmVyb1dpZHRoRGlhY3JpdGljKSB7CiAgICAgICAgICBzY2FsZWREaW0gPSAwOwogICAgICAgIH0KICAgICAgICBpZiAoIWZvbnQudmVydGljYWwpIHsKICAgICAgICAgIHNjYWxlZERpbSAqPSB0ZXh0U3RhdGUudGV4dEhTY2FsZTsKICAgICAgICAgIGludGVyc2VjdG9yPy5hZGRHbHlwaChnZXRDdXJyZW50VGV4dFRyYW5zZm9ybSgpLCBzY2FsZWREaW0sIDAsIGdseXBoLnVuaWNvZGUpOwogICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRNYXRyaXgoc2NhbGVkRGltLCAwKTsKICAgICAgICAgIHRleHRDaHVuay53aWR0aCArPSBzY2FsZWREaW07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGludGVyc2VjdG9yPy5hZGRHbHlwaChnZXRDdXJyZW50VGV4dFRyYW5zZm9ybSgpLCAwLCBzY2FsZWREaW0sIGdseXBoLnVuaWNvZGUpOwogICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRNYXRyaXgoMCwgc2NhbGVkRGltKTsKICAgICAgICAgIHNjYWxlZERpbSA9IE1hdGguYWJzKHNjYWxlZERpbSk7CiAgICAgICAgICB0ZXh0Q2h1bmsuaGVpZ2h0ICs9IHNjYWxlZERpbTsKICAgICAgICB9CiAgICAgICAgaWYgKHNjYWxlZERpbSkgewogICAgICAgICAgdGV4dENodW5rLnByZXZUcmFuc2Zvcm0gPSBnZXRDdXJyZW50VGV4dFRyYW5zZm9ybSgpOwogICAgICAgIH0KICAgICAgICBjb25zdCBnbHlwaFVuaWNvZGUgPSBnbHlwaC51bmljb2RlOwogICAgICAgIGlmIChzYXZlTGFzdENoYXIoZ2x5cGhVbmljb2RlKSkgewogICAgICAgICAgdGV4dENodW5rLnN0ci5wdXNoKCIgIik7CiAgICAgICAgICBpbnRlcnNlY3Rvcj8uYWRkRXh0cmFDaGFyKCIgIik7CiAgICAgICAgfQogICAgICAgIGlmICghaW50ZXJzZWN0b3IpIHsKICAgICAgICAgIHRleHRDaHVuay5zdHIucHVzaChnbHlwaFVuaWNvZGUpOwogICAgICAgIH0KICAgICAgICBpZiAoY2hhclNwYWNpbmcpIHsKICAgICAgICAgIGlmICghZm9udC52ZXJ0aWNhbCkgewogICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dE1hdHJpeChjaGFyU3BhY2luZyAqIHRleHRTdGF0ZS50ZXh0SFNjYWxlLCAwKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TWF0cml4KDAsIC1jaGFyU3BhY2luZyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBhcHBlbmRFT0woKSB7CiAgICAgIGludGVyc2VjdG9yPy5hZGRFeHRyYUNoYXIoIlxuIik7CiAgICAgIHJlc2V0TGFzdENoYXJzKCk7CiAgICAgIGlmICh0ZXh0Q29udGVudEl0ZW0uaW5pdGlhbGl6ZWQpIHsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0uaGFzRU9MID0gdHJ1ZTsKICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICB9IGVsc2UgewogICAgICAgIHRleHRDb250ZW50Lml0ZW1zLnB1c2goewogICAgICAgICAgc3RyOiAiIiwKICAgICAgICAgIGRpcjogImx0ciIsCiAgICAgICAgICB3aWR0aDogMCwKICAgICAgICAgIGhlaWdodDogMCwKICAgICAgICAgIHRyYW5zZm9ybTogZ2V0Q3VycmVudFRleHRUcmFuc2Zvcm0oKSwKICAgICAgICAgIGZvbnROYW1lOiB0ZXh0U3RhdGUubG9hZGVkTmFtZSwKICAgICAgICAgIGhhc0VPTDogdHJ1ZQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBhZGRGYWtlU3BhY2VzKHdpZHRoLCB0cmFuc2YsIHRleHRPcmllbnRhdGlvbikgewogICAgICBpZiAodGV4dE9yaWVudGF0aW9uICogdGV4dENvbnRlbnRJdGVtLnNwYWNlSW5GbG93TWluIDw9IHdpZHRoICYmIHdpZHRoIDw9IHRleHRPcmllbnRhdGlvbiAqIHRleHRDb250ZW50SXRlbS5zcGFjZUluRmxvd01heCkgewogICAgICAgIGlmICh0ZXh0Q29udGVudEl0ZW0uaW5pdGlhbGl6ZWQpIHsKICAgICAgICAgIHJlc2V0TGFzdENoYXJzKCk7CiAgICAgICAgICB0ZXh0Q29udGVudEl0ZW0uc3RyLnB1c2goIiAiKTsKICAgICAgICAgIGludGVyc2VjdG9yPy5hZGRFeHRyYUNoYXIoIiAiKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGNvbnN0IGZvbnROYW1lID0gdGV4dENvbnRlbnRJdGVtLmZvbnROYW1lOwogICAgICBsZXQgaGVpZ2h0ID0gMDsKICAgICAgaWYgKHRleHRDb250ZW50SXRlbS52ZXJ0aWNhbCkgewogICAgICAgIGhlaWdodCA9IHdpZHRoOwogICAgICAgIHdpZHRoID0gMDsKICAgICAgfQogICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICByZXNldExhc3RDaGFycygpOwogICAgICBwdXNoV2hpdGVzcGFjZSh7CiAgICAgICAgd2lkdGg6IE1hdGguYWJzKHdpZHRoKSwKICAgICAgICBoZWlnaHQ6IE1hdGguYWJzKGhlaWdodCksCiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2YgfHwgZ2V0Q3VycmVudFRleHRUcmFuc2Zvcm0oKSwKICAgICAgICBmb250TmFtZQogICAgICB9KTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBmdW5jdGlvbiBmbHVzaFRleHRDb250ZW50SXRlbSgpIHsKICAgICAgaWYgKCF0ZXh0Q29udGVudEl0ZW0uaW5pdGlhbGl6ZWQgfHwgIXRleHRDb250ZW50SXRlbS5zdHIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCF0ZXh0Q29udGVudEl0ZW0udmVydGljYWwpIHsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0udG90YWxXaWR0aCArPSB0ZXh0Q29udGVudEl0ZW0ud2lkdGggKiB0ZXh0Q29udGVudEl0ZW0udGV4dEFkdmFuY2VTY2FsZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0udG90YWxIZWlnaHQgKz0gdGV4dENvbnRlbnRJdGVtLmhlaWdodCAqIHRleHRDb250ZW50SXRlbS50ZXh0QWR2YW5jZVNjYWxlOwogICAgICB9CiAgICAgIHRleHRDb250ZW50Lml0ZW1zLnB1c2gocnVuQmlkaVRyYW5zZm9ybSh0ZXh0Q29udGVudEl0ZW0pKTsKICAgICAgdGV4dENvbnRlbnRJdGVtLmluaXRpYWxpemVkID0gZmFsc2U7CiAgICAgIHRleHRDb250ZW50SXRlbS5zdHIubGVuZ3RoID0gMDsKICAgIH0KICAgIGZ1bmN0aW9uIGVucXVldWVDaHVuayhiYXRjaCA9IGZhbHNlKSB7CiAgICAgIGNvbnN0IGxlbmd0aCA9IHRleHRDb250ZW50Lml0ZW1zLmxlbmd0aDsKICAgICAgaWYgKGxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoYmF0Y2ggJiYgbGVuZ3RoIDwgVEVYVF9DSFVOS19CQVRDSF9TSVpFKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHNpbms/LmVucXVldWUodGV4dENvbnRlbnQsIGxlbmd0aCk7CiAgICAgIHRleHRDb250ZW50Lml0ZW1zID0gW107CiAgICAgIHRleHRDb250ZW50LnN0eWxlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB9CiAgICBjb25zdCB0aW1lU2xvdE1hbmFnZXIgPSBuZXcgVGltZVNsb3RNYW5hZ2VyKCk7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gcHJvbWlzZUJvZHkocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIGNvbnN0IG5leHQgPSBmdW5jdGlvbiAocHJvbWlzZSkgewogICAgICAgIGVucXVldWVDaHVuayh0cnVlKTsKICAgICAgICBQcm9taXNlLmFsbChbcHJvbWlzZSwgc2luaz8ucmVhZHldKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHByb21pc2VCb2R5KHJlc29sdmUsIHJlamVjdCk7CiAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICByZWplY3QoZXgpOwogICAgICAgICAgfQogICAgICAgIH0sIHJlamVjdCk7CiAgICAgIH07CiAgICAgIHRhc2suZW5zdXJlTm90VGVybWluYXRlZCgpOwogICAgICB0aW1lU2xvdE1hbmFnZXIucmVzZXQoKTsKICAgICAgY29uc3Qgb3BlcmF0aW9uID0ge307CiAgICAgIGxldCBzdG9wLAogICAgICAgIG5hbWUsCiAgICAgICAgaXNWYWxpZE5hbWUsCiAgICAgICAgYXJncyA9IFtdOwogICAgICB3aGlsZSAoIShzdG9wID0gdGltZVNsb3RNYW5hZ2VyLmNoZWNrKCkpKSB7CiAgICAgICAgYXJncy5sZW5ndGggPSAwOwogICAgICAgIG9wZXJhdGlvbi5hcmdzID0gYXJnczsKICAgICAgICBpZiAoIXByZXByb2Nlc3Nvci5yZWFkKG9wZXJhdGlvbikpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gdGV4dFN0YXRlOwogICAgICAgIHRleHRTdGF0ZSA9IHN0YXRlTWFuYWdlci5zdGF0ZTsKICAgICAgICBjb25zdCBmbiA9IG9wZXJhdGlvbi5mbjsKICAgICAgICBhcmdzID0gb3BlcmF0aW9uLmFyZ3M7CiAgICAgICAgc3dpdGNoIChmbiB8IDApIHsKICAgICAgICAgIGNhc2UgT1BTLnNldEZvbnQ6CiAgICAgICAgICAgIGNvbnN0IGZvbnROYW1lQXJnID0gYXJnc1swXS5uYW1lLAogICAgICAgICAgICAgIGZvbnRTaXplQXJnID0gYXJnc1sxXTsKICAgICAgICAgICAgaWYgKHRleHRTdGF0ZS5mb250ICYmIGZvbnROYW1lQXJnID09PSB0ZXh0U3RhdGUuZm9udE5hbWUgJiYgZm9udFNpemVBcmcgPT09IHRleHRTdGF0ZS5mb250U2l6ZSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgICAgIHRleHRTdGF0ZS5mb250TmFtZSA9IGZvbnROYW1lQXJnOwogICAgICAgICAgICB0ZXh0U3RhdGUuZm9udFNpemUgPSBmb250U2l6ZUFyZzsKICAgICAgICAgICAgbmV4dChoYW5kbGVTZXRGb250KGZvbnROYW1lQXJnLCBudWxsKSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIGNhc2UgT1BTLnNldFRleHRSaXNlOgogICAgICAgICAgICB0ZXh0U3RhdGUudGV4dFJpc2UgPSBhcmdzWzBdOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEhTY2FsZToKICAgICAgICAgICAgdGV4dFN0YXRlLnRleHRIU2NhbGUgPSBhcmdzWzBdIC8gMTAwOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldExlYWRpbmc6CiAgICAgICAgICAgIHRleHRTdGF0ZS5sZWFkaW5nID0gYXJnc1swXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5tb3ZlVGV4dDoKICAgICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRMaW5lTWF0cml4KGFyZ3NbMF0sIGFyZ3NbMV0pOwogICAgICAgICAgICB0ZXh0U3RhdGUudGV4dE1hdHJpeCA9IHRleHRTdGF0ZS50ZXh0TGluZU1hdHJpeC5zbGljZSgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldExlYWRpbmdNb3ZlVGV4dDoKICAgICAgICAgICAgdGV4dFN0YXRlLmxlYWRpbmcgPSAtYXJnc1sxXTsKICAgICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRMaW5lTWF0cml4KGFyZ3NbMF0sIGFyZ3NbMV0pOwogICAgICAgICAgICB0ZXh0U3RhdGUudGV4dE1hdHJpeCA9IHRleHRTdGF0ZS50ZXh0TGluZU1hdHJpeC5zbGljZSgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLm5leHRMaW5lOgogICAgICAgICAgICB0ZXh0U3RhdGUuY2FycmlhZ2VSZXR1cm4oKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRUZXh0TWF0cml4OgogICAgICAgICAgICB0ZXh0U3RhdGUuc2V0VGV4dE1hdHJpeChhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdLCBhcmdzWzRdLCBhcmdzWzVdKTsKICAgICAgICAgICAgdGV4dFN0YXRlLnNldFRleHRMaW5lTWF0cml4KGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0sIGFyZ3NbM10sIGFyZ3NbNF0sIGFyZ3NbNV0pOwogICAgICAgICAgICB1cGRhdGVBZHZhbmNlU2NhbGUoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRDaGFyU3BhY2luZzoKICAgICAgICAgICAgdGV4dFN0YXRlLmNoYXJTcGFjaW5nID0gYXJnc1swXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRXb3JkU3BhY2luZzoKICAgICAgICAgICAgdGV4dFN0YXRlLndvcmRTcGFjaW5nID0gYXJnc1swXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5iZWdpblRleHQ6CiAgICAgICAgICAgIHRleHRTdGF0ZS50ZXh0TWF0cml4ID0gSURFTlRJVFlfTUFUUklYLnNsaWNlKCk7CiAgICAgICAgICAgIHRleHRTdGF0ZS50ZXh0TGluZU1hdHJpeCA9IElERU5USVRZX01BVFJJWC5zbGljZSgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNob3dTcGFjZWRUZXh0OgogICAgICAgICAgICBpZiAoIXN0YXRlTWFuYWdlci5zdGF0ZS5mb250KSB7CiAgICAgICAgICAgICAgc2VsZi5lbnN1cmVTdGF0ZUZvbnQoc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBzcGFjZUZhY3RvciA9ICh0ZXh0U3RhdGUuZm9udC52ZXJ0aWNhbCA/IDEgOiAtMSkgKiB0ZXh0U3RhdGUuZm9udFNpemUgLyAxMDAwOwogICAgICAgICAgICBjb25zdCBlbGVtZW50cyA9IGFyZ3NbMF07CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGVsZW1lbnRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICBjb25zdCBpdGVtID0gZWxlbWVudHNbaV07CiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBpdGVtID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgICAgc2hvd1NwYWNlZFRleHRCdWZmZXIucHVzaChpdGVtKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBpdGVtID09PSAibnVtYmVyIiAmJiBpdGVtICE9PSAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzdHIgPSBzaG93U3BhY2VkVGV4dEJ1ZmZlci5qb2luKCIiKTsKICAgICAgICAgICAgICAgIHNob3dTcGFjZWRUZXh0QnVmZmVyLmxlbmd0aCA9IDA7CiAgICAgICAgICAgICAgICBidWlsZFRleHRDb250ZW50SXRlbSh7CiAgICAgICAgICAgICAgICAgIGNoYXJzOiBzdHIsCiAgICAgICAgICAgICAgICAgIGV4dHJhU3BhY2luZzogaXRlbSAqIHNwYWNlRmFjdG9yCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNob3dTcGFjZWRUZXh0QnVmZmVyLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBjb25zdCBzdHIgPSBzaG93U3BhY2VkVGV4dEJ1ZmZlci5qb2luKCIiKTsKICAgICAgICAgICAgICBzaG93U3BhY2VkVGV4dEJ1ZmZlci5sZW5ndGggPSAwOwogICAgICAgICAgICAgIGJ1aWxkVGV4dENvbnRlbnRJdGVtKHsKICAgICAgICAgICAgICAgIGNoYXJzOiBzdHIsCiAgICAgICAgICAgICAgICBleHRyYVNwYWNpbmc6IDAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNob3dUZXh0OgogICAgICAgICAgICBpZiAoIXN0YXRlTWFuYWdlci5zdGF0ZS5mb250KSB7CiAgICAgICAgICAgICAgc2VsZi5lbnN1cmVTdGF0ZUZvbnQoc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBidWlsZFRleHRDb250ZW50SXRlbSh7CiAgICAgICAgICAgICAgY2hhcnM6IGFyZ3NbMF0sCiAgICAgICAgICAgICAgZXh0cmFTcGFjaW5nOiAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLm5leHRMaW5lU2hvd1RleHQ6CiAgICAgICAgICAgIGlmICghc3RhdGVNYW5hZ2VyLnN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgICBzZWxmLmVuc3VyZVN0YXRlRm9udChzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRleHRTdGF0ZS5jYXJyaWFnZVJldHVybigpOwogICAgICAgICAgICBidWlsZFRleHRDb250ZW50SXRlbSh7CiAgICAgICAgICAgICAgY2hhcnM6IGFyZ3NbMF0sCiAgICAgICAgICAgICAgZXh0cmFTcGFjaW5nOiAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLm5leHRMaW5lU2V0U3BhY2luZ1Nob3dUZXh0OgogICAgICAgICAgICBpZiAoIXN0YXRlTWFuYWdlci5zdGF0ZS5mb250KSB7CiAgICAgICAgICAgICAgc2VsZi5lbnN1cmVTdGF0ZUZvbnQoc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0ZXh0U3RhdGUud29yZFNwYWNpbmcgPSBhcmdzWzBdOwogICAgICAgICAgICB0ZXh0U3RhdGUuY2hhclNwYWNpbmcgPSBhcmdzWzFdOwogICAgICAgICAgICB0ZXh0U3RhdGUuY2FycmlhZ2VSZXR1cm4oKTsKICAgICAgICAgICAgYnVpbGRUZXh0Q29udGVudEl0ZW0oewogICAgICAgICAgICAgIGNoYXJzOiBhcmdzWzJdLAogICAgICAgICAgICAgIGV4dHJhU3BhY2luZzogMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5wYWludFhPYmplY3Q6CiAgICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgICAgIHhvYmpzID8/PSByZXNvdXJjZXMuZ2V0KCJYT2JqZWN0IikgfHwgRGljdC5lbXB0eTsKICAgICAgICAgICAgaXNWYWxpZE5hbWUgPSBhcmdzWzBdIGluc3RhbmNlb2YgTmFtZTsKICAgICAgICAgICAgbmFtZSA9IGFyZ3NbMF0ubmFtZTsKICAgICAgICAgICAgaWYgKGlzVmFsaWROYW1lICYmIGVtcHR5WE9iamVjdENhY2hlLmdldEJ5TmFtZShuYW1lKSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG5leHQobmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmVYT2JqZWN0LCByZWplY3RYT2JqZWN0KSB7CiAgICAgICAgICAgICAgaWYgKCFpc1ZhbGlkTmFtZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJYT2JqZWN0IG11c3QgYmUgcmVmZXJyZWQgdG8gYnkgbmFtZS4iKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbGV0IHhvYmogPSB4b2Jqcy5nZXRSYXcobmFtZSk7CiAgICAgICAgICAgICAgaWYgKHhvYmogaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICAgICAgICAgIGlmIChlbXB0eVhPYmplY3RDYWNoZS5nZXRCeVJlZih4b2JqKSkgewogICAgICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBnbG9iYWxJbWFnZSA9IHNlbGYuZ2xvYmFsSW1hZ2VDYWNoZS5nZXREYXRhKHhvYmosIHNlbGYucGFnZUluZGV4KTsKICAgICAgICAgICAgICAgIGlmIChnbG9iYWxJbWFnZSkgewogICAgICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB4b2JqID0geHJlZi5mZXRjaCh4b2JqKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKCEoeG9iaiBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlhPYmplY3Qgc2hvdWxkIGJlIGEgc3RyZWFtIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICAgIGRpY3QKICAgICAgICAgICAgICB9ID0geG9iajsKICAgICAgICAgICAgICBjb25zdCB0eXBlID0gZGljdC5nZXQoIlN1YnR5cGUiKTsKICAgICAgICAgICAgICBpZiAoISh0eXBlIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiWE9iamVjdCBzaG91bGQgaGF2ZSBhIE5hbWUgc3VidHlwZSIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodHlwZS5uYW1lICE9PSAiRm9ybSIpIHsKICAgICAgICAgICAgICAgIGVtcHR5WE9iamVjdENhY2hlLnNldChuYW1lLCBkaWN0Lm9iaklkLCB0cnVlKTsKICAgICAgICAgICAgICAgIHJlc29sdmVYT2JqZWN0KCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTdGF0ZSA9IHN0YXRlTWFuYWdlci5zdGF0ZS5jbG9uZSgpOwogICAgICAgICAgICAgIGNvbnN0IHhPYmpTdGF0ZU1hbmFnZXIgPSBuZXcgU3RhdGVNYW5hZ2VyKGN1cnJlbnRTdGF0ZSk7CiAgICAgICAgICAgICAgY29uc3QgbWF0cml4ID0gbG9va3VwTWF0cml4KGRpY3QuZ2V0QXJyYXkoIk1hdHJpeCIpLCBudWxsKTsKICAgICAgICAgICAgICBpZiAobWF0cml4KSB7CiAgICAgICAgICAgICAgICB4T2JqU3RhdGVNYW5hZ2VyLnRyYW5zZm9ybShtYXRyaXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBsb2NhbFJlc291cmNlcyA9IGRpY3QuZ2V0KCJSZXNvdXJjZXMiKTsKICAgICAgICAgICAgICBlbnF1ZXVlQ2h1bmsoKTsKICAgICAgICAgICAgICBjb25zdCBzaW5rV3JhcHBlciA9IHsKICAgICAgICAgICAgICAgIGVucXVldWVJbnZva2VkOiBmYWxzZSwKICAgICAgICAgICAgICAgIGVucXVldWUoY2h1bmssIHNpemUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5lbnF1ZXVlSW52b2tlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHNpbmsuZW5xdWV1ZShjaHVuaywgc2l6ZSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ2V0IGRlc2lyZWRTaXplKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gc2luay5kZXNpcmVkU2l6ZSA/PyAwOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldCByZWFkeSgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpbmsucmVhZHk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBzZWxmLmdldFRleHRDb250ZW50KHsKICAgICAgICAgICAgICAgIHN0cmVhbTogeG9iaiwKICAgICAgICAgICAgICAgIHRhc2ssCiAgICAgICAgICAgICAgICByZXNvdXJjZXM6IGxvY2FsUmVzb3VyY2VzIGluc3RhbmNlb2YgRGljdCA/IGxvY2FsUmVzb3VyY2VzIDogcmVzb3VyY2VzLAogICAgICAgICAgICAgICAgc3RhdGVNYW5hZ2VyOiB4T2JqU3RhdGVNYW5hZ2VyLAogICAgICAgICAgICAgICAgaW5jbHVkZU1hcmtlZENvbnRlbnQsCiAgICAgICAgICAgICAgICBzaW5rOiBzaW5rICYmIHNpbmtXcmFwcGVyLAogICAgICAgICAgICAgICAgc2VlblN0eWxlcywKICAgICAgICAgICAgICAgIHZpZXdCb3gsCiAgICAgICAgICAgICAgICBsYW5nLAogICAgICAgICAgICAgICAgbWFya2VkQ29udGVudERhdGEsCiAgICAgICAgICAgICAgICBkaXNhYmxlTm9ybWFsaXphdGlvbiwKICAgICAgICAgICAgICAgIGtlZXBXaGl0ZVNwYWNlLAogICAgICAgICAgICAgICAgcHJldlJlZnM6IHNlZW5SZWZzCiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoIXNpbmtXcmFwcGVyLmVucXVldWVJbnZva2VkKSB7CiAgICAgICAgICAgICAgICAgIGVtcHR5WE9iamVjdENhY2hlLnNldChuYW1lLCBkaWN0Lm9iaklkLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc29sdmVYT2JqZWN0KCk7CiAgICAgICAgICAgICAgfSwgcmVqZWN0WE9iamVjdCk7CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICAgICAgICAgIHdhcm4oYGdldFRleHRDb250ZW50IC0gaWdub3JpbmcgWE9iamVjdDogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRocm93IHJlYXNvbjsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBjYXNlIE9QUy5zZXRHU3RhdGU6CiAgICAgICAgICAgIGlzVmFsaWROYW1lID0gYXJnc1swXSBpbnN0YW5jZW9mIE5hbWU7CiAgICAgICAgICAgIG5hbWUgPSBhcmdzWzBdLm5hbWU7CiAgICAgICAgICAgIGlmIChpc1ZhbGlkTmFtZSAmJiBlbXB0eUdTdGF0ZUNhY2hlLmdldEJ5TmFtZShuYW1lKSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG5leHQobmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmVHU3RhdGUsIHJlamVjdEdTdGF0ZSkgewogICAgICAgICAgICAgIGlmICghaXNWYWxpZE5hbWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiR1N0YXRlIG11c3QgYmUgcmVmZXJyZWQgdG8gYnkgbmFtZS4iKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgZXh0R1N0YXRlID0gcmVzb3VyY2VzLmdldCgiRXh0R1N0YXRlIik7CiAgICAgICAgICAgICAgaWYgKCEoZXh0R1N0YXRlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiRXh0R1N0YXRlIHNob3VsZCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGdTdGF0ZSA9IGV4dEdTdGF0ZS5nZXQobmFtZSk7CiAgICAgICAgICAgICAgaWYgKCEoZ1N0YXRlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiR1N0YXRlIHNob3VsZCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGdTdGF0ZUZvbnQgPSBnU3RhdGUuZ2V0KCJGb250Iik7CiAgICAgICAgICAgICAgaWYgKCFnU3RhdGVGb250KSB7CiAgICAgICAgICAgICAgICBlbXB0eUdTdGF0ZUNhY2hlLnNldChuYW1lLCBnU3RhdGUub2JqSWQsIHRydWUpOwogICAgICAgICAgICAgICAgcmVzb2x2ZUdTdGF0ZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICAgIHRleHRTdGF0ZS5mb250TmFtZSA9IG51bGw7CiAgICAgICAgICAgICAgdGV4dFN0YXRlLmZvbnRTaXplID0gZ1N0YXRlRm9udFsxXTsKICAgICAgICAgICAgICBoYW5kbGVTZXRGb250KG51bGwsIGdTdGF0ZUZvbnRbMF0pLnRoZW4ocmVzb2x2ZUdTdGF0ZSwgcmVqZWN0R1N0YXRlKTsKICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBBYm9ydEV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgICAgICAgICAgd2FybihgZ2V0VGV4dENvbnRlbnQgLSBpZ25vcmluZyBFeHRHU3RhdGU6ICIke3JlYXNvbn0iLmApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY2FzZSBPUFMuYmVnaW5NYXJrZWRDb250ZW50OgogICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICBpZiAoaW5jbHVkZU1hcmtlZENvbnRlbnQpIHsKICAgICAgICAgICAgICBtYXJrZWRDb250ZW50RGF0YS5sZXZlbCsrOwogICAgICAgICAgICAgIHRleHRDb250ZW50Lml0ZW1zLnB1c2goewogICAgICAgICAgICAgICAgdHlwZTogImJlZ2luTWFya2VkQ29udGVudCIsCiAgICAgICAgICAgICAgICB0YWc6IGFyZ3NbMF0gaW5zdGFuY2VvZiBOYW1lID8gYXJnc1swXS5uYW1lIDogbnVsbAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuYmVnaW5NYXJrZWRDb250ZW50UHJvcHM6CiAgICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgICAgIGlmIChpbmNsdWRlTWFya2VkQ29udGVudCkgewogICAgICAgICAgICAgIG1hcmtlZENvbnRlbnREYXRhLmxldmVsKys7CiAgICAgICAgICAgICAgbGV0IG1jaWQgPSBudWxsOwogICAgICAgICAgICAgIGlmIChhcmdzWzFdIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgICAgICAgICAgbWNpZCA9IGFyZ3NbMV0uZ2V0KCJNQ0lEIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRleHRDb250ZW50Lml0ZW1zLnB1c2goewogICAgICAgICAgICAgICAgdHlwZTogImJlZ2luTWFya2VkQ29udGVudFByb3BzIiwKICAgICAgICAgICAgICAgIGlkOiBOdW1iZXIuaXNJbnRlZ2VyKG1jaWQpID8gYCR7c2VsZi5pZEZhY3RvcnkuZ2V0UGFnZU9iaklkKCl9X21jJHttY2lkfWAgOiBudWxsLAogICAgICAgICAgICAgICAgdGFnOiBhcmdzWzBdIGluc3RhbmNlb2YgTmFtZSA/IGFyZ3NbMF0ubmFtZSA6IG51bGwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLmVuZE1hcmtlZENvbnRlbnQ6CiAgICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgICAgIGlmIChpbmNsdWRlTWFya2VkQ29udGVudCkgewogICAgICAgICAgICAgIGlmIChtYXJrZWRDb250ZW50RGF0YS5sZXZlbCA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIG1hcmtlZENvbnRlbnREYXRhLmxldmVsLS07CiAgICAgICAgICAgICAgdGV4dENvbnRlbnQuaXRlbXMucHVzaCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZW5kTWFya2VkQ29udGVudCIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnJlc3RvcmU6CiAgICAgICAgICAgIGlmIChwcmV2aW91c1N0YXRlICYmIChwcmV2aW91c1N0YXRlLmZvbnQgIT09IHRleHRTdGF0ZS5mb250IHx8IHByZXZpb3VzU3RhdGUuZm9udFNpemUgIT09IHRleHRTdGF0ZS5mb250U2l6ZSB8fCBwcmV2aW91c1N0YXRlLmZvbnROYW1lICE9PSB0ZXh0U3RhdGUuZm9udE5hbWUpKSB7CiAgICAgICAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKHRleHRDb250ZW50Lml0ZW1zLmxlbmd0aCA+PSAoc2luaz8uZGVzaXJlZFNpemUgPz8gMSkpIHsKICAgICAgICAgIHN0b3AgPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChzdG9wKSB7CiAgICAgICAgbmV4dChkZWZlcnJlZCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgIGVucXVldWVDaHVuaygpOwogICAgICByZXNvbHZlKCk7CiAgICB9KS5jYXRjaChyZWFzb24gPT4gewogICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICB3YXJuKGBnZXRUZXh0Q29udGVudCAtIGlnbm9yaW5nIGVycm9ycyBkdXJpbmcgIiR7dGFzay5uYW1lfSIgYCArIGB0YXNrOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgIGVucXVldWVDaHVuaygpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aHJvdyByZWFzb247CiAgICB9KTsKICB9CiAgYXN5bmMgZXh0cmFjdERhdGFTdHJ1Y3R1cmVzKGRpY3QsIHByb3BlcnRpZXMpIHsKICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWY7CiAgICBsZXQgY2lkVG9HaWRCeXRlczsKICAgIGNvbnN0IHRvVW5pY29kZVByb21pc2UgPSB0aGlzLnJlYWRUb1VuaWNvZGUocHJvcGVydGllcy50b1VuaWNvZGUpOwogICAgaWYgKHByb3BlcnRpZXMuY29tcG9zaXRlKSB7CiAgICAgIGNvbnN0IGNpZFN5c3RlbUluZm8gPSBkaWN0LmdldCgiQ0lEU3lzdGVtSW5mbyIpOwogICAgICBpZiAoY2lkU3lzdGVtSW5mbyBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICBwcm9wZXJ0aWVzLmNpZFN5c3RlbUluZm8gPSB7CiAgICAgICAgICByZWdpc3RyeTogc3RyaW5nVG9QREZTdHJpbmcoY2lkU3lzdGVtSW5mby5nZXQoIlJlZ2lzdHJ5IikpLAogICAgICAgICAgb3JkZXJpbmc6IHN0cmluZ1RvUERGU3RyaW5nKGNpZFN5c3RlbUluZm8uZ2V0KCJPcmRlcmluZyIpKSwKICAgICAgICAgIHN1cHBsZW1lbnQ6IGNpZFN5c3RlbUluZm8uZ2V0KCJTdXBwbGVtZW50IikKICAgICAgICB9OwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgY2lkVG9HaWRNYXAgPSBkaWN0LmdldCgiQ0lEVG9HSURNYXAiKTsKICAgICAgICBpZiAoY2lkVG9HaWRNYXAgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgICAgICBjaWRUb0dpZEJ5dGVzID0gY2lkVG9HaWRNYXAuZ2V0Qnl0ZXMoKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICB0aHJvdyBleDsKICAgICAgICB9CiAgICAgICAgd2FybihgZXh0cmFjdERhdGFTdHJ1Y3R1cmVzIC0gaWdub3JpbmcgQ0lEVG9HSURNYXAgZGF0YTogIiR7ZXh9Ii5gKTsKICAgICAgfQogICAgfQogICAgY29uc3QgZGlmZmVyZW5jZXMgPSBbXTsKICAgIGxldCBiYXNlRW5jb2RpbmdOYW1lID0gbnVsbDsKICAgIGxldCBlbmNvZGluZzsKICAgIGlmIChkaWN0LmhhcygiRW5jb2RpbmciKSkgewogICAgICBlbmNvZGluZyA9IGRpY3QuZ2V0KCJFbmNvZGluZyIpOwogICAgICBpZiAoZW5jb2RpbmcgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgYmFzZUVuY29kaW5nTmFtZSA9IGVuY29kaW5nLmdldCgiQmFzZUVuY29kaW5nIik7CiAgICAgICAgYmFzZUVuY29kaW5nTmFtZSA9IGJhc2VFbmNvZGluZ05hbWUgaW5zdGFuY2VvZiBOYW1lID8gYmFzZUVuY29kaW5nTmFtZS5uYW1lIDogbnVsbDsKICAgICAgICBpZiAoZW5jb2RpbmcuaGFzKCJEaWZmZXJlbmNlcyIpKSB7CiAgICAgICAgICBjb25zdCBkaWZmRW5jb2RpbmcgPSBlbmNvZGluZy5nZXQoIkRpZmZlcmVuY2VzIik7CiAgICAgICAgICBsZXQgaW5kZXggPSAwOwogICAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBkaWZmRW5jb2RpbmcpIHsKICAgICAgICAgICAgY29uc3QgZGF0YSA9IHhyZWYuZmV0Y2hJZlJlZihlbnRyeSk7CiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICBpbmRleCA9IGRhdGE7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgICBkaWZmZXJlbmNlc1tpbmRleCsrXSA9IGRhdGEubmFtZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgZW50cnkgaW4gJ0RpZmZlcmVuY2VzJyBhcnJheTogJHtkYXRhfWApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGVuY29kaW5nIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIGJhc2VFbmNvZGluZ05hbWUgPSBlbmNvZGluZy5uYW1lOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IG1zZyA9ICJFbmNvZGluZyBpcyBub3QgYSBOYW1lIG5vciBhIERpY3QiOwogICAgICAgIGlmICghdGhpcy5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKG1zZyk7CiAgICAgICAgfQogICAgICAgIHdhcm4obXNnKTsKICAgICAgfQogICAgICBpZiAoYmFzZUVuY29kaW5nTmFtZSAhPT0gIk1hY1JvbWFuRW5jb2RpbmciICYmIGJhc2VFbmNvZGluZ05hbWUgIT09ICJNYWNFeHBlcnRFbmNvZGluZyIgJiYgYmFzZUVuY29kaW5nTmFtZSAhPT0gIldpbkFuc2lFbmNvZGluZyIpIHsKICAgICAgICBiYXNlRW5jb2RpbmdOYW1lID0gbnVsbDsKICAgICAgfQogICAgfQogICAgY29uc3Qgbm9uRW1iZWRkZWRGb250ID0gIXByb3BlcnRpZXMuZmlsZSB8fCBwcm9wZXJ0aWVzLmlzSW50ZXJuYWxGb250LAogICAgICBpc1N5bWJvbHNGb250TmFtZSA9IGdldFN5bWJvbHNGb250cygpW3Byb3BlcnRpZXMubmFtZV07CiAgICBpZiAoYmFzZUVuY29kaW5nTmFtZSAmJiBub25FbWJlZGRlZEZvbnQgJiYgaXNTeW1ib2xzRm9udE5hbWUpIHsKICAgICAgYmFzZUVuY29kaW5nTmFtZSA9IG51bGw7CiAgICB9CiAgICBpZiAoYmFzZUVuY29kaW5nTmFtZSkgewogICAgICBwcm9wZXJ0aWVzLmRlZmF1bHRFbmNvZGluZyA9IGdldEVuY29kaW5nKGJhc2VFbmNvZGluZ05hbWUpOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgaXNTeW1ib2xpY0ZvbnQgPSAhIShwcm9wZXJ0aWVzLmZsYWdzICYgRm9udEZsYWdzLlN5bWJvbGljKTsKICAgICAgY29uc3QgaXNOb25zeW1ib2xpY0ZvbnQgPSAhIShwcm9wZXJ0aWVzLmZsYWdzICYgRm9udEZsYWdzLk5vbnN5bWJvbGljKTsKICAgICAgZW5jb2RpbmcgPSBTdGFuZGFyZEVuY29kaW5nOwogICAgICBpZiAocHJvcGVydGllcy50eXBlID09PSAiVHJ1ZVR5cGUiICYmICFpc05vbnN5bWJvbGljRm9udCkgewogICAgICAgIGVuY29kaW5nID0gV2luQW5zaUVuY29kaW5nOwogICAgICB9CiAgICAgIGlmIChpc1N5bWJvbGljRm9udCB8fCBpc1N5bWJvbHNGb250TmFtZSkgewogICAgICAgIGVuY29kaW5nID0gTWFjUm9tYW5FbmNvZGluZzsKICAgICAgICBpZiAobm9uRW1iZWRkZWRGb250KSB7CiAgICAgICAgICBpZiAoL1N5bWJvbC9pLnRlc3QocHJvcGVydGllcy5uYW1lKSkgewogICAgICAgICAgICBlbmNvZGluZyA9IFN5bWJvbFNldEVuY29kaW5nOwogICAgICAgICAgfSBlbHNlIGlmICgvRGluZ2JhdHMvaS50ZXN0KHByb3BlcnRpZXMubmFtZSkpIHsKICAgICAgICAgICAgZW5jb2RpbmcgPSBaYXBmRGluZ2JhdHNFbmNvZGluZzsKICAgICAgICAgIH0gZWxzZSBpZiAoL1dpbmdkaW5ncy9pLnRlc3QocHJvcGVydGllcy5uYW1lKSkgewogICAgICAgICAgICBlbmNvZGluZyA9IFdpbkFuc2lFbmNvZGluZzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcHJvcGVydGllcy5kZWZhdWx0RW5jb2RpbmcgPSBlbmNvZGluZzsKICAgIH0KICAgIHByb3BlcnRpZXMuZGlmZmVyZW5jZXMgPSBkaWZmZXJlbmNlczsKICAgIHByb3BlcnRpZXMuYmFzZUVuY29kaW5nTmFtZSA9IGJhc2VFbmNvZGluZ05hbWU7CiAgICBwcm9wZXJ0aWVzLmhhc0VuY29kaW5nID0gISFiYXNlRW5jb2RpbmdOYW1lIHx8IGRpZmZlcmVuY2VzLmxlbmd0aCA+IDA7CiAgICBwcm9wZXJ0aWVzLmRpY3QgPSBkaWN0OwogICAgcHJvcGVydGllcy50b1VuaWNvZGUgPSBhd2FpdCB0b1VuaWNvZGVQcm9taXNlOwogICAgY29uc3QgYnVpbHRUb1VuaWNvZGUgPSBhd2FpdCB0aGlzLmJ1aWxkVG9Vbmljb2RlKHByb3BlcnRpZXMpOwogICAgcHJvcGVydGllcy50b1VuaWNvZGUgPSBidWlsdFRvVW5pY29kZTsKICAgIGlmIChjaWRUb0dpZEJ5dGVzKSB7CiAgICAgIHByb3BlcnRpZXMuY2lkVG9HaWRNYXAgPSB0aGlzLnJlYWRDaWRUb0dpZE1hcChjaWRUb0dpZEJ5dGVzLCBidWlsdFRvVW5pY29kZSk7CiAgICB9CiAgICByZXR1cm4gcHJvcGVydGllczsKICB9CiAgX3NpbXBsZUZvbnRUb1VuaWNvZGUocHJvcGVydGllcywgZm9yY2VHbHlwaHMgPSBmYWxzZSkgewogICAgYXNzZXJ0KCFwcm9wZXJ0aWVzLmNvbXBvc2l0ZSwgIk11c3QgYmUgYSBzaW1wbGUgZm9udC4iKTsKICAgIGNvbnN0IHRvVW5pY29kZSA9IFtdOwogICAgY29uc3QgZW5jb2RpbmcgPSBwcm9wZXJ0aWVzLmRlZmF1bHRFbmNvZGluZy5zbGljZSgpOwogICAgY29uc3QgYmFzZUVuY29kaW5nTmFtZSA9IHByb3BlcnRpZXMuYmFzZUVuY29kaW5nTmFtZTsKICAgIGNvbnN0IGRpZmZlcmVuY2VzID0gcHJvcGVydGllcy5kaWZmZXJlbmNlczsKICAgIGZvciAoY29uc3QgY2hhcmNvZGUgaW4gZGlmZmVyZW5jZXMpIHsKICAgICAgY29uc3QgZ2x5cGhOYW1lID0gZGlmZmVyZW5jZXNbY2hhcmNvZGVdOwogICAgICBpZiAoZ2x5cGhOYW1lID09PSAiLm5vdGRlZiIpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBlbmNvZGluZ1tjaGFyY29kZV0gPSBnbHlwaE5hbWU7CiAgICB9CiAgICBjb25zdCBnbHlwaHNVbmljb2RlTWFwID0gZ2V0R2x5cGhzVW5pY29kZSgpOwogICAgZm9yIChjb25zdCBjaGFyY29kZSBpbiBlbmNvZGluZykgewogICAgICBsZXQgZ2x5cGhOYW1lID0gZW5jb2RpbmdbY2hhcmNvZGVdOwogICAgICBpZiAoZ2x5cGhOYW1lID09PSAiIikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGxldCB1bmljb2RlID0gZ2x5cGhzVW5pY29kZU1hcFtnbHlwaE5hbWVdOwogICAgICBpZiAodW5pY29kZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdG9Vbmljb2RlW2NoYXJjb2RlXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUodW5pY29kZSk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgbGV0IGNvZGUgPSAwOwogICAgICBzd2l0Y2ggKGdseXBoTmFtZVswXSkgewogICAgICAgIGNhc2UgIkciOgogICAgICAgICAgaWYgKGdseXBoTmFtZS5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgY29kZSA9IHBhcnNlSW50KGdseXBoTmFtZS5zdWJzdHJpbmcoMSksIDE2KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImciOgogICAgICAgICAgaWYgKGdseXBoTmFtZS5sZW5ndGggPT09IDUpIHsKICAgICAgICAgICAgY29kZSA9IHBhcnNlSW50KGdseXBoTmFtZS5zdWJzdHJpbmcoMSksIDE2KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkMiOgogICAgICAgIGNhc2UgImMiOgogICAgICAgICAgaWYgKGdseXBoTmFtZS5sZW5ndGggPj0gMyAmJiBnbHlwaE5hbWUubGVuZ3RoIDw9IDQpIHsKICAgICAgICAgICAgY29uc3QgY29kZVN0ciA9IGdseXBoTmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgIGlmIChmb3JjZUdseXBocykgewogICAgICAgICAgICAgIGNvZGUgPSBwYXJzZUludChjb2RlU3RyLCAxNik7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29kZSA9ICtjb2RlU3RyOwogICAgICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKGNvZGUpICYmIE51bWJlci5pc0ludGVnZXIocGFyc2VJbnQoY29kZVN0ciwgMTYpKSkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zaW1wbGVGb250VG9Vbmljb2RlKHByb3BlcnRpZXMsIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJ1IjoKICAgICAgICAgIHVuaWNvZGUgPSBnZXRVbmljb2RlRm9yR2x5cGgoZ2x5cGhOYW1lLCBnbHlwaHNVbmljb2RlTWFwKTsKICAgICAgICAgIGlmICh1bmljb2RlICE9PSAtMSkgewogICAgICAgICAgICBjb2RlID0gdW5pY29kZTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBzd2l0Y2ggKGdseXBoTmFtZSkgewogICAgICAgICAgICBjYXNlICJmX2giOgogICAgICAgICAgICBjYXNlICJmX3QiOgogICAgICAgICAgICBjYXNlICJUX2giOgogICAgICAgICAgICAgIHRvVW5pY29kZVtjaGFyY29kZV0gPSBnbHlwaE5hbWUucmVwbGFjZUFsbCgiXyIsICIiKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmIChjb2RlID4gMCAmJiBjb2RlIDw9IDB4MTBmZmZmICYmIE51bWJlci5pc0ludGVnZXIoY29kZSkpIHsKICAgICAgICBpZiAoYmFzZUVuY29kaW5nTmFtZSAmJiBjb2RlID09PSArY2hhcmNvZGUpIHsKICAgICAgICAgIGNvbnN0IGJhc2VFbmNvZGluZyA9IGdldEVuY29kaW5nKGJhc2VFbmNvZGluZ05hbWUpOwogICAgICAgICAgaWYgKGJhc2VFbmNvZGluZyAmJiAoZ2x5cGhOYW1lID0gYmFzZUVuY29kaW5nW2NoYXJjb2RlXSkpIHsKICAgICAgICAgICAgdG9Vbmljb2RlW2NoYXJjb2RlXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZ2x5cGhzVW5pY29kZU1hcFtnbHlwaE5hbWVdKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRvVW5pY29kZVtjaGFyY29kZV0gPSBTdHJpbmcuZnJvbUNvZGVQb2ludChjb2RlKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRvVW5pY29kZTsKICB9CiAgYXN5bmMgYnVpbGRUb1VuaWNvZGUocHJvcGVydGllcykgewogICAgcHJvcGVydGllcy5oYXNJbmNsdWRlZFRvVW5pY29kZU1hcCA9IHByb3BlcnRpZXMudG9Vbmljb2RlPy5sZW5ndGggPiAwOwogICAgaWYgKHByb3BlcnRpZXMuaGFzSW5jbHVkZWRUb1VuaWNvZGVNYXApIHsKICAgICAgaWYgKCFwcm9wZXJ0aWVzLmNvbXBvc2l0ZSAmJiBwcm9wZXJ0aWVzLmhhc0VuY29kaW5nKSB7CiAgICAgICAgcHJvcGVydGllcy5mYWxsYmFja1RvVW5pY29kZSA9IHRoaXMuX3NpbXBsZUZvbnRUb1VuaWNvZGUocHJvcGVydGllcyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHByb3BlcnRpZXMudG9Vbmljb2RlOwogICAgfQogICAgaWYgKCFwcm9wZXJ0aWVzLmNvbXBvc2l0ZSkgewogICAgICByZXR1cm4gbmV3IFRvVW5pY29kZU1hcCh0aGlzLl9zaW1wbGVGb250VG9Vbmljb2RlKHByb3BlcnRpZXMpKTsKICAgIH0KICAgIGlmIChwcm9wZXJ0aWVzLmNvbXBvc2l0ZSAmJiAocHJvcGVydGllcy5jTWFwLmJ1aWx0SW5DTWFwICYmICEocHJvcGVydGllcy5jTWFwIGluc3RhbmNlb2YgSWRlbnRpdHlDTWFwKSB8fCBwcm9wZXJ0aWVzLmNpZFN5c3RlbUluZm8/LnJlZ2lzdHJ5ID09PSAiQWRvYmUiICYmIChwcm9wZXJ0aWVzLmNpZFN5c3RlbUluZm8ub3JkZXJpbmcgPT09ICJHQjEiIHx8IHByb3BlcnRpZXMuY2lkU3lzdGVtSW5mby5vcmRlcmluZyA9PT0gIkNOUzEiIHx8IHByb3BlcnRpZXMuY2lkU3lzdGVtSW5mby5vcmRlcmluZyA9PT0gIkphcGFuMSIgfHwgcHJvcGVydGllcy5jaWRTeXN0ZW1JbmZvLm9yZGVyaW5nID09PSAiS29yZWExIikpKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICByZWdpc3RyeSwKICAgICAgICBvcmRlcmluZwogICAgICB9ID0gcHJvcGVydGllcy5jaWRTeXN0ZW1JbmZvOwogICAgICBjb25zdCB1Y3MyQ01hcE5hbWUgPSBOYW1lLmdldChgJHtyZWdpc3RyeX0tJHtvcmRlcmluZ30tVUNTMmApOwogICAgICBjb25zdCB1Y3MyQ01hcCA9IGF3YWl0IENNYXBGYWN0b3J5LmNyZWF0ZSh7CiAgICAgICAgZW5jb2Rpbmc6IHVjczJDTWFwTmFtZSwKICAgICAgICBmZXRjaEJ1aWx0SW5DTWFwOiB0aGlzLl9mZXRjaEJ1aWx0SW5DTWFwQm91bmQsCiAgICAgICAgdXNlQ01hcDogbnVsbAogICAgICB9KTsKICAgICAgY29uc3QgdG9Vbmljb2RlID0gW10sCiAgICAgICAgYnVmID0gW107CiAgICAgIHByb3BlcnRpZXMuY01hcC5mb3JFYWNoKGZ1bmN0aW9uIChjaGFyY29kZSwgY2lkKSB7CiAgICAgICAgaWYgKGNpZCA+IDB4ZmZmZikgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJNYXggc2l6ZSBvZiBDSUQgaXMgNjUsNTM1Iik7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHVjczIgPSB1Y3MyQ01hcC5sb29rdXAoY2lkKTsKICAgICAgICBpZiAodWNzMikgewogICAgICAgICAgYnVmLmxlbmd0aCA9IDA7CiAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB1Y3MyLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICAgICAgYnVmLnB1c2goKHVjczIuY2hhckNvZGVBdChpKSA8PCA4KSArIHVjczIuY2hhckNvZGVBdChpICsgMSkpOwogICAgICAgICAgfQogICAgICAgICAgdG9Vbmljb2RlW2NoYXJjb2RlXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoLi4uYnVmKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gbmV3IFRvVW5pY29kZU1hcCh0b1VuaWNvZGUpOwogICAgfQogICAgcmV0dXJuIG5ldyBJZGVudGl0eVRvVW5pY29kZU1hcChwcm9wZXJ0aWVzLmZpcnN0Q2hhciwgcHJvcGVydGllcy5sYXN0Q2hhcik7CiAgfQogIGFzeW5jIHJlYWRUb1VuaWNvZGUoY21hcE9iaikgewogICAgaWYgKCFjbWFwT2JqKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKGNtYXBPYmogaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgIGNvbnN0IGNtYXAgPSBhd2FpdCBDTWFwRmFjdG9yeS5jcmVhdGUoewogICAgICAgIGVuY29kaW5nOiBjbWFwT2JqLAogICAgICAgIGZldGNoQnVpbHRJbkNNYXA6IHRoaXMuX2ZldGNoQnVpbHRJbkNNYXBCb3VuZCwKICAgICAgICB1c2VDTWFwOiBudWxsCiAgICAgIH0pOwogICAgICBpZiAoY21hcCBpbnN0YW5jZW9mIElkZW50aXR5Q01hcCkgewogICAgICAgIHJldHVybiBuZXcgSWRlbnRpdHlUb1VuaWNvZGVNYXAoMCwgMHhmZmZmKTsKICAgICAgfQogICAgICByZXR1cm4gbmV3IFRvVW5pY29kZU1hcChjbWFwLmdldE1hcCgpKTsKICAgIH0KICAgIGlmIChjbWFwT2JqIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IGNtYXAgPSBhd2FpdCBDTWFwRmFjdG9yeS5jcmVhdGUoewogICAgICAgICAgZW5jb2Rpbmc6IGNtYXBPYmosCiAgICAgICAgICBmZXRjaEJ1aWx0SW5DTWFwOiB0aGlzLl9mZXRjaEJ1aWx0SW5DTWFwQm91bmQsCiAgICAgICAgICB1c2VDTWFwOiBudWxsCiAgICAgICAgfSk7CiAgICAgICAgaWYgKGNtYXAgaW5zdGFuY2VvZiBJZGVudGl0eUNNYXApIHsKICAgICAgICAgIHJldHVybiBuZXcgSWRlbnRpdHlUb1VuaWNvZGVNYXAoMCwgMHhmZmZmKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbWFwID0gbmV3IEFycmF5KGNtYXAubGVuZ3RoKTsKICAgICAgICBjbWFwLmZvckVhY2goZnVuY3Rpb24gKGNoYXJDb2RlLCB0b2tlbikgewogICAgICAgICAgaWYgKHR5cGVvZiB0b2tlbiA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgbWFwW2NoYXJDb2RlXSA9IFN0cmluZy5mcm9tQ29kZVBvaW50KHRva2VuKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRva2VuLmxlbmd0aCAlIDIgIT09IDApIHsKICAgICAgICAgICAgdG9rZW4gPSAiXHUwMDAwIiArIHRva2VuOwogICAgICAgICAgfQogICAgICAgICAgY29uc3Qgc3RyID0gW107CiAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IHRva2VuLmxlbmd0aDsgayArPSAyKSB7CiAgICAgICAgICAgIGNvbnN0IHcxID0gdG9rZW4uY2hhckNvZGVBdChrKSA8PCA4IHwgdG9rZW4uY2hhckNvZGVBdChrICsgMSk7CiAgICAgICAgICAgIGlmICgodzEgJiAweGY4MDApICE9PSAweGQ4MDApIHsKICAgICAgICAgICAgICBzdHIucHVzaCh3MSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgayArPSAyOwogICAgICAgICAgICBjb25zdCB3MiA9IHRva2VuLmNoYXJDb2RlQXQoaykgPDwgOCB8IHRva2VuLmNoYXJDb2RlQXQoayArIDEpOwogICAgICAgICAgICBzdHIucHVzaCgoKHcxICYgMHgzZmYpIDw8IDEwKSArICh3MiAmIDB4M2ZmKSArIDB4MTAwMDApOwogICAgICAgICAgfQogICAgICAgICAgbWFwW2NoYXJDb2RlXSA9IFN0cmluZy5mcm9tQ29kZVBvaW50KC4uLnN0cik7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIG5ldyBUb1VuaWNvZGVNYXAobWFwKTsKICAgICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICAgIHdhcm4oYHJlYWRUb1VuaWNvZGUgLSBpZ25vcmluZyBUb1VuaWNvZGUgZGF0YTogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdGhyb3cgcmVhc29uOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgcmVhZENpZFRvR2lkTWFwKGdseXBoc0RhdGEsIHRvVW5pY29kZSkgewogICAgY29uc3QgcmVzdWx0ID0gW107CiAgICBmb3IgKGxldCBqID0gMCwgamogPSBnbHlwaHNEYXRhLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgY29uc3QgZ2x5cGhJRCA9IGdseXBoc0RhdGFbaisrXSA8PCA4IHwgZ2x5cGhzRGF0YVtqXTsKICAgICAgY29uc3QgY29kZSA9IGogPj4gMTsKICAgICAgaWYgKGdseXBoSUQgPT09IDAgJiYgIXRvVW5pY29kZS5oYXMoY29kZSkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICByZXN1bHRbY29kZV0gPSBnbHlwaElEOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CiAgZXh0cmFjdFdpZHRocyhkaWN0LCBkZXNjcmlwdG9yLCBwcm9wZXJ0aWVzKSB7CiAgICBjb25zdCB4cmVmID0gdGhpcy54cmVmOwogICAgbGV0IGdseXBoc1dpZHRocyA9IFtdOwogICAgbGV0IGRlZmF1bHRXaWR0aCA9IDA7CiAgICBjb25zdCBnbHlwaHNWTWV0cmljcyA9IFtdOwogICAgbGV0IGRlZmF1bHRWTWV0cmljczsKICAgIGlmIChwcm9wZXJ0aWVzLmNvbXBvc2l0ZSkgewogICAgICBjb25zdCBkdyA9IGRpY3QuZ2V0KCJEVyIpOwogICAgICBkZWZhdWx0V2lkdGggPSB0eXBlb2YgZHcgPT09ICJudW1iZXIiID8gTWF0aC5jZWlsKGR3KSA6IDEwMDA7CiAgICAgIGNvbnN0IHdpZHRocyA9IGRpY3QuZ2V0KCJXIik7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHdpZHRocykpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB3aWR0aHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgbGV0IHN0YXJ0ID0geHJlZi5mZXRjaElmUmVmKHdpZHRoc1tpKytdKTsKICAgICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihzdGFydCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBjb2RlID0geHJlZi5mZXRjaElmUmVmKHdpZHRoc1tpXSk7CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb2RlKSkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGMgb2YgY29kZSkgewogICAgICAgICAgICAgIGNvbnN0IHdpZHRoID0geHJlZi5mZXRjaElmUmVmKGMpOwogICAgICAgICAgICAgIGlmICh0eXBlb2Ygd2lkdGggPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICBnbHlwaHNXaWR0aHNbc3RhcnRdID0gd2lkdGg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHN0YXJ0Kys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoTnVtYmVyLmlzSW50ZWdlcihjb2RlKSkgewogICAgICAgICAgICBjb25zdCB3aWR0aCA9IHhyZWYuZmV0Y2hJZlJlZih3aWR0aHNbKytpXSk7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygd2lkdGggIT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChsZXQgaiA9IHN0YXJ0OyBqIDw9IGNvZGU7IGorKykgewogICAgICAgICAgICAgIGdseXBoc1dpZHRoc1tqXSA9IHdpZHRoOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHByb3BlcnRpZXMudmVydGljYWwpIHsKICAgICAgICBjb25zdCBkdzIgPSBkaWN0LmdldEFycmF5KCJEVzIiKTsKICAgICAgICBsZXQgdm1ldHJpY3MgPSBpc051bWJlckFycmF5KGR3MiwgMikgPyBkdzIgOiBbODgwLCAtMTAwMF07CiAgICAgICAgZGVmYXVsdFZNZXRyaWNzID0gW3ZtZXRyaWNzWzFdLCBkZWZhdWx0V2lkdGggKiAwLjUsIHZtZXRyaWNzWzBdXTsKICAgICAgICB2bWV0cmljcyA9IGRpY3QuZ2V0KCJXMiIpOwogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZtZXRyaWNzKSkgewogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdm1ldHJpY3MubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICBsZXQgc3RhcnQgPSB4cmVmLmZldGNoSWZSZWYodm1ldHJpY3NbaSsrXSk7CiAgICAgICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihzdGFydCkpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBjb2RlID0geHJlZi5mZXRjaElmUmVmKHZtZXRyaWNzW2ldKTsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29kZSkpIHsKICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgamogPSBjb2RlLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHZtZXRyaWMgPSBbeHJlZi5mZXRjaElmUmVmKGNvZGVbaisrXSksIHhyZWYuZmV0Y2hJZlJlZihjb2RlW2orK10pLCB4cmVmLmZldGNoSWZSZWYoY29kZVtqXSldOwogICAgICAgICAgICAgICAgaWYgKGlzTnVtYmVyQXJyYXkodm1ldHJpYywgbnVsbCkpIHsKICAgICAgICAgICAgICAgICAgZ2x5cGhzVk1ldHJpY3Nbc3RhcnRdID0gdm1ldHJpYzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0YXJ0Kys7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKE51bWJlci5pc0ludGVnZXIoY29kZSkpIHsKICAgICAgICAgICAgICBjb25zdCB2bWV0cmljID0gW3hyZWYuZmV0Y2hJZlJlZih2bWV0cmljc1srK2ldKSwgeHJlZi5mZXRjaElmUmVmKHZtZXRyaWNzWysraV0pLCB4cmVmLmZldGNoSWZSZWYodm1ldHJpY3NbKytpXSldOwogICAgICAgICAgICAgIGlmICghaXNOdW1iZXJBcnJheSh2bWV0cmljLCBudWxsKSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGZvciAobGV0IGogPSBzdGFydDsgaiA8PSBjb2RlOyBqKyspIHsKICAgICAgICAgICAgICAgIGdseXBoc1ZNZXRyaWNzW2pdID0gdm1ldHJpYzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHdpZHRocyA9IGRpY3QuZ2V0KCJXaWR0aHMiKTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkod2lkdGhzKSkgewogICAgICAgIGxldCBqID0gcHJvcGVydGllcy5maXJzdENoYXI7CiAgICAgICAgZm9yIChjb25zdCB3IG9mIHdpZHRocykgewogICAgICAgICAgY29uc3Qgd2lkdGggPSB4cmVmLmZldGNoSWZSZWYodyk7CiAgICAgICAgICBpZiAodHlwZW9mIHdpZHRoID09PSAibnVtYmVyIikgewogICAgICAgICAgICBnbHlwaHNXaWR0aHNbal0gPSB3aWR0aDsKICAgICAgICAgIH0KICAgICAgICAgIGorKzsKICAgICAgICB9CiAgICAgICAgY29uc3QgbWlzc2luZ1dpZHRoID0gZGVzY3JpcHRvci5nZXQoIk1pc3NpbmdXaWR0aCIpOwogICAgICAgIGRlZmF1bHRXaWR0aCA9IHR5cGVvZiBtaXNzaW5nV2lkdGggPT09ICJudW1iZXIiID8gbWlzc2luZ1dpZHRoIDogMDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBiYXNlRm9udE5hbWUgPSBkaWN0LmdldCgiQmFzZUZvbnQiKTsKICAgICAgICBpZiAoYmFzZUZvbnROYW1lIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgY29uc3QgbWV0cmljcyA9IHRoaXMuZ2V0QmFzZUZvbnRNZXRyaWNzKGJhc2VGb250TmFtZS5uYW1lKTsKICAgICAgICAgIGdseXBoc1dpZHRocyA9IHRoaXMuYnVpbGRDaGFyQ29kZVRvV2lkdGgobWV0cmljcy53aWR0aHMsIHByb3BlcnRpZXMpOwogICAgICAgICAgZGVmYXVsdFdpZHRoID0gbWV0cmljcy5kZWZhdWx0V2lkdGg7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBsZXQgaXNNb25vc3BhY2UgPSB0cnVlOwogICAgbGV0IGZpcnN0V2lkdGggPSBkZWZhdWx0V2lkdGg7CiAgICBmb3IgKGNvbnN0IGdseXBoIGluIGdseXBoc1dpZHRocykgewogICAgICBjb25zdCBnbHlwaFdpZHRoID0gZ2x5cGhzV2lkdGhzW2dseXBoXTsKICAgICAgaWYgKCFnbHlwaFdpZHRoKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFmaXJzdFdpZHRoKSB7CiAgICAgICAgZmlyc3RXaWR0aCA9IGdseXBoV2lkdGg7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGZpcnN0V2lkdGggIT09IGdseXBoV2lkdGgpIHsKICAgICAgICBpc01vbm9zcGFjZSA9IGZhbHNlOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBpZiAoaXNNb25vc3BhY2UpIHsKICAgICAgcHJvcGVydGllcy5mbGFncyB8PSBGb250RmxhZ3MuRml4ZWRQaXRjaDsKICAgIH0gZWxzZSB7CiAgICAgIHByb3BlcnRpZXMuZmxhZ3MgJj0gfkZvbnRGbGFncy5GaXhlZFBpdGNoOwogICAgfQogICAgcHJvcGVydGllcy5kZWZhdWx0V2lkdGggPSBkZWZhdWx0V2lkdGg7CiAgICBwcm9wZXJ0aWVzLndpZHRocyA9IGdseXBoc1dpZHRoczsKICAgIHByb3BlcnRpZXMuZGVmYXVsdFZNZXRyaWNzID0gZGVmYXVsdFZNZXRyaWNzOwogICAgcHJvcGVydGllcy52bWV0cmljcyA9IGdseXBoc1ZNZXRyaWNzOwogIH0KICBpc1NlcmlmRm9udChiYXNlRm9udE5hbWUpIHsKICAgIGNvbnN0IGZvbnROYW1lV29TdHlsZSA9IGJhc2VGb250TmFtZS5zcGxpdCgiLSIsIDEpWzBdOwogICAgcmV0dXJuIGZvbnROYW1lV29TdHlsZSBpbiBnZXRTZXJpZkZvbnRzKCkgfHwgL3NlcmlmL2dpLnRlc3QoZm9udE5hbWVXb1N0eWxlKTsKICB9CiAgZ2V0QmFzZUZvbnRNZXRyaWNzKG5hbWUpIHsKICAgIGxldCBkZWZhdWx0V2lkdGggPSAwOwogICAgbGV0IHdpZHRocyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBsZXQgbW9ub3NwYWNlID0gZmFsc2U7CiAgICBjb25zdCBzdGRGb250TWFwID0gZ2V0U3RkRm9udE1hcCgpOwogICAgbGV0IGxvb2t1cE5hbWUgPSBzdGRGb250TWFwW25hbWVdIHx8IG5hbWU7CiAgICBjb25zdCBNZXRyaWNzID0gZ2V0TWV0cmljcygpOwogICAgaWYgKCEobG9va3VwTmFtZSBpbiBNZXRyaWNzKSkgewogICAgICBsb29rdXBOYW1lID0gdGhpcy5pc1NlcmlmRm9udChuYW1lKSA/ICJUaW1lcy1Sb21hbiIgOiAiSGVsdmV0aWNhIjsKICAgIH0KICAgIGNvbnN0IGdseXBoV2lkdGhzID0gTWV0cmljc1tsb29rdXBOYW1lXTsKICAgIGlmICh0eXBlb2YgZ2x5cGhXaWR0aHMgPT09ICJudW1iZXIiKSB7CiAgICAgIGRlZmF1bHRXaWR0aCA9IGdseXBoV2lkdGhzOwogICAgICBtb25vc3BhY2UgPSB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgd2lkdGhzID0gZ2x5cGhXaWR0aHMoKTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIGRlZmF1bHRXaWR0aCwKICAgICAgbW9ub3NwYWNlLAogICAgICB3aWR0aHMKICAgIH07CiAgfQogIGJ1aWxkQ2hhckNvZGVUb1dpZHRoKHdpZHRoc0J5R2x5cGhOYW1lLCBwcm9wZXJ0aWVzKSB7CiAgICBjb25zdCB3aWR0aHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgY29uc3QgZGlmZmVyZW5jZXMgPSBwcm9wZXJ0aWVzLmRpZmZlcmVuY2VzOwogICAgY29uc3QgZW5jb2RpbmcgPSBwcm9wZXJ0aWVzLmRlZmF1bHRFbmNvZGluZzsKICAgIGZvciAobGV0IGNoYXJDb2RlID0gMDsgY2hhckNvZGUgPCAyNTY7IGNoYXJDb2RlKyspIHsKICAgICAgaWYgKGNoYXJDb2RlIGluIGRpZmZlcmVuY2VzICYmIHdpZHRoc0J5R2x5cGhOYW1lW2RpZmZlcmVuY2VzW2NoYXJDb2RlXV0pIHsKICAgICAgICB3aWR0aHNbY2hhckNvZGVdID0gd2lkdGhzQnlHbHlwaE5hbWVbZGlmZmVyZW5jZXNbY2hhckNvZGVdXTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoY2hhckNvZGUgaW4gZW5jb2RpbmcgJiYgd2lkdGhzQnlHbHlwaE5hbWVbZW5jb2RpbmdbY2hhckNvZGVdXSkgewogICAgICAgIHdpZHRoc1tjaGFyQ29kZV0gPSB3aWR0aHNCeUdseXBoTmFtZVtlbmNvZGluZ1tjaGFyQ29kZV1dOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gd2lkdGhzOwogIH0KICBwcmVFdmFsdWF0ZUZvbnQoZGljdCkgewogICAgY29uc3QgYmFzZURpY3QgPSBkaWN0OwogICAgbGV0IHR5cGUgPSBkaWN0LmdldCgiU3VidHlwZSIpOwogICAgaWYgKCEodHlwZSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiaW52YWxpZCBmb250IFN1YnR5cGUiKTsKICAgIH0KICAgIGxldCBjb21wb3NpdGUgPSBmYWxzZTsKICAgIGxldCBoYXNoOwogICAgaWYgKHR5cGUubmFtZSA9PT0gIlR5cGUwIikgewogICAgICBjb25zdCBkZiA9IGRpY3QuZ2V0KCJEZXNjZW5kYW50Rm9udHMiKTsKICAgICAgaWYgKCFkZikgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiRGVzY2VuZGFudCBmb250cyBhcmUgbm90IHNwZWNpZmllZCIpOwogICAgICB9CiAgICAgIGRpY3QgPSBBcnJheS5pc0FycmF5KGRmKSA/IHRoaXMueHJlZi5mZXRjaElmUmVmKGRmWzBdKSA6IGRmOwogICAgICBpZiAoIShkaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkRlc2NlbmRhbnQgZm9udCBpcyBub3QgYSBkaWN0aW9uYXJ5LiIpOwogICAgICB9CiAgICAgIHR5cGUgPSBkaWN0LmdldCgiU3VidHlwZSIpOwogICAgICBpZiAoISh0eXBlIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoImludmFsaWQgZm9udCBTdWJ0eXBlIik7CiAgICAgIH0KICAgICAgY29tcG9zaXRlID0gdHJ1ZTsKICAgIH0KICAgIGxldCBmaXJzdENoYXIgPSBkaWN0LmdldCgiRmlyc3RDaGFyIik7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoZmlyc3RDaGFyKSkgewogICAgICBmaXJzdENoYXIgPSAwOwogICAgfQogICAgbGV0IGxhc3RDaGFyID0gZGljdC5nZXQoIkxhc3RDaGFyIik7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIobGFzdENoYXIpKSB7CiAgICAgIGxhc3RDaGFyID0gY29tcG9zaXRlID8gMHhmZmZmIDogMHhmZjsKICAgIH0KICAgIGNvbnN0IGRlc2NyaXB0b3IgPSBkaWN0LmdldCgiRm9udERlc2NyaXB0b3IiKTsKICAgIGNvbnN0IHRvVW5pY29kZSA9IGRpY3QuZ2V0KCJUb1VuaWNvZGUiKSB8fCBiYXNlRGljdC5nZXQoIlRvVW5pY29kZSIpOwogICAgaWYgKGRlc2NyaXB0b3IpIHsKICAgICAgaGFzaCA9IG5ldyBNdXJtdXJIYXNoM182NCgpOwogICAgICBjb25zdCBlbmNvZGluZyA9IGJhc2VEaWN0LmdldFJhdygiRW5jb2RpbmciKTsKICAgICAgaWYgKGVuY29kaW5nIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIGhhc2gudXBkYXRlKGVuY29kaW5nLm5hbWUpOwogICAgICB9IGVsc2UgaWYgKGVuY29kaW5nIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgaGFzaC51cGRhdGUoZW5jb2RpbmcudG9TdHJpbmcoKSk7CiAgICAgIH0gZWxzZSBpZiAoZW5jb2RpbmcgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBlbmNvZGluZy5nZXRSYXdWYWx1ZXMoKSkgewogICAgICAgICAgaWYgKGVudHJ5IGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgICBoYXNoLnVwZGF0ZShlbnRyeS5uYW1lKTsKICAgICAgICAgIH0gZWxzZSBpZiAoZW50cnkgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICAgICAgaGFzaC51cGRhdGUoZW50cnkudG9TdHJpbmcoKSk7CiAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZW50cnkpKSB7CiAgICAgICAgICAgIGNvbnN0IGRpZmZMZW5ndGggPSBlbnRyeS5sZW5ndGgsCiAgICAgICAgICAgICAgZGlmZkJ1ZiA9IG5ldyBBcnJheShkaWZmTGVuZ3RoKTsKICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBkaWZmTGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICBjb25zdCBkaWZmRW50cnkgPSBlbnRyeVtqXTsKICAgICAgICAgICAgICBpZiAoZGlmZkVudHJ5IGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgICAgICAgZGlmZkJ1ZltqXSA9IGRpZmZFbnRyeS5uYW1lOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGRpZmZFbnRyeSA9PT0gIm51bWJlciIgfHwgZGlmZkVudHJ5IGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgICAgICBkaWZmQnVmW2pdID0gZGlmZkVudHJ5LnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGhhc2gudXBkYXRlKGRpZmZCdWYuam9pbigpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaGFzaC51cGRhdGUoYCR7Zmlyc3RDaGFyfS0ke2xhc3RDaGFyfWApOwogICAgICBpZiAodG9Vbmljb2RlIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgIGNvbnN0IHN0cmVhbSA9IHRvVW5pY29kZS5zdHIgfHwgdG9Vbmljb2RlOwogICAgICAgIGNvbnN0IHVpbnQ4YXJyYXkgPSBzdHJlYW0uYnVmZmVyID8gbmV3IFVpbnQ4QXJyYXkoc3RyZWFtLmJ1ZmZlci5idWZmZXIsIDAsIHN0cmVhbS5idWZmZXJMZW5ndGgpIDogbmV3IFVpbnQ4QXJyYXkoc3RyZWFtLmJ5dGVzLmJ1ZmZlciwgc3RyZWFtLnN0YXJ0LCBzdHJlYW0uZW5kIC0gc3RyZWFtLnN0YXJ0KTsKICAgICAgICBoYXNoLnVwZGF0ZSh1aW50OGFycmF5KTsKICAgICAgfSBlbHNlIGlmICh0b1VuaWNvZGUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgaGFzaC51cGRhdGUodG9Vbmljb2RlLm5hbWUpOwogICAgICB9CiAgICAgIGNvbnN0IHdpZHRocyA9IGRpY3QuZ2V0KCJXaWR0aHMiKSB8fCBiYXNlRGljdC5nZXQoIldpZHRocyIpOwogICAgICBpZiAoQXJyYXkuaXNBcnJheSh3aWR0aHMpKSB7CiAgICAgICAgY29uc3Qgd2lkdGhzQnVmID0gW107CiAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiB3aWR0aHMpIHsKICAgICAgICAgIGlmICh0eXBlb2YgZW50cnkgPT09ICJudW1iZXIiIHx8IGVudHJ5IGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgIHdpZHRoc0J1Zi5wdXNoKGVudHJ5LnRvU3RyaW5nKCkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBoYXNoLnVwZGF0ZSh3aWR0aHNCdWYuam9pbigpKTsKICAgICAgfQogICAgICBpZiAoY29tcG9zaXRlKSB7CiAgICAgICAgaGFzaC51cGRhdGUoImNvbXBvc2l0ZUZvbnQiKTsKICAgICAgICBjb25zdCBjb21wb3NpdGVXaWR0aHMgPSBkaWN0LmdldCgiVyIpIHx8IGJhc2VEaWN0LmdldCgiVyIpOwogICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvbXBvc2l0ZVdpZHRocykpIHsKICAgICAgICAgIGNvbnN0IHdpZHRoc0J1ZiA9IFtdOwogICAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBjb21wb3NpdGVXaWR0aHMpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBlbnRyeSA9PT0gIm51bWJlciIgfHwgZW50cnkgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICAgICAgICB3aWR0aHNCdWYucHVzaChlbnRyeS50b1N0cmluZygpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGVudHJ5KSkgewogICAgICAgICAgICAgIGNvbnN0IHN1YldpZHRoc0J1ZiA9IFtdOwogICAgICAgICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBlbnRyeSkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlbGVtZW50ID09PSAibnVtYmVyIiB8fCBlbGVtZW50IGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgICAgICAgIHN1YldpZHRoc0J1Zi5wdXNoKGVsZW1lbnQudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHdpZHRoc0J1Zi5wdXNoKGBbJHtzdWJXaWR0aHNCdWYuam9pbigpfV1gKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaGFzaC51cGRhdGUod2lkdGhzQnVmLmpvaW4oKSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGNpZFRvR2lkTWFwID0gZGljdC5nZXRSYXcoIkNJRFRvR0lETWFwIikgfHwgYmFzZURpY3QuZ2V0UmF3KCJDSURUb0dJRE1hcCIpOwogICAgICAgIGlmIChjaWRUb0dpZE1hcCBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgIGhhc2gudXBkYXRlKGNpZFRvR2lkTWFwLm5hbWUpOwogICAgICAgIH0gZWxzZSBpZiAoY2lkVG9HaWRNYXAgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICAgIGhhc2gudXBkYXRlKGNpZFRvR2lkTWFwLnRvU3RyaW5nKCkpOwogICAgICAgIH0gZWxzZSBpZiAoY2lkVG9HaWRNYXAgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgICAgICBoYXNoLnVwZGF0ZShjaWRUb0dpZE1hcC5wZWVrQnl0ZXMoKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICBkZXNjcmlwdG9yLAogICAgICBkaWN0LAogICAgICBiYXNlRGljdCwKICAgICAgY29tcG9zaXRlLAogICAgICB0eXBlOiB0eXBlLm5hbWUsCiAgICAgIGZpcnN0Q2hhciwKICAgICAgbGFzdENoYXIsCiAgICAgIHRvVW5pY29kZSwKICAgICAgaGFzaDogaGFzaCA/IGhhc2guaGV4ZGlnZXN0KCkgOiAiIgogICAgfTsKICB9CiAgYXN5bmMgdHJhbnNsYXRlRm9udCh7CiAgICBkZXNjcmlwdG9yLAogICAgZGljdCwKICAgIGJhc2VEaWN0LAogICAgY29tcG9zaXRlLAogICAgdHlwZSwKICAgIGZpcnN0Q2hhciwKICAgIGxhc3RDaGFyLAogICAgdG9Vbmljb2RlLAogICAgY3NzRm9udEluZm8KICB9KSB7CiAgICBjb25zdCBpc1R5cGUzRm9udCA9IHR5cGUgPT09ICJUeXBlMyI7CiAgICBpZiAoIWRlc2NyaXB0b3IpIHsKICAgICAgaWYgKGlzVHlwZTNGb250KSB7CiAgICAgICAgZGVzY3JpcHRvciA9IERpY3QuZW1wdHk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGV0IGJhc2VGb250TmFtZSA9IGRpY3QuZ2V0KCJCYXNlRm9udCIpOwogICAgICAgIGlmICghKGJhc2VGb250TmFtZSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkJhc2UgZm9udCBpcyBub3Qgc3BlY2lmaWVkIik7CiAgICAgICAgfQogICAgICAgIGJhc2VGb250TmFtZSA9IGJhc2VGb250TmFtZS5uYW1lLnJlcGxhY2VBbGwoL1ssX10vZywgIi0iKTsKICAgICAgICBjb25zdCBtZXRyaWNzID0gdGhpcy5nZXRCYXNlRm9udE1ldHJpY3MoYmFzZUZvbnROYW1lKTsKICAgICAgICBjb25zdCBmb250TmFtZVdvU3R5bGUgPSBiYXNlRm9udE5hbWUuc3BsaXQoIi0iLCAxKVswXTsKICAgICAgICBjb25zdCBmbGFncyA9ICh0aGlzLmlzU2VyaWZGb250KGZvbnROYW1lV29TdHlsZSkgPyBGb250RmxhZ3MuU2VyaWYgOiAwKSB8IChtZXRyaWNzLm1vbm9zcGFjZSA/IEZvbnRGbGFncy5GaXhlZFBpdGNoIDogMCkgfCAoZ2V0U3ltYm9sc0ZvbnRzKClbZm9udE5hbWVXb1N0eWxlXSA/IEZvbnRGbGFncy5TeW1ib2xpYyA6IEZvbnRGbGFncy5Ob25zeW1ib2xpYyk7CiAgICAgICAgY29uc3QgcHJvcGVydGllcyA9IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBuYW1lOiBiYXNlRm9udE5hbWUsCiAgICAgICAgICBsb2FkZWROYW1lOiBiYXNlRGljdC5sb2FkZWROYW1lLAogICAgICAgICAgc3lzdGVtRm9udEluZm86IG51bGwsCiAgICAgICAgICB3aWR0aHM6IG1ldHJpY3Mud2lkdGhzLAogICAgICAgICAgZGVmYXVsdFdpZHRoOiBtZXRyaWNzLmRlZmF1bHRXaWR0aCwKICAgICAgICAgIGlzU2ltdWxhdGVkRmxhZ3M6IHRydWUsCiAgICAgICAgICBmbGFncywKICAgICAgICAgIGZpcnN0Q2hhciwKICAgICAgICAgIGxhc3RDaGFyLAogICAgICAgICAgdG9Vbmljb2RlLAogICAgICAgICAgeEhlaWdodDogMCwKICAgICAgICAgIGNhcEhlaWdodDogMCwKICAgICAgICAgIGl0YWxpY0FuZ2xlOiAwLAogICAgICAgICAgaXNUeXBlM0ZvbnQKICAgICAgICB9OwogICAgICAgIGNvbnN0IHdpZHRocyA9IGRpY3QuZ2V0KCJXaWR0aHMiKTsKICAgICAgICBjb25zdCBzdGFuZGFyZEZvbnROYW1lID0gZ2V0U3RhbmRhcmRGb250TmFtZShiYXNlRm9udE5hbWUpOwogICAgICAgIGxldCBmaWxlID0gbnVsbDsKICAgICAgICBpZiAoc3RhbmRhcmRGb250TmFtZSkgewogICAgICAgICAgZmlsZSA9IGF3YWl0IHRoaXMuZmV0Y2hTdGFuZGFyZEZvbnREYXRhKHN0YW5kYXJkRm9udE5hbWUpOwogICAgICAgICAgcHJvcGVydGllcy5pc0ludGVybmFsRm9udCA9ICEhZmlsZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFwcm9wZXJ0aWVzLmlzSW50ZXJuYWxGb250ICYmIHRoaXMub3B0aW9ucy51c2VTeXN0ZW1Gb250cykgewogICAgICAgICAgcHJvcGVydGllcy5zeXN0ZW1Gb250SW5mbyA9IGdldEZvbnRTdWJzdGl0dXRpb24odGhpcy5zeXN0ZW1Gb250Q2FjaGUsIHRoaXMuaWRGYWN0b3J5LCB0aGlzLm9wdGlvbnMuc3RhbmRhcmRGb250RGF0YVVybCwgYmFzZUZvbnROYW1lLCBzdGFuZGFyZEZvbnROYW1lLCB0eXBlKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbmV3UHJvcGVydGllcyA9IGF3YWl0IHRoaXMuZXh0cmFjdERhdGFTdHJ1Y3R1cmVzKGRpY3QsIHByb3BlcnRpZXMpOwogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHdpZHRocykpIHsKICAgICAgICAgIGNvbnN0IGdseXBoV2lkdGhzID0gW107CiAgICAgICAgICBsZXQgaiA9IGZpcnN0Q2hhcjsKICAgICAgICAgIGZvciAoY29uc3QgdyBvZiB3aWR0aHMpIHsKICAgICAgICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZih3KTsKICAgICAgICAgICAgaWYgKHR5cGVvZiB3aWR0aCA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICBnbHlwaFdpZHRoc1tqXSA9IHdpZHRoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGorKzsKICAgICAgICAgIH0KICAgICAgICAgIG5ld1Byb3BlcnRpZXMud2lkdGhzID0gZ2x5cGhXaWR0aHM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5ld1Byb3BlcnRpZXMud2lkdGhzID0gdGhpcy5idWlsZENoYXJDb2RlVG9XaWR0aChtZXRyaWNzLndpZHRocywgbmV3UHJvcGVydGllcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgRm9udChiYXNlRm9udE5hbWUsIGZpbGUsIG5ld1Byb3BlcnRpZXMsIHRoaXMub3B0aW9ucyk7CiAgICAgIH0KICAgIH0KICAgIGxldCBmb250TmFtZSA9IGRlc2NyaXB0b3IuZ2V0KCJGb250TmFtZSIpOwogICAgbGV0IGJhc2VGb250ID0gZGljdC5nZXQoIkJhc2VGb250Iik7CiAgICBpZiAodHlwZW9mIGZvbnROYW1lID09PSAic3RyaW5nIikgewogICAgICBmb250TmFtZSA9IE5hbWUuZ2V0KGZvbnROYW1lKTsKICAgIH0KICAgIGlmICh0eXBlb2YgYmFzZUZvbnQgPT09ICJzdHJpbmciKSB7CiAgICAgIGJhc2VGb250ID0gTmFtZS5nZXQoYmFzZUZvbnQpOwogICAgfQogICAgY29uc3QgZm9udE5hbWVTdHIgPSBmb250TmFtZT8ubmFtZTsKICAgIGNvbnN0IGJhc2VGb250U3RyID0gYmFzZUZvbnQ/Lm5hbWU7CiAgICBpZiAoaXNUeXBlM0ZvbnQpIHsKICAgICAgaWYgKCFmb250TmFtZVN0cikgewogICAgICAgIGZvbnROYW1lID0gTmFtZS5nZXQodHlwZSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoZm9udE5hbWVTdHIgIT09IGJhc2VGb250U3RyKSB7CiAgICAgIGluZm8oYFRoZSBGb250RGVzY3JpcHRvcidzIEZvbnROYW1lIGlzICIke2ZvbnROYW1lU3RyfSIgYnV0IGAgKyBgc2hvdWxkIGJlIHRoZSBzYW1lIGFzIHRoZSBGb250J3MgQmFzZUZvbnQgIiR7YmFzZUZvbnRTdHJ9Ii5gKTsKICAgICAgaWYgKGZvbnROYW1lU3RyICYmIGJhc2VGb250U3RyICYmIChiYXNlRm9udFN0ci5zdGFydHNXaXRoKGZvbnROYW1lU3RyKSB8fCAhaXNLbm93bkZvbnROYW1lKGZvbnROYW1lU3RyKSAmJiBpc0tub3duRm9udE5hbWUoYmFzZUZvbnRTdHIpKSkgewogICAgICAgIGZvbnROYW1lID0gbnVsbDsKICAgICAgfQogICAgICBmb250TmFtZSB8fD0gYmFzZUZvbnQ7CiAgICB9CiAgICBpZiAoIShmb250TmFtZSBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiaW52YWxpZCBmb250IG5hbWUiKTsKICAgIH0KICAgIGxldCBmb250RmlsZSwgc3VidHlwZSwgbGVuZ3RoMSwgbGVuZ3RoMiwgbGVuZ3RoMzsKICAgIHRyeSB7CiAgICAgIGZvbnRGaWxlID0gZGVzY3JpcHRvci5nZXQoIkZvbnRGaWxlIiwgIkZvbnRGaWxlMiIsICJGb250RmlsZTMiKTsKICAgICAgaWYgKGZvbnRGaWxlKSB7CiAgICAgICAgaWYgKCEoZm9udEZpbGUgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSkgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJGb250RmlsZSBzaG91bGQgYmUgYSBzdHJlYW0iKTsKICAgICAgICB9IGVsc2UgaWYgKGZvbnRGaWxlLmlzRW1wdHkpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiRm9udEZpbGUgaXMgZW1wdHkiKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmICghdGhpcy5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oYHRyYW5zbGF0ZUZvbnQgLSBmZXRjaGluZyAiJHtmb250TmFtZS5uYW1lfSIgZm9udCBmaWxlOiAiJHtleH0iLmApOwogICAgICBmb250RmlsZSA9IG51bGw7CiAgICB9CiAgICBsZXQgaXNJbnRlcm5hbEZvbnQgPSBmYWxzZTsKICAgIGxldCBnbHlwaFNjYWxlRmFjdG9ycyA9IG51bGw7CiAgICBsZXQgc3lzdGVtRm9udEluZm8gPSBudWxsOwogICAgaWYgKGZvbnRGaWxlKSB7CiAgICAgIGlmIChmb250RmlsZS5kaWN0KSB7CiAgICAgICAgY29uc3Qgc3VidHlwZUVudHJ5ID0gZm9udEZpbGUuZGljdC5nZXQoIlN1YnR5cGUiKTsKICAgICAgICBpZiAoc3VidHlwZUVudHJ5IGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgc3VidHlwZSA9IHN1YnR5cGVFbnRyeS5uYW1lOwogICAgICAgIH0KICAgICAgICBsZW5ndGgxID0gZm9udEZpbGUuZGljdC5nZXQoIkxlbmd0aDEiKTsKICAgICAgICBsZW5ndGgyID0gZm9udEZpbGUuZGljdC5nZXQoIkxlbmd0aDIiKTsKICAgICAgICBsZW5ndGgzID0gZm9udEZpbGUuZGljdC5nZXQoIkxlbmd0aDMiKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChjc3NGb250SW5mbykgewogICAgICBjb25zdCBzdGFuZGFyZEZvbnROYW1lID0gZ2V0WGZhRm9udE5hbWUoZm9udE5hbWUubmFtZSk7CiAgICAgIGlmIChzdGFuZGFyZEZvbnROYW1lKSB7CiAgICAgICAgY3NzRm9udEluZm8uZm9udEZhbWlseSA9IGAke2Nzc0ZvbnRJbmZvLmZvbnRGYW1pbHl9LVBkZkpTLVhGQWA7CiAgICAgICAgY3NzRm9udEluZm8ubWV0cmljcyA9IHN0YW5kYXJkRm9udE5hbWUubWV0cmljcyB8fCBudWxsOwogICAgICAgIGdseXBoU2NhbGVGYWN0b3JzID0gc3RhbmRhcmRGb250TmFtZS5mYWN0b3JzIHx8IG51bGw7CiAgICAgICAgZm9udEZpbGUgPSBhd2FpdCB0aGlzLmZldGNoU3RhbmRhcmRGb250RGF0YShzdGFuZGFyZEZvbnROYW1lLm5hbWUpOwogICAgICAgIGlzSW50ZXJuYWxGb250ID0gISFmb250RmlsZTsKICAgICAgICBiYXNlRGljdCA9IGRpY3QgPSBnZXRYZmFGb250RGljdChmb250TmFtZS5uYW1lKTsKICAgICAgICBjb21wb3NpdGUgPSB0cnVlOwogICAgICB9CiAgICB9IGVsc2UgaWYgKCFpc1R5cGUzRm9udCkgewogICAgICBjb25zdCBzdGFuZGFyZEZvbnROYW1lID0gZ2V0U3RhbmRhcmRGb250TmFtZShmb250TmFtZS5uYW1lKTsKICAgICAgaWYgKHN0YW5kYXJkRm9udE5hbWUpIHsKICAgICAgICBmb250RmlsZSA9IGF3YWl0IHRoaXMuZmV0Y2hTdGFuZGFyZEZvbnREYXRhKHN0YW5kYXJkRm9udE5hbWUpOwogICAgICAgIGlzSW50ZXJuYWxGb250ID0gISFmb250RmlsZTsKICAgICAgfQogICAgICBpZiAoIWlzSW50ZXJuYWxGb250ICYmIHRoaXMub3B0aW9ucy51c2VTeXN0ZW1Gb250cykgewogICAgICAgIHN5c3RlbUZvbnRJbmZvID0gZ2V0Rm9udFN1YnN0aXR1dGlvbih0aGlzLnN5c3RlbUZvbnRDYWNoZSwgdGhpcy5pZEZhY3RvcnksIHRoaXMub3B0aW9ucy5zdGFuZGFyZEZvbnREYXRhVXJsLCBmb250TmFtZS5uYW1lLCBzdGFuZGFyZEZvbnROYW1lLCB0eXBlKTsKICAgICAgfQogICAgfQogICAgY29uc3QgZm9udE1hdHJpeCA9IGxvb2t1cE1hdHJpeChkaWN0LmdldEFycmF5KCJGb250TWF0cml4IiksIEZPTlRfSURFTlRJVFlfTUFUUklYKTsKICAgIGNvbnN0IGJib3ggPSBsb29rdXBOb3JtYWxSZWN0KGRlc2NyaXB0b3IuZ2V0QXJyYXkoIkZvbnRCQm94IikgfHwgZGljdC5nZXRBcnJheSgiRm9udEJCb3giKSwgaXNUeXBlM0ZvbnQgPyBbMCwgMCwgMCwgMF0gOiB1bmRlZmluZWQpOwogICAgbGV0IGFzY2VudCA9IGRlc2NyaXB0b3IuZ2V0KCJBc2NlbnQiKTsKICAgIGlmICh0eXBlb2YgYXNjZW50ICE9PSAibnVtYmVyIikgewogICAgICBhc2NlbnQgPSB1bmRlZmluZWQ7CiAgICB9CiAgICBsZXQgZGVzY2VudCA9IGRlc2NyaXB0b3IuZ2V0KCJEZXNjZW50Iik7CiAgICBpZiAodHlwZW9mIGRlc2NlbnQgIT09ICJudW1iZXIiKSB7CiAgICAgIGRlc2NlbnQgPSB1bmRlZmluZWQ7CiAgICB9CiAgICBsZXQgeEhlaWdodCA9IGRlc2NyaXB0b3IuZ2V0KCJYSGVpZ2h0Iik7CiAgICBpZiAodHlwZW9mIHhIZWlnaHQgIT09ICJudW1iZXIiKSB7CiAgICAgIHhIZWlnaHQgPSAwOwogICAgfQogICAgbGV0IGNhcEhlaWdodCA9IGRlc2NyaXB0b3IuZ2V0KCJDYXBIZWlnaHQiKTsKICAgIGlmICh0eXBlb2YgY2FwSGVpZ2h0ICE9PSAibnVtYmVyIikgewogICAgICBjYXBIZWlnaHQgPSAwOwogICAgfQogICAgbGV0IGZsYWdzID0gZGVzY3JpcHRvci5nZXQoIkZsYWdzIik7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoZmxhZ3MpKSB7CiAgICAgIGZsYWdzID0gMDsKICAgIH0KICAgIGxldCBpdGFsaWNBbmdsZSA9IGRlc2NyaXB0b3IuZ2V0KCJJdGFsaWNBbmdsZSIpOwogICAgaWYgKHR5cGVvZiBpdGFsaWNBbmdsZSAhPT0gIm51bWJlciIpIHsKICAgICAgaXRhbGljQW5nbGUgPSAwOwogICAgfQogICAgY29uc3QgcHJvcGVydGllcyA9IHsKICAgICAgdHlwZSwKICAgICAgbmFtZTogZm9udE5hbWUubmFtZSwKICAgICAgc3VidHlwZSwKICAgICAgZmlsZTogZm9udEZpbGUsCiAgICAgIGxlbmd0aDEsCiAgICAgIGxlbmd0aDIsCiAgICAgIGxlbmd0aDMsCiAgICAgIGlzSW50ZXJuYWxGb250LAogICAgICBsb2FkZWROYW1lOiBiYXNlRGljdC5sb2FkZWROYW1lLAogICAgICBjb21wb3NpdGUsCiAgICAgIGZpeGVkUGl0Y2g6IGZhbHNlLAogICAgICBmb250TWF0cml4LAogICAgICBmaXJzdENoYXIsCiAgICAgIGxhc3RDaGFyLAogICAgICB0b1VuaWNvZGUsCiAgICAgIGJib3gsCiAgICAgIGFzY2VudCwKICAgICAgZGVzY2VudCwKICAgICAgeEhlaWdodCwKICAgICAgY2FwSGVpZ2h0LAogICAgICBmbGFncywKICAgICAgaXRhbGljQW5nbGUsCiAgICAgIGlzVHlwZTNGb250LAogICAgICBjc3NGb250SW5mbywKICAgICAgc2NhbGVGYWN0b3JzOiBnbHlwaFNjYWxlRmFjdG9ycywKICAgICAgc3lzdGVtRm9udEluZm8KICAgIH07CiAgICBpZiAoY29tcG9zaXRlKSB7CiAgICAgIGNvbnN0IGNpZEVuY29kaW5nID0gYmFzZURpY3QuZ2V0KCJFbmNvZGluZyIpOwogICAgICBpZiAoY2lkRW5jb2RpbmcgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgcHJvcGVydGllcy5jaWRFbmNvZGluZyA9IGNpZEVuY29kaW5nLm5hbWU7CiAgICAgIH0KICAgICAgY29uc3QgY01hcCA9IGF3YWl0IENNYXBGYWN0b3J5LmNyZWF0ZSh7CiAgICAgICAgZW5jb2Rpbmc6IGNpZEVuY29kaW5nLAogICAgICAgIGZldGNoQnVpbHRJbkNNYXA6IHRoaXMuX2ZldGNoQnVpbHRJbkNNYXBCb3VuZCwKICAgICAgICB1c2VDTWFwOiBudWxsCiAgICAgIH0pOwogICAgICBwcm9wZXJ0aWVzLmNNYXAgPSBjTWFwOwogICAgICBwcm9wZXJ0aWVzLnZlcnRpY2FsID0gcHJvcGVydGllcy5jTWFwLnZlcnRpY2FsOwogICAgfQogICAgY29uc3QgbmV3UHJvcGVydGllcyA9IGF3YWl0IHRoaXMuZXh0cmFjdERhdGFTdHJ1Y3R1cmVzKGRpY3QsIHByb3BlcnRpZXMpOwogICAgdGhpcy5leHRyYWN0V2lkdGhzKGRpY3QsIGRlc2NyaXB0b3IsIG5ld1Byb3BlcnRpZXMpOwogICAgcmV0dXJuIG5ldyBGb250KGZvbnROYW1lLm5hbWUsIGZvbnRGaWxlLCBuZXdQcm9wZXJ0aWVzLCB0aGlzLm9wdGlvbnMpOwogIH0KICBzdGF0aWMgYnVpbGRGb250UGF0aHMoZm9udCwgZ2x5cGhzLCBoYW5kbGVyLCBldmFsdWF0b3JPcHRpb25zKSB7CiAgICBmdW5jdGlvbiBidWlsZFBhdGgoZm9udENoYXIpIHsKICAgICAgY29uc3QgZ2x5cGhOYW1lID0gYCR7Zm9udC5sb2FkZWROYW1lfV9wYXRoXyR7Zm9udENoYXJ9YDsKICAgICAgdHJ5IHsKICAgICAgICBpZiAoZm9udC5yZW5kZXJlci5oYXNCdWlsdFBhdGgoZm9udENoYXIpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGhhbmRsZXIuc2VuZCgiY29tbW9ub2JqIiwgW2dseXBoTmFtZSwgIkZvbnRQYXRoIiwgZm9udC5yZW5kZXJlci5nZXRQYXRoSnMoZm9udENoYXIpXSk7CiAgICAgIH0gY2F0Y2ggKHJlYXNvbikgewogICAgICAgIGlmIChldmFsdWF0b3JPcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgICAgd2FybihgYnVpbGRGb250UGF0aHMgLSBpZ25vcmluZyAke2dseXBoTmFtZX0gZ2x5cGg6ICIke3JlYXNvbn0iLmApOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aHJvdyByZWFzb247CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3QgZ2x5cGggb2YgZ2x5cGhzKSB7CiAgICAgIGJ1aWxkUGF0aChnbHlwaC5mb250Q2hhcik7CiAgICAgIGNvbnN0IGFjY2VudCA9IGdseXBoLmFjY2VudDsKICAgICAgaWYgKGFjY2VudD8uZm9udENoYXIpIHsKICAgICAgICBidWlsZFBhdGgoYWNjZW50LmZvbnRDaGFyKTsKICAgICAgfQogICAgfQogIH0KICBzdGF0aWMgZ2V0IGZhbGxiYWNrRm9udERpY3QoKSB7CiAgICBjb25zdCBkaWN0ID0gbmV3IERpY3QoKTsKICAgIGRpY3Quc2V0KCJCYXNlRm9udCIsIE5hbWUuZ2V0KCJIZWx2ZXRpY2EiKSk7CiAgICBkaWN0LnNldCgiVHlwZSIsIE5hbWUuZ2V0KCJGYWxsYmFja1R5cGUiKSk7CiAgICBkaWN0LnNldCgiU3VidHlwZSIsIE5hbWUuZ2V0KCJGYWxsYmFja1R5cGUiKSk7CiAgICBkaWN0LnNldCgiRW5jb2RpbmciLCBOYW1lLmdldCgiV2luQW5zaUVuY29kaW5nIikpOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZmFsbGJhY2tGb250RGljdCIsIGRpY3QpOwogIH0KfQpjbGFzcyBUcmFuc2xhdGVkRm9udCB7CiAgI3NlbnQgPSBmYWxzZTsKICAjdHlwZTNMb2FkZWQgPSBudWxsOwogIGNvbnN0cnVjdG9yKHsKICAgIGxvYWRlZE5hbWUsCiAgICBmb250LAogICAgZGljdAogIH0pIHsKICAgIHRoaXMubG9hZGVkTmFtZSA9IGxvYWRlZE5hbWU7CiAgICB0aGlzLmZvbnQgPSBmb250OwogICAgdGhpcy5kaWN0ID0gZGljdDsKICAgIHRoaXMudHlwZTNEZXBlbmRlbmNpZXMgPSBmb250LmlzVHlwZTNGb250ID8gbmV3IFNldCgpIDogbnVsbDsKICB9CiAgc2VuZChoYW5kbGVyKSB7CiAgICBpZiAodGhpcy4jc2VudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLiNzZW50ID0gdHJ1ZTsKICAgIGhhbmRsZXIuc2VuZCgiY29tbW9ub2JqIiwgW3RoaXMubG9hZGVkTmFtZSwgIkZvbnQiLCB0aGlzLmZvbnQuZXhwb3J0RGF0YSgpXSk7CiAgfQogIGZhbGxiYWNrKGhhbmRsZXIsIGV2YWx1YXRvck9wdGlvbnMpIHsKICAgIGlmICghdGhpcy5mb250LmRhdGEpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5mb250LmRpc2FibGVGb250RmFjZSA9IHRydWU7CiAgICBQYXJ0aWFsRXZhbHVhdG9yLmJ1aWxkRm9udFBhdGhzKHRoaXMuZm9udCwgdGhpcy5mb250LmdseXBoQ2FjaGVWYWx1ZXMsIGhhbmRsZXIsIGV2YWx1YXRvck9wdGlvbnMpOwogIH0KICBsb2FkVHlwZTNEYXRhKGV2YWx1YXRvciwgcmVzb3VyY2VzLCB0YXNrKSB7CiAgICBpZiAodGhpcy4jdHlwZTNMb2FkZWQpIHsKICAgICAgcmV0dXJuIHRoaXMuI3R5cGUzTG9hZGVkOwogICAgfQogICAgY29uc3QgewogICAgICBmb250LAogICAgICB0eXBlM0RlcGVuZGVuY2llcwogICAgfSA9IHRoaXM7CiAgICBhc3NlcnQoZm9udC5pc1R5cGUzRm9udCwgIk11c3QgYmUgYSBUeXBlMyBmb250LiIpOwogICAgY29uc3QgdHlwZTNFdmFsdWF0b3IgPSBldmFsdWF0b3IuY2xvbmUoewogICAgICBpZ25vcmVFcnJvcnM6IGZhbHNlCiAgICB9KTsKICAgIGNvbnN0IHR5cGUzRm9udFJlZnMgPSBuZXcgUmVmU2V0KGV2YWx1YXRvci50eXBlM0ZvbnRSZWZzKTsKICAgIGlmICh0aGlzLmRpY3Qub2JqSWQgJiYgIXR5cGUzRm9udFJlZnMuaGFzKHRoaXMuZGljdC5vYmpJZCkpIHsKICAgICAgdHlwZTNGb250UmVmcy5wdXQodGhpcy5kaWN0Lm9iaklkKTsKICAgIH0KICAgIHR5cGUzRXZhbHVhdG9yLnR5cGUzRm9udFJlZnMgPSB0eXBlM0ZvbnRSZWZzOwogICAgbGV0IGxvYWRDaGFyUHJvY3NQcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICBjb25zdCBjaGFyUHJvY3MgPSB0aGlzLmRpY3QuZ2V0KCJDaGFyUHJvY3MiKTsKICAgIGNvbnN0IGZvbnRSZXNvdXJjZXMgPSB0aGlzLmRpY3QuZ2V0KCJSZXNvdXJjZXMiKSB8fCByZXNvdXJjZXM7CiAgICBjb25zdCBjaGFyUHJvY09wZXJhdG9yTGlzdCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBjb25zdCBbeDAsIHkwLCB4MSwgeTFdID0gZm9udC5iYm94LAogICAgICB3aWR0aCA9IHgxIC0geDAsCiAgICAgIGhlaWdodCA9IHkxIC0geTA7CiAgICBjb25zdCBmb250QkJveFNpemUgPSBNYXRoLmh5cG90KHdpZHRoLCBoZWlnaHQpOwogICAgZm9yIChjb25zdCBrZXkgb2YgY2hhclByb2NzLmdldEtleXMoKSkgewogICAgICBsb2FkQ2hhclByb2NzUHJvbWlzZSA9IGxvYWRDaGFyUHJvY3NQcm9taXNlLnRoZW4oKCkgPT4gewogICAgICAgIGNvbnN0IGdseXBoU3RyZWFtID0gY2hhclByb2NzLmdldChrZXkpOwogICAgICAgIGNvbnN0IG9wZXJhdG9yTGlzdCA9IG5ldyBPcGVyYXRvckxpc3QoKTsKICAgICAgICByZXR1cm4gdHlwZTNFdmFsdWF0b3IuZ2V0T3BlcmF0b3JMaXN0KHsKICAgICAgICAgIHN0cmVhbTogZ2x5cGhTdHJlYW0sCiAgICAgICAgICB0YXNrLAogICAgICAgICAgcmVzb3VyY2VzOiBmb250UmVzb3VyY2VzLAogICAgICAgICAgb3BlcmF0b3JMaXN0CiAgICAgICAgfSkudGhlbigoKSA9PiB7CiAgICAgICAgICBzd2l0Y2ggKG9wZXJhdG9yTGlzdC5mbkFycmF5WzBdKSB7CiAgICAgICAgICAgIGNhc2UgT1BTLnNldENoYXJXaWR0aEFuZEJvdW5kczoKICAgICAgICAgICAgICB0aGlzLiNyZW1vdmVUeXBlM0NvbG9yT3BlcmF0b3JzKG9wZXJhdG9yTGlzdCwgZm9udEJCb3hTaXplKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBPUFMuc2V0Q2hhcldpZHRoOgogICAgICAgICAgICAgIGlmICghZm9udEJCb3hTaXplKSB7CiAgICAgICAgICAgICAgICB0aGlzLiNndWVzc1R5cGUzRm9udEJCb3gob3BlcmF0b3JMaXN0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBjaGFyUHJvY09wZXJhdG9yTGlzdFtrZXldID0gb3BlcmF0b3JMaXN0LmdldElSKCk7CiAgICAgICAgICBmb3IgKGNvbnN0IGRlcGVuZGVuY3kgb2Ygb3BlcmF0b3JMaXN0LmRlcGVuZGVuY2llcykgewogICAgICAgICAgICB0eXBlM0RlcGVuZGVuY2llcy5hZGQoZGVwZW5kZW5jeSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgd2FybihgVHlwZTMgZm9udCByZXNvdXJjZSAiJHtrZXl9IiBpcyBub3QgYXZhaWxhYmxlLmApOwogICAgICAgICAgY29uc3QgZHVtbXlPcGVyYXRvckxpc3QgPSBuZXcgT3BlcmF0b3JMaXN0KCk7CiAgICAgICAgICBjaGFyUHJvY09wZXJhdG9yTGlzdFtrZXldID0gZHVtbXlPcGVyYXRvckxpc3QuZ2V0SVIoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICB0aGlzLiN0eXBlM0xvYWRlZCA9IGxvYWRDaGFyUHJvY3NQcm9taXNlLnRoZW4oKCkgPT4gewogICAgICBmb250LmNoYXJQcm9jT3BlcmF0b3JMaXN0ID0gY2hhclByb2NPcGVyYXRvckxpc3Q7CiAgICAgIGlmICh0aGlzLl9iYm94KSB7CiAgICAgICAgZm9udC5pc0NoYXJCQm94ID0gdHJ1ZTsKICAgICAgICBmb250LmJib3ggPSB0aGlzLl9iYm94OwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiB0aGlzLiN0eXBlM0xvYWRlZDsKICB9CiAgI3JlbW92ZVR5cGUzQ29sb3JPcGVyYXRvcnMob3BlcmF0b3JMaXN0LCBmb250QkJveFNpemUgPSBOYU4pIHsKICAgIGNvbnN0IGNoYXJCQm94ID0gVXRpbC5ub3JtYWxpemVSZWN0KG9wZXJhdG9yTGlzdC5hcmdzQXJyYXlbMF0uc2xpY2UoMikpLAogICAgICB3aWR0aCA9IGNoYXJCQm94WzJdIC0gY2hhckJCb3hbMF0sCiAgICAgIGhlaWdodCA9IGNoYXJCQm94WzNdIC0gY2hhckJCb3hbMV07CiAgICBjb25zdCBjaGFyQkJveFNpemUgPSBNYXRoLmh5cG90KHdpZHRoLCBoZWlnaHQpOwogICAgaWYgKHdpZHRoID09PSAwIHx8IGhlaWdodCA9PT0gMCkgewogICAgICBvcGVyYXRvckxpc3QuZm5BcnJheS5zcGxpY2UoMCwgMSk7CiAgICAgIG9wZXJhdG9yTGlzdC5hcmdzQXJyYXkuc3BsaWNlKDAsIDEpOwogICAgfSBlbHNlIGlmIChmb250QkJveFNpemUgPT09IDAgfHwgTWF0aC5yb3VuZChjaGFyQkJveFNpemUgLyBmb250QkJveFNpemUpID49IDEwKSB7CiAgICAgIHRoaXMuX2Jib3ggPz89IFtJbmZpbml0eSwgSW5maW5pdHksIC1JbmZpbml0eSwgLUluZmluaXR5XTsKICAgICAgVXRpbC5yZWN0Qm91bmRpbmdCb3goLi4uY2hhckJCb3gsIHRoaXMuX2Jib3gpOwogICAgfQogICAgbGV0IGkgPSAwLAogICAgICBpaSA9IG9wZXJhdG9yTGlzdC5sZW5ndGg7CiAgICB3aGlsZSAoaSA8IGlpKSB7CiAgICAgIHN3aXRjaCAob3BlcmF0b3JMaXN0LmZuQXJyYXlbaV0pIHsKICAgICAgICBjYXNlIE9QUy5zZXRDaGFyV2lkdGhBbmRCb3VuZHM6CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIE9QUy5zZXRTdHJva2VDb2xvclNwYWNlOgogICAgICAgIGNhc2UgT1BTLnNldEZpbGxDb2xvclNwYWNlOgogICAgICAgIGNhc2UgT1BTLnNldFN0cm9rZUNvbG9yOgogICAgICAgIGNhc2UgT1BTLnNldFN0cm9rZUNvbG9yTjoKICAgICAgICBjYXNlIE9QUy5zZXRGaWxsQ29sb3I6CiAgICAgICAgY2FzZSBPUFMuc2V0RmlsbENvbG9yTjoKICAgICAgICBjYXNlIE9QUy5zZXRTdHJva2VHcmF5OgogICAgICAgIGNhc2UgT1BTLnNldEZpbGxHcmF5OgogICAgICAgIGNhc2UgT1BTLnNldFN0cm9rZVJHQkNvbG9yOgogICAgICAgIGNhc2UgT1BTLnNldEZpbGxSR0JDb2xvcjoKICAgICAgICBjYXNlIE9QUy5zZXRTdHJva2VDTVlLQ29sb3I6CiAgICAgICAgY2FzZSBPUFMuc2V0RmlsbENNWUtDb2xvcjoKICAgICAgICBjYXNlIE9QUy5zaGFkaW5nRmlsbDoKICAgICAgICBjYXNlIE9QUy5zZXRSZW5kZXJpbmdJbnRlbnQ6CiAgICAgICAgICBvcGVyYXRvckxpc3QuZm5BcnJheS5zcGxpY2UoaSwgMSk7CiAgICAgICAgICBvcGVyYXRvckxpc3QuYXJnc0FycmF5LnNwbGljZShpLCAxKTsKICAgICAgICAgIGlpLS07CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICBjYXNlIE9QUy5zZXRHU3RhdGU6CiAgICAgICAgICBjb25zdCBbZ1N0YXRlT2JqXSA9IG9wZXJhdG9yTGlzdC5hcmdzQXJyYXlbaV07CiAgICAgICAgICBsZXQgaiA9IDAsCiAgICAgICAgICAgIGpqID0gZ1N0YXRlT2JqLmxlbmd0aDsKICAgICAgICAgIHdoaWxlIChqIDwgamopIHsKICAgICAgICAgICAgY29uc3QgW2dTdGF0ZUtleV0gPSBnU3RhdGVPYmpbal07CiAgICAgICAgICAgIHN3aXRjaCAoZ1N0YXRlS2V5KSB7CiAgICAgICAgICAgICAgY2FzZSAiVFIiOgogICAgICAgICAgICAgIGNhc2UgIlRSMiI6CiAgICAgICAgICAgICAgY2FzZSAiSFQiOgogICAgICAgICAgICAgIGNhc2UgIkJHIjoKICAgICAgICAgICAgICBjYXNlICJCRzIiOgogICAgICAgICAgICAgIGNhc2UgIlVDUiI6CiAgICAgICAgICAgICAgY2FzZSAiVUNSMiI6CiAgICAgICAgICAgICAgICBnU3RhdGVPYmouc3BsaWNlKGosIDEpOwogICAgICAgICAgICAgICAgamotLTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGorKzsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGkrKzsKICAgIH0KICB9CiAgI2d1ZXNzVHlwZTNGb250QkJveChvcGVyYXRvckxpc3QpIHsKICAgIGxldCBpID0gMTsKICAgIGNvbnN0IGlpID0gb3BlcmF0b3JMaXN0Lmxlbmd0aDsKICAgIHdoaWxlIChpIDwgaWkpIHsKICAgICAgc3dpdGNoIChvcGVyYXRvckxpc3QuZm5BcnJheVtpXSkgewogICAgICAgIGNhc2UgT1BTLmNvbnN0cnVjdFBhdGg6CiAgICAgICAgICBjb25zdCBtaW5NYXggPSBvcGVyYXRvckxpc3QuYXJnc0FycmF5W2ldWzJdOwogICAgICAgICAgdGhpcy5fYmJveCA/Pz0gW0luZmluaXR5LCBJbmZpbml0eSwgLUluZmluaXR5LCAtSW5maW5pdHldOwogICAgICAgICAgVXRpbC5yZWN0Qm91bmRpbmdCb3goLi4ubWluTWF4LCB0aGlzLl9iYm94KTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGkrKzsKICAgIH0KICB9Cn0KY2xhc3MgU3RhdGVNYW5hZ2VyIHsKICBjb25zdHJ1Y3Rvcihpbml0aWFsU3RhdGUgPSBuZXcgRXZhbFN0YXRlKCkpIHsKICAgIHRoaXMuc3RhdGUgPSBpbml0aWFsU3RhdGU7CiAgICB0aGlzLnN0YXRlU3RhY2sgPSBbXTsKICB9CiAgc2F2ZSgpIHsKICAgIGNvbnN0IG9sZCA9IHRoaXMuc3RhdGU7CiAgICB0aGlzLnN0YXRlU3RhY2sucHVzaCh0aGlzLnN0YXRlKTsKICAgIHRoaXMuc3RhdGUgPSBvbGQuY2xvbmUoKTsKICB9CiAgcmVzdG9yZSgpIHsKICAgIGNvbnN0IHByZXYgPSB0aGlzLnN0YXRlU3RhY2sucG9wKCk7CiAgICBpZiAocHJldikgewogICAgICB0aGlzLnN0YXRlID0gcHJldjsKICAgIH0KICB9CiAgdHJhbnNmb3JtKGFyZ3MpIHsKICAgIHRoaXMuc3RhdGUuY3RtID0gVXRpbC50cmFuc2Zvcm0odGhpcy5zdGF0ZS5jdG0sIGFyZ3MpOwogIH0KfQpjbGFzcyBUZXh0U3RhdGUgewogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5jdG0gPSBuZXcgRmxvYXQzMkFycmF5KElERU5USVRZX01BVFJJWCk7CiAgICB0aGlzLmZvbnROYW1lID0gbnVsbDsKICAgIHRoaXMuZm9udFNpemUgPSAwOwogICAgdGhpcy5sb2FkZWROYW1lID0gbnVsbDsKICAgIHRoaXMuZm9udCA9IG51bGw7CiAgICB0aGlzLmZvbnRNYXRyaXggPSBGT05UX0lERU5USVRZX01BVFJJWDsKICAgIHRoaXMudGV4dE1hdHJpeCA9IElERU5USVRZX01BVFJJWC5zbGljZSgpOwogICAgdGhpcy50ZXh0TGluZU1hdHJpeCA9IElERU5USVRZX01BVFJJWC5zbGljZSgpOwogICAgdGhpcy5jaGFyU3BhY2luZyA9IDA7CiAgICB0aGlzLndvcmRTcGFjaW5nID0gMDsKICAgIHRoaXMubGVhZGluZyA9IDA7CiAgICB0aGlzLnRleHRIU2NhbGUgPSAxOwogICAgdGhpcy50ZXh0UmlzZSA9IDA7CiAgfQogIHNldFRleHRNYXRyaXgoYSwgYiwgYywgZCwgZSwgZikgewogICAgY29uc3QgbSA9IHRoaXMudGV4dE1hdHJpeDsKICAgIG1bMF0gPSBhOwogICAgbVsxXSA9IGI7CiAgICBtWzJdID0gYzsKICAgIG1bM10gPSBkOwogICAgbVs0XSA9IGU7CiAgICBtWzVdID0gZjsKICB9CiAgc2V0VGV4dExpbmVNYXRyaXgoYSwgYiwgYywgZCwgZSwgZikgewogICAgY29uc3QgbSA9IHRoaXMudGV4dExpbmVNYXRyaXg7CiAgICBtWzBdID0gYTsKICAgIG1bMV0gPSBiOwogICAgbVsyXSA9IGM7CiAgICBtWzNdID0gZDsKICAgIG1bNF0gPSBlOwogICAgbVs1XSA9IGY7CiAgfQogIHRyYW5zbGF0ZVRleHRNYXRyaXgoeCwgeSkgewogICAgY29uc3QgbSA9IHRoaXMudGV4dE1hdHJpeDsKICAgIG1bNF0gPSBtWzBdICogeCArIG1bMl0gKiB5ICsgbVs0XTsKICAgIG1bNV0gPSBtWzFdICogeCArIG1bM10gKiB5ICsgbVs1XTsKICB9CiAgdHJhbnNsYXRlVGV4dExpbmVNYXRyaXgoeCwgeSkgewogICAgY29uc3QgbSA9IHRoaXMudGV4dExpbmVNYXRyaXg7CiAgICBtWzRdID0gbVswXSAqIHggKyBtWzJdICogeSArIG1bNF07CiAgICBtWzVdID0gbVsxXSAqIHggKyBtWzNdICogeSArIG1bNV07CiAgfQogIGNhcnJpYWdlUmV0dXJuKCkgewogICAgdGhpcy50cmFuc2xhdGVUZXh0TGluZU1hdHJpeCgwLCAtdGhpcy5sZWFkaW5nKTsKICAgIHRoaXMudGV4dE1hdHJpeCA9IHRoaXMudGV4dExpbmVNYXRyaXguc2xpY2UoKTsKICB9CiAgY2xvbmUoKSB7CiAgICBjb25zdCBjbG9uZSA9IE9iamVjdC5jcmVhdGUodGhpcyk7CiAgICBjbG9uZS50ZXh0TWF0cml4ID0gdGhpcy50ZXh0TWF0cml4LnNsaWNlKCk7CiAgICBjbG9uZS50ZXh0TGluZU1hdHJpeCA9IHRoaXMudGV4dExpbmVNYXRyaXguc2xpY2UoKTsKICAgIGNsb25lLmZvbnRNYXRyaXggPSB0aGlzLmZvbnRNYXRyaXguc2xpY2UoKTsKICAgIHJldHVybiBjbG9uZTsKICB9Cn0KY2xhc3MgRXZhbFN0YXRlIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMuY3RtID0gbmV3IEZsb2F0MzJBcnJheShJREVOVElUWV9NQVRSSVgpOwogICAgdGhpcy5mb250ID0gbnVsbDsKICAgIHRoaXMudGV4dFJlbmRlcmluZ01vZGUgPSBUZXh0UmVuZGVyaW5nTW9kZS5GSUxMOwogICAgdGhpcy5fZmlsbENvbG9yU3BhY2UgPSB0aGlzLl9zdHJva2VDb2xvclNwYWNlID0gQ29sb3JTcGFjZVV0aWxzLmdyYXk7CiAgICB0aGlzLnBhdHRlcm5GaWxsQ29sb3JTcGFjZSA9IG51bGw7CiAgICB0aGlzLnBhdHRlcm5TdHJva2VDb2xvclNwYWNlID0gbnVsbDsKICAgIHRoaXMuY3VycmVudFBvaW50WCA9IHRoaXMuY3VycmVudFBvaW50WSA9IDA7CiAgICB0aGlzLnBhdGhNaW5NYXggPSBuZXcgRmxvYXQzMkFycmF5KFtJbmZpbml0eSwgSW5maW5pdHksIC1JbmZpbml0eSwgLUluZmluaXR5XSk7CiAgICB0aGlzLnBhdGhCdWZmZXIgPSBbXTsKICB9CiAgZ2V0IGZpbGxDb2xvclNwYWNlKCkgewogICAgcmV0dXJuIHRoaXMuX2ZpbGxDb2xvclNwYWNlOwogIH0KICBzZXQgZmlsbENvbG9yU3BhY2UoY29sb3JTcGFjZSkgewogICAgdGhpcy5fZmlsbENvbG9yU3BhY2UgPSB0aGlzLnBhdHRlcm5GaWxsQ29sb3JTcGFjZSA9IGNvbG9yU3BhY2U7CiAgfQogIGdldCBzdHJva2VDb2xvclNwYWNlKCkgewogICAgcmV0dXJuIHRoaXMuX3N0cm9rZUNvbG9yU3BhY2U7CiAgfQogIHNldCBzdHJva2VDb2xvclNwYWNlKGNvbG9yU3BhY2UpIHsKICAgIHRoaXMuX3N0cm9rZUNvbG9yU3BhY2UgPSB0aGlzLnBhdHRlcm5TdHJva2VDb2xvclNwYWNlID0gY29sb3JTcGFjZTsKICB9CiAgY2xvbmUoewogICAgbmV3UGF0aCA9IGZhbHNlCiAgfSA9IHt9KSB7CiAgICBjb25zdCBjbG9uZSA9IE9iamVjdC5jcmVhdGUodGhpcyk7CiAgICBpZiAobmV3UGF0aCkgewogICAgICBjbG9uZS5wYXRoQnVmZmVyID0gW107CiAgICAgIGNsb25lLnBhdGhNaW5NYXggPSBuZXcgRmxvYXQzMkFycmF5KFtJbmZpbml0eSwgSW5maW5pdHksIC1JbmZpbml0eSwgLUluZmluaXR5XSk7CiAgICB9CiAgICByZXR1cm4gY2xvbmU7CiAgfQp9CmNsYXNzIEV2YWx1YXRvclByZXByb2Nlc3NvciB7CiAgc3RhdGljIGdldCBvcE1hcCgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgIm9wTWFwIiwgT2JqZWN0LmFzc2lnbihPYmplY3QuY3JlYXRlKG51bGwpLCB7CiAgICAgIHc6IHsKICAgICAgICBpZDogT1BTLnNldExpbmVXaWR0aCwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgSjogewogICAgICAgIGlkOiBPUFMuc2V0TGluZUNhcCwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgajogewogICAgICAgIGlkOiBPUFMuc2V0TGluZUpvaW4sCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIE06IHsKICAgICAgICBpZDogT1BTLnNldE1pdGVyTGltaXQsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGQ6IHsKICAgICAgICBpZDogT1BTLnNldERhc2gsCiAgICAgICAgbnVtQXJnczogMiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIHJpOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRSZW5kZXJpbmdJbnRlbnQsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGk6IHsKICAgICAgICBpZDogT1BTLnNldEZsYXRuZXNzLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBnczogewogICAgICAgIGlkOiBPUFMuc2V0R1N0YXRlLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBxOiB7CiAgICAgICAgaWQ6IE9QUy5zYXZlLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBROiB7CiAgICAgICAgaWQ6IE9QUy5yZXN0b3JlLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBjbTogewogICAgICAgIGlkOiBPUFMudHJhbnNmb3JtLAogICAgICAgIG51bUFyZ3M6IDYsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBtOiB7CiAgICAgICAgaWQ6IE9QUy5tb3ZlVG8sCiAgICAgICAgbnVtQXJnczogMiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGw6IHsKICAgICAgICBpZDogT1BTLmxpbmVUbywKICAgICAgICBudW1BcmdzOiAyLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgYzogewogICAgICAgIGlkOiBPUFMuY3VydmVUbywKICAgICAgICBudW1BcmdzOiA2LAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgdjogewogICAgICAgIGlkOiBPUFMuY3VydmVUbzIsCiAgICAgICAgbnVtQXJnczogNCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIHk6IHsKICAgICAgICBpZDogT1BTLmN1cnZlVG8zLAogICAgICAgIG51bUFyZ3M6IDQsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBoOiB7CiAgICAgICAgaWQ6IE9QUy5jbG9zZVBhdGgsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIHJlOiB7CiAgICAgICAgaWQ6IE9QUy5yZWN0YW5nbGUsCiAgICAgICAgbnVtQXJnczogNCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFM6IHsKICAgICAgICBpZDogT1BTLnN0cm9rZSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgczogewogICAgICAgIGlkOiBPUFMuY2xvc2VTdHJva2UsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGY6IHsKICAgICAgICBpZDogT1BTLmZpbGwsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEY6IHsKICAgICAgICBpZDogT1BTLmZpbGwsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgICJmKiI6IHsKICAgICAgICBpZDogT1BTLmVvRmlsbCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgQjogewogICAgICAgIGlkOiBPUFMuZmlsbFN0cm9rZSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgIkIqIjogewogICAgICAgIGlkOiBPUFMuZW9GaWxsU3Ryb2tlLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBiOiB7CiAgICAgICAgaWQ6IE9QUy5jbG9zZUZpbGxTdHJva2UsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgICJiKiI6IHsKICAgICAgICBpZDogT1BTLmNsb3NlRU9GaWxsU3Ryb2tlLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBuOiB7CiAgICAgICAgaWQ6IE9QUy5lbmRQYXRoLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBXOiB7CiAgICAgICAgaWQ6IE9QUy5jbGlwLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICAiVyoiOiB7CiAgICAgICAgaWQ6IE9QUy5lb0NsaXAsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEJUOiB7CiAgICAgICAgaWQ6IE9QUy5iZWdpblRleHQsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEVUOiB7CiAgICAgICAgaWQ6IE9QUy5lbmRUZXh0LAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBUYzogewogICAgICAgIGlkOiBPUFMuc2V0Q2hhclNwYWNpbmcsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFR3OiB7CiAgICAgICAgaWQ6IE9QUy5zZXRXb3JkU3BhY2luZywKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVHo6IHsKICAgICAgICBpZDogT1BTLnNldEhTY2FsZSwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVEw6IHsKICAgICAgICBpZDogT1BTLnNldExlYWRpbmcsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFRmOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRGb250LAogICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBUcjogewogICAgICAgIGlkOiBPUFMuc2V0VGV4dFJlbmRlcmluZ01vZGUsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFRzOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRUZXh0UmlzZSwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVGQ6IHsKICAgICAgICBpZDogT1BTLm1vdmVUZXh0LAogICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBURDogewogICAgICAgIGlkOiBPUFMuc2V0TGVhZGluZ01vdmVUZXh0LAogICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBUbTogewogICAgICAgIGlkOiBPUFMuc2V0VGV4dE1hdHJpeCwKICAgICAgICBudW1BcmdzOiA2LAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgIlQqIjogewogICAgICAgIGlkOiBPUFMubmV4dExpbmUsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFRqOiB7CiAgICAgICAgaWQ6IE9QUy5zaG93VGV4dCwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVEo6IHsKICAgICAgICBpZDogT1BTLnNob3dTcGFjZWRUZXh0LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICAiJyI6IHsKICAgICAgICBpZDogT1BTLm5leHRMaW5lU2hvd1RleHQsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgICciJzogewogICAgICAgIGlkOiBPUFMubmV4dExpbmVTZXRTcGFjaW5nU2hvd1RleHQsCiAgICAgICAgbnVtQXJnczogMywKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGQwOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRDaGFyV2lkdGgsCiAgICAgICAgbnVtQXJnczogMiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGQxOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRDaGFyV2lkdGhBbmRCb3VuZHMsCiAgICAgICAgbnVtQXJnczogNiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIENTOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRTdHJva2VDb2xvclNwYWNlLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBjczogewogICAgICAgIGlkOiBPUFMuc2V0RmlsbENvbG9yU3BhY2UsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFNDOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRTdHJva2VDb2xvciwKICAgICAgICBudW1BcmdzOiA0LAogICAgICAgIHZhcmlhYmxlQXJnczogdHJ1ZQogICAgICB9LAogICAgICBTQ046IHsKICAgICAgICBpZDogT1BTLnNldFN0cm9rZUNvbG9yTiwKICAgICAgICBudW1BcmdzOiAzMywKICAgICAgICB2YXJpYWJsZUFyZ3M6IHRydWUKICAgICAgfSwKICAgICAgc2M6IHsKICAgICAgICBpZDogT1BTLnNldEZpbGxDb2xvciwKICAgICAgICBudW1BcmdzOiA0LAogICAgICAgIHZhcmlhYmxlQXJnczogdHJ1ZQogICAgICB9LAogICAgICBzY246IHsKICAgICAgICBpZDogT1BTLnNldEZpbGxDb2xvck4sCiAgICAgICAgbnVtQXJnczogMzMsCiAgICAgICAgdmFyaWFibGVBcmdzOiB0cnVlCiAgICAgIH0sCiAgICAgIEc6IHsKICAgICAgICBpZDogT1BTLnNldFN0cm9rZUdyYXksCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGc6IHsKICAgICAgICBpZDogT1BTLnNldEZpbGxHcmF5LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBSRzogewogICAgICAgIGlkOiBPUFMuc2V0U3Ryb2tlUkdCQ29sb3IsCiAgICAgICAgbnVtQXJnczogMywKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIHJnOiB7CiAgICAgICAgaWQ6IE9QUy5zZXRGaWxsUkdCQ29sb3IsCiAgICAgICAgbnVtQXJnczogMywKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEs6IHsKICAgICAgICBpZDogT1BTLnNldFN0cm9rZUNNWUtDb2xvciwKICAgICAgICBudW1BcmdzOiA0LAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgazogewogICAgICAgIGlkOiBPUFMuc2V0RmlsbENNWUtDb2xvciwKICAgICAgICBudW1BcmdzOiA0LAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgc2g6IHsKICAgICAgICBpZDogT1BTLnNoYWRpbmdGaWxsLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBCSTogewogICAgICAgIGlkOiBPUFMuYmVnaW5JbmxpbmVJbWFnZSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgSUQ6IHsKICAgICAgICBpZDogT1BTLmJlZ2luSW1hZ2VEYXRhLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBFSTogewogICAgICAgIGlkOiBPUFMuZW5kSW5saW5lSW1hZ2UsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIERvOiB7CiAgICAgICAgaWQ6IE9QUy5wYWludFhPYmplY3QsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIE1QOiB7CiAgICAgICAgaWQ6IE9QUy5tYXJrUG9pbnQsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIERQOiB7CiAgICAgICAgaWQ6IE9QUy5tYXJrUG9pbnRQcm9wcywKICAgICAgICBudW1BcmdzOiAyLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgQk1DOiB7CiAgICAgICAgaWQ6IE9QUy5iZWdpbk1hcmtlZENvbnRlbnQsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEJEQzogewogICAgICAgIGlkOiBPUFMuYmVnaW5NYXJrZWRDb250ZW50UHJvcHMsCiAgICAgICAgbnVtQXJnczogMiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEVNQzogewogICAgICAgIGlkOiBPUFMuZW5kTWFya2VkQ29udGVudCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgQlg6IHsKICAgICAgICBpZDogT1BTLmJlZ2luQ29tcGF0LAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBFWDogewogICAgICAgIGlkOiBPUFMuZW5kQ29tcGF0LAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBCTTogbnVsbCwKICAgICAgQkQ6IG51bGwsCiAgICAgIHRydWU6IG51bGwsCiAgICAgIGZhOiBudWxsLAogICAgICBmYWw6IG51bGwsCiAgICAgIGZhbHM6IG51bGwsCiAgICAgIGZhbHNlOiBudWxsLAogICAgICBudTogbnVsbCwKICAgICAgbnVsOiBudWxsLAogICAgICBudWxsOiBudWxsCiAgICB9KSk7CiAgfQogIHN0YXRpYyBNQVhfSU5WQUxJRF9QQVRIX09QUyA9IDEwOwogIGNvbnN0cnVjdG9yKHN0cmVhbSwgeHJlZiwgc3RhdGVNYW5hZ2VyID0gbmV3IFN0YXRlTWFuYWdlcigpKSB7CiAgICB0aGlzLnBhcnNlciA9IG5ldyBQYXJzZXIoewogICAgICBsZXhlcjogbmV3IExleGVyKHN0cmVhbSwgRXZhbHVhdG9yUHJlcHJvY2Vzc29yLm9wTWFwKSwKICAgICAgeHJlZgogICAgfSk7CiAgICB0aGlzLnN0YXRlTWFuYWdlciA9IHN0YXRlTWFuYWdlcjsKICAgIHRoaXMubm9uUHJvY2Vzc2VkQXJncyA9IFtdOwogICAgdGhpcy5faXNQYXRoT3AgPSBmYWxzZTsKICAgIHRoaXMuX251bUludmFsaWRQYXRoT1BTID0gMDsKICB9CiAgZ2V0IHNhdmVkU3RhdGVzRGVwdGgoKSB7CiAgICByZXR1cm4gdGhpcy5zdGF0ZU1hbmFnZXIuc3RhdGVTdGFjay5sZW5ndGg7CiAgfQogIHJlYWQob3BlcmF0aW9uKSB7CiAgICBsZXQgYXJncyA9IG9wZXJhdGlvbi5hcmdzOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgY29uc3Qgb2JqID0gdGhpcy5wYXJzZXIuZ2V0T2JqKCk7CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBDbWQpIHsKICAgICAgICBjb25zdCBjbWQgPSBvYmouY21kOwogICAgICAgIGNvbnN0IG9wU3BlYyA9IEV2YWx1YXRvclByZXByb2Nlc3Nvci5vcE1hcFtjbWRdOwogICAgICAgIGlmICghb3BTcGVjKSB7CiAgICAgICAgICB3YXJuKGBVbmtub3duIGNvbW1hbmQgIiR7Y21kfSIuYCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgZm4gPSBvcFNwZWMuaWQ7CiAgICAgICAgY29uc3QgbnVtQXJncyA9IG9wU3BlYy5udW1BcmdzOwogICAgICAgIGxldCBhcmdzTGVuZ3RoID0gYXJncyAhPT0gbnVsbCA/IGFyZ3MubGVuZ3RoIDogMDsKICAgICAgICBpZiAoIXRoaXMuX2lzUGF0aE9wKSB7CiAgICAgICAgICB0aGlzLl9udW1JbnZhbGlkUGF0aE9QUyA9IDA7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2lzUGF0aE9wID0gZm4gPj0gT1BTLm1vdmVUbyAmJiBmbiA8PSBPUFMuZW5kUGF0aDsKICAgICAgICBpZiAoIW9wU3BlYy52YXJpYWJsZUFyZ3MpIHsKICAgICAgICAgIGlmIChhcmdzTGVuZ3RoICE9PSBudW1BcmdzKSB7CiAgICAgICAgICAgIGNvbnN0IG5vblByb2Nlc3NlZEFyZ3MgPSB0aGlzLm5vblByb2Nlc3NlZEFyZ3M7CiAgICAgICAgICAgIHdoaWxlIChhcmdzTGVuZ3RoID4gbnVtQXJncykgewogICAgICAgICAgICAgIG5vblByb2Nlc3NlZEFyZ3MucHVzaChhcmdzLnNoaWZ0KCkpOwogICAgICAgICAgICAgIGFyZ3NMZW5ndGgtLTsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aGlsZSAoYXJnc0xlbmd0aCA8IG51bUFyZ3MgJiYgbm9uUHJvY2Vzc2VkQXJncy5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgICBpZiAoYXJncyA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgYXJncyA9IFtdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBhcmdzLnVuc2hpZnQobm9uUHJvY2Vzc2VkQXJncy5wb3AoKSk7CiAgICAgICAgICAgICAgYXJnc0xlbmd0aCsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYXJnc0xlbmd0aCA8IG51bUFyZ3MpIHsKICAgICAgICAgICAgY29uc3QgcGFydGlhbE1zZyA9IGBjb21tYW5kICR7Y21kfTogZXhwZWN0ZWQgJHtudW1BcmdzfSBhcmdzLCBgICsgYGJ1dCByZWNlaXZlZCAke2FyZ3NMZW5ndGh9IGFyZ3MuYDsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzUGF0aE9wICYmICsrdGhpcy5fbnVtSW52YWxpZFBhdGhPUFMgPiBFdmFsdWF0b3JQcmVwcm9jZXNzb3IuTUFYX0lOVkFMSURfUEFUSF9PUFMpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgJHtwYXJ0aWFsTXNnfWApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdhcm4oYFNraXBwaW5nICR7cGFydGlhbE1zZ31gKTsKICAgICAgICAgICAgaWYgKGFyZ3MgIT09IG51bGwpIHsKICAgICAgICAgICAgICBhcmdzLmxlbmd0aCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChhcmdzTGVuZ3RoID4gbnVtQXJncykgewogICAgICAgICAgaW5mbyhgQ29tbWFuZCAke2NtZH06IGV4cGVjdGVkIFswLCAke251bUFyZ3N9XSBhcmdzLCBgICsgYGJ1dCByZWNlaXZlZCAke2FyZ3NMZW5ndGh9IGFyZ3MuYCk7CiAgICAgICAgfQogICAgICAgIHRoaXMucHJlcHJvY2Vzc0NvbW1hbmQoZm4sIGFyZ3MpOwogICAgICAgIG9wZXJhdGlvbi5mbiA9IGZuOwogICAgICAgIG9wZXJhdGlvbi5hcmdzID0gYXJnczsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBpZiAob2JqID09PSBFT0YpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKG9iaiAhPT0gbnVsbCkgewogICAgICAgIGlmIChhcmdzID09PSBudWxsKSB7CiAgICAgICAgICBhcmdzID0gW107CiAgICAgICAgfQogICAgICAgIGFyZ3MucHVzaChvYmopOwogICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDMzKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlRvbyBtYW55IGFyZ3VtZW50cyIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICBwcmVwcm9jZXNzQ29tbWFuZChmbiwgYXJncykgewogICAgc3dpdGNoIChmbiB8IDApIHsKICAgICAgY2FzZSBPUFMuc2F2ZToKICAgICAgICB0aGlzLnN0YXRlTWFuYWdlci5zYXZlKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgT1BTLnJlc3RvcmU6CiAgICAgICAgdGhpcy5zdGF0ZU1hbmFnZXIucmVzdG9yZSgpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIE9QUy50cmFuc2Zvcm06CiAgICAgICAgdGhpcy5zdGF0ZU1hbmFnZXIudHJhbnNmb3JtKGFyZ3MpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KfQoKOy8vIC4vc3JjL2NvcmUvZGVmYXVsdF9hcHBlYXJhbmNlLmpzCgoKCgoKCgoKY2xhc3MgRGVmYXVsdEFwcGVhcmFuY2VFdmFsdWF0b3IgZXh0ZW5kcyBFdmFsdWF0b3JQcmVwcm9jZXNzb3IgewogIGNvbnN0cnVjdG9yKHN0cikgewogICAgc3VwZXIobmV3IFN0cmluZ1N0cmVhbShzdHIpKTsKICB9CiAgcGFyc2UoKSB7CiAgICBjb25zdCBvcGVyYXRpb24gPSB7CiAgICAgIGZuOiAwLAogICAgICBhcmdzOiBbXQogICAgfTsKICAgIGNvbnN0IHJlc3VsdCA9IHsKICAgICAgZm9udFNpemU6IDAsCiAgICAgIGZvbnROYW1lOiAiIiwKICAgICAgZm9udENvbG9yOiBuZXcgVWludDhDbGFtcGVkQXJyYXkoMykKICAgIH07CiAgICB0cnkgewogICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgIG9wZXJhdGlvbi5hcmdzLmxlbmd0aCA9IDA7CiAgICAgICAgaWYgKCF0aGlzLnJlYWQob3BlcmF0aW9uKSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnNhdmVkU3RhdGVzRGVwdGggIT09IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCB7CiAgICAgICAgICBmbiwKICAgICAgICAgIGFyZ3MKICAgICAgICB9ID0gb3BlcmF0aW9uOwogICAgICAgIHN3aXRjaCAoZm4gfCAwKSB7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGb250OgogICAgICAgICAgICBjb25zdCBbZm9udE5hbWUsIGZvbnRTaXplXSA9IGFyZ3M7CiAgICAgICAgICAgIGlmIChmb250TmFtZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgICByZXN1bHQuZm9udE5hbWUgPSBmb250TmFtZS5uYW1lOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0eXBlb2YgZm9udFNpemUgPT09ICJudW1iZXIiICYmIGZvbnRTaXplID4gMCkgewogICAgICAgICAgICAgIHJlc3VsdC5mb250U2l6ZSA9IGZvbnRTaXplOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0RmlsbFJHQkNvbG9yOgogICAgICAgICAgICBDb2xvclNwYWNlVXRpbHMucmdiLmdldFJnYkl0ZW0oYXJncywgMCwgcmVzdWx0LmZvbnRDb2xvciwgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0RmlsbEdyYXk6CiAgICAgICAgICAgIENvbG9yU3BhY2VVdGlscy5ncmF5LmdldFJnYkl0ZW0oYXJncywgMCwgcmVzdWx0LmZvbnRDb2xvciwgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2V0RmlsbENNWUtDb2xvcjoKICAgICAgICAgICAgQ29sb3JTcGFjZVV0aWxzLmNteWsuZ2V0UmdiSXRlbShhcmdzLCAwLCByZXN1bHQuZm9udENvbG9yLCAwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgd2FybihgcGFyc2VEZWZhdWx0QXBwZWFyYW5jZSAtIGlnbm9yaW5nIGVycm9yczogIiR7cmVhc29ufSIuYCk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KfQpmdW5jdGlvbiBwYXJzZURlZmF1bHRBcHBlYXJhbmNlKHN0cikgewogIHJldHVybiBuZXcgRGVmYXVsdEFwcGVhcmFuY2VFdmFsdWF0b3Ioc3RyKS5wYXJzZSgpOwp9CmNsYXNzIEFwcGVhcmFuY2VTdHJlYW1FdmFsdWF0b3IgZXh0ZW5kcyBFdmFsdWF0b3JQcmVwcm9jZXNzb3IgewogIGNvbnN0cnVjdG9yKHN0cmVhbSwgZXZhbHVhdG9yT3B0aW9ucywgeHJlZiwgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlKSB7CiAgICBzdXBlcihzdHJlYW0pOwogICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07CiAgICB0aGlzLmV2YWx1YXRvck9wdGlvbnMgPSBldmFsdWF0b3JPcHRpb25zOwogICAgdGhpcy54cmVmID0geHJlZjsKICAgIHRoaXMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlID0gZ2xvYmFsQ29sb3JTcGFjZUNhY2hlOwogICAgdGhpcy5yZXNvdXJjZXMgPSBzdHJlYW0uZGljdD8uZ2V0KCJSZXNvdXJjZXMiKTsKICB9CiAgcGFyc2UoKSB7CiAgICBjb25zdCBvcGVyYXRpb24gPSB7CiAgICAgIGZuOiAwLAogICAgICBhcmdzOiBbXQogICAgfTsKICAgIGxldCByZXN1bHQgPSB7CiAgICAgIHNjYWxlRmFjdG9yOiAxLAogICAgICBmb250U2l6ZTogMCwKICAgICAgZm9udE5hbWU6ICIiLAogICAgICBmb250Q29sb3I6IG5ldyBVaW50OENsYW1wZWRBcnJheSgzKSwKICAgICAgZmlsbENvbG9yU3BhY2U6IENvbG9yU3BhY2VVdGlscy5ncmF5CiAgICB9OwogICAgbGV0IGJyZWFrTG9vcCA9IGZhbHNlOwogICAgY29uc3Qgc3RhY2sgPSBbXTsKICAgIHRyeSB7CiAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgb3BlcmF0aW9uLmFyZ3MubGVuZ3RoID0gMDsKICAgICAgICBpZiAoYnJlYWtMb29wIHx8ICF0aGlzLnJlYWQob3BlcmF0aW9uKSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHsKICAgICAgICAgIGZuLAogICAgICAgICAgYXJncwogICAgICAgIH0gPSBvcGVyYXRpb247CiAgICAgICAgc3dpdGNoIChmbiB8IDApIHsKICAgICAgICAgIGNhc2UgT1BTLnNhdmU6CiAgICAgICAgICAgIHN0YWNrLnB1c2goewogICAgICAgICAgICAgIHNjYWxlRmFjdG9yOiByZXN1bHQuc2NhbGVGYWN0b3IsCiAgICAgICAgICAgICAgZm9udFNpemU6IHJlc3VsdC5mb250U2l6ZSwKICAgICAgICAgICAgICBmb250TmFtZTogcmVzdWx0LmZvbnROYW1lLAogICAgICAgICAgICAgIGZvbnRDb2xvcjogcmVzdWx0LmZvbnRDb2xvci5zbGljZSgpLAogICAgICAgICAgICAgIGZpbGxDb2xvclNwYWNlOiByZXN1bHQuZmlsbENvbG9yU3BhY2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMucmVzdG9yZToKICAgICAgICAgICAgcmVzdWx0ID0gc3RhY2sucG9wKCkgfHwgcmVzdWx0OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldFRleHRNYXRyaXg6CiAgICAgICAgICAgIHJlc3VsdC5zY2FsZUZhY3RvciAqPSBNYXRoLmh5cG90KGFyZ3NbMF0sIGFyZ3NbMV0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEZvbnQ6CiAgICAgICAgICAgIGNvbnN0IFtmb250TmFtZSwgZm9udFNpemVdID0gYXJnczsKICAgICAgICAgICAgaWYgKGZvbnROYW1lIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgICAgIHJlc3VsdC5mb250TmFtZSA9IGZvbnROYW1lLm5hbWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGVvZiBmb250U2l6ZSA9PT0gIm51bWJlciIgJiYgZm9udFNpemUgPiAwKSB7CiAgICAgICAgICAgICAgcmVzdWx0LmZvbnRTaXplID0gZm9udFNpemUgKiByZXN1bHQuc2NhbGVGYWN0b3I7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsQ29sb3JTcGFjZToKICAgICAgICAgICAgcmVzdWx0LmZpbGxDb2xvclNwYWNlID0gQ29sb3JTcGFjZVV0aWxzLnBhcnNlKHsKICAgICAgICAgICAgICBjczogYXJnc1swXSwKICAgICAgICAgICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgICAgICAgICAgcmVzb3VyY2VzOiB0aGlzLnJlc291cmNlcywKICAgICAgICAgICAgICBwZGZGdW5jdGlvbkZhY3Rvcnk6IHRoaXMuX3BkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgICAgICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGU6IHRoaXMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlOiB0aGlzLl9sb2NhbENvbG9yU3BhY2VDYWNoZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIE9QUy5zZXRGaWxsQ29sb3I6CiAgICAgICAgICAgIGNvbnN0IGNzID0gcmVzdWx0LmZpbGxDb2xvclNwYWNlOwogICAgICAgICAgICBjcy5nZXRSZ2JJdGVtKGFyZ3MsIDAsIHJlc3VsdC5mb250Q29sb3IsIDApOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEZpbGxSR0JDb2xvcjoKICAgICAgICAgICAgQ29sb3JTcGFjZVV0aWxzLnJnYi5nZXRSZ2JJdGVtKGFyZ3MsIDAsIHJlc3VsdC5mb250Q29sb3IsIDApOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEZpbGxHcmF5OgogICAgICAgICAgICBDb2xvclNwYWNlVXRpbHMuZ3JheS5nZXRSZ2JJdGVtKGFyZ3MsIDAsIHJlc3VsdC5mb250Q29sb3IsIDApOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgT1BTLnNldEZpbGxDTVlLQ29sb3I6CiAgICAgICAgICAgIENvbG9yU3BhY2VVdGlscy5jbXlrLmdldFJnYkl0ZW0oYXJncywgMCwgcmVzdWx0LmZvbnRDb2xvciwgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBPUFMuc2hvd1RleHQ6CiAgICAgICAgICBjYXNlIE9QUy5zaG93U3BhY2VkVGV4dDoKICAgICAgICAgIGNhc2UgT1BTLm5leHRMaW5lU2hvd1RleHQ6CiAgICAgICAgICBjYXNlIE9QUy5uZXh0TGluZVNldFNwYWNpbmdTaG93VGV4dDoKICAgICAgICAgICAgYnJlYWtMb29wID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgd2FybihgcGFyc2VBcHBlYXJhbmNlU3RyZWFtIC0gaWdub3JpbmcgZXJyb3JzOiAiJHtyZWFzb259Ii5gKTsKICAgIH0KICAgIHRoaXMuc3RyZWFtLnJlc2V0KCk7CiAgICBkZWxldGUgcmVzdWx0LnNjYWxlRmFjdG9yOwogICAgZGVsZXRlIHJlc3VsdC5maWxsQ29sb3JTcGFjZTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQogIGdldCBfbG9jYWxDb2xvclNwYWNlQ2FjaGUoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJfbG9jYWxDb2xvclNwYWNlQ2FjaGUiLCBuZXcgTG9jYWxDb2xvclNwYWNlQ2FjaGUoKSk7CiAgfQogIGdldCBfcGRmRnVuY3Rpb25GYWN0b3J5KCkgewogICAgY29uc3QgcGRmRnVuY3Rpb25GYWN0b3J5ID0gbmV3IFBERkZ1bmN0aW9uRmFjdG9yeSh7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgaXNFdmFsU3VwcG9ydGVkOiB0aGlzLmV2YWx1YXRvck9wdGlvbnMuaXNFdmFsU3VwcG9ydGVkCiAgICB9KTsKICAgIHJldHVybiBzaGFkb3codGhpcywgIl9wZGZGdW5jdGlvbkZhY3RvcnkiLCBwZGZGdW5jdGlvbkZhY3RvcnkpOwogIH0KfQpmdW5jdGlvbiBwYXJzZUFwcGVhcmFuY2VTdHJlYW0oc3RyZWFtLCBldmFsdWF0b3JPcHRpb25zLCB4cmVmLCBnbG9iYWxDb2xvclNwYWNlQ2FjaGUpIHsKICByZXR1cm4gbmV3IEFwcGVhcmFuY2VTdHJlYW1FdmFsdWF0b3Ioc3RyZWFtLCBldmFsdWF0b3JPcHRpb25zLCB4cmVmLCBnbG9iYWxDb2xvclNwYWNlQ2FjaGUpLnBhcnNlKCk7Cn0KZnVuY3Rpb24gZ2V0UGRmQ29sb3IoY29sb3IsIGlzRmlsbCkgewogIGlmIChjb2xvclswXSA9PT0gY29sb3JbMV0gJiYgY29sb3JbMV0gPT09IGNvbG9yWzJdKSB7CiAgICBjb25zdCBncmF5ID0gY29sb3JbMF0gLyAyNTU7CiAgICByZXR1cm4gYCR7bnVtYmVyVG9TdHJpbmcoZ3JheSl9ICR7aXNGaWxsID8gImciIDogIkcifWA7CiAgfQogIHJldHVybiBBcnJheS5mcm9tKGNvbG9yLCBjID0+IG51bWJlclRvU3RyaW5nKGMgLyAyNTUpKS5qb2luKCIgIikgKyBgICR7aXNGaWxsID8gInJnIiA6ICJSRyJ9YDsKfQpmdW5jdGlvbiBjcmVhdGVEZWZhdWx0QXBwZWFyYW5jZSh7CiAgZm9udFNpemUsCiAgZm9udE5hbWUsCiAgZm9udENvbG9yCn0pIHsKICByZXR1cm4gYC8ke2VzY2FwZVBERk5hbWUoZm9udE5hbWUpfSAke2ZvbnRTaXplfSBUZiAke2dldFBkZkNvbG9yKGZvbnRDb2xvciwgdHJ1ZSl9YDsKfQpjbGFzcyBGYWtlVW5pY29kZUZvbnQgewogIGNvbnN0cnVjdG9yKHhyZWYsIGZvbnRGYW1pbHkpIHsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLndpZHRocyA9IG51bGw7CiAgICB0aGlzLmZpcnN0Q2hhciA9IEluZmluaXR5OwogICAgdGhpcy5sYXN0Q2hhciA9IC1JbmZpbml0eTsKICAgIHRoaXMuZm9udEZhbWlseSA9IGZvbnRGYW1pbHk7CiAgICBjb25zdCBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKDEsIDEpOwogICAgdGhpcy5jdHhNZWFzdXJlID0gY2FudmFzLmdldENvbnRleHQoIjJkIiwgewogICAgICB3aWxsUmVhZEZyZXF1ZW50bHk6IHRydWUKICAgIH0pOwogICAgaWYgKCFGYWtlVW5pY29kZUZvbnQuX2ZvbnROYW1lSWQpIHsKICAgICAgRmFrZVVuaWNvZGVGb250Ll9mb250TmFtZUlkID0gMTsKICAgIH0KICAgIHRoaXMuZm9udE5hbWUgPSBOYW1lLmdldChgSW52YWxpZFBERmpzRm9udF8ke2ZvbnRGYW1pbHl9XyR7RmFrZVVuaWNvZGVGb250Ll9mb250TmFtZUlkKyt9YCk7CiAgfQogIGdldCBmb250RGVzY3JpcHRvclJlZigpIHsKICAgIGlmICghRmFrZVVuaWNvZGVGb250Ll9mb250RGVzY3JpcHRvclJlZikgewogICAgICBjb25zdCBmb250RGVzY3JpcHRvciA9IG5ldyBEaWN0KHRoaXMueHJlZik7CiAgICAgIGZvbnREZXNjcmlwdG9yLnNldElmTmFtZSgiVHlwZSIsICJGb250RGVzY3JpcHRvciIpOwogICAgICBmb250RGVzY3JpcHRvci5zZXQoIkZvbnROYW1lIiwgdGhpcy5mb250TmFtZSk7CiAgICAgIGZvbnREZXNjcmlwdG9yLnNldCgiRm9udEZhbWlseSIsICJNeXJpYWRQcm8gUmVndWxhciIpOwogICAgICBmb250RGVzY3JpcHRvci5zZXQoIkZvbnRCQm94IiwgWzAsIDAsIDAsIDBdKTsKICAgICAgZm9udERlc2NyaXB0b3Iuc2V0SWZOYW1lKCJGb250U3RyZXRjaCIsICJOb3JtYWwiKTsKICAgICAgZm9udERlc2NyaXB0b3Iuc2V0KCJGb250V2VpZ2h0IiwgNDAwKTsKICAgICAgZm9udERlc2NyaXB0b3Iuc2V0KCJJdGFsaWNBbmdsZSIsIDApOwogICAgICBGYWtlVW5pY29kZUZvbnQuX2ZvbnREZXNjcmlwdG9yUmVmID0gdGhpcy54cmVmLmdldE5ld1BlcnNpc3RlbnRSZWYoZm9udERlc2NyaXB0b3IpOwogICAgfQogICAgcmV0dXJuIEZha2VVbmljb2RlRm9udC5fZm9udERlc2NyaXB0b3JSZWY7CiAgfQogIGdldCBkZXNjZW5kYW50Rm9udFJlZigpIHsKICAgIGNvbnN0IGRlc2NlbmRhbnRGb250ID0gbmV3IERpY3QodGhpcy54cmVmKTsKICAgIGRlc2NlbmRhbnRGb250LnNldCgiQmFzZUZvbnQiLCB0aGlzLmZvbnROYW1lKTsKICAgIGRlc2NlbmRhbnRGb250LnNldElmTmFtZSgiVHlwZSIsICJGb250Iik7CiAgICBkZXNjZW5kYW50Rm9udC5zZXRJZk5hbWUoIlN1YnR5cGUiLCAiQ0lERm9udFR5cGUwIik7CiAgICBkZXNjZW5kYW50Rm9udC5zZXRJZk5hbWUoIkNJRFRvR0lETWFwIiwgIklkZW50aXR5Iik7CiAgICBkZXNjZW5kYW50Rm9udC5zZXQoIkZpcnN0Q2hhciIsIHRoaXMuZmlyc3RDaGFyKTsKICAgIGRlc2NlbmRhbnRGb250LnNldCgiTGFzdENoYXIiLCB0aGlzLmxhc3RDaGFyKTsKICAgIGRlc2NlbmRhbnRGb250LnNldCgiRm9udERlc2NyaXB0b3IiLCB0aGlzLmZvbnREZXNjcmlwdG9yUmVmKTsKICAgIGRlc2NlbmRhbnRGb250LnNldCgiRFciLCAxMDAwKTsKICAgIGNvbnN0IHdpZHRocyA9IFtdOwogICAgY29uc3QgY2hhcnMgPSBbLi4udGhpcy53aWR0aHMuZW50cmllcygpXS5zb3J0KCk7CiAgICBsZXQgY3VycmVudENoYXIgPSBudWxsOwogICAgbGV0IGN1cnJlbnRXaWR0aHMgPSBudWxsOwogICAgZm9yIChjb25zdCBbY2hhciwgd2lkdGhdIG9mIGNoYXJzKSB7CiAgICAgIGlmICghY3VycmVudENoYXIpIHsKICAgICAgICBjdXJyZW50Q2hhciA9IGNoYXI7CiAgICAgICAgY3VycmVudFdpZHRocyA9IFt3aWR0aF07CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGNoYXIgPT09IGN1cnJlbnRDaGFyICsgY3VycmVudFdpZHRocy5sZW5ndGgpIHsKICAgICAgICBjdXJyZW50V2lkdGhzLnB1c2god2lkdGgpOwogICAgICB9IGVsc2UgewogICAgICAgIHdpZHRocy5wdXNoKGN1cnJlbnRDaGFyLCBjdXJyZW50V2lkdGhzKTsKICAgICAgICBjdXJyZW50Q2hhciA9IGNoYXI7CiAgICAgICAgY3VycmVudFdpZHRocyA9IFt3aWR0aF07CiAgICAgIH0KICAgIH0KICAgIGlmIChjdXJyZW50Q2hhcikgewogICAgICB3aWR0aHMucHVzaChjdXJyZW50Q2hhciwgY3VycmVudFdpZHRocyk7CiAgICB9CiAgICBkZXNjZW5kYW50Rm9udC5zZXQoIlciLCB3aWR0aHMpOwogICAgY29uc3QgY2lkU3lzdGVtSW5mbyA9IG5ldyBEaWN0KHRoaXMueHJlZik7CiAgICBjaWRTeXN0ZW1JbmZvLnNldCgiT3JkZXJpbmciLCAiSWRlbnRpdHkiKTsKICAgIGNpZFN5c3RlbUluZm8uc2V0KCJSZWdpc3RyeSIsICJBZG9iZSIpOwogICAgY2lkU3lzdGVtSW5mby5zZXQoIlN1cHBsZW1lbnQiLCAwKTsKICAgIGRlc2NlbmRhbnRGb250LnNldCgiQ0lEU3lzdGVtSW5mbyIsIGNpZFN5c3RlbUluZm8pOwogICAgcmV0dXJuIHRoaXMueHJlZi5nZXROZXdQZXJzaXN0ZW50UmVmKGRlc2NlbmRhbnRGb250KTsKICB9CiAgZ2V0IGJhc2VGb250UmVmKCkgewogICAgY29uc3QgYmFzZUZvbnQgPSBuZXcgRGljdCh0aGlzLnhyZWYpOwogICAgYmFzZUZvbnQuc2V0KCJCYXNlRm9udCIsIHRoaXMuZm9udE5hbWUpOwogICAgYmFzZUZvbnQuc2V0SWZOYW1lKCJUeXBlIiwgIkZvbnQiKTsKICAgIGJhc2VGb250LnNldElmTmFtZSgiU3VidHlwZSIsICJUeXBlMCIpOwogICAgYmFzZUZvbnQuc2V0SWZOYW1lKCJFbmNvZGluZyIsICJJZGVudGl0eS1IIik7CiAgICBiYXNlRm9udC5zZXQoIkRlc2NlbmRhbnRGb250cyIsIFt0aGlzLmRlc2NlbmRhbnRGb250UmVmXSk7CiAgICBiYXNlRm9udC5zZXRJZk5hbWUoIlRvVW5pY29kZSIsICJJZGVudGl0eS1IIik7CiAgICByZXR1cm4gdGhpcy54cmVmLmdldE5ld1BlcnNpc3RlbnRSZWYoYmFzZUZvbnQpOwogIH0KICBnZXQgcmVzb3VyY2VzKCkgewogICAgY29uc3QgcmVzb3VyY2VzID0gbmV3IERpY3QodGhpcy54cmVmKTsKICAgIGNvbnN0IGZvbnQgPSBuZXcgRGljdCh0aGlzLnhyZWYpOwogICAgZm9udC5zZXQodGhpcy5mb250TmFtZS5uYW1lLCB0aGlzLmJhc2VGb250UmVmKTsKICAgIHJlc291cmNlcy5zZXQoIkZvbnQiLCBmb250KTsKICAgIHJldHVybiByZXNvdXJjZXM7CiAgfQogIF9jcmVhdGVDb250ZXh0KCkgewogICAgdGhpcy53aWR0aHMgPSBuZXcgTWFwKCk7CiAgICB0aGlzLmN0eE1lYXN1cmUuZm9udCA9IGAxMDAwcHggJHt0aGlzLmZvbnRGYW1pbHl9YDsKICAgIHJldHVybiB0aGlzLmN0eE1lYXN1cmU7CiAgfQogIGNyZWF0ZUZvbnRSZXNvdXJjZXModGV4dCkgewogICAgY29uc3QgY3R4ID0gdGhpcy5fY3JlYXRlQ29udGV4dCgpOwogICAgZm9yIChjb25zdCBsaW5lIG9mIHRleHQuc3BsaXQoL1xyXG4/fFxuLykpIHsKICAgICAgZm9yIChjb25zdCBjaGFyIG9mIGxpbmUuc3BsaXQoIiIpKSB7CiAgICAgICAgY29uc3QgY29kZSA9IGNoYXIuY2hhckNvZGVBdCgwKTsKICAgICAgICBpZiAodGhpcy53aWR0aHMuaGFzKGNvZGUpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbWV0cmljcyA9IGN0eC5tZWFzdXJlVGV4dChjaGFyKTsKICAgICAgICBjb25zdCB3aWR0aCA9IE1hdGguY2VpbChtZXRyaWNzLndpZHRoKTsKICAgICAgICB0aGlzLndpZHRocy5zZXQoY29kZSwgd2lkdGgpOwogICAgICAgIHRoaXMuZmlyc3RDaGFyID0gTWF0aC5taW4oY29kZSwgdGhpcy5maXJzdENoYXIpOwogICAgICAgIHRoaXMubGFzdENoYXIgPSBNYXRoLm1heChjb2RlLCB0aGlzLmxhc3RDaGFyKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRoaXMucmVzb3VyY2VzOwogIH0KICBzdGF0aWMgZ2V0Rmlyc3RQb3NpdGlvbkluZm8ocmVjdCwgcm90YXRpb24sIGZvbnRTaXplKSB7CiAgICBjb25zdCBbeDEsIHkxLCB4MiwgeTJdID0gcmVjdDsKICAgIGxldCB3ID0geDIgLSB4MTsKICAgIGxldCBoID0geTIgLSB5MTsKICAgIGlmIChyb3RhdGlvbiAlIDE4MCAhPT0gMCkgewogICAgICBbdywgaF0gPSBbaCwgd107CiAgICB9CiAgICBjb25zdCBsaW5lSGVpZ2h0ID0gTElORV9GQUNUT1IgKiBmb250U2l6ZTsKICAgIGNvbnN0IGxpbmVEZXNjZW50ID0gTElORV9ERVNDRU5UX0ZBQ1RPUiAqIGZvbnRTaXplOwogICAgcmV0dXJuIHsKICAgICAgY29vcmRzOiBbMCwgaCArIGxpbmVEZXNjZW50IC0gbGluZUhlaWdodF0sCiAgICAgIGJib3g6IFswLCAwLCB3LCBoXSwKICAgICAgbWF0cml4OiByb3RhdGlvbiAhPT0gMCA/IGdldFJvdGF0aW9uTWF0cml4KHJvdGF0aW9uLCBoLCBsaW5lSGVpZ2h0KSA6IHVuZGVmaW5lZAogICAgfTsKICB9CiAgY3JlYXRlQXBwZWFyYW5jZSh0ZXh0LCByZWN0LCByb3RhdGlvbiwgZm9udFNpemUsIGJnQ29sb3IsIHN0cm9rZUFscGhhKSB7CiAgICBjb25zdCBjdHggPSB0aGlzLl9jcmVhdGVDb250ZXh0KCk7CiAgICBjb25zdCBsaW5lcyA9IFtdOwogICAgbGV0IG1heFdpZHRoID0gLUluZmluaXR5OwogICAgZm9yIChjb25zdCBsaW5lIG9mIHRleHQuc3BsaXQoL1xyXG4/fFxuLykpIHsKICAgICAgbGluZXMucHVzaChsaW5lKTsKICAgICAgY29uc3QgbGluZVdpZHRoID0gY3R4Lm1lYXN1cmVUZXh0KGxpbmUpLndpZHRoOwogICAgICBtYXhXaWR0aCA9IE1hdGgubWF4KG1heFdpZHRoLCBsaW5lV2lkdGgpOwogICAgICBmb3IgKGNvbnN0IGNvZGUgb2YgY29kZVBvaW50SXRlcihsaW5lKSkgewogICAgICAgIGNvbnN0IGNoYXIgPSBTdHJpbmcuZnJvbUNvZGVQb2ludChjb2RlKTsKICAgICAgICBsZXQgd2lkdGggPSB0aGlzLndpZHRocy5nZXQoY29kZSk7CiAgICAgICAgaWYgKHdpZHRoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNvbnN0IG1ldHJpY3MgPSBjdHgubWVhc3VyZVRleHQoY2hhcik7CiAgICAgICAgICB3aWR0aCA9IE1hdGguY2VpbChtZXRyaWNzLndpZHRoKTsKICAgICAgICAgIHRoaXMud2lkdGhzLnNldChjb2RlLCB3aWR0aCk7CiAgICAgICAgICB0aGlzLmZpcnN0Q2hhciA9IE1hdGgubWluKGNvZGUsIHRoaXMuZmlyc3RDaGFyKTsKICAgICAgICAgIHRoaXMubGFzdENoYXIgPSBNYXRoLm1heChjb2RlLCB0aGlzLmxhc3RDaGFyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIG1heFdpZHRoICo9IGZvbnRTaXplIC8gMTAwMDsKICAgIGNvbnN0IFt4MSwgeTEsIHgyLCB5Ml0gPSByZWN0OwogICAgbGV0IHcgPSB4MiAtIHgxOwogICAgbGV0IGggPSB5MiAtIHkxOwogICAgaWYgKHJvdGF0aW9uICUgMTgwICE9PSAwKSB7CiAgICAgIFt3LCBoXSA9IFtoLCB3XTsKICAgIH0KICAgIGxldCBoc2NhbGUgPSAxOwogICAgaWYgKG1heFdpZHRoID4gdykgewogICAgICBoc2NhbGUgPSB3IC8gbWF4V2lkdGg7CiAgICB9CiAgICBsZXQgdnNjYWxlID0gMTsKICAgIGNvbnN0IGxpbmVIZWlnaHQgPSBMSU5FX0ZBQ1RPUiAqIGZvbnRTaXplOwogICAgY29uc3QgbGluZURlc2NlbnQgPSBMSU5FX0RFU0NFTlRfRkFDVE9SICogZm9udFNpemU7CiAgICBjb25zdCBtYXhIZWlnaHQgPSBsaW5lSGVpZ2h0ICogbGluZXMubGVuZ3RoOwogICAgaWYgKG1heEhlaWdodCA+IGgpIHsKICAgICAgdnNjYWxlID0gaCAvIG1heEhlaWdodDsKICAgIH0KICAgIGNvbnN0IGZzY2FsZSA9IE1hdGgubWluKGhzY2FsZSwgdnNjYWxlKTsKICAgIGNvbnN0IG5ld0ZvbnRTaXplID0gZm9udFNpemUgKiBmc2NhbGU7CiAgICBjb25zdCBidWZmZXIgPSBbInEiLCBgMCAwICR7bnVtYmVyVG9TdHJpbmcodyl9ICR7bnVtYmVyVG9TdHJpbmcoaCl9IHJlIFcgbmAsIGBCVGAsIGAxIDAgMCAxIDAgJHtudW1iZXJUb1N0cmluZyhoICsgbGluZURlc2NlbnQpfSBUbSAwIFRjICR7Z2V0UGRmQ29sb3IoYmdDb2xvciwgdHJ1ZSl9YCwgYC8ke3RoaXMuZm9udE5hbWUubmFtZX0gJHtudW1iZXJUb1N0cmluZyhuZXdGb250U2l6ZSl9IFRmYF07CiAgICBjb25zdCB7CiAgICAgIHJlc291cmNlcwogICAgfSA9IHRoaXM7CiAgICBzdHJva2VBbHBoYSA9IHR5cGVvZiBzdHJva2VBbHBoYSA9PT0gIm51bWJlciIgJiYgc3Ryb2tlQWxwaGEgPj0gMCAmJiBzdHJva2VBbHBoYSA8PSAxID8gc3Ryb2tlQWxwaGEgOiAxOwogICAgaWYgKHN0cm9rZUFscGhhICE9PSAxKSB7CiAgICAgIGJ1ZmZlci5wdXNoKCIvUjAgZ3MiKTsKICAgICAgY29uc3QgZXh0R1N0YXRlID0gbmV3IERpY3QodGhpcy54cmVmKTsKICAgICAgY29uc3QgcjAgPSBuZXcgRGljdCh0aGlzLnhyZWYpOwogICAgICByMC5zZXQoImNhIiwgc3Ryb2tlQWxwaGEpOwogICAgICByMC5zZXQoIkNBIiwgc3Ryb2tlQWxwaGEpOwogICAgICByMC5zZXRJZk5hbWUoIlR5cGUiLCAiRXh0R1N0YXRlIik7CiAgICAgIGV4dEdTdGF0ZS5zZXQoIlIwIiwgcjApOwogICAgICByZXNvdXJjZXMuc2V0KCJFeHRHU3RhdGUiLCBleHRHU3RhdGUpOwogICAgfQogICAgY29uc3QgdlNoaWZ0ID0gbnVtYmVyVG9TdHJpbmcobGluZUhlaWdodCk7CiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHsKICAgICAgYnVmZmVyLnB1c2goYDAgLSR7dlNoaWZ0fSBUZCA8JHtzdHJpbmdUb1VURjE2SGV4U3RyaW5nKGxpbmUpfT4gVGpgKTsKICAgIH0KICAgIGJ1ZmZlci5wdXNoKCJFVCIsICJRIik7CiAgICBjb25zdCBhcHBlYXJhbmNlID0gYnVmZmVyLmpvaW4oIlxuIik7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtRGljdCA9IG5ldyBEaWN0KHRoaXMueHJlZik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlN1YnR5cGUiLCAiRm9ybSIpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0SWZOYW1lKCJUeXBlIiwgIlhPYmplY3QiKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiQkJveCIsIFswLCAwLCB3LCBoXSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkxlbmd0aCIsIGFwcGVhcmFuY2UubGVuZ3RoKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiUmVzb3VyY2VzIiwgcmVzb3VyY2VzKTsKICAgIGlmIChyb3RhdGlvbikgewogICAgICBjb25zdCBtYXRyaXggPSBnZXRSb3RhdGlvbk1hdHJpeChyb3RhdGlvbiwgdywgaCk7CiAgICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiTWF0cml4IiwgbWF0cml4KTsKICAgIH0KICAgIGNvbnN0IGFwID0gbmV3IFN0cmluZ1N0cmVhbShhcHBlYXJhbmNlKTsKICAgIGFwLmRpY3QgPSBhcHBlYXJhbmNlU3RyZWFtRGljdDsKICAgIHJldHVybiBhcDsKICB9Cn0KCjsvLyAuL3NyYy9zaGFyZWQvc2NyaXB0aW5nX3V0aWxzLmpzCmZ1bmN0aW9uIG1ha2VDb2xvckNvbXAobikgewogIHJldHVybiBNYXRoLmZsb29yKE1hdGgubWF4KDAsIE1hdGgubWluKDEsIG4pKSAqIDI1NSkudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICIwIik7Cn0KZnVuY3Rpb24gc2NhbGVBbmRDbGFtcCh4KSB7CiAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKDI1NSwgMjU1ICogeCkpOwp9CmNsYXNzIENvbG9yQ29udmVydGVycyB7CiAgc3RhdGljIENNWUtfRyhbYywgeSwgbSwga10pIHsKICAgIHJldHVybiBbIkciLCAxIC0gTWF0aC5taW4oMSwgMC4zICogYyArIDAuNTkgKiBtICsgMC4xMSAqIHkgKyBrKV07CiAgfQogIHN0YXRpYyBHX0NNWUsoW2ddKSB7CiAgICByZXR1cm4gWyJDTVlLIiwgMCwgMCwgMCwgMSAtIGddOwogIH0KICBzdGF0aWMgR19SR0IoW2ddKSB7CiAgICByZXR1cm4gWyJSR0IiLCBnLCBnLCBnXTsKICB9CiAgc3RhdGljIEdfcmdiKFtnXSkgewogICAgZyA9IHNjYWxlQW5kQ2xhbXAoZyk7CiAgICByZXR1cm4gW2csIGcsIGddOwogIH0KICBzdGF0aWMgR19IVE1MKFtnXSkgewogICAgY29uc3QgRyA9IG1ha2VDb2xvckNvbXAoZyk7CiAgICByZXR1cm4gYCMke0d9JHtHfSR7R31gOwogIH0KICBzdGF0aWMgUkdCX0coW3IsIGcsIGJdKSB7CiAgICByZXR1cm4gWyJHIiwgMC4zICogciArIDAuNTkgKiBnICsgMC4xMSAqIGJdOwogIH0KICBzdGF0aWMgUkdCX3JnYihjb2xvcikgewogICAgcmV0dXJuIGNvbG9yLm1hcChzY2FsZUFuZENsYW1wKTsKICB9CiAgc3RhdGljIFJHQl9IVE1MKGNvbG9yKSB7CiAgICByZXR1cm4gYCMke2NvbG9yLm1hcChtYWtlQ29sb3JDb21wKS5qb2luKCIiKX1gOwogIH0KICBzdGF0aWMgVF9IVE1MKCkgewogICAgcmV0dXJuICIjMDAwMDAwMDAiOwogIH0KICBzdGF0aWMgVF9yZ2IoKSB7CiAgICByZXR1cm4gW251bGxdOwogIH0KICBzdGF0aWMgQ01ZS19SR0IoW2MsIHksIG0sIGtdKSB7CiAgICByZXR1cm4gWyJSR0IiLCAxIC0gTWF0aC5taW4oMSwgYyArIGspLCAxIC0gTWF0aC5taW4oMSwgbSArIGspLCAxIC0gTWF0aC5taW4oMSwgeSArIGspXTsKICB9CiAgc3RhdGljIENNWUtfcmdiKFtjLCB5LCBtLCBrXSkgewogICAgcmV0dXJuIFtzY2FsZUFuZENsYW1wKDEgLSBNYXRoLm1pbigxLCBjICsgaykpLCBzY2FsZUFuZENsYW1wKDEgLSBNYXRoLm1pbigxLCBtICsgaykpLCBzY2FsZUFuZENsYW1wKDEgLSBNYXRoLm1pbigxLCB5ICsgaykpXTsKICB9CiAgc3RhdGljIENNWUtfSFRNTChjb21wb25lbnRzKSB7CiAgICBjb25zdCByZ2IgPSB0aGlzLkNNWUtfUkdCKGNvbXBvbmVudHMpLnNsaWNlKDEpOwogICAgcmV0dXJuIHRoaXMuUkdCX0hUTUwocmdiKTsKICB9CiAgc3RhdGljIFJHQl9DTVlLKFtyLCBnLCBiXSkgewogICAgY29uc3QgYyA9IDEgLSByOwogICAgY29uc3QgbSA9IDEgLSBnOwogICAgY29uc3QgeSA9IDEgLSBiOwogICAgY29uc3QgayA9IE1hdGgubWluKGMsIG0sIHkpOwogICAgcmV0dXJuIFsiQ01ZSyIsIGMsIG0sIHksIGtdOwogIH0KfQpjb25zdCBEYXRlRm9ybWF0cyA9IFsibS9kIiwgIm0vZC95eSIsICJtbS9kZC95eSIsICJtbS95eSIsICJkLW1tbSIsICJkLW1tbS15eSIsICJkZC1tbW0teXkiLCAieXktbW0tZGQiLCAibW1tLXl5IiwgIm1tbW0teXkiLCAibW1tIGQsIHl5eXkiLCAibW1tbSBkLCB5eXl5IiwgIm0vZC95eSBoOk1NIHR0IiwgIm0vZC95eSBISDpNTSJdOwpjb25zdCBUaW1lRm9ybWF0cyA9IFsiSEg6TU0iLCAiaDpNTSB0dCIsICJISDpNTTpzcyIsICJoOk1NOnNzIHR0Il07Cgo7Ly8gLi9zcmMvY29yZS9uYW1lX251bWJlcl90cmVlLmpzCgoKY2xhc3MgTmFtZU9yTnVtYmVyVHJlZSB7CiAgY29uc3RydWN0b3Iocm9vdCwgeHJlZiwgdHlwZSkgewogICAgdGhpcy5yb290ID0gcm9vdDsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLl90eXBlID0gdHlwZTsKICB9CiAgZ2V0QWxsKCkgewogICAgY29uc3QgbWFwID0gbmV3IE1hcCgpOwogICAgaWYgKCF0aGlzLnJvb3QpIHsKICAgICAgcmV0dXJuIG1hcDsKICAgIH0KICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWY7CiAgICBjb25zdCBwcm9jZXNzZWQgPSBuZXcgUmVmU2V0KCk7CiAgICBwcm9jZXNzZWQucHV0KHRoaXMucm9vdCk7CiAgICBjb25zdCBxdWV1ZSA9IFt0aGlzLnJvb3RdOwogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3Qgb2JqID0geHJlZi5mZXRjaElmUmVmKHF1ZXVlLnNoaWZ0KCkpOwogICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChvYmouaGFzKCJLaWRzIikpIHsKICAgICAgICBjb25zdCBraWRzID0gb2JqLmdldCgiS2lkcyIpOwogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShraWRzKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGZvciAoY29uc3Qga2lkIG9mIGtpZHMpIHsKICAgICAgICAgIGlmIChwcm9jZXNzZWQuaGFzKGtpZCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBEdXBsaWNhdGUgZW50cnkgaW4gIiR7dGhpcy5fdHlwZX0iIHRyZWUuYCk7CiAgICAgICAgICB9CiAgICAgICAgICBxdWV1ZS5wdXNoKGtpZCk7CiAgICAgICAgICBwcm9jZXNzZWQucHV0KGtpZCk7CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGVudHJpZXMgPSBvYmouZ2V0KHRoaXMuX3R5cGUpOwogICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZW50cmllcykpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBlbnRyaWVzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICBtYXAuc2V0KHhyZWYuZmV0Y2hJZlJlZihlbnRyaWVzW2ldKSwgeHJlZi5mZXRjaElmUmVmKGVudHJpZXNbaSArIDFdKSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBtYXA7CiAgfQogIGdldFJhdyhrZXkpIHsKICAgIGlmICghdGhpcy5yb290KSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgeHJlZiA9IHRoaXMueHJlZjsKICAgIGxldCBraWRzT3JFbnRyaWVzID0geHJlZi5mZXRjaElmUmVmKHRoaXMucm9vdCk7CiAgICBsZXQgbG9vcENvdW50ID0gMDsKICAgIGNvbnN0IE1BWF9MRVZFTFMgPSAxMDsKICAgIHdoaWxlIChraWRzT3JFbnRyaWVzLmhhcygiS2lkcyIpKSB7CiAgICAgIGlmICgrK2xvb3BDb3VudCA+IE1BWF9MRVZFTFMpIHsKICAgICAgICB3YXJuKGBTZWFyY2ggZGVwdGggbGltaXQgcmVhY2hlZCBmb3IgIiR7dGhpcy5fdHlwZX0iIHRyZWUuYCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3Qga2lkcyA9IGtpZHNPckVudHJpZXMuZ2V0KCJLaWRzIik7CiAgICAgIGlmICghQXJyYXkuaXNBcnJheShraWRzKSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGxldCBsID0gMCwKICAgICAgICByID0ga2lkcy5sZW5ndGggLSAxOwogICAgICB3aGlsZSAobCA8PSByKSB7CiAgICAgICAgY29uc3QgbSA9IGwgKyByID4+IDE7CiAgICAgICAgY29uc3Qga2lkID0geHJlZi5mZXRjaElmUmVmKGtpZHNbbV0pOwogICAgICAgIGNvbnN0IGxpbWl0cyA9IGtpZC5nZXQoIkxpbWl0cyIpOwogICAgICAgIGlmIChrZXkgPCB4cmVmLmZldGNoSWZSZWYobGltaXRzWzBdKSkgewogICAgICAgICAgciA9IG0gLSAxOwogICAgICAgIH0gZWxzZSBpZiAoa2V5ID4geHJlZi5mZXRjaElmUmVmKGxpbWl0c1sxXSkpIHsKICAgICAgICAgIGwgPSBtICsgMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAga2lkc09yRW50cmllcyA9IGtpZDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobCA+IHIpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgY29uc3QgZW50cmllcyA9IGtpZHNPckVudHJpZXMuZ2V0KHRoaXMuX3R5cGUpOwogICAgaWYgKEFycmF5LmlzQXJyYXkoZW50cmllcykpIHsKICAgICAgbGV0IGwgPSAwLAogICAgICAgIHIgPSBlbnRyaWVzLmxlbmd0aCAtIDI7CiAgICAgIHdoaWxlIChsIDw9IHIpIHsKICAgICAgICBjb25zdCB0bXAgPSBsICsgciA+PiAxLAogICAgICAgICAgbSA9IHRtcCArICh0bXAgJiAxKTsKICAgICAgICBjb25zdCBjdXJyZW50S2V5ID0geHJlZi5mZXRjaElmUmVmKGVudHJpZXNbbV0pOwogICAgICAgIGlmIChrZXkgPCBjdXJyZW50S2V5KSB7CiAgICAgICAgICByID0gbSAtIDI7CiAgICAgICAgfSBlbHNlIGlmIChrZXkgPiBjdXJyZW50S2V5KSB7CiAgICAgICAgICBsID0gbSArIDI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBlbnRyaWVzW20gKyAxXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICBnZXQoa2V5KSB7CiAgICByZXR1cm4gdGhpcy54cmVmLmZldGNoSWZSZWYodGhpcy5nZXRSYXcoa2V5KSk7CiAgfQp9CmNsYXNzIE5hbWVUcmVlIGV4dGVuZHMgTmFtZU9yTnVtYmVyVHJlZSB7CiAgY29uc3RydWN0b3Iocm9vdCwgeHJlZikgewogICAgc3VwZXIocm9vdCwgeHJlZiwgIk5hbWVzIik7CiAgfQp9CmNsYXNzIE51bWJlclRyZWUgZXh0ZW5kcyBOYW1lT3JOdW1iZXJUcmVlIHsKICBjb25zdHJ1Y3Rvcihyb290LCB4cmVmKSB7CiAgICBzdXBlcihyb290LCB4cmVmLCAiTnVtcyIpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY2xlYW51cF9oZWxwZXIuanMKCgoKCmZ1bmN0aW9uIGNsZWFyR2xvYmFsQ2FjaGVzKCkgewogIGNsZWFyUGF0dGVybkNhY2hlcygpOwogIGNsZWFyUHJpbWl0aXZlQ2FjaGVzKCk7CiAgY2xlYXJVbmljb2RlQ2FjaGVzKCk7CiAgSnB4SW1hZ2UuY2xlYW51cCgpOwp9Cgo7Ly8gLi9zcmMvY29yZS9maWxlX3NwZWMuanMKCgoKZnVuY3Rpb24gcGlja1BsYXRmb3JtSXRlbShkaWN0KSB7CiAgaWYgKCEoZGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgaWYgKGRpY3QuaGFzKCJVRiIpKSB7CiAgICByZXR1cm4gZGljdC5nZXQoIlVGIik7CiAgfSBlbHNlIGlmIChkaWN0LmhhcygiRiIpKSB7CiAgICByZXR1cm4gZGljdC5nZXQoIkYiKTsKICB9IGVsc2UgaWYgKGRpY3QuaGFzKCJVbml4IikpIHsKICAgIHJldHVybiBkaWN0LmdldCgiVW5peCIpOwogIH0gZWxzZSBpZiAoZGljdC5oYXMoIk1hYyIpKSB7CiAgICByZXR1cm4gZGljdC5nZXQoIk1hYyIpOwogIH0gZWxzZSBpZiAoZGljdC5oYXMoIkRPUyIpKSB7CiAgICByZXR1cm4gZGljdC5nZXQoIkRPUyIpOwogIH0KICByZXR1cm4gbnVsbDsKfQpmdW5jdGlvbiBzdHJpcFBhdGgoc3RyKSB7CiAgcmV0dXJuIHN0ci5zdWJzdHJpbmcoc3RyLmxhc3RJbmRleE9mKCIvIikgKyAxKTsKfQpjbGFzcyBGaWxlU3BlYyB7CiAgI2NvbnRlbnRBdmFpbGFibGUgPSBmYWxzZTsKICBjb25zdHJ1Y3Rvcihyb290LCB4cmVmLCBza2lwQ29udGVudCA9IGZhbHNlKSB7CiAgICBpZiAoIShyb290IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy54cmVmID0geHJlZjsKICAgIHRoaXMucm9vdCA9IHJvb3Q7CiAgICBpZiAocm9vdC5oYXMoIkZTIikpIHsKICAgICAgdGhpcy5mcyA9IHJvb3QuZ2V0KCJGUyIpOwogICAgfQogICAgaWYgKHJvb3QuaGFzKCJSRiIpKSB7CiAgICAgIHdhcm4oIlJlbGF0ZWQgZmlsZSBzcGVjaWZpY2F0aW9ucyBhcmUgbm90IHN1cHBvcnRlZCIpOwogICAgfQogICAgaWYgKCFza2lwQ29udGVudCkgewogICAgICBpZiAocm9vdC5oYXMoIkVGIikpIHsKICAgICAgICB0aGlzLiNjb250ZW50QXZhaWxhYmxlID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKCJOb24tZW1iZWRkZWQgZmlsZSBzcGVjaWZpY2F0aW9ucyBhcmUgbm90IHN1cHBvcnRlZCIpOwogICAgICB9CiAgICB9CiAgfQogIGdldCBmaWxlbmFtZSgpIHsKICAgIGxldCBmaWxlbmFtZSA9ICIiOwogICAgY29uc3QgaXRlbSA9IHBpY2tQbGF0Zm9ybUl0ZW0odGhpcy5yb290KTsKICAgIGlmIChpdGVtICYmIHR5cGVvZiBpdGVtID09PSAic3RyaW5nIikgewogICAgICBmaWxlbmFtZSA9IHN0cmluZ1RvUERGU3RyaW5nKGl0ZW0sIHRydWUpLnJlcGxhY2VBbGwoIlxcXFwiLCAiXFwiKS5yZXBsYWNlQWxsKCJcXC8iLCAiLyIpLnJlcGxhY2VBbGwoIlxcIiwgIi8iKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImZpbGVuYW1lIiwgZmlsZW5hbWUgfHwgInVubmFtZWQiKTsKICB9CiAgZ2V0IGNvbnRlbnQoKSB7CiAgICBpZiAoIXRoaXMuI2NvbnRlbnRBdmFpbGFibGUpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICB0aGlzLl9jb250ZW50UmVmIHx8PSBwaWNrUGxhdGZvcm1JdGVtKHRoaXMucm9vdD8uZ2V0KCJFRiIpKTsKICAgIGxldCBjb250ZW50ID0gbnVsbDsKICAgIGlmICh0aGlzLl9jb250ZW50UmVmKSB7CiAgICAgIGNvbnN0IGZpbGVPYmogPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZih0aGlzLl9jb250ZW50UmVmKTsKICAgICAgaWYgKGZpbGVPYmogaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgICAgY29udGVudCA9IGZpbGVPYmouZ2V0Qnl0ZXMoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKCJFbWJlZGRlZCBmaWxlIHNwZWNpZmljYXRpb24gcG9pbnRzIHRvIG5vbi1leGlzdGluZy9pbnZhbGlkIGNvbnRlbnQiKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgd2FybigiRW1iZWRkZWQgZmlsZSBzcGVjaWZpY2F0aW9uIGRvZXMgbm90IGhhdmUgYW55IGNvbnRlbnQiKTsKICAgIH0KICAgIHJldHVybiBjb250ZW50OwogIH0KICBnZXQgZGVzY3JpcHRpb24oKSB7CiAgICBsZXQgZGVzY3JpcHRpb24gPSAiIjsKICAgIGNvbnN0IGRlc2MgPSB0aGlzLnJvb3Q/LmdldCgiRGVzYyIpOwogICAgaWYgKGRlc2MgJiYgdHlwZW9mIGRlc2MgPT09ICJzdHJpbmciKSB7CiAgICAgIGRlc2NyaXB0aW9uID0gc3RyaW5nVG9QREZTdHJpbmcoZGVzYyk7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJkZXNjcmlwdGlvbiIsIGRlc2NyaXB0aW9uKTsKICB9CiAgZ2V0IHNlcmlhbGl6YWJsZSgpIHsKICAgIHJldHVybiB7CiAgICAgIHJhd0ZpbGVuYW1lOiB0aGlzLmZpbGVuYW1lLAogICAgICBmaWxlbmFtZTogc3RyaXBQYXRoKHRoaXMuZmlsZW5hbWUpLAogICAgICBjb250ZW50OiB0aGlzLmNvbnRlbnQsCiAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmRlc2NyaXB0aW9uCiAgICB9OwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveG1sX3BhcnNlci5qcwoKY29uc3QgWE1MUGFyc2VyRXJyb3JDb2RlID0gewogIE5vRXJyb3I6IDAsCiAgRW5kT2ZEb2N1bWVudDogLTEsCiAgVW50ZXJtaW5hdGVkQ2RhdDogLTIsCiAgVW50ZXJtaW5hdGVkWG1sRGVjbGFyYXRpb246IC0zLAogIFVudGVybWluYXRlZERvY3R5cGVEZWNsYXJhdGlvbjogLTQsCiAgVW50ZXJtaW5hdGVkQ29tbWVudDogLTUsCiAgTWFsZm9ybWVkRWxlbWVudDogLTYsCiAgT3V0T2ZNZW1vcnk6IC03LAogIFVudGVybWluYXRlZEF0dHJpYnV0ZVZhbHVlOiAtOCwKICBVbnRlcm1pbmF0ZWRFbGVtZW50OiAtOSwKICBFbGVtZW50TmV2ZXJCZWd1bjogLTEwCn07CmZ1bmN0aW9uIGlzV2hpdGVzcGFjZShzLCBpbmRleCkgewogIGNvbnN0IGNoID0gc1tpbmRleF07CiAgcmV0dXJuIGNoID09PSAiICIgfHwgY2ggPT09ICJcbiIgfHwgY2ggPT09ICJcciIgfHwgY2ggPT09ICJcdCI7Cn0KZnVuY3Rpb24gaXNXaGl0ZXNwYWNlU3RyaW5nKHMpIHsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGlmICghaXNXaGl0ZXNwYWNlKHMsIGkpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9CiAgcmV0dXJuIHRydWU7Cn0KY2xhc3MgWE1MUGFyc2VyQmFzZSB7CiAgX3Jlc29sdmVFbnRpdGllcyhzKSB7CiAgICByZXR1cm4gcy5yZXBsYWNlQWxsKC8mKFteO10rKTsvZywgKGFsbCwgZW50aXR5KSA9PiB7CiAgICAgIGlmIChlbnRpdHkuc3Vic3RyaW5nKDAsIDIpID09PSAiI3giKSB7CiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ29kZVBvaW50KHBhcnNlSW50KGVudGl0eS5zdWJzdHJpbmcoMiksIDE2KSk7CiAgICAgIH0gZWxzZSBpZiAoZW50aXR5LnN1YnN0cmluZygwLCAxKSA9PT0gIiMiKSB7CiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ29kZVBvaW50KHBhcnNlSW50KGVudGl0eS5zdWJzdHJpbmcoMSksIDEwKSk7CiAgICAgIH0KICAgICAgc3dpdGNoIChlbnRpdHkpIHsKICAgICAgICBjYXNlICJsdCI6CiAgICAgICAgICByZXR1cm4gIjwiOwogICAgICAgIGNhc2UgImd0IjoKICAgICAgICAgIHJldHVybiAiPiI7CiAgICAgICAgY2FzZSAiYW1wIjoKICAgICAgICAgIHJldHVybiAiJiI7CiAgICAgICAgY2FzZSAicXVvdCI6CiAgICAgICAgICByZXR1cm4gJyInOwogICAgICAgIGNhc2UgImFwb3MiOgogICAgICAgICAgcmV0dXJuICInIjsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5vblJlc29sdmVFbnRpdHkoZW50aXR5KTsKICAgIH0pOwogIH0KICBfcGFyc2VDb250ZW50KHMsIHN0YXJ0KSB7CiAgICBjb25zdCBhdHRyaWJ1dGVzID0gW107CiAgICBsZXQgcG9zID0gc3RhcnQ7CiAgICBmdW5jdGlvbiBza2lwV3MoKSB7CiAgICAgIHdoaWxlIChwb3MgPCBzLmxlbmd0aCAmJiBpc1doaXRlc3BhY2UocywgcG9zKSkgewogICAgICAgICsrcG9zOwogICAgICB9CiAgICB9CiAgICB3aGlsZSAocG9zIDwgcy5sZW5ndGggJiYgIWlzV2hpdGVzcGFjZShzLCBwb3MpICYmIHNbcG9zXSAhPT0gIj4iICYmIHNbcG9zXSAhPT0gIi8iKSB7CiAgICAgICsrcG9zOwogICAgfQogICAgY29uc3QgbmFtZSA9IHMuc3Vic3RyaW5nKHN0YXJ0LCBwb3MpOwogICAgc2tpcFdzKCk7CiAgICB3aGlsZSAocG9zIDwgcy5sZW5ndGggJiYgc1twb3NdICE9PSAiPiIgJiYgc1twb3NdICE9PSAiLyIgJiYgc1twb3NdICE9PSAiPyIpIHsKICAgICAgc2tpcFdzKCk7CiAgICAgIGxldCBhdHRyTmFtZSA9ICIiLAogICAgICAgIGF0dHJWYWx1ZSA9ICIiOwogICAgICB3aGlsZSAocG9zIDwgcy5sZW5ndGggJiYgIWlzV2hpdGVzcGFjZShzLCBwb3MpICYmIHNbcG9zXSAhPT0gIj0iKSB7CiAgICAgICAgYXR0ck5hbWUgKz0gc1twb3NdOwogICAgICAgICsrcG9zOwogICAgICB9CiAgICAgIHNraXBXcygpOwogICAgICBpZiAoc1twb3NdICE9PSAiPSIpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICArK3BvczsKICAgICAgc2tpcFdzKCk7CiAgICAgIGNvbnN0IGF0dHJFbmRDaGFyID0gc1twb3NdOwogICAgICBpZiAoYXR0ckVuZENoYXIgIT09ICciJyAmJiBhdHRyRW5kQ2hhciAhPT0gIiciKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3QgYXR0ckVuZEluZGV4ID0gcy5pbmRleE9mKGF0dHJFbmRDaGFyLCArK3Bvcyk7CiAgICAgIGlmIChhdHRyRW5kSW5kZXggPCAwKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgYXR0clZhbHVlID0gcy5zdWJzdHJpbmcocG9zLCBhdHRyRW5kSW5kZXgpOwogICAgICBhdHRyaWJ1dGVzLnB1c2goewogICAgICAgIG5hbWU6IGF0dHJOYW1lLAogICAgICAgIHZhbHVlOiB0aGlzLl9yZXNvbHZlRW50aXRpZXMoYXR0clZhbHVlKQogICAgICB9KTsKICAgICAgcG9zID0gYXR0ckVuZEluZGV4ICsgMTsKICAgICAgc2tpcFdzKCk7CiAgICB9CiAgICByZXR1cm4gewogICAgICBuYW1lLAogICAgICBhdHRyaWJ1dGVzLAogICAgICBwYXJzZWQ6IHBvcyAtIHN0YXJ0CiAgICB9OwogIH0KICBfcGFyc2VQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24ocywgc3RhcnQpIHsKICAgIGxldCBwb3MgPSBzdGFydDsKICAgIGZ1bmN0aW9uIHNraXBXcygpIHsKICAgICAgd2hpbGUgKHBvcyA8IHMubGVuZ3RoICYmIGlzV2hpdGVzcGFjZShzLCBwb3MpKSB7CiAgICAgICAgKytwb3M7CiAgICAgIH0KICAgIH0KICAgIHdoaWxlIChwb3MgPCBzLmxlbmd0aCAmJiAhaXNXaGl0ZXNwYWNlKHMsIHBvcykgJiYgc1twb3NdICE9PSAiPiIgJiYgc1twb3NdICE9PSAiPyIgJiYgc1twb3NdICE9PSAiLyIpIHsKICAgICAgKytwb3M7CiAgICB9CiAgICBjb25zdCBuYW1lID0gcy5zdWJzdHJpbmcoc3RhcnQsIHBvcyk7CiAgICBza2lwV3MoKTsKICAgIGNvbnN0IGF0dHJTdGFydCA9IHBvczsKICAgIHdoaWxlIChwb3MgPCBzLmxlbmd0aCAmJiAoc1twb3NdICE9PSAiPyIgfHwgc1twb3MgKyAxXSAhPT0gIj4iKSkgewogICAgICArK3BvczsKICAgIH0KICAgIGNvbnN0IHZhbHVlID0gcy5zdWJzdHJpbmcoYXR0clN0YXJ0LCBwb3MpOwogICAgcmV0dXJuIHsKICAgICAgbmFtZSwKICAgICAgdmFsdWUsCiAgICAgIHBhcnNlZDogcG9zIC0gc3RhcnQKICAgIH07CiAgfQogIHBhcnNlWG1sKHMpIHsKICAgIGxldCBpID0gMDsKICAgIHdoaWxlIChpIDwgcy5sZW5ndGgpIHsKICAgICAgY29uc3QgY2ggPSBzW2ldOwogICAgICBsZXQgaiA9IGk7CiAgICAgIGlmIChjaCA9PT0gIjwiKSB7CiAgICAgICAgKytqOwogICAgICAgIGNvbnN0IGNoMiA9IHNbal07CiAgICAgICAgbGV0IHE7CiAgICAgICAgc3dpdGNoIChjaDIpIHsKICAgICAgICAgIGNhc2UgIi8iOgogICAgICAgICAgICArK2o7CiAgICAgICAgICAgIHEgPSBzLmluZGV4T2YoIj4iLCBqKTsKICAgICAgICAgICAgaWYgKHEgPCAwKSB7CiAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKFhNTFBhcnNlckVycm9yQ29kZS5VbnRlcm1pbmF0ZWRFbGVtZW50KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5vbkVuZEVsZW1lbnQocy5zdWJzdHJpbmcoaiwgcSkpOwogICAgICAgICAgICBqID0gcSArIDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiPyI6CiAgICAgICAgICAgICsrajsKICAgICAgICAgICAgY29uc3QgcGkgPSB0aGlzLl9wYXJzZVByb2Nlc3NpbmdJbnN0cnVjdGlvbihzLCBqKTsKICAgICAgICAgICAgaWYgKHMuc3Vic3RyaW5nKGogKyBwaS5wYXJzZWQsIGogKyBwaS5wYXJzZWQgKyAyKSAhPT0gIj8+IikgewogICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuVW50ZXJtaW5hdGVkWG1sRGVjbGFyYXRpb24pOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm9uUGkocGkubmFtZSwgcGkudmFsdWUpOwogICAgICAgICAgICBqICs9IHBpLnBhcnNlZCArIDI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiISI6CiAgICAgICAgICAgIGlmIChzLnN1YnN0cmluZyhqICsgMSwgaiArIDMpID09PSAiLS0iKSB7CiAgICAgICAgICAgICAgcSA9IHMuaW5kZXhPZigiLS0+IiwgaiArIDMpOwogICAgICAgICAgICAgIGlmIChxIDwgMCkgewogICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKFhNTFBhcnNlckVycm9yQ29kZS5VbnRlcm1pbmF0ZWRDb21tZW50KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5vbkNvbW1lbnQocy5zdWJzdHJpbmcoaiArIDMsIHEpKTsKICAgICAgICAgICAgICBqID0gcSArIDM7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocy5zdWJzdHJpbmcoaiArIDEsIGogKyA4KSA9PT0gIltDREFUQVsiKSB7CiAgICAgICAgICAgICAgcSA9IHMuaW5kZXhPZigiXV0+IiwgaiArIDgpOwogICAgICAgICAgICAgIGlmIChxIDwgMCkgewogICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKFhNTFBhcnNlckVycm9yQ29kZS5VbnRlcm1pbmF0ZWRDZGF0KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5vbkNkYXRhKHMuc3Vic3RyaW5nKGogKyA4LCBxKSk7CiAgICAgICAgICAgICAgaiA9IHEgKyAzOwogICAgICAgICAgICB9IGVsc2UgaWYgKHMuc3Vic3RyaW5nKGogKyAxLCBqICsgOCkgPT09ICJET0NUWVBFIikgewogICAgICAgICAgICAgIGNvbnN0IHEyID0gcy5pbmRleE9mKCJbIiwgaiArIDgpOwogICAgICAgICAgICAgIGxldCBjb21wbGV4RG9jdHlwZSA9IGZhbHNlOwogICAgICAgICAgICAgIHEgPSBzLmluZGV4T2YoIj4iLCBqICsgOCk7CiAgICAgICAgICAgICAgaWYgKHEgPCAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoWE1MUGFyc2VyRXJyb3JDb2RlLlVudGVybWluYXRlZERvY3R5cGVEZWNsYXJhdGlvbik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChxMiA+IDAgJiYgcSA+IHEyKSB7CiAgICAgICAgICAgICAgICBxID0gcy5pbmRleE9mKCJdPiIsIGogKyA4KTsKICAgICAgICAgICAgICAgIGlmIChxIDwgMCkgewogICAgICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoWE1MUGFyc2VyRXJyb3JDb2RlLlVudGVybWluYXRlZERvY3R5cGVEZWNsYXJhdGlvbik7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbXBsZXhEb2N0eXBlID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgZG9jdHlwZUNvbnRlbnQgPSBzLnN1YnN0cmluZyhqICsgOCwgcSArIChjb21wbGV4RG9jdHlwZSA/IDEgOiAwKSk7CiAgICAgICAgICAgICAgdGhpcy5vbkRvY3R5cGUoZG9jdHlwZUNvbnRlbnQpOwogICAgICAgICAgICAgIGogPSBxICsgKGNvbXBsZXhEb2N0eXBlID8gMiA6IDEpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuTWFsZm9ybWVkRWxlbWVudCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgY29uc3QgY29udGVudCA9IHRoaXMuX3BhcnNlQ29udGVudChzLCBqKTsKICAgICAgICAgICAgaWYgKGNvbnRlbnQgPT09IG51bGwpIHsKICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoWE1MUGFyc2VyRXJyb3JDb2RlLk1hbGZvcm1lZEVsZW1lbnQpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgaXNDbG9zZWQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHMuc3Vic3RyaW5nKGogKyBjb250ZW50LnBhcnNlZCwgaiArIGNvbnRlbnQucGFyc2VkICsgMikgPT09ICIvPiIpIHsKICAgICAgICAgICAgICBpc0Nsb3NlZCA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocy5zdWJzdHJpbmcoaiArIGNvbnRlbnQucGFyc2VkLCBqICsgY29udGVudC5wYXJzZWQgKyAxKSAhPT0gIj4iKSB7CiAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKFhNTFBhcnNlckVycm9yQ29kZS5VbnRlcm1pbmF0ZWRFbGVtZW50KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5vbkJlZ2luRWxlbWVudChjb250ZW50Lm5hbWUsIGNvbnRlbnQuYXR0cmlidXRlcywgaXNDbG9zZWQpOwogICAgICAgICAgICBqICs9IGNvbnRlbnQucGFyc2VkICsgKGlzQ2xvc2VkID8gMiA6IDEpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2hpbGUgKGogPCBzLmxlbmd0aCAmJiBzW2pdICE9PSAiPCIpIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CiAgICAgICAgY29uc3QgdGV4dCA9IHMuc3Vic3RyaW5nKGksIGopOwogICAgICAgIHRoaXMub25UZXh0KHRoaXMuX3Jlc29sdmVFbnRpdGllcyh0ZXh0KSk7CiAgICAgIH0KICAgICAgaSA9IGo7CiAgICB9CiAgfQogIG9uUmVzb2x2ZUVudGl0eShuYW1lKSB7CiAgICByZXR1cm4gYCYke25hbWV9O2A7CiAgfQogIG9uUGkobmFtZSwgdmFsdWUpIHt9CiAgb25Db21tZW50KHRleHQpIHt9CiAgb25DZGF0YSh0ZXh0KSB7fQogIG9uRG9jdHlwZShkb2N0eXBlQ29udGVudCkge30KICBvblRleHQodGV4dCkge30KICBvbkJlZ2luRWxlbWVudChuYW1lLCBhdHRyaWJ1dGVzLCBpc0VtcHR5KSB7fQogIG9uRW5kRWxlbWVudChuYW1lKSB7fQogIG9uRXJyb3IoY29kZSkge30KfQpjbGFzcyBTaW1wbGVET01Ob2RlIHsKICBjb25zdHJ1Y3Rvcihub2RlTmFtZSwgbm9kZVZhbHVlKSB7CiAgICB0aGlzLm5vZGVOYW1lID0gbm9kZU5hbWU7CiAgICB0aGlzLm5vZGVWYWx1ZSA9IG5vZGVWYWx1ZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAicGFyZW50Tm9kZSIsIHsKICAgICAgdmFsdWU6IG51bGwsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9CiAgZ2V0IGZpcnN0Q2hpbGQoKSB7CiAgICByZXR1cm4gdGhpcy5jaGlsZE5vZGVzPy5bMF07CiAgfQogIGdldCBuZXh0U2libGluZygpIHsKICAgIGNvbnN0IGNoaWxkTm9kZXMgPSB0aGlzLnBhcmVudE5vZGUuY2hpbGROb2RlczsKICAgIGlmICghY2hpbGROb2RlcykgewogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQogICAgY29uc3QgaW5kZXggPSBjaGlsZE5vZGVzLmluZGV4T2YodGhpcyk7CiAgICBpZiAoaW5kZXggPT09IC0xKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICByZXR1cm4gY2hpbGROb2Rlc1tpbmRleCArIDFdOwogIH0KICBnZXQgdGV4dENvbnRlbnQoKSB7CiAgICBpZiAoIXRoaXMuY2hpbGROb2RlcykgewogICAgICByZXR1cm4gdGhpcy5ub2RlVmFsdWUgfHwgIiI7CiAgICB9CiAgICByZXR1cm4gdGhpcy5jaGlsZE5vZGVzLm1hcChjaGlsZCA9PiBjaGlsZC50ZXh0Q29udGVudCkuam9pbigiIik7CiAgfQogIGdldCBjaGlsZHJlbigpIHsKICAgIHJldHVybiB0aGlzLmNoaWxkTm9kZXMgfHwgW107CiAgfQogIGhhc0NoaWxkTm9kZXMoKSB7CiAgICByZXR1cm4gdGhpcy5jaGlsZE5vZGVzPy5sZW5ndGggPiAwOwogIH0KICBzZWFyY2hOb2RlKHBhdGhzLCBwb3MpIHsKICAgIGlmIChwb3MgPj0gcGF0aHMubGVuZ3RoKSB7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgY29uc3QgY29tcG9uZW50ID0gcGF0aHNbcG9zXTsKICAgIGlmIChjb21wb25lbnQubmFtZS5zdGFydHNXaXRoKCIjIikgJiYgcG9zIDwgcGF0aHMubGVuZ3RoIC0gMSkgewogICAgICByZXR1cm4gdGhpcy5zZWFyY2hOb2RlKHBhdGhzLCBwb3MgKyAxKTsKICAgIH0KICAgIGNvbnN0IHN0YWNrID0gW107CiAgICBsZXQgbm9kZSA9IHRoaXM7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBpZiAoY29tcG9uZW50Lm5hbWUgPT09IG5vZGUubm9kZU5hbWUpIHsKICAgICAgICBpZiAoY29tcG9uZW50LnBvcyA9PT0gMCkgewogICAgICAgICAgY29uc3QgcmVzID0gbm9kZS5zZWFyY2hOb2RlKHBhdGhzLCBwb3MgKyAxKTsKICAgICAgICAgIGlmIChyZXMgIT09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHN0YWNrLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IFtwYXJlbnRdID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBsZXQgc2libGluZ1BvcyA9IDA7CiAgICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHBhcmVudC5jaGlsZE5vZGVzKSB7CiAgICAgICAgICAgIGlmIChjb21wb25lbnQubmFtZSA9PT0gY2hpbGQubm9kZU5hbWUpIHsKICAgICAgICAgICAgICBpZiAoc2libGluZ1BvcyA9PT0gY29tcG9uZW50LnBvcykgewogICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkLnNlYXJjaE5vZGUocGF0aHMsIHBvcyArIDEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzaWJsaW5nUG9zKys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBub2RlLnNlYXJjaE5vZGUocGF0aHMsIHBvcyArIDEpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobm9kZS5jaGlsZE5vZGVzPy5sZW5ndGggPiAwKSB7CiAgICAgICAgc3RhY2sucHVzaChbbm9kZSwgMF0pOwogICAgICAgIG5vZGUgPSBub2RlLmNoaWxkTm9kZXNbMF07CiAgICAgIH0gZWxzZSBpZiAoc3RhY2subGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgY29uc3QgW3BhcmVudCwgY3VycmVudFBvc10gPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGNvbnN0IG5ld1BvcyA9IGN1cnJlbnRQb3MgKyAxOwogICAgICAgICAgaWYgKG5ld1BvcyA8IHBhcmVudC5jaGlsZE5vZGVzLmxlbmd0aCkgewogICAgICAgICAgICBzdGFjay5wdXNoKFtwYXJlbnQsIG5ld1Bvc10pOwogICAgICAgICAgICBub2RlID0gcGFyZW50LmNoaWxkTm9kZXNbbmV3UG9zXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChzdGFjay5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICBkdW1wKGJ1ZmZlcikgewogICAgaWYgKHRoaXMubm9kZU5hbWUgPT09ICIjdGV4dCIpIHsKICAgICAgYnVmZmVyLnB1c2goZW5jb2RlVG9YbWxTdHJpbmcodGhpcy5ub2RlVmFsdWUpKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgYnVmZmVyLnB1c2goYDwke3RoaXMubm9kZU5hbWV9YCk7CiAgICBpZiAodGhpcy5hdHRyaWJ1dGVzKSB7CiAgICAgIGZvciAoY29uc3QgYXR0cmlidXRlIG9mIHRoaXMuYXR0cmlidXRlcykgewogICAgICAgIGJ1ZmZlci5wdXNoKGAgJHthdHRyaWJ1dGUubmFtZX09IiR7ZW5jb2RlVG9YbWxTdHJpbmcoYXR0cmlidXRlLnZhbHVlKX0iYCk7CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzLmhhc0NoaWxkTm9kZXMoKSkgewogICAgICBidWZmZXIucHVzaCgiPiIpOwogICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXMuY2hpbGROb2RlcykgewogICAgICAgIGNoaWxkLmR1bXAoYnVmZmVyKTsKICAgICAgfQogICAgICBidWZmZXIucHVzaChgPC8ke3RoaXMubm9kZU5hbWV9PmApOwogICAgfSBlbHNlIGlmICh0aGlzLm5vZGVWYWx1ZSkgewogICAgICBidWZmZXIucHVzaChgPiR7ZW5jb2RlVG9YbWxTdHJpbmcodGhpcy5ub2RlVmFsdWUpfTwvJHt0aGlzLm5vZGVOYW1lfT5gKTsKICAgIH0gZWxzZSB7CiAgICAgIGJ1ZmZlci5wdXNoKCIvPiIpOwogICAgfQogIH0KfQpjbGFzcyBTaW1wbGVYTUxQYXJzZXIgZXh0ZW5kcyBYTUxQYXJzZXJCYXNlIHsKICBjb25zdHJ1Y3Rvcih7CiAgICBoYXNBdHRyaWJ1dGVzID0gZmFsc2UsCiAgICBsb3dlckNhc2VOYW1lID0gZmFsc2UKICB9KSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5fY3VycmVudEZyYWdtZW50ID0gbnVsbDsKICAgIHRoaXMuX3N0YWNrID0gbnVsbDsKICAgIHRoaXMuX2Vycm9yQ29kZSA9IFhNTFBhcnNlckVycm9yQ29kZS5Ob0Vycm9yOwogICAgdGhpcy5faGFzQXR0cmlidXRlcyA9IGhhc0F0dHJpYnV0ZXM7CiAgICB0aGlzLl9sb3dlckNhc2VOYW1lID0gbG93ZXJDYXNlTmFtZTsKICB9CiAgcGFyc2VGcm9tU3RyaW5nKGRhdGEpIHsKICAgIHRoaXMuX2N1cnJlbnRGcmFnbWVudCA9IFtdOwogICAgdGhpcy5fc3RhY2sgPSBbXTsKICAgIHRoaXMuX2Vycm9yQ29kZSA9IFhNTFBhcnNlckVycm9yQ29kZS5Ob0Vycm9yOwogICAgdGhpcy5wYXJzZVhtbChkYXRhKTsKICAgIGlmICh0aGlzLl9lcnJvckNvZGUgIT09IFhNTFBhcnNlckVycm9yQ29kZS5Ob0Vycm9yKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICBjb25zdCBbZG9jdW1lbnRFbGVtZW50XSA9IHRoaXMuX2N1cnJlbnRGcmFnbWVudDsKICAgIGlmICghZG9jdW1lbnRFbGVtZW50KSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICByZXR1cm4gewogICAgICBkb2N1bWVudEVsZW1lbnQKICAgIH07CiAgfQogIG9uVGV4dCh0ZXh0KSB7CiAgICBpZiAoaXNXaGl0ZXNwYWNlU3RyaW5nKHRleHQpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG5vZGUgPSBuZXcgU2ltcGxlRE9NTm9kZSgiI3RleHQiLCB0ZXh0KTsKICAgIHRoaXMuX2N1cnJlbnRGcmFnbWVudC5wdXNoKG5vZGUpOwogIH0KICBvbkNkYXRhKHRleHQpIHsKICAgIGNvbnN0IG5vZGUgPSBuZXcgU2ltcGxlRE9NTm9kZSgiI3RleHQiLCB0ZXh0KTsKICAgIHRoaXMuX2N1cnJlbnRGcmFnbWVudC5wdXNoKG5vZGUpOwogIH0KICBvbkJlZ2luRWxlbWVudChuYW1lLCBhdHRyaWJ1dGVzLCBpc0VtcHR5KSB7CiAgICBpZiAodGhpcy5fbG93ZXJDYXNlTmFtZSkgewogICAgICBuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgfQogICAgY29uc3Qgbm9kZSA9IG5ldyBTaW1wbGVET01Ob2RlKG5hbWUpOwogICAgbm9kZS5jaGlsZE5vZGVzID0gW107CiAgICBpZiAodGhpcy5faGFzQXR0cmlidXRlcykgewogICAgICBub2RlLmF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzOwogICAgfQogICAgdGhpcy5fY3VycmVudEZyYWdtZW50LnB1c2gobm9kZSk7CiAgICBpZiAoaXNFbXB0eSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9zdGFjay5wdXNoKHRoaXMuX2N1cnJlbnRGcmFnbWVudCk7CiAgICB0aGlzLl9jdXJyZW50RnJhZ21lbnQgPSBub2RlLmNoaWxkTm9kZXM7CiAgfQogIG9uRW5kRWxlbWVudChuYW1lKSB7CiAgICB0aGlzLl9jdXJyZW50RnJhZ21lbnQgPSB0aGlzLl9zdGFjay5wb3AoKSB8fCBbXTsKICAgIGNvbnN0IGxhc3RFbGVtZW50ID0gdGhpcy5fY3VycmVudEZyYWdtZW50LmF0KC0xKTsKICAgIGlmICghbGFzdEVsZW1lbnQpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBmb3IgKGNvbnN0IGNoaWxkTm9kZSBvZiBsYXN0RWxlbWVudC5jaGlsZE5vZGVzKSB7CiAgICAgIGNoaWxkTm9kZS5wYXJlbnROb2RlID0gbGFzdEVsZW1lbnQ7CiAgICB9CiAgICByZXR1cm4gbGFzdEVsZW1lbnQ7CiAgfQogIG9uRXJyb3IoY29kZSkgewogICAgdGhpcy5fZXJyb3JDb2RlID0gY29kZTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL21ldGFkYXRhX3BhcnNlci5qcwoKY2xhc3MgTWV0YWRhdGFQYXJzZXIgewogIGNvbnN0cnVjdG9yKGRhdGEpIHsKICAgIGRhdGEgPSB0aGlzLl9yZXBhaXIoZGF0YSk7CiAgICBjb25zdCBwYXJzZXIgPSBuZXcgU2ltcGxlWE1MUGFyc2VyKHsKICAgICAgbG93ZXJDYXNlTmFtZTogdHJ1ZQogICAgfSk7CiAgICBjb25zdCB4bWxEb2N1bWVudCA9IHBhcnNlci5wYXJzZUZyb21TdHJpbmcoZGF0YSk7CiAgICB0aGlzLl9tZXRhZGF0YU1hcCA9IG5ldyBNYXAoKTsKICAgIHRoaXMuX2RhdGEgPSBkYXRhOwogICAgaWYgKHhtbERvY3VtZW50KSB7CiAgICAgIHRoaXMuX3BhcnNlKHhtbERvY3VtZW50KTsKICAgIH0KICB9CiAgX3JlcGFpcihkYXRhKSB7CiAgICByZXR1cm4gZGF0YS5yZXBsYWNlKC9eW148XSsvLCAiIikucmVwbGFjZUFsbCgvPlxcMzc2XFwzNzcoW148XSspL2csIGZ1bmN0aW9uIChhbGwsIGNvZGVzKSB7CiAgICAgIGNvbnN0IGJ5dGVzID0gY29kZXMucmVwbGFjZUFsbCgvXFwoWzAtM10pKFswLTddKShbMC03XSkvZywgZnVuY3Rpb24gKGNvZGUsIGQxLCBkMiwgZDMpIHsKICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShkMSAqIDY0ICsgZDIgKiA4ICsgZDMgKiAxKTsKICAgICAgfSkucmVwbGFjZUFsbCgvJihhbXB8YXBvc3xndHxsdHxxdW90KTsvZywgZnVuY3Rpb24gKHN0ciwgbmFtZSkgewogICAgICAgIHN3aXRjaCAobmFtZSkgewogICAgICAgICAgY2FzZSAiYW1wIjoKICAgICAgICAgICAgcmV0dXJuICImIjsKICAgICAgICAgIGNhc2UgImFwb3MiOgogICAgICAgICAgICByZXR1cm4gIiciOwogICAgICAgICAgY2FzZSAiZ3QiOgogICAgICAgICAgICByZXR1cm4gIj4iOwogICAgICAgICAgY2FzZSAibHQiOgogICAgICAgICAgICByZXR1cm4gIjwiOwogICAgICAgICAgY2FzZSAicXVvdCI6CiAgICAgICAgICAgIHJldHVybiAnIic7CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBFcnJvcihgX3JlcGFpcjogJHtuYW1lfSBpc24ndCBkZWZpbmVkLmApOwogICAgICB9KTsKICAgICAgY29uc3QgY2hhckJ1ZiA9IFsiPiJdOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBieXRlcy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgICAgY29uc3QgY29kZSA9IGJ5dGVzLmNoYXJDb2RlQXQoaSkgKiAyNTYgKyBieXRlcy5jaGFyQ29kZUF0KGkgKyAxKTsKICAgICAgICBpZiAoY29kZSA+PSAzMiAmJiBjb2RlIDwgMTI3ICYmIGNvZGUgIT09IDYwICYmIGNvZGUgIT09IDYyICYmIGNvZGUgIT09IDM4KSB7CiAgICAgICAgICBjaGFyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNoYXJCdWYucHVzaCgiJiN4IiArICgweDEwMDAwICsgY29kZSkudG9TdHJpbmcoMTYpLnN1YnN0cmluZygxKSArICI7Iik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBjaGFyQnVmLmpvaW4oIiIpOwogICAgfSk7CiAgfQogIF9nZXRTZXF1ZW5jZShlbnRyeSkgewogICAgY29uc3QgbmFtZSA9IGVudHJ5Lm5vZGVOYW1lOwogICAgaWYgKG5hbWUgIT09ICJyZGY6YmFnIiAmJiBuYW1lICE9PSAicmRmOnNlcSIgJiYgbmFtZSAhPT0gInJkZjphbHQiKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcmV0dXJuIGVudHJ5LmNoaWxkTm9kZXMuZmlsdGVyKG5vZGUgPT4gbm9kZS5ub2RlTmFtZSA9PT0gInJkZjpsaSIpOwogIH0KICBfcGFyc2VBcnJheShlbnRyeSkgewogICAgaWYgKCFlbnRyeS5oYXNDaGlsZE5vZGVzKCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgW3NlcU5vZGVdID0gZW50cnkuY2hpbGROb2RlczsKICAgIGNvbnN0IHNlcXVlbmNlID0gdGhpcy5fZ2V0U2VxdWVuY2Uoc2VxTm9kZSkgfHwgW107CiAgICB0aGlzLl9tZXRhZGF0YU1hcC5zZXQoZW50cnkubm9kZU5hbWUsIHNlcXVlbmNlLm1hcChub2RlID0+IG5vZGUudGV4dENvbnRlbnQudHJpbSgpKSk7CiAgfQogIF9wYXJzZSh4bWxEb2N1bWVudCkgewogICAgbGV0IHJkZiA9IHhtbERvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKICAgIGlmIChyZGYubm9kZU5hbWUgIT09ICJyZGY6cmRmIikgewogICAgICByZGYgPSByZGYuZmlyc3RDaGlsZDsKICAgICAgd2hpbGUgKHJkZiAmJiByZGYubm9kZU5hbWUgIT09ICJyZGY6cmRmIikgewogICAgICAgIHJkZiA9IHJkZi5uZXh0U2libGluZzsKICAgICAgfQogICAgfQogICAgaWYgKCFyZGYgfHwgcmRmLm5vZGVOYW1lICE9PSAicmRmOnJkZiIgfHwgIXJkZi5oYXNDaGlsZE5vZGVzKCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBkZXNjIG9mIHJkZi5jaGlsZE5vZGVzKSB7CiAgICAgIGlmIChkZXNjLm5vZGVOYW1lICE9PSAicmRmOmRlc2NyaXB0aW9uIikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgZGVzYy5jaGlsZE5vZGVzKSB7CiAgICAgICAgY29uc3QgbmFtZSA9IGVudHJ5Lm5vZGVOYW1lOwogICAgICAgIHN3aXRjaCAobmFtZSkgewogICAgICAgICAgY2FzZSAiI3RleHQiOgogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIGNhc2UgImRjOmNyZWF0b3IiOgogICAgICAgICAgY2FzZSAiZGM6c3ViamVjdCI6CiAgICAgICAgICAgIHRoaXMuX3BhcnNlQXJyYXkoZW50cnkpOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fbWV0YWRhdGFNYXAuc2V0KG5hbWUsIGVudHJ5LnRleHRDb250ZW50LnRyaW0oKSk7CiAgICAgIH0KICAgIH0KICB9CiAgZ2V0IHNlcmlhbGl6YWJsZSgpIHsKICAgIHJldHVybiB7CiAgICAgIHBhcnNlZERhdGE6IHRoaXMuX21ldGFkYXRhTWFwLAogICAgICByYXdEYXRhOiB0aGlzLl9kYXRhCiAgICB9OwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvc3RydWN0X3RyZWUuanMKCgoKCmNvbnN0IE1BWF9ERVBUSCA9IDQwOwpjb25zdCBTdHJ1Y3RFbGVtZW50VHlwZSA9IHsKICBQQUdFX0NPTlRFTlQ6IDEsCiAgU1RSRUFNX0NPTlRFTlQ6IDIsCiAgT0JKRUNUOiAzLAogIEFOTk9UQVRJT046IDQsCiAgRUxFTUVOVDogNQp9OwpjbGFzcyBTdHJ1Y3RUcmVlUm9vdCB7CiAgY29uc3RydWN0b3IoeHJlZiwgcm9vdERpY3QsIHJvb3RSZWYpIHsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLmRpY3QgPSByb290RGljdDsKICAgIHRoaXMucmVmID0gcm9vdFJlZiBpbnN0YW5jZW9mIFJlZiA/IHJvb3RSZWYgOiBudWxsOwogICAgdGhpcy5yb2xlTWFwID0gbmV3IE1hcCgpOwogICAgdGhpcy5zdHJ1Y3RQYXJlbnRJZHMgPSBudWxsOwogIH0KICBpbml0KCkgewogICAgdGhpcy5yZWFkUm9sZU1hcCgpOwogIH0KICAjYWRkSWRUb1BhZ2UocGFnZVJlZiwgaWQsIHR5cGUpIHsKICAgIGlmICghKHBhZ2VSZWYgaW5zdGFuY2VvZiBSZWYpIHx8IGlkIDwgMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnN0cnVjdFBhcmVudElkcyB8fD0gbmV3IFJlZlNldENhY2hlKCk7CiAgICBsZXQgaWRzID0gdGhpcy5zdHJ1Y3RQYXJlbnRJZHMuZ2V0KHBhZ2VSZWYpOwogICAgaWYgKCFpZHMpIHsKICAgICAgaWRzID0gW107CiAgICAgIHRoaXMuc3RydWN0UGFyZW50SWRzLnB1dChwYWdlUmVmLCBpZHMpOwogICAgfQogICAgaWRzLnB1c2goW2lkLCB0eXBlXSk7CiAgfQogIGFkZEFubm90YXRpb25JZFRvUGFnZShwYWdlUmVmLCBpZCkgewogICAgdGhpcy4jYWRkSWRUb1BhZ2UocGFnZVJlZiwgaWQsIFN0cnVjdEVsZW1lbnRUeXBlLkFOTk9UQVRJT04pOwogIH0KICByZWFkUm9sZU1hcCgpIHsKICAgIGNvbnN0IHJvbGVNYXBEaWN0ID0gdGhpcy5kaWN0LmdldCgiUm9sZU1hcCIpOwogICAgaWYgKCEocm9sZU1hcERpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiByb2xlTWFwRGljdCkgewogICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgdGhpcy5yb2xlTWFwLnNldChrZXksIHZhbHVlLm5hbWUpOwogICAgICB9CiAgICB9CiAgfQogIHN0YXRpYyBhc3luYyBjYW5DcmVhdGVTdHJ1Y3R1cmVUcmVlKHsKICAgIGNhdGFsb2dSZWYsCiAgICBwZGZNYW5hZ2VyLAogICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2UKICB9KSB7CiAgICBpZiAoIShjYXRhbG9nUmVmIGluc3RhbmNlb2YgUmVmKSkgewogICAgICB3YXJuKCJDYW5ub3Qgc2F2ZSB0aGUgc3RydWN0IHRyZWU6IG5vIGNhdGFsb2cgcmVmZXJlbmNlLiIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBsZXQgbmV4dEtleSA9IDA7CiAgICBsZXQgaGFzTm90aGluZ1RvVXBkYXRlID0gdHJ1ZTsKICAgIGZvciAoY29uc3QgW3BhZ2VJbmRleCwgZWxlbWVudHNdIG9mIG5ld0Fubm90YXRpb25zQnlQYWdlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICByZWY6IHBhZ2VSZWYKICAgICAgfSA9IGF3YWl0IHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpOwogICAgICBpZiAoIShwYWdlUmVmIGluc3RhbmNlb2YgUmVmKSkgewogICAgICAgIHdhcm4oYENhbm5vdCBzYXZlIHRoZSBzdHJ1Y3QgdHJlZTogcGFnZSAke3BhZ2VJbmRleH0gaGFzIG5vIHJlZi5gKTsKICAgICAgICBoYXNOb3RoaW5nVG9VcGRhdGUgPSB0cnVlOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBlbGVtZW50cykgewogICAgICAgIGlmIChlbGVtZW50LmFjY2Vzc2liaWxpdHlEYXRhPy50eXBlKSB7CiAgICAgICAgICBlbGVtZW50LnBhcmVudFRyZWVJZCA9IG5leHRLZXkrKzsKICAgICAgICAgIGhhc05vdGhpbmdUb1VwZGF0ZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKGhhc05vdGhpbmdUb1VwZGF0ZSkgewogICAgICBmb3IgKGNvbnN0IGVsZW1lbnRzIG9mIG5ld0Fubm90YXRpb25zQnlQYWdlLnZhbHVlcygpKSB7CiAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKSB7CiAgICAgICAgICBkZWxldGUgZWxlbWVudC5wYXJlbnRUcmVlSWQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KICBzdGF0aWMgYXN5bmMgY3JlYXRlU3RydWN0dXJlVHJlZSh7CiAgICBuZXdBbm5vdGF0aW9uc0J5UGFnZSwKICAgIHhyZWYsCiAgICBjYXRhbG9nUmVmLAogICAgcGRmTWFuYWdlciwKICAgIGNoYW5nZXMKICB9KSB7CiAgICBjb25zdCByb290ID0gYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJjbG9uZURpY3QiKTsKICAgIGNvbnN0IGNhY2hlID0gbmV3IFJlZlNldENhY2hlKCk7CiAgICBjYWNoZS5wdXQoY2F0YWxvZ1JlZiwgcm9vdCk7CiAgICBjb25zdCBzdHJ1Y3RUcmVlUm9vdFJlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICByb290LnNldCgiU3RydWN0VHJlZVJvb3QiLCBzdHJ1Y3RUcmVlUm9vdFJlZik7CiAgICBjb25zdCBzdHJ1Y3RUcmVlUm9vdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgc3RydWN0VHJlZVJvb3Quc2V0KCJUeXBlIiwgTmFtZS5nZXQoIlN0cnVjdFRyZWVSb290IikpOwogICAgY29uc3QgcGFyZW50VHJlZVJlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICBzdHJ1Y3RUcmVlUm9vdC5zZXQoIlBhcmVudFRyZWUiLCBwYXJlbnRUcmVlUmVmKTsKICAgIGNvbnN0IGtpZHMgPSBbXTsKICAgIHN0cnVjdFRyZWVSb290LnNldCgiSyIsIGtpZHMpOwogICAgY2FjaGUucHV0KHN0cnVjdFRyZWVSb290UmVmLCBzdHJ1Y3RUcmVlUm9vdCk7CiAgICBjb25zdCBwYXJlbnRUcmVlID0gbmV3IERpY3QoeHJlZik7CiAgICBjb25zdCBudW1zID0gW107CiAgICBwYXJlbnRUcmVlLnNldCgiTnVtcyIsIG51bXMpOwogICAgY29uc3QgbmV4dEtleSA9IGF3YWl0IHRoaXMuI3dyaXRlS2lkcyh7CiAgICAgIG5ld0Fubm90YXRpb25zQnlQYWdlLAogICAgICBzdHJ1Y3RUcmVlUm9vdFJlZiwKICAgICAgc3RydWN0VHJlZVJvb3Q6IG51bGwsCiAgICAgIGtpZHMsCiAgICAgIG51bXMsCiAgICAgIHhyZWYsCiAgICAgIHBkZk1hbmFnZXIsCiAgICAgIGNoYW5nZXMsCiAgICAgIGNhY2hlCiAgICB9KTsKICAgIHN0cnVjdFRyZWVSb290LnNldCgiUGFyZW50VHJlZU5leHRLZXkiLCBuZXh0S2V5KTsKICAgIGNhY2hlLnB1dChwYXJlbnRUcmVlUmVmLCBwYXJlbnRUcmVlKTsKICAgIGZvciAoY29uc3QgW3JlZiwgb2JqXSBvZiBjYWNoZS5pdGVtcygpKSB7CiAgICAgIGNoYW5nZXMucHV0KHJlZiwgewogICAgICAgIGRhdGE6IG9iagogICAgICB9KTsKICAgIH0KICB9CiAgYXN5bmMgY2FuVXBkYXRlU3RydWN0VHJlZSh7CiAgICBwZGZNYW5hZ2VyLAogICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2UKICB9KSB7CiAgICBpZiAoIXRoaXMucmVmKSB7CiAgICAgIHdhcm4oIkNhbm5vdCB1cGRhdGUgdGhlIHN0cnVjdCB0cmVlOiBubyByb290IHJlZmVyZW5jZS4iKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgbGV0IG5leHRLZXkgPSB0aGlzLmRpY3QuZ2V0KCJQYXJlbnRUcmVlTmV4dEtleSIpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKG5leHRLZXkpIHx8IG5leHRLZXkgPCAwKSB7CiAgICAgIHdhcm4oIkNhbm5vdCB1cGRhdGUgdGhlIHN0cnVjdCB0cmVlOiBpbnZhbGlkIG5leHQga2V5LiIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBjb25zdCBwYXJlbnRUcmVlID0gdGhpcy5kaWN0LmdldCgiUGFyZW50VHJlZSIpOwogICAgaWYgKCEocGFyZW50VHJlZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHdhcm4oIkNhbm5vdCB1cGRhdGUgdGhlIHN0cnVjdCB0cmVlOiBQYXJlbnRUcmVlIGlzbid0IGEgZGljdC4iKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgbnVtcyA9IHBhcmVudFRyZWUuZ2V0KCJOdW1zIik7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkobnVtcykpIHsKICAgICAgd2FybigiQ2Fubm90IHVwZGF0ZSB0aGUgc3RydWN0IHRyZWU6IG51bXMgaXNuJ3QgYW4gYXJyYXkuIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGNvbnN0IG51bWJlclRyZWUgPSBuZXcgTnVtYmVyVHJlZShwYXJlbnRUcmVlLCB0aGlzLnhyZWYpOwogICAgZm9yIChjb25zdCBwYWdlSW5kZXggb2YgbmV3QW5ub3RhdGlvbnNCeVBhZ2Uua2V5cygpKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBwYWdlRGljdAogICAgICB9ID0gYXdhaXQgcGRmTWFuYWdlci5nZXRQYWdlKHBhZ2VJbmRleCk7CiAgICAgIGlmICghcGFnZURpY3QuaGFzKCJTdHJ1Y3RQYXJlbnRzIikpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBpZCA9IHBhZ2VEaWN0LmdldCgiU3RydWN0UGFyZW50cyIpOwogICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoaWQpIHx8ICFBcnJheS5pc0FycmF5KG51bWJlclRyZWUuZ2V0KGlkKSkpIHsKICAgICAgICB3YXJuKGBDYW5ub3Qgc2F2ZSB0aGUgc3RydWN0IHRyZWU6IHBhZ2UgJHtwYWdlSW5kZXh9IGhhcyBhIHdyb25nIGlkLmApOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgbGV0IGhhc05vdGhpbmdUb1VwZGF0ZSA9IHRydWU7CiAgICBmb3IgKGNvbnN0IFtwYWdlSW5kZXgsIGVsZW1lbnRzXSBvZiBuZXdBbm5vdGF0aW9uc0J5UGFnZSkgewogICAgICBjb25zdCB7CiAgICAgICAgcGFnZURpY3QKICAgICAgfSA9IGF3YWl0IHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpOwogICAgICBTdHJ1Y3RUcmVlUm9vdC4jY29sbGVjdFBhcmVudHMoewogICAgICAgIGVsZW1lbnRzLAogICAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgICBwYWdlRGljdCwKICAgICAgICBudW1iZXJUcmVlCiAgICAgIH0pOwogICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZWxlbWVudHMpIHsKICAgICAgICBpZiAoZWxlbWVudC5hY2Nlc3NpYmlsaXR5RGF0YT8udHlwZSkgewogICAgICAgICAgaWYgKCEoZWxlbWVudC5hY2Nlc3NpYmlsaXR5RGF0YS5zdHJ1Y3RQYXJlbnQgPj0gMCkpIHsKICAgICAgICAgICAgZWxlbWVudC5wYXJlbnRUcmVlSWQgPSBuZXh0S2V5Kys7CiAgICAgICAgICB9CiAgICAgICAgICBoYXNOb3RoaW5nVG9VcGRhdGUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChoYXNOb3RoaW5nVG9VcGRhdGUpIHsKICAgICAgZm9yIChjb25zdCBlbGVtZW50cyBvZiBuZXdBbm5vdGF0aW9uc0J5UGFnZS52YWx1ZXMoKSkgewogICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBlbGVtZW50cykgewogICAgICAgICAgZGVsZXRlIGVsZW1lbnQucGFyZW50VHJlZUlkOwogICAgICAgICAgZGVsZXRlIGVsZW1lbnQuc3RydWN0VHJlZVBhcmVudDsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogIGFzeW5jIHVwZGF0ZVN0cnVjdHVyZVRyZWUoewogICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2UsCiAgICBwZGZNYW5hZ2VyLAogICAgY2hhbmdlcwogIH0pIHsKICAgIGNvbnN0IHsKICAgICAgcmVmOiBzdHJ1Y3RUcmVlUm9vdFJlZiwKICAgICAgeHJlZgogICAgfSA9IHRoaXM7CiAgICBjb25zdCBzdHJ1Y3RUcmVlUm9vdCA9IHRoaXMuZGljdC5jbG9uZSgpOwogICAgY29uc3QgY2FjaGUgPSBuZXcgUmVmU2V0Q2FjaGUoKTsKICAgIGNhY2hlLnB1dChzdHJ1Y3RUcmVlUm9vdFJlZiwgc3RydWN0VHJlZVJvb3QpOwogICAgbGV0IHBhcmVudFRyZWVSZWYgPSBzdHJ1Y3RUcmVlUm9vdC5nZXRSYXcoIlBhcmVudFRyZWUiKTsKICAgIGxldCBwYXJlbnRUcmVlOwogICAgaWYgKHBhcmVudFRyZWVSZWYgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgcGFyZW50VHJlZSA9IHhyZWYuZmV0Y2gocGFyZW50VHJlZVJlZik7CiAgICB9IGVsc2UgewogICAgICBwYXJlbnRUcmVlID0gcGFyZW50VHJlZVJlZjsKICAgICAgcGFyZW50VHJlZVJlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgIHN0cnVjdFRyZWVSb290LnNldCgiUGFyZW50VHJlZSIsIHBhcmVudFRyZWVSZWYpOwogICAgfQogICAgcGFyZW50VHJlZSA9IHBhcmVudFRyZWUuY2xvbmUoKTsKICAgIGNhY2hlLnB1dChwYXJlbnRUcmVlUmVmLCBwYXJlbnRUcmVlKTsKICAgIGxldCBudW1zID0gcGFyZW50VHJlZS5nZXRSYXcoIk51bXMiKTsKICAgIGxldCBudW1zUmVmID0gbnVsbDsKICAgIGlmIChudW1zIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgIG51bXNSZWYgPSBudW1zOwogICAgICBudW1zID0geHJlZi5mZXRjaChudW1zUmVmKTsKICAgIH0KICAgIG51bXMgPSBudW1zLnNsaWNlKCk7CiAgICBpZiAoIW51bXNSZWYpIHsKICAgICAgcGFyZW50VHJlZS5zZXQoIk51bXMiLCBudW1zKTsKICAgIH0KICAgIGNvbnN0IG5ld05leHRLZXkgPSBhd2FpdCBTdHJ1Y3RUcmVlUm9vdC4jd3JpdGVLaWRzKHsKICAgICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2UsCiAgICAgIHN0cnVjdFRyZWVSb290UmVmLAogICAgICBzdHJ1Y3RUcmVlUm9vdDogdGhpcywKICAgICAga2lkczogbnVsbCwKICAgICAgbnVtcywKICAgICAgeHJlZiwKICAgICAgcGRmTWFuYWdlciwKICAgICAgY2hhbmdlcywKICAgICAgY2FjaGUKICAgIH0pOwogICAgaWYgKG5ld05leHRLZXkgPT09IC0xKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHN0cnVjdFRyZWVSb290LnNldCgiUGFyZW50VHJlZU5leHRLZXkiLCBuZXdOZXh0S2V5KTsKICAgIGlmIChudW1zUmVmKSB7CiAgICAgIGNhY2hlLnB1dChudW1zUmVmLCBudW1zKTsKICAgIH0KICAgIGZvciAoY29uc3QgW3JlZiwgb2JqXSBvZiBjYWNoZS5pdGVtcygpKSB7CiAgICAgIGNoYW5nZXMucHV0KHJlZiwgewogICAgICAgIGRhdGE6IG9iagogICAgICB9KTsKICAgIH0KICB9CiAgc3RhdGljIGFzeW5jICN3cml0ZUtpZHMoewogICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2UsCiAgICBzdHJ1Y3RUcmVlUm9vdFJlZiwKICAgIHN0cnVjdFRyZWVSb290LAogICAga2lkcywKICAgIG51bXMsCiAgICB4cmVmLAogICAgcGRmTWFuYWdlciwKICAgIGNoYW5nZXMsCiAgICBjYWNoZQogIH0pIHsKICAgIGNvbnN0IG9ianIgPSBOYW1lLmdldCgiT0JKUiIpOwogICAgbGV0IG5leHRLZXkgPSAtMTsKICAgIGxldCBzdHJ1Y3RUcmVlUGFnZU9ianM7CiAgICBmb3IgKGNvbnN0IFtwYWdlSW5kZXgsIGVsZW1lbnRzXSBvZiBuZXdBbm5vdGF0aW9uc0J5UGFnZSkgewogICAgICBjb25zdCBwYWdlID0gYXdhaXQgcGRmTWFuYWdlci5nZXRQYWdlKHBhZ2VJbmRleCk7CiAgICAgIGNvbnN0IHsKICAgICAgICByZWY6IHBhZ2VSZWYKICAgICAgfSA9IHBhZ2U7CiAgICAgIGNvbnN0IGlzUGFnZVJlZiA9IHBhZ2VSZWYgaW5zdGFuY2VvZiBSZWY7CiAgICAgIGZvciAoY29uc3QgewogICAgICAgIGFjY2Vzc2liaWxpdHlEYXRhLAogICAgICAgIHJlZiwKICAgICAgICBwYXJlbnRUcmVlSWQsCiAgICAgICAgc3RydWN0VHJlZVBhcmVudAogICAgICB9IG9mIGVsZW1lbnRzKSB7CiAgICAgICAgaWYgKCFhY2Nlc3NpYmlsaXR5RGF0YT8udHlwZSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHsKICAgICAgICAgIHN0cnVjdFBhcmVudAogICAgICAgIH0gPSBhY2Nlc3NpYmlsaXR5RGF0YTsKICAgICAgICBpZiAoc3RydWN0VHJlZVJvb3QgJiYgTnVtYmVyLmlzSW50ZWdlcihzdHJ1Y3RQYXJlbnQpICYmIHN0cnVjdFBhcmVudCA+PSAwKSB7CiAgICAgICAgICBsZXQgb2JqcyA9IChzdHJ1Y3RUcmVlUGFnZU9ianMgfHw9IG5ldyBNYXAoKSkuZ2V0KHBhZ2VJbmRleCk7CiAgICAgICAgICBpZiAob2JqcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGNvbnN0IHN0cnVjdFRyZWVQYWdlID0gbmV3IFN0cnVjdFRyZWVQYWdlKHN0cnVjdFRyZWVSb290LCBwYWdlLnBhZ2VEaWN0KTsKICAgICAgICAgICAgb2JqcyA9IHN0cnVjdFRyZWVQYWdlLmNvbGxlY3RPYmplY3RzKHBhZ2VSZWYpOwogICAgICAgICAgICBzdHJ1Y3RUcmVlUGFnZU9ianMuc2V0KHBhZ2VJbmRleCwgb2Jqcyk7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBvYmpSZWYgPSBvYmpzPy5nZXQoc3RydWN0UGFyZW50KTsKICAgICAgICAgIGlmIChvYmpSZWYpIHsKICAgICAgICAgICAgY29uc3QgdGFnRGljdCA9IHhyZWYuZmV0Y2gob2JqUmVmKS5jbG9uZSgpOwogICAgICAgICAgICBTdHJ1Y3RUcmVlUm9vdC4jd3JpdGVQcm9wZXJ0aWVzKHRhZ0RpY3QsIGFjY2Vzc2liaWxpdHlEYXRhKTsKICAgICAgICAgICAgY2hhbmdlcy5wdXQob2JqUmVmLCB7CiAgICAgICAgICAgICAgZGF0YTogdGFnRGljdAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG5leHRLZXkgPSBNYXRoLm1heChuZXh0S2V5LCBwYXJlbnRUcmVlSWQpOwogICAgICAgIGNvbnN0IHRhZ1JlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgICAgY29uc3QgdGFnRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgICAgIFN0cnVjdFRyZWVSb290LiN3cml0ZVByb3BlcnRpZXModGFnRGljdCwgYWNjZXNzaWJpbGl0eURhdGEpOwogICAgICAgIGF3YWl0IHRoaXMuI3VwZGF0ZVBhcmVudFRhZyh7CiAgICAgICAgICBzdHJ1Y3RUcmVlUGFyZW50LAogICAgICAgICAgdGFnRGljdCwKICAgICAgICAgIG5ld1RhZ1JlZjogdGFnUmVmLAogICAgICAgICAgc3RydWN0VHJlZVJvb3RSZWYsCiAgICAgICAgICBmYWxsYmFja0tpZHM6IGtpZHMsCiAgICAgICAgICB4cmVmLAogICAgICAgICAgY2FjaGUKICAgICAgICB9KTsKICAgICAgICBjb25zdCBvYmpEaWN0ID0gbmV3IERpY3QoeHJlZik7CiAgICAgICAgdGFnRGljdC5zZXQoIksiLCBvYmpEaWN0KTsKICAgICAgICBvYmpEaWN0LnNldCgiVHlwZSIsIG9ianIpOwogICAgICAgIGlmIChpc1BhZ2VSZWYpIHsKICAgICAgICAgIG9iakRpY3Quc2V0KCJQZyIsIHBhZ2VSZWYpOwogICAgICAgIH0KICAgICAgICBvYmpEaWN0LnNldCgiT2JqIiwgcmVmKTsKICAgICAgICBjYWNoZS5wdXQodGFnUmVmLCB0YWdEaWN0KTsKICAgICAgICBudW1zLnB1c2gocGFyZW50VHJlZUlkLCB0YWdSZWYpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbmV4dEtleSArIDE7CiAgfQogIHN0YXRpYyAjd3JpdGVQcm9wZXJ0aWVzKHRhZ0RpY3QsIHsKICAgIHR5cGUsCiAgICB0aXRsZSwKICAgIGxhbmcsCiAgICBhbHQsCiAgICBleHBhbmRlZCwKICAgIGFjdHVhbFRleHQKICB9KSB7CiAgICB0YWdEaWN0LnNldCgiUyIsIE5hbWUuZ2V0KHR5cGUpKTsKICAgIGlmICh0aXRsZSkgewogICAgICB0YWdEaWN0LnNldCgiVCIsIHN0cmluZ1RvQXNjaWlPclVURjE2QkUodGl0bGUpKTsKICAgIH0KICAgIGlmIChsYW5nKSB7CiAgICAgIHRhZ0RpY3Quc2V0KCJMYW5nIiwgc3RyaW5nVG9Bc2NpaU9yVVRGMTZCRShsYW5nKSk7CiAgICB9CiAgICBpZiAoYWx0KSB7CiAgICAgIHRhZ0RpY3Quc2V0KCJBbHQiLCBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKGFsdCkpOwogICAgfQogICAgaWYgKGV4cGFuZGVkKSB7CiAgICAgIHRhZ0RpY3Quc2V0KCJFIiwgc3RyaW5nVG9Bc2NpaU9yVVRGMTZCRShleHBhbmRlZCkpOwogICAgfQogICAgaWYgKGFjdHVhbFRleHQpIHsKICAgICAgdGFnRGljdC5zZXQoIkFjdHVhbFRleHQiLCBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKGFjdHVhbFRleHQpKTsKICAgIH0KICB9CiAgc3RhdGljICNjb2xsZWN0UGFyZW50cyh7CiAgICBlbGVtZW50cywKICAgIHhyZWYsCiAgICBwYWdlRGljdCwKICAgIG51bWJlclRyZWUKICB9KSB7CiAgICBjb25zdCBpZFRvRWxlbWVudHMgPSBuZXcgTWFwKCk7CiAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZWxlbWVudHMpIHsKICAgICAgaWYgKGVsZW1lbnQuc3RydWN0VHJlZVBhcmVudElkKSB7CiAgICAgICAgY29uc3QgaWQgPSBwYXJzZUludChlbGVtZW50LnN0cnVjdFRyZWVQYXJlbnRJZC5zcGxpdCgiX21jIilbMV0sIDEwKTsKICAgICAgICBsZXQgZWxlbXMgPSBpZFRvRWxlbWVudHMuZ2V0KGlkKTsKICAgICAgICBpZiAoIWVsZW1zKSB7CiAgICAgICAgICBlbGVtcyA9IFtdOwogICAgICAgICAgaWRUb0VsZW1lbnRzLnNldChpZCwgZWxlbXMpOwogICAgICAgIH0KICAgICAgICBlbGVtcy5wdXNoKGVsZW1lbnQpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBpZCA9IHBhZ2VEaWN0LmdldCgiU3RydWN0UGFyZW50cyIpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGlkKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBwYXJlbnRBcnJheSA9IG51bWJlclRyZWUuZ2V0KGlkKTsKICAgIGNvbnN0IHVwZGF0ZUVsZW1lbnQgPSAoa2lkLCBwYWdlS2lkLCBraWRSZWYpID0+IHsKICAgICAgY29uc3QgZWxlbXMgPSBpZFRvRWxlbWVudHMuZ2V0KGtpZCk7CiAgICAgIGlmIChlbGVtcykgewogICAgICAgIGNvbnN0IHBhcmVudFJlZiA9IHBhZ2VLaWQuZ2V0UmF3KCJQIik7CiAgICAgICAgY29uc3QgcGFyZW50RGljdCA9IHhyZWYuZmV0Y2hJZlJlZihwYXJlbnRSZWYpOwogICAgICAgIGlmIChwYXJlbnRSZWYgaW5zdGFuY2VvZiBSZWYgJiYgcGFyZW50RGljdCBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHsKICAgICAgICAgICAgcmVmOiBraWRSZWYsCiAgICAgICAgICAgIGRpY3Q6IHBhZ2VLaWQKICAgICAgICAgIH07CiAgICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZWxlbXMpIHsKICAgICAgICAgICAgZWxlbWVudC5zdHJ1Y3RUcmVlUGFyZW50ID0gcGFyYW1zOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwogICAgZm9yIChjb25zdCBraWRSZWYgb2YgcGFyZW50QXJyYXkpIHsKICAgICAgaWYgKCEoa2lkUmVmIGluc3RhbmNlb2YgUmVmKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHBhZ2VLaWQgPSB4cmVmLmZldGNoKGtpZFJlZik7CiAgICAgIGNvbnN0IGsgPSBwYWdlS2lkLmdldCgiSyIpOwogICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihrKSkgewogICAgICAgIHVwZGF0ZUVsZW1lbnQoaywgcGFnZUtpZCwga2lkUmVmKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIUFycmF5LmlzQXJyYXkoaykpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBmb3IgKGxldCBraWQgb2YgaykgewogICAgICAgIGtpZCA9IHhyZWYuZmV0Y2hJZlJlZihraWQpOwogICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGtpZCkgJiYgdXBkYXRlRWxlbWVudChraWQsIHBhZ2VLaWQsIGtpZFJlZikpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoIShraWQgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICghaXNOYW1lKGtpZC5nZXQoIlR5cGUiKSwgIk1DUiIpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgY29uc3QgbWNpZCA9IGtpZC5nZXQoIk1DSUQiKTsKICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihtY2lkKSAmJiB1cGRhdGVFbGVtZW50KG1jaWQsIHBhZ2VLaWQsIGtpZFJlZikpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICBzdGF0aWMgYXN5bmMgI3VwZGF0ZVBhcmVudFRhZyh7CiAgICBzdHJ1Y3RUcmVlUGFyZW50LAogICAgdGFnRGljdCwKICAgIG5ld1RhZ1JlZiwKICAgIHN0cnVjdFRyZWVSb290UmVmLAogICAgZmFsbGJhY2tLaWRzLAogICAgeHJlZiwKICAgIGNhY2hlCiAgfSkgewogICAgbGV0IHJlZiA9IG51bGw7CiAgICBsZXQgcGFyZW50UmVmOwogICAgaWYgKHN0cnVjdFRyZWVQYXJlbnQpIHsKICAgICAgKHsKICAgICAgICByZWYKICAgICAgfSA9IHN0cnVjdFRyZWVQYXJlbnQpOwogICAgICBwYXJlbnRSZWYgPSBzdHJ1Y3RUcmVlUGFyZW50LmRpY3QuZ2V0UmF3KCJQIikgfHwgc3RydWN0VHJlZVJvb3RSZWY7CiAgICB9IGVsc2UgewogICAgICBwYXJlbnRSZWYgPSBzdHJ1Y3RUcmVlUm9vdFJlZjsKICAgIH0KICAgIHRhZ0RpY3Quc2V0KCJQIiwgcGFyZW50UmVmKTsKICAgIGNvbnN0IHBhcmVudERpY3QgPSB4cmVmLmZldGNoSWZSZWYocGFyZW50UmVmKTsKICAgIGlmICghcGFyZW50RGljdCkgewogICAgICBmYWxsYmFja0tpZHMucHVzaChuZXdUYWdSZWYpOwogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgY2FjaGVkUGFyZW50RGljdCA9IGNhY2hlLmdldChwYXJlbnRSZWYpOwogICAgaWYgKCFjYWNoZWRQYXJlbnREaWN0KSB7CiAgICAgIGNhY2hlZFBhcmVudERpY3QgPSBwYXJlbnREaWN0LmNsb25lKCk7CiAgICAgIGNhY2hlLnB1dChwYXJlbnRSZWYsIGNhY2hlZFBhcmVudERpY3QpOwogICAgfQogICAgY29uc3QgcGFyZW50S2lkc1JhdyA9IGNhY2hlZFBhcmVudERpY3QuZ2V0UmF3KCJLIik7CiAgICBsZXQgY2FjaGVkUGFyZW50S2lkcyA9IHBhcmVudEtpZHNSYXcgaW5zdGFuY2VvZiBSZWYgPyBjYWNoZS5nZXQocGFyZW50S2lkc1JhdykgOiBudWxsOwogICAgaWYgKCFjYWNoZWRQYXJlbnRLaWRzKSB7CiAgICAgIGNhY2hlZFBhcmVudEtpZHMgPSB4cmVmLmZldGNoSWZSZWYocGFyZW50S2lkc1Jhdyk7CiAgICAgIGNhY2hlZFBhcmVudEtpZHMgPSBBcnJheS5pc0FycmF5KGNhY2hlZFBhcmVudEtpZHMpID8gY2FjaGVkUGFyZW50S2lkcy5zbGljZSgpIDogW3BhcmVudEtpZHNSYXddOwogICAgICBjb25zdCBwYXJlbnRLaWRzUmVmID0geHJlZi5nZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgICAgY2FjaGVkUGFyZW50RGljdC5zZXQoIksiLCBwYXJlbnRLaWRzUmVmKTsKICAgICAgY2FjaGUucHV0KHBhcmVudEtpZHNSZWYsIGNhY2hlZFBhcmVudEtpZHMpOwogICAgfQogICAgY29uc3QgaW5kZXggPSBjYWNoZWRQYXJlbnRLaWRzLmluZGV4T2YocmVmKTsKICAgIGNhY2hlZFBhcmVudEtpZHMuc3BsaWNlKGluZGV4ID49IDAgPyBpbmRleCArIDEgOiBjYWNoZWRQYXJlbnRLaWRzLmxlbmd0aCwgMCwgbmV3VGFnUmVmKTsKICB9Cn0KY2xhc3MgU3RydWN0RWxlbWVudE5vZGUgewogIGNvbnN0cnVjdG9yKHRyZWUsIGRpY3QpIHsKICAgIHRoaXMudHJlZSA9IHRyZWU7CiAgICB0aGlzLnhyZWYgPSB0cmVlLnhyZWY7CiAgICB0aGlzLmRpY3QgPSBkaWN0OwogICAgdGhpcy5raWRzID0gW107CiAgICB0aGlzLnBhcnNlS2lkcygpOwogIH0KICBnZXQgcm9sZSgpIHsKICAgIGNvbnN0IG5hbWVPYmogPSB0aGlzLmRpY3QuZ2V0KCJTIik7CiAgICBjb25zdCBuYW1lID0gbmFtZU9iaiBpbnN0YW5jZW9mIE5hbWUgPyBuYW1lT2JqLm5hbWUgOiAiIjsKICAgIGNvbnN0IHsKICAgICAgcm9vdAogICAgfSA9IHRoaXMudHJlZTsKICAgIHJldHVybiByb290LnJvbGVNYXAuZ2V0KG5hbWUpID8/IG5hbWU7CiAgfQogIHBhcnNlS2lkcygpIHsKICAgIGxldCBwYWdlT2JqSWQgPSBudWxsOwogICAgY29uc3Qgb2JqUmVmID0gdGhpcy5kaWN0LmdldFJhdygiUGciKTsKICAgIGlmIChvYmpSZWYgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgcGFnZU9iaklkID0gb2JqUmVmLnRvU3RyaW5nKCk7CiAgICB9CiAgICBjb25zdCBraWRzID0gdGhpcy5kaWN0LmdldCgiSyIpOwogICAgaWYgKEFycmF5LmlzQXJyYXkoa2lkcykpIHsKICAgICAgZm9yIChjb25zdCBraWQgb2Yga2lkcykgewogICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLnBhcnNlS2lkKHBhZ2VPYmpJZCwgdGhpcy54cmVmLmZldGNoSWZSZWYoa2lkKSk7CiAgICAgICAgaWYgKGVsZW1lbnQpIHsKICAgICAgICAgIHRoaXMua2lkcy5wdXNoKGVsZW1lbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMucGFyc2VLaWQocGFnZU9iaklkLCBraWRzKTsKICAgICAgaWYgKGVsZW1lbnQpIHsKICAgICAgICB0aGlzLmtpZHMucHVzaChlbGVtZW50KTsKICAgICAgfQogICAgfQogIH0KICBwYXJzZUtpZChwYWdlT2JqSWQsIGtpZCkgewogICAgaWYgKE51bWJlci5pc0ludGVnZXIoa2lkKSkgewogICAgICBpZiAodGhpcy50cmVlLnBhZ2VEaWN0Lm9iaklkICE9PSBwYWdlT2JqSWQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gbmV3IFN0cnVjdEVsZW1lbnQoewogICAgICAgIHR5cGU6IFN0cnVjdEVsZW1lbnRUeXBlLlBBR0VfQ09OVEVOVCwKICAgICAgICBtY2lkOiBraWQsCiAgICAgICAgcGFnZU9iaklkCiAgICAgIH0pOwogICAgfQogICAgaWYgKCEoa2lkIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBwYWdlUmVmID0ga2lkLmdldFJhdygiUGciKTsKICAgIGlmIChwYWdlUmVmIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgIHBhZ2VPYmpJZCA9IHBhZ2VSZWYudG9TdHJpbmcoKTsKICAgIH0KICAgIGNvbnN0IHR5cGUgPSBraWQuZ2V0KCJUeXBlIikgaW5zdGFuY2VvZiBOYW1lID8ga2lkLmdldCgiVHlwZSIpLm5hbWUgOiBudWxsOwogICAgaWYgKHR5cGUgPT09ICJNQ1IiKSB7CiAgICAgIGlmICh0aGlzLnRyZWUucGFnZURpY3Qub2JqSWQgIT09IHBhZ2VPYmpJZCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IGtpZFJlZiA9IGtpZC5nZXRSYXcoIlN0bSIpOwogICAgICByZXR1cm4gbmV3IFN0cnVjdEVsZW1lbnQoewogICAgICAgIHR5cGU6IFN0cnVjdEVsZW1lbnRUeXBlLlNUUkVBTV9DT05URU5ULAogICAgICAgIHJlZk9iaklkOiBraWRSZWYgaW5zdGFuY2VvZiBSZWYgPyBraWRSZWYudG9TdHJpbmcoKSA6IG51bGwsCiAgICAgICAgcGFnZU9iaklkLAogICAgICAgIG1jaWQ6IGtpZC5nZXQoIk1DSUQiKQogICAgICB9KTsKICAgIH0KICAgIGlmICh0eXBlID09PSAiT0JKUiIpIHsKICAgICAgaWYgKHRoaXMudHJlZS5wYWdlRGljdC5vYmpJZCAhPT0gcGFnZU9iaklkKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3Qga2lkUmVmID0ga2lkLmdldFJhdygiT2JqIik7CiAgICAgIHJldHVybiBuZXcgU3RydWN0RWxlbWVudCh7CiAgICAgICAgdHlwZTogU3RydWN0RWxlbWVudFR5cGUuT0JKRUNULAogICAgICAgIHJlZk9iaklkOiBraWRSZWYgaW5zdGFuY2VvZiBSZWYgPyBraWRSZWYudG9TdHJpbmcoKSA6IG51bGwsCiAgICAgICAgcGFnZU9iaklkCiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIG5ldyBTdHJ1Y3RFbGVtZW50KHsKICAgICAgdHlwZTogU3RydWN0RWxlbWVudFR5cGUuRUxFTUVOVCwKICAgICAgZGljdDoga2lkCiAgICB9KTsKICB9Cn0KY2xhc3MgU3RydWN0RWxlbWVudCB7CiAgY29uc3RydWN0b3IoewogICAgdHlwZSwKICAgIGRpY3QgPSBudWxsLAogICAgbWNpZCA9IG51bGwsCiAgICBwYWdlT2JqSWQgPSBudWxsLAogICAgcmVmT2JqSWQgPSBudWxsCiAgfSkgewogICAgdGhpcy50eXBlID0gdHlwZTsKICAgIHRoaXMuZGljdCA9IGRpY3Q7CiAgICB0aGlzLm1jaWQgPSBtY2lkOwogICAgdGhpcy5wYWdlT2JqSWQgPSBwYWdlT2JqSWQ7CiAgICB0aGlzLnJlZk9iaklkID0gcmVmT2JqSWQ7CiAgICB0aGlzLnBhcmVudE5vZGUgPSBudWxsOwogIH0KfQpjbGFzcyBTdHJ1Y3RUcmVlUGFnZSB7CiAgY29uc3RydWN0b3Ioc3RydWN0VHJlZVJvb3QsIHBhZ2VEaWN0KSB7CiAgICB0aGlzLnJvb3QgPSBzdHJ1Y3RUcmVlUm9vdDsKICAgIHRoaXMueHJlZiA9IHN0cnVjdFRyZWVSb290Py54cmVmID8/IG51bGw7CiAgICB0aGlzLnJvb3REaWN0ID0gc3RydWN0VHJlZVJvb3Q/LmRpY3QgPz8gbnVsbDsKICAgIHRoaXMucGFnZURpY3QgPSBwYWdlRGljdDsKICAgIHRoaXMubm9kZXMgPSBbXTsKICB9CiAgY29sbGVjdE9iamVjdHMocGFnZVJlZikgewogICAgaWYgKCF0aGlzLnJvb3QgfHwgIXRoaXMucm9vdERpY3QgfHwgIShwYWdlUmVmIGluc3RhbmNlb2YgUmVmKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHBhcmVudFRyZWUgPSB0aGlzLnJvb3REaWN0LmdldCgiUGFyZW50VHJlZSIpOwogICAgaWYgKCFwYXJlbnRUcmVlKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgaWRzID0gdGhpcy5yb290LnN0cnVjdFBhcmVudElkcz8uZ2V0KHBhZ2VSZWYpOwogICAgaWYgKCFpZHMpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBtYXAgPSBuZXcgTWFwKCk7CiAgICBjb25zdCBudW1iZXJUcmVlID0gbmV3IE51bWJlclRyZWUocGFyZW50VHJlZSwgdGhpcy54cmVmKTsKICAgIGZvciAoY29uc3QgW2VsZW1JZF0gb2YgaWRzKSB7CiAgICAgIGNvbnN0IG9iaiA9IG51bWJlclRyZWUuZ2V0UmF3KGVsZW1JZCk7CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICBtYXAuc2V0KGVsZW1JZCwgb2JqKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG1hcDsKICB9CiAgcGFyc2UocGFnZVJlZikgewogICAgaWYgKCF0aGlzLnJvb3QgfHwgIXRoaXMucm9vdERpY3QgfHwgIShwYWdlUmVmIGluc3RhbmNlb2YgUmVmKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBwYXJlbnRUcmVlID0gdGhpcy5yb290RGljdC5nZXQoIlBhcmVudFRyZWUiKTsKICAgIGlmICghcGFyZW50VHJlZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBpZCA9IHRoaXMucGFnZURpY3QuZ2V0KCJTdHJ1Y3RQYXJlbnRzIik7CiAgICBjb25zdCBpZHMgPSB0aGlzLnJvb3Quc3RydWN0UGFyZW50SWRzPy5nZXQocGFnZVJlZik7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoaWQpICYmICFpZHMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgbWFwID0gbmV3IE1hcCgpOwogICAgY29uc3QgbnVtYmVyVHJlZSA9IG5ldyBOdW1iZXJUcmVlKHBhcmVudFRyZWUsIHRoaXMueHJlZik7CiAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihpZCkpIHsKICAgICAgY29uc3QgcGFyZW50QXJyYXkgPSBudW1iZXJUcmVlLmdldChpZCk7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhcmVudEFycmF5KSkgewogICAgICAgIGZvciAoY29uc3QgcmVmIG9mIHBhcmVudEFycmF5KSB7CiAgICAgICAgICBpZiAocmVmIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgIHRoaXMuYWRkTm9kZSh0aGlzLnhyZWYuZmV0Y2gocmVmKSwgbWFwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmICghaWRzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAoY29uc3QgW2VsZW1JZCwgdHlwZV0gb2YgaWRzKSB7CiAgICAgIGNvbnN0IG9iaiA9IG51bWJlclRyZWUuZ2V0KGVsZW1JZCk7CiAgICAgIGlmIChvYmopIHsKICAgICAgICBjb25zdCBlbGVtID0gdGhpcy5hZGROb2RlKHRoaXMueHJlZi5mZXRjaElmUmVmKG9iaiksIG1hcCk7CiAgICAgICAgaWYgKGVsZW0/LmtpZHM/Lmxlbmd0aCA9PT0gMSAmJiBlbGVtLmtpZHNbMF0udHlwZSA9PT0gU3RydWN0RWxlbWVudFR5cGUuT0JKRUNUKSB7CiAgICAgICAgICBlbGVtLmtpZHNbMF0udHlwZSA9IHR5cGU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIGFkZE5vZGUoZGljdCwgbWFwLCBsZXZlbCA9IDApIHsKICAgIGlmIChsZXZlbCA+IE1BWF9ERVBUSCkgewogICAgICB3YXJuKCJTdHJ1Y3RUcmVlIE1BWF9ERVBUSCByZWFjaGVkLiIpOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmICghKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChtYXAuaGFzKGRpY3QpKSB7CiAgICAgIHJldHVybiBtYXAuZ2V0KGRpY3QpOwogICAgfQogICAgY29uc3QgZWxlbWVudCA9IG5ldyBTdHJ1Y3RFbGVtZW50Tm9kZSh0aGlzLCBkaWN0KTsKICAgIG1hcC5zZXQoZGljdCwgZWxlbWVudCk7CiAgICBjb25zdCBwYXJlbnQgPSBkaWN0LmdldCgiUCIpOwogICAgaWYgKCEocGFyZW50IGluc3RhbmNlb2YgRGljdCkgfHwgaXNOYW1lKHBhcmVudC5nZXQoIlR5cGUiKSwgIlN0cnVjdFRyZWVSb290IikpIHsKICAgICAgaWYgKCF0aGlzLmFkZFRvcExldmVsTm9kZShkaWN0LCBlbGVtZW50KSkgewogICAgICAgIG1hcC5kZWxldGUoZGljdCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGVsZW1lbnQ7CiAgICB9CiAgICBjb25zdCBwYXJlbnROb2RlID0gdGhpcy5hZGROb2RlKHBhcmVudCwgbWFwLCBsZXZlbCArIDEpOwogICAgaWYgKCFwYXJlbnROb2RlKSB7CiAgICAgIHJldHVybiBlbGVtZW50OwogICAgfQogICAgbGV0IHNhdmUgPSBmYWxzZTsKICAgIGZvciAoY29uc3Qga2lkIG9mIHBhcmVudE5vZGUua2lkcykgewogICAgICBpZiAoa2lkLnR5cGUgPT09IFN0cnVjdEVsZW1lbnRUeXBlLkVMRU1FTlQgJiYga2lkLmRpY3QgPT09IGRpY3QpIHsKICAgICAgICBraWQucGFyZW50Tm9kZSA9IGVsZW1lbnQ7CiAgICAgICAgc2F2ZSA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIGlmICghc2F2ZSkgewogICAgICBtYXAuZGVsZXRlKGRpY3QpOwogICAgfQogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfQogIGFkZFRvcExldmVsTm9kZShkaWN0LCBlbGVtZW50KSB7CiAgICBjb25zdCBvYmogPSB0aGlzLnJvb3REaWN0LmdldCgiSyIpOwogICAgaWYgKCFvYmopIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgaWYgKG9iai5vYmpJZCAhPT0gZGljdC5vYmpJZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICB0aGlzLm5vZGVzWzBdID0gZWxlbWVudDsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAoIUFycmF5LmlzQXJyYXkob2JqKSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGxldCBzYXZlID0gZmFsc2U7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9iai5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCBraWRSZWYgPSBvYmpbaV07CiAgICAgIGlmIChraWRSZWY/LnRvU3RyaW5nKCkgPT09IGRpY3Qub2JqSWQpIHsKICAgICAgICB0aGlzLm5vZGVzW2ldID0gZWxlbWVudDsKICAgICAgICBzYXZlID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHNhdmU7CiAgfQogIGdldCBzZXJpYWxpemFibGUoKSB7CiAgICBmdW5jdGlvbiBub2RlVG9TZXJpYWxpemFibGUobm9kZSwgcGFyZW50LCBsZXZlbCA9IDApIHsKICAgICAgaWYgKGxldmVsID4gTUFYX0RFUFRIKSB7CiAgICAgICAgd2FybigiU3RydWN0VHJlZSB0b28gZGVlcCB0byBiZSBmdWxseSBzZXJpYWxpemVkLiIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBvYmogPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBvYmoucm9sZSA9IG5vZGUucm9sZTsKICAgICAgb2JqLmNoaWxkcmVuID0gW107CiAgICAgIHBhcmVudC5jaGlsZHJlbi5wdXNoKG9iaik7CiAgICAgIGxldCBhbHQgPSBub2RlLmRpY3QuZ2V0KCJBbHQiKTsKICAgICAgaWYgKHR5cGVvZiBhbHQgIT09ICJzdHJpbmciKSB7CiAgICAgICAgYWx0ID0gbm9kZS5kaWN0LmdldCgiQWN0dWFsVGV4dCIpOwogICAgICB9CiAgICAgIGlmICh0eXBlb2YgYWx0ID09PSAic3RyaW5nIikgewogICAgICAgIG9iai5hbHQgPSBzdHJpbmdUb1BERlN0cmluZyhhbHQpOwogICAgICB9CiAgICAgIGNvbnN0IGEgPSBub2RlLmRpY3QuZ2V0KCJBIik7CiAgICAgIGlmIChhIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgIGNvbnN0IGJib3ggPSBsb29rdXBOb3JtYWxSZWN0KGEuZ2V0QXJyYXkoIkJCb3giKSwgbnVsbCk7CiAgICAgICAgaWYgKGJib3gpIHsKICAgICAgICAgIG9iai5iYm94ID0gYmJveDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3Qgd2lkdGggPSBhLmdldCgiV2lkdGgiKTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IGEuZ2V0KCJIZWlnaHQiKTsKICAgICAgICAgIGlmICh0eXBlb2Ygd2lkdGggPT09ICJudW1iZXIiICYmIHdpZHRoID4gMCAmJiB0eXBlb2YgaGVpZ2h0ID09PSAibnVtYmVyIiAmJiBoZWlnaHQgPiAwKSB7CiAgICAgICAgICAgIG9iai5iYm94ID0gWzAsIDAsIHdpZHRoLCBoZWlnaHRdOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBsYW5nID0gbm9kZS5kaWN0LmdldCgiTGFuZyIpOwogICAgICBpZiAodHlwZW9mIGxhbmcgPT09ICJzdHJpbmciKSB7CiAgICAgICAgb2JqLmxhbmcgPSBzdHJpbmdUb1BERlN0cmluZyhsYW5nKTsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IGtpZCBvZiBub2RlLmtpZHMpIHsKICAgICAgICBjb25zdCBraWRFbGVtZW50ID0ga2lkLnR5cGUgPT09IFN0cnVjdEVsZW1lbnRUeXBlLkVMRU1FTlQgPyBraWQucGFyZW50Tm9kZSA6IG51bGw7CiAgICAgICAgaWYgKGtpZEVsZW1lbnQpIHsKICAgICAgICAgIG5vZGVUb1NlcmlhbGl6YWJsZShraWRFbGVtZW50LCBvYmosIGxldmVsICsgMSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IGVsc2UgaWYgKGtpZC50eXBlID09PSBTdHJ1Y3RFbGVtZW50VHlwZS5QQUdFX0NPTlRFTlQgfHwga2lkLnR5cGUgPT09IFN0cnVjdEVsZW1lbnRUeXBlLlNUUkVBTV9DT05URU5UKSB7CiAgICAgICAgICBvYmouY2hpbGRyZW4ucHVzaCh7CiAgICAgICAgICAgIHR5cGU6ICJjb250ZW50IiwKICAgICAgICAgICAgaWQ6IGBwJHtraWQucGFnZU9iaklkfV9tYyR7a2lkLm1jaWR9YAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChraWQudHlwZSA9PT0gU3RydWN0RWxlbWVudFR5cGUuT0JKRUNUKSB7CiAgICAgICAgICBvYmouY2hpbGRyZW4ucHVzaCh7CiAgICAgICAgICAgIHR5cGU6ICJvYmplY3QiLAogICAgICAgICAgICBpZDoga2lkLnJlZk9iaklkCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKGtpZC50eXBlID09PSBTdHJ1Y3RFbGVtZW50VHlwZS5BTk5PVEFUSU9OKSB7CiAgICAgICAgICBvYmouY2hpbGRyZW4ucHVzaCh7CiAgICAgICAgICAgIHR5cGU6ICJhbm5vdGF0aW9uIiwKICAgICAgICAgICAgaWQ6IGAke0Fubm90YXRpb25QcmVmaXh9JHtraWQucmVmT2JqSWR9YAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBjb25zdCByb290ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHJvb3QuY2hpbGRyZW4gPSBbXTsKICAgIHJvb3Qucm9sZSA9ICJSb290IjsKICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpcy5ub2RlcykgewogICAgICBpZiAoIWNoaWxkKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgbm9kZVRvU2VyaWFsaXphYmxlKGNoaWxkLCByb290KTsKICAgIH0KICAgIHJldHVybiByb290OwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY2F0YWxvZy5qcwoKCgoKCgoKCgoKCmNvbnN0IGlzUmVmID0gdiA9PiB2IGluc3RhbmNlb2YgUmVmOwpjb25zdCBpc1ZhbGlkRXhwbGljaXREZXN0ID0gX2lzVmFsaWRFeHBsaWNpdERlc3QuYmluZChudWxsLCBpc1JlZiwgaXNOYW1lKTsKZnVuY3Rpb24gZmV0Y2hEZXN0KGRlc3QpIHsKICBpZiAoZGVzdCBpbnN0YW5jZW9mIERpY3QpIHsKICAgIGRlc3QgPSBkZXN0LmdldCgiRCIpOwogIH0KICByZXR1cm4gaXNWYWxpZEV4cGxpY2l0RGVzdChkZXN0KSA/IGRlc3QgOiBudWxsOwp9CmZ1bmN0aW9uIGZldGNoUmVtb3RlRGVzdChhY3Rpb24pIHsKICBsZXQgZGVzdCA9IGFjdGlvbi5nZXQoIkQiKTsKICBpZiAoZGVzdCkgewogICAgaWYgKGRlc3QgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgIGRlc3QgPSBkZXN0Lm5hbWU7CiAgICB9CiAgICBpZiAodHlwZW9mIGRlc3QgPT09ICJzdHJpbmciKSB7CiAgICAgIHJldHVybiBzdHJpbmdUb1BERlN0cmluZyhkZXN0LCB0cnVlKTsKICAgIH0gZWxzZSBpZiAoaXNWYWxpZEV4cGxpY2l0RGVzdChkZXN0KSkgewogICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZGVzdCk7CiAgICB9CiAgfQogIHJldHVybiBudWxsOwp9CmNsYXNzIENhdGFsb2cgewogICNhY3R1YWxOdW1QYWdlcyA9IG51bGw7CiAgI2NhdERpY3QgPSBudWxsOwogIGJ1aWx0SW5DTWFwQ2FjaGUgPSBuZXcgTWFwKCk7CiAgZm9udENhY2hlID0gbmV3IFJlZlNldENhY2hlKCk7CiAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlID0gbmV3IEdsb2JhbENvbG9yU3BhY2VDYWNoZSgpOwogIGdsb2JhbEltYWdlQ2FjaGUgPSBuZXcgR2xvYmFsSW1hZ2VDYWNoZSgpOwogIG5vbkJsZW5kTW9kZXNTZXQgPSBuZXcgUmVmU2V0KCk7CiAgcGFnZURpY3RDYWNoZSA9IG5ldyBSZWZTZXRDYWNoZSgpOwogIHBhZ2VJbmRleENhY2hlID0gbmV3IFJlZlNldENhY2hlKCk7CiAgcGFnZUtpZHNDb3VudENhY2hlID0gbmV3IFJlZlNldENhY2hlKCk7CiAgc3RhbmRhcmRGb250RGF0YUNhY2hlID0gbmV3IE1hcCgpOwogIHN5c3RlbUZvbnRDYWNoZSA9IG5ldyBNYXAoKTsKICBjb25zdHJ1Y3RvcihwZGZNYW5hZ2VyLCB4cmVmKSB7CiAgICB0aGlzLnBkZk1hbmFnZXIgPSBwZGZNYW5hZ2VyOwogICAgdGhpcy54cmVmID0geHJlZjsKICAgIHRoaXMuI2NhdERpY3QgPSB4cmVmLmdldENhdGFsb2dPYmooKTsKICAgIGlmICghKHRoaXMuI2NhdERpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkNhdGFsb2cgb2JqZWN0IGlzIG5vdCBhIGRpY3Rpb25hcnkuIik7CiAgICB9CiAgICB0aGlzLnRvcGxldmVsUGFnZXNEaWN0OwogIH0KICBjbG9uZURpY3QoKSB7CiAgICByZXR1cm4gdGhpcy4jY2F0RGljdC5jbG9uZSgpOwogIH0KICBnZXQgdmVyc2lvbigpIHsKICAgIGNvbnN0IHZlcnNpb24gPSB0aGlzLiNjYXREaWN0LmdldCgiVmVyc2lvbiIpOwogICAgaWYgKHZlcnNpb24gaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgIGlmIChQREZfVkVSU0lPTl9SRUdFWFAudGVzdCh2ZXJzaW9uLm5hbWUpKSB7CiAgICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAidmVyc2lvbiIsIHZlcnNpb24ubmFtZSk7CiAgICAgIH0KICAgICAgd2FybihgSW52YWxpZCBQREYgY2F0YWxvZyB2ZXJzaW9uOiAke3ZlcnNpb24ubmFtZX1gKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInZlcnNpb24iLCBudWxsKTsKICB9CiAgZ2V0IGxhbmcoKSB7CiAgICBjb25zdCBsYW5nID0gdGhpcy4jY2F0RGljdC5nZXQoIkxhbmciKTsKICAgIHJldHVybiBzaGFkb3codGhpcywgImxhbmciLCBsYW5nICYmIHR5cGVvZiBsYW5nID09PSAic3RyaW5nIiA/IHN0cmluZ1RvUERGU3RyaW5nKGxhbmcpIDogbnVsbCk7CiAgfQogIGdldCBuZWVkc1JlbmRlcmluZygpIHsKICAgIGNvbnN0IG5lZWRzUmVuZGVyaW5nID0gdGhpcy4jY2F0RGljdC5nZXQoIk5lZWRzUmVuZGVyaW5nIik7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJuZWVkc1JlbmRlcmluZyIsIHR5cGVvZiBuZWVkc1JlbmRlcmluZyA9PT0gImJvb2xlYW4iID8gbmVlZHNSZW5kZXJpbmcgOiBmYWxzZSk7CiAgfQogIGdldCBjb2xsZWN0aW9uKCkgewogICAgbGV0IGNvbGxlY3Rpb24gPSBudWxsOwogICAgdHJ5IHsKICAgICAgY29uc3Qgb2JqID0gdGhpcy4jY2F0RGljdC5nZXQoIkNvbGxlY3Rpb24iKTsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QgJiYgb2JqLnNpemUgPiAwKSB7CiAgICAgICAgY29sbGVjdGlvbiA9IG9iajsKICAgICAgfQogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICBpbmZvKCJDYW5ub3QgZmV0Y2ggQ29sbGVjdGlvbiBlbnRyeTsgYXNzdW1pbmcgbm8gY29sbGVjdGlvbiBpcyBwcmVzZW50LiIpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiY29sbGVjdGlvbiIsIGNvbGxlY3Rpb24pOwogIH0KICBnZXQgYWNyb0Zvcm0oKSB7CiAgICBsZXQgYWNyb0Zvcm0gPSBudWxsOwogICAgdHJ5IHsKICAgICAgY29uc3Qgb2JqID0gdGhpcy4jY2F0RGljdC5nZXQoIkFjcm9Gb3JtIik7CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBEaWN0ICYmIG9iai5zaXplID4gMCkgewogICAgICAgIGFjcm9Gb3JtID0gb2JqOwogICAgICB9CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIGluZm8oIkNhbm5vdCBmZXRjaCBBY3JvRm9ybSBlbnRyeTsgYXNzdW1pbmcgbm8gZm9ybXMgYXJlIHByZXNlbnQuIik7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJhY3JvRm9ybSIsIGFjcm9Gb3JtKTsKICB9CiAgZ2V0IGFjcm9Gb3JtUmVmKCkgewogICAgY29uc3QgdmFsdWUgPSB0aGlzLiNjYXREaWN0LmdldFJhdygiQWNyb0Zvcm0iKTsKICAgIHJldHVybiBzaGFkb3codGhpcywgImFjcm9Gb3JtUmVmIiwgdmFsdWUgaW5zdGFuY2VvZiBSZWYgPyB2YWx1ZSA6IG51bGwpOwogIH0KICBnZXQgbWV0YWRhdGEoKSB7CiAgICBjb25zdCBzdHJlYW1SZWYgPSB0aGlzLiNjYXREaWN0LmdldFJhdygiTWV0YWRhdGEiKTsKICAgIGlmICghKHN0cmVhbVJlZiBpbnN0YW5jZW9mIFJlZikpIHsKICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAibWV0YWRhdGEiLCBudWxsKTsKICAgIH0KICAgIGxldCBtZXRhZGF0YSA9IG51bGw7CiAgICB0cnkgewogICAgICBjb25zdCBzdHJlYW0gPSB0aGlzLnhyZWYuZmV0Y2goc3RyZWFtUmVmLCAhdGhpcy54cmVmLmVuY3J5cHQ/LmVuY3J5cHRNZXRhZGF0YSk7CiAgICAgIGlmIChzdHJlYW0gaW5zdGFuY2VvZiBCYXNlU3RyZWFtICYmIHN0cmVhbS5kaWN0IGluc3RhbmNlb2YgRGljdCkgewogICAgICAgIGNvbnN0IHR5cGUgPSBzdHJlYW0uZGljdC5nZXQoIlR5cGUiKTsKICAgICAgICBjb25zdCBzdWJ0eXBlID0gc3RyZWFtLmRpY3QuZ2V0KCJTdWJ0eXBlIik7CiAgICAgICAgaWYgKGlzTmFtZSh0eXBlLCAiTWV0YWRhdGEiKSAmJiBpc05hbWUoc3VidHlwZSwgIlhNTCIpKSB7CiAgICAgICAgICBjb25zdCBkYXRhID0gc3RyaW5nVG9VVEY4U3RyaW5nKHN0cmVhbS5nZXRTdHJpbmcoKSk7CiAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICBtZXRhZGF0YSA9IG5ldyBNZXRhZGF0YVBhcnNlcihkYXRhKS5zZXJpYWxpemFibGU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIGluZm8oYFNraXBwaW5nIGludmFsaWQgTWV0YWRhdGE6ICIke2V4fSIuYCk7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJtZXRhZGF0YSIsIG1ldGFkYXRhKTsKICB9CiAgZ2V0IG1hcmtJbmZvKCkgewogICAgbGV0IG1hcmtJbmZvID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIG1hcmtJbmZvID0gdGhpcy4jcmVhZE1hcmtJbmZvKCk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oIlVuYWJsZSB0byByZWFkIG1hcmsgaW5mby4iKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgIm1hcmtJbmZvIiwgbWFya0luZm8pOwogIH0KICAjcmVhZE1hcmtJbmZvKCkgewogICAgY29uc3Qgb2JqID0gdGhpcy4jY2F0RGljdC5nZXQoIk1hcmtJbmZvIik7CiAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IG1hcmtJbmZvID0gewogICAgICBNYXJrZWQ6IGZhbHNlLAogICAgICBVc2VyUHJvcGVydGllczogZmFsc2UsCiAgICAgIFN1c3BlY3RzOiBmYWxzZQogICAgfTsKICAgIGZvciAoY29uc3Qga2V5IGluIG1hcmtJbmZvKSB7CiAgICAgIGNvbnN0IHZhbHVlID0gb2JqLmdldChrZXkpOwogICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAiYm9vbGVhbiIpIHsKICAgICAgICBtYXJrSW5mb1trZXldID0gdmFsdWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBtYXJrSW5mbzsKICB9CiAgZ2V0IHN0cnVjdFRyZWVSb290KCkgewogICAgbGV0IHN0cnVjdFRyZWUgPSBudWxsOwogICAgdHJ5IHsKICAgICAgc3RydWN0VHJlZSA9IHRoaXMuI3JlYWRTdHJ1Y3RUcmVlUm9vdCgpOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICB3YXJuKCJVbmFibGUgcmVhZCB0byBzdHJ1Y3RUcmVlUm9vdCBpbmZvLiIpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAic3RydWN0VHJlZVJvb3QiLCBzdHJ1Y3RUcmVlKTsKICB9CiAgI3JlYWRTdHJ1Y3RUcmVlUm9vdCgpIHsKICAgIGNvbnN0IHJhd09iaiA9IHRoaXMuI2NhdERpY3QuZ2V0UmF3KCJTdHJ1Y3RUcmVlUm9vdCIpOwogICAgY29uc3Qgb2JqID0gdGhpcy54cmVmLmZldGNoSWZSZWYocmF3T2JqKTsKICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3Qgcm9vdCA9IG5ldyBTdHJ1Y3RUcmVlUm9vdCh0aGlzLnhyZWYsIG9iaiwgcmF3T2JqKTsKICAgIHJvb3QuaW5pdCgpOwogICAgcmV0dXJuIHJvb3Q7CiAgfQogIGdldCB0b3BsZXZlbFBhZ2VzRGljdCgpIHsKICAgIGNvbnN0IHBhZ2VzT2JqID0gdGhpcy4jY2F0RGljdC5nZXQoIlBhZ2VzIik7CiAgICBpZiAoIShwYWdlc09iaiBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCB0b3AtbGV2ZWwgcGFnZXMgZGljdGlvbmFyeS4iKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInRvcGxldmVsUGFnZXNEaWN0IiwgcGFnZXNPYmopOwogIH0KICBnZXQgZG9jdW1lbnRPdXRsaW5lKCkgewogICAgbGV0IG9iaiA9IG51bGw7CiAgICB0cnkgewogICAgICBvYmogPSB0aGlzLiNyZWFkRG9jdW1lbnRPdXRsaW5lKCk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oIlVuYWJsZSB0byByZWFkIGRvY3VtZW50IG91dGxpbmUuIik7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJkb2N1bWVudE91dGxpbmUiLCBvYmopOwogIH0KICAjcmVhZERvY3VtZW50T3V0bGluZSgpIHsKICAgIGxldCBvYmogPSB0aGlzLiNjYXREaWN0LmdldCgiT3V0bGluZXMiKTsKICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgb2JqID0gb2JqLmdldFJhdygiRmlyc3QiKTsKICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIFJlZikpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCByb290ID0gewogICAgICBpdGVtczogW10KICAgIH07CiAgICBjb25zdCBxdWV1ZSA9IFt7CiAgICAgIG9iaiwKICAgICAgcGFyZW50OiByb290CiAgICB9XTsKICAgIGNvbnN0IHByb2Nlc3NlZCA9IG5ldyBSZWZTZXQoKTsKICAgIHByb2Nlc3NlZC5wdXQob2JqKTsKICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWYsCiAgICAgIGJsYWNrQ29sb3IgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoMyk7CiAgICB3aGlsZSAocXVldWUubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBpID0gcXVldWUuc2hpZnQoKTsKICAgICAgY29uc3Qgb3V0bGluZURpY3QgPSB4cmVmLmZldGNoSWZSZWYoaS5vYmopOwogICAgICBpZiAob3V0bGluZURpY3QgPT09IG51bGwpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIW91dGxpbmVEaWN0LmhhcygiVGl0bGUiKSkgewogICAgICAgIHdhcm4oIkludmFsaWQgb3V0bGluZSBpdGVtIGVuY291bnRlcmVkLiIpOwogICAgICB9CiAgICAgIGNvbnN0IGRhdGEgPSB7CiAgICAgICAgdXJsOiBudWxsLAogICAgICAgIGRlc3Q6IG51bGwsCiAgICAgICAgYWN0aW9uOiBudWxsCiAgICAgIH07CiAgICAgIENhdGFsb2cucGFyc2VEZXN0RGljdGlvbmFyeSh7CiAgICAgICAgZGVzdERpY3Q6IG91dGxpbmVEaWN0LAogICAgICAgIHJlc3VsdE9iajogZGF0YSwKICAgICAgICBkb2NCYXNlVXJsOiB0aGlzLmJhc2VVcmwsCiAgICAgICAgZG9jQXR0YWNobWVudHM6IHRoaXMuYXR0YWNobWVudHMKICAgICAgfSk7CiAgICAgIGNvbnN0IHRpdGxlID0gb3V0bGluZURpY3QuZ2V0KCJUaXRsZSIpOwogICAgICBjb25zdCBmbGFncyA9IG91dGxpbmVEaWN0LmdldCgiRiIpIHx8IDA7CiAgICAgIGNvbnN0IGNvbG9yID0gb3V0bGluZURpY3QuZ2V0QXJyYXkoIkMiKTsKICAgICAgY29uc3QgY291bnQgPSBvdXRsaW5lRGljdC5nZXQoIkNvdW50Iik7CiAgICAgIGxldCByZ2JDb2xvciA9IGJsYWNrQ29sb3I7CiAgICAgIGlmIChpc051bWJlckFycmF5KGNvbG9yLCAzKSAmJiAoY29sb3JbMF0gIT09IDAgfHwgY29sb3JbMV0gIT09IDAgfHwgY29sb3JbMl0gIT09IDApKSB7CiAgICAgICAgcmdiQ29sb3IgPSBDb2xvclNwYWNlVXRpbHMucmdiLmdldFJnYihjb2xvciwgMCk7CiAgICAgIH0KICAgICAgY29uc3Qgb3V0bGluZUl0ZW0gPSB7CiAgICAgICAgYWN0aW9uOiBkYXRhLmFjdGlvbiwKICAgICAgICBhdHRhY2htZW50OiBkYXRhLmF0dGFjaG1lbnQsCiAgICAgICAgZGVzdDogZGF0YS5kZXN0LAogICAgICAgIHVybDogZGF0YS51cmwsCiAgICAgICAgdW5zYWZlVXJsOiBkYXRhLnVuc2FmZVVybCwKICAgICAgICBuZXdXaW5kb3c6IGRhdGEubmV3V2luZG93LAogICAgICAgIHNldE9DR1N0YXRlOiBkYXRhLnNldE9DR1N0YXRlLAogICAgICAgIHRpdGxlOiB0eXBlb2YgdGl0bGUgPT09ICJzdHJpbmciID8gc3RyaW5nVG9QREZTdHJpbmcodGl0bGUpIDogIiIsCiAgICAgICAgY29sb3I6IHJnYkNvbG9yLAogICAgICAgIGNvdW50OiBOdW1iZXIuaXNJbnRlZ2VyKGNvdW50KSA/IGNvdW50IDogdW5kZWZpbmVkLAogICAgICAgIGJvbGQ6ICEhKGZsYWdzICYgMiksCiAgICAgICAgaXRhbGljOiAhIShmbGFncyAmIDEpLAogICAgICAgIGl0ZW1zOiBbXQogICAgICB9OwogICAgICBpLnBhcmVudC5pdGVtcy5wdXNoKG91dGxpbmVJdGVtKTsKICAgICAgb2JqID0gb3V0bGluZURpY3QuZ2V0UmF3KCJGaXJzdCIpOwogICAgICBpZiAob2JqIGluc3RhbmNlb2YgUmVmICYmICFwcm9jZXNzZWQuaGFzKG9iaikpIHsKICAgICAgICBxdWV1ZS5wdXNoKHsKICAgICAgICAgIG9iaiwKICAgICAgICAgIHBhcmVudDogb3V0bGluZUl0ZW0KICAgICAgICB9KTsKICAgICAgICBwcm9jZXNzZWQucHV0KG9iaik7CiAgICAgIH0KICAgICAgb2JqID0gb3V0bGluZURpY3QuZ2V0UmF3KCJOZXh0Iik7CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBSZWYgJiYgIXByb2Nlc3NlZC5oYXMob2JqKSkgewogICAgICAgIHF1ZXVlLnB1c2goewogICAgICAgICAgb2JqLAogICAgICAgICAgcGFyZW50OiBpLnBhcmVudAogICAgICAgIH0pOwogICAgICAgIHByb2Nlc3NlZC5wdXQob2JqKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJvb3QuaXRlbXMubGVuZ3RoID4gMCA/IHJvb3QuaXRlbXMgOiBudWxsOwogIH0KICBnZXQgcGVybWlzc2lvbnMoKSB7CiAgICBsZXQgcGVybWlzc2lvbnMgPSBudWxsOwogICAgdHJ5IHsKICAgICAgcGVybWlzc2lvbnMgPSB0aGlzLiNyZWFkUGVybWlzc2lvbnMoKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgd2FybigiVW5hYmxlIHRvIHJlYWQgcGVybWlzc2lvbnMuIik7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJwZXJtaXNzaW9ucyIsIHBlcm1pc3Npb25zKTsKICB9CiAgI3JlYWRQZXJtaXNzaW9ucygpIHsKICAgIGNvbnN0IGVuY3J5cHQgPSB0aGlzLnhyZWYudHJhaWxlci5nZXQoIkVuY3J5cHQiKTsKICAgIGlmICghKGVuY3J5cHQgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGxldCBmbGFncyA9IGVuY3J5cHQuZ2V0KCJQIik7CiAgICBpZiAodHlwZW9mIGZsYWdzICE9PSAibnVtYmVyIikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGZsYWdzICs9IDIgKiogMzI7CiAgICBjb25zdCBwZXJtaXNzaW9ucyA9IFtdOwogICAgZm9yIChjb25zdCBrZXkgaW4gUGVybWlzc2lvbkZsYWcpIHsKICAgICAgY29uc3QgdmFsdWUgPSBQZXJtaXNzaW9uRmxhZ1trZXldOwogICAgICBpZiAoZmxhZ3MgJiB2YWx1ZSkgewogICAgICAgIHBlcm1pc3Npb25zLnB1c2godmFsdWUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcGVybWlzc2lvbnM7CiAgfQogIGdldCBvcHRpb25hbENvbnRlbnRDb25maWcoKSB7CiAgICBsZXQgY29uZmlnID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHByb3BlcnRpZXMgPSB0aGlzLiNjYXREaWN0LmdldCgiT0NQcm9wZXJ0aWVzIik7CiAgICAgIGlmICghcHJvcGVydGllcykgewogICAgICAgIHJldHVybiBzaGFkb3codGhpcywgIm9wdGlvbmFsQ29udGVudENvbmZpZyIsIG51bGwpOwogICAgICB9CiAgICAgIGNvbnN0IGRlZmF1bHRDb25maWcgPSBwcm9wZXJ0aWVzLmdldCgiRCIpOwogICAgICBpZiAoIWRlZmF1bHRDb25maWcpIHsKICAgICAgICByZXR1cm4gc2hhZG93KHRoaXMsICJvcHRpb25hbENvbnRlbnRDb25maWciLCBudWxsKTsKICAgICAgfQogICAgICBjb25zdCBncm91cHNEYXRhID0gcHJvcGVydGllcy5nZXQoIk9DR3MiKTsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGdyb3Vwc0RhdGEpKSB7CiAgICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAib3B0aW9uYWxDb250ZW50Q29uZmlnIiwgbnVsbCk7CiAgICAgIH0KICAgICAgY29uc3QgZ3JvdXBSZWZDYWNoZSA9IG5ldyBSZWZTZXRDYWNoZSgpOwogICAgICBmb3IgKGNvbnN0IGdyb3VwUmVmIG9mIGdyb3Vwc0RhdGEpIHsKICAgICAgICBpZiAoIShncm91cFJlZiBpbnN0YW5jZW9mIFJlZikgfHwgZ3JvdXBSZWZDYWNoZS5oYXMoZ3JvdXBSZWYpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgZ3JvdXBSZWZDYWNoZS5wdXQoZ3JvdXBSZWYsIHRoaXMuI3JlYWRPcHRpb25hbENvbnRlbnRHcm91cChncm91cFJlZikpOwogICAgICB9CiAgICAgIGNvbmZpZyA9IHRoaXMuI3JlYWRPcHRpb25hbENvbnRlbnRDb25maWcoZGVmYXVsdENvbmZpZywgZ3JvdXBSZWZDYWNoZSk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oYFVuYWJsZSB0byByZWFkIG9wdGlvbmFsIGNvbnRlbnQgY29uZmlnOiAke2V4fWApOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAib3B0aW9uYWxDb250ZW50Q29uZmlnIiwgY29uZmlnKTsKICB9CiAgI3JlYWRPcHRpb25hbENvbnRlbnRHcm91cChncm91cFJlZikgewogICAgY29uc3QgZ3JvdXAgPSB0aGlzLnhyZWYuZmV0Y2goZ3JvdXBSZWYpOwogICAgY29uc3Qgb2JqID0gewogICAgICBpZDogZ3JvdXBSZWYudG9TdHJpbmcoKSwKICAgICAgbmFtZTogbnVsbCwKICAgICAgaW50ZW50OiBudWxsLAogICAgICB1c2FnZTogewogICAgICAgIHByaW50OiBudWxsLAogICAgICAgIHZpZXc6IG51bGwKICAgICAgfSwKICAgICAgcmJHcm91cHM6IFtdCiAgICB9OwogICAgY29uc3QgbmFtZSA9IGdyb3VwLmdldCgiTmFtZSIpOwogICAgaWYgKHR5cGVvZiBuYW1lID09PSAic3RyaW5nIikgewogICAgICBvYmoubmFtZSA9IHN0cmluZ1RvUERGU3RyaW5nKG5hbWUpOwogICAgfQogICAgbGV0IGludGVudCA9IGdyb3VwLmdldEFycmF5KCJJbnRlbnQiKTsKICAgIGlmICghQXJyYXkuaXNBcnJheShpbnRlbnQpKSB7CiAgICAgIGludGVudCA9IFtpbnRlbnRdOwogICAgfQogICAgaWYgKGludGVudC5ldmVyeShpID0+IGkgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgICBvYmouaW50ZW50ID0gaW50ZW50Lm1hcChpID0+IGkubmFtZSk7CiAgICB9CiAgICBjb25zdCB1c2FnZSA9IGdyb3VwLmdldCgiVXNhZ2UiKTsKICAgIGlmICghKHVzYWdlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuIG9iajsKICAgIH0KICAgIGNvbnN0IHVzYWdlT2JqID0gb2JqLnVzYWdlOwogICAgY29uc3QgcHJpbnQgPSB1c2FnZS5nZXQoIlByaW50Iik7CiAgICBpZiAocHJpbnQgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIGNvbnN0IHByaW50U3RhdGUgPSBwcmludC5nZXQoIlByaW50U3RhdGUiKTsKICAgICAgaWYgKHByaW50U3RhdGUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgc3dpdGNoIChwcmludFN0YXRlLm5hbWUpIHsKICAgICAgICAgIGNhc2UgIk9OIjoKICAgICAgICAgIGNhc2UgIk9GRiI6CiAgICAgICAgICAgIHVzYWdlT2JqLnByaW50ID0gewogICAgICAgICAgICAgIHByaW50U3RhdGU6IHByaW50U3RhdGUubmFtZQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY29uc3QgdmlldyA9IHVzYWdlLmdldCgiVmlldyIpOwogICAgaWYgKHZpZXcgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIGNvbnN0IHZpZXdTdGF0ZSA9IHZpZXcuZ2V0KCJWaWV3U3RhdGUiKTsKICAgICAgaWYgKHZpZXdTdGF0ZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICBzd2l0Y2ggKHZpZXdTdGF0ZS5uYW1lKSB7CiAgICAgICAgICBjYXNlICJPTiI6CiAgICAgICAgICBjYXNlICJPRkYiOgogICAgICAgICAgICB1c2FnZU9iai52aWV3ID0gewogICAgICAgICAgICAgIHZpZXdTdGF0ZTogdmlld1N0YXRlLm5hbWUKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBvYmo7CiAgfQogICNyZWFkT3B0aW9uYWxDb250ZW50Q29uZmlnKGNvbmZpZywgZ3JvdXBSZWZDYWNoZSkgewogICAgZnVuY3Rpb24gcGFyc2VPbk9mZihyZWZzKSB7CiAgICAgIGNvbnN0IG9uUGFyc2VkID0gW107CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlZnMpKSB7CiAgICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiByZWZzKSB7CiAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBSZWYgJiYgZ3JvdXBSZWZDYWNoZS5oYXModmFsdWUpKSB7CiAgICAgICAgICAgIG9uUGFyc2VkLnB1c2godmFsdWUudG9TdHJpbmcoKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvblBhcnNlZDsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlT3JkZXIocmVmcywgbmVzdGVkTGV2ZWxzID0gMCkgewogICAgICBpZiAoIUFycmF5LmlzQXJyYXkocmVmcykpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBvcmRlciA9IFtdOwogICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJlZnMpIHsKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBSZWYgJiYgZ3JvdXBSZWZDYWNoZS5oYXModmFsdWUpKSB7CiAgICAgICAgICBwYXJzZWRPcmRlclJlZnMucHV0KHZhbHVlKTsKICAgICAgICAgIG9yZGVyLnB1c2godmFsdWUudG9TdHJpbmcoKSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbmVzdGVkT3JkZXIgPSBwYXJzZU5lc3RlZE9yZGVyKHZhbHVlLCBuZXN0ZWRMZXZlbHMpOwogICAgICAgIGlmIChuZXN0ZWRPcmRlcikgewogICAgICAgICAgb3JkZXIucHVzaChuZXN0ZWRPcmRlcik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChuZXN0ZWRMZXZlbHMgPiAwKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyOwogICAgICB9CiAgICAgIGNvbnN0IGhpZGRlbkdyb3VwcyA9IFtdOwogICAgICBmb3IgKGNvbnN0IFtncm91cFJlZl0gb2YgZ3JvdXBSZWZDYWNoZS5pdGVtcygpKSB7CiAgICAgICAgaWYgKHBhcnNlZE9yZGVyUmVmcy5oYXMoZ3JvdXBSZWYpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaGlkZGVuR3JvdXBzLnB1c2goZ3JvdXBSZWYudG9TdHJpbmcoKSk7CiAgICAgIH0KICAgICAgaWYgKGhpZGRlbkdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICBvcmRlci5wdXNoKHsKICAgICAgICAgIG5hbWU6IG51bGwsCiAgICAgICAgICBvcmRlcjogaGlkZGVuR3JvdXBzCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIG9yZGVyOwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VOZXN0ZWRPcmRlcihyZWYsIG5lc3RlZExldmVscykgewogICAgICBpZiAoKytuZXN0ZWRMZXZlbHMgPiBNQVhfTkVTVEVEX0xFVkVMUykgewogICAgICAgIHdhcm4oInBhcnNlTmVzdGVkT3JkZXIgLSByZWFjaGVkIE1BWF9ORVNURURfTEVWRUxTLiIpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IHZhbHVlID0geHJlZi5mZXRjaElmUmVmKHJlZik7CiAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBuZXN0ZWROYW1lID0geHJlZi5mZXRjaElmUmVmKHZhbHVlWzBdKTsKICAgICAgaWYgKHR5cGVvZiBuZXN0ZWROYW1lICE9PSAic3RyaW5nIikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IG5lc3RlZE9yZGVyID0gcGFyc2VPcmRlcih2YWx1ZS5zbGljZSgxKSwgbmVzdGVkTGV2ZWxzKTsKICAgICAgaWYgKCFuZXN0ZWRPcmRlcj8ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiBzdHJpbmdUb1BERlN0cmluZyhuZXN0ZWROYW1lKSwKICAgICAgICBvcmRlcjogbmVzdGVkT3JkZXIKICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlUkJHcm91cHMocmJHcm91cHMpIHsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHJiR3JvdXBzKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJiR3JvdXBzKSB7CiAgICAgICAgY29uc3QgcmJHcm91cCA9IHhyZWYuZmV0Y2hJZlJlZih2YWx1ZSk7CiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHJiR3JvdXApIHx8ICFyYkdyb3VwLmxlbmd0aCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHBhcnNlZFJiR3JvdXAgPSBuZXcgU2V0KCk7CiAgICAgICAgZm9yIChjb25zdCByZWYgb2YgcmJHcm91cCkgewogICAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFJlZiAmJiBncm91cFJlZkNhY2hlLmhhcyhyZWYpICYmICFwYXJzZWRSYkdyb3VwLmhhcyhyZWYudG9TdHJpbmcoKSkpIHsKICAgICAgICAgICAgcGFyc2VkUmJHcm91cC5hZGQocmVmLnRvU3RyaW5nKCkpOwogICAgICAgICAgICBncm91cFJlZkNhY2hlLmdldChyZWYpLnJiR3JvdXBzLnB1c2gocGFyc2VkUmJHcm91cCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBjb25zdCB4cmVmID0gdGhpcy54cmVmLAogICAgICBwYXJzZWRPcmRlclJlZnMgPSBuZXcgUmVmU2V0KCksCiAgICAgIE1BWF9ORVNURURfTEVWRUxTID0gMTA7CiAgICBwYXJzZVJCR3JvdXBzKGNvbmZpZy5nZXQoIlJCR3JvdXBzIikpOwogICAgcmV0dXJuIHsKICAgICAgbmFtZTogdHlwZW9mIGNvbmZpZy5nZXQoIk5hbWUiKSA9PT0gInN0cmluZyIgPyBzdHJpbmdUb1BERlN0cmluZyhjb25maWcuZ2V0KCJOYW1lIikpIDogbnVsbCwKICAgICAgY3JlYXRvcjogdHlwZW9mIGNvbmZpZy5nZXQoIkNyZWF0b3IiKSA9PT0gInN0cmluZyIgPyBzdHJpbmdUb1BERlN0cmluZyhjb25maWcuZ2V0KCJDcmVhdG9yIikpIDogbnVsbCwKICAgICAgYmFzZVN0YXRlOiBjb25maWcuZ2V0KCJCYXNlU3RhdGUiKSBpbnN0YW5jZW9mIE5hbWUgPyBjb25maWcuZ2V0KCJCYXNlU3RhdGUiKS5uYW1lIDogbnVsbCwKICAgICAgb246IHBhcnNlT25PZmYoY29uZmlnLmdldCgiT04iKSksCiAgICAgIG9mZjogcGFyc2VPbk9mZihjb25maWcuZ2V0KCJPRkYiKSksCiAgICAgIG9yZGVyOiBwYXJzZU9yZGVyKGNvbmZpZy5nZXQoIk9yZGVyIikpLAogICAgICBncm91cHM6IFsuLi5ncm91cFJlZkNhY2hlXQogICAgfTsKICB9CiAgc2V0QWN0dWFsTnVtUGFnZXMobnVtID0gbnVsbCkgewogICAgdGhpcy4jYWN0dWFsTnVtUGFnZXMgPSBudW07CiAgfQogIGdldCBoYXNBY3R1YWxOdW1QYWdlcygpIHsKICAgIHJldHVybiB0aGlzLiNhY3R1YWxOdW1QYWdlcyAhPT0gbnVsbDsKICB9CiAgZ2V0IF9wYWdlc0NvdW50KCkgewogICAgY29uc3Qgb2JqID0gdGhpcy50b3BsZXZlbFBhZ2VzRGljdC5nZXQoIkNvdW50Iik7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIob2JqKSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlBhZ2UgY291bnQgaW4gdG9wLWxldmVsIHBhZ2VzIGRpY3Rpb25hcnkgaXMgbm90IGFuIGludGVnZXIuIik7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJfcGFnZXNDb3VudCIsIG9iaik7CiAgfQogIGdldCBudW1QYWdlcygpIHsKICAgIHJldHVybiB0aGlzLiNhY3R1YWxOdW1QYWdlcyA/PyB0aGlzLl9wYWdlc0NvdW50OwogIH0KICBnZXQgZGVzdGluYXRpb25zKCkgewogICAgY29uc3QgcmF3RGVzdHMgPSB0aGlzLiNyZWFkRGVzdHMoKSwKICAgICAgZGVzdHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgZm9yIChjb25zdCBvYmogb2YgcmF3RGVzdHMpIHsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIE5hbWVUcmVlKSB7CiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2Ygb2JqLmdldEFsbCgpKSB7CiAgICAgICAgICBjb25zdCBkZXN0ID0gZmV0Y2hEZXN0KHZhbHVlKTsKICAgICAgICAgIGlmIChkZXN0KSB7CiAgICAgICAgICAgIGRlc3RzW3N0cmluZ1RvUERGU3RyaW5nKGtleSwgdHJ1ZSldID0gZGVzdDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG9iaikgewogICAgICAgICAgY29uc3QgZGVzdCA9IGZldGNoRGVzdCh2YWx1ZSk7CiAgICAgICAgICBpZiAoZGVzdCkgewogICAgICAgICAgICBkZXN0c1tzdHJpbmdUb1BERlN0cmluZyhrZXksIHRydWUpXSB8fD0gZGVzdDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImRlc3RpbmF0aW9ucyIsIGRlc3RzKTsKICB9CiAgZ2V0RGVzdGluYXRpb24oaWQpIHsKICAgIGlmICh0aGlzLmhhc093blByb3BlcnR5KCJkZXN0aW5hdGlvbnMiKSkgewogICAgICByZXR1cm4gdGhpcy5kZXN0aW5hdGlvbnNbaWRdID8/IG51bGw7CiAgICB9CiAgICBjb25zdCByYXdEZXN0cyA9IHRoaXMuI3JlYWREZXN0cygpOwogICAgZm9yIChjb25zdCBvYmogb2YgcmF3RGVzdHMpIHsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIE5hbWVUcmVlIHx8IG9iaiBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICBjb25zdCBkZXN0ID0gZmV0Y2hEZXN0KG9iai5nZXQoaWQpKTsKICAgICAgICBpZiAoZGVzdCkgewogICAgICAgICAgcmV0dXJuIGRlc3Q7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAocmF3RGVzdHMubGVuZ3RoKSB7CiAgICAgIGNvbnN0IGRlc3QgPSB0aGlzLmRlc3RpbmF0aW9uc1tpZF07CiAgICAgIGlmIChkZXN0KSB7CiAgICAgICAgcmV0dXJuIGRlc3Q7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICAjcmVhZERlc3RzKCkgewogICAgY29uc3Qgb2JqID0gdGhpcy4jY2F0RGljdC5nZXQoIk5hbWVzIik7CiAgICBjb25zdCByYXdEZXN0cyA9IFtdOwogICAgaWYgKG9iaj8uaGFzKCJEZXN0cyIpKSB7CiAgICAgIHJhd0Rlc3RzLnB1c2gobmV3IE5hbWVUcmVlKG9iai5nZXRSYXcoIkRlc3RzIiksIHRoaXMueHJlZikpOwogICAgfQogICAgaWYgKHRoaXMuI2NhdERpY3QuaGFzKCJEZXN0cyIpKSB7CiAgICAgIHJhd0Rlc3RzLnB1c2godGhpcy4jY2F0RGljdC5nZXQoIkRlc3RzIikpOwogICAgfQogICAgcmV0dXJuIHJhd0Rlc3RzOwogIH0KICBnZXQgcGFnZUxhYmVscygpIHsKICAgIGxldCBvYmogPSBudWxsOwogICAgdHJ5IHsKICAgICAgb2JqID0gdGhpcy4jcmVhZFBhZ2VMYWJlbHMoKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIE1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgd2FybigiVW5hYmxlIHRvIHJlYWQgcGFnZSBsYWJlbHMuIik7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJwYWdlTGFiZWxzIiwgb2JqKTsKICB9CiAgI3JlYWRQYWdlTGFiZWxzKCkgewogICAgY29uc3Qgb2JqID0gdGhpcy4jY2F0RGljdC5nZXRSYXcoIlBhZ2VMYWJlbHMiKTsKICAgIGlmICghb2JqKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgcGFnZUxhYmVscyA9IG5ldyBBcnJheSh0aGlzLm51bVBhZ2VzKTsKICAgIGxldCBzdHlsZSA9IG51bGwsCiAgICAgIHByZWZpeCA9ICIiOwogICAgY29uc3QgbnVtYmVyVHJlZSA9IG5ldyBOdW1iZXJUcmVlKG9iaiwgdGhpcy54cmVmKTsKICAgIGNvbnN0IG51bXMgPSBudW1iZXJUcmVlLmdldEFsbCgpOwogICAgbGV0IGN1cnJlbnRMYWJlbCA9ICIiLAogICAgICBjdXJyZW50SW5kZXggPSAxOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdGhpcy5udW1QYWdlczsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgbGFiZWxEaWN0ID0gbnVtcy5nZXQoaSk7CiAgICAgIGlmIChsYWJlbERpY3QgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGlmICghKGxhYmVsRGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlBhZ2VMYWJlbCBpcyBub3QgYSBkaWN0aW9uYXJ5LiIpOwogICAgICAgIH0KICAgICAgICBpZiAobGFiZWxEaWN0LmhhcygiVHlwZSIpICYmICFpc05hbWUobGFiZWxEaWN0LmdldCgiVHlwZSIpLCAiUGFnZUxhYmVsIikpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCB0eXBlIGluIFBhZ2VMYWJlbCBkaWN0aW9uYXJ5LiIpOwogICAgICAgIH0KICAgICAgICBpZiAobGFiZWxEaWN0LmhhcygiUyIpKSB7CiAgICAgICAgICBjb25zdCBzID0gbGFiZWxEaWN0LmdldCgiUyIpOwogICAgICAgICAgaWYgKCEocyBpbnN0YW5jZW9mIE5hbWUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBzdHlsZSBpbiBQYWdlTGFiZWwgZGljdGlvbmFyeS4iKTsKICAgICAgICAgIH0KICAgICAgICAgIHN0eWxlID0gcy5uYW1lOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHlsZSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGlmIChsYWJlbERpY3QuaGFzKCJQIikpIHsKICAgICAgICAgIGNvbnN0IHAgPSBsYWJlbERpY3QuZ2V0KCJQIik7CiAgICAgICAgICBpZiAodHlwZW9mIHAgIT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBwcmVmaXggaW4gUGFnZUxhYmVsIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICB9CiAgICAgICAgICBwcmVmaXggPSBzdHJpbmdUb1BERlN0cmluZyhwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcHJlZml4ID0gIiI7CiAgICAgICAgfQogICAgICAgIGlmIChsYWJlbERpY3QuaGFzKCJTdCIpKSB7CiAgICAgICAgICBjb25zdCBzdCA9IGxhYmVsRGljdC5nZXQoIlN0Iik7CiAgICAgICAgICBpZiAoIShOdW1iZXIuaXNJbnRlZ2VyKHN0KSAmJiBzdCA+PSAxKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgc3RhcnQgaW4gUGFnZUxhYmVsIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICB9CiAgICAgICAgICBjdXJyZW50SW5kZXggPSBzdDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3VycmVudEluZGV4ID0gMTsKICAgICAgICB9CiAgICAgIH0KICAgICAgc3dpdGNoIChzdHlsZSkgewogICAgICAgIGNhc2UgIkQiOgogICAgICAgICAgY3VycmVudExhYmVsID0gY3VycmVudEluZGV4OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiUiI6CiAgICAgICAgY2FzZSAiciI6CiAgICAgICAgICBjdXJyZW50TGFiZWwgPSB0b1JvbWFuTnVtZXJhbHMoY3VycmVudEluZGV4LCBzdHlsZSA9PT0gInIiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkEiOgogICAgICAgIGNhc2UgImEiOgogICAgICAgICAgY29uc3QgTElNSVQgPSAyNjsKICAgICAgICAgIGNvbnN0IEFfVVBQRVJfQ0FTRSA9IDB4NDEsCiAgICAgICAgICAgIEFfTE9XRVJfQ0FTRSA9IDB4NjE7CiAgICAgICAgICBjb25zdCBiYXNlQ2hhckNvZGUgPSBzdHlsZSA9PT0gImEiID8gQV9MT1dFUl9DQVNFIDogQV9VUFBFUl9DQVNFOwogICAgICAgICAgY29uc3QgbGV0dGVySW5kZXggPSBjdXJyZW50SW5kZXggLSAxOwogICAgICAgICAgY29uc3QgY2hhcmFjdGVyID0gU3RyaW5nLmZyb21DaGFyQ29kZShiYXNlQ2hhckNvZGUgKyBsZXR0ZXJJbmRleCAlIExJTUlUKTsKICAgICAgICAgIGN1cnJlbnRMYWJlbCA9IGNoYXJhY3Rlci5yZXBlYXQoTWF0aC5mbG9vcihsZXR0ZXJJbmRleCAvIExJTUlUKSArIDEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmIChzdHlsZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgc3R5bGUgIiR7c3R5bGV9IiBpbiBQYWdlTGFiZWwgZGljdGlvbmFyeS5gKTsKICAgICAgICAgIH0KICAgICAgICAgIGN1cnJlbnRMYWJlbCA9ICIiOwogICAgICB9CiAgICAgIHBhZ2VMYWJlbHNbaV0gPSBwcmVmaXggKyBjdXJyZW50TGFiZWw7CiAgICAgIGN1cnJlbnRJbmRleCsrOwogICAgfQogICAgcmV0dXJuIHBhZ2VMYWJlbHM7CiAgfQogIGdldCBwYWdlTGF5b3V0KCkgewogICAgY29uc3Qgb2JqID0gdGhpcy4jY2F0RGljdC5nZXQoIlBhZ2VMYXlvdXQiKTsKICAgIGxldCBwYWdlTGF5b3V0ID0gIiI7CiAgICBpZiAob2JqIGluc3RhbmNlb2YgTmFtZSkgewogICAgICBzd2l0Y2ggKG9iai5uYW1lKSB7CiAgICAgICAgY2FzZSAiU2luZ2xlUGFnZSI6CiAgICAgICAgY2FzZSAiT25lQ29sdW1uIjoKICAgICAgICBjYXNlICJUd29Db2x1bW5MZWZ0IjoKICAgICAgICBjYXNlICJUd29Db2x1bW5SaWdodCI6CiAgICAgICAgY2FzZSAiVHdvUGFnZUxlZnQiOgogICAgICAgIGNhc2UgIlR3b1BhZ2VSaWdodCI6CiAgICAgICAgICBwYWdlTGF5b3V0ID0gb2JqLm5hbWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInBhZ2VMYXlvdXQiLCBwYWdlTGF5b3V0KTsKICB9CiAgZ2V0IHBhZ2VNb2RlKCkgewogICAgY29uc3Qgb2JqID0gdGhpcy4jY2F0RGljdC5nZXQoIlBhZ2VNb2RlIik7CiAgICBsZXQgcGFnZU1vZGUgPSAiVXNlTm9uZSI7CiAgICBpZiAob2JqIGluc3RhbmNlb2YgTmFtZSkgewogICAgICBzd2l0Y2ggKG9iai5uYW1lKSB7CiAgICAgICAgY2FzZSAiVXNlTm9uZSI6CiAgICAgICAgY2FzZSAiVXNlT3V0bGluZXMiOgogICAgICAgIGNhc2UgIlVzZVRodW1icyI6CiAgICAgICAgY2FzZSAiRnVsbFNjcmVlbiI6CiAgICAgICAgY2FzZSAiVXNlT0MiOgogICAgICAgIGNhc2UgIlVzZUF0dGFjaG1lbnRzIjoKICAgICAgICAgIHBhZ2VNb2RlID0gb2JqLm5hbWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInBhZ2VNb2RlIiwgcGFnZU1vZGUpOwogIH0KICBnZXQgdmlld2VyUHJlZmVyZW5jZXMoKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLiNjYXREaWN0LmdldCgiVmlld2VyUHJlZmVyZW5jZXMiKTsKICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybiBzaGFkb3codGhpcywgInZpZXdlclByZWZlcmVuY2VzIiwgbnVsbCk7CiAgICB9CiAgICBsZXQgcHJlZnMgPSBudWxsOwogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2Ygb2JqKSB7CiAgICAgIGxldCBwcmVmVmFsdWU7CiAgICAgIHN3aXRjaCAoa2V5KSB7CiAgICAgICAgY2FzZSAiSGlkZVRvb2xiYXIiOgogICAgICAgIGNhc2UgIkhpZGVNZW51YmFyIjoKICAgICAgICBjYXNlICJIaWRlV2luZG93VUkiOgogICAgICAgIGNhc2UgIkZpdFdpbmRvdyI6CiAgICAgICAgY2FzZSAiQ2VudGVyV2luZG93IjoKICAgICAgICBjYXNlICJEaXNwbGF5RG9jVGl0bGUiOgogICAgICAgIGNhc2UgIlBpY2tUcmF5QnlQREZTaXplIjoKICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJib29sZWFuIikgewogICAgICAgICAgICBwcmVmVmFsdWUgPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIk5vbkZ1bGxTY3JlZW5QYWdlTW9kZSI6CiAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgIHN3aXRjaCAodmFsdWUubmFtZSkgewogICAgICAgICAgICAgIGNhc2UgIlVzZU5vbmUiOgogICAgICAgICAgICAgIGNhc2UgIlVzZU91dGxpbmVzIjoKICAgICAgICAgICAgICBjYXNlICJVc2VUaHVtYnMiOgogICAgICAgICAgICAgIGNhc2UgIlVzZU9DIjoKICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9IHZhbHVlLm5hbWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gIlVzZU5vbmUiOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJEaXJlY3Rpb24iOgogICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgICBzd2l0Y2ggKHZhbHVlLm5hbWUpIHsKICAgICAgICAgICAgICBjYXNlICJMMlIiOgogICAgICAgICAgICAgIGNhc2UgIlIyTCI6CiAgICAgICAgICAgICAgICBwcmVmVmFsdWUgPSB2YWx1ZS5uYW1lOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9ICJMMlIiOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJWaWV3QXJlYSI6CiAgICAgICAgY2FzZSAiVmlld0NsaXAiOgogICAgICAgIGNhc2UgIlByaW50QXJlYSI6CiAgICAgICAgY2FzZSAiUHJpbnRDbGlwIjoKICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgc3dpdGNoICh2YWx1ZS5uYW1lKSB7CiAgICAgICAgICAgICAgY2FzZSAiTWVkaWFCb3giOgogICAgICAgICAgICAgIGNhc2UgIkNyb3BCb3giOgogICAgICAgICAgICAgIGNhc2UgIkJsZWVkQm94IjoKICAgICAgICAgICAgICBjYXNlICJUcmltQm94IjoKICAgICAgICAgICAgICBjYXNlICJBcnRCb3giOgogICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gdmFsdWUubmFtZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBwcmVmVmFsdWUgPSAiQ3JvcEJveCI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlByaW50U2NhbGluZyI6CiAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgIHN3aXRjaCAodmFsdWUubmFtZSkgewogICAgICAgICAgICAgIGNhc2UgIk5vbmUiOgogICAgICAgICAgICAgIGNhc2UgIkFwcERlZmF1bHQiOgogICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gdmFsdWUubmFtZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBwcmVmVmFsdWUgPSAiQXBwRGVmYXVsdCI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkR1cGxleCI6CiAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgIHN3aXRjaCAodmFsdWUubmFtZSkgewogICAgICAgICAgICAgIGNhc2UgIlNpbXBsZXgiOgogICAgICAgICAgICAgIGNhc2UgIkR1cGxleEZsaXBTaG9ydEVkZ2UiOgogICAgICAgICAgICAgIGNhc2UgIkR1cGxleEZsaXBMb25nRWRnZSI6CiAgICAgICAgICAgICAgICBwcmVmVmFsdWUgPSB2YWx1ZS5uYW1lOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9ICJOb25lIjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiUHJpbnRQYWdlUmFuZ2UiOgogICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmxlbmd0aCAlIDIgPT09IDApIHsKICAgICAgICAgICAgY29uc3QgaXNWYWxpZCA9IHZhbHVlLmV2ZXJ5KChwYWdlLCBpLCBhcnIpID0+IE51bWJlci5pc0ludGVnZXIocGFnZSkgJiYgcGFnZSA+IDAgJiYgKGkgPT09IDAgfHwgcGFnZSA+PSBhcnJbaSAtIDFdKSAmJiBwYWdlIDw9IHRoaXMubnVtUGFnZXMpOwogICAgICAgICAgICBpZiAoaXNWYWxpZCkgewogICAgICAgICAgICAgIHByZWZWYWx1ZSA9IHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJOdW1Db3BpZXMiOgogICAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIodmFsdWUpICYmIHZhbHVlID4gMCkgewogICAgICAgICAgICBwcmVmVmFsdWUgPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB3YXJuKGBJZ25vcmluZyBub24tc3RhbmRhcmQga2V5IGluIFZpZXdlclByZWZlcmVuY2VzOiAke2tleX0uYCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAocHJlZlZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgICB3YXJuKGBCYWQgdmFsdWUsIGZvciBrZXkgIiR7a2V5fSIsIGluIFZpZXdlclByZWZlcmVuY2VzOiAke3ZhbHVlfS5gKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBwcmVmcyA/Pz0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgcHJlZnNba2V5XSA9IHByZWZWYWx1ZTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInZpZXdlclByZWZlcmVuY2VzIiwgcHJlZnMpOwogIH0KICBnZXQgb3BlbkFjdGlvbigpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuI2NhdERpY3QuZ2V0KCJPcGVuQWN0aW9uIik7CiAgICBjb25zdCBvcGVuQWN0aW9uID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGlmIChvYmogaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIGNvbnN0IGRlc3REaWN0ID0gbmV3IERpY3QodGhpcy54cmVmKTsKICAgICAgZGVzdERpY3Quc2V0KCJBIiwgb2JqKTsKICAgICAgY29uc3QgcmVzdWx0T2JqID0gewogICAgICAgIHVybDogbnVsbCwKICAgICAgICBkZXN0OiBudWxsLAogICAgICAgIGFjdGlvbjogbnVsbAogICAgICB9OwogICAgICBDYXRhbG9nLnBhcnNlRGVzdERpY3Rpb25hcnkoewogICAgICAgIGRlc3REaWN0LAogICAgICAgIHJlc3VsdE9iagogICAgICB9KTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVzdWx0T2JqLmRlc3QpKSB7CiAgICAgICAgb3BlbkFjdGlvbi5kZXN0ID0gcmVzdWx0T2JqLmRlc3Q7CiAgICAgIH0gZWxzZSBpZiAocmVzdWx0T2JqLmFjdGlvbikgewogICAgICAgIG9wZW5BY3Rpb24uYWN0aW9uID0gcmVzdWx0T2JqLmFjdGlvbjsKICAgICAgfQogICAgfSBlbHNlIGlmIChpc1ZhbGlkRXhwbGljaXREZXN0KG9iaikpIHsKICAgICAgb3BlbkFjdGlvbi5kZXN0ID0gb2JqOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAib3BlbkFjdGlvbiIsIG9iamVjdFNpemUob3BlbkFjdGlvbikgPiAwID8gb3BlbkFjdGlvbiA6IG51bGwpOwogIH0KICBnZXQgYXR0YWNobWVudHMoKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLiNjYXREaWN0LmdldCgiTmFtZXMiKTsKICAgIGxldCBhdHRhY2htZW50cyA9IG51bGw7CiAgICBpZiAob2JqIGluc3RhbmNlb2YgRGljdCAmJiBvYmouaGFzKCJFbWJlZGRlZEZpbGVzIikpIHsKICAgICAgY29uc3QgbmFtZVRyZWUgPSBuZXcgTmFtZVRyZWUob2JqLmdldFJhdygiRW1iZWRkZWRGaWxlcyIpLCB0aGlzLnhyZWYpOwogICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBuYW1lVHJlZS5nZXRBbGwoKSkgewogICAgICAgIGNvbnN0IGZzID0gbmV3IEZpbGVTcGVjKHZhbHVlLCB0aGlzLnhyZWYpOwogICAgICAgIGF0dGFjaG1lbnRzID8/PSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIGF0dGFjaG1lbnRzW3N0cmluZ1RvUERGU3RyaW5nKGtleSwgdHJ1ZSldID0gZnMuc2VyaWFsaXphYmxlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJhdHRhY2htZW50cyIsIGF0dGFjaG1lbnRzKTsKICB9CiAgZ2V0IHhmYUltYWdlcygpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuI2NhdERpY3QuZ2V0KCJOYW1lcyIpOwogICAgbGV0IHhmYUltYWdlcyA9IG51bGw7CiAgICBpZiAob2JqIGluc3RhbmNlb2YgRGljdCAmJiBvYmouaGFzKCJYRkFJbWFnZXMiKSkgewogICAgICBjb25zdCBuYW1lVHJlZSA9IG5ldyBOYW1lVHJlZShvYmouZ2V0UmF3KCJYRkFJbWFnZXMiKSwgdGhpcy54cmVmKTsKICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgbmFtZVRyZWUuZ2V0QWxsKCkpIHsKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgICAgICB4ZmFJbWFnZXMgPz89IG5ldyBNYXAoKTsKICAgICAgICAgIHhmYUltYWdlcy5zZXQoc3RyaW5nVG9QREZTdHJpbmcoa2V5LCB0cnVlKSwgdmFsdWUuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJ4ZmFJbWFnZXMiLCB4ZmFJbWFnZXMpOwogIH0KICAjY29sbGVjdEphdmFTY3JpcHQoKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLiNjYXREaWN0LmdldCgiTmFtZXMiKTsKICAgIGxldCBqYXZhU2NyaXB0ID0gbnVsbDsKICAgIGZ1bmN0aW9uIGFwcGVuZElmSmF2YVNjcmlwdERpY3QobmFtZSwganNEaWN0KSB7CiAgICAgIGlmICghKGpzRGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICghaXNOYW1lKGpzRGljdC5nZXQoIlMiKSwgIkphdmFTY3JpcHQiKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQganMgPSBqc0RpY3QuZ2V0KCJKUyIpOwogICAgICBpZiAoanMgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgICAganMgPSBqcy5nZXRTdHJpbmcoKTsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YganMgIT09ICJzdHJpbmciKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGpzID0gc3RyaW5nVG9QREZTdHJpbmcoanMsIHRydWUpLnJlcGxhY2VBbGwoIlx4MDAiLCAiIik7CiAgICAgIGlmIChqcykgewogICAgICAgIChqYXZhU2NyaXB0IHx8PSBuZXcgTWFwKCkpLnNldChuYW1lLCBqcyk7CiAgICAgIH0KICAgIH0KICAgIGlmIChvYmogaW5zdGFuY2VvZiBEaWN0ICYmIG9iai5oYXMoIkphdmFTY3JpcHQiKSkgewogICAgICBjb25zdCBuYW1lVHJlZSA9IG5ldyBOYW1lVHJlZShvYmouZ2V0UmF3KCJKYXZhU2NyaXB0IiksIHRoaXMueHJlZik7CiAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG5hbWVUcmVlLmdldEFsbCgpKSB7CiAgICAgICAgYXBwZW5kSWZKYXZhU2NyaXB0RGljdChzdHJpbmdUb1BERlN0cmluZyhrZXksIHRydWUpLCB2YWx1ZSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IG9wZW5BY3Rpb24gPSB0aGlzLiNjYXREaWN0LmdldCgiT3BlbkFjdGlvbiIpOwogICAgaWYgKG9wZW5BY3Rpb24pIHsKICAgICAgYXBwZW5kSWZKYXZhU2NyaXB0RGljdCgiT3BlbkFjdGlvbiIsIG9wZW5BY3Rpb24pOwogICAgfQogICAgcmV0dXJuIGphdmFTY3JpcHQ7CiAgfQogIGdldCBqc0FjdGlvbnMoKSB7CiAgICBjb25zdCBqYXZhU2NyaXB0ID0gdGhpcy4jY29sbGVjdEphdmFTY3JpcHQoKTsKICAgIGxldCBhY3Rpb25zID0gY29sbGVjdEFjdGlvbnModGhpcy54cmVmLCB0aGlzLiNjYXREaWN0LCBEb2N1bWVudEFjdGlvbkV2ZW50VHlwZSk7CiAgICBpZiAoamF2YVNjcmlwdCkgewogICAgICBhY3Rpb25zIHx8PSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbF0gb2YgamF2YVNjcmlwdCkgewogICAgICAgIGlmIChrZXkgaW4gYWN0aW9ucykgewogICAgICAgICAgYWN0aW9uc1trZXldLnB1c2godmFsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYWN0aW9uc1trZXldID0gW3ZhbF07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJqc0FjdGlvbnMiLCBhY3Rpb25zKTsKICB9CiAgYXN5bmMgY2xlYW51cChtYW51YWxseVRyaWdnZXJlZCA9IGZhbHNlKSB7CiAgICBjbGVhckdsb2JhbENhY2hlcygpOwogICAgdGhpcy5nbG9iYWxDb2xvclNwYWNlQ2FjaGUuY2xlYXIoKTsKICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZS5jbGVhcihtYW51YWxseVRyaWdnZXJlZCk7CiAgICB0aGlzLnBhZ2VLaWRzQ291bnRDYWNoZS5jbGVhcigpOwogICAgdGhpcy5wYWdlSW5kZXhDYWNoZS5jbGVhcigpOwogICAgdGhpcy5wYWdlRGljdENhY2hlLmNsZWFyKCk7CiAgICB0aGlzLm5vbkJsZW5kTW9kZXNTZXQuY2xlYXIoKTsKICAgIGZvciAoY29uc3QgewogICAgICBkaWN0CiAgICB9IG9mIGF3YWl0IFByb21pc2UuYWxsKHRoaXMuZm9udENhY2hlKSkgewogICAgICBkZWxldGUgZGljdC5jYWNoZUtleTsKICAgIH0KICAgIHRoaXMuZm9udENhY2hlLmNsZWFyKCk7CiAgICB0aGlzLmJ1aWx0SW5DTWFwQ2FjaGUuY2xlYXIoKTsKICAgIHRoaXMuc3RhbmRhcmRGb250RGF0YUNhY2hlLmNsZWFyKCk7CiAgICB0aGlzLnN5c3RlbUZvbnRDYWNoZS5jbGVhcigpOwogIH0KICBhc3luYyBnZXRQYWdlRGljdChwYWdlSW5kZXgpIHsKICAgIGNvbnN0IG5vZGVzVG9WaXNpdCA9IFt0aGlzLnRvcGxldmVsUGFnZXNEaWN0XTsKICAgIGNvbnN0IHZpc2l0ZWROb2RlcyA9IG5ldyBSZWZTZXQoKTsKICAgIGNvbnN0IHBhZ2VzUmVmID0gdGhpcy4jY2F0RGljdC5nZXRSYXcoIlBhZ2VzIik7CiAgICBpZiAocGFnZXNSZWYgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgdmlzaXRlZE5vZGVzLnB1dChwYWdlc1JlZik7CiAgICB9CiAgICBjb25zdCB4cmVmID0gdGhpcy54cmVmLAogICAgICBwYWdlS2lkc0NvdW50Q2FjaGUgPSB0aGlzLnBhZ2VLaWRzQ291bnRDYWNoZSwKICAgICAgcGFnZUluZGV4Q2FjaGUgPSB0aGlzLnBhZ2VJbmRleENhY2hlLAogICAgICBwYWdlRGljdENhY2hlID0gdGhpcy5wYWdlRGljdENhY2hlOwogICAgbGV0IGN1cnJlbnRQYWdlSW5kZXggPSAwOwogICAgd2hpbGUgKG5vZGVzVG9WaXNpdC5sZW5ndGgpIHsKICAgICAgY29uc3QgY3VycmVudE5vZGUgPSBub2Rlc1RvVmlzaXQucG9wKCk7CiAgICAgIGlmIChjdXJyZW50Tm9kZSBpbnN0YW5jZW9mIFJlZikgewogICAgICAgIGNvbnN0IGNvdW50ID0gcGFnZUtpZHNDb3VudENhY2hlLmdldChjdXJyZW50Tm9kZSk7CiAgICAgICAgaWYgKGNvdW50ID49IDAgJiYgY3VycmVudFBhZ2VJbmRleCArIGNvdW50IDw9IHBhZ2VJbmRleCkgewogICAgICAgICAgY3VycmVudFBhZ2VJbmRleCArPSBjb3VudDsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAodmlzaXRlZE5vZGVzLmhhcyhjdXJyZW50Tm9kZSkpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiUGFnZXMgdHJlZSBjb250YWlucyBjaXJjdWxhciByZWZlcmVuY2UuIik7CiAgICAgICAgfQogICAgICAgIHZpc2l0ZWROb2Rlcy5wdXQoY3VycmVudE5vZGUpOwogICAgICAgIGNvbnN0IG9iaiA9IGF3YWl0IChwYWdlRGljdENhY2hlLmdldChjdXJyZW50Tm9kZSkgfHwgeHJlZi5mZXRjaEFzeW5jKGN1cnJlbnROb2RlKSk7CiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICAgIGxldCB0eXBlID0gb2JqLmdldFJhdygiVHlwZSIpOwogICAgICAgICAgaWYgKHR5cGUgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICAgICAgdHlwZSA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyh0eXBlKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpc05hbWUodHlwZSwgIlBhZ2UiKSB8fCAhb2JqLmhhcygiS2lkcyIpKSB7CiAgICAgICAgICAgIGlmICghcGFnZUtpZHNDb3VudENhY2hlLmhhcyhjdXJyZW50Tm9kZSkpIHsKICAgICAgICAgICAgICBwYWdlS2lkc0NvdW50Q2FjaGUucHV0KGN1cnJlbnROb2RlLCAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXBhZ2VJbmRleENhY2hlLmhhcyhjdXJyZW50Tm9kZSkpIHsKICAgICAgICAgICAgICBwYWdlSW5kZXhDYWNoZS5wdXQoY3VycmVudE5vZGUsIGN1cnJlbnRQYWdlSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjdXJyZW50UGFnZUluZGV4ID09PSBwYWdlSW5kZXgpIHsKICAgICAgICAgICAgICByZXR1cm4gW29iaiwgY3VycmVudE5vZGVdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN1cnJlbnRQYWdlSW5kZXgrKzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG5vZGVzVG9WaXNpdC5wdXNoKG9iaik7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCEoY3VycmVudE5vZGUgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiUGFnZSBkaWN0aW9uYXJ5IGtpZCByZWZlcmVuY2UgcG9pbnRzIHRvIHdyb25nIHR5cGUgb2Ygb2JqZWN0LiIpOwogICAgICB9CiAgICAgIGNvbnN0IHsKICAgICAgICBvYmpJZAogICAgICB9ID0gY3VycmVudE5vZGU7CiAgICAgIGxldCBjb3VudCA9IGN1cnJlbnROb2RlLmdldFJhdygiQ291bnQiKTsKICAgICAgaWYgKGNvdW50IGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgY291bnQgPSBhd2FpdCB4cmVmLmZldGNoQXN5bmMoY291bnQpOwogICAgICB9CiAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGNvdW50KSAmJiBjb3VudCA+PSAwKSB7CiAgICAgICAgaWYgKG9iaklkICYmICFwYWdlS2lkc0NvdW50Q2FjaGUuaGFzKG9iaklkKSkgewogICAgICAgICAgcGFnZUtpZHNDb3VudENhY2hlLnB1dChvYmpJZCwgY291bnQpOwogICAgICAgIH0KICAgICAgICBpZiAoY3VycmVudFBhZ2VJbmRleCArIGNvdW50IDw9IHBhZ2VJbmRleCkgewogICAgICAgICAgY3VycmVudFBhZ2VJbmRleCArPSBjb3VudDsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgfQogICAgICBsZXQga2lkcyA9IGN1cnJlbnROb2RlLmdldFJhdygiS2lkcyIpOwogICAgICBpZiAoa2lkcyBpbnN0YW5jZW9mIFJlZikgewogICAgICAgIGtpZHMgPSBhd2FpdCB4cmVmLmZldGNoQXN5bmMoa2lkcyk7CiAgICAgIH0KICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGtpZHMpKSB7CiAgICAgICAgbGV0IHR5cGUgPSBjdXJyZW50Tm9kZS5nZXRSYXcoIlR5cGUiKTsKICAgICAgICBpZiAodHlwZSBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgdHlwZSA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyh0eXBlKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzTmFtZSh0eXBlLCAiUGFnZSIpIHx8ICFjdXJyZW50Tm9kZS5oYXMoIktpZHMiKSkgewogICAgICAgICAgaWYgKGN1cnJlbnRQYWdlSW5kZXggPT09IHBhZ2VJbmRleCkgewogICAgICAgICAgICByZXR1cm4gW2N1cnJlbnROb2RlLCBudWxsXTsKICAgICAgICAgIH0KICAgICAgICAgIGN1cnJlbnRQYWdlSW5kZXgrKzsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlBhZ2UgZGljdGlvbmFyeSBraWRzIG9iamVjdCBpcyBub3QgYW4gYXJyYXkuIik7CiAgICAgIH0KICAgICAgZm9yIChsZXQgbGFzdCA9IGtpZHMubGVuZ3RoIC0gMTsgbGFzdCA+PSAwOyBsYXN0LS0pIHsKICAgICAgICBjb25zdCBsYXN0S2lkID0ga2lkc1tsYXN0XTsKICAgICAgICBub2Rlc1RvVmlzaXQucHVzaChsYXN0S2lkKTsKICAgICAgICBpZiAoY3VycmVudE5vZGUgPT09IHRoaXMudG9wbGV2ZWxQYWdlc0RpY3QgJiYgbGFzdEtpZCBpbnN0YW5jZW9mIFJlZiAmJiAhcGFnZURpY3RDYWNoZS5oYXMobGFzdEtpZCkpIHsKICAgICAgICAgIHBhZ2VEaWN0Q2FjaGUucHV0KGxhc3RLaWQsIHhyZWYuZmV0Y2hBc3luYyhsYXN0S2lkKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICB0aHJvdyBuZXcgRXJyb3IoYFBhZ2UgaW5kZXggJHtwYWdlSW5kZXh9IG5vdCBmb3VuZC5gKTsKICB9CiAgYXN5bmMgZ2V0QWxsUGFnZURpY3RzKHJlY292ZXJ5TW9kZSA9IGZhbHNlKSB7CiAgICBjb25zdCB7CiAgICAgIGlnbm9yZUVycm9ycwogICAgfSA9IHRoaXMucGRmTWFuYWdlci5ldmFsdWF0b3JPcHRpb25zOwogICAgY29uc3QgcXVldWUgPSBbewogICAgICBjdXJyZW50Tm9kZTogdGhpcy50b3BsZXZlbFBhZ2VzRGljdCwKICAgICAgcG9zSW5LaWRzOiAwCiAgICB9XTsKICAgIGNvbnN0IHZpc2l0ZWROb2RlcyA9IG5ldyBSZWZTZXQoKTsKICAgIGNvbnN0IHBhZ2VzUmVmID0gdGhpcy4jY2F0RGljdC5nZXRSYXcoIlBhZ2VzIik7CiAgICBpZiAocGFnZXNSZWYgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgdmlzaXRlZE5vZGVzLnB1dChwYWdlc1JlZik7CiAgICB9CiAgICBjb25zdCBtYXAgPSBuZXcgTWFwKCksCiAgICAgIHhyZWYgPSB0aGlzLnhyZWYsCiAgICAgIHBhZ2VJbmRleENhY2hlID0gdGhpcy5wYWdlSW5kZXhDYWNoZTsKICAgIGxldCBwYWdlSW5kZXggPSAwOwogICAgZnVuY3Rpb24gYWRkUGFnZURpY3QocGFnZURpY3QsIHBhZ2VSZWYpIHsKICAgICAgaWYgKHBhZ2VSZWYgJiYgIXBhZ2VJbmRleENhY2hlLmhhcyhwYWdlUmVmKSkgewogICAgICAgIHBhZ2VJbmRleENhY2hlLnB1dChwYWdlUmVmLCBwYWdlSW5kZXgpOwogICAgICB9CiAgICAgIG1hcC5zZXQocGFnZUluZGV4KyssIFtwYWdlRGljdCwgcGFnZVJlZl0pOwogICAgfQogICAgZnVuY3Rpb24gYWRkUGFnZUVycm9yKGVycm9yKSB7CiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIFhSZWZFbnRyeUV4Y2VwdGlvbiAmJiAhcmVjb3ZlcnlNb2RlKSB7CiAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgIH0KICAgICAgaWYgKHJlY292ZXJ5TW9kZSAmJiBpZ25vcmVFcnJvcnMgJiYgcGFnZUluZGV4ID09PSAwKSB7CiAgICAgICAgd2FybihgZ2V0QWxsUGFnZURpY3RzIC0gU2tpcHBpbmcgaW52YWxpZCBmaXJzdCBwYWdlOiAiJHtlcnJvcn0iLmApOwogICAgICAgIGVycm9yID0gRGljdC5lbXB0eTsKICAgICAgfQogICAgICBtYXAuc2V0KHBhZ2VJbmRleCsrLCBbZXJyb3IsIG51bGxdKTsKICAgIH0KICAgIHdoaWxlIChxdWV1ZS5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IHF1ZXVlSXRlbSA9IHF1ZXVlLmF0KC0xKTsKICAgICAgY29uc3QgewogICAgICAgIGN1cnJlbnROb2RlLAogICAgICAgIHBvc0luS2lkcwogICAgICB9ID0gcXVldWVJdGVtOwogICAgICBsZXQga2lkcyA9IGN1cnJlbnROb2RlLmdldFJhdygiS2lkcyIpOwogICAgICBpZiAoa2lkcyBpbnN0YW5jZW9mIFJlZikgewogICAgICAgIHRyeSB7CiAgICAgICAgICBraWRzID0gYXdhaXQgeHJlZi5mZXRjaEFzeW5jKGtpZHMpOwogICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICBhZGRQYWdlRXJyb3IoZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICghQXJyYXkuaXNBcnJheShraWRzKSkgewogICAgICAgIGFkZFBhZ2VFcnJvcihuZXcgRm9ybWF0RXJyb3IoIlBhZ2UgZGljdGlvbmFyeSBraWRzIG9iamVjdCBpcyBub3QgYW4gYXJyYXkuIikpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmIChwb3NJbktpZHMgPj0ga2lkcy5sZW5ndGgpIHsKICAgICAgICBxdWV1ZS5wb3AoKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBraWRPYmogPSBraWRzW3Bvc0luS2lkc107CiAgICAgIGxldCBvYmo7CiAgICAgIGlmIChraWRPYmogaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICBpZiAodmlzaXRlZE5vZGVzLmhhcyhraWRPYmopKSB7CiAgICAgICAgICBhZGRQYWdlRXJyb3IobmV3IEZvcm1hdEVycm9yKCJQYWdlcyB0cmVlIGNvbnRhaW5zIGNpcmN1bGFyIHJlZmVyZW5jZS4iKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgdmlzaXRlZE5vZGVzLnB1dChraWRPYmopOwogICAgICAgIHRyeSB7CiAgICAgICAgICBvYmogPSBhd2FpdCB4cmVmLmZldGNoQXN5bmMoa2lkT2JqKTsKICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgYWRkUGFnZUVycm9yKGV4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBvYmogPSBraWRPYmo7CiAgICAgIH0KICAgICAgaWYgKCEob2JqIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICBhZGRQYWdlRXJyb3IobmV3IEZvcm1hdEVycm9yKCJQYWdlIGRpY3Rpb25hcnkga2lkIHJlZmVyZW5jZSBwb2ludHMgdG8gd3JvbmcgdHlwZSBvZiBvYmplY3QuIikpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGxldCB0eXBlID0gb2JqLmdldFJhdygiVHlwZSIpOwogICAgICBpZiAodHlwZSBpbnN0YW5jZW9mIFJlZikgewogICAgICAgIHRyeSB7CiAgICAgICAgICB0eXBlID0gYXdhaXQgeHJlZi5mZXRjaEFzeW5jKHR5cGUpOwogICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICBhZGRQYWdlRXJyb3IoZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChpc05hbWUodHlwZSwgIlBhZ2UiKSB8fCAhb2JqLmhhcygiS2lkcyIpKSB7CiAgICAgICAgYWRkUGFnZURpY3Qob2JqLCBraWRPYmogaW5zdGFuY2VvZiBSZWYgPyBraWRPYmogOiBudWxsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBxdWV1ZS5wdXNoKHsKICAgICAgICAgIGN1cnJlbnROb2RlOiBvYmosCiAgICAgICAgICBwb3NJbktpZHM6IDAKICAgICAgICB9KTsKICAgICAgfQogICAgICBxdWV1ZUl0ZW0ucG9zSW5LaWRzKys7CiAgICB9CiAgICByZXR1cm4gbWFwOwogIH0KICBnZXRQYWdlSW5kZXgocGFnZVJlZikgewogICAgY29uc3QgY2FjaGVkUGFnZUluZGV4ID0gdGhpcy5wYWdlSW5kZXhDYWNoZS5nZXQocGFnZVJlZik7CiAgICBpZiAoY2FjaGVkUGFnZUluZGV4ICE9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjYWNoZWRQYWdlSW5kZXgpOwogICAgfQogICAgY29uc3QgeHJlZiA9IHRoaXMueHJlZjsKICAgIGZ1bmN0aW9uIHBhZ2VzQmVmb3JlUmVmKGtpZFJlZikgewogICAgICBsZXQgdG90YWwgPSAwLAogICAgICAgIHBhcmVudFJlZjsKICAgICAgcmV0dXJuIHhyZWYuZmV0Y2hBc3luYyhraWRSZWYpLnRoZW4oZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICBpZiAoaXNSZWZzRXF1YWwoa2lkUmVmLCBwYWdlUmVmKSAmJiAhaXNEaWN0KG5vZGUsICJQYWdlIikgJiYgIShub2RlIGluc3RhbmNlb2YgRGljdCAmJiAhbm9kZS5oYXMoIlR5cGUiKSAmJiBub2RlLmhhcygiQ29udGVudHMiKSkpIHsKICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiVGhlIHJlZmVyZW5jZSBkb2VzIG5vdCBwb2ludCB0byBhIC9QYWdlIGRpY3Rpb25hcnkuIik7CiAgICAgICAgfQogICAgICAgIGlmICghbm9kZSkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICghKG5vZGUgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJOb2RlIG11c3QgYmUgYSBkaWN0aW9uYXJ5LiIpOwogICAgICAgIH0KICAgICAgICBwYXJlbnRSZWYgPSBub2RlLmdldFJhdygiUGFyZW50Iik7CiAgICAgICAgcmV0dXJuIG5vZGUuZ2V0QXN5bmMoIlBhcmVudCIpOwogICAgICB9KS50aGVuKGZ1bmN0aW9uIChwYXJlbnQpIHsKICAgICAgICBpZiAoIXBhcmVudCkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICghKHBhcmVudCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlBhcmVudCBtdXN0IGJlIGEgZGljdGlvbmFyeS4iKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBhcmVudC5nZXRBc3luYygiS2lkcyIpOwogICAgICB9KS50aGVuKGZ1bmN0aW9uIChraWRzKSB7CiAgICAgICAgaWYgKCFraWRzKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgY29uc3Qga2lkUHJvbWlzZXMgPSBbXTsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBmb3IgKGNvbnN0IGtpZCBvZiBraWRzKSB7CiAgICAgICAgICBpZiAoIShraWQgaW5zdGFuY2VvZiBSZWYpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiS2lkIG11c3QgYmUgYSByZWZlcmVuY2UuIik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaXNSZWZzRXF1YWwoa2lkLCBraWRSZWYpKSB7CiAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBraWRQcm9taXNlcy5wdXNoKHhyZWYuZmV0Y2hBc3luYyhraWQpLnRoZW4oZnVuY3Rpb24gKG9iaikgewogICAgICAgICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiS2lkIG5vZGUgbXVzdCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9iai5oYXMoIkNvdW50IikpIHsKICAgICAgICAgICAgICB0b3RhbCArPSBvYmouZ2V0KCJDb3VudCIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRvdGFsKys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJLaWQgcmVmZXJlbmNlIG5vdCBmb3VuZCBpbiBwYXJlbnQncyBraWRzLiIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoa2lkUHJvbWlzZXMpLnRoZW4oKCkgPT4gW3RvdGFsLCBwYXJlbnRSZWZdKTsKICAgICAgfSk7CiAgICB9CiAgICBsZXQgdG90YWwgPSAwOwogICAgY29uc3QgbmV4dCA9IHJlZiA9PiBwYWdlc0JlZm9yZVJlZihyZWYpLnRoZW4oYXJncyA9PiB7CiAgICAgIGlmICghYXJncykgewogICAgICAgIHRoaXMucGFnZUluZGV4Q2FjaGUucHV0KHBhZ2VSZWYsIHRvdGFsKTsKICAgICAgICByZXR1cm4gdG90YWw7CiAgICAgIH0KICAgICAgY29uc3QgW2NvdW50LCBwYXJlbnRSZWZdID0gYXJnczsKICAgICAgdG90YWwgKz0gY291bnQ7CiAgICAgIHJldHVybiBuZXh0KHBhcmVudFJlZik7CiAgICB9KTsKICAgIHJldHVybiBuZXh0KHBhZ2VSZWYpOwogIH0KICBnZXQgYmFzZVVybCgpIHsKICAgIGNvbnN0IHVyaSA9IHRoaXMuI2NhdERpY3QuZ2V0KCJVUkkiKTsKICAgIGlmICh1cmkgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIGNvbnN0IGJhc2UgPSB1cmkuZ2V0KCJCYXNlIik7CiAgICAgIGlmICh0eXBlb2YgYmFzZSA9PT0gInN0cmluZyIpIHsKICAgICAgICBjb25zdCBhYnNvbHV0ZVVybCA9IGNyZWF0ZVZhbGlkQWJzb2x1dGVVcmwoYmFzZSwgbnVsbCwgewogICAgICAgICAgdHJ5Q29udmVydEVuY29kaW5nOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgaWYgKGFic29sdXRlVXJsKSB7CiAgICAgICAgICByZXR1cm4gc2hhZG93KHRoaXMsICJiYXNlVXJsIiwgYWJzb2x1dGVVcmwuaHJlZik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJiYXNlVXJsIiwgdGhpcy5wZGZNYW5hZ2VyLmRvY0Jhc2VVcmwpOwogIH0KICBzdGF0aWMgcGFyc2VEZXN0RGljdGlvbmFyeSh7CiAgICBkZXN0RGljdCwKICAgIHJlc3VsdE9iaiwKICAgIGRvY0Jhc2VVcmwgPSBudWxsLAogICAgZG9jQXR0YWNobWVudHMgPSBudWxsCiAgfSkgewogICAgaWYgKCEoZGVzdERpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICB3YXJuKCJwYXJzZURlc3REaWN0aW9uYXJ5OiBgZGVzdERpY3RgIG11c3QgYmUgYSBkaWN0aW9uYXJ5LiIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgYWN0aW9uID0gZGVzdERpY3QuZ2V0KCJBIiksCiAgICAgIHVybCwKICAgICAgZGVzdDsKICAgIGlmICghKGFjdGlvbiBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIGlmIChkZXN0RGljdC5oYXMoIkRlc3QiKSkgewogICAgICAgIGFjdGlvbiA9IGRlc3REaWN0LmdldCgiRGVzdCIpOwogICAgICB9IGVsc2UgewogICAgICAgIGFjdGlvbiA9IGRlc3REaWN0LmdldCgiQUEiKTsKICAgICAgICBpZiAoYWN0aW9uIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgICAgaWYgKGFjdGlvbi5oYXMoIkQiKSkgewogICAgICAgICAgICBhY3Rpb24gPSBhY3Rpb24uZ2V0KCJEIik7CiAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5oYXMoIlUiKSkgewogICAgICAgICAgICBhY3Rpb24gPSBhY3Rpb24uZ2V0KCJVIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoYWN0aW9uIGluc3RhbmNlb2YgRGljdCkgewogICAgICBjb25zdCBhY3Rpb25UeXBlID0gYWN0aW9uLmdldCgiUyIpOwogICAgICBpZiAoIShhY3Rpb25UeXBlIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgICB3YXJuKCJwYXJzZURlc3REaWN0aW9uYXJ5OiBJbnZhbGlkIHR5cGUgaW4gQWN0aW9uIGRpY3Rpb25hcnkuIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IGFjdGlvbk5hbWUgPSBhY3Rpb25UeXBlLm5hbWU7CiAgICAgIHN3aXRjaCAoYWN0aW9uTmFtZSkgewogICAgICAgIGNhc2UgIlJlc2V0Rm9ybSI6CiAgICAgICAgICBjb25zdCBmbGFncyA9IGFjdGlvbi5nZXQoIkZsYWdzIik7CiAgICAgICAgICBjb25zdCBpbmNsdWRlID0gKCh0eXBlb2YgZmxhZ3MgPT09ICJudW1iZXIiID8gZmxhZ3MgOiAwKSAmIDEpID09PSAwOwogICAgICAgICAgY29uc3QgZmllbGRzID0gW107CiAgICAgICAgICBjb25zdCByZWZzID0gW107CiAgICAgICAgICBmb3IgKGNvbnN0IG9iaiBvZiBhY3Rpb24uZ2V0KCJGaWVsZHMiKSB8fCBbXSkgewogICAgICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICAgICAgcmVmcy5wdXNoKG9iai50b1N0cmluZygpKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgIGZpZWxkcy5wdXNoKHN0cmluZ1RvUERGU3RyaW5nKG9iaikpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHRPYmoucmVzZXRGb3JtID0gewogICAgICAgICAgICBmaWVsZHMsCiAgICAgICAgICAgIHJlZnMsCiAgICAgICAgICAgIGluY2x1ZGUKICAgICAgICAgIH07CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJVUkkiOgogICAgICAgICAgdXJsID0gYWN0aW9uLmdldCgiVVJJIik7CiAgICAgICAgICBpZiAodXJsIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgICB1cmwgPSAiLyIgKyB1cmwubmFtZTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkdvVG8iOgogICAgICAgICAgZGVzdCA9IGFjdGlvbi5nZXQoIkQiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkxhdW5jaCI6CiAgICAgICAgY2FzZSAiR29Ub1IiOgogICAgICAgICAgY29uc3QgdXJsRGljdCA9IGFjdGlvbi5nZXQoIkYiKTsKICAgICAgICAgIGlmICh1cmxEaWN0IGluc3RhbmNlb2YgRGljdCkgewogICAgICAgICAgICBjb25zdCBmcyA9IG5ldyBGaWxlU3BlYyh1cmxEaWN0LCBudWxsLCB0cnVlKTsKICAgICAgICAgICAgY29uc3QgewogICAgICAgICAgICAgIHJhd0ZpbGVuYW1lCiAgICAgICAgICAgIH0gPSBmcy5zZXJpYWxpemFibGU7CiAgICAgICAgICAgIHVybCA9IHJhd0ZpbGVuYW1lOwogICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdXJsRGljdCA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgdXJsID0gdXJsRGljdDsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHJlbW90ZURlc3QgPSBmZXRjaFJlbW90ZURlc3QoYWN0aW9uKTsKICAgICAgICAgIGlmIChyZW1vdGVEZXN0ICYmIHR5cGVvZiB1cmwgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIHVybCA9IHVybC5zcGxpdCgiIyIsIDEpWzBdICsgIiMiICsgcmVtb3RlRGVzdDsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IG5ld1dpbmRvdyA9IGFjdGlvbi5nZXQoIk5ld1dpbmRvdyIpOwogICAgICAgICAgaWYgKHR5cGVvZiBuZXdXaW5kb3cgPT09ICJib29sZWFuIikgewogICAgICAgICAgICByZXN1bHRPYmoubmV3V2luZG93ID0gbmV3V2luZG93OwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiR29Ub0UiOgogICAgICAgICAgY29uc3QgdGFyZ2V0ID0gYWN0aW9uLmdldCgiVCIpOwogICAgICAgICAgbGV0IGF0dGFjaG1lbnQ7CiAgICAgICAgICBpZiAoZG9jQXR0YWNobWVudHMgJiYgdGFyZ2V0IGluc3RhbmNlb2YgRGljdCkgewogICAgICAgICAgICBjb25zdCByZWxhdGlvbnNoaXAgPSB0YXJnZXQuZ2V0KCJSIik7CiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSB0YXJnZXQuZ2V0KCJOIik7CiAgICAgICAgICAgIGlmIChpc05hbWUocmVsYXRpb25zaGlwLCAiQyIpICYmIHR5cGVvZiBuYW1lID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgIGF0dGFjaG1lbnQgPSBkb2NBdHRhY2htZW50c1tzdHJpbmdUb1BERlN0cmluZyhuYW1lLCB0cnVlKV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChhdHRhY2htZW50KSB7CiAgICAgICAgICAgIHJlc3VsdE9iai5hdHRhY2htZW50ID0gYXR0YWNobWVudDsKICAgICAgICAgICAgY29uc3QgYXR0YWNobWVudERlc3QgPSBmZXRjaFJlbW90ZURlc3QoYWN0aW9uKTsKICAgICAgICAgICAgaWYgKGF0dGFjaG1lbnREZXN0KSB7CiAgICAgICAgICAgICAgcmVzdWx0T2JqLmF0dGFjaG1lbnREZXN0ID0gYXR0YWNobWVudERlc3Q7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHdhcm4oYHBhcnNlRGVzdERpY3Rpb25hcnkgLSB1bmltcGxlbWVudGVkICJHb1RvRSIgYWN0aW9uLmApOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiTmFtZWQiOgogICAgICAgICAgY29uc3QgbmFtZWRBY3Rpb24gPSBhY3Rpb24uZ2V0KCJOIik7CiAgICAgICAgICBpZiAobmFtZWRBY3Rpb24gaW5zdGFuY2VvZiBOYW1lKSB7CiAgICAgICAgICAgIHJlc3VsdE9iai5hY3Rpb24gPSBuYW1lZEFjdGlvbi5uYW1lOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiU2V0T0NHU3RhdGUiOgogICAgICAgICAgY29uc3Qgc3RhdGUgPSBhY3Rpb24uZ2V0KCJTdGF0ZSIpOwogICAgICAgICAgY29uc3QgcHJlc2VydmVSQiA9IGFjdGlvbi5nZXQoIlByZXNlcnZlUkIiKTsKICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShzdGF0ZSkgfHwgc3RhdGUubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgY29uc3Qgc3RhdGVBcnIgPSBbXTsKICAgICAgICAgIGZvciAoY29uc3QgZWxlbSBvZiBzdGF0ZSkgewogICAgICAgICAgICBpZiAoZWxlbSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKGVsZW0ubmFtZSkgewogICAgICAgICAgICAgICAgY2FzZSAiT04iOgogICAgICAgICAgICAgICAgY2FzZSAiT0ZGIjoKICAgICAgICAgICAgICAgIGNhc2UgIlRvZ2dsZSI6CiAgICAgICAgICAgICAgICAgIHN0YXRlQXJyLnB1c2goZWxlbS5uYW1lKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW0gaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICAgICAgICBzdGF0ZUFyci5wdXNoKGVsZW0udG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdGF0ZUFyci5sZW5ndGggIT09IHN0YXRlLmxlbmd0aCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHJlc3VsdE9iai5zZXRPQ0dTdGF0ZSA9IHsKICAgICAgICAgICAgc3RhdGU6IHN0YXRlQXJyLAogICAgICAgICAgICBwcmVzZXJ2ZVJCOiB0eXBlb2YgcHJlc2VydmVSQiA9PT0gImJvb2xlYW4iID8gcHJlc2VydmVSQiA6IHRydWUKICAgICAgICAgIH07CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJKYXZhU2NyaXB0IjoKICAgICAgICAgIGNvbnN0IGpzQWN0aW9uID0gYWN0aW9uLmdldCgiSlMiKTsKICAgICAgICAgIGxldCBqczsKICAgICAgICAgIGlmIChqc0FjdGlvbiBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgICAgICAganMgPSBqc0FjdGlvbi5nZXRTdHJpbmcoKTsKICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGpzQWN0aW9uID09PSAic3RyaW5nIikgewogICAgICAgICAgICBqcyA9IGpzQWN0aW9uOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QganNVUkwgPSBqcyAmJiByZWNvdmVySnNVUkwoc3RyaW5nVG9QREZTdHJpbmcoanMsIHRydWUpKTsKICAgICAgICAgIGlmIChqc1VSTCkgewogICAgICAgICAgICB1cmwgPSBqc1VSTC51cmw7CiAgICAgICAgICAgIHJlc3VsdE9iai5uZXdXaW5kb3cgPSBqc1VSTC5uZXdXaW5kb3c7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBpZiAoYWN0aW9uTmFtZSA9PT0gIkphdmFTY3JpcHQiIHx8IGFjdGlvbk5hbWUgPT09ICJTdWJtaXRGb3JtIikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHdhcm4oYHBhcnNlRGVzdERpY3Rpb25hcnkgLSB1bnN1cHBvcnRlZCBhY3Rpb246ICIke2FjdGlvbk5hbWV9Ii5gKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGRlc3REaWN0LmhhcygiRGVzdCIpKSB7CiAgICAgIGRlc3QgPSBkZXN0RGljdC5nZXQoIkRlc3QiKTsKICAgIH0KICAgIGlmICh0eXBlb2YgdXJsID09PSAic3RyaW5nIikgewogICAgICBjb25zdCBhYnNvbHV0ZVVybCA9IGNyZWF0ZVZhbGlkQWJzb2x1dGVVcmwodXJsLCBkb2NCYXNlVXJsLCB7CiAgICAgICAgYWRkRGVmYXVsdFByb3RvY29sOiB0cnVlLAogICAgICAgIHRyeUNvbnZlcnRFbmNvZGluZzogdHJ1ZQogICAgICB9KTsKICAgICAgaWYgKGFic29sdXRlVXJsKSB7CiAgICAgICAgcmVzdWx0T2JqLnVybCA9IGFic29sdXRlVXJsLmhyZWY7CiAgICAgIH0KICAgICAgcmVzdWx0T2JqLnVuc2FmZVVybCA9IHVybDsKICAgIH0KICAgIGlmIChkZXN0KSB7CiAgICAgIGlmIChkZXN0IGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgIGRlc3QgPSBkZXN0Lm5hbWU7CiAgICAgIH0KICAgICAgaWYgKHR5cGVvZiBkZXN0ID09PSAic3RyaW5nIikgewogICAgICAgIHJlc3VsdE9iai5kZXN0ID0gc3RyaW5nVG9QREZTdHJpbmcoZGVzdCwgdHJ1ZSk7CiAgICAgIH0gZWxzZSBpZiAoaXNWYWxpZEV4cGxpY2l0RGVzdChkZXN0KSkgewogICAgICAgIHJlc3VsdE9iai5kZXN0ID0gZGVzdDsKICAgICAgfQogICAgfQogIH0KfQoKOy8vIC4vc3JjL2NvcmUvb2JqZWN0X2xvYWRlci5qcwoKCgoKZnVuY3Rpb24gbWF5SGF2ZUNoaWxkcmVuKHZhbHVlKSB7CiAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUmVmIHx8IHZhbHVlIGluc3RhbmNlb2YgRGljdCB8fCB2YWx1ZSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0gfHwgQXJyYXkuaXNBcnJheSh2YWx1ZSk7Cn0KZnVuY3Rpb24gYWRkQ2hpbGRyZW4obm9kZSwgbm9kZXNUb1Zpc2l0KSB7CiAgaWYgKG5vZGUgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICBub2RlID0gbm9kZS5nZXRSYXdWYWx1ZXMoKTsKICB9IGVsc2UgaWYgKG5vZGUgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICBub2RlID0gbm9kZS5kaWN0LmdldFJhd1ZhbHVlcygpOwogIH0gZWxzZSBpZiAoIUFycmF5LmlzQXJyYXkobm9kZSkpIHsKICAgIHJldHVybjsKICB9CiAgZm9yIChjb25zdCByYXdWYWx1ZSBvZiBub2RlKSB7CiAgICBpZiAobWF5SGF2ZUNoaWxkcmVuKHJhd1ZhbHVlKSkgewogICAgICBub2Rlc1RvVmlzaXQucHVzaChyYXdWYWx1ZSk7CiAgICB9CiAgfQp9CmNsYXNzIE9iamVjdExvYWRlciB7CiAgcmVmU2V0ID0gbmV3IFJlZlNldCgpOwogIGNvbnN0cnVjdG9yKGRpY3QsIGtleXMsIHhyZWYpIHsKICAgIHRoaXMuZGljdCA9IGRpY3Q7CiAgICB0aGlzLmtleXMgPSBrZXlzOwogICAgdGhpcy54cmVmID0geHJlZjsKICB9CiAgYXN5bmMgbG9hZCgpIHsKICAgIGNvbnN0IHsKICAgICAga2V5cywKICAgICAgZGljdAogICAgfSA9IHRoaXM7CiAgICBjb25zdCBub2Rlc1RvVmlzaXQgPSBbXTsKICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHsKICAgICAgY29uc3QgcmF3VmFsdWUgPSBkaWN0LmdldFJhdyhrZXkpOwogICAgICBpZiAocmF3VmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIG5vZGVzVG9WaXNpdC5wdXNoKHJhd1ZhbHVlKTsKICAgICAgfQogICAgfQogICAgYXdhaXQgdGhpcy4jd2Fsayhub2Rlc1RvVmlzaXQpOwogICAgdGhpcy5yZWZTZXQgPSBudWxsOwogIH0KICBhc3luYyAjd2Fsayhub2Rlc1RvVmlzaXQpIHsKICAgIGNvbnN0IG5vZGVzVG9SZXZpc2l0ID0gW107CiAgICBjb25zdCBwZW5kaW5nUmVxdWVzdHMgPSBbXTsKICAgIHdoaWxlIChub2Rlc1RvVmlzaXQubGVuZ3RoKSB7CiAgICAgIGxldCBjdXJyZW50Tm9kZSA9IG5vZGVzVG9WaXNpdC5wb3AoKTsKICAgICAgaWYgKGN1cnJlbnROb2RlIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgaWYgKHRoaXMucmVmU2V0LmhhcyhjdXJyZW50Tm9kZSkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgdGhpcy5yZWZTZXQucHV0KGN1cnJlbnROb2RlKTsKICAgICAgICAgIGN1cnJlbnROb2RlID0gdGhpcy54cmVmLmZldGNoKGN1cnJlbnROb2RlKTsKICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgaWYgKCEoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikpIHsKICAgICAgICAgICAgd2FybihgT2JqZWN0TG9hZGVyLiN3YWxrIC0gcmVxdWVzdGluZyBhbGwgZGF0YTogIiR7ZXh9Ii5gKTsKICAgICAgICAgICAgYXdhaXQgdGhpcy54cmVmLnN0cmVhbS5tYW5hZ2VyLnJlcXVlc3RBbGxDaHVua3MoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgbm9kZXNUb1JldmlzaXQucHVzaChjdXJyZW50Tm9kZSk7CiAgICAgICAgICBwZW5kaW5nUmVxdWVzdHMucHVzaCh7CiAgICAgICAgICAgIGJlZ2luOiBleC5iZWdpbiwKICAgICAgICAgICAgZW5kOiBleC5lbmQKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoY3VycmVudE5vZGUgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgICAgY29uc3QgYmFzZVN0cmVhbXMgPSBjdXJyZW50Tm9kZS5nZXRCYXNlU3RyZWFtcygpOwogICAgICAgIGlmIChiYXNlU3RyZWFtcykgewogICAgICAgICAgbGV0IGZvdW5kTWlzc2luZ0RhdGEgPSBmYWxzZTsKICAgICAgICAgIGZvciAoY29uc3Qgc3RyZWFtIG9mIGJhc2VTdHJlYW1zKSB7CiAgICAgICAgICAgIGlmIChzdHJlYW0uaXNEYXRhTG9hZGVkKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm91bmRNaXNzaW5nRGF0YSA9IHRydWU7CiAgICAgICAgICAgIHBlbmRpbmdSZXF1ZXN0cy5wdXNoKHsKICAgICAgICAgICAgICBiZWdpbjogc3RyZWFtLnN0YXJ0LAogICAgICAgICAgICAgIGVuZDogc3RyZWFtLmVuZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChmb3VuZE1pc3NpbmdEYXRhKSB7CiAgICAgICAgICAgIG5vZGVzVG9SZXZpc2l0LnB1c2goY3VycmVudE5vZGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBhZGRDaGlsZHJlbihjdXJyZW50Tm9kZSwgbm9kZXNUb1Zpc2l0KTsKICAgIH0KICAgIGlmIChwZW5kaW5nUmVxdWVzdHMubGVuZ3RoKSB7CiAgICAgIGF3YWl0IHRoaXMueHJlZi5zdHJlYW0ubWFuYWdlci5yZXF1ZXN0UmFuZ2VzKHBlbmRpbmdSZXF1ZXN0cyk7CiAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlc1RvUmV2aXNpdCkgewogICAgICAgIGlmIChub2RlIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICB0aGlzLnJlZlNldC5yZW1vdmUobm9kZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGF3YWl0IHRoaXMuI3dhbGsobm9kZXNUb1JldmlzaXQpOwogICAgfQogIH0KICBzdGF0aWMgYXN5bmMgbG9hZChvYmosIGtleXMsIHhyZWYpIHsKICAgIGlmICh4cmVmLnN0cmVhbS5pc0RhdGFMb2FkZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgb2JqTG9hZGVyID0gbmV3IE9iamVjdExvYWRlcihvYmosIGtleXMsIHhyZWYpOwogICAgYXdhaXQgb2JqTG9hZGVyLmxvYWQoKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS9zeW1ib2xfdXRpbHMuanMKY29uc3QgJGFjY2VwdFdoaXRlc3BhY2UgPSBTeW1ib2woKTsKY29uc3QgJGFkZEhUTUwgPSBTeW1ib2woKTsKY29uc3QgJGFwcGVuZENoaWxkID0gU3ltYm9sKCk7CmNvbnN0ICRjaGlsZHJlblRvSFRNTCA9IFN5bWJvbCgpOwpjb25zdCAkY2xlYW4gPSBTeW1ib2woKTsKY29uc3QgJGNsZWFuUGFnZSA9IFN5bWJvbCgpOwpjb25zdCAkY2xlYW51cCA9IFN5bWJvbCgpOwpjb25zdCAkY2xvbmUgPSBTeW1ib2woKTsKY29uc3QgJGNvbnN1bWVkID0gU3ltYm9sKCk7CmNvbnN0ICRjb250ZW50ID0gU3ltYm9sKCJjb250ZW50Iik7CmNvbnN0ICRkYXRhID0gU3ltYm9sKCJkYXRhIik7CmNvbnN0ICRkdW1wID0gU3ltYm9sKCk7CmNvbnN0ICRleHRyYSA9IFN5bWJvbCgiZXh0cmEiKTsKY29uc3QgJGZpbmFsaXplID0gU3ltYm9sKCk7CmNvbnN0ICRmbHVzaEhUTUwgPSBTeW1ib2woKTsKY29uc3QgJGdldEF0dHJpYnV0ZUl0ID0gU3ltYm9sKCk7CmNvbnN0ICRnZXRBdHRyaWJ1dGVzID0gU3ltYm9sKCk7CmNvbnN0ICRnZXRBdmFpbGFibGVTcGFjZSA9IFN5bWJvbCgpOwpjb25zdCAkZ2V0Q2hpbGRyZW5CeUNsYXNzID0gU3ltYm9sKCk7CmNvbnN0ICRnZXRDaGlsZHJlbkJ5TmFtZSA9IFN5bWJvbCgpOwpjb25zdCAkZ2V0Q2hpbGRyZW5CeU5hbWVJdCA9IFN5bWJvbCgpOwpjb25zdCAkZ2V0RGF0YVZhbHVlID0gU3ltYm9sKCk7CmNvbnN0ICRnZXRFeHRyYSA9IFN5bWJvbCgpOwpjb25zdCAkZ2V0UmVhbENoaWxkcmVuQnlOYW1lSXQgPSBTeW1ib2woKTsKY29uc3QgJGdldENoaWxkcmVuID0gU3ltYm9sKCk7CmNvbnN0ICRnZXRDb250YWluZWRDaGlsZHJlbiA9IFN5bWJvbCgpOwpjb25zdCAkZ2V0TmV4dFBhZ2UgPSBTeW1ib2woKTsKY29uc3QgJGdldFN1YmZvcm1QYXJlbnQgPSBTeW1ib2woKTsKY29uc3QgJGdldFBhcmVudCA9IFN5bWJvbCgpOwpjb25zdCAkZ2V0VGVtcGxhdGVSb290ID0gU3ltYm9sKCk7CmNvbnN0ICRnbG9iYWxEYXRhID0gU3ltYm9sKCk7CmNvbnN0ICRoYXNTZXR0YWJsZVZhbHVlID0gU3ltYm9sKCk7CmNvbnN0ICRpZHMgPSBTeW1ib2woKTsKY29uc3QgJGluZGV4T2YgPSBTeW1ib2woKTsKY29uc3QgJGluc2VydEF0ID0gU3ltYm9sKCk7CmNvbnN0ICRpc0NEQVRBWG1sID0gU3ltYm9sKCk7CmNvbnN0ICRpc0JpbmRhYmxlID0gU3ltYm9sKCk7CmNvbnN0ICRpc0RhdGFWYWx1ZSA9IFN5bWJvbCgpOwpjb25zdCAkaXNEZXNjZW5kZW50ID0gU3ltYm9sKCk7CmNvbnN0ICRpc05zQWdub3N0aWMgPSBTeW1ib2woKTsKY29uc3QgJGlzU3BsaXR0YWJsZSA9IFN5bWJvbCgpOwpjb25zdCAkaXNUaGVyZU1vcmVXaWR0aCA9IFN5bWJvbCgpOwpjb25zdCAkaXNUcmFuc3BhcmVudCA9IFN5bWJvbCgpOwpjb25zdCAkaXNVc2FibGUgPSBTeW1ib2woKTsKY29uc3QgJGxhc3RBdHRyaWJ1dGUgPSBTeW1ib2woKTsKY29uc3QgJG5hbWVzcGFjZUlkID0gU3ltYm9sKCJuYW1lc3BhY2VJZCIpOwpjb25zdCAkbm9kZU5hbWUgPSBTeW1ib2woIm5vZGVOYW1lIik7CmNvbnN0ICRuc0F0dHJpYnV0ZXMgPSBTeW1ib2woKTsKY29uc3QgJG9uQ2hpbGQgPSBTeW1ib2woKTsKY29uc3QgJG9uQ2hpbGRDaGVjayA9IFN5bWJvbCgpOwpjb25zdCAkb25UZXh0ID0gU3ltYm9sKCk7CmNvbnN0ICRwdXNoR2x5cGhzID0gU3ltYm9sKCk7CmNvbnN0ICRwb3BQYXJhID0gU3ltYm9sKCk7CmNvbnN0ICRwdXNoUGFyYSA9IFN5bWJvbCgpOwpjb25zdCAkcmVtb3ZlQ2hpbGQgPSBTeW1ib2woKTsKY29uc3QgJHJvb3QgPSBTeW1ib2woInJvb3QiKTsKY29uc3QgJHJlc29sdmVQcm90b3R5cGVzID0gU3ltYm9sKCk7CmNvbnN0ICRzZWFyY2hOb2RlID0gU3ltYm9sKCk7CmNvbnN0ICRzZXRJZCA9IFN5bWJvbCgpOwpjb25zdCAkc2V0U2V0QXR0cmlidXRlcyA9IFN5bWJvbCgpOwpjb25zdCAkc2V0VmFsdWUgPSBTeW1ib2woKTsKY29uc3QgJHRhYkluZGV4ID0gU3ltYm9sKCk7CmNvbnN0ICR0ZXh0ID0gU3ltYm9sKCk7CmNvbnN0ICR0b1BhZ2VzID0gU3ltYm9sKCk7CmNvbnN0ICR0b0hUTUwgPSBTeW1ib2woKTsKY29uc3QgJHRvU3RyaW5nID0gU3ltYm9sKCk7CmNvbnN0ICR0b1N0eWxlID0gU3ltYm9sKCk7CmNvbnN0ICR1aWQgPSBTeW1ib2woInVpZCIpOwoKOy8vIC4vc3JjL2NvcmUveGZhL25hbWVzcGFjZXMuanMKY29uc3QgJGJ1aWxkWEZBT2JqZWN0ID0gU3ltYm9sKCk7CmNvbnN0IE5hbWVzcGFjZUlkcyA9IHsKICBjb25maWc6IHsKICAgIGlkOiAwLAogICAgY2hlY2s6IG5zID0+IG5zLnN0YXJ0c1dpdGgoImh0dHA6Ly93d3cueGZhLm9yZy9zY2hlbWEveGNpLyIpCiAgfSwKICBjb25uZWN0aW9uU2V0OiB7CiAgICBpZDogMSwKICAgIGNoZWNrOiBucyA9PiBucy5zdGFydHNXaXRoKCJodHRwOi8vd3d3LnhmYS5vcmcvc2NoZW1hL3hmYS1jb25uZWN0aW9uLXNldC8iKQogIH0sCiAgZGF0YXNldHM6IHsKICAgIGlkOiAyLAogICAgY2hlY2s6IG5zID0+IG5zLnN0YXJ0c1dpdGgoImh0dHA6Ly93d3cueGZhLm9yZy9zY2hlbWEveGZhLWRhdGEvIikKICB9LAogIGZvcm06IHsKICAgIGlkOiAzLAogICAgY2hlY2s6IG5zID0+IG5zLnN0YXJ0c1dpdGgoImh0dHA6Ly93d3cueGZhLm9yZy9zY2hlbWEveGZhLWZvcm0vIikKICB9LAogIGxvY2FsZVNldDogewogICAgaWQ6IDQsCiAgICBjaGVjazogbnMgPT4gbnMuc3RhcnRzV2l0aCgiaHR0cDovL3d3dy54ZmEub3JnL3NjaGVtYS94ZmEtbG9jYWxlLXNldC8iKQogIH0sCiAgcGRmOiB7CiAgICBpZDogNSwKICAgIGNoZWNrOiBucyA9PiBucyA9PT0gImh0dHA6Ly9ucy5hZG9iZS5jb20veGRwL3BkZi8iCiAgfSwKICBzaWduYXR1cmU6IHsKICAgIGlkOiA2LAogICAgY2hlY2s6IG5zID0+IG5zID09PSAiaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyIKICB9LAogIHNvdXJjZVNldDogewogICAgaWQ6IDcsCiAgICBjaGVjazogbnMgPT4gbnMuc3RhcnRzV2l0aCgiaHR0cDovL3d3dy54ZmEub3JnL3NjaGVtYS94ZmEtc291cmNlLXNldC8iKQogIH0sCiAgc3R5bGVzaGVldDogewogICAgaWQ6IDgsCiAgICBjaGVjazogbnMgPT4gbnMgPT09ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L1hTTC9UcmFuc2Zvcm0iCiAgfSwKICB0ZW1wbGF0ZTogewogICAgaWQ6IDksCiAgICBjaGVjazogbnMgPT4gbnMuc3RhcnRzV2l0aCgiaHR0cDovL3d3dy54ZmEub3JnL3NjaGVtYS94ZmEtdGVtcGxhdGUvIikKICB9LAogIHhkYzogewogICAgaWQ6IDEwLAogICAgY2hlY2s6IG5zID0+IG5zLnN0YXJ0c1dpdGgoImh0dHA6Ly93d3cueGZhLm9yZy9zY2hlbWEveGRjLyIpCiAgfSwKICB4ZHA6IHsKICAgIGlkOiAxMSwKICAgIGNoZWNrOiBucyA9PiBucyA9PT0gImh0dHA6Ly9ucy5hZG9iZS5jb20veGRwLyIKICB9LAogIHhmZGY6IHsKICAgIGlkOiAxMiwKICAgIGNoZWNrOiBucyA9PiBucyA9PT0gImh0dHA6Ly9ucy5hZG9iZS5jb20veGZkZi8iCiAgfSwKICB4aHRtbDogewogICAgaWQ6IDEzLAogICAgY2hlY2s6IG5zID0+IG5zID09PSAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIKICB9LAogIHhtcG1ldGE6IHsKICAgIGlkOiAxNCwKICAgIGNoZWNrOiBucyA9PiBucyA9PT0gImh0dHA6Ly9ucy5hZG9iZS5jb20veG1wbWV0YS8iCiAgfQp9OwoKOy8vIC4vc3JjL2NvcmUveGZhL3V0aWxzLmpzCgpjb25zdCBkaW1Db252ZXJ0ZXJzID0gewogIHB0OiB4ID0+IHgsCiAgY206IHggPT4geCAvIDIuNTQgKiA3MiwKICBtbTogeCA9PiB4IC8gKDEwICogMi41NCkgKiA3MiwKICBpbjogeCA9PiB4ICogNzIsCiAgcHg6IHggPT4geAp9Owpjb25zdCBtZWFzdXJlbWVudFBhdHRlcm4gPSAvKFsrLV0/XGQrXC4/XGQqKSguKikvOwpmdW5jdGlvbiBzdHJpcFF1b3RlcyhzdHIpIHsKICBpZiAoc3RyLnN0YXJ0c1dpdGgoIiciKSB8fCBzdHIuc3RhcnRzV2l0aCgnIicpKSB7CiAgICByZXR1cm4gc3RyLnNsaWNlKDEsIC0xKTsKICB9CiAgcmV0dXJuIHN0cjsKfQpmdW5jdGlvbiBnZXRJbnRlZ2VyKHsKICBkYXRhLAogIGRlZmF1bHRWYWx1ZSwKICB2YWxpZGF0ZQp9KSB7CiAgaWYgKCFkYXRhKSB7CiAgICByZXR1cm4gZGVmYXVsdFZhbHVlOwogIH0KICBkYXRhID0gZGF0YS50cmltKCk7CiAgY29uc3QgbiA9IHBhcnNlSW50KGRhdGEsIDEwKTsKICBpZiAoIWlzTmFOKG4pICYmIHZhbGlkYXRlKG4pKSB7CiAgICByZXR1cm4gbjsKICB9CiAgcmV0dXJuIGRlZmF1bHRWYWx1ZTsKfQpmdW5jdGlvbiBnZXRGbG9hdCh7CiAgZGF0YSwKICBkZWZhdWx0VmFsdWUsCiAgdmFsaWRhdGUKfSkgewogIGlmICghZGF0YSkgewogICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTsKICB9CiAgZGF0YSA9IGRhdGEudHJpbSgpOwogIGNvbnN0IG4gPSBwYXJzZUZsb2F0KGRhdGEpOwogIGlmICghaXNOYU4obikgJiYgdmFsaWRhdGUobikpIHsKICAgIHJldHVybiBuOwogIH0KICByZXR1cm4gZGVmYXVsdFZhbHVlOwp9CmZ1bmN0aW9uIGdldEtleXdvcmQoewogIGRhdGEsCiAgZGVmYXVsdFZhbHVlLAogIHZhbGlkYXRlCn0pIHsKICBpZiAoIWRhdGEpIHsKICAgIHJldHVybiBkZWZhdWx0VmFsdWU7CiAgfQogIGRhdGEgPSBkYXRhLnRyaW0oKTsKICBpZiAodmFsaWRhdGUoZGF0YSkpIHsKICAgIHJldHVybiBkYXRhOwogIH0KICByZXR1cm4gZGVmYXVsdFZhbHVlOwp9CmZ1bmN0aW9uIGdldFN0cmluZ09wdGlvbihkYXRhLCBvcHRpb25zKSB7CiAgcmV0dXJuIGdldEtleXdvcmQoewogICAgZGF0YSwKICAgIGRlZmF1bHRWYWx1ZTogb3B0aW9uc1swXSwKICAgIHZhbGlkYXRlOiBrID0+IG9wdGlvbnMuaW5jbHVkZXMoaykKICB9KTsKfQpmdW5jdGlvbiBnZXRNZWFzdXJlbWVudChzdHIsIGRlZiA9ICIwIikgewogIGRlZiB8fD0gIjAiOwogIGlmICghc3RyKSB7CiAgICByZXR1cm4gZ2V0TWVhc3VyZW1lbnQoZGVmKTsKICB9CiAgY29uc3QgbWF0Y2ggPSBzdHIudHJpbSgpLm1hdGNoKG1lYXN1cmVtZW50UGF0dGVybik7CiAgaWYgKCFtYXRjaCkgewogICAgcmV0dXJuIGdldE1lYXN1cmVtZW50KGRlZik7CiAgfQogIGNvbnN0IFssIHZhbHVlU3RyLCB1bml0XSA9IG1hdGNoOwogIGNvbnN0IHZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZVN0cik7CiAgaWYgKGlzTmFOKHZhbHVlKSkgewogICAgcmV0dXJuIGdldE1lYXN1cmVtZW50KGRlZik7CiAgfQogIGlmICh2YWx1ZSA9PT0gMCkgewogICAgcmV0dXJuIDA7CiAgfQogIGNvbnN0IGNvbnYgPSBkaW1Db252ZXJ0ZXJzW3VuaXRdOwogIGlmIChjb252KSB7CiAgICByZXR1cm4gY29udih2YWx1ZSk7CiAgfQogIHJldHVybiB2YWx1ZTsKfQpmdW5jdGlvbiBnZXRSYXRpbyhkYXRhKSB7CiAgaWYgKCFkYXRhKSB7CiAgICByZXR1cm4gewogICAgICBudW06IDEsCiAgICAgIGRlbjogMQogICAgfTsKICB9CiAgY29uc3QgcmF0aW8gPSBkYXRhLnNwbGl0KCI6IiwgMikubWFwKHggPT4gcGFyc2VGbG9hdCh4LnRyaW0oKSkpLmZpbHRlcih4ID0+ICFpc05hTih4KSk7CiAgaWYgKHJhdGlvLmxlbmd0aCA9PT0gMSkgewogICAgcmF0aW8ucHVzaCgxKTsKICB9CiAgaWYgKHJhdGlvLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIHsKICAgICAgbnVtOiAxLAogICAgICBkZW46IDEKICAgIH07CiAgfQogIGNvbnN0IFtudW0sIGRlbl0gPSByYXRpbzsKICByZXR1cm4gewogICAgbnVtLAogICAgZGVuCiAgfTsKfQpmdW5jdGlvbiBnZXRSZWxldmFudChkYXRhKSB7CiAgaWYgKCFkYXRhKSB7CiAgICByZXR1cm4gW107CiAgfQogIHJldHVybiBkYXRhLnRyaW0oKS5zcGxpdCgvXHMrLykubWFwKGUgPT4gKHsKICAgIGV4Y2x1ZGVkOiBlWzBdID09PSAiLSIsCiAgICB2aWV3bmFtZTogZS5zdWJzdHJpbmcoMSkKICB9KSk7Cn0KZnVuY3Rpb24gZ2V0Q29sb3IoZGF0YSwgZGVmID0gWzAsIDAsIDBdKSB7CiAgbGV0IFtyLCBnLCBiXSA9IGRlZjsKICBpZiAoIWRhdGEpIHsKICAgIHJldHVybiB7CiAgICAgIHIsCiAgICAgIGcsCiAgICAgIGIKICAgIH07CiAgfQogIGNvbnN0IGNvbG9yID0gZGF0YS5zcGxpdCgiLCIsIDMpLm1hcChjID0+IE1hdGhDbGFtcChwYXJzZUludChjLnRyaW0oKSwgMTApLCAwLCAyNTUpKS5tYXAoYyA9PiBpc05hTihjKSA/IDAgOiBjKTsKICBpZiAoY29sb3IubGVuZ3RoIDwgMykgewogICAgcmV0dXJuIHsKICAgICAgciwKICAgICAgZywKICAgICAgYgogICAgfTsKICB9CiAgW3IsIGcsIGJdID0gY29sb3I7CiAgcmV0dXJuIHsKICAgIHIsCiAgICBnLAogICAgYgogIH07Cn0KZnVuY3Rpb24gZ2V0QkJveChkYXRhKSB7CiAgY29uc3QgZGVmID0gLTE7CiAgaWYgKCFkYXRhKSB7CiAgICByZXR1cm4gewogICAgICB4OiBkZWYsCiAgICAgIHk6IGRlZiwKICAgICAgd2lkdGg6IGRlZiwKICAgICAgaGVpZ2h0OiBkZWYKICAgIH07CiAgfQogIGNvbnN0IGJib3ggPSBkYXRhLnNwbGl0KCIsIiwgNCkubWFwKG0gPT4gZ2V0TWVhc3VyZW1lbnQobS50cmltKCksICItMSIpKTsKICBpZiAoYmJveC5sZW5ndGggPCA0IHx8IGJib3hbMl0gPCAwIHx8IGJib3hbM10gPCAwKSB7CiAgICByZXR1cm4gewogICAgICB4OiBkZWYsCiAgICAgIHk6IGRlZiwKICAgICAgd2lkdGg6IGRlZiwKICAgICAgaGVpZ2h0OiBkZWYKICAgIH07CiAgfQogIGNvbnN0IFt4LCB5LCB3aWR0aCwgaGVpZ2h0XSA9IGJib3g7CiAgcmV0dXJuIHsKICAgIHgsCiAgICB5LAogICAgd2lkdGgsCiAgICBoZWlnaHQKICB9Owp9CmNsYXNzIEhUTUxSZXN1bHQgewogIHN0YXRpYyBnZXQgRkFJTFVSRSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgIkZBSUxVUkUiLCBuZXcgSFRNTFJlc3VsdChmYWxzZSwgbnVsbCwgbnVsbCwgbnVsbCkpOwogIH0KICBzdGF0aWMgZ2V0IEVNUFRZKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiRU1QVFkiLCBuZXcgSFRNTFJlc3VsdCh0cnVlLCBudWxsLCBudWxsLCBudWxsKSk7CiAgfQogIGNvbnN0cnVjdG9yKHN1Y2Nlc3MsIGh0bWwsIGJib3gsIGJyZWFrTm9kZSkgewogICAgdGhpcy5zdWNjZXNzID0gc3VjY2VzczsKICAgIHRoaXMuaHRtbCA9IGh0bWw7CiAgICB0aGlzLmJib3ggPSBiYm94OwogICAgdGhpcy5icmVha05vZGUgPSBicmVha05vZGU7CiAgfQogIGlzQnJlYWsoKSB7CiAgICByZXR1cm4gISF0aGlzLmJyZWFrTm9kZTsKICB9CiAgc3RhdGljIGJyZWFrTm9kZShub2RlKSB7CiAgICByZXR1cm4gbmV3IEhUTUxSZXN1bHQoZmFsc2UsIG51bGwsIG51bGwsIG5vZGUpOwogIH0KICBzdGF0aWMgc3VjY2VzcyhodG1sLCBiYm94ID0gbnVsbCkgewogICAgcmV0dXJuIG5ldyBIVE1MUmVzdWx0KHRydWUsIGh0bWwsIGJib3gsIG51bGwpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL2ZvbnRzLmpzCgoKCmNsYXNzIEZvbnRGaW5kZXIgewogIGNvbnN0cnVjdG9yKHBkZkZvbnRzKSB7CiAgICB0aGlzLmZvbnRzID0gbmV3IE1hcCgpOwogICAgdGhpcy5jYWNoZSA9IG5ldyBNYXAoKTsKICAgIHRoaXMud2FybmVkID0gbmV3IFNldCgpOwogICAgdGhpcy5kZWZhdWx0Rm9udCA9IG51bGw7CiAgICB0aGlzLmFkZChwZGZGb250cyk7CiAgfQogIGFkZChwZGZGb250cywgcmVhbGx5TWlzc2luZ0ZvbnRzID0gbnVsbCkgewogICAgZm9yIChjb25zdCBwZGZGb250IG9mIHBkZkZvbnRzKSB7CiAgICAgIHRoaXMuYWRkUGRmRm9udChwZGZGb250KTsKICAgIH0KICAgIGZvciAoY29uc3QgcGRmRm9udCBvZiB0aGlzLmZvbnRzLnZhbHVlcygpKSB7CiAgICAgIGlmICghcGRmRm9udC5yZWd1bGFyKSB7CiAgICAgICAgcGRmRm9udC5yZWd1bGFyID0gcGRmRm9udC5pdGFsaWMgfHwgcGRmRm9udC5ib2xkIHx8IHBkZkZvbnQuYm9sZGl0YWxpYzsKICAgICAgfQogICAgfQogICAgaWYgKCFyZWFsbHlNaXNzaW5nRm9udHMgfHwgcmVhbGx5TWlzc2luZ0ZvbnRzLnNpemUgPT09IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgbXlyaWFkID0gdGhpcy5mb250cy5nZXQoIlBkZkpTLUZhbGxiYWNrLVBkZkpTLVhGQSIpOwogICAgZm9yIChjb25zdCBtaXNzaW5nIG9mIHJlYWxseU1pc3NpbmdGb250cykgewogICAgICB0aGlzLmZvbnRzLnNldChtaXNzaW5nLCBteXJpYWQpOwogICAgfQogIH0KICBhZGRQZGZGb250KHBkZkZvbnQpIHsKICAgIGNvbnN0IGNzc0ZvbnRJbmZvID0gcGRmRm9udC5jc3NGb250SW5mbzsKICAgIGNvbnN0IG5hbWUgPSBjc3NGb250SW5mby5mb250RmFtaWx5OwogICAgbGV0IGZvbnQgPSB0aGlzLmZvbnRzLmdldChuYW1lKTsKICAgIGlmICghZm9udCkgewogICAgICBmb250ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgdGhpcy5mb250cy5zZXQobmFtZSwgZm9udCk7CiAgICAgIGlmICghdGhpcy5kZWZhdWx0Rm9udCkgewogICAgICAgIHRoaXMuZGVmYXVsdEZvbnQgPSBmb250OwogICAgICB9CiAgICB9CiAgICBsZXQgcHJvcGVydHkgPSAiIjsKICAgIGNvbnN0IGZvbnRXZWlnaHQgPSBwYXJzZUZsb2F0KGNzc0ZvbnRJbmZvLmZvbnRXZWlnaHQpOwogICAgaWYgKHBhcnNlRmxvYXQoY3NzRm9udEluZm8uaXRhbGljQW5nbGUpICE9PSAwKSB7CiAgICAgIHByb3BlcnR5ID0gZm9udFdlaWdodCA+PSA3MDAgPyAiYm9sZGl0YWxpYyIgOiAiaXRhbGljIjsKICAgIH0gZWxzZSBpZiAoZm9udFdlaWdodCA+PSA3MDApIHsKICAgICAgcHJvcGVydHkgPSAiYm9sZCI7CiAgICB9CiAgICBpZiAoIXByb3BlcnR5KSB7CiAgICAgIGlmIChwZGZGb250Lm5hbWUuaW5jbHVkZXMoIkJvbGQiKSB8fCBwZGZGb250LnBzTmFtZT8uaW5jbHVkZXMoIkJvbGQiKSkgewogICAgICAgIHByb3BlcnR5ID0gImJvbGQiOwogICAgICB9CiAgICAgIGlmIChwZGZGb250Lm5hbWUuaW5jbHVkZXMoIkl0YWxpYyIpIHx8IHBkZkZvbnQubmFtZS5lbmRzV2l0aCgiSXQiKSB8fCBwZGZGb250LnBzTmFtZT8uaW5jbHVkZXMoIkl0YWxpYyIpIHx8IHBkZkZvbnQucHNOYW1lPy5lbmRzV2l0aCgiSXQiKSkgewogICAgICAgIHByb3BlcnR5ICs9ICJpdGFsaWMiOwogICAgICB9CiAgICB9CiAgICBpZiAoIXByb3BlcnR5KSB7CiAgICAgIHByb3BlcnR5ID0gInJlZ3VsYXIiOwogICAgfQogICAgZm9udFtwcm9wZXJ0eV0gPSBwZGZGb250OwogIH0KICBnZXREZWZhdWx0KCkgewogICAgcmV0dXJuIHRoaXMuZGVmYXVsdEZvbnQ7CiAgfQogIGZpbmQoZm9udE5hbWUsIG11c3RXYXJuID0gdHJ1ZSkgewogICAgbGV0IGZvbnQgPSB0aGlzLmZvbnRzLmdldChmb250TmFtZSkgfHwgdGhpcy5jYWNoZS5nZXQoZm9udE5hbWUpOwogICAgaWYgKGZvbnQpIHsKICAgICAgcmV0dXJuIGZvbnQ7CiAgICB9CiAgICBjb25zdCBwYXR0ZXJuID0gLyx8LXxffCB8Ym9sZGl0YWxpY3xib2xkfGl0YWxpY3xyZWd1bGFyfGl0L2dpOwogICAgbGV0IG5hbWUgPSBmb250TmFtZS5yZXBsYWNlQWxsKHBhdHRlcm4sICIiKTsKICAgIGZvbnQgPSB0aGlzLmZvbnRzLmdldChuYW1lKTsKICAgIGlmIChmb250KSB7CiAgICAgIHRoaXMuY2FjaGUuc2V0KGZvbnROYW1lLCBmb250KTsKICAgICAgcmV0dXJuIGZvbnQ7CiAgICB9CiAgICBuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgY29uc3QgbWF5YmUgPSBbXTsKICAgIGZvciAoY29uc3QgW2ZhbWlseSwgcGRmRm9udF0gb2YgdGhpcy5mb250cy5lbnRyaWVzKCkpIHsKICAgICAgaWYgKGZhbWlseS5yZXBsYWNlQWxsKHBhdHRlcm4sICIiKS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgobmFtZSkpIHsKICAgICAgICBtYXliZS5wdXNoKHBkZkZvbnQpOwogICAgICB9CiAgICB9CiAgICBpZiAobWF5YmUubGVuZ3RoID09PSAwKSB7CiAgICAgIGZvciAoY29uc3QgWywgcGRmRm9udF0gb2YgdGhpcy5mb250cy5lbnRyaWVzKCkpIHsKICAgICAgICBpZiAocGRmRm9udC5yZWd1bGFyLm5hbWU/LnJlcGxhY2VBbGwocGF0dGVybiwgIiIpLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChuYW1lKSkgewogICAgICAgICAgbWF5YmUucHVzaChwZGZGb250KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChtYXliZS5sZW5ndGggPT09IDApIHsKICAgICAgbmFtZSA9IG5hbWUucmVwbGFjZUFsbCgvcHNtdHxtdC9naSwgIiIpOwogICAgICBmb3IgKGNvbnN0IFtmYW1pbHksIHBkZkZvbnRdIG9mIHRoaXMuZm9udHMuZW50cmllcygpKSB7CiAgICAgICAgaWYgKGZhbWlseS5yZXBsYWNlQWxsKHBhdHRlcm4sICIiKS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgobmFtZSkpIHsKICAgICAgICAgIG1heWJlLnB1c2gocGRmRm9udCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAobWF5YmUubGVuZ3RoID09PSAwKSB7CiAgICAgIGZvciAoY29uc3QgcGRmRm9udCBvZiB0aGlzLmZvbnRzLnZhbHVlcygpKSB7CiAgICAgICAgaWYgKHBkZkZvbnQucmVndWxhci5uYW1lPy5yZXBsYWNlQWxsKHBhdHRlcm4sICIiKS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgobmFtZSkpIHsKICAgICAgICAgIG1heWJlLnB1c2gocGRmRm9udCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAobWF5YmUubGVuZ3RoID49IDEpIHsKICAgICAgaWYgKG1heWJlLmxlbmd0aCAhPT0gMSAmJiBtdXN0V2FybikgewogICAgICAgIHdhcm4oYFhGQSAtIFRvbyBtYW55IGNob2ljZXMgdG8gZ3Vlc3MgdGhlIGNvcnJlY3QgZm9udDogJHtmb250TmFtZX1gKTsKICAgICAgfQogICAgICB0aGlzLmNhY2hlLnNldChmb250TmFtZSwgbWF5YmVbMF0pOwogICAgICByZXR1cm4gbWF5YmVbMF07CiAgICB9CiAgICBpZiAobXVzdFdhcm4gJiYgIXRoaXMud2FybmVkLmhhcyhmb250TmFtZSkpIHsKICAgICAgdGhpcy53YXJuZWQuYWRkKGZvbnROYW1lKTsKICAgICAgd2FybihgWEZBIC0gQ2Fubm90IGZpbmQgdGhlIGZvbnQ6ICR7Zm9udE5hbWV9YCk7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9Cn0KZnVuY3Rpb24gc2VsZWN0Rm9udCh4ZmFGb250LCB0eXBlZmFjZSkgewogIGlmICh4ZmFGb250LnBvc3R1cmUgPT09ICJpdGFsaWMiKSB7CiAgICBpZiAoeGZhRm9udC53ZWlnaHQgPT09ICJib2xkIikgewogICAgICByZXR1cm4gdHlwZWZhY2UuYm9sZGl0YWxpYzsKICAgIH0KICAgIHJldHVybiB0eXBlZmFjZS5pdGFsaWM7CiAgfSBlbHNlIGlmICh4ZmFGb250LndlaWdodCA9PT0gImJvbGQiKSB7CiAgICByZXR1cm4gdHlwZWZhY2UuYm9sZDsKICB9CiAgcmV0dXJuIHR5cGVmYWNlLnJlZ3VsYXI7Cn0KZnVuY3Rpb24gZm9udHNfZ2V0TWV0cmljcyh4ZmFGb250LCByZWFsID0gZmFsc2UpIHsKICBsZXQgcGRmRm9udCA9IG51bGw7CiAgaWYgKHhmYUZvbnQpIHsKICAgIGNvbnN0IG5hbWUgPSBzdHJpcFF1b3Rlcyh4ZmFGb250LnR5cGVmYWNlKTsKICAgIGNvbnN0IHR5cGVmYWNlID0geGZhRm9udFskZ2xvYmFsRGF0YV0uZm9udEZpbmRlci5maW5kKG5hbWUpOwogICAgcGRmRm9udCA9IHNlbGVjdEZvbnQoeGZhRm9udCwgdHlwZWZhY2UpOwogIH0KICBpZiAoIXBkZkZvbnQpIHsKICAgIHJldHVybiB7CiAgICAgIGxpbmVIZWlnaHQ6IDEyLAogICAgICBsaW5lR2FwOiAyLAogICAgICBsaW5lTm9HYXA6IDEwCiAgICB9OwogIH0KICBjb25zdCBzaXplID0geGZhRm9udC5zaXplIHx8IDEwOwogIGNvbnN0IGxpbmVIZWlnaHQgPSBwZGZGb250LmxpbmVIZWlnaHQgPyBNYXRoLm1heChyZWFsID8gMCA6IDEuMiwgcGRmRm9udC5saW5lSGVpZ2h0KSA6IDEuMjsKICBjb25zdCBsaW5lR2FwID0gcGRmRm9udC5saW5lR2FwID09PSB1bmRlZmluZWQgPyAwLjIgOiBwZGZGb250LmxpbmVHYXA7CiAgcmV0dXJuIHsKICAgIGxpbmVIZWlnaHQ6IGxpbmVIZWlnaHQgKiBzaXplLAogICAgbGluZUdhcDogbGluZUdhcCAqIHNpemUsCiAgICBsaW5lTm9HYXA6IE1hdGgubWF4KDEsIGxpbmVIZWlnaHQgLSBsaW5lR2FwKSAqIHNpemUKICB9Owp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvdGV4dC5qcwoKY29uc3QgV0lEVEhfRkFDVE9SID0gMS4wMjsKY2xhc3MgRm9udEluZm8gewogIGNvbnN0cnVjdG9yKHhmYUZvbnQsIG1hcmdpbiwgbGluZUhlaWdodCwgZm9udEZpbmRlcikgewogICAgdGhpcy5saW5lSGVpZ2h0ID0gbGluZUhlaWdodDsKICAgIHRoaXMucGFyYU1hcmdpbiA9IG1hcmdpbiB8fCB7CiAgICAgIHRvcDogMCwKICAgICAgYm90dG9tOiAwLAogICAgICBsZWZ0OiAwLAogICAgICByaWdodDogMAogICAgfTsKICAgIGlmICgheGZhRm9udCkgewogICAgICBbdGhpcy5wZGZGb250LCB0aGlzLnhmYUZvbnRdID0gdGhpcy5kZWZhdWx0Rm9udChmb250RmluZGVyKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy54ZmFGb250ID0gewogICAgICB0eXBlZmFjZTogeGZhRm9udC50eXBlZmFjZSwKICAgICAgcG9zdHVyZTogeGZhRm9udC5wb3N0dXJlLAogICAgICB3ZWlnaHQ6IHhmYUZvbnQud2VpZ2h0LAogICAgICBzaXplOiB4ZmFGb250LnNpemUsCiAgICAgIGxldHRlclNwYWNpbmc6IHhmYUZvbnQubGV0dGVyU3BhY2luZwogICAgfTsKICAgIGNvbnN0IHR5cGVmYWNlID0gZm9udEZpbmRlci5maW5kKHhmYUZvbnQudHlwZWZhY2UpOwogICAgaWYgKCF0eXBlZmFjZSkgewogICAgICBbdGhpcy5wZGZGb250LCB0aGlzLnhmYUZvbnRdID0gdGhpcy5kZWZhdWx0Rm9udChmb250RmluZGVyKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5wZGZGb250ID0gc2VsZWN0Rm9udCh4ZmFGb250LCB0eXBlZmFjZSk7CiAgICBpZiAoIXRoaXMucGRmRm9udCkgewogICAgICBbdGhpcy5wZGZGb250LCB0aGlzLnhmYUZvbnRdID0gdGhpcy5kZWZhdWx0Rm9udChmb250RmluZGVyKTsKICAgIH0KICB9CiAgZGVmYXVsdEZvbnQoZm9udEZpbmRlcikgewogICAgY29uc3QgZm9udCA9IGZvbnRGaW5kZXIuZmluZCgiSGVsdmV0aWNhIiwgZmFsc2UpIHx8IGZvbnRGaW5kZXIuZmluZCgiTXlyaWFkIFBybyIsIGZhbHNlKSB8fCBmb250RmluZGVyLmZpbmQoIkFyaWFsIiwgZmFsc2UpIHx8IGZvbnRGaW5kZXIuZ2V0RGVmYXVsdCgpOwogICAgaWYgKGZvbnQ/LnJlZ3VsYXIpIHsKICAgICAgY29uc3QgcGRmRm9udCA9IGZvbnQucmVndWxhcjsKICAgICAgY29uc3QgaW5mbyA9IHBkZkZvbnQuY3NzRm9udEluZm87CiAgICAgIGNvbnN0IHhmYUZvbnQgPSB7CiAgICAgICAgdHlwZWZhY2U6IGluZm8uZm9udEZhbWlseSwKICAgICAgICBwb3N0dXJlOiAibm9ybWFsIiwKICAgICAgICB3ZWlnaHQ6ICJub3JtYWwiLAogICAgICAgIHNpemU6IDEwLAogICAgICAgIGxldHRlclNwYWNpbmc6IDAKICAgICAgfTsKICAgICAgcmV0dXJuIFtwZGZGb250LCB4ZmFGb250XTsKICAgIH0KICAgIGNvbnN0IHhmYUZvbnQgPSB7CiAgICAgIHR5cGVmYWNlOiAiQ291cmllciIsCiAgICAgIHBvc3R1cmU6ICJub3JtYWwiLAogICAgICB3ZWlnaHQ6ICJub3JtYWwiLAogICAgICBzaXplOiAxMCwKICAgICAgbGV0dGVyU3BhY2luZzogMAogICAgfTsKICAgIHJldHVybiBbbnVsbCwgeGZhRm9udF07CiAgfQp9CmNsYXNzIEZvbnRTZWxlY3RvciB7CiAgY29uc3RydWN0b3IoZGVmYXVsdFhmYUZvbnQsIGRlZmF1bHRQYXJhTWFyZ2luLCBkZWZhdWx0TGluZUhlaWdodCwgZm9udEZpbmRlcikgewogICAgdGhpcy5mb250RmluZGVyID0gZm9udEZpbmRlcjsKICAgIHRoaXMuc3RhY2sgPSBbbmV3IEZvbnRJbmZvKGRlZmF1bHRYZmFGb250LCBkZWZhdWx0UGFyYU1hcmdpbiwgZGVmYXVsdExpbmVIZWlnaHQsIGZvbnRGaW5kZXIpXTsKICB9CiAgcHVzaERhdGEoeGZhRm9udCwgbWFyZ2luLCBsaW5lSGVpZ2h0KSB7CiAgICBjb25zdCBsYXN0Rm9udCA9IHRoaXMuc3RhY2suYXQoLTEpOwogICAgZm9yIChjb25zdCBuYW1lIG9mIFsidHlwZWZhY2UiLCAicG9zdHVyZSIsICJ3ZWlnaHQiLCAic2l6ZSIsICJsZXR0ZXJTcGFjaW5nIl0pIHsKICAgICAgaWYgKCF4ZmFGb250W25hbWVdKSB7CiAgICAgICAgeGZhRm9udFtuYW1lXSA9IGxhc3RGb250LnhmYUZvbnRbbmFtZV07CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3QgbmFtZSBvZiBbInRvcCIsICJib3R0b20iLCAibGVmdCIsICJyaWdodCJdKSB7CiAgICAgIGlmIChpc05hTihtYXJnaW5bbmFtZV0pKSB7CiAgICAgICAgbWFyZ2luW25hbWVdID0gbGFzdEZvbnQucGFyYU1hcmdpbltuYW1lXTsKICAgICAgfQogICAgfQogICAgY29uc3QgZm9udEluZm8gPSBuZXcgRm9udEluZm8oeGZhRm9udCwgbWFyZ2luLCBsaW5lSGVpZ2h0IHx8IGxhc3RGb250LmxpbmVIZWlnaHQsIHRoaXMuZm9udEZpbmRlcik7CiAgICBpZiAoIWZvbnRJbmZvLnBkZkZvbnQpIHsKICAgICAgZm9udEluZm8ucGRmRm9udCA9IGxhc3RGb250LnBkZkZvbnQ7CiAgICB9CiAgICB0aGlzLnN0YWNrLnB1c2goZm9udEluZm8pOwogIH0KICBwb3BGb250KCkgewogICAgdGhpcy5zdGFjay5wb3AoKTsKICB9CiAgdG9wRm9udCgpIHsKICAgIHJldHVybiB0aGlzLnN0YWNrLmF0KC0xKTsKICB9Cn0KY2xhc3MgVGV4dE1lYXN1cmUgewogIGNvbnN0cnVjdG9yKGRlZmF1bHRYZmFGb250LCBkZWZhdWx0UGFyYU1hcmdpbiwgZGVmYXVsdExpbmVIZWlnaHQsIGZvbnRzKSB7CiAgICB0aGlzLmdseXBocyA9IFtdOwogICAgdGhpcy5mb250U2VsZWN0b3IgPSBuZXcgRm9udFNlbGVjdG9yKGRlZmF1bHRYZmFGb250LCBkZWZhdWx0UGFyYU1hcmdpbiwgZGVmYXVsdExpbmVIZWlnaHQsIGZvbnRzKTsKICAgIHRoaXMuZXh0cmFIZWlnaHQgPSAwOwogIH0KICBwdXNoRGF0YSh4ZmFGb250LCBtYXJnaW4sIGxpbmVIZWlnaHQpIHsKICAgIHRoaXMuZm9udFNlbGVjdG9yLnB1c2hEYXRhKHhmYUZvbnQsIG1hcmdpbiwgbGluZUhlaWdodCk7CiAgfQogIHBvcEZvbnQoeGZhRm9udCkgewogICAgcmV0dXJuIHRoaXMuZm9udFNlbGVjdG9yLnBvcEZvbnQoKTsKICB9CiAgYWRkUGFyYSgpIHsKICAgIGNvbnN0IGxhc3RGb250ID0gdGhpcy5mb250U2VsZWN0b3IudG9wRm9udCgpOwogICAgdGhpcy5leHRyYUhlaWdodCArPSBsYXN0Rm9udC5wYXJhTWFyZ2luLnRvcCArIGxhc3RGb250LnBhcmFNYXJnaW4uYm90dG9tOwogIH0KICBhZGRTdHJpbmcoc3RyKSB7CiAgICBpZiAoIXN0cikgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBsYXN0Rm9udCA9IHRoaXMuZm9udFNlbGVjdG9yLnRvcEZvbnQoKTsKICAgIGNvbnN0IGZvbnRTaXplID0gbGFzdEZvbnQueGZhRm9udC5zaXplOwogICAgaWYgKGxhc3RGb250LnBkZkZvbnQpIHsKICAgICAgY29uc3QgbGV0dGVyU3BhY2luZyA9IGxhc3RGb250LnhmYUZvbnQubGV0dGVyU3BhY2luZzsKICAgICAgY29uc3QgcGRmRm9udCA9IGxhc3RGb250LnBkZkZvbnQ7CiAgICAgIGNvbnN0IGZvbnRMaW5lSGVpZ2h0ID0gcGRmRm9udC5saW5lSGVpZ2h0IHx8IDEuMjsKICAgICAgY29uc3QgbGluZUhlaWdodCA9IGxhc3RGb250LmxpbmVIZWlnaHQgfHwgTWF0aC5tYXgoMS4yLCBmb250TGluZUhlaWdodCkgKiBmb250U2l6ZTsKICAgICAgY29uc3QgbGluZUdhcCA9IHBkZkZvbnQubGluZUdhcCA9PT0gdW5kZWZpbmVkID8gMC4yIDogcGRmRm9udC5saW5lR2FwOwogICAgICBjb25zdCBub0dhcCA9IGZvbnRMaW5lSGVpZ2h0IC0gbGluZUdhcDsKICAgICAgY29uc3QgZmlyc3RMaW5lSGVpZ2h0ID0gTWF0aC5tYXgoMSwgbm9HYXApICogZm9udFNpemU7CiAgICAgIGNvbnN0IHNjYWxlID0gZm9udFNpemUgLyAxMDAwOwogICAgICBjb25zdCBmYWxsYmFja1dpZHRoID0gcGRmRm9udC5kZWZhdWx0V2lkdGggfHwgcGRmRm9udC5jaGFyc1RvR2x5cGhzKCIgIilbMF0ud2lkdGg7CiAgICAgIGZvciAoY29uc3QgbGluZSBvZiBzdHIuc3BsaXQoL1tcdTIwMjlcbl0vKSkgewogICAgICAgIGNvbnN0IGVuY29kZWRMaW5lID0gcGRmRm9udC5lbmNvZGVTdHJpbmcobGluZSkuam9pbigiIik7CiAgICAgICAgY29uc3QgZ2x5cGhzID0gcGRmRm9udC5jaGFyc1RvR2x5cGhzKGVuY29kZWRMaW5lKTsKICAgICAgICBmb3IgKGNvbnN0IGdseXBoIG9mIGdseXBocykgewogICAgICAgICAgY29uc3Qgd2lkdGggPSBnbHlwaC53aWR0aCB8fCBmYWxsYmFja1dpZHRoOwogICAgICAgICAgdGhpcy5nbHlwaHMucHVzaChbd2lkdGggKiBzY2FsZSArIGxldHRlclNwYWNpbmcsIGxpbmVIZWlnaHQsIGZpcnN0TGluZUhlaWdodCwgZ2x5cGgudW5pY29kZSwgZmFsc2VdKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5nbHlwaHMucHVzaChbMCwgMCwgMCwgIlxuIiwgdHJ1ZV0pOwogICAgICB9CiAgICAgIHRoaXMuZ2x5cGhzLnBvcCgpOwogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IGxpbmUgb2Ygc3RyLnNwbGl0KC9bXHUyMDI5XG5dLykpIHsKICAgICAgZm9yIChjb25zdCBjaGFyIG9mIGxpbmUuc3BsaXQoIiIpKSB7CiAgICAgICAgdGhpcy5nbHlwaHMucHVzaChbZm9udFNpemUsIDEuMiAqIGZvbnRTaXplLCBmb250U2l6ZSwgY2hhciwgZmFsc2VdKTsKICAgICAgfQogICAgICB0aGlzLmdseXBocy5wdXNoKFswLCAwLCAwLCAiXG4iLCB0cnVlXSk7CiAgICB9CiAgICB0aGlzLmdseXBocy5wb3AoKTsKICB9CiAgY29tcHV0ZShtYXhXaWR0aCkgewogICAgbGV0IGxhc3RTcGFjZVBvcyA9IC0xLAogICAgICBsYXN0U3BhY2VXaWR0aCA9IDAsCiAgICAgIHdpZHRoID0gMCwKICAgICAgaGVpZ2h0ID0gMCwKICAgICAgY3VycmVudExpbmVXaWR0aCA9IDAsCiAgICAgIGN1cnJlbnRMaW5lSGVpZ2h0ID0gMDsKICAgIGxldCBpc0Jyb2tlbiA9IGZhbHNlOwogICAgbGV0IGlzRmlyc3RMaW5lID0gdHJ1ZTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHRoaXMuZ2x5cGhzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgW2dseXBoV2lkdGgsIGxpbmVIZWlnaHQsIGZpcnN0TGluZUhlaWdodCwgY2hhciwgaXNFT0xdID0gdGhpcy5nbHlwaHNbaV07CiAgICAgIGNvbnN0IGlzU3BhY2UgPSBjaGFyID09PSAiICI7CiAgICAgIGNvbnN0IGdseXBoSGVpZ2h0ID0gaXNGaXJzdExpbmUgPyBmaXJzdExpbmVIZWlnaHQgOiBsaW5lSGVpZ2h0OwogICAgICBpZiAoaXNFT0wpIHsKICAgICAgICB3aWR0aCA9IE1hdGgubWF4KHdpZHRoLCBjdXJyZW50TGluZVdpZHRoKTsKICAgICAgICBjdXJyZW50TGluZVdpZHRoID0gMDsKICAgICAgICBoZWlnaHQgKz0gY3VycmVudExpbmVIZWlnaHQ7CiAgICAgICAgY3VycmVudExpbmVIZWlnaHQgPSBnbHlwaEhlaWdodDsKICAgICAgICBsYXN0U3BhY2VQb3MgPSAtMTsKICAgICAgICBsYXN0U3BhY2VXaWR0aCA9IDA7CiAgICAgICAgaXNGaXJzdExpbmUgPSBmYWxzZTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoaXNTcGFjZSkgewogICAgICAgIGlmIChjdXJyZW50TGluZVdpZHRoICsgZ2x5cGhXaWR0aCA+IG1heFdpZHRoKSB7CiAgICAgICAgICB3aWR0aCA9IE1hdGgubWF4KHdpZHRoLCBjdXJyZW50TGluZVdpZHRoKTsKICAgICAgICAgIGN1cnJlbnRMaW5lV2lkdGggPSAwOwogICAgICAgICAgaGVpZ2h0ICs9IGN1cnJlbnRMaW5lSGVpZ2h0OwogICAgICAgICAgY3VycmVudExpbmVIZWlnaHQgPSBnbHlwaEhlaWdodDsKICAgICAgICAgIGxhc3RTcGFjZVBvcyA9IC0xOwogICAgICAgICAgbGFzdFNwYWNlV2lkdGggPSAwOwogICAgICAgICAgaXNCcm9rZW4gPSB0cnVlOwogICAgICAgICAgaXNGaXJzdExpbmUgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3VycmVudExpbmVIZWlnaHQgPSBNYXRoLm1heChnbHlwaEhlaWdodCwgY3VycmVudExpbmVIZWlnaHQpOwogICAgICAgICAgbGFzdFNwYWNlV2lkdGggPSBjdXJyZW50TGluZVdpZHRoOwogICAgICAgICAgY3VycmVudExpbmVXaWR0aCArPSBnbHlwaFdpZHRoOwogICAgICAgICAgbGFzdFNwYWNlUG9zID0gaTsKICAgICAgICB9CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGN1cnJlbnRMaW5lV2lkdGggKyBnbHlwaFdpZHRoID4gbWF4V2lkdGgpIHsKICAgICAgICBoZWlnaHQgKz0gY3VycmVudExpbmVIZWlnaHQ7CiAgICAgICAgY3VycmVudExpbmVIZWlnaHQgPSBnbHlwaEhlaWdodDsKICAgICAgICBpZiAobGFzdFNwYWNlUG9zICE9PSAtMSkgewogICAgICAgICAgaSA9IGxhc3RTcGFjZVBvczsKICAgICAgICAgIHdpZHRoID0gTWF0aC5tYXgod2lkdGgsIGxhc3RTcGFjZVdpZHRoKTsKICAgICAgICAgIGN1cnJlbnRMaW5lV2lkdGggPSAwOwogICAgICAgICAgbGFzdFNwYWNlUG9zID0gLTE7CiAgICAgICAgICBsYXN0U3BhY2VXaWR0aCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdpZHRoID0gTWF0aC5tYXgod2lkdGgsIGN1cnJlbnRMaW5lV2lkdGgpOwogICAgICAgICAgY3VycmVudExpbmVXaWR0aCA9IGdseXBoV2lkdGg7CiAgICAgICAgfQogICAgICAgIGlzQnJva2VuID0gdHJ1ZTsKICAgICAgICBpc0ZpcnN0TGluZSA9IGZhbHNlOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGN1cnJlbnRMaW5lV2lkdGggKz0gZ2x5cGhXaWR0aDsKICAgICAgY3VycmVudExpbmVIZWlnaHQgPSBNYXRoLm1heChnbHlwaEhlaWdodCwgY3VycmVudExpbmVIZWlnaHQpOwogICAgfQogICAgd2lkdGggPSBNYXRoLm1heCh3aWR0aCwgY3VycmVudExpbmVXaWR0aCk7CiAgICBoZWlnaHQgKz0gY3VycmVudExpbmVIZWlnaHQgKyB0aGlzLmV4dHJhSGVpZ2h0OwogICAgcmV0dXJuIHsKICAgICAgd2lkdGg6IFdJRFRIX0ZBQ1RPUiAqIHdpZHRoLAogICAgICBoZWlnaHQsCiAgICAgIGlzQnJva2VuCiAgICB9OwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL3NvbS5qcwoKCmNvbnN0IG5hbWVQYXR0ZXJuID0gL15bXi5bXSsvOwpjb25zdCBpbmRleFBhdHRlcm4gPSAvXlteXF1dKy87CmNvbnN0IG9wZXJhdG9ycyA9IHsKICBkb3Q6IDAsCiAgZG90RG90OiAxLAogIGRvdEhhc2g6IDIsCiAgZG90QnJhY2tldDogMywKICBkb3RQYXJlbjogNAp9Owpjb25zdCBzaG9ydGN1dHMgPSBuZXcgTWFwKFtbIiRkYXRhIiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3QuZGF0YXNldHMgPyByb290LmRhdGFzZXRzLmRhdGEgOiByb290XSwgWyIkcmVjb3JkIiwgKHJvb3QsIGN1cnJlbnQpID0+IChyb290LmRhdGFzZXRzID8gcm9vdC5kYXRhc2V0cy5kYXRhIDogcm9vdClbJGdldENoaWxkcmVuXSgpWzBdXSwgWyIkdGVtcGxhdGUiLCAocm9vdCwgY3VycmVudCkgPT4gcm9vdC50ZW1wbGF0ZV0sIFsiJGNvbm5lY3Rpb25TZXQiLCAocm9vdCwgY3VycmVudCkgPT4gcm9vdC5jb25uZWN0aW9uU2V0XSwgWyIkZm9ybSIsIChyb290LCBjdXJyZW50KSA9PiByb290LmZvcm1dLCBbIiRsYXlvdXQiLCAocm9vdCwgY3VycmVudCkgPT4gcm9vdC5sYXlvdXRdLCBbIiRob3N0IiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3QuaG9zdF0sIFsiJGRhdGFXaW5kb3ciLCAocm9vdCwgY3VycmVudCkgPT4gcm9vdC5kYXRhV2luZG93XSwgWyIkZXZlbnQiLCAocm9vdCwgY3VycmVudCkgPT4gcm9vdC5ldmVudF0sIFsiISIsIChyb290LCBjdXJyZW50KSA9PiByb290LmRhdGFzZXRzXSwgWyIkeGZhIiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3RdLCBbInhmYSIsIChyb290LCBjdXJyZW50KSA9PiByb290XSwgWyIkIiwgKHJvb3QsIGN1cnJlbnQpID0+IGN1cnJlbnRdXSk7CmNvbnN0IHNvbUNhY2hlID0gbmV3IFdlYWtNYXAoKTsKZnVuY3Rpb24gcGFyc2VJbmRleChpbmRleCkgewogIGluZGV4ID0gaW5kZXgudHJpbSgpOwogIGlmIChpbmRleCA9PT0gIioiKSB7CiAgICByZXR1cm4gSW5maW5pdHk7CiAgfQogIHJldHVybiBwYXJzZUludChpbmRleCwgMTApIHx8IDA7Cn0KZnVuY3Rpb24gcGFyc2VFeHByZXNzaW9uKGV4cHIsIGRvdERvdEFsbG93ZWQsIG5vRXhwciA9IHRydWUpIHsKICBsZXQgbWF0Y2ggPSBleHByLm1hdGNoKG5hbWVQYXR0ZXJuKTsKICBpZiAoIW1hdGNoKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgbGV0IFtuYW1lXSA9IG1hdGNoOwogIGNvbnN0IHBhcnNlZCA9IFt7CiAgICBuYW1lLAogICAgY2FjaGVOYW1lOiAiLiIgKyBuYW1lLAogICAgaW5kZXg6IDAsCiAgICBqczogbnVsbCwKICAgIGZvcm1DYWxjOiBudWxsLAogICAgb3BlcmF0b3I6IG9wZXJhdG9ycy5kb3QKICB9XTsKICBsZXQgcG9zID0gbmFtZS5sZW5ndGg7CiAgd2hpbGUgKHBvcyA8IGV4cHIubGVuZ3RoKSB7CiAgICBjb25zdCBzcG9zID0gcG9zOwogICAgY29uc3QgY2hhciA9IGV4cHIuY2hhckF0KHBvcysrKTsKICAgIGlmIChjaGFyID09PSAiWyIpIHsKICAgICAgbWF0Y2ggPSBleHByLnNsaWNlKHBvcykubWF0Y2goaW5kZXhQYXR0ZXJuKTsKICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgIHdhcm4oIlhGQSAtIEludmFsaWQgaW5kZXggaW4gU09NIGV4cHJlc3Npb24iKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBwYXJzZWQuYXQoLTEpLmluZGV4ID0gcGFyc2VJbmRleChtYXRjaFswXSk7CiAgICAgIHBvcyArPSBtYXRjaFswXS5sZW5ndGggKyAxOwogICAgICBjb250aW51ZTsKICAgIH0KICAgIGxldCBvcGVyYXRvcjsKICAgIHN3aXRjaCAoZXhwci5jaGFyQXQocG9zKSkgewogICAgICBjYXNlICIuIjoKICAgICAgICBpZiAoIWRvdERvdEFsbG93ZWQpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBwb3MrKzsKICAgICAgICBvcGVyYXRvciA9IG9wZXJhdG9ycy5kb3REb3Q7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIiMiOgogICAgICAgIHBvcysrOwogICAgICAgIG9wZXJhdG9yID0gb3BlcmF0b3JzLmRvdEhhc2g7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIlsiOgogICAgICAgIGlmIChub0V4cHIpIHsKICAgICAgICAgIHdhcm4oIlhGQSAtIFNPTSBleHByZXNzaW9uIGNvbnRhaW5zIGEgRm9ybUNhbGMgc3ViZXhwcmVzc2lvbiB3aGljaCBpcyBub3Qgc3VwcG9ydGVkIGZvciBub3cuIik7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgb3BlcmF0b3IgPSBvcGVyYXRvcnMuZG90QnJhY2tldDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiKCI6CiAgICAgICAgaWYgKG5vRXhwcikgewogICAgICAgICAgd2FybigiWEZBIC0gU09NIGV4cHJlc3Npb24gY29udGFpbnMgYSBKYXZhU2NyaXB0IHN1YmV4cHJlc3Npb24gd2hpY2ggaXMgbm90IHN1cHBvcnRlZCBmb3Igbm93LiIpOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIG9wZXJhdG9yID0gb3BlcmF0b3JzLmRvdFBhcmVuOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIG9wZXJhdG9yID0gb3BlcmF0b3JzLmRvdDsKICAgICAgICBicmVhazsKICAgIH0KICAgIG1hdGNoID0gZXhwci5zbGljZShwb3MpLm1hdGNoKG5hbWVQYXR0ZXJuKTsKICAgIGlmICghbWF0Y2gpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBbbmFtZV0gPSBtYXRjaDsKICAgIHBvcyArPSBuYW1lLmxlbmd0aDsKICAgIHBhcnNlZC5wdXNoKHsKICAgICAgbmFtZSwKICAgICAgY2FjaGVOYW1lOiBleHByLnNsaWNlKHNwb3MsIHBvcyksCiAgICAgIG9wZXJhdG9yLAogICAgICBpbmRleDogMCwKICAgICAganM6IG51bGwsCiAgICAgIGZvcm1DYWxjOiBudWxsCiAgICB9KTsKICB9CiAgcmV0dXJuIHBhcnNlZDsKfQpmdW5jdGlvbiBzZWFyY2hOb2RlKHJvb3QsIGNvbnRhaW5lciwgZXhwciwgZG90RG90QWxsb3dlZCA9IHRydWUsIHVzZUNhY2hlID0gdHJ1ZSkgewogIGNvbnN0IHBhcnNlZCA9IHBhcnNlRXhwcmVzc2lvbihleHByLCBkb3REb3RBbGxvd2VkKTsKICBpZiAoIXBhcnNlZCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IGZuID0gc2hvcnRjdXRzLmdldChwYXJzZWRbMF0ubmFtZSk7CiAgbGV0IGkgPSAwOwogIGxldCBpc1F1YWxpZmllZDsKICBpZiAoZm4pIHsKICAgIGlzUXVhbGlmaWVkID0gdHJ1ZTsKICAgIHJvb3QgPSBbZm4ocm9vdCwgY29udGFpbmVyKV07CiAgICBpID0gMTsKICB9IGVsc2UgewogICAgaXNRdWFsaWZpZWQgPSBjb250YWluZXIgPT09IG51bGw7CiAgICByb290ID0gW2NvbnRhaW5lciB8fCByb290XTsKICB9CiAgZm9yIChsZXQgaWkgPSBwYXJzZWQubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgewogICAgICBuYW1lLAogICAgICBjYWNoZU5hbWUsCiAgICAgIG9wZXJhdG9yLAogICAgICBpbmRleAogICAgfSA9IHBhcnNlZFtpXTsKICAgIGNvbnN0IG5vZGVzID0gW107CiAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygcm9vdCkgewogICAgICBpZiAoIW5vZGUuaXNYRkFPYmplY3QpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBsZXQgY2hpbGRyZW4sIGNhY2hlZDsKICAgICAgaWYgKHVzZUNhY2hlKSB7CiAgICAgICAgY2FjaGVkID0gc29tQ2FjaGUuZ2V0KG5vZGUpOwogICAgICAgIGlmICghY2FjaGVkKSB7CiAgICAgICAgICBjYWNoZWQgPSBuZXcgTWFwKCk7CiAgICAgICAgICBzb21DYWNoZS5zZXQobm9kZSwgY2FjaGVkKTsKICAgICAgICB9CiAgICAgICAgY2hpbGRyZW4gPSBjYWNoZWQuZ2V0KGNhY2hlTmFtZSk7CiAgICAgIH0KICAgICAgaWYgKCFjaGlsZHJlbikgewogICAgICAgIHN3aXRjaCAob3BlcmF0b3IpIHsKICAgICAgICAgIGNhc2Ugb3BlcmF0b3JzLmRvdDoKICAgICAgICAgICAgY2hpbGRyZW4gPSBub2RlWyRnZXRDaGlsZHJlbkJ5TmFtZV0obmFtZSwgZmFsc2UpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2Ugb3BlcmF0b3JzLmRvdERvdDoKICAgICAgICAgICAgY2hpbGRyZW4gPSBub2RlWyRnZXRDaGlsZHJlbkJ5TmFtZV0obmFtZSwgdHJ1ZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBvcGVyYXRvcnMuZG90SGFzaDoKICAgICAgICAgICAgY2hpbGRyZW4gPSBub2RlWyRnZXRDaGlsZHJlbkJ5Q2xhc3NdKG5hbWUpOwogICAgICAgICAgICBjaGlsZHJlbiA9IGNoaWxkcmVuLmlzWEZBT2JqZWN0QXJyYXkgPyBjaGlsZHJlbi5jaGlsZHJlbiA6IFtjaGlsZHJlbl07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmICh1c2VDYWNoZSkgewogICAgICAgICAgY2FjaGVkLnNldChjYWNoZU5hbWUsIGNoaWxkcmVuKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA+IDApIHsKICAgICAgICBub2Rlcy5wdXNoKGNoaWxkcmVuKTsKICAgICAgfQogICAgfQogICAgaWYgKG5vZGVzLmxlbmd0aCA9PT0gMCAmJiAhaXNRdWFsaWZpZWQgJiYgaSA9PT0gMCkgewogICAgICBjb25zdCBwYXJlbnQgPSBjb250YWluZXJbJGdldFBhcmVudF0oKTsKICAgICAgY29udGFpbmVyID0gcGFyZW50OwogICAgICBpZiAoIWNvbnRhaW5lcikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGkgPSAtMTsKICAgICAgcm9vdCA9IFtjb250YWluZXJdOwogICAgICBjb250aW51ZTsKICAgIH0KICAgIHJvb3QgPSBpc0Zpbml0ZShpbmRleCkgPyBub2Rlcy5maWx0ZXIobm9kZSA9PiBpbmRleCA8IG5vZGUubGVuZ3RoKS5tYXAobm9kZSA9PiBub2RlW2luZGV4XSkgOiBub2Rlcy5mbGF0KCk7CiAgfQogIGlmIChyb290Lmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIHJldHVybiByb290Owp9CmZ1bmN0aW9uIGNyZWF0ZURhdGFOb2RlKHJvb3QsIGNvbnRhaW5lciwgZXhwcikgewogIGNvbnN0IHBhcnNlZCA9IHBhcnNlRXhwcmVzc2lvbihleHByKTsKICBpZiAoIXBhcnNlZCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGlmIChwYXJzZWQuc29tZSh4ID0+IHgub3BlcmF0b3IgPT09IG9wZXJhdG9ycy5kb3REb3QpKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY29uc3QgZm4gPSBzaG9ydGN1dHMuZ2V0KHBhcnNlZFswXS5uYW1lKTsKICBsZXQgaSA9IDA7CiAgaWYgKGZuKSB7CiAgICByb290ID0gZm4ocm9vdCwgY29udGFpbmVyKTsKICAgIGkgPSAxOwogIH0gZWxzZSB7CiAgICByb290ID0gY29udGFpbmVyIHx8IHJvb3Q7CiAgfQogIGZvciAobGV0IGlpID0gcGFyc2VkLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGNvbnN0IHsKICAgICAgbmFtZSwKICAgICAgb3BlcmF0b3IsCiAgICAgIGluZGV4CiAgICB9ID0gcGFyc2VkW2ldOwogICAgaWYgKCFpc0Zpbml0ZShpbmRleCkpIHsKICAgICAgcGFyc2VkW2ldLmluZGV4ID0gMDsKICAgICAgcmV0dXJuIHJvb3QuY3JlYXRlTm9kZXMocGFyc2VkLnNsaWNlKGkpKTsKICAgIH0KICAgIGxldCBjaGlsZHJlbjsKICAgIHN3aXRjaCAob3BlcmF0b3IpIHsKICAgICAgY2FzZSBvcGVyYXRvcnMuZG90OgogICAgICAgIGNoaWxkcmVuID0gcm9vdFskZ2V0Q2hpbGRyZW5CeU5hbWVdKG5hbWUsIGZhbHNlKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBvcGVyYXRvcnMuZG90RG90OgogICAgICAgIGNoaWxkcmVuID0gcm9vdFskZ2V0Q2hpbGRyZW5CeU5hbWVdKG5hbWUsIHRydWUpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIG9wZXJhdG9ycy5kb3RIYXNoOgogICAgICAgIGNoaWxkcmVuID0gcm9vdFskZ2V0Q2hpbGRyZW5CeUNsYXNzXShuYW1lKTsKICAgICAgICBjaGlsZHJlbiA9IGNoaWxkcmVuLmlzWEZBT2JqZWN0QXJyYXkgPyBjaGlsZHJlbi5jaGlsZHJlbiA6IFtjaGlsZHJlbl07CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiByb290LmNyZWF0ZU5vZGVzKHBhcnNlZC5zbGljZShpKSk7CiAgICB9CiAgICBpZiAoaW5kZXggPCBjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpbmRleF07CiAgICAgIGlmICghY2hpbGQuaXNYRkFPYmplY3QpIHsKICAgICAgICB3YXJuKGBYRkEgLSBDYW5ub3QgY3JlYXRlIGEgbm9kZS5gKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICByb290ID0gY2hpbGQ7CiAgICB9IGVsc2UgewogICAgICBwYXJzZWRbaV0uaW5kZXggPSBpbmRleCAtIGNoaWxkcmVuLmxlbmd0aDsKICAgICAgcmV0dXJuIHJvb3QuY3JlYXRlTm9kZXMocGFyc2VkLnNsaWNlKGkpKTsKICAgIH0KICB9CiAgcmV0dXJuIG51bGw7Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS94ZmFfb2JqZWN0LmpzCgoKCgoKCmNvbnN0IF9hcHBseVByb3RvdHlwZSA9IFN5bWJvbCgpOwpjb25zdCBfYXR0cmlidXRlcyA9IFN5bWJvbCgpOwpjb25zdCBfYXR0cmlidXRlTmFtZXMgPSBTeW1ib2woKTsKY29uc3QgX2NoaWxkcmVuID0gU3ltYm9sKCJfY2hpbGRyZW4iKTsKY29uc3QgX2Nsb25lQXR0cmlidXRlID0gU3ltYm9sKCk7CmNvbnN0IF9kYXRhVmFsdWUgPSBTeW1ib2woKTsKY29uc3QgX2RlZmF1bHRWYWx1ZSA9IFN5bWJvbCgpOwpjb25zdCBfZmlsdGVyZWRDaGlsZHJlbkdlbmVyYXRvciA9IFN5bWJvbCgpOwpjb25zdCBfZ2V0UHJvdG90eXBlID0gU3ltYm9sKCk7CmNvbnN0IF9nZXRVbnNldEF0dHJpYnV0ZXMgPSBTeW1ib2woKTsKY29uc3QgX2hhc0NoaWxkcmVuID0gU3ltYm9sKCk7CmNvbnN0IF9tYXggPSBTeW1ib2woKTsKY29uc3QgX29wdGlvbnMgPSBTeW1ib2woKTsKY29uc3QgX3BhcmVudCA9IFN5bWJvbCgicGFyZW50Iik7CmNvbnN0IF9yZXNvbHZlUHJvdG90eXBlc0hlbHBlciA9IFN5bWJvbCgpOwpjb25zdCBfc2V0QXR0cmlidXRlcyA9IFN5bWJvbCgpOwpjb25zdCBfdmFsaWRhdG9yID0gU3ltYm9sKCk7CmxldCB1aWQgPSAwOwpjb25zdCBOU19EQVRBU0VUUyA9IE5hbWVzcGFjZUlkcy5kYXRhc2V0cy5pZDsKY2xhc3MgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3Rvcihuc0lkLCBuYW1lLCBoYXNDaGlsZHJlbiA9IGZhbHNlKSB7CiAgICB0aGlzWyRuYW1lc3BhY2VJZF0gPSBuc0lkOwogICAgdGhpc1skbm9kZU5hbWVdID0gbmFtZTsKICAgIHRoaXNbX2hhc0NoaWxkcmVuXSA9IGhhc0NoaWxkcmVuOwogICAgdGhpc1tfcGFyZW50XSA9IG51bGw7CiAgICB0aGlzW19jaGlsZHJlbl0gPSBbXTsKICAgIHRoaXNbJHVpZF0gPSBgJHtuYW1lfSR7dWlkKyt9YDsKICAgIHRoaXNbJGdsb2JhbERhdGFdID0gbnVsbDsKICB9CiAgZ2V0IGlzWEZBT2JqZWN0KCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGdldCBpc1hGQU9iamVjdEFycmF5KCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBjcmVhdGVOb2RlcyhwYXRoKSB7CiAgICBsZXQgcm9vdCA9IHRoaXMsCiAgICAgIG5vZGUgPSBudWxsOwogICAgZm9yIChjb25zdCB7CiAgICAgIG5hbWUsCiAgICAgIGluZGV4CiAgICB9IG9mIHBhdGgpIHsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gaXNGaW5pdGUoaW5kZXgpID8gaW5kZXggOiAwOyBpIDw9IGlpOyBpKyspIHsKICAgICAgICBjb25zdCBuc0lkID0gcm9vdFskbmFtZXNwYWNlSWRdID09PSBOU19EQVRBU0VUUyA/IC0xIDogcm9vdFskbmFtZXNwYWNlSWRdOwogICAgICAgIG5vZGUgPSBuZXcgWG1sT2JqZWN0KG5zSWQsIG5hbWUpOwogICAgICAgIHJvb3RbJGFwcGVuZENoaWxkXShub2RlKTsKICAgICAgfQogICAgICByb290ID0gbm9kZTsKICAgIH0KICAgIHJldHVybiBub2RlOwogIH0KICBbJG9uQ2hpbGRdKGNoaWxkKSB7CiAgICBpZiAoIXRoaXNbX2hhc0NoaWxkcmVuXSB8fCAhdGhpc1skb25DaGlsZENoZWNrXShjaGlsZCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgbmFtZSA9IGNoaWxkWyRub2RlTmFtZV07CiAgICBjb25zdCBub2RlID0gdGhpc1tuYW1lXTsKICAgIGlmIChub2RlIGluc3RhbmNlb2YgWEZBT2JqZWN0QXJyYXkpIHsKICAgICAgaWYgKG5vZGUucHVzaChjaGlsZCkpIHsKICAgICAgICB0aGlzWyRhcHBlbmRDaGlsZF0oY2hpbGQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZiAobm9kZSAhPT0gbnVsbCkgewogICAgICAgIHRoaXNbJHJlbW92ZUNoaWxkXShub2RlKTsKICAgICAgfQogICAgICB0aGlzW25hbWVdID0gY2hpbGQ7CiAgICAgIHRoaXNbJGFwcGVuZENoaWxkXShjaGlsZCk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgbGV0IGlkID0gIiI7CiAgICBpZiAodGhpcy5pZCkgewogICAgICBpZCA9IGAgKGlkOiAke3RoaXMuaWR9KWA7CiAgICB9IGVsc2UgaWYgKHRoaXMubmFtZSkgewogICAgICBpZCA9IGAgKG5hbWU6ICR7dGhpcy5uYW1lfSAke3RoaXMuaC52YWx1ZX0pYDsKICAgIH0KICAgIHdhcm4oYFhGQSAtIG5vZGUgIiR7dGhpc1skbm9kZU5hbWVdfSIke2lkfSBoYXMgYWxyZWFkeSBlbm91Z2ggIiR7bmFtZX0iIWApOwogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbJG9uQ2hpbGRDaGVja10oY2hpbGQpIHsKICAgIHJldHVybiB0aGlzLmhhc093blByb3BlcnR5KGNoaWxkWyRub2RlTmFtZV0pICYmIGNoaWxkWyRuYW1lc3BhY2VJZF0gPT09IHRoaXNbJG5hbWVzcGFjZUlkXTsKICB9CiAgWyRpc05zQWdub3N0aWNdKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbJGFjY2VwdFdoaXRlc3BhY2VdKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbJGlzQ0RBVEFYbWxdKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbJGlzQmluZGFibGVdKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbJHBvcFBhcmFdKCkgewogICAgaWYgKHRoaXMucGFyYSkgewogICAgICB0aGlzWyRnZXRUZW1wbGF0ZVJvb3RdKClbJGV4dHJhXS5wYXJhU3RhY2sucG9wKCk7CiAgICB9CiAgfQogIFskcHVzaFBhcmFdKCkgewogICAgdGhpc1skZ2V0VGVtcGxhdGVSb290XSgpWyRleHRyYV0ucGFyYVN0YWNrLnB1c2godGhpcy5wYXJhKTsKICB9CiAgWyRzZXRJZF0oaWRzKSB7CiAgICBpZiAodGhpcy5pZCAmJiB0aGlzWyRuYW1lc3BhY2VJZF0gPT09IE5hbWVzcGFjZUlkcy50ZW1wbGF0ZS5pZCkgewogICAgICBpZHMuc2V0KHRoaXMuaWQsIHRoaXMpOwogICAgfQogIH0KICBbJGdldFRlbXBsYXRlUm9vdF0oKSB7CiAgICByZXR1cm4gdGhpc1skZ2xvYmFsRGF0YV0udGVtcGxhdGU7CiAgfQogIFskaXNTcGxpdHRhYmxlXSgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgWyRpc1RoZXJlTW9yZVdpZHRoXSgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgWyRhcHBlbmRDaGlsZF0oY2hpbGQpIHsKICAgIGNoaWxkW19wYXJlbnRdID0gdGhpczsKICAgIHRoaXNbX2NoaWxkcmVuXS5wdXNoKGNoaWxkKTsKICAgIGlmICghY2hpbGRbJGdsb2JhbERhdGFdICYmIHRoaXNbJGdsb2JhbERhdGFdKSB7CiAgICAgIGNoaWxkWyRnbG9iYWxEYXRhXSA9IHRoaXNbJGdsb2JhbERhdGFdOwogICAgfQogIH0KICBbJHJlbW92ZUNoaWxkXShjaGlsZCkgewogICAgY29uc3QgaSA9IHRoaXNbX2NoaWxkcmVuXS5pbmRleE9mKGNoaWxkKTsKICAgIHRoaXNbX2NoaWxkcmVuXS5zcGxpY2UoaSwgMSk7CiAgfQogIFskaGFzU2V0dGFibGVWYWx1ZV0oKSB7CiAgICByZXR1cm4gdGhpcy5oYXNPd25Qcm9wZXJ0eSgidmFsdWUiKTsKICB9CiAgWyRzZXRWYWx1ZV0oXykge30KICBbJG9uVGV4dF0oXykge30KICBbJGZpbmFsaXplXSgpIHt9CiAgWyRjbGVhbl0oYnVpbGRlcikgewogICAgZGVsZXRlIHRoaXNbX2hhc0NoaWxkcmVuXTsKICAgIGlmICh0aGlzWyRjbGVhbnVwXSkgewogICAgICBidWlsZGVyLmNsZWFuKHRoaXNbJGNsZWFudXBdKTsKICAgICAgZGVsZXRlIHRoaXNbJGNsZWFudXBdOwogICAgfQogIH0KICBbJGluZGV4T2ZdKGNoaWxkKSB7CiAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dLmluZGV4T2YoY2hpbGQpOwogIH0KICBbJGluc2VydEF0XShpLCBjaGlsZCkgewogICAgY2hpbGRbX3BhcmVudF0gPSB0aGlzOwogICAgdGhpc1tfY2hpbGRyZW5dLnNwbGljZShpLCAwLCBjaGlsZCk7CiAgICBpZiAoIWNoaWxkWyRnbG9iYWxEYXRhXSAmJiB0aGlzWyRnbG9iYWxEYXRhXSkgewogICAgICBjaGlsZFskZ2xvYmFsRGF0YV0gPSB0aGlzWyRnbG9iYWxEYXRhXTsKICAgIH0KICB9CiAgWyRpc1RyYW5zcGFyZW50XSgpIHsKICAgIHJldHVybiAhdGhpcy5uYW1lOwogIH0KICBbJGxhc3RBdHRyaWJ1dGVdKCkgewogICAgcmV0dXJuICIiOwogIH0KICBbJHRleHRdKCkgewogICAgaWYgKHRoaXNbX2NoaWxkcmVuXS5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHRoaXNbJGNvbnRlbnRdOwogICAgfQogICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXS5tYXAoYyA9PiBjWyR0ZXh0XSgpKS5qb2luKCIiKTsKICB9CiAgZ2V0IFtfYXR0cmlidXRlTmFtZXNdKCkgewogICAgY29uc3QgcHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcyk7CiAgICBpZiAoIXByb3RvLl9hdHRyaWJ1dGVzKSB7CiAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBwcm90by5fYXR0cmlidXRlcyA9IG5ldyBTZXQoKTsKICAgICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpKSB7CiAgICAgICAgaWYgKHRoaXNbbmFtZV0gPT09IG51bGwgfHwgdGhpc1tuYW1lXSBpbnN0YW5jZW9mIFhGQU9iamVjdCB8fCB0aGlzW25hbWVdIGluc3RhbmNlb2YgWEZBT2JqZWN0QXJyYXkpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBhdHRyaWJ1dGVzLmFkZChuYW1lKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCBfYXR0cmlidXRlTmFtZXMsIHByb3RvLl9hdHRyaWJ1dGVzKTsKICB9CiAgWyRpc0Rlc2NlbmRlbnRdKHBhcmVudCkgewogICAgbGV0IG5vZGUgPSB0aGlzOwogICAgd2hpbGUgKG5vZGUpIHsKICAgICAgaWYgKG5vZGUgPT09IHBhcmVudCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIG5vZGUgPSBub2RlWyRnZXRQYXJlbnRdKCk7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIFskZ2V0UGFyZW50XSgpIHsKICAgIHJldHVybiB0aGlzW19wYXJlbnRdOwogIH0KICBbJGdldFN1YmZvcm1QYXJlbnRdKCkgewogICAgcmV0dXJuIHRoaXNbJGdldFBhcmVudF0oKTsKICB9CiAgWyRnZXRDaGlsZHJlbl0obmFtZSA9IG51bGwpIHsKICAgIGlmICghbmFtZSkgewogICAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dOwogICAgfQogICAgcmV0dXJuIHRoaXNbbmFtZV07CiAgfQogIFskZHVtcF0oKSB7CiAgICBjb25zdCBkdW1wZWQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgaWYgKHRoaXNbJGNvbnRlbnRdKSB7CiAgICAgIGR1bXBlZC4kY29udGVudCA9IHRoaXNbJGNvbnRlbnRdOwogICAgfQogICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpKSB7CiAgICAgIGNvbnN0IHZhbHVlID0gdGhpc1tuYW1lXTsKICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgWEZBT2JqZWN0KSB7CiAgICAgICAgZHVtcGVkW25hbWVdID0gdmFsdWVbJGR1bXBdKCk7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBYRkFPYmplY3RBcnJheSkgewogICAgICAgIGlmICghdmFsdWUuaXNFbXB0eSgpKSB7CiAgICAgICAgICBkdW1wZWRbbmFtZV0gPSB2YWx1ZS5kdW1wKCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGR1bXBlZFtuYW1lXSA9IHZhbHVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZHVtcGVkOwogIH0KICBbJHRvU3R5bGVdKCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIFskdG9IVE1MXSgpIHsKICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogIH0KICAqWyRnZXRDb250YWluZWRDaGlsZHJlbl0oKSB7CiAgICBmb3IgKGNvbnN0IG5vZGUgb2YgdGhpc1skZ2V0Q2hpbGRyZW5dKCkpIHsKICAgICAgeWllbGQgbm9kZTsKICAgIH0KICB9CiAgKltfZmlsdGVyZWRDaGlsZHJlbkdlbmVyYXRvcl0oZmlsdGVyLCBpbmNsdWRlKSB7CiAgICBmb3IgKGNvbnN0IG5vZGUgb2YgdGhpc1skZ2V0Q29udGFpbmVkQ2hpbGRyZW5dKCkpIHsKICAgICAgaWYgKCFmaWx0ZXIgfHwgaW5jbHVkZSA9PT0gZmlsdGVyLmhhcyhub2RlWyRub2RlTmFtZV0pKSB7CiAgICAgICAgY29uc3QgYXZhaWxhYmxlU3BhY2UgPSB0aGlzWyRnZXRBdmFpbGFibGVTcGFjZV0oKTsKICAgICAgICBjb25zdCByZXMgPSBub2RlWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKTsKICAgICAgICBpZiAoIXJlcy5zdWNjZXNzKSB7CiAgICAgICAgICB0aGlzWyRleHRyYV0uZmFpbGluZ05vZGUgPSBub2RlOwogICAgICAgIH0KICAgICAgICB5aWVsZCByZXM7CiAgICAgIH0KICAgIH0KICB9CiAgWyRmbHVzaEhUTUxdKCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIFskYWRkSFRNTF0oaHRtbCwgYmJveCkgewogICAgdGhpc1skZXh0cmFdLmNoaWxkcmVuLnB1c2goaHRtbCk7CiAgfQogIFskZ2V0QXZhaWxhYmxlU3BhY2VdKCkge30KICBbJGNoaWxkcmVuVG9IVE1MXSh7CiAgICBmaWx0ZXIgPSBudWxsLAogICAgaW5jbHVkZSA9IHRydWUKICB9KSB7CiAgICBpZiAoIXRoaXNbJGV4dHJhXS5nZW5lcmF0b3IpIHsKICAgICAgdGhpc1skZXh0cmFdLmdlbmVyYXRvciA9IHRoaXNbX2ZpbHRlcmVkQ2hpbGRyZW5HZW5lcmF0b3JdKGZpbHRlciwgaW5jbHVkZSk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBhdmFpbGFibGVTcGFjZSA9IHRoaXNbJGdldEF2YWlsYWJsZVNwYWNlXSgpOwogICAgICBjb25zdCByZXMgPSB0aGlzWyRleHRyYV0uZmFpbGluZ05vZGVbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpOwogICAgICBpZiAoIXJlcy5zdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIHJlczsKICAgICAgfQogICAgICBpZiAocmVzLmh0bWwpIHsKICAgICAgICB0aGlzWyRhZGRIVE1MXShyZXMuaHRtbCwgcmVzLmJib3gpOwogICAgICB9CiAgICAgIGRlbGV0ZSB0aGlzWyRleHRyYV0uZmFpbGluZ05vZGU7CiAgICB9CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBjb25zdCBnZW4gPSB0aGlzWyRleHRyYV0uZ2VuZXJhdG9yLm5leHQoKTsKICAgICAgaWYgKGdlbi5kb25lKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY29uc3QgcmVzID0gZ2VuLnZhbHVlOwogICAgICBpZiAoIXJlcy5zdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIHJlczsKICAgICAgfQogICAgICBpZiAocmVzLmh0bWwpIHsKICAgICAgICB0aGlzWyRhZGRIVE1MXShyZXMuaHRtbCwgcmVzLmJib3gpOwogICAgICB9CiAgICB9CiAgICB0aGlzWyRleHRyYV0uZ2VuZXJhdG9yID0gbnVsbDsKICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogIH0KICBbJHNldFNldEF0dHJpYnV0ZXNdKGF0dHJpYnV0ZXMpIHsKICAgIHRoaXNbX3NldEF0dHJpYnV0ZXNdID0gbmV3IFNldChPYmplY3Qua2V5cyhhdHRyaWJ1dGVzKSk7CiAgfQogIFtfZ2V0VW5zZXRBdHRyaWJ1dGVzXShwcm90b0F0dHJpYnV0ZXMpIHsKICAgIGNvbnN0IGFsbEF0dHIgPSB0aGlzW19hdHRyaWJ1dGVOYW1lc107CiAgICBjb25zdCBzZXRBdHRyID0gdGhpc1tfc2V0QXR0cmlidXRlc107CiAgICByZXR1cm4gWy4uLnByb3RvQXR0cmlidXRlc10uZmlsdGVyKHggPT4gYWxsQXR0ci5oYXMoeCkgJiYgIXNldEF0dHIuaGFzKHgpKTsKICB9CiAgWyRyZXNvbHZlUHJvdG90eXBlc10oaWRzLCBhbmNlc3RvcnMgPSBuZXcgU2V0KCkpIHsKICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpc1tfY2hpbGRyZW5dKSB7CiAgICAgIGNoaWxkW19yZXNvbHZlUHJvdG90eXBlc0hlbHBlcl0oaWRzLCBhbmNlc3RvcnMpOwogICAgfQogIH0KICBbX3Jlc29sdmVQcm90b3R5cGVzSGVscGVyXShpZHMsIGFuY2VzdG9ycykgewogICAgY29uc3QgcHJvdG8gPSB0aGlzW19nZXRQcm90b3R5cGVdKGlkcywgYW5jZXN0b3JzKTsKICAgIGlmIChwcm90bykgewogICAgICB0aGlzW19hcHBseVByb3RvdHlwZV0ocHJvdG8sIGlkcywgYW5jZXN0b3JzKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXNbJHJlc29sdmVQcm90b3R5cGVzXShpZHMsIGFuY2VzdG9ycyk7CiAgICB9CiAgfQogIFtfZ2V0UHJvdG90eXBlXShpZHMsIGFuY2VzdG9ycykgewogICAgY29uc3QgewogICAgICB1c2UsCiAgICAgIHVzZWhyZWYKICAgIH0gPSB0aGlzOwogICAgaWYgKCF1c2UgJiYgIXVzZWhyZWYpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBsZXQgcHJvdG8gPSBudWxsOwogICAgbGV0IHNvbUV4cHJlc3Npb24gPSBudWxsOwogICAgbGV0IGlkID0gbnVsbDsKICAgIGxldCByZWYgPSB1c2U7CiAgICBpZiAodXNlaHJlZikgewogICAgICByZWYgPSB1c2VocmVmOwogICAgICBpZiAodXNlaHJlZi5zdGFydHNXaXRoKCIjc29tKCIpICYmIHVzZWhyZWYuZW5kc1dpdGgoIikiKSkgewogICAgICAgIHNvbUV4cHJlc3Npb24gPSB1c2VocmVmLnNsaWNlKCIjc29tKCIubGVuZ3RoLCAtMSk7CiAgICAgIH0gZWxzZSBpZiAodXNlaHJlZi5zdGFydHNXaXRoKCIuI3NvbSgiKSAmJiB1c2VocmVmLmVuZHNXaXRoKCIpIikpIHsKICAgICAgICBzb21FeHByZXNzaW9uID0gdXNlaHJlZi5zbGljZSgiLiNzb20oIi5sZW5ndGgsIC0xKTsKICAgICAgfSBlbHNlIGlmICh1c2VocmVmLnN0YXJ0c1dpdGgoIiMiKSkgewogICAgICAgIGlkID0gdXNlaHJlZi5zbGljZSgxKTsKICAgICAgfSBlbHNlIGlmICh1c2VocmVmLnN0YXJ0c1dpdGgoIi4jIikpIHsKICAgICAgICBpZCA9IHVzZWhyZWYuc2xpY2UoMik7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAodXNlLnN0YXJ0c1dpdGgoIiMiKSkgewogICAgICBpZCA9IHVzZS5zbGljZSgxKTsKICAgIH0gZWxzZSB7CiAgICAgIHNvbUV4cHJlc3Npb24gPSB1c2U7CiAgICB9CiAgICB0aGlzLnVzZSA9IHRoaXMudXNlaHJlZiA9ICIiOwogICAgaWYgKGlkKSB7CiAgICAgIHByb3RvID0gaWRzLmdldChpZCk7CiAgICB9IGVsc2UgewogICAgICBwcm90byA9IHNlYXJjaE5vZGUoaWRzLmdldCgkcm9vdCksIHRoaXMsIHNvbUV4cHJlc3Npb24sIHRydWUsIGZhbHNlKTsKICAgICAgaWYgKHByb3RvKSB7CiAgICAgICAgcHJvdG8gPSBwcm90b1swXTsKICAgICAgfQogICAgfQogICAgaWYgKCFwcm90bykgewogICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIHByb3RvdHlwZSByZWZlcmVuY2U6ICR7cmVmfS5gKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpZiAocHJvdG9bJG5vZGVOYW1lXSAhPT0gdGhpc1skbm9kZU5hbWVdKSB7CiAgICAgIHdhcm4oYFhGQSAtIEluY29tcGF0aWJsZSBwcm90b3R5cGU6ICR7cHJvdG9bJG5vZGVOYW1lXX0gIT09ICR7dGhpc1skbm9kZU5hbWVdfS5gKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpZiAoYW5jZXN0b3JzLmhhcyhwcm90bykpIHsKICAgICAgd2FybihgWEZBIC0gQ3ljbGUgZGV0ZWN0ZWQgaW4gcHJvdG90eXBlcyB1c2UuYCk7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgYW5jZXN0b3JzLmFkZChwcm90byk7CiAgICBjb25zdCBwcm90b1Byb3RvID0gcHJvdG9bX2dldFByb3RvdHlwZV0oaWRzLCBhbmNlc3RvcnMpOwogICAgaWYgKHByb3RvUHJvdG8pIHsKICAgICAgcHJvdG9bX2FwcGx5UHJvdG90eXBlXShwcm90b1Byb3RvLCBpZHMsIGFuY2VzdG9ycyk7CiAgICB9CiAgICBwcm90b1skcmVzb2x2ZVByb3RvdHlwZXNdKGlkcywgYW5jZXN0b3JzKTsKICAgIGFuY2VzdG9ycy5kZWxldGUocHJvdG8pOwogICAgcmV0dXJuIHByb3RvOwogIH0KICBbX2FwcGx5UHJvdG90eXBlXShwcm90bywgaWRzLCBhbmNlc3RvcnMpIHsKICAgIGlmIChhbmNlc3RvcnMuaGFzKHByb3RvKSkgewogICAgICB3YXJuKGBYRkEgLSBDeWNsZSBkZXRlY3RlZCBpbiBwcm90b3R5cGVzIHVzZS5gKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCF0aGlzWyRjb250ZW50XSAmJiBwcm90b1skY29udGVudF0pIHsKICAgICAgdGhpc1skY29udGVudF0gPSBwcm90b1skY29udGVudF07CiAgICB9CiAgICBjb25zdCBuZXdBbmNlc3RvcnMgPSBuZXcgU2V0KGFuY2VzdG9ycyk7CiAgICBuZXdBbmNlc3RvcnMuYWRkKHByb3RvKTsKICAgIGZvciAoY29uc3QgdW5zZXRBdHRyTmFtZSBvZiB0aGlzW19nZXRVbnNldEF0dHJpYnV0ZXNdKHByb3RvW19zZXRBdHRyaWJ1dGVzXSkpIHsKICAgICAgdGhpc1t1bnNldEF0dHJOYW1lXSA9IHByb3RvW3Vuc2V0QXR0ck5hbWVdOwogICAgICBpZiAodGhpc1tfc2V0QXR0cmlidXRlc10pIHsKICAgICAgICB0aGlzW19zZXRBdHRyaWJ1dGVzXS5hZGQodW5zZXRBdHRyTmFtZSk7CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzKSkgewogICAgICBpZiAodGhpc1tfYXR0cmlidXRlTmFtZXNdLmhhcyhuYW1lKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHZhbHVlID0gdGhpc1tuYW1lXTsKICAgICAgY29uc3QgcHJvdG9WYWx1ZSA9IHByb3RvW25hbWVdOwogICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBYRkFPYmplY3RBcnJheSkgewogICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdmFsdWVbX2NoaWxkcmVuXSkgewogICAgICAgICAgY2hpbGRbX3Jlc29sdmVQcm90b3R5cGVzSGVscGVyXShpZHMsIGFuY2VzdG9ycyk7CiAgICAgICAgfQogICAgICAgIGZvciAobGV0IGkgPSB2YWx1ZVtfY2hpbGRyZW5dLmxlbmd0aCwgaWkgPSBwcm90b1ZhbHVlW19jaGlsZHJlbl0ubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgY29uc3QgY2hpbGQgPSBwcm90b1tfY2hpbGRyZW5dW2ldWyRjbG9uZV0oKTsKICAgICAgICAgIGlmICh2YWx1ZS5wdXNoKGNoaWxkKSkgewogICAgICAgICAgICBjaGlsZFtfcGFyZW50XSA9IHRoaXM7CiAgICAgICAgICAgIHRoaXNbX2NoaWxkcmVuXS5wdXNoKGNoaWxkKTsKICAgICAgICAgICAgY2hpbGRbX3Jlc29sdmVQcm90b3R5cGVzSGVscGVyXShpZHMsIGFuY2VzdG9ycyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKHZhbHVlICE9PSBudWxsKSB7CiAgICAgICAgdmFsdWVbJHJlc29sdmVQcm90b3R5cGVzXShpZHMsIGFuY2VzdG9ycyk7CiAgICAgICAgaWYgKHByb3RvVmFsdWUpIHsKICAgICAgICAgIHZhbHVlW19hcHBseVByb3RvdHlwZV0ocHJvdG9WYWx1ZSwgaWRzLCBhbmNlc3RvcnMpOwogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAocHJvdG9WYWx1ZSAhPT0gbnVsbCkgewogICAgICAgIGNvbnN0IGNoaWxkID0gcHJvdG9WYWx1ZVskY2xvbmVdKCk7CiAgICAgICAgY2hpbGRbX3BhcmVudF0gPSB0aGlzOwogICAgICAgIHRoaXNbbmFtZV0gPSBjaGlsZDsKICAgICAgICB0aGlzW19jaGlsZHJlbl0ucHVzaChjaGlsZCk7CiAgICAgICAgY2hpbGRbX3Jlc29sdmVQcm90b3R5cGVzSGVscGVyXShpZHMsIGFuY2VzdG9ycyk7CiAgICAgIH0KICAgIH0KICB9CiAgc3RhdGljIFtfY2xvbmVBdHRyaWJ1dGVdKG9iaikgewogICAgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkgewogICAgICByZXR1cm4gb2JqLm1hcCh4ID0+IFhGQU9iamVjdFtfY2xvbmVBdHRyaWJ1dGVdKHgpKTsKICAgIH0KICAgIGlmICh0eXBlb2Ygb2JqID09PSAib2JqZWN0IiAmJiBvYmogIT09IG51bGwpIHsKICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIG9iaik7CiAgICB9CiAgICByZXR1cm4gb2JqOwogIH0KICBbJGNsb25lXSgpIHsKICAgIGNvbnN0IGNsb25lID0gT2JqZWN0LmNyZWF0ZShPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykpOwogICAgZm9yIChjb25zdCAkc3ltYm9sIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHModGhpcykpIHsKICAgICAgdHJ5IHsKICAgICAgICBjbG9uZVskc3ltYm9sXSA9IHRoaXNbJHN5bWJvbF07CiAgICAgIH0gY2F0Y2ggewogICAgICAgIHNoYWRvdyhjbG9uZSwgJHN5bWJvbCwgdGhpc1skc3ltYm9sXSk7CiAgICAgIH0KICAgIH0KICAgIGNsb25lWyR1aWRdID0gYCR7Y2xvbmVbJG5vZGVOYW1lXX0ke3VpZCsrfWA7CiAgICBjbG9uZVtfY2hpbGRyZW5dID0gW107CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsKICAgICAgaWYgKHRoaXNbX2F0dHJpYnV0ZU5hbWVzXS5oYXMobmFtZSkpIHsKICAgICAgICBjbG9uZVtuYW1lXSA9IFhGQU9iamVjdFtfY2xvbmVBdHRyaWJ1dGVdKHRoaXNbbmFtZV0pOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHZhbHVlID0gdGhpc1tuYW1lXTsKICAgICAgY2xvbmVbbmFtZV0gPSB2YWx1ZSBpbnN0YW5jZW9mIFhGQU9iamVjdEFycmF5ID8gbmV3IFhGQU9iamVjdEFycmF5KHZhbHVlW19tYXhdKSA6IG51bGw7CiAgICB9CiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXNbX2NoaWxkcmVuXSkgewogICAgICBjb25zdCBuYW1lID0gY2hpbGRbJG5vZGVOYW1lXTsKICAgICAgY29uc3QgY2xvbmVkQ2hpbGQgPSBjaGlsZFskY2xvbmVdKCk7CiAgICAgIGNsb25lW19jaGlsZHJlbl0ucHVzaChjbG9uZWRDaGlsZCk7CiAgICAgIGNsb25lZENoaWxkW19wYXJlbnRdID0gY2xvbmU7CiAgICAgIGlmIChjbG9uZVtuYW1lXSA9PT0gbnVsbCkgewogICAgICAgIGNsb25lW25hbWVdID0gY2xvbmVkQ2hpbGQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2xvbmVbbmFtZV1bX2NoaWxkcmVuXS5wdXNoKGNsb25lZENoaWxkKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGNsb25lOwogIH0KICBbJGdldENoaWxkcmVuXShuYW1lID0gbnVsbCkgewogICAgaWYgKCFuYW1lKSB7CiAgICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl07CiAgICB9CiAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dLmZpbHRlcihjID0+IGNbJG5vZGVOYW1lXSA9PT0gbmFtZSk7CiAgfQogIFskZ2V0Q2hpbGRyZW5CeUNsYXNzXShuYW1lKSB7CiAgICByZXR1cm4gdGhpc1tuYW1lXTsKICB9CiAgWyRnZXRDaGlsZHJlbkJ5TmFtZV0obmFtZSwgYWxsVHJhbnNwYXJlbnQsIGZpcnN0ID0gdHJ1ZSkgewogICAgcmV0dXJuIEFycmF5LmZyb20odGhpc1skZ2V0Q2hpbGRyZW5CeU5hbWVJdF0obmFtZSwgYWxsVHJhbnNwYXJlbnQsIGZpcnN0KSk7CiAgfQogICpbJGdldENoaWxkcmVuQnlOYW1lSXRdKG5hbWUsIGFsbFRyYW5zcGFyZW50LCBmaXJzdCA9IHRydWUpIHsKICAgIGlmIChuYW1lID09PSAicGFyZW50IikgewogICAgICB5aWVsZCB0aGlzW19wYXJlbnRdOwogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXNbX2NoaWxkcmVuXSkgewogICAgICBpZiAoY2hpbGRbJG5vZGVOYW1lXSA9PT0gbmFtZSkgewogICAgICAgIHlpZWxkIGNoaWxkOwogICAgICB9CiAgICAgIGlmIChjaGlsZC5uYW1lID09PSBuYW1lKSB7CiAgICAgICAgeWllbGQgY2hpbGQ7CiAgICAgIH0KICAgICAgaWYgKGFsbFRyYW5zcGFyZW50IHx8IGNoaWxkWyRpc1RyYW5zcGFyZW50XSgpKSB7CiAgICAgICAgeWllbGQqIGNoaWxkWyRnZXRDaGlsZHJlbkJ5TmFtZUl0XShuYW1lLCBhbGxUcmFuc3BhcmVudCwgZmFsc2UpOwogICAgICB9CiAgICB9CiAgICBpZiAoZmlyc3QgJiYgdGhpc1tfYXR0cmlidXRlTmFtZXNdLmhhcyhuYW1lKSkgewogICAgICB5aWVsZCBuZXcgWEZBQXR0cmlidXRlKHRoaXMsIG5hbWUsIHRoaXNbbmFtZV0pOwogICAgfQogIH0KfQpjbGFzcyBYRkFPYmplY3RBcnJheSB7CiAgY29uc3RydWN0b3IobWF4ID0gSW5maW5pdHkpIHsKICAgIHRoaXNbX21heF0gPSBtYXg7CiAgICB0aGlzW19jaGlsZHJlbl0gPSBbXTsKICB9CiAgZ2V0IGlzWEZBT2JqZWN0KCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBnZXQgaXNYRkFPYmplY3RBcnJheSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBwdXNoKGNoaWxkKSB7CiAgICBjb25zdCBsZW4gPSB0aGlzW19jaGlsZHJlbl0ubGVuZ3RoOwogICAgaWYgKGxlbiA8PSB0aGlzW19tYXhdKSB7CiAgICAgIHRoaXNbX2NoaWxkcmVuXS5wdXNoKGNoaWxkKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICB3YXJuKGBYRkEgLSBub2RlICIke2NoaWxkWyRub2RlTmFtZV19IiBhY2NlcHRzIG5vIG1vcmUgdGhhbiAke3RoaXNbX21heF19IGNoaWxkcmVuYCk7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlzRW1wdHkoKSB7CiAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dLmxlbmd0aCA9PT0gMDsKICB9CiAgZHVtcCgpIHsKICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl0ubGVuZ3RoID09PSAxID8gdGhpc1tfY2hpbGRyZW5dWzBdWyRkdW1wXSgpIDogdGhpc1tfY2hpbGRyZW5dLm1hcCh4ID0+IHhbJGR1bXBdKCkpOwogIH0KICBbJGNsb25lXSgpIHsKICAgIGNvbnN0IGNsb25lID0gbmV3IFhGQU9iamVjdEFycmF5KHRoaXNbX21heF0pOwogICAgY2xvbmVbX2NoaWxkcmVuXSA9IHRoaXNbX2NoaWxkcmVuXS5tYXAoYyA9PiBjWyRjbG9uZV0oKSk7CiAgICByZXR1cm4gY2xvbmU7CiAgfQogIGdldCBjaGlsZHJlbigpIHsKICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl07CiAgfQogIGNsZWFyKCkgewogICAgdGhpc1tfY2hpbGRyZW5dLmxlbmd0aCA9IDA7CiAgfQp9CmNsYXNzIFhGQUF0dHJpYnV0ZSB7CiAgY29uc3RydWN0b3Iobm9kZSwgbmFtZSwgdmFsdWUpIHsKICAgIHRoaXNbX3BhcmVudF0gPSBub2RlOwogICAgdGhpc1skbm9kZU5hbWVdID0gbmFtZTsKICAgIHRoaXNbJGNvbnRlbnRdID0gdmFsdWU7CiAgICB0aGlzWyRjb25zdW1lZF0gPSBmYWxzZTsKICAgIHRoaXNbJHVpZF0gPSBgYXR0cmlidXRlJHt1aWQrK31gOwogIH0KICBbJGdldFBhcmVudF0oKSB7CiAgICByZXR1cm4gdGhpc1tfcGFyZW50XTsKICB9CiAgWyRpc0RhdGFWYWx1ZV0oKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgWyRnZXREYXRhVmFsdWVdKCkgewogICAgcmV0dXJuIHRoaXNbJGNvbnRlbnRdLnRyaW0oKTsKICB9CiAgWyRzZXRWYWx1ZV0odmFsdWUpIHsKICAgIHZhbHVlID0gdmFsdWUudmFsdWUgfHwgIiI7CiAgICB0aGlzWyRjb250ZW50XSA9IHZhbHVlLnRvU3RyaW5nKCk7CiAgfQogIFskdGV4dF0oKSB7CiAgICByZXR1cm4gdGhpc1skY29udGVudF07CiAgfQogIFskaXNEZXNjZW5kZW50XShwYXJlbnQpIHsKICAgIHJldHVybiB0aGlzW19wYXJlbnRdID09PSBwYXJlbnQgfHwgdGhpc1tfcGFyZW50XVskaXNEZXNjZW5kZW50XShwYXJlbnQpOwogIH0KfQpjbGFzcyBYbWxPYmplY3QgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKG5zSWQsIG5hbWUsIGF0dHJpYnV0ZXMgPSB7fSkgewogICAgc3VwZXIobnNJZCwgbmFtZSk7CiAgICB0aGlzWyRjb250ZW50XSA9ICIiOwogICAgdGhpc1tfZGF0YVZhbHVlXSA9IG51bGw7CiAgICBpZiAobmFtZSAhPT0gIiN0ZXh0IikgewogICAgICBjb25zdCBtYXAgPSBuZXcgTWFwKCk7CiAgICAgIHRoaXNbX2F0dHJpYnV0ZXNdID0gbWFwOwogICAgICBmb3IgKGNvbnN0IFthdHRyTmFtZSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGF0dHJpYnV0ZXMpKSB7CiAgICAgICAgbWFwLnNldChhdHRyTmFtZSwgbmV3IFhGQUF0dHJpYnV0ZSh0aGlzLCBhdHRyTmFtZSwgdmFsdWUpKTsKICAgICAgfQogICAgICBpZiAoYXR0cmlidXRlcy5oYXNPd25Qcm9wZXJ0eSgkbnNBdHRyaWJ1dGVzKSkgewogICAgICAgIGNvbnN0IGRhdGFOb2RlID0gYXR0cmlidXRlc1skbnNBdHRyaWJ1dGVzXS54ZmEuZGF0YU5vZGU7CiAgICAgICAgaWYgKGRhdGFOb2RlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGlmIChkYXRhTm9kZSA9PT0gImRhdGFHcm91cCIpIHsKICAgICAgICAgICAgdGhpc1tfZGF0YVZhbHVlXSA9IGZhbHNlOwogICAgICAgICAgfSBlbHNlIGlmIChkYXRhTm9kZSA9PT0gImRhdGFWYWx1ZSIpIHsKICAgICAgICAgICAgdGhpc1tfZGF0YVZhbHVlXSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICB0aGlzWyRjb25zdW1lZF0gPSBmYWxzZTsKICB9CiAgWyR0b1N0cmluZ10oYnVmKSB7CiAgICBjb25zdCB0YWdOYW1lID0gdGhpc1skbm9kZU5hbWVdOwogICAgaWYgKHRhZ05hbWUgPT09ICIjdGV4dCIpIHsKICAgICAgYnVmLnB1c2goZW5jb2RlVG9YbWxTdHJpbmcodGhpc1skY29udGVudF0pKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgdXRmOFRhZ05hbWUgPSB1dGY4U3RyaW5nVG9TdHJpbmcodGFnTmFtZSk7CiAgICBjb25zdCBwcmVmaXggPSB0aGlzWyRuYW1lc3BhY2VJZF0gPT09IE5TX0RBVEFTRVRTID8gInhmYToiIDogIiI7CiAgICBidWYucHVzaChgPCR7cHJlZml4fSR7dXRmOFRhZ05hbWV9YCk7CiAgICBmb3IgKGNvbnN0IFtuYW1lLCB2YWx1ZV0gb2YgdGhpc1tfYXR0cmlidXRlc10uZW50cmllcygpKSB7CiAgICAgIGNvbnN0IHV0ZjhOYW1lID0gdXRmOFN0cmluZ1RvU3RyaW5nKG5hbWUpOwogICAgICBidWYucHVzaChgICR7dXRmOE5hbWV9PSIke2VuY29kZVRvWG1sU3RyaW5nKHZhbHVlWyRjb250ZW50XSl9ImApOwogICAgfQogICAgaWYgKHRoaXNbX2RhdGFWYWx1ZV0gIT09IG51bGwpIHsKICAgICAgaWYgKHRoaXNbX2RhdGFWYWx1ZV0pIHsKICAgICAgICBidWYucHVzaChgIHhmYTpkYXRhTm9kZT0iZGF0YVZhbHVlImApOwogICAgICB9IGVsc2UgewogICAgICAgIGJ1Zi5wdXNoKGAgeGZhOmRhdGFOb2RlPSJkYXRhR3JvdXAiYCk7CiAgICAgIH0KICAgIH0KICAgIGlmICghdGhpc1skY29udGVudF0gJiYgdGhpc1tfY2hpbGRyZW5dLmxlbmd0aCA9PT0gMCkgewogICAgICBidWYucHVzaCgiLz4iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgYnVmLnB1c2goIj4iKTsKICAgIGlmICh0aGlzWyRjb250ZW50XSkgewogICAgICBpZiAodHlwZW9mIHRoaXNbJGNvbnRlbnRdID09PSAic3RyaW5nIikgewogICAgICAgIGJ1Zi5wdXNoKGVuY29kZVRvWG1sU3RyaW5nKHRoaXNbJGNvbnRlbnRdKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpc1skY29udGVudF1bJHRvU3RyaW5nXShidWYpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXNbX2NoaWxkcmVuXSkgewogICAgICAgIGNoaWxkWyR0b1N0cmluZ10oYnVmKTsKICAgICAgfQogICAgfQogICAgYnVmLnB1c2goYDwvJHtwcmVmaXh9JHt1dGY4VGFnTmFtZX0+YCk7CiAgfQogIFskb25DaGlsZF0oY2hpbGQpIHsKICAgIGlmICh0aGlzWyRjb250ZW50XSkgewogICAgICBjb25zdCBub2RlID0gbmV3IFhtbE9iamVjdCh0aGlzWyRuYW1lc3BhY2VJZF0sICIjdGV4dCIpOwogICAgICB0aGlzWyRhcHBlbmRDaGlsZF0obm9kZSk7CiAgICAgIG5vZGVbJGNvbnRlbnRdID0gdGhpc1skY29udGVudF07CiAgICAgIHRoaXNbJGNvbnRlbnRdID0gIiI7CiAgICB9CiAgICB0aGlzWyRhcHBlbmRDaGlsZF0oY2hpbGQpOwogICAgcmV0dXJuIHRydWU7CiAgfQogIFskb25UZXh0XShzdHIpIHsKICAgIHRoaXNbJGNvbnRlbnRdICs9IHN0cjsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICBpZiAodGhpc1skY29udGVudF0gJiYgdGhpc1tfY2hpbGRyZW5dLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3Qgbm9kZSA9IG5ldyBYbWxPYmplY3QodGhpc1skbmFtZXNwYWNlSWRdLCAiI3RleHQiKTsKICAgICAgdGhpc1skYXBwZW5kQ2hpbGRdKG5vZGUpOwogICAgICBub2RlWyRjb250ZW50XSA9IHRoaXNbJGNvbnRlbnRdOwogICAgICBkZWxldGUgdGhpc1skY29udGVudF07CiAgICB9CiAgfQogIFskdG9IVE1MXSgpIHsKICAgIGlmICh0aGlzWyRub2RlTmFtZV0gPT09ICIjdGV4dCIpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgICAgbmFtZTogIiN0ZXh0IiwKICAgICAgICB2YWx1ZTogdGhpc1skY29udGVudF0KICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICB9CiAgWyRnZXRDaGlsZHJlbl0obmFtZSA9IG51bGwpIHsKICAgIGlmICghbmFtZSkgewogICAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dOwogICAgfQogICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXS5maWx0ZXIoYyA9PiBjWyRub2RlTmFtZV0gPT09IG5hbWUpOwogIH0KICBbJGdldEF0dHJpYnV0ZXNdKCkgewogICAgcmV0dXJuIHRoaXNbX2F0dHJpYnV0ZXNdOwogIH0KICBbJGdldENoaWxkcmVuQnlDbGFzc10obmFtZSkgewogICAgY29uc3QgdmFsdWUgPSB0aGlzW19hdHRyaWJ1dGVzXS5nZXQobmFtZSk7CiAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICByZXR1cm4gdGhpc1skZ2V0Q2hpbGRyZW5dKG5hbWUpOwogIH0KICAqWyRnZXRDaGlsZHJlbkJ5TmFtZUl0XShuYW1lLCBhbGxUcmFuc3BhcmVudCkgewogICAgY29uc3QgdmFsdWUgPSB0aGlzW19hdHRyaWJ1dGVzXS5nZXQobmFtZSk7CiAgICBpZiAodmFsdWUpIHsKICAgICAgeWllbGQgdmFsdWU7CiAgICB9CiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXNbX2NoaWxkcmVuXSkgewogICAgICBpZiAoY2hpbGRbJG5vZGVOYW1lXSA9PT0gbmFtZSkgewogICAgICAgIHlpZWxkIGNoaWxkOwogICAgICB9CiAgICAgIGlmIChhbGxUcmFuc3BhcmVudCkgewogICAgICAgIHlpZWxkKiBjaGlsZFskZ2V0Q2hpbGRyZW5CeU5hbWVJdF0obmFtZSwgYWxsVHJhbnNwYXJlbnQpOwogICAgICB9CiAgICB9CiAgfQogICpbJGdldEF0dHJpYnV0ZUl0XShuYW1lLCBza2lwQ29uc3VtZWQpIHsKICAgIGNvbnN0IHZhbHVlID0gdGhpc1tfYXR0cmlidXRlc10uZ2V0KG5hbWUpOwogICAgaWYgKHZhbHVlICYmICghc2tpcENvbnN1bWVkIHx8ICF2YWx1ZVskY29uc3VtZWRdKSkgewogICAgICB5aWVsZCB2YWx1ZTsKICAgIH0KICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpc1tfY2hpbGRyZW5dKSB7CiAgICAgIHlpZWxkKiBjaGlsZFskZ2V0QXR0cmlidXRlSXRdKG5hbWUsIHNraXBDb25zdW1lZCk7CiAgICB9CiAgfQogICpbJGdldFJlYWxDaGlsZHJlbkJ5TmFtZUl0XShuYW1lLCBhbGxUcmFuc3BhcmVudCwgc2tpcENvbnN1bWVkKSB7CiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXNbX2NoaWxkcmVuXSkgewogICAgICBpZiAoY2hpbGRbJG5vZGVOYW1lXSA9PT0gbmFtZSAmJiAoIXNraXBDb25zdW1lZCB8fCAhY2hpbGRbJGNvbnN1bWVkXSkpIHsKICAgICAgICB5aWVsZCBjaGlsZDsKICAgICAgfQogICAgICBpZiAoYWxsVHJhbnNwYXJlbnQpIHsKICAgICAgICB5aWVsZCogY2hpbGRbJGdldFJlYWxDaGlsZHJlbkJ5TmFtZUl0XShuYW1lLCBhbGxUcmFuc3BhcmVudCwgc2tpcENvbnN1bWVkKTsKICAgICAgfQogICAgfQogIH0KICBbJGlzRGF0YVZhbHVlXSgpIHsKICAgIGlmICh0aGlzW19kYXRhVmFsdWVdID09PSBudWxsKSB7CiAgICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl0ubGVuZ3RoID09PSAwIHx8IHRoaXNbX2NoaWxkcmVuXVswXVskbmFtZXNwYWNlSWRdID09PSBOYW1lc3BhY2VJZHMueGh0bWwuaWQ7CiAgICB9CiAgICByZXR1cm4gdGhpc1tfZGF0YVZhbHVlXTsKICB9CiAgWyRnZXREYXRhVmFsdWVdKCkgewogICAgaWYgKHRoaXNbX2RhdGFWYWx1ZV0gPT09IG51bGwpIHsKICAgICAgaWYgKHRoaXNbX2NoaWxkcmVuXS5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpc1skY29udGVudF0udHJpbSgpOwogICAgICB9CiAgICAgIGlmICh0aGlzW19jaGlsZHJlbl1bMF1bJG5hbWVzcGFjZUlkXSA9PT0gTmFtZXNwYWNlSWRzLnhodG1sLmlkKSB7CiAgICAgICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXVswXVskdGV4dF0oKS50cmltKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICByZXR1cm4gdGhpc1skY29udGVudF0udHJpbSgpOwogIH0KICBbJHNldFZhbHVlXSh2YWx1ZSkgewogICAgdmFsdWUgPSB2YWx1ZS52YWx1ZSB8fCAiIjsKICAgIHRoaXNbJGNvbnRlbnRdID0gdmFsdWUudG9TdHJpbmcoKTsKICB9CiAgWyRkdW1wXShoYXNOUyA9IGZhbHNlKSB7CiAgICBjb25zdCBkdW1wZWQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgaWYgKGhhc05TKSB7CiAgICAgIGR1bXBlZC4kbnMgPSB0aGlzWyRuYW1lc3BhY2VJZF07CiAgICB9CiAgICBpZiAodGhpc1skY29udGVudF0pIHsKICAgICAgZHVtcGVkLiRjb250ZW50ID0gdGhpc1skY29udGVudF07CiAgICB9CiAgICBkdW1wZWQuJG5hbWUgPSB0aGlzWyRub2RlTmFtZV07CiAgICBkdW1wZWQuY2hpbGRyZW4gPSBbXTsKICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpc1tfY2hpbGRyZW5dKSB7CiAgICAgIGR1bXBlZC5jaGlsZHJlbi5wdXNoKGNoaWxkWyRkdW1wXShoYXNOUykpOwogICAgfQogICAgZHVtcGVkLmF0dHJpYnV0ZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgZm9yIChjb25zdCBbbmFtZSwgdmFsdWVdIG9mIHRoaXNbX2F0dHJpYnV0ZXNdKSB7CiAgICAgIGR1bXBlZC5hdHRyaWJ1dGVzW25hbWVdID0gdmFsdWVbJGNvbnRlbnRdOwogICAgfQogICAgcmV0dXJuIGR1bXBlZDsKICB9Cn0KY2xhc3MgQ29udGVudE9iamVjdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IobnNJZCwgbmFtZSkgewogICAgc3VwZXIobnNJZCwgbmFtZSk7CiAgICB0aGlzWyRjb250ZW50XSA9ICIiOwogIH0KICBbJG9uVGV4dF0odGV4dCkgewogICAgdGhpc1skY29udGVudF0gKz0gdGV4dDsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7fQp9CmNsYXNzIE9wdGlvbk9iamVjdCBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKG5zSWQsIG5hbWUsIG9wdGlvbnMpIHsKICAgIHN1cGVyKG5zSWQsIG5hbWUpOwogICAgdGhpc1tfb3B0aW9uc10gPSBvcHRpb25zOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbJGNvbnRlbnRdID0gZ2V0S2V5d29yZCh7CiAgICAgIGRhdGE6IHRoaXNbJGNvbnRlbnRdLAogICAgICBkZWZhdWx0VmFsdWU6IHRoaXNbX29wdGlvbnNdWzBdLAogICAgICB2YWxpZGF0ZTogayA9PiB0aGlzW19vcHRpb25zXS5pbmNsdWRlcyhrKQogICAgfSk7CiAgfQogIFskY2xlYW5dKGJ1aWxkZXIpIHsKICAgIHN1cGVyWyRjbGVhbl0oYnVpbGRlcik7CiAgICBkZWxldGUgdGhpc1tfb3B0aW9uc107CiAgfQp9CmNsYXNzIFN0cmluZ09iamVjdCBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIFskZmluYWxpemVdKCkgewogICAgdGhpc1skY29udGVudF0gPSB0aGlzWyRjb250ZW50XS50cmltKCk7CiAgfQp9CmNsYXNzIEludGVnZXJPYmplY3QgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3Rvcihuc0lkLCBuYW1lLCBkZWZhdWx0VmFsdWUsIHZhbGlkYXRvcikgewogICAgc3VwZXIobnNJZCwgbmFtZSk7CiAgICB0aGlzW19kZWZhdWx0VmFsdWVdID0gZGVmYXVsdFZhbHVlOwogICAgdGhpc1tfdmFsaWRhdG9yXSA9IHZhbGlkYXRvcjsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICB0aGlzWyRjb250ZW50XSA9IGdldEludGVnZXIoewogICAgICBkYXRhOiB0aGlzWyRjb250ZW50XSwKICAgICAgZGVmYXVsdFZhbHVlOiB0aGlzW19kZWZhdWx0VmFsdWVdLAogICAgICB2YWxpZGF0ZTogdGhpc1tfdmFsaWRhdG9yXQogICAgfSk7CiAgfQogIFskY2xlYW5dKGJ1aWxkZXIpIHsKICAgIHN1cGVyWyRjbGVhbl0oYnVpbGRlcik7CiAgICBkZWxldGUgdGhpc1tfZGVmYXVsdFZhbHVlXTsKICAgIGRlbGV0ZSB0aGlzW192YWxpZGF0b3JdOwogIH0KfQpjbGFzcyBPcHRpb24wMSBleHRlbmRzIEludGVnZXJPYmplY3QgewogIGNvbnN0cnVjdG9yKG5zSWQsIG5hbWUpIHsKICAgIHN1cGVyKG5zSWQsIG5hbWUsIDAsIG4gPT4gbiA9PT0gMSk7CiAgfQp9CmNsYXNzIE9wdGlvbjEwIGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IobnNJZCwgbmFtZSkgewogICAgc3VwZXIobnNJZCwgbmFtZSwgMSwgbiA9PiBuID09PSAwKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS9odG1sX3V0aWxzLmpzCgoKCgoKCmZ1bmN0aW9uIG1lYXN1cmVUb1N0cmluZyhtKSB7CiAgaWYgKHR5cGVvZiBtID09PSAic3RyaW5nIikgewogICAgcmV0dXJuICIwcHgiOwogIH0KICByZXR1cm4gTnVtYmVyLmlzSW50ZWdlcihtKSA/IGAke219cHhgIDogYCR7bS50b0ZpeGVkKDIpfXB4YDsKfQpjb25zdCBjb252ZXJ0ZXJzID0gewogIGFuY2hvclR5cGUobm9kZSwgc3R5bGUpIHsKICAgIGNvbnN0IHBhcmVudCA9IG5vZGVbJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgICBpZiAoIXBhcmVudCB8fCBwYXJlbnQubGF5b3V0ICYmIHBhcmVudC5sYXlvdXQgIT09ICJwb3NpdGlvbiIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCEoInRyYW5zZm9ybSIgaW4gc3R5bGUpKSB7CiAgICAgIHN0eWxlLnRyYW5zZm9ybSA9ICIiOwogICAgfQogICAgc3dpdGNoIChub2RlLmFuY2hvclR5cGUpIHsKICAgICAgY2FzZSAiYm90dG9tQ2VudGVyIjoKICAgICAgICBzdHlsZS50cmFuc2Zvcm0gKz0gInRyYW5zbGF0ZSgtNTAlLCAtMTAwJSkiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJib3R0b21MZWZ0IjoKICAgICAgICBzdHlsZS50cmFuc2Zvcm0gKz0gInRyYW5zbGF0ZSgwLC0xMDAlKSI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImJvdHRvbVJpZ2h0IjoKICAgICAgICBzdHlsZS50cmFuc2Zvcm0gKz0gInRyYW5zbGF0ZSgtMTAwJSwtMTAwJSkiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJtaWRkbGVDZW50ZXIiOgogICAgICAgIHN0eWxlLnRyYW5zZm9ybSArPSAidHJhbnNsYXRlKC01MCUsLTUwJSkiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJtaWRkbGVMZWZ0IjoKICAgICAgICBzdHlsZS50cmFuc2Zvcm0gKz0gInRyYW5zbGF0ZSgwLC01MCUpIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAibWlkZGxlUmlnaHQiOgogICAgICAgIHN0eWxlLnRyYW5zZm9ybSArPSAidHJhbnNsYXRlKC0xMDAlLC01MCUpIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAidG9wQ2VudGVyIjoKICAgICAgICBzdHlsZS50cmFuc2Zvcm0gKz0gInRyYW5zbGF0ZSgtNTAlLDApIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAidG9wUmlnaHQiOgogICAgICAgIHN0eWxlLnRyYW5zZm9ybSArPSAidHJhbnNsYXRlKC0xMDAlLDApIjsKICAgICAgICBicmVhazsKICAgIH0KICB9LAogIGRpbWVuc2lvbnMobm9kZSwgc3R5bGUpIHsKICAgIGNvbnN0IHBhcmVudCA9IG5vZGVbJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgICBsZXQgd2lkdGggPSBub2RlLnc7CiAgICBjb25zdCBoZWlnaHQgPSBub2RlLmg7CiAgICBpZiAocGFyZW50LmxheW91dD8uaW5jbHVkZXMoInJvdyIpKSB7CiAgICAgIGNvbnN0IGV4dHJhID0gcGFyZW50WyRleHRyYV07CiAgICAgIGNvbnN0IGNvbFNwYW4gPSBub2RlLmNvbFNwYW47CiAgICAgIGxldCB3OwogICAgICBpZiAoY29sU3BhbiA9PT0gLTEpIHsKICAgICAgICB3ID0gTWF0aC5zdW1QcmVjaXNlKGV4dHJhLmNvbHVtbldpZHRocy5zbGljZShleHRyYS5jdXJyZW50Q29sdW1uKSk7CiAgICAgICAgZXh0cmEuY3VycmVudENvbHVtbiA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdyA9IE1hdGguc3VtUHJlY2lzZShleHRyYS5jb2x1bW5XaWR0aHMuc2xpY2UoZXh0cmEuY3VycmVudENvbHVtbiwgZXh0cmEuY3VycmVudENvbHVtbiArIGNvbFNwYW4pKTsKICAgICAgICBleHRyYS5jdXJyZW50Q29sdW1uID0gKGV4dHJhLmN1cnJlbnRDb2x1bW4gKyBub2RlLmNvbFNwYW4pICUgZXh0cmEuY29sdW1uV2lkdGhzLmxlbmd0aDsKICAgICAgfQogICAgICBpZiAoIWlzTmFOKHcpKSB7CiAgICAgICAgd2lkdGggPSBub2RlLncgPSB3OwogICAgICB9CiAgICB9CiAgICBzdHlsZS53aWR0aCA9IHdpZHRoICE9PSAiIiA/IG1lYXN1cmVUb1N0cmluZyh3aWR0aCkgOiAiYXV0byI7CiAgICBzdHlsZS5oZWlnaHQgPSBoZWlnaHQgIT09ICIiID8gbWVhc3VyZVRvU3RyaW5nKGhlaWdodCkgOiAiYXV0byI7CiAgfSwKICBwb3NpdGlvbihub2RlLCBzdHlsZSkgewogICAgY29uc3QgcGFyZW50ID0gbm9kZVskZ2V0U3ViZm9ybVBhcmVudF0oKTsKICAgIGlmIChwYXJlbnQ/LmxheW91dCAmJiBwYXJlbnQubGF5b3V0ICE9PSAicG9zaXRpb24iKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKICAgIHN0eWxlLmxlZnQgPSBtZWFzdXJlVG9TdHJpbmcobm9kZS54KTsKICAgIHN0eWxlLnRvcCA9IG1lYXN1cmVUb1N0cmluZyhub2RlLnkpOwogIH0sCiAgcm90YXRlKG5vZGUsIHN0eWxlKSB7CiAgICBpZiAobm9kZS5yb3RhdGUpIHsKICAgICAgaWYgKCEoInRyYW5zZm9ybSIgaW4gc3R5bGUpKSB7CiAgICAgICAgc3R5bGUudHJhbnNmb3JtID0gIiI7CiAgICAgIH0KICAgICAgc3R5bGUudHJhbnNmb3JtICs9IGByb3RhdGUoLSR7bm9kZS5yb3RhdGV9ZGVnKWA7CiAgICAgIHN0eWxlLnRyYW5zZm9ybU9yaWdpbiA9ICJ0b3AgbGVmdCI7CiAgICB9CiAgfSwKICBwcmVzZW5jZShub2RlLCBzdHlsZSkgewogICAgc3dpdGNoIChub2RlLnByZXNlbmNlKSB7CiAgICAgIGNhc2UgImludmlzaWJsZSI6CiAgICAgICAgc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJoaWRkZW4iOgogICAgICBjYXNlICJpbmFjdGl2ZSI6CiAgICAgICAgc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICBicmVhazsKICAgIH0KICB9LAogIGhBbGlnbihub2RlLCBzdHlsZSkgewogICAgaWYgKG5vZGVbJG5vZGVOYW1lXSA9PT0gInBhcmEiKSB7CiAgICAgIHN3aXRjaCAobm9kZS5oQWxpZ24pIHsKICAgICAgICBjYXNlICJqdXN0aWZ5QWxsIjoKICAgICAgICAgIHN0eWxlLnRleHRBbGlnbiA9ICJqdXN0aWZ5LWFsbCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJyYWRpeCI6CiAgICAgICAgICBzdHlsZS50ZXh0QWxpZ24gPSAibGVmdCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgc3R5bGUudGV4dEFsaWduID0gbm9kZS5oQWxpZ247CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHN3aXRjaCAobm9kZS5oQWxpZ24pIHsKICAgICAgICBjYXNlICJsZWZ0IjoKICAgICAgICAgIHN0eWxlLmFsaWduU2VsZiA9ICJzdGFydCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjZW50ZXIiOgogICAgICAgICAgc3R5bGUuYWxpZ25TZWxmID0gImNlbnRlciI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJyaWdodCI6CiAgICAgICAgICBzdHlsZS5hbGlnblNlbGYgPSAiZW5kIjsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfSwKICBtYXJnaW4obm9kZSwgc3R5bGUpIHsKICAgIGlmIChub2RlLm1hcmdpbikgewogICAgICBzdHlsZS5tYXJnaW4gPSBub2RlLm1hcmdpblskdG9TdHlsZV0oKS5tYXJnaW47CiAgICB9CiAgfQp9OwpmdW5jdGlvbiBzZXRNaW5NYXhEaW1lbnNpb25zKG5vZGUsIHN0eWxlKSB7CiAgY29uc3QgcGFyZW50ID0gbm9kZVskZ2V0U3ViZm9ybVBhcmVudF0oKTsKICBpZiAocGFyZW50LmxheW91dCA9PT0gInBvc2l0aW9uIikgewogICAgaWYgKG5vZGUubWluVyA+IDApIHsKICAgICAgc3R5bGUubWluV2lkdGggPSBtZWFzdXJlVG9TdHJpbmcobm9kZS5taW5XKTsKICAgIH0KICAgIGlmIChub2RlLm1heFcgPiAwKSB7CiAgICAgIHN0eWxlLm1heFdpZHRoID0gbWVhc3VyZVRvU3RyaW5nKG5vZGUubWF4Vyk7CiAgICB9CiAgICBpZiAobm9kZS5taW5IID4gMCkgewogICAgICBzdHlsZS5taW5IZWlnaHQgPSBtZWFzdXJlVG9TdHJpbmcobm9kZS5taW5IKTsKICAgIH0KICAgIGlmIChub2RlLm1heEggPiAwKSB7CiAgICAgIHN0eWxlLm1heEhlaWdodCA9IG1lYXN1cmVUb1N0cmluZyhub2RlLm1heEgpOwogICAgfQogIH0KfQpmdW5jdGlvbiBsYXlvdXRUZXh0KHRleHQsIHhmYUZvbnQsIG1hcmdpbiwgbGluZUhlaWdodCwgZm9udEZpbmRlciwgd2lkdGgpIHsKICBjb25zdCBtZWFzdXJlID0gbmV3IFRleHRNZWFzdXJlKHhmYUZvbnQsIG1hcmdpbiwgbGluZUhlaWdodCwgZm9udEZpbmRlcik7CiAgaWYgKHR5cGVvZiB0ZXh0ID09PSAic3RyaW5nIikgewogICAgbWVhc3VyZS5hZGRTdHJpbmcodGV4dCk7CiAgfSBlbHNlIHsKICAgIHRleHRbJHB1c2hHbHlwaHNdKG1lYXN1cmUpOwogIH0KICByZXR1cm4gbWVhc3VyZS5jb21wdXRlKHdpZHRoKTsKfQpmdW5jdGlvbiBsYXlvdXROb2RlKG5vZGUsIGF2YWlsYWJsZVNwYWNlKSB7CiAgbGV0IGhlaWdodCA9IG51bGw7CiAgbGV0IHdpZHRoID0gbnVsbDsKICBsZXQgaXNCcm9rZW4gPSBmYWxzZTsKICBpZiAoKCFub2RlLncgfHwgIW5vZGUuaCkgJiYgbm9kZS52YWx1ZSkgewogICAgbGV0IG1hcmdpbkggPSAwOwogICAgbGV0IG1hcmdpblYgPSAwOwogICAgaWYgKG5vZGUubWFyZ2luKSB7CiAgICAgIG1hcmdpbkggPSBub2RlLm1hcmdpbi5sZWZ0SW5zZXQgKyBub2RlLm1hcmdpbi5yaWdodEluc2V0OwogICAgICBtYXJnaW5WID0gbm9kZS5tYXJnaW4udG9wSW5zZXQgKyBub2RlLm1hcmdpbi5ib3R0b21JbnNldDsKICAgIH0KICAgIGxldCBsaW5lSGVpZ2h0ID0gbnVsbDsKICAgIGxldCBtYXJnaW4gPSBudWxsOwogICAgaWYgKG5vZGUucGFyYSkgewogICAgICBtYXJnaW4gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBsaW5lSGVpZ2h0ID0gbm9kZS5wYXJhLmxpbmVIZWlnaHQgPT09ICIiID8gbnVsbCA6IG5vZGUucGFyYS5saW5lSGVpZ2h0OwogICAgICBtYXJnaW4udG9wID0gbm9kZS5wYXJhLnNwYWNlQWJvdmUgPT09ICIiID8gMCA6IG5vZGUucGFyYS5zcGFjZUFib3ZlOwogICAgICBtYXJnaW4uYm90dG9tID0gbm9kZS5wYXJhLnNwYWNlQmVsb3cgPT09ICIiID8gMCA6IG5vZGUucGFyYS5zcGFjZUJlbG93OwogICAgICBtYXJnaW4ubGVmdCA9IG5vZGUucGFyYS5tYXJnaW5MZWZ0ID09PSAiIiA/IDAgOiBub2RlLnBhcmEubWFyZ2luTGVmdDsKICAgICAgbWFyZ2luLnJpZ2h0ID0gbm9kZS5wYXJhLm1hcmdpblJpZ2h0ID09PSAiIiA/IDAgOiBub2RlLnBhcmEubWFyZ2luUmlnaHQ7CiAgICB9CiAgICBsZXQgZm9udCA9IG5vZGUuZm9udDsKICAgIGlmICghZm9udCkgewogICAgICBjb25zdCByb290ID0gbm9kZVskZ2V0VGVtcGxhdGVSb290XSgpOwogICAgICBsZXQgcGFyZW50ID0gbm9kZVskZ2V0UGFyZW50XSgpOwogICAgICB3aGlsZSAocGFyZW50ICYmIHBhcmVudCAhPT0gcm9vdCkgewogICAgICAgIGlmIChwYXJlbnQuZm9udCkgewogICAgICAgICAgZm9udCA9IHBhcmVudC5mb250OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHBhcmVudCA9IHBhcmVudFskZ2V0UGFyZW50XSgpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBtYXhXaWR0aCA9IChub2RlLncgfHwgYXZhaWxhYmxlU3BhY2Uud2lkdGgpIC0gbWFyZ2luSDsKICAgIGNvbnN0IGZvbnRGaW5kZXIgPSBub2RlWyRnbG9iYWxEYXRhXS5mb250RmluZGVyOwogICAgaWYgKG5vZGUudmFsdWUuZXhEYXRhICYmIG5vZGUudmFsdWUuZXhEYXRhWyRjb250ZW50XSAmJiBub2RlLnZhbHVlLmV4RGF0YS5jb250ZW50VHlwZSA9PT0gInRleHQvaHRtbCIpIHsKICAgICAgY29uc3QgcmVzID0gbGF5b3V0VGV4dChub2RlLnZhbHVlLmV4RGF0YVskY29udGVudF0sIGZvbnQsIG1hcmdpbiwgbGluZUhlaWdodCwgZm9udEZpbmRlciwgbWF4V2lkdGgpOwogICAgICB3aWR0aCA9IHJlcy53aWR0aDsKICAgICAgaGVpZ2h0ID0gcmVzLmhlaWdodDsKICAgICAgaXNCcm9rZW4gPSByZXMuaXNCcm9rZW47CiAgICB9IGVsc2UgewogICAgICBjb25zdCB0ZXh0ID0gbm9kZS52YWx1ZVskdGV4dF0oKTsKICAgICAgaWYgKHRleHQpIHsKICAgICAgICBjb25zdCByZXMgPSBsYXlvdXRUZXh0KHRleHQsIGZvbnQsIG1hcmdpbiwgbGluZUhlaWdodCwgZm9udEZpbmRlciwgbWF4V2lkdGgpOwogICAgICAgIHdpZHRoID0gcmVzLndpZHRoOwogICAgICAgIGhlaWdodCA9IHJlcy5oZWlnaHQ7CiAgICAgICAgaXNCcm9rZW4gPSByZXMuaXNCcm9rZW47CiAgICAgIH0KICAgIH0KICAgIGlmICh3aWR0aCAhPT0gbnVsbCAmJiAhbm9kZS53KSB7CiAgICAgIHdpZHRoICs9IG1hcmdpbkg7CiAgICB9CiAgICBpZiAoaGVpZ2h0ICE9PSBudWxsICYmICFub2RlLmgpIHsKICAgICAgaGVpZ2h0ICs9IG1hcmdpblY7CiAgICB9CiAgfQogIHJldHVybiB7CiAgICB3OiB3aWR0aCwKICAgIGg6IGhlaWdodCwKICAgIGlzQnJva2VuCiAgfTsKfQpmdW5jdGlvbiBjb21wdXRlQmJveChub2RlLCBodG1sLCBhdmFpbGFibGVTcGFjZSkgewogIGxldCBiYm94OwogIGlmIChub2RlLncgIT09ICIiICYmIG5vZGUuaCAhPT0gIiIpIHsKICAgIGJib3ggPSBbbm9kZS54LCBub2RlLnksIG5vZGUudywgbm9kZS5oXTsKICB9IGVsc2UgewogICAgaWYgKCFhdmFpbGFibGVTcGFjZSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGxldCB3aWR0aCA9IG5vZGUudzsKICAgIGlmICh3aWR0aCA9PT0gIiIpIHsKICAgICAgaWYgKG5vZGUubWF4VyA9PT0gMCkgewogICAgICAgIGNvbnN0IHBhcmVudCA9IG5vZGVbJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgICAgICAgd2lkdGggPSBwYXJlbnQubGF5b3V0ID09PSAicG9zaXRpb24iICYmIHBhcmVudC53ICE9PSAiIiA/IDAgOiBub2RlLm1pblc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2lkdGggPSBNYXRoLm1pbihub2RlLm1heFcsIGF2YWlsYWJsZVNwYWNlLndpZHRoKTsKICAgICAgfQogICAgICBodG1sLmF0dHJpYnV0ZXMuc3R5bGUud2lkdGggPSBtZWFzdXJlVG9TdHJpbmcod2lkdGgpOwogICAgfQogICAgbGV0IGhlaWdodCA9IG5vZGUuaDsKICAgIGlmIChoZWlnaHQgPT09ICIiKSB7CiAgICAgIGlmIChub2RlLm1heEggPT09IDApIHsKICAgICAgICBjb25zdCBwYXJlbnQgPSBub2RlWyRnZXRTdWJmb3JtUGFyZW50XSgpOwogICAgICAgIGhlaWdodCA9IHBhcmVudC5sYXlvdXQgPT09ICJwb3NpdGlvbiIgJiYgcGFyZW50LmggIT09ICIiID8gMCA6IG5vZGUubWluSDsKICAgICAgfSBlbHNlIHsKICAgICAgICBoZWlnaHQgPSBNYXRoLm1pbihub2RlLm1heEgsIGF2YWlsYWJsZVNwYWNlLmhlaWdodCk7CiAgICAgIH0KICAgICAgaHRtbC5hdHRyaWJ1dGVzLnN0eWxlLmhlaWdodCA9IG1lYXN1cmVUb1N0cmluZyhoZWlnaHQpOwogICAgfQogICAgYmJveCA9IFtub2RlLngsIG5vZGUueSwgd2lkdGgsIGhlaWdodF07CiAgfQogIHJldHVybiBiYm94Owp9CmZ1bmN0aW9uIGZpeERpbWVuc2lvbnMobm9kZSkgewogIGNvbnN0IHBhcmVudCA9IG5vZGVbJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgaWYgKHBhcmVudC5sYXlvdXQ/LmluY2x1ZGVzKCJyb3ciKSkgewogICAgY29uc3QgZXh0cmEgPSBwYXJlbnRbJGV4dHJhXTsKICAgIGNvbnN0IGNvbFNwYW4gPSBub2RlLmNvbFNwYW47CiAgICBsZXQgd2lkdGg7CiAgICBpZiAoY29sU3BhbiA9PT0gLTEpIHsKICAgICAgd2lkdGggPSBNYXRoLnN1bVByZWNpc2UoZXh0cmEuY29sdW1uV2lkdGhzLnNsaWNlKGV4dHJhLmN1cnJlbnRDb2x1bW4pKTsKICAgIH0gZWxzZSB7CiAgICAgIHdpZHRoID0gTWF0aC5zdW1QcmVjaXNlKGV4dHJhLmNvbHVtbldpZHRocy5zbGljZShleHRyYS5jdXJyZW50Q29sdW1uLCBleHRyYS5jdXJyZW50Q29sdW1uICsgY29sU3BhbikpOwogICAgfQogICAgaWYgKCFpc05hTih3aWR0aCkpIHsKICAgICAgbm9kZS53ID0gd2lkdGg7CiAgICB9CiAgfQogIGlmIChwYXJlbnQubGF5b3V0ICYmIHBhcmVudC5sYXlvdXQgIT09ICJwb3NpdGlvbiIpIHsKICAgIG5vZGUueCA9IG5vZGUueSA9IDA7CiAgfQogIGlmIChub2RlLmxheW91dCA9PT0gInRhYmxlIikgewogICAgaWYgKG5vZGUudyA9PT0gIiIgJiYgQXJyYXkuaXNBcnJheShub2RlLmNvbHVtbldpZHRocykpIHsKICAgICAgbm9kZS53ID0gTWF0aC5zdW1QcmVjaXNlKG5vZGUuY29sdW1uV2lkdGhzKTsKICAgIH0KICB9Cn0KZnVuY3Rpb24gbGF5b3V0Q2xhc3Mobm9kZSkgewogIHN3aXRjaCAobm9kZS5sYXlvdXQpIHsKICAgIGNhc2UgInBvc2l0aW9uIjoKICAgICAgcmV0dXJuICJ4ZmFQb3NpdGlvbiI7CiAgICBjYXNlICJsci10YiI6CiAgICAgIHJldHVybiAieGZhTHJUYiI7CiAgICBjYXNlICJybC1yb3ciOgogICAgICByZXR1cm4gInhmYVJsUm93IjsKICAgIGNhc2UgInJsLXRiIjoKICAgICAgcmV0dXJuICJ4ZmFSbFRiIjsKICAgIGNhc2UgInJvdyI6CiAgICAgIHJldHVybiAieGZhUm93IjsKICAgIGNhc2UgInRhYmxlIjoKICAgICAgcmV0dXJuICJ4ZmFUYWJsZSI7CiAgICBjYXNlICJ0YiI6CiAgICAgIHJldHVybiAieGZhVGIiOwogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuICJ4ZmFQb3NpdGlvbiI7CiAgfQp9CmZ1bmN0aW9uIHRvU3R5bGUobm9kZSwgLi4ubmFtZXMpIHsKICBjb25zdCBzdHlsZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgZm9yIChjb25zdCBuYW1lIG9mIG5hbWVzKSB7CiAgICBjb25zdCB2YWx1ZSA9IG5vZGVbbmFtZV07CiAgICBpZiAodmFsdWUgPT09IG51bGwpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBpZiAoY29udmVydGVycy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICBjb252ZXJ0ZXJzW25hbWVdKG5vZGUsIHN0eWxlKTsKICAgICAgY29udGludWU7CiAgICB9CiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBYRkFPYmplY3QpIHsKICAgICAgY29uc3QgbmV3U3R5bGUgPSB2YWx1ZVskdG9TdHlsZV0oKTsKICAgICAgaWYgKG5ld1N0eWxlKSB7CiAgICAgICAgT2JqZWN0LmFzc2lnbihzdHlsZSwgbmV3U3R5bGUpOwogICAgICB9IGVsc2UgewogICAgICAgIHdhcm4oYChERUJVRykgLSBYRkEgLSBzdHlsZSBmb3IgJHtuYW1lfSBub3QgaW1wbGVtZW50ZWQgeWV0YCk7CiAgICAgIH0KICAgIH0KICB9CiAgcmV0dXJuIHN0eWxlOwp9CmZ1bmN0aW9uIGNyZWF0ZVdyYXBwZXIobm9kZSwgaHRtbCkgewogIGNvbnN0IHsKICAgIGF0dHJpYnV0ZXMKICB9ID0gaHRtbDsKICBjb25zdCB7CiAgICBzdHlsZQogIH0gPSBhdHRyaWJ1dGVzOwogIGNvbnN0IHdyYXBwZXIgPSB7CiAgICBuYW1lOiAiZGl2IiwKICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgY2xhc3M6IFsieGZhV3JhcHBlciJdLAogICAgICBzdHlsZTogT2JqZWN0LmNyZWF0ZShudWxsKQogICAgfSwKICAgIGNoaWxkcmVuOiBbXQogIH07CiAgYXR0cmlidXRlcy5jbGFzcy5wdXNoKCJ4ZmFXcmFwcGVkIik7CiAgaWYgKG5vZGUuYm9yZGVyKSB7CiAgICBjb25zdCB7CiAgICAgIHdpZHRocywKICAgICAgaW5zZXRzCiAgICB9ID0gbm9kZS5ib3JkZXJbJGV4dHJhXTsKICAgIGxldCB3aWR0aCwgaGVpZ2h0OwogICAgbGV0IHRvcCA9IGluc2V0c1swXTsKICAgIGxldCBsZWZ0ID0gaW5zZXRzWzNdOwogICAgY29uc3QgaW5zZXRzSCA9IGluc2V0c1swXSArIGluc2V0c1syXTsKICAgIGNvbnN0IGluc2V0c1cgPSBpbnNldHNbMV0gKyBpbnNldHNbM107CiAgICBzd2l0Y2ggKG5vZGUuYm9yZGVyLmhhbmQpIHsKICAgICAgY2FzZSAiZXZlbiI6CiAgICAgICAgdG9wIC09IHdpZHRoc1swXSAvIDI7CiAgICAgICAgbGVmdCAtPSB3aWR0aHNbM10gLyAyOwogICAgICAgIHdpZHRoID0gYGNhbGMoMTAwJSArICR7KHdpZHRoc1sxXSArIHdpZHRoc1szXSkgLyAyIC0gaW5zZXRzV31weClgOwogICAgICAgIGhlaWdodCA9IGBjYWxjKDEwMCUgKyAkeyh3aWR0aHNbMF0gKyB3aWR0aHNbMl0pIC8gMiAtIGluc2V0c0h9cHgpYDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAibGVmdCI6CiAgICAgICAgdG9wIC09IHdpZHRoc1swXTsKICAgICAgICBsZWZ0IC09IHdpZHRoc1szXTsKICAgICAgICB3aWR0aCA9IGBjYWxjKDEwMCUgKyAke3dpZHRoc1sxXSArIHdpZHRoc1szXSAtIGluc2V0c1d9cHgpYDsKICAgICAgICBoZWlnaHQgPSBgY2FsYygxMDAlICsgJHt3aWR0aHNbMF0gKyB3aWR0aHNbMl0gLSBpbnNldHNIfXB4KWA7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgInJpZ2h0IjoKICAgICAgICB3aWR0aCA9IGluc2V0c1cgPyBgY2FsYygxMDAlIC0gJHtpbnNldHNXfXB4KWAgOiAiMTAwJSI7CiAgICAgICAgaGVpZ2h0ID0gaW5zZXRzSCA/IGBjYWxjKDEwMCUgLSAke2luc2V0c0h9cHgpYCA6ICIxMDAlIjsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0IGNsYXNzTmFtZXMgPSBbInhmYUJvcmRlciJdOwogICAgaWYgKGlzUHJpbnRPbmx5KG5vZGUuYm9yZGVyKSkgewogICAgICBjbGFzc05hbWVzLnB1c2goInhmYVByaW50T25seSIpOwogICAgfQogICAgY29uc3QgYm9yZGVyID0gewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBjbGFzc05hbWVzLAogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICB0b3A6IGAke3RvcH1weGAsCiAgICAgICAgICBsZWZ0OiBgJHtsZWZ0fXB4YCwKICAgICAgICAgIHdpZHRoLAogICAgICAgICAgaGVpZ2h0CiAgICAgICAgfQogICAgICB9LAogICAgICBjaGlsZHJlbjogW10KICAgIH07CiAgICBmb3IgKGNvbnN0IGtleSBvZiBbImJvcmRlciIsICJib3JkZXJXaWR0aCIsICJib3JkZXJDb2xvciIsICJib3JkZXJSYWRpdXMiLCAiYm9yZGVyU3R5bGUiXSkgewogICAgICBpZiAoc3R5bGVba2V5XSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgYm9yZGVyLmF0dHJpYnV0ZXMuc3R5bGVba2V5XSA9IHN0eWxlW2tleV07CiAgICAgICAgZGVsZXRlIHN0eWxlW2tleV07CiAgICAgIH0KICAgIH0KICAgIHdyYXBwZXIuY2hpbGRyZW4ucHVzaChib3JkZXIsIGh0bWwpOwogIH0gZWxzZSB7CiAgICB3cmFwcGVyLmNoaWxkcmVuLnB1c2goaHRtbCk7CiAgfQogIGZvciAoY29uc3Qga2V5IG9mIFsiYmFja2dyb3VuZCIsICJiYWNrZ3JvdW5kQ2xpcCIsICJ0b3AiLCAibGVmdCIsICJ3aWR0aCIsICJoZWlnaHQiLCAibWluV2lkdGgiLCAibWluSGVpZ2h0IiwgIm1heFdpZHRoIiwgIm1heEhlaWdodCIsICJ0cmFuc2Zvcm0iLCAidHJhbnNmb3JtT3JpZ2luIiwgInZpc2liaWxpdHkiXSkgewogICAgaWYgKHN0eWxlW2tleV0gIT09IHVuZGVmaW5lZCkgewogICAgICB3cmFwcGVyLmF0dHJpYnV0ZXMuc3R5bGVba2V5XSA9IHN0eWxlW2tleV07CiAgICAgIGRlbGV0ZSBzdHlsZVtrZXldOwogICAgfQogIH0KICB3cmFwcGVyLmF0dHJpYnV0ZXMuc3R5bGUucG9zaXRpb24gPSBzdHlsZS5wb3NpdGlvbiA9PT0gImFic29sdXRlIiA/ICJhYnNvbHV0ZSIgOiAicmVsYXRpdmUiOwogIGRlbGV0ZSBzdHlsZS5wb3NpdGlvbjsKICBpZiAoc3R5bGUuYWxpZ25TZWxmKSB7CiAgICB3cmFwcGVyLmF0dHJpYnV0ZXMuc3R5bGUuYWxpZ25TZWxmID0gc3R5bGUuYWxpZ25TZWxmOwogICAgZGVsZXRlIHN0eWxlLmFsaWduU2VsZjsKICB9CiAgcmV0dXJuIHdyYXBwZXI7Cn0KZnVuY3Rpb24gZml4VGV4dEluZGVudChzdHlsZXMpIHsKICBjb25zdCBpbmRlbnQgPSBnZXRNZWFzdXJlbWVudChzdHlsZXMudGV4dEluZGVudCwgIjBweCIpOwogIGlmIChpbmRlbnQgPj0gMCkgewogICAgcmV0dXJuOwogIH0KICBjb25zdCBhbGlnbiA9IHN0eWxlcy50ZXh0QWxpZ24gPT09ICJyaWdodCIgPyAicmlnaHQiIDogImxlZnQiOwogIGNvbnN0IG5hbWUgPSAicGFkZGluZyIgKyAoYWxpZ24gPT09ICJsZWZ0IiA/ICJMZWZ0IiA6ICJSaWdodCIpOwogIGNvbnN0IHBhZGRpbmcgPSBnZXRNZWFzdXJlbWVudChzdHlsZXNbbmFtZV0sICIwcHgiKTsKICBzdHlsZXNbbmFtZV0gPSBgJHtwYWRkaW5nIC0gaW5kZW50fXB4YDsKfQpmdW5jdGlvbiBzZXRBY2Nlc3Mobm9kZSwgY2xhc3NOYW1lcykgewogIHN3aXRjaCAobm9kZS5hY2Nlc3MpIHsKICAgIGNhc2UgIm5vbkludGVyYWN0aXZlIjoKICAgICAgY2xhc3NOYW1lcy5wdXNoKCJ4ZmFOb25JbnRlcmFjdGl2ZSIpOwogICAgICBicmVhazsKICAgIGNhc2UgInJlYWRPbmx5IjoKICAgICAgY2xhc3NOYW1lcy5wdXNoKCJ4ZmFSZWFkT25seSIpOwogICAgICBicmVhazsKICAgIGNhc2UgInByb3RlY3RlZCI6CiAgICAgIGNsYXNzTmFtZXMucHVzaCgieGZhRGlzYWJsZWQiKTsKICAgICAgYnJlYWs7CiAgfQp9CmZ1bmN0aW9uIGlzUHJpbnRPbmx5KG5vZGUpIHsKICByZXR1cm4gbm9kZS5yZWxldmFudC5sZW5ndGggPiAwICYmICFub2RlLnJlbGV2YW50WzBdLmV4Y2x1ZGVkICYmIG5vZGUucmVsZXZhbnRbMF0udmlld25hbWUgPT09ICJwcmludCI7Cn0KZnVuY3Rpb24gZ2V0Q3VycmVudFBhcmEobm9kZSkgewogIGNvbnN0IHN0YWNrID0gbm9kZVskZ2V0VGVtcGxhdGVSb290XSgpWyRleHRyYV0ucGFyYVN0YWNrOwogIHJldHVybiBzdGFjay5sZW5ndGggPyBzdGFjay5hdCgtMSkgOiBudWxsOwp9CmZ1bmN0aW9uIHNldFBhcmEobm9kZSwgbm9kZVN0eWxlLCB2YWx1ZSkgewogIGlmICh2YWx1ZS5hdHRyaWJ1dGVzLmNsYXNzPy5pbmNsdWRlcygieGZhUmljaCIpKSB7CiAgICBpZiAobm9kZVN0eWxlKSB7CiAgICAgIGlmIChub2RlLmggPT09ICIiKSB7CiAgICAgICAgbm9kZVN0eWxlLmhlaWdodCA9ICJhdXRvIjsKICAgICAgfQogICAgICBpZiAobm9kZS53ID09PSAiIikgewogICAgICAgIG5vZGVTdHlsZS53aWR0aCA9ICJhdXRvIjsKICAgICAgfQogICAgfQogICAgY29uc3QgcGFyYSA9IGdldEN1cnJlbnRQYXJhKG5vZGUpOwogICAgaWYgKHBhcmEpIHsKICAgICAgY29uc3QgdmFsdWVTdHlsZSA9IHZhbHVlLmF0dHJpYnV0ZXMuc3R5bGU7CiAgICAgIHZhbHVlU3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKICAgICAgdmFsdWVTdHlsZS5mbGV4RGlyZWN0aW9uID0gImNvbHVtbiI7CiAgICAgIHN3aXRjaCAocGFyYS52QWxpZ24pIHsKICAgICAgICBjYXNlICJ0b3AiOgogICAgICAgICAgdmFsdWVTdHlsZS5qdXN0aWZ5Q29udGVudCA9ICJzdGFydCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJib3R0b20iOgogICAgICAgICAgdmFsdWVTdHlsZS5qdXN0aWZ5Q29udGVudCA9ICJlbmQiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibWlkZGxlIjoKICAgICAgICAgIHZhbHVlU3R5bGUuanVzdGlmeUNvbnRlbnQgPSAiY2VudGVyIjsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNvbnN0IHBhcmFTdHlsZSA9IHBhcmFbJHRvU3R5bGVdKCk7CiAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsXSBvZiBPYmplY3QuZW50cmllcyhwYXJhU3R5bGUpKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIHZhbHVlU3R5bGUpKSB7CiAgICAgICAgICB2YWx1ZVN0eWxlW2tleV0gPSB2YWw7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9CmZ1bmN0aW9uIHNldEZvbnRGYW1pbHkoeGZhRm9udCwgbm9kZSwgZm9udEZpbmRlciwgc3R5bGUpIHsKICBpZiAoIWZvbnRGaW5kZXIpIHsKICAgIGRlbGV0ZSBzdHlsZS5mb250RmFtaWx5OwogICAgcmV0dXJuOwogIH0KICBjb25zdCBuYW1lID0gc3RyaXBRdW90ZXMoeGZhRm9udC50eXBlZmFjZSk7CiAgc3R5bGUuZm9udEZhbWlseSA9IGAiJHtuYW1lfSJgOwogIGNvbnN0IHR5cGVmYWNlID0gZm9udEZpbmRlci5maW5kKG5hbWUpOwogIGlmICh0eXBlZmFjZSkgewogICAgY29uc3QgewogICAgICBmb250RmFtaWx5CiAgICB9ID0gdHlwZWZhY2UucmVndWxhci5jc3NGb250SW5mbzsKICAgIGlmIChmb250RmFtaWx5ICE9PSBuYW1lKSB7CiAgICAgIHN0eWxlLmZvbnRGYW1pbHkgPSBgIiR7Zm9udEZhbWlseX0iYDsKICAgIH0KICAgIGNvbnN0IHBhcmEgPSBnZXRDdXJyZW50UGFyYShub2RlKTsKICAgIGlmIChwYXJhICYmIHBhcmEubGluZUhlaWdodCAhPT0gIiIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHN0eWxlLmxpbmVIZWlnaHQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcGRmRm9udCA9IHNlbGVjdEZvbnQoeGZhRm9udCwgdHlwZWZhY2UpOwogICAgaWYgKHBkZkZvbnQpIHsKICAgICAgc3R5bGUubGluZUhlaWdodCA9IE1hdGgubWF4KDEuMiwgcGRmRm9udC5saW5lSGVpZ2h0KTsKICAgIH0KICB9Cn0KZnVuY3Rpb24gZml4VVJMKHN0cikgewogIGNvbnN0IGFic29sdXRlVXJsID0gY3JlYXRlVmFsaWRBYnNvbHV0ZVVybChzdHIsIG51bGwsIHsKICAgIGFkZERlZmF1bHRQcm90b2NvbDogdHJ1ZSwKICAgIHRyeUNvbnZlcnRFbmNvZGluZzogdHJ1ZQogIH0pOwogIHJldHVybiBhYnNvbHV0ZVVybCA/IGFic29sdXRlVXJsLmhyZWYgOiBudWxsOwp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvbGF5b3V0LmpzCgoKCmZ1bmN0aW9uIGNyZWF0ZUxpbmUobm9kZSwgY2hpbGRyZW4pIHsKICByZXR1cm4gewogICAgbmFtZTogImRpdiIsCiAgICBhdHRyaWJ1dGVzOiB7CiAgICAgIGNsYXNzOiBbbm9kZS5sYXlvdXQgPT09ICJsci10YiIgPyAieGZhTHIiIDogInhmYVJsIl0KICAgIH0sCiAgICBjaGlsZHJlbgogIH07Cn0KZnVuY3Rpb24gZmx1c2hIVE1MKG5vZGUpIHsKICBpZiAoIW5vZGVbJGV4dHJhXSkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IGF0dHJpYnV0ZXMgPSBub2RlWyRleHRyYV0uYXR0cmlidXRlczsKICBjb25zdCBodG1sID0gewogICAgbmFtZTogImRpdiIsCiAgICBhdHRyaWJ1dGVzLAogICAgY2hpbGRyZW46IG5vZGVbJGV4dHJhXS5jaGlsZHJlbgogIH07CiAgaWYgKG5vZGVbJGV4dHJhXS5mYWlsaW5nTm9kZSkgewogICAgY29uc3QgaHRtbEZyb21GYWlsaW5nID0gbm9kZVskZXh0cmFdLmZhaWxpbmdOb2RlWyRmbHVzaEhUTUxdKCk7CiAgICBpZiAoaHRtbEZyb21GYWlsaW5nKSB7CiAgICAgIGlmIChub2RlLmxheW91dC5lbmRzV2l0aCgiLXRiIikpIHsKICAgICAgICBodG1sLmNoaWxkcmVuLnB1c2goY3JlYXRlTGluZShub2RlLCBbaHRtbEZyb21GYWlsaW5nXSkpOwogICAgICB9IGVsc2UgewogICAgICAgIGh0bWwuY2hpbGRyZW4ucHVzaChodG1sRnJvbUZhaWxpbmcpOwogICAgICB9CiAgICB9CiAgfQogIGlmIChodG1sLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIHJldHVybiBodG1sOwp9CmZ1bmN0aW9uIGFkZEhUTUwobm9kZSwgaHRtbCwgYmJveCkgewogIGNvbnN0IGV4dHJhID0gbm9kZVskZXh0cmFdOwogIGNvbnN0IGF2YWlsYWJsZVNwYWNlID0gZXh0cmEuYXZhaWxhYmxlU3BhY2U7CiAgY29uc3QgW3gsIHksIHcsIGhdID0gYmJveDsKICBzd2l0Y2ggKG5vZGUubGF5b3V0KSB7CiAgICBjYXNlICJwb3NpdGlvbiI6CiAgICAgIHsKICAgICAgICBleHRyYS53aWR0aCA9IE1hdGgubWF4KGV4dHJhLndpZHRoLCB4ICsgdyk7CiAgICAgICAgZXh0cmEuaGVpZ2h0ID0gTWF0aC5tYXgoZXh0cmEuaGVpZ2h0LCB5ICsgaCk7CiAgICAgICAgZXh0cmEuY2hpbGRyZW4ucHVzaChodG1sKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgY2FzZSAibHItdGIiOgogICAgY2FzZSAicmwtdGIiOgogICAgICBpZiAoIWV4dHJhLmxpbmUgfHwgZXh0cmEuYXR0ZW1wdCA9PT0gMSkgewogICAgICAgIGV4dHJhLmxpbmUgPSBjcmVhdGVMaW5lKG5vZGUsIFtdKTsKICAgICAgICBleHRyYS5jaGlsZHJlbi5wdXNoKGV4dHJhLmxpbmUpOwogICAgICAgIGV4dHJhLm51bWJlckluTGluZSA9IDA7CiAgICAgIH0KICAgICAgZXh0cmEubnVtYmVySW5MaW5lICs9IDE7CiAgICAgIGV4dHJhLmxpbmUuY2hpbGRyZW4ucHVzaChodG1sKTsKICAgICAgaWYgKGV4dHJhLmF0dGVtcHQgPT09IDApIHsKICAgICAgICBleHRyYS5jdXJyZW50V2lkdGggKz0gdzsKICAgICAgICBleHRyYS5oZWlnaHQgPSBNYXRoLm1heChleHRyYS5oZWlnaHQsIGV4dHJhLnByZXZIZWlnaHQgKyBoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBleHRyYS5jdXJyZW50V2lkdGggPSB3OwogICAgICAgIGV4dHJhLnByZXZIZWlnaHQgPSBleHRyYS5oZWlnaHQ7CiAgICAgICAgZXh0cmEuaGVpZ2h0ICs9IGg7CiAgICAgICAgZXh0cmEuYXR0ZW1wdCA9IDA7CiAgICAgIH0KICAgICAgZXh0cmEud2lkdGggPSBNYXRoLm1heChleHRyYS53aWR0aCwgZXh0cmEuY3VycmVudFdpZHRoKTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJybC1yb3ciOgogICAgY2FzZSAicm93IjoKICAgICAgewogICAgICAgIGV4dHJhLmNoaWxkcmVuLnB1c2goaHRtbCk7CiAgICAgICAgZXh0cmEud2lkdGggKz0gdzsKICAgICAgICBleHRyYS5oZWlnaHQgPSBNYXRoLm1heChleHRyYS5oZWlnaHQsIGgpOwogICAgICAgIGNvbnN0IGhlaWdodCA9IG1lYXN1cmVUb1N0cmluZyhleHRyYS5oZWlnaHQpOwogICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgZXh0cmEuY2hpbGRyZW4pIHsKICAgICAgICAgIGNoaWxkLmF0dHJpYnV0ZXMuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgfQogICAgY2FzZSAidGFibGUiOgogICAgICB7CiAgICAgICAgZXh0cmEud2lkdGggPSBNYXRoQ2xhbXAodywgZXh0cmEud2lkdGgsIGF2YWlsYWJsZVNwYWNlLndpZHRoKTsKICAgICAgICBleHRyYS5oZWlnaHQgKz0gaDsKICAgICAgICBleHRyYS5jaGlsZHJlbi5wdXNoKGh0bWwpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICBjYXNlICJ0YiI6CiAgICAgIHsKICAgICAgICBleHRyYS53aWR0aCA9IE1hdGhDbGFtcCh3LCBleHRyYS53aWR0aCwgYXZhaWxhYmxlU3BhY2Uud2lkdGgpOwogICAgICAgIGV4dHJhLmhlaWdodCArPSBoOwogICAgICAgIGV4dHJhLmNoaWxkcmVuLnB1c2goaHRtbCk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICB9Cn0KZnVuY3Rpb24gZ2V0QXZhaWxhYmxlU3BhY2Uobm9kZSkgewogIGNvbnN0IGF2YWlsYWJsZVNwYWNlID0gbm9kZVskZXh0cmFdLmF2YWlsYWJsZVNwYWNlOwogIGNvbnN0IG1hcmdpblYgPSBub2RlLm1hcmdpbiA/IG5vZGUubWFyZ2luLnRvcEluc2V0ICsgbm9kZS5tYXJnaW4uYm90dG9tSW5zZXQgOiAwOwogIGNvbnN0IG1hcmdpbkggPSBub2RlLm1hcmdpbiA/IG5vZGUubWFyZ2luLmxlZnRJbnNldCArIG5vZGUubWFyZ2luLnJpZ2h0SW5zZXQgOiAwOwogIHN3aXRjaCAobm9kZS5sYXlvdXQpIHsKICAgIGNhc2UgImxyLXRiIjoKICAgIGNhc2UgInJsLXRiIjoKICAgICAgaWYgKG5vZGVbJGV4dHJhXS5hdHRlbXB0ID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHdpZHRoOiBhdmFpbGFibGVTcGFjZS53aWR0aCAtIG1hcmdpbkggLSBub2RlWyRleHRyYV0uY3VycmVudFdpZHRoLAogICAgICAgICAgaGVpZ2h0OiBhdmFpbGFibGVTcGFjZS5oZWlnaHQgLSBtYXJnaW5WIC0gbm9kZVskZXh0cmFdLnByZXZIZWlnaHQKICAgICAgICB9OwogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgd2lkdGg6IGF2YWlsYWJsZVNwYWNlLndpZHRoIC0gbWFyZ2luSCwKICAgICAgICBoZWlnaHQ6IGF2YWlsYWJsZVNwYWNlLmhlaWdodCAtIG1hcmdpblYgLSBub2RlWyRleHRyYV0uaGVpZ2h0CiAgICAgIH07CiAgICBjYXNlICJybC1yb3ciOgogICAgY2FzZSAicm93IjoKICAgICAgY29uc3Qgd2lkdGggPSBNYXRoLnN1bVByZWNpc2Uobm9kZVskZXh0cmFdLmNvbHVtbldpZHRocy5zbGljZShub2RlWyRleHRyYV0uY3VycmVudENvbHVtbikpOwogICAgICByZXR1cm4gewogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodDogYXZhaWxhYmxlU3BhY2UuaGVpZ2h0IC0gbWFyZ2luSAogICAgICB9OwogICAgY2FzZSAidGFibGUiOgogICAgY2FzZSAidGIiOgogICAgICByZXR1cm4gewogICAgICAgIHdpZHRoOiBhdmFpbGFibGVTcGFjZS53aWR0aCAtIG1hcmdpbkgsCiAgICAgICAgaGVpZ2h0OiBhdmFpbGFibGVTcGFjZS5oZWlnaHQgLSBtYXJnaW5WIC0gbm9kZVskZXh0cmFdLmhlaWdodAogICAgICB9OwogICAgY2FzZSAicG9zaXRpb24iOgogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIGF2YWlsYWJsZVNwYWNlOwogIH0KfQpmdW5jdGlvbiBnZXRUcmFuc2Zvcm1lZEJCb3gobm9kZSkgewogIGxldCB3ID0gbm9kZS53ID09PSAiIiA/IE5hTiA6IG5vZGUudzsKICBsZXQgaCA9IG5vZGUuaCA9PT0gIiIgPyBOYU4gOiBub2RlLmg7CiAgbGV0IFtjZW50ZXJYLCBjZW50ZXJZXSA9IFswLCAwXTsKICBzd2l0Y2ggKG5vZGUuYW5jaG9yVHlwZSB8fCAiIikgewogICAgY2FzZSAiYm90dG9tQ2VudGVyIjoKICAgICAgW2NlbnRlclgsIGNlbnRlclldID0gW3cgLyAyLCBoXTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJib3R0b21MZWZ0IjoKICAgICAgW2NlbnRlclgsIGNlbnRlclldID0gWzAsIGhdOwogICAgICBicmVhazsKICAgIGNhc2UgImJvdHRvbVJpZ2h0IjoKICAgICAgW2NlbnRlclgsIGNlbnRlclldID0gW3csIGhdOwogICAgICBicmVhazsKICAgIGNhc2UgIm1pZGRsZUNlbnRlciI6CiAgICAgIFtjZW50ZXJYLCBjZW50ZXJZXSA9IFt3IC8gMiwgaCAvIDJdOwogICAgICBicmVhazsKICAgIGNhc2UgIm1pZGRsZUxlZnQiOgogICAgICBbY2VudGVyWCwgY2VudGVyWV0gPSBbMCwgaCAvIDJdOwogICAgICBicmVhazsKICAgIGNhc2UgIm1pZGRsZVJpZ2h0IjoKICAgICAgW2NlbnRlclgsIGNlbnRlclldID0gW3csIGggLyAyXTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJ0b3BDZW50ZXIiOgogICAgICBbY2VudGVyWCwgY2VudGVyWV0gPSBbdyAvIDIsIDBdOwogICAgICBicmVhazsKICAgIGNhc2UgInRvcFJpZ2h0IjoKICAgICAgW2NlbnRlclgsIGNlbnRlclldID0gW3csIDBdOwogICAgICBicmVhazsKICB9CiAgbGV0IHgsIHk7CiAgc3dpdGNoIChub2RlLnJvdGF0ZSB8fCAwKSB7CiAgICBjYXNlIDA6CiAgICAgIFt4LCB5XSA9IFstY2VudGVyWCwgLWNlbnRlclldOwogICAgICBicmVhazsKICAgIGNhc2UgOTA6CiAgICAgIFt4LCB5XSA9IFstY2VudGVyWSwgY2VudGVyWF07CiAgICAgIFt3LCBoXSA9IFtoLCAtd107CiAgICAgIGJyZWFrOwogICAgY2FzZSAxODA6CiAgICAgIFt4LCB5XSA9IFtjZW50ZXJYLCBjZW50ZXJZXTsKICAgICAgW3csIGhdID0gWy13LCAtaF07CiAgICAgIGJyZWFrOwogICAgY2FzZSAyNzA6CiAgICAgIFt4LCB5XSA9IFtjZW50ZXJZLCAtY2VudGVyWF07CiAgICAgIFt3LCBoXSA9IFstaCwgd107CiAgICAgIGJyZWFrOwogIH0KICByZXR1cm4gW25vZGUueCArIHggKyBNYXRoLm1pbigwLCB3KSwgbm9kZS55ICsgeSArIE1hdGgubWluKDAsIGgpLCBNYXRoLmFicyh3KSwgTWF0aC5hYnMoaCldOwp9CmZ1bmN0aW9uIGNoZWNrRGltZW5zaW9ucyhub2RlLCBzcGFjZSkgewogIGlmIChub2RlWyRnZXRUZW1wbGF0ZVJvb3RdKClbJGV4dHJhXS5maXJzdFVuc3BsaXR0YWJsZSA9PT0gbnVsbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGlmIChub2RlLncgPT09IDAgfHwgbm9kZS5oID09PSAwKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgY29uc3QgRVJST1IgPSAyOwogIGNvbnN0IHBhcmVudCA9IG5vZGVbJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgY29uc3QgYXR0ZW1wdCA9IHBhcmVudFskZXh0cmFdPy5hdHRlbXB0IHx8IDA7CiAgY29uc3QgWywgeSwgdywgaF0gPSBnZXRUcmFuc2Zvcm1lZEJCb3gobm9kZSk7CiAgc3dpdGNoIChwYXJlbnQubGF5b3V0KSB7CiAgICBjYXNlICJsci10YiI6CiAgICBjYXNlICJybC10YiI6CiAgICAgIGlmIChhdHRlbXB0ID09PSAwKSB7CiAgICAgICAgaWYgKCFub2RlWyRnZXRUZW1wbGF0ZVJvb3RdKClbJGV4dHJhXS5ub0xheW91dEZhaWx1cmUpIHsKICAgICAgICAgIGlmIChub2RlLmggIT09ICIiICYmIE1hdGgucm91bmQoaCAtIHNwYWNlLmhlaWdodCkgPiBFUlJPUikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobm9kZS53ICE9PSAiIikgewogICAgICAgICAgICBpZiAoTWF0aC5yb3VuZCh3IC0gc3BhY2Uud2lkdGgpIDw9IEVSUk9SKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHBhcmVudFskZXh0cmFdLm51bWJlckluTGluZSA9PT0gMCkgewogICAgICAgICAgICAgIHJldHVybiBzcGFjZS5oZWlnaHQgPiBFUlJPUjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gc3BhY2Uud2lkdGggPiBFUlJPUjsKICAgICAgICB9CiAgICAgICAgaWYgKG5vZGUudyAhPT0gIiIpIHsKICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHcgLSBzcGFjZS53aWR0aCkgPD0gRVJST1I7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzcGFjZS53aWR0aCA+IEVSUk9SOwogICAgICB9CiAgICAgIGlmIChub2RlWyRnZXRUZW1wbGF0ZVJvb3RdKClbJGV4dHJhXS5ub0xheW91dEZhaWx1cmUpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBpZiAobm9kZS5oICE9PSAiIiAmJiBNYXRoLnJvdW5kKGggLSBzcGFjZS5oZWlnaHQpID4gRVJST1IpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKG5vZGUudyA9PT0gIiIgfHwgTWF0aC5yb3VuZCh3IC0gc3BhY2Uud2lkdGgpIDw9IEVSUk9SKSB7CiAgICAgICAgcmV0dXJuIHNwYWNlLmhlaWdodCA+IEVSUk9SOwogICAgICB9CiAgICAgIGlmIChwYXJlbnRbJGlzVGhlcmVNb3JlV2lkdGhdKCkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHNwYWNlLmhlaWdodCA+IEVSUk9SOwogICAgY2FzZSAidGFibGUiOgogICAgY2FzZSAidGIiOgogICAgICBpZiAobm9kZVskZ2V0VGVtcGxhdGVSb290XSgpWyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKG5vZGUuaCAhPT0gIiIgJiYgIW5vZGVbJGlzU3BsaXR0YWJsZV0oKSkgewogICAgICAgIHJldHVybiBNYXRoLnJvdW5kKGggLSBzcGFjZS5oZWlnaHQpIDw9IEVSUk9SOwogICAgICB9CiAgICAgIGlmIChub2RlLncgPT09ICIiIHx8IE1hdGgucm91bmQodyAtIHNwYWNlLndpZHRoKSA8PSBFUlJPUikgewogICAgICAgIHJldHVybiBzcGFjZS5oZWlnaHQgPiBFUlJPUjsKICAgICAgfQogICAgICBpZiAocGFyZW50WyRpc1RoZXJlTW9yZVdpZHRoXSgpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiBzcGFjZS5oZWlnaHQgPiBFUlJPUjsKICAgIGNhc2UgInBvc2l0aW9uIjoKICAgICAgaWYgKG5vZGVbJGdldFRlbXBsYXRlUm9vdF0oKVskZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGlmIChub2RlLmggPT09ICIiIHx8IE1hdGgucm91bmQoaCArIHkgLSBzcGFjZS5oZWlnaHQpIDw9IEVSUk9SKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgY29uc3QgYXJlYSA9IG5vZGVbJGdldFRlbXBsYXRlUm9vdF0oKVskZXh0cmFdLmN1cnJlbnRDb250ZW50QXJlYTsKICAgICAgcmV0dXJuIGggKyB5ID4gYXJlYS5oOwogICAgY2FzZSAicmwtcm93IjoKICAgIGNhc2UgInJvdyI6CiAgICAgIGlmIChub2RlWyRnZXRUZW1wbGF0ZVJvb3RdKClbJGV4dHJhXS5ub0xheW91dEZhaWx1cmUpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBpZiAobm9kZS5oICE9PSAiIikgewogICAgICAgIHJldHVybiBNYXRoLnJvdW5kKGggLSBzcGFjZS5oZWlnaHQpIDw9IEVSUk9SOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIHRydWU7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvdGVtcGxhdGUuanMKCgoKCgoKCgoKCmNvbnN0IFRFTVBMQVRFX05TX0lEID0gTmFtZXNwYWNlSWRzLnRlbXBsYXRlLmlkOwpjb25zdCBTVkdfTlMgPSAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciOwpjb25zdCBNQVhfQVRURU1QVFNfRk9SX0xSVEJfTEFZT1VUID0gMjsKY29uc3QgTUFYX0VNUFRZX1BBR0VTID0gMzsKY29uc3QgREVGQVVMVF9UQUJfSU5ERVggPSA1MDAwOwpjb25zdCBIRUFESU5HX1BBVFRFUk4gPSAvXkgoXGQrKSQvOwpjb25zdCBNSU1FUyA9IG5ldyBTZXQoWyJpbWFnZS9naWYiLCAiaW1hZ2UvanBlZyIsICJpbWFnZS9qcGciLCAiaW1hZ2UvcGpwZWciLCAiaW1hZ2UvcG5nIiwgImltYWdlL2FwbmciLCAiaW1hZ2UveC1wbmciLCAiaW1hZ2UvYm1wIiwgImltYWdlL3gtbXMtYm1wIiwgImltYWdlL3RpZmYiLCAiaW1hZ2UvdGlmIiwgImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSJdKTsKY29uc3QgSU1BR0VTX0hFQURFUlMgPSBbW1sweDQyLCAweDRkXSwgImltYWdlL2JtcCJdLCBbWzB4ZmYsIDB4ZDgsIDB4ZmZdLCAiaW1hZ2UvanBlZyJdLCBbWzB4NDksIDB4NDksIDB4MmEsIDB4MDBdLCAiaW1hZ2UvdGlmZiJdLCBbWzB4NGQsIDB4NGQsIDB4MDAsIDB4MmFdLCAiaW1hZ2UvdGlmZiJdLCBbWzB4NDcsIDB4NDksIDB4NDYsIDB4MzgsIDB4MzksIDB4NjFdLCAiaW1hZ2UvZ2lmIl0sIFtbMHg4OSwgMHg1MCwgMHg0ZSwgMHg0NywgMHgwZCwgMHgwYSwgMHgxYSwgMHgwYV0sICJpbWFnZS9wbmciXV07CmZ1bmN0aW9uIGdldEJvcmRlckRpbXMobm9kZSkgewogIGlmICghbm9kZSB8fCAhbm9kZS5ib3JkZXIpIHsKICAgIHJldHVybiB7CiAgICAgIHc6IDAsCiAgICAgIGg6IDAKICAgIH07CiAgfQogIGNvbnN0IGJvcmRlckV4dHJhID0gbm9kZS5ib3JkZXJbJGdldEV4dHJhXSgpOwogIGlmICghYm9yZGVyRXh0cmEpIHsKICAgIHJldHVybiB7CiAgICAgIHc6IDAsCiAgICAgIGg6IDAKICAgIH07CiAgfQogIHJldHVybiB7CiAgICB3OiBib3JkZXJFeHRyYS53aWR0aHNbMF0gKyBib3JkZXJFeHRyYS53aWR0aHNbMl0gKyBib3JkZXJFeHRyYS5pbnNldHNbMF0gKyBib3JkZXJFeHRyYS5pbnNldHNbMl0sCiAgICBoOiBib3JkZXJFeHRyYS53aWR0aHNbMV0gKyBib3JkZXJFeHRyYS53aWR0aHNbM10gKyBib3JkZXJFeHRyYS5pbnNldHNbMV0gKyBib3JkZXJFeHRyYS5pbnNldHNbM10KICB9Owp9CmZ1bmN0aW9uIGhhc01hcmdpbihub2RlKSB7CiAgcmV0dXJuIG5vZGUubWFyZ2luICYmIChub2RlLm1hcmdpbi50b3BJbnNldCB8fCBub2RlLm1hcmdpbi5yaWdodEluc2V0IHx8IG5vZGUubWFyZ2luLmJvdHRvbUluc2V0IHx8IG5vZGUubWFyZ2luLmxlZnRJbnNldCk7Cn0KZnVuY3Rpb24gX3NldFZhbHVlKHRlbXBsYXRlTm9kZSwgdmFsdWUpIHsKICBpZiAoIXRlbXBsYXRlTm9kZS52YWx1ZSkgewogICAgY29uc3Qgbm9kZVZhbHVlID0gbmV3IFZhbHVlKHt9KTsKICAgIHRlbXBsYXRlTm9kZVskYXBwZW5kQ2hpbGRdKG5vZGVWYWx1ZSk7CiAgICB0ZW1wbGF0ZU5vZGUudmFsdWUgPSBub2RlVmFsdWU7CiAgfQogIHRlbXBsYXRlTm9kZS52YWx1ZVskc2V0VmFsdWVdKHZhbHVlKTsKfQpmdW5jdGlvbiogZ2V0Q29udGFpbmVkQ2hpbGRyZW4obm9kZSkgewogIGZvciAoY29uc3QgY2hpbGQgb2Ygbm9kZVskZ2V0Q2hpbGRyZW5dKCkpIHsKICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIFN1YmZvcm1TZXQpIHsKICAgICAgeWllbGQqIGNoaWxkWyRnZXRDb250YWluZWRDaGlsZHJlbl0oKTsKICAgICAgY29udGludWU7CiAgICB9CiAgICB5aWVsZCBjaGlsZDsKICB9Cn0KZnVuY3Rpb24gaXNSZXF1aXJlZChub2RlKSB7CiAgcmV0dXJuIG5vZGUudmFsaWRhdGU/Lm51bGxUZXN0ID09PSAiZXJyb3IiOwp9CmZ1bmN0aW9uIHNldFRhYkluZGV4KG5vZGUpIHsKICB3aGlsZSAobm9kZSkgewogICAgaWYgKCFub2RlLnRyYXZlcnNhbCkgewogICAgICBub2RlWyR0YWJJbmRleF0gPSBub2RlWyRnZXRQYXJlbnRdKClbJHRhYkluZGV4XTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKG5vZGVbJHRhYkluZGV4XSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgbmV4dCA9IG51bGw7CiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIG5vZGUudHJhdmVyc2FsWyRnZXRDaGlsZHJlbl0oKSkgewogICAgICBpZiAoY2hpbGQub3BlcmF0aW9uID09PSAibmV4dCIpIHsKICAgICAgICBuZXh0ID0gY2hpbGQ7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmICghbmV4dCB8fCAhbmV4dC5yZWYpIHsKICAgICAgbm9kZVskdGFiSW5kZXhdID0gbm9kZVskZ2V0UGFyZW50XSgpWyR0YWJJbmRleF07CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHJvb3QgPSBub2RlWyRnZXRUZW1wbGF0ZVJvb3RdKCk7CiAgICBub2RlWyR0YWJJbmRleF0gPSArK3Jvb3RbJHRhYkluZGV4XTsKICAgIGNvbnN0IHJlZiA9IHJvb3RbJHNlYXJjaE5vZGVdKG5leHQucmVmLCBub2RlKTsKICAgIGlmICghcmVmKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIG5vZGUgPSByZWZbMF07CiAgfQp9CmZ1bmN0aW9uIGFwcGx5QXNzaXN0KG9iaiwgYXR0cmlidXRlcykgewogIGNvbnN0IGFzc2lzdCA9IG9iai5hc3Npc3Q7CiAgaWYgKGFzc2lzdCkgewogICAgY29uc3QgYXNzaXN0VGl0bGUgPSBhc3Npc3RbJHRvSFRNTF0oKTsKICAgIGlmIChhc3Npc3RUaXRsZSkgewogICAgICBhdHRyaWJ1dGVzLnRpdGxlID0gYXNzaXN0VGl0bGU7CiAgICB9CiAgICBjb25zdCByb2xlID0gYXNzaXN0LnJvbGU7CiAgICBjb25zdCBtYXRjaCA9IHJvbGUubWF0Y2goSEVBRElOR19QQVRURVJOKTsKICAgIGlmIChtYXRjaCkgewogICAgICBjb25zdCBhcmlhUm9sZSA9ICJoZWFkaW5nIjsKICAgICAgY29uc3QgYXJpYUxldmVsID0gbWF0Y2hbMV07CiAgICAgIGF0dHJpYnV0ZXMucm9sZSA9IGFyaWFSb2xlOwogICAgICBhdHRyaWJ1dGVzWyJhcmlhLWxldmVsIl0gPSBhcmlhTGV2ZWw7CiAgICB9CiAgfQogIGlmIChvYmoubGF5b3V0ID09PSAidGFibGUiKSB7CiAgICBhdHRyaWJ1dGVzLnJvbGUgPSAidGFibGUiOwogIH0gZWxzZSBpZiAob2JqLmxheW91dCA9PT0gInJvdyIpIHsKICAgIGF0dHJpYnV0ZXMucm9sZSA9ICJyb3ciOwogIH0gZWxzZSB7CiAgICBjb25zdCBwYXJlbnQgPSBvYmpbJGdldFBhcmVudF0oKTsKICAgIGlmIChwYXJlbnQubGF5b3V0ID09PSAicm93IikgewogICAgICBhdHRyaWJ1dGVzLnJvbGUgPSBwYXJlbnQuYXNzaXN0Py5yb2xlID09PSAiVEgiID8gImNvbHVtbmhlYWRlciIgOiAiY2VsbCI7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGFyaWFMYWJlbChvYmopIHsKICBpZiAoIW9iai5hc3Npc3QpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBhc3Npc3QgPSBvYmouYXNzaXN0OwogIGlmIChhc3Npc3Quc3BlYWsgJiYgYXNzaXN0LnNwZWFrWyRjb250ZW50XSAhPT0gIiIpIHsKICAgIHJldHVybiBhc3Npc3Quc3BlYWtbJGNvbnRlbnRdOwogIH0KICBpZiAoYXNzaXN0LnRvb2xUaXApIHsKICAgIHJldHVybiBhc3Npc3QudG9vbFRpcFskY29udGVudF07CiAgfQogIHJldHVybiBudWxsOwp9CmZ1bmN0aW9uIHZhbHVlVG9IdG1sKHZhbHVlKSB7CiAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICBuYW1lOiAiZGl2IiwKICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgY2xhc3M6IFsieGZhUmljaCJdLAogICAgICBzdHlsZTogT2JqZWN0LmNyZWF0ZShudWxsKQogICAgfSwKICAgIGNoaWxkcmVuOiBbewogICAgICBuYW1lOiAic3BhbiIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBzdHlsZTogT2JqZWN0LmNyZWF0ZShudWxsKQogICAgICB9LAogICAgICB2YWx1ZQogICAgfV0KICB9KTsKfQpmdW5jdGlvbiBzZXRGaXJzdFVuc3BsaXR0YWJsZShub2RlKSB7CiAgY29uc3Qgcm9vdCA9IG5vZGVbJGdldFRlbXBsYXRlUm9vdF0oKTsKICBpZiAocm9vdFskZXh0cmFdLmZpcnN0VW5zcGxpdHRhYmxlID09PSBudWxsKSB7CiAgICByb290WyRleHRyYV0uZmlyc3RVbnNwbGl0dGFibGUgPSBub2RlOwogICAgcm9vdFskZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IHRydWU7CiAgfQp9CmZ1bmN0aW9uIHVuc2V0Rmlyc3RVbnNwbGl0dGFibGUobm9kZSkgewogIGNvbnN0IHJvb3QgPSBub2RlWyRnZXRUZW1wbGF0ZVJvb3RdKCk7CiAgaWYgKHJvb3RbJGV4dHJhXS5maXJzdFVuc3BsaXR0YWJsZSA9PT0gbm9kZSkgewogICAgcm9vdFskZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IGZhbHNlOwogIH0KfQpmdW5jdGlvbiBoYW5kbGVCcmVhayhub2RlKSB7CiAgaWYgKG5vZGVbJGV4dHJhXSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBub2RlWyRleHRyYV0gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIGlmIChub2RlLnRhcmdldFR5cGUgPT09ICJhdXRvIikgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBjb25zdCByb290ID0gbm9kZVskZ2V0VGVtcGxhdGVSb290XSgpOwogIGxldCB0YXJnZXQgPSBudWxsOwogIGlmIChub2RlLnRhcmdldCkgewogICAgdGFyZ2V0ID0gcm9vdFskc2VhcmNoTm9kZV0obm9kZS50YXJnZXQsIG5vZGVbJGdldFBhcmVudF0oKSk7CiAgICBpZiAoIXRhcmdldCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB0YXJnZXQgPSB0YXJnZXRbMF07CiAgfQogIGNvbnN0IHsKICAgIGN1cnJlbnRQYWdlQXJlYSwKICAgIGN1cnJlbnRDb250ZW50QXJlYQogIH0gPSByb290WyRleHRyYV07CiAgaWYgKG5vZGUudGFyZ2V0VHlwZSA9PT0gInBhZ2VBcmVhIikgewogICAgaWYgKCEodGFyZ2V0IGluc3RhbmNlb2YgUGFnZUFyZWEpKSB7CiAgICAgIHRhcmdldCA9IG51bGw7CiAgICB9CiAgICBpZiAobm9kZS5zdGFydE5ldykgewogICAgICBub2RlWyRleHRyYV0udGFyZ2V0ID0gdGFyZ2V0IHx8IGN1cnJlbnRQYWdlQXJlYTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgaWYgKHRhcmdldCAmJiB0YXJnZXQgIT09IGN1cnJlbnRQYWdlQXJlYSkgewogICAgICBub2RlWyRleHRyYV0udGFyZ2V0ID0gdGFyZ2V0OwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgaWYgKCEodGFyZ2V0IGluc3RhbmNlb2YgQ29udGVudEFyZWEpKSB7CiAgICB0YXJnZXQgPSBudWxsOwogIH0KICBjb25zdCBwYWdlQXJlYSA9IHRhcmdldCAmJiB0YXJnZXRbJGdldFBhcmVudF0oKTsKICBsZXQgaW5kZXg7CiAgbGV0IG5leHRQYWdlQXJlYSA9IHBhZ2VBcmVhOwogIGlmIChub2RlLnN0YXJ0TmV3KSB7CiAgICBpZiAodGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvbnRlbnRBcmVhcyA9IHBhZ2VBcmVhLmNvbnRlbnRBcmVhLmNoaWxkcmVuOwogICAgICBjb25zdCBpbmRleEZvckN1cnJlbnQgPSBjb250ZW50QXJlYXMuaW5kZXhPZihjdXJyZW50Q29udGVudEFyZWEpOwogICAgICBjb25zdCBpbmRleEZvclRhcmdldCA9IGNvbnRlbnRBcmVhcy5pbmRleE9mKHRhcmdldCk7CiAgICAgIGlmIChpbmRleEZvckN1cnJlbnQgIT09IC0xICYmIGluZGV4Rm9yQ3VycmVudCA8IGluZGV4Rm9yVGFyZ2V0KSB7CiAgICAgICAgbmV4dFBhZ2VBcmVhID0gbnVsbDsKICAgICAgfQogICAgICBpbmRleCA9IGluZGV4Rm9yVGFyZ2V0IC0gMTsKICAgIH0gZWxzZSB7CiAgICAgIGluZGV4ID0gY3VycmVudFBhZ2VBcmVhLmNvbnRlbnRBcmVhLmNoaWxkcmVuLmluZGV4T2YoY3VycmVudENvbnRlbnRBcmVhKTsKICAgIH0KICB9IGVsc2UgaWYgKHRhcmdldCAmJiB0YXJnZXQgIT09IGN1cnJlbnRDb250ZW50QXJlYSkgewogICAgY29uc3QgY29udGVudEFyZWFzID0gcGFnZUFyZWEuY29udGVudEFyZWEuY2hpbGRyZW47CiAgICBpbmRleCA9IGNvbnRlbnRBcmVhcy5pbmRleE9mKHRhcmdldCkgLSAxOwogICAgbmV4dFBhZ2VBcmVhID0gcGFnZUFyZWEgPT09IGN1cnJlbnRQYWdlQXJlYSA/IG51bGwgOiBwYWdlQXJlYTsKICB9IGVsc2UgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBub2RlWyRleHRyYV0udGFyZ2V0ID0gbmV4dFBhZ2VBcmVhOwogIG5vZGVbJGV4dHJhXS5pbmRleCA9IGluZGV4OwogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIGhhbmRsZU92ZXJmbG93KG5vZGUsIGV4dHJhTm9kZSwgc3BhY2UpIHsKICBjb25zdCByb290ID0gbm9kZVskZ2V0VGVtcGxhdGVSb290XSgpOwogIGNvbnN0IHNhdmVkID0gcm9vdFskZXh0cmFdLm5vTGF5b3V0RmFpbHVyZTsKICBjb25zdCBzYXZlZE1ldGhvZCA9IGV4dHJhTm9kZVskZ2V0U3ViZm9ybVBhcmVudF07CiAgZXh0cmFOb2RlWyRnZXRTdWJmb3JtUGFyZW50XSA9ICgpID0+IG5vZGU7CiAgcm9vdFskZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IHRydWU7CiAgY29uc3QgcmVzID0gZXh0cmFOb2RlWyR0b0hUTUxdKHNwYWNlKTsKICBub2RlWyRhZGRIVE1MXShyZXMuaHRtbCwgcmVzLmJib3gpOwogIHJvb3RbJGV4dHJhXS5ub0xheW91dEZhaWx1cmUgPSBzYXZlZDsKICBleHRyYU5vZGVbJGdldFN1YmZvcm1QYXJlbnRdID0gc2F2ZWRNZXRob2Q7Cn0KY2xhc3MgQXBwZWFyYW5jZUZpbHRlciBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJhcHBlYXJhbmNlRmlsdGVyIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBBcmMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYXJjIiwgdHJ1ZSk7CiAgICB0aGlzLmNpcmN1bGFyID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuY2lyY3VsYXIsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmhhbmQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oYW5kLCBbImV2ZW4iLCAibGVmdCIsICJyaWdodCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5zdGFydEFuZ2xlID0gZ2V0RmxvYXQoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnN0YXJ0QW5nbGUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4gdHJ1ZQogICAgfSk7CiAgICB0aGlzLnN3ZWVwQW5nbGUgPSBnZXRGbG9hdCh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuc3dlZXBBbmdsZSwKICAgICAgZGVmYXVsdFZhbHVlOiAzNjAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHRydWUKICAgIH0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZWRnZSA9IG51bGw7CiAgICB0aGlzLmZpbGwgPSBudWxsOwogIH0KICBbJHRvSFRNTF0oKSB7CiAgICBjb25zdCBlZGdlID0gdGhpcy5lZGdlIHx8IG5ldyBFZGdlKHt9KTsKICAgIGNvbnN0IGVkZ2VTdHlsZSA9IGVkZ2VbJHRvU3R5bGVdKCk7CiAgICBjb25zdCBzdHlsZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBpZiAodGhpcy5maWxsPy5wcmVzZW5jZSA9PT0gInZpc2libGUiKSB7CiAgICAgIE9iamVjdC5hc3NpZ24oc3R5bGUsIHRoaXMuZmlsbFskdG9TdHlsZV0oKSk7CiAgICB9IGVsc2UgewogICAgICBzdHlsZS5maWxsID0gInRyYW5zcGFyZW50IjsKICAgIH0KICAgIHN0eWxlLnN0cm9rZVdpZHRoID0gbWVhc3VyZVRvU3RyaW5nKGVkZ2UucHJlc2VuY2UgPT09ICJ2aXNpYmxlIiA/IGVkZ2UudGhpY2tuZXNzIDogMCk7CiAgICBzdHlsZS5zdHJva2UgPSBlZGdlU3R5bGUuY29sb3I7CiAgICBsZXQgYXJjOwogICAgY29uc3QgYXR0cmlidXRlcyA9IHsKICAgICAgeG1sbnM6IFNWR19OUywKICAgICAgc3R5bGU6IHsKICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgIGhlaWdodDogIjEwMCUiLAogICAgICAgIG92ZXJmbG93OiAidmlzaWJsZSIKICAgICAgfQogICAgfTsKICAgIGlmICh0aGlzLnN3ZWVwQW5nbGUgPT09IDM2MCkgewogICAgICBhcmMgPSB7CiAgICAgICAgbmFtZTogImVsbGlwc2UiLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHhtbG5zOiBTVkdfTlMsCiAgICAgICAgICBjeDogIjUwJSIsCiAgICAgICAgICBjeTogIjUwJSIsCiAgICAgICAgICByeDogIjUwJSIsCiAgICAgICAgICByeTogIjUwJSIsCiAgICAgICAgICBzdHlsZQogICAgICAgIH0KICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHN0YXJ0QW5nbGUgPSB0aGlzLnN0YXJ0QW5nbGUgKiBNYXRoLlBJIC8gMTgwOwogICAgICBjb25zdCBzd2VlcEFuZ2xlID0gdGhpcy5zd2VlcEFuZ2xlICogTWF0aC5QSSAvIDE4MDsKICAgICAgY29uc3QgbGFyZ2VBcmMgPSB0aGlzLnN3ZWVwQW5nbGUgPiAxODAgPyAxIDogMDsKICAgICAgY29uc3QgW3gxLCB5MSwgeDIsIHkyXSA9IFs1MCAqICgxICsgTWF0aC5jb3Moc3RhcnRBbmdsZSkpLCA1MCAqICgxIC0gTWF0aC5zaW4oc3RhcnRBbmdsZSkpLCA1MCAqICgxICsgTWF0aC5jb3Moc3RhcnRBbmdsZSArIHN3ZWVwQW5nbGUpKSwgNTAgKiAoMSAtIE1hdGguc2luKHN0YXJ0QW5nbGUgKyBzd2VlcEFuZ2xlKSldOwogICAgICBhcmMgPSB7CiAgICAgICAgbmFtZTogInBhdGgiLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHhtbG5zOiBTVkdfTlMsCiAgICAgICAgICBkOiBgTSAke3gxfSAke3kxfSBBIDUwIDUwIDAgJHtsYXJnZUFyY30gMCAke3gyfSAke3kyfWAsCiAgICAgICAgICB2ZWN0b3JFZmZlY3Q6ICJub24tc2NhbGluZy1zdHJva2UiLAogICAgICAgICAgc3R5bGUKICAgICAgICB9CiAgICAgIH07CiAgICAgIE9iamVjdC5hc3NpZ24oYXR0cmlidXRlcywgewogICAgICAgIHZpZXdCb3g6ICIwIDAgMTAwIDEwMCIsCiAgICAgICAgcHJlc2VydmVBc3BlY3RSYXRpbzogIm5vbmUiCiAgICAgIH0pOwogICAgfQogICAgY29uc3Qgc3ZnID0gewogICAgICBuYW1lOiAic3ZnIiwKICAgICAgY2hpbGRyZW46IFthcmNdLAogICAgICBhdHRyaWJ1dGVzCiAgICB9OwogICAgY29uc3QgcGFyZW50ID0gdGhpc1skZ2V0UGFyZW50XSgpWyRnZXRQYXJlbnRdKCk7CiAgICBpZiAoaGFzTWFyZ2luKHBhcmVudCkpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgICAgbmFtZTogImRpdiIsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgZGlzcGxheTogImlubGluZSIsCiAgICAgICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgICAgIGhlaWdodDogIjEwMCUiCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjaGlsZHJlbjogW3N2Z10KICAgICAgfSk7CiAgICB9CiAgICBzdmcuYXR0cmlidXRlcy5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHN2Zyk7CiAgfQp9CmNsYXNzIEFyZWEgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYXJlYSIsIHRydWUpOwogICAgdGhpcy5jb2xTcGFuID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuY29sU3BhbiwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogbiA9PiBuID49IDEgfHwgbiA9PT0gLTEKICAgIH0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnJlbGV2YW50ID0gZ2V0UmVsZXZhbnQoYXR0cmlidXRlcy5yZWxldmFudCk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy54ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy54LCAiMHB0Iik7CiAgICB0aGlzLnkgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnksICIwcHQiKTsKICAgIHRoaXMuZGVzYyA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLmFyZWEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZHJhdyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leE9iamVjdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leGNsR3JvdXAgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmllbGQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3ViZm9ybSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJmb3JtU2V0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQogICpbJGdldENvbnRhaW5lZENoaWxkcmVuXSgpIHsKICAgIHlpZWxkKiBnZXRDb250YWluZWRDaGlsZHJlbih0aGlzKTsKICB9CiAgWyRpc1RyYW5zcGFyZW50XSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBbJGlzQmluZGFibGVdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIFskYWRkSFRNTF0oaHRtbCwgYmJveCkgewogICAgY29uc3QgW3gsIHksIHcsIGhdID0gYmJveDsKICAgIHRoaXNbJGV4dHJhXS53aWR0aCA9IE1hdGgubWF4KHRoaXNbJGV4dHJhXS53aWR0aCwgeCArIHcpOwogICAgdGhpc1skZXh0cmFdLmhlaWdodCA9IE1hdGgubWF4KHRoaXNbJGV4dHJhXS5oZWlnaHQsIHkgKyBoKTsKICAgIHRoaXNbJGV4dHJhXS5jaGlsZHJlbi5wdXNoKGh0bWwpOwogIH0KICBbJGdldEF2YWlsYWJsZVNwYWNlXSgpIHsKICAgIHJldHVybiB0aGlzWyRleHRyYV0uYXZhaWxhYmxlU3BhY2U7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgY29uc3Qgc3R5bGUgPSB0b1N0eWxlKHRoaXMsICJwb3NpdGlvbiIpOwogICAgY29uc3QgYXR0cmlidXRlcyA9IHsKICAgICAgc3R5bGUsCiAgICAgIGlkOiB0aGlzWyR1aWRdLAogICAgICBjbGFzczogWyJ4ZmFBcmVhIl0KICAgIH07CiAgICBpZiAoaXNQcmludE9ubHkodGhpcykpIHsKICAgICAgYXR0cmlidXRlcy5jbGFzcy5wdXNoKCJ4ZmFQcmludE9ubHkiKTsKICAgIH0KICAgIGlmICh0aGlzLm5hbWUpIHsKICAgICAgYXR0cmlidXRlcy54ZmFOYW1lID0gdGhpcy5uYW1lOwogICAgfQogICAgY29uc3QgY2hpbGRyZW4gPSBbXTsKICAgIHRoaXNbJGV4dHJhXSA9IHsKICAgICAgY2hpbGRyZW4sCiAgICAgIHdpZHRoOiAwLAogICAgICBoZWlnaHQ6IDAsCiAgICAgIGF2YWlsYWJsZVNwYWNlCiAgICB9OwogICAgY29uc3QgcmVzdWx0ID0gdGhpc1skY2hpbGRyZW5Ub0hUTUxdKHsKICAgICAgZmlsdGVyOiBuZXcgU2V0KFsiYXJlYSIsICJkcmF3IiwgImZpZWxkIiwgImV4Y2xHcm91cCIsICJzdWJmb3JtIiwgInN1YmZvcm1TZXQiXSksCiAgICAgIGluY2x1ZGU6IHRydWUKICAgIH0pOwogICAgaWYgKCFyZXN1bHQuc3VjY2VzcykgewogICAgICBpZiAocmVzdWx0LmlzQnJlYWsoKSkgewogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgZGVsZXRlIHRoaXNbJGV4dHJhXTsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRkFJTFVSRTsKICAgIH0KICAgIHN0eWxlLndpZHRoID0gbWVhc3VyZVRvU3RyaW5nKHRoaXNbJGV4dHJhXS53aWR0aCk7CiAgICBzdHlsZS5oZWlnaHQgPSBtZWFzdXJlVG9TdHJpbmcodGhpc1skZXh0cmFdLmhlaWdodCk7CiAgICBjb25zdCBodG1sID0gewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgYXR0cmlidXRlcywKICAgICAgY2hpbGRyZW4KICAgIH07CiAgICBjb25zdCBiYm94ID0gW3RoaXMueCwgdGhpcy55LCB0aGlzWyRleHRyYV0ud2lkdGgsIHRoaXNbJGV4dHJhXS5oZWlnaHRdOwogICAgZGVsZXRlIHRoaXNbJGV4dHJhXTsKICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoaHRtbCwgYmJveCk7CiAgfQp9CmNsYXNzIEFzc2lzdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJhc3Npc3QiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5yb2xlID0gYXR0cmlidXRlcy5yb2xlIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuc3BlYWsgPSBudWxsOwogICAgdGhpcy50b29sVGlwID0gbnVsbDsKICB9CiAgWyR0b0hUTUxdKCkgewogICAgcmV0dXJuIHRoaXMudG9vbFRpcD8uWyRjb250ZW50XSB8fCBudWxsOwogIH0KfQpjbGFzcyBCYXJjb2RlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImJhcmNvZGUiLCB0cnVlKTsKICAgIHRoaXMuY2hhckVuY29kaW5nID0gZ2V0S2V5d29yZCh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuY2hhckVuY29kaW5nID8gYXR0cmlidXRlcy5jaGFyRW5jb2RpbmcudG9Mb3dlckNhc2UoKSA6ICIiLAogICAgICBkZWZhdWx0VmFsdWU6ICIiLAogICAgICB2YWxpZGF0ZTogayA9PiBbInV0Zi04IiwgImJpZy1maXZlIiwgImZvbnRzcGVjaWZpYyIsICJnYmsiLCAiZ2ItMTgwMzAiLCAiZ2ItMjMxMiIsICJrc2MtNTYwMSIsICJub25lIiwgInNoaWZ0LWppcyIsICJ1Y3MtMiIsICJ1dGYtMTYiXS5pbmNsdWRlcyhrKSB8fCBrLm1hdGNoKC9pc28tODg1OS1cZHsyfS8pCiAgICB9KTsKICAgIHRoaXMuY2hlY2tzdW0gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5jaGVja3N1bSwgWyJub25lIiwgIjFtb2QxMCIsICIxbW9kMTBfMW1vZDExIiwgIjJtb2QxMCIsICJhdXRvIl0pOwogICAgdGhpcy5kYXRhQ29sdW1uQ291bnQgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5kYXRhQ29sdW1uQ291bnQsCiAgICAgIGRlZmF1bHRWYWx1ZTogLTEsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLmRhdGFMZW5ndGggPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5kYXRhTGVuZ3RoLAogICAgICBkZWZhdWx0VmFsdWU6IC0xLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAKICAgIH0pOwogICAgdGhpcy5kYXRhUHJlcCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmRhdGFQcmVwLCBbIm5vbmUiLCAiZmxhdGVDb21wcmVzcyJdKTsKICAgIHRoaXMuZGF0YVJvd0NvdW50ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZGF0YVJvd0NvdW50LAogICAgICBkZWZhdWx0VmFsdWU6IC0xLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAKICAgIH0pOwogICAgdGhpcy5lbmRDaGFyID0gYXR0cmlidXRlcy5lbmRDaGFyIHx8ICIiOwogICAgdGhpcy5lcnJvckNvcnJlY3Rpb25MZXZlbCA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmVycm9yQ29ycmVjdGlvbkxldmVsLAogICAgICBkZWZhdWx0VmFsdWU6IC0xLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAgJiYgeCA8PSA4CiAgICB9KTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5tb2R1bGVIZWlnaHQgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1vZHVsZUhlaWdodCwgIjVtbSIpOwogICAgdGhpcy5tb2R1bGVXaWR0aCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubW9kdWxlV2lkdGgsICIwLjI1bW0iKTsKICAgIHRoaXMucHJpbnRDaGVja0RpZ2l0ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMucHJpbnRDaGVja0RpZ2l0LAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy5yb3dDb2x1bW5SYXRpbyA9IGdldFJhdGlvKGF0dHJpYnV0ZXMucm93Q29sdW1uUmF0aW8pOwogICAgdGhpcy5zdGFydENoYXIgPSBhdHRyaWJ1dGVzLnN0YXJ0Q2hhciB8fCAiIjsKICAgIHRoaXMudGV4dExvY2F0aW9uID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudGV4dExvY2F0aW9uLCBbImJlbG93IiwgImFib3ZlIiwgImFib3ZlRW1iZWRkZWQiLCAiYmVsb3dFbWJlZGRlZCIsICJub25lIl0pOwogICAgdGhpcy50cnVuY2F0ZSA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnRydW5jYXRlLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSA/IGF0dHJpYnV0ZXMudHlwZS50b0xvd2VyQ2FzZSgpIDogIiIsIFsiYXp0ZWMiLCAiY29kYWJhciIsICJjb2RlMm9mNWluZHVzdHJpYWwiLCAiY29kZTJvZjVpbnRlcmxlYXZlZCIsICJjb2RlMm9mNW1hdHJpeCIsICJjb2RlMm9mNXN0YW5kYXJkIiwgImNvZGUzb2Y5IiwgImNvZGUzb2Y5ZXh0ZW5kZWQiLCAiY29kZTExIiwgImNvZGU0OSIsICJjb2RlOTMiLCAiY29kZTEyOCIsICJjb2RlMTI4YSIsICJjb2RlMTI4YiIsICJjb2RlMTI4YyIsICJjb2RlMTI4c3NjYyIsICJkYXRhbWF0cml4IiwgImVhbjgiLCAiZWFuOGFkZDIiLCAiZWFuOGFkZDUiLCAiZWFuMTMiLCAiZWFuMTNhZGQyIiwgImVhbjEzYWRkNSIsICJlYW4xM3B3Y2QiLCAiZmltIiwgImxvZ21hcnMiLCAibWF4aWNvZGUiLCAibXNpIiwgInBkZjQxNyIsICJwZGY0MTdtYWNybyIsICJwbGVzc2V5IiwgInBvc3RhdXNjdXN0MiIsICJwb3N0YXVzY3VzdDMiLCAicG9zdGF1c3JlcGx5cGFpZCIsICJwb3N0YXVzc3RhbmRhcmQiLCAicG9zdHVrcm00c2NjIiwgInBvc3R1c2RwYmMiLCAicG9zdHVzaW1iIiwgInBvc3R1c3N0YW5kYXJkIiwgInBvc3R1czV6aXAiLCAicXJjb2RlIiwgInJmaWQiLCAicnNzMTQiLCAicnNzMTRleHBhbmRlZCIsICJyc3MxNGxpbWl0ZWQiLCAicnNzMTRzdGFja2VkIiwgInJzczE0c3RhY2tlZG9tbmkiLCAicnNzMTR0cnVuY2F0ZWQiLCAidGVsZXBlbiIsICJ1Y2MxMjgiLCAidWNjMTI4cmFuZG9tIiwgInVjYzEyOHNzY2MiLCAidXBjYSIsICJ1cGNhYWRkMiIsICJ1cGNhYWRkNSIsICJ1cGNhcHdjZCIsICJ1cGNlIiwgInVwY2VhZGQyIiwgInVwY2VhZGQ1IiwgInVwY2VhbjIiLCAidXBjZWFuNSIsICJ1cHNtYXhpY29kZSJdKTsKICAgIHRoaXMudXBzTW9kZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnVwc01vZGUsIFsidXNDYXJyaWVyIiwgImludGVybmF0aW9uYWxDYXJyaWVyIiwgInNlY3VyZVN5bWJvbCIsICJzdGFuZGFyZFN5bWJvbCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLndpZGVOYXJyb3dSYXRpbyA9IGdldFJhdGlvKGF0dHJpYnV0ZXMud2lkZU5hcnJvd1JhdGlvKTsKICAgIHRoaXMuZW5jcnlwdCA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQp9CmNsYXNzIEJpbmQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYmluZCIsIHRydWUpOwogICAgdGhpcy5tYXRjaCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm1hdGNoLCBbIm9uY2UiLCAiZGF0YVJlZiIsICJnbG9iYWwiLCAibm9uZSJdKTsKICAgIHRoaXMucmVmID0gYXR0cmlidXRlcy5yZWYgfHwgIiI7CiAgICB0aGlzLnBpY3R1cmUgPSBudWxsOwogIH0KfQpjbGFzcyBCaW5kSXRlbXMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYmluZEl0ZW1zIik7CiAgICB0aGlzLmNvbm5lY3Rpb24gPSBhdHRyaWJ1dGVzLmNvbm5lY3Rpb24gfHwgIiI7CiAgICB0aGlzLmxhYmVsUmVmID0gYXR0cmlidXRlcy5sYWJlbFJlZiB8fCAiIjsKICAgIHRoaXMucmVmID0gYXR0cmlidXRlcy5yZWYgfHwgIiI7CiAgICB0aGlzLnZhbHVlUmVmID0gYXR0cmlidXRlcy52YWx1ZVJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgQm9va2VuZCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJib29rZW5kIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubGVhZGVyID0gYXR0cmlidXRlcy5sZWFkZXIgfHwgIiI7CiAgICB0aGlzLnRyYWlsZXIgPSBhdHRyaWJ1dGVzLnRyYWlsZXIgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBCb29sZWFuRWxlbWVudCBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImJvb2xlYW4iKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICByZXR1cm4gdmFsdWVUb0h0bWwodGhpc1skY29udGVudF0gPT09IDEgPyAiMSIgOiAiMCIpOwogIH0KfQpjbGFzcyBCb3JkZXIgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYm9yZGVyIiwgdHJ1ZSk7CiAgICB0aGlzLmJyZWFrID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuYnJlYWssIFsiY2xvc2UiLCAib3BlbiJdKTsKICAgIHRoaXMuaGFuZCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmhhbmQsIFsiZXZlbiIsICJsZWZ0IiwgInJpZ2h0Il0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnByZXNlbmNlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucHJlc2VuY2UsIFsidmlzaWJsZSIsICJoaWRkZW4iLCAiaW5hY3RpdmUiLCAiaW52aXNpYmxlIl0pOwogICAgdGhpcy5yZWxldmFudCA9IGdldFJlbGV2YW50KGF0dHJpYnV0ZXMucmVsZXZhbnQpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY29ybmVyID0gbmV3IFhGQU9iamVjdEFycmF5KDQpOwogICAgdGhpcy5lZGdlID0gbmV3IFhGQU9iamVjdEFycmF5KDQpOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5maWxsID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICB9CiAgWyRnZXRFeHRyYV0oKSB7CiAgICBpZiAoIXRoaXNbJGV4dHJhXSkgewogICAgICBjb25zdCBlZGdlcyA9IHRoaXMuZWRnZS5jaGlsZHJlbi5zbGljZSgpOwogICAgICBpZiAoZWRnZXMubGVuZ3RoIDwgNCkgewogICAgICAgIGNvbnN0IGRlZmF1bHRFZGdlID0gZWRnZXMuYXQoLTEpIHx8IG5ldyBFZGdlKHt9KTsKICAgICAgICBmb3IgKGxldCBpID0gZWRnZXMubGVuZ3RoOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICBlZGdlcy5wdXNoKGRlZmF1bHRFZGdlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3Qgd2lkdGhzID0gZWRnZXMubWFwKGVkZ2UgPT4gZWRnZS50aGlja25lc3MpOwogICAgICBjb25zdCBpbnNldHMgPSBbMCwgMCwgMCwgMF07CiAgICAgIGlmICh0aGlzLm1hcmdpbikgewogICAgICAgIGluc2V0c1swXSA9IHRoaXMubWFyZ2luLnRvcEluc2V0OwogICAgICAgIGluc2V0c1sxXSA9IHRoaXMubWFyZ2luLnJpZ2h0SW5zZXQ7CiAgICAgICAgaW5zZXRzWzJdID0gdGhpcy5tYXJnaW4uYm90dG9tSW5zZXQ7CiAgICAgICAgaW5zZXRzWzNdID0gdGhpcy5tYXJnaW4ubGVmdEluc2V0OwogICAgICB9CiAgICAgIHRoaXNbJGV4dHJhXSA9IHsKICAgICAgICB3aWR0aHMsCiAgICAgICAgaW5zZXRzLAogICAgICAgIGVkZ2VzCiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gdGhpc1skZXh0cmFdOwogIH0KICBbJHRvU3R5bGVdKCkgewogICAgY29uc3QgewogICAgICBlZGdlcwogICAgfSA9IHRoaXNbJGdldEV4dHJhXSgpOwogICAgY29uc3QgZWRnZVN0eWxlcyA9IGVkZ2VzLm1hcChub2RlID0+IHsKICAgICAgY29uc3Qgc3R5bGUgPSBub2RlWyR0b1N0eWxlXSgpOwogICAgICBzdHlsZS5jb2xvciB8fD0gIiMwMDAwMDAiOwogICAgICByZXR1cm4gc3R5bGU7CiAgICB9KTsKICAgIGNvbnN0IHN0eWxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGlmICh0aGlzLm1hcmdpbikgewogICAgICBPYmplY3QuYXNzaWduKHN0eWxlLCB0aGlzLm1hcmdpblskdG9TdHlsZV0oKSk7CiAgICB9CiAgICBpZiAodGhpcy5maWxsPy5wcmVzZW5jZSA9PT0gInZpc2libGUiKSB7CiAgICAgIE9iamVjdC5hc3NpZ24oc3R5bGUsIHRoaXMuZmlsbFskdG9TdHlsZV0oKSk7CiAgICB9CiAgICBpZiAodGhpcy5jb3JuZXIuY2hpbGRyZW4uc29tZShub2RlID0+IG5vZGUucmFkaXVzICE9PSAwKSkgewogICAgICBjb25zdCBjb3JuZXJTdHlsZXMgPSB0aGlzLmNvcm5lci5jaGlsZHJlbi5tYXAobm9kZSA9PiBub2RlWyR0b1N0eWxlXSgpKTsKICAgICAgaWYgKGNvcm5lclN0eWxlcy5sZW5ndGggPT09IDIgfHwgY29ybmVyU3R5bGVzLmxlbmd0aCA9PT0gMykgewogICAgICAgIGNvbnN0IGxhc3QgPSBjb3JuZXJTdHlsZXMuYXQoLTEpOwogICAgICAgIGZvciAobGV0IGkgPSBjb3JuZXJTdHlsZXMubGVuZ3RoOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICBjb3JuZXJTdHlsZXMucHVzaChsYXN0KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgc3R5bGUuYm9yZGVyUmFkaXVzID0gY29ybmVyU3R5bGVzLm1hcChzID0+IHMucmFkaXVzKS5qb2luKCIgIik7CiAgICB9CiAgICBzd2l0Y2ggKHRoaXMucHJlc2VuY2UpIHsKICAgICAgY2FzZSAiaW52aXNpYmxlIjoKICAgICAgY2FzZSAiaGlkZGVuIjoKICAgICAgICBzdHlsZS5ib3JkZXJTdHlsZSA9ICIiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJpbmFjdGl2ZSI6CiAgICAgICAgc3R5bGUuYm9yZGVyU3R5bGUgPSAibm9uZSI7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgc3R5bGUuYm9yZGVyU3R5bGUgPSBlZGdlU3R5bGVzLm1hcChzID0+IHMuc3R5bGUpLmpvaW4oIiAiKTsKICAgICAgICBicmVhazsKICAgIH0KICAgIHN0eWxlLmJvcmRlcldpZHRoID0gZWRnZVN0eWxlcy5tYXAocyA9PiBzLndpZHRoKS5qb2luKCIgIik7CiAgICBzdHlsZS5ib3JkZXJDb2xvciA9IGVkZ2VTdHlsZXMubWFwKHMgPT4gcy5jb2xvcikuam9pbigiICIpOwogICAgcmV0dXJuIHN0eWxlOwogIH0KfQpjbGFzcyBCcmVhayBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJicmVhayIsIHRydWUpOwogICAgdGhpcy5hZnRlciA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmFmdGVyLCBbImF1dG8iLCAiY29udGVudEFyZWEiLCAicGFnZUFyZWEiLCAicGFnZUV2ZW4iLCAicGFnZU9kZCJdKTsKICAgIHRoaXMuYWZ0ZXJUYXJnZXQgPSBhdHRyaWJ1dGVzLmFmdGVyVGFyZ2V0IHx8ICIiOwogICAgdGhpcy5iZWZvcmUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5iZWZvcmUsIFsiYXV0byIsICJjb250ZW50QXJlYSIsICJwYWdlQXJlYSIsICJwYWdlRXZlbiIsICJwYWdlT2RkIl0pOwogICAgdGhpcy5iZWZvcmVUYXJnZXQgPSBhdHRyaWJ1dGVzLmJlZm9yZVRhcmdldCB8fCAiIjsKICAgIHRoaXMuYm9va2VuZExlYWRlciA9IGF0dHJpYnV0ZXMuYm9va2VuZExlYWRlciB8fCAiIjsKICAgIHRoaXMuYm9va2VuZFRyYWlsZXIgPSBhdHRyaWJ1dGVzLmJvb2tlbmRUcmFpbGVyIHx8ICIiOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm92ZXJmbG93TGVhZGVyID0gYXR0cmlidXRlcy5vdmVyZmxvd0xlYWRlciB8fCAiIjsKICAgIHRoaXMub3ZlcmZsb3dUYXJnZXQgPSBhdHRyaWJ1dGVzLm92ZXJmbG93VGFyZ2V0IHx8ICIiOwogICAgdGhpcy5vdmVyZmxvd1RyYWlsZXIgPSBhdHRyaWJ1dGVzLm92ZXJmbG93VHJhaWxlciB8fCAiIjsKICAgIHRoaXMuc3RhcnROZXcgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5zdGFydE5ldywKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQp9CmNsYXNzIEJyZWFrQWZ0ZXIgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYnJlYWtBZnRlciIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxlYWRlciA9IGF0dHJpYnV0ZXMubGVhZGVyIHx8ICIiOwogICAgdGhpcy5zdGFydE5ldyA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnN0YXJ0TmV3LAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy50YXJnZXQgPSBhdHRyaWJ1dGVzLnRhcmdldCB8fCAiIjsKICAgIHRoaXMudGFyZ2V0VHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnRhcmdldFR5cGUsIFsiYXV0byIsICJjb250ZW50QXJlYSIsICJwYWdlQXJlYSJdKTsKICAgIHRoaXMudHJhaWxlciA9IGF0dHJpYnV0ZXMudHJhaWxlciB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnNjcmlwdCA9IG51bGw7CiAgfQp9CmNsYXNzIEJyZWFrQmVmb3JlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImJyZWFrQmVmb3JlIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubGVhZGVyID0gYXR0cmlidXRlcy5sZWFkZXIgfHwgIiI7CiAgICB0aGlzLnN0YXJ0TmV3ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuc3RhcnROZXcsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLnRhcmdldCA9IGF0dHJpYnV0ZXMudGFyZ2V0IHx8ICIiOwogICAgdGhpcy50YXJnZXRUeXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudGFyZ2V0VHlwZSwgWyJhdXRvIiwgImNvbnRlbnRBcmVhIiwgInBhZ2VBcmVhIl0pOwogICAgdGhpcy50cmFpbGVyID0gYXR0cmlidXRlcy50cmFpbGVyIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuc2NyaXB0ID0gbnVsbDsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICB0aGlzWyRleHRyYV0gPSB7fTsKICAgIHJldHVybiBIVE1MUmVzdWx0LkZBSUxVUkU7CiAgfQp9CmNsYXNzIEJ1dHRvbiBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJidXR0b24iLCB0cnVlKTsKICAgIHRoaXMuaGlnaGxpZ2h0ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuaGlnaGxpZ2h0LCBbImludmVydGVkIiwgIm5vbmUiLCAib3V0bGluZSIsICJwdXNoIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGdyYW5kcGEgPSBwYXJlbnRbJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGh0bWxCdXR0b24gPSB7CiAgICAgIG5hbWU6ICJidXR0b24iLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgaWQ6IHRoaXNbJHVpZF0sCiAgICAgICAgY2xhc3M6IFsieGZhQnV0dG9uIl0sCiAgICAgICAgc3R5bGU6IHt9CiAgICAgIH0sCiAgICAgIGNoaWxkcmVuOiBbXQogICAgfTsKICAgIGZvciAoY29uc3QgZXZlbnQgb2YgZ3JhbmRwYS5ldmVudC5jaGlsZHJlbikgewogICAgICBpZiAoZXZlbnQuYWN0aXZpdHkgIT09ICJjbGljayIgfHwgIWV2ZW50LnNjcmlwdCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGpzVVJMID0gcmVjb3ZlckpzVVJMKGV2ZW50LnNjcmlwdFskY29udGVudF0pOwogICAgICBpZiAoIWpzVVJMKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgaHJlZiA9IGZpeFVSTChqc1VSTC51cmwpOwogICAgICBpZiAoIWhyZWYpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBodG1sQnV0dG9uLmNoaWxkcmVuLnB1c2goewogICAgICAgIG5hbWU6ICJhIiwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBpZDogImxpbmsiICsgdGhpc1skdWlkXSwKICAgICAgICAgIGhyZWYsCiAgICAgICAgICBuZXdXaW5kb3c6IGpzVVJMLm5ld1dpbmRvdywKICAgICAgICAgIGNsYXNzOiBbInhmYUxpbmsiXSwKICAgICAgICAgIHN0eWxlOiB7fQogICAgICAgIH0sCiAgICAgICAgY2hpbGRyZW46IFtdCiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2VzcyhodG1sQnV0dG9uKTsKICB9Cn0KY2xhc3MgQ2FsY3VsYXRlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImNhbGN1bGF0ZSIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm92ZXJyaWRlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMub3ZlcnJpZGUsIFsiZGlzYWJsZWQiLCAiZXJyb3IiLCAiaWdub3JlIiwgIndhcm5pbmciXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tZXNzYWdlID0gbnVsbDsKICAgIHRoaXMuc2NyaXB0ID0gbnVsbDsKICB9Cn0KY2xhc3MgQ2FwdGlvbiBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJjYXB0aW9uIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMucGxhY2VtZW50ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucGxhY2VtZW50LCBbImxlZnQiLCAiYm90dG9tIiwgImlubGluZSIsICJyaWdodCIsICJ0b3AiXSk7CiAgICB0aGlzLnByZXNlbmNlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucHJlc2VuY2UsIFsidmlzaWJsZSIsICJoaWRkZW4iLCAiaW5hY3RpdmUiLCAiaW52aXNpYmxlIl0pOwogICAgdGhpcy5yZXNlcnZlID0gTWF0aC5jZWlsKGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMucmVzZXJ2ZSkpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuZm9udCA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgICB0aGlzLnBhcmEgPSBudWxsOwogICAgdGhpcy52YWx1ZSA9IG51bGw7CiAgfQogIFskc2V0VmFsdWVdKHZhbHVlKSB7CiAgICBfc2V0VmFsdWUodGhpcywgdmFsdWUpOwogIH0KICBbJGdldEV4dHJhXShhdmFpbGFibGVTcGFjZSkgewogICAgaWYgKCF0aGlzWyRleHRyYV0pIHsKICAgICAgbGV0IHsKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQKICAgICAgfSA9IGF2YWlsYWJsZVNwYWNlOwogICAgICBzd2l0Y2ggKHRoaXMucGxhY2VtZW50KSB7CiAgICAgICAgY2FzZSAibGVmdCI6CiAgICAgICAgY2FzZSAicmlnaHQiOgogICAgICAgIGNhc2UgImlubGluZSI6CiAgICAgICAgICB3aWR0aCA9IHRoaXMucmVzZXJ2ZSA8PSAwID8gd2lkdGggOiB0aGlzLnJlc2VydmU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJ0b3AiOgogICAgICAgIGNhc2UgImJvdHRvbSI6CiAgICAgICAgICBoZWlnaHQgPSB0aGlzLnJlc2VydmUgPD0gMCA/IGhlaWdodCA6IHRoaXMucmVzZXJ2ZTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHRoaXNbJGV4dHJhXSA9IGxheW91dE5vZGUodGhpcywgewogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodAogICAgICB9KTsKICAgIH0KICAgIHJldHVybiB0aGlzWyRleHRyYV07CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgaWYgKCF0aGlzLnZhbHVlKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgdGhpc1skcHVzaFBhcmFdKCk7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXMudmFsdWVbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpLmh0bWw7CiAgICBpZiAoIXZhbHVlKSB7CiAgICAgIHRoaXNbJHBvcFBhcmFdKCk7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgY29uc3Qgc2F2ZWRSZXNlcnZlID0gdGhpcy5yZXNlcnZlOwogICAgaWYgKHRoaXMucmVzZXJ2ZSA8PSAwKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB3LAogICAgICAgIGgKICAgICAgfSA9IHRoaXNbJGdldEV4dHJhXShhdmFpbGFibGVTcGFjZSk7CiAgICAgIHN3aXRjaCAodGhpcy5wbGFjZW1lbnQpIHsKICAgICAgICBjYXNlICJsZWZ0IjoKICAgICAgICBjYXNlICJyaWdodCI6CiAgICAgICAgY2FzZSAiaW5saW5lIjoKICAgICAgICAgIHRoaXMucmVzZXJ2ZSA9IHc7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJ0b3AiOgogICAgICAgIGNhc2UgImJvdHRvbSI6CiAgICAgICAgICB0aGlzLnJlc2VydmUgPSBoOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGNoaWxkcmVuID0gW107CiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAic3RyaW5nIikgewogICAgICBjaGlsZHJlbi5wdXNoKHsKICAgICAgICBuYW1lOiAiI3RleHQiLAogICAgICAgIHZhbHVlCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgY2hpbGRyZW4ucHVzaCh2YWx1ZSk7CiAgICB9CiAgICBjb25zdCBzdHlsZSA9IHRvU3R5bGUodGhpcywgImZvbnQiLCAibWFyZ2luIiwgInZpc2liaWxpdHkiKTsKICAgIHN3aXRjaCAodGhpcy5wbGFjZW1lbnQpIHsKICAgICAgY2FzZSAibGVmdCI6CiAgICAgIGNhc2UgInJpZ2h0IjoKICAgICAgICBpZiAodGhpcy5yZXNlcnZlID4gMCkgewogICAgICAgICAgc3R5bGUud2lkdGggPSBtZWFzdXJlVG9TdHJpbmcodGhpcy5yZXNlcnZlKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgInRvcCI6CiAgICAgIGNhc2UgImJvdHRvbSI6CiAgICAgICAgaWYgKHRoaXMucmVzZXJ2ZSA+IDApIHsKICAgICAgICAgIHN0eWxlLmhlaWdodCA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLnJlc2VydmUpOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgIH0KICAgIHNldFBhcmEodGhpcywgbnVsbCwgdmFsdWUpOwogICAgdGhpc1skcG9wUGFyYV0oKTsKICAgIHRoaXMucmVzZXJ2ZSA9IHNhdmVkUmVzZXJ2ZTsKICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIHN0eWxlLAogICAgICAgIGNsYXNzOiBbInhmYUNhcHRpb24iXQogICAgICB9LAogICAgICBjaGlsZHJlbgogICAgfSk7CiAgfQp9CmNsYXNzIENlcnRpZmljYXRlIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImNlcnRpZmljYXRlIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIENlcnRpZmljYXRlcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJjZXJ0aWZpY2F0ZXMiLCB0cnVlKTsKICAgIHRoaXMuY3JlZGVudGlhbFNlcnZlclBvbGljeSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmNyZWRlbnRpYWxTZXJ2ZXJQb2xpY3ksIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXJsID0gYXR0cmlidXRlcy51cmwgfHwgIiI7CiAgICB0aGlzLnVybFBvbGljeSA9IGF0dHJpYnV0ZXMudXJsUG9saWN5IHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZW5jcnlwdGlvbiA9IG51bGw7CiAgICB0aGlzLmlzc3VlcnMgPSBudWxsOwogICAgdGhpcy5rZXlVc2FnZSA9IG51bGw7CiAgICB0aGlzLm9pZHMgPSBudWxsOwogICAgdGhpcy5zaWduaW5nID0gbnVsbDsKICAgIHRoaXMuc3ViamVjdEROcyA9IG51bGw7CiAgfQp9CmNsYXNzIENoZWNrQnV0dG9uIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImNoZWNrQnV0dG9uIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubWFyayA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm1hcmssIFsiZGVmYXVsdCIsICJjaGVjayIsICJjaXJjbGUiLCAiY3Jvc3MiLCAiZGlhbW9uZCIsICJzcXVhcmUiLCAic3RhciJdKTsKICAgIHRoaXMuc2hhcGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5zaGFwZSwgWyJzcXVhcmUiLCAicm91bmQiXSk7CiAgICB0aGlzLnNpemUgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnNpemUsICIxMHB0Iik7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAibWFyZ2luIik7CiAgICBjb25zdCBzaXplID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMuc2l6ZSk7CiAgICBzdHlsZS53aWR0aCA9IHN0eWxlLmhlaWdodCA9IHNpemU7CiAgICBsZXQgdHlwZTsKICAgIGxldCBjbGFzc05hbWU7CiAgICBsZXQgZ3JvdXBJZDsKICAgIGNvbnN0IGZpZWxkID0gdGhpc1skZ2V0UGFyZW50XSgpWyRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBpdGVtcyA9IGZpZWxkLml0ZW1zLmNoaWxkcmVuLmxlbmd0aCAmJiBmaWVsZC5pdGVtcy5jaGlsZHJlblswXVskdG9IVE1MXSgpLmh0bWwgfHwgW107CiAgICBjb25zdCBleHBvcnRlZFZhbHVlID0gewogICAgICBvbjogKGl0ZW1zWzBdICE9PSB1bmRlZmluZWQgPyBpdGVtc1swXSA6ICJvbiIpLnRvU3RyaW5nKCksCiAgICAgIG9mZjogKGl0ZW1zWzFdICE9PSB1bmRlZmluZWQgPyBpdGVtc1sxXSA6ICJvZmYiKS50b1N0cmluZygpCiAgICB9OwogICAgY29uc3QgdmFsdWUgPSBmaWVsZC52YWx1ZT8uWyR0ZXh0XSgpIHx8ICJvZmYiOwogICAgY29uc3QgY2hlY2tlZCA9IHZhbHVlID09PSBleHBvcnRlZFZhbHVlLm9uIHx8IHVuZGVmaW5lZDsKICAgIGNvbnN0IGNvbnRhaW5lciA9IGZpZWxkWyRnZXRTdWJmb3JtUGFyZW50XSgpOwogICAgY29uc3QgZmllbGRJZCA9IGZpZWxkWyR1aWRdOwogICAgbGV0IGRhdGFJZDsKICAgIGlmIChjb250YWluZXIgaW5zdGFuY2VvZiBFeGNsR3JvdXApIHsKICAgICAgZ3JvdXBJZCA9IGNvbnRhaW5lclskdWlkXTsKICAgICAgdHlwZSA9ICJyYWRpbyI7CiAgICAgIGNsYXNzTmFtZSA9ICJ4ZmFSYWRpbyI7CiAgICAgIGRhdGFJZCA9IGNvbnRhaW5lclskZGF0YV0/LlskdWlkXSB8fCBjb250YWluZXJbJHVpZF07CiAgICB9IGVsc2UgewogICAgICB0eXBlID0gImNoZWNrYm94IjsKICAgICAgY2xhc3NOYW1lID0gInhmYUNoZWNrYm94IjsKICAgICAgZGF0YUlkID0gZmllbGRbJGRhdGFdPy5bJHVpZF0gfHwgZmllbGRbJHVpZF07CiAgICB9CiAgICBjb25zdCBpbnB1dCA9IHsKICAgICAgbmFtZTogImlucHV0IiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbY2xhc3NOYW1lXSwKICAgICAgICBzdHlsZSwKICAgICAgICBmaWVsZElkLAogICAgICAgIGRhdGFJZCwKICAgICAgICB0eXBlLAogICAgICAgIGNoZWNrZWQsCiAgICAgICAgeGZhT246IGV4cG9ydGVkVmFsdWUub24sCiAgICAgICAgeGZhT2ZmOiBleHBvcnRlZFZhbHVlLm9mZiwKICAgICAgICAiYXJpYS1sYWJlbCI6IGFyaWFMYWJlbChmaWVsZCksCiAgICAgICAgImFyaWEtcmVxdWlyZWQiOiBmYWxzZQogICAgICB9CiAgICB9OwogICAgaWYgKGdyb3VwSWQpIHsKICAgICAgaW5wdXQuYXR0cmlidXRlcy5uYW1lID0gZ3JvdXBJZDsKICAgIH0KICAgIGlmIChpc1JlcXVpcmVkKGZpZWxkKSkgewogICAgICBpbnB1dC5hdHRyaWJ1dGVzWyJhcmlhLXJlcXVpcmVkIl0gPSB0cnVlOwogICAgICBpbnB1dC5hdHRyaWJ1dGVzLnJlcXVpcmVkID0gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAibGFiZWwiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IFsieGZhTGFiZWwiXQogICAgICB9LAogICAgICBjaGlsZHJlbjogW2lucHV0XQogICAgfSk7CiAgfQp9CmNsYXNzIENob2ljZUxpc3QgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY2hvaWNlTGlzdCIsIHRydWUpOwogICAgdGhpcy5jb21taXRPbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmNvbW1pdE9uLCBbInNlbGVjdCIsICJleGl0Il0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm9wZW4gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5vcGVuLCBbInVzZXJDb250cm9sIiwgImFsd2F5cyIsICJtdWx0aVNlbGVjdCIsICJvbkVudHJ5Il0pOwogICAgdGhpcy50ZXh0RW50cnkgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy50ZXh0RW50cnksCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAiYm9yZGVyIiwgIm1hcmdpbiIpOwogICAgY29uc3QgdWkgPSB0aGlzWyRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBmaWVsZCA9IHVpWyRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBmb250U2l6ZSA9IGZpZWxkLmZvbnQ/LnNpemUgfHwgMTA7CiAgICBjb25zdCBvcHRpb25TdHlsZSA9IHsKICAgICAgZm9udFNpemU6IGBjYWxjKCR7Zm9udFNpemV9cHggKiB2YXIoLS10b3RhbC1zY2FsZS1mYWN0b3IpKWAKICAgIH07CiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOwogICAgaWYgKGZpZWxkLml0ZW1zLmNoaWxkcmVuLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgaXRlbXMgPSBmaWVsZC5pdGVtczsKICAgICAgbGV0IGRpc3BsYXllZEluZGV4ID0gMDsKICAgICAgbGV0IHNhdmVJbmRleCA9IDA7CiAgICAgIGlmIChpdGVtcy5jaGlsZHJlbi5sZW5ndGggPT09IDIpIHsKICAgICAgICBkaXNwbGF5ZWRJbmRleCA9IGl0ZW1zLmNoaWxkcmVuWzBdLnNhdmU7CiAgICAgICAgc2F2ZUluZGV4ID0gMSAtIGRpc3BsYXllZEluZGV4OwogICAgICB9CiAgICAgIGNvbnN0IGRpc3BsYXllZCA9IGl0ZW1zLmNoaWxkcmVuW2Rpc3BsYXllZEluZGV4XVskdG9IVE1MXSgpLmh0bWw7CiAgICAgIGNvbnN0IHZhbHVlcyA9IGl0ZW1zLmNoaWxkcmVuW3NhdmVJbmRleF1bJHRvSFRNTF0oKS5odG1sOwogICAgICBsZXQgc2VsZWN0ZWQgPSBmYWxzZTsKICAgICAgY29uc3QgdmFsdWUgPSBmaWVsZC52YWx1ZT8uWyR0ZXh0XSgpIHx8ICIiOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBkaXNwbGF5ZWQubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvbnN0IG9wdGlvbiA9IHsKICAgICAgICAgIG5hbWU6ICJvcHRpb24iLAogICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICB2YWx1ZTogdmFsdWVzW2ldIHx8IGRpc3BsYXllZFtpXSwKICAgICAgICAgICAgc3R5bGU6IG9wdGlvblN0eWxlCiAgICAgICAgICB9LAogICAgICAgICAgdmFsdWU6IGRpc3BsYXllZFtpXQogICAgICAgIH07CiAgICAgICAgaWYgKHZhbHVlc1tpXSA9PT0gdmFsdWUpIHsKICAgICAgICAgIG9wdGlvbi5hdHRyaWJ1dGVzLnNlbGVjdGVkID0gc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBjaGlsZHJlbi5wdXNoKG9wdGlvbik7CiAgICAgIH0KICAgICAgaWYgKCFzZWxlY3RlZCkgewogICAgICAgIGNoaWxkcmVuLnNwbGljZSgwLCAwLCB7CiAgICAgICAgICBuYW1lOiAib3B0aW9uIiwKICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgaGlkZGVuOiB0cnVlLAogICAgICAgICAgICBzZWxlY3RlZDogdHJ1ZQogICAgICAgICAgfSwKICAgICAgICAgIHZhbHVlOiAiICIKICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgY29uc3Qgc2VsZWN0QXR0cmlidXRlcyA9IHsKICAgICAgY2xhc3M6IFsieGZhU2VsZWN0Il0sCiAgICAgIGZpZWxkSWQ6IGZpZWxkWyR1aWRdLAogICAgICBkYXRhSWQ6IGZpZWxkWyRkYXRhXT8uWyR1aWRdIHx8IGZpZWxkWyR1aWRdLAogICAgICBzdHlsZSwKICAgICAgImFyaWEtbGFiZWwiOiBhcmlhTGFiZWwoZmllbGQpLAogICAgICAiYXJpYS1yZXF1aXJlZCI6IGZhbHNlCiAgICB9OwogICAgaWYgKGlzUmVxdWlyZWQoZmllbGQpKSB7CiAgICAgIHNlbGVjdEF0dHJpYnV0ZXNbImFyaWEtcmVxdWlyZWQiXSA9IHRydWU7CiAgICAgIHNlbGVjdEF0dHJpYnV0ZXMucmVxdWlyZWQgPSB0cnVlOwogICAgfQogICAgaWYgKHRoaXMub3BlbiA9PT0gIm11bHRpU2VsZWN0IikgewogICAgICBzZWxlY3RBdHRyaWJ1dGVzLm11bHRpcGxlID0gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAibGFiZWwiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IFsieGZhTGFiZWwiXQogICAgICB9LAogICAgICBjaGlsZHJlbjogW3sKICAgICAgICBuYW1lOiAic2VsZWN0IiwKICAgICAgICBjaGlsZHJlbiwKICAgICAgICBhdHRyaWJ1dGVzOiBzZWxlY3RBdHRyaWJ1dGVzCiAgICAgIH1dCiAgICB9KTsKICB9Cn0KY2xhc3MgQ29sb3IgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY29sb3IiLCB0cnVlKTsKICAgIHRoaXMuY1NwYWNlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuY1NwYWNlLCBbIlNSR0IiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnZhbHVlID0gYXR0cmlidXRlcy52YWx1ZSA/IGdldENvbG9yKGF0dHJpYnV0ZXMudmFsdWUpIDogIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFskaGFzU2V0dGFibGVWYWx1ZV0oKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIFskdG9TdHlsZV0oKSB7CiAgICByZXR1cm4gdGhpcy52YWx1ZSA/IFV0aWwubWFrZUhleENvbG9yKHRoaXMudmFsdWUuciwgdGhpcy52YWx1ZS5nLCB0aGlzLnZhbHVlLmIpIDogbnVsbDsKICB9Cn0KY2xhc3MgQ29tYiBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJjb21iIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubnVtYmVyT2ZDZWxscyA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm51bWJlck9mQ2VsbHMsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIENvbm5lY3QgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY29ubmVjdCIsIHRydWUpOwogICAgdGhpcy5jb25uZWN0aW9uID0gYXR0cmlidXRlcy5jb25uZWN0aW9uIHx8ICIiOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnJlZiA9IGF0dHJpYnV0ZXMucmVmIHx8ICIiOwogICAgdGhpcy51c2FnZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnVzYWdlLCBbImV4cG9ydEFuZEltcG9ydCIsICJleHBvcnRPbmx5IiwgImltcG9ydE9ubHkiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5waWN0dXJlID0gbnVsbDsKICB9Cn0KY2xhc3MgQ29udGVudEFyZWEgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY29udGVudEFyZWEiLCB0cnVlKTsKICAgIHRoaXMuaCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMuaCk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucmVsZXZhbnQgPSBnZXRSZWxldmFudChhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLncgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLncpOwogICAgdGhpcy54ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy54LCAiMHB0Iik7CiAgICB0aGlzLnkgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnksICIwcHQiKTsKICAgIHRoaXMuZGVzYyA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgY29uc3QgbGVmdCA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLngpOwogICAgY29uc3QgdG9wID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMueSk7CiAgICBjb25zdCBzdHlsZSA9IHsKICAgICAgbGVmdCwKICAgICAgdG9wLAogICAgICB3aWR0aDogbWVhc3VyZVRvU3RyaW5nKHRoaXMudyksCiAgICAgIGhlaWdodDogbWVhc3VyZVRvU3RyaW5nKHRoaXMuaCkKICAgIH07CiAgICBjb25zdCBjbGFzc05hbWVzID0gWyJ4ZmFDb250ZW50YXJlYSJdOwogICAgaWYgKGlzUHJpbnRPbmx5KHRoaXMpKSB7CiAgICAgIGNsYXNzTmFtZXMucHVzaCgieGZhUHJpbnRPbmx5Iik7CiAgICB9CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIHN0eWxlLAogICAgICAgIGNsYXNzOiBjbGFzc05hbWVzLAogICAgICAgIGlkOiB0aGlzWyR1aWRdCiAgICAgIH0KICAgIH0pOwogIH0KfQpjbGFzcyBDb3JuZXIgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY29ybmVyIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMuaW52ZXJ0ZWQgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5pbnZlcnRlZCwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMuam9pbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmpvaW4sIFsic3F1YXJlIiwgInJvdW5kIl0pOwogICAgdGhpcy5wcmVzZW5jZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnByZXNlbmNlLCBbInZpc2libGUiLCAiaGlkZGVuIiwgImluYWN0aXZlIiwgImludmlzaWJsZSJdKTsKICAgIHRoaXMucmFkaXVzID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5yYWRpdXMpOwogICAgdGhpcy5zdHJva2UgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5zdHJva2UsIFsic29saWQiLCAiZGFzaERvdCIsICJkYXNoRG90RG90IiwgImRhc2hlZCIsICJkb3R0ZWQiLCAiZW1ib3NzZWQiLCAiZXRjaGVkIiwgImxvd2VyZWQiLCAicmFpc2VkIl0pOwogICAgdGhpcy50aGlja25lc3MgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnRoaWNrbmVzcywgIjAuNXB0Iik7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jb2xvciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFskdG9TdHlsZV0oKSB7CiAgICBjb25zdCBzdHlsZSA9IHRvU3R5bGUodGhpcywgInZpc2liaWxpdHkiKTsKICAgIHN0eWxlLnJhZGl1cyA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLmpvaW4gPT09ICJzcXVhcmUiID8gMCA6IHRoaXMucmFkaXVzKTsKICAgIHJldHVybiBzdHlsZTsKICB9Cn0KY2xhc3MgRGF0ZUVsZW1lbnQgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImRhdGUiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICBjb25zdCBkYXRlID0gdGhpc1skY29udGVudF0udHJpbSgpOwogICAgdGhpc1skY29udGVudF0gPSBkYXRlID8gbmV3IERhdGUoZGF0ZSkgOiBudWxsOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHJldHVybiB2YWx1ZVRvSHRtbCh0aGlzWyRjb250ZW50XSA/IHRoaXNbJGNvbnRlbnRdLnRvU3RyaW5nKCkgOiAiIik7CiAgfQp9CmNsYXNzIERhdGVUaW1lIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJkYXRlVGltZSIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIGNvbnN0IGRhdGUgPSB0aGlzWyRjb250ZW50XS50cmltKCk7CiAgICB0aGlzWyRjb250ZW50XSA9IGRhdGUgPyBuZXcgRGF0ZShkYXRlKSA6IG51bGw7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgcmV0dXJuIHZhbHVlVG9IdG1sKHRoaXNbJGNvbnRlbnRdID8gdGhpc1skY29udGVudF0udG9TdHJpbmcoKSA6ICIiKTsKICB9Cn0KY2xhc3MgRGF0ZVRpbWVFZGl0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImRhdGVUaW1lRWRpdCIsIHRydWUpOwogICAgdGhpcy5oU2Nyb2xsUG9saWN5ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuaFNjcm9sbFBvbGljeSwgWyJhdXRvIiwgIm9mZiIsICJvbiJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5waWNrZXIgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5waWNrZXIsIFsiaG9zdCIsICJub25lIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9yZGVyID0gbnVsbDsKICAgIHRoaXMuY29tYiA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgY29uc3Qgc3R5bGUgPSB0b1N0eWxlKHRoaXMsICJib3JkZXIiLCAiZm9udCIsICJtYXJnaW4iKTsKICAgIGNvbnN0IGZpZWxkID0gdGhpc1skZ2V0UGFyZW50XSgpWyRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBodG1sID0gewogICAgICBuYW1lOiAiaW5wdXQiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgdHlwZTogInRleHQiLAogICAgICAgIGZpZWxkSWQ6IGZpZWxkWyR1aWRdLAogICAgICAgIGRhdGFJZDogZmllbGRbJGRhdGFdPy5bJHVpZF0gfHwgZmllbGRbJHVpZF0sCiAgICAgICAgY2xhc3M6IFsieGZhVGV4dGZpZWxkIl0sCiAgICAgICAgc3R5bGUsCiAgICAgICAgImFyaWEtbGFiZWwiOiBhcmlhTGFiZWwoZmllbGQpLAogICAgICAgICJhcmlhLXJlcXVpcmVkIjogZmFsc2UKICAgICAgfQogICAgfTsKICAgIGlmIChpc1JlcXVpcmVkKGZpZWxkKSkgewogICAgICBodG1sLmF0dHJpYnV0ZXNbImFyaWEtcmVxdWlyZWQiXSA9IHRydWU7CiAgICAgIGh0bWwuYXR0cmlidXRlcy5yZXF1aXJlZCA9IHRydWU7CiAgICB9CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgbmFtZTogImxhYmVsIiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbInhmYUxhYmVsIl0KICAgICAgfSwKICAgICAgY2hpbGRyZW46IFtodG1sXQogICAgfSk7CiAgfQp9CmNsYXNzIERlY2ltYWwgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImRlY2ltYWwiKTsKICAgIHRoaXMuZnJhY0RpZ2l0cyA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmZyYWNEaWdpdHMsCiAgICAgIGRlZmF1bHRWYWx1ZTogMiwKICAgICAgdmFsaWRhdGU6IHggPT4gdHJ1ZQogICAgfSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubGVhZERpZ2l0cyA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmxlYWREaWdpdHMsCiAgICAgIGRlZmF1bHRWYWx1ZTogLTEsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHRydWUKICAgIH0pOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICBjb25zdCBudW1iZXIgPSBwYXJzZUZsb2F0KHRoaXNbJGNvbnRlbnRdLnRyaW0oKSk7CiAgICB0aGlzWyRjb250ZW50XSA9IGlzTmFOKG51bWJlcikgPyBudWxsIDogbnVtYmVyOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHJldHVybiB2YWx1ZVRvSHRtbCh0aGlzWyRjb250ZW50XSAhPT0gbnVsbCA/IHRoaXNbJGNvbnRlbnRdLnRvU3RyaW5nKCkgOiAiIik7CiAgfQp9CmNsYXNzIERlZmF1bHRVaSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJkZWZhdWx0VWkiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9Cn0KY2xhc3MgRGVzYyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJkZXNjIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmJvb2xlYW4gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGF0ZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlVGltZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kZWNpbWFsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4RGF0YSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5mbG9hdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbWFnZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbnRlZ2VyID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRleHQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGltZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBEaWdlc3RNZXRob2QgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZGlnZXN0TWV0aG9kIiwgWyIiLCAiU0hBMSIsICJTSEEyNTYiLCAiU0hBNTEyIiwgIlJJUEVNRDE2MCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgRGlnZXN0TWV0aG9kcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJkaWdlc3RNZXRob2RzIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5kaWdlc3RNZXRob2QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgRHJhdyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJkcmF3IiwgdHJ1ZSk7CiAgICB0aGlzLmFuY2hvclR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5hbmNob3JUeXBlLCBbInRvcExlZnQiLCAiYm90dG9tQ2VudGVyIiwgImJvdHRvbUxlZnQiLCAiYm90dG9tUmlnaHQiLCAibWlkZGxlQ2VudGVyIiwgIm1pZGRsZUxlZnQiLCAibWlkZGxlUmlnaHQiLCAidG9wQ2VudGVyIiwgInRvcFJpZ2h0Il0pOwogICAgdGhpcy5jb2xTcGFuID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuY29sU3BhbiwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogbiA9PiBuID49IDEgfHwgbiA9PT0gLTEKICAgIH0pOwogICAgdGhpcy5oID0gYXR0cmlidXRlcy5oID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5oKSA6ICIiOwogICAgdGhpcy5oQWxpZ24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oQWxpZ24sIFsibGVmdCIsICJjZW50ZXIiLCAianVzdGlmeSIsICJqdXN0aWZ5QWxsIiwgInJhZGl4IiwgInJpZ2h0Il0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxvY2FsZSA9IGF0dHJpYnV0ZXMubG9jYWxlIHx8ICIiOwogICAgdGhpcy5tYXhIID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5tYXhILCAiMHB0Iik7CiAgICB0aGlzLm1heFcgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1heFcsICIwcHQiKTsKICAgIHRoaXMubWluSCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWluSCwgIjBwdCIpOwogICAgdGhpcy5taW5XID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5taW5XLCAiMHB0Iik7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnByZXNlbmNlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucHJlc2VuY2UsIFsidmlzaWJsZSIsICJoaWRkZW4iLCAiaW5hY3RpdmUiLCAiaW52aXNpYmxlIl0pOwogICAgdGhpcy5yZWxldmFudCA9IGdldFJlbGV2YW50KGF0dHJpYnV0ZXMucmVsZXZhbnQpOwogICAgdGhpcy5yb3RhdGUgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5yb3RhdGUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCAlIDkwID09PSAwCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLncgPSBhdHRyaWJ1dGVzLncgPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLncpIDogIiI7CiAgICB0aGlzLnggPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLngsICIwcHQiKTsKICAgIHRoaXMueSA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMueSwgIjBwdCIpOwogICAgdGhpcy5hc3Npc3QgPSBudWxsOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5jYXB0aW9uID0gbnVsbDsKICAgIHRoaXMuZGVzYyA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLmZvbnQgPSBudWxsOwogICAgdGhpcy5rZWVwID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICAgIHRoaXMucGFyYSA9IG51bGw7CiAgICB0aGlzLnRyYXZlcnNhbCA9IG51bGw7CiAgICB0aGlzLnVpID0gbnVsbDsKICAgIHRoaXMudmFsdWUgPSBudWxsOwogICAgdGhpcy5zZXRQcm9wZXJ0eSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KICBbJHNldFZhbHVlXSh2YWx1ZSkgewogICAgX3NldFZhbHVlKHRoaXMsIHZhbHVlKTsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBzZXRUYWJJbmRleCh0aGlzKTsKICAgIGlmICh0aGlzLnByZXNlbmNlID09PSAiaGlkZGVuIiB8fCB0aGlzLnByZXNlbmNlID09PSAiaW5hY3RpdmUiKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgZml4RGltZW5zaW9ucyh0aGlzKTsKICAgIHRoaXNbJHB1c2hQYXJhXSgpOwogICAgY29uc3Qgc2F2ZWRXID0gdGhpcy53OwogICAgY29uc3Qgc2F2ZWRIID0gdGhpcy5oOwogICAgY29uc3QgewogICAgICB3LAogICAgICBoLAogICAgICBpc0Jyb2tlbgogICAgfSA9IGxheW91dE5vZGUodGhpcywgYXZhaWxhYmxlU3BhY2UpOwogICAgaWYgKHcgJiYgdGhpcy53ID09PSAiIikgewogICAgICBpZiAoaXNCcm9rZW4gJiYgdGhpc1skZ2V0U3ViZm9ybVBhcmVudF0oKVskaXNUaGVyZU1vcmVXaWR0aF0oKSkgewogICAgICAgIHRoaXNbJHBvcFBhcmFdKCk7CiAgICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRkFJTFVSRTsKICAgICAgfQogICAgICB0aGlzLncgPSB3OwogICAgfQogICAgaWYgKGggJiYgdGhpcy5oID09PSAiIikgewogICAgICB0aGlzLmggPSBoOwogICAgfQogICAgc2V0Rmlyc3RVbnNwbGl0dGFibGUodGhpcyk7CiAgICBpZiAoIWNoZWNrRGltZW5zaW9ucyh0aGlzLCBhdmFpbGFibGVTcGFjZSkpIHsKICAgICAgdGhpcy53ID0gc2F2ZWRXOwogICAgICB0aGlzLmggPSBzYXZlZEg7CiAgICAgIHRoaXNbJHBvcFBhcmFdKCk7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkZBSUxVUkU7CiAgICB9CiAgICB1bnNldEZpcnN0VW5zcGxpdHRhYmxlKHRoaXMpOwogICAgY29uc3Qgc3R5bGUgPSB0b1N0eWxlKHRoaXMsICJmb250IiwgImhBbGlnbiIsICJkaW1lbnNpb25zIiwgInBvc2l0aW9uIiwgInByZXNlbmNlIiwgInJvdGF0ZSIsICJhbmNob3JUeXBlIiwgImJvcmRlciIsICJtYXJnaW4iKTsKICAgIHNldE1pbk1heERpbWVuc2lvbnModGhpcywgc3R5bGUpOwogICAgaWYgKHN0eWxlLm1hcmdpbikgewogICAgICBzdHlsZS5wYWRkaW5nID0gc3R5bGUubWFyZ2luOwogICAgICBkZWxldGUgc3R5bGUubWFyZ2luOwogICAgfQogICAgY29uc3QgY2xhc3NOYW1lcyA9IFsieGZhRHJhdyJdOwogICAgaWYgKHRoaXMuZm9udCkgewogICAgICBjbGFzc05hbWVzLnB1c2goInhmYUZvbnQiKTsKICAgIH0KICAgIGlmIChpc1ByaW50T25seSh0aGlzKSkgewogICAgICBjbGFzc05hbWVzLnB1c2goInhmYVByaW50T25seSIpOwogICAgfQogICAgY29uc3QgYXR0cmlidXRlcyA9IHsKICAgICAgc3R5bGUsCiAgICAgIGlkOiB0aGlzWyR1aWRdLAogICAgICBjbGFzczogY2xhc3NOYW1lcwogICAgfTsKICAgIGlmICh0aGlzLm5hbWUpIHsKICAgICAgYXR0cmlidXRlcy54ZmFOYW1lID0gdGhpcy5uYW1lOwogICAgfQogICAgY29uc3QgaHRtbCA9IHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGF0dHJpYnV0ZXMsCiAgICAgIGNoaWxkcmVuOiBbXQogICAgfTsKICAgIGFwcGx5QXNzaXN0KHRoaXMsIGF0dHJpYnV0ZXMpOwogICAgY29uc3QgYmJveCA9IGNvbXB1dGVCYm94KHRoaXMsIGh0bWwsIGF2YWlsYWJsZVNwYWNlKTsKICAgIGNvbnN0IHZhbHVlID0gdGhpcy52YWx1ZSA/IHRoaXMudmFsdWVbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpLmh0bWwgOiBudWxsOwogICAgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICAgIHRoaXMudyA9IHNhdmVkVzsKICAgICAgdGhpcy5oID0gc2F2ZWRIOwogICAgICB0aGlzWyRwb3BQYXJhXSgpOwogICAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKGNyZWF0ZVdyYXBwZXIodGhpcywgaHRtbCksIGJib3gpOwogICAgfQogICAgaHRtbC5jaGlsZHJlbi5wdXNoKHZhbHVlKTsKICAgIHNldFBhcmEodGhpcywgc3R5bGUsIHZhbHVlKTsKICAgIHRoaXMudyA9IHNhdmVkVzsKICAgIHRoaXMuaCA9IHNhdmVkSDsKICAgIHRoaXNbJHBvcFBhcmFdKCk7CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKGNyZWF0ZVdyYXBwZXIodGhpcywgaHRtbCksIGJib3gpOwogIH0KfQpjbGFzcyBFZGdlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImVkZ2UiLCB0cnVlKTsKICAgIHRoaXMuY2FwID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuY2FwLCBbInNxdWFyZSIsICJidXR0IiwgInJvdW5kIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnByZXNlbmNlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucHJlc2VuY2UsIFsidmlzaWJsZSIsICJoaWRkZW4iLCAiaW5hY3RpdmUiLCAiaW52aXNpYmxlIl0pOwogICAgdGhpcy5zdHJva2UgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5zdHJva2UsIFsic29saWQiLCAiZGFzaERvdCIsICJkYXNoRG90RG90IiwgImRhc2hlZCIsICJkb3R0ZWQiLCAiZW1ib3NzZWQiLCAiZXRjaGVkIiwgImxvd2VyZWQiLCAicmFpc2VkIl0pOwogICAgdGhpcy50aGlja25lc3MgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnRoaWNrbmVzcywgIjAuNXB0Iik7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jb2xvciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFskdG9TdHlsZV0oKSB7CiAgICBjb25zdCBzdHlsZSA9IHRvU3R5bGUodGhpcywgInZpc2liaWxpdHkiKTsKICAgIE9iamVjdC5hc3NpZ24oc3R5bGUsIHsKICAgICAgbGluZWNhcDogdGhpcy5jYXAsCiAgICAgIHdpZHRoOiBtZWFzdXJlVG9TdHJpbmcodGhpcy50aGlja25lc3MpLAogICAgICBjb2xvcjogdGhpcy5jb2xvciA/IHRoaXMuY29sb3JbJHRvU3R5bGVdKCkgOiAiIzAwMDAwMCIsCiAgICAgIHN0eWxlOiAiIgogICAgfSk7CiAgICBpZiAodGhpcy5wcmVzZW5jZSAhPT0gInZpc2libGUiKSB7CiAgICAgIHN0eWxlLnN0eWxlID0gIm5vbmUiOwogICAgfSBlbHNlIHsKICAgICAgc3dpdGNoICh0aGlzLnN0cm9rZSkgewogICAgICAgIGNhc2UgInNvbGlkIjoKICAgICAgICAgIHN0eWxlLnN0eWxlID0gInNvbGlkIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImRhc2hEb3QiOgogICAgICAgICAgc3R5bGUuc3R5bGUgPSAiZGFzaGVkIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImRhc2hEb3REb3QiOgogICAgICAgICAgc3R5bGUuc3R5bGUgPSAiZGFzaGVkIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImRhc2hlZCI6CiAgICAgICAgICBzdHlsZS5zdHlsZSA9ICJkYXNoZWQiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZG90dGVkIjoKICAgICAgICAgIHN0eWxlLnN0eWxlID0gImRvdHRlZCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJlbWJvc3NlZCI6CiAgICAgICAgICBzdHlsZS5zdHlsZSA9ICJyaWRnZSI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJldGNoZWQiOgogICAgICAgICAgc3R5bGUuc3R5bGUgPSAiZ3Jvb3ZlIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImxvd2VyZWQiOgogICAgICAgICAgc3R5bGUuc3R5bGUgPSAiaW5zZXQiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicmFpc2VkIjoKICAgICAgICAgIHN0eWxlLnN0eWxlID0gIm91dHNldCI7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHN0eWxlOwogIH0KfQpjbGFzcyBFbmNvZGluZyBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJlbmNvZGluZyIsIFsiYWRiZS54NTA5LnJzYV9zaGExIiwgImFkYmUucGtjczcuZGV0YWNoZWQiLCAiYWRiZS5wa2NzNy5zaGExIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBFbmNvZGluZ3MgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZW5jb2RpbmdzIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5lbmNvZGluZyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBFbmNyeXB0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImVuY3J5cHQiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY2VydGlmaWNhdGUgPSBudWxsOwogIH0KfQpjbGFzcyBFbmNyeXB0RGF0YSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJlbmNyeXB0RGF0YSIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm9wZXJhdGlvbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm9wZXJhdGlvbiwgWyJlbmNyeXB0IiwgImRlY3J5cHQiXSk7CiAgICB0aGlzLnRhcmdldCA9IGF0dHJpYnV0ZXMudGFyZ2V0IHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZmlsdGVyID0gbnVsbDsKICAgIHRoaXMubWFuaWZlc3QgPSBudWxsOwogIH0KfQpjbGFzcyBFbmNyeXB0aW9uIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImVuY3J5cHRpb24iLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNlcnRpZmljYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIEVuY3J5cHRpb25NZXRob2QgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZW5jcnlwdGlvbk1ldGhvZCIsIFsiIiwgIkFFUzI1Ni1DQkMiLCAiVFJJUExFREVTLUNCQyIsICJBRVMxMjgtQ0JDIiwgIkFFUzE5Mi1DQkMiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIEVuY3J5cHRpb25NZXRob2RzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImVuY3J5cHRpb25NZXRob2RzIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5lbmNyeXB0aW9uTWV0aG9kID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIEV2ZW50IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImV2ZW50IiwgdHJ1ZSk7CiAgICB0aGlzLmFjdGl2aXR5ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuYWN0aXZpdHksIFsiY2xpY2siLCAiY2hhbmdlIiwgImRvY0Nsb3NlIiwgImRvY1JlYWR5IiwgImVudGVyIiwgImV4aXQiLCAiZnVsbCIsICJpbmRleENoYW5nZSIsICJpbml0aWFsaXplIiwgIm1vdXNlRG93biIsICJtb3VzZUVudGVyIiwgIm1vdXNlRXhpdCIsICJtb3VzZVVwIiwgInBvc3RFeGVjdXRlIiwgInBvc3RPcGVuIiwgInBvc3RQcmludCIsICJwb3N0U2F2ZSIsICJwb3N0U2lnbiIsICJwb3N0U3VibWl0IiwgInByZUV4ZWN1dGUiLCAicHJlT3BlbiIsICJwcmVQcmludCIsICJwcmVTYXZlIiwgInByZVNpZ24iLCAicHJlU3VibWl0IiwgInJlYWR5IiwgInZhbGlkYXRpb25TdGF0ZSJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5saXN0ZW4gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5saXN0ZW4sIFsicmVmT25seSIsICJyZWZBbmREZXNjZW5kZW50cyJdKTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucmVmID0gYXR0cmlidXRlcy5yZWYgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5lbmNyeXB0RGF0YSA9IG51bGw7CiAgICB0aGlzLmV4ZWN1dGUgPSBudWxsOwogICAgdGhpcy5zY3JpcHQgPSBudWxsOwogICAgdGhpcy5zaWduRGF0YSA9IG51bGw7CiAgICB0aGlzLnN1Ym1pdCA9IG51bGw7CiAgfQp9CmNsYXNzIEV4RGF0YSBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZXhEYXRhIik7CiAgICB0aGlzLmNvbnRlbnRUeXBlID0gYXR0cmlidXRlcy5jb250ZW50VHlwZSB8fCAiIjsKICAgIHRoaXMuaHJlZiA9IGF0dHJpYnV0ZXMuaHJlZiB8fCAiIjsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5tYXhMZW5ndGggPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5tYXhMZW5ndGgsCiAgICAgIGRlZmF1bHRWYWx1ZTogLTEsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gLTEKICAgIH0pOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5yaWQgPSBhdHRyaWJ1dGVzLnJpZCB8fCAiIjsKICAgIHRoaXMudHJhbnNmZXJFbmNvZGluZyA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnRyYW5zZmVyRW5jb2RpbmcsIFsibm9uZSIsICJiYXNlNjQiLCAicGFja2FnZSJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFskaXNDREFUQVhtbF0oKSB7CiAgICByZXR1cm4gdGhpcy5jb250ZW50VHlwZSA9PT0gInRleHQvaHRtbCI7CiAgfQogIFskb25DaGlsZF0oY2hpbGQpIHsKICAgIGlmICh0aGlzLmNvbnRlbnRUeXBlID09PSAidGV4dC9odG1sIiAmJiBjaGlsZFskbmFtZXNwYWNlSWRdID09PSBOYW1lc3BhY2VJZHMueGh0bWwuaWQpIHsKICAgICAgdGhpc1skY29udGVudF0gPSBjaGlsZDsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAodGhpcy5jb250ZW50VHlwZSA9PT0gInRleHQveG1sIikgewogICAgICB0aGlzWyRjb250ZW50XSA9IGNoaWxkOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBpZiAodGhpcy5jb250ZW50VHlwZSAhPT0gInRleHQvaHRtbCIgfHwgIXRoaXNbJGNvbnRlbnRdKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgcmV0dXJuIHRoaXNbJGNvbnRlbnRdWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKTsKICB9Cn0KY2xhc3MgRXhPYmplY3QgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZXhPYmplY3QiLCB0cnVlKTsKICAgIHRoaXMuYXJjaGl2ZSA9IGF0dHJpYnV0ZXMuYXJjaGl2ZSB8fCAiIjsKICAgIHRoaXMuY2xhc3NJZCA9IGF0dHJpYnV0ZXMuY2xhc3NJZCB8fCAiIjsKICAgIHRoaXMuY29kZUJhc2UgPSBhdHRyaWJ1dGVzLmNvZGVCYXNlIHx8ICIiOwogICAgdGhpcy5jb2RlVHlwZSA9IGF0dHJpYnV0ZXMuY29kZVR5cGUgfHwgIiI7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLmJvb2xlYW4gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGF0ZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlVGltZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kZWNpbWFsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4RGF0YSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leE9iamVjdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5mbG9hdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbWFnZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbnRlZ2VyID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRleHQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGltZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBFeGNsR3JvdXAgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZXhjbEdyb3VwIiwgdHJ1ZSk7CiAgICB0aGlzLmFjY2VzcyA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmFjY2VzcywgWyJvcGVuIiwgIm5vbkludGVyYWN0aXZlIiwgInByb3RlY3RlZCIsICJyZWFkT25seSJdKTsKICAgIHRoaXMuYWNjZXNzS2V5ID0gYXR0cmlidXRlcy5hY2Nlc3NLZXkgfHwgIiI7CiAgICB0aGlzLmFuY2hvclR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5hbmNob3JUeXBlLCBbInRvcExlZnQiLCAiYm90dG9tQ2VudGVyIiwgImJvdHRvbUxlZnQiLCAiYm90dG9tUmlnaHQiLCAibWlkZGxlQ2VudGVyIiwgIm1pZGRsZUxlZnQiLCAibWlkZGxlUmlnaHQiLCAidG9wQ2VudGVyIiwgInRvcFJpZ2h0Il0pOwogICAgdGhpcy5jb2xTcGFuID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuY29sU3BhbiwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogbiA9PiBuID49IDEgfHwgbiA9PT0gLTEKICAgIH0pOwogICAgdGhpcy5oID0gYXR0cmlidXRlcy5oID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5oKSA6ICIiOwogICAgdGhpcy5oQWxpZ24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oQWxpZ24sIFsibGVmdCIsICJjZW50ZXIiLCAianVzdGlmeSIsICJqdXN0aWZ5QWxsIiwgInJhZGl4IiwgInJpZ2h0Il0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxheW91dCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmxheW91dCwgWyJwb3NpdGlvbiIsICJsci10YiIsICJybC1yb3ciLCAicmwtdGIiLCAicm93IiwgInRhYmxlIiwgInRiIl0pOwogICAgdGhpcy5tYXhIID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5tYXhILCAiMHB0Iik7CiAgICB0aGlzLm1heFcgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1heFcsICIwcHQiKTsKICAgIHRoaXMubWluSCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWluSCwgIjBwdCIpOwogICAgdGhpcy5taW5XID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5taW5XLCAiMHB0Iik7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnByZXNlbmNlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucHJlc2VuY2UsIFsidmlzaWJsZSIsICJoaWRkZW4iLCAiaW5hY3RpdmUiLCAiaW52aXNpYmxlIl0pOwogICAgdGhpcy5yZWxldmFudCA9IGdldFJlbGV2YW50KGF0dHJpYnV0ZXMucmVsZXZhbnQpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudyA9IGF0dHJpYnV0ZXMudyA/IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMudykgOiAiIjsKICAgIHRoaXMueCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMueCwgIjBwdCIpOwogICAgdGhpcy55ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy55LCAiMHB0Iik7CiAgICB0aGlzLmFzc2lzdCA9IG51bGw7CiAgICB0aGlzLmJpbmQgPSBudWxsOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5jYWxjdWxhdGUgPSBudWxsOwogICAgdGhpcy5jYXB0aW9uID0gbnVsbDsKICAgIHRoaXMuZGVzYyA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgICB0aGlzLnBhcmEgPSBudWxsOwogICAgdGhpcy50cmF2ZXJzYWwgPSBudWxsOwogICAgdGhpcy52YWxpZGF0ZSA9IG51bGw7CiAgICB0aGlzLmNvbm5lY3QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXZlbnQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmllbGQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2V0UHJvcGVydHkgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9CiAgWyRpc0JpbmRhYmxlXSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBbJGhhc1NldHRhYmxlVmFsdWVdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIFskc2V0VmFsdWVdKHZhbHVlKSB7CiAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIHRoaXMuZmllbGQuY2hpbGRyZW4pIHsKICAgICAgaWYgKCFmaWVsZC52YWx1ZSkgewogICAgICAgIGNvbnN0IG5vZGVWYWx1ZSA9IG5ldyBWYWx1ZSh7fSk7CiAgICAgICAgZmllbGRbJGFwcGVuZENoaWxkXShub2RlVmFsdWUpOwogICAgICAgIGZpZWxkLnZhbHVlID0gbm9kZVZhbHVlOwogICAgICB9CiAgICAgIGZpZWxkLnZhbHVlWyRzZXRWYWx1ZV0odmFsdWUpOwogICAgfQogIH0KICBbJGlzVGhlcmVNb3JlV2lkdGhdKCkgewogICAgcmV0dXJuIHRoaXMubGF5b3V0LmVuZHNXaXRoKCItdGIiKSAmJiB0aGlzWyRleHRyYV0uYXR0ZW1wdCA9PT0gMCAmJiB0aGlzWyRleHRyYV0ubnVtYmVySW5MaW5lID4gMCB8fCB0aGlzWyRnZXRQYXJlbnRdKClbJGlzVGhlcmVNb3JlV2lkdGhdKCk7CiAgfQogIFskaXNTcGxpdHRhYmxlXSgpIHsKICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgICBpZiAoIXBhcmVudFskaXNTcGxpdHRhYmxlXSgpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzWyRleHRyYV0uX2lzU3BsaXR0YWJsZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiB0aGlzWyRleHRyYV0uX2lzU3BsaXR0YWJsZTsKICAgIH0KICAgIGlmICh0aGlzLmxheW91dCA9PT0gInBvc2l0aW9uIiB8fCB0aGlzLmxheW91dC5pbmNsdWRlcygicm93IikpIHsKICAgICAgdGhpc1skZXh0cmFdLl9pc1NwbGl0dGFibGUgPSBmYWxzZTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHBhcmVudC5sYXlvdXQ/LmVuZHNXaXRoKCItdGIiKSAmJiBwYXJlbnRbJGV4dHJhXS5udW1iZXJJbkxpbmUgIT09IDApIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdGhpc1skZXh0cmFdLl9pc1NwbGl0dGFibGUgPSB0cnVlOwogICAgcmV0dXJuIHRydWU7CiAgfQogIFskZmx1c2hIVE1MXSgpIHsKICAgIHJldHVybiBmbHVzaEhUTUwodGhpcyk7CiAgfQogIFskYWRkSFRNTF0oaHRtbCwgYmJveCkgewogICAgYWRkSFRNTCh0aGlzLCBodG1sLCBiYm94KTsKICB9CiAgWyRnZXRBdmFpbGFibGVTcGFjZV0oKSB7CiAgICByZXR1cm4gZ2V0QXZhaWxhYmxlU3BhY2UodGhpcyk7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgc2V0VGFiSW5kZXgodGhpcyk7CiAgICBpZiAodGhpcy5wcmVzZW5jZSA9PT0gImhpZGRlbiIgfHwgdGhpcy5wcmVzZW5jZSA9PT0gImluYWN0aXZlIiB8fCB0aGlzLmggPT09IDAgfHwgdGhpcy53ID09PSAwKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgZml4RGltZW5zaW9ucyh0aGlzKTsKICAgIGNvbnN0IGNoaWxkcmVuID0gW107CiAgICBjb25zdCBhdHRyaWJ1dGVzID0gewogICAgICBpZDogdGhpc1skdWlkXSwKICAgICAgY2xhc3M6IFtdCiAgICB9OwogICAgc2V0QWNjZXNzKHRoaXMsIGF0dHJpYnV0ZXMuY2xhc3MpOwogICAgdGhpc1skZXh0cmFdIHx8PSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgT2JqZWN0LmFzc2lnbih0aGlzWyRleHRyYV0sIHsKICAgICAgY2hpbGRyZW4sCiAgICAgIGF0dHJpYnV0ZXMsCiAgICAgIGF0dGVtcHQ6IDAsCiAgICAgIGxpbmU6IG51bGwsCiAgICAgIG51bWJlckluTGluZTogMCwKICAgICAgYXZhaWxhYmxlU3BhY2U6IHsKICAgICAgICB3aWR0aDogTWF0aC5taW4odGhpcy53IHx8IEluZmluaXR5LCBhdmFpbGFibGVTcGFjZS53aWR0aCksCiAgICAgICAgaGVpZ2h0OiBNYXRoLm1pbih0aGlzLmggfHwgSW5maW5pdHksIGF2YWlsYWJsZVNwYWNlLmhlaWdodCkKICAgICAgfSwKICAgICAgd2lkdGg6IDAsCiAgICAgIGhlaWdodDogMCwKICAgICAgcHJldkhlaWdodDogMCwKICAgICAgY3VycmVudFdpZHRoOiAwCiAgICB9KTsKICAgIGNvbnN0IGlzU3BsaXR0YWJsZSA9IHRoaXNbJGlzU3BsaXR0YWJsZV0oKTsKICAgIGlmICghaXNTcGxpdHRhYmxlKSB7CiAgICAgIHNldEZpcnN0VW5zcGxpdHRhYmxlKHRoaXMpOwogICAgfQogICAgaWYgKCFjaGVja0RpbWVuc2lvbnModGhpcywgYXZhaWxhYmxlU3BhY2UpKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkZBSUxVUkU7CiAgICB9CiAgICBjb25zdCBmaWx0ZXIgPSBuZXcgU2V0KFsiZmllbGQiXSk7CiAgICBpZiAodGhpcy5sYXlvdXQuaW5jbHVkZXMoInJvdyIpKSB7CiAgICAgIGNvbnN0IGNvbHVtbldpZHRocyA9IHRoaXNbJGdldFN1YmZvcm1QYXJlbnRdKCkuY29sdW1uV2lkdGhzOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShjb2x1bW5XaWR0aHMpICYmIGNvbHVtbldpZHRocy5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpc1skZXh0cmFdLmNvbHVtbldpZHRocyA9IGNvbHVtbldpZHRoczsKICAgICAgICB0aGlzWyRleHRyYV0uY3VycmVudENvbHVtbiA9IDA7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAiYW5jaG9yVHlwZSIsICJkaW1lbnNpb25zIiwgInBvc2l0aW9uIiwgInByZXNlbmNlIiwgImJvcmRlciIsICJtYXJnaW4iLCAiaEFsaWduIik7CiAgICBjb25zdCBjbGFzc05hbWVzID0gWyJ4ZmFFeGNsZ3JvdXAiXTsKICAgIGNvbnN0IGNsID0gbGF5b3V0Q2xhc3ModGhpcyk7CiAgICBpZiAoY2wpIHsKICAgICAgY2xhc3NOYW1lcy5wdXNoKGNsKTsKICAgIH0KICAgIGlmIChpc1ByaW50T25seSh0aGlzKSkgewogICAgICBjbGFzc05hbWVzLnB1c2goInhmYVByaW50T25seSIpOwogICAgfQogICAgYXR0cmlidXRlcy5zdHlsZSA9IHN0eWxlOwogICAgYXR0cmlidXRlcy5jbGFzcyA9IGNsYXNzTmFtZXM7CiAgICBpZiAodGhpcy5uYW1lKSB7CiAgICAgIGF0dHJpYnV0ZXMueGZhTmFtZSA9IHRoaXMubmFtZTsKICAgIH0KICAgIHRoaXNbJHB1c2hQYXJhXSgpOwogICAgY29uc3QgaXNMclRiID0gdGhpcy5sYXlvdXQgPT09ICJsci10YiIgfHwgdGhpcy5sYXlvdXQgPT09ICJybC10YiI7CiAgICBjb25zdCBtYXhSdW4gPSBpc0xyVGIgPyBNQVhfQVRURU1QVFNfRk9SX0xSVEJfTEFZT1VUIDogMTsKICAgIGZvciAoOyB0aGlzWyRleHRyYV0uYXR0ZW1wdCA8IG1heFJ1bjsgdGhpc1skZXh0cmFdLmF0dGVtcHQrKykgewogICAgICBpZiAoaXNMclRiICYmIHRoaXNbJGV4dHJhXS5hdHRlbXB0ID09PSBNQVhfQVRURU1QVFNfRk9SX0xSVEJfTEFZT1VUIC0gMSkgewogICAgICAgIHRoaXNbJGV4dHJhXS5udW1iZXJJbkxpbmUgPSAwOwogICAgICB9CiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXNbJGNoaWxkcmVuVG9IVE1MXSh7CiAgICAgICAgZmlsdGVyLAogICAgICAgIGluY2x1ZGU6IHRydWUKICAgICAgfSk7CiAgICAgIGlmIChyZXN1bHQuc3VjY2VzcykgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmIChyZXN1bHQuaXNCcmVhaygpKSB7CiAgICAgICAgdGhpc1skcG9wUGFyYV0oKTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIGlmIChpc0xyVGIgJiYgdGhpc1skZXh0cmFdLmF0dGVtcHQgPT09IDAgJiYgdGhpc1skZXh0cmFdLm51bWJlckluTGluZSA9PT0gMCAmJiAhdGhpc1skZ2V0VGVtcGxhdGVSb290XSgpWyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlKSB7CiAgICAgICAgdGhpc1skZXh0cmFdLmF0dGVtcHQgPSBtYXhSdW47CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHRoaXNbJHBvcFBhcmFdKCk7CiAgICBpZiAoIWlzU3BsaXR0YWJsZSkgewogICAgICB1bnNldEZpcnN0VW5zcGxpdHRhYmxlKHRoaXMpOwogICAgfQogICAgaWYgKHRoaXNbJGV4dHJhXS5hdHRlbXB0ID09PSBtYXhSdW4pIHsKICAgICAgaWYgKCFpc1NwbGl0dGFibGUpIHsKICAgICAgICBkZWxldGUgdGhpc1skZXh0cmFdOwogICAgICB9CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkZBSUxVUkU7CiAgICB9CiAgICBsZXQgbWFyZ2luSCA9IDA7CiAgICBsZXQgbWFyZ2luViA9IDA7CiAgICBpZiAodGhpcy5tYXJnaW4pIHsKICAgICAgbWFyZ2luSCA9IHRoaXMubWFyZ2luLmxlZnRJbnNldCArIHRoaXMubWFyZ2luLnJpZ2h0SW5zZXQ7CiAgICAgIG1hcmdpblYgPSB0aGlzLm1hcmdpbi50b3BJbnNldCArIHRoaXMubWFyZ2luLmJvdHRvbUluc2V0OwogICAgfQogICAgY29uc3Qgd2lkdGggPSBNYXRoLm1heCh0aGlzWyRleHRyYV0ud2lkdGggKyBtYXJnaW5ILCB0aGlzLncgfHwgMCk7CiAgICBjb25zdCBoZWlnaHQgPSBNYXRoLm1heCh0aGlzWyRleHRyYV0uaGVpZ2h0ICsgbWFyZ2luViwgdGhpcy5oIHx8IDApOwogICAgY29uc3QgYmJveCA9IFt0aGlzLngsIHRoaXMueSwgd2lkdGgsIGhlaWdodF07CiAgICBpZiAodGhpcy53ID09PSAiIikgewogICAgICBzdHlsZS53aWR0aCA9IG1lYXN1cmVUb1N0cmluZyh3aWR0aCk7CiAgICB9CiAgICBpZiAodGhpcy5oID09PSAiIikgewogICAgICBzdHlsZS5oZWlnaHQgPSBtZWFzdXJlVG9TdHJpbmcoaGVpZ2h0KTsKICAgIH0KICAgIGNvbnN0IGh0bWwgPSB7CiAgICAgIG5hbWU6ICJkaXYiLAogICAgICBhdHRyaWJ1dGVzLAogICAgICBjaGlsZHJlbgogICAgfTsKICAgIGFwcGx5QXNzaXN0KHRoaXMsIGF0dHJpYnV0ZXMpOwogICAgZGVsZXRlIHRoaXNbJGV4dHJhXTsKICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoY3JlYXRlV3JhcHBlcih0aGlzLCBodG1sKSwgYmJveCk7CiAgfQp9CmNsYXNzIEV4ZWN1dGUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZXhlY3V0ZSIpOwogICAgdGhpcy5jb25uZWN0aW9uID0gYXR0cmlidXRlcy5jb25uZWN0aW9uIHx8ICIiOwogICAgdGhpcy5leGVjdXRlVHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmV4ZWN1dGVUeXBlLCBbImltcG9ydCIsICJyZW1lcmdlIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnJ1bkF0ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucnVuQXQsIFsiY2xpZW50IiwgImJvdGgiLCAic2VydmVyIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgRXh0cmFzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImV4dHJhcyIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib29sZWFuID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGF0ZVRpbWUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGVjaW1hbCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leERhdGEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXh0cmFzID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmZsb2F0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmltYWdlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmludGVnZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGV4dCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50aW1lID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIEZpZWxkIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImZpZWxkIiwgdHJ1ZSk7CiAgICB0aGlzLmFjY2VzcyA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmFjY2VzcywgWyJvcGVuIiwgIm5vbkludGVyYWN0aXZlIiwgInByb3RlY3RlZCIsICJyZWFkT25seSJdKTsKICAgIHRoaXMuYWNjZXNzS2V5ID0gYXR0cmlidXRlcy5hY2Nlc3NLZXkgfHwgIiI7CiAgICB0aGlzLmFuY2hvclR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5hbmNob3JUeXBlLCBbInRvcExlZnQiLCAiYm90dG9tQ2VudGVyIiwgImJvdHRvbUxlZnQiLCAiYm90dG9tUmlnaHQiLCAibWlkZGxlQ2VudGVyIiwgIm1pZGRsZUxlZnQiLCAibWlkZGxlUmlnaHQiLCAidG9wQ2VudGVyIiwgInRvcFJpZ2h0Il0pOwogICAgdGhpcy5jb2xTcGFuID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuY29sU3BhbiwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogbiA9PiBuID49IDEgfHwgbiA9PT0gLTEKICAgIH0pOwogICAgdGhpcy5oID0gYXR0cmlidXRlcy5oID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5oKSA6ICIiOwogICAgdGhpcy5oQWxpZ24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oQWxpZ24sIFsibGVmdCIsICJjZW50ZXIiLCAianVzdGlmeSIsICJqdXN0aWZ5QWxsIiwgInJhZGl4IiwgInJpZ2h0Il0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxvY2FsZSA9IGF0dHJpYnV0ZXMubG9jYWxlIHx8ICIiOwogICAgdGhpcy5tYXhIID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5tYXhILCAiMHB0Iik7CiAgICB0aGlzLm1heFcgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1heFcsICIwcHQiKTsKICAgIHRoaXMubWluSCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWluSCwgIjBwdCIpOwogICAgdGhpcy5taW5XID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5taW5XLCAiMHB0Iik7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnByZXNlbmNlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucHJlc2VuY2UsIFsidmlzaWJsZSIsICJoaWRkZW4iLCAiaW5hY3RpdmUiLCAiaW52aXNpYmxlIl0pOwogICAgdGhpcy5yZWxldmFudCA9IGdldFJlbGV2YW50KGF0dHJpYnV0ZXMucmVsZXZhbnQpOwogICAgdGhpcy5yb3RhdGUgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5yb3RhdGUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCAlIDkwID09PSAwCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLncgPSBhdHRyaWJ1dGVzLncgPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLncpIDogIiI7CiAgICB0aGlzLnggPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLngsICIwcHQiKTsKICAgIHRoaXMueSA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMueSwgIjBwdCIpOwogICAgdGhpcy5hc3Npc3QgPSBudWxsOwogICAgdGhpcy5iaW5kID0gbnVsbDsKICAgIHRoaXMuYm9yZGVyID0gbnVsbDsKICAgIHRoaXMuY2FsY3VsYXRlID0gbnVsbDsKICAgIHRoaXMuY2FwdGlvbiA9IG51bGw7CiAgICB0aGlzLmRlc2MgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5mb250ID0gbnVsbDsKICAgIHRoaXMuZm9ybWF0ID0gbnVsbDsKICAgIHRoaXMuaXRlbXMgPSBuZXcgWEZBT2JqZWN0QXJyYXkoMik7CiAgICB0aGlzLmtlZXAgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogICAgdGhpcy5wYXJhID0gbnVsbDsKICAgIHRoaXMudHJhdmVyc2FsID0gbnVsbDsKICAgIHRoaXMudWkgPSBudWxsOwogICAgdGhpcy52YWxpZGF0ZSA9IG51bGw7CiAgICB0aGlzLnZhbHVlID0gbnVsbDsKICAgIHRoaXMuYmluZEl0ZW1zID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNvbm5lY3QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXZlbnQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2V0UHJvcGVydHkgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9CiAgWyRpc0JpbmRhYmxlXSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBbJHNldFZhbHVlXSh2YWx1ZSkgewogICAgX3NldFZhbHVlKHRoaXMsIHZhbHVlKTsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBzZXRUYWJJbmRleCh0aGlzKTsKICAgIGlmICghdGhpcy51aSkgewogICAgICB0aGlzLnVpID0gbmV3IFVpKHt9KTsKICAgICAgdGhpcy51aVskZ2xvYmFsRGF0YV0gPSB0aGlzWyRnbG9iYWxEYXRhXTsKICAgICAgdGhpc1skYXBwZW5kQ2hpbGRdKHRoaXMudWkpOwogICAgICBsZXQgbm9kZTsKICAgICAgc3dpdGNoICh0aGlzLml0ZW1zLmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIG5vZGUgPSBuZXcgVGV4dEVkaXQoe30pOwogICAgICAgICAgdGhpcy51aS50ZXh0RWRpdCA9IG5vZGU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBub2RlID0gbmV3IENoZWNrQnV0dG9uKHt9KTsKICAgICAgICAgIHRoaXMudWkuY2hlY2tCdXR0b24gPSBub2RlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyOgogICAgICAgICAgbm9kZSA9IG5ldyBDaG9pY2VMaXN0KHt9KTsKICAgICAgICAgIHRoaXMudWkuY2hvaWNlTGlzdCA9IG5vZGU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICB0aGlzLnVpWyRhcHBlbmRDaGlsZF0obm9kZSk7CiAgICB9CiAgICBpZiAoIXRoaXMudWkgfHwgdGhpcy5wcmVzZW5jZSA9PT0gImhpZGRlbiIgfHwgdGhpcy5wcmVzZW5jZSA9PT0gImluYWN0aXZlIiB8fCB0aGlzLmggPT09IDAgfHwgdGhpcy53ID09PSAwKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgaWYgKHRoaXMuY2FwdGlvbikgewogICAgICBkZWxldGUgdGhpcy5jYXB0aW9uWyRleHRyYV07CiAgICB9CiAgICB0aGlzWyRwdXNoUGFyYV0oKTsKICAgIGNvbnN0IGNhcHRpb24gPSB0aGlzLmNhcHRpb24gPyB0aGlzLmNhcHRpb25bJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpLmh0bWwgOiBudWxsOwogICAgY29uc3Qgc2F2ZWRXID0gdGhpcy53OwogICAgY29uc3Qgc2F2ZWRIID0gdGhpcy5oOwogICAgbGV0IG1hcmdpbkggPSAwOwogICAgbGV0IG1hcmdpblYgPSAwOwogICAgaWYgKHRoaXMubWFyZ2luKSB7CiAgICAgIG1hcmdpbkggPSB0aGlzLm1hcmdpbi5sZWZ0SW5zZXQgKyB0aGlzLm1hcmdpbi5yaWdodEluc2V0OwogICAgICBtYXJnaW5WID0gdGhpcy5tYXJnaW4udG9wSW5zZXQgKyB0aGlzLm1hcmdpbi5ib3R0b21JbnNldDsKICAgIH0KICAgIGxldCBib3JkZXJEaW1zID0gbnVsbDsKICAgIGlmICh0aGlzLncgPT09ICIiIHx8IHRoaXMuaCA9PT0gIiIpIHsKICAgICAgbGV0IHdpZHRoID0gbnVsbDsKICAgICAgbGV0IGhlaWdodCA9IG51bGw7CiAgICAgIGxldCB1aVcgPSAwOwogICAgICBsZXQgdWlIID0gMDsKICAgICAgaWYgKHRoaXMudWkuY2hlY2tCdXR0b24pIHsKICAgICAgICB1aVcgPSB1aUggPSB0aGlzLnVpLmNoZWNrQnV0dG9uLnNpemU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgdywKICAgICAgICAgIGgKICAgICAgICB9ID0gbGF5b3V0Tm9kZSh0aGlzLCBhdmFpbGFibGVTcGFjZSk7CiAgICAgICAgaWYgKHcgIT09IG51bGwpIHsKICAgICAgICAgIHVpVyA9IHc7CiAgICAgICAgICB1aUggPSBoOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB1aUggPSBmb250c19nZXRNZXRyaWNzKHRoaXMuZm9udCwgdHJ1ZSkubGluZU5vR2FwOwogICAgICAgIH0KICAgICAgfQogICAgICBib3JkZXJEaW1zID0gZ2V0Qm9yZGVyRGltcyh0aGlzLnVpWyRnZXRFeHRyYV0oKSk7CiAgICAgIHVpVyArPSBib3JkZXJEaW1zLnc7CiAgICAgIHVpSCArPSBib3JkZXJEaW1zLmg7CiAgICAgIGlmICh0aGlzLmNhcHRpb24pIHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICB3LAogICAgICAgICAgaCwKICAgICAgICAgIGlzQnJva2VuCiAgICAgICAgfSA9IHRoaXMuY2FwdGlvblskZ2V0RXh0cmFdKGF2YWlsYWJsZVNwYWNlKTsKICAgICAgICBpZiAoaXNCcm9rZW4gJiYgdGhpc1skZ2V0U3ViZm9ybVBhcmVudF0oKVskaXNUaGVyZU1vcmVXaWR0aF0oKSkgewogICAgICAgICAgdGhpc1skcG9wUGFyYV0oKTsKICAgICAgICAgIHJldHVybiBIVE1MUmVzdWx0LkZBSUxVUkU7CiAgICAgICAgfQogICAgICAgIHdpZHRoID0gdzsKICAgICAgICBoZWlnaHQgPSBoOwogICAgICAgIHN3aXRjaCAodGhpcy5jYXB0aW9uLnBsYWNlbWVudCkgewogICAgICAgICAgY2FzZSAibGVmdCI6CiAgICAgICAgICBjYXNlICJyaWdodCI6CiAgICAgICAgICBjYXNlICJpbmxpbmUiOgogICAgICAgICAgICB3aWR0aCArPSB1aVc7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAidG9wIjoKICAgICAgICAgIGNhc2UgImJvdHRvbSI6CiAgICAgICAgICAgIGhlaWdodCArPSB1aUg7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB3aWR0aCA9IHVpVzsKICAgICAgICBoZWlnaHQgPSB1aUg7CiAgICAgIH0KICAgICAgaWYgKHdpZHRoICYmIHRoaXMudyA9PT0gIiIpIHsKICAgICAgICB3aWR0aCArPSBtYXJnaW5IOwogICAgICAgIHRoaXMudyA9IE1hdGgubWluKHRoaXMubWF4VyA8PSAwID8gSW5maW5pdHkgOiB0aGlzLm1heFcsIHRoaXMubWluVyArIDEgPCB3aWR0aCA/IHdpZHRoIDogdGhpcy5taW5XKTsKICAgICAgfQogICAgICBpZiAoaGVpZ2h0ICYmIHRoaXMuaCA9PT0gIiIpIHsKICAgICAgICBoZWlnaHQgKz0gbWFyZ2luVjsKICAgICAgICB0aGlzLmggPSBNYXRoLm1pbih0aGlzLm1heEggPD0gMCA/IEluZmluaXR5IDogdGhpcy5tYXhILCB0aGlzLm1pbkggKyAxIDwgaGVpZ2h0ID8gaGVpZ2h0IDogdGhpcy5taW5IKTsKICAgICAgfQogICAgfQogICAgdGhpc1skcG9wUGFyYV0oKTsKICAgIGZpeERpbWVuc2lvbnModGhpcyk7CiAgICBzZXRGaXJzdFVuc3BsaXR0YWJsZSh0aGlzKTsKICAgIGlmICghY2hlY2tEaW1lbnNpb25zKHRoaXMsIGF2YWlsYWJsZVNwYWNlKSkgewogICAgICB0aGlzLncgPSBzYXZlZFc7CiAgICAgIHRoaXMuaCA9IHNhdmVkSDsKICAgICAgdGhpc1skcG9wUGFyYV0oKTsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRkFJTFVSRTsKICAgIH0KICAgIHVuc2V0Rmlyc3RVbnNwbGl0dGFibGUodGhpcyk7CiAgICBjb25zdCBzdHlsZSA9IHRvU3R5bGUodGhpcywgImZvbnQiLCAiZGltZW5zaW9ucyIsICJwb3NpdGlvbiIsICJyb3RhdGUiLCAiYW5jaG9yVHlwZSIsICJwcmVzZW5jZSIsICJtYXJnaW4iLCAiaEFsaWduIik7CiAgICBzZXRNaW5NYXhEaW1lbnNpb25zKHRoaXMsIHN0eWxlKTsKICAgIGNvbnN0IGNsYXNzTmFtZXMgPSBbInhmYUZpZWxkIl07CiAgICBpZiAodGhpcy5mb250KSB7CiAgICAgIGNsYXNzTmFtZXMucHVzaCgieGZhRm9udCIpOwogICAgfQogICAgaWYgKGlzUHJpbnRPbmx5KHRoaXMpKSB7CiAgICAgIGNsYXNzTmFtZXMucHVzaCgieGZhUHJpbnRPbmx5Iik7CiAgICB9CiAgICBjb25zdCBhdHRyaWJ1dGVzID0gewogICAgICBzdHlsZSwKICAgICAgaWQ6IHRoaXNbJHVpZF0sCiAgICAgIGNsYXNzOiBjbGFzc05hbWVzCiAgICB9OwogICAgaWYgKHN0eWxlLm1hcmdpbikgewogICAgICBzdHlsZS5wYWRkaW5nID0gc3R5bGUubWFyZ2luOwogICAgICBkZWxldGUgc3R5bGUubWFyZ2luOwogICAgfQogICAgc2V0QWNjZXNzKHRoaXMsIGNsYXNzTmFtZXMpOwogICAgaWYgKHRoaXMubmFtZSkgewogICAgICBhdHRyaWJ1dGVzLnhmYU5hbWUgPSB0aGlzLm5hbWU7CiAgICB9CiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOwogICAgY29uc3QgaHRtbCA9IHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGF0dHJpYnV0ZXMsCiAgICAgIGNoaWxkcmVuCiAgICB9OwogICAgYXBwbHlBc3Npc3QodGhpcywgYXR0cmlidXRlcyk7CiAgICBjb25zdCBib3JkZXJTdHlsZSA9IHRoaXMuYm9yZGVyID8gdGhpcy5ib3JkZXJbJHRvU3R5bGVdKCkgOiBudWxsOwogICAgY29uc3QgYmJveCA9IGNvbXB1dGVCYm94KHRoaXMsIGh0bWwsIGF2YWlsYWJsZVNwYWNlKTsKICAgIGNvbnN0IHVpID0gdGhpcy51aVskdG9IVE1MXSgpLmh0bWw7CiAgICBpZiAoIXVpKSB7CiAgICAgIE9iamVjdC5hc3NpZ24oc3R5bGUsIGJvcmRlclN0eWxlKTsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2VzcyhjcmVhdGVXcmFwcGVyKHRoaXMsIGh0bWwpLCBiYm94KTsKICAgIH0KICAgIGlmICh0aGlzWyR0YWJJbmRleF0pIHsKICAgICAgaWYgKHVpLmNoaWxkcmVuPy5bMF0pIHsKICAgICAgICB1aS5jaGlsZHJlblswXS5hdHRyaWJ1dGVzLnRhYmluZGV4ID0gdGhpc1skdGFiSW5kZXhdOwogICAgICB9IGVsc2UgewogICAgICAgIHVpLmF0dHJpYnV0ZXMudGFiaW5kZXggPSB0aGlzWyR0YWJJbmRleF07CiAgICAgIH0KICAgIH0KICAgIHVpLmF0dHJpYnV0ZXMuc3R5bGUgfHw9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBsZXQgYUVsZW1lbnQgPSBudWxsOwogICAgaWYgKHRoaXMudWkuYnV0dG9uKSB7CiAgICAgIGlmICh1aS5jaGlsZHJlbi5sZW5ndGggPT09IDEpIHsKICAgICAgICBbYUVsZW1lbnRdID0gdWkuY2hpbGRyZW4uc3BsaWNlKDAsIDEpOwogICAgICB9CiAgICAgIE9iamVjdC5hc3NpZ24odWkuYXR0cmlidXRlcy5zdHlsZSwgYm9yZGVyU3R5bGUpOwogICAgfSBlbHNlIHsKICAgICAgT2JqZWN0LmFzc2lnbihzdHlsZSwgYm9yZGVyU3R5bGUpOwogICAgfQogICAgY2hpbGRyZW4ucHVzaCh1aSk7CiAgICBpZiAodGhpcy52YWx1ZSkgewogICAgICBpZiAodGhpcy51aS5pbWFnZUVkaXQpIHsKICAgICAgICB1aS5jaGlsZHJlbi5wdXNoKHRoaXMudmFsdWVbJHRvSFRNTF0oKS5odG1sKTsKICAgICAgfSBlbHNlIGlmICghdGhpcy51aS5idXR0b24pIHsKICAgICAgICBsZXQgdmFsdWUgPSAiIjsKICAgICAgICBpZiAodGhpcy52YWx1ZS5leERhdGEpIHsKICAgICAgICAgIHZhbHVlID0gdGhpcy52YWx1ZS5leERhdGFbJHRleHRdKCk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnZhbHVlLnRleHQpIHsKICAgICAgICAgIHZhbHVlID0gdGhpcy52YWx1ZS50ZXh0WyRnZXRFeHRyYV0oKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3QgaHRtbFZhbHVlID0gdGhpcy52YWx1ZVskdG9IVE1MXSgpLmh0bWw7CiAgICAgICAgICBpZiAoaHRtbFZhbHVlICE9PSBudWxsKSB7CiAgICAgICAgICAgIHZhbHVlID0gaHRtbFZhbHVlLmNoaWxkcmVuWzBdLnZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodGhpcy51aS50ZXh0RWRpdCAmJiB0aGlzLnZhbHVlLnRleHQ/Lm1heENoYXJzKSB7CiAgICAgICAgICB1aS5jaGlsZHJlblswXS5hdHRyaWJ1dGVzLm1heExlbmd0aCA9IHRoaXMudmFsdWUudGV4dC5tYXhDaGFyczsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICBpZiAodGhpcy51aS5udW1lcmljRWRpdCkgewogICAgICAgICAgICB2YWx1ZSA9IHBhcnNlRmxvYXQodmFsdWUpOwogICAgICAgICAgICB2YWx1ZSA9IGlzTmFOKHZhbHVlKSA/ICIiIDogdmFsdWUudG9TdHJpbmcoKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh1aS5jaGlsZHJlblswXS5uYW1lID09PSAidGV4dGFyZWEiKSB7CiAgICAgICAgICAgIHVpLmNoaWxkcmVuWzBdLmF0dHJpYnV0ZXMudGV4dENvbnRlbnQgPSB2YWx1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpLmNoaWxkcmVuWzBdLmF0dHJpYnV0ZXMudmFsdWUgPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmICghdGhpcy51aS5pbWFnZUVkaXQgJiYgdWkuY2hpbGRyZW4/LlswXSAmJiB0aGlzLmgpIHsKICAgICAgYm9yZGVyRGltcyA9IGJvcmRlckRpbXMgfHwgZ2V0Qm9yZGVyRGltcyh0aGlzLnVpWyRnZXRFeHRyYV0oKSk7CiAgICAgIGxldCBjYXB0aW9uSGVpZ2h0ID0gMDsKICAgICAgaWYgKHRoaXMuY2FwdGlvbiAmJiBbInRvcCIsICJib3R0b20iXS5pbmNsdWRlcyh0aGlzLmNhcHRpb24ucGxhY2VtZW50KSkgewogICAgICAgIGNhcHRpb25IZWlnaHQgPSB0aGlzLmNhcHRpb24ucmVzZXJ2ZTsKICAgICAgICBpZiAoY2FwdGlvbkhlaWdodCA8PSAwKSB7CiAgICAgICAgICBjYXB0aW9uSGVpZ2h0ID0gdGhpcy5jYXB0aW9uWyRnZXRFeHRyYV0oYXZhaWxhYmxlU3BhY2UpLmg7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGlucHV0SGVpZ2h0ID0gdGhpcy5oIC0gY2FwdGlvbkhlaWdodCAtIG1hcmdpblYgLSBib3JkZXJEaW1zLmg7CiAgICAgICAgdWkuY2hpbGRyZW5bMF0uYXR0cmlidXRlcy5zdHlsZS5oZWlnaHQgPSBtZWFzdXJlVG9TdHJpbmcoaW5wdXRIZWlnaHQpOwogICAgICB9IGVsc2UgewogICAgICAgIHVpLmNoaWxkcmVuWzBdLmF0dHJpYnV0ZXMuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICB9CiAgICB9CiAgICBpZiAoYUVsZW1lbnQpIHsKICAgICAgdWkuY2hpbGRyZW4ucHVzaChhRWxlbWVudCk7CiAgICB9CiAgICBpZiAoIWNhcHRpb24pIHsKICAgICAgaWYgKHVpLmF0dHJpYnV0ZXMuY2xhc3MpIHsKICAgICAgICB1aS5hdHRyaWJ1dGVzLmNsYXNzLnB1c2goInhmYUxlZnQiKTsKICAgICAgfQogICAgICB0aGlzLncgPSBzYXZlZFc7CiAgICAgIHRoaXMuaCA9IHNhdmVkSDsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2VzcyhjcmVhdGVXcmFwcGVyKHRoaXMsIGh0bWwpLCBiYm94KTsKICAgIH0KICAgIGlmICh0aGlzLnVpLmJ1dHRvbikgewogICAgICBpZiAoc3R5bGUucGFkZGluZykgewogICAgICAgIGRlbGV0ZSBzdHlsZS5wYWRkaW5nOwogICAgICB9CiAgICAgIGlmIChjYXB0aW9uLm5hbWUgPT09ICJkaXYiKSB7CiAgICAgICAgY2FwdGlvbi5uYW1lID0gInNwYW4iOwogICAgICB9CiAgICAgIHVpLmNoaWxkcmVuLnB1c2goY2FwdGlvbik7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoaHRtbCwgYmJveCk7CiAgICB9IGVsc2UgaWYgKHRoaXMudWkuY2hlY2tCdXR0b24pIHsKICAgICAgY2FwdGlvbi5hdHRyaWJ1dGVzLmNsYXNzWzBdID0gInhmYUNhcHRpb25Gb3JDaGVja0J1dHRvbiI7CiAgICB9CiAgICB1aS5hdHRyaWJ1dGVzLmNsYXNzIHx8PSBbXTsKICAgIHVpLmNoaWxkcmVuLnNwbGljZSgwLCAwLCBjYXB0aW9uKTsKICAgIHN3aXRjaCAodGhpcy5jYXB0aW9uLnBsYWNlbWVudCkgewogICAgICBjYXNlICJsZWZ0IjoKICAgICAgICB1aS5hdHRyaWJ1dGVzLmNsYXNzLnB1c2goInhmYUxlZnQiKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAicmlnaHQiOgogICAgICAgIHVpLmF0dHJpYnV0ZXMuY2xhc3MucHVzaCgieGZhUmlnaHQiKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAidG9wIjoKICAgICAgICB1aS5hdHRyaWJ1dGVzLmNsYXNzLnB1c2goInhmYVRvcCIpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJib3R0b20iOgogICAgICAgIHVpLmF0dHJpYnV0ZXMuY2xhc3MucHVzaCgieGZhQm90dG9tIik7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImlubGluZSI6CiAgICAgICAgdWkuYXR0cmlidXRlcy5jbGFzcy5wdXNoKCJ4ZmFMZWZ0Iik7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICB0aGlzLncgPSBzYXZlZFc7CiAgICB0aGlzLmggPSBzYXZlZEg7CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKGNyZWF0ZVdyYXBwZXIodGhpcywgaHRtbCksIGJib3gpOwogIH0KfQpjbGFzcyBGaWxsIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImZpbGwiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5wcmVzZW5jZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnByZXNlbmNlLCBbInZpc2libGUiLCAiaGlkZGVuIiwgImluYWN0aXZlIiwgImludmlzaWJsZSJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNvbG9yID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMubGluZWFyID0gbnVsbDsKICAgIHRoaXMucGF0dGVybiA9IG51bGw7CiAgICB0aGlzLnJhZGlhbCA9IG51bGw7CiAgICB0aGlzLnNvbGlkID0gbnVsbDsKICAgIHRoaXMuc3RpcHBsZSA9IG51bGw7CiAgfQogIFskdG9TdHlsZV0oKSB7CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBncmFuZHBhID0gcGFyZW50WyRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBnZ3JhbmRwYSA9IGdyYW5kcGFbJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IHN0eWxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGxldCBwcm9wTmFtZSA9ICJjb2xvciI7CiAgICBsZXQgYWx0UHJvcE5hbWUgPSBwcm9wTmFtZTsKICAgIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBCb3JkZXIpIHsKICAgICAgcHJvcE5hbWUgPSAiYmFja2dyb3VuZC1jb2xvciI7CiAgICAgIGFsdFByb3BOYW1lID0gImJhY2tncm91bmQiOwogICAgICBpZiAoZ2dyYW5kcGEgaW5zdGFuY2VvZiBVaSkgewogICAgICAgIHN0eWxlLmJhY2tncm91bmRDb2xvciA9ICJ3aGl0ZSI7CiAgICAgIH0KICAgIH0KICAgIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBSZWN0YW5nbGUgfHwgcGFyZW50IGluc3RhbmNlb2YgQXJjKSB7CiAgICAgIHByb3BOYW1lID0gYWx0UHJvcE5hbWUgPSAiZmlsbCI7CiAgICAgIHN0eWxlLmZpbGwgPSAid2hpdGUiOwogICAgfQogICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpKSB7CiAgICAgIGlmIChuYW1lID09PSAiZXh0cmFzIiB8fCBuYW1lID09PSAiY29sb3IiKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3Qgb2JqID0gdGhpc1tuYW1lXTsKICAgICAgaWYgKCEob2JqIGluc3RhbmNlb2YgWEZBT2JqZWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGNvbG9yID0gb2JqWyR0b1N0eWxlXSh0aGlzLmNvbG9yKTsKICAgICAgaWYgKGNvbG9yKSB7CiAgICAgICAgc3R5bGVbY29sb3Iuc3RhcnRzV2l0aCgiIyIpID8gcHJvcE5hbWUgOiBhbHRQcm9wTmFtZV0gPSBjb2xvcjsKICAgICAgfQogICAgICByZXR1cm4gc3R5bGU7CiAgICB9CiAgICBpZiAodGhpcy5jb2xvcj8udmFsdWUpIHsKICAgICAgY29uc3QgY29sb3IgPSB0aGlzLmNvbG9yWyR0b1N0eWxlXSgpOwogICAgICBzdHlsZVtjb2xvci5zdGFydHNXaXRoKCIjIikgPyBwcm9wTmFtZSA6IGFsdFByb3BOYW1lXSA9IGNvbG9yOwogICAgfQogICAgcmV0dXJuIHN0eWxlOwogIH0KfQpjbGFzcyBGaWx0ZXIgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZmlsdGVyIiwgdHJ1ZSk7CiAgICB0aGlzLmFkZFJldm9jYXRpb25JbmZvID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuYWRkUmV2b2NhdGlvbkluZm8sIFsiIiwgInJlcXVpcmVkIiwgIm9wdGlvbmFsIiwgIm5vbmUiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnZlcnNpb24gPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogdGhpcy52ZXJzaW9uLAogICAgICBkZWZhdWx0VmFsdWU6IDUsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMSAmJiB4IDw9IDUKICAgIH0pOwogICAgdGhpcy5hcHBlYXJhbmNlRmlsdGVyID0gbnVsbDsKICAgIHRoaXMuY2VydGlmaWNhdGVzID0gbnVsbDsKICAgIHRoaXMuZGlnZXN0TWV0aG9kcyA9IG51bGw7CiAgICB0aGlzLmVuY29kaW5ncyA9IG51bGw7CiAgICB0aGlzLmVuY3J5cHRpb25NZXRob2RzID0gbnVsbDsKICAgIHRoaXMuaGFuZGxlciA9IG51bGw7CiAgICB0aGlzLmxvY2tEb2N1bWVudCA9IG51bGw7CiAgICB0aGlzLm1kcCA9IG51bGw7CiAgICB0aGlzLnJlYXNvbnMgPSBudWxsOwogICAgdGhpcy50aW1lU3RhbXAgPSBudWxsOwogIH0KfQpjbGFzcyBGbG9hdCBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZmxvYXQiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICBjb25zdCBudW1iZXIgPSBwYXJzZUZsb2F0KHRoaXNbJGNvbnRlbnRdLnRyaW0oKSk7CiAgICB0aGlzWyRjb250ZW50XSA9IGlzTmFOKG51bWJlcikgPyBudWxsIDogbnVtYmVyOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHJldHVybiB2YWx1ZVRvSHRtbCh0aGlzWyRjb250ZW50XSAhPT0gbnVsbCA/IHRoaXNbJGNvbnRlbnRdLnRvU3RyaW5nKCkgOiAiIik7CiAgfQp9CmNsYXNzIHRlbXBsYXRlX0ZvbnQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZm9udCIsIHRydWUpOwogICAgdGhpcy5iYXNlbGluZVNoaWZ0ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5iYXNlbGluZVNoaWZ0KTsKICAgIHRoaXMuZm9udEhvcml6b250YWxTY2FsZSA9IGdldEZsb2F0KHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5mb250SG9yaXpvbnRhbFNjYWxlLAogICAgICBkZWZhdWx0VmFsdWU6IDEwMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwCiAgICB9KTsKICAgIHRoaXMuZm9udFZlcnRpY2FsU2NhbGUgPSBnZXRGbG9hdCh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZm9udFZlcnRpY2FsU2NhbGUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMTAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAKICAgIH0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmtlcm5pbmdNb2RlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMua2VybmluZ01vZGUsIFsibm9uZSIsICJwYWlyIl0pOwogICAgdGhpcy5sZXR0ZXJTcGFjaW5nID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5sZXR0ZXJTcGFjaW5nLCAiMCIpOwogICAgdGhpcy5saW5lVGhyb3VnaCA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmxpbmVUaHJvdWdoLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEgfHwgeCA9PT0gMgogICAgfSk7CiAgICB0aGlzLmxpbmVUaHJvdWdoUGVyaW9kID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubGluZVRocm91Z2hQZXJpb2QsIFsiYWxsIiwgIndvcmQiXSk7CiAgICB0aGlzLm92ZXJsaW5lID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMub3ZlcmxpbmUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMSB8fCB4ID09PSAyCiAgICB9KTsKICAgIHRoaXMub3ZlcmxpbmVQZXJpb2QgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5vdmVybGluZVBlcmlvZCwgWyJhbGwiLCAid29yZCJdKTsKICAgIHRoaXMucG9zdHVyZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnBvc3R1cmUsIFsibm9ybWFsIiwgIml0YWxpYyJdKTsKICAgIHRoaXMuc2l6ZSA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMuc2l6ZSwgIjEwcHQiKTsKICAgIHRoaXMudHlwZWZhY2UgPSBhdHRyaWJ1dGVzLnR5cGVmYWNlIHx8ICJDb3VyaWVyIjsKICAgIHRoaXMudW5kZXJsaW5lID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMudW5kZXJsaW5lLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEgfHwgeCA9PT0gMgogICAgfSk7CiAgICB0aGlzLnVuZGVybGluZVBlcmlvZCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnVuZGVybGluZVBlcmlvZCwgWyJhbGwiLCAid29yZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLndlaWdodCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLndlaWdodCwgWyJub3JtYWwiLCAiYm9sZCJdKTsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuZmlsbCA9IG51bGw7CiAgfQogIFskY2xlYW5dKGJ1aWxkZXIpIHsKICAgIHN1cGVyWyRjbGVhbl0oYnVpbGRlcik7CiAgICB0aGlzWyRnbG9iYWxEYXRhXS51c2VkVHlwZWZhY2VzLmFkZCh0aGlzLnR5cGVmYWNlKTsKICB9CiAgWyR0b1N0eWxlXSgpIHsKICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAiZmlsbCIpOwogICAgY29uc3QgY29sb3IgPSBzdHlsZS5jb2xvcjsKICAgIGlmIChjb2xvcikgewogICAgICBpZiAoY29sb3IgPT09ICIjMDAwMDAwIikgewogICAgICAgIGRlbGV0ZSBzdHlsZS5jb2xvcjsKICAgICAgfSBlbHNlIGlmICghY29sb3Iuc3RhcnRzV2l0aCgiIyIpKSB7CiAgICAgICAgc3R5bGUuYmFja2dyb3VuZCA9IGNvbG9yOwogICAgICAgIHN0eWxlLmJhY2tncm91bmRDbGlwID0gInRleHQiOwogICAgICAgIHN0eWxlLmNvbG9yID0gInRyYW5zcGFyZW50IjsKICAgICAgfQogICAgfQogICAgaWYgKHRoaXMuYmFzZWxpbmVTaGlmdCkgewogICAgICBzdHlsZS52ZXJ0aWNhbEFsaWduID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMuYmFzZWxpbmVTaGlmdCk7CiAgICB9CiAgICBzdHlsZS5mb250S2VybmluZyA9IHRoaXMua2VybmluZ01vZGUgPT09ICJub25lIiA/ICJub25lIiA6ICJub3JtYWwiOwogICAgc3R5bGUubGV0dGVyU3BhY2luZyA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLmxldHRlclNwYWNpbmcpOwogICAgaWYgKHRoaXMubGluZVRocm91Z2ggIT09IDApIHsKICAgICAgc3R5bGUudGV4dERlY29yYXRpb24gPSAibGluZS10aHJvdWdoIjsKICAgICAgaWYgKHRoaXMubGluZVRocm91Z2ggPT09IDIpIHsKICAgICAgICBzdHlsZS50ZXh0RGVjb3JhdGlvblN0eWxlID0gImRvdWJsZSI7CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzLm92ZXJsaW5lICE9PSAwKSB7CiAgICAgIHN0eWxlLnRleHREZWNvcmF0aW9uID0gIm92ZXJsaW5lIjsKICAgICAgaWYgKHRoaXMub3ZlcmxpbmUgPT09IDIpIHsKICAgICAgICBzdHlsZS50ZXh0RGVjb3JhdGlvblN0eWxlID0gImRvdWJsZSI7CiAgICAgIH0KICAgIH0KICAgIHN0eWxlLmZvbnRTdHlsZSA9IHRoaXMucG9zdHVyZTsKICAgIHN0eWxlLmZvbnRTaXplID0gbWVhc3VyZVRvU3RyaW5nKDAuOTkgKiB0aGlzLnNpemUpOwogICAgc2V0Rm9udEZhbWlseSh0aGlzLCB0aGlzLCB0aGlzWyRnbG9iYWxEYXRhXS5mb250RmluZGVyLCBzdHlsZSk7CiAgICBpZiAodGhpcy51bmRlcmxpbmUgIT09IDApIHsKICAgICAgc3R5bGUudGV4dERlY29yYXRpb24gPSAidW5kZXJsaW5lIjsKICAgICAgaWYgKHRoaXMudW5kZXJsaW5lID09PSAyKSB7CiAgICAgICAgc3R5bGUudGV4dERlY29yYXRpb25TdHlsZSA9ICJkb3VibGUiOwogICAgICB9CiAgICB9CiAgICBzdHlsZS5mb250V2VpZ2h0ID0gdGhpcy53ZWlnaHQ7CiAgICByZXR1cm4gc3R5bGU7CiAgfQp9CmNsYXNzIEZvcm1hdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJmb3JtYXQiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMucGljdHVyZSA9IG51bGw7CiAgfQp9CmNsYXNzIEhhbmRsZXIgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiaGFuZGxlciIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgSHlwaGVuYXRpb24gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiaHlwaGVuYXRpb24iKTsKICAgIHRoaXMuZXhjbHVkZUFsbENhcHMgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5leGNsdWRlQWxsQ2FwcywKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMuZXhjbHVkZUluaXRpYWxDYXAgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5leGNsdWRlSW5pdGlhbENhcCwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMuaHlwaGVuYXRlID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuaHlwaGVuYXRlLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnB1c2hDaGFyYWN0ZXJDb3VudCA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnB1c2hDaGFyYWN0ZXJDb3VudCwKICAgICAgZGVmYXVsdFZhbHVlOiAzLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAKICAgIH0pOwogICAgdGhpcy5yZW1haW5DaGFyYWN0ZXJDb3VudCA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnJlbWFpbkNoYXJhY3RlckNvdW50LAogICAgICBkZWZhdWx0VmFsdWU6IDMsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy53b3JkQ2hhcmFjdGVyQ291bnQgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy53b3JkQ2hhcmFjdGVyQ291bnQsCiAgICAgIGRlZmF1bHRWYWx1ZTogNywKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwCiAgICB9KTsKICB9Cn0KY2xhc3MgSW1hZ2UgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiaW1hZ2UiKTsKICAgIHRoaXMuYXNwZWN0ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuYXNwZWN0LCBbImZpdCIsICJhY3R1YWwiLCAiaGVpZ2h0IiwgIm5vbmUiLCAid2lkdGgiXSk7CiAgICB0aGlzLmNvbnRlbnRUeXBlID0gYXR0cmlidXRlcy5jb250ZW50VHlwZSB8fCAiIjsKICAgIHRoaXMuaHJlZiA9IGF0dHJpYnV0ZXMuaHJlZiB8fCAiIjsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy50cmFuc2ZlckVuY29kaW5nID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHJhbnNmZXJFbmNvZGluZywgWyJiYXNlNjQiLCAibm9uZSIsICJwYWNrYWdlIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgWyR0b0hUTUxdKCkgewogICAgaWYgKHRoaXMuY29udGVudFR5cGUgJiYgIU1JTUVTLmhhcyh0aGlzLmNvbnRlbnRUeXBlLnRvTG93ZXJDYXNlKCkpKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgbGV0IGJ1ZmZlciA9IHRoaXNbJGdsb2JhbERhdGFdLmltYWdlcz8uZ2V0KHRoaXMuaHJlZik7CiAgICBpZiAoIWJ1ZmZlciAmJiAodGhpcy5ocmVmIHx8ICF0aGlzWyRjb250ZW50XSkpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICBpZiAoIWJ1ZmZlciAmJiB0aGlzLnRyYW5zZmVyRW5jb2RpbmcgPT09ICJiYXNlNjQiKSB7CiAgICAgIGJ1ZmZlciA9IGZyb21CYXNlNjRVdGlsKHRoaXNbJGNvbnRlbnRdKTsKICAgIH0KICAgIGlmICghYnVmZmVyKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgaWYgKCF0aGlzLmNvbnRlbnRUeXBlKSB7CiAgICAgIGZvciAoY29uc3QgW2hlYWRlciwgdHlwZV0gb2YgSU1BR0VTX0hFQURFUlMpIHsKICAgICAgICBpZiAoYnVmZmVyLmxlbmd0aCA+IGhlYWRlci5sZW5ndGggJiYgaGVhZGVyLmV2ZXJ5KCh4LCBpKSA9PiB4ID09PSBidWZmZXJbaV0pKSB7CiAgICAgICAgICB0aGlzLmNvbnRlbnRUeXBlID0gdHlwZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIXRoaXMuY29udGVudFR5cGUpIHsKICAgICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgICAgfQogICAgfQogICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtidWZmZXJdLCB7CiAgICAgIHR5cGU6IHRoaXMuY29udGVudFR5cGUKICAgIH0pOwogICAgbGV0IHN0eWxlOwogICAgc3dpdGNoICh0aGlzLmFzcGVjdCkgewogICAgICBjYXNlICJmaXQiOgogICAgICBjYXNlICJhY3R1YWwiOgogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJoZWlnaHQiOgogICAgICAgIHN0eWxlID0gewogICAgICAgICAgaGVpZ2h0OiAiMTAwJSIsCiAgICAgICAgICBvYmplY3RGaXQ6ICJmaWxsIgogICAgICAgIH07CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIm5vbmUiOgogICAgICAgIHN0eWxlID0gewogICAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICAgIGhlaWdodDogIjEwMCUiLAogICAgICAgICAgb2JqZWN0Rml0OiAiZmlsbCIKICAgICAgICB9OwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJ3aWR0aCI6CiAgICAgICAgc3R5bGUgPSB7CiAgICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgICAgb2JqZWN0Rml0OiAiZmlsbCIKICAgICAgICB9OwogICAgICAgIGJyZWFrOwogICAgfQogICAgY29uc3QgcGFyZW50ID0gdGhpc1skZ2V0UGFyZW50XSgpOwogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgIG5hbWU6ICJpbWciLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IFsieGZhSW1hZ2UiXSwKICAgICAgICBzdHlsZSwKICAgICAgICBzcmM6IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYiksCiAgICAgICAgYWx0OiBwYXJlbnQgPyBhcmlhTGFiZWwocGFyZW50WyRnZXRQYXJlbnRdKCkpIDogbnVsbAogICAgICB9CiAgICB9KTsKICB9Cn0KY2xhc3MgSW1hZ2VFZGl0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImltYWdlRWRpdCIsIHRydWUpOwogICAgdGhpcy5kYXRhID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuZGF0YSwgWyJsaW5rIiwgImVtYmVkIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGlmICh0aGlzLmRhdGEgPT09ICJlbWJlZCIpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgICAgbmFtZTogImRpdiIsCiAgICAgICAgY2hpbGRyZW46IFtdLAogICAgICAgIGF0dHJpYnV0ZXM6IHt9CiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgfQp9CmNsYXNzIEludGVnZXIgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImludGVnZXIiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICBjb25zdCBudW1iZXIgPSBwYXJzZUludCh0aGlzWyRjb250ZW50XS50cmltKCksIDEwKTsKICAgIHRoaXNbJGNvbnRlbnRdID0gaXNOYU4obnVtYmVyKSA/IG51bGwgOiBudW1iZXI7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgcmV0dXJuIHZhbHVlVG9IdG1sKHRoaXNbJGNvbnRlbnRdICE9PSBudWxsID8gdGhpc1skY29udGVudF0udG9TdHJpbmcoKSA6ICIiKTsKICB9Cn0KY2xhc3MgSXNzdWVycyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJpc3N1ZXJzIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jZXJ0aWZpY2F0ZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBJdGVtcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJpdGVtcyIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnByZXNlbmNlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucHJlc2VuY2UsIFsidmlzaWJsZSIsICJoaWRkZW4iLCAiaW5hY3RpdmUiLCAiaW52aXNpYmxlIl0pOwogICAgdGhpcy5yZWYgPSBhdHRyaWJ1dGVzLnJlZiB8fCAiIjsKICAgIHRoaXMuc2F2ZSA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnNhdmUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib29sZWFuID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGF0ZVRpbWUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGVjaW1hbCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leERhdGEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmxvYXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaW1hZ2UgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaW50ZWdlciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50ZXh0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRpbWUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9CiAgWyR0b0hUTUxdKCkgewogICAgY29uc3Qgb3V0cHV0ID0gW107CiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXNbJGdldENoaWxkcmVuXSgpKSB7CiAgICAgIG91dHB1dC5wdXNoKGNoaWxkWyR0ZXh0XSgpKTsKICAgIH0KICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3Mob3V0cHV0KTsKICB9Cn0KY2xhc3MgS2VlcCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJrZWVwIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIGNvbnN0IG9wdGlvbnMgPSBbIm5vbmUiLCAiY29udGVudEFyZWEiLCAicGFnZUFyZWEiXTsKICAgIHRoaXMuaW50YWN0ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuaW50YWN0LCBvcHRpb25zKTsKICAgIHRoaXMubmV4dCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm5leHQsIG9wdGlvbnMpOwogICAgdGhpcy5wcmV2aW91cyA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnByZXZpb3VzLCBvcHRpb25zKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQp9CmNsYXNzIEtleVVzYWdlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImtleVVzYWdlIik7CiAgICBjb25zdCBvcHRpb25zID0gWyIiLCAieWVzIiwgIm5vIl07CiAgICB0aGlzLmNybFNpZ24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5jcmxTaWduLCBvcHRpb25zKTsKICAgIHRoaXMuZGF0YUVuY2lwaGVybWVudCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmRhdGFFbmNpcGhlcm1lbnQsIG9wdGlvbnMpOwogICAgdGhpcy5kZWNpcGhlck9ubHkgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5kZWNpcGhlck9ubHksIG9wdGlvbnMpOwogICAgdGhpcy5kaWdpdGFsU2lnbmF0dXJlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuZGlnaXRhbFNpZ25hdHVyZSwgb3B0aW9ucyk7CiAgICB0aGlzLmVuY2lwaGVyT25seSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmVuY2lwaGVyT25seSwgb3B0aW9ucyk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMua2V5QWdyZWVtZW50ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMua2V5QWdyZWVtZW50LCBvcHRpb25zKTsKICAgIHRoaXMua2V5Q2VydFNpZ24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5rZXlDZXJ0U2lnbiwgb3B0aW9ucyk7CiAgICB0aGlzLmtleUVuY2lwaGVybWVudCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmtleUVuY2lwaGVybWVudCwgb3B0aW9ucyk7CiAgICB0aGlzLm5vblJlcHVkaWF0aW9uID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubm9uUmVwdWRpYXRpb24sIG9wdGlvbnMpOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIExpbmUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAibGluZSIsIHRydWUpOwogICAgdGhpcy5oYW5kID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuaGFuZCwgWyJldmVuIiwgImxlZnQiLCAicmlnaHQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMuc2xvcGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5zbG9wZSwgWyJcXCIsICIvIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZWRnZSA9IG51bGw7CiAgfQogIFskdG9IVE1MXSgpIHsKICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbJGdldFBhcmVudF0oKVskZ2V0UGFyZW50XSgpOwogICAgY29uc3QgZWRnZSA9IHRoaXMuZWRnZSB8fCBuZXcgRWRnZSh7fSk7CiAgICBjb25zdCBlZGdlU3R5bGUgPSBlZGdlWyR0b1N0eWxlXSgpOwogICAgY29uc3Qgc3R5bGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgY29uc3QgdGhpY2tuZXNzID0gZWRnZS5wcmVzZW5jZSA9PT0gInZpc2libGUiID8gZWRnZS50aGlja25lc3MgOiAwOwogICAgc3R5bGUuc3Ryb2tlV2lkdGggPSBtZWFzdXJlVG9TdHJpbmcodGhpY2tuZXNzKTsKICAgIHN0eWxlLnN0cm9rZSA9IGVkZ2VTdHlsZS5jb2xvcjsKICAgIGxldCB4MSwgeTEsIHgyLCB5MjsKICAgIGxldCB3aWR0aCA9ICIxMDAlIjsKICAgIGxldCBoZWlnaHQgPSAiMTAwJSI7CiAgICBpZiAocGFyZW50LncgPD0gdGhpY2tuZXNzKSB7CiAgICAgIFt4MSwgeTEsIHgyLCB5Ml0gPSBbIjUwJSIsIDAsICI1MCUiLCAiMTAwJSJdOwogICAgICB3aWR0aCA9IHN0eWxlLnN0cm9rZVdpZHRoOwogICAgfSBlbHNlIGlmIChwYXJlbnQuaCA8PSB0aGlja25lc3MpIHsKICAgICAgW3gxLCB5MSwgeDIsIHkyXSA9IFswLCAiNTAlIiwgIjEwMCUiLCAiNTAlIl07CiAgICAgIGhlaWdodCA9IHN0eWxlLnN0cm9rZVdpZHRoOwogICAgfSBlbHNlIGlmICh0aGlzLnNsb3BlID09PSAiXFwiKSB7CiAgICAgIFt4MSwgeTEsIHgyLCB5Ml0gPSBbMCwgMCwgIjEwMCUiLCAiMTAwJSJdOwogICAgfSBlbHNlIHsKICAgICAgW3gxLCB5MSwgeDIsIHkyXSA9IFswLCAiMTAwJSIsICIxMDAlIiwgMF07CiAgICB9CiAgICBjb25zdCBsaW5lID0gewogICAgICBuYW1lOiAibGluZSIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICB4bWxuczogU1ZHX05TLAogICAgICAgIHgxLAogICAgICAgIHkxLAogICAgICAgIHgyLAogICAgICAgIHkyLAogICAgICAgIHN0eWxlCiAgICAgIH0KICAgIH07CiAgICBjb25zdCBzdmcgPSB7CiAgICAgIG5hbWU6ICJzdmciLAogICAgICBjaGlsZHJlbjogW2xpbmVdLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgeG1sbnM6IFNWR19OUywKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIG92ZXJmbG93OiAidmlzaWJsZSIKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICBpZiAoaGFzTWFyZ2luKHBhcmVudCkpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgICAgbmFtZTogImRpdiIsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgZGlzcGxheTogImlubGluZSIsCiAgICAgICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgICAgIGhlaWdodDogIjEwMCUiCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjaGlsZHJlbjogW3N2Z10KICAgICAgfSk7CiAgICB9CiAgICBzdmcuYXR0cmlidXRlcy5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHN2Zyk7CiAgfQp9CmNsYXNzIExpbmVhciBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJsaW5lYXIiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJ0b1JpZ2h0IiwgInRvQm90dG9tIiwgInRvTGVmdCIsICJ0b1RvcCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNvbG9yID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9CiAgWyR0b1N0eWxlXShzdGFydENvbG9yKSB7CiAgICBzdGFydENvbG9yID0gc3RhcnRDb2xvciA/IHN0YXJ0Q29sb3JbJHRvU3R5bGVdKCkgOiAiI0ZGRkZGRiI7CiAgICBjb25zdCB0cmFuc2YgPSB0aGlzLnR5cGUucmVwbGFjZSgvKFtSQkxUXSkvLCAiICQxIikudG9Mb3dlckNhc2UoKTsKICAgIGNvbnN0IGVuZENvbG9yID0gdGhpcy5jb2xvciA/IHRoaXMuY29sb3JbJHRvU3R5bGVdKCkgOiAiIzAwMDAwMCI7CiAgICByZXR1cm4gYGxpbmVhci1ncmFkaWVudCgke3RyYW5zZn0sICR7c3RhcnRDb2xvcn0sICR7ZW5kQ29sb3J9KWA7CiAgfQp9CmNsYXNzIExvY2tEb2N1bWVudCBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAibG9ja0RvY3VtZW50Iik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbJGNvbnRlbnRdID0gZ2V0U3RyaW5nT3B0aW9uKHRoaXNbJGNvbnRlbnRdLCBbImF1dG8iLCAiMCIsICIxIl0pOwogIH0KfQpjbGFzcyBNYW5pZmVzdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJtYW5pZmVzdCIsIHRydWUpOwogICAgdGhpcy5hY3Rpb24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5hY3Rpb24sIFsiaW5jbHVkZSIsICJhbGwiLCAiZXhjbHVkZSJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMucmVmID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIE1hcmdpbiBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJtYXJnaW4iLCB0cnVlKTsKICAgIHRoaXMuYm90dG9tSW5zZXQgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLmJvdHRvbUluc2V0LCAiMCIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxlZnRJbnNldCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubGVmdEluc2V0LCAiMCIpOwogICAgdGhpcy5yaWdodEluc2V0ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5yaWdodEluc2V0LCAiMCIpOwogICAgdGhpcy50b3BJbnNldCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMudG9wSW5zZXQsICIwIik7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KICBbJHRvU3R5bGVdKCkgewogICAgcmV0dXJuIHsKICAgICAgbWFyZ2luOiBtZWFzdXJlVG9TdHJpbmcodGhpcy50b3BJbnNldCkgKyAiICIgKyBtZWFzdXJlVG9TdHJpbmcodGhpcy5yaWdodEluc2V0KSArICIgIiArIG1lYXN1cmVUb1N0cmluZyh0aGlzLmJvdHRvbUluc2V0KSArICIgIiArIG1lYXN1cmVUb1N0cmluZyh0aGlzLmxlZnRJbnNldCkKICAgIH07CiAgfQp9CmNsYXNzIE1kcCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJtZHAiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5wZXJtaXNzaW9ucyA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnBlcm1pc3Npb25zLAogICAgICBkZWZhdWx0VmFsdWU6IDIsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEgfHwgeCA9PT0gMwogICAgfSk7CiAgICB0aGlzLnNpZ25hdHVyZVR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5zaWduYXR1cmVUeXBlLCBbImZpbGxlciIsICJhdXRob3IiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBNZWRpdW0gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAibWVkaXVtIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMuaW1hZ2luZ0JCb3ggPSBnZXRCQm94KGF0dHJpYnV0ZXMuaW1hZ2luZ0JCb3gpOwogICAgdGhpcy5sb25nID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5sb25nKTsKICAgIHRoaXMub3JpZW50YXRpb24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5vcmllbnRhdGlvbiwgWyJwb3J0cmFpdCIsICJsYW5kc2NhcGUiXSk7CiAgICB0aGlzLnNob3J0ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5zaG9ydCk7CiAgICB0aGlzLnN0b2NrID0gYXR0cmlidXRlcy5zdG9jayB8fCAiIjsKICAgIHRoaXMudHJheUluID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHJheUluLCBbImF1dG8iLCAiZGVsZWdhdGUiLCAicGFnZUZyb250Il0pOwogICAgdGhpcy50cmF5T3V0ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHJheU91dCwgWyJhdXRvIiwgImRlbGVnYXRlIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgTWVzc2FnZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJtZXNzYWdlIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnRleHQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgTnVtZXJpY0VkaXQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAibnVtZXJpY0VkaXQiLCB0cnVlKTsKICAgIHRoaXMuaFNjcm9sbFBvbGljeSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmhTY3JvbGxQb2xpY3ksIFsiYXV0byIsICJvZmYiLCAib24iXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmNvbWIgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAiYm9yZGVyIiwgImZvbnQiLCAibWFyZ2luIik7CiAgICBjb25zdCBmaWVsZCA9IHRoaXNbJGdldFBhcmVudF0oKVskZ2V0UGFyZW50XSgpOwogICAgY29uc3QgaHRtbCA9IHsKICAgICAgbmFtZTogImlucHV0IiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIHR5cGU6ICJ0ZXh0IiwKICAgICAgICBmaWVsZElkOiBmaWVsZFskdWlkXSwKICAgICAgICBkYXRhSWQ6IGZpZWxkWyRkYXRhXT8uWyR1aWRdIHx8IGZpZWxkWyR1aWRdLAogICAgICAgIGNsYXNzOiBbInhmYVRleHRmaWVsZCJdLAogICAgICAgIHN0eWxlLAogICAgICAgICJhcmlhLWxhYmVsIjogYXJpYUxhYmVsKGZpZWxkKSwKICAgICAgICAiYXJpYS1yZXF1aXJlZCI6IGZhbHNlCiAgICAgIH0KICAgIH07CiAgICBpZiAoaXNSZXF1aXJlZChmaWVsZCkpIHsKICAgICAgaHRtbC5hdHRyaWJ1dGVzWyJhcmlhLXJlcXVpcmVkIl0gPSB0cnVlOwogICAgICBodG1sLmF0dHJpYnV0ZXMucmVxdWlyZWQgPSB0cnVlOwogICAgfQogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgIG5hbWU6ICJsYWJlbCIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBjbGFzczogWyJ4ZmFMYWJlbCJdCiAgICAgIH0sCiAgICAgIGNoaWxkcmVuOiBbaHRtbF0KICAgIH0pOwogIH0KfQpjbGFzcyBPY2N1ciBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJvY2N1ciIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmluaXRpYWwgPSBhdHRyaWJ1dGVzLmluaXRpYWwgIT09ICIiID8gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuaW5pdGlhbCwKICAgICAgZGVmYXVsdFZhbHVlOiAiIiwKICAgICAgdmFsaWRhdGU6IHggPT4gdHJ1ZQogICAgfSkgOiAiIjsKICAgIHRoaXMubWF4ID0gYXR0cmlidXRlcy5tYXggIT09ICIiID8gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMubWF4LAogICAgICBkZWZhdWx0VmFsdWU6IDEsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHRydWUKICAgIH0pIDogIiI7CiAgICB0aGlzLm1pbiA9IGF0dHJpYnV0ZXMubWluICE9PSAiIiA/IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm1pbiwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogeCA9PiB0cnVlCiAgICB9KSA6ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9CiAgWyRjbGVhbl0oKSB7CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBvcmlnaW5hbE1pbiA9IHRoaXMubWluOwogICAgaWYgKHRoaXMubWluID09PSAiIikgewogICAgICB0aGlzLm1pbiA9IHBhcmVudCBpbnN0YW5jZW9mIFBhZ2VBcmVhIHx8IHBhcmVudCBpbnN0YW5jZW9mIFBhZ2VTZXQgPyAwIDogMTsKICAgIH0KICAgIGlmICh0aGlzLm1heCA9PT0gIiIpIHsKICAgICAgaWYgKG9yaWdpbmFsTWluID09PSAiIikgewogICAgICAgIHRoaXMubWF4ID0gcGFyZW50IGluc3RhbmNlb2YgUGFnZUFyZWEgfHwgcGFyZW50IGluc3RhbmNlb2YgUGFnZVNldCA/IC0xIDogMTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm1heCA9IHRoaXMubWluOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5tYXggIT09IC0xICYmIHRoaXMubWF4IDwgdGhpcy5taW4pIHsKICAgICAgdGhpcy5tYXggPSB0aGlzLm1pbjsKICAgIH0KICAgIGlmICh0aGlzLmluaXRpYWwgPT09ICIiKSB7CiAgICAgIHRoaXMuaW5pdGlhbCA9IHBhcmVudCBpbnN0YW5jZW9mIFRlbXBsYXRlID8gMSA6IHRoaXMubWluOwogICAgfQogIH0KfQpjbGFzcyBPaWQgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAib2lkIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIE9pZHMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAib2lkcyIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMub2lkID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIE92ZXJmbG93IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgIm92ZXJmbG93Iik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubGVhZGVyID0gYXR0cmlidXRlcy5sZWFkZXIgfHwgIiI7CiAgICB0aGlzLnRhcmdldCA9IGF0dHJpYnV0ZXMudGFyZ2V0IHx8ICIiOwogICAgdGhpcy50cmFpbGVyID0gYXR0cmlidXRlcy50cmFpbGVyIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgWyRnZXRFeHRyYV0oKSB7CiAgICBpZiAoIXRoaXNbJGV4dHJhXSkgewogICAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKCk7CiAgICAgIGNvbnN0IHJvb3QgPSB0aGlzWyRnZXRUZW1wbGF0ZVJvb3RdKCk7CiAgICAgIGNvbnN0IHRhcmdldCA9IHJvb3RbJHNlYXJjaE5vZGVdKHRoaXMudGFyZ2V0LCBwYXJlbnQpOwogICAgICBjb25zdCBsZWFkZXIgPSByb290WyRzZWFyY2hOb2RlXSh0aGlzLmxlYWRlciwgcGFyZW50KTsKICAgICAgY29uc3QgdHJhaWxlciA9IHJvb3RbJHNlYXJjaE5vZGVdKHRoaXMudHJhaWxlciwgcGFyZW50KTsKICAgICAgdGhpc1skZXh0cmFdID0gewogICAgICAgIHRhcmdldDogdGFyZ2V0Py5bMF0gfHwgbnVsbCwKICAgICAgICBsZWFkZXI6IGxlYWRlcj8uWzBdIHx8IG51bGwsCiAgICAgICAgdHJhaWxlcjogdHJhaWxlcj8uWzBdIHx8IG51bGwsCiAgICAgICAgYWRkTGVhZGVyOiBmYWxzZSwKICAgICAgICBhZGRUcmFpbGVyOiBmYWxzZQogICAgICB9OwogICAgfQogICAgcmV0dXJuIHRoaXNbJGV4dHJhXTsKICB9Cn0KY2xhc3MgUGFnZUFyZWEgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicGFnZUFyZWEiLCB0cnVlKTsKICAgIHRoaXMuYmxhbmtPck5vdEJsYW5rID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuYmxhbmtPck5vdEJsYW5rLCBbImFueSIsICJibGFuayIsICJub3RCbGFuayJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5pbml0aWFsTnVtYmVyID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuaW5pdGlhbE51bWJlciwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogeCA9PiB0cnVlCiAgICB9KTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMubnVtYmVyZWQgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5udW1iZXJlZCwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogeCA9PiB0cnVlCiAgICB9KTsKICAgIHRoaXMub2RkT3JFdmVuID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMub2RkT3JFdmVuLCBbImFueSIsICJldmVuIiwgIm9kZCJdKTsKICAgIHRoaXMucGFnZVBvc2l0aW9uID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMucGFnZVBvc2l0aW9uLCBbImFueSIsICJmaXJzdCIsICJsYXN0IiwgIm9ubHkiLCAicmVzdCJdKTsKICAgIHRoaXMucmVsZXZhbnQgPSBnZXRSZWxldmFudChhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmRlc2MgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tZWRpdW0gPSBudWxsOwogICAgdGhpcy5vY2N1ciA9IG51bGw7CiAgICB0aGlzLmFyZWEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY29udGVudEFyZWEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZHJhdyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leGNsR3JvdXAgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmllbGQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3ViZm9ybSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KICBbJGlzVXNhYmxlXSgpIHsKICAgIGlmICghdGhpc1skZXh0cmFdKSB7CiAgICAgIHRoaXNbJGV4dHJhXSA9IHsKICAgICAgICBudW1iZXJPZlVzZTogMAogICAgICB9OwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiAhdGhpcy5vY2N1ciB8fCB0aGlzLm9jY3VyLm1heCA9PT0gLTEgfHwgdGhpc1skZXh0cmFdLm51bWJlck9mVXNlIDwgdGhpcy5vY2N1ci5tYXg7CiAgfQogIFskY2xlYW5QYWdlXSgpIHsKICAgIGRlbGV0ZSB0aGlzWyRleHRyYV07CiAgfQogIFskZ2V0TmV4dFBhZ2VdKCkgewogICAgdGhpc1skZXh0cmFdIHx8PSB7CiAgICAgIG51bWJlck9mVXNlOiAwCiAgICB9OwogICAgY29uc3QgcGFyZW50ID0gdGhpc1skZ2V0UGFyZW50XSgpOwogICAgaWYgKHBhcmVudC5yZWxhdGlvbiA9PT0gIm9yZGVyZWRPY2N1cnJlbmNlIikgewogICAgICBpZiAodGhpc1skaXNVc2FibGVdKCkpIHsKICAgICAgICB0aGlzWyRleHRyYV0ubnVtYmVyT2ZVc2UgKz0gMTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHBhcmVudFskZ2V0TmV4dFBhZ2VdKCk7CiAgfQogIFskZ2V0QXZhaWxhYmxlU3BhY2VdKCkgewogICAgcmV0dXJuIHRoaXNbJGV4dHJhXS5zcGFjZSB8fCB7CiAgICAgIHdpZHRoOiAwLAogICAgICBoZWlnaHQ6IDAKICAgIH07CiAgfQogIFskdG9IVE1MXSgpIHsKICAgIHRoaXNbJGV4dHJhXSB8fD0gewogICAgICBudW1iZXJPZlVzZTogMQogICAgfTsKICAgIGNvbnN0IGNoaWxkcmVuID0gW107CiAgICB0aGlzWyRleHRyYV0uY2hpbGRyZW4gPSBjaGlsZHJlbjsKICAgIGNvbnN0IHN0eWxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGlmICh0aGlzLm1lZGl1bSAmJiB0aGlzLm1lZGl1bS5zaG9ydCAmJiB0aGlzLm1lZGl1bS5sb25nKSB7CiAgICAgIHN0eWxlLndpZHRoID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMubWVkaXVtLnNob3J0KTsKICAgICAgc3R5bGUuaGVpZ2h0ID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMubWVkaXVtLmxvbmcpOwogICAgICB0aGlzWyRleHRyYV0uc3BhY2UgPSB7CiAgICAgICAgd2lkdGg6IHRoaXMubWVkaXVtLnNob3J0LAogICAgICAgIGhlaWdodDogdGhpcy5tZWRpdW0ubG9uZwogICAgICB9OwogICAgICBpZiAodGhpcy5tZWRpdW0ub3JpZW50YXRpb24gPT09ICJsYW5kc2NhcGUiKSB7CiAgICAgICAgY29uc3QgeCA9IHN0eWxlLndpZHRoOwogICAgICAgIHN0eWxlLndpZHRoID0gc3R5bGUuaGVpZ2h0OwogICAgICAgIHN0eWxlLmhlaWdodCA9IHg7CiAgICAgICAgdGhpc1skZXh0cmFdLnNwYWNlID0gewogICAgICAgICAgd2lkdGg6IHRoaXMubWVkaXVtLmxvbmcsCiAgICAgICAgICBoZWlnaHQ6IHRoaXMubWVkaXVtLnNob3J0CiAgICAgICAgfTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgd2FybigiWEZBIC0gTm8gbWVkaXVtIHNwZWNpZmllZCBpbiBwYWdlQXJlYTogcGxlYXNlIGZpbGUgYSBidWcuIik7CiAgICB9CiAgICB0aGlzWyRjaGlsZHJlblRvSFRNTF0oewogICAgICBmaWx0ZXI6IG5ldyBTZXQoWyJhcmVhIiwgImRyYXciLCAiZmllbGQiLCAic3ViZm9ybSJdKSwKICAgICAgaW5jbHVkZTogdHJ1ZQogICAgfSk7CiAgICB0aGlzWyRjaGlsZHJlblRvSFRNTF0oewogICAgICBmaWx0ZXI6IG5ldyBTZXQoWyJjb250ZW50QXJlYSJdKSwKICAgICAgaW5jbHVkZTogdHJ1ZQogICAgfSk7CiAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGNoaWxkcmVuLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IFsieGZhUGFnZSJdLAogICAgICAgIGlkOiB0aGlzWyR1aWRdLAogICAgICAgIHN0eWxlLAogICAgICAgIHhmYU5hbWU6IHRoaXMubmFtZQogICAgICB9CiAgICB9KTsKICB9Cn0KY2xhc3MgUGFnZVNldCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJwYWdlU2V0IiwgdHJ1ZSk7CiAgICB0aGlzLmR1cGxleEltcG9zaXRpb24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5kdXBsZXhJbXBvc2l0aW9uLCBbImxvbmdFZGdlIiwgInNob3J0RWRnZSJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5yZWxhdGlvbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnJlbGF0aW9uLCBbIm9yZGVyZWRPY2N1cnJlbmNlIiwgImR1cGxleFBhZ2luYXRlZCIsICJzaW1wbGV4UGFnaW5hdGVkIl0pOwogICAgdGhpcy5yZWxldmFudCA9IGdldFJlbGV2YW50KGF0dHJpYnV0ZXMucmVsZXZhbnQpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMub2NjdXIgPSBudWxsOwogICAgdGhpcy5wYWdlQXJlYSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wYWdlU2V0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQogIFskY2xlYW5QYWdlXSgpIHsKICAgIGZvciAoY29uc3QgcGFnZSBvZiB0aGlzLnBhZ2VBcmVhLmNoaWxkcmVuKSB7CiAgICAgIHBhZ2VbJGNsZWFuUGFnZV0oKTsKICAgIH0KICAgIGZvciAoY29uc3QgcGFnZSBvZiB0aGlzLnBhZ2VTZXQuY2hpbGRyZW4pIHsKICAgICAgcGFnZVskY2xlYW5QYWdlXSgpOwogICAgfQogIH0KICBbJGlzVXNhYmxlXSgpIHsKICAgIHJldHVybiAhdGhpcy5vY2N1ciB8fCB0aGlzLm9jY3VyLm1heCA9PT0gLTEgfHwgdGhpc1skZXh0cmFdLm51bWJlck9mVXNlIDwgdGhpcy5vY2N1ci5tYXg7CiAgfQogIFskZ2V0TmV4dFBhZ2VdKCkgewogICAgdGhpc1skZXh0cmFdIHx8PSB7CiAgICAgIG51bWJlck9mVXNlOiAxLAogICAgICBwYWdlSW5kZXg6IC0xLAogICAgICBwYWdlU2V0SW5kZXg6IC0xCiAgICB9OwogICAgaWYgKHRoaXMucmVsYXRpb24gPT09ICJvcmRlcmVkT2NjdXJyZW5jZSIpIHsKICAgICAgaWYgKHRoaXNbJGV4dHJhXS5wYWdlSW5kZXggKyAxIDwgdGhpcy5wYWdlQXJlYS5jaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICB0aGlzWyRleHRyYV0ucGFnZUluZGV4ICs9IDE7CiAgICAgICAgY29uc3QgcGFnZUFyZWEgPSB0aGlzLnBhZ2VBcmVhLmNoaWxkcmVuW3RoaXNbJGV4dHJhXS5wYWdlSW5kZXhdOwogICAgICAgIHJldHVybiBwYWdlQXJlYVskZ2V0TmV4dFBhZ2VdKCk7CiAgICAgIH0KICAgICAgaWYgKHRoaXNbJGV4dHJhXS5wYWdlU2V0SW5kZXggKyAxIDwgdGhpcy5wYWdlU2V0LmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIHRoaXNbJGV4dHJhXS5wYWdlU2V0SW5kZXggKz0gMTsKICAgICAgICByZXR1cm4gdGhpcy5wYWdlU2V0LmNoaWxkcmVuW3RoaXNbJGV4dHJhXS5wYWdlU2V0SW5kZXhdWyRnZXROZXh0UGFnZV0oKTsKICAgICAgfQogICAgICBpZiAodGhpc1skaXNVc2FibGVdKCkpIHsKICAgICAgICB0aGlzWyRleHRyYV0ubnVtYmVyT2ZVc2UgKz0gMTsKICAgICAgICB0aGlzWyRleHRyYV0ucGFnZUluZGV4ID0gLTE7CiAgICAgICAgdGhpc1skZXh0cmFdLnBhZ2VTZXRJbmRleCA9IC0xOwogICAgICAgIHJldHVybiB0aGlzWyRnZXROZXh0UGFnZV0oKTsKICAgICAgfQogICAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKCk7CiAgICAgIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBQYWdlU2V0KSB7CiAgICAgICAgcmV0dXJuIHBhcmVudFskZ2V0TmV4dFBhZ2VdKCk7CiAgICAgIH0KICAgICAgdGhpc1skY2xlYW5QYWdlXSgpOwogICAgICByZXR1cm4gdGhpc1skZ2V0TmV4dFBhZ2VdKCk7CiAgICB9CiAgICBjb25zdCBwYWdlTnVtYmVyID0gdGhpc1skZ2V0VGVtcGxhdGVSb290XSgpWyRleHRyYV0ucGFnZU51bWJlcjsKICAgIGNvbnN0IHBhcml0eSA9IHBhZ2VOdW1iZXIgJSAyID09PSAwID8gImV2ZW4iIDogIm9kZCI7CiAgICBjb25zdCBwb3NpdGlvbiA9IHBhZ2VOdW1iZXIgPT09IDAgPyAiZmlyc3QiIDogInJlc3QiOwogICAgbGV0IHBhZ2UgPSB0aGlzLnBhZ2VBcmVhLmNoaWxkcmVuLmZpbmQocCA9PiBwLm9kZE9yRXZlbiA9PT0gcGFyaXR5ICYmIHAucGFnZVBvc2l0aW9uID09PSBwb3NpdGlvbik7CiAgICBpZiAocGFnZSkgewogICAgICByZXR1cm4gcGFnZTsKICAgIH0KICAgIHBhZ2UgPSB0aGlzLnBhZ2VBcmVhLmNoaWxkcmVuLmZpbmQocCA9PiBwLm9kZE9yRXZlbiA9PT0gImFueSIgJiYgcC5wYWdlUG9zaXRpb24gPT09IHBvc2l0aW9uKTsKICAgIGlmIChwYWdlKSB7CiAgICAgIHJldHVybiBwYWdlOwogICAgfQogICAgcGFnZSA9IHRoaXMucGFnZUFyZWEuY2hpbGRyZW4uZmluZChwID0+IHAub2RkT3JFdmVuID09PSAiYW55IiAmJiBwLnBhZ2VQb3NpdGlvbiA9PT0gImFueSIpOwogICAgaWYgKHBhZ2UpIHsKICAgICAgcmV0dXJuIHBhZ2U7CiAgICB9CiAgICByZXR1cm4gdGhpcy5wYWdlQXJlYS5jaGlsZHJlblswXTsKICB9Cn0KY2xhc3MgUGFyYSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJwYXJhIiwgdHJ1ZSk7CiAgICB0aGlzLmhBbGlnbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmhBbGlnbiwgWyJsZWZ0IiwgImNlbnRlciIsICJqdXN0aWZ5IiwgImp1c3RpZnlBbGwiLCAicmFkaXgiLCAicmlnaHQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubGluZUhlaWdodCA9IGF0dHJpYnV0ZXMubGluZUhlaWdodCA/IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubGluZUhlaWdodCwgIjBwdCIpIDogIiI7CiAgICB0aGlzLm1hcmdpbkxlZnQgPSBhdHRyaWJ1dGVzLm1hcmdpbkxlZnQgPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1hcmdpbkxlZnQsICIwcHQiKSA6ICIiOwogICAgdGhpcy5tYXJnaW5SaWdodCA9IGF0dHJpYnV0ZXMubWFyZ2luUmlnaHQgPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1hcmdpblJpZ2h0LCAiMHB0IikgOiAiIjsKICAgIHRoaXMub3JwaGFucyA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm9ycGhhbnMsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwCiAgICB9KTsKICAgIHRoaXMucHJlc2VydmUgPSBhdHRyaWJ1dGVzLnByZXNlcnZlIHx8ICIiOwogICAgdGhpcy5yYWRpeE9mZnNldCA9IGF0dHJpYnV0ZXMucmFkaXhPZmZzZXQgPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnJhZGl4T2Zmc2V0LCAiMHB0IikgOiAiIjsKICAgIHRoaXMuc3BhY2VBYm92ZSA9IGF0dHJpYnV0ZXMuc3BhY2VBYm92ZSA/IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMuc3BhY2VBYm92ZSwgIjBwdCIpIDogIiI7CiAgICB0aGlzLnNwYWNlQmVsb3cgPSBhdHRyaWJ1dGVzLnNwYWNlQmVsb3cgPyBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnNwYWNlQmVsb3csICIwcHQiKSA6ICIiOwogICAgdGhpcy50YWJEZWZhdWx0ID0gYXR0cmlidXRlcy50YWJEZWZhdWx0ID8gZ2V0TWVhc3VyZW1lbnQodGhpcy50YWJEZWZhdWx0KSA6ICIiOwogICAgdGhpcy50YWJTdG9wcyA9IChhdHRyaWJ1dGVzLnRhYlN0b3BzIHx8ICIiKS50cmltKCkuc3BsaXQoL1xzKy8pLm1hcCgoeCwgaSkgPT4gaSAlIDIgPT09IDEgPyBnZXRNZWFzdXJlbWVudCh4KSA6IHgpOwogICAgdGhpcy50ZXh0SW5kZW50ID0gYXR0cmlidXRlcy50ZXh0SW5kZW50ID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy50ZXh0SW5kZW50LCAiMHB0IikgOiAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnZBbGlnbiA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnZBbGlnbiwgWyJ0b3AiLCAiYm90dG9tIiwgIm1pZGRsZSJdKTsKICAgIHRoaXMud2lkb3dzID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMud2lkb3dzLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLmh5cGhlbmF0aW9uID0gbnVsbDsKICB9CiAgWyR0b1N0eWxlXSgpIHsKICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAiaEFsaWduIik7CiAgICBpZiAodGhpcy5tYXJnaW5MZWZ0ICE9PSAiIikgewogICAgICBzdHlsZS5wYWRkaW5nTGVmdCA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLm1hcmdpbkxlZnQpOwogICAgfQogICAgaWYgKHRoaXMubWFyZ2luUmlnaHQgIT09ICIiKSB7CiAgICAgIHN0eWxlLnBhZGRpbmdSaWdodCA9IG1lYXN1cmVUb1N0cmluZyh0aGlzLm1hcmdpblJpZ2h0KTsKICAgIH0KICAgIGlmICh0aGlzLnNwYWNlQWJvdmUgIT09ICIiKSB7CiAgICAgIHN0eWxlLnBhZGRpbmdUb3AgPSBtZWFzdXJlVG9TdHJpbmcodGhpcy5zcGFjZUFib3ZlKTsKICAgIH0KICAgIGlmICh0aGlzLnNwYWNlQmVsb3cgIT09ICIiKSB7CiAgICAgIHN0eWxlLnBhZGRpbmdCb3R0b20gPSBtZWFzdXJlVG9TdHJpbmcodGhpcy5zcGFjZUJlbG93KTsKICAgIH0KICAgIGlmICh0aGlzLnRleHRJbmRlbnQgIT09ICIiKSB7CiAgICAgIHN0eWxlLnRleHRJbmRlbnQgPSBtZWFzdXJlVG9TdHJpbmcodGhpcy50ZXh0SW5kZW50KTsKICAgICAgZml4VGV4dEluZGVudChzdHlsZSk7CiAgICB9CiAgICBpZiAodGhpcy5saW5lSGVpZ2h0ID4gMCkgewogICAgICBzdHlsZS5saW5lSGVpZ2h0ID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMubGluZUhlaWdodCk7CiAgICB9CiAgICBpZiAodGhpcy50YWJEZWZhdWx0ICE9PSAiIikgewogICAgICBzdHlsZS50YWJTaXplID0gbWVhc3VyZVRvU3RyaW5nKHRoaXMudGFiRGVmYXVsdCk7CiAgICB9CiAgICBpZiAodGhpcy50YWJTdG9wcy5sZW5ndGggPiAwKSB7fQogICAgaWYgKHRoaXMuaHlwaGVuYXRhdGlvbikgewogICAgICBPYmplY3QuYXNzaWduKHN0eWxlLCB0aGlzLmh5cGhlbmF0YXRpb25bJHRvU3R5bGVdKCkpOwogICAgfQogICAgcmV0dXJuIHN0eWxlOwogIH0KfQpjbGFzcyBQYXNzd29yZEVkaXQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicGFzc3dvcmRFZGl0IiwgdHJ1ZSk7CiAgICB0aGlzLmhTY3JvbGxQb2xpY3kgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oU2Nyb2xsUG9saWN5LCBbImF1dG8iLCAib2ZmIiwgIm9uIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnBhc3N3b3JkQ2hhciA9IGF0dHJpYnV0ZXMucGFzc3dvcmRDaGFyIHx8ICIqIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgfQp9CmNsYXNzIHRlbXBsYXRlX1BhdHRlcm4gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicGF0dGVybiIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbImNyb3NzSGF0Y2giLCAiY3Jvc3NEaWFnb25hbCIsICJkaWFnb25hbExlZnQiLCAiZGlhZ29uYWxSaWdodCIsICJob3Jpem9udGFsIiwgInZlcnRpY2FsIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY29sb3IgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KICBbJHRvU3R5bGVdKHN0YXJ0Q29sb3IpIHsKICAgIHN0YXJ0Q29sb3IgPSBzdGFydENvbG9yID8gc3RhcnRDb2xvclskdG9TdHlsZV0oKSA6ICIjRkZGRkZGIjsKICAgIGNvbnN0IGVuZENvbG9yID0gdGhpcy5jb2xvciA/IHRoaXMuY29sb3JbJHRvU3R5bGVdKCkgOiAiIzAwMDAwMCI7CiAgICBjb25zdCB3aWR0aCA9IDU7CiAgICBjb25zdCBjbWQgPSAicmVwZWF0aW5nLWxpbmVhci1ncmFkaWVudCI7CiAgICBjb25zdCBjb2xvcnMgPSBgJHtzdGFydENvbG9yfSwke3N0YXJ0Q29sb3J9ICR7d2lkdGh9cHgsJHtlbmRDb2xvcn0gJHt3aWR0aH1weCwke2VuZENvbG9yfSAkezIgKiB3aWR0aH1weGA7CiAgICBzd2l0Y2ggKHRoaXMudHlwZSkgewogICAgICBjYXNlICJjcm9zc0hhdGNoIjoKICAgICAgICByZXR1cm4gYCR7Y21kfSh0byB0b3AsJHtjb2xvcnN9KSAke2NtZH0odG8gcmlnaHQsJHtjb2xvcnN9KWA7CiAgICAgIGNhc2UgImNyb3NzRGlhZ29uYWwiOgogICAgICAgIHJldHVybiBgJHtjbWR9KDQ1ZGVnLCR7Y29sb3JzfSkgJHtjbWR9KC00NWRlZywke2NvbG9yc30pYDsKICAgICAgY2FzZSAiZGlhZ29uYWxMZWZ0IjoKICAgICAgICByZXR1cm4gYCR7Y21kfSg0NWRlZywke2NvbG9yc30pYDsKICAgICAgY2FzZSAiZGlhZ29uYWxSaWdodCI6CiAgICAgICAgcmV0dXJuIGAke2NtZH0oLTQ1ZGVnLCR7Y29sb3JzfSlgOwogICAgICBjYXNlICJob3Jpem9udGFsIjoKICAgICAgICByZXR1cm4gYCR7Y21kfSh0byB0b3AsJHtjb2xvcnN9KWA7CiAgICAgIGNhc2UgInZlcnRpY2FsIjoKICAgICAgICByZXR1cm4gYCR7Y21kfSh0byByaWdodCwke2NvbG9yc30pYDsKICAgIH0KICAgIHJldHVybiAiIjsKICB9Cn0KY2xhc3MgUGljdHVyZSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJwaWN0dXJlIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIFByb3RvIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInByb3RvIiwgdHJ1ZSk7CiAgICB0aGlzLmFwcGVhcmFuY2VGaWx0ZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYXJjID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmFyZWEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYXNzaXN0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJhcmNvZGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYmluZEl0ZW1zID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJvb2tlbmQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYm9vbGVhbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5ib3JkZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYnJlYWsgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYnJlYWtBZnRlciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5icmVha0JlZm9yZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5idXR0b24gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY2FsY3VsYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNhcHRpb24gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY2VydGlmaWNhdGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY2VydGlmaWNhdGVzID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNoZWNrQnV0dG9uID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNob2ljZUxpc3QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY29sb3IgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY29tYiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5jb25uZWN0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNvbnRlbnRBcmVhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNvcm5lciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGVUaW1lID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGVUaW1lRWRpdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kZWNpbWFsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRlZmF1bHRVaSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kZXNjID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRpZ2VzdE1ldGhvZCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kaWdlc3RNZXRob2RzID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRyYXcgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZWRnZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5lbmNvZGluZyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5lbmNvZGluZ3MgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZW5jcnlwdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5lbmNyeXB0RGF0YSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5lbmNyeXB0aW9uID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmVuY3J5cHRpb25NZXRob2QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZW5jcnlwdGlvbk1ldGhvZHMgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXZlbnQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhEYXRhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4T2JqZWN0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4Y2xHcm91cCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leGVjdXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4dHJhcyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5maWVsZCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5maWxsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmZpbHRlciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5mbG9hdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5mb250ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmZvcm1hdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5oYW5kbGVyID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmh5cGhlbmF0aW9uID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmltYWdlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmltYWdlRWRpdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbnRlZ2VyID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmlzc3VlcnMgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaXRlbXMgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMua2VlcCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5rZXlVc2FnZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5saW5lID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmxpbmVhciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5sb2NrRG9jdW1lbnQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubWFuaWZlc3QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubWFyZ2luID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLm1kcCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5tZWRpdW0gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubWVzc2FnZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5udW1lcmljRWRpdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5vY2N1ciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5vaWQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMub2lkcyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5vdmVyZmxvdyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wYWdlQXJlYSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wYWdlU2V0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnBhcmEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucGFzc3dvcmRFZGl0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnBhdHRlcm4gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucGljdHVyZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5yYWRpYWwgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucmVhc29uID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnJlYXNvbnMgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucmVjdGFuZ2xlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnJlZiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zY3JpcHQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2V0UHJvcGVydHkgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2lnbkRhdGEgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2lnbmF0dXJlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNpZ25pbmcgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc29saWQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3BlYWsgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3RpcHBsZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJmb3JtID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1YmZvcm1TZXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3ViamVjdEROID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1YmplY3RETnMgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3VibWl0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRleHQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGV4dEVkaXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGltZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50aW1lU3RhbXAgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudG9vbFRpcCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50cmF2ZXJzYWwgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudHJhdmVyc2UgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudWkgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudmFsaWRhdGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudmFsdWUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudmFyaWFibGVzID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIFJhZGlhbCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJyYWRpYWwiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJ0b0VkZ2UiLCAidG9DZW50ZXIiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jb2xvciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFskdG9TdHlsZV0oc3RhcnRDb2xvcikgewogICAgc3RhcnRDb2xvciA9IHN0YXJ0Q29sb3IgPyBzdGFydENvbG9yWyR0b1N0eWxlXSgpIDogIiNGRkZGRkYiOwogICAgY29uc3QgZW5kQ29sb3IgPSB0aGlzLmNvbG9yID8gdGhpcy5jb2xvclskdG9TdHlsZV0oKSA6ICIjMDAwMDAwIjsKICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMudHlwZSA9PT0gInRvRWRnZSIgPyBgJHtzdGFydENvbG9yfSwke2VuZENvbG9yfWAgOiBgJHtlbmRDb2xvcn0sJHtzdGFydENvbG9yfWA7CiAgICByZXR1cm4gYHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgY2VudGVyLCAke2NvbG9yc30pYDsKICB9Cn0KY2xhc3MgUmVhc29uIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInJlYXNvbiIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBSZWFzb25zIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInJlYXNvbnMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnJlYXNvbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBSZWN0YW5nbGUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicmVjdGFuZ2xlIiwgdHJ1ZSk7CiAgICB0aGlzLmhhbmQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oYW5kLCBbImV2ZW4iLCAibGVmdCIsICJyaWdodCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY29ybmVyID0gbmV3IFhGQU9iamVjdEFycmF5KDQpOwogICAgdGhpcy5lZGdlID0gbmV3IFhGQU9iamVjdEFycmF5KDQpOwogICAgdGhpcy5maWxsID0gbnVsbDsKICB9CiAgWyR0b0hUTUxdKCkgewogICAgY29uc3QgZWRnZSA9IHRoaXMuZWRnZS5jaGlsZHJlbi5sZW5ndGggPyB0aGlzLmVkZ2UuY2hpbGRyZW5bMF0gOiBuZXcgRWRnZSh7fSk7CiAgICBjb25zdCBlZGdlU3R5bGUgPSBlZGdlWyR0b1N0eWxlXSgpOwogICAgY29uc3Qgc3R5bGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgaWYgKHRoaXMuZmlsbD8ucHJlc2VuY2UgPT09ICJ2aXNpYmxlIikgewogICAgICBPYmplY3QuYXNzaWduKHN0eWxlLCB0aGlzLmZpbGxbJHRvU3R5bGVdKCkpOwogICAgfSBlbHNlIHsKICAgICAgc3R5bGUuZmlsbCA9ICJ0cmFuc3BhcmVudCI7CiAgICB9CiAgICBzdHlsZS5zdHJva2VXaWR0aCA9IG1lYXN1cmVUb1N0cmluZyhlZGdlLnByZXNlbmNlID09PSAidmlzaWJsZSIgPyBlZGdlLnRoaWNrbmVzcyA6IDApOwogICAgc3R5bGUuc3Ryb2tlID0gZWRnZVN0eWxlLmNvbG9yOwogICAgY29uc3QgY29ybmVyID0gdGhpcy5jb3JuZXIuY2hpbGRyZW4ubGVuZ3RoID8gdGhpcy5jb3JuZXIuY2hpbGRyZW5bMF0gOiBuZXcgQ29ybmVyKHt9KTsKICAgIGNvbnN0IGNvcm5lclN0eWxlID0gY29ybmVyWyR0b1N0eWxlXSgpOwogICAgY29uc3QgcmVjdCA9IHsKICAgICAgbmFtZTogInJlY3QiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgeG1sbnM6IFNWR19OUywKICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgIGhlaWdodDogIjEwMCUiLAogICAgICAgIHg6IDAsCiAgICAgICAgeTogMCwKICAgICAgICByeDogY29ybmVyU3R5bGUucmFkaXVzLAogICAgICAgIHJ5OiBjb3JuZXJTdHlsZS5yYWRpdXMsCiAgICAgICAgc3R5bGUKICAgICAgfQogICAgfTsKICAgIGNvbnN0IHN2ZyA9IHsKICAgICAgbmFtZTogInN2ZyIsCiAgICAgIGNoaWxkcmVuOiBbcmVjdF0sCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICB4bWxuczogU1ZHX05TLAogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICBvdmVyZmxvdzogInZpc2libGUiCiAgICAgICAgfSwKICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgIGhlaWdodDogIjEwMCUiCiAgICAgIH0KICAgIH07CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKClbJGdldFBhcmVudF0oKTsKICAgIGlmIChoYXNNYXJnaW4ocGFyZW50KSkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgICBuYW1lOiAiZGl2IiwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lIiwKICAgICAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICAgICAgaGVpZ2h0OiAiMTAwJSIKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNoaWxkcmVuOiBbc3ZnXQogICAgICB9KTsKICAgIH0KICAgIHN2Zy5hdHRyaWJ1dGVzLnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3Moc3ZnKTsKICB9Cn0KY2xhc3MgUmVmRWxlbWVudCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJyZWYiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgU2NyaXB0IGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInNjcmlwdCIpOwogICAgdGhpcy5iaW5kaW5nID0gYXR0cmlidXRlcy5iaW5kaW5nIHx8ICIiOwogICAgdGhpcy5jb250ZW50VHlwZSA9IGF0dHJpYnV0ZXMuY29udGVudFR5cGUgfHwgIiI7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucnVuQXQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5ydW5BdCwgWyJjbGllbnQiLCAiYm90aCIsICJzZXJ2ZXIiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBTZXRQcm9wZXJ0eSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzZXRQcm9wZXJ0eSIpOwogICAgdGhpcy5jb25uZWN0aW9uID0gYXR0cmlidXRlcy5jb25uZWN0aW9uIHx8ICIiOwogICAgdGhpcy5yZWYgPSBhdHRyaWJ1dGVzLnJlZiB8fCAiIjsKICAgIHRoaXMudGFyZ2V0ID0gYXR0cmlidXRlcy50YXJnZXQgfHwgIiI7CiAgfQp9CmNsYXNzIFNpZ25EYXRhIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInNpZ25EYXRhIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMub3BlcmF0aW9uID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMub3BlcmF0aW9uLCBbInNpZ24iLCAiY2xlYXIiLCAidmVyaWZ5Il0pOwogICAgdGhpcy5yZWYgPSBhdHRyaWJ1dGVzLnJlZiB8fCAiIjsKICAgIHRoaXMudGFyZ2V0ID0gYXR0cmlidXRlcy50YXJnZXQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5maWx0ZXIgPSBudWxsOwogICAgdGhpcy5tYW5pZmVzdCA9IG51bGw7CiAgfQp9CmNsYXNzIFNpZ25hdHVyZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzaWduYXR1cmUiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJQREYxLjMiLCAiUERGMS42Il0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9yZGVyID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuZmlsdGVyID0gbnVsbDsKICAgIHRoaXMubWFuaWZlc3QgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogIH0KfQpjbGFzcyBTaWduaW5nIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInNpZ25pbmciLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNlcnRpZmljYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIFNvbGlkIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInNvbGlkIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFskdG9TdHlsZV0oc3RhcnRDb2xvcikgewogICAgcmV0dXJuIHN0YXJ0Q29sb3IgPyBzdGFydENvbG9yWyR0b1N0eWxlXSgpIDogIiNGRkZGRkYiOwogIH0KfQpjbGFzcyBTcGVhayBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzcGVhayIpOwogICAgdGhpcy5kaXNhYmxlID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZGlzYWJsZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5wcmlvcml0eSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnByaW9yaXR5LCBbImN1c3RvbSIsICJjYXB0aW9uIiwgIm5hbWUiLCAidG9vbFRpcCJdKTsKICAgIHRoaXMucmlkID0gYXR0cmlidXRlcy5yaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBTdGlwcGxlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInN0aXBwbGUiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5yYXRlID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMucmF0ZSwKICAgICAgZGVmYXVsdFZhbHVlOiA1MCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwICYmIHggPD0gMTAwCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNvbG9yID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9CiAgWyR0b1N0eWxlXShiZ0NvbG9yKSB7CiAgICBjb25zdCBhbHBoYSA9IHRoaXMucmF0ZSAvIDEwMDsKICAgIHJldHVybiBVdGlsLm1ha2VIZXhDb2xvcihNYXRoLnJvdW5kKGJnQ29sb3IudmFsdWUuciAqICgxIC0gYWxwaGEpICsgdGhpcy52YWx1ZS5yICogYWxwaGEpLCBNYXRoLnJvdW5kKGJnQ29sb3IudmFsdWUuZyAqICgxIC0gYWxwaGEpICsgdGhpcy52YWx1ZS5nICogYWxwaGEpLCBNYXRoLnJvdW5kKGJnQ29sb3IudmFsdWUuYiAqICgxIC0gYWxwaGEpICsgdGhpcy52YWx1ZS5iICogYWxwaGEpKTsKICB9Cn0KY2xhc3MgU3ViZm9ybSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzdWJmb3JtIiwgdHJ1ZSk7CiAgICB0aGlzLmFjY2VzcyA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmFjY2VzcywgWyJvcGVuIiwgIm5vbkludGVyYWN0aXZlIiwgInByb3RlY3RlZCIsICJyZWFkT25seSJdKTsKICAgIHRoaXMuYWxsb3dNYWNybyA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmFsbG93TWFjcm8sCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmFuY2hvclR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5hbmNob3JUeXBlLCBbInRvcExlZnQiLCAiYm90dG9tQ2VudGVyIiwgImJvdHRvbUxlZnQiLCAiYm90dG9tUmlnaHQiLCAibWlkZGxlQ2VudGVyIiwgIm1pZGRsZUxlZnQiLCAibWlkZGxlUmlnaHQiLCAidG9wQ2VudGVyIiwgInRvcFJpZ2h0Il0pOwogICAgdGhpcy5jb2xTcGFuID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuY29sU3BhbiwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogbiA9PiBuID49IDEgfHwgbiA9PT0gLTEKICAgIH0pOwogICAgdGhpcy5jb2x1bW5XaWR0aHMgPSAoYXR0cmlidXRlcy5jb2x1bW5XaWR0aHMgfHwgIiIpLnRyaW0oKS5zcGxpdCgvXHMrLykubWFwKHggPT4geCA9PT0gIi0xIiA/IC0xIDogZ2V0TWVhc3VyZW1lbnQoeCkpOwogICAgdGhpcy5oID0gYXR0cmlidXRlcy5oID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5oKSA6ICIiOwogICAgdGhpcy5oQWxpZ24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5oQWxpZ24sIFsibGVmdCIsICJjZW50ZXIiLCAianVzdGlmeSIsICJqdXN0aWZ5QWxsIiwgInJhZGl4IiwgInJpZ2h0Il0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxheW91dCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmxheW91dCwgWyJwb3NpdGlvbiIsICJsci10YiIsICJybC1yb3ciLCAicmwtdGIiLCAicm93IiwgInRhYmxlIiwgInRiIl0pOwogICAgdGhpcy5sb2NhbGUgPSBhdHRyaWJ1dGVzLmxvY2FsZSB8fCAiIjsKICAgIHRoaXMubWF4SCA9IGdldE1lYXN1cmVtZW50KGF0dHJpYnV0ZXMubWF4SCwgIjBwdCIpOwogICAgdGhpcy5tYXhXID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5tYXhXLCAiMHB0Iik7CiAgICB0aGlzLm1lcmdlTW9kZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm1lcmdlTW9kZSwgWyJjb25zdW1lRGF0YSIsICJtYXRjaFRlbXBsYXRlIl0pOwogICAgdGhpcy5taW5IID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy5taW5ILCAiMHB0Iik7CiAgICB0aGlzLm1pblcgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLm1pblcsICIwcHQiKTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucHJlc2VuY2UgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5wcmVzZW5jZSwgWyJ2aXNpYmxlIiwgImhpZGRlbiIsICJpbmFjdGl2ZSIsICJpbnZpc2libGUiXSk7CiAgICB0aGlzLnJlbGV2YW50ID0gZ2V0UmVsZXZhbnQoYXR0cmlidXRlcy5yZWxldmFudCk7CiAgICB0aGlzLnJlc3RvcmVTdGF0ZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnJlc3RvcmVTdGF0ZSwgWyJtYW51YWwiLCAiYXV0byJdKTsKICAgIHRoaXMuc2NvcGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5zY29wZSwgWyJuYW1lIiwgIm5vbmUiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy53ID0gYXR0cmlidXRlcy53ID8gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy53KSA6ICIiOwogICAgdGhpcy54ID0gZ2V0TWVhc3VyZW1lbnQoYXR0cmlidXRlcy54LCAiMHB0Iik7CiAgICB0aGlzLnkgPSBnZXRNZWFzdXJlbWVudChhdHRyaWJ1dGVzLnksICIwcHQiKTsKICAgIHRoaXMuYXNzaXN0ID0gbnVsbDsKICAgIHRoaXMuYmluZCA9IG51bGw7CiAgICB0aGlzLmJvb2tlbmQgPSBudWxsOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5icmVhayA9IG51bGw7CiAgICB0aGlzLmNhbGN1bGF0ZSA9IG51bGw7CiAgICB0aGlzLmRlc2MgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5rZWVwID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICAgIHRoaXMub2NjdXIgPSBudWxsOwogICAgdGhpcy5vdmVyZmxvdyA9IG51bGw7CiAgICB0aGlzLnBhZ2VTZXQgPSBudWxsOwogICAgdGhpcy5wYXJhID0gbnVsbDsKICAgIHRoaXMudHJhdmVyc2FsID0gbnVsbDsKICAgIHRoaXMudmFsaWRhdGUgPSBudWxsOwogICAgdGhpcy52YXJpYWJsZXMgPSBudWxsOwogICAgdGhpcy5hcmVhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJyZWFrQWZ0ZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYnJlYWtCZWZvcmUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY29ubmVjdCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kcmF3ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV2ZW50ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4T2JqZWN0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4Y2xHcm91cCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5maWVsZCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wcm90byA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zZXRQcm9wZXJ0eSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJmb3JtID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1YmZvcm1TZXQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9CiAgWyRnZXRTdWJmb3JtUGFyZW50XSgpIHsKICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbJGdldFBhcmVudF0oKTsKICAgIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBTdWJmb3JtU2V0KSB7CiAgICAgIHJldHVybiBwYXJlbnRbJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgICB9CiAgICByZXR1cm4gcGFyZW50OwogIH0KICBbJGlzQmluZGFibGVdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIFskaXNUaGVyZU1vcmVXaWR0aF0oKSB7CiAgICByZXR1cm4gdGhpcy5sYXlvdXQuZW5kc1dpdGgoIi10YiIpICYmIHRoaXNbJGV4dHJhXS5hdHRlbXB0ID09PSAwICYmIHRoaXNbJGV4dHJhXS5udW1iZXJJbkxpbmUgPiAwIHx8IHRoaXNbJGdldFBhcmVudF0oKVskaXNUaGVyZU1vcmVXaWR0aF0oKTsKICB9CiAgKlskZ2V0Q29udGFpbmVkQ2hpbGRyZW5dKCkgewogICAgeWllbGQqIGdldENvbnRhaW5lZENoaWxkcmVuKHRoaXMpOwogIH0KICBbJGZsdXNoSFRNTF0oKSB7CiAgICByZXR1cm4gZmx1c2hIVE1MKHRoaXMpOwogIH0KICBbJGFkZEhUTUxdKGh0bWwsIGJib3gpIHsKICAgIGFkZEhUTUwodGhpcywgaHRtbCwgYmJveCk7CiAgfQogIFskZ2V0QXZhaWxhYmxlU3BhY2VdKCkgewogICAgcmV0dXJuIGdldEF2YWlsYWJsZVNwYWNlKHRoaXMpOwogIH0KICBbJGlzU3BsaXR0YWJsZV0oKSB7CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzWyRnZXRTdWJmb3JtUGFyZW50XSgpOwogICAgaWYgKCFwYXJlbnRbJGlzU3BsaXR0YWJsZV0oKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpc1skZXh0cmFdLl9pc1NwbGl0dGFibGUgIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gdGhpc1skZXh0cmFdLl9pc1NwbGl0dGFibGU7CiAgICB9CiAgICBpZiAodGhpcy5sYXlvdXQgPT09ICJwb3NpdGlvbiIgfHwgdGhpcy5sYXlvdXQuaW5jbHVkZXMoInJvdyIpKSB7CiAgICAgIHRoaXNbJGV4dHJhXS5faXNTcGxpdHRhYmxlID0gZmFsc2U7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzLmtlZXAgJiYgdGhpcy5rZWVwLmludGFjdCAhPT0gIm5vbmUiKSB7CiAgICAgIHRoaXNbJGV4dHJhXS5faXNTcGxpdHRhYmxlID0gZmFsc2U7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmIChwYXJlbnQubGF5b3V0Py5lbmRzV2l0aCgiLXRiIikgJiYgcGFyZW50WyRleHRyYV0ubnVtYmVySW5MaW5lICE9PSAwKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRoaXNbJGV4dHJhXS5faXNTcGxpdHRhYmxlID0gdHJ1ZTsKICAgIHJldHVybiB0cnVlOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHNldFRhYkluZGV4KHRoaXMpOwogICAgaWYgKHRoaXMuYnJlYWspIHsKICAgICAgaWYgKHRoaXMuYnJlYWsuYWZ0ZXIgIT09ICJhdXRvIiB8fCB0aGlzLmJyZWFrLmFmdGVyVGFyZ2V0ICE9PSAiIikgewogICAgICAgIGNvbnN0IG5vZGUgPSBuZXcgQnJlYWtBZnRlcih7CiAgICAgICAgICB0YXJnZXRUeXBlOiB0aGlzLmJyZWFrLmFmdGVyLAogICAgICAgICAgdGFyZ2V0OiB0aGlzLmJyZWFrLmFmdGVyVGFyZ2V0LAogICAgICAgICAgc3RhcnROZXc6IHRoaXMuYnJlYWsuc3RhcnROZXcudG9TdHJpbmcoKQogICAgICAgIH0pOwogICAgICAgIG5vZGVbJGdsb2JhbERhdGFdID0gdGhpc1skZ2xvYmFsRGF0YV07CiAgICAgICAgdGhpc1skYXBwZW5kQ2hpbGRdKG5vZGUpOwogICAgICAgIHRoaXMuYnJlYWtBZnRlci5wdXNoKG5vZGUpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmJyZWFrLmJlZm9yZSAhPT0gImF1dG8iIHx8IHRoaXMuYnJlYWsuYmVmb3JlVGFyZ2V0ICE9PSAiIikgewogICAgICAgIGNvbnN0IG5vZGUgPSBuZXcgQnJlYWtCZWZvcmUoewogICAgICAgICAgdGFyZ2V0VHlwZTogdGhpcy5icmVhay5iZWZvcmUsCiAgICAgICAgICB0YXJnZXQ6IHRoaXMuYnJlYWsuYmVmb3JlVGFyZ2V0LAogICAgICAgICAgc3RhcnROZXc6IHRoaXMuYnJlYWsuc3RhcnROZXcudG9TdHJpbmcoKQogICAgICAgIH0pOwogICAgICAgIG5vZGVbJGdsb2JhbERhdGFdID0gdGhpc1skZ2xvYmFsRGF0YV07CiAgICAgICAgdGhpc1skYXBwZW5kQ2hpbGRdKG5vZGUpOwogICAgICAgIHRoaXMuYnJlYWtCZWZvcmUucHVzaChub2RlKTsKICAgICAgfQogICAgICBpZiAodGhpcy5icmVhay5vdmVyZmxvd1RhcmdldCAhPT0gIiIpIHsKICAgICAgICBjb25zdCBub2RlID0gbmV3IE92ZXJmbG93KHsKICAgICAgICAgIHRhcmdldDogdGhpcy5icmVhay5vdmVyZmxvd1RhcmdldCwKICAgICAgICAgIGxlYWRlcjogdGhpcy5icmVhay5vdmVyZmxvd0xlYWRlciwKICAgICAgICAgIHRyYWlsZXI6IHRoaXMuYnJlYWsub3ZlcmZsb3dUcmFpbGVyCiAgICAgICAgfSk7CiAgICAgICAgbm9kZVskZ2xvYmFsRGF0YV0gPSB0aGlzWyRnbG9iYWxEYXRhXTsKICAgICAgICB0aGlzWyRhcHBlbmRDaGlsZF0obm9kZSk7CiAgICAgICAgdGhpcy5vdmVyZmxvdy5wdXNoKG5vZGUpOwogICAgICB9CiAgICAgIHRoaXNbJHJlbW92ZUNoaWxkXSh0aGlzLmJyZWFrKTsKICAgICAgdGhpcy5icmVhayA9IG51bGw7CiAgICB9CiAgICBpZiAodGhpcy5wcmVzZW5jZSA9PT0gImhpZGRlbiIgfHwgdGhpcy5wcmVzZW5jZSA9PT0gImluYWN0aXZlIikgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGlmICh0aGlzLmJyZWFrQmVmb3JlLmNoaWxkcmVuLmxlbmd0aCA+IDEgfHwgdGhpcy5icmVha0FmdGVyLmNoaWxkcmVuLmxlbmd0aCA+IDEpIHsKICAgICAgd2FybigiWEZBIC0gU2V2ZXJhbCBicmVha0JlZm9yZSBvciBicmVha0FmdGVyIGluIHN1YmZvcm1zOiBwbGVhc2UgZmlsZSBhIGJ1Zy4iKTsKICAgIH0KICAgIGlmICh0aGlzLmJyZWFrQmVmb3JlLmNoaWxkcmVuLmxlbmd0aCA+PSAxKSB7CiAgICAgIGNvbnN0IGJyZWFrQmVmb3JlID0gdGhpcy5icmVha0JlZm9yZS5jaGlsZHJlblswXTsKICAgICAgaWYgKGhhbmRsZUJyZWFrKGJyZWFrQmVmb3JlKSkgewogICAgICAgIHJldHVybiBIVE1MUmVzdWx0LmJyZWFrTm9kZShicmVha0JlZm9yZSk7CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzWyRleHRyYV0/LmFmdGVyQnJlYWtBZnRlcikgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGZpeERpbWVuc2lvbnModGhpcyk7CiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOwogICAgY29uc3QgYXR0cmlidXRlcyA9IHsKICAgICAgaWQ6IHRoaXNbJHVpZF0sCiAgICAgIGNsYXNzOiBbXQogICAgfTsKICAgIHNldEFjY2Vzcyh0aGlzLCBhdHRyaWJ1dGVzLmNsYXNzKTsKICAgIHRoaXNbJGV4dHJhXSB8fD0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIE9iamVjdC5hc3NpZ24odGhpc1skZXh0cmFdLCB7CiAgICAgIGNoaWxkcmVuLAogICAgICBsaW5lOiBudWxsLAogICAgICBhdHRyaWJ1dGVzLAogICAgICBhdHRlbXB0OiAwLAogICAgICBudW1iZXJJbkxpbmU6IDAsCiAgICAgIGF2YWlsYWJsZVNwYWNlOiB7CiAgICAgICAgd2lkdGg6IE1hdGgubWluKHRoaXMudyB8fCBJbmZpbml0eSwgYXZhaWxhYmxlU3BhY2Uud2lkdGgpLAogICAgICAgIGhlaWdodDogTWF0aC5taW4odGhpcy5oIHx8IEluZmluaXR5LCBhdmFpbGFibGVTcGFjZS5oZWlnaHQpCiAgICAgIH0sCiAgICAgIHdpZHRoOiAwLAogICAgICBoZWlnaHQ6IDAsCiAgICAgIHByZXZIZWlnaHQ6IDAsCiAgICAgIGN1cnJlbnRXaWR0aDogMAogICAgfSk7CiAgICBjb25zdCByb290ID0gdGhpc1skZ2V0VGVtcGxhdGVSb290XSgpOwogICAgY29uc3Qgc2F2ZWROb0xheW91dEZhaWx1cmUgPSByb290WyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlOwogICAgY29uc3QgaXNTcGxpdHRhYmxlID0gdGhpc1skaXNTcGxpdHRhYmxlXSgpOwogICAgaWYgKCFpc1NwbGl0dGFibGUpIHsKICAgICAgc2V0Rmlyc3RVbnNwbGl0dGFibGUodGhpcyk7CiAgICB9CiAgICBpZiAoIWNoZWNrRGltZW5zaW9ucyh0aGlzLCBhdmFpbGFibGVTcGFjZSkpIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuRkFJTFVSRTsKICAgIH0KICAgIGNvbnN0IGZpbHRlciA9IG5ldyBTZXQoWyJhcmVhIiwgImRyYXciLCAiZXhjbEdyb3VwIiwgImZpZWxkIiwgInN1YmZvcm0iLCAic3ViZm9ybVNldCJdKTsKICAgIGlmICh0aGlzLmxheW91dC5pbmNsdWRlcygicm93IikpIHsKICAgICAgY29uc3QgY29sdW1uV2lkdGhzID0gdGhpc1skZ2V0U3ViZm9ybVBhcmVudF0oKS5jb2x1bW5XaWR0aHM7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvbHVtbldpZHRocykgJiYgY29sdW1uV2lkdGhzLmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzWyRleHRyYV0uY29sdW1uV2lkdGhzID0gY29sdW1uV2lkdGhzOwogICAgICAgIHRoaXNbJGV4dHJhXS5jdXJyZW50Q29sdW1uID0gMDsKICAgICAgfQogICAgfQogICAgY29uc3Qgc3R5bGUgPSB0b1N0eWxlKHRoaXMsICJhbmNob3JUeXBlIiwgImRpbWVuc2lvbnMiLCAicG9zaXRpb24iLCAicHJlc2VuY2UiLCAiYm9yZGVyIiwgIm1hcmdpbiIsICJoQWxpZ24iKTsKICAgIGNvbnN0IGNsYXNzTmFtZXMgPSBbInhmYVN1YmZvcm0iXTsKICAgIGNvbnN0IGNsID0gbGF5b3V0Q2xhc3ModGhpcyk7CiAgICBpZiAoY2wpIHsKICAgICAgY2xhc3NOYW1lcy5wdXNoKGNsKTsKICAgIH0KICAgIGF0dHJpYnV0ZXMuc3R5bGUgPSBzdHlsZTsKICAgIGF0dHJpYnV0ZXMuY2xhc3MgPSBjbGFzc05hbWVzOwogICAgaWYgKHRoaXMubmFtZSkgewogICAgICBhdHRyaWJ1dGVzLnhmYU5hbWUgPSB0aGlzLm5hbWU7CiAgICB9CiAgICBpZiAodGhpcy5vdmVyZmxvdykgewogICAgICBjb25zdCBvdmVyZmxvd0V4dHJhID0gdGhpcy5vdmVyZmxvd1skZ2V0RXh0cmFdKCk7CiAgICAgIGlmIChvdmVyZmxvd0V4dHJhLmFkZExlYWRlcikgewogICAgICAgIG92ZXJmbG93RXh0cmEuYWRkTGVhZGVyID0gZmFsc2U7CiAgICAgICAgaGFuZGxlT3ZlcmZsb3codGhpcywgb3ZlcmZsb3dFeHRyYS5sZWFkZXIsIGF2YWlsYWJsZVNwYWNlKTsKICAgICAgfQogICAgfQogICAgdGhpc1skcHVzaFBhcmFdKCk7CiAgICBjb25zdCBpc0xyVGIgPSB0aGlzLmxheW91dCA9PT0gImxyLXRiIiB8fCB0aGlzLmxheW91dCA9PT0gInJsLXRiIjsKICAgIGNvbnN0IG1heFJ1biA9IGlzTHJUYiA/IE1BWF9BVFRFTVBUU19GT1JfTFJUQl9MQVlPVVQgOiAxOwogICAgZm9yICg7IHRoaXNbJGV4dHJhXS5hdHRlbXB0IDwgbWF4UnVuOyB0aGlzWyRleHRyYV0uYXR0ZW1wdCsrKSB7CiAgICAgIGlmIChpc0xyVGIgJiYgdGhpc1skZXh0cmFdLmF0dGVtcHQgPT09IE1BWF9BVFRFTVBUU19GT1JfTFJUQl9MQVlPVVQgLSAxKSB7CiAgICAgICAgdGhpc1skZXh0cmFdLm51bWJlckluTGluZSA9IDA7CiAgICAgIH0KICAgICAgY29uc3QgcmVzdWx0ID0gdGhpc1skY2hpbGRyZW5Ub0hUTUxdKHsKICAgICAgICBmaWx0ZXIsCiAgICAgICAgaW5jbHVkZTogdHJ1ZQogICAgICB9KTsKICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKHJlc3VsdC5pc0JyZWFrKCkpIHsKICAgICAgICB0aGlzWyRwb3BQYXJhXSgpOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgaWYgKGlzTHJUYiAmJiB0aGlzWyRleHRyYV0uYXR0ZW1wdCA9PT0gMCAmJiB0aGlzWyRleHRyYV0ubnVtYmVySW5MaW5lID09PSAwICYmICFyb290WyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlKSB7CiAgICAgICAgdGhpc1skZXh0cmFdLmF0dGVtcHQgPSBtYXhSdW47CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHRoaXNbJHBvcFBhcmFdKCk7CiAgICBpZiAoIWlzU3BsaXR0YWJsZSkgewogICAgICB1bnNldEZpcnN0VW5zcGxpdHRhYmxlKHRoaXMpOwogICAgfQogICAgcm9vdFskZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IHNhdmVkTm9MYXlvdXRGYWlsdXJlOwogICAgaWYgKHRoaXNbJGV4dHJhXS5hdHRlbXB0ID09PSBtYXhSdW4pIHsKICAgICAgaWYgKHRoaXMub3ZlcmZsb3cpIHsKICAgICAgICB0aGlzWyRnZXRUZW1wbGF0ZVJvb3RdKClbJGV4dHJhXS5vdmVyZmxvd05vZGUgPSB0aGlzLm92ZXJmbG93OwogICAgICB9CiAgICAgIGlmICghaXNTcGxpdHRhYmxlKSB7CiAgICAgICAgZGVsZXRlIHRoaXNbJGV4dHJhXTsKICAgICAgfQogICAgICByZXR1cm4gSFRNTFJlc3VsdC5GQUlMVVJFOwogICAgfQogICAgaWYgKHRoaXMub3ZlcmZsb3cpIHsKICAgICAgY29uc3Qgb3ZlcmZsb3dFeHRyYSA9IHRoaXMub3ZlcmZsb3dbJGdldEV4dHJhXSgpOwogICAgICBpZiAob3ZlcmZsb3dFeHRyYS5hZGRUcmFpbGVyKSB7CiAgICAgICAgb3ZlcmZsb3dFeHRyYS5hZGRUcmFpbGVyID0gZmFsc2U7CiAgICAgICAgaGFuZGxlT3ZlcmZsb3codGhpcywgb3ZlcmZsb3dFeHRyYS50cmFpbGVyLCBhdmFpbGFibGVTcGFjZSk7CiAgICAgIH0KICAgIH0KICAgIGxldCBtYXJnaW5IID0gMDsKICAgIGxldCBtYXJnaW5WID0gMDsKICAgIGlmICh0aGlzLm1hcmdpbikgewogICAgICBtYXJnaW5IID0gdGhpcy5tYXJnaW4ubGVmdEluc2V0ICsgdGhpcy5tYXJnaW4ucmlnaHRJbnNldDsKICAgICAgbWFyZ2luViA9IHRoaXMubWFyZ2luLnRvcEluc2V0ICsgdGhpcy5tYXJnaW4uYm90dG9tSW5zZXQ7CiAgICB9CiAgICBjb25zdCB3aWR0aCA9IE1hdGgubWF4KHRoaXNbJGV4dHJhXS53aWR0aCArIG1hcmdpbkgsIHRoaXMudyB8fCAwKTsKICAgIGNvbnN0IGhlaWdodCA9IE1hdGgubWF4KHRoaXNbJGV4dHJhXS5oZWlnaHQgKyBtYXJnaW5WLCB0aGlzLmggfHwgMCk7CiAgICBjb25zdCBiYm94ID0gW3RoaXMueCwgdGhpcy55LCB3aWR0aCwgaGVpZ2h0XTsKICAgIGlmICh0aGlzLncgPT09ICIiKSB7CiAgICAgIHN0eWxlLndpZHRoID0gbWVhc3VyZVRvU3RyaW5nKHdpZHRoKTsKICAgIH0KICAgIGlmICh0aGlzLmggPT09ICIiKSB7CiAgICAgIHN0eWxlLmhlaWdodCA9IG1lYXN1cmVUb1N0cmluZyhoZWlnaHQpOwogICAgfQogICAgaWYgKChzdHlsZS53aWR0aCA9PT0gIjBweCIgfHwgc3R5bGUuaGVpZ2h0ID09PSAiMHB4IikgJiYgY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgY29uc3QgaHRtbCA9IHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGF0dHJpYnV0ZXMsCiAgICAgIGNoaWxkcmVuCiAgICB9OwogICAgYXBwbHlBc3Npc3QodGhpcywgYXR0cmlidXRlcyk7CiAgICBjb25zdCByZXN1bHQgPSBIVE1MUmVzdWx0LnN1Y2Nlc3MoY3JlYXRlV3JhcHBlcih0aGlzLCBodG1sKSwgYmJveCk7CiAgICBpZiAodGhpcy5icmVha0FmdGVyLmNoaWxkcmVuLmxlbmd0aCA+PSAxKSB7CiAgICAgIGNvbnN0IGJyZWFrQWZ0ZXIgPSB0aGlzLmJyZWFrQWZ0ZXIuY2hpbGRyZW5bMF07CiAgICAgIGlmIChoYW5kbGVCcmVhayhicmVha0FmdGVyKSkgewogICAgICAgIHRoaXNbJGV4dHJhXS5hZnRlckJyZWFrQWZ0ZXIgPSByZXN1bHQ7CiAgICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuYnJlYWtOb2RlKGJyZWFrQWZ0ZXIpOwogICAgICB9CiAgICB9CiAgICBkZWxldGUgdGhpc1skZXh0cmFdOwogICAgcmV0dXJuIHJlc3VsdDsKICB9Cn0KY2xhc3MgU3ViZm9ybVNldCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzdWJmb3JtU2V0IiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucmVsYXRpb24gPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5yZWxhdGlvbiwgWyJvcmRlcmVkIiwgImNob2ljZSIsICJ1bm9yZGVyZWQiXSk7CiAgICB0aGlzLnJlbGV2YW50ID0gZ2V0UmVsZXZhbnQoYXR0cmlidXRlcy5yZWxldmFudCk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib29rZW5kID0gbnVsbDsKICAgIHRoaXMuYnJlYWsgPSBudWxsOwogICAgdGhpcy5kZXNjID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMub2NjdXIgPSBudWxsOwogICAgdGhpcy5vdmVyZmxvdyA9IG51bGw7CiAgICB0aGlzLmJyZWFrQWZ0ZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYnJlYWtCZWZvcmUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3ViZm9ybSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJmb3JtU2V0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQogICpbJGdldENvbnRhaW5lZENoaWxkcmVuXSgpIHsKICAgIHlpZWxkKiBnZXRDb250YWluZWRDaGlsZHJlbih0aGlzKTsKICB9CiAgWyRnZXRTdWJmb3JtUGFyZW50XSgpIHsKICAgIGxldCBwYXJlbnQgPSB0aGlzWyRnZXRQYXJlbnRdKCk7CiAgICB3aGlsZSAoIShwYXJlbnQgaW5zdGFuY2VvZiBTdWJmb3JtKSkgewogICAgICBwYXJlbnQgPSBwYXJlbnRbJGdldFBhcmVudF0oKTsKICAgIH0KICAgIHJldHVybiBwYXJlbnQ7CiAgfQogIFskaXNCaW5kYWJsZV0oKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KY2xhc3MgU3ViamVjdEROIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzdWJqZWN0RE4iKTsKICAgIHRoaXMuZGVsaW1pdGVyID0gYXR0cmlidXRlcy5kZWxpbWl0ZXIgfHwgIiwiOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbJGNvbnRlbnRdID0gbmV3IE1hcCh0aGlzWyRjb250ZW50XS5zcGxpdCh0aGlzLmRlbGltaXRlcikubWFwKGt2ID0+IHsKICAgICAga3YgPSBrdi5zcGxpdCgiPSIsIDIpOwogICAgICBrdlswXSA9IGt2WzBdLnRyaW0oKTsKICAgICAgcmV0dXJuIGt2OwogICAgfSkpOwogIH0KfQpjbGFzcyBTdWJqZWN0RE5zIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInN1YmplY3RETnMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnN1YmplY3RETiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBTdWJtaXQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAic3VibWl0IiwgdHJ1ZSk7CiAgICB0aGlzLmVtYmVkUERGID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZW1iZWRQREYsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmZvcm1hdCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmZvcm1hdCwgWyJ4ZHAiLCAiZm9ybWRhdGEiLCAicGRmIiwgInVybGVuY29kZWQiLCAieGZkIiwgInhtbCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50YXJnZXQgPSBhdHRyaWJ1dGVzLnRhcmdldCB8fCAiIjsKICAgIHRoaXMudGV4dEVuY29kaW5nID0gZ2V0S2V5d29yZCh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMudGV4dEVuY29kaW5nID8gYXR0cmlidXRlcy50ZXh0RW5jb2RpbmcudG9Mb3dlckNhc2UoKSA6ICIiLAogICAgICBkZWZhdWx0VmFsdWU6ICIiLAogICAgICB2YWxpZGF0ZTogayA9PiBbInV0Zi04IiwgImJpZy1maXZlIiwgImZvbnRzcGVjaWZpYyIsICJnYmsiLCAiZ2ItMTgwMzAiLCAiZ2ItMjMxMiIsICJrc2MtNTYwMSIsICJub25lIiwgInNoaWZ0LWppcyIsICJ1Y3MtMiIsICJ1dGYtMTYiXS5pbmNsdWRlcyhrKSB8fCBrLm1hdGNoKC9pc28tODg1OS1cZHsyfS8pCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnhkcENvbnRlbnQgPSBhdHRyaWJ1dGVzLnhkcENvbnRlbnQgfHwgIiI7CiAgICB0aGlzLmVuY3J5cHQgPSBudWxsOwogICAgdGhpcy5lbmNyeXB0RGF0YSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zaWduRGF0YSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBUZW1wbGF0ZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ0ZW1wbGF0ZSIsIHRydWUpOwogICAgdGhpcy5iYXNlUHJvZmlsZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmJhc2VQcm9maWxlLCBbImZ1bGwiLCAiaW50ZXJhY3RpdmVGb3JtcyJdKTsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuc3ViZm9ybSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIGlmICh0aGlzLnN1YmZvcm0uY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgIHdhcm4oIlhGQSAtIE5vIHN1YmZvcm1zIGluIHRlbXBsYXRlIG5vZGUuIik7CiAgICB9CiAgICBpZiAodGhpcy5zdWJmb3JtLmNoaWxkcmVuLmxlbmd0aCA+PSAyKSB7CiAgICAgIHdhcm4oIlhGQSAtIFNldmVyYWwgc3ViZm9ybXMgaW4gdGVtcGxhdGUgbm9kZTogcGxlYXNlIGZpbGUgYSBidWcuIik7CiAgICB9CiAgICB0aGlzWyR0YWJJbmRleF0gPSBERUZBVUxUX1RBQl9JTkRFWDsKICB9CiAgWyRpc1NwbGl0dGFibGVdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIFskc2VhcmNoTm9kZV0oZXhwciwgY29udGFpbmVyKSB7CiAgICBpZiAoZXhwci5zdGFydHNXaXRoKCIjIikpIHsKICAgICAgcmV0dXJuIFt0aGlzWyRpZHNdLmdldChleHByLnNsaWNlKDEpKV07CiAgICB9CiAgICByZXR1cm4gc2VhcmNoTm9kZSh0aGlzLCBjb250YWluZXIsIGV4cHIsIHRydWUsIHRydWUpOwogIH0KICAqWyR0b1BhZ2VzXSgpIHsKICAgIGlmICghdGhpcy5zdWJmb3JtLmNoaWxkcmVuLmxlbmd0aCkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgICBuYW1lOiAiZGl2IiwKICAgICAgICBjaGlsZHJlbjogW10KICAgICAgfSk7CiAgICB9CiAgICB0aGlzWyRleHRyYV0gPSB7CiAgICAgIG92ZXJmbG93Tm9kZTogbnVsbCwKICAgICAgZmlyc3RVbnNwbGl0dGFibGU6IG51bGwsCiAgICAgIGN1cnJlbnRDb250ZW50QXJlYTogbnVsbCwKICAgICAgY3VycmVudFBhZ2VBcmVhOiBudWxsLAogICAgICBub0xheW91dEZhaWx1cmU6IGZhbHNlLAogICAgICBwYWdlTnVtYmVyOiAxLAogICAgICBwYWdlUG9zaXRpb246ICJmaXJzdCIsCiAgICAgIG9kZE9yRXZlbjogIm9kZCIsCiAgICAgIGJsYW5rT3JOb3RCbGFuazogIm5vbkJsYW5rIiwKICAgICAgcGFyYVN0YWNrOiBbXQogICAgfTsKICAgIGNvbnN0IHJvb3QgPSB0aGlzLnN1YmZvcm0uY2hpbGRyZW5bMF07CiAgICByb290LnBhZ2VTZXRbJGNsZWFuUGFnZV0oKTsKICAgIGNvbnN0IHBhZ2VBcmVhcyA9IHJvb3QucGFnZVNldC5wYWdlQXJlYS5jaGlsZHJlbjsKICAgIGNvbnN0IG1haW5IdG1sID0gewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgY2hpbGRyZW46IFtdCiAgICB9OwogICAgbGV0IHBhZ2VBcmVhID0gbnVsbDsKICAgIGxldCBicmVha0JlZm9yZSA9IG51bGw7CiAgICBsZXQgYnJlYWtCZWZvcmVUYXJnZXQgPSBudWxsOwogICAgaWYgKHJvb3QuYnJlYWtCZWZvcmUuY2hpbGRyZW4ubGVuZ3RoID49IDEpIHsKICAgICAgYnJlYWtCZWZvcmUgPSByb290LmJyZWFrQmVmb3JlLmNoaWxkcmVuWzBdOwogICAgICBicmVha0JlZm9yZVRhcmdldCA9IGJyZWFrQmVmb3JlLnRhcmdldDsKICAgIH0gZWxzZSBpZiAocm9vdC5zdWJmb3JtLmNoaWxkcmVuLmxlbmd0aCA+PSAxICYmIHJvb3Quc3ViZm9ybS5jaGlsZHJlblswXS5icmVha0JlZm9yZS5jaGlsZHJlbi5sZW5ndGggPj0gMSkgewogICAgICBicmVha0JlZm9yZSA9IHJvb3Quc3ViZm9ybS5jaGlsZHJlblswXS5icmVha0JlZm9yZS5jaGlsZHJlblswXTsKICAgICAgYnJlYWtCZWZvcmVUYXJnZXQgPSBicmVha0JlZm9yZS50YXJnZXQ7CiAgICB9IGVsc2UgaWYgKHJvb3QuYnJlYWs/LmJlZm9yZVRhcmdldCkgewogICAgICBicmVha0JlZm9yZSA9IHJvb3QuYnJlYWs7CiAgICAgIGJyZWFrQmVmb3JlVGFyZ2V0ID0gYnJlYWtCZWZvcmUuYmVmb3JlVGFyZ2V0OwogICAgfSBlbHNlIGlmIChyb290LnN1YmZvcm0uY2hpbGRyZW4ubGVuZ3RoID49IDEgJiYgcm9vdC5zdWJmb3JtLmNoaWxkcmVuWzBdLmJyZWFrPy5iZWZvcmVUYXJnZXQpIHsKICAgICAgYnJlYWtCZWZvcmUgPSByb290LnN1YmZvcm0uY2hpbGRyZW5bMF0uYnJlYWs7CiAgICAgIGJyZWFrQmVmb3JlVGFyZ2V0ID0gYnJlYWtCZWZvcmUuYmVmb3JlVGFyZ2V0OwogICAgfQogICAgaWYgKGJyZWFrQmVmb3JlKSB7CiAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXNbJHNlYXJjaE5vZGVdKGJyZWFrQmVmb3JlVGFyZ2V0LCBicmVha0JlZm9yZVskZ2V0UGFyZW50XSgpKTsKICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIFBhZ2VBcmVhKSB7CiAgICAgICAgcGFnZUFyZWEgPSB0YXJnZXQ7CiAgICAgICAgYnJlYWtCZWZvcmVbJGV4dHJhXSA9IHt9OwogICAgICB9CiAgICB9CiAgICBwYWdlQXJlYSB8fD0gcGFnZUFyZWFzWzBdOwogICAgcGFnZUFyZWFbJGV4dHJhXSA9IHsKICAgICAgbnVtYmVyT2ZVc2U6IDEKICAgIH07CiAgICBjb25zdCBwYWdlQXJlYVBhcmVudCA9IHBhZ2VBcmVhWyRnZXRQYXJlbnRdKCk7CiAgICBwYWdlQXJlYVBhcmVudFskZXh0cmFdID0gewogICAgICBudW1iZXJPZlVzZTogMSwKICAgICAgcGFnZUluZGV4OiBwYWdlQXJlYVBhcmVudC5wYWdlQXJlYS5jaGlsZHJlbi5pbmRleE9mKHBhZ2VBcmVhKSwKICAgICAgcGFnZVNldEluZGV4OiAwCiAgICB9OwogICAgbGV0IHRhcmdldFBhZ2VBcmVhOwogICAgbGV0IGxlYWRlciA9IG51bGw7CiAgICBsZXQgdHJhaWxlciA9IG51bGw7CiAgICBsZXQgaGFzU29tZXRoaW5nID0gdHJ1ZTsKICAgIGxldCBoYXNTb21ldGhpbmdDb3VudGVyID0gMDsKICAgIGxldCBzdGFydEluZGV4ID0gMDsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGlmICghaGFzU29tZXRoaW5nKSB7CiAgICAgICAgbWFpbkh0bWwuY2hpbGRyZW4ucG9wKCk7CiAgICAgICAgaWYgKCsraGFzU29tZXRoaW5nQ291bnRlciA9PT0gTUFYX0VNUFRZX1BBR0VTKSB7CiAgICAgICAgICB3YXJuKCJYRkEgLSBTb21ldGhpbmcgZ29lcyB3cm9uZzogcGxlYXNlIGZpbGUgYSBidWcuIik7CiAgICAgICAgICByZXR1cm4gbWFpbkh0bWw7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGhhc1NvbWV0aGluZ0NvdW50ZXIgPSAwOwogICAgICB9CiAgICAgIHRhcmdldFBhZ2VBcmVhID0gbnVsbDsKICAgICAgdGhpc1skZXh0cmFdLmN1cnJlbnRQYWdlQXJlYSA9IHBhZ2VBcmVhOwogICAgICBjb25zdCBwYWdlID0gcGFnZUFyZWFbJHRvSFRNTF0oKS5odG1sOwogICAgICBtYWluSHRtbC5jaGlsZHJlbi5wdXNoKHBhZ2UpOwogICAgICBpZiAobGVhZGVyKSB7CiAgICAgICAgdGhpc1skZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IHRydWU7CiAgICAgICAgcGFnZS5jaGlsZHJlbi5wdXNoKGxlYWRlclskdG9IVE1MXShwYWdlQXJlYVskZXh0cmFdLnNwYWNlKS5odG1sKTsKICAgICAgICBsZWFkZXIgPSBudWxsOwogICAgICB9CiAgICAgIGlmICh0cmFpbGVyKSB7CiAgICAgICAgdGhpc1skZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IHRydWU7CiAgICAgICAgcGFnZS5jaGlsZHJlbi5wdXNoKHRyYWlsZXJbJHRvSFRNTF0ocGFnZUFyZWFbJGV4dHJhXS5zcGFjZSkuaHRtbCk7CiAgICAgICAgdHJhaWxlciA9IG51bGw7CiAgICAgIH0KICAgICAgY29uc3QgY29udGVudEFyZWFzID0gcGFnZUFyZWEuY29udGVudEFyZWEuY2hpbGRyZW47CiAgICAgIGNvbnN0IGh0bWxDb250ZW50QXJlYXMgPSBwYWdlLmNoaWxkcmVuLmZpbHRlcihub2RlID0+IG5vZGUuYXR0cmlidXRlcy5jbGFzcy5pbmNsdWRlcygieGZhQ29udGVudGFyZWEiKSk7CiAgICAgIGhhc1NvbWV0aGluZyA9IGZhbHNlOwogICAgICB0aGlzWyRleHRyYV0uZmlyc3RVbnNwbGl0dGFibGUgPSBudWxsOwogICAgICB0aGlzWyRleHRyYV0ubm9MYXlvdXRGYWlsdXJlID0gZmFsc2U7CiAgICAgIGNvbnN0IGZsdXNoID0gaW5kZXggPT4gewogICAgICAgIGNvbnN0IGh0bWwgPSByb290WyRmbHVzaEhUTUxdKCk7CiAgICAgICAgaWYgKGh0bWwpIHsKICAgICAgICAgIGhhc1NvbWV0aGluZyB8fD0gaHRtbC5jaGlsZHJlbj8ubGVuZ3RoID4gMDsKICAgICAgICAgIGh0bWxDb250ZW50QXJlYXNbaW5kZXhdLmNoaWxkcmVuLnB1c2goaHRtbCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBmb3IgKGxldCBpID0gc3RhcnRJbmRleCwgaWkgPSBjb250ZW50QXJlYXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvbnN0IGNvbnRlbnRBcmVhID0gdGhpc1skZXh0cmFdLmN1cnJlbnRDb250ZW50QXJlYSA9IGNvbnRlbnRBcmVhc1tpXTsKICAgICAgICBjb25zdCBzcGFjZSA9IHsKICAgICAgICAgIHdpZHRoOiBjb250ZW50QXJlYS53LAogICAgICAgICAgaGVpZ2h0OiBjb250ZW50QXJlYS5oCiAgICAgICAgfTsKICAgICAgICBzdGFydEluZGV4ID0gMDsKICAgICAgICBpZiAobGVhZGVyKSB7CiAgICAgICAgICBodG1sQ29udGVudEFyZWFzW2ldLmNoaWxkcmVuLnB1c2gobGVhZGVyWyR0b0hUTUxdKHNwYWNlKS5odG1sKTsKICAgICAgICAgIGxlYWRlciA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICh0cmFpbGVyKSB7CiAgICAgICAgICBodG1sQ29udGVudEFyZWFzW2ldLmNoaWxkcmVuLnB1c2godHJhaWxlclskdG9IVE1MXShzcGFjZSkuaHRtbCk7CiAgICAgICAgICB0cmFpbGVyID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgY29uc3QgaHRtbCA9IHJvb3RbJHRvSFRNTF0oc3BhY2UpOwogICAgICAgIGlmIChodG1sLnN1Y2Nlc3MpIHsKICAgICAgICAgIGlmIChodG1sLmh0bWwpIHsKICAgICAgICAgICAgaGFzU29tZXRoaW5nIHx8PSBodG1sLmh0bWwuY2hpbGRyZW4/Lmxlbmd0aCA+IDA7CiAgICAgICAgICAgIGh0bWxDb250ZW50QXJlYXNbaV0uY2hpbGRyZW4ucHVzaChodG1sLmh0bWwpOwogICAgICAgICAgfSBlbHNlIGlmICghaGFzU29tZXRoaW5nICYmIG1haW5IdG1sLmNoaWxkcmVuLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgbWFpbkh0bWwuY2hpbGRyZW4ucG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbWFpbkh0bWw7CiAgICAgICAgfQogICAgICAgIGlmIChodG1sLmlzQnJlYWsoKSkgewogICAgICAgICAgY29uc3Qgbm9kZSA9IGh0bWwuYnJlYWtOb2RlOwogICAgICAgICAgZmx1c2goaSk7CiAgICAgICAgICBpZiAobm9kZS50YXJnZXRUeXBlID09PSAiYXV0byIpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobm9kZS5sZWFkZXIpIHsKICAgICAgICAgICAgbGVhZGVyID0gdGhpc1skc2VhcmNoTm9kZV0obm9kZS5sZWFkZXIsIG5vZGVbJGdldFBhcmVudF0oKSk7CiAgICAgICAgICAgIGxlYWRlciA9IGxlYWRlciA/IGxlYWRlclswXSA6IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobm9kZS50cmFpbGVyKSB7CiAgICAgICAgICAgIHRyYWlsZXIgPSB0aGlzWyRzZWFyY2hOb2RlXShub2RlLnRyYWlsZXIsIG5vZGVbJGdldFBhcmVudF0oKSk7CiAgICAgICAgICAgIHRyYWlsZXIgPSB0cmFpbGVyID8gdHJhaWxlclswXSA6IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobm9kZS50YXJnZXRUeXBlID09PSAicGFnZUFyZWEiKSB7CiAgICAgICAgICAgIHRhcmdldFBhZ2VBcmVhID0gbm9kZVskZXh0cmFdLnRhcmdldDsKICAgICAgICAgICAgaSA9IEluZmluaXR5OwogICAgICAgICAgfSBlbHNlIGlmICghbm9kZVskZXh0cmFdLnRhcmdldCkgewogICAgICAgICAgICBpID0gbm9kZVskZXh0cmFdLmluZGV4OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFyZ2V0UGFnZUFyZWEgPSBub2RlWyRleHRyYV0udGFyZ2V0OwogICAgICAgICAgICBzdGFydEluZGV4ID0gbm9kZVskZXh0cmFdLmluZGV4ICsgMTsKICAgICAgICAgICAgaSA9IEluZmluaXR5OwogICAgICAgICAgfQogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzWyRleHRyYV0ub3ZlcmZsb3dOb2RlKSB7CiAgICAgICAgICBjb25zdCBub2RlID0gdGhpc1skZXh0cmFdLm92ZXJmbG93Tm9kZTsKICAgICAgICAgIHRoaXNbJGV4dHJhXS5vdmVyZmxvd05vZGUgPSBudWxsOwogICAgICAgICAgY29uc3Qgb3ZlcmZsb3dFeHRyYSA9IG5vZGVbJGdldEV4dHJhXSgpOwogICAgICAgICAgY29uc3QgdGFyZ2V0ID0gb3ZlcmZsb3dFeHRyYS50YXJnZXQ7CiAgICAgICAgICBvdmVyZmxvd0V4dHJhLmFkZExlYWRlciA9IG92ZXJmbG93RXh0cmEubGVhZGVyICE9PSBudWxsOwogICAgICAgICAgb3ZlcmZsb3dFeHRyYS5hZGRUcmFpbGVyID0gb3ZlcmZsb3dFeHRyYS50cmFpbGVyICE9PSBudWxsOwogICAgICAgICAgZmx1c2goaSk7CiAgICAgICAgICBjb25zdCBjdXJyZW50SW5kZXggPSBpOwogICAgICAgICAgaSA9IEluZmluaXR5OwogICAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIFBhZ2VBcmVhKSB7CiAgICAgICAgICAgIHRhcmdldFBhZ2VBcmVhID0gdGFyZ2V0OwogICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBDb250ZW50QXJlYSkgewogICAgICAgICAgICBjb25zdCBpbmRleCA9IGNvbnRlbnRBcmVhcy5pbmRleE9mKHRhcmdldCk7CiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICBpZiAoaW5kZXggPiBjdXJyZW50SW5kZXgpIHsKICAgICAgICAgICAgICAgIGkgPSBpbmRleCAtIDE7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXggPSBpbmRleDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGFyZ2V0UGFnZUFyZWEgPSB0YXJnZXRbJGdldFBhcmVudF0oKTsKICAgICAgICAgICAgICBzdGFydEluZGV4ID0gdGFyZ2V0UGFnZUFyZWEuY29udGVudEFyZWEuY2hpbGRyZW4uaW5kZXhPZih0YXJnZXQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgZmx1c2goaSk7CiAgICAgIH0KICAgICAgdGhpc1skZXh0cmFdLnBhZ2VOdW1iZXIgKz0gMTsKICAgICAgaWYgKHRhcmdldFBhZ2VBcmVhKSB7CiAgICAgICAgaWYgKHRhcmdldFBhZ2VBcmVhWyRpc1VzYWJsZV0oKSkgewogICAgICAgICAgdGFyZ2V0UGFnZUFyZWFbJGV4dHJhXS5udW1iZXJPZlVzZSArPSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0YXJnZXRQYWdlQXJlYSA9IG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICAgIHBhZ2VBcmVhID0gdGFyZ2V0UGFnZUFyZWEgfHwgcGFnZUFyZWFbJGdldE5leHRQYWdlXSgpOwogICAgICB5aWVsZCBudWxsOwogICAgfQogIH0KfQpjbGFzcyBUZXh0IGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ0ZXh0Iik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubWF4Q2hhcnMgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5tYXhDaGFycywKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAKICAgIH0pOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5yaWQgPSBhdHRyaWJ1dGVzLnJpZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFskYWNjZXB0V2hpdGVzcGFjZV0oKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgWyRvbkNoaWxkXShjaGlsZCkgewogICAgaWYgKGNoaWxkWyRuYW1lc3BhY2VJZF0gPT09IE5hbWVzcGFjZUlkcy54aHRtbC5pZCkgewogICAgICB0aGlzWyRjb250ZW50XSA9IGNoaWxkOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHdhcm4oYFhGQSAtIEludmFsaWQgY29udGVudCBpbiBUZXh0OiAke2NoaWxkWyRub2RlTmFtZV19LmApOwogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbJG9uVGV4dF0oc3RyKSB7CiAgICBpZiAodGhpc1skY29udGVudF0gaW5zdGFuY2VvZiBYRkFPYmplY3QpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3VwZXJbJG9uVGV4dF0oc3RyKTsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICBpZiAodHlwZW9mIHRoaXNbJGNvbnRlbnRdID09PSAic3RyaW5nIikgewogICAgICB0aGlzWyRjb250ZW50XSA9IHRoaXNbJGNvbnRlbnRdLnJlcGxhY2VBbGwoIlxyXG4iLCAiXG4iKTsKICAgIH0KICB9CiAgWyRnZXRFeHRyYV0oKSB7CiAgICBpZiAodHlwZW9mIHRoaXNbJGNvbnRlbnRdID09PSAic3RyaW5nIikgewogICAgICByZXR1cm4gdGhpc1skY29udGVudF0uc3BsaXQoL1tcdTIwMjlcdTIwMjhcbl0vKS5maWx0ZXIobGluZSA9PiAhIWxpbmUpLmpvaW4oIlxuIik7CiAgICB9CiAgICByZXR1cm4gdGhpc1skY29udGVudF1bJHRleHRdKCk7CiAgfQogIFskdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgaWYgKHR5cGVvZiB0aGlzWyRjb250ZW50XSA9PT0gInN0cmluZyIpIHsKICAgICAgY29uc3QgaHRtbCA9IHZhbHVlVG9IdG1sKHRoaXNbJGNvbnRlbnRdKS5odG1sOwogICAgICBpZiAodGhpc1skY29udGVudF0uaW5jbHVkZXMoIlx1MjAyOSIpKSB7CiAgICAgICAgaHRtbC5uYW1lID0gImRpdiI7CiAgICAgICAgaHRtbC5jaGlsZHJlbiA9IFtdOwogICAgICAgIHRoaXNbJGNvbnRlbnRdLnNwbGl0KCJcdTIwMjkiKS5tYXAocGFyYSA9PiBwYXJhLnNwbGl0KC9bXHUyMDI4XG5dLykuZmxhdE1hcChsaW5lID0+IFt7CiAgICAgICAgICBuYW1lOiAic3BhbiIsCiAgICAgICAgICB2YWx1ZTogbGluZQogICAgICAgIH0sIHsKICAgICAgICAgIG5hbWU6ICJiciIKICAgICAgICB9XSkpLmZvckVhY2gobGluZXMgPT4gewogICAgICAgICAgaHRtbC5jaGlsZHJlbi5wdXNoKHsKICAgICAgICAgICAgbmFtZTogInAiLAogICAgICAgICAgICBjaGlsZHJlbjogbGluZXMKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKC9bXHUyMDI4XG5dLy50ZXN0KHRoaXNbJGNvbnRlbnRdKSkgewogICAgICAgIGh0bWwubmFtZSA9ICJkaXYiOwogICAgICAgIGh0bWwuY2hpbGRyZW4gPSBbXTsKICAgICAgICB0aGlzWyRjb250ZW50XS5zcGxpdCgvW1x1MjAyOFxuXS8pLmZvckVhY2gobGluZSA9PiB7CiAgICAgICAgICBodG1sLmNoaWxkcmVuLnB1c2goewogICAgICAgICAgICBuYW1lOiAic3BhbiIsCiAgICAgICAgICAgIHZhbHVlOiBsaW5lCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJiciIKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoaHRtbCk7CiAgICB9CiAgICByZXR1cm4gdGhpc1skY29udGVudF1bJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpOwogIH0KfQpjbGFzcyBUZXh0RWRpdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ0ZXh0RWRpdCIsIHRydWUpOwogICAgdGhpcy5hbGxvd1JpY2hUZXh0ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuYWxsb3dSaWNoVGV4dCwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMuaFNjcm9sbFBvbGljeSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmhTY3JvbGxQb2xpY3ksIFsiYXV0byIsICJvZmYiLCAib24iXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubXVsdGlMaW5lID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMubXVsdGlMaW5lLAogICAgICBkZWZhdWx0VmFsdWU6ICIiLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAwIHx8IHggPT09IDEKICAgIH0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudlNjcm9sbFBvbGljeSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnZTY3JvbGxQb2xpY3ksIFsiYXV0byIsICJvZmYiLCAib24iXSk7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmNvbWIgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IHN0eWxlID0gdG9TdHlsZSh0aGlzLCAiYm9yZGVyIiwgImZvbnQiLCAibWFyZ2luIik7CiAgICBsZXQgaHRtbDsKICAgIGNvbnN0IGZpZWxkID0gdGhpc1skZ2V0UGFyZW50XSgpWyRnZXRQYXJlbnRdKCk7CiAgICBpZiAodGhpcy5tdWx0aUxpbmUgPT09ICIiKSB7CiAgICAgIHRoaXMubXVsdGlMaW5lID0gZmllbGQgaW5zdGFuY2VvZiBEcmF3ID8gMSA6IDA7CiAgICB9CiAgICBpZiAodGhpcy5tdWx0aUxpbmUgPT09IDEpIHsKICAgICAgaHRtbCA9IHsKICAgICAgICBuYW1lOiAidGV4dGFyZWEiLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGRhdGFJZDogZmllbGRbJGRhdGFdPy5bJHVpZF0gfHwgZmllbGRbJHVpZF0sCiAgICAgICAgICBmaWVsZElkOiBmaWVsZFskdWlkXSwKICAgICAgICAgIGNsYXNzOiBbInhmYVRleHRmaWVsZCJdLAogICAgICAgICAgc3R5bGUsCiAgICAgICAgICAiYXJpYS1sYWJlbCI6IGFyaWFMYWJlbChmaWVsZCksCiAgICAgICAgICAiYXJpYS1yZXF1aXJlZCI6IGZhbHNlCiAgICAgICAgfQogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgaHRtbCA9IHsKICAgICAgICBuYW1lOiAiaW5wdXQiLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHR5cGU6ICJ0ZXh0IiwKICAgICAgICAgIGRhdGFJZDogZmllbGRbJGRhdGFdPy5bJHVpZF0gfHwgZmllbGRbJHVpZF0sCiAgICAgICAgICBmaWVsZElkOiBmaWVsZFskdWlkXSwKICAgICAgICAgIGNsYXNzOiBbInhmYVRleHRmaWVsZCJdLAogICAgICAgICAgc3R5bGUsCiAgICAgICAgICAiYXJpYS1sYWJlbCI6IGFyaWFMYWJlbChmaWVsZCksCiAgICAgICAgICAiYXJpYS1yZXF1aXJlZCI6IGZhbHNlCiAgICAgICAgfQogICAgICB9OwogICAgfQogICAgaWYgKGlzUmVxdWlyZWQoZmllbGQpKSB7CiAgICAgIGh0bWwuYXR0cmlidXRlc1siYXJpYS1yZXF1aXJlZCJdID0gdHJ1ZTsKICAgICAgaHRtbC5hdHRyaWJ1dGVzLnJlcXVpcmVkID0gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAibGFiZWwiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IFsieGZhTGFiZWwiXQogICAgICB9LAogICAgICBjaGlsZHJlbjogW2h0bWxdCiAgICB9KTsKICB9Cn0KY2xhc3MgVGltZSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ0aW1lIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgY29uc3QgZGF0ZSA9IHRoaXNbJGNvbnRlbnRdLnRyaW0oKTsKICAgIHRoaXNbJGNvbnRlbnRdID0gZGF0ZSA/IG5ldyBEYXRlKGRhdGUpIDogbnVsbDsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICByZXR1cm4gdmFsdWVUb0h0bWwodGhpc1skY29udGVudF0gPyB0aGlzWyRjb250ZW50XS50b1N0cmluZygpIDogIiIpOwogIH0KfQpjbGFzcyBUaW1lU3RhbXAgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAidGltZVN0YW1wIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMuc2VydmVyID0gYXR0cmlidXRlcy5zZXJ2ZXIgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgVG9vbFRpcCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ0b29sVGlwIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMucmlkID0gYXR0cmlidXRlcy5yaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBUcmF2ZXJzYWwgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAidHJhdmVyc2FsIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLnRyYXZlcnNlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIFRyYXZlcnNlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInRyYXZlcnNlIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMub3BlcmF0aW9uID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMub3BlcmF0aW9uLCBbIm5leHQiLCAiYmFjayIsICJkb3duIiwgImZpcnN0IiwgImxlZnQiLCAicmlnaHQiLCAidXAiXSk7CiAgICB0aGlzLnJlZiA9IGF0dHJpYnV0ZXMucmVmIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuc2NyaXB0ID0gbnVsbDsKICB9CiAgZ2V0IG5hbWUoKSB7CiAgICByZXR1cm4gdGhpcy5vcGVyYXRpb247CiAgfQogIFskaXNUcmFuc3BhcmVudF0oKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQp9CmNsYXNzIFVpIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInVpIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLnBpY3R1cmUgPSBudWxsOwogICAgdGhpcy5iYXJjb2RlID0gbnVsbDsKICAgIHRoaXMuYnV0dG9uID0gbnVsbDsKICAgIHRoaXMuY2hlY2tCdXR0b24gPSBudWxsOwogICAgdGhpcy5jaG9pY2VMaXN0ID0gbnVsbDsKICAgIHRoaXMuZGF0ZVRpbWVFZGl0ID0gbnVsbDsKICAgIHRoaXMuZGVmYXVsdFVpID0gbnVsbDsKICAgIHRoaXMuaW1hZ2VFZGl0ID0gbnVsbDsKICAgIHRoaXMubnVtZXJpY0VkaXQgPSBudWxsOwogICAgdGhpcy5wYXNzd29yZEVkaXQgPSBudWxsOwogICAgdGhpcy5zaWduYXR1cmUgPSBudWxsOwogICAgdGhpcy50ZXh0RWRpdCA9IG51bGw7CiAgfQogIFskZ2V0RXh0cmFdKCkgewogICAgaWYgKHRoaXNbJGV4dHJhXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzKSkgewogICAgICAgIGlmIChuYW1lID09PSAiZXh0cmFzIiB8fCBuYW1lID09PSAicGljdHVyZSIpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBvYmogPSB0aGlzW25hbWVdOwogICAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIFhGQU9iamVjdCkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICB0aGlzWyRleHRyYV0gPSBvYmo7CiAgICAgICAgcmV0dXJuIG9iajsKICAgICAgfQogICAgICB0aGlzWyRleHRyYV0gPSBudWxsOwogICAgfQogICAgcmV0dXJuIHRoaXNbJGV4dHJhXTsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBvYmogPSB0aGlzWyRnZXRFeHRyYV0oKTsKICAgIGlmIChvYmopIHsKICAgICAgcmV0dXJuIG9ialskdG9IVE1MXShhdmFpbGFibGVTcGFjZSk7CiAgICB9CiAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICB9Cn0KY2xhc3MgVmFsaWRhdGUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAidmFsaWRhdGUiLCB0cnVlKTsKICAgIHRoaXMuZm9ybWF0VGVzdCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLmZvcm1hdFRlc3QsIFsid2FybmluZyIsICJkaXNhYmxlZCIsICJlcnJvciJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5udWxsVGVzdCA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm51bGxUZXN0LCBbImRpc2FibGVkIiwgImVycm9yIiwgIndhcm5pbmciXSk7CiAgICB0aGlzLnNjcmlwdFRlc3QgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5zY3JpcHRUZXN0LCBbImVycm9yIiwgImRpc2FibGVkIiwgIndhcm5pbmciXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tZXNzYWdlID0gbnVsbDsKICAgIHRoaXMucGljdHVyZSA9IG51bGw7CiAgICB0aGlzLnNjcmlwdCA9IG51bGw7CiAgfQp9CmNsYXNzIFZhbHVlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInZhbHVlIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMub3ZlcnJpZGUgPSBnZXRJbnRlZ2VyKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5vdmVycmlkZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMucmVsZXZhbnQgPSBnZXRSZWxldmFudChhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmFyYyA9IG51bGw7CiAgICB0aGlzLmJvb2xlYW4gPSBudWxsOwogICAgdGhpcy5kYXRlID0gbnVsbDsKICAgIHRoaXMuZGF0ZVRpbWUgPSBudWxsOwogICAgdGhpcy5kZWNpbWFsID0gbnVsbDsKICAgIHRoaXMuZXhEYXRhID0gbnVsbDsKICAgIHRoaXMuZmxvYXQgPSBudWxsOwogICAgdGhpcy5pbWFnZSA9IG51bGw7CiAgICB0aGlzLmludGVnZXIgPSBudWxsOwogICAgdGhpcy5saW5lID0gbnVsbDsKICAgIHRoaXMucmVjdGFuZ2xlID0gbnVsbDsKICAgIHRoaXMudGV4dCA9IG51bGw7CiAgICB0aGlzLnRpbWUgPSBudWxsOwogIH0KICBbJHNldFZhbHVlXSh2YWx1ZSkgewogICAgY29uc3QgcGFyZW50ID0gdGhpc1skZ2V0UGFyZW50XSgpOwogICAgaWYgKHBhcmVudCBpbnN0YW5jZW9mIEZpZWxkKSB7CiAgICAgIGlmIChwYXJlbnQudWk/LmltYWdlRWRpdCkgewogICAgICAgIGlmICghdGhpcy5pbWFnZSkgewogICAgICAgICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSh7fSk7CiAgICAgICAgICB0aGlzWyRhcHBlbmRDaGlsZF0odGhpcy5pbWFnZSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuaW1hZ2VbJGNvbnRlbnRdID0gdmFsdWVbJGNvbnRlbnRdOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgY29uc3QgdmFsdWVOYW1lID0gdmFsdWVbJG5vZGVOYW1lXTsKICAgIGlmICh0aGlzW3ZhbHVlTmFtZV0gIT09IG51bGwpIHsKICAgICAgdGhpc1t2YWx1ZU5hbWVdWyRjb250ZW50XSA9IHZhbHVlWyRjb250ZW50XTsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpKSB7CiAgICAgIGNvbnN0IG9iaiA9IHRoaXNbbmFtZV07CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBYRkFPYmplY3QpIHsKICAgICAgICB0aGlzW25hbWVdID0gbnVsbDsKICAgICAgICB0aGlzWyRyZW1vdmVDaGlsZF0ob2JqKTsKICAgICAgfQogICAgfQogICAgdGhpc1t2YWx1ZVskbm9kZU5hbWVdXSA9IHZhbHVlOwogICAgdGhpc1skYXBwZW5kQ2hpbGRdKHZhbHVlKTsKICB9CiAgWyR0ZXh0XSgpIHsKICAgIGlmICh0aGlzLmV4RGF0YSkgewogICAgICBpZiAodHlwZW9mIHRoaXMuZXhEYXRhWyRjb250ZW50XSA9PT0gInN0cmluZyIpIHsKICAgICAgICByZXR1cm4gdGhpcy5leERhdGFbJGNvbnRlbnRdLnRyaW0oKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5leERhdGFbJGNvbnRlbnRdWyR0ZXh0XSgpLnRyaW0oKTsKICAgIH0KICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzKSkgewogICAgICBpZiAobmFtZSA9PT0gImltYWdlIikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IG9iaiA9IHRoaXNbbmFtZV07CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBYRkFPYmplY3QpIHsKICAgICAgICByZXR1cm4gKG9ialskY29udGVudF0gfHwgIiIpLnRvU3RyaW5nKCkudHJpbSgpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsKICAgICAgY29uc3Qgb2JqID0gdGhpc1tuYW1lXTsKICAgICAgaWYgKCEob2JqIGluc3RhbmNlb2YgWEZBT2JqZWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHJldHVybiBvYmpbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpOwogICAgfQogICAgcmV0dXJuIEhUTUxSZXN1bHQuRU1QVFk7CiAgfQp9CmNsYXNzIFZhcmlhYmxlcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ2YXJpYWJsZXMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9vbGVhbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGVUaW1lID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRlY2ltYWwgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhEYXRhID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmZsb2F0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmltYWdlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmludGVnZXIgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubWFuaWZlc3QgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2NyaXB0ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRleHQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGltZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KICBbJGlzVHJhbnNwYXJlbnRdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQp9CmNsYXNzIFRlbXBsYXRlTmFtZXNwYWNlIHsKICBzdGF0aWMgWyRidWlsZFhGQU9iamVjdF0obmFtZSwgYXR0cmlidXRlcykgewogICAgaWYgKFRlbXBsYXRlTmFtZXNwYWNlLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgIGNvbnN0IG5vZGUgPSBUZW1wbGF0ZU5hbWVzcGFjZVtuYW1lXShhdHRyaWJ1dGVzKTsKICAgICAgbm9kZVskc2V0U2V0QXR0cmlidXRlc10oYXR0cmlidXRlcyk7CiAgICAgIHJldHVybiBub2RlOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgc3RhdGljIGFwcGVhcmFuY2VGaWx0ZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQXBwZWFyYW5jZUZpbHRlcihhdHRycyk7CiAgfQogIHN0YXRpYyBhcmMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQXJjKGF0dHJzKTsKICB9CiAgc3RhdGljIGFyZWEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQXJlYShhdHRycyk7CiAgfQogIHN0YXRpYyBhc3Npc3QoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQXNzaXN0KGF0dHJzKTsKICB9CiAgc3RhdGljIGJhcmNvZGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQmFyY29kZShhdHRycyk7CiAgfQogIHN0YXRpYyBiaW5kKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJpbmQoYXR0cnMpOwogIH0KICBzdGF0aWMgYmluZEl0ZW1zKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJpbmRJdGVtcyhhdHRycyk7CiAgfQogIHN0YXRpYyBib29rZW5kKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJvb2tlbmQoYXR0cnMpOwogIH0KICBzdGF0aWMgYm9vbGVhbihhdHRycykgewogICAgcmV0dXJuIG5ldyBCb29sZWFuRWxlbWVudChhdHRycyk7CiAgfQogIHN0YXRpYyBib3JkZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQm9yZGVyKGF0dHJzKTsKICB9CiAgc3RhdGljIGJyZWFrKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJyZWFrKGF0dHJzKTsKICB9CiAgc3RhdGljIGJyZWFrQWZ0ZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQnJlYWtBZnRlcihhdHRycyk7CiAgfQogIHN0YXRpYyBicmVha0JlZm9yZShhdHRycykgewogICAgcmV0dXJuIG5ldyBCcmVha0JlZm9yZShhdHRycyk7CiAgfQogIHN0YXRpYyBidXR0b24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQnV0dG9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGNhbGN1bGF0ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBDYWxjdWxhdGUoYXR0cnMpOwogIH0KICBzdGF0aWMgY2FwdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBDYXB0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGNlcnRpZmljYXRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENlcnRpZmljYXRlKGF0dHJzKTsKICB9CiAgc3RhdGljIGNlcnRpZmljYXRlcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBDZXJ0aWZpY2F0ZXMoYXR0cnMpOwogIH0KICBzdGF0aWMgY2hlY2tCdXR0b24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ2hlY2tCdXR0b24oYXR0cnMpOwogIH0KICBzdGF0aWMgY2hvaWNlTGlzdChhdHRycykgewogICAgcmV0dXJuIG5ldyBDaG9pY2VMaXN0KGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbG9yKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbG9yKGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbWIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29tYihhdHRycyk7CiAgfQogIHN0YXRpYyBjb25uZWN0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbm5lY3QoYXR0cnMpOwogIH0KICBzdGF0aWMgY29udGVudEFyZWEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29udGVudEFyZWEoYXR0cnMpOwogIH0KICBzdGF0aWMgY29ybmVyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvcm5lcihhdHRycyk7CiAgfQogIHN0YXRpYyBkYXRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERhdGVFbGVtZW50KGF0dHJzKTsKICB9CiAgc3RhdGljIGRhdGVUaW1lKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERhdGVUaW1lKGF0dHJzKTsKICB9CiAgc3RhdGljIGRhdGVUaW1lRWRpdChhdHRycykgewogICAgcmV0dXJuIG5ldyBEYXRlVGltZUVkaXQoYXR0cnMpOwogIH0KICBzdGF0aWMgZGVjaW1hbChhdHRycykgewogICAgcmV0dXJuIG5ldyBEZWNpbWFsKGF0dHJzKTsKICB9CiAgc3RhdGljIGRlZmF1bHRVaShhdHRycykgewogICAgcmV0dXJuIG5ldyBEZWZhdWx0VWkoYXR0cnMpOwogIH0KICBzdGF0aWMgZGVzYyhhdHRycykgewogICAgcmV0dXJuIG5ldyBEZXNjKGF0dHJzKTsKICB9CiAgc3RhdGljIGRpZ2VzdE1ldGhvZChhdHRycykgewogICAgcmV0dXJuIG5ldyBEaWdlc3RNZXRob2QoYXR0cnMpOwogIH0KICBzdGF0aWMgZGlnZXN0TWV0aG9kcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBEaWdlc3RNZXRob2RzKGF0dHJzKTsKICB9CiAgc3RhdGljIGRyYXcoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRHJhdyhhdHRycyk7CiAgfQogIHN0YXRpYyBlZGdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVkZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jb2RpbmcoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW5jb2RpbmcoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jb2RpbmdzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVuY29kaW5ncyhhdHRycyk7CiAgfQogIHN0YXRpYyBlbmNyeXB0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVuY3J5cHQoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jcnlwdERhdGEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW5jcnlwdERhdGEoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jcnlwdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBFbmNyeXB0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGVuY3J5cHRpb25NZXRob2QoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW5jcnlwdGlvbk1ldGhvZChhdHRycyk7CiAgfQogIHN0YXRpYyBlbmNyeXB0aW9uTWV0aG9kcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBFbmNyeXB0aW9uTWV0aG9kcyhhdHRycyk7CiAgfQogIHN0YXRpYyBldmVudChhdHRycykgewogICAgcmV0dXJuIG5ldyBFdmVudChhdHRycyk7CiAgfQogIHN0YXRpYyBleERhdGEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRXhEYXRhKGF0dHJzKTsKICB9CiAgc3RhdGljIGV4T2JqZWN0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEV4T2JqZWN0KGF0dHJzKTsKICB9CiAgc3RhdGljIGV4Y2xHcm91cChhdHRycykgewogICAgcmV0dXJuIG5ldyBFeGNsR3JvdXAoYXR0cnMpOwogIH0KICBzdGF0aWMgZXhlY3V0ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBFeGVjdXRlKGF0dHJzKTsKICB9CiAgc3RhdGljIGV4dHJhcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBFeHRyYXMoYXR0cnMpOwogIH0KICBzdGF0aWMgZmllbGQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRmllbGQoYXR0cnMpOwogIH0KICBzdGF0aWMgZmlsbChhdHRycykgewogICAgcmV0dXJuIG5ldyBGaWxsKGF0dHJzKTsKICB9CiAgc3RhdGljIGZpbHRlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBGaWx0ZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgZmxvYXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRmxvYXQoYXR0cnMpOwogIH0KICBzdGF0aWMgZm9udChhdHRycykgewogICAgcmV0dXJuIG5ldyB0ZW1wbGF0ZV9Gb250KGF0dHJzKTsKICB9CiAgc3RhdGljIGZvcm1hdChhdHRycykgewogICAgcmV0dXJuIG5ldyBGb3JtYXQoYXR0cnMpOwogIH0KICBzdGF0aWMgaGFuZGxlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBIYW5kbGVyKGF0dHJzKTsKICB9CiAgc3RhdGljIGh5cGhlbmF0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEh5cGhlbmF0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGltYWdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEltYWdlKGF0dHJzKTsKICB9CiAgc3RhdGljIGltYWdlRWRpdChhdHRycykgewogICAgcmV0dXJuIG5ldyBJbWFnZUVkaXQoYXR0cnMpOwogIH0KICBzdGF0aWMgaW50ZWdlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBJbnRlZ2VyKGF0dHJzKTsKICB9CiAgc3RhdGljIGlzc3VlcnMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgSXNzdWVycyhhdHRycyk7CiAgfQogIHN0YXRpYyBpdGVtcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBJdGVtcyhhdHRycyk7CiAgfQogIHN0YXRpYyBrZWVwKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEtlZXAoYXR0cnMpOwogIH0KICBzdGF0aWMga2V5VXNhZ2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgS2V5VXNhZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgbGluZShhdHRycykgewogICAgcmV0dXJuIG5ldyBMaW5lKGF0dHJzKTsKICB9CiAgc3RhdGljIGxpbmVhcihhdHRycykgewogICAgcmV0dXJuIG5ldyBMaW5lYXIoYXR0cnMpOwogIH0KICBzdGF0aWMgbG9ja0RvY3VtZW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IExvY2tEb2N1bWVudChhdHRycyk7CiAgfQogIHN0YXRpYyBtYW5pZmVzdChhdHRycykgewogICAgcmV0dXJuIG5ldyBNYW5pZmVzdChhdHRycyk7CiAgfQogIHN0YXRpYyBtYXJnaW4oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTWFyZ2luKGF0dHJzKTsKICB9CiAgc3RhdGljIG1kcChhdHRycykgewogICAgcmV0dXJuIG5ldyBNZHAoYXR0cnMpOwogIH0KICBzdGF0aWMgbWVkaXVtKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1lZGl1bShhdHRycyk7CiAgfQogIHN0YXRpYyBtZXNzYWdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1lc3NhZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgbnVtZXJpY0VkaXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTnVtZXJpY0VkaXQoYXR0cnMpOwogIH0KICBzdGF0aWMgb2NjdXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgT2NjdXIoYXR0cnMpOwogIH0KICBzdGF0aWMgb2lkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE9pZChhdHRycyk7CiAgfQogIHN0YXRpYyBvaWRzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE9pZHMoYXR0cnMpOwogIH0KICBzdGF0aWMgb3ZlcmZsb3coYXR0cnMpIHsKICAgIHJldHVybiBuZXcgT3ZlcmZsb3coYXR0cnMpOwogIH0KICBzdGF0aWMgcGFnZUFyZWEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGFnZUFyZWEoYXR0cnMpOwogIH0KICBzdGF0aWMgcGFnZVNldChhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWdlU2V0KGF0dHJzKTsKICB9CiAgc3RhdGljIHBhcmEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGFyYShhdHRycyk7CiAgfQogIHN0YXRpYyBwYXNzd29yZEVkaXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGFzc3dvcmRFZGl0KGF0dHJzKTsKICB9CiAgc3RhdGljIHBhdHRlcm4oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgdGVtcGxhdGVfUGF0dGVybihhdHRycyk7CiAgfQogIHN0YXRpYyBwaWN0dXJlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBpY3R1cmUoYXR0cnMpOwogIH0KICBzdGF0aWMgcHJvdG8oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUHJvdG8oYXR0cnMpOwogIH0KICBzdGF0aWMgcmFkaWFsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFJhZGlhbChhdHRycyk7CiAgfQogIHN0YXRpYyByZWFzb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmVhc29uKGF0dHJzKTsKICB9CiAgc3RhdGljIHJlYXNvbnMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmVhc29ucyhhdHRycyk7CiAgfQogIHN0YXRpYyByZWN0YW5nbGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmVjdGFuZ2xlKGF0dHJzKTsKICB9CiAgc3RhdGljIHJlZihhdHRycykgewogICAgcmV0dXJuIG5ldyBSZWZFbGVtZW50KGF0dHJzKTsKICB9CiAgc3RhdGljIHNjcmlwdChhdHRycykgewogICAgcmV0dXJuIG5ldyBTY3JpcHQoYXR0cnMpOwogIH0KICBzdGF0aWMgc2V0UHJvcGVydHkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU2V0UHJvcGVydHkoYXR0cnMpOwogIH0KICBzdGF0aWMgc2lnbkRhdGEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU2lnbkRhdGEoYXR0cnMpOwogIH0KICBzdGF0aWMgc2lnbmF0dXJlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNpZ25hdHVyZShhdHRycyk7CiAgfQogIHN0YXRpYyBzaWduaW5nKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNpZ25pbmcoYXR0cnMpOwogIH0KICBzdGF0aWMgc29saWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU29saWQoYXR0cnMpOwogIH0KICBzdGF0aWMgc3BlYWsoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3BlYWsoYXR0cnMpOwogIH0KICBzdGF0aWMgc3RpcHBsZShhdHRycykgewogICAgcmV0dXJuIG5ldyBTdGlwcGxlKGF0dHJzKTsKICB9CiAgc3RhdGljIHN1YmZvcm0oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3ViZm9ybShhdHRycyk7CiAgfQogIHN0YXRpYyBzdWJmb3JtU2V0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN1YmZvcm1TZXQoYXR0cnMpOwogIH0KICBzdGF0aWMgc3ViamVjdEROKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN1YmplY3RETihhdHRycyk7CiAgfQogIHN0YXRpYyBzdWJqZWN0RE5zKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN1YmplY3RETnMoYXR0cnMpOwogIH0KICBzdGF0aWMgc3VibWl0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN1Ym1pdChhdHRycyk7CiAgfQogIHN0YXRpYyB0ZW1wbGF0ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBUZW1wbGF0ZShhdHRycyk7CiAgfQogIHN0YXRpYyB0ZXh0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRleHQoYXR0cnMpOwogIH0KICBzdGF0aWMgdGV4dEVkaXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVGV4dEVkaXQoYXR0cnMpOwogIH0KICBzdGF0aWMgdGltZShhdHRycykgewogICAgcmV0dXJuIG5ldyBUaW1lKGF0dHJzKTsKICB9CiAgc3RhdGljIHRpbWVTdGFtcChhdHRycykgewogICAgcmV0dXJuIG5ldyBUaW1lU3RhbXAoYXR0cnMpOwogIH0KICBzdGF0aWMgdG9vbFRpcChhdHRycykgewogICAgcmV0dXJuIG5ldyBUb29sVGlwKGF0dHJzKTsKICB9CiAgc3RhdGljIHRyYXZlcnNhbChhdHRycykgewogICAgcmV0dXJuIG5ldyBUcmF2ZXJzYWwoYXR0cnMpOwogIH0KICBzdGF0aWMgdHJhdmVyc2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVHJhdmVyc2UoYXR0cnMpOwogIH0KICBzdGF0aWMgdWkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVWkoYXR0cnMpOwogIH0KICBzdGF0aWMgdmFsaWRhdGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVmFsaWRhdGUoYXR0cnMpOwogIH0KICBzdGF0aWMgdmFsdWUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVmFsdWUoYXR0cnMpOwogIH0KICBzdGF0aWMgdmFyaWFibGVzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFZhcmlhYmxlcyhhdHRycyk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvYmluZC5qcwoKCgoKCgpjb25zdCBiaW5kX05TX0RBVEFTRVRTID0gTmFtZXNwYWNlSWRzLmRhdGFzZXRzLmlkOwpmdW5jdGlvbiBjcmVhdGVUZXh0KGNvbnRlbnQpIHsKICBjb25zdCBub2RlID0gbmV3IFRleHQoe30pOwogIG5vZGVbJGNvbnRlbnRdID0gY29udGVudDsKICByZXR1cm4gbm9kZTsKfQpjbGFzcyBCaW5kZXIgewogIGNvbnN0cnVjdG9yKHJvb3QpIHsKICAgIHRoaXMucm9vdCA9IHJvb3Q7CiAgICB0aGlzLmRhdGFzZXRzID0gcm9vdC5kYXRhc2V0czsKICAgIHRoaXMuZGF0YSA9IHJvb3QuZGF0YXNldHM/LmRhdGEgfHwgbmV3IFhtbE9iamVjdChOYW1lc3BhY2VJZHMuZGF0YXNldHMuaWQsICJkYXRhIik7CiAgICB0aGlzLmVtcHR5TWVyZ2UgPSB0aGlzLmRhdGFbJGdldENoaWxkcmVuXSgpLmxlbmd0aCA9PT0gMDsKICAgIHRoaXMucm9vdC5mb3JtID0gdGhpcy5mb3JtID0gcm9vdC50ZW1wbGF0ZVskY2xvbmVdKCk7CiAgfQogIF9pc0NvbnN1bWVEYXRhKCkgewogICAgcmV0dXJuICF0aGlzLmVtcHR5TWVyZ2UgJiYgdGhpcy5fbWVyZ2VNb2RlOwogIH0KICBfaXNNYXRjaFRlbXBsYXRlKCkgewogICAgcmV0dXJuICF0aGlzLl9pc0NvbnN1bWVEYXRhKCk7CiAgfQogIGJpbmQoKSB7CiAgICB0aGlzLl9iaW5kRWxlbWVudCh0aGlzLmZvcm0sIHRoaXMuZGF0YSk7CiAgICByZXR1cm4gdGhpcy5mb3JtOwogIH0KICBnZXREYXRhKCkgewogICAgcmV0dXJuIHRoaXMuZGF0YTsKICB9CiAgX2JpbmRWYWx1ZShmb3JtTm9kZSwgZGF0YSwgcGljdHVyZSkgewogICAgZm9ybU5vZGVbJGRhdGFdID0gZGF0YTsKICAgIGlmIChmb3JtTm9kZVskaGFzU2V0dGFibGVWYWx1ZV0oKSkgewogICAgICBpZiAoZGF0YVskaXNEYXRhVmFsdWVdKCkpIHsKICAgICAgICBjb25zdCB2YWx1ZSA9IGRhdGFbJGdldERhdGFWYWx1ZV0oKTsKICAgICAgICBmb3JtTm9kZVskc2V0VmFsdWVdKGNyZWF0ZVRleHQodmFsdWUpKTsKICAgICAgfSBlbHNlIGlmIChmb3JtTm9kZSBpbnN0YW5jZW9mIEZpZWxkICYmIGZvcm1Ob2RlLnVpPy5jaG9pY2VMaXN0Py5vcGVuID09PSAibXVsdGlTZWxlY3QiKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSBkYXRhWyRnZXRDaGlsZHJlbl0oKS5tYXAoY2hpbGQgPT4gY2hpbGRbJGNvbnRlbnRdLnRyaW0oKSkuam9pbigiXG4iKTsKICAgICAgICBmb3JtTm9kZVskc2V0VmFsdWVdKGNyZWF0ZVRleHQodmFsdWUpKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLl9pc0NvbnN1bWVEYXRhKCkpIHsKICAgICAgICB3YXJuKGBYRkEgLSBOb2RlcyBoYXZlbid0IHRoZSBzYW1lIHR5cGUuYCk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoIWRhdGFbJGlzRGF0YVZhbHVlXSgpIHx8IHRoaXMuX2lzTWF0Y2hUZW1wbGF0ZSgpKSB7CiAgICAgIHRoaXMuX2JpbmRFbGVtZW50KGZvcm1Ob2RlLCBkYXRhKTsKICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oYFhGQSAtIE5vZGVzIGhhdmVuJ3QgdGhlIHNhbWUgdHlwZS5gKTsKICAgIH0KICB9CiAgX2ZpbmREYXRhQnlOYW1lVG9Db25zdW1lKG5hbWUsIGlzVmFsdWUsIGRhdGFOb2RlLCBnbG9iYWwpIHsKICAgIGlmICghbmFtZSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGxldCBnZW5lcmF0b3IsIG1hdGNoOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgZ2VuZXJhdG9yID0gZGF0YU5vZGVbJGdldFJlYWxDaGlsZHJlbkJ5TmFtZUl0XShuYW1lLCBmYWxzZSwgdHJ1ZSk7CiAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgbWF0Y2ggPSBnZW5lcmF0b3IubmV4dCgpLnZhbHVlOwogICAgICAgIGlmICghbWF0Y2gpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoaXNWYWx1ZSA9PT0gbWF0Y2hbJGlzRGF0YVZhbHVlXSgpKSB7CiAgICAgICAgICByZXR1cm4gbWF0Y2g7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChkYXRhTm9kZVskbmFtZXNwYWNlSWRdID09PSBOYW1lc3BhY2VJZHMuZGF0YXNldHMuaWQgJiYgZGF0YU5vZGVbJG5vZGVOYW1lXSA9PT0gImRhdGEiKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgZGF0YU5vZGUgPSBkYXRhTm9kZVskZ2V0UGFyZW50XSgpOwogICAgfQogICAgaWYgKCFnbG9iYWwpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBnZW5lcmF0b3IgPSB0aGlzLmRhdGFbJGdldFJlYWxDaGlsZHJlbkJ5TmFtZUl0XShuYW1lLCB0cnVlLCBmYWxzZSk7CiAgICBtYXRjaCA9IGdlbmVyYXRvci5uZXh0KCkudmFsdWU7CiAgICBpZiAobWF0Y2gpIHsKICAgICAgcmV0dXJuIG1hdGNoOwogICAgfQogICAgZ2VuZXJhdG9yID0gdGhpcy5kYXRhWyRnZXRBdHRyaWJ1dGVJdF0obmFtZSwgdHJ1ZSk7CiAgICBtYXRjaCA9IGdlbmVyYXRvci5uZXh0KCkudmFsdWU7CiAgICBpZiAobWF0Y2g/LlskaXNEYXRhVmFsdWVdKCkpIHsKICAgICAgcmV0dXJuIG1hdGNoOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIF9zZXRQcm9wZXJ0aWVzKGZvcm1Ob2RlLCBkYXRhTm9kZSkgewogICAgaWYgKCFmb3JtTm9kZS5oYXNPd25Qcm9wZXJ0eSgic2V0UHJvcGVydHkiKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IHsKICAgICAgcmVmLAogICAgICB0YXJnZXQsCiAgICAgIGNvbm5lY3Rpb24KICAgIH0gb2YgZm9ybU5vZGUuc2V0UHJvcGVydHkuY2hpbGRyZW4pIHsKICAgICAgaWYgKGNvbm5lY3Rpb24pIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIXJlZikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IG5vZGVzID0gc2VhcmNoTm9kZSh0aGlzLnJvb3QsIGRhdGFOb2RlLCByZWYsIGZhbHNlLCBmYWxzZSk7CiAgICAgIGlmICghbm9kZXMpIHsKICAgICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIHJlZmVyZW5jZTogJHtyZWZ9LmApOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IFtub2RlXSA9IG5vZGVzOwogICAgICBpZiAoIW5vZGVbJGlzRGVzY2VuZGVudF0odGhpcy5kYXRhKSkgewogICAgICAgIHdhcm4oYFhGQSAtIEludmFsaWQgbm9kZTogbXVzdCBiZSBhIGRhdGEgbm9kZS5gKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCB0YXJnZXROb2RlcyA9IHNlYXJjaE5vZGUodGhpcy5yb290LCBmb3JtTm9kZSwgdGFyZ2V0LCBmYWxzZSwgZmFsc2UpOwogICAgICBpZiAoIXRhcmdldE5vZGVzKSB7CiAgICAgICAgd2FybihgWEZBIC0gSW52YWxpZCB0YXJnZXQ6ICR7dGFyZ2V0fS5gKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBbdGFyZ2V0Tm9kZV0gPSB0YXJnZXROb2RlczsKICAgICAgaWYgKCF0YXJnZXROb2RlWyRpc0Rlc2NlbmRlbnRdKGZvcm1Ob2RlKSkgewogICAgICAgIHdhcm4oYFhGQSAtIEludmFsaWQgdGFyZ2V0OiBtdXN0IGJlIGEgcHJvcGVydHkgb3Igc3VicHJvcGVydHkuYCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgdGFyZ2V0UGFyZW50ID0gdGFyZ2V0Tm9kZVskZ2V0UGFyZW50XSgpOwogICAgICBpZiAodGFyZ2V0Tm9kZSBpbnN0YW5jZW9mIFNldFByb3BlcnR5IHx8IHRhcmdldFBhcmVudCBpbnN0YW5jZW9mIFNldFByb3BlcnR5KSB7CiAgICAgICAgd2FybihgWEZBIC0gSW52YWxpZCB0YXJnZXQ6IGNhbm5vdCBiZSBhIHNldFByb3BlcnR5IG9yIG9uZSBvZiBpdHMgcHJvcGVydGllcy5gKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAodGFyZ2V0Tm9kZSBpbnN0YW5jZW9mIEJpbmRJdGVtcyB8fCB0YXJnZXRQYXJlbnQgaW5zdGFuY2VvZiBCaW5kSXRlbXMpIHsKICAgICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIHRhcmdldDogY2Fubm90IGJlIGEgYmluZEl0ZW1zIG9yIG9uZSBvZiBpdHMgcHJvcGVydGllcy5gKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBjb250ZW50ID0gbm9kZVskdGV4dF0oKTsKICAgICAgY29uc3QgbmFtZSA9IHRhcmdldE5vZGVbJG5vZGVOYW1lXTsKICAgICAgaWYgKHRhcmdldE5vZGUgaW5zdGFuY2VvZiBYRkFBdHRyaWJ1dGUpIHsKICAgICAgICBjb25zdCBhdHRycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgYXR0cnNbbmFtZV0gPSBjb250ZW50OwogICAgICAgIGNvbnN0IG9iaiA9IFJlZmxlY3QuY29uc3RydWN0KE9iamVjdC5nZXRQcm90b3R5cGVPZih0YXJnZXRQYXJlbnQpLmNvbnN0cnVjdG9yLCBbYXR0cnNdKTsKICAgICAgICB0YXJnZXRQYXJlbnRbbmFtZV0gPSBvYmpbbmFtZV07CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCF0YXJnZXROb2RlLmhhc093blByb3BlcnR5KCRjb250ZW50KSkgewogICAgICAgIHdhcm4oYFhGQSAtIEludmFsaWQgbm9kZSB0byB1c2UgaW4gc2V0UHJvcGVydHlgKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB0YXJnZXROb2RlWyRkYXRhXSA9IG5vZGU7CiAgICAgIHRhcmdldE5vZGVbJGNvbnRlbnRdID0gY29udGVudDsKICAgICAgdGFyZ2V0Tm9kZVskZmluYWxpemVdKCk7CiAgICB9CiAgfQogIF9iaW5kSXRlbXMoZm9ybU5vZGUsIGRhdGFOb2RlKSB7CiAgICBpZiAoIWZvcm1Ob2RlLmhhc093blByb3BlcnR5KCJpdGVtcyIpIHx8ICFmb3JtTm9kZS5oYXNPd25Qcm9wZXJ0eSgiYmluZEl0ZW1zIikgfHwgZm9ybU5vZGUuYmluZEl0ZW1zLmlzRW1wdHkoKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgZm9ybU5vZGUuaXRlbXMuY2hpbGRyZW4pIHsKICAgICAgZm9ybU5vZGVbJHJlbW92ZUNoaWxkXShpdGVtKTsKICAgIH0KICAgIGZvcm1Ob2RlLml0ZW1zLmNsZWFyKCk7CiAgICBjb25zdCBsYWJlbHMgPSBuZXcgSXRlbXMoe30pOwogICAgY29uc3QgdmFsdWVzID0gbmV3IEl0ZW1zKHt9KTsKICAgIGZvcm1Ob2RlWyRhcHBlbmRDaGlsZF0obGFiZWxzKTsKICAgIGZvcm1Ob2RlLml0ZW1zLnB1c2gobGFiZWxzKTsKICAgIGZvcm1Ob2RlWyRhcHBlbmRDaGlsZF0odmFsdWVzKTsKICAgIGZvcm1Ob2RlLml0ZW1zLnB1c2godmFsdWVzKTsKICAgIGZvciAoY29uc3QgewogICAgICByZWYsCiAgICAgIGxhYmVsUmVmLAogICAgICB2YWx1ZVJlZiwKICAgICAgY29ubmVjdGlvbgogICAgfSBvZiBmb3JtTm9kZS5iaW5kSXRlbXMuY2hpbGRyZW4pIHsKICAgICAgaWYgKGNvbm5lY3Rpb24pIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIXJlZikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IG5vZGVzID0gc2VhcmNoTm9kZSh0aGlzLnJvb3QsIGRhdGFOb2RlLCByZWYsIGZhbHNlLCBmYWxzZSk7CiAgICAgIGlmICghbm9kZXMpIHsKICAgICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIHJlZmVyZW5jZTogJHtyZWZ9LmApOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2RlcykgewogICAgICAgIGlmICghbm9kZVskaXNEZXNjZW5kZW50XSh0aGlzLmRhdGFzZXRzKSkgewogICAgICAgICAgd2FybihgWEZBIC0gSW52YWxpZCByZWYgKCR7cmVmfSk6IG11c3QgYmUgYSBkYXRhc2V0cyBjaGlsZC5gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBsYWJlbE5vZGVzID0gc2VhcmNoTm9kZSh0aGlzLnJvb3QsIG5vZGUsIGxhYmVsUmVmLCB0cnVlLCBmYWxzZSk7CiAgICAgICAgaWYgKCFsYWJlbE5vZGVzKSB7CiAgICAgICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIGxhYmVsOiAke2xhYmVsUmVmfS5gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBbbGFiZWxOb2RlXSA9IGxhYmVsTm9kZXM7CiAgICAgICAgaWYgKCFsYWJlbE5vZGVbJGlzRGVzY2VuZGVudF0odGhpcy5kYXRhc2V0cykpIHsKICAgICAgICAgIHdhcm4oYFhGQSAtIEludmFsaWQgbGFiZWw6IG11c3QgYmUgYSBkYXRhc2V0cyBjaGlsZC5gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCB2YWx1ZU5vZGVzID0gc2VhcmNoTm9kZSh0aGlzLnJvb3QsIG5vZGUsIHZhbHVlUmVmLCB0cnVlLCBmYWxzZSk7CiAgICAgICAgaWYgKCF2YWx1ZU5vZGVzKSB7CiAgICAgICAgICB3YXJuKGBYRkEgLSBJbnZhbGlkIHZhbHVlOiAke3ZhbHVlUmVmfS5gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBbdmFsdWVOb2RlXSA9IHZhbHVlTm9kZXM7CiAgICAgICAgaWYgKCF2YWx1ZU5vZGVbJGlzRGVzY2VuZGVudF0odGhpcy5kYXRhc2V0cykpIHsKICAgICAgICAgIHdhcm4oYFhGQSAtIEludmFsaWQgdmFsdWU6IG11c3QgYmUgYSBkYXRhc2V0cyBjaGlsZC5gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBsYWJlbCA9IGNyZWF0ZVRleHQobGFiZWxOb2RlWyR0ZXh0XSgpKTsKICAgICAgICBjb25zdCB2YWx1ZSA9IGNyZWF0ZVRleHQodmFsdWVOb2RlWyR0ZXh0XSgpKTsKICAgICAgICBsYWJlbHNbJGFwcGVuZENoaWxkXShsYWJlbCk7CiAgICAgICAgbGFiZWxzLnRleHQucHVzaChsYWJlbCk7CiAgICAgICAgdmFsdWVzWyRhcHBlbmRDaGlsZF0odmFsdWUpOwogICAgICAgIHZhbHVlcy50ZXh0LnB1c2godmFsdWUpOwogICAgICB9CiAgICB9CiAgfQogIF9iaW5kT2NjdXJyZW5jZXMoZm9ybU5vZGUsIG1hdGNoZXMsIHBpY3R1cmUpIHsKICAgIGxldCBiYXNlQ2xvbmU7CiAgICBpZiAobWF0Y2hlcy5sZW5ndGggPiAxKSB7CiAgICAgIGJhc2VDbG9uZSA9IGZvcm1Ob2RlWyRjbG9uZV0oKTsKICAgICAgYmFzZUNsb25lWyRyZW1vdmVDaGlsZF0oYmFzZUNsb25lLm9jY3VyKTsKICAgICAgYmFzZUNsb25lLm9jY3VyID0gbnVsbDsKICAgIH0KICAgIHRoaXMuX2JpbmRWYWx1ZShmb3JtTm9kZSwgbWF0Y2hlc1swXSwgcGljdHVyZSk7CiAgICB0aGlzLl9zZXRQcm9wZXJ0aWVzKGZvcm1Ob2RlLCBtYXRjaGVzWzBdKTsKICAgIHRoaXMuX2JpbmRJdGVtcyhmb3JtTm9kZSwgbWF0Y2hlc1swXSk7CiAgICBpZiAobWF0Y2hlcy5sZW5ndGggPT09IDEpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcGFyZW50ID0gZm9ybU5vZGVbJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IG5hbWUgPSBmb3JtTm9kZVskbm9kZU5hbWVdOwogICAgY29uc3QgcG9zID0gcGFyZW50WyRpbmRleE9mXShmb3JtTm9kZSk7CiAgICBmb3IgKGxldCBpID0gMSwgaWkgPSBtYXRjaGVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgbWF0Y2ggPSBtYXRjaGVzW2ldOwogICAgICBjb25zdCBjbG9uZSA9IGJhc2VDbG9uZVskY2xvbmVdKCk7CiAgICAgIHBhcmVudFtuYW1lXS5wdXNoKGNsb25lKTsKICAgICAgcGFyZW50WyRpbnNlcnRBdF0ocG9zICsgaSwgY2xvbmUpOwogICAgICB0aGlzLl9iaW5kVmFsdWUoY2xvbmUsIG1hdGNoLCBwaWN0dXJlKTsKICAgICAgdGhpcy5fc2V0UHJvcGVydGllcyhjbG9uZSwgbWF0Y2gpOwogICAgICB0aGlzLl9iaW5kSXRlbXMoY2xvbmUsIG1hdGNoKTsKICAgIH0KICB9CiAgX2NyZWF0ZU9jY3VycmVuY2VzKGZvcm1Ob2RlKSB7CiAgICBpZiAoIXRoaXMuZW1wdHlNZXJnZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIG9jY3VyCiAgICB9ID0gZm9ybU5vZGU7CiAgICBpZiAoIW9jY3VyIHx8IG9jY3VyLmluaXRpYWwgPD0gMSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBwYXJlbnQgPSBmb3JtTm9kZVskZ2V0UGFyZW50XSgpOwogICAgY29uc3QgbmFtZSA9IGZvcm1Ob2RlWyRub2RlTmFtZV07CiAgICBpZiAoIShwYXJlbnRbbmFtZV0gaW5zdGFuY2VvZiBYRkFPYmplY3RBcnJheSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGN1cnJlbnROdW1iZXI7CiAgICBpZiAoZm9ybU5vZGUubmFtZSkgewogICAgICBjdXJyZW50TnVtYmVyID0gcGFyZW50W25hbWVdLmNoaWxkcmVuLmZpbHRlcihlID0+IGUubmFtZSA9PT0gZm9ybU5vZGUubmFtZSkubGVuZ3RoOwogICAgfSBlbHNlIHsKICAgICAgY3VycmVudE51bWJlciA9IHBhcmVudFtuYW1lXS5jaGlsZHJlbi5sZW5ndGg7CiAgICB9CiAgICBjb25zdCBwb3MgPSBwYXJlbnRbJGluZGV4T2ZdKGZvcm1Ob2RlKSArIDE7CiAgICBjb25zdCBpaSA9IG9jY3VyLmluaXRpYWwgLSBjdXJyZW50TnVtYmVyOwogICAgaWYgKGlpKSB7CiAgICAgIGNvbnN0IG5vZGVDbG9uZSA9IGZvcm1Ob2RlWyRjbG9uZV0oKTsKICAgICAgbm9kZUNsb25lWyRyZW1vdmVDaGlsZF0obm9kZUNsb25lLm9jY3VyKTsKICAgICAgbm9kZUNsb25lLm9jY3VyID0gbnVsbDsKICAgICAgcGFyZW50W25hbWVdLnB1c2gobm9kZUNsb25lKTsKICAgICAgcGFyZW50WyRpbnNlcnRBdF0ocG9zLCBub2RlQ2xvbmUpOwogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCBjbG9uZSA9IG5vZGVDbG9uZVskY2xvbmVdKCk7CiAgICAgICAgcGFyZW50W25hbWVdLnB1c2goY2xvbmUpOwogICAgICAgIHBhcmVudFskaW5zZXJ0QXRdKHBvcyArIGksIGNsb25lKTsKICAgICAgfQogICAgfQogIH0KICBfZ2V0T2NjdXJJbmZvKGZvcm1Ob2RlKSB7CiAgICBjb25zdCB7CiAgICAgIG5hbWUsCiAgICAgIG9jY3VyCiAgICB9ID0gZm9ybU5vZGU7CiAgICBpZiAoIW9jY3VyIHx8ICFuYW1lKSB7CiAgICAgIHJldHVybiBbMSwgMV07CiAgICB9CiAgICBjb25zdCBtYXggPSBvY2N1ci5tYXggPT09IC0xID8gSW5maW5pdHkgOiBvY2N1ci5tYXg7CiAgICByZXR1cm4gW29jY3VyLm1pbiwgbWF4XTsKICB9CiAgX3NldEFuZEJpbmQoZm9ybU5vZGUsIGRhdGFOb2RlKSB7CiAgICB0aGlzLl9zZXRQcm9wZXJ0aWVzKGZvcm1Ob2RlLCBkYXRhTm9kZSk7CiAgICB0aGlzLl9iaW5kSXRlbXMoZm9ybU5vZGUsIGRhdGFOb2RlKTsKICAgIHRoaXMuX2JpbmRFbGVtZW50KGZvcm1Ob2RlLCBkYXRhTm9kZSk7CiAgfQogIF9iaW5kRWxlbWVudChmb3JtTm9kZSwgZGF0YU5vZGUpIHsKICAgIGNvbnN0IHVzZWxlc3NOb2RlcyA9IFtdOwogICAgdGhpcy5fY3JlYXRlT2NjdXJyZW5jZXMoZm9ybU5vZGUpOwogICAgZm9yIChjb25zdCBjaGlsZCBvZiBmb3JtTm9kZVskZ2V0Q2hpbGRyZW5dKCkpIHsKICAgICAgaWYgKGNoaWxkWyRkYXRhXSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICh0aGlzLl9tZXJnZU1vZGUgPT09IHVuZGVmaW5lZCAmJiBjaGlsZFskbm9kZU5hbWVdID09PSAic3ViZm9ybSIpIHsKICAgICAgICB0aGlzLl9tZXJnZU1vZGUgPSBjaGlsZC5tZXJnZU1vZGUgPT09ICJjb25zdW1lRGF0YSI7CiAgICAgICAgY29uc3QgZGF0YUNoaWxkcmVuID0gZGF0YU5vZGVbJGdldENoaWxkcmVuXSgpOwogICAgICAgIGlmIChkYXRhQ2hpbGRyZW4ubGVuZ3RoID4gMCkgewogICAgICAgICAgdGhpcy5fYmluZE9jY3VycmVuY2VzKGNoaWxkLCBbZGF0YUNoaWxkcmVuWzBdXSwgbnVsbCk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5TWVyZ2UpIHsKICAgICAgICAgIGNvbnN0IG5zSWQgPSBkYXRhTm9kZVskbmFtZXNwYWNlSWRdID09PSBiaW5kX05TX0RBVEFTRVRTID8gLTEgOiBkYXRhTm9kZVskbmFtZXNwYWNlSWRdOwogICAgICAgICAgY29uc3QgZGF0YUNoaWxkID0gY2hpbGRbJGRhdGFdID0gbmV3IFhtbE9iamVjdChuc0lkLCBjaGlsZC5uYW1lIHx8ICJyb290Iik7CiAgICAgICAgICBkYXRhTm9kZVskYXBwZW5kQ2hpbGRdKGRhdGFDaGlsZCk7CiAgICAgICAgICB0aGlzLl9iaW5kRWxlbWVudChjaGlsZCwgZGF0YUNoaWxkKTsKICAgICAgICB9CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFjaGlsZFskaXNCaW5kYWJsZV0oKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGxldCBnbG9iYWwgPSBmYWxzZTsKICAgICAgbGV0IHBpY3R1cmUgPSBudWxsOwogICAgICBsZXQgcmVmID0gbnVsbDsKICAgICAgbGV0IG1hdGNoID0gbnVsbDsKICAgICAgaWYgKGNoaWxkLmJpbmQpIHsKICAgICAgICBzd2l0Y2ggKGNoaWxkLmJpbmQubWF0Y2gpIHsKICAgICAgICAgIGNhc2UgIm5vbmUiOgogICAgICAgICAgICB0aGlzLl9zZXRBbmRCaW5kKGNoaWxkLCBkYXRhTm9kZSk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgY2FzZSAiZ2xvYmFsIjoKICAgICAgICAgICAgZ2xvYmFsID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJkYXRhUmVmIjoKICAgICAgICAgICAgaWYgKCFjaGlsZC5iaW5kLnJlZikgewogICAgICAgICAgICAgIHdhcm4oYFhGQSAtIHJlZiBpcyBlbXB0eSBpbiBub2RlICR7Y2hpbGRbJG5vZGVOYW1lXX0uYCk7CiAgICAgICAgICAgICAgdGhpcy5fc2V0QW5kQmluZChjaGlsZCwgZGF0YU5vZGUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlZiA9IGNoaWxkLmJpbmQucmVmOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoY2hpbGQuYmluZC5waWN0dXJlKSB7CiAgICAgICAgICBwaWN0dXJlID0gY2hpbGQuYmluZC5waWN0dXJlWyRjb250ZW50XTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgW21pbiwgbWF4XSA9IHRoaXMuX2dldE9jY3VySW5mbyhjaGlsZCk7CiAgICAgIGlmIChyZWYpIHsKICAgICAgICBtYXRjaCA9IHNlYXJjaE5vZGUodGhpcy5yb290LCBkYXRhTm9kZSwgcmVmLCB0cnVlLCBmYWxzZSk7CiAgICAgICAgaWYgKG1hdGNoID09PSBudWxsKSB7CiAgICAgICAgICBtYXRjaCA9IGNyZWF0ZURhdGFOb2RlKHRoaXMuZGF0YSwgZGF0YU5vZGUsIHJlZik7CiAgICAgICAgICBpZiAoIW1hdGNoKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuX2lzQ29uc3VtZURhdGEoKSkgewogICAgICAgICAgICBtYXRjaFskY29uc3VtZWRdID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuX3NldEFuZEJpbmQoY2hpbGQsIG1hdGNoKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGhpcy5faXNDb25zdW1lRGF0YSgpKSB7CiAgICAgICAgICAgIG1hdGNoID0gbWF0Y2guZmlsdGVyKG5vZGUgPT4gIW5vZGVbJGNvbnN1bWVkXSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobWF0Y2gubGVuZ3RoID4gbWF4KSB7CiAgICAgICAgICAgIG1hdGNoID0gbWF0Y2guc2xpY2UoMCwgbWF4KTsKICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2gubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIG1hdGNoID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChtYXRjaCAmJiB0aGlzLl9pc0NvbnN1bWVEYXRhKCkpIHsKICAgICAgICAgICAgbWF0Y2guZm9yRWFjaChub2RlID0+IHsKICAgICAgICAgICAgICBub2RlWyRjb25zdW1lZF0gPSB0cnVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCFjaGlsZC5uYW1lKSB7CiAgICAgICAgICB0aGlzLl9zZXRBbmRCaW5kKGNoaWxkLCBkYXRhTm9kZSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuX2lzQ29uc3VtZURhdGEoKSkgewogICAgICAgICAgY29uc3QgbWF0Y2hlcyA9IFtdOwogICAgICAgICAgd2hpbGUgKG1hdGNoZXMubGVuZ3RoIDwgbWF4KSB7CiAgICAgICAgICAgIGNvbnN0IGZvdW5kID0gdGhpcy5fZmluZERhdGFCeU5hbWVUb0NvbnN1bWUoY2hpbGQubmFtZSwgY2hpbGRbJGhhc1NldHRhYmxlVmFsdWVdKCksIGRhdGFOb2RlLCBnbG9iYWwpOwogICAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm91bmRbJGNvbnN1bWVkXSA9IHRydWU7CiAgICAgICAgICAgIG1hdGNoZXMucHVzaChmb3VuZCk7CiAgICAgICAgICB9CiAgICAgICAgICBtYXRjaCA9IG1hdGNoZXMubGVuZ3RoID4gMCA/IG1hdGNoZXMgOiBudWxsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRjaCA9IGRhdGFOb2RlWyRnZXRSZWFsQ2hpbGRyZW5CeU5hbWVJdF0oY2hpbGQubmFtZSwgZmFsc2UsIHRoaXMuZW1wdHlNZXJnZSkubmV4dCgpLnZhbHVlOwogICAgICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgICAgICBpZiAobWluID09PSAwKSB7CiAgICAgICAgICAgICAgdXNlbGVzc05vZGVzLnB1c2goY2hpbGQpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IG5zSWQgPSBkYXRhTm9kZVskbmFtZXNwYWNlSWRdID09PSBiaW5kX05TX0RBVEFTRVRTID8gLTEgOiBkYXRhTm9kZVskbmFtZXNwYWNlSWRdOwogICAgICAgICAgICBtYXRjaCA9IGNoaWxkWyRkYXRhXSA9IG5ldyBYbWxPYmplY3QobnNJZCwgY2hpbGQubmFtZSk7CiAgICAgICAgICAgIGlmICh0aGlzLmVtcHR5TWVyZ2UpIHsKICAgICAgICAgICAgICBtYXRjaFskY29uc3VtZWRdID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkYXRhTm9kZVskYXBwZW5kQ2hpbGRdKG1hdGNoKTsKICAgICAgICAgICAgdGhpcy5fc2V0QW5kQmluZChjaGlsZCwgbWF0Y2gpOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmVtcHR5TWVyZ2UpIHsKICAgICAgICAgICAgbWF0Y2hbJGNvbnN1bWVkXSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBtYXRjaCA9IFttYXRjaF07CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChtYXRjaCkgewogICAgICAgIHRoaXMuX2JpbmRPY2N1cnJlbmNlcyhjaGlsZCwgbWF0Y2gsIHBpY3R1cmUpOwogICAgICB9IGVsc2UgaWYgKG1pbiA+IDApIHsKICAgICAgICB0aGlzLl9zZXRBbmRCaW5kKGNoaWxkLCBkYXRhTm9kZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdXNlbGVzc05vZGVzLnB1c2goY2hpbGQpOwogICAgICB9CiAgICB9CiAgICB1c2VsZXNzTm9kZXMuZm9yRWFjaChub2RlID0+IG5vZGVbJGdldFBhcmVudF0oKVskcmVtb3ZlQ2hpbGRdKG5vZGUpKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS9kYXRhLmpzCgpjbGFzcyBEYXRhSGFuZGxlciB7CiAgY29uc3RydWN0b3Iocm9vdCwgZGF0YSkgewogICAgdGhpcy5kYXRhID0gZGF0YTsKICAgIHRoaXMuZGF0YXNldCA9IHJvb3QuZGF0YXNldHMgfHwgbnVsbDsKICB9CiAgc2VyaWFsaXplKHN0b3JhZ2UpIHsKICAgIGNvbnN0IHN0YWNrID0gW1stMSwgdGhpcy5kYXRhWyRnZXRDaGlsZHJlbl0oKV1dOwogICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgbGFzdCA9IHN0YWNrLmF0KC0xKTsKICAgICAgY29uc3QgW2ksIGNoaWxkcmVuXSA9IGxhc3Q7CiAgICAgIGlmIChpICsgMSA9PT0gY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlblsrK2xhc3RbMF1dOwogICAgICBjb25zdCBzdG9yYWdlRW50cnkgPSBzdG9yYWdlLmdldChjaGlsZFskdWlkXSk7CiAgICAgIGlmIChzdG9yYWdlRW50cnkpIHsKICAgICAgICBjaGlsZFskc2V0VmFsdWVdKHN0b3JhZ2VFbnRyeSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IGNoaWxkWyRnZXRBdHRyaWJ1dGVzXSgpOwogICAgICAgIGZvciAoY29uc3QgdmFsdWUgb2YgYXR0cmlidXRlcy52YWx1ZXMoKSkgewogICAgICAgICAgY29uc3QgZW50cnkgPSBzdG9yYWdlLmdldCh2YWx1ZVskdWlkXSk7CiAgICAgICAgICBpZiAoZW50cnkpIHsKICAgICAgICAgICAgdmFsdWVbJHNldFZhbHVlXShlbnRyeSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBub2RlcyA9IGNoaWxkWyRnZXRDaGlsZHJlbl0oKTsKICAgICAgaWYgKG5vZGVzLmxlbmd0aCA+IDApIHsKICAgICAgICBzdGFjay5wdXNoKFstMSwgbm9kZXNdKTsKICAgICAgfQogICAgfQogICAgY29uc3QgYnVmID0gW2A8eGZhOmRhdGFzZXRzIHhtbG5zOnhmYT0iaHR0cDovL3d3dy54ZmEub3JnL3NjaGVtYS94ZmEtZGF0YS8xLjAvIj5gXTsKICAgIGlmICh0aGlzLmRhdGFzZXQpIHsKICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzLmRhdGFzZXRbJGdldENoaWxkcmVuXSgpKSB7CiAgICAgICAgaWYgKGNoaWxkWyRub2RlTmFtZV0gIT09ICJkYXRhIikgewogICAgICAgICAgY2hpbGRbJHRvU3RyaW5nXShidWYpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdGhpcy5kYXRhWyR0b1N0cmluZ10oYnVmKTsKICAgIGJ1Zi5wdXNoKCI8L3hmYTpkYXRhc2V0cz4iKTsKICAgIHJldHVybiBidWYuam9pbigiIik7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvY29uZmlnLmpzCgoKCgoKY29uc3QgQ09ORklHX05TX0lEID0gTmFtZXNwYWNlSWRzLmNvbmZpZy5pZDsKY2xhc3MgQWNyb2JhdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYWNyb2JhdCIsIHRydWUpOwogICAgdGhpcy5hY3JvYmF0NyA9IG51bGw7CiAgICB0aGlzLmF1dG9TYXZlID0gbnVsbDsKICAgIHRoaXMuY29tbW9uID0gbnVsbDsKICAgIHRoaXMudmFsaWRhdGUgPSBudWxsOwogICAgdGhpcy52YWxpZGF0ZUFwcHJvdmFsU2lnbmF0dXJlcyA9IG51bGw7CiAgICB0aGlzLnN1Ym1pdFVybCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBBY3JvYmF0NyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYWNyb2JhdDciLCB0cnVlKTsKICAgIHRoaXMuZHluYW1pY1JlbmRlciA9IG51bGw7CiAgfQp9CmNsYXNzIEFEQkVfSlNDb25zb2xlIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJBREJFX0pTQ29uc29sZSIsIFsiZGVsZWdhdGUiLCAiRW5hYmxlIiwgIkRpc2FibGUiXSk7CiAgfQp9CmNsYXNzIEFEQkVfSlNEZWJ1Z2dlciBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiQURCRV9KU0RlYnVnZ2VyIiwgWyJkZWxlZ2F0ZSIsICJFbmFibGUiLCAiRGlzYWJsZSJdKTsKICB9Cn0KY2xhc3MgQWRkU2lsZW50UHJpbnQgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYWRkU2lsZW50UHJpbnQiKTsKICB9Cn0KY2xhc3MgQWRkVmlld2VyUHJlZmVyZW5jZXMgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYWRkVmlld2VyUHJlZmVyZW5jZXMiKTsKICB9Cn0KY2xhc3MgQWRqdXN0RGF0YSBleHRlbmRzIE9wdGlvbjEwIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJhZGp1c3REYXRhIik7CiAgfQp9CmNsYXNzIEFkb2JlRXh0ZW5zaW9uTGV2ZWwgZXh0ZW5kcyBJbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJhZG9iZUV4dGVuc2lvbkxldmVsIiwgMCwgbiA9PiBuID49IDEgJiYgbiA8PSA4KTsKICB9Cn0KY2xhc3MgQWdlbnQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImFnZW50IiwgdHJ1ZSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgPyBhdHRyaWJ1dGVzLm5hbWUudHJpbSgpIDogIiI7CiAgICB0aGlzLmNvbW1vbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBBbHdheXNFbWJlZCBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImFsd2F5c0VtYmVkIik7CiAgfQp9CmNsYXNzIEFtZCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYW1kIik7CiAgfQp9CmNsYXNzIGNvbmZpZ19BcmVhIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJhcmVhIik7CiAgICB0aGlzLmxldmVsID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMubGV2ZWwsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IG4gPT4gbiA+PSAxICYmIG4gPD0gMwogICAgfSk7CiAgICB0aGlzLm5hbWUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5uYW1lLCBbIiIsICJiYXJjb2RlIiwgImNvcmVpbml0IiwgImRldmljZURyaXZlciIsICJmb250IiwgImdlbmVyYWwiLCAibGF5b3V0IiwgIm1lcmdlIiwgInNjcmlwdCIsICJzaWduYXR1cmUiLCAic291cmNlU2V0IiwgInRlbXBsYXRlQ2FjaGUiXSk7CiAgfQp9CmNsYXNzIEF0dHJpYnV0ZXMgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImF0dHJpYnV0ZXMiLCBbInByZXNlcnZlIiwgImRlbGVnYXRlIiwgImlnbm9yZSJdKTsKICB9Cn0KY2xhc3MgQXV0b1NhdmUgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImF1dG9TYXZlIiwgWyJkaXNhYmxlZCIsICJlbmFibGVkIl0pOwogIH0KfQpjbGFzcyBCYXNlIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJiYXNlIik7CiAgfQp9CmNsYXNzIEJhdGNoT3V0cHV0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJiYXRjaE91dHB1dCIpOwogICAgdGhpcy5mb3JtYXQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5mb3JtYXQsIFsibm9uZSIsICJjb25jYXQiLCAiemlwIiwgInppcENvbXByZXNzIl0pOwogIH0KfQpjbGFzcyBCZWhhdmlvck92ZXJyaWRlIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYmVoYXZpb3JPdmVycmlkZSIpOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbJGNvbnRlbnRdID0gbmV3IE1hcCh0aGlzWyRjb250ZW50XS50cmltKCkuc3BsaXQoL1xzKy8pLmZpbHRlcih4ID0+IHguaW5jbHVkZXMoIjoiKSkubWFwKHggPT4geC5zcGxpdCgiOiIsIDIpKSk7CiAgfQp9CmNsYXNzIENhY2hlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjYWNoZSIsIHRydWUpOwogICAgdGhpcy50ZW1wbGF0ZUNhY2hlID0gbnVsbDsKICB9Cn0KY2xhc3MgQ2hhbmdlIGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNoYW5nZSIpOwogIH0KfQpjbGFzcyBDb21tb24gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNvbW1vbiIsIHRydWUpOwogICAgdGhpcy5kYXRhID0gbnVsbDsKICAgIHRoaXMubG9jYWxlID0gbnVsbDsKICAgIHRoaXMubG9jYWxlU2V0ID0gbnVsbDsKICAgIHRoaXMubWVzc2FnaW5nID0gbnVsbDsKICAgIHRoaXMuc3VwcHJlc3NCYW5uZXIgPSBudWxsOwogICAgdGhpcy50ZW1wbGF0ZSA9IG51bGw7CiAgICB0aGlzLnZhbGlkYXRpb25NZXNzYWdpbmcgPSBudWxsOwogICAgdGhpcy52ZXJzaW9uQ29udHJvbCA9IG51bGw7CiAgICB0aGlzLmxvZyA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBDb21wcmVzcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiY29tcHJlc3MiKTsKICAgIHRoaXMuc2NvcGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5zY29wZSwgWyJpbWFnZU9ubHkiLCAiZG9jdW1lbnQiXSk7CiAgfQp9CmNsYXNzIENvbXByZXNzTG9naWNhbFN0cnVjdHVyZSBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjb21wcmVzc0xvZ2ljYWxTdHJ1Y3R1cmUiKTsKICB9Cn0KY2xhc3MgQ29tcHJlc3NPYmplY3RTdHJlYW0gZXh0ZW5kcyBPcHRpb24xMCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiY29tcHJlc3NPYmplY3RTdHJlYW0iKTsKICB9Cn0KY2xhc3MgQ29tcHJlc3Npb24gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNvbXByZXNzaW9uIiwgdHJ1ZSk7CiAgICB0aGlzLmNvbXByZXNzTG9naWNhbFN0cnVjdHVyZSA9IG51bGw7CiAgICB0aGlzLmNvbXByZXNzT2JqZWN0U3RyZWFtID0gbnVsbDsKICAgIHRoaXMubGV2ZWwgPSBudWxsOwogICAgdGhpcy50eXBlID0gbnVsbDsKICB9Cn0KY2xhc3MgQ29uZmlnIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjb25maWciLCB0cnVlKTsKICAgIHRoaXMuYWNyb2JhdCA9IG51bGw7CiAgICB0aGlzLnByZXNlbnQgPSBudWxsOwogICAgdGhpcy50cmFjZSA9IG51bGw7CiAgICB0aGlzLmFnZW50ID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIENvbmZvcm1hbmNlIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjb25mb3JtYW5jZSIsIFsiQSIsICJCIl0pOwogIH0KfQpjbGFzcyBDb250ZW50Q29weSBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjb250ZW50Q29weSIpOwogIH0KfQpjbGFzcyBDb3BpZXMgZXh0ZW5kcyBJbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjb3BpZXMiLCAxLCBuID0+IG4gPj0gMSk7CiAgfQp9CmNsYXNzIENyZWF0b3IgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNyZWF0b3IiKTsKICB9Cn0KY2xhc3MgQ3VycmVudFBhZ2UgZXh0ZW5kcyBJbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjdXJyZW50UGFnZSIsIDAsIG4gPT4gbiA+PSAwKTsKICB9Cn0KY2xhc3MgRGF0YSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZGF0YSIsIHRydWUpOwogICAgdGhpcy5hZGp1c3REYXRhID0gbnVsbDsKICAgIHRoaXMuYXR0cmlidXRlcyA9IG51bGw7CiAgICB0aGlzLmluY3JlbWVudGFsTG9hZCA9IG51bGw7CiAgICB0aGlzLm91dHB1dFhTTCA9IG51bGw7CiAgICB0aGlzLnJhbmdlID0gbnVsbDsKICAgIHRoaXMucmVjb3JkID0gbnVsbDsKICAgIHRoaXMuc3RhcnROb2RlID0gbnVsbDsKICAgIHRoaXMudXJpID0gbnVsbDsKICAgIHRoaXMud2luZG93ID0gbnVsbDsKICAgIHRoaXMueHNsID0gbnVsbDsKICAgIHRoaXMuZXhjbHVkZU5TID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRyYW5zZm9ybSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBEZWJ1ZyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZGVidWciLCB0cnVlKTsKICAgIHRoaXMudXJpID0gbnVsbDsKICB9Cn0KY2xhc3MgRGVmYXVsdFR5cGVmYWNlIGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZGVmYXVsdFR5cGVmYWNlIik7CiAgICB0aGlzLndyaXRpbmdTY3JpcHQgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy53cml0aW5nU2NyaXB0LCBbIioiLCAiQXJhYmljIiwgIkN5cmlsbGljIiwgIkVhc3RFdXJvcGVhblJvbWFuIiwgIkdyZWVrIiwgIkhlYnJldyIsICJKYXBhbmVzZSIsICJLb3JlYW4iLCAiUm9tYW4iLCAiU2ltcGxpZmllZENoaW5lc2UiLCAiVGhhaSIsICJUcmFkaXRpb25hbENoaW5lc2UiLCAiVmlldG5hbWVzZSJdKTsKICB9Cn0KY2xhc3MgRGVzdGluYXRpb24gZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImRlc3RpbmF0aW9uIiwgWyJwZGYiLCAicGNsIiwgInBzIiwgIndlYkNsaWVudCIsICJ6cGwiXSk7CiAgfQp9CmNsYXNzIERvY3VtZW50QXNzZW1ibHkgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZG9jdW1lbnRBc3NlbWJseSIpOwogIH0KfQpjbGFzcyBEcml2ZXIgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImRyaXZlciIsIHRydWUpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lID8gYXR0cmlidXRlcy5uYW1lLnRyaW0oKSA6ICIiOwogICAgdGhpcy5mb250SW5mbyA9IG51bGw7CiAgICB0aGlzLnhkYyA9IG51bGw7CiAgfQp9CmNsYXNzIER1cGxleE9wdGlvbiBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZHVwbGV4T3B0aW9uIiwgWyJzaW1wbGV4IiwgImR1cGxleEZsaXBMb25nRWRnZSIsICJkdXBsZXhGbGlwU2hvcnRFZGdlIl0pOwogIH0KfQpjbGFzcyBEeW5hbWljUmVuZGVyIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJkeW5hbWljUmVuZGVyIiwgWyJmb3JiaWRkZW4iLCAicmVxdWlyZWQiXSk7CiAgfQp9CmNsYXNzIEVtYmVkIGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImVtYmVkIik7CiAgfQp9CmNsYXNzIGNvbmZpZ19FbmNyeXB0IGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImVuY3J5cHQiKTsKICB9Cn0KY2xhc3MgY29uZmlnX0VuY3J5cHRpb24gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImVuY3J5cHRpb24iLCB0cnVlKTsKICAgIHRoaXMuZW5jcnlwdCA9IG51bGw7CiAgICB0aGlzLmVuY3J5cHRpb25MZXZlbCA9IG51bGw7CiAgICB0aGlzLnBlcm1pc3Npb25zID0gbnVsbDsKICB9Cn0KY2xhc3MgRW5jcnlwdGlvbkxldmVsIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJlbmNyeXB0aW9uTGV2ZWwiLCBbIjQwYml0IiwgIjEyOGJpdCJdKTsKICB9Cn0KY2xhc3MgRW5mb3JjZSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZW5mb3JjZSIpOwogIH0KfQpjbGFzcyBFcXVhdGUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImVxdWF0ZSIpOwogICAgdGhpcy5mb3JjZSA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmZvcmNlLAogICAgICBkZWZhdWx0VmFsdWU6IDEsCiAgICAgIHZhbGlkYXRlOiBuID0+IG4gPT09IDAKICAgIH0pOwogICAgdGhpcy5mcm9tID0gYXR0cmlidXRlcy5mcm9tIHx8ICIiOwogICAgdGhpcy50byA9IGF0dHJpYnV0ZXMudG8gfHwgIiI7CiAgfQp9CmNsYXNzIEVxdWF0ZVJhbmdlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJlcXVhdGVSYW5nZSIpOwogICAgdGhpcy5mcm9tID0gYXR0cmlidXRlcy5mcm9tIHx8ICIiOwogICAgdGhpcy50byA9IGF0dHJpYnV0ZXMudG8gfHwgIiI7CiAgICB0aGlzLl91bmljb2RlUmFuZ2UgPSBhdHRyaWJ1dGVzLnVuaWNvZGVSYW5nZSB8fCAiIjsKICB9CiAgZ2V0IHVuaWNvZGVSYW5nZSgpIHsKICAgIGNvbnN0IHJhbmdlcyA9IFtdOwogICAgY29uc3QgdW5pY29kZVJlZ2V4ID0gL1VcKyhbMC05YS1mQS1GXSspLzsKICAgIGNvbnN0IHVuaWNvZGVSYW5nZSA9IHRoaXMuX3VuaWNvZGVSYW5nZTsKICAgIGZvciAobGV0IHJhbmdlIG9mIHVuaWNvZGVSYW5nZS5zcGxpdCgiLCIpLm1hcCh4ID0+IHgudHJpbSgpKS5maWx0ZXIoeCA9PiAhIXgpKSB7CiAgICAgIHJhbmdlID0gcmFuZ2Uuc3BsaXQoIi0iLCAyKS5tYXAoeCA9PiB7CiAgICAgICAgY29uc3QgZm91bmQgPSB4Lm1hdGNoKHVuaWNvZGVSZWdleCk7CiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYXJzZUludChmb3VuZFsxXSwgMTYpOwogICAgICB9KTsKICAgICAgaWYgKHJhbmdlLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHJhbmdlLnB1c2gocmFuZ2VbMF0pOwogICAgICB9CiAgICAgIHJhbmdlcy5wdXNoKHJhbmdlKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInVuaWNvZGVSYW5nZSIsIHJhbmdlcyk7CiAgfQp9CmNsYXNzIEV4Y2x1ZGUgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJleGNsdWRlIik7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgdGhpc1skY29udGVudF0gPSB0aGlzWyRjb250ZW50XS50cmltKCkuc3BsaXQoL1xzKy8pLmZpbHRlcih4ID0+IHggJiYgWyJjYWxjdWxhdGUiLCAiY2xvc2UiLCAiZW50ZXIiLCAiZXhpdCIsICJpbml0aWFsaXplIiwgInJlYWR5IiwgInZhbGlkYXRlIl0uaW5jbHVkZXMoeCkpOwogIH0KfQpjbGFzcyBFeGNsdWRlTlMgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImV4Y2x1ZGVOUyIpOwogIH0KfQpjbGFzcyBGbGlwTGFiZWwgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImZsaXBMYWJlbCIsIFsidXNlUHJpbnRlclNldHRpbmciLCAib24iLCAib2ZmIl0pOwogIH0KfQpjbGFzcyBjb25maWdfRm9udEluZm8gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImZvbnRJbmZvIiwgdHJ1ZSk7CiAgICB0aGlzLmVtYmVkID0gbnVsbDsKICAgIHRoaXMubWFwID0gbnVsbDsKICAgIHRoaXMuc3Vic2V0QmVsb3cgPSBudWxsOwogICAgdGhpcy5hbHdheXNFbWJlZCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kZWZhdWx0VHlwZWZhY2UgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubmV2ZXJFbWJlZCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBGb3JtRmllbGRGaWxsaW5nIGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImZvcm1GaWVsZEZpbGxpbmciKTsKICB9Cn0KY2xhc3MgR3JvdXBQYXJlbnQgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImdyb3VwUGFyZW50Iik7CiAgfQp9CmNsYXNzIElmRW1wdHkgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImlmRW1wdHkiLCBbImRhdGFWYWx1ZSIsICJkYXRhR3JvdXAiLCAiaWdub3JlIiwgInJlbW92ZSJdKTsKICB9Cn0KY2xhc3MgSW5jbHVkZVhEUENvbnRlbnQgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImluY2x1ZGVYRFBDb250ZW50Iik7CiAgfQp9CmNsYXNzIEluY3JlbWVudGFsTG9hZCBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiaW5jcmVtZW50YWxMb2FkIiwgWyJub25lIiwgImZvcndhcmRPbmx5Il0pOwogIH0KfQpjbGFzcyBJbmNyZW1lbnRhbE1lcmdlIGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImluY3JlbWVudGFsTWVyZ2UiKTsKICB9Cn0KY2xhc3MgSW50ZXJhY3RpdmUgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiaW50ZXJhY3RpdmUiKTsKICB9Cn0KY2xhc3MgSm9nIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJqb2ciLCBbInVzZVByaW50ZXJTZXR0aW5nIiwgIm5vbmUiLCAicGFnZVNldCJdKTsKICB9Cn0KY2xhc3MgTGFiZWxQcmludGVyIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJsYWJlbFByaW50ZXIiLCB0cnVlKTsKICAgIHRoaXMubmFtZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm5hbWUsIFsienBsIiwgImRwbCIsICJpcGwiLCAidGNwbCJdKTsKICAgIHRoaXMuYmF0Y2hPdXRwdXQgPSBudWxsOwogICAgdGhpcy5mbGlwTGFiZWwgPSBudWxsOwogICAgdGhpcy5mb250SW5mbyA9IG51bGw7CiAgICB0aGlzLnhkYyA9IG51bGw7CiAgfQp9CmNsYXNzIExheW91dCBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibGF5b3V0IiwgWyJwYWdpbmF0ZSIsICJwYW5lbCJdKTsKICB9Cn0KY2xhc3MgTGV2ZWwgZXh0ZW5kcyBJbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJsZXZlbCIsIDAsIG4gPT4gbiA+IDApOwogIH0KfQpjbGFzcyBMaW5lYXJpemVkIGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImxpbmVhcml6ZWQiKTsKICB9Cn0KY2xhc3MgTG9jYWxlIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJsb2NhbGUiKTsKICB9Cn0KY2xhc3MgTG9jYWxlU2V0IGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJsb2NhbGVTZXQiKTsKICB9Cn0KY2xhc3MgTG9nIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJsb2ciLCB0cnVlKTsKICAgIHRoaXMubW9kZSA9IG51bGw7CiAgICB0aGlzLnRocmVzaG9sZCA9IG51bGw7CiAgICB0aGlzLnRvID0gbnVsbDsKICAgIHRoaXMudXJpID0gbnVsbDsKICB9Cn0KY2xhc3MgTWFwRWxlbWVudCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibWFwIiwgdHJ1ZSk7CiAgICB0aGlzLmVxdWF0ZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5lcXVhdGVSYW5nZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBNZWRpdW1JbmZvIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJtZWRpdW1JbmZvIiwgdHJ1ZSk7CiAgICB0aGlzLm1hcCA9IG51bGw7CiAgfQp9CmNsYXNzIGNvbmZpZ19NZXNzYWdlIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJtZXNzYWdlIiwgdHJ1ZSk7CiAgICB0aGlzLm1zZ0lkID0gbnVsbDsKICAgIHRoaXMuc2V2ZXJpdHkgPSBudWxsOwogIH0KfQpjbGFzcyBNZXNzYWdpbmcgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgIm1lc3NhZ2luZyIsIHRydWUpOwogICAgdGhpcy5tZXNzYWdlID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIE1vZGUgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgIm1vZGUiLCBbImFwcGVuZCIsICJvdmVyd3JpdGUiXSk7CiAgfQp9CmNsYXNzIE1vZGlmeUFubm90cyBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJtb2RpZnlBbm5vdHMiKTsKICB9Cn0KY2xhc3MgTXNnSWQgZXh0ZW5kcyBJbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJtc2dJZCIsIDEsIG4gPT4gbiA+PSAxKTsKICB9Cn0KY2xhc3MgTmFtZUF0dHIgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgIm5hbWVBdHRyIik7CiAgfQp9CmNsYXNzIE5ldmVyRW1iZWQgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJuZXZlckVtYmVkIik7CiAgfQp9CmNsYXNzIE51bWJlck9mQ29waWVzIGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibnVtYmVyT2ZDb3BpZXMiLCBudWxsLCBuID0+IG4gPj0gMiAmJiBuIDw9IDUpOwogIH0KfQpjbGFzcyBPcGVuQWN0aW9uIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJvcGVuQWN0aW9uIiwgdHJ1ZSk7CiAgICB0aGlzLmRlc3RpbmF0aW9uID0gbnVsbDsKICB9Cn0KY2xhc3MgT3V0cHV0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJvdXRwdXQiLCB0cnVlKTsKICAgIHRoaXMudG8gPSBudWxsOwogICAgdGhpcy50eXBlID0gbnVsbDsKICAgIHRoaXMudXJpID0gbnVsbDsKICB9Cn0KY2xhc3MgT3V0cHV0QmluIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJvdXRwdXRCaW4iKTsKICB9Cn0KY2xhc3MgT3V0cHV0WFNMIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJvdXRwdXRYU0wiLCB0cnVlKTsKICAgIHRoaXMudXJpID0gbnVsbDsKICB9Cn0KY2xhc3MgT3ZlcnByaW50IGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJvdmVycHJpbnQiLCBbIm5vbmUiLCAiYm90aCIsICJkcmF3IiwgImZpZWxkIl0pOwogIH0KfQpjbGFzcyBQYWNrZXRzIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwYWNrZXRzIik7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgaWYgKHRoaXNbJGNvbnRlbnRdID09PSAiKiIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpc1skY29udGVudF0gPSB0aGlzWyRjb250ZW50XS50cmltKCkuc3BsaXQoL1xzKy8pLmZpbHRlcih4ID0+IFsiY29uZmlnIiwgImRhdGFzZXRzIiwgInRlbXBsYXRlIiwgInhmZGYiLCAieHNsdCJdLmluY2x1ZGVzKHgpKTsKICB9Cn0KY2xhc3MgUGFnZU9mZnNldCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGFnZU9mZnNldCIpOwogICAgdGhpcy54ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMueCwKICAgICAgZGVmYXVsdFZhbHVlOiAidXNlWERDU2V0dGluZyIsCiAgICAgIHZhbGlkYXRlOiBuID0+IHRydWUKICAgIH0pOwogICAgdGhpcy55ID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMueSwKICAgICAgZGVmYXVsdFZhbHVlOiAidXNlWERDU2V0dGluZyIsCiAgICAgIHZhbGlkYXRlOiBuID0+IHRydWUKICAgIH0pOwogIH0KfQpjbGFzcyBQYWdlUmFuZ2UgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBhZ2VSYW5nZSIpOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIGNvbnN0IG51bWJlcnMgPSB0aGlzWyRjb250ZW50XS50cmltKCkuc3BsaXQoL1xzKy8pLm1hcCh4ID0+IHBhcnNlSW50KHgsIDEwKSk7CiAgICBjb25zdCByYW5nZXMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IG51bWJlcnMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICByYW5nZXMucHVzaChudW1iZXJzLnNsaWNlKGksIGkgKyAyKSk7CiAgICB9CiAgICB0aGlzWyRjb250ZW50XSA9IHJhbmdlczsKICB9Cn0KY2xhc3MgUGFnaW5hdGlvbiBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGFnaW5hdGlvbiIsIFsic2ltcGxleCIsICJkdXBsZXhTaG9ydEVkZ2UiLCAiZHVwbGV4TG9uZ0VkZ2UiXSk7CiAgfQp9CmNsYXNzIFBhZ2luYXRpb25PdmVycmlkZSBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGFnaW5hdGlvbk92ZXJyaWRlIiwgWyJub25lIiwgImZvcmNlRHVwbGV4IiwgImZvcmNlRHVwbGV4TG9uZ0VkZ2UiLCAiZm9yY2VEdXBsZXhTaG9ydEVkZ2UiLCAiZm9yY2VTaW1wbGV4Il0pOwogIH0KfQpjbGFzcyBQYXJ0IGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGFydCIsIDEsIG4gPT4gZmFsc2UpOwogIH0KfQpjbGFzcyBQY2wgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBjbCIsIHRydWUpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5iYXRjaE91dHB1dCA9IG51bGw7CiAgICB0aGlzLmZvbnRJbmZvID0gbnVsbDsKICAgIHRoaXMuam9nID0gbnVsbDsKICAgIHRoaXMubWVkaXVtSW5mbyA9IG51bGw7CiAgICB0aGlzLm91dHB1dEJpbiA9IG51bGw7CiAgICB0aGlzLnBhZ2VPZmZzZXQgPSBudWxsOwogICAgdGhpcy5zdGFwbGUgPSBudWxsOwogICAgdGhpcy54ZGMgPSBudWxsOwogIH0KfQpjbGFzcyBQZGYgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBkZiIsIHRydWUpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5hZG9iZUV4dGVuc2lvbkxldmVsID0gbnVsbDsKICAgIHRoaXMuYmF0Y2hPdXRwdXQgPSBudWxsOwogICAgdGhpcy5jb21wcmVzc2lvbiA9IG51bGw7CiAgICB0aGlzLmNyZWF0b3IgPSBudWxsOwogICAgdGhpcy5lbmNyeXB0aW9uID0gbnVsbDsKICAgIHRoaXMuZm9udEluZm8gPSBudWxsOwogICAgdGhpcy5pbnRlcmFjdGl2ZSA9IG51bGw7CiAgICB0aGlzLmxpbmVhcml6ZWQgPSBudWxsOwogICAgdGhpcy5vcGVuQWN0aW9uID0gbnVsbDsKICAgIHRoaXMucGRmYSA9IG51bGw7CiAgICB0aGlzLnByb2R1Y2VyID0gbnVsbDsKICAgIHRoaXMucmVuZGVyUG9saWN5ID0gbnVsbDsKICAgIHRoaXMuc2NyaXB0TW9kZWwgPSBudWxsOwogICAgdGhpcy5zaWxlbnRQcmludCA9IG51bGw7CiAgICB0aGlzLnN1Ym1pdEZvcm1hdCA9IG51bGw7CiAgICB0aGlzLnRhZ2dlZCA9IG51bGw7CiAgICB0aGlzLnZlcnNpb24gPSBudWxsOwogICAgdGhpcy52aWV3ZXJQcmVmZXJlbmNlcyA9IG51bGw7CiAgICB0aGlzLnhkYyA9IG51bGw7CiAgfQp9CmNsYXNzIFBkZmEgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBkZmEiLCB0cnVlKTsKICAgIHRoaXMuYW1kID0gbnVsbDsKICAgIHRoaXMuY29uZm9ybWFuY2UgPSBudWxsOwogICAgdGhpcy5pbmNsdWRlWERQQ29udGVudCA9IG51bGw7CiAgICB0aGlzLnBhcnQgPSBudWxsOwogIH0KfQpjbGFzcyBQZXJtaXNzaW9ucyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGVybWlzc2lvbnMiLCB0cnVlKTsKICAgIHRoaXMuYWNjZXNzaWJsZUNvbnRlbnQgPSBudWxsOwogICAgdGhpcy5jaGFuZ2UgPSBudWxsOwogICAgdGhpcy5jb250ZW50Q29weSA9IG51bGw7CiAgICB0aGlzLmRvY3VtZW50QXNzZW1ibHkgPSBudWxsOwogICAgdGhpcy5mb3JtRmllbGRGaWxsaW5nID0gbnVsbDsKICAgIHRoaXMubW9kaWZ5QW5ub3RzID0gbnVsbDsKICAgIHRoaXMucGxhaW50ZXh0TWV0YWRhdGEgPSBudWxsOwogICAgdGhpcy5wcmludCA9IG51bGw7CiAgICB0aGlzLnByaW50SGlnaFF1YWxpdHkgPSBudWxsOwogIH0KfQpjbGFzcyBQaWNrVHJheUJ5UERGU2l6ZSBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwaWNrVHJheUJ5UERGU2l6ZSIpOwogIH0KfQpjbGFzcyBjb25maWdfUGljdHVyZSBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGljdHVyZSIpOwogIH0KfQpjbGFzcyBQbGFpbnRleHRNZXRhZGF0YSBleHRlbmRzIE9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwbGFpbnRleHRNZXRhZGF0YSIpOwogIH0KfQpjbGFzcyBQcmVzZW5jZSBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicHJlc2VuY2UiLCBbInByZXNlcnZlIiwgImRpc3NvbHZlIiwgImRpc3NvbHZlU3RydWN0dXJlIiwgImlnbm9yZSIsICJyZW1vdmUiXSk7CiAgfQp9CmNsYXNzIFByZXNlbnQgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInByZXNlbnQiLCB0cnVlKTsKICAgIHRoaXMuYmVoYXZpb3JPdmVycmlkZSA9IG51bGw7CiAgICB0aGlzLmNhY2hlID0gbnVsbDsKICAgIHRoaXMuY29tbW9uID0gbnVsbDsKICAgIHRoaXMuY29waWVzID0gbnVsbDsKICAgIHRoaXMuZGVzdGluYXRpb24gPSBudWxsOwogICAgdGhpcy5pbmNyZW1lbnRhbE1lcmdlID0gbnVsbDsKICAgIHRoaXMubGF5b3V0ID0gbnVsbDsKICAgIHRoaXMub3V0cHV0ID0gbnVsbDsKICAgIHRoaXMub3ZlcnByaW50ID0gbnVsbDsKICAgIHRoaXMucGFnaW5hdGlvbiA9IG51bGw7CiAgICB0aGlzLnBhZ2luYXRpb25PdmVycmlkZSA9IG51bGw7CiAgICB0aGlzLnNjcmlwdCA9IG51bGw7CiAgICB0aGlzLnZhbGlkYXRlID0gbnVsbDsKICAgIHRoaXMueGRwID0gbnVsbDsKICAgIHRoaXMuZHJpdmVyID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmxhYmVsUHJpbnRlciA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wY2wgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucGRmID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnBzID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1Ym1pdFVybCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy53ZWJDbGllbnQgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuenBsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIFByaW50IGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInByaW50Iik7CiAgfQp9CmNsYXNzIFByaW50SGlnaFF1YWxpdHkgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicHJpbnRIaWdoUXVhbGl0eSIpOwogIH0KfQpjbGFzcyBQcmludFNjYWxpbmcgZXh0ZW5kcyBPcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInByaW50U2NhbGluZyIsIFsiYXBwZGVmYXVsdCIsICJub1NjYWxpbmciXSk7CiAgfQp9CmNsYXNzIFByaW50ZXJOYW1lIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwcmludGVyTmFtZSIpOwogIH0KfQpjbGFzcyBQcm9kdWNlciBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicHJvZHVjZXIiKTsKICB9Cn0KY2xhc3MgUHMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBzIiwgdHJ1ZSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLmJhdGNoT3V0cHV0ID0gbnVsbDsKICAgIHRoaXMuZm9udEluZm8gPSBudWxsOwogICAgdGhpcy5qb2cgPSBudWxsOwogICAgdGhpcy5tZWRpdW1JbmZvID0gbnVsbDsKICAgIHRoaXMub3V0cHV0QmluID0gbnVsbDsKICAgIHRoaXMuc3RhcGxlID0gbnVsbDsKICAgIHRoaXMueGRjID0gbnVsbDsKICB9Cn0KY2xhc3MgUmFuZ2UgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJyYW5nZSIpOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbJGNvbnRlbnRdID0gdGhpc1skY29udGVudF0uc3BsaXQoIiwiLCAyKS5tYXAocmFuZ2UgPT4gcmFuZ2Uuc3BsaXQoIi0iKS5tYXAoeCA9PiBwYXJzZUludCh4LnRyaW0oKSwgMTApKSkuZmlsdGVyKHJhbmdlID0+IHJhbmdlLmV2ZXJ5KHggPT4gIWlzTmFOKHgpKSkubWFwKHJhbmdlID0+IHsKICAgICAgaWYgKHJhbmdlLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHJhbmdlLnB1c2gocmFuZ2VbMF0pOwogICAgICB9CiAgICAgIHJldHVybiByYW5nZTsKICAgIH0pOwogIH0KfQpjbGFzcyBSZWNvcmQgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJyZWNvcmQiKTsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICB0aGlzWyRjb250ZW50XSA9IHRoaXNbJGNvbnRlbnRdLnRyaW0oKTsKICAgIGNvbnN0IG4gPSBwYXJzZUludCh0aGlzWyRjb250ZW50XSwgMTApOwogICAgaWYgKCFpc05hTihuKSAmJiBuID49IDApIHsKICAgICAgdGhpc1skY29udGVudF0gPSBuOwogICAgfQogIH0KfQpjbGFzcyBSZWxldmFudCBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInJlbGV2YW50Iik7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgdGhpc1skY29udGVudF0gPSB0aGlzWyRjb250ZW50XS50cmltKCkuc3BsaXQoL1xzKy8pOwogIH0KfQpjbGFzcyBSZW5hbWUgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJyZW5hbWUiKTsKICB9CiAgWyRmaW5hbGl6ZV0oKSB7CiAgICB0aGlzWyRjb250ZW50XSA9IHRoaXNbJGNvbnRlbnRdLnRyaW0oKTsKICAgIGlmICh0aGlzWyRjb250ZW50XS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoInhtbCIpIHx8IG5ldyBSZWdFeHAoIltcXHB7TH1fXVtcXHB7TH1cXGQuX1xccHtNfS1dKiIsICJ1IikudGVzdCh0aGlzWyRjb250ZW50XSkpIHsKICAgICAgd2FybigiWEZBIC0gUmVuYW1lOiBpbnZhbGlkIFhGQSBuYW1lIik7CiAgICB9CiAgfQp9CmNsYXNzIFJlbmRlclBvbGljeSBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicmVuZGVyUG9saWN5IiwgWyJzZXJ2ZXIiLCAiY2xpZW50Il0pOwogIH0KfQpjbGFzcyBSdW5TY3JpcHRzIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJydW5TY3JpcHRzIiwgWyJib3RoIiwgImNsaWVudCIsICJub25lIiwgInNlcnZlciJdKTsKICB9Cn0KY2xhc3MgY29uZmlnX1NjcmlwdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic2NyaXB0IiwgdHJ1ZSk7CiAgICB0aGlzLmN1cnJlbnRQYWdlID0gbnVsbDsKICAgIHRoaXMuZXhjbHVkZSA9IG51bGw7CiAgICB0aGlzLnJ1blNjcmlwdHMgPSBudWxsOwogIH0KfQpjbGFzcyBTY3JpcHRNb2RlbCBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic2NyaXB0TW9kZWwiLCBbIlhGQSIsICJub25lIl0pOwogIH0KfQpjbGFzcyBTZXZlcml0eSBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic2V2ZXJpdHkiLCBbImlnbm9yZSIsICJlcnJvciIsICJpbmZvcm1hdGlvbiIsICJ0cmFjZSIsICJ3YXJuaW5nIl0pOwogIH0KfQpjbGFzcyBTaWxlbnRQcmludCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic2lsZW50UHJpbnQiLCB0cnVlKTsKICAgIHRoaXMuYWRkU2lsZW50UHJpbnQgPSBudWxsOwogICAgdGhpcy5wcmludGVyTmFtZSA9IG51bGw7CiAgfQp9CmNsYXNzIFN0YXBsZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic3RhcGxlIik7CiAgICB0aGlzLm1vZGUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5tb2RlLCBbInVzZVByaW50ZXJTZXR0aW5nIiwgIm9uIiwgIm9mZiJdKTsKICB9Cn0KY2xhc3MgU3RhcnROb2RlIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJzdGFydE5vZGUiKTsKICB9Cn0KY2xhc3MgU3RhcnRQYWdlIGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic3RhcnRQYWdlIiwgMCwgbiA9PiB0cnVlKTsKICB9Cn0KY2xhc3MgU3VibWl0Rm9ybWF0IGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJzdWJtaXRGb3JtYXQiLCBbImh0bWwiLCAiZGVsZWdhdGUiLCAiZmRmIiwgInhtbCIsICJwZGYiXSk7CiAgfQp9CmNsYXNzIFN1Ym1pdFVybCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic3VibWl0VXJsIik7CiAgfQp9CmNsYXNzIFN1YnNldEJlbG93IGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic3Vic2V0QmVsb3ciLCAxMDAsIG4gPT4gbiA+PSAwICYmIG4gPD0gMTAwKTsKICB9Cn0KY2xhc3MgU3VwcHJlc3NCYW5uZXIgZXh0ZW5kcyBPcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAic3VwcHJlc3NCYW5uZXIiKTsKICB9Cn0KY2xhc3MgVGFnZ2VkIGV4dGVuZHMgT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInRhZ2dlZCIpOwogIH0KfQpjbGFzcyBjb25maWdfVGVtcGxhdGUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInRlbXBsYXRlIiwgdHJ1ZSk7CiAgICB0aGlzLmJhc2UgPSBudWxsOwogICAgdGhpcy5yZWxldmFudCA9IG51bGw7CiAgICB0aGlzLnN0YXJ0UGFnZSA9IG51bGw7CiAgICB0aGlzLnVyaSA9IG51bGw7CiAgICB0aGlzLnhzbCA9IG51bGw7CiAgfQp9CmNsYXNzIFRocmVzaG9sZCBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidGhyZXNob2xkIiwgWyJ0cmFjZSIsICJlcnJvciIsICJpbmZvcm1hdGlvbiIsICJ3YXJuaW5nIl0pOwogIH0KfQpjbGFzcyBUbyBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidG8iLCBbIm51bGwiLCAibWVtb3J5IiwgInN0ZGVyciIsICJzdGRvdXQiLCAic3lzdGVtIiwgInVyaSJdKTsKICB9Cn0KY2xhc3MgVGVtcGxhdGVDYWNoZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidGVtcGxhdGVDYWNoZSIpOwogICAgdGhpcy5tYXhFbnRyaWVzID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMubWF4RW50cmllcywKICAgICAgZGVmYXVsdFZhbHVlOiA1LAogICAgICB2YWxpZGF0ZTogbiA9PiBuID49IDAKICAgIH0pOwogIH0KfQpjbGFzcyBUcmFjZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidHJhY2UiLCB0cnVlKTsKICAgIHRoaXMuYXJlYSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBUcmFuc2Zvcm0gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInRyYW5zZm9ybSIsIHRydWUpOwogICAgdGhpcy5ncm91cFBhcmVudCA9IG51bGw7CiAgICB0aGlzLmlmRW1wdHkgPSBudWxsOwogICAgdGhpcy5uYW1lQXR0ciA9IG51bGw7CiAgICB0aGlzLnBpY3R1cmUgPSBudWxsOwogICAgdGhpcy5wcmVzZW5jZSA9IG51bGw7CiAgICB0aGlzLnJlbmFtZSA9IG51bGw7CiAgICB0aGlzLndoaXRlc3BhY2UgPSBudWxsOwogIH0KfQpjbGFzcyBUeXBlIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ0eXBlIiwgWyJub25lIiwgImFzY2lpODUiLCAiYXNjaWlIZXgiLCAiY2NpdHRmYXgiLCAiZmxhdGUiLCAibHp3IiwgInJ1bkxlbmd0aCIsICJuYXRpdmUiLCAieGRwIiwgIm1lcmdlZFhEUCJdKTsKICB9Cn0KY2xhc3MgVXJpIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ1cmkiKTsKICB9Cn0KY2xhc3MgY29uZmlnX1ZhbGlkYXRlIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ2YWxpZGF0ZSIsIFsicHJlU3VibWl0IiwgInByZVByaW50IiwgInByZUV4ZWN1dGUiLCAicHJlU2F2ZSJdKTsKICB9Cn0KY2xhc3MgVmFsaWRhdGVBcHByb3ZhbFNpZ25hdHVyZXMgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ2YWxpZGF0ZUFwcHJvdmFsU2lnbmF0dXJlcyIpOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbJGNvbnRlbnRdID0gdGhpc1skY29udGVudF0udHJpbSgpLnNwbGl0KC9ccysvKS5maWx0ZXIoeCA9PiBbImRvY1JlYWR5IiwgInBvc3RTaWduIl0uaW5jbHVkZXMoeCkpOwogIH0KfQpjbGFzcyBWYWxpZGF0aW9uTWVzc2FnaW5nIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ2YWxpZGF0aW9uTWVzc2FnaW5nIiwgWyJhbGxNZXNzYWdlc0luZGl2aWR1YWxseSIsICJhbGxNZXNzYWdlc1RvZ2V0aGVyIiwgImZpcnN0TWVzc2FnZU9ubHkiLCAibm9NZXNzYWdlcyJdKTsKICB9Cn0KY2xhc3MgVmVyc2lvbiBleHRlbmRzIE9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidmVyc2lvbiIsIFsiMS43IiwgIjEuNiIsICIxLjUiLCAiMS40IiwgIjEuMyIsICIxLjIiXSk7CiAgfQp9CmNsYXNzIFZlcnNpb25Db250cm9sIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJWZXJzaW9uQ29udHJvbCIpOwogICAgdGhpcy5vdXRwdXRCZWxvdyA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLm91dHB1dEJlbG93LCBbIndhcm4iLCAiZXJyb3IiLCAidXBkYXRlIl0pOwogICAgdGhpcy5zb3VyY2VBYm92ZSA9IGdldFN0cmluZ09wdGlvbihhdHRyaWJ1dGVzLnNvdXJjZUFib3ZlLCBbIndhcm4iLCAiZXJyb3IiXSk7CiAgICB0aGlzLnNvdXJjZUJlbG93ID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMuc291cmNlQmVsb3csIFsidXBkYXRlIiwgIm1haW50YWluIl0pOwogIH0KfQpjbGFzcyBWaWV3ZXJQcmVmZXJlbmNlcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidmlld2VyUHJlZmVyZW5jZXMiLCB0cnVlKTsKICAgIHRoaXMuQURCRV9KU0NvbnNvbGUgPSBudWxsOwogICAgdGhpcy5BREJFX0pTRGVidWdnZXIgPSBudWxsOwogICAgdGhpcy5hZGRWaWV3ZXJQcmVmZXJlbmNlcyA9IG51bGw7CiAgICB0aGlzLmR1cGxleE9wdGlvbiA9IG51bGw7CiAgICB0aGlzLmVuZm9yY2UgPSBudWxsOwogICAgdGhpcy5udW1iZXJPZkNvcGllcyA9IG51bGw7CiAgICB0aGlzLnBhZ2VSYW5nZSA9IG51bGw7CiAgICB0aGlzLnBpY2tUcmF5QnlQREZTaXplID0gbnVsbDsKICAgIHRoaXMucHJpbnRTY2FsaW5nID0gbnVsbDsKICB9Cn0KY2xhc3MgV2ViQ2xpZW50IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ3ZWJDbGllbnQiLCB0cnVlKTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSA/IGF0dHJpYnV0ZXMubmFtZS50cmltKCkgOiAiIjsKICAgIHRoaXMuZm9udEluZm8gPSBudWxsOwogICAgdGhpcy54ZGMgPSBudWxsOwogIH0KfQpjbGFzcyBXaGl0ZXNwYWNlIGV4dGVuZHMgT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ3aGl0ZXNwYWNlIiwgWyJwcmVzZXJ2ZSIsICJsdHJpbSIsICJub3JtYWxpemUiLCAicnRyaW0iLCAidHJpbSJdKTsKICB9Cn0KY2xhc3MgV2luZG93IGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAid2luZG93Iik7CiAgfQogIFskZmluYWxpemVdKCkgewogICAgY29uc3QgcGFpciA9IHRoaXNbJGNvbnRlbnRdLnNwbGl0KCIsIiwgMikubWFwKHggPT4gcGFyc2VJbnQoeC50cmltKCksIDEwKSk7CiAgICBpZiAocGFpci5zb21lKHggPT4gaXNOYU4oeCkpKSB7CiAgICAgIHRoaXNbJGNvbnRlbnRdID0gWzAsIDBdOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAocGFpci5sZW5ndGggPT09IDEpIHsKICAgICAgcGFpci5wdXNoKHBhaXJbMF0pOwogICAgfQogICAgdGhpc1skY29udGVudF0gPSBwYWlyOwogIH0KfQpjbGFzcyBYZGMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInhkYyIsIHRydWUpOwogICAgdGhpcy51cmkgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMueHNsID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIFhkcCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAieGRwIiwgdHJ1ZSk7CiAgICB0aGlzLnBhY2tldHMgPSBudWxsOwogIH0KfQpjbGFzcyBYc2wgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInhzbCIsIHRydWUpOwogICAgdGhpcy5kZWJ1ZyA9IG51bGw7CiAgICB0aGlzLnVyaSA9IG51bGw7CiAgfQp9CmNsYXNzIFpwbCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAienBsIiwgdHJ1ZSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgPyBhdHRyaWJ1dGVzLm5hbWUudHJpbSgpIDogIiI7CiAgICB0aGlzLmJhdGNoT3V0cHV0ID0gbnVsbDsKICAgIHRoaXMuZmxpcExhYmVsID0gbnVsbDsKICAgIHRoaXMuZm9udEluZm8gPSBudWxsOwogICAgdGhpcy54ZGMgPSBudWxsOwogIH0KfQpjbGFzcyBDb25maWdOYW1lc3BhY2UgewogIHN0YXRpYyBbJGJ1aWxkWEZBT2JqZWN0XShuYW1lLCBhdHRyaWJ1dGVzKSB7CiAgICBpZiAoQ29uZmlnTmFtZXNwYWNlLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgIHJldHVybiBDb25maWdOYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBzdGF0aWMgYWNyb2JhdChhdHRycykgewogICAgcmV0dXJuIG5ldyBBY3JvYmF0KGF0dHJzKTsKICB9CiAgc3RhdGljIGFjcm9iYXQ3KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFjcm9iYXQ3KGF0dHJzKTsKICB9CiAgc3RhdGljIEFEQkVfSlNDb25zb2xlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFEQkVfSlNDb25zb2xlKGF0dHJzKTsKICB9CiAgc3RhdGljIEFEQkVfSlNEZWJ1Z2dlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBBREJFX0pTRGVidWdnZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgYWRkU2lsZW50UHJpbnQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQWRkU2lsZW50UHJpbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgYWRkVmlld2VyUHJlZmVyZW5jZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQWRkVmlld2VyUHJlZmVyZW5jZXMoYXR0cnMpOwogIH0KICBzdGF0aWMgYWRqdXN0RGF0YShhdHRycykgewogICAgcmV0dXJuIG5ldyBBZGp1c3REYXRhKGF0dHJzKTsKICB9CiAgc3RhdGljIGFkb2JlRXh0ZW5zaW9uTGV2ZWwoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQWRvYmVFeHRlbnNpb25MZXZlbChhdHRycyk7CiAgfQogIHN0YXRpYyBhZ2VudChhdHRycykgewogICAgcmV0dXJuIG5ldyBBZ2VudChhdHRycyk7CiAgfQogIHN0YXRpYyBhbHdheXNFbWJlZChhdHRycykgewogICAgcmV0dXJuIG5ldyBBbHdheXNFbWJlZChhdHRycyk7CiAgfQogIHN0YXRpYyBhbWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQW1kKGF0dHJzKTsKICB9CiAgc3RhdGljIGFyZWEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgY29uZmlnX0FyZWEoYXR0cnMpOwogIH0KICBzdGF0aWMgYXR0cmlidXRlcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBBdHRyaWJ1dGVzKGF0dHJzKTsKICB9CiAgc3RhdGljIGF1dG9TYXZlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEF1dG9TYXZlKGF0dHJzKTsKICB9CiAgc3RhdGljIGJhc2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQmFzZShhdHRycyk7CiAgfQogIHN0YXRpYyBiYXRjaE91dHB1dChhdHRycykgewogICAgcmV0dXJuIG5ldyBCYXRjaE91dHB1dChhdHRycyk7CiAgfQogIHN0YXRpYyBiZWhhdmlvck92ZXJyaWRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJlaGF2aW9yT3ZlcnJpZGUoYXR0cnMpOwogIH0KICBzdGF0aWMgY2FjaGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ2FjaGUoYXR0cnMpOwogIH0KICBzdGF0aWMgY2hhbmdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENoYW5nZShhdHRycyk7CiAgfQogIHN0YXRpYyBjb21tb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29tbW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbXByZXNzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbXByZXNzKGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbXByZXNzTG9naWNhbFN0cnVjdHVyZShhdHRycykgewogICAgcmV0dXJuIG5ldyBDb21wcmVzc0xvZ2ljYWxTdHJ1Y3R1cmUoYXR0cnMpOwogIH0KICBzdGF0aWMgY29tcHJlc3NPYmplY3RTdHJlYW0oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29tcHJlc3NPYmplY3RTdHJlYW0oYXR0cnMpOwogIH0KICBzdGF0aWMgY29tcHJlc3Npb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29tcHJlc3Npb24oYXR0cnMpOwogIH0KICBzdGF0aWMgY29uZmlnKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbmZpZyhhdHRycyk7CiAgfQogIHN0YXRpYyBjb25mb3JtYW5jZShhdHRycykgewogICAgcmV0dXJuIG5ldyBDb25mb3JtYW5jZShhdHRycyk7CiAgfQogIHN0YXRpYyBjb250ZW50Q29weShhdHRycykgewogICAgcmV0dXJuIG5ldyBDb250ZW50Q29weShhdHRycyk7CiAgfQogIHN0YXRpYyBjb3BpZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29waWVzKGF0dHJzKTsKICB9CiAgc3RhdGljIGNyZWF0b3IoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ3JlYXRvcihhdHRycyk7CiAgfQogIHN0YXRpYyBjdXJyZW50UGFnZShhdHRycykgewogICAgcmV0dXJuIG5ldyBDdXJyZW50UGFnZShhdHRycyk7CiAgfQogIHN0YXRpYyBkYXRhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERhdGEoYXR0cnMpOwogIH0KICBzdGF0aWMgZGVidWcoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGVidWcoYXR0cnMpOwogIH0KICBzdGF0aWMgZGVmYXVsdFR5cGVmYWNlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERlZmF1bHRUeXBlZmFjZShhdHRycyk7CiAgfQogIHN0YXRpYyBkZXN0aW5hdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBEZXN0aW5hdGlvbihhdHRycyk7CiAgfQogIHN0YXRpYyBkb2N1bWVudEFzc2VtYmx5KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERvY3VtZW50QXNzZW1ibHkoYXR0cnMpOwogIH0KICBzdGF0aWMgZHJpdmVyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERyaXZlcihhdHRycyk7CiAgfQogIHN0YXRpYyBkdXBsZXhPcHRpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRHVwbGV4T3B0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGR5bmFtaWNSZW5kZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRHluYW1pY1JlbmRlcihhdHRycyk7CiAgfQogIHN0YXRpYyBlbWJlZChhdHRycykgewogICAgcmV0dXJuIG5ldyBFbWJlZChhdHRycyk7CiAgfQogIHN0YXRpYyBlbmNyeXB0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IGNvbmZpZ19FbmNyeXB0KGF0dHJzKTsKICB9CiAgc3RhdGljIGVuY3J5cHRpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgY29uZmlnX0VuY3J5cHRpb24oYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jcnlwdGlvbkxldmVsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVuY3J5cHRpb25MZXZlbChhdHRycyk7CiAgfQogIHN0YXRpYyBlbmZvcmNlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVuZm9yY2UoYXR0cnMpOwogIH0KICBzdGF0aWMgZXF1YXRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVxdWF0ZShhdHRycyk7CiAgfQogIHN0YXRpYyBlcXVhdGVSYW5nZShhdHRycykgewogICAgcmV0dXJuIG5ldyBFcXVhdGVSYW5nZShhdHRycyk7CiAgfQogIHN0YXRpYyBleGNsdWRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEV4Y2x1ZGUoYXR0cnMpOwogIH0KICBzdGF0aWMgZXhjbHVkZU5TKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEV4Y2x1ZGVOUyhhdHRycyk7CiAgfQogIHN0YXRpYyBmbGlwTGFiZWwoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRmxpcExhYmVsKGF0dHJzKTsKICB9CiAgc3RhdGljIGZvbnRJbmZvKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IGNvbmZpZ19Gb250SW5mbyhhdHRycyk7CiAgfQogIHN0YXRpYyBmb3JtRmllbGRGaWxsaW5nKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEZvcm1GaWVsZEZpbGxpbmcoYXR0cnMpOwogIH0KICBzdGF0aWMgZ3JvdXBQYXJlbnQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgR3JvdXBQYXJlbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgaWZFbXB0eShhdHRycykgewogICAgcmV0dXJuIG5ldyBJZkVtcHR5KGF0dHJzKTsKICB9CiAgc3RhdGljIGluY2x1ZGVYRFBDb250ZW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEluY2x1ZGVYRFBDb250ZW50KGF0dHJzKTsKICB9CiAgc3RhdGljIGluY3JlbWVudGFsTG9hZChhdHRycykgewogICAgcmV0dXJuIG5ldyBJbmNyZW1lbnRhbExvYWQoYXR0cnMpOwogIH0KICBzdGF0aWMgaW5jcmVtZW50YWxNZXJnZShhdHRycykgewogICAgcmV0dXJuIG5ldyBJbmNyZW1lbnRhbE1lcmdlKGF0dHJzKTsKICB9CiAgc3RhdGljIGludGVyYWN0aXZlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEludGVyYWN0aXZlKGF0dHJzKTsKICB9CiAgc3RhdGljIGpvZyhhdHRycykgewogICAgcmV0dXJuIG5ldyBKb2coYXR0cnMpOwogIH0KICBzdGF0aWMgbGFiZWxQcmludGVyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IExhYmVsUHJpbnRlcihhdHRycyk7CiAgfQogIHN0YXRpYyBsYXlvdXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTGF5b3V0KGF0dHJzKTsKICB9CiAgc3RhdGljIGxldmVsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IExldmVsKGF0dHJzKTsKICB9CiAgc3RhdGljIGxpbmVhcml6ZWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTGluZWFyaXplZChhdHRycyk7CiAgfQogIHN0YXRpYyBsb2NhbGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTG9jYWxlKGF0dHJzKTsKICB9CiAgc3RhdGljIGxvY2FsZVNldChhdHRycykgewogICAgcmV0dXJuIG5ldyBMb2NhbGVTZXQoYXR0cnMpOwogIH0KICBzdGF0aWMgbG9nKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IExvZyhhdHRycyk7CiAgfQogIHN0YXRpYyBtYXAoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTWFwRWxlbWVudChhdHRycyk7CiAgfQogIHN0YXRpYyBtZWRpdW1JbmZvKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1lZGl1bUluZm8oYXR0cnMpOwogIH0KICBzdGF0aWMgbWVzc2FnZShhdHRycykgewogICAgcmV0dXJuIG5ldyBjb25maWdfTWVzc2FnZShhdHRycyk7CiAgfQogIHN0YXRpYyBtZXNzYWdpbmcoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTWVzc2FnaW5nKGF0dHJzKTsKICB9CiAgc3RhdGljIG1vZGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTW9kZShhdHRycyk7CiAgfQogIHN0YXRpYyBtb2RpZnlBbm5vdHMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTW9kaWZ5QW5ub3RzKGF0dHJzKTsKICB9CiAgc3RhdGljIG1zZ0lkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1zZ0lkKGF0dHJzKTsKICB9CiAgc3RhdGljIG5hbWVBdHRyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE5hbWVBdHRyKGF0dHJzKTsKICB9CiAgc3RhdGljIG5ldmVyRW1iZWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTmV2ZXJFbWJlZChhdHRycyk7CiAgfQogIHN0YXRpYyBudW1iZXJPZkNvcGllcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBOdW1iZXJPZkNvcGllcyhhdHRycyk7CiAgfQogIHN0YXRpYyBvcGVuQWN0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE9wZW5BY3Rpb24oYXR0cnMpOwogIH0KICBzdGF0aWMgb3V0cHV0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE91dHB1dChhdHRycyk7CiAgfQogIHN0YXRpYyBvdXRwdXRCaW4oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgT3V0cHV0QmluKGF0dHJzKTsKICB9CiAgc3RhdGljIG91dHB1dFhTTChhdHRycykgewogICAgcmV0dXJuIG5ldyBPdXRwdXRYU0woYXR0cnMpOwogIH0KICBzdGF0aWMgb3ZlcnByaW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE92ZXJwcmludChhdHRycyk7CiAgfQogIHN0YXRpYyBwYWNrZXRzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBhY2tldHMoYXR0cnMpOwogIH0KICBzdGF0aWMgcGFnZU9mZnNldChhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWdlT2Zmc2V0KGF0dHJzKTsKICB9CiAgc3RhdGljIHBhZ2VSYW5nZShhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWdlUmFuZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgcGFnaW5hdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWdpbmF0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIHBhZ2luYXRpb25PdmVycmlkZShhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWdpbmF0aW9uT3ZlcnJpZGUoYXR0cnMpOwogIH0KICBzdGF0aWMgcGFydChhdHRycykgewogICAgcmV0dXJuIG5ldyBQYXJ0KGF0dHJzKTsKICB9CiAgc3RhdGljIHBjbChhdHRycykgewogICAgcmV0dXJuIG5ldyBQY2woYXR0cnMpOwogIH0KICBzdGF0aWMgcGRmKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBkZihhdHRycyk7CiAgfQogIHN0YXRpYyBwZGZhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBkZmEoYXR0cnMpOwogIH0KICBzdGF0aWMgcGVybWlzc2lvbnMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGVybWlzc2lvbnMoYXR0cnMpOwogIH0KICBzdGF0aWMgcGlja1RyYXlCeVBERlNpemUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGlja1RyYXlCeVBERlNpemUoYXR0cnMpOwogIH0KICBzdGF0aWMgcGljdHVyZShhdHRycykgewogICAgcmV0dXJuIG5ldyBjb25maWdfUGljdHVyZShhdHRycyk7CiAgfQogIHN0YXRpYyBwbGFpbnRleHRNZXRhZGF0YShhdHRycykgewogICAgcmV0dXJuIG5ldyBQbGFpbnRleHRNZXRhZGF0YShhdHRycyk7CiAgfQogIHN0YXRpYyBwcmVzZW5jZShhdHRycykgewogICAgcmV0dXJuIG5ldyBQcmVzZW5jZShhdHRycyk7CiAgfQogIHN0YXRpYyBwcmVzZW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFByZXNlbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgcHJpbnQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUHJpbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgcHJpbnRIaWdoUXVhbGl0eShhdHRycykgewogICAgcmV0dXJuIG5ldyBQcmludEhpZ2hRdWFsaXR5KGF0dHJzKTsKICB9CiAgc3RhdGljIHByaW50U2NhbGluZyhhdHRycykgewogICAgcmV0dXJuIG5ldyBQcmludFNjYWxpbmcoYXR0cnMpOwogIH0KICBzdGF0aWMgcHJpbnRlck5hbWUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUHJpbnRlck5hbWUoYXR0cnMpOwogIH0KICBzdGF0aWMgcHJvZHVjZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUHJvZHVjZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgcHMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUHMoYXR0cnMpOwogIH0KICBzdGF0aWMgcmFuZ2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmFuZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgcmVjb3JkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFJlY29yZChhdHRycyk7CiAgfQogIHN0YXRpYyByZWxldmFudChhdHRycykgewogICAgcmV0dXJuIG5ldyBSZWxldmFudChhdHRycyk7CiAgfQogIHN0YXRpYyByZW5hbWUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmVuYW1lKGF0dHJzKTsKICB9CiAgc3RhdGljIHJlbmRlclBvbGljeShhdHRycykgewogICAgcmV0dXJuIG5ldyBSZW5kZXJQb2xpY3koYXR0cnMpOwogIH0KICBzdGF0aWMgcnVuU2NyaXB0cyhhdHRycykgewogICAgcmV0dXJuIG5ldyBSdW5TY3JpcHRzKGF0dHJzKTsKICB9CiAgc3RhdGljIHNjcmlwdChhdHRycykgewogICAgcmV0dXJuIG5ldyBjb25maWdfU2NyaXB0KGF0dHJzKTsKICB9CiAgc3RhdGljIHNjcmlwdE1vZGVsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNjcmlwdE1vZGVsKGF0dHJzKTsKICB9CiAgc3RhdGljIHNldmVyaXR5KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNldmVyaXR5KGF0dHJzKTsKICB9CiAgc3RhdGljIHNpbGVudFByaW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNpbGVudFByaW50KGF0dHJzKTsKICB9CiAgc3RhdGljIHN0YXBsZShhdHRycykgewogICAgcmV0dXJuIG5ldyBTdGFwbGUoYXR0cnMpOwogIH0KICBzdGF0aWMgc3RhcnROb2RlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN0YXJ0Tm9kZShhdHRycyk7CiAgfQogIHN0YXRpYyBzdGFydFBhZ2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3RhcnRQYWdlKGF0dHJzKTsKICB9CiAgc3RhdGljIHN1Ym1pdEZvcm1hdChhdHRycykgewogICAgcmV0dXJuIG5ldyBTdWJtaXRGb3JtYXQoYXR0cnMpOwogIH0KICBzdGF0aWMgc3VibWl0VXJsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN1Ym1pdFVybChhdHRycyk7CiAgfQogIHN0YXRpYyBzdWJzZXRCZWxvdyhhdHRycykgewogICAgcmV0dXJuIG5ldyBTdWJzZXRCZWxvdyhhdHRycyk7CiAgfQogIHN0YXRpYyBzdXBwcmVzc0Jhbm5lcihhdHRycykgewogICAgcmV0dXJuIG5ldyBTdXBwcmVzc0Jhbm5lcihhdHRycyk7CiAgfQogIHN0YXRpYyB0YWdnZWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVGFnZ2VkKGF0dHJzKTsKICB9CiAgc3RhdGljIHRlbXBsYXRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IGNvbmZpZ19UZW1wbGF0ZShhdHRycyk7CiAgfQogIHN0YXRpYyB0ZW1wbGF0ZUNhY2hlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRlbXBsYXRlQ2FjaGUoYXR0cnMpOwogIH0KICBzdGF0aWMgdGhyZXNob2xkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRocmVzaG9sZChhdHRycyk7CiAgfQogIHN0YXRpYyB0byhhdHRycykgewogICAgcmV0dXJuIG5ldyBUbyhhdHRycyk7CiAgfQogIHN0YXRpYyB0cmFjZShhdHRycykgewogICAgcmV0dXJuIG5ldyBUcmFjZShhdHRycyk7CiAgfQogIHN0YXRpYyB0cmFuc2Zvcm0oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVHJhbnNmb3JtKGF0dHJzKTsKICB9CiAgc3RhdGljIHR5cGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVHlwZShhdHRycyk7CiAgfQogIHN0YXRpYyB1cmkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVXJpKGF0dHJzKTsKICB9CiAgc3RhdGljIHZhbGlkYXRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IGNvbmZpZ19WYWxpZGF0ZShhdHRycyk7CiAgfQogIHN0YXRpYyB2YWxpZGF0ZUFwcHJvdmFsU2lnbmF0dXJlcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBWYWxpZGF0ZUFwcHJvdmFsU2lnbmF0dXJlcyhhdHRycyk7CiAgfQogIHN0YXRpYyB2YWxpZGF0aW9uTWVzc2FnaW5nKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25NZXNzYWdpbmcoYXR0cnMpOwogIH0KICBzdGF0aWMgdmVyc2lvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBWZXJzaW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIHZlcnNpb25Db250cm9sKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFZlcnNpb25Db250cm9sKGF0dHJzKTsKICB9CiAgc3RhdGljIHZpZXdlclByZWZlcmVuY2VzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFZpZXdlclByZWZlcmVuY2VzKGF0dHJzKTsKICB9CiAgc3RhdGljIHdlYkNsaWVudChhdHRycykgewogICAgcmV0dXJuIG5ldyBXZWJDbGllbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgd2hpdGVzcGFjZShhdHRycykgewogICAgcmV0dXJuIG5ldyBXaGl0ZXNwYWNlKGF0dHJzKTsKICB9CiAgc3RhdGljIHdpbmRvdyhhdHRycykgewogICAgcmV0dXJuIG5ldyBXaW5kb3coYXR0cnMpOwogIH0KICBzdGF0aWMgeGRjKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFhkYyhhdHRycyk7CiAgfQogIHN0YXRpYyB4ZHAoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgWGRwKGF0dHJzKTsKICB9CiAgc3RhdGljIHhzbChhdHRycykgewogICAgcmV0dXJuIG5ldyBYc2woYXR0cnMpOwogIH0KICBzdGF0aWMgenBsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFpwbChhdHRycyk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvY29ubmVjdGlvbl9zZXQuanMKCgpjb25zdCBDT05ORUNUSU9OX1NFVF9OU19JRCA9IE5hbWVzcGFjZUlkcy5jb25uZWN0aW9uU2V0LmlkOwpjbGFzcyBDb25uZWN0aW9uU2V0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgImNvbm5lY3Rpb25TZXQiLCB0cnVlKTsKICAgIHRoaXMud3NkbENvbm5lY3Rpb24gPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMueG1sQ29ubmVjdGlvbiA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy54c2RDb25uZWN0aW9uID0gbmV3IFhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIEVmZmVjdGl2ZUlucHV0UG9saWN5IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgImVmZmVjdGl2ZUlucHV0UG9saWN5Iik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIEVmZmVjdGl2ZU91dHB1dFBvbGljeSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJlZmZlY3RpdmVPdXRwdXRQb2xpY3kiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgT3BlcmF0aW9uIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgIm9wZXJhdGlvbiIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmlucHV0ID0gYXR0cmlidXRlcy5pbnB1dCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMub3V0cHV0ID0gYXR0cmlidXRlcy5vdXRwdXQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBSb290RWxlbWVudCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJyb290RWxlbWVudCIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBTb2FwQWN0aW9uIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgInNvYXBBY3Rpb24iKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgU29hcEFkZHJlc3MgZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTk5FQ1RJT05fU0VUX05TX0lELCAic29hcEFkZHJlc3MiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgY29ubmVjdGlvbl9zZXRfVXJpIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgInVyaSIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBXc2RsQWRkcmVzcyBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJ3c2RsQWRkcmVzcyIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBXc2RsQ29ubmVjdGlvbiBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJ3c2RsQ29ubmVjdGlvbiIsIHRydWUpOwogICAgdGhpcy5kYXRhRGVzY3JpcHRpb24gPSBhdHRyaWJ1dGVzLmRhdGFEZXNjcmlwdGlvbiB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMuZWZmZWN0aXZlSW5wdXRQb2xpY3kgPSBudWxsOwogICAgdGhpcy5lZmZlY3RpdmVPdXRwdXRQb2xpY3kgPSBudWxsOwogICAgdGhpcy5vcGVyYXRpb24gPSBudWxsOwogICAgdGhpcy5zb2FwQWN0aW9uID0gbnVsbDsKICAgIHRoaXMuc29hcEFkZHJlc3MgPSBudWxsOwogICAgdGhpcy53c2RsQWRkcmVzcyA9IG51bGw7CiAgfQp9CmNsYXNzIFhtbENvbm5lY3Rpb24gZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTk5FQ1RJT05fU0VUX05TX0lELCAieG1sQ29ubmVjdGlvbiIsIHRydWUpOwogICAgdGhpcy5kYXRhRGVzY3JpcHRpb24gPSBhdHRyaWJ1dGVzLmRhdGFEZXNjcmlwdGlvbiB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXJpID0gbnVsbDsKICB9Cn0KY2xhc3MgWHNkQ29ubmVjdGlvbiBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJ4c2RDb25uZWN0aW9uIiwgdHJ1ZSk7CiAgICB0aGlzLmRhdGFEZXNjcmlwdGlvbiA9IGF0dHJpYnV0ZXMuZGF0YURlc2NyaXB0aW9uIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5yb290RWxlbWVudCA9IG51bGw7CiAgICB0aGlzLnVyaSA9IG51bGw7CiAgfQp9CmNsYXNzIENvbm5lY3Rpb25TZXROYW1lc3BhY2UgewogIHN0YXRpYyBbJGJ1aWxkWEZBT2JqZWN0XShuYW1lLCBhdHRyaWJ1dGVzKSB7CiAgICBpZiAoQ29ubmVjdGlvblNldE5hbWVzcGFjZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICByZXR1cm4gQ29ubmVjdGlvblNldE5hbWVzcGFjZVtuYW1lXShhdHRyaWJ1dGVzKTsKICAgIH0KICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQogIHN0YXRpYyBjb25uZWN0aW9uU2V0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbm5lY3Rpb25TZXQoYXR0cnMpOwogIH0KICBzdGF0aWMgZWZmZWN0aXZlSW5wdXRQb2xpY3koYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRWZmZWN0aXZlSW5wdXRQb2xpY3koYXR0cnMpOwogIH0KICBzdGF0aWMgZWZmZWN0aXZlT3V0cHV0UG9saWN5KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVmZmVjdGl2ZU91dHB1dFBvbGljeShhdHRycyk7CiAgfQogIHN0YXRpYyBvcGVyYXRpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgT3BlcmF0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIHJvb3RFbGVtZW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFJvb3RFbGVtZW50KGF0dHJzKTsKICB9CiAgc3RhdGljIHNvYXBBY3Rpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU29hcEFjdGlvbihhdHRycyk7CiAgfQogIHN0YXRpYyBzb2FwQWRkcmVzcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBTb2FwQWRkcmVzcyhhdHRycyk7CiAgfQogIHN0YXRpYyB1cmkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgY29ubmVjdGlvbl9zZXRfVXJpKGF0dHJzKTsKICB9CiAgc3RhdGljIHdzZGxBZGRyZXNzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFdzZGxBZGRyZXNzKGF0dHJzKTsKICB9CiAgc3RhdGljIHdzZGxDb25uZWN0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFdzZGxDb25uZWN0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIHhtbENvbm5lY3Rpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgWG1sQ29ubmVjdGlvbihhdHRycyk7CiAgfQogIHN0YXRpYyB4c2RDb25uZWN0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFhzZENvbm5lY3Rpb24oYXR0cnMpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL2RhdGFzZXRzLmpzCgoKCmNvbnN0IERBVEFTRVRTX05TX0lEID0gTmFtZXNwYWNlSWRzLmRhdGFzZXRzLmlkOwpjbGFzcyBkYXRhc2V0c19EYXRhIGV4dGVuZHMgWG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihEQVRBU0VUU19OU19JRCwgImRhdGEiLCBhdHRyaWJ1dGVzKTsKICB9CiAgWyRpc05zQWdub3N0aWNdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQp9CmNsYXNzIERhdGFzZXRzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihEQVRBU0VUU19OU19JRCwgImRhdGFzZXRzIiwgdHJ1ZSk7CiAgICB0aGlzLmRhdGEgPSBudWxsOwogICAgdGhpcy5TaWduYXR1cmUgPSBudWxsOwogIH0KICBbJG9uQ2hpbGRdKGNoaWxkKSB7CiAgICBjb25zdCBuYW1lID0gY2hpbGRbJG5vZGVOYW1lXTsKICAgIGlmIChuYW1lID09PSAiZGF0YSIgJiYgY2hpbGRbJG5hbWVzcGFjZUlkXSA9PT0gREFUQVNFVFNfTlNfSUQgfHwgbmFtZSA9PT0gIlNpZ25hdHVyZSIgJiYgY2hpbGRbJG5hbWVzcGFjZUlkXSA9PT0gTmFtZXNwYWNlSWRzLnNpZ25hdHVyZS5pZCkgewogICAgICB0aGlzW25hbWVdID0gY2hpbGQ7CiAgICB9CiAgICB0aGlzWyRhcHBlbmRDaGlsZF0oY2hpbGQpOwogIH0KfQpjbGFzcyBEYXRhc2V0c05hbWVzcGFjZSB7CiAgc3RhdGljIFskYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChEYXRhc2V0c05hbWVzcGFjZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICByZXR1cm4gRGF0YXNldHNOYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBzdGF0aWMgZGF0YXNldHMoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBEYXRhc2V0cyhhdHRyaWJ1dGVzKTsKICB9CiAgc3RhdGljIGRhdGEoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBkYXRhc2V0c19EYXRhKGF0dHJpYnV0ZXMpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL2xvY2FsZV9zZXQuanMKCgoKY29uc3QgTE9DQUxFX1NFVF9OU19JRCA9IE5hbWVzcGFjZUlkcy5sb2NhbGVTZXQuaWQ7CmNsYXNzIENhbGVuZGFyU3ltYm9scyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImNhbGVuZGFyU3ltYm9scyIsIHRydWUpOwogICAgdGhpcy5uYW1lID0gImdyZWdvcmlhbiI7CiAgICB0aGlzLmRheU5hbWVzID0gbmV3IFhGQU9iamVjdEFycmF5KDIpOwogICAgdGhpcy5lcmFOYW1lcyA9IG51bGw7CiAgICB0aGlzLm1lcmlkaWVtTmFtZXMgPSBudWxsOwogICAgdGhpcy5tb250aE5hbWVzID0gbmV3IFhGQU9iamVjdEFycmF5KDIpOwogIH0KfQpjbGFzcyBDdXJyZW5jeVN5bWJvbCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImN1cnJlbmN5U3ltYm9sIik7CiAgICB0aGlzLm5hbWUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5uYW1lLCBbInN5bWJvbCIsICJpc29uYW1lIiwgImRlY2ltYWwiXSk7CiAgfQp9CmNsYXNzIEN1cnJlbmN5U3ltYm9scyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImN1cnJlbmN5U3ltYm9scyIsIHRydWUpOwogICAgdGhpcy5jdXJyZW5jeVN5bWJvbCA9IG5ldyBYRkFPYmplY3RBcnJheSgzKTsKICB9Cn0KY2xhc3MgRGF0ZVBhdHRlcm4gZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJkYXRlUGF0dGVybiIpOwogICAgdGhpcy5uYW1lID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubmFtZSwgWyJmdWxsIiwgImxvbmciLCAibWVkIiwgInNob3J0Il0pOwogIH0KfQpjbGFzcyBEYXRlUGF0dGVybnMgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJkYXRlUGF0dGVybnMiLCB0cnVlKTsKICAgIHRoaXMuZGF0ZVBhdHRlcm4gPSBuZXcgWEZBT2JqZWN0QXJyYXkoNCk7CiAgfQp9CmNsYXNzIERhdGVUaW1lU3ltYm9scyBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJkYXRlVGltZVN5bWJvbHMiKTsKICB9Cn0KY2xhc3MgRGF5IGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAiZGF5Iik7CiAgfQp9CmNsYXNzIERheU5hbWVzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAiZGF5TmFtZXMiLCB0cnVlKTsKICAgIHRoaXMuYWJiciA9IGdldEludGVnZXIoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmFiYnIsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmRheSA9IG5ldyBYRkFPYmplY3RBcnJheSg3KTsKICB9Cn0KY2xhc3MgRXJhIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAiZXJhIik7CiAgfQp9CmNsYXNzIEVyYU5hbWVzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAiZXJhTmFtZXMiLCB0cnVlKTsKICAgIHRoaXMuZXJhID0gbmV3IFhGQU9iamVjdEFycmF5KDIpOwogIH0KfQpjbGFzcyBsb2NhbGVfc2V0X0xvY2FsZSBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImxvY2FsZSIsIHRydWUpOwogICAgdGhpcy5kZXNjID0gYXR0cmlidXRlcy5kZXNjIHx8ICIiOwogICAgdGhpcy5uYW1lID0gImlzb25hbWUiOwogICAgdGhpcy5jYWxlbmRhclN5bWJvbHMgPSBudWxsOwogICAgdGhpcy5jdXJyZW5jeVN5bWJvbHMgPSBudWxsOwogICAgdGhpcy5kYXRlUGF0dGVybnMgPSBudWxsOwogICAgdGhpcy5kYXRlVGltZVN5bWJvbHMgPSBudWxsOwogICAgdGhpcy5udW1iZXJQYXR0ZXJucyA9IG51bGw7CiAgICB0aGlzLm51bWJlclN5bWJvbHMgPSBudWxsOwogICAgdGhpcy50aW1lUGF0dGVybnMgPSBudWxsOwogICAgdGhpcy50eXBlRmFjZXMgPSBudWxsOwogIH0KfQpjbGFzcyBsb2NhbGVfc2V0X0xvY2FsZVNldCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImxvY2FsZVNldCIsIHRydWUpOwogICAgdGhpcy5sb2NhbGUgPSBuZXcgWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgTWVyaWRpZW0gZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJtZXJpZGllbSIpOwogIH0KfQpjbGFzcyBNZXJpZGllbU5hbWVzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAibWVyaWRpZW1OYW1lcyIsIHRydWUpOwogICAgdGhpcy5tZXJpZGllbSA9IG5ldyBYRkFPYmplY3RBcnJheSgyKTsKICB9Cn0KY2xhc3MgTW9udGggZXh0ZW5kcyBTdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJtb250aCIpOwogIH0KfQpjbGFzcyBNb250aE5hbWVzIGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAibW9udGhOYW1lcyIsIHRydWUpOwogICAgdGhpcy5hYmJyID0gZ2V0SW50ZWdlcih7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuYWJiciwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMubW9udGggPSBuZXcgWEZBT2JqZWN0QXJyYXkoMTIpOwogIH0KfQpjbGFzcyBOdW1iZXJQYXR0ZXJuIGV4dGVuZHMgU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAibnVtYmVyUGF0dGVybiIpOwogICAgdGhpcy5uYW1lID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubmFtZSwgWyJmdWxsIiwgImxvbmciLCAibWVkIiwgInNob3J0Il0pOwogIH0KfQpjbGFzcyBOdW1iZXJQYXR0ZXJucyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgIm51bWJlclBhdHRlcm5zIiwgdHJ1ZSk7CiAgICB0aGlzLm51bWJlclBhdHRlcm4gPSBuZXcgWEZBT2JqZWN0QXJyYXkoNCk7CiAgfQp9CmNsYXNzIE51bWJlclN5bWJvbCBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgIm51bWJlclN5bWJvbCIpOwogICAgdGhpcy5uYW1lID0gZ2V0U3RyaW5nT3B0aW9uKGF0dHJpYnV0ZXMubmFtZSwgWyJkZWNpbWFsIiwgImdyb3VwaW5nIiwgInBlcmNlbnQiLCAibWludXMiLCAiemVybyJdKTsKICB9Cn0KY2xhc3MgTnVtYmVyU3ltYm9scyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgIm51bWJlclN5bWJvbHMiLCB0cnVlKTsKICAgIHRoaXMubnVtYmVyU3ltYm9sID0gbmV3IFhGQU9iamVjdEFycmF5KDUpOwogIH0KfQpjbGFzcyBUaW1lUGF0dGVybiBleHRlbmRzIFN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgInRpbWVQYXR0ZXJuIik7CiAgICB0aGlzLm5hbWUgPSBnZXRTdHJpbmdPcHRpb24oYXR0cmlidXRlcy5uYW1lLCBbImZ1bGwiLCAibG9uZyIsICJtZWQiLCAic2hvcnQiXSk7CiAgfQp9CmNsYXNzIFRpbWVQYXR0ZXJucyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgInRpbWVQYXR0ZXJucyIsIHRydWUpOwogICAgdGhpcy50aW1lUGF0dGVybiA9IG5ldyBYRkFPYmplY3RBcnJheSg0KTsKICB9Cn0KY2xhc3MgVHlwZUZhY2UgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJ0eXBlRmFjZSIsIHRydWUpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHwgIiI7CiAgfQp9CmNsYXNzIFR5cGVGYWNlcyBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgInR5cGVGYWNlcyIsIHRydWUpOwogICAgdGhpcy50eXBlRmFjZSA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBMb2NhbGVTZXROYW1lc3BhY2UgewogIHN0YXRpYyBbJGJ1aWxkWEZBT2JqZWN0XShuYW1lLCBhdHRyaWJ1dGVzKSB7CiAgICBpZiAoTG9jYWxlU2V0TmFtZXNwYWNlLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgIHJldHVybiBMb2NhbGVTZXROYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBzdGF0aWMgY2FsZW5kYXJTeW1ib2xzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENhbGVuZGFyU3ltYm9scyhhdHRycyk7CiAgfQogIHN0YXRpYyBjdXJyZW5jeVN5bWJvbChhdHRycykgewogICAgcmV0dXJuIG5ldyBDdXJyZW5jeVN5bWJvbChhdHRycyk7CiAgfQogIHN0YXRpYyBjdXJyZW5jeVN5bWJvbHMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ3VycmVuY3lTeW1ib2xzKGF0dHJzKTsKICB9CiAgc3RhdGljIGRhdGVQYXR0ZXJuKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERhdGVQYXR0ZXJuKGF0dHJzKTsKICB9CiAgc3RhdGljIGRhdGVQYXR0ZXJucyhhdHRycykgewogICAgcmV0dXJuIG5ldyBEYXRlUGF0dGVybnMoYXR0cnMpOwogIH0KICBzdGF0aWMgZGF0ZVRpbWVTeW1ib2xzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERhdGVUaW1lU3ltYm9scyhhdHRycyk7CiAgfQogIHN0YXRpYyBkYXkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGF5KGF0dHJzKTsKICB9CiAgc3RhdGljIGRheU5hbWVzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERheU5hbWVzKGF0dHJzKTsKICB9CiAgc3RhdGljIGVyYShhdHRycykgewogICAgcmV0dXJuIG5ldyBFcmEoYXR0cnMpOwogIH0KICBzdGF0aWMgZXJhTmFtZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRXJhTmFtZXMoYXR0cnMpOwogIH0KICBzdGF0aWMgbG9jYWxlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IGxvY2FsZV9zZXRfTG9jYWxlKGF0dHJzKTsKICB9CiAgc3RhdGljIGxvY2FsZVNldChhdHRycykgewogICAgcmV0dXJuIG5ldyBsb2NhbGVfc2V0X0xvY2FsZVNldChhdHRycyk7CiAgfQogIHN0YXRpYyBtZXJpZGllbShhdHRycykgewogICAgcmV0dXJuIG5ldyBNZXJpZGllbShhdHRycyk7CiAgfQogIHN0YXRpYyBtZXJpZGllbU5hbWVzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1lcmlkaWVtTmFtZXMoYXR0cnMpOwogIH0KICBzdGF0aWMgbW9udGgoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTW9udGgoYXR0cnMpOwogIH0KICBzdGF0aWMgbW9udGhOYW1lcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBNb250aE5hbWVzKGF0dHJzKTsKICB9CiAgc3RhdGljIG51bWJlclBhdHRlcm4oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTnVtYmVyUGF0dGVybihhdHRycyk7CiAgfQogIHN0YXRpYyBudW1iZXJQYXR0ZXJucyhhdHRycykgewogICAgcmV0dXJuIG5ldyBOdW1iZXJQYXR0ZXJucyhhdHRycyk7CiAgfQogIHN0YXRpYyBudW1iZXJTeW1ib2woYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTnVtYmVyU3ltYm9sKGF0dHJzKTsKICB9CiAgc3RhdGljIG51bWJlclN5bWJvbHMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTnVtYmVyU3ltYm9scyhhdHRycyk7CiAgfQogIHN0YXRpYyB0aW1lUGF0dGVybihhdHRycykgewogICAgcmV0dXJuIG5ldyBUaW1lUGF0dGVybihhdHRycyk7CiAgfQogIHN0YXRpYyB0aW1lUGF0dGVybnMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVGltZVBhdHRlcm5zKGF0dHJzKTsKICB9CiAgc3RhdGljIHR5cGVGYWNlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFR5cGVGYWNlKGF0dHJzKTsKICB9CiAgc3RhdGljIHR5cGVGYWNlcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBUeXBlRmFjZXMoYXR0cnMpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL3NpZ25hdHVyZS5qcwoKCmNvbnN0IFNJR05BVFVSRV9OU19JRCA9IE5hbWVzcGFjZUlkcy5zaWduYXR1cmUuaWQ7CmNsYXNzIHNpZ25hdHVyZV9TaWduYXR1cmUgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFNJR05BVFVSRV9OU19JRCwgInNpZ25hdHVyZSIsIHRydWUpOwogIH0KfQpjbGFzcyBTaWduYXR1cmVOYW1lc3BhY2UgewogIHN0YXRpYyBbJGJ1aWxkWEZBT2JqZWN0XShuYW1lLCBhdHRyaWJ1dGVzKSB7CiAgICBpZiAoU2lnbmF0dXJlTmFtZXNwYWNlLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgIHJldHVybiBTaWduYXR1cmVOYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBzdGF0aWMgc2lnbmF0dXJlKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgc2lnbmF0dXJlX1NpZ25hdHVyZShhdHRyaWJ1dGVzKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3hmYS9zdHlsZXNoZWV0LmpzCgoKY29uc3QgU1RZTEVTSEVFVF9OU19JRCA9IE5hbWVzcGFjZUlkcy5zdHlsZXNoZWV0LmlkOwpjbGFzcyBTdHlsZXNoZWV0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihTVFlMRVNIRUVUX05TX0lELCAic3R5bGVzaGVldCIsIHRydWUpOwogIH0KfQpjbGFzcyBTdHlsZXNoZWV0TmFtZXNwYWNlIHsKICBzdGF0aWMgWyRidWlsZFhGQU9iamVjdF0obmFtZSwgYXR0cmlidXRlcykgewogICAgaWYgKFN0eWxlc2hlZXROYW1lc3BhY2UuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgcmV0dXJuIFN0eWxlc2hlZXROYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBzdGF0aWMgc3R5bGVzaGVldChhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IFN0eWxlc2hlZXQoYXR0cmlidXRlcyk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEveGRwLmpzCgoKCmNvbnN0IFhEUF9OU19JRCA9IE5hbWVzcGFjZUlkcy54ZHAuaWQ7CmNsYXNzIHhkcF9YZHAgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFhEUF9OU19JRCwgInhkcCIsIHRydWUpOwogICAgdGhpcy51dWlkID0gYXR0cmlidXRlcy51dWlkIHx8ICIiOwogICAgdGhpcy50aW1lU3RhbXAgPSBhdHRyaWJ1dGVzLnRpbWVTdGFtcCB8fCAiIjsKICAgIHRoaXMuY29uZmlnID0gbnVsbDsKICAgIHRoaXMuY29ubmVjdGlvblNldCA9IG51bGw7CiAgICB0aGlzLmRhdGFzZXRzID0gbnVsbDsKICAgIHRoaXMubG9jYWxlU2V0ID0gbnVsbDsKICAgIHRoaXMuc3R5bGVzaGVldCA9IG5ldyBYRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50ZW1wbGF0ZSA9IG51bGw7CiAgfQogIFskb25DaGlsZENoZWNrXShjaGlsZCkgewogICAgY29uc3QgbnMgPSBOYW1lc3BhY2VJZHNbY2hpbGRbJG5vZGVOYW1lXV07CiAgICByZXR1cm4gbnMgJiYgY2hpbGRbJG5hbWVzcGFjZUlkXSA9PT0gbnMuaWQ7CiAgfQp9CmNsYXNzIFhkcE5hbWVzcGFjZSB7CiAgc3RhdGljIFskYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChYZHBOYW1lc3BhY2UuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgcmV0dXJuIFhkcE5hbWVzcGFjZVtuYW1lXShhdHRyaWJ1dGVzKTsKICAgIH0KICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQogIHN0YXRpYyB4ZHAoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyB4ZHBfWGRwKGF0dHJpYnV0ZXMpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL3hodG1sLmpzCgoKCgoKY29uc3QgWEhUTUxfTlNfSUQgPSBOYW1lc3BhY2VJZHMueGh0bWwuaWQ7CmNvbnN0ICRyaWNoVGV4dCA9IFN5bWJvbCgpOwpjb25zdCBWQUxJRF9TVFlMRVMgPSBuZXcgU2V0KFsiY29sb3IiLCAiZm9udCIsICJmb250LWZhbWlseSIsICJmb250LXNpemUiLCAiZm9udC1zdHJldGNoIiwgImZvbnQtc3R5bGUiLCAiZm9udC13ZWlnaHQiLCAibWFyZ2luIiwgIm1hcmdpbi1ib3R0b20iLCAibWFyZ2luLWxlZnQiLCAibWFyZ2luLXJpZ2h0IiwgIm1hcmdpbi10b3AiLCAibGV0dGVyLXNwYWNpbmciLCAibGluZS1oZWlnaHQiLCAib3JwaGFucyIsICJwYWdlLWJyZWFrLWFmdGVyIiwgInBhZ2UtYnJlYWstYmVmb3JlIiwgInBhZ2UtYnJlYWstaW5zaWRlIiwgInRhYi1pbnRlcnZhbCIsICJ0YWItc3RvcCIsICJ0ZXh0LWFsaWduIiwgInRleHQtZGVjb3JhdGlvbiIsICJ0ZXh0LWluZGVudCIsICJ2ZXJ0aWNhbC1hbGlnbiIsICJ3aWRvd3MiLCAia2VybmluZy1tb2RlIiwgInhmYS1mb250LWhvcml6b250YWwtc2NhbGUiLCAieGZhLWZvbnQtdmVydGljYWwtc2NhbGUiLCAieGZhLXNwYWNlcnVuIiwgInhmYS10YWItc3RvcHMiXSk7CmNvbnN0IFN0eWxlTWFwcGluZyA9IG5ldyBNYXAoW1sicGFnZS1icmVhay1hZnRlciIsICJicmVha0FmdGVyIl0sIFsicGFnZS1icmVhay1iZWZvcmUiLCAiYnJlYWtCZWZvcmUiXSwgWyJwYWdlLWJyZWFrLWluc2lkZSIsICJicmVha0luc2lkZSJdLCBbImtlcm5pbmctbW9kZSIsIHZhbHVlID0+IHZhbHVlID09PSAibm9uZSIgPyAibm9uZSIgOiAibm9ybWFsIl0sIFsieGZhLWZvbnQtaG9yaXpvbnRhbC1zY2FsZSIsIHZhbHVlID0+IGBzY2FsZVgoJHtNYXRoLm1heCgwLCBwYXJzZUludCh2YWx1ZSkgLyAxMDApLnRvRml4ZWQoMil9KWBdLCBbInhmYS1mb250LXZlcnRpY2FsLXNjYWxlIiwgdmFsdWUgPT4gYHNjYWxlWSgke01hdGgubWF4KDAsIHBhcnNlSW50KHZhbHVlKSAvIDEwMCkudG9GaXhlZCgyKX0pYF0sIFsieGZhLXNwYWNlcnVuIiwgIiJdLCBbInhmYS10YWItc3RvcHMiLCAiIl0sIFsiZm9udC1zaXplIiwgKHZhbHVlLCBvcmlnaW5hbCkgPT4gewogIHZhbHVlID0gb3JpZ2luYWwuZm9udFNpemUgPSBNYXRoLmFicyhnZXRNZWFzdXJlbWVudCh2YWx1ZSkpOwogIHJldHVybiBtZWFzdXJlVG9TdHJpbmcoMC45OSAqIHZhbHVlKTsKfV0sIFsibGV0dGVyLXNwYWNpbmciLCB2YWx1ZSA9PiBtZWFzdXJlVG9TdHJpbmcoZ2V0TWVhc3VyZW1lbnQodmFsdWUpKV0sIFsibGluZS1oZWlnaHQiLCB2YWx1ZSA9PiBtZWFzdXJlVG9TdHJpbmcoZ2V0TWVhc3VyZW1lbnQodmFsdWUpKV0sIFsibWFyZ2luIiwgdmFsdWUgPT4gbWVhc3VyZVRvU3RyaW5nKGdldE1lYXN1cmVtZW50KHZhbHVlKSldLCBbIm1hcmdpbi1ib3R0b20iLCB2YWx1ZSA9PiBtZWFzdXJlVG9TdHJpbmcoZ2V0TWVhc3VyZW1lbnQodmFsdWUpKV0sIFsibWFyZ2luLWxlZnQiLCB2YWx1ZSA9PiBtZWFzdXJlVG9TdHJpbmcoZ2V0TWVhc3VyZW1lbnQodmFsdWUpKV0sIFsibWFyZ2luLXJpZ2h0IiwgdmFsdWUgPT4gbWVhc3VyZVRvU3RyaW5nKGdldE1lYXN1cmVtZW50KHZhbHVlKSldLCBbIm1hcmdpbi10b3AiLCB2YWx1ZSA9PiBtZWFzdXJlVG9TdHJpbmcoZ2V0TWVhc3VyZW1lbnQodmFsdWUpKV0sIFsidGV4dC1pbmRlbnQiLCB2YWx1ZSA9PiBtZWFzdXJlVG9TdHJpbmcoZ2V0TWVhc3VyZW1lbnQodmFsdWUpKV0sIFsiZm9udC1mYW1pbHkiLCB2YWx1ZSA9PiB2YWx1ZV0sIFsidmVydGljYWwtYWxpZ24iLCB2YWx1ZSA9PiBtZWFzdXJlVG9TdHJpbmcoZ2V0TWVhc3VyZW1lbnQodmFsdWUpKV1dKTsKY29uc3Qgc3BhY2VzUmVnRXhwID0gL1xzKy9nOwpjb25zdCBjcmxmUmVnRXhwID0gL1tcclxuXSsvZzsKY29uc3QgY3JsZkZvclJpY2hUZXh0UmVnRXhwID0gL1xyXG4/L2c7CmZ1bmN0aW9uIG1hcFN0eWxlKHN0eWxlU3RyLCBub2RlLCByaWNoVGV4dCkgewogIGNvbnN0IHN0eWxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBpZiAoIXN0eWxlU3RyKSB7CiAgICByZXR1cm4gc3R5bGU7CiAgfQogIGNvbnN0IG9yaWdpbmFsID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBzdHlsZVN0ci5zcGxpdCgiOyIpLm1hcChzID0+IHMuc3BsaXQoIjoiLCAyKSkpIHsKICAgIGNvbnN0IG1hcHBpbmcgPSBTdHlsZU1hcHBpbmcuZ2V0KGtleSk7CiAgICBpZiAobWFwcGluZyA9PT0gIiIpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBsZXQgbmV3VmFsdWUgPSB2YWx1ZTsKICAgIGlmIChtYXBwaW5nKSB7CiAgICAgIG5ld1ZhbHVlID0gdHlwZW9mIG1hcHBpbmcgPT09ICJzdHJpbmciID8gbWFwcGluZyA6IG1hcHBpbmcodmFsdWUsIG9yaWdpbmFsKTsKICAgIH0KICAgIGlmIChrZXkuZW5kc1dpdGgoInNjYWxlIikpIHsKICAgICAgc3R5bGUudHJhbnNmb3JtID0gc3R5bGUudHJhbnNmb3JtID8gYCR7c3R5bGVba2V5XX0gJHtuZXdWYWx1ZX1gIDogbmV3VmFsdWU7CiAgICB9IGVsc2UgewogICAgICBzdHlsZVtrZXkucmVwbGFjZUFsbCgvLShbYS16QS1aXSkvZywgKF8sIHgpID0+IHgudG9VcHBlckNhc2UoKSldID0gbmV3VmFsdWU7CiAgICB9CiAgfQogIGlmIChzdHlsZS5mb250RmFtaWx5KSB7CiAgICBzZXRGb250RmFtaWx5KHsKICAgICAgdHlwZWZhY2U6IHN0eWxlLmZvbnRGYW1pbHksCiAgICAgIHdlaWdodDogc3R5bGUuZm9udFdlaWdodCB8fCAibm9ybWFsIiwKICAgICAgcG9zdHVyZTogc3R5bGUuZm9udFN0eWxlIHx8ICJub3JtYWwiLAogICAgICBzaXplOiBvcmlnaW5hbC5mb250U2l6ZSB8fCAwCiAgICB9LCBub2RlLCBub2RlWyRnbG9iYWxEYXRhXS5mb250RmluZGVyLCBzdHlsZSk7CiAgfQogIGlmIChyaWNoVGV4dCAmJiBzdHlsZS52ZXJ0aWNhbEFsaWduICYmIHN0eWxlLnZlcnRpY2FsQWxpZ24gIT09ICIwcHgiICYmIHN0eWxlLmZvbnRTaXplKSB7CiAgICBjb25zdCBTVUJfU1VQRVJfU0NSSVBUX0ZBQ1RPUiA9IDAuNTgzOwogICAgY29uc3QgVkVSVElDQUxfRkFDVE9SID0gMC4zMzM7CiAgICBjb25zdCBmb250U2l6ZSA9IGdldE1lYXN1cmVtZW50KHN0eWxlLmZvbnRTaXplKTsKICAgIHN0eWxlLmZvbnRTaXplID0gbWVhc3VyZVRvU3RyaW5nKGZvbnRTaXplICogU1VCX1NVUEVSX1NDUklQVF9GQUNUT1IpOwogICAgc3R5bGUudmVydGljYWxBbGlnbiA9IG1lYXN1cmVUb1N0cmluZyhNYXRoLnNpZ24oZ2V0TWVhc3VyZW1lbnQoc3R5bGUudmVydGljYWxBbGlnbikpICogZm9udFNpemUgKiBWRVJUSUNBTF9GQUNUT1IpOwogIH0KICBpZiAocmljaFRleHQgJiYgc3R5bGUuZm9udFNpemUpIHsKICAgIHN0eWxlLmZvbnRTaXplID0gYGNhbGMoJHtzdHlsZS5mb250U2l6ZX0gKiB2YXIoLS10b3RhbC1zY2FsZS1mYWN0b3IpKWA7CiAgfQogIGZpeFRleHRJbmRlbnQoc3R5bGUpOwogIHJldHVybiBzdHlsZTsKfQpmdW5jdGlvbiBjaGVja1N0eWxlKG5vZGUpIHsKICBpZiAoIW5vZGUuc3R5bGUpIHsKICAgIHJldHVybiAiIjsKICB9CiAgcmV0dXJuIG5vZGUuc3R5bGUuc3BsaXQoIjsiKS5maWx0ZXIocyA9PiAhIXMudHJpbSgpKS5tYXAocyA9PiBzLnNwbGl0KCI6IiwgMikubWFwKHQgPT4gdC50cmltKCkpKS5maWx0ZXIoKFtrZXksIHZhbHVlXSkgPT4gewogICAgaWYgKGtleSA9PT0gImZvbnQtZmFtaWx5IikgewogICAgICBub2RlWyRnbG9iYWxEYXRhXS51c2VkVHlwZWZhY2VzLmFkZCh2YWx1ZSk7CiAgICB9CiAgICByZXR1cm4gVkFMSURfU1RZTEVTLmhhcyhrZXkpOwogIH0pLm1hcChrdiA9PiBrdi5qb2luKCI6IikpLmpvaW4oIjsiKTsKfQpjb25zdCBOb1doaXRlcyA9IG5ldyBTZXQoWyJib2R5IiwgImh0bWwiXSk7CmNsYXNzIFhodG1sT2JqZWN0IGV4dGVuZHMgWG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzLCBuYW1lKSB7CiAgICBzdXBlcihYSFRNTF9OU19JRCwgbmFtZSk7CiAgICB0aGlzWyRyaWNoVGV4dF0gPSBmYWxzZTsKICAgIHRoaXMuc3R5bGUgPSBhdHRyaWJ1dGVzLnN0eWxlIHx8ICIiOwogIH0KICBbJGNsZWFuXShidWlsZGVyKSB7CiAgICBzdXBlclskY2xlYW5dKGJ1aWxkZXIpOwogICAgdGhpcy5zdHlsZSA9IGNoZWNrU3R5bGUodGhpcyk7CiAgfQogIFskYWNjZXB0V2hpdGVzcGFjZV0oKSB7CiAgICByZXR1cm4gIU5vV2hpdGVzLmhhcyh0aGlzWyRub2RlTmFtZV0pOwogIH0KICBbJG9uVGV4dF0oc3RyLCByaWNoVGV4dCA9IGZhbHNlKSB7CiAgICBpZiAoIXJpY2hUZXh0KSB7CiAgICAgIHN0ciA9IHN0ci5yZXBsYWNlQWxsKGNybGZSZWdFeHAsICIiKTsKICAgICAgaWYgKCF0aGlzLnN0eWxlLmluY2x1ZGVzKCJ4ZmEtc3BhY2VydW46eWVzIikpIHsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZUFsbChzcGFjZXNSZWdFeHAsICIgIik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXNbJHJpY2hUZXh0XSA9IHRydWU7CiAgICB9CiAgICBpZiAoc3RyKSB7CiAgICAgIHRoaXNbJGNvbnRlbnRdICs9IHN0cjsKICAgIH0KICB9CiAgWyRwdXNoR2x5cGhzXShtZWFzdXJlLCBtdXN0UG9wID0gdHJ1ZSkgewogICAgY29uc3QgeGZhRm9udCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBjb25zdCBtYXJnaW4gPSB7CiAgICAgIHRvcDogTmFOLAogICAgICBib3R0b206IE5hTiwKICAgICAgbGVmdDogTmFOLAogICAgICByaWdodDogTmFOCiAgICB9OwogICAgbGV0IGxpbmVIZWlnaHQgPSBudWxsOwogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5zdHlsZS5zcGxpdCgiOyIpLm1hcChzID0+IHMuc3BsaXQoIjoiLCAyKSkpIHsKICAgICAgc3dpdGNoIChrZXkpIHsKICAgICAgICBjYXNlICJmb250LWZhbWlseSI6CiAgICAgICAgICB4ZmFGb250LnR5cGVmYWNlID0gc3RyaXBRdW90ZXModmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZm9udC1zaXplIjoKICAgICAgICAgIHhmYUZvbnQuc2l6ZSA9IGdldE1lYXN1cmVtZW50KHZhbHVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImZvbnQtd2VpZ2h0IjoKICAgICAgICAgIHhmYUZvbnQud2VpZ2h0ID0gdmFsdWU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJmb250LXN0eWxlIjoKICAgICAgICAgIHhmYUZvbnQucG9zdHVyZSA9IHZhbHVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibGV0dGVyLXNwYWNpbmciOgogICAgICAgICAgeGZhRm9udC5sZXR0ZXJTcGFjaW5nID0gZ2V0TWVhc3VyZW1lbnQodmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibWFyZ2luIjoKICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IHZhbHVlLnNwbGl0KC8gXHQvKS5tYXAoeCA9PiBnZXRNZWFzdXJlbWVudCh4KSk7CiAgICAgICAgICBzd2l0Y2ggKHZhbHVlcy5sZW5ndGgpIHsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIG1hcmdpbi50b3AgPSBtYXJnaW4uYm90dG9tID0gbWFyZ2luLmxlZnQgPSBtYXJnaW4ucmlnaHQgPSB2YWx1ZXNbMF07CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBtYXJnaW4udG9wID0gbWFyZ2luLmJvdHRvbSA9IHZhbHVlc1swXTsKICAgICAgICAgICAgICBtYXJnaW4ubGVmdCA9IG1hcmdpbi5yaWdodCA9IHZhbHVlc1sxXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIG1hcmdpbi50b3AgPSB2YWx1ZXNbMF07CiAgICAgICAgICAgICAgbWFyZ2luLmJvdHRvbSA9IHZhbHVlc1syXTsKICAgICAgICAgICAgICBtYXJnaW4ubGVmdCA9IG1hcmdpbi5yaWdodCA9IHZhbHVlc1sxXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIG1hcmdpbi50b3AgPSB2YWx1ZXNbMF07CiAgICAgICAgICAgICAgbWFyZ2luLmxlZnQgPSB2YWx1ZXNbMV07CiAgICAgICAgICAgICAgbWFyZ2luLmJvdHRvbSA9IHZhbHVlc1syXTsKICAgICAgICAgICAgICBtYXJnaW4ucmlnaHQgPSB2YWx1ZXNbM107CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtYXJnaW4tdG9wIjoKICAgICAgICAgIG1hcmdpbi50b3AgPSBnZXRNZWFzdXJlbWVudCh2YWx1ZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtYXJnaW4tYm90dG9tIjoKICAgICAgICAgIG1hcmdpbi5ib3R0b20gPSBnZXRNZWFzdXJlbWVudCh2YWx1ZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtYXJnaW4tbGVmdCI6CiAgICAgICAgICBtYXJnaW4ubGVmdCA9IGdldE1lYXN1cmVtZW50KHZhbHVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIm1hcmdpbi1yaWdodCI6CiAgICAgICAgICBtYXJnaW4ucmlnaHQgPSBnZXRNZWFzdXJlbWVudCh2YWx1ZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJsaW5lLWhlaWdodCI6CiAgICAgICAgICBsaW5lSGVpZ2h0ID0gZ2V0TWVhc3VyZW1lbnQodmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIG1lYXN1cmUucHVzaERhdGEoeGZhRm9udCwgbWFyZ2luLCBsaW5lSGVpZ2h0KTsKICAgIGlmICh0aGlzWyRjb250ZW50XSkgewogICAgICBtZWFzdXJlLmFkZFN0cmluZyh0aGlzWyRjb250ZW50XSk7CiAgICB9IGVsc2UgewogICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXNbJGdldENoaWxkcmVuXSgpKSB7CiAgICAgICAgaWYgKGNoaWxkWyRub2RlTmFtZV0gPT09ICIjdGV4dCIpIHsKICAgICAgICAgIG1lYXN1cmUuYWRkU3RyaW5nKGNoaWxkWyRjb250ZW50XSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY2hpbGRbJHB1c2hHbHlwaHNdKG1lYXN1cmUpOwogICAgICB9CiAgICB9CiAgICBpZiAobXVzdFBvcCkgewogICAgICBtZWFzdXJlLnBvcEZvbnQoKTsKICAgIH0KICB9CiAgWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOwogICAgdGhpc1skZXh0cmFdID0gewogICAgICBjaGlsZHJlbgogICAgfTsKICAgIHRoaXNbJGNoaWxkcmVuVG9IVE1MXSh7fSk7CiAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID09PSAwICYmICF0aGlzWyRjb250ZW50XSkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGxldCB2YWx1ZTsKICAgIGlmICh0aGlzWyRyaWNoVGV4dF0pIHsKICAgICAgdmFsdWUgPSB0aGlzWyRjb250ZW50XSA/IHRoaXNbJGNvbnRlbnRdLnJlcGxhY2VBbGwoY3JsZkZvclJpY2hUZXh0UmVnRXhwLCAiXG4iKSA6IHVuZGVmaW5lZDsKICAgIH0gZWxzZSB7CiAgICAgIHZhbHVlID0gdGhpc1skY29udGVudF0gfHwgdW5kZWZpbmVkOwogICAgfQogICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgIG5hbWU6IHRoaXNbJG5vZGVOYW1lXSwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGhyZWY6IHRoaXMuaHJlZiwKICAgICAgICBzdHlsZTogbWFwU3R5bGUodGhpcy5zdHlsZSwgdGhpcywgdGhpc1skcmljaFRleHRdKQogICAgICB9LAogICAgICBjaGlsZHJlbiwKICAgICAgdmFsdWUKICAgIH0pOwogIH0KfQpjbGFzcyBBIGV4dGVuZHMgWGh0bWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKGF0dHJpYnV0ZXMsICJhIik7CiAgICB0aGlzLmhyZWYgPSBmaXhVUkwoYXR0cmlidXRlcy5ocmVmKSB8fCAiIjsKICB9Cn0KY2xhc3MgQiBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAiYiIpOwogIH0KICBbJHB1c2hHbHlwaHNdKG1lYXN1cmUpIHsKICAgIG1lYXN1cmUucHVzaEZvbnQoewogICAgICB3ZWlnaHQ6ICJib2xkIgogICAgfSk7CiAgICBzdXBlclskcHVzaEdseXBoc10obWVhc3VyZSk7CiAgICBtZWFzdXJlLnBvcEZvbnQoKTsKICB9Cn0KY2xhc3MgQm9keSBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAiYm9keSIpOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IHJlcyA9IHN1cGVyWyR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKTsKICAgIGNvbnN0IHsKICAgICAgaHRtbAogICAgfSA9IHJlczsKICAgIGlmICghaHRtbCkgewogICAgICByZXR1cm4gSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGh0bWwubmFtZSA9ICJkaXYiOwogICAgaHRtbC5hdHRyaWJ1dGVzLmNsYXNzID0gWyJ4ZmFSaWNoIl07CiAgICByZXR1cm4gcmVzOwogIH0KfQpjbGFzcyBCciBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAiYnIiKTsKICB9CiAgWyR0ZXh0XSgpIHsKICAgIHJldHVybiAiXG4iOwogIH0KICBbJHB1c2hHbHlwaHNdKG1lYXN1cmUpIHsKICAgIG1lYXN1cmUuYWRkU3RyaW5nKCJcbiIpOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAiYnIiCiAgICB9KTsKICB9Cn0KY2xhc3MgSHRtbCBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAiaHRtbCIpOwogIH0KICBbJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IGNoaWxkcmVuID0gW107CiAgICB0aGlzWyRleHRyYV0gPSB7CiAgICAgIGNoaWxkcmVuCiAgICB9OwogICAgdGhpc1skY2hpbGRyZW5Ub0hUTUxdKHt9KTsKICAgIGlmIChjaGlsZHJlbi5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgICAgbmFtZTogImRpdiIsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgY2xhc3M6IFsieGZhUmljaCJdLAogICAgICAgICAgc3R5bGU6IHt9CiAgICAgICAgfSwKICAgICAgICB2YWx1ZTogdGhpc1skY29udGVudF0gfHwgIiIKICAgICAgfSk7CiAgICB9CiAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID09PSAxKSB7CiAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5bMF07CiAgICAgIGlmIChjaGlsZC5hdHRyaWJ1dGVzPy5jbGFzcy5pbmNsdWRlcygieGZhUmljaCIpKSB7CiAgICAgICAgcmV0dXJuIEhUTUxSZXN1bHQuc3VjY2VzcyhjaGlsZCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBIVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbInhmYVJpY2giXSwKICAgICAgICBzdHlsZToge30KICAgICAgfSwKICAgICAgY2hpbGRyZW4KICAgIH0pOwogIH0KfQpjbGFzcyBJIGV4dGVuZHMgWGh0bWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKGF0dHJpYnV0ZXMsICJpIik7CiAgfQogIFskcHVzaEdseXBoc10obWVhc3VyZSkgewogICAgbWVhc3VyZS5wdXNoRm9udCh7CiAgICAgIHBvc3R1cmU6ICJpdGFsaWMiCiAgICB9KTsKICAgIHN1cGVyWyRwdXNoR2x5cGhzXShtZWFzdXJlKTsKICAgIG1lYXN1cmUucG9wRm9udCgpOwogIH0KfQpjbGFzcyBMaSBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAibGkiKTsKICB9Cn0KY2xhc3MgT2wgZXh0ZW5kcyBYaHRtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoYXR0cmlidXRlcywgIm9sIik7CiAgfQp9CmNsYXNzIFAgZXh0ZW5kcyBYaHRtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoYXR0cmlidXRlcywgInAiKTsKICB9CiAgWyRwdXNoR2x5cGhzXShtZWFzdXJlKSB7CiAgICBzdXBlclskcHVzaEdseXBoc10obWVhc3VyZSwgZmFsc2UpOwogICAgbWVhc3VyZS5hZGRTdHJpbmcoIlxuIik7CiAgICBtZWFzdXJlLmFkZFBhcmEoKTsKICAgIG1lYXN1cmUucG9wRm9udCgpOwogIH0KICBbJHRleHRdKCkgewogICAgY29uc3Qgc2libGluZ3MgPSB0aGlzWyRnZXRQYXJlbnRdKClbJGdldENoaWxkcmVuXSgpOwogICAgaWYgKHNpYmxpbmdzLmF0KC0xKSA9PT0gdGhpcykgewogICAgICByZXR1cm4gc3VwZXJbJHRleHRdKCk7CiAgICB9CiAgICByZXR1cm4gc3VwZXJbJHRleHRdKCkgKyAiXG4iOwogIH0KfQpjbGFzcyBTcGFuIGV4dGVuZHMgWGh0bWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKGF0dHJpYnV0ZXMsICJzcGFuIik7CiAgfQp9CmNsYXNzIFN1YiBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAic3ViIik7CiAgfQp9CmNsYXNzIFN1cCBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAic3VwIik7CiAgfQp9CmNsYXNzIFVsIGV4dGVuZHMgWGh0bWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKGF0dHJpYnV0ZXMsICJ1bCIpOwogIH0KfQpjbGFzcyBYaHRtbE5hbWVzcGFjZSB7CiAgc3RhdGljIFskYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChYaHRtbE5hbWVzcGFjZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICByZXR1cm4gWGh0bWxOYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBzdGF0aWMgYShhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IEEoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBiKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgQihhdHRyaWJ1dGVzKTsKICB9CiAgc3RhdGljIGJvZHkoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBCb2R5KGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgYnIoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBCcihhdHRyaWJ1dGVzKTsKICB9CiAgc3RhdGljIGh0bWwoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBIdG1sKGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgaShhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IEkoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBsaShhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IExpKGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgb2woYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBPbChhdHRyaWJ1dGVzKTsKICB9CiAgc3RhdGljIHAoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBQKGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgc3BhbihhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IFNwYW4oYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBzdWIoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBTdWIoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBzdXAoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBTdXAoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyB1bChhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IFVsKGF0dHJpYnV0ZXMpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveGZhL3NldHVwLmpzCgoKCgoKCgoKCmNvbnN0IE5hbWVzcGFjZVNldFVwID0gewogIGNvbmZpZzogQ29uZmlnTmFtZXNwYWNlLAogIGNvbm5lY3Rpb246IENvbm5lY3Rpb25TZXROYW1lc3BhY2UsCiAgZGF0YXNldHM6IERhdGFzZXRzTmFtZXNwYWNlLAogIGxvY2FsZVNldDogTG9jYWxlU2V0TmFtZXNwYWNlLAogIHNpZ25hdHVyZTogU2lnbmF0dXJlTmFtZXNwYWNlLAogIHN0eWxlc2hlZXQ6IFN0eWxlc2hlZXROYW1lc3BhY2UsCiAgdGVtcGxhdGU6IFRlbXBsYXRlTmFtZXNwYWNlLAogIHhkcDogWGRwTmFtZXNwYWNlLAogIHhodG1sOiBYaHRtbE5hbWVzcGFjZQp9OwoKOy8vIC4vc3JjL2NvcmUveGZhL3Vua25vd24uanMKCgpjbGFzcyBVbmtub3duTmFtZXNwYWNlIHsKICBjb25zdHJ1Y3Rvcihuc0lkKSB7CiAgICB0aGlzLm5hbWVzcGFjZUlkID0gbnNJZDsKICB9CiAgWyRidWlsZFhGQU9iamVjdF0obmFtZSwgYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBYbWxPYmplY3QodGhpcy5uYW1lc3BhY2VJZCwgbmFtZSwgYXR0cmlidXRlcyk7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvYnVpbGRlci5qcwoKCgoKCgoKY2xhc3MgUm9vdCBleHRlbmRzIFhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoaWRzKSB7CiAgICBzdXBlcigtMSwgInJvb3QiLCBPYmplY3QuY3JlYXRlKG51bGwpKTsKICAgIHRoaXMuZWxlbWVudCA9IG51bGw7CiAgICB0aGlzWyRpZHNdID0gaWRzOwogIH0KICBbJG9uQ2hpbGRdKGNoaWxkKSB7CiAgICB0aGlzLmVsZW1lbnQgPSBjaGlsZDsKICAgIHJldHVybiB0cnVlOwogIH0KICBbJGZpbmFsaXplXSgpIHsKICAgIHN1cGVyWyRmaW5hbGl6ZV0oKTsKICAgIGlmICh0aGlzLmVsZW1lbnQudGVtcGxhdGUgaW5zdGFuY2VvZiBUZW1wbGF0ZSkgewogICAgICB0aGlzWyRpZHNdLnNldCgkcm9vdCwgdGhpcy5lbGVtZW50KTsKICAgICAgdGhpcy5lbGVtZW50LnRlbXBsYXRlWyRyZXNvbHZlUHJvdG90eXBlc10odGhpc1skaWRzXSk7CiAgICAgIHRoaXMuZWxlbWVudC50ZW1wbGF0ZVskaWRzXSA9IHRoaXNbJGlkc107CiAgICB9CiAgfQp9CmNsYXNzIEVtcHR5IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKC0xLCAiIiwgT2JqZWN0LmNyZWF0ZShudWxsKSk7CiAgfQogIFskb25DaGlsZF0oXykgewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQpjbGFzcyBCdWlsZGVyIHsKICBjb25zdHJ1Y3Rvcihyb290TmFtZVNwYWNlID0gbnVsbCkgewogICAgdGhpcy5fbmFtZXNwYWNlU3RhY2sgPSBbXTsKICAgIHRoaXMuX25zQWdub3N0aWNMZXZlbCA9IDA7CiAgICB0aGlzLl9uYW1lc3BhY2VQcmVmaXhlcyA9IG5ldyBNYXAoKTsKICAgIHRoaXMuX25hbWVzcGFjZXMgPSBuZXcgTWFwKCk7CiAgICB0aGlzLl9uZXh0TnNJZCA9IE1hdGgubWF4KC4uLk9iamVjdC52YWx1ZXMoTmFtZXNwYWNlSWRzKS5tYXAoKHsKICAgICAgaWQKICAgIH0pID0+IGlkKSk7CiAgICB0aGlzLl9jdXJyZW50TmFtZXNwYWNlID0gcm9vdE5hbWVTcGFjZSB8fCBuZXcgVW5rbm93bk5hbWVzcGFjZSgrK3RoaXMuX25leHROc0lkKTsKICB9CiAgYnVpbGRSb290KGlkcykgewogICAgcmV0dXJuIG5ldyBSb290KGlkcyk7CiAgfQogIGJ1aWxkKHsKICAgIG5zUHJlZml4LAogICAgbmFtZSwKICAgIGF0dHJpYnV0ZXMsCiAgICBuYW1lc3BhY2UsCiAgICBwcmVmaXhlcwogIH0pIHsKICAgIGNvbnN0IGhhc05hbWVzcGFjZURlZiA9IG5hbWVzcGFjZSAhPT0gbnVsbDsKICAgIGlmIChoYXNOYW1lc3BhY2VEZWYpIHsKICAgICAgdGhpcy5fbmFtZXNwYWNlU3RhY2sucHVzaCh0aGlzLl9jdXJyZW50TmFtZXNwYWNlKTsKICAgICAgdGhpcy5fY3VycmVudE5hbWVzcGFjZSA9IHRoaXMuX3NlYXJjaE5hbWVzcGFjZShuYW1lc3BhY2UpOwogICAgfQogICAgaWYgKHByZWZpeGVzKSB7CiAgICAgIHRoaXMuX2FkZE5hbWVzcGFjZVByZWZpeChwcmVmaXhlcyk7CiAgICB9CiAgICBpZiAoYXR0cmlidXRlcy5oYXNPd25Qcm9wZXJ0eSgkbnNBdHRyaWJ1dGVzKSkgewogICAgICBjb25zdCBkYXRhVGVtcGxhdGUgPSBOYW1lc3BhY2VTZXRVcC5kYXRhc2V0czsKICAgICAgY29uc3QgbnNBdHRycyA9IGF0dHJpYnV0ZXNbJG5zQXR0cmlidXRlc107CiAgICAgIGxldCB4ZmFBdHRycyA9IG51bGw7CiAgICAgIGZvciAoY29uc3QgW25zLCBhdHRyc10gb2YgT2JqZWN0LmVudHJpZXMobnNBdHRycykpIHsKICAgICAgICBjb25zdCBuc1RvVXNlID0gdGhpcy5fZ2V0TmFtZXNwYWNlVG9Vc2UobnMpOwogICAgICAgIGlmIChuc1RvVXNlID09PSBkYXRhVGVtcGxhdGUpIHsKICAgICAgICAgIHhmYUF0dHJzID0gewogICAgICAgICAgICB4ZmE6IGF0dHJzCiAgICAgICAgICB9OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh4ZmFBdHRycykgewogICAgICAgIGF0dHJpYnV0ZXNbJG5zQXR0cmlidXRlc10gPSB4ZmFBdHRyczsKICAgICAgfSBlbHNlIHsKICAgICAgICBkZWxldGUgYXR0cmlidXRlc1skbnNBdHRyaWJ1dGVzXTsKICAgICAgfQogICAgfQogICAgY29uc3QgbmFtZXNwYWNlVG9Vc2UgPSB0aGlzLl9nZXROYW1lc3BhY2VUb1VzZShuc1ByZWZpeCk7CiAgICBjb25zdCBub2RlID0gbmFtZXNwYWNlVG9Vc2U/LlskYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHx8IG5ldyBFbXB0eSgpOwogICAgaWYgKG5vZGVbJGlzTnNBZ25vc3RpY10oKSkgewogICAgICB0aGlzLl9uc0Fnbm9zdGljTGV2ZWwrKzsKICAgIH0KICAgIGlmIChoYXNOYW1lc3BhY2VEZWYgfHwgcHJlZml4ZXMgfHwgbm9kZVskaXNOc0Fnbm9zdGljXSgpKSB7CiAgICAgIG5vZGVbJGNsZWFudXBdID0gewogICAgICAgIGhhc05hbWVzcGFjZTogaGFzTmFtZXNwYWNlRGVmLAogICAgICAgIHByZWZpeGVzLAogICAgICAgIG5zQWdub3N0aWM6IG5vZGVbJGlzTnNBZ25vc3RpY10oKQogICAgICB9OwogICAgfQogICAgcmV0dXJuIG5vZGU7CiAgfQogIGlzTnNBZ25vc3RpYygpIHsKICAgIHJldHVybiB0aGlzLl9uc0Fnbm9zdGljTGV2ZWwgPiAwOwogIH0KICBfc2VhcmNoTmFtZXNwYWNlKG5zTmFtZSkgewogICAgbGV0IG5zID0gdGhpcy5fbmFtZXNwYWNlcy5nZXQobnNOYW1lKTsKICAgIGlmIChucykgewogICAgICByZXR1cm4gbnM7CiAgICB9CiAgICBmb3IgKGNvbnN0IFtuYW1lLCB7CiAgICAgIGNoZWNrCiAgICB9XSBvZiBPYmplY3QuZW50cmllcyhOYW1lc3BhY2VJZHMpKSB7CiAgICAgIGlmIChjaGVjayhuc05hbWUpKSB7CiAgICAgICAgbnMgPSBOYW1lc3BhY2VTZXRVcFtuYW1lXTsKICAgICAgICBpZiAobnMpIHsKICAgICAgICAgIHRoaXMuX25hbWVzcGFjZXMuc2V0KG5zTmFtZSwgbnMpOwogICAgICAgICAgcmV0dXJuIG5zOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgbnMgPSBuZXcgVW5rbm93bk5hbWVzcGFjZSgrK3RoaXMuX25leHROc0lkKTsKICAgIHRoaXMuX25hbWVzcGFjZXMuc2V0KG5zTmFtZSwgbnMpOwogICAgcmV0dXJuIG5zOwogIH0KICBfYWRkTmFtZXNwYWNlUHJlZml4KHByZWZpeGVzKSB7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgcHJlZml4LAogICAgICB2YWx1ZQogICAgfSBvZiBwcmVmaXhlcykgewogICAgICBjb25zdCBuYW1lc3BhY2UgPSB0aGlzLl9zZWFyY2hOYW1lc3BhY2UodmFsdWUpOwogICAgICBsZXQgcHJlZml4U3RhY2sgPSB0aGlzLl9uYW1lc3BhY2VQcmVmaXhlcy5nZXQocHJlZml4KTsKICAgICAgaWYgKCFwcmVmaXhTdGFjaykgewogICAgICAgIHByZWZpeFN0YWNrID0gW107CiAgICAgICAgdGhpcy5fbmFtZXNwYWNlUHJlZml4ZXMuc2V0KHByZWZpeCwgcHJlZml4U3RhY2spOwogICAgICB9CiAgICAgIHByZWZpeFN0YWNrLnB1c2gobmFtZXNwYWNlKTsKICAgIH0KICB9CiAgX2dldE5hbWVzcGFjZVRvVXNlKHByZWZpeCkgewogICAgaWYgKCFwcmVmaXgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnROYW1lc3BhY2U7CiAgICB9CiAgICBjb25zdCBwcmVmaXhTdGFjayA9IHRoaXMuX25hbWVzcGFjZVByZWZpeGVzLmdldChwcmVmaXgpOwogICAgaWYgKHByZWZpeFN0YWNrPy5sZW5ndGggPiAwKSB7CiAgICAgIHJldHVybiBwcmVmaXhTdGFjay5hdCgtMSk7CiAgICB9CiAgICB3YXJuKGBVbmtub3duIG5hbWVzcGFjZSBwcmVmaXg6ICR7cHJlZml4fS5gKTsKICAgIHJldHVybiBudWxsOwogIH0KICBjbGVhbihkYXRhKSB7CiAgICBjb25zdCB7CiAgICAgIGhhc05hbWVzcGFjZSwKICAgICAgcHJlZml4ZXMsCiAgICAgIG5zQWdub3N0aWMKICAgIH0gPSBkYXRhOwogICAgaWYgKGhhc05hbWVzcGFjZSkgewogICAgICB0aGlzLl9jdXJyZW50TmFtZXNwYWNlID0gdGhpcy5fbmFtZXNwYWNlU3RhY2sucG9wKCk7CiAgICB9CiAgICBpZiAocHJlZml4ZXMpIHsKICAgICAgcHJlZml4ZXMuZm9yRWFjaCgoewogICAgICAgIHByZWZpeAogICAgICB9KSA9PiB7CiAgICAgICAgdGhpcy5fbmFtZXNwYWNlUHJlZml4ZXMuZ2V0KHByZWZpeCkucG9wKCk7CiAgICAgIH0pOwogICAgfQogICAgaWYgKG5zQWdub3N0aWMpIHsKICAgICAgdGhpcy5fbnNBZ25vc3RpY0xldmVsLS07CiAgICB9CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvcGFyc2VyLmpzCgoKCgpjbGFzcyBYRkFQYXJzZXIgZXh0ZW5kcyBYTUxQYXJzZXJCYXNlIHsKICBjb25zdHJ1Y3Rvcihyb290TmFtZVNwYWNlID0gbnVsbCwgcmljaFRleHQgPSBmYWxzZSkgewogICAgc3VwZXIoKTsKICAgIHRoaXMuX2J1aWxkZXIgPSBuZXcgQnVpbGRlcihyb290TmFtZVNwYWNlKTsKICAgIHRoaXMuX3N0YWNrID0gW107CiAgICB0aGlzLl9nbG9iYWxEYXRhID0gewogICAgICB1c2VkVHlwZWZhY2VzOiBuZXcgU2V0KCkKICAgIH07CiAgICB0aGlzLl9pZHMgPSBuZXcgTWFwKCk7CiAgICB0aGlzLl9jdXJyZW50ID0gdGhpcy5fYnVpbGRlci5idWlsZFJvb3QodGhpcy5faWRzKTsKICAgIHRoaXMuX2Vycm9yQ29kZSA9IFhNTFBhcnNlckVycm9yQ29kZS5Ob0Vycm9yOwogICAgdGhpcy5fd2hpdGVSZWdleCA9IC9eXHMrJC87CiAgICB0aGlzLl9uYnNwcyA9IC9ceGEwKy9nOwogICAgdGhpcy5fcmljaFRleHQgPSByaWNoVGV4dDsKICB9CiAgcGFyc2UoZGF0YSkgewogICAgdGhpcy5wYXJzZVhtbChkYXRhKTsKICAgIGlmICh0aGlzLl9lcnJvckNvZGUgIT09IFhNTFBhcnNlckVycm9yQ29kZS5Ob0Vycm9yKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICB0aGlzLl9jdXJyZW50WyRmaW5hbGl6ZV0oKTsKICAgIHJldHVybiB0aGlzLl9jdXJyZW50LmVsZW1lbnQ7CiAgfQogIG9uVGV4dCh0ZXh0KSB7CiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKHRoaXMuX25ic3BzLCBtYXRjaCA9PiBtYXRjaC5zbGljZSgxKSArICIgIik7CiAgICBpZiAodGhpcy5fcmljaFRleHQgfHwgdGhpcy5fY3VycmVudFskYWNjZXB0V2hpdGVzcGFjZV0oKSkgewogICAgICB0aGlzLl9jdXJyZW50WyRvblRleHRdKHRleHQsIHRoaXMuX3JpY2hUZXh0KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuX3doaXRlUmVnZXgudGVzdCh0ZXh0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9jdXJyZW50WyRvblRleHRdKHRleHQudHJpbSgpKTsKICB9CiAgb25DZGF0YSh0ZXh0KSB7CiAgICB0aGlzLl9jdXJyZW50WyRvblRleHRdKHRleHQpOwogIH0KICBfbWtBdHRyaWJ1dGVzKGF0dHJpYnV0ZXMsIHRhZ05hbWUpIHsKICAgIGxldCBuYW1lc3BhY2UgPSBudWxsOwogICAgbGV0IHByZWZpeGVzID0gbnVsbDsKICAgIGNvbnN0IGF0dHJpYnV0ZU9iaiA9IE9iamVjdC5jcmVhdGUoe30pOwogICAgZm9yIChjb25zdCB7CiAgICAgIG5hbWUsCiAgICAgIHZhbHVlCiAgICB9IG9mIGF0dHJpYnV0ZXMpIHsKICAgICAgaWYgKG5hbWUgPT09ICJ4bWxucyIpIHsKICAgICAgICBpZiAoIW5hbWVzcGFjZSkgewogICAgICAgICAgbmFtZXNwYWNlID0gdmFsdWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdhcm4oYFhGQSAtIG11bHRpcGxlIG5hbWVzcGFjZSBkZWZpbml0aW9uIGluIDwke3RhZ05hbWV9PmApOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChuYW1lLnN0YXJ0c1dpdGgoInhtbG5zOiIpKSB7CiAgICAgICAgY29uc3QgcHJlZml4ID0gbmFtZS5zdWJzdHJpbmcoInhtbG5zOiIubGVuZ3RoKTsKICAgICAgICBwcmVmaXhlcyA/Pz0gW107CiAgICAgICAgcHJlZml4ZXMucHVzaCh7CiAgICAgICAgICBwcmVmaXgsCiAgICAgICAgICB2YWx1ZQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGkgPSBuYW1lLmluZGV4T2YoIjoiKTsKICAgICAgICBpZiAoaSA9PT0gLTEpIHsKICAgICAgICAgIGF0dHJpYnV0ZU9ialtuYW1lXSA9IHZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBuc0F0dHJzID0gYXR0cmlidXRlT2JqWyRuc0F0dHJpYnV0ZXNdID8/PSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgY29uc3QgW25zLCBhdHRyTmFtZV0gPSBbbmFtZS5zbGljZSgwLCBpKSwgbmFtZS5zbGljZShpICsgMSldOwogICAgICAgICAgY29uc3QgYXR0cnMgPSBuc0F0dHJzW25zXSB8fD0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgIGF0dHJzW2F0dHJOYW1lXSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIFtuYW1lc3BhY2UsIHByZWZpeGVzLCBhdHRyaWJ1dGVPYmpdOwogIH0KICBfZ2V0TmFtZUFuZFByZWZpeChuYW1lLCBuc0Fnbm9zdGljKSB7CiAgICBjb25zdCBpID0gbmFtZS5pbmRleE9mKCI6Iik7CiAgICBpZiAoaSA9PT0gLTEpIHsKICAgICAgcmV0dXJuIFtuYW1lLCBudWxsXTsKICAgIH0KICAgIHJldHVybiBbbmFtZS5zdWJzdHJpbmcoaSArIDEpLCBuc0Fnbm9zdGljID8gIiIgOiBuYW1lLnN1YnN0cmluZygwLCBpKV07CiAgfQogIG9uQmVnaW5FbGVtZW50KHRhZ05hbWUsIGF0dHJpYnV0ZXMsIGlzRW1wdHkpIHsKICAgIGNvbnN0IFtuYW1lc3BhY2UsIHByZWZpeGVzLCBhdHRyaWJ1dGVzT2JqXSA9IHRoaXMuX21rQXR0cmlidXRlcyhhdHRyaWJ1dGVzLCB0YWdOYW1lKTsKICAgIGNvbnN0IFtuYW1lLCBuc1ByZWZpeF0gPSB0aGlzLl9nZXROYW1lQW5kUHJlZml4KHRhZ05hbWUsIHRoaXMuX2J1aWxkZXIuaXNOc0Fnbm9zdGljKCkpOwogICAgY29uc3Qgbm9kZSA9IHRoaXMuX2J1aWxkZXIuYnVpbGQoewogICAgICBuc1ByZWZpeCwKICAgICAgbmFtZSwKICAgICAgYXR0cmlidXRlczogYXR0cmlidXRlc09iaiwKICAgICAgbmFtZXNwYWNlLAogICAgICBwcmVmaXhlcwogICAgfSk7CiAgICBub2RlWyRnbG9iYWxEYXRhXSA9IHRoaXMuX2dsb2JhbERhdGE7CiAgICBpZiAoaXNFbXB0eSkgewogICAgICBub2RlWyRmaW5hbGl6ZV0oKTsKICAgICAgaWYgKHRoaXMuX2N1cnJlbnRbJG9uQ2hpbGRdKG5vZGUpKSB7CiAgICAgICAgbm9kZVskc2V0SWRdKHRoaXMuX2lkcyk7CiAgICAgIH0KICAgICAgbm9kZVskY2xlYW5dKHRoaXMuX2J1aWxkZXIpOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9zdGFjay5wdXNoKHRoaXMuX2N1cnJlbnQpOwogICAgdGhpcy5fY3VycmVudCA9IG5vZGU7CiAgfQogIG9uRW5kRWxlbWVudChuYW1lKSB7CiAgICBjb25zdCBub2RlID0gdGhpcy5fY3VycmVudDsKICAgIGlmIChub2RlWyRpc0NEQVRBWG1sXSgpICYmIHR5cGVvZiBub2RlWyRjb250ZW50XSA9PT0gInN0cmluZyIpIHsKICAgICAgY29uc3QgcGFyc2VyID0gbmV3IFhGQVBhcnNlcigpOwogICAgICBwYXJzZXIuX2dsb2JhbERhdGEgPSB0aGlzLl9nbG9iYWxEYXRhOwogICAgICBjb25zdCByb290ID0gcGFyc2VyLnBhcnNlKG5vZGVbJGNvbnRlbnRdKTsKICAgICAgbm9kZVskY29udGVudF0gPSBudWxsOwogICAgICBub2RlWyRvbkNoaWxkXShyb290KTsKICAgIH0KICAgIG5vZGVbJGZpbmFsaXplXSgpOwogICAgdGhpcy5fY3VycmVudCA9IHRoaXMuX3N0YWNrLnBvcCgpOwogICAgaWYgKHRoaXMuX2N1cnJlbnRbJG9uQ2hpbGRdKG5vZGUpKSB7CiAgICAgIG5vZGVbJHNldElkXSh0aGlzLl9pZHMpOwogICAgfQogICAgbm9kZVskY2xlYW5dKHRoaXMuX2J1aWxkZXIpOwogIH0KICBvbkVycm9yKGNvZGUpIHsKICAgIHRoaXMuX2Vycm9yQ29kZSA9IGNvZGU7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS94ZmEvZmFjdG9yeS5qcwoKCgoKCgoKCmNsYXNzIFhGQUZhY3RvcnkgewogIGNvbnN0cnVjdG9yKGRhdGEpIHsKICAgIHRyeSB7CiAgICAgIHRoaXMucm9vdCA9IG5ldyBYRkFQYXJzZXIoKS5wYXJzZShYRkFGYWN0b3J5Ll9jcmVhdGVEb2N1bWVudChkYXRhKSk7CiAgICAgIGNvbnN0IGJpbmRlciA9IG5ldyBCaW5kZXIodGhpcy5yb290KTsKICAgICAgdGhpcy5mb3JtID0gYmluZGVyLmJpbmQoKTsKICAgICAgdGhpcy5kYXRhSGFuZGxlciA9IG5ldyBEYXRhSGFuZGxlcih0aGlzLnJvb3QsIGJpbmRlci5nZXREYXRhKCkpOwogICAgICB0aGlzLmZvcm1bJGdsb2JhbERhdGFdLnRlbXBsYXRlID0gdGhpcy5mb3JtOwogICAgfSBjYXRjaCAoZSkgewogICAgICB3YXJuKGBYRkEgLSBhbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgcGFyc2luZyBhbmQgYmluZGluZzogJHtlfWApOwogICAgfQogIH0KICBpc1ZhbGlkKCkgewogICAgcmV0dXJuICEhKHRoaXMucm9vdCAmJiB0aGlzLmZvcm0pOwogIH0KICBfY3JlYXRlUGFnZXNIZWxwZXIoKSB7CiAgICBjb25zdCBpdGVyYXRvciA9IHRoaXMuZm9ybVskdG9QYWdlc10oKTsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIGNvbnN0IG5leHRJdGVyYXRpb24gPSAoKSA9PiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IHZhbHVlID0gaXRlcmF0b3IubmV4dCgpOwogICAgICAgICAgaWYgKHZhbHVlLmRvbmUpIHsKICAgICAgICAgICAgcmVzb2x2ZSh2YWx1ZS52YWx1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZXRUaW1lb3V0KG5leHRJdGVyYXRpb24sIDApOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHNldFRpbWVvdXQobmV4dEl0ZXJhdGlvbiwgMCk7CiAgICB9KTsKICB9CiAgYXN5bmMgX2NyZWF0ZVBhZ2VzKCkgewogICAgdHJ5IHsKICAgICAgdGhpcy5wYWdlcyA9IGF3YWl0IHRoaXMuX2NyZWF0ZVBhZ2VzSGVscGVyKCk7CiAgICAgIHRoaXMuZGltcyA9IHRoaXMucGFnZXMuY2hpbGRyZW4ubWFwKGMgPT4gewogICAgICAgIGNvbnN0IHsKICAgICAgICAgIHdpZHRoLAogICAgICAgICAgaGVpZ2h0CiAgICAgICAgfSA9IGMuYXR0cmlidXRlcy5zdHlsZTsKICAgICAgICByZXR1cm4gWzAsIDAsIHBhcnNlSW50KHdpZHRoKSwgcGFyc2VJbnQoaGVpZ2h0KV07CiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICB3YXJuKGBYRkEgLSBhbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgbGF5b3V0OiAke2V9YCk7CiAgICB9CiAgfQogIGdldEJvdW5kaW5nQm94KHBhZ2VJbmRleCkgewogICAgcmV0dXJuIHRoaXMuZGltc1twYWdlSW5kZXhdOwogIH0KICBhc3luYyBnZXROdW1QYWdlcygpIHsKICAgIGlmICghdGhpcy5wYWdlcykgewogICAgICBhd2FpdCB0aGlzLl9jcmVhdGVQYWdlcygpOwogICAgfQogICAgcmV0dXJuIHRoaXMuZGltcy5sZW5ndGg7CiAgfQogIHNldEltYWdlcyhpbWFnZXMpIHsKICAgIHRoaXMuZm9ybVskZ2xvYmFsRGF0YV0uaW1hZ2VzID0gaW1hZ2VzOwogIH0KICBzZXRGb250cyhmb250cykgewogICAgdGhpcy5mb3JtWyRnbG9iYWxEYXRhXS5mb250RmluZGVyID0gbmV3IEZvbnRGaW5kZXIoZm9udHMpOwogICAgY29uc3QgbWlzc2luZ0ZvbnRzID0gW107CiAgICBmb3IgKGxldCB0eXBlZmFjZSBvZiB0aGlzLmZvcm1bJGdsb2JhbERhdGFdLnVzZWRUeXBlZmFjZXMpIHsKICAgICAgdHlwZWZhY2UgPSBzdHJpcFF1b3Rlcyh0eXBlZmFjZSk7CiAgICAgIGNvbnN0IGZvbnQgPSB0aGlzLmZvcm1bJGdsb2JhbERhdGFdLmZvbnRGaW5kZXIuZmluZCh0eXBlZmFjZSk7CiAgICAgIGlmICghZm9udCkgewogICAgICAgIG1pc3NpbmdGb250cy5wdXNoKHR5cGVmYWNlKTsKICAgICAgfQogICAgfQogICAgaWYgKG1pc3NpbmdGb250cy5sZW5ndGggPiAwKSB7CiAgICAgIHJldHVybiBtaXNzaW5nRm9udHM7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgYXBwZW5kRm9udHMoZm9udHMsIHJlYWxseU1pc3NpbmdGb250cykgewogICAgdGhpcy5mb3JtWyRnbG9iYWxEYXRhXS5mb250RmluZGVyLmFkZChmb250cywgcmVhbGx5TWlzc2luZ0ZvbnRzKTsKICB9CiAgYXN5bmMgZ2V0UGFnZXMoKSB7CiAgICBpZiAoIXRoaXMucGFnZXMpIHsKICAgICAgYXdhaXQgdGhpcy5fY3JlYXRlUGFnZXMoKTsKICAgIH0KICAgIGNvbnN0IHBhZ2VzID0gdGhpcy5wYWdlczsKICAgIHRoaXMucGFnZXMgPSBudWxsOwogICAgcmV0dXJuIHBhZ2VzOwogIH0KICBzZXJpYWxpemVEYXRhKHN0b3JhZ2UpIHsKICAgIHJldHVybiB0aGlzLmRhdGFIYW5kbGVyLnNlcmlhbGl6ZShzdG9yYWdlKTsKICB9CiAgc3RhdGljIF9jcmVhdGVEb2N1bWVudChkYXRhKSB7CiAgICBpZiAoIWRhdGFbIi94ZHA6eGRwIl0pIHsKICAgICAgcmV0dXJuIGRhdGFbInhkcDp4ZHAiXTsKICAgIH0KICAgIHJldHVybiBPYmplY3QudmFsdWVzKGRhdGEpLmpvaW4oIiIpOwogIH0KICBzdGF0aWMgZ2V0UmljaFRleHRBc0h0bWwocmMpIHsKICAgIGlmICghcmMgfHwgdHlwZW9mIHJjICE9PSAic3RyaW5nIikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHRyeSB7CiAgICAgIGxldCByb290ID0gbmV3IFhGQVBhcnNlcihYaHRtbE5hbWVzcGFjZSwgdHJ1ZSkucGFyc2UocmMpOwogICAgICBpZiAoIVsiYm9keSIsICJ4aHRtbCJdLmluY2x1ZGVzKHJvb3RbJG5vZGVOYW1lXSkpIHsKICAgICAgICBjb25zdCBuZXdSb290ID0gWGh0bWxOYW1lc3BhY2UuYm9keSh7fSk7CiAgICAgICAgbmV3Um9vdFskYXBwZW5kQ2hpbGRdKHJvb3QpOwogICAgICAgIHJvb3QgPSBuZXdSb290OwogICAgICB9CiAgICAgIGNvbnN0IHJlc3VsdCA9IHJvb3RbJHRvSFRNTF0oKTsKICAgICAgaWYgKCFyZXN1bHQuc3VjY2VzcykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IHsKICAgICAgICBodG1sCiAgICAgIH0gPSByZXN1bHQ7CiAgICAgIGNvbnN0IHsKICAgICAgICBhdHRyaWJ1dGVzCiAgICAgIH0gPSBodG1sOwogICAgICBpZiAoYXR0cmlidXRlcykgewogICAgICAgIGlmIChhdHRyaWJ1dGVzLmNsYXNzKSB7CiAgICAgICAgICBhdHRyaWJ1dGVzLmNsYXNzID0gYXR0cmlidXRlcy5jbGFzcy5maWx0ZXIoYXR0ciA9PiAhYXR0ci5zdGFydHNXaXRoKCJ4ZmEiKSk7CiAgICAgICAgfQogICAgICAgIGF0dHJpYnV0ZXMuZGlyID0gImF1dG8iOwogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgaHRtbCwKICAgICAgICBzdHI6IHJvb3RbJHRleHRdKCkKICAgICAgfTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgd2FybihgWEZBIC0gYW4gZXJyb3Igb2NjdXJyZWQgZHVyaW5nIHBhcnNpbmcgb2YgcmljaCB0ZXh0OiAke2V9YCk7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2Fubm90YXRpb24uanMKCgoKCgoKCgoKCgoKCgoKY2xhc3MgQW5ub3RhdGlvbkZhY3RvcnkgewogIHN0YXRpYyBjcmVhdGVHbG9iYWxzKHBkZk1hbmFnZXIpIHsKICAgIHJldHVybiBQcm9taXNlLmFsbChbcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJhY3JvRm9ybSIpLCBwZGZNYW5hZ2VyLmVuc3VyZURvYygieGZhRGF0YXNldHMiKSwgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJzdHJ1Y3RUcmVlUm9vdCIpLCBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImJhc2VVcmwiKSwgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJhdHRhY2htZW50cyIpLCBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImdsb2JhbENvbG9yU3BhY2VDYWNoZSIpXSkudGhlbigoW2Fjcm9Gb3JtLCB4ZmFEYXRhc2V0cywgc3RydWN0VHJlZVJvb3QsIGJhc2VVcmwsIGF0dGFjaG1lbnRzLCBnbG9iYWxDb2xvclNwYWNlQ2FjaGVdKSA9PiAoewogICAgICBwZGZNYW5hZ2VyLAogICAgICBhY3JvRm9ybTogYWNyb0Zvcm0gaW5zdGFuY2VvZiBEaWN0ID8gYWNyb0Zvcm0gOiBEaWN0LmVtcHR5LAogICAgICB4ZmFEYXRhc2V0cywKICAgICAgc3RydWN0VHJlZVJvb3QsCiAgICAgIGJhc2VVcmwsCiAgICAgIGF0dGFjaG1lbnRzLAogICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGUKICAgIH0pLCByZWFzb24gPT4gewogICAgICB3YXJuKGBjcmVhdGVHbG9iYWxzOiAiJHtyZWFzb259Ii5gKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9KTsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZSh4cmVmLCByZWYsIGFubm90YXRpb25HbG9iYWxzLCBpZEZhY3RvcnksIGNvbGxlY3RGaWVsZHMsIG9ycGhhbkZpZWxkcywgcGFnZVJlZikgewogICAgY29uc3QgcGFnZUluZGV4ID0gY29sbGVjdEZpZWxkcyA/IGF3YWl0IHRoaXMuX2dldFBhZ2VJbmRleCh4cmVmLCByZWYsIGFubm90YXRpb25HbG9iYWxzLnBkZk1hbmFnZXIpIDogbnVsbDsKICAgIHJldHVybiBhbm5vdGF0aW9uR2xvYmFscy5wZGZNYW5hZ2VyLmVuc3VyZSh0aGlzLCAiX2NyZWF0ZSIsIFt4cmVmLCByZWYsIGFubm90YXRpb25HbG9iYWxzLCBpZEZhY3RvcnksIGNvbGxlY3RGaWVsZHMsIG9ycGhhbkZpZWxkcywgcGFnZUluZGV4LCBwYWdlUmVmXSk7CiAgfQogIHN0YXRpYyBfY3JlYXRlKHhyZWYsIHJlZiwgYW5ub3RhdGlvbkdsb2JhbHMsIGlkRmFjdG9yeSwgY29sbGVjdEZpZWxkcyA9IGZhbHNlLCBvcnBoYW5GaWVsZHMgPSBudWxsLCBwYWdlSW5kZXggPSBudWxsLCBwYWdlUmVmID0gbnVsbCkgewogICAgY29uc3QgZGljdCA9IHhyZWYuZmV0Y2hJZlJlZihyZWYpOwogICAgaWYgKCEoZGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGFjcm9Gb3JtLAogICAgICBwZGZNYW5hZ2VyCiAgICB9ID0gYW5ub3RhdGlvbkdsb2JhbHM7CiAgICBjb25zdCBpZCA9IHJlZiBpbnN0YW5jZW9mIFJlZiA/IHJlZi50b1N0cmluZygpIDogYGFubm90XyR7aWRGYWN0b3J5LmNyZWF0ZU9iaklkKCl9YDsKICAgIGxldCBzdWJ0eXBlID0gZGljdC5nZXQoIlN1YnR5cGUiKTsKICAgIHN1YnR5cGUgPSBzdWJ0eXBlIGluc3RhbmNlb2YgTmFtZSA/IHN1YnR5cGUubmFtZSA6IG51bGw7CiAgICBjb25zdCBwYXJhbWV0ZXJzID0gewogICAgICB4cmVmLAogICAgICByZWYsCiAgICAgIGRpY3QsCiAgICAgIHN1YnR5cGUsCiAgICAgIGlkLAogICAgICBhbm5vdGF0aW9uR2xvYmFscywKICAgICAgY29sbGVjdEZpZWxkcywKICAgICAgb3JwaGFuRmllbGRzLAogICAgICBuZWVkQXBwZWFyYW5jZXM6ICFjb2xsZWN0RmllbGRzICYmIGFjcm9Gb3JtLmdldCgiTmVlZEFwcGVhcmFuY2VzIikgPT09IHRydWUsCiAgICAgIHBhZ2VJbmRleCwKICAgICAgZXZhbHVhdG9yT3B0aW9uczogcGRmTWFuYWdlci5ldmFsdWF0b3JPcHRpb25zLAogICAgICBwYWdlUmVmCiAgICB9OwogICAgc3dpdGNoIChzdWJ0eXBlKSB7CiAgICAgIGNhc2UgIkxpbmsiOgogICAgICAgIHJldHVybiBuZXcgTGlua0Fubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIlRleHQiOgogICAgICAgIHJldHVybiBuZXcgVGV4dEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIldpZGdldCI6CiAgICAgICAgbGV0IGZpZWxkVHlwZSA9IGdldEluaGVyaXRhYmxlUHJvcGVydHkoewogICAgICAgICAgZGljdCwKICAgICAgICAgIGtleTogIkZUIgogICAgICAgIH0pOwogICAgICAgIGZpZWxkVHlwZSA9IGZpZWxkVHlwZSBpbnN0YW5jZW9mIE5hbWUgPyBmaWVsZFR5cGUubmFtZSA6IG51bGw7CiAgICAgICAgc3dpdGNoIChmaWVsZFR5cGUpIHsKICAgICAgICAgIGNhc2UgIlR4IjoKICAgICAgICAgICAgcmV0dXJuIG5ldyBUZXh0V2lkZ2V0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgICAgIGNhc2UgIkJ0biI6CiAgICAgICAgICAgIHJldHVybiBuZXcgQnV0dG9uV2lkZ2V0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgICAgIGNhc2UgIkNoIjoKICAgICAgICAgICAgcmV0dXJuIG5ldyBDaG9pY2VXaWRnZXRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICAgICAgY2FzZSAiU2lnIjoKICAgICAgICAgICAgcmV0dXJuIG5ldyBTaWduYXR1cmVXaWRnZXRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICAgIH0KICAgICAgICB3YXJuKGBVbmltcGxlbWVudGVkIHdpZGdldCBmaWVsZCB0eXBlICIke2ZpZWxkVHlwZX0iLCBgICsgImZhbGxpbmcgYmFjayB0byBiYXNlIGZpZWxkIHR5cGUuIik7CiAgICAgICAgcmV0dXJuIG5ldyBXaWRnZXRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJQb3B1cCI6CiAgICAgICAgcmV0dXJuIG5ldyBQb3B1cEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIkZyZWVUZXh0IjoKICAgICAgICByZXR1cm4gbmV3IEZyZWVUZXh0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiTGluZSI6CiAgICAgICAgcmV0dXJuIG5ldyBMaW5lQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiU3F1YXJlIjoKICAgICAgICByZXR1cm4gbmV3IFNxdWFyZUFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIkNpcmNsZSI6CiAgICAgICAgcmV0dXJuIG5ldyBDaXJjbGVBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJQb2x5TGluZSI6CiAgICAgICAgcmV0dXJuIG5ldyBQb2x5bGluZUFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIlBvbHlnb24iOgogICAgICAgIHJldHVybiBuZXcgUG9seWdvbkFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIkNhcmV0IjoKICAgICAgICByZXR1cm4gbmV3IENhcmV0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiSW5rIjoKICAgICAgICByZXR1cm4gbmV3IElua0Fubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIkhpZ2hsaWdodCI6CiAgICAgICAgcmV0dXJuIG5ldyBIaWdobGlnaHRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJVbmRlcmxpbmUiOgogICAgICAgIHJldHVybiBuZXcgVW5kZXJsaW5lQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiU3F1aWdnbHkiOgogICAgICAgIHJldHVybiBuZXcgU3F1aWdnbHlBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJTdHJpa2VPdXQiOgogICAgICAgIHJldHVybiBuZXcgU3RyaWtlT3V0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiU3RhbXAiOgogICAgICAgIHJldHVybiBuZXcgU3RhbXBBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJGaWxlQXR0YWNobWVudCI6CiAgICAgICAgcmV0dXJuIG5ldyBGaWxlQXR0YWNobWVudEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgaWYgKCFjb2xsZWN0RmllbGRzKSB7CiAgICAgICAgICBpZiAoIXN1YnR5cGUpIHsKICAgICAgICAgICAgd2FybigiQW5ub3RhdGlvbiBpcyBtaXNzaW5nIHRoZSByZXF1aXJlZCAvU3VidHlwZS4iKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHdhcm4oYFVuaW1wbGVtZW50ZWQgYW5ub3RhdGlvbiB0eXBlICIke3N1YnR5cGV9IiwgYCArICJmYWxsaW5nIGJhY2sgdG8gYmFzZSBhbm5vdGF0aW9uLiIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICB9CiAgfQogIHN0YXRpYyBhc3luYyBfZ2V0UGFnZUluZGV4KHhyZWYsIHJlZiwgcGRmTWFuYWdlcikgewogICAgdHJ5IHsKICAgICAgY29uc3QgYW5ub3REaWN0ID0gYXdhaXQgeHJlZi5mZXRjaElmUmVmQXN5bmMocmVmKTsKICAgICAgaWYgKCEoYW5ub3REaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICByZXR1cm4gLTE7CiAgICAgIH0KICAgICAgY29uc3QgcGFnZVJlZiA9IGFubm90RGljdC5nZXRSYXcoIlAiKTsKICAgICAgaWYgKHBhZ2VSZWYgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICB0cnkgewogICAgICAgICAgY29uc3QgcGFnZUluZGV4ID0gYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJnZXRQYWdlSW5kZXgiLCBbcGFnZVJlZl0pOwogICAgICAgICAgcmV0dXJuIHBhZ2VJbmRleDsKICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgaW5mbyhgX2dldFBhZ2VJbmRleCAtLSBub3QgYSB2YWxpZCBwYWdlIHJlZmVyZW5jZTogIiR7ZXh9Ii5gKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGFubm90RGljdC5oYXMoIktpZHMiKSkgewogICAgICAgIHJldHVybiAtMTsKICAgICAgfQogICAgICBjb25zdCBudW1QYWdlcyA9IGF3YWl0IHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJudW1QYWdlcyIpOwogICAgICBmb3IgKGxldCBwYWdlSW5kZXggPSAwOyBwYWdlSW5kZXggPCBudW1QYWdlczsgcGFnZUluZGV4KyspIHsKICAgICAgICBjb25zdCBwYWdlID0gYXdhaXQgcGRmTWFuYWdlci5nZXRQYWdlKHBhZ2VJbmRleCk7CiAgICAgICAgY29uc3QgYW5ub3RhdGlvbnMgPSBhd2FpdCBwZGZNYW5hZ2VyLmVuc3VyZShwYWdlLCAiYW5ub3RhdGlvbnMiKTsKICAgICAgICBmb3IgKGNvbnN0IGFubm90UmVmIG9mIGFubm90YXRpb25zKSB7CiAgICAgICAgICBpZiAoYW5ub3RSZWYgaW5zdGFuY2VvZiBSZWYgJiYgaXNSZWZzRXF1YWwoYW5ub3RSZWYsIHJlZikpIHsKICAgICAgICAgICAgcmV0dXJuIHBhZ2VJbmRleDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIHdhcm4oYF9nZXRQYWdlSW5kZXg6ICIke2V4fSIuYCk7CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfQogIHN0YXRpYyBnZW5lcmF0ZUltYWdlcyhhbm5vdGF0aW9ucywgeHJlZiwgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpIHsKICAgIGlmICghaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpIHsKICAgICAgd2FybigiZ2VuZXJhdGVJbWFnZXM6IE9mZnNjcmVlbkNhbnZhcyBpcyBub3Qgc3VwcG9ydGVkLCBjYW5ub3Qgc2F2ZSBvciBwcmludCBzb21lIGFubm90YXRpb25zIHdpdGggaW1hZ2VzLiIpOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGxldCBpbWFnZVByb21pc2VzOwogICAgZm9yIChjb25zdCB7CiAgICAgIGJpdG1hcElkLAogICAgICBiaXRtYXAKICAgIH0gb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgaWYgKCFiaXRtYXApIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpbWFnZVByb21pc2VzIHx8PSBuZXcgTWFwKCk7CiAgICAgIGltYWdlUHJvbWlzZXMuc2V0KGJpdG1hcElkLCBTdGFtcEFubm90YXRpb24uY3JlYXRlSW1hZ2UoYml0bWFwLCB4cmVmKSk7CiAgICB9CiAgICByZXR1cm4gaW1hZ2VQcm9taXNlczsKICB9CiAgc3RhdGljIGFzeW5jIHNhdmVOZXdBbm5vdGF0aW9ucyhldmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25zLCBpbWFnZVByb21pc2VzLCBjaGFuZ2VzKSB7CiAgICBjb25zdCB4cmVmID0gZXZhbHVhdG9yLnhyZWY7CiAgICBsZXQgYmFzZUZvbnRSZWY7CiAgICBjb25zdCBwcm9taXNlcyA9IFtdOwogICAgY29uc3QgewogICAgICBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZAogICAgfSA9IGV2YWx1YXRvci5vcHRpb25zOwogICAgZm9yIChjb25zdCBhbm5vdGF0aW9uIG9mIGFubm90YXRpb25zKSB7CiAgICAgIGlmIChhbm5vdGF0aW9uLmRlbGV0ZWQpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBzd2l0Y2ggKGFubm90YXRpb24uYW5ub3RhdGlvblR5cGUpIHsKICAgICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JUeXBlLkZSRUVURVhUOgogICAgICAgICAgaWYgKCFiYXNlRm9udFJlZikgewogICAgICAgICAgICBjb25zdCBiYXNlRm9udCA9IG5ldyBEaWN0KHhyZWYpOwogICAgICAgICAgICBiYXNlRm9udC5zZXRJZk5hbWUoIkJhc2VGb250IiwgIkhlbHZldGljYSIpOwogICAgICAgICAgICBiYXNlRm9udC5zZXRJZk5hbWUoIlR5cGUiLCAiRm9udCIpOwogICAgICAgICAgICBiYXNlRm9udC5zZXRJZk5hbWUoIlN1YnR5cGUiLCAiVHlwZTEiKTsKICAgICAgICAgICAgYmFzZUZvbnQuc2V0SWZOYW1lKCJFbmNvZGluZyIsICJXaW5BbnNpRW5jb2RpbmciKTsKICAgICAgICAgICAgYmFzZUZvbnRSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgICAgICAgICBjaGFuZ2VzLnB1dChiYXNlRm9udFJlZiwgewogICAgICAgICAgICAgIGRhdGE6IGJhc2VGb250CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgcHJvbWlzZXMucHVzaChGcmVlVGV4dEFubm90YXRpb24uY3JlYXRlTmV3QW5ub3RhdGlvbih4cmVmLCBhbm5vdGF0aW9uLCBjaGFuZ2VzLCB7CiAgICAgICAgICAgIGV2YWx1YXRvciwKICAgICAgICAgICAgdGFzaywKICAgICAgICAgICAgYmFzZUZvbnRSZWYKICAgICAgICAgIH0pKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclR5cGUuSElHSExJR0hUOgogICAgICAgICAgaWYgKGFubm90YXRpb24ucXVhZFBvaW50cykgewogICAgICAgICAgICBwcm9taXNlcy5wdXNoKEhpZ2hsaWdodEFubm90YXRpb24uY3JlYXRlTmV3QW5ub3RhdGlvbih4cmVmLCBhbm5vdGF0aW9uLCBjaGFuZ2VzKSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcm9taXNlcy5wdXNoKElua0Fubm90YXRpb24uY3JlYXRlTmV3QW5ub3RhdGlvbih4cmVmLCBhbm5vdGF0aW9uLCBjaGFuZ2VzKSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JUeXBlLklOSzoKICAgICAgICAgIHByb21pc2VzLnB1c2goSW5rQW5ub3RhdGlvbi5jcmVhdGVOZXdBbm5vdGF0aW9uKHhyZWYsIGFubm90YXRpb24sIGNoYW5nZXMpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclR5cGUuU1RBTVA6CiAgICAgICAgICBjb25zdCBpbWFnZSA9IGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkID8gYXdhaXQgaW1hZ2VQcm9taXNlcz8uZ2V0KGFubm90YXRpb24uYml0bWFwSWQpIDogbnVsbDsKICAgICAgICAgIGlmIChpbWFnZT8uaW1hZ2VTdHJlYW0pIHsKICAgICAgICAgICAgY29uc3QgewogICAgICAgICAgICAgIGltYWdlU3RyZWFtLAogICAgICAgICAgICAgIHNtYXNrU3RyZWFtCiAgICAgICAgICAgIH0gPSBpbWFnZTsKICAgICAgICAgICAgaWYgKHNtYXNrU3RyZWFtKSB7CiAgICAgICAgICAgICAgY29uc3Qgc21hc2tSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgICAgICAgICAgIGNoYW5nZXMucHV0KHNtYXNrUmVmLCB7CiAgICAgICAgICAgICAgICBkYXRhOiBzbWFza1N0cmVhbQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGltYWdlU3RyZWFtLmRpY3Quc2V0KCJTTWFzayIsIHNtYXNrUmVmKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBpbWFnZVJlZiA9IGltYWdlLmltYWdlUmVmID0geHJlZi5nZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgICAgICAgICAgY2hhbmdlcy5wdXQoaW1hZ2VSZWYsIHsKICAgICAgICAgICAgICBkYXRhOiBpbWFnZVN0cmVhbQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaW1hZ2UuaW1hZ2VTdHJlYW0gPSBpbWFnZS5zbWFza1N0cmVhbSA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBwcm9taXNlcy5wdXNoKFN0YW1wQW5ub3RhdGlvbi5jcmVhdGVOZXdBbm5vdGF0aW9uKHhyZWYsIGFubm90YXRpb24sIGNoYW5nZXMsIHsKICAgICAgICAgICAgaW1hZ2UKICAgICAgICAgIH0pKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclR5cGUuU0lHTkFUVVJFOgogICAgICAgICAgcHJvbWlzZXMucHVzaChTdGFtcEFubm90YXRpb24uY3JlYXRlTmV3QW5ub3RhdGlvbih4cmVmLCBhbm5vdGF0aW9uLCBjaGFuZ2VzLCB7fSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB7CiAgICAgIGFubm90YXRpb25zOiAoYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpKS5mbGF0KCkKICAgIH07CiAgfQogIHN0YXRpYyBhc3luYyBwcmludE5ld0Fubm90YXRpb25zKGFubm90YXRpb25HbG9iYWxzLCBldmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25zLCBpbWFnZVByb21pc2VzKSB7CiAgICBpZiAoIWFubm90YXRpb25zKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgewogICAgICBvcHRpb25zLAogICAgICB4cmVmCiAgICB9ID0gZXZhbHVhdG9yOwogICAgY29uc3QgcHJvbWlzZXMgPSBbXTsKICAgIGZvciAoY29uc3QgYW5ub3RhdGlvbiBvZiBhbm5vdGF0aW9ucykgewogICAgICBpZiAoYW5ub3RhdGlvbi5kZWxldGVkKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc3dpdGNoIChhbm5vdGF0aW9uLmFubm90YXRpb25UeXBlKSB7CiAgICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5GUkVFVEVYVDoKICAgICAgICAgIHByb21pc2VzLnB1c2goRnJlZVRleHRBbm5vdGF0aW9uLmNyZWF0ZU5ld1ByaW50QW5ub3RhdGlvbihhbm5vdGF0aW9uR2xvYmFscywgeHJlZiwgYW5ub3RhdGlvbiwgewogICAgICAgICAgICBldmFsdWF0b3IsCiAgICAgICAgICAgIHRhc2ssCiAgICAgICAgICAgIGV2YWx1YXRvck9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgIH0pKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQW5ub3RhdGlvbkVkaXRvclR5cGUuSElHSExJR0hUOgogICAgICAgICAgaWYgKGFubm90YXRpb24ucXVhZFBvaW50cykgewogICAgICAgICAgICBwcm9taXNlcy5wdXNoKEhpZ2hsaWdodEFubm90YXRpb24uY3JlYXRlTmV3UHJpbnRBbm5vdGF0aW9uKGFubm90YXRpb25HbG9iYWxzLCB4cmVmLCBhbm5vdGF0aW9uLCB7CiAgICAgICAgICAgICAgZXZhbHVhdG9yT3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcm9taXNlcy5wdXNoKElua0Fubm90YXRpb24uY3JlYXRlTmV3UHJpbnRBbm5vdGF0aW9uKGFubm90YXRpb25HbG9iYWxzLCB4cmVmLCBhbm5vdGF0aW9uLCB7CiAgICAgICAgICAgICAgZXZhbHVhdG9yT3B0aW9uczogb3B0aW9ucwogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEFubm90YXRpb25FZGl0b3JUeXBlLklOSzoKICAgICAgICAgIHByb21pc2VzLnB1c2goSW5rQW5ub3RhdGlvbi5jcmVhdGVOZXdQcmludEFubm90YXRpb24oYW5ub3RhdGlvbkdsb2JhbHMsIHhyZWYsIGFubm90YXRpb24sIHsKICAgICAgICAgICAgZXZhbHVhdG9yT3B0aW9uczogb3B0aW9ucwogICAgICAgICAgfSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5TVEFNUDoKICAgICAgICAgIGNvbnN0IGltYWdlID0gb3B0aW9ucy5pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCA/IGF3YWl0IGltYWdlUHJvbWlzZXM/LmdldChhbm5vdGF0aW9uLmJpdG1hcElkKSA6IG51bGw7CiAgICAgICAgICBpZiAoaW1hZ2U/LmltYWdlU3RyZWFtKSB7CiAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICBpbWFnZVN0cmVhbSwKICAgICAgICAgICAgICBzbWFza1N0cmVhbQogICAgICAgICAgICB9ID0gaW1hZ2U7CiAgICAgICAgICAgIGlmIChzbWFza1N0cmVhbSkgewogICAgICAgICAgICAgIGltYWdlU3RyZWFtLmRpY3Quc2V0KCJTTWFzayIsIHNtYXNrU3RyZWFtKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbWFnZS5pbWFnZVJlZiA9IG5ldyBKcGVnU3RyZWFtKGltYWdlU3RyZWFtLCBpbWFnZVN0cmVhbS5sZW5ndGgpOwogICAgICAgICAgICBpbWFnZS5pbWFnZVN0cmVhbSA9IGltYWdlLnNtYXNrU3RyZWFtID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHByb21pc2VzLnB1c2goU3RhbXBBbm5vdGF0aW9uLmNyZWF0ZU5ld1ByaW50QW5ub3RhdGlvbihhbm5vdGF0aW9uR2xvYmFscywgeHJlZiwgYW5ub3RhdGlvbiwgewogICAgICAgICAgICBpbWFnZSwKICAgICAgICAgICAgZXZhbHVhdG9yT3B0aW9uczogb3B0aW9ucwogICAgICAgICAgfSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBBbm5vdGF0aW9uRWRpdG9yVHlwZS5TSUdOQVRVUkU6CiAgICAgICAgICBwcm9taXNlcy5wdXNoKFN0YW1wQW5ub3RhdGlvbi5jcmVhdGVOZXdQcmludEFubm90YXRpb24oYW5ub3RhdGlvbkdsb2JhbHMsIHhyZWYsIGFubm90YXRpb24sIHsKICAgICAgICAgICAgZXZhbHVhdG9yT3B0aW9uczogb3B0aW9ucwogICAgICAgICAgfSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcyk7CiAgfQp9CmZ1bmN0aW9uIGdldFJnYkNvbG9yKGNvbG9yLCBkZWZhdWx0Q29sb3IgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoMykpIHsKICBpZiAoIUFycmF5LmlzQXJyYXkoY29sb3IpKSB7CiAgICByZXR1cm4gZGVmYXVsdENvbG9yOwogIH0KICBjb25zdCByZ2JDb2xvciA9IGRlZmF1bHRDb2xvciB8fCBuZXcgVWludDhDbGFtcGVkQXJyYXkoMyk7CiAgc3dpdGNoIChjb2xvci5sZW5ndGgpIHsKICAgIGNhc2UgMDoKICAgICAgcmV0dXJuIG51bGw7CiAgICBjYXNlIDE6CiAgICAgIENvbG9yU3BhY2VVdGlscy5ncmF5LmdldFJnYkl0ZW0oY29sb3IsIDAsIHJnYkNvbG9yLCAwKTsKICAgICAgcmV0dXJuIHJnYkNvbG9yOwogICAgY2FzZSAzOgogICAgICBDb2xvclNwYWNlVXRpbHMucmdiLmdldFJnYkl0ZW0oY29sb3IsIDAsIHJnYkNvbG9yLCAwKTsKICAgICAgcmV0dXJuIHJnYkNvbG9yOwogICAgY2FzZSA0OgogICAgICBDb2xvclNwYWNlVXRpbHMuY215ay5nZXRSZ2JJdGVtKGNvbG9yLCAwLCByZ2JDb2xvciwgMCk7CiAgICAgIHJldHVybiByZ2JDb2xvcjsKICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiBkZWZhdWx0Q29sb3I7CiAgfQp9CmZ1bmN0aW9uIGdldFBkZkNvbG9yQXJyYXkoY29sb3IsIGRlZmF1bHRWYWx1ZSA9IG51bGwpIHsKICByZXR1cm4gY29sb3IgJiYgQXJyYXkuZnJvbShjb2xvciwgYyA9PiBjIC8gMjU1KSB8fCBkZWZhdWx0VmFsdWU7Cn0KZnVuY3Rpb24gZ2V0UXVhZFBvaW50cyhkaWN0LCByZWN0KSB7CiAgY29uc3QgcXVhZFBvaW50cyA9IGRpY3QuZ2V0QXJyYXkoIlF1YWRQb2ludHMiKTsKICBpZiAoIWlzTnVtYmVyQXJyYXkocXVhZFBvaW50cywgbnVsbCkgfHwgcXVhZFBvaW50cy5sZW5ndGggPT09IDAgfHwgcXVhZFBvaW50cy5sZW5ndGggJSA4ID4gMCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IG5ld1F1YWRQb2ludHMgPSBuZXcgRmxvYXQzMkFycmF5KHF1YWRQb2ludHMubGVuZ3RoKTsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBxdWFkUG9pbnRzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDgpIHsKICAgIGNvbnN0IFt4MSwgeTEsIHgyLCB5MiwgeDMsIHkzLCB4NCwgeTRdID0gcXVhZFBvaW50cy5zbGljZShpLCBpICsgOCk7CiAgICBjb25zdCBtaW5YID0gTWF0aC5taW4oeDEsIHgyLCB4MywgeDQpOwogICAgY29uc3QgbWF4WCA9IE1hdGgubWF4KHgxLCB4MiwgeDMsIHg0KTsKICAgIGNvbnN0IG1pblkgPSBNYXRoLm1pbih5MSwgeTIsIHkzLCB5NCk7CiAgICBjb25zdCBtYXhZID0gTWF0aC5tYXgoeTEsIHkyLCB5MywgeTQpOwogICAgaWYgKHJlY3QgIT09IG51bGwgJiYgKG1pblggPCByZWN0WzBdIHx8IG1heFggPiByZWN0WzJdIHx8IG1pblkgPCByZWN0WzFdIHx8IG1heFkgPiByZWN0WzNdKSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIG5ld1F1YWRQb2ludHMuc2V0KFttaW5YLCBtYXhZLCBtYXhYLCBtYXhZLCBtaW5YLCBtaW5ZLCBtYXhYLCBtaW5ZXSwgaSk7CiAgfQogIHJldHVybiBuZXdRdWFkUG9pbnRzOwp9CmZ1bmN0aW9uIGdldFRyYW5zZm9ybU1hdHJpeChyZWN0LCBiYm94LCBtYXRyaXgpIHsKICBjb25zdCBtaW5NYXggPSBuZXcgRmxvYXQzMkFycmF5KFtJbmZpbml0eSwgSW5maW5pdHksIC1JbmZpbml0eSwgLUluZmluaXR5XSk7CiAgVXRpbC5heGlhbEFsaWduZWRCb3VuZGluZ0JveChiYm94LCBtYXRyaXgsIG1pbk1heCk7CiAgY29uc3QgW21pblgsIG1pblksIG1heFgsIG1heFldID0gbWluTWF4OwogIGlmIChtaW5YID09PSBtYXhYIHx8IG1pblkgPT09IG1heFkpIHsKICAgIHJldHVybiBbMSwgMCwgMCwgMSwgcmVjdFswXSwgcmVjdFsxXV07CiAgfQogIGNvbnN0IHhSYXRpbyA9IChyZWN0WzJdIC0gcmVjdFswXSkgLyAobWF4WCAtIG1pblgpOwogIGNvbnN0IHlSYXRpbyA9IChyZWN0WzNdIC0gcmVjdFsxXSkgLyAobWF4WSAtIG1pblkpOwogIHJldHVybiBbeFJhdGlvLCAwLCAwLCB5UmF0aW8sIHJlY3RbMF0gLSBtaW5YICogeFJhdGlvLCByZWN0WzFdIC0gbWluWSAqIHlSYXRpb107Cn0KY2xhc3MgQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYsCiAgICAgIGFubm90YXRpb25HbG9iYWxzLAogICAgICByZWYsCiAgICAgIG9ycGhhbkZpZWxkcwogICAgfSA9IHBhcmFtczsKICAgIGNvbnN0IHBhcmVudFJlZiA9IG9ycGhhbkZpZWxkcz8uZ2V0KHJlZik7CiAgICBpZiAocGFyZW50UmVmKSB7CiAgICAgIGRpY3Quc2V0KCJQYXJlbnQiLCBwYXJlbnRSZWYpOwogICAgfQogICAgdGhpcy5zZXRUaXRsZShkaWN0LmdldCgiVCIpKTsKICAgIHRoaXMuc2V0Q29udGVudHMoZGljdC5nZXQoIkNvbnRlbnRzIikpOwogICAgdGhpcy5zZXRNb2RpZmljYXRpb25EYXRlKGRpY3QuZ2V0KCJNIikpOwogICAgdGhpcy5zZXRGbGFncyhkaWN0LmdldCgiRiIpKTsKICAgIHRoaXMuc2V0UmVjdGFuZ2xlKGRpY3QuZ2V0QXJyYXkoIlJlY3QiKSk7CiAgICB0aGlzLnNldENvbG9yKGRpY3QuZ2V0QXJyYXkoIkMiKSk7CiAgICB0aGlzLnNldEJvcmRlclN0eWxlKGRpY3QpOwogICAgdGhpcy5zZXRBcHBlYXJhbmNlKGRpY3QpOwogICAgdGhpcy5zZXRPcHRpb25hbENvbnRlbnQoZGljdCk7CiAgICBjb25zdCBNSyA9IGRpY3QuZ2V0KCJNSyIpOwogICAgdGhpcy5zZXRCb3JkZXJBbmRCYWNrZ3JvdW5kQ29sb3JzKE1LKTsKICAgIHRoaXMuc2V0Um90YXRpb24oTUssIGRpY3QpOwogICAgdGhpcy5yZWYgPSBwYXJhbXMucmVmIGluc3RhbmNlb2YgUmVmID8gcGFyYW1zLnJlZiA6IG51bGw7CiAgICB0aGlzLl9zdHJlYW1zID0gW107CiAgICBpZiAodGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgIHRoaXMuX3N0cmVhbXMucHVzaCh0aGlzLmFwcGVhcmFuY2UpOwogICAgfQogICAgY29uc3QgaXNMb2NrZWQgPSAhISh0aGlzLmZsYWdzICYgQW5ub3RhdGlvbkZsYWcuTE9DS0VEKTsKICAgIGNvbnN0IGlzQ29udGVudExvY2tlZCA9ICEhKHRoaXMuZmxhZ3MgJiBBbm5vdGF0aW9uRmxhZy5MT0NLRURDT05URU5UUyk7CiAgICB0aGlzLmRhdGEgPSB7CiAgICAgIGFubm90YXRpb25GbGFnczogdGhpcy5mbGFncywKICAgICAgYm9yZGVyU3R5bGU6IHRoaXMuYm9yZGVyU3R5bGUsCiAgICAgIGNvbG9yOiB0aGlzLmNvbG9yLAogICAgICBiYWNrZ3JvdW5kQ29sb3I6IHRoaXMuYmFja2dyb3VuZENvbG9yLAogICAgICBib3JkZXJDb2xvcjogdGhpcy5ib3JkZXJDb2xvciwKICAgICAgcm90YXRpb246IHRoaXMucm90YXRpb24sCiAgICAgIGNvbnRlbnRzT2JqOiB0aGlzLl9jb250ZW50cywKICAgICAgaGFzQXBwZWFyYW5jZTogISF0aGlzLmFwcGVhcmFuY2UsCiAgICAgIGlkOiBwYXJhbXMuaWQsCiAgICAgIG1vZGlmaWNhdGlvbkRhdGU6IHRoaXMubW9kaWZpY2F0aW9uRGF0ZSwKICAgICAgcmVjdDogdGhpcy5yZWN0YW5nbGUsCiAgICAgIHN1YnR5cGU6IHBhcmFtcy5zdWJ0eXBlLAogICAgICBoYXNPd25DYW52YXM6IGZhbHNlLAogICAgICBub1JvdGF0ZTogISEodGhpcy5mbGFncyAmIEFubm90YXRpb25GbGFnLk5PUk9UQVRFKSwKICAgICAgbm9IVE1MOiBpc0xvY2tlZCAmJiBpc0NvbnRlbnRMb2NrZWQsCiAgICAgIGlzRWRpdGFibGU6IGZhbHNlLAogICAgICBzdHJ1Y3RQYXJlbnQ6IC0xCiAgICB9OwogICAgaWYgKGFubm90YXRpb25HbG9iYWxzLnN0cnVjdFRyZWVSb290KSB7CiAgICAgIGxldCBzdHJ1Y3RQYXJlbnQgPSBkaWN0LmdldCgiU3RydWN0UGFyZW50Iik7CiAgICAgIHRoaXMuZGF0YS5zdHJ1Y3RQYXJlbnQgPSBzdHJ1Y3RQYXJlbnQgPSBOdW1iZXIuaXNJbnRlZ2VyKHN0cnVjdFBhcmVudCkgJiYgc3RydWN0UGFyZW50ID49IDAgPyBzdHJ1Y3RQYXJlbnQgOiAtMTsKICAgICAgYW5ub3RhdGlvbkdsb2JhbHMuc3RydWN0VHJlZVJvb3QuYWRkQW5ub3RhdGlvbklkVG9QYWdlKHBhcmFtcy5wYWdlUmVmLCBzdHJ1Y3RQYXJlbnQpOwogICAgfQogICAgaWYgKHBhcmFtcy5jb2xsZWN0RmllbGRzKSB7CiAgICAgIGNvbnN0IGtpZHMgPSBkaWN0LmdldCgiS2lkcyIpOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShraWRzKSkgewogICAgICAgIGNvbnN0IGtpZElkcyA9IFtdOwogICAgICAgIGZvciAoY29uc3Qga2lkIG9mIGtpZHMpIHsKICAgICAgICAgIGlmIChraWQgaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgICAgICAga2lkSWRzLnB1c2goa2lkLnRvU3RyaW5nKCkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoa2lkSWRzLmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgdGhpcy5kYXRhLmtpZElkcyA9IGtpZElkczsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5kYXRhLmFjdGlvbnMgPSBjb2xsZWN0QWN0aW9ucyh4cmVmLCBkaWN0LCBBbm5vdGF0aW9uQWN0aW9uRXZlbnRUeXBlKTsKICAgICAgdGhpcy5kYXRhLmZpZWxkTmFtZSA9IHRoaXMuX2NvbnN0cnVjdEZpZWxkTmFtZShkaWN0KTsKICAgICAgdGhpcy5kYXRhLnBhZ2VJbmRleCA9IHBhcmFtcy5wYWdlSW5kZXg7CiAgICB9CiAgICBjb25zdCBpdCA9IGRpY3QuZ2V0KCJJVCIpOwogICAgaWYgKGl0IGluc3RhbmNlb2YgTmFtZSkgewogICAgICB0aGlzLmRhdGEuaXQgPSBpdC5uYW1lOwogICAgfQogICAgdGhpcy5faXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgPSBwYXJhbXMuZXZhbHVhdG9yT3B0aW9ucy5pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZDsKICAgIHRoaXMuX2ZhbGxiYWNrRm9udERpY3QgPSBudWxsOwogICAgdGhpcy5fbmVlZEFwcGVhcmFuY2VzID0gZmFsc2U7CiAgfQogIF9oYXNGbGFnKGZsYWdzLCBmbGFnKSB7CiAgICByZXR1cm4gISEoZmxhZ3MgJiBmbGFnKTsKICB9CiAgX2J1aWxkRmxhZ3Mobm9WaWV3LCBub1ByaW50KSB7CiAgICBsZXQgewogICAgICBmbGFncwogICAgfSA9IHRoaXM7CiAgICBpZiAobm9WaWV3ID09PSB1bmRlZmluZWQpIHsKICAgICAgaWYgKG5vUHJpbnQgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgaWYgKG5vUHJpbnQpIHsKICAgICAgICByZXR1cm4gZmxhZ3MgJiB+QW5ub3RhdGlvbkZsYWcuUFJJTlQ7CiAgICAgIH0KICAgICAgcmV0dXJuIGZsYWdzICYgfkFubm90YXRpb25GbGFnLkhJRERFTiB8IEFubm90YXRpb25GbGFnLlBSSU5UOwogICAgfQogICAgaWYgKG5vVmlldykgewogICAgICBmbGFncyB8PSBBbm5vdGF0aW9uRmxhZy5QUklOVDsKICAgICAgaWYgKG5vUHJpbnQpIHsKICAgICAgICByZXR1cm4gZmxhZ3MgJiB+QW5ub3RhdGlvbkZsYWcuTk9WSUVXIHwgQW5ub3RhdGlvbkZsYWcuSElEREVOOwogICAgICB9CiAgICAgIHJldHVybiBmbGFncyAmIH5Bbm5vdGF0aW9uRmxhZy5ISURERU4gfCBBbm5vdGF0aW9uRmxhZy5OT1ZJRVc7CiAgICB9CiAgICBmbGFncyAmPSB+KEFubm90YXRpb25GbGFnLkhJRERFTiB8IEFubm90YXRpb25GbGFnLk5PVklFVyk7CiAgICBpZiAobm9QcmludCkgewogICAgICByZXR1cm4gZmxhZ3MgJiB+QW5ub3RhdGlvbkZsYWcuUFJJTlQ7CiAgICB9CiAgICByZXR1cm4gZmxhZ3MgfCBBbm5vdGF0aW9uRmxhZy5QUklOVDsKICB9CiAgX2lzVmlld2FibGUoZmxhZ3MpIHsKICAgIHJldHVybiAhdGhpcy5faGFzRmxhZyhmbGFncywgQW5ub3RhdGlvbkZsYWcuSU5WSVNJQkxFKSAmJiAhdGhpcy5faGFzRmxhZyhmbGFncywgQW5ub3RhdGlvbkZsYWcuTk9WSUVXKTsKICB9CiAgX2lzUHJpbnRhYmxlKGZsYWdzKSB7CiAgICByZXR1cm4gdGhpcy5faGFzRmxhZyhmbGFncywgQW5ub3RhdGlvbkZsYWcuUFJJTlQpICYmICF0aGlzLl9oYXNGbGFnKGZsYWdzLCBBbm5vdGF0aW9uRmxhZy5ISURERU4pICYmICF0aGlzLl9oYXNGbGFnKGZsYWdzLCBBbm5vdGF0aW9uRmxhZy5JTlZJU0lCTEUpOwogIH0KICBtdXN0QmVWaWV3ZWQoYW5ub3RhdGlvblN0b3JhZ2UsIF9yZW5kZXJGb3JtcykgewogICAgY29uc3Qgbm9WaWV3ID0gYW5ub3RhdGlvblN0b3JhZ2U/LmdldCh0aGlzLmRhdGEuaWQpPy5ub1ZpZXc7CiAgICBpZiAobm9WaWV3ICE9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuICFub1ZpZXc7CiAgICB9CiAgICByZXR1cm4gdGhpcy52aWV3YWJsZSAmJiAhdGhpcy5faGFzRmxhZyh0aGlzLmZsYWdzLCBBbm5vdGF0aW9uRmxhZy5ISURERU4pOwogIH0KICBtdXN0QmVQcmludGVkKGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBjb25zdCBub1ByaW50ID0gYW5ub3RhdGlvblN0b3JhZ2U/LmdldCh0aGlzLmRhdGEuaWQpPy5ub1ByaW50OwogICAgaWYgKG5vUHJpbnQgIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gIW5vUHJpbnQ7CiAgICB9CiAgICByZXR1cm4gdGhpcy5wcmludGFibGU7CiAgfQogIG11c3RCZVZpZXdlZFdoZW5FZGl0aW5nKGlzRWRpdGluZywgbW9kaWZpZWRJZHMgPSBudWxsKSB7CiAgICByZXR1cm4gaXNFZGl0aW5nID8gIXRoaXMuZGF0YS5pc0VkaXRhYmxlIDogIW1vZGlmaWVkSWRzPy5oYXModGhpcy5kYXRhLmlkKTsKICB9CiAgZ2V0IHZpZXdhYmxlKCkgewogICAgaWYgKHRoaXMuZGF0YS5xdWFkUG9pbnRzID09PSBudWxsKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzLmZsYWdzID09PSAwKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIHRoaXMuX2lzVmlld2FibGUodGhpcy5mbGFncyk7CiAgfQogIGdldCBwcmludGFibGUoKSB7CiAgICBpZiAodGhpcy5kYXRhLnF1YWRQb2ludHMgPT09IG51bGwpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHRoaXMuZmxhZ3MgPT09IDApIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRoaXMuX2lzUHJpbnRhYmxlKHRoaXMuZmxhZ3MpOwogIH0KICBfcGFyc2VTdHJpbmdIZWxwZXIoZGF0YSkgewogICAgY29uc3Qgc3RyID0gdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciID8gc3RyaW5nVG9QREZTdHJpbmcoZGF0YSkgOiAiIjsKICAgIGNvbnN0IGRpciA9IHN0ciAmJiBiaWRpKHN0cikuZGlyID09PSAicnRsIiA/ICJydGwiIDogImx0ciI7CiAgICByZXR1cm4gewogICAgICBzdHIsCiAgICAgIGRpcgogICAgfTsKICB9CiAgc2V0RGVmYXVsdEFwcGVhcmFuY2UocGFyYW1zKSB7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIGFubm90YXRpb25HbG9iYWxzCiAgICB9ID0gcGFyYW1zOwogICAgY29uc3QgZGVmYXVsdEFwcGVhcmFuY2UgPSBnZXRJbmhlcml0YWJsZVByb3BlcnR5KHsKICAgICAgZGljdCwKICAgICAga2V5OiAiREEiCiAgICB9KSB8fCBhbm5vdGF0aW9uR2xvYmFscy5hY3JvRm9ybS5nZXQoIkRBIik7CiAgICB0aGlzLl9kZWZhdWx0QXBwZWFyYW5jZSA9IHR5cGVvZiBkZWZhdWx0QXBwZWFyYW5jZSA9PT0gInN0cmluZyIgPyBkZWZhdWx0QXBwZWFyYW5jZSA6ICIiOwogICAgdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YSA9IHBhcnNlRGVmYXVsdEFwcGVhcmFuY2UodGhpcy5fZGVmYXVsdEFwcGVhcmFuY2UpOwogIH0KICBzZXRUaXRsZSh0aXRsZSkgewogICAgdGhpcy5fdGl0bGUgPSB0aGlzLl9wYXJzZVN0cmluZ0hlbHBlcih0aXRsZSk7CiAgfQogIHNldENvbnRlbnRzKGNvbnRlbnRzKSB7CiAgICB0aGlzLl9jb250ZW50cyA9IHRoaXMuX3BhcnNlU3RyaW5nSGVscGVyKGNvbnRlbnRzKTsKICB9CiAgc2V0TW9kaWZpY2F0aW9uRGF0ZShtb2RpZmljYXRpb25EYXRlKSB7CiAgICB0aGlzLm1vZGlmaWNhdGlvbkRhdGUgPSB0eXBlb2YgbW9kaWZpY2F0aW9uRGF0ZSA9PT0gInN0cmluZyIgPyBtb2RpZmljYXRpb25EYXRlIDogbnVsbDsKICB9CiAgc2V0RmxhZ3MoZmxhZ3MpIHsKICAgIHRoaXMuZmxhZ3MgPSBOdW1iZXIuaXNJbnRlZ2VyKGZsYWdzKSAmJiBmbGFncyA+IDAgPyBmbGFncyA6IDA7CiAgICBpZiAodGhpcy5mbGFncyAmIEFubm90YXRpb25GbGFnLklOVklTSUJMRSAmJiB0aGlzLmNvbnN0cnVjdG9yLm5hbWUgIT09ICJBbm5vdGF0aW9uIikgewogICAgICB0aGlzLmZsYWdzIF49IEFubm90YXRpb25GbGFnLklOVklTSUJMRTsKICAgIH0KICB9CiAgaGFzRmxhZyhmbGFnKSB7CiAgICByZXR1cm4gdGhpcy5faGFzRmxhZyh0aGlzLmZsYWdzLCBmbGFnKTsKICB9CiAgc2V0UmVjdGFuZ2xlKHJlY3RhbmdsZSkgewogICAgdGhpcy5yZWN0YW5nbGUgPSBsb29rdXBOb3JtYWxSZWN0KHJlY3RhbmdsZSwgWzAsIDAsIDAsIDBdKTsKICB9CiAgc2V0Q29sb3IoY29sb3IpIHsKICAgIHRoaXMuY29sb3IgPSBnZXRSZ2JDb2xvcihjb2xvcik7CiAgfQogIHNldExpbmVFbmRpbmdzKGxpbmVFbmRpbmdzKSB7CiAgICB0aGlzLmxpbmVFbmRpbmdzID0gWyJOb25lIiwgIk5vbmUiXTsKICAgIGlmIChBcnJheS5pc0FycmF5KGxpbmVFbmRpbmdzKSAmJiBsaW5lRW5kaW5ncy5sZW5ndGggPT09IDIpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyOyBpKyspIHsKICAgICAgICBjb25zdCBvYmogPSBsaW5lRW5kaW5nc1tpXTsKICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgc3dpdGNoIChvYmoubmFtZSkgewogICAgICAgICAgICBjYXNlICJOb25lIjoKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY2FzZSAiU3F1YXJlIjoKICAgICAgICAgICAgY2FzZSAiQ2lyY2xlIjoKICAgICAgICAgICAgY2FzZSAiRGlhbW9uZCI6CiAgICAgICAgICAgIGNhc2UgIk9wZW5BcnJvdyI6CiAgICAgICAgICAgIGNhc2UgIkNsb3NlZEFycm93IjoKICAgICAgICAgICAgY2FzZSAiQnV0dCI6CiAgICAgICAgICAgIGNhc2UgIlJPcGVuQXJyb3ciOgogICAgICAgICAgICBjYXNlICJSQ2xvc2VkQXJyb3ciOgogICAgICAgICAgICBjYXNlICJTbGFzaCI6CiAgICAgICAgICAgICAgdGhpcy5saW5lRW5kaW5nc1tpXSA9IG9iai5uYW1lOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB3YXJuKGBJZ25vcmluZyBpbnZhbGlkIGxpbmVFbmRpbmc6ICR7b2JqfWApOwogICAgICB9CiAgICB9CiAgfQogIHNldFJvdGF0aW9uKG1rLCBkaWN0KSB7CiAgICB0aGlzLnJvdGF0aW9uID0gMDsKICAgIGxldCBhbmdsZSA9IG1rIGluc3RhbmNlb2YgRGljdCA/IG1rLmdldCgiUiIpIHx8IDAgOiBkaWN0LmdldCgiUm90YXRlIikgfHwgMDsKICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGFuZ2xlKSAmJiBhbmdsZSAhPT0gMCkgewogICAgICBhbmdsZSAlPSAzNjA7CiAgICAgIGlmIChhbmdsZSA8IDApIHsKICAgICAgICBhbmdsZSArPSAzNjA7CiAgICAgIH0KICAgICAgaWYgKGFuZ2xlICUgOTAgPT09IDApIHsKICAgICAgICB0aGlzLnJvdGF0aW9uID0gYW5nbGU7CiAgICAgIH0KICAgIH0KICB9CiAgc2V0Qm9yZGVyQW5kQmFja2dyb3VuZENvbG9ycyhtaykgewogICAgaWYgKG1rIGluc3RhbmNlb2YgRGljdCkgewogICAgICB0aGlzLmJvcmRlckNvbG9yID0gZ2V0UmdiQ29sb3IobWsuZ2V0QXJyYXkoIkJDIiksIG51bGwpOwogICAgICB0aGlzLmJhY2tncm91bmRDb2xvciA9IGdldFJnYkNvbG9yKG1rLmdldEFycmF5KCJCRyIpLCBudWxsKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuYm9yZGVyQ29sb3IgPSB0aGlzLmJhY2tncm91bmRDb2xvciA9IG51bGw7CiAgICB9CiAgfQogIHNldEJvcmRlclN0eWxlKGJvcmRlclN0eWxlKSB7CiAgICB0aGlzLmJvcmRlclN0eWxlID0gbmV3IEFubm90YXRpb25Cb3JkZXJTdHlsZSgpOwogICAgaWYgKCEoYm9yZGVyU3R5bGUgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoYm9yZGVyU3R5bGUuaGFzKCJCUyIpKSB7CiAgICAgIGNvbnN0IGRpY3QgPSBib3JkZXJTdHlsZS5nZXQoIkJTIik7CiAgICAgIGlmIChkaWN0IGluc3RhbmNlb2YgRGljdCkgewogICAgICAgIGNvbnN0IGRpY3RUeXBlID0gZGljdC5nZXQoIlR5cGUiKTsKICAgICAgICBpZiAoIWRpY3RUeXBlIHx8IGlzTmFtZShkaWN0VHlwZSwgIkJvcmRlciIpKSB7CiAgICAgICAgICB0aGlzLmJvcmRlclN0eWxlLnNldFdpZHRoKGRpY3QuZ2V0KCJXIiksIHRoaXMucmVjdGFuZ2xlKTsKICAgICAgICAgIHRoaXMuYm9yZGVyU3R5bGUuc2V0U3R5bGUoZGljdC5nZXQoIlMiKSk7CiAgICAgICAgICB0aGlzLmJvcmRlclN0eWxlLnNldERhc2hBcnJheShkaWN0LmdldEFycmF5KCJEIikpOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmIChib3JkZXJTdHlsZS5oYXMoIkJvcmRlciIpKSB7CiAgICAgIGNvbnN0IGFycmF5ID0gYm9yZGVyU3R5bGUuZ2V0QXJyYXkoIkJvcmRlciIpOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShhcnJheSkgJiYgYXJyYXkubGVuZ3RoID49IDMpIHsKICAgICAgICB0aGlzLmJvcmRlclN0eWxlLnNldEhvcml6b250YWxDb3JuZXJSYWRpdXMoYXJyYXlbMF0pOwogICAgICAgIHRoaXMuYm9yZGVyU3R5bGUuc2V0VmVydGljYWxDb3JuZXJSYWRpdXMoYXJyYXlbMV0pOwogICAgICAgIHRoaXMuYm9yZGVyU3R5bGUuc2V0V2lkdGgoYXJyYXlbMl0sIHRoaXMucmVjdGFuZ2xlKTsKICAgICAgICBpZiAoYXJyYXkubGVuZ3RoID09PSA0KSB7CiAgICAgICAgICB0aGlzLmJvcmRlclN0eWxlLnNldERhc2hBcnJheShhcnJheVszXSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmJvcmRlclN0eWxlLnNldFdpZHRoKDApOwogICAgfQogIH0KICBzZXRBcHBlYXJhbmNlKGRpY3QpIHsKICAgIHRoaXMuYXBwZWFyYW5jZSA9IG51bGw7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RhdGVzID0gZGljdC5nZXQoIkFQIik7CiAgICBpZiAoIShhcHBlYXJhbmNlU3RhdGVzIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgbm9ybWFsQXBwZWFyYW5jZVN0YXRlID0gYXBwZWFyYW5jZVN0YXRlcy5nZXQoIk4iKTsKICAgIGlmIChub3JtYWxBcHBlYXJhbmNlU3RhdGUgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgIHRoaXMuYXBwZWFyYW5jZSA9IG5vcm1hbEFwcGVhcmFuY2VTdGF0ZTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCEobm9ybWFsQXBwZWFyYW5jZVN0YXRlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgYXMgPSBkaWN0LmdldCgiQVMiKTsKICAgIGlmICghKGFzIGluc3RhbmNlb2YgTmFtZSkgfHwgIW5vcm1hbEFwcGVhcmFuY2VTdGF0ZS5oYXMoYXMubmFtZSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgYXBwZWFyYW5jZSA9IG5vcm1hbEFwcGVhcmFuY2VTdGF0ZS5nZXQoYXMubmFtZSk7CiAgICBpZiAoYXBwZWFyYW5jZSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgICAgdGhpcy5hcHBlYXJhbmNlID0gYXBwZWFyYW5jZTsKICAgIH0KICB9CiAgc2V0T3B0aW9uYWxDb250ZW50KGRpY3QpIHsKICAgIHRoaXMub2MgPSBudWxsOwogICAgY29uc3Qgb2MgPSBkaWN0LmdldCgiT0MiKTsKICAgIGlmIChvYyBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgd2Fybigic2V0T3B0aW9uYWxDb250ZW50OiBTdXBwb3J0IGZvciAvTmFtZS1lbnRyeSBpcyBub3QgaW1wbGVtZW50ZWQuIik7CiAgICB9IGVsc2UgaWYgKG9jIGluc3RhbmNlb2YgRGljdCkgewogICAgICB0aGlzLm9jID0gb2M7CiAgICB9CiAgfQogIGFzeW5jIGxvYWRSZXNvdXJjZXMoa2V5cywgYXBwZWFyYW5jZSkgewogICAgY29uc3QgcmVzb3VyY2VzID0gYXdhaXQgYXBwZWFyYW5jZS5kaWN0LmdldEFzeW5jKCJSZXNvdXJjZXMiKTsKICAgIGlmIChyZXNvdXJjZXMpIHsKICAgICAgYXdhaXQgT2JqZWN0TG9hZGVyLmxvYWQocmVzb3VyY2VzLCBrZXlzLCByZXNvdXJjZXMueHJlZik7CiAgICB9CiAgICByZXR1cm4gcmVzb3VyY2VzOwogIH0KICBhc3luYyBnZXRPcGVyYXRvckxpc3QoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBjb25zdCB7CiAgICAgIGhhc093bkNhbnZhcywKICAgICAgaWQsCiAgICAgIHJlY3QKICAgIH0gPSB0aGlzLmRhdGE7CiAgICBsZXQgYXBwZWFyYW5jZSA9IHRoaXMuYXBwZWFyYW5jZTsKICAgIGNvbnN0IGlzVXNpbmdPd25DYW52YXMgPSAhIShoYXNPd25DYW52YXMgJiYgaW50ZW50ICYgUmVuZGVyaW5nSW50ZW50RmxhZy5ESVNQTEFZKTsKICAgIGlmIChpc1VzaW5nT3duQ2FudmFzICYmICh0aGlzLndpZHRoID09PSAwIHx8IHRoaXMuaGVpZ2h0ID09PSAwKSkgewogICAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gZmFsc2U7CiAgICAgIHJldHVybiB7CiAgICAgICAgb3BMaXN0OiBuZXcgT3BlcmF0b3JMaXN0KCksCiAgICAgICAgc2VwYXJhdGVGb3JtOiBmYWxzZSwKICAgICAgICBzZXBhcmF0ZUNhbnZhczogZmFsc2UKICAgICAgfTsKICAgIH0KICAgIGlmICghYXBwZWFyYW5jZSkgewogICAgICBpZiAoIWlzVXNpbmdPd25DYW52YXMpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgb3BMaXN0OiBuZXcgT3BlcmF0b3JMaXN0KCksCiAgICAgICAgICBzZXBhcmF0ZUZvcm06IGZhbHNlLAogICAgICAgICAgc2VwYXJhdGVDYW52YXM6IGZhbHNlCiAgICAgICAgfTsKICAgICAgfQogICAgICBhcHBlYXJhbmNlID0gbmV3IFN0cmluZ1N0cmVhbSgiIik7CiAgICAgIGFwcGVhcmFuY2UuZGljdCA9IG5ldyBEaWN0KCk7CiAgICB9CiAgICBjb25zdCBhcHBlYXJhbmNlRGljdCA9IGFwcGVhcmFuY2UuZGljdDsKICAgIGNvbnN0IHJlc291cmNlcyA9IGF3YWl0IHRoaXMubG9hZFJlc291cmNlcyhSRVNPVVJDRVNfS0VZU19PUEVSQVRPUl9MSVNULCBhcHBlYXJhbmNlKTsKICAgIGNvbnN0IGJib3ggPSBsb29rdXBSZWN0KGFwcGVhcmFuY2VEaWN0LmdldEFycmF5KCJCQm94IiksIFswLCAwLCAxLCAxXSk7CiAgICBjb25zdCBtYXRyaXggPSBsb29rdXBNYXRyaXgoYXBwZWFyYW5jZURpY3QuZ2V0QXJyYXkoIk1hdHJpeCIpLCBJREVOVElUWV9NQVRSSVgpOwogICAgY29uc3QgdHJhbnNmb3JtID0gZ2V0VHJhbnNmb3JtTWF0cml4KHJlY3QsIGJib3gsIG1hdHJpeCk7CiAgICBjb25zdCBvcExpc3QgPSBuZXcgT3BlcmF0b3JMaXN0KCk7CiAgICBsZXQgb3B0aW9uYWxDb250ZW50OwogICAgaWYgKHRoaXMub2MpIHsKICAgICAgb3B0aW9uYWxDb250ZW50ID0gYXdhaXQgZXZhbHVhdG9yLnBhcnNlTWFya2VkQ29udGVudFByb3BzKHRoaXMub2MsIG51bGwpOwogICAgfQogICAgaWYgKG9wdGlvbmFsQ29udGVudCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIG9wTGlzdC5hZGRPcChPUFMuYmVnaW5NYXJrZWRDb250ZW50UHJvcHMsIFsiT0MiLCBvcHRpb25hbENvbnRlbnRdKTsKICAgIH0KICAgIG9wTGlzdC5hZGRPcChPUFMuYmVnaW5Bbm5vdGF0aW9uLCBbaWQsIHJlY3QsIHRyYW5zZm9ybSwgbWF0cml4LCBpc1VzaW5nT3duQ2FudmFzXSk7CiAgICBhd2FpdCBldmFsdWF0b3IuZ2V0T3BlcmF0b3JMaXN0KHsKICAgICAgc3RyZWFtOiBhcHBlYXJhbmNlLAogICAgICB0YXNrLAogICAgICByZXNvdXJjZXMsCiAgICAgIG9wZXJhdG9yTGlzdDogb3BMaXN0LAogICAgICBmYWxsYmFja0ZvbnREaWN0OiB0aGlzLl9mYWxsYmFja0ZvbnREaWN0CiAgICB9KTsKICAgIG9wTGlzdC5hZGRPcChPUFMuZW5kQW5ub3RhdGlvbiwgW10pOwogICAgaWYgKG9wdGlvbmFsQ29udGVudCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIG9wTGlzdC5hZGRPcChPUFMuZW5kTWFya2VkQ29udGVudCwgW10pOwogICAgfQogICAgdGhpcy5yZXNldCgpOwogICAgcmV0dXJuIHsKICAgICAgb3BMaXN0LAogICAgICBzZXBhcmF0ZUZvcm06IGZhbHNlLAogICAgICBzZXBhcmF0ZUNhbnZhczogaXNVc2luZ093bkNhbnZhcwogICAgfTsKICB9CiAgYXN5bmMgc2F2ZShldmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlLCBjaGFuZ2VzKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgZ2V0IG92ZXJsYXlzVGV4dENvbnRlbnQoKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGdldCBoYXNUZXh0Q29udGVudCgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgYXN5bmMgZXh0cmFjdFRleHRDb250ZW50KGV2YWx1YXRvciwgdGFzaywgdmlld0JveCkgewogICAgaWYgKCF0aGlzLmFwcGVhcmFuY2UpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcmVzb3VyY2VzID0gYXdhaXQgdGhpcy5sb2FkUmVzb3VyY2VzKFJFU09VUkNFU19LRVlTX1RFWFRfQ09OVEVOVCwgdGhpcy5hcHBlYXJhbmNlKTsKICAgIGNvbnN0IHRleHQgPSBbXTsKICAgIGNvbnN0IGJ1ZmZlciA9IFtdOwogICAgbGV0IGZpcnN0UG9zaXRpb24gPSBudWxsOwogICAgY29uc3Qgc2luayA9IHsKICAgICAgZGVzaXJlZFNpemU6IE1hdGguSW5maW5pdHksCiAgICAgIHJlYWR5OiB0cnVlLAogICAgICBlbnF1ZXVlKGNodW5rLCBzaXplKSB7CiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGNodW5rLml0ZW1zKSB7CiAgICAgICAgICBpZiAoaXRlbS5zdHIgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGZpcnN0UG9zaXRpb24gfHw9IGl0ZW0udHJhbnNmb3JtLnNsaWNlKC0yKTsKICAgICAgICAgIGJ1ZmZlci5wdXNoKGl0ZW0uc3RyKTsKICAgICAgICAgIGlmIChpdGVtLmhhc0VPTCkgewogICAgICAgICAgICB0ZXh0LnB1c2goYnVmZmVyLmpvaW4oIiIpLnRyaW1FbmQoKSk7CiAgICAgICAgICAgIGJ1ZmZlci5sZW5ndGggPSAwOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIGF3YWl0IGV2YWx1YXRvci5nZXRUZXh0Q29udGVudCh7CiAgICAgIHN0cmVhbTogdGhpcy5hcHBlYXJhbmNlLAogICAgICB0YXNrLAogICAgICByZXNvdXJjZXMsCiAgICAgIGluY2x1ZGVNYXJrZWRDb250ZW50OiB0cnVlLAogICAgICBrZWVwV2hpdGVTcGFjZTogdHJ1ZSwKICAgICAgc2luaywKICAgICAgdmlld0JveAogICAgfSk7CiAgICB0aGlzLnJlc2V0KCk7CiAgICBpZiAoYnVmZmVyLmxlbmd0aCkgewogICAgICB0ZXh0LnB1c2goYnVmZmVyLmpvaW4oIiIpLnRyaW1FbmQoKSk7CiAgICB9CiAgICBpZiAodGV4dC5sZW5ndGggPiAxIHx8IHRleHRbMF0pIHsKICAgICAgY29uc3QgYXBwZWFyYW5jZURpY3QgPSB0aGlzLmFwcGVhcmFuY2UuZGljdDsKICAgICAgY29uc3QgYmJveCA9IGxvb2t1cFJlY3QoYXBwZWFyYW5jZURpY3QuZ2V0QXJyYXkoIkJCb3giKSwgbnVsbCk7CiAgICAgIGNvbnN0IG1hdHJpeCA9IGxvb2t1cE1hdHJpeChhcHBlYXJhbmNlRGljdC5nZXRBcnJheSgiTWF0cml4IiksIG51bGwpOwogICAgICB0aGlzLmRhdGEudGV4dFBvc2l0aW9uID0gdGhpcy5fdHJhbnNmb3JtUG9pbnQoZmlyc3RQb3NpdGlvbiwgYmJveCwgbWF0cml4KTsKICAgICAgdGhpcy5kYXRhLnRleHRDb250ZW50ID0gdGV4dDsKICAgIH0KICB9CiAgX3RyYW5zZm9ybVBvaW50KGNvb3JkcywgYmJveCwgbWF0cml4KSB7CiAgICBjb25zdCB7CiAgICAgIHJlY3QKICAgIH0gPSB0aGlzLmRhdGE7CiAgICBiYm94IHx8PSBbMCwgMCwgMSwgMV07CiAgICBtYXRyaXggfHw9IFsxLCAwLCAwLCAxLCAwLCAwXTsKICAgIGNvbnN0IHRyYW5zZm9ybSA9IGdldFRyYW5zZm9ybU1hdHJpeChyZWN0LCBiYm94LCBtYXRyaXgpOwogICAgdHJhbnNmb3JtWzRdIC09IHJlY3RbMF07CiAgICB0cmFuc2Zvcm1bNV0gLT0gcmVjdFsxXTsKICAgIGNvbnN0IHAgPSBjb29yZHMuc2xpY2UoKTsKICAgIFV0aWwuYXBwbHlUcmFuc2Zvcm0ocCwgdHJhbnNmb3JtKTsKICAgIFV0aWwuYXBwbHlUcmFuc2Zvcm0ocCwgbWF0cml4KTsKICAgIHJldHVybiBwOwogIH0KICBnZXRGaWVsZE9iamVjdCgpIHsKICAgIGlmICh0aGlzLmRhdGEua2lkSWRzKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgaWQ6IHRoaXMuZGF0YS5pZCwKICAgICAgICBhY3Rpb25zOiB0aGlzLmRhdGEuYWN0aW9ucywKICAgICAgICBuYW1lOiB0aGlzLmRhdGEuZmllbGROYW1lLAogICAgICAgIHN0cm9rZUNvbG9yOiB0aGlzLmRhdGEuYm9yZGVyQ29sb3IsCiAgICAgICAgZmlsbENvbG9yOiB0aGlzLmRhdGEuYmFja2dyb3VuZENvbG9yLAogICAgICAgIHR5cGU6ICIiLAogICAgICAgIGtpZElkczogdGhpcy5kYXRhLmtpZElkcywKICAgICAgICBwYWdlOiB0aGlzLmRhdGEucGFnZUluZGV4LAogICAgICAgIHJvdGF0aW9uOiB0aGlzLnJvdGF0aW9uCiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgcmVzZXQoKSB7CiAgICBmb3IgKGNvbnN0IHN0cmVhbSBvZiB0aGlzLl9zdHJlYW1zKSB7CiAgICAgIHN0cmVhbS5yZXNldCgpOwogICAgfQogIH0KICBfY29uc3RydWN0RmllbGROYW1lKGRpY3QpIHsKICAgIGlmICghZGljdC5oYXMoIlQiKSAmJiAhZGljdC5oYXMoIlBhcmVudCIpKSB7CiAgICAgIHdhcm4oIlVua25vd24gZmllbGQgbmFtZSwgZmFsbGluZyBiYWNrIHRvIGVtcHR5IGZpZWxkIG5hbWUuIik7CiAgICAgIHJldHVybiAiIjsKICAgIH0KICAgIGlmICghZGljdC5oYXMoIlBhcmVudCIpKSB7CiAgICAgIHJldHVybiBzdHJpbmdUb1BERlN0cmluZyhkaWN0LmdldCgiVCIpKTsKICAgIH0KICAgIGNvbnN0IGZpZWxkTmFtZSA9IFtdOwogICAgaWYgKGRpY3QuaGFzKCJUIikpIHsKICAgICAgZmllbGROYW1lLnVuc2hpZnQoc3RyaW5nVG9QREZTdHJpbmcoZGljdC5nZXQoIlQiKSkpOwogICAgfQogICAgbGV0IGxvb3BEaWN0ID0gZGljdDsKICAgIGNvbnN0IHZpc2l0ZWQgPSBuZXcgUmVmU2V0KCk7CiAgICBpZiAoZGljdC5vYmpJZCkgewogICAgICB2aXNpdGVkLnB1dChkaWN0Lm9iaklkKTsKICAgIH0KICAgIHdoaWxlIChsb29wRGljdC5oYXMoIlBhcmVudCIpKSB7CiAgICAgIGxvb3BEaWN0ID0gbG9vcERpY3QuZ2V0KCJQYXJlbnQiKTsKICAgICAgaWYgKCEobG9vcERpY3QgaW5zdGFuY2VvZiBEaWN0KSB8fCBsb29wRGljdC5vYmpJZCAmJiB2aXNpdGVkLmhhcyhsb29wRGljdC5vYmpJZCkpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAobG9vcERpY3Qub2JqSWQpIHsKICAgICAgICB2aXNpdGVkLnB1dChsb29wRGljdC5vYmpJZCk7CiAgICAgIH0KICAgICAgaWYgKGxvb3BEaWN0LmhhcygiVCIpKSB7CiAgICAgICAgZmllbGROYW1lLnVuc2hpZnQoc3RyaW5nVG9QREZTdHJpbmcobG9vcERpY3QuZ2V0KCJUIikpKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGZpZWxkTmFtZS5qb2luKCIuIik7CiAgfQogIGdldCB3aWR0aCgpIHsKICAgIHJldHVybiB0aGlzLmRhdGEucmVjdFsyXSAtIHRoaXMuZGF0YS5yZWN0WzBdOwogIH0KICBnZXQgaGVpZ2h0KCkgewogICAgcmV0dXJuIHRoaXMuZGF0YS5yZWN0WzNdIC0gdGhpcy5kYXRhLnJlY3RbMV07CiAgfQp9CmNsYXNzIEFubm90YXRpb25Cb3JkZXJTdHlsZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLndpZHRoID0gMTsKICAgIHRoaXMucmF3V2lkdGggPSAxOwogICAgdGhpcy5zdHlsZSA9IEFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUuU09MSUQ7CiAgICB0aGlzLmRhc2hBcnJheSA9IFszXTsKICAgIHRoaXMuaG9yaXpvbnRhbENvcm5lclJhZGl1cyA9IDA7CiAgICB0aGlzLnZlcnRpY2FsQ29ybmVyUmFkaXVzID0gMDsKICB9CiAgc2V0V2lkdGgod2lkdGgsIHJlY3QgPSBbMCwgMCwgMCwgMF0pIHsKICAgIGlmICh3aWR0aCBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgdGhpcy53aWR0aCA9IDA7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0eXBlb2Ygd2lkdGggPT09ICJudW1iZXIiKSB7CiAgICAgIGlmICh3aWR0aCA+IDApIHsKICAgICAgICB0aGlzLnJhd1dpZHRoID0gd2lkdGg7CiAgICAgICAgY29uc3QgbWF4V2lkdGggPSAocmVjdFsyXSAtIHJlY3RbMF0pIC8gMjsKICAgICAgICBjb25zdCBtYXhIZWlnaHQgPSAocmVjdFszXSAtIHJlY3RbMV0pIC8gMjsKICAgICAgICBpZiAobWF4V2lkdGggPiAwICYmIG1heEhlaWdodCA+IDAgJiYgKHdpZHRoID4gbWF4V2lkdGggfHwgd2lkdGggPiBtYXhIZWlnaHQpKSB7CiAgICAgICAgICB3YXJuKGBBbm5vdGF0aW9uQm9yZGVyU3R5bGUuc2V0V2lkdGggLSBpZ25vcmluZyB3aWR0aDogJHt3aWR0aH1gKTsKICAgICAgICAgIHdpZHRoID0gMTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwogICAgfQogIH0KICBzZXRTdHlsZShzdHlsZSkgewogICAgaWYgKCEoc3R5bGUgaW5zdGFuY2VvZiBOYW1lKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBzd2l0Y2ggKHN0eWxlLm5hbWUpIHsKICAgICAgY2FzZSAiUyI6CiAgICAgICAgdGhpcy5zdHlsZSA9IEFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUuU09MSUQ7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIkQiOgogICAgICAgIHRoaXMuc3R5bGUgPSBBbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlLkRBU0hFRDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiQiI6CiAgICAgICAgdGhpcy5zdHlsZSA9IEFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUuQkVWRUxFRDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiSSI6CiAgICAgICAgdGhpcy5zdHlsZSA9IEFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUuSU5TRVQ7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIlUiOgogICAgICAgIHRoaXMuc3R5bGUgPSBBbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlLlVOREVSTElORTsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICBicmVhazsKICAgIH0KICB9CiAgc2V0RGFzaEFycmF5KGRhc2hBcnJheSwgZm9yY2VTdHlsZSA9IGZhbHNlKSB7CiAgICBpZiAoQXJyYXkuaXNBcnJheShkYXNoQXJyYXkpKSB7CiAgICAgIGxldCBpc1ZhbGlkID0gdHJ1ZTsKICAgICAgbGV0IGFsbFplcm9zID0gdHJ1ZTsKICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGRhc2hBcnJheSkgewogICAgICAgIGNvbnN0IHZhbGlkTnVtYmVyID0gK2VsZW1lbnQgPj0gMDsKICAgICAgICBpZiAoIXZhbGlkTnVtYmVyKSB7CiAgICAgICAgICBpc1ZhbGlkID0gZmFsc2U7CiAgICAgICAgICBicmVhazsKICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQgPiAwKSB7CiAgICAgICAgICBhbGxaZXJvcyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoZGFzaEFycmF5Lmxlbmd0aCA9PT0gMCB8fCBpc1ZhbGlkICYmICFhbGxaZXJvcykgewogICAgICAgIHRoaXMuZGFzaEFycmF5ID0gZGFzaEFycmF5OwogICAgICAgIGlmIChmb3JjZVN0eWxlKSB7CiAgICAgICAgICB0aGlzLnNldFN0eWxlKE5hbWUuZ2V0KCJEIikpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLndpZHRoID0gMDsKICAgICAgfQogICAgfSBlbHNlIGlmIChkYXNoQXJyYXkpIHsKICAgICAgdGhpcy53aWR0aCA9IDA7CiAgICB9CiAgfQogIHNldEhvcml6b250YWxDb3JuZXJSYWRpdXMocmFkaXVzKSB7CiAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihyYWRpdXMpKSB7CiAgICAgIHRoaXMuaG9yaXpvbnRhbENvcm5lclJhZGl1cyA9IHJhZGl1czsKICAgIH0KICB9CiAgc2V0VmVydGljYWxDb3JuZXJSYWRpdXMocmFkaXVzKSB7CiAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihyYWRpdXMpKSB7CiAgICAgIHRoaXMudmVydGljYWxDb3JuZXJSYWRpdXMgPSByYWRpdXM7CiAgICB9CiAgfQp9CmNsYXNzIE1hcmt1cEFubm90YXRpb24gZXh0ZW5kcyBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QKICAgIH0gPSBwYXJhbXM7CiAgICBpZiAoZGljdC5oYXMoIklSVCIpKSB7CiAgICAgIGNvbnN0IHJhd0lSVCA9IGRpY3QuZ2V0UmF3KCJJUlQiKTsKICAgICAgdGhpcy5kYXRhLmluUmVwbHlUbyA9IHJhd0lSVCBpbnN0YW5jZW9mIFJlZiA/IHJhd0lSVC50b1N0cmluZygpIDogbnVsbDsKICAgICAgY29uc3QgcnQgPSBkaWN0LmdldCgiUlQiKTsKICAgICAgdGhpcy5kYXRhLnJlcGx5VHlwZSA9IHJ0IGluc3RhbmNlb2YgTmFtZSA/IHJ0Lm5hbWUgOiBBbm5vdGF0aW9uUmVwbHlUeXBlLlJFUExZOwogICAgfQogICAgbGV0IHBvcHVwUmVmID0gbnVsbDsKICAgIGlmICh0aGlzLmRhdGEucmVwbHlUeXBlID09PSBBbm5vdGF0aW9uUmVwbHlUeXBlLkdST1VQKSB7CiAgICAgIGNvbnN0IHBhcmVudCA9IGRpY3QuZ2V0KCJJUlQiKTsKICAgICAgdGhpcy5zZXRUaXRsZShwYXJlbnQuZ2V0KCJUIikpOwogICAgICB0aGlzLmRhdGEudGl0bGVPYmogPSB0aGlzLl90aXRsZTsKICAgICAgdGhpcy5zZXRDb250ZW50cyhwYXJlbnQuZ2V0KCJDb250ZW50cyIpKTsKICAgICAgdGhpcy5kYXRhLmNvbnRlbnRzT2JqID0gdGhpcy5fY29udGVudHM7CiAgICAgIGlmICghcGFyZW50LmhhcygiQ3JlYXRpb25EYXRlIikpIHsKICAgICAgICB0aGlzLmRhdGEuY3JlYXRpb25EYXRlID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNldENyZWF0aW9uRGF0ZShwYXJlbnQuZ2V0KCJDcmVhdGlvbkRhdGUiKSk7CiAgICAgICAgdGhpcy5kYXRhLmNyZWF0aW9uRGF0ZSA9IHRoaXMuY3JlYXRpb25EYXRlOwogICAgICB9CiAgICAgIGlmICghcGFyZW50LmhhcygiTSIpKSB7CiAgICAgICAgdGhpcy5kYXRhLm1vZGlmaWNhdGlvbkRhdGUgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2V0TW9kaWZpY2F0aW9uRGF0ZShwYXJlbnQuZ2V0KCJNIikpOwogICAgICAgIHRoaXMuZGF0YS5tb2RpZmljYXRpb25EYXRlID0gdGhpcy5tb2RpZmljYXRpb25EYXRlOwogICAgICB9CiAgICAgIHBvcHVwUmVmID0gcGFyZW50LmdldFJhdygiUG9wdXAiKTsKICAgICAgaWYgKCFwYXJlbnQuaGFzKCJDIikpIHsKICAgICAgICB0aGlzLmRhdGEuY29sb3IgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2V0Q29sb3IocGFyZW50LmdldEFycmF5KCJDIikpOwogICAgICAgIHRoaXMuZGF0YS5jb2xvciA9IHRoaXMuY29sb3I7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGF0YS50aXRsZU9iaiA9IHRoaXMuX3RpdGxlOwogICAgICB0aGlzLnNldENyZWF0aW9uRGF0ZShkaWN0LmdldCgiQ3JlYXRpb25EYXRlIikpOwogICAgICB0aGlzLmRhdGEuY3JlYXRpb25EYXRlID0gdGhpcy5jcmVhdGlvbkRhdGU7CiAgICAgIHBvcHVwUmVmID0gZGljdC5nZXRSYXcoIlBvcHVwIik7CiAgICAgIGlmICghZGljdC5oYXMoIkMiKSkgewogICAgICAgIHRoaXMuZGF0YS5jb2xvciA9IG51bGw7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuZGF0YS5wb3B1cFJlZiA9IHBvcHVwUmVmIGluc3RhbmNlb2YgUmVmID8gcG9wdXBSZWYudG9TdHJpbmcoKSA6IG51bGw7CiAgICBpZiAoZGljdC5oYXMoIlJDIikpIHsKICAgICAgdGhpcy5kYXRhLnJpY2hUZXh0ID0gWEZBRmFjdG9yeS5nZXRSaWNoVGV4dEFzSHRtbChkaWN0LmdldCgiUkMiKSk7CiAgICB9CiAgfQogIHNldENyZWF0aW9uRGF0ZShjcmVhdGlvbkRhdGUpIHsKICAgIHRoaXMuY3JlYXRpb25EYXRlID0gdHlwZW9mIGNyZWF0aW9uRGF0ZSA9PT0gInN0cmluZyIgPyBjcmVhdGlvbkRhdGUgOiBudWxsOwogIH0KICBfc2V0RGVmYXVsdEFwcGVhcmFuY2UoewogICAgeHJlZiwKICAgIGV4dHJhLAogICAgc3Ryb2tlQ29sb3IsCiAgICBmaWxsQ29sb3IsCiAgICBibGVuZE1vZGUsCiAgICBzdHJva2VBbHBoYSwKICAgIGZpbGxBbHBoYSwKICAgIHBvaW50c0NhbGxiYWNrCiAgfSkgewogICAgY29uc3QgYmJveCA9IHRoaXMuZGF0YS5yZWN0ID0gW0luZmluaXR5LCBJbmZpbml0eSwgLUluZmluaXR5LCAtSW5maW5pdHldOwogICAgY29uc3QgYnVmZmVyID0gWyJxIl07CiAgICBpZiAoZXh0cmEpIHsKICAgICAgYnVmZmVyLnB1c2goZXh0cmEpOwogICAgfQogICAgaWYgKHN0cm9rZUNvbG9yKSB7CiAgICAgIGJ1ZmZlci5wdXNoKGAke3N0cm9rZUNvbG9yWzBdfSAke3N0cm9rZUNvbG9yWzFdfSAke3N0cm9rZUNvbG9yWzJdfSBSR2ApOwogICAgfQogICAgaWYgKGZpbGxDb2xvcikgewogICAgICBidWZmZXIucHVzaChgJHtmaWxsQ29sb3JbMF19ICR7ZmlsbENvbG9yWzFdfSAke2ZpbGxDb2xvclsyXX0gcmdgKTsKICAgIH0KICAgIGNvbnN0IHBvaW50c0FycmF5ID0gdGhpcy5kYXRhLnF1YWRQb2ludHMgfHwgRmxvYXQzMkFycmF5LmZyb20oW3RoaXMucmVjdGFuZ2xlWzBdLCB0aGlzLnJlY3RhbmdsZVszXSwgdGhpcy5yZWN0YW5nbGVbMl0sIHRoaXMucmVjdGFuZ2xlWzNdLCB0aGlzLnJlY3RhbmdsZVswXSwgdGhpcy5yZWN0YW5nbGVbMV0sIHRoaXMucmVjdGFuZ2xlWzJdLCB0aGlzLnJlY3RhbmdsZVsxXV0pOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gcG9pbnRzQXJyYXkubGVuZ3RoOyBpIDwgaWk7IGkgKz0gOCkgewogICAgICBjb25zdCBwb2ludHMgPSBwb2ludHNDYWxsYmFjayhidWZmZXIsIHBvaW50c0FycmF5LnN1YmFycmF5KGksIGkgKyA4KSk7CiAgICAgIFV0aWwucmVjdEJvdW5kaW5nQm94KC4uLnBvaW50cywgYmJveCk7CiAgICB9CiAgICBidWZmZXIucHVzaCgiUSIpOwogICAgY29uc3QgZm9ybURpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIGNvbnN0IGFwcGVhcmFuY2VTdHJlYW1EaWN0ID0gbmV3IERpY3QoeHJlZik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlN1YnR5cGUiLCAiRm9ybSIpOwogICAgY29uc3QgYXBwZWFyYW5jZVN0cmVhbSA9IG5ldyBTdHJpbmdTdHJlYW0oYnVmZmVyLmpvaW4oIiAiKSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtLmRpY3QgPSBhcHBlYXJhbmNlU3RyZWFtRGljdDsKICAgIGZvcm1EaWN0LnNldCgiRm0wIiwgYXBwZWFyYW5jZVN0cmVhbSk7CiAgICBjb25zdCBnc0RpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIGlmIChibGVuZE1vZGUpIHsKICAgICAgZ3NEaWN0LnNldElmTmFtZSgiQk0iLCBibGVuZE1vZGUpOwogICAgfQogICAgZ3NEaWN0LnNldElmTnVtYmVyKCJDQSIsIHN0cm9rZUFscGhhKTsKICAgIGdzRGljdC5zZXRJZk51bWJlcigiY2EiLCBmaWxsQWxwaGEpOwogICAgY29uc3Qgc3RhdGVEaWN0ID0gbmV3IERpY3QoeHJlZik7CiAgICBzdGF0ZURpY3Quc2V0KCJHUzAiLCBnc0RpY3QpOwogICAgY29uc3QgcmVzb3VyY2VzID0gbmV3IERpY3QoeHJlZik7CiAgICByZXNvdXJjZXMuc2V0KCJFeHRHU3RhdGUiLCBzdGF0ZURpY3QpOwogICAgcmVzb3VyY2VzLnNldCgiWE9iamVjdCIsIGZvcm1EaWN0KTsKICAgIGNvbnN0IGFwcGVhcmFuY2VEaWN0ID0gbmV3IERpY3QoeHJlZik7CiAgICBhcHBlYXJhbmNlRGljdC5zZXQoIlJlc291cmNlcyIsIHJlc291cmNlcyk7CiAgICBhcHBlYXJhbmNlRGljdC5zZXQoIkJCb3giLCBiYm94KTsKICAgIHRoaXMuYXBwZWFyYW5jZSA9IG5ldyBTdHJpbmdTdHJlYW0oIi9HUzAgZ3MgL0ZtMCBEbyIpOwogICAgdGhpcy5hcHBlYXJhbmNlLmRpY3QgPSBhcHBlYXJhbmNlRGljdDsKICAgIHRoaXMuX3N0cmVhbXMucHVzaCh0aGlzLmFwcGVhcmFuY2UsIGFwcGVhcmFuY2VTdHJlYW0pOwogIH0KICBzdGF0aWMgYXN5bmMgY3JlYXRlTmV3QW5ub3RhdGlvbih4cmVmLCBhbm5vdGF0aW9uLCBjaGFuZ2VzLCBwYXJhbXMpIHsKICAgIGNvbnN0IGFubm90YXRpb25SZWYgPSBhbm5vdGF0aW9uLnJlZiB8fD0geHJlZi5nZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgIGNvbnN0IGFwID0gYXdhaXQgdGhpcy5jcmVhdGVOZXdBcHBlYXJhbmNlU3RyZWFtKGFubm90YXRpb24sIHhyZWYsIHBhcmFtcyk7CiAgICBsZXQgYW5ub3RhdGlvbkRpY3Q7CiAgICBpZiAoYXApIHsKICAgICAgY29uc3QgYXBSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgICBhbm5vdGF0aW9uRGljdCA9IHRoaXMuY3JlYXRlTmV3RGljdChhbm5vdGF0aW9uLCB4cmVmLCB7CiAgICAgICAgYXBSZWYKICAgICAgfSk7CiAgICAgIGNoYW5nZXMucHV0KGFwUmVmLCB7CiAgICAgICAgZGF0YTogYXAKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBhbm5vdGF0aW9uRGljdCA9IHRoaXMuY3JlYXRlTmV3RGljdChhbm5vdGF0aW9uLCB4cmVmLCB7fSk7CiAgICB9CiAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihhbm5vdGF0aW9uLnBhcmVudFRyZWVJZCkpIHsKICAgICAgYW5ub3RhdGlvbkRpY3Quc2V0KCJTdHJ1Y3RQYXJlbnQiLCBhbm5vdGF0aW9uLnBhcmVudFRyZWVJZCk7CiAgICB9CiAgICBjaGFuZ2VzLnB1dChhbm5vdGF0aW9uUmVmLCB7CiAgICAgIGRhdGE6IGFubm90YXRpb25EaWN0CiAgICB9KTsKICAgIGNvbnN0IHJldFJlZiA9IHsKICAgICAgcmVmOiBhbm5vdGF0aW9uUmVmCiAgICB9OwogICAgaWYgKGFubm90YXRpb24ucG9wdXApIHsKICAgICAgY29uc3QgcG9wdXAgPSBhbm5vdGF0aW9uLnBvcHVwOwogICAgICBpZiAocG9wdXAuZGVsZXRlZCkgewogICAgICAgIGFubm90YXRpb25EaWN0LmRlbGV0ZSgiUG9wdXAiKTsKICAgICAgICBhbm5vdGF0aW9uRGljdC5kZWxldGUoIkNvbnRlbnRzIik7CiAgICAgICAgYW5ub3RhdGlvbkRpY3QuZGVsZXRlKCJSQyIpOwogICAgICAgIHJldHVybiByZXRSZWY7CiAgICAgIH0KICAgICAgY29uc3QgcG9wdXBSZWYgPSBwb3B1cC5yZWYgfHw9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgIHBvcHVwLnBhcmVudCA9IGFubm90YXRpb25SZWY7CiAgICAgIGNvbnN0IHBvcHVwRGljdCA9IFBvcHVwQW5ub3RhdGlvbi5jcmVhdGVOZXdEaWN0KHBvcHVwLCB4cmVmKTsKICAgICAgY2hhbmdlcy5wdXQocG9wdXBSZWYsIHsKICAgICAgICBkYXRhOiBwb3B1cERpY3QKICAgICAgfSk7CiAgICAgIGFubm90YXRpb25EaWN0LnNldElmRGVmaW5lZCgiQ29udGVudHMiLCBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKHBvcHVwLmNvbnRlbnRzKSk7CiAgICAgIGFubm90YXRpb25EaWN0LnNldCgiUG9wdXAiLCBwb3B1cFJlZik7CiAgICAgIHJldHVybiBbcmV0UmVmLCB7CiAgICAgICAgcmVmOiBwb3B1cFJlZgogICAgICB9XTsKICAgIH0KICAgIHJldHVybiByZXRSZWY7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVOZXdQcmludEFubm90YXRpb24oYW5ub3RhdGlvbkdsb2JhbHMsIHhyZWYsIGFubm90YXRpb24sIHBhcmFtcykgewogICAgY29uc3QgYXAgPSBhd2FpdCB0aGlzLmNyZWF0ZU5ld0FwcGVhcmFuY2VTdHJlYW0oYW5ub3RhdGlvbiwgeHJlZiwgcGFyYW1zKTsKICAgIGNvbnN0IGFubm90YXRpb25EaWN0ID0gdGhpcy5jcmVhdGVOZXdEaWN0KGFubm90YXRpb24sIHhyZWYsIGFwID8gewogICAgICBhcAogICAgfSA6IHt9KTsKICAgIGNvbnN0IG5ld0Fubm90YXRpb24gPSBuZXcgdGhpcy5wcm90b3R5cGUuY29uc3RydWN0b3IoewogICAgICBkaWN0OiBhbm5vdGF0aW9uRGljdCwKICAgICAgeHJlZiwKICAgICAgYW5ub3RhdGlvbkdsb2JhbHMsCiAgICAgIGV2YWx1YXRvck9wdGlvbnM6IHBhcmFtcy5ldmFsdWF0b3JPcHRpb25zCiAgICB9KTsKICAgIGlmIChhbm5vdGF0aW9uLnJlZikgewogICAgICBuZXdBbm5vdGF0aW9uLnJlZiA9IG5ld0Fubm90YXRpb24ucmVmVG9SZXBsYWNlID0gYW5ub3RhdGlvbi5yZWY7CiAgICB9CiAgICByZXR1cm4gbmV3QW5ub3RhdGlvbjsKICB9Cn0KY2xhc3MgV2lkZ2V0QW5ub3RhdGlvbiBleHRlbmRzIEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZiwKICAgICAgYW5ub3RhdGlvbkdsb2JhbHMKICAgIH0gPSBwYXJhbXM7CiAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgdGhpcy5fbmVlZEFwcGVhcmFuY2VzID0gcGFyYW1zLm5lZWRBcHBlYXJhbmNlczsKICAgIGRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5XSURHRVQ7CiAgICBpZiAoZGF0YS5maWVsZE5hbWUgPT09IHVuZGVmaW5lZCkgewogICAgICBkYXRhLmZpZWxkTmFtZSA9IHRoaXMuX2NvbnN0cnVjdEZpZWxkTmFtZShkaWN0KTsKICAgIH0KICAgIGlmIChkYXRhLmFjdGlvbnMgPT09IHVuZGVmaW5lZCkgewogICAgICBkYXRhLmFjdGlvbnMgPSBjb2xsZWN0QWN0aW9ucyh4cmVmLCBkaWN0LCBBbm5vdGF0aW9uQWN0aW9uRXZlbnRUeXBlKTsKICAgIH0KICAgIGxldCBmaWVsZFZhbHVlID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgICAgIGRpY3QsCiAgICAgIGtleTogIlYiLAogICAgICBnZXRBcnJheTogdHJ1ZQogICAgfSk7CiAgICBkYXRhLmZpZWxkVmFsdWUgPSB0aGlzLl9kZWNvZGVGb3JtVmFsdWUoZmllbGRWYWx1ZSk7CiAgICBjb25zdCBkZWZhdWx0RmllbGRWYWx1ZSA9IGdldEluaGVyaXRhYmxlUHJvcGVydHkoewogICAgICBkaWN0LAogICAgICBrZXk6ICJEViIsCiAgICAgIGdldEFycmF5OiB0cnVlCiAgICB9KTsKICAgIGRhdGEuZGVmYXVsdEZpZWxkVmFsdWUgPSB0aGlzLl9kZWNvZGVGb3JtVmFsdWUoZGVmYXVsdEZpZWxkVmFsdWUpOwogICAgaWYgKGZpZWxkVmFsdWUgPT09IHVuZGVmaW5lZCAmJiBhbm5vdGF0aW9uR2xvYmFscy54ZmFEYXRhc2V0cykgewogICAgICBjb25zdCBwYXRoID0gdGhpcy5fdGl0bGUuc3RyOwogICAgICBpZiAocGF0aCkgewogICAgICAgIHRoaXMuX2hhc1ZhbHVlRnJvbVhGQSA9IHRydWU7CiAgICAgICAgZGF0YS5maWVsZFZhbHVlID0gZmllbGRWYWx1ZSA9IGFubm90YXRpb25HbG9iYWxzLnhmYURhdGFzZXRzLmdldFZhbHVlKHBhdGgpOwogICAgICB9CiAgICB9CiAgICBpZiAoZmllbGRWYWx1ZSA9PT0gdW5kZWZpbmVkICYmIGRhdGEuZGVmYXVsdEZpZWxkVmFsdWUgIT09IG51bGwpIHsKICAgICAgZGF0YS5maWVsZFZhbHVlID0gZGF0YS5kZWZhdWx0RmllbGRWYWx1ZTsKICAgIH0KICAgIGRhdGEuYWx0ZXJuYXRpdmVUZXh0ID0gc3RyaW5nVG9QREZTdHJpbmcoZGljdC5nZXQoIlRVIikgfHwgIiIpOwogICAgdGhpcy5zZXREZWZhdWx0QXBwZWFyYW5jZShwYXJhbXMpOwogICAgZGF0YS5oYXNBcHBlYXJhbmNlIHx8PSB0aGlzLl9uZWVkQXBwZWFyYW5jZXMgJiYgZGF0YS5maWVsZFZhbHVlICE9PSB1bmRlZmluZWQgJiYgZGF0YS5maWVsZFZhbHVlICE9PSBudWxsOwogICAgY29uc3QgZmllbGRUeXBlID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgICAgIGRpY3QsCiAgICAgIGtleTogIkZUIgogICAgfSk7CiAgICBkYXRhLmZpZWxkVHlwZSA9IGZpZWxkVHlwZSBpbnN0YW5jZW9mIE5hbWUgPyBmaWVsZFR5cGUubmFtZSA6IG51bGw7CiAgICBjb25zdCBsb2NhbFJlc291cmNlcyA9IGdldEluaGVyaXRhYmxlUHJvcGVydHkoewogICAgICBkaWN0LAogICAgICBrZXk6ICJEUiIKICAgIH0pOwogICAgY29uc3QgYWNyb0Zvcm1SZXNvdXJjZXMgPSBhbm5vdGF0aW9uR2xvYmFscy5hY3JvRm9ybS5nZXQoIkRSIik7CiAgICBjb25zdCBhcHBlYXJhbmNlUmVzb3VyY2VzID0gdGhpcy5hcHBlYXJhbmNlPy5kaWN0LmdldCgiUmVzb3VyY2VzIik7CiAgICB0aGlzLl9maWVsZFJlc291cmNlcyA9IHsKICAgICAgbG9jYWxSZXNvdXJjZXMsCiAgICAgIGFjcm9Gb3JtUmVzb3VyY2VzLAogICAgICBhcHBlYXJhbmNlUmVzb3VyY2VzLAogICAgICBtZXJnZWRSZXNvdXJjZXM6IERpY3QubWVyZ2UoewogICAgICAgIHhyZWYsCiAgICAgICAgZGljdEFycmF5OiBbbG9jYWxSZXNvdXJjZXMsIGFwcGVhcmFuY2VSZXNvdXJjZXMsIGFjcm9Gb3JtUmVzb3VyY2VzXSwKICAgICAgICBtZXJnZVN1YkRpY3RzOiB0cnVlCiAgICAgIH0pCiAgICB9OwogICAgZGF0YS5maWVsZEZsYWdzID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgICAgIGRpY3QsCiAgICAgIGtleTogIkZmIgogICAgfSk7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoZGF0YS5maWVsZEZsYWdzKSB8fCBkYXRhLmZpZWxkRmxhZ3MgPCAwKSB7CiAgICAgIGRhdGEuZmllbGRGbGFncyA9IDA7CiAgICB9CiAgICBkYXRhLnBhc3N3b3JkID0gdGhpcy5oYXNGaWVsZEZsYWcoQW5ub3RhdGlvbkZpZWxkRmxhZy5QQVNTV09SRCk7CiAgICBkYXRhLnJlYWRPbmx5ID0gdGhpcy5oYXNGaWVsZEZsYWcoQW5ub3RhdGlvbkZpZWxkRmxhZy5SRUFET05MWSk7CiAgICBkYXRhLnJlcXVpcmVkID0gdGhpcy5oYXNGaWVsZEZsYWcoQW5ub3RhdGlvbkZpZWxkRmxhZy5SRVFVSVJFRCk7CiAgICBkYXRhLmhpZGRlbiA9IHRoaXMuX2hhc0ZsYWcoZGF0YS5hbm5vdGF0aW9uRmxhZ3MsIEFubm90YXRpb25GbGFnLkhJRERFTikgfHwgdGhpcy5faGFzRmxhZyhkYXRhLmFubm90YXRpb25GbGFncywgQW5ub3RhdGlvbkZsYWcuTk9WSUVXKTsKICB9CiAgX2RlY29kZUZvcm1WYWx1ZShmb3JtVmFsdWUpIHsKICAgIGlmIChBcnJheS5pc0FycmF5KGZvcm1WYWx1ZSkpIHsKICAgICAgcmV0dXJuIGZvcm1WYWx1ZS5maWx0ZXIoaXRlbSA9PiB0eXBlb2YgaXRlbSA9PT0gInN0cmluZyIpLm1hcChpdGVtID0+IHN0cmluZ1RvUERGU3RyaW5nKGl0ZW0pKTsKICAgIH0gZWxzZSBpZiAoZm9ybVZhbHVlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICByZXR1cm4gc3RyaW5nVG9QREZTdHJpbmcoZm9ybVZhbHVlLm5hbWUpOwogICAgfSBlbHNlIGlmICh0eXBlb2YgZm9ybVZhbHVlID09PSAic3RyaW5nIikgewogICAgICByZXR1cm4gc3RyaW5nVG9QREZTdHJpbmcoZm9ybVZhbHVlKTsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICBoYXNGaWVsZEZsYWcoZmxhZykgewogICAgcmV0dXJuICEhKHRoaXMuZGF0YS5maWVsZEZsYWdzICYgZmxhZyk7CiAgfQogIF9pc1ZpZXdhYmxlKGZsYWdzKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgbXVzdEJlVmlld2VkKGFubm90YXRpb25TdG9yYWdlLCByZW5kZXJGb3JtcykgewogICAgaWYgKHJlbmRlckZvcm1zKSB7CiAgICAgIHJldHVybiB0aGlzLnZpZXdhYmxlOwogICAgfQogICAgcmV0dXJuIHN1cGVyLm11c3RCZVZpZXdlZChhbm5vdGF0aW9uU3RvcmFnZSwgcmVuZGVyRm9ybXMpICYmICF0aGlzLl9oYXNGbGFnKHRoaXMuZmxhZ3MsIEFubm90YXRpb25GbGFnLk5PVklFVyk7CiAgfQogIGdldFJvdGF0aW9uTWF0cml4KGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBsZXQgcm90YXRpb24gPSBhbm5vdGF0aW9uU3RvcmFnZT8uZ2V0KHRoaXMuZGF0YS5pZCk/LnJvdGF0aW9uOwogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgcm90YXRpb24gPSB0aGlzLnJvdGF0aW9uOwogICAgfQogICAgcmV0dXJuIHJvdGF0aW9uID09PSAwID8gSURFTlRJVFlfTUFUUklYIDogZ2V0Um90YXRpb25NYXRyaXgocm90YXRpb24sIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTsKICB9CiAgZ2V0Qm9yZGVyQW5kQmFja2dyb3VuZEFwcGVhcmFuY2VzKGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBsZXQgcm90YXRpb24gPSBhbm5vdGF0aW9uU3RvcmFnZT8uZ2V0KHRoaXMuZGF0YS5pZCk/LnJvdGF0aW9uOwogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgcm90YXRpb24gPSB0aGlzLnJvdGF0aW9uOwogICAgfQogICAgaWYgKCF0aGlzLmJhY2tncm91bmRDb2xvciAmJiAhdGhpcy5ib3JkZXJDb2xvcikgewogICAgICByZXR1cm4gIiI7CiAgICB9CiAgICBjb25zdCByZWN0ID0gcm90YXRpb24gPT09IDAgfHwgcm90YXRpb24gPT09IDE4MCA/IGAwIDAgJHt0aGlzLndpZHRofSAke3RoaXMuaGVpZ2h0fSByZWAgOiBgMCAwICR7dGhpcy5oZWlnaHR9ICR7dGhpcy53aWR0aH0gcmVgOwogICAgbGV0IHN0ciA9ICIiOwogICAgaWYgKHRoaXMuYmFja2dyb3VuZENvbG9yKSB7CiAgICAgIHN0ciA9IGAke2dldFBkZkNvbG9yKHRoaXMuYmFja2dyb3VuZENvbG9yLCB0cnVlKX0gJHtyZWN0fSBmIGA7CiAgICB9CiAgICBpZiAodGhpcy5ib3JkZXJDb2xvcikgewogICAgICBjb25zdCBib3JkZXJXaWR0aCA9IHRoaXMuYm9yZGVyU3R5bGUud2lkdGggfHwgMTsKICAgICAgc3RyICs9IGAke2JvcmRlcldpZHRofSB3ICR7Z2V0UGRmQ29sb3IodGhpcy5ib3JkZXJDb2xvciwgZmFsc2UpfSAke3JlY3R9IFMgYDsKICAgIH0KICAgIHJldHVybiBzdHI7CiAgfQogIGFzeW5jIGdldE9wZXJhdG9yTGlzdChldmFsdWF0b3IsIHRhc2ssIGludGVudCwgYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIGlmIChpbnRlbnQgJiBSZW5kZXJpbmdJbnRlbnRGbGFnLkFOTk9UQVRJT05TX0ZPUk1TICYmICEodGhpcyBpbnN0YW5jZW9mIFNpZ25hdHVyZVdpZGdldEFubm90YXRpb24pICYmICF0aGlzLmRhdGEubm9IVE1MICYmICF0aGlzLmRhdGEuaGFzT3duQ2FudmFzKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgb3BMaXN0OiBuZXcgT3BlcmF0b3JMaXN0KCksCiAgICAgICAgc2VwYXJhdGVGb3JtOiB0cnVlLAogICAgICAgIHNlcGFyYXRlQ2FudmFzOiBmYWxzZQogICAgICB9OwogICAgfQogICAgaWYgKCF0aGlzLl9oYXNUZXh0KSB7CiAgICAgIHJldHVybiBzdXBlci5nZXRPcGVyYXRvckxpc3QoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKTsKICAgIH0KICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLl9nZXRBcHBlYXJhbmNlKGV2YWx1YXRvciwgdGFzaywgaW50ZW50LCBhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICBpZiAodGhpcy5hcHBlYXJhbmNlICYmIGNvbnRlbnQgPT09IG51bGwpIHsKICAgICAgcmV0dXJuIHN1cGVyLmdldE9wZXJhdG9yTGlzdChldmFsdWF0b3IsIHRhc2ssIGludGVudCwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgfQogICAgY29uc3Qgb3BMaXN0ID0gbmV3IE9wZXJhdG9yTGlzdCgpOwogICAgaWYgKCF0aGlzLl9kZWZhdWx0QXBwZWFyYW5jZSB8fCBjb250ZW50ID09PSBudWxsKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgb3BMaXN0LAogICAgICAgIHNlcGFyYXRlRm9ybTogZmFsc2UsCiAgICAgICAgc2VwYXJhdGVDYW52YXM6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICBjb25zdCBpc1VzaW5nT3duQ2FudmFzID0gISEodGhpcy5kYXRhLmhhc093bkNhbnZhcyAmJiBpbnRlbnQgJiBSZW5kZXJpbmdJbnRlbnRGbGFnLkRJU1BMQVkpOwogICAgY29uc3QgbWF0cml4ID0gWzEsIDAsIDAsIDEsIDAsIDBdOwogICAgY29uc3QgYmJveCA9IFswLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodF07CiAgICBjb25zdCB0cmFuc2Zvcm0gPSBnZXRUcmFuc2Zvcm1NYXRyaXgodGhpcy5kYXRhLnJlY3QsIGJib3gsIG1hdHJpeCk7CiAgICBsZXQgb3B0aW9uYWxDb250ZW50OwogICAgaWYgKHRoaXMub2MpIHsKICAgICAgb3B0aW9uYWxDb250ZW50ID0gYXdhaXQgZXZhbHVhdG9yLnBhcnNlTWFya2VkQ29udGVudFByb3BzKHRoaXMub2MsIG51bGwpOwogICAgfQogICAgaWYgKG9wdGlvbmFsQ29udGVudCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIG9wTGlzdC5hZGRPcChPUFMuYmVnaW5NYXJrZWRDb250ZW50UHJvcHMsIFsiT0MiLCBvcHRpb25hbENvbnRlbnRdKTsKICAgIH0KICAgIG9wTGlzdC5hZGRPcChPUFMuYmVnaW5Bbm5vdGF0aW9uLCBbdGhpcy5kYXRhLmlkLCB0aGlzLmRhdGEucmVjdCwgdHJhbnNmb3JtLCB0aGlzLmdldFJvdGF0aW9uTWF0cml4KGFubm90YXRpb25TdG9yYWdlKSwgaXNVc2luZ093bkNhbnZhc10pOwogICAgY29uc3Qgc3RyZWFtID0gbmV3IFN0cmluZ1N0cmVhbShjb250ZW50KTsKICAgIGF3YWl0IGV2YWx1YXRvci5nZXRPcGVyYXRvckxpc3QoewogICAgICBzdHJlYW0sCiAgICAgIHRhc2ssCiAgICAgIHJlc291cmNlczogdGhpcy5fZmllbGRSZXNvdXJjZXMubWVyZ2VkUmVzb3VyY2VzLAogICAgICBvcGVyYXRvckxpc3Q6IG9wTGlzdAogICAgfSk7CiAgICBvcExpc3QuYWRkT3AoT1BTLmVuZEFubm90YXRpb24sIFtdKTsKICAgIGlmIChvcHRpb25hbENvbnRlbnQgIT09IHVuZGVmaW5lZCkgewogICAgICBvcExpc3QuYWRkT3AoT1BTLmVuZE1hcmtlZENvbnRlbnQsIFtdKTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIG9wTGlzdCwKICAgICAgc2VwYXJhdGVGb3JtOiBmYWxzZSwKICAgICAgc2VwYXJhdGVDYW52YXM6IGlzVXNpbmdPd25DYW52YXMKICAgIH07CiAgfQogIF9nZXRNS0RpY3Qocm90YXRpb24pIHsKICAgIGNvbnN0IG1rID0gbmV3IERpY3QobnVsbCk7CiAgICBpZiAocm90YXRpb24pIHsKICAgICAgbWsuc2V0KCJSIiwgcm90YXRpb24pOwogICAgfQogICAgbWsuc2V0SWZBcnJheSgiQkMiLCBnZXRQZGZDb2xvckFycmF5KHRoaXMuYm9yZGVyQ29sb3IpKTsKICAgIG1rLnNldElmQXJyYXkoIkJHIiwgZ2V0UGRmQ29sb3JBcnJheSh0aGlzLmJhY2tncm91bmRDb2xvcikpOwogICAgcmV0dXJuIG1rLnNpemUgPiAwID8gbWsgOiBudWxsOwogIH0KICBhbWVuZFNhdmVkRGljdChhbm5vdGF0aW9uU3RvcmFnZSwgZGljdCkge30KICBzZXRWYWx1ZShkaWN0LCB2YWx1ZSwgeHJlZiwgY2hhbmdlcykgewogICAgY29uc3QgewogICAgICBkaWN0OiBwYXJlbnREaWN0LAogICAgICByZWY6IHBhcmVudFJlZgogICAgfSA9IGdldFBhcmVudFRvVXBkYXRlKGRpY3QsIHRoaXMucmVmLCB4cmVmKTsKICAgIGlmICghcGFyZW50RGljdCkgewogICAgICBkaWN0LnNldCgiViIsIHZhbHVlKTsKICAgIH0gZWxzZSBpZiAoIWNoYW5nZXMuaGFzKHBhcmVudFJlZikpIHsKICAgICAgY29uc3QgbmV3UGFyZW50RGljdCA9IHBhcmVudERpY3QuY2xvbmUoKTsKICAgICAgbmV3UGFyZW50RGljdC5zZXQoIlYiLCB2YWx1ZSk7CiAgICAgIGNoYW5nZXMucHV0KHBhcmVudFJlZiwgewogICAgICAgIGRhdGE6IG5ld1BhcmVudERpY3QKICAgICAgfSk7CiAgICAgIHJldHVybiBuZXdQYXJlbnREaWN0OwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIGFzeW5jIHNhdmUoZXZhbHVhdG9yLCB0YXNrLCBhbm5vdGF0aW9uU3RvcmFnZSwgY2hhbmdlcykgewogICAgY29uc3Qgc3RvcmFnZUVudHJ5ID0gYW5ub3RhdGlvblN0b3JhZ2U/LmdldCh0aGlzLmRhdGEuaWQpOwogICAgY29uc3QgZmxhZ3MgPSB0aGlzLl9idWlsZEZsYWdzKHN0b3JhZ2VFbnRyeT8ubm9WaWV3LCBzdG9yYWdlRW50cnk/Lm5vUHJpbnQpOwogICAgbGV0IHZhbHVlID0gc3RvcmFnZUVudHJ5Py52YWx1ZSwKICAgICAgcm90YXRpb24gPSBzdG9yYWdlRW50cnk/LnJvdGF0aW9uOwogICAgaWYgKHZhbHVlID09PSB0aGlzLmRhdGEuZmllbGRWYWx1ZSB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmICghdGhpcy5faGFzVmFsdWVGcm9tWEZBICYmIHJvdGF0aW9uID09PSB1bmRlZmluZWQgJiYgZmxhZ3MgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YWx1ZSB8fD0gdGhpcy5kYXRhLmZpZWxkVmFsdWU7CiAgICB9CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCAmJiAhdGhpcy5faGFzVmFsdWVGcm9tWEZBICYmIEFycmF5LmlzQXJyYXkodmFsdWUpICYmIEFycmF5LmlzQXJyYXkodGhpcy5kYXRhLmZpZWxkVmFsdWUpICYmIGlzQXJyYXlFcXVhbCh2YWx1ZSwgdGhpcy5kYXRhLmZpZWxkVmFsdWUpICYmIGZsYWdzID09PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgcm90YXRpb24gPSB0aGlzLnJvdGF0aW9uOwogICAgfQogICAgbGV0IGFwcGVhcmFuY2UgPSBudWxsOwogICAgaWYgKCF0aGlzLl9uZWVkQXBwZWFyYW5jZXMpIHsKICAgICAgYXBwZWFyYW5jZSA9IGF3YWl0IHRoaXMuX2dldEFwcGVhcmFuY2UoZXZhbHVhdG9yLCB0YXNrLCBSZW5kZXJpbmdJbnRlbnRGbGFnLlNBVkUsIGFubm90YXRpb25TdG9yYWdlKTsKICAgICAgaWYgKGFwcGVhcmFuY2UgPT09IG51bGwgJiYgZmxhZ3MgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfSBlbHNlIHt9CiAgICBsZXQgbmVlZEFwcGVhcmFuY2VzID0gZmFsc2U7CiAgICBpZiAoYXBwZWFyYW5jZT8ubmVlZEFwcGVhcmFuY2VzKSB7CiAgICAgIG5lZWRBcHBlYXJhbmNlcyA9IHRydWU7CiAgICAgIGFwcGVhcmFuY2UgPSBudWxsOwogICAgfQogICAgY29uc3QgewogICAgICB4cmVmCiAgICB9ID0gZXZhbHVhdG9yOwogICAgY29uc3Qgb3JpZ2luYWxEaWN0ID0geHJlZi5mZXRjaElmUmVmKHRoaXMucmVmKTsKICAgIGlmICghKG9yaWdpbmFsRGljdCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGRpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIGZvciAoY29uc3Qga2V5IG9mIG9yaWdpbmFsRGljdC5nZXRLZXlzKCkpIHsKICAgICAgaWYgKGtleSAhPT0gIkFQIikgewogICAgICAgIGRpY3Quc2V0KGtleSwgb3JpZ2luYWxEaWN0LmdldFJhdyhrZXkpKTsKICAgICAgfQogICAgfQogICAgaWYgKGZsYWdzICE9PSB1bmRlZmluZWQpIHsKICAgICAgZGljdC5zZXQoIkYiLCBmbGFncyk7CiAgICAgIGlmIChhcHBlYXJhbmNlID09PSBudWxsICYmICFuZWVkQXBwZWFyYW5jZXMpIHsKICAgICAgICBjb25zdCBhcCA9IG9yaWdpbmFsRGljdC5nZXRSYXcoIkFQIik7CiAgICAgICAgaWYgKGFwKSB7CiAgICAgICAgICBkaWN0LnNldCgiQVAiLCBhcCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBjb25zdCB4ZmEgPSB7CiAgICAgIHBhdGg6IHRoaXMuZGF0YS5maWVsZE5hbWUsCiAgICAgIHZhbHVlCiAgICB9OwogICAgY29uc3QgbmV3UGFyZW50RGljdCA9IHRoaXMuc2V0VmFsdWUoZGljdCwgQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5tYXAoc3RyaW5nVG9Bc2NpaU9yVVRGMTZCRSkgOiBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKHZhbHVlKSwgeHJlZiwgY2hhbmdlcyk7CiAgICB0aGlzLmFtZW5kU2F2ZWREaWN0KGFubm90YXRpb25TdG9yYWdlLCBuZXdQYXJlbnREaWN0IHx8IGRpY3QpOwogICAgY29uc3QgbWF5YmVNSyA9IHRoaXMuX2dldE1LRGljdChyb3RhdGlvbik7CiAgICBpZiAobWF5YmVNSykgewogICAgICBkaWN0LnNldCgiTUsiLCBtYXliZU1LKTsKICAgIH0KICAgIGNoYW5nZXMucHV0KHRoaXMucmVmLCB7CiAgICAgIGRhdGE6IGRpY3QsCiAgICAgIHhmYSwKICAgICAgbmVlZEFwcGVhcmFuY2VzCiAgICB9KTsKICAgIGlmIChhcHBlYXJhbmNlICE9PSBudWxsKSB7CiAgICAgIGNvbnN0IG5ld1JlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgIGNvbnN0IEFQID0gbmV3IERpY3QoeHJlZik7CiAgICAgIGRpY3Quc2V0KCJBUCIsIEFQKTsKICAgICAgQVAuc2V0KCJOIiwgbmV3UmVmKTsKICAgICAgY29uc3QgcmVzb3VyY2VzID0gdGhpcy5fZ2V0U2F2ZUZpZWxkUmVzb3VyY2VzKHhyZWYpOwogICAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtID0gbmV3IFN0cmluZ1N0cmVhbShhcHBlYXJhbmNlKTsKICAgICAgY29uc3QgYXBwZWFyYW5jZURpY3QgPSBhcHBlYXJhbmNlU3RyZWFtLmRpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgICAgYXBwZWFyYW5jZURpY3Quc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIkZvcm0iKTsKICAgICAgYXBwZWFyYW5jZURpY3Quc2V0KCJSZXNvdXJjZXMiLCByZXNvdXJjZXMpOwogICAgICBjb25zdCBiYm94ID0gcm90YXRpb24gJSAxODAgPT09IDAgPyBbMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHRdIDogWzAsIDAsIHRoaXMuaGVpZ2h0LCB0aGlzLndpZHRoXTsKICAgICAgYXBwZWFyYW5jZURpY3Quc2V0KCJCQm94IiwgYmJveCk7CiAgICAgIGNvbnN0IHJvdGF0aW9uTWF0cml4ID0gdGhpcy5nZXRSb3RhdGlvbk1hdHJpeChhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICAgIGlmIChyb3RhdGlvbk1hdHJpeCAhPT0gSURFTlRJVFlfTUFUUklYKSB7CiAgICAgICAgYXBwZWFyYW5jZURpY3Quc2V0KCJNYXRyaXgiLCByb3RhdGlvbk1hdHJpeCk7CiAgICAgIH0KICAgICAgY2hhbmdlcy5wdXQobmV3UmVmLCB7CiAgICAgICAgZGF0YTogYXBwZWFyYW5jZVN0cmVhbSwKICAgICAgICB4ZmE6IG51bGwsCiAgICAgICAgbmVlZEFwcGVhcmFuY2VzOiBmYWxzZQogICAgICB9KTsKICAgIH0KICAgIGRpY3Quc2V0KCJNIiwgYEQ6JHtnZXRNb2RpZmljYXRpb25EYXRlKCl9YCk7CiAgfQogIGFzeW5jIF9nZXRBcHBlYXJhbmNlKGV2YWx1YXRvciwgdGFzaywgaW50ZW50LCBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgaWYgKHRoaXMuZGF0YS5wYXNzd29yZCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHN0b3JhZ2VFbnRyeSA9IGFubm90YXRpb25TdG9yYWdlPy5nZXQodGhpcy5kYXRhLmlkKTsKICAgIGxldCB2YWx1ZSwgcm90YXRpb247CiAgICBpZiAoc3RvcmFnZUVudHJ5KSB7CiAgICAgIHZhbHVlID0gc3RvcmFnZUVudHJ5LmZvcm1hdHRlZFZhbHVlIHx8IHN0b3JhZ2VFbnRyeS52YWx1ZTsKICAgICAgcm90YXRpb24gPSBzdG9yYWdlRW50cnkucm90YXRpb247CiAgICB9CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkICYmICF0aGlzLl9uZWVkQXBwZWFyYW5jZXMpIHsKICAgICAgaWYgKCF0aGlzLl9oYXNWYWx1ZUZyb21YRkEgfHwgdGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuZ2V0Qm9yZGVyQW5kQmFja2dyb3VuZEFwcGVhcmFuY2VzKGFubm90YXRpb25TdG9yYWdlKTsKICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHZhbHVlID0gdGhpcy5kYXRhLmZpZWxkVmFsdWU7CiAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICByZXR1cm4gYC9UeCBCTUMgcSAke2NvbG9yc31RIEVNQ2A7CiAgICAgIH0KICAgIH0KICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDEpIHsKICAgICAgdmFsdWUgPSB2YWx1ZVswXTsKICAgIH0KICAgIGFzc2VydCh0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciLCAiRXhwZWN0ZWQgYHZhbHVlYCB0byBiZSBhIHN0cmluZy4iKTsKICAgIHZhbHVlID0gdmFsdWUudHJpbUVuZCgpOwogICAgaWYgKHRoaXMuZGF0YS5jb21ibykgewogICAgICBjb25zdCBvcHRpb24gPSB0aGlzLmRhdGEub3B0aW9ucy5maW5kKCh7CiAgICAgICAgZXhwb3J0VmFsdWUKICAgICAgfSkgPT4gdmFsdWUgPT09IGV4cG9ydFZhbHVlKTsKICAgICAgdmFsdWUgPSBvcHRpb24/LmRpc3BsYXlWYWx1ZSB8fCB2YWx1ZTsKICAgIH0KICAgIGlmICh2YWx1ZSA9PT0gIiIpIHsKICAgICAgcmV0dXJuIGAvVHggQk1DIHEgJHtjb2xvcnN9USBFTUNgOwogICAgfQogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgcm90YXRpb24gPSB0aGlzLnJvdGF0aW9uOwogICAgfQogICAgbGV0IGxpbmVDb3VudCA9IC0xOwogICAgbGV0IGxpbmVzOwogICAgaWYgKHRoaXMuZGF0YS5tdWx0aUxpbmUpIHsKICAgICAgbGluZXMgPSB2YWx1ZS5zcGxpdCgvXHJcbj98XG4vKS5tYXAobGluZSA9PiBsaW5lLm5vcm1hbGl6ZSgiTkZDIikpOwogICAgICBsaW5lQ291bnQgPSBsaW5lcy5sZW5ndGg7CiAgICB9IGVsc2UgewogICAgICBsaW5lcyA9IFt2YWx1ZS5yZXBsYWNlKC9cclxuP3xcbi8sICIiKS5ub3JtYWxpemUoIk5GQyIpXTsKICAgIH0KICAgIGNvbnN0IGRlZmF1bHRQYWRkaW5nID0gMTsKICAgIGNvbnN0IGRlZmF1bHRIUGFkZGluZyA9IDI7CiAgICBsZXQgewogICAgICB3aWR0aDogdG90YWxXaWR0aCwKICAgICAgaGVpZ2h0OiB0b3RhbEhlaWdodAogICAgfSA9IHRoaXM7CiAgICBpZiAocm90YXRpb24gPT09IDkwIHx8IHJvdGF0aW9uID09PSAyNzApIHsKICAgICAgW3RvdGFsV2lkdGgsIHRvdGFsSGVpZ2h0XSA9IFt0b3RhbEhlaWdodCwgdG90YWxXaWR0aF07CiAgICB9CiAgICBpZiAoIXRoaXMuX2RlZmF1bHRBcHBlYXJhbmNlKSB7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEgPSBwYXJzZURlZmF1bHRBcHBlYXJhbmNlKHRoaXMuX2RlZmF1bHRBcHBlYXJhbmNlID0gIi9IZWx2ZXRpY2EgMCBUZiAwIGciKTsKICAgIH0KICAgIGxldCBmb250ID0gYXdhaXQgV2lkZ2V0QW5ub3RhdGlvbi5fZ2V0Rm9udERhdGEoZXZhbHVhdG9yLCB0YXNrLCB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhLCB0aGlzLl9maWVsZFJlc291cmNlcy5tZXJnZWRSZXNvdXJjZXMpOwogICAgbGV0IGRlZmF1bHRBcHBlYXJhbmNlLCBmb250U2l6ZSwgbGluZUhlaWdodDsKICAgIGNvbnN0IGVuY29kZWRMaW5lcyA9IFtdOwogICAgbGV0IGVuY29kaW5nRXJyb3IgPSBmYWxzZTsKICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykgewogICAgICBjb25zdCBlbmNvZGVkU3RyaW5nID0gZm9udC5lbmNvZGVTdHJpbmcobGluZSk7CiAgICAgIGlmIChlbmNvZGVkU3RyaW5nLmxlbmd0aCA+IDEpIHsKICAgICAgICBlbmNvZGluZ0Vycm9yID0gdHJ1ZTsKICAgICAgfQogICAgICBlbmNvZGVkTGluZXMucHVzaChlbmNvZGVkU3RyaW5nLmpvaW4oIiIpKTsKICAgIH0KICAgIGlmIChlbmNvZGluZ0Vycm9yICYmIGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuU0FWRSkgewogICAgICByZXR1cm4gewogICAgICAgIG5lZWRBcHBlYXJhbmNlczogdHJ1ZQogICAgICB9OwogICAgfQogICAgaWYgKGVuY29kaW5nRXJyb3IgJiYgdGhpcy5faXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpIHsKICAgICAgY29uc3QgZm9udEZhbWlseSA9IHRoaXMuZGF0YS5jb21iID8gIm1vbm9zcGFjZSIgOiAic2Fucy1zZXJpZiI7CiAgICAgIGNvbnN0IGZha2VVbmljb2RlRm9udCA9IG5ldyBGYWtlVW5pY29kZUZvbnQoZXZhbHVhdG9yLnhyZWYsIGZvbnRGYW1pbHkpOwogICAgICBjb25zdCByZXNvdXJjZXMgPSBmYWtlVW5pY29kZUZvbnQuY3JlYXRlRm9udFJlc291cmNlcyhsaW5lcy5qb2luKCIiKSk7CiAgICAgIGNvbnN0IG5ld0ZvbnQgPSByZXNvdXJjZXMuZ2V0UmF3KCJGb250Iik7CiAgICAgIGlmICh0aGlzLl9maWVsZFJlc291cmNlcy5tZXJnZWRSZXNvdXJjZXMuaGFzKCJGb250IikpIHsKICAgICAgICBjb25zdCBvbGRGb250ID0gdGhpcy5fZmllbGRSZXNvdXJjZXMubWVyZ2VkUmVzb3VyY2VzLmdldCgiRm9udCIpOwogICAgICAgIGZvciAoY29uc3Qga2V5IG9mIG5ld0ZvbnQuZ2V0S2V5cygpKSB7CiAgICAgICAgICBvbGRGb250LnNldChrZXksIG5ld0ZvbnQuZ2V0UmF3KGtleSkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9maWVsZFJlc291cmNlcy5tZXJnZWRSZXNvdXJjZXMuc2V0KCJGb250IiwgbmV3Rm9udCk7CiAgICAgIH0KICAgICAgY29uc3QgZm9udE5hbWUgPSBmYWtlVW5pY29kZUZvbnQuZm9udE5hbWUubmFtZTsKICAgICAgZm9udCA9IGF3YWl0IFdpZGdldEFubm90YXRpb24uX2dldEZvbnREYXRhKGV2YWx1YXRvciwgdGFzaywgewogICAgICAgIGZvbnROYW1lLAogICAgICAgIGZvbnRTaXplOiAwCiAgICAgIH0sIHJlc291cmNlcyk7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGVuY29kZWRMaW5lcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgZW5jb2RlZExpbmVzW2ldID0gc3RyaW5nVG9VVEYxNlN0cmluZyhsaW5lc1tpXSk7CiAgICAgIH0KICAgICAgY29uc3Qgc2F2ZWREZWZhdWx0QXBwZWFyYW5jZSA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShudWxsKSwgdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YSk7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEuZm9udFNpemUgPSAwOwogICAgICB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhLmZvbnROYW1lID0gZm9udE5hbWU7CiAgICAgIFtkZWZhdWx0QXBwZWFyYW5jZSwgZm9udFNpemUsIGxpbmVIZWlnaHRdID0gdGhpcy5fY29tcHV0ZUZvbnRTaXplKHRvdGFsSGVpZ2h0IC0gMiAqIGRlZmF1bHRQYWRkaW5nLCB0b3RhbFdpZHRoIC0gMiAqIGRlZmF1bHRIUGFkZGluZywgdmFsdWUsIGZvbnQsIGxpbmVDb3VudCk7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEgPSBzYXZlZERlZmF1bHRBcHBlYXJhbmNlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCF0aGlzLl9pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCkgewogICAgICAgIHdhcm4oIl9nZXRBcHBlYXJhbmNlOiBPZmZzY3JlZW5DYW52YXMgaXMgbm90IHN1cHBvcnRlZCwgYW5ub3RhdGlvbiBtYXkgbm90IHJlbmRlciBjb3JyZWN0bHkuIik7CiAgICAgIH0KICAgICAgW2RlZmF1bHRBcHBlYXJhbmNlLCBmb250U2l6ZSwgbGluZUhlaWdodF0gPSB0aGlzLl9jb21wdXRlRm9udFNpemUodG90YWxIZWlnaHQgLSAyICogZGVmYXVsdFBhZGRpbmcsIHRvdGFsV2lkdGggLSAyICogZGVmYXVsdEhQYWRkaW5nLCB2YWx1ZSwgZm9udCwgbGluZUNvdW50KTsKICAgIH0KICAgIGxldCBkZXNjZW50ID0gZm9udC5kZXNjZW50OwogICAgaWYgKGlzTmFOKGRlc2NlbnQpKSB7CiAgICAgIGRlc2NlbnQgPSBCQVNFTElORV9GQUNUT1IgKiBsaW5lSGVpZ2h0OwogICAgfSBlbHNlIHsKICAgICAgZGVzY2VudCA9IE1hdGgubWF4KEJBU0VMSU5FX0ZBQ1RPUiAqIGxpbmVIZWlnaHQsIE1hdGguYWJzKGRlc2NlbnQpICogZm9udFNpemUpOwogICAgfQogICAgY29uc3QgZGVmYXVsdFZQYWRkaW5nID0gTWF0aC5taW4oTWF0aC5mbG9vcigodG90YWxIZWlnaHQgLSBmb250U2l6ZSkgLyAyKSwgZGVmYXVsdFBhZGRpbmcpOwogICAgY29uc3QgYWxpZ25tZW50ID0gdGhpcy5kYXRhLnRleHRBbGlnbm1lbnQ7CiAgICBpZiAodGhpcy5kYXRhLm11bHRpTGluZSkgewogICAgICByZXR1cm4gdGhpcy5fZ2V0TXVsdGlsaW5lQXBwZWFyYW5jZShkZWZhdWx0QXBwZWFyYW5jZSwgZW5jb2RlZExpbmVzLCBmb250LCBmb250U2l6ZSwgdG90YWxXaWR0aCwgdG90YWxIZWlnaHQsIGFsaWdubWVudCwgZGVmYXVsdEhQYWRkaW5nLCBkZWZhdWx0VlBhZGRpbmcsIGRlc2NlbnQsIGxpbmVIZWlnaHQsIGFubm90YXRpb25TdG9yYWdlKTsKICAgIH0KICAgIGlmICh0aGlzLmRhdGEuY29tYikgewogICAgICByZXR1cm4gdGhpcy5fZ2V0Q29tYkFwcGVhcmFuY2UoZGVmYXVsdEFwcGVhcmFuY2UsIGZvbnQsIGVuY29kZWRMaW5lc1swXSwgZm9udFNpemUsIHRvdGFsV2lkdGgsIHRvdGFsSGVpZ2h0LCBkZWZhdWx0SFBhZGRpbmcsIGRlZmF1bHRWUGFkZGluZywgZGVzY2VudCwgbGluZUhlaWdodCwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgfQogICAgY29uc3QgYm90dG9tUGFkZGluZyA9IGRlZmF1bHRWUGFkZGluZyArIGRlc2NlbnQ7CiAgICBpZiAoYWxpZ25tZW50ID09PSAwIHx8IGFsaWdubWVudCA+IDIpIHsKICAgICAgcmV0dXJuIGAvVHggQk1DIHEgJHtjb2xvcnN9QlQgYCArIGRlZmF1bHRBcHBlYXJhbmNlICsgYCAxIDAgMCAxICR7bnVtYmVyVG9TdHJpbmcoZGVmYXVsdEhQYWRkaW5nKX0gJHtudW1iZXJUb1N0cmluZyhib3R0b21QYWRkaW5nKX0gVG0gKCR7ZXNjYXBlU3RyaW5nKGVuY29kZWRMaW5lc1swXSl9KSBUamAgKyAiIEVUIFEgRU1DIjsKICAgIH0KICAgIGNvbnN0IHByZXZJbmZvID0gewogICAgICBzaGlmdDogMAogICAgfTsKICAgIGNvbnN0IHJlbmRlcmVkVGV4dCA9IHRoaXMuX3JlbmRlclRleHQoZW5jb2RlZExpbmVzWzBdLCBmb250LCBmb250U2l6ZSwgdG90YWxXaWR0aCwgYWxpZ25tZW50LCBwcmV2SW5mbywgZGVmYXVsdEhQYWRkaW5nLCBib3R0b21QYWRkaW5nKTsKICAgIHJldHVybiBgL1R4IEJNQyBxICR7Y29sb3JzfUJUIGAgKyBkZWZhdWx0QXBwZWFyYW5jZSArIGAgMSAwIDAgMSAwIDAgVG0gJHtyZW5kZXJlZFRleHR9YCArICIgRVQgUSBFTUMiOwogIH0KICBzdGF0aWMgYXN5bmMgX2dldEZvbnREYXRhKGV2YWx1YXRvciwgdGFzaywgYXBwZWFyYW5jZURhdGEsIHJlc291cmNlcykgewogICAgY29uc3Qgb3BlcmF0b3JMaXN0ID0gbmV3IE9wZXJhdG9yTGlzdCgpOwogICAgY29uc3QgaW5pdGlhbFN0YXRlID0gewogICAgICBmb250OiBudWxsLAogICAgICBjbG9uZSgpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IHsKICAgICAgZm9udE5hbWUsCiAgICAgIGZvbnRTaXplCiAgICB9ID0gYXBwZWFyYW5jZURhdGE7CiAgICBhd2FpdCBldmFsdWF0b3IuaGFuZGxlU2V0Rm9udChyZXNvdXJjZXMsIFtmb250TmFtZSAmJiBOYW1lLmdldChmb250TmFtZSksIGZvbnRTaXplXSwgbnVsbCwgb3BlcmF0b3JMaXN0LCB0YXNrLCBpbml0aWFsU3RhdGUsIG51bGwpOwogICAgcmV0dXJuIGluaXRpYWxTdGF0ZS5mb250OwogIH0KICBfZ2V0VGV4dFdpZHRoKHRleHQsIGZvbnQpIHsKICAgIHJldHVybiBNYXRoLnN1bVByZWNpc2UoZm9udC5jaGFyc1RvR2x5cGhzKHRleHQpLm1hcChnID0+IGcud2lkdGgpKSAvIDEwMDA7CiAgfQogIF9jb21wdXRlRm9udFNpemUoaGVpZ2h0LCB3aWR0aCwgdGV4dCwgZm9udCwgbGluZUNvdW50KSB7CiAgICBsZXQgewogICAgICBmb250U2l6ZQogICAgfSA9IHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGE7CiAgICBsZXQgbGluZUhlaWdodCA9IChmb250U2l6ZSB8fCAxMikgKiBMSU5FX0ZBQ1RPUiwKICAgICAgbnVtYmVyT2ZMaW5lcyA9IE1hdGgucm91bmQoaGVpZ2h0IC8gbGluZUhlaWdodCk7CiAgICBpZiAoIWZvbnRTaXplKSB7CiAgICAgIGNvbnN0IHJvdW5kV2l0aFR3b0RpZ2l0cyA9IHggPT4gTWF0aC5mbG9vcih4ICogMTAwKSAvIDEwMDsKICAgICAgaWYgKGxpbmVDb3VudCA9PT0gLTEpIHsKICAgICAgICBjb25zdCB0ZXh0V2lkdGggPSB0aGlzLl9nZXRUZXh0V2lkdGgodGV4dCwgZm9udCk7CiAgICAgICAgZm9udFNpemUgPSByb3VuZFdpdGhUd29EaWdpdHMoTWF0aC5taW4oaGVpZ2h0IC8gTElORV9GQUNUT1IsIHdpZHRoIC8gdGV4dFdpZHRoKSk7CiAgICAgICAgbnVtYmVyT2ZMaW5lcyA9IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgbGluZXMgPSB0ZXh0LnNwbGl0KC9cclxuP3xcbi8pOwogICAgICAgIGNvbnN0IGNhY2hlZExpbmVzID0gW107CiAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7CiAgICAgICAgICBjb25zdCBlbmNvZGVkID0gZm9udC5lbmNvZGVTdHJpbmcobGluZSkuam9pbigiIik7CiAgICAgICAgICBjb25zdCBnbHlwaHMgPSBmb250LmNoYXJzVG9HbHlwaHMoZW5jb2RlZCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbnMgPSBmb250LmdldENoYXJQb3NpdGlvbnMoZW5jb2RlZCk7CiAgICAgICAgICBjYWNoZWRMaW5lcy5wdXNoKHsKICAgICAgICAgICAgbGluZTogZW5jb2RlZCwKICAgICAgICAgICAgZ2x5cGhzLAogICAgICAgICAgICBwb3NpdGlvbnMKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBjb25zdCBpc1Rvb0JpZyA9IGZzaXplID0+IHsKICAgICAgICAgIGxldCB0b3RhbEhlaWdodCA9IDA7CiAgICAgICAgICBmb3IgKGNvbnN0IGNhY2hlIG9mIGNhY2hlZExpbmVzKSB7CiAgICAgICAgICAgIGNvbnN0IGNodW5rcyA9IHRoaXMuX3NwbGl0TGluZShudWxsLCBmb250LCBmc2l6ZSwgd2lkdGgsIGNhY2hlKTsKICAgICAgICAgICAgdG90YWxIZWlnaHQgKz0gY2h1bmtzLmxlbmd0aCAqIGZzaXplOwogICAgICAgICAgICBpZiAodG90YWxIZWlnaHQgPiBoZWlnaHQpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH07CiAgICAgICAgbnVtYmVyT2ZMaW5lcyA9IE1hdGgubWF4KG51bWJlck9mTGluZXMsIGxpbmVDb3VudCk7CiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgIGxpbmVIZWlnaHQgPSBoZWlnaHQgLyBudW1iZXJPZkxpbmVzOwogICAgICAgICAgZm9udFNpemUgPSByb3VuZFdpdGhUd29EaWdpdHMobGluZUhlaWdodCAvIExJTkVfRkFDVE9SKTsKICAgICAgICAgIGlmIChpc1Rvb0JpZyhmb250U2l6ZSkpIHsKICAgICAgICAgICAgbnVtYmVyT2ZMaW5lcysrOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCB7CiAgICAgICAgZm9udE5hbWUsCiAgICAgICAgZm9udENvbG9yCiAgICAgIH0gPSB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhOwogICAgICB0aGlzLl9kZWZhdWx0QXBwZWFyYW5jZSA9IGNyZWF0ZURlZmF1bHRBcHBlYXJhbmNlKHsKICAgICAgICBmb250U2l6ZSwKICAgICAgICBmb250TmFtZSwKICAgICAgICBmb250Q29sb3IKICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gW3RoaXMuX2RlZmF1bHRBcHBlYXJhbmNlLCBmb250U2l6ZSwgaGVpZ2h0IC8gbnVtYmVyT2ZMaW5lc107CiAgfQogIF9yZW5kZXJUZXh0KHRleHQsIGZvbnQsIGZvbnRTaXplLCB0b3RhbFdpZHRoLCBhbGlnbm1lbnQsIHByZXZJbmZvLCBoUGFkZGluZywgdlBhZGRpbmcpIHsKICAgIGxldCBzaGlmdDsKICAgIGlmIChhbGlnbm1lbnQgPT09IDEpIHsKICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLl9nZXRUZXh0V2lkdGgodGV4dCwgZm9udCkgKiBmb250U2l6ZTsKICAgICAgc2hpZnQgPSAodG90YWxXaWR0aCAtIHdpZHRoKSAvIDI7CiAgICB9IGVsc2UgaWYgKGFsaWdubWVudCA9PT0gMikgewogICAgICBjb25zdCB3aWR0aCA9IHRoaXMuX2dldFRleHRXaWR0aCh0ZXh0LCBmb250KSAqIGZvbnRTaXplOwogICAgICBzaGlmdCA9IHRvdGFsV2lkdGggLSB3aWR0aCAtIGhQYWRkaW5nOwogICAgfSBlbHNlIHsKICAgICAgc2hpZnQgPSBoUGFkZGluZzsKICAgIH0KICAgIGNvbnN0IHNoaWZ0U3RyID0gbnVtYmVyVG9TdHJpbmcoc2hpZnQgLSBwcmV2SW5mby5zaGlmdCk7CiAgICBwcmV2SW5mby5zaGlmdCA9IHNoaWZ0OwogICAgdlBhZGRpbmcgPSBudW1iZXJUb1N0cmluZyh2UGFkZGluZyk7CiAgICByZXR1cm4gYCR7c2hpZnRTdHJ9ICR7dlBhZGRpbmd9IFRkICgke2VzY2FwZVN0cmluZyh0ZXh0KX0pIFRqYDsKICB9CiAgX2dldFNhdmVGaWVsZFJlc291cmNlcyh4cmVmKSB7CiAgICBjb25zdCB7CiAgICAgIGxvY2FsUmVzb3VyY2VzLAogICAgICBhcHBlYXJhbmNlUmVzb3VyY2VzLAogICAgICBhY3JvRm9ybVJlc291cmNlcwogICAgfSA9IHRoaXMuX2ZpZWxkUmVzb3VyY2VzOwogICAgY29uc3QgZm9udE5hbWUgPSB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhPy5mb250TmFtZTsKICAgIGlmICghZm9udE5hbWUpIHsKICAgICAgcmV0dXJuIGxvY2FsUmVzb3VyY2VzIHx8IERpY3QuZW1wdHk7CiAgICB9CiAgICBmb3IgKGNvbnN0IHJlc291cmNlcyBvZiBbbG9jYWxSZXNvdXJjZXMsIGFwcGVhcmFuY2VSZXNvdXJjZXNdKSB7CiAgICAgIGlmIChyZXNvdXJjZXMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgY29uc3QgbG9jYWxGb250ID0gcmVzb3VyY2VzLmdldCgiRm9udCIpOwogICAgICAgIGlmIChsb2NhbEZvbnQgaW5zdGFuY2VvZiBEaWN0ICYmIGxvY2FsRm9udC5oYXMoZm9udE5hbWUpKSB7CiAgICAgICAgICByZXR1cm4gcmVzb3VyY2VzOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKGFjcm9Gb3JtUmVzb3VyY2VzIGluc3RhbmNlb2YgRGljdCkgewogICAgICBjb25zdCBhY3JvRm9ybUZvbnQgPSBhY3JvRm9ybVJlc291cmNlcy5nZXQoIkZvbnQiKTsKICAgICAgaWYgKGFjcm9Gb3JtRm9udCBpbnN0YW5jZW9mIERpY3QgJiYgYWNyb0Zvcm1Gb250Lmhhcyhmb250TmFtZSkpIHsKICAgICAgICBjb25zdCBzdWJGb250RGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgICAgIHN1YkZvbnREaWN0LnNldChmb250TmFtZSwgYWNyb0Zvcm1Gb250LmdldFJhdyhmb250TmFtZSkpOwogICAgICAgIGNvbnN0IHN1YlJlc291cmNlc0RpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgICAgICBzdWJSZXNvdXJjZXNEaWN0LnNldCgiRm9udCIsIHN1YkZvbnREaWN0KTsKICAgICAgICByZXR1cm4gRGljdC5tZXJnZSh7CiAgICAgICAgICB4cmVmLAogICAgICAgICAgZGljdEFycmF5OiBbc3ViUmVzb3VyY2VzRGljdCwgbG9jYWxSZXNvdXJjZXNdLAogICAgICAgICAgbWVyZ2VTdWJEaWN0czogdHJ1ZQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbG9jYWxSZXNvdXJjZXMgfHwgRGljdC5lbXB0eTsKICB9CiAgZ2V0RmllbGRPYmplY3QoKSB7CiAgICByZXR1cm4gbnVsbDsKICB9Cn0KY2xhc3MgVGV4dFdpZGdldEFubm90YXRpb24gZXh0ZW5kcyBXaWRnZXRBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QKICAgIH0gPSBwYXJhbXM7CiAgICBpZiAoZGljdC5oYXMoIlBNRCIpKSB7CiAgICAgIHRoaXMuZmxhZ3MgfD0gQW5ub3RhdGlvbkZsYWcuSElEREVOOwogICAgICB0aGlzLmRhdGEuaGlkZGVuID0gdHJ1ZTsKICAgICAgd2FybigiQmFyY29kZXMgYXJlIG5vdCBzdXBwb3J0ZWQiKTsKICAgIH0KICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEucmVhZE9ubHkgJiYgIXRoaXMuZGF0YS5ub0hUTUw7CiAgICB0aGlzLl9oYXNUZXh0ID0gdHJ1ZTsKICAgIGlmICh0eXBlb2YgdGhpcy5kYXRhLmZpZWxkVmFsdWUgIT09ICJzdHJpbmciKSB7CiAgICAgIHRoaXMuZGF0YS5maWVsZFZhbHVlID0gIiI7CiAgICB9CiAgICBsZXQgYWxpZ25tZW50ID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgICAgIGRpY3QsCiAgICAgIGtleTogIlEiCiAgICB9KTsKICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihhbGlnbm1lbnQpIHx8IGFsaWdubWVudCA8IDAgfHwgYWxpZ25tZW50ID4gMikgewogICAgICBhbGlnbm1lbnQgPSBudWxsOwogICAgfQogICAgdGhpcy5kYXRhLnRleHRBbGlnbm1lbnQgPSBhbGlnbm1lbnQ7CiAgICBsZXQgbWF4aW11bUxlbmd0aCA9IGdldEluaGVyaXRhYmxlUHJvcGVydHkoewogICAgICBkaWN0LAogICAgICBrZXk6ICJNYXhMZW4iCiAgICB9KTsKICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihtYXhpbXVtTGVuZ3RoKSB8fCBtYXhpbXVtTGVuZ3RoIDwgMCkgewogICAgICBtYXhpbXVtTGVuZ3RoID0gMDsKICAgIH0KICAgIHRoaXMuZGF0YS5tYXhMZW4gPSBtYXhpbXVtTGVuZ3RoOwogICAgdGhpcy5kYXRhLm11bHRpTGluZSA9IHRoaXMuaGFzRmllbGRGbGFnKEFubm90YXRpb25GaWVsZEZsYWcuTVVMVElMSU5FKTsKICAgIHRoaXMuZGF0YS5jb21iID0gdGhpcy5oYXNGaWVsZEZsYWcoQW5ub3RhdGlvbkZpZWxkRmxhZy5DT01CKSAmJiAhdGhpcy5kYXRhLm11bHRpTGluZSAmJiAhdGhpcy5kYXRhLnBhc3N3b3JkICYmICF0aGlzLmhhc0ZpZWxkRmxhZyhBbm5vdGF0aW9uRmllbGRGbGFnLkZJTEVTRUxFQ1QpICYmIHRoaXMuZGF0YS5tYXhMZW4gIT09IDA7CiAgICB0aGlzLmRhdGEuZG9Ob3RTY3JvbGwgPSB0aGlzLmhhc0ZpZWxkRmxhZyhBbm5vdGF0aW9uRmllbGRGbGFnLkRPTk9UU0NST0xMKTsKICAgIGNvbnN0IHsKICAgICAgZGF0YTogewogICAgICAgIGFjdGlvbnMKICAgICAgfQogICAgfSA9IHRoaXM7CiAgICBpZiAoIWFjdGlvbnMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgQUZEYXRlVGltZSA9IC9eQUYoRGF0ZXxUaW1lKV8oPzpLZXlzdHJva2V8Rm9ybWF0KSg/OkV4KT9cKFsnIl0/KFteJyJdKylbJyJdP1wpOyQvOwogICAgbGV0IGNhblVzZUhUTUxEYXRlVGltZSA9IGZhbHNlOwogICAgaWYgKGFjdGlvbnMuRm9ybWF0Py5sZW5ndGggPT09IDEgJiYgYWN0aW9ucy5LZXlzdHJva2U/Lmxlbmd0aCA9PT0gMSAmJiBBRkRhdGVUaW1lLnRlc3QoYWN0aW9ucy5Gb3JtYXRbMF0pICYmIEFGRGF0ZVRpbWUudGVzdChhY3Rpb25zLktleXN0cm9rZVswXSkgfHwgYWN0aW9ucy5Gb3JtYXQ/Lmxlbmd0aCA9PT0gMCAmJiBhY3Rpb25zLktleXN0cm9rZT8ubGVuZ3RoID09PSAxICYmIEFGRGF0ZVRpbWUudGVzdChhY3Rpb25zLktleXN0cm9rZVswXSkgfHwgYWN0aW9ucy5LZXlzdHJva2U/Lmxlbmd0aCA9PT0gMCAmJiBhY3Rpb25zLkZvcm1hdD8ubGVuZ3RoID09PSAxICYmIEFGRGF0ZVRpbWUudGVzdChhY3Rpb25zLkZvcm1hdFswXSkpIHsKICAgICAgY2FuVXNlSFRNTERhdGVUaW1lID0gdHJ1ZTsKICAgIH0KICAgIGNvbnN0IGFjdGlvbnNUb1Zpc2l0ID0gW107CiAgICBpZiAoYWN0aW9ucy5Gb3JtYXQpIHsKICAgICAgYWN0aW9uc1RvVmlzaXQucHVzaCguLi5hY3Rpb25zLkZvcm1hdCk7CiAgICB9CiAgICBpZiAoYWN0aW9ucy5LZXlzdHJva2UpIHsKICAgICAgYWN0aW9uc1RvVmlzaXQucHVzaCguLi5hY3Rpb25zLktleXN0cm9rZSk7CiAgICB9CiAgICBpZiAoY2FuVXNlSFRNTERhdGVUaW1lKSB7CiAgICAgIGRlbGV0ZSBhY3Rpb25zLktleXN0cm9rZTsKICAgICAgYWN0aW9ucy5Gb3JtYXQgPSBhY3Rpb25zVG9WaXNpdDsKICAgIH0KICAgIGZvciAoY29uc3QgZm9ybWF0QWN0aW9uIG9mIGFjdGlvbnNUb1Zpc2l0KSB7CiAgICAgIGNvbnN0IG0gPSBmb3JtYXRBY3Rpb24ubWF0Y2goQUZEYXRlVGltZSk7CiAgICAgIGlmICghbSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGlzRGF0ZSA9IG1bMV0gPT09ICJEYXRlIjsKICAgICAgbGV0IGZvcm1hdCA9IG1bMl07CiAgICAgIGNvbnN0IG51bSA9IHBhcnNlSW50KGZvcm1hdCwgMTApOwogICAgICBpZiAoIWlzTmFOKG51bSkgJiYgTWF0aC5mbG9vcihNYXRoLmxvZzEwKG51bSkpICsgMSA9PT0gbVsyXS5sZW5ndGgpIHsKICAgICAgICBmb3JtYXQgPSAoaXNEYXRlID8gRGF0ZUZvcm1hdHMgOiBUaW1lRm9ybWF0cylbbnVtXSA/PyBmb3JtYXQ7CiAgICAgIH0KICAgICAgdGhpcy5kYXRhLmRhdGV0aW1lRm9ybWF0ID0gZm9ybWF0OwogICAgICBpZiAoIWNhblVzZUhUTUxEYXRlVGltZSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmIChpc0RhdGUpIHsKICAgICAgICBpZiAoL0hIfE1NfHNzfGgvLnRlc3QoZm9ybWF0KSkgewogICAgICAgICAgdGhpcy5kYXRhLmRhdGV0aW1lVHlwZSA9ICJkYXRldGltZS1sb2NhbCI7CiAgICAgICAgICB0aGlzLmRhdGEudGltZVN0ZXAgPSAvc3MvLnRlc3QoZm9ybWF0KSA/IDEgOiA2MDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5kYXRhLmRhdGV0aW1lVHlwZSA9ICJkYXRlIjsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgdGhpcy5kYXRhLmRhdGV0aW1lVHlwZSA9ICJ0aW1lIjsKICAgICAgdGhpcy5kYXRhLnRpbWVTdGVwID0gL3NzLy50ZXN0KGZvcm1hdCkgPyAxIDogNjA7CiAgICAgIGJyZWFrOwogICAgfQogIH0KICBnZXQgaGFzVGV4dENvbnRlbnQoKSB7CiAgICByZXR1cm4gISF0aGlzLmFwcGVhcmFuY2UgJiYgIXRoaXMuX25lZWRBcHBlYXJhbmNlczsKICB9CiAgX2dldENvbWJBcHBlYXJhbmNlKGRlZmF1bHRBcHBlYXJhbmNlLCBmb250LCB0ZXh0LCBmb250U2l6ZSwgd2lkdGgsIGhlaWdodCwgaFBhZGRpbmcsIHZQYWRkaW5nLCBkZXNjZW50LCBsaW5lSGVpZ2h0LCBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgY29uc3QgY29tYldpZHRoID0gd2lkdGggLyB0aGlzLmRhdGEubWF4TGVuOwogICAgY29uc3QgY29sb3JzID0gdGhpcy5nZXRCb3JkZXJBbmRCYWNrZ3JvdW5kQXBwZWFyYW5jZXMoYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgY29uc3QgYnVmID0gW107CiAgICBjb25zdCBwb3NpdGlvbnMgPSBmb250LmdldENoYXJQb3NpdGlvbnModGV4dCk7CiAgICBmb3IgKGNvbnN0IFtzdGFydCwgZW5kXSBvZiBwb3NpdGlvbnMpIHsKICAgICAgYnVmLnB1c2goYCgke2VzY2FwZVN0cmluZyh0ZXh0LnN1YnN0cmluZyhzdGFydCwgZW5kKSl9KSBUamApOwogICAgfQogICAgY29uc3QgcmVuZGVyZWRDb21iID0gYnVmLmpvaW4oYCAke251bWJlclRvU3RyaW5nKGNvbWJXaWR0aCl9IDAgVGQgYCk7CiAgICByZXR1cm4gYC9UeCBCTUMgcSAke2NvbG9yc31CVCBgICsgZGVmYXVsdEFwcGVhcmFuY2UgKyBgIDEgMCAwIDEgJHtudW1iZXJUb1N0cmluZyhoUGFkZGluZyl9ICR7bnVtYmVyVG9TdHJpbmcodlBhZGRpbmcgKyBkZXNjZW50KX0gVG0gJHtyZW5kZXJlZENvbWJ9YCArICIgRVQgUSBFTUMiOwogIH0KICBfZ2V0TXVsdGlsaW5lQXBwZWFyYW5jZShkZWZhdWx0QXBwZWFyYW5jZSwgbGluZXMsIGZvbnQsIGZvbnRTaXplLCB3aWR0aCwgaGVpZ2h0LCBhbGlnbm1lbnQsIGhQYWRkaW5nLCB2UGFkZGluZywgZGVzY2VudCwgbGluZUhlaWdodCwgYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIGNvbnN0IGJ1ZiA9IFtdOwogICAgY29uc3QgdG90YWxXaWR0aCA9IHdpZHRoIC0gMiAqIGhQYWRkaW5nOwogICAgY29uc3QgcHJldkluZm8gPSB7CiAgICAgIHNoaWZ0OiAwCiAgICB9OwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gbGluZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBsaW5lID0gbGluZXNbaV07CiAgICAgIGNvbnN0IGNodW5rcyA9IHRoaXMuX3NwbGl0TGluZShsaW5lLCBmb250LCBmb250U2l6ZSwgdG90YWxXaWR0aCk7CiAgICAgIGZvciAobGV0IGogPSAwLCBqaiA9IGNodW5rcy5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgY29uc3QgY2h1bmsgPSBjaHVua3Nbal07CiAgICAgICAgY29uc3QgdlNoaWZ0ID0gaSA9PT0gMCAmJiBqID09PSAwID8gLXZQYWRkaW5nIC0gKGxpbmVIZWlnaHQgLSBkZXNjZW50KSA6IC1saW5lSGVpZ2h0OwogICAgICAgIGJ1Zi5wdXNoKHRoaXMuX3JlbmRlclRleHQoY2h1bmssIGZvbnQsIGZvbnRTaXplLCB3aWR0aCwgYWxpZ25tZW50LCBwcmV2SW5mbywgaFBhZGRpbmcsIHZTaGlmdCkpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBjb2xvcnMgPSB0aGlzLmdldEJvcmRlckFuZEJhY2tncm91bmRBcHBlYXJhbmNlcyhhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICBjb25zdCByZW5kZXJlZFRleHQgPSBidWYuam9pbigiXG4iKTsKICAgIHJldHVybiBgL1R4IEJNQyBxICR7Y29sb3JzfUJUIGAgKyBkZWZhdWx0QXBwZWFyYW5jZSArIGAgMSAwIDAgMSAwICR7bnVtYmVyVG9TdHJpbmcoaGVpZ2h0KX0gVG0gJHtyZW5kZXJlZFRleHR9YCArICIgRVQgUSBFTUMiOwogIH0KICBfc3BsaXRMaW5lKGxpbmUsIGZvbnQsIGZvbnRTaXplLCB3aWR0aCwgY2FjaGUgPSB7fSkgewogICAgbGluZSA9IGNhY2hlLmxpbmUgfHwgbGluZTsKICAgIGNvbnN0IGdseXBocyA9IGNhY2hlLmdseXBocyB8fCBmb250LmNoYXJzVG9HbHlwaHMobGluZSk7CiAgICBpZiAoZ2x5cGhzLmxlbmd0aCA8PSAxKSB7CiAgICAgIHJldHVybiBbbGluZV07CiAgICB9CiAgICBjb25zdCBwb3NpdGlvbnMgPSBjYWNoZS5wb3NpdGlvbnMgfHwgZm9udC5nZXRDaGFyUG9zaXRpb25zKGxpbmUpOwogICAgY29uc3Qgc2NhbGUgPSBmb250U2l6ZSAvIDEwMDA7CiAgICBjb25zdCBjaHVua3MgPSBbXTsKICAgIGxldCBsYXN0U3BhY2VQb3NJblN0cmluZ1N0YXJ0ID0gLTEsCiAgICAgIGxhc3RTcGFjZVBvc0luU3RyaW5nRW5kID0gLTEsCiAgICAgIGxhc3RTcGFjZVBvcyA9IC0xLAogICAgICBzdGFydENodW5rID0gMCwKICAgICAgY3VycmVudFdpZHRoID0gMDsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGdseXBocy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IFtzdGFydCwgZW5kXSA9IHBvc2l0aW9uc1tpXTsKICAgICAgY29uc3QgZ2x5cGggPSBnbHlwaHNbaV07CiAgICAgIGNvbnN0IGdseXBoV2lkdGggPSBnbHlwaC53aWR0aCAqIHNjYWxlOwogICAgICBpZiAoZ2x5cGgudW5pY29kZSA9PT0gIiAiKSB7CiAgICAgICAgaWYgKGN1cnJlbnRXaWR0aCArIGdseXBoV2lkdGggPiB3aWR0aCkgewogICAgICAgICAgY2h1bmtzLnB1c2gobGluZS5zdWJzdHJpbmcoc3RhcnRDaHVuaywgc3RhcnQpKTsKICAgICAgICAgIHN0YXJ0Q2h1bmsgPSBzdGFydDsKICAgICAgICAgIGN1cnJlbnRXaWR0aCA9IGdseXBoV2lkdGg7CiAgICAgICAgICBsYXN0U3BhY2VQb3NJblN0cmluZ1N0YXJ0ID0gLTE7CiAgICAgICAgICBsYXN0U3BhY2VQb3MgPSAtMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3VycmVudFdpZHRoICs9IGdseXBoV2lkdGg7CiAgICAgICAgICBsYXN0U3BhY2VQb3NJblN0cmluZ1N0YXJ0ID0gc3RhcnQ7CiAgICAgICAgICBsYXN0U3BhY2VQb3NJblN0cmluZ0VuZCA9IGVuZDsKICAgICAgICAgIGxhc3RTcGFjZVBvcyA9IGk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGN1cnJlbnRXaWR0aCArIGdseXBoV2lkdGggPiB3aWR0aCkgewogICAgICAgIGlmIChsYXN0U3BhY2VQb3NJblN0cmluZ1N0YXJ0ICE9PSAtMSkgewogICAgICAgICAgY2h1bmtzLnB1c2gobGluZS5zdWJzdHJpbmcoc3RhcnRDaHVuaywgbGFzdFNwYWNlUG9zSW5TdHJpbmdFbmQpKTsKICAgICAgICAgIHN0YXJ0Q2h1bmsgPSBsYXN0U3BhY2VQb3NJblN0cmluZ0VuZDsKICAgICAgICAgIGkgPSBsYXN0U3BhY2VQb3MgKyAxOwogICAgICAgICAgbGFzdFNwYWNlUG9zSW5TdHJpbmdTdGFydCA9IC0xOwogICAgICAgICAgY3VycmVudFdpZHRoID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2h1bmtzLnB1c2gobGluZS5zdWJzdHJpbmcoc3RhcnRDaHVuaywgc3RhcnQpKTsKICAgICAgICAgIHN0YXJ0Q2h1bmsgPSBzdGFydDsKICAgICAgICAgIGN1cnJlbnRXaWR0aCA9IGdseXBoV2lkdGg7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGN1cnJlbnRXaWR0aCArPSBnbHlwaFdpZHRoOwogICAgICB9CiAgICB9CiAgICBpZiAoc3RhcnRDaHVuayA8IGxpbmUubGVuZ3RoKSB7CiAgICAgIGNodW5rcy5wdXNoKGxpbmUuc3Vic3RyaW5nKHN0YXJ0Q2h1bmssIGxpbmUubGVuZ3RoKSk7CiAgICB9CiAgICByZXR1cm4gY2h1bmtzOwogIH0KICBhc3luYyBleHRyYWN0VGV4dENvbnRlbnQoZXZhbHVhdG9yLCB0YXNrLCB2aWV3Qm94KSB7CiAgICBhd2FpdCBzdXBlci5leHRyYWN0VGV4dENvbnRlbnQoZXZhbHVhdG9yLCB0YXNrLCB2aWV3Qm94KTsKICAgIGNvbnN0IHRleHQgPSB0aGlzLmRhdGEudGV4dENvbnRlbnQ7CiAgICBpZiAoIXRleHQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgYWxsVGV4dCA9IHRleHQuam9pbigiXG4iKTsKICAgIGlmIChhbGxUZXh0ID09PSB0aGlzLmRhdGEuZmllbGRWYWx1ZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCByZWdleCA9IGFsbFRleHQucmVwbGFjZUFsbCgvKFsuKis/XiR7fSgpfFtcXVxcXSl8KFxzKykvZywgKF9tLCBwMSkgPT4gcDEgPyBgXFwke3AxfWAgOiAiXFxzKyIpOwogICAgaWYgKG5ldyBSZWdFeHAoYF5cXHMqJHtyZWdleH1cXHMqJGApLnRlc3QodGhpcy5kYXRhLmZpZWxkVmFsdWUpKSB7CiAgICAgIHRoaXMuZGF0YS50ZXh0Q29udGVudCA9IHRoaXMuZGF0YS5maWVsZFZhbHVlLnNwbGl0KCJcbiIpOwogICAgfQogIH0KICBnZXRGaWVsZE9iamVjdCgpIHsKICAgIHJldHVybiB7CiAgICAgIGlkOiB0aGlzLmRhdGEuaWQsCiAgICAgIHZhbHVlOiB0aGlzLmRhdGEuZmllbGRWYWx1ZSwKICAgICAgZGVmYXVsdFZhbHVlOiB0aGlzLmRhdGEuZGVmYXVsdEZpZWxkVmFsdWUgfHwgIiIsCiAgICAgIG11bHRpbGluZTogdGhpcy5kYXRhLm11bHRpTGluZSwKICAgICAgcGFzc3dvcmQ6IHRoaXMuZGF0YS5wYXNzd29yZCwKICAgICAgY2hhckxpbWl0OiB0aGlzLmRhdGEubWF4TGVuLAogICAgICBjb21iOiB0aGlzLmRhdGEuY29tYiwKICAgICAgZWRpdGFibGU6ICF0aGlzLmRhdGEucmVhZE9ubHksCiAgICAgIGhpZGRlbjogdGhpcy5kYXRhLmhpZGRlbiwKICAgICAgbmFtZTogdGhpcy5kYXRhLmZpZWxkTmFtZSwKICAgICAgcmVjdDogdGhpcy5kYXRhLnJlY3QsCiAgICAgIGFjdGlvbnM6IHRoaXMuZGF0YS5hY3Rpb25zLAogICAgICBwYWdlOiB0aGlzLmRhdGEucGFnZUluZGV4LAogICAgICBzdHJva2VDb2xvcjogdGhpcy5kYXRhLmJvcmRlckNvbG9yLAogICAgICBmaWxsQ29sb3I6IHRoaXMuZGF0YS5iYWNrZ3JvdW5kQ29sb3IsCiAgICAgIHJvdGF0aW9uOiB0aGlzLnJvdGF0aW9uLAogICAgICBkYXRldGltZUZvcm1hdDogdGhpcy5kYXRhLmRhdGV0aW1lRm9ybWF0LAogICAgICBoYXNEYXRldGltZUhUTUw6ICEhdGhpcy5kYXRhLmRhdGV0aW1lVHlwZSwKICAgICAgdHlwZTogInRleHQiCiAgICB9OwogIH0KfQpjbGFzcyBCdXR0b25XaWRnZXRBbm5vdGF0aW9uIGV4dGVuZHMgV2lkZ2V0QW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgdGhpcy5jaGVja2VkQXBwZWFyYW5jZSA9IG51bGw7CiAgICB0aGlzLnVuY2hlY2tlZEFwcGVhcmFuY2UgPSBudWxsOwogICAgY29uc3QgaXNSYWRpbyA9IHRoaXMuaGFzRmllbGRGbGFnKEFubm90YXRpb25GaWVsZEZsYWcuUkFESU8pLAogICAgICBpc1B1c2hCdXR0b24gPSB0aGlzLmhhc0ZpZWxkRmxhZyhBbm5vdGF0aW9uRmllbGRGbGFnLlBVU0hCVVRUT04pOwogICAgdGhpcy5kYXRhLmNoZWNrQm94ID0gIWlzUmFkaW8gJiYgIWlzUHVzaEJ1dHRvbjsKICAgIHRoaXMuZGF0YS5yYWRpb0J1dHRvbiA9IGlzUmFkaW8gJiYgIWlzUHVzaEJ1dHRvbjsKICAgIHRoaXMuZGF0YS5wdXNoQnV0dG9uID0gaXNQdXNoQnV0dG9uOwogICAgdGhpcy5kYXRhLmlzVG9vbHRpcE9ubHkgPSBmYWxzZTsKICAgIGlmICh0aGlzLmRhdGEuY2hlY2tCb3gpIHsKICAgICAgdGhpcy5fcHJvY2Vzc0NoZWNrQm94KHBhcmFtcyk7CiAgICB9IGVsc2UgaWYgKHRoaXMuZGF0YS5yYWRpb0J1dHRvbikgewogICAgICB0aGlzLl9wcm9jZXNzUmFkaW9CdXR0b24ocGFyYW1zKTsKICAgIH0gZWxzZSBpZiAodGhpcy5kYXRhLnB1c2hCdXR0b24pIHsKICAgICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IHRydWU7CiAgICAgIHRoaXMuZGF0YS5ub0hUTUwgPSBmYWxzZTsKICAgICAgdGhpcy5fcHJvY2Vzc1B1c2hCdXR0b24ocGFyYW1zKTsKICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oIkludmFsaWQgZmllbGQgZmxhZ3MgZm9yIGJ1dHRvbiB3aWRnZXQgYW5ub3RhdGlvbiIpOwogICAgfQogIH0KICBhc3luYyBnZXRPcGVyYXRvckxpc3QoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBpZiAodGhpcy5kYXRhLnB1c2hCdXR0b24pIHsKICAgICAgcmV0dXJuIHN1cGVyLmdldE9wZXJhdG9yTGlzdChldmFsdWF0b3IsIHRhc2ssIGludGVudCwgZmFsc2UsIGFubm90YXRpb25TdG9yYWdlKTsKICAgIH0KICAgIGxldCB2YWx1ZSA9IG51bGw7CiAgICBsZXQgcm90YXRpb24gPSBudWxsOwogICAgaWYgKGFubm90YXRpb25TdG9yYWdlKSB7CiAgICAgIGNvbnN0IHN0b3JhZ2VFbnRyeSA9IGFubm90YXRpb25TdG9yYWdlLmdldCh0aGlzLmRhdGEuaWQpOwogICAgICB2YWx1ZSA9IHN0b3JhZ2VFbnRyeSA/IHN0b3JhZ2VFbnRyeS52YWx1ZSA6IG51bGw7CiAgICAgIHJvdGF0aW9uID0gc3RvcmFnZUVudHJ5ID8gc3RvcmFnZUVudHJ5LnJvdGF0aW9uIDogbnVsbDsKICAgIH0KICAgIGlmICh2YWx1ZSA9PT0gbnVsbCAmJiB0aGlzLmFwcGVhcmFuY2UpIHsKICAgICAgcmV0dXJuIHN1cGVyLmdldE9wZXJhdG9yTGlzdChldmFsdWF0b3IsIHRhc2ssIGludGVudCwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgfQogICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgdmFsdWUgPSB0aGlzLmRhdGEuY2hlY2tCb3ggPyB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9PT0gdGhpcy5kYXRhLmV4cG9ydFZhbHVlIDogdGhpcy5kYXRhLmZpZWxkVmFsdWUgPT09IHRoaXMuZGF0YS5idXR0b25WYWx1ZTsKICAgIH0KICAgIGNvbnN0IGFwcGVhcmFuY2UgPSB2YWx1ZSA/IHRoaXMuY2hlY2tlZEFwcGVhcmFuY2UgOiB0aGlzLnVuY2hlY2tlZEFwcGVhcmFuY2U7CiAgICBpZiAoYXBwZWFyYW5jZSkgewogICAgICBjb25zdCBzYXZlZEFwcGVhcmFuY2UgPSB0aGlzLmFwcGVhcmFuY2U7CiAgICAgIGNvbnN0IHNhdmVkTWF0cml4ID0gbG9va3VwTWF0cml4KGFwcGVhcmFuY2UuZGljdC5nZXRBcnJheSgiTWF0cml4IiksIElERU5USVRZX01BVFJJWCk7CiAgICAgIGlmIChyb3RhdGlvbikgewogICAgICAgIGFwcGVhcmFuY2UuZGljdC5zZXQoIk1hdHJpeCIsIHRoaXMuZ2V0Um90YXRpb25NYXRyaXgoYW5ub3RhdGlvblN0b3JhZ2UpKTsKICAgICAgfQogICAgICB0aGlzLmFwcGVhcmFuY2UgPSBhcHBlYXJhbmNlOwogICAgICBjb25zdCBvcGVyYXRvckxpc3QgPSBzdXBlci5nZXRPcGVyYXRvckxpc3QoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKTsKICAgICAgdGhpcy5hcHBlYXJhbmNlID0gc2F2ZWRBcHBlYXJhbmNlOwogICAgICBhcHBlYXJhbmNlLmRpY3Quc2V0KCJNYXRyaXgiLCBzYXZlZE1hdHJpeCk7CiAgICAgIHJldHVybiBvcGVyYXRvckxpc3Q7CiAgICB9CiAgICByZXR1cm4gewogICAgICBvcExpc3Q6IG5ldyBPcGVyYXRvckxpc3QoKSwKICAgICAgc2VwYXJhdGVGb3JtOiBmYWxzZSwKICAgICAgc2VwYXJhdGVDYW52YXM6IGZhbHNlCiAgICB9OwogIH0KICBhc3luYyBzYXZlKGV2YWx1YXRvciwgdGFzaywgYW5ub3RhdGlvblN0b3JhZ2UsIGNoYW5nZXMpIHsKICAgIGlmICh0aGlzLmRhdGEuY2hlY2tCb3gpIHsKICAgICAgdGhpcy5fc2F2ZUNoZWNrYm94KGV2YWx1YXRvciwgdGFzaywgYW5ub3RhdGlvblN0b3JhZ2UsIGNoYW5nZXMpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy5kYXRhLnJhZGlvQnV0dG9uKSB7CiAgICAgIHRoaXMuX3NhdmVSYWRpb0J1dHRvbihldmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlLCBjaGFuZ2VzKTsKICAgIH0KICB9CiAgYXN5bmMgX3NhdmVDaGVja2JveChldmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlLCBjaGFuZ2VzKSB7CiAgICBpZiAoIWFubm90YXRpb25TdG9yYWdlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHN0b3JhZ2VFbnRyeSA9IGFubm90YXRpb25TdG9yYWdlLmdldCh0aGlzLmRhdGEuaWQpOwogICAgY29uc3QgZmxhZ3MgPSB0aGlzLl9idWlsZEZsYWdzKHN0b3JhZ2VFbnRyeT8ubm9WaWV3LCBzdG9yYWdlRW50cnk/Lm5vUHJpbnQpOwogICAgbGV0IHJvdGF0aW9uID0gc3RvcmFnZUVudHJ5Py5yb3RhdGlvbiwKICAgICAgdmFsdWUgPSBzdG9yYWdlRW50cnk/LnZhbHVlOwogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQgJiYgZmxhZ3MgPT09IHVuZGVmaW5lZCkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9PT0gdGhpcy5kYXRhLmV4cG9ydFZhbHVlOwogICAgICBpZiAoZGVmYXVsdFZhbHVlID09PSB2YWx1ZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgbGV0IGRpY3QgPSBldmFsdWF0b3IueHJlZi5mZXRjaElmUmVmKHRoaXMucmVmKTsKICAgIGlmICghKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBkaWN0ID0gZGljdC5jbG9uZSgpOwogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgcm90YXRpb24gPSB0aGlzLnJvdGF0aW9uOwogICAgfQogICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgdmFsdWUgPSB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9PT0gdGhpcy5kYXRhLmV4cG9ydFZhbHVlOwogICAgfQogICAgY29uc3QgeGZhID0gewogICAgICBwYXRoOiB0aGlzLmRhdGEuZmllbGROYW1lLAogICAgICB2YWx1ZTogdmFsdWUgPyB0aGlzLmRhdGEuZXhwb3J0VmFsdWUgOiAiIgogICAgfTsKICAgIGNvbnN0IG5hbWUgPSBOYW1lLmdldCh2YWx1ZSA/IHRoaXMuZGF0YS5leHBvcnRWYWx1ZSA6ICJPZmYiKTsKICAgIHRoaXMuc2V0VmFsdWUoZGljdCwgbmFtZSwgZXZhbHVhdG9yLnhyZWYsIGNoYW5nZXMpOwogICAgZGljdC5zZXQoIkFTIiwgbmFtZSk7CiAgICBkaWN0LnNldCgiTSIsIGBEOiR7Z2V0TW9kaWZpY2F0aW9uRGF0ZSgpfWApOwogICAgaWYgKGZsYWdzICE9PSB1bmRlZmluZWQpIHsKICAgICAgZGljdC5zZXQoIkYiLCBmbGFncyk7CiAgICB9CiAgICBjb25zdCBtYXliZU1LID0gdGhpcy5fZ2V0TUtEaWN0KHJvdGF0aW9uKTsKICAgIGlmIChtYXliZU1LKSB7CiAgICAgIGRpY3Quc2V0KCJNSyIsIG1heWJlTUspOwogICAgfQogICAgY2hhbmdlcy5wdXQodGhpcy5yZWYsIHsKICAgICAgZGF0YTogZGljdCwKICAgICAgeGZhLAogICAgICBuZWVkQXBwZWFyYW5jZXM6IGZhbHNlCiAgICB9KTsKICB9CiAgYXN5bmMgX3NhdmVSYWRpb0J1dHRvbihldmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlLCBjaGFuZ2VzKSB7CiAgICBpZiAoIWFubm90YXRpb25TdG9yYWdlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHN0b3JhZ2VFbnRyeSA9IGFubm90YXRpb25TdG9yYWdlLmdldCh0aGlzLmRhdGEuaWQpOwogICAgY29uc3QgZmxhZ3MgPSB0aGlzLl9idWlsZEZsYWdzKHN0b3JhZ2VFbnRyeT8ubm9WaWV3LCBzdG9yYWdlRW50cnk/Lm5vUHJpbnQpOwogICAgbGV0IHJvdGF0aW9uID0gc3RvcmFnZUVudHJ5Py5yb3RhdGlvbiwKICAgICAgdmFsdWUgPSBzdG9yYWdlRW50cnk/LnZhbHVlOwogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQgJiYgZmxhZ3MgPT09IHVuZGVmaW5lZCkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9PT0gdGhpcy5kYXRhLmJ1dHRvblZhbHVlOwogICAgICBpZiAoZGVmYXVsdFZhbHVlID09PSB2YWx1ZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgbGV0IGRpY3QgPSBldmFsdWF0b3IueHJlZi5mZXRjaElmUmVmKHRoaXMucmVmKTsKICAgIGlmICghKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBkaWN0ID0gZGljdC5jbG9uZSgpOwogICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgdmFsdWUgPSB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9PT0gdGhpcy5kYXRhLmJ1dHRvblZhbHVlOwogICAgfQogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgcm90YXRpb24gPSB0aGlzLnJvdGF0aW9uOwogICAgfQogICAgY29uc3QgeGZhID0gewogICAgICBwYXRoOiB0aGlzLmRhdGEuZmllbGROYW1lLAogICAgICB2YWx1ZTogdmFsdWUgPyB0aGlzLmRhdGEuYnV0dG9uVmFsdWUgOiAiIgogICAgfTsKICAgIGNvbnN0IG5hbWUgPSBOYW1lLmdldCh2YWx1ZSA/IHRoaXMuZGF0YS5idXR0b25WYWx1ZSA6ICJPZmYiKTsKICAgIGlmICh2YWx1ZSkgewogICAgICB0aGlzLnNldFZhbHVlKGRpY3QsIG5hbWUsIGV2YWx1YXRvci54cmVmLCBjaGFuZ2VzKTsKICAgIH0KICAgIGRpY3Quc2V0KCJBUyIsIG5hbWUpOwogICAgZGljdC5zZXQoIk0iLCBgRDoke2dldE1vZGlmaWNhdGlvbkRhdGUoKX1gKTsKICAgIGlmIChmbGFncyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGRpY3Quc2V0KCJGIiwgZmxhZ3MpOwogICAgfQogICAgY29uc3QgbWF5YmVNSyA9IHRoaXMuX2dldE1LRGljdChyb3RhdGlvbik7CiAgICBpZiAobWF5YmVNSykgewogICAgICBkaWN0LnNldCgiTUsiLCBtYXliZU1LKTsKICAgIH0KICAgIGNoYW5nZXMucHV0KHRoaXMucmVmLCB7CiAgICAgIGRhdGE6IGRpY3QsCiAgICAgIHhmYSwKICAgICAgbmVlZEFwcGVhcmFuY2VzOiBmYWxzZQogICAgfSk7CiAgfQogIF9nZXREZWZhdWx0Q2hlY2tlZEFwcGVhcmFuY2UocGFyYW1zLCB0eXBlKSB7CiAgICBjb25zdCB7CiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gPSB0aGlzOwogICAgY29uc3QgYmJveCA9IFswLCAwLCB3aWR0aCwgaGVpZ2h0XTsKICAgIGNvbnN0IEZPTlRfUkFUSU8gPSAwLjg7CiAgICBjb25zdCBmb250U2l6ZSA9IE1hdGgubWluKHdpZHRoLCBoZWlnaHQpICogRk9OVF9SQVRJTzsKICAgIGxldCBtZXRyaWNzLCBjaGFyOwogICAgaWYgKHR5cGUgPT09ICJjaGVjayIpIHsKICAgICAgbWV0cmljcyA9IHsKICAgICAgICB3aWR0aDogMC43NTUgKiBmb250U2l6ZSwKICAgICAgICBoZWlnaHQ6IDAuNzA1ICogZm9udFNpemUKICAgICAgfTsKICAgICAgY2hhciA9ICJceDMzIjsKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gImRpc2MiKSB7CiAgICAgIG1ldHJpY3MgPSB7CiAgICAgICAgd2lkdGg6IDAuNzkxICogZm9udFNpemUsCiAgICAgICAgaGVpZ2h0OiAwLjcwNSAqIGZvbnRTaXplCiAgICAgIH07CiAgICAgIGNoYXIgPSAiXHg2QyI7CiAgICB9IGVsc2UgewogICAgICB1bnJlYWNoYWJsZShgX2dldERlZmF1bHRDaGVja2VkQXBwZWFyYW5jZSAtIHVuc3VwcG9ydGVkIHR5cGU6ICR7dHlwZX1gKTsKICAgIH0KICAgIGNvbnN0IHhTaGlmdCA9IG51bWJlclRvU3RyaW5nKCh3aWR0aCAtIG1ldHJpY3Mud2lkdGgpIC8gMik7CiAgICBjb25zdCB5U2hpZnQgPSBudW1iZXJUb1N0cmluZygoaGVpZ2h0IC0gbWV0cmljcy5oZWlnaHQpIC8gMik7CiAgICBjb25zdCBhcHBlYXJhbmNlID0gYHEgQlQgL1BkZkpzWmFEYiAke2ZvbnRTaXplfSBUZiAwIGcgJHt4U2hpZnR9ICR7eVNoaWZ0fSBUZCAoJHtjaGFyfSkgVGogRVQgUWA7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtRGljdCA9IG5ldyBEaWN0KHBhcmFtcy54cmVmKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiRm9ybVR5cGUiLCAxKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiU3VidHlwZSIsICJGb3JtIik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiWE9iamVjdCIpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJCQm94IiwgYmJveCk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIk1hdHJpeCIsIFsxLCAwLCAwLCAxLCAwLCAwXSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkxlbmd0aCIsIGFwcGVhcmFuY2UubGVuZ3RoKTsKICAgIGNvbnN0IHJlc291cmNlcyA9IG5ldyBEaWN0KHBhcmFtcy54cmVmKTsKICAgIGNvbnN0IGZvbnQgPSBuZXcgRGljdChwYXJhbXMueHJlZik7CiAgICBmb250LnNldCgiUGRmSnNaYURiIiwgdGhpcy5mYWxsYmFja0ZvbnREaWN0KTsKICAgIHJlc291cmNlcy5zZXQoIkZvbnQiLCBmb250KTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiUmVzb3VyY2VzIiwgcmVzb3VyY2VzKTsKICAgIHRoaXMuY2hlY2tlZEFwcGVhcmFuY2UgPSBuZXcgU3RyaW5nU3RyZWFtKGFwcGVhcmFuY2UpOwogICAgdGhpcy5jaGVja2VkQXBwZWFyYW5jZS5kaWN0ID0gYXBwZWFyYW5jZVN0cmVhbURpY3Q7CiAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy5jaGVja2VkQXBwZWFyYW5jZSk7CiAgfQogIF9wcm9jZXNzQ2hlY2tCb3gocGFyYW1zKSB7CiAgICBjb25zdCBjdXN0b21BcHBlYXJhbmNlID0gcGFyYW1zLmRpY3QuZ2V0KCJBUCIpOwogICAgaWYgKCEoY3VzdG9tQXBwZWFyYW5jZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG5vcm1hbEFwcGVhcmFuY2UgPSBjdXN0b21BcHBlYXJhbmNlLmdldCgiTiIpOwogICAgaWYgKCEobm9ybWFsQXBwZWFyYW5jZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGFzVmFsdWUgPSB0aGlzLl9kZWNvZGVGb3JtVmFsdWUocGFyYW1zLmRpY3QuZ2V0KCJBUyIpKTsKICAgIGlmICh0eXBlb2YgYXNWYWx1ZSA9PT0gInN0cmluZyIpIHsKICAgICAgdGhpcy5kYXRhLmZpZWxkVmFsdWUgPSBhc1ZhbHVlOwogICAgfQogICAgY29uc3QgeWVzID0gdGhpcy5kYXRhLmZpZWxkVmFsdWUgIT09IG51bGwgJiYgdGhpcy5kYXRhLmZpZWxkVmFsdWUgIT09ICJPZmYiID8gdGhpcy5kYXRhLmZpZWxkVmFsdWUgOiAiWWVzIjsKICAgIGNvbnN0IGV4cG9ydFZhbHVlcyA9IHRoaXMuX2RlY29kZUZvcm1WYWx1ZShub3JtYWxBcHBlYXJhbmNlLmdldEtleXMoKSk7CiAgICBpZiAoZXhwb3J0VmFsdWVzLmxlbmd0aCA9PT0gMCkgewogICAgICBleHBvcnRWYWx1ZXMucHVzaCgiT2ZmIiwgeWVzKTsKICAgIH0gZWxzZSBpZiAoZXhwb3J0VmFsdWVzLmxlbmd0aCA9PT0gMSkgewogICAgICBpZiAoZXhwb3J0VmFsdWVzWzBdID09PSAiT2ZmIikgewogICAgICAgIGV4cG9ydFZhbHVlcy5wdXNoKHllcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZXhwb3J0VmFsdWVzLnVuc2hpZnQoIk9mZiIpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGV4cG9ydFZhbHVlcy5pbmNsdWRlcyh5ZXMpKSB7CiAgICAgIGV4cG9ydFZhbHVlcy5sZW5ndGggPSAwOwogICAgICBleHBvcnRWYWx1ZXMucHVzaCgiT2ZmIiwgeWVzKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IG90aGVyWWVzID0gZXhwb3J0VmFsdWVzLmZpbmQodiA9PiB2ICE9PSAiT2ZmIik7CiAgICAgIGV4cG9ydFZhbHVlcy5sZW5ndGggPSAwOwogICAgICBleHBvcnRWYWx1ZXMucHVzaCgiT2ZmIiwgb3RoZXJZZXMpOwogICAgfQogICAgaWYgKCFleHBvcnRWYWx1ZXMuaW5jbHVkZXModGhpcy5kYXRhLmZpZWxkVmFsdWUpKSB7CiAgICAgIHRoaXMuZGF0YS5maWVsZFZhbHVlID0gIk9mZiI7CiAgICB9CiAgICB0aGlzLmRhdGEuZXhwb3J0VmFsdWUgPSBleHBvcnRWYWx1ZXNbMV07CiAgICBjb25zdCBjaGVja2VkQXBwZWFyYW5jZSA9IG5vcm1hbEFwcGVhcmFuY2UuZ2V0KHRoaXMuZGF0YS5leHBvcnRWYWx1ZSk7CiAgICB0aGlzLmNoZWNrZWRBcHBlYXJhbmNlID0gY2hlY2tlZEFwcGVhcmFuY2UgaW5zdGFuY2VvZiBCYXNlU3RyZWFtID8gY2hlY2tlZEFwcGVhcmFuY2UgOiBudWxsOwogICAgY29uc3QgdW5jaGVja2VkQXBwZWFyYW5jZSA9IG5vcm1hbEFwcGVhcmFuY2UuZ2V0KCJPZmYiKTsKICAgIHRoaXMudW5jaGVja2VkQXBwZWFyYW5jZSA9IHVuY2hlY2tlZEFwcGVhcmFuY2UgaW5zdGFuY2VvZiBCYXNlU3RyZWFtID8gdW5jaGVja2VkQXBwZWFyYW5jZSA6IG51bGw7CiAgICBpZiAodGhpcy5jaGVja2VkQXBwZWFyYW5jZSkgewogICAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy5jaGVja2VkQXBwZWFyYW5jZSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9nZXREZWZhdWx0Q2hlY2tlZEFwcGVhcmFuY2UocGFyYW1zLCAiY2hlY2siKTsKICAgIH0KICAgIGlmICh0aGlzLnVuY2hlY2tlZEFwcGVhcmFuY2UpIHsKICAgICAgdGhpcy5fc3RyZWFtcy5wdXNoKHRoaXMudW5jaGVja2VkQXBwZWFyYW5jZSk7CiAgICB9CiAgICB0aGlzLl9mYWxsYmFja0ZvbnREaWN0ID0gdGhpcy5mYWxsYmFja0ZvbnREaWN0OwogICAgaWYgKHRoaXMuZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSA9PT0gbnVsbCkgewogICAgICB0aGlzLmRhdGEuZGVmYXVsdEZpZWxkVmFsdWUgPSAiT2ZmIjsKICAgIH0KICB9CiAgX3Byb2Nlc3NSYWRpb0J1dHRvbihwYXJhbXMpIHsKICAgIHRoaXMuZGF0YS5idXR0b25WYWx1ZSA9IG51bGw7CiAgICBjb25zdCBmaWVsZFBhcmVudCA9IHBhcmFtcy5kaWN0LmdldCgiUGFyZW50Iik7CiAgICBpZiAoZmllbGRQYXJlbnQgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIHRoaXMucGFyZW50ID0gcGFyYW1zLmRpY3QuZ2V0UmF3KCJQYXJlbnQiKTsKICAgICAgY29uc3QgZmllbGRQYXJlbnRWYWx1ZSA9IGZpZWxkUGFyZW50LmdldCgiViIpOwogICAgICBpZiAoZmllbGRQYXJlbnRWYWx1ZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9IHRoaXMuX2RlY29kZUZvcm1WYWx1ZShmaWVsZFBhcmVudFZhbHVlKTsKICAgICAgfQogICAgfQogICAgY29uc3QgYXBwZWFyYW5jZVN0YXRlcyA9IHBhcmFtcy5kaWN0LmdldCgiQVAiKTsKICAgIGlmICghKGFwcGVhcmFuY2VTdGF0ZXMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBub3JtYWxBcHBlYXJhbmNlID0gYXBwZWFyYW5jZVN0YXRlcy5nZXQoIk4iKTsKICAgIGlmICghKG5vcm1hbEFwcGVhcmFuY2UgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IGtleSBvZiBub3JtYWxBcHBlYXJhbmNlLmdldEtleXMoKSkgewogICAgICBpZiAoa2V5ICE9PSAiT2ZmIikgewogICAgICAgIHRoaXMuZGF0YS5idXR0b25WYWx1ZSA9IHRoaXMuX2RlY29kZUZvcm1WYWx1ZShrZXkpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBjb25zdCBjaGVja2VkQXBwZWFyYW5jZSA9IG5vcm1hbEFwcGVhcmFuY2UuZ2V0KHRoaXMuZGF0YS5idXR0b25WYWx1ZSk7CiAgICB0aGlzLmNoZWNrZWRBcHBlYXJhbmNlID0gY2hlY2tlZEFwcGVhcmFuY2UgaW5zdGFuY2VvZiBCYXNlU3RyZWFtID8gY2hlY2tlZEFwcGVhcmFuY2UgOiBudWxsOwogICAgY29uc3QgdW5jaGVja2VkQXBwZWFyYW5jZSA9IG5vcm1hbEFwcGVhcmFuY2UuZ2V0KCJPZmYiKTsKICAgIHRoaXMudW5jaGVja2VkQXBwZWFyYW5jZSA9IHVuY2hlY2tlZEFwcGVhcmFuY2UgaW5zdGFuY2VvZiBCYXNlU3RyZWFtID8gdW5jaGVja2VkQXBwZWFyYW5jZSA6IG51bGw7CiAgICBpZiAodGhpcy5jaGVja2VkQXBwZWFyYW5jZSkgewogICAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy5jaGVja2VkQXBwZWFyYW5jZSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9nZXREZWZhdWx0Q2hlY2tlZEFwcGVhcmFuY2UocGFyYW1zLCAiZGlzYyIpOwogICAgfQogICAgaWYgKHRoaXMudW5jaGVja2VkQXBwZWFyYW5jZSkgewogICAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy51bmNoZWNrZWRBcHBlYXJhbmNlKTsKICAgIH0KICAgIHRoaXMuX2ZhbGxiYWNrRm9udERpY3QgPSB0aGlzLmZhbGxiYWNrRm9udERpY3Q7CiAgICBpZiAodGhpcy5kYXRhLmRlZmF1bHRGaWVsZFZhbHVlID09PSBudWxsKSB7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSA9ICJPZmYiOwogICAgfQogIH0KICBfcHJvY2Vzc1B1c2hCdXR0b24ocGFyYW1zKSB7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIGFubm90YXRpb25HbG9iYWxzCiAgICB9ID0gcGFyYW1zOwogICAgaWYgKCFkaWN0LmhhcygiQSIpICYmICFkaWN0LmhhcygiQUEiKSAmJiAhdGhpcy5kYXRhLmFsdGVybmF0aXZlVGV4dCkgewogICAgICB3YXJuKCJQdXNoIGJ1dHRvbnMgd2l0aG91dCBhY3Rpb24gZGljdGlvbmFyaWVzIGFyZSBub3Qgc3VwcG9ydGVkIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuZGF0YS5pc1Rvb2x0aXBPbmx5ID0gIWRpY3QuaGFzKCJBIikgJiYgIWRpY3QuaGFzKCJBQSIpOwogICAgQ2F0YWxvZy5wYXJzZURlc3REaWN0aW9uYXJ5KHsKICAgICAgZGVzdERpY3Q6IGRpY3QsCiAgICAgIHJlc3VsdE9iajogdGhpcy5kYXRhLAogICAgICBkb2NCYXNlVXJsOiBhbm5vdGF0aW9uR2xvYmFscy5iYXNlVXJsLAogICAgICBkb2NBdHRhY2htZW50czogYW5ub3RhdGlvbkdsb2JhbHMuYXR0YWNobWVudHMKICAgIH0pOwogIH0KICBnZXRGaWVsZE9iamVjdCgpIHsKICAgIGxldCB0eXBlID0gImJ1dHRvbiI7CiAgICBsZXQgZXhwb3J0VmFsdWVzOwogICAgaWYgKHRoaXMuZGF0YS5jaGVja0JveCkgewogICAgICB0eXBlID0gImNoZWNrYm94IjsKICAgICAgZXhwb3J0VmFsdWVzID0gdGhpcy5kYXRhLmV4cG9ydFZhbHVlOwogICAgfSBlbHNlIGlmICh0aGlzLmRhdGEucmFkaW9CdXR0b24pIHsKICAgICAgdHlwZSA9ICJyYWRpb2J1dHRvbiI7CiAgICAgIGV4cG9ydFZhbHVlcyA9IHRoaXMuZGF0YS5idXR0b25WYWx1ZTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIGlkOiB0aGlzLmRhdGEuaWQsCiAgICAgIHZhbHVlOiB0aGlzLmRhdGEuZmllbGRWYWx1ZSB8fCAiT2ZmIiwKICAgICAgZGVmYXVsdFZhbHVlOiB0aGlzLmRhdGEuZGVmYXVsdEZpZWxkVmFsdWUsCiAgICAgIGV4cG9ydFZhbHVlcywKICAgICAgZWRpdGFibGU6ICF0aGlzLmRhdGEucmVhZE9ubHksCiAgICAgIG5hbWU6IHRoaXMuZGF0YS5maWVsZE5hbWUsCiAgICAgIHJlY3Q6IHRoaXMuZGF0YS5yZWN0LAogICAgICBoaWRkZW46IHRoaXMuZGF0YS5oaWRkZW4sCiAgICAgIGFjdGlvbnM6IHRoaXMuZGF0YS5hY3Rpb25zLAogICAgICBwYWdlOiB0aGlzLmRhdGEucGFnZUluZGV4LAogICAgICBzdHJva2VDb2xvcjogdGhpcy5kYXRhLmJvcmRlckNvbG9yLAogICAgICBmaWxsQ29sb3I6IHRoaXMuZGF0YS5iYWNrZ3JvdW5kQ29sb3IsCiAgICAgIHJvdGF0aW9uOiB0aGlzLnJvdGF0aW9uLAogICAgICB0eXBlCiAgICB9OwogIH0KICBnZXQgZmFsbGJhY2tGb250RGljdCgpIHsKICAgIGNvbnN0IGRpY3QgPSBuZXcgRGljdCgpOwogICAgZGljdC5zZXRJZk5hbWUoIkJhc2VGb250IiwgIlphcGZEaW5nYmF0cyIpOwogICAgZGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiRmFsbGJhY2tUeXBlIik7CiAgICBkaWN0LnNldElmTmFtZSgiU3VidHlwZSIsICJGYWxsYmFja1R5cGUiKTsKICAgIGRpY3Quc2V0SWZOYW1lKCJFbmNvZGluZyIsICJaYXBmRGluZ2JhdHNFbmNvZGluZyIpOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZmFsbGJhY2tGb250RGljdCIsIGRpY3QpOwogIH0KfQpjbGFzcyBDaG9pY2VXaWRnZXRBbm5vdGF0aW9uIGV4dGVuZHMgV2lkZ2V0QW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICB4cmVmCiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5pbmRpY2VzID0gZGljdC5nZXRBcnJheSgiSSIpOwogICAgdGhpcy5oYXNJbmRpY2VzID0gQXJyYXkuaXNBcnJheSh0aGlzLmluZGljZXMpICYmIHRoaXMuaW5kaWNlcy5sZW5ndGggPiAwOwogICAgdGhpcy5kYXRhLm9wdGlvbnMgPSBbXTsKICAgIGNvbnN0IG9wdGlvbnMgPSBnZXRJbmhlcml0YWJsZVByb3BlcnR5KHsKICAgICAgZGljdCwKICAgICAga2V5OiAiT3B0IgogICAgfSk7CiAgICBpZiAoQXJyYXkuaXNBcnJheShvcHRpb25zKSkgewogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBvcHRpb25zLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCBvcHRpb24gPSB4cmVmLmZldGNoSWZSZWYob3B0aW9uc1tpXSk7CiAgICAgICAgY29uc3QgaXNPcHRpb25BcnJheSA9IEFycmF5LmlzQXJyYXkob3B0aW9uKTsKICAgICAgICB0aGlzLmRhdGEub3B0aW9uc1tpXSA9IHsKICAgICAgICAgIGV4cG9ydFZhbHVlOiB0aGlzLl9kZWNvZGVGb3JtVmFsdWUoaXNPcHRpb25BcnJheSA/IHhyZWYuZmV0Y2hJZlJlZihvcHRpb25bMF0pIDogb3B0aW9uKSwKICAgICAgICAgIGRpc3BsYXlWYWx1ZTogdGhpcy5fZGVjb2RlRm9ybVZhbHVlKGlzT3B0aW9uQXJyYXkgPyB4cmVmLmZldGNoSWZSZWYob3B0aW9uWzFdKSA6IG9wdGlvbikKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgICBpZiAoIXRoaXMuaGFzSW5kaWNlcykgewogICAgICBpZiAodHlwZW9mIHRoaXMuZGF0YS5maWVsZFZhbHVlID09PSAic3RyaW5nIikgewogICAgICAgIHRoaXMuZGF0YS5maWVsZFZhbHVlID0gW3RoaXMuZGF0YS5maWVsZFZhbHVlXTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRhdGEuZmllbGRWYWx1ZSB8fD0gW107CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGF0YS5maWVsZFZhbHVlID0gW107CiAgICAgIGNvbnN0IGlpID0gdGhpcy5kYXRhLm9wdGlvbnMubGVuZ3RoOwogICAgICBmb3IgKGNvbnN0IGkgb2YgdGhpcy5pbmRpY2VzKSB7CiAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIoaSkgJiYgaSA+PSAwICYmIGkgPCBpaSkgewogICAgICAgICAgdGhpcy5kYXRhLmZpZWxkVmFsdWUucHVzaCh0aGlzLmRhdGEub3B0aW9uc1tpXS5leHBvcnRWYWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5kYXRhLm9wdGlvbnMubGVuZ3RoID09PSAwICYmIHRoaXMuZGF0YS5maWVsZFZhbHVlLmxlbmd0aCA+IDApIHsKICAgICAgdGhpcy5kYXRhLm9wdGlvbnMgPSB0aGlzLmRhdGEuZmllbGRWYWx1ZS5tYXAodmFsdWUgPT4gKHsKICAgICAgICBleHBvcnRWYWx1ZTogdmFsdWUsCiAgICAgICAgZGlzcGxheVZhbHVlOiB2YWx1ZQogICAgICB9KSk7CiAgICB9CiAgICB0aGlzLmRhdGEuY29tYm8gPSB0aGlzLmhhc0ZpZWxkRmxhZyhBbm5vdGF0aW9uRmllbGRGbGFnLkNPTUJPKTsKICAgIHRoaXMuZGF0YS5tdWx0aVNlbGVjdCA9IHRoaXMuaGFzRmllbGRGbGFnKEFubm90YXRpb25GaWVsZEZsYWcuTVVMVElTRUxFQ1QpOwogICAgdGhpcy5faGFzVGV4dCA9IHRydWU7CiAgfQogIGdldEZpZWxkT2JqZWN0KCkgewogICAgY29uc3QgdHlwZSA9IHRoaXMuZGF0YS5jb21ibyA/ICJjb21ib2JveCIgOiAibGlzdGJveCI7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZGF0YS5maWVsZFZhbHVlLmxlbmd0aCA+IDAgPyB0aGlzLmRhdGEuZmllbGRWYWx1ZVswXSA6IG51bGw7CiAgICByZXR1cm4gewogICAgICBpZDogdGhpcy5kYXRhLmlkLAogICAgICB2YWx1ZSwKICAgICAgZGVmYXVsdFZhbHVlOiB0aGlzLmRhdGEuZGVmYXVsdEZpZWxkVmFsdWUsCiAgICAgIGVkaXRhYmxlOiAhdGhpcy5kYXRhLnJlYWRPbmx5LAogICAgICBuYW1lOiB0aGlzLmRhdGEuZmllbGROYW1lLAogICAgICByZWN0OiB0aGlzLmRhdGEucmVjdCwKICAgICAgbnVtSXRlbXM6IHRoaXMuZGF0YS5maWVsZFZhbHVlLmxlbmd0aCwKICAgICAgbXVsdGlwbGVTZWxlY3Rpb246IHRoaXMuZGF0YS5tdWx0aVNlbGVjdCwKICAgICAgaGlkZGVuOiB0aGlzLmRhdGEuaGlkZGVuLAogICAgICBhY3Rpb25zOiB0aGlzLmRhdGEuYWN0aW9ucywKICAgICAgaXRlbXM6IHRoaXMuZGF0YS5vcHRpb25zLAogICAgICBwYWdlOiB0aGlzLmRhdGEucGFnZUluZGV4LAogICAgICBzdHJva2VDb2xvcjogdGhpcy5kYXRhLmJvcmRlckNvbG9yLAogICAgICBmaWxsQ29sb3I6IHRoaXMuZGF0YS5iYWNrZ3JvdW5kQ29sb3IsCiAgICAgIHJvdGF0aW9uOiB0aGlzLnJvdGF0aW9uLAogICAgICB0eXBlCiAgICB9OwogIH0KICBhbWVuZFNhdmVkRGljdChhbm5vdGF0aW9uU3RvcmFnZSwgZGljdCkgewogICAgaWYgKCF0aGlzLmhhc0luZGljZXMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IHZhbHVlcyA9IGFubm90YXRpb25TdG9yYWdlPy5nZXQodGhpcy5kYXRhLmlkKT8udmFsdWU7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWVzKSkgewogICAgICB2YWx1ZXMgPSBbdmFsdWVzXTsKICAgIH0KICAgIGNvbnN0IGluZGljZXMgPSBbXTsKICAgIGNvbnN0IHsKICAgICAgb3B0aW9ucwogICAgfSA9IHRoaXMuZGF0YTsKICAgIGZvciAobGV0IGkgPSAwLCBqID0gMCwgaWkgPSBvcHRpb25zLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgaWYgKG9wdGlvbnNbaV0uZXhwb3J0VmFsdWUgPT09IHZhbHVlc1tqXSkgewogICAgICAgIGluZGljZXMucHVzaChpKTsKICAgICAgICBqICs9IDE7CiAgICAgIH0KICAgIH0KICAgIGRpY3Quc2V0KCJJIiwgaW5kaWNlcyk7CiAgfQogIGFzeW5jIF9nZXRBcHBlYXJhbmNlKGV2YWx1YXRvciwgdGFzaywgaW50ZW50LCBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgaWYgKHRoaXMuZGF0YS5jb21ibykgewogICAgICByZXR1cm4gc3VwZXIuX2dldEFwcGVhcmFuY2UoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKTsKICAgIH0KICAgIGxldCBleHBvcnRlZFZhbHVlLCByb3RhdGlvbjsKICAgIGNvbnN0IHN0b3JhZ2VFbnRyeSA9IGFubm90YXRpb25TdG9yYWdlPy5nZXQodGhpcy5kYXRhLmlkKTsKICAgIGlmIChzdG9yYWdlRW50cnkpIHsKICAgICAgcm90YXRpb24gPSBzdG9yYWdlRW50cnkucm90YXRpb247CiAgICAgIGV4cG9ydGVkVmFsdWUgPSBzdG9yYWdlRW50cnkudmFsdWU7CiAgICB9CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCAmJiBleHBvcnRlZFZhbHVlID09PSB1bmRlZmluZWQgJiYgIXRoaXMuX25lZWRBcHBlYXJhbmNlcykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChleHBvcnRlZFZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgZXhwb3J0ZWRWYWx1ZSA9IHRoaXMuZGF0YS5maWVsZFZhbHVlOwogICAgfSBlbHNlIGlmICghQXJyYXkuaXNBcnJheShleHBvcnRlZFZhbHVlKSkgewogICAgICBleHBvcnRlZFZhbHVlID0gW2V4cG9ydGVkVmFsdWVdOwogICAgfQogICAgY29uc3QgZGVmYXVsdFBhZGRpbmcgPSAxOwogICAgY29uc3QgZGVmYXVsdEhQYWRkaW5nID0gMjsKICAgIGxldCB7CiAgICAgIHdpZHRoOiB0b3RhbFdpZHRoLAogICAgICBoZWlnaHQ6IHRvdGFsSGVpZ2h0CiAgICB9ID0gdGhpczsKICAgIGlmIChyb3RhdGlvbiA9PT0gOTAgfHwgcm90YXRpb24gPT09IDI3MCkgewogICAgICBbdG90YWxXaWR0aCwgdG90YWxIZWlnaHRdID0gW3RvdGFsSGVpZ2h0LCB0b3RhbFdpZHRoXTsKICAgIH0KICAgIGNvbnN0IGxpbmVDb3VudCA9IHRoaXMuZGF0YS5vcHRpb25zLmxlbmd0aDsKICAgIGNvbnN0IHZhbHVlSW5kaWNlcyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lQ291bnQ7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgZXhwb3J0VmFsdWUKICAgICAgfSA9IHRoaXMuZGF0YS5vcHRpb25zW2ldOwogICAgICBpZiAoZXhwb3J0ZWRWYWx1ZS5pbmNsdWRlcyhleHBvcnRWYWx1ZSkpIHsKICAgICAgICB2YWx1ZUluZGljZXMucHVzaChpKTsKICAgICAgfQogICAgfQogICAgaWYgKCF0aGlzLl9kZWZhdWx0QXBwZWFyYW5jZSkgewogICAgICB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhID0gcGFyc2VEZWZhdWx0QXBwZWFyYW5jZSh0aGlzLl9kZWZhdWx0QXBwZWFyYW5jZSA9ICIvSGVsdmV0aWNhIDAgVGYgMCBnIik7CiAgICB9CiAgICBjb25zdCBmb250ID0gYXdhaXQgV2lkZ2V0QW5ub3RhdGlvbi5fZ2V0Rm9udERhdGEoZXZhbHVhdG9yLCB0YXNrLCB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhLCB0aGlzLl9maWVsZFJlc291cmNlcy5tZXJnZWRSZXNvdXJjZXMpOwogICAgbGV0IGRlZmF1bHRBcHBlYXJhbmNlOwogICAgbGV0IHsKICAgICAgZm9udFNpemUKICAgIH0gPSB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhOwogICAgaWYgKCFmb250U2l6ZSkgewogICAgICBjb25zdCBsaW5lSGVpZ2h0ID0gKHRvdGFsSGVpZ2h0IC0gZGVmYXVsdFBhZGRpbmcpIC8gbGluZUNvdW50OwogICAgICBsZXQgbGluZVdpZHRoID0gLTE7CiAgICAgIGxldCB2YWx1ZTsKICAgICAgZm9yIChjb25zdCB7CiAgICAgICAgZGlzcGxheVZhbHVlCiAgICAgIH0gb2YgdGhpcy5kYXRhLm9wdGlvbnMpIHsKICAgICAgICBjb25zdCB3aWR0aCA9IHRoaXMuX2dldFRleHRXaWR0aChkaXNwbGF5VmFsdWUsIGZvbnQpOwogICAgICAgIGlmICh3aWR0aCA+IGxpbmVXaWR0aCkgewogICAgICAgICAgbGluZVdpZHRoID0gd2lkdGg7CiAgICAgICAgICB2YWx1ZSA9IGRpc3BsYXlWYWx1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgW2RlZmF1bHRBcHBlYXJhbmNlLCBmb250U2l6ZV0gPSB0aGlzLl9jb21wdXRlRm9udFNpemUobGluZUhlaWdodCwgdG90YWxXaWR0aCAtIDIgKiBkZWZhdWx0SFBhZGRpbmcsIHZhbHVlLCBmb250LCAtMSk7CiAgICB9IGVsc2UgewogICAgICBkZWZhdWx0QXBwZWFyYW5jZSA9IHRoaXMuX2RlZmF1bHRBcHBlYXJhbmNlOwogICAgfQogICAgY29uc3QgbGluZUhlaWdodCA9IGZvbnRTaXplICogTElORV9GQUNUT1I7CiAgICBjb25zdCB2UGFkZGluZyA9IChsaW5lSGVpZ2h0IC0gZm9udFNpemUpIC8gMjsKICAgIGNvbnN0IG51bWJlck9mVmlzaWJsZUxpbmVzID0gTWF0aC5mbG9vcih0b3RhbEhlaWdodCAvIGxpbmVIZWlnaHQpOwogICAgbGV0IGZpcnN0SW5kZXggPSAwOwogICAgaWYgKHZhbHVlSW5kaWNlcy5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IG1pbkluZGV4ID0gTWF0aC5taW4oLi4udmFsdWVJbmRpY2VzKTsKICAgICAgY29uc3QgbWF4SW5kZXggPSBNYXRoLm1heCguLi52YWx1ZUluZGljZXMpOwogICAgICBmaXJzdEluZGV4ID0gTWF0aC5tYXgoMCwgbWF4SW5kZXggLSBudW1iZXJPZlZpc2libGVMaW5lcyArIDEpOwogICAgICBpZiAoZmlyc3RJbmRleCA+IG1pbkluZGV4KSB7CiAgICAgICAgZmlyc3RJbmRleCA9IG1pbkluZGV4OwogICAgICB9CiAgICB9CiAgICBjb25zdCBlbmQgPSBNYXRoLm1pbihmaXJzdEluZGV4ICsgbnVtYmVyT2ZWaXNpYmxlTGluZXMgKyAxLCBsaW5lQ291bnQpOwogICAgY29uc3QgYnVmID0gWyIvVHggQk1DIHEiLCBgMSAxICR7dG90YWxXaWR0aH0gJHt0b3RhbEhlaWdodH0gcmUgVyBuYF07CiAgICBpZiAodmFsdWVJbmRpY2VzLmxlbmd0aCkgewogICAgICBidWYucHVzaCgiMC42MDAwMDYgMC43NTY4NjYgMC44NTQ5MDQgcmciKTsKICAgICAgZm9yIChjb25zdCBpbmRleCBvZiB2YWx1ZUluZGljZXMpIHsKICAgICAgICBpZiAoZmlyc3RJbmRleCA8PSBpbmRleCAmJiBpbmRleCA8IGVuZCkgewogICAgICAgICAgYnVmLnB1c2goYDEgJHt0b3RhbEhlaWdodCAtIChpbmRleCAtIGZpcnN0SW5kZXggKyAxKSAqIGxpbmVIZWlnaHR9ICR7dG90YWxXaWR0aH0gJHtsaW5lSGVpZ2h0fSByZSBmYCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBidWYucHVzaCgiQlQiLCBkZWZhdWx0QXBwZWFyYW5jZSwgYDEgMCAwIDEgMCAke3RvdGFsSGVpZ2h0fSBUbWApOwogICAgY29uc3QgcHJldkluZm8gPSB7CiAgICAgIHNoaWZ0OiAwCiAgICB9OwogICAgZm9yIChsZXQgaSA9IGZpcnN0SW5kZXg7IGkgPCBlbmQ7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgZGlzcGxheVZhbHVlCiAgICAgIH0gPSB0aGlzLmRhdGEub3B0aW9uc1tpXTsKICAgICAgY29uc3QgdnBhZGRpbmcgPSBpID09PSBmaXJzdEluZGV4ID8gdlBhZGRpbmcgOiAwOwogICAgICBidWYucHVzaCh0aGlzLl9yZW5kZXJUZXh0KGRpc3BsYXlWYWx1ZSwgZm9udCwgZm9udFNpemUsIHRvdGFsV2lkdGgsIDAsIHByZXZJbmZvLCBkZWZhdWx0SFBhZGRpbmcsIC1saW5lSGVpZ2h0ICsgdnBhZGRpbmcpKTsKICAgIH0KICAgIGJ1Zi5wdXNoKCJFVCBRIEVNQyIpOwogICAgcmV0dXJuIGJ1Zi5qb2luKCJcbiIpOwogIH0KfQpjbGFzcyBTaWduYXR1cmVXaWRnZXRBbm5vdGF0aW9uIGV4dGVuZHMgV2lkZ2V0QW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgdGhpcy5kYXRhLmZpZWxkVmFsdWUgPSBudWxsOwogICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IHRoaXMuZGF0YS5ub1JvdGF0ZTsKICAgIHRoaXMuZGF0YS5ub0hUTUwgPSAhdGhpcy5kYXRhLmhhc093bkNhbnZhczsKICB9CiAgZ2V0RmllbGRPYmplY3QoKSB7CiAgICByZXR1cm4gewogICAgICBpZDogdGhpcy5kYXRhLmlkLAogICAgICB2YWx1ZTogbnVsbCwKICAgICAgcGFnZTogdGhpcy5kYXRhLnBhZ2VJbmRleCwKICAgICAgdHlwZTogInNpZ25hdHVyZSIKICAgIH07CiAgfQp9CmNsYXNzIFRleHRBbm5vdGF0aW9uIGV4dGVuZHMgTWFya3VwQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBjb25zdCBERUZBVUxUX0lDT05fU0laRSA9IDIyOwogICAgc3VwZXIocGFyYW1zKTsKICAgIHRoaXMuZGF0YS5ub1JvdGF0ZSA9IHRydWU7CiAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdGhpcy5kYXRhLm5vUm90YXRlOwogICAgdGhpcy5kYXRhLm5vSFRNTCA9IGZhbHNlOwogICAgY29uc3QgewogICAgICBkaWN0CiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gQW5ub3RhdGlvblR5cGUuVEVYVDsKICAgIGlmICh0aGlzLmRhdGEuaGFzQXBwZWFyYW5jZSkgewogICAgICB0aGlzLmRhdGEubmFtZSA9ICJOb0ljb24iOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kYXRhLnJlY3RbMV0gPSB0aGlzLmRhdGEucmVjdFszXSAtIERFRkFVTFRfSUNPTl9TSVpFOwogICAgICB0aGlzLmRhdGEucmVjdFsyXSA9IHRoaXMuZGF0YS5yZWN0WzBdICsgREVGQVVMVF9JQ09OX1NJWkU7CiAgICAgIHRoaXMuZGF0YS5uYW1lID0gZGljdC5oYXMoIk5hbWUiKSA/IGRpY3QuZ2V0KCJOYW1lIikubmFtZSA6ICJOb3RlIjsKICAgIH0KICAgIGlmIChkaWN0LmhhcygiU3RhdGUiKSkgewogICAgICB0aGlzLmRhdGEuc3RhdGUgPSBkaWN0LmdldCgiU3RhdGUiKSB8fCBudWxsOwogICAgICB0aGlzLmRhdGEuc3RhdGVNb2RlbCA9IGRpY3QuZ2V0KCJTdGF0ZU1vZGVsIikgfHwgbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGF0YS5zdGF0ZSA9IG51bGw7CiAgICAgIHRoaXMuZGF0YS5zdGF0ZU1vZGVsID0gbnVsbDsKICAgIH0KICB9Cn0KY2xhc3MgTGlua0Fubm90YXRpb24gZXh0ZW5kcyBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIGFubm90YXRpb25HbG9iYWxzCiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gQW5ub3RhdGlvblR5cGUuTElOSzsKICAgIHRoaXMuZGF0YS5ub0hUTUwgPSBmYWxzZTsKICAgIGNvbnN0IHF1YWRQb2ludHMgPSBnZXRRdWFkUG9pbnRzKGRpY3QsIHRoaXMucmVjdGFuZ2xlKTsKICAgIGlmIChxdWFkUG9pbnRzKSB7CiAgICAgIHRoaXMuZGF0YS5xdWFkUG9pbnRzID0gcXVhZFBvaW50czsKICAgIH0KICAgIHRoaXMuZGF0YS5ib3JkZXJDb2xvciB8fD0gdGhpcy5kYXRhLmNvbG9yOwogICAgQ2F0YWxvZy5wYXJzZURlc3REaWN0aW9uYXJ5KHsKICAgICAgZGVzdERpY3Q6IGRpY3QsCiAgICAgIHJlc3VsdE9iajogdGhpcy5kYXRhLAogICAgICBkb2NCYXNlVXJsOiBhbm5vdGF0aW9uR2xvYmFscy5iYXNlVXJsLAogICAgICBkb2NBdHRhY2htZW50czogYW5ub3RhdGlvbkdsb2JhbHMuYXR0YWNobWVudHMKICAgIH0pOwogIH0KICBnZXQgb3ZlcmxheXNUZXh0Q29udGVudCgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KfQpjbGFzcyBQb3B1cEFubm90YXRpb24gZXh0ZW5kcyBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5QT1BVUDsKICAgIHRoaXMuZGF0YS5ub0hUTUwgPSBmYWxzZTsKICAgIGlmICh0aGlzLndpZHRoID09PSAwIHx8IHRoaXMuaGVpZ2h0ID09PSAwKSB7CiAgICAgIHRoaXMuZGF0YS5yZWN0ID0gbnVsbDsKICAgIH0KICAgIGxldCBwYXJlbnRJdGVtID0gZGljdC5nZXQoIlBhcmVudCIpOwogICAgaWYgKCFwYXJlbnRJdGVtKSB7CiAgICAgIHdhcm4oIlBvcHVwIGFubm90YXRpb24gaGFzIGEgbWlzc2luZyBvciBpbnZhbGlkIHBhcmVudCBhbm5vdGF0aW9uLiIpOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmRhdGEucGFyZW50UmVjdCA9IGxvb2t1cE5vcm1hbFJlY3QocGFyZW50SXRlbS5nZXRBcnJheSgiUmVjdCIpLCBudWxsKTsKICAgIHRoaXMuZGF0YS5jcmVhdGlvbkRhdGUgPSBwYXJlbnRJdGVtLmdldCgiQ3JlYXRpb25EYXRlIikgfHwgIiI7CiAgICBjb25zdCBydCA9IHBhcmVudEl0ZW0uZ2V0KCJSVCIpOwogICAgaWYgKGlzTmFtZShydCwgQW5ub3RhdGlvblJlcGx5VHlwZS5HUk9VUCkpIHsKICAgICAgcGFyZW50SXRlbSA9IHBhcmVudEl0ZW0uZ2V0KCJJUlQiKTsKICAgIH0KICAgIGlmICghcGFyZW50SXRlbS5oYXMoIk0iKSkgewogICAgICB0aGlzLmRhdGEubW9kaWZpY2F0aW9uRGF0ZSA9IG51bGw7CiAgICB9IGVsc2UgewogICAgICB0aGlzLnNldE1vZGlmaWNhdGlvbkRhdGUocGFyZW50SXRlbS5nZXQoIk0iKSk7CiAgICAgIHRoaXMuZGF0YS5tb2RpZmljYXRpb25EYXRlID0gdGhpcy5tb2RpZmljYXRpb25EYXRlOwogICAgfQogICAgaWYgKCFwYXJlbnRJdGVtLmhhcygiQyIpKSB7CiAgICAgIHRoaXMuZGF0YS5jb2xvciA9IG51bGw7CiAgICB9IGVsc2UgewogICAgICB0aGlzLnNldENvbG9yKHBhcmVudEl0ZW0uZ2V0QXJyYXkoIkMiKSk7CiAgICAgIHRoaXMuZGF0YS5jb2xvciA9IHRoaXMuY29sb3I7CiAgICB9CiAgICBpZiAoIXRoaXMudmlld2FibGUpIHsKICAgICAgY29uc3QgcGFyZW50RmxhZ3MgPSBwYXJlbnRJdGVtLmdldCgiRiIpOwogICAgICBpZiAodGhpcy5faXNWaWV3YWJsZShwYXJlbnRGbGFncykpIHsKICAgICAgICB0aGlzLnNldEZsYWdzKHBhcmVudEZsYWdzKTsKICAgICAgfQogICAgfQogICAgdGhpcy5zZXRUaXRsZShwYXJlbnRJdGVtLmdldCgiVCIpKTsKICAgIHRoaXMuZGF0YS50aXRsZU9iaiA9IHRoaXMuX3RpdGxlOwogICAgdGhpcy5zZXRDb250ZW50cyhwYXJlbnRJdGVtLmdldCgiQ29udGVudHMiKSk7CiAgICB0aGlzLmRhdGEuY29udGVudHNPYmogPSB0aGlzLl9jb250ZW50czsKICAgIGlmIChwYXJlbnRJdGVtLmhhcygiUkMiKSkgewogICAgICB0aGlzLmRhdGEucmljaFRleHQgPSBYRkFGYWN0b3J5LmdldFJpY2hUZXh0QXNIdG1sKHBhcmVudEl0ZW0uZ2V0KCJSQyIpKTsKICAgIH0KICAgIHRoaXMuZGF0YS5vcGVuID0gISFkaWN0LmdldCgiT3BlbiIpOwogIH0KICBzdGF0aWMgY3JlYXRlTmV3RGljdChhbm5vdGF0aW9uLCB4cmVmLCBfcGFyYW1zKSB7CiAgICBjb25zdCB7CiAgICAgIG9sZEFubm90YXRpb24sCiAgICAgIHJlY3QsCiAgICAgIHBhcmVudAogICAgfSA9IGFubm90YXRpb247CiAgICBjb25zdCBwb3B1cCA9IG9sZEFubm90YXRpb24gfHwgbmV3IERpY3QoeHJlZik7CiAgICBwb3B1cC5zZXRJZk5vdEV4aXN0cygiVHlwZSIsIE5hbWUuZ2V0KCJBbm5vdCIpKTsKICAgIHBvcHVwLnNldElmTm90RXhpc3RzKCJTdWJ0eXBlIiwgTmFtZS5nZXQoIlBvcHVwIikpOwogICAgcG9wdXAuc2V0SWZOb3RFeGlzdHMoIk9wZW4iLCBmYWxzZSk7CiAgICBwb3B1cC5zZXRJZkFycmF5KCJSZWN0IiwgcmVjdCk7CiAgICBwb3B1cC5zZXQoIlBhcmVudCIsIHBhcmVudCk7CiAgICByZXR1cm4gcG9wdXA7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVOZXdBcHBlYXJhbmNlU3RyZWFtKGFubm90YXRpb24sIHhyZWYsIHBhcmFtcykgewogICAgcmV0dXJuIG51bGw7CiAgfQp9CmNsYXNzIEZyZWVUZXh0QW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEubm9Sb3RhdGU7CiAgICB0aGlzLmRhdGEuaXNFZGl0YWJsZSA9ICF0aGlzLmRhdGEubm9IVE1MOwogICAgdGhpcy5kYXRhLm5vSFRNTCA9IGZhbHNlOwogICAgY29uc3QgewogICAgICBhbm5vdGF0aW9uR2xvYmFscywKICAgICAgZXZhbHVhdG9yT3B0aW9ucywKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLkZSRUVURVhUOwogICAgdGhpcy5zZXREZWZhdWx0QXBwZWFyYW5jZShwYXJhbXMpOwogICAgdGhpcy5faGFzQXBwZWFyYW5jZSA9ICEhdGhpcy5hcHBlYXJhbmNlOwogICAgaWYgKHRoaXMuX2hhc0FwcGVhcmFuY2UpIHsKICAgICAgY29uc3QgewogICAgICAgIGZvbnRDb2xvciwKICAgICAgICBmb250U2l6ZQogICAgICB9ID0gcGFyc2VBcHBlYXJhbmNlU3RyZWFtKHRoaXMuYXBwZWFyYW5jZSwgZXZhbHVhdG9yT3B0aW9ucywgeHJlZiwgYW5ub3RhdGlvbkdsb2JhbHMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlKTsKICAgICAgdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YS5mb250Q29sb3IgPSBmb250Q29sb3I7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEuZm9udFNpemUgPSBmb250U2l6ZSB8fCAxMDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEuZm9udFNpemUgfHw9IDEwOwogICAgICBjb25zdCB7CiAgICAgICAgZm9udENvbG9yLAogICAgICAgIGZvbnRTaXplCiAgICAgIH0gPSB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhOwogICAgICBpZiAodGhpcy5fY29udGVudHMuc3RyKSB7CiAgICAgICAgdGhpcy5kYXRhLnRleHRDb250ZW50ID0gdGhpcy5fY29udGVudHMuc3RyLnNwbGl0KC9cclxuP3xcbi8pLm1hcChsaW5lID0+IGxpbmUudHJpbUVuZCgpKTsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBjb29yZHMsCiAgICAgICAgICBiYm94LAogICAgICAgICAgbWF0cml4CiAgICAgICAgfSA9IEZha2VVbmljb2RlRm9udC5nZXRGaXJzdFBvc2l0aW9uSW5mbyh0aGlzLnJlY3RhbmdsZSwgdGhpcy5yb3RhdGlvbiwgZm9udFNpemUpOwogICAgICAgIHRoaXMuZGF0YS50ZXh0UG9zaXRpb24gPSB0aGlzLl90cmFuc2Zvcm1Qb2ludChjb29yZHMsIGJib3gsIG1hdHJpeCk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuX2lzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKSB7CiAgICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBwYXJhbXMuZGljdC5nZXQoIkNBIik7CiAgICAgICAgY29uc3QgZmFrZVVuaWNvZGVGb250ID0gbmV3IEZha2VVbmljb2RlRm9udCh4cmVmLCAic2Fucy1zZXJpZiIpOwogICAgICAgIHRoaXMuYXBwZWFyYW5jZSA9IGZha2VVbmljb2RlRm9udC5jcmVhdGVBcHBlYXJhbmNlKHRoaXMuX2NvbnRlbnRzLnN0ciwgdGhpcy5yZWN0YW5nbGUsIHRoaXMucm90YXRpb24sIGZvbnRTaXplLCBmb250Q29sb3IsIHN0cm9rZUFscGhhKTsKICAgICAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy5hcHBlYXJhbmNlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKCJGcmVlVGV4dEFubm90YXRpb246IE9mZnNjcmVlbkNhbnZhcyBpcyBub3Qgc3VwcG9ydGVkLCBhbm5vdGF0aW9uIG1heSBub3QgcmVuZGVyIGNvcnJlY3RseS4iKTsKICAgICAgfQogICAgfQogIH0KICBnZXQgaGFzVGV4dENvbnRlbnQoKSB7CiAgICByZXR1cm4gdGhpcy5faGFzQXBwZWFyYW5jZTsKICB9CiAgc3RhdGljIGNyZWF0ZU5ld0RpY3QoYW5ub3RhdGlvbiwgeHJlZiwgewogICAgYXBSZWYsCiAgICBhcAogIH0pIHsKICAgIGNvbnN0IHsKICAgICAgY29sb3IsCiAgICAgIGRhdGUsCiAgICAgIGZvbnRTaXplLAogICAgICBvbGRBbm5vdGF0aW9uLAogICAgICByZWN0LAogICAgICByb3RhdGlvbiwKICAgICAgdXNlciwKICAgICAgdmFsdWUKICAgIH0gPSBhbm5vdGF0aW9uOwogICAgY29uc3QgZnJlZXRleHQgPSBvbGRBbm5vdGF0aW9uIHx8IG5ldyBEaWN0KHhyZWYpOwogICAgZnJlZXRleHQuc2V0SWZOb3RFeGlzdHMoIlR5cGUiLCBOYW1lLmdldCgiQW5ub3QiKSk7CiAgICBmcmVldGV4dC5zZXRJZk5vdEV4aXN0cygiU3VidHlwZSIsIE5hbWUuZ2V0KCJGcmVlVGV4dCIpKTsKICAgIGZyZWV0ZXh0LnNldChvbGRBbm5vdGF0aW9uID8gIk0iIDogIkNyZWF0aW9uRGF0ZSIsIGBEOiR7Z2V0TW9kaWZpY2F0aW9uRGF0ZShkYXRlKX1gKTsKICAgIGlmIChvbGRBbm5vdGF0aW9uKSB7CiAgICAgIGZyZWV0ZXh0LmRlbGV0ZSgiUkMiKTsKICAgIH0KICAgIGZyZWV0ZXh0LnNldElmQXJyYXkoIlJlY3QiLCByZWN0KTsKICAgIGNvbnN0IGRhID0gYC9IZWx2ICR7Zm9udFNpemV9IFRmICR7Z2V0UGRmQ29sb3IoY29sb3IsIHRydWUpfWA7CiAgICBmcmVldGV4dC5zZXQoIkRBIiwgZGEpOwogICAgZnJlZXRleHQuc2V0SWZEZWZpbmVkKCJDb250ZW50cyIsIHN0cmluZ1RvQXNjaWlPclVURjE2QkUodmFsdWUpKTsKICAgIGZyZWV0ZXh0LnNldElmTm90RXhpc3RzKCJGIiwgNCk7CiAgICBmcmVldGV4dC5zZXRJZk5vdEV4aXN0cygiQm9yZGVyIiwgWzAsIDAsIDBdKTsKICAgIGZyZWV0ZXh0LnNldElmTnVtYmVyKCJSb3RhdGUiLCByb3RhdGlvbik7CiAgICBmcmVldGV4dC5zZXRJZkRlZmluZWQoIlQiLCBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKHVzZXIpKTsKICAgIGlmIChhcFJlZiB8fCBhcCkgewogICAgICBjb25zdCBuID0gbmV3IERpY3QoeHJlZik7CiAgICAgIGZyZWV0ZXh0LnNldCgiQVAiLCBuKTsKICAgICAgbi5zZXQoIk4iLCBhcFJlZiB8fCBhcCk7CiAgICB9CiAgICByZXR1cm4gZnJlZXRleHQ7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVOZXdBcHBlYXJhbmNlU3RyZWFtKGFubm90YXRpb24sIHhyZWYsIHBhcmFtcykgewogICAgY29uc3QgewogICAgICBiYXNlRm9udFJlZiwKICAgICAgZXZhbHVhdG9yLAogICAgICB0YXNrCiAgICB9ID0gcGFyYW1zOwogICAgY29uc3QgewogICAgICBjb2xvciwKICAgICAgZm9udFNpemUsCiAgICAgIHJlY3QsCiAgICAgIHJvdGF0aW9uLAogICAgICB2YWx1ZQogICAgfSA9IGFubm90YXRpb247CiAgICBpZiAoIWNvbG9yKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgcmVzb3VyY2VzID0gbmV3IERpY3QoeHJlZik7CiAgICBjb25zdCBmb250ID0gbmV3IERpY3QoeHJlZik7CiAgICBpZiAoYmFzZUZvbnRSZWYpIHsKICAgICAgZm9udC5zZXQoIkhlbHYiLCBiYXNlRm9udFJlZik7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBiYXNlRm9udCA9IG5ldyBEaWN0KHhyZWYpOwogICAgICBiYXNlRm9udC5zZXRJZk5hbWUoIkJhc2VGb250IiwgIkhlbHZldGljYSIpOwogICAgICBiYXNlRm9udC5zZXRJZk5hbWUoIlR5cGUiLCAiRm9udCIpOwogICAgICBiYXNlRm9udC5zZXRJZk5hbWUoIlN1YnR5cGUiLCAiVHlwZTEiKTsKICAgICAgYmFzZUZvbnQuc2V0SWZOYW1lKCJFbmNvZGluZyIsICJXaW5BbnNpRW5jb2RpbmciKTsKICAgICAgZm9udC5zZXQoIkhlbHYiLCBiYXNlRm9udCk7CiAgICB9CiAgICByZXNvdXJjZXMuc2V0KCJGb250IiwgZm9udCk7CiAgICBjb25zdCBoZWx2ID0gYXdhaXQgV2lkZ2V0QW5ub3RhdGlvbi5fZ2V0Rm9udERhdGEoZXZhbHVhdG9yLCB0YXNrLCB7CiAgICAgIGZvbnROYW1lOiAiSGVsdiIsCiAgICAgIGZvbnRTaXplCiAgICB9LCByZXNvdXJjZXMpOwogICAgY29uc3QgW3gxLCB5MSwgeDIsIHkyXSA9IHJlY3Q7CiAgICBsZXQgdyA9IHgyIC0geDE7CiAgICBsZXQgaCA9IHkyIC0geTE7CiAgICBpZiAocm90YXRpb24gJSAxODAgIT09IDApIHsKICAgICAgW3csIGhdID0gW2gsIHddOwogICAgfQogICAgY29uc3QgbGluZXMgPSB2YWx1ZS5zcGxpdCgiXG4iKTsKICAgIGNvbnN0IHNjYWxlID0gZm9udFNpemUgLyAxMDAwOwogICAgbGV0IHRvdGFsV2lkdGggPSAtSW5maW5pdHk7CiAgICBjb25zdCBlbmNvZGVkTGluZXMgPSBbXTsKICAgIGZvciAobGV0IGxpbmUgb2YgbGluZXMpIHsKICAgICAgY29uc3QgZW5jb2RlZCA9IGhlbHYuZW5jb2RlU3RyaW5nKGxpbmUpOwogICAgICBpZiAoZW5jb2RlZC5sZW5ndGggPiAxKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgbGluZSA9IGVuY29kZWQuam9pbigiIik7CiAgICAgIGVuY29kZWRMaW5lcy5wdXNoKGxpbmUpOwogICAgICBsZXQgbGluZVdpZHRoID0gMDsKICAgICAgY29uc3QgZ2x5cGhzID0gaGVsdi5jaGFyc1RvR2x5cGhzKGxpbmUpOwogICAgICBmb3IgKGNvbnN0IGdseXBoIG9mIGdseXBocykgewogICAgICAgIGxpbmVXaWR0aCArPSBnbHlwaC53aWR0aCAqIHNjYWxlOwogICAgICB9CiAgICAgIHRvdGFsV2lkdGggPSBNYXRoLm1heCh0b3RhbFdpZHRoLCBsaW5lV2lkdGgpOwogICAgfQogICAgbGV0IGhzY2FsZSA9IDE7CiAgICBpZiAodG90YWxXaWR0aCA+IHcpIHsKICAgICAgaHNjYWxlID0gdyAvIHRvdGFsV2lkdGg7CiAgICB9CiAgICBsZXQgdnNjYWxlID0gMTsKICAgIGNvbnN0IGxpbmVIZWlnaHQgPSBMSU5FX0ZBQ1RPUiAqIGZvbnRTaXplOwogICAgY29uc3QgbGluZUFzY2VudCA9IChMSU5FX0ZBQ1RPUiAtIExJTkVfREVTQ0VOVF9GQUNUT1IpICogZm9udFNpemU7CiAgICBjb25zdCB0b3RhbEhlaWdodCA9IGxpbmVIZWlnaHQgKiBsaW5lcy5sZW5ndGg7CiAgICBpZiAodG90YWxIZWlnaHQgPiBoKSB7CiAgICAgIHZzY2FsZSA9IGggLyB0b3RhbEhlaWdodDsKICAgIH0KICAgIGNvbnN0IGZzY2FsZSA9IE1hdGgubWluKGhzY2FsZSwgdnNjYWxlKTsKICAgIGNvbnN0IG5ld0ZvbnRTaXplID0gZm9udFNpemUgKiBmc2NhbGU7CiAgICBsZXQgZmlyc3RQb2ludCwgY2xpcEJveCwgbWF0cml4OwogICAgc3dpdGNoIChyb3RhdGlvbikgewogICAgICBjYXNlIDA6CiAgICAgICAgbWF0cml4ID0gWzEsIDAsIDAsIDFdOwogICAgICAgIGNsaXBCb3ggPSBbcmVjdFswXSwgcmVjdFsxXSwgdywgaF07CiAgICAgICAgZmlyc3RQb2ludCA9IFtyZWN0WzBdLCByZWN0WzNdIC0gbGluZUFzY2VudF07CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgOTA6CiAgICAgICAgbWF0cml4ID0gWzAsIDEsIC0xLCAwXTsKICAgICAgICBjbGlwQm94ID0gW3JlY3RbMV0sIC1yZWN0WzJdLCB3LCBoXTsKICAgICAgICBmaXJzdFBvaW50ID0gW3JlY3RbMV0sIC1yZWN0WzBdIC0gbGluZUFzY2VudF07CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMTgwOgogICAgICAgIG1hdHJpeCA9IFstMSwgMCwgMCwgLTFdOwogICAgICAgIGNsaXBCb3ggPSBbLXJlY3RbMl0sIC1yZWN0WzNdLCB3LCBoXTsKICAgICAgICBmaXJzdFBvaW50ID0gWy1yZWN0WzJdLCAtcmVjdFsxXSAtIGxpbmVBc2NlbnRdOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDI3MDoKICAgICAgICBtYXRyaXggPSBbMCwgLTEsIDEsIDBdOwogICAgICAgIGNsaXBCb3ggPSBbLXJlY3RbM10sIHJlY3RbMF0sIHcsIGhdOwogICAgICAgIGZpcnN0UG9pbnQgPSBbLXJlY3RbM10sIHJlY3RbMl0gLSBsaW5lQXNjZW50XTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0IGJ1ZmZlciA9IFsicSIsIGAke21hdHJpeC5qb2luKCIgIil9IDAgMCBjbWAsIGAke2NsaXBCb3guam9pbigiICIpfSByZSBXIG5gLCBgQlRgLCBgJHtnZXRQZGZDb2xvcihjb2xvciwgdHJ1ZSl9YCwgYDAgVGMgL0hlbHYgJHtudW1iZXJUb1N0cmluZyhuZXdGb250U2l6ZSl9IFRmYF07CiAgICBidWZmZXIucHVzaChgJHtmaXJzdFBvaW50LmpvaW4oIiAiKX0gVGQgKCR7ZXNjYXBlU3RyaW5nKGVuY29kZWRMaW5lc1swXSl9KSBUamApOwogICAgY29uc3QgdlNoaWZ0ID0gbnVtYmVyVG9TdHJpbmcobGluZUhlaWdodCk7CiAgICBmb3IgKGxldCBpID0gMSwgaWkgPSBlbmNvZGVkTGluZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBsaW5lID0gZW5jb2RlZExpbmVzW2ldOwogICAgICBidWZmZXIucHVzaChgMCAtJHt2U2hpZnR9IFRkICgke2VzY2FwZVN0cmluZyhsaW5lKX0pIFRqYCk7CiAgICB9CiAgICBidWZmZXIucHVzaCgiRVQiLCAiUSIpOwogICAgY29uc3QgYXBwZWFyYW5jZSA9IGJ1ZmZlci5qb2luKCJcbiIpOwogICAgY29uc3QgYXBwZWFyYW5jZVN0cmVhbURpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiRm9ybVR5cGUiLCAxKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiU3VidHlwZSIsICJGb3JtIik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiWE9iamVjdCIpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJCQm94IiwgcmVjdCk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIlJlc291cmNlcyIsIHJlc291cmNlcyk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIk1hdHJpeCIsIFsxLCAwLCAwLCAxLCAtcmVjdFswXSwgLXJlY3RbMV1dKTsKICAgIGNvbnN0IGFwID0gbmV3IFN0cmluZ1N0cmVhbShhcHBlYXJhbmNlKTsKICAgIGFwLmRpY3QgPSBhcHBlYXJhbmNlU3RyZWFtRGljdDsKICAgIHJldHVybiBhcDsKICB9Cn0KY2xhc3MgTGluZUFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5MSU5FOwogICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IHRoaXMuZGF0YS5ub1JvdGF0ZTsKICAgIHRoaXMuZGF0YS5ub0hUTUwgPSBmYWxzZTsKICAgIGNvbnN0IGxpbmVDb29yZGluYXRlcyA9IGxvb2t1cFJlY3QoZGljdC5nZXRBcnJheSgiTCIpLCBbMCwgMCwgMCwgMF0pOwogICAgdGhpcy5kYXRhLmxpbmVDb29yZGluYXRlcyA9IFV0aWwubm9ybWFsaXplUmVjdChsaW5lQ29vcmRpbmF0ZXMpOwogICAgdGhpcy5zZXRMaW5lRW5kaW5ncyhkaWN0LmdldEFycmF5KCJMRSIpKTsKICAgIHRoaXMuZGF0YS5saW5lRW5kaW5ncyA9IHRoaXMubGluZUVuZGluZ3M7CiAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSkgewogICAgICBjb25zdCBzdHJva2VDb2xvciA9IGdldFBkZkNvbG9yQXJyYXkodGhpcy5jb2xvciwgWzAsIDAsIDBdKTsKICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBkaWN0LmdldCgiQ0EiKTsKICAgICAgY29uc3QgaW50ZXJpb3JDb2xvciA9IGdldFJnYkNvbG9yKGRpY3QuZ2V0QXJyYXkoIklDIiksIG51bGwpOwogICAgICBjb25zdCBmaWxsQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KGludGVyaW9yQ29sb3IpOwogICAgICBjb25zdCBmaWxsQWxwaGEgPSBmaWxsQ29sb3IgPyBzdHJva2VBbHBoYSA6IG51bGw7CiAgICAgIGNvbnN0IGJvcmRlcldpZHRoID0gdGhpcy5ib3JkZXJTdHlsZS53aWR0aCB8fCAxLAogICAgICAgIGJvcmRlckFkanVzdCA9IDIgKiBib3JkZXJXaWR0aDsKICAgICAgY29uc3QgYmJveCA9IFt0aGlzLmRhdGEubGluZUNvb3JkaW5hdGVzWzBdIC0gYm9yZGVyQWRqdXN0LCB0aGlzLmRhdGEubGluZUNvb3JkaW5hdGVzWzFdIC0gYm9yZGVyQWRqdXN0LCB0aGlzLmRhdGEubGluZUNvb3JkaW5hdGVzWzJdICsgYm9yZGVyQWRqdXN0LCB0aGlzLmRhdGEubGluZUNvb3JkaW5hdGVzWzNdICsgYm9yZGVyQWRqdXN0XTsKICAgICAgaWYgKCFVdGlsLmludGVyc2VjdCh0aGlzLnJlY3RhbmdsZSwgYmJveCkpIHsKICAgICAgICB0aGlzLnJlY3RhbmdsZSA9IGJib3g7CiAgICAgIH0KICAgICAgdGhpcy5fc2V0RGVmYXVsdEFwcGVhcmFuY2UoewogICAgICAgIHhyZWYsCiAgICAgICAgZXh0cmE6IGAke2JvcmRlcldpZHRofSB3YCwKICAgICAgICBzdHJva2VDb2xvciwKICAgICAgICBmaWxsQ29sb3IsCiAgICAgICAgc3Ryb2tlQWxwaGEsCiAgICAgICAgZmlsbEFscGhhLAogICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgIGJ1ZmZlci5wdXNoKGAke2xpbmVDb29yZGluYXRlc1swXX0gJHtsaW5lQ29vcmRpbmF0ZXNbMV19IG1gLCBgJHtsaW5lQ29vcmRpbmF0ZXNbMl19ICR7bGluZUNvb3JkaW5hdGVzWzNdfSBsYCwgIlMiKTsKICAgICAgICAgIHJldHVybiBbcG9pbnRzWzBdIC0gYm9yZGVyV2lkdGgsIHBvaW50c1s3XSAtIGJvcmRlcldpZHRoLCBwb2ludHNbMl0gKyBib3JkZXJXaWR0aCwgcG9pbnRzWzNdICsgYm9yZGVyV2lkdGhdOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfQp9CmNsYXNzIFNxdWFyZUFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5TUVVBUkU7CiAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdGhpcy5kYXRhLm5vUm90YXRlOwogICAgdGhpcy5kYXRhLm5vSFRNTCA9IGZhbHNlOwogICAgaWYgKCF0aGlzLmFwcGVhcmFuY2UpIHsKICAgICAgY29uc3Qgc3Ryb2tlQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KHRoaXMuY29sb3IsIFswLCAwLCAwXSk7CiAgICAgIGNvbnN0IHN0cm9rZUFscGhhID0gZGljdC5nZXQoIkNBIik7CiAgICAgIGNvbnN0IGludGVyaW9yQ29sb3IgPSBnZXRSZ2JDb2xvcihkaWN0LmdldEFycmF5KCJJQyIpLCBudWxsKTsKICAgICAgY29uc3QgZmlsbENvbG9yID0gZ2V0UGRmQ29sb3JBcnJheShpbnRlcmlvckNvbG9yKTsKICAgICAgY29uc3QgZmlsbEFscGhhID0gZmlsbENvbG9yID8gc3Ryb2tlQWxwaGEgOiBudWxsOwogICAgICBpZiAodGhpcy5ib3JkZXJTdHlsZS53aWR0aCA9PT0gMCAmJiAhZmlsbENvbG9yKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuX3NldERlZmF1bHRBcHBlYXJhbmNlKHsKICAgICAgICB4cmVmLAogICAgICAgIGV4dHJhOiBgJHt0aGlzLmJvcmRlclN0eWxlLndpZHRofSB3YCwKICAgICAgICBzdHJva2VDb2xvciwKICAgICAgICBmaWxsQ29sb3IsCiAgICAgICAgc3Ryb2tlQWxwaGEsCiAgICAgICAgZmlsbEFscGhhLAogICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgIGNvbnN0IHggPSBwb2ludHNbNF0gKyB0aGlzLmJvcmRlclN0eWxlLndpZHRoIC8gMjsKICAgICAgICAgIGNvbnN0IHkgPSBwb2ludHNbNV0gKyB0aGlzLmJvcmRlclN0eWxlLndpZHRoIC8gMjsKICAgICAgICAgIGNvbnN0IHdpZHRoID0gcG9pbnRzWzZdIC0gcG9pbnRzWzRdIC0gdGhpcy5ib3JkZXJTdHlsZS53aWR0aDsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IHBvaW50c1szXSAtIHBvaW50c1s3XSAtIHRoaXMuYm9yZGVyU3R5bGUud2lkdGg7CiAgICAgICAgICBidWZmZXIucHVzaChgJHt4fSAke3l9ICR7d2lkdGh9ICR7aGVpZ2h0fSByZWApOwogICAgICAgICAgaWYgKGZpbGxDb2xvcikgewogICAgICAgICAgICBidWZmZXIucHVzaCgiQiIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnVmZmVyLnB1c2goIlMiKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBbcG9pbnRzWzBdLCBwb2ludHNbN10sIHBvaW50c1syXSwgcG9pbnRzWzNdXTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0KfQpjbGFzcyBDaXJjbGVBbm5vdGF0aW9uIGV4dGVuZHMgTWFya3VwQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICB4cmVmCiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gQW5ub3RhdGlvblR5cGUuQ0lSQ0xFOwogICAgaWYgKCF0aGlzLmFwcGVhcmFuY2UpIHsKICAgICAgY29uc3Qgc3Ryb2tlQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KHRoaXMuY29sb3IsIFswLCAwLCAwXSk7CiAgICAgIGNvbnN0IHN0cm9rZUFscGhhID0gZGljdC5nZXQoIkNBIik7CiAgICAgIGNvbnN0IGludGVyaW9yQ29sb3IgPSBnZXRSZ2JDb2xvcihkaWN0LmdldEFycmF5KCJJQyIpLCBudWxsKTsKICAgICAgY29uc3QgZmlsbENvbG9yID0gZ2V0UGRmQ29sb3JBcnJheShpbnRlcmlvckNvbG9yKTsKICAgICAgY29uc3QgZmlsbEFscGhhID0gZmlsbENvbG9yID8gc3Ryb2tlQWxwaGEgOiBudWxsOwogICAgICBpZiAodGhpcy5ib3JkZXJTdHlsZS53aWR0aCA9PT0gMCAmJiAhZmlsbENvbG9yKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IGNvbnRyb2xQb2ludHNEaXN0YW5jZSA9IDQgLyAzICogTWF0aC50YW4oTWF0aC5QSSAvICgyICogNCkpOwogICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgeHJlZiwKICAgICAgICBleHRyYTogYCR7dGhpcy5ib3JkZXJTdHlsZS53aWR0aH0gd2AsCiAgICAgICAgc3Ryb2tlQ29sb3IsCiAgICAgICAgZmlsbENvbG9yLAogICAgICAgIHN0cm9rZUFscGhhLAogICAgICAgIGZpbGxBbHBoYSwKICAgICAgICBwb2ludHNDYWxsYmFjazogKGJ1ZmZlciwgcG9pbnRzKSA9PiB7CiAgICAgICAgICBjb25zdCB4MCA9IHBvaW50c1swXSArIHRoaXMuYm9yZGVyU3R5bGUud2lkdGggLyAyOwogICAgICAgICAgY29uc3QgeTAgPSBwb2ludHNbMV0gLSB0aGlzLmJvcmRlclN0eWxlLndpZHRoIC8gMjsKICAgICAgICAgIGNvbnN0IHgxID0gcG9pbnRzWzZdIC0gdGhpcy5ib3JkZXJTdHlsZS53aWR0aCAvIDI7CiAgICAgICAgICBjb25zdCB5MSA9IHBvaW50c1s3XSArIHRoaXMuYm9yZGVyU3R5bGUud2lkdGggLyAyOwogICAgICAgICAgY29uc3QgeE1pZCA9IHgwICsgKHgxIC0geDApIC8gMjsKICAgICAgICAgIGNvbnN0IHlNaWQgPSB5MCArICh5MSAtIHkwKSAvIDI7CiAgICAgICAgICBjb25zdCB4T2Zmc2V0ID0gKHgxIC0geDApIC8gMiAqIGNvbnRyb2xQb2ludHNEaXN0YW5jZTsKICAgICAgICAgIGNvbnN0IHlPZmZzZXQgPSAoeTEgLSB5MCkgLyAyICogY29udHJvbFBvaW50c0Rpc3RhbmNlOwogICAgICAgICAgYnVmZmVyLnB1c2goYCR7eE1pZH0gJHt5MX0gbWAsIGAke3hNaWQgKyB4T2Zmc2V0fSAke3kxfSAke3gxfSAke3lNaWQgKyB5T2Zmc2V0fSAke3gxfSAke3lNaWR9IGNgLCBgJHt4MX0gJHt5TWlkIC0geU9mZnNldH0gJHt4TWlkICsgeE9mZnNldH0gJHt5MH0gJHt4TWlkfSAke3kwfSBjYCwgYCR7eE1pZCAtIHhPZmZzZXR9ICR7eTB9ICR7eDB9ICR7eU1pZCAtIHlPZmZzZXR9ICR7eDB9ICR7eU1pZH0gY2AsIGAke3gwfSAke3lNaWQgKyB5T2Zmc2V0fSAke3hNaWQgLSB4T2Zmc2V0fSAke3kxfSAke3hNaWR9ICR7eTF9IGNgLCAiaCIpOwogICAgICAgICAgaWYgKGZpbGxDb2xvcikgewogICAgICAgICAgICBidWZmZXIucHVzaCgiQiIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnVmZmVyLnB1c2goIlMiKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBbcG9pbnRzWzBdLCBwb2ludHNbN10sIHBvaW50c1syXSwgcG9pbnRzWzNdXTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0KfQpjbGFzcyBQb2x5bGluZUFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5QT0xZTElORTsKICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEubm9Sb3RhdGU7CiAgICB0aGlzLmRhdGEubm9IVE1MID0gZmFsc2U7CiAgICB0aGlzLmRhdGEudmVydGljZXMgPSBudWxsOwogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFBvbHlnb25Bbm5vdGF0aW9uKSkgewogICAgICB0aGlzLnNldExpbmVFbmRpbmdzKGRpY3QuZ2V0QXJyYXkoIkxFIikpOwogICAgICB0aGlzLmRhdGEubGluZUVuZGluZ3MgPSB0aGlzLmxpbmVFbmRpbmdzOwogICAgfQogICAgY29uc3QgcmF3VmVydGljZXMgPSBkaWN0LmdldEFycmF5KCJWZXJ0aWNlcyIpOwogICAgaWYgKCFpc051bWJlckFycmF5KHJhd1ZlcnRpY2VzLCBudWxsKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMuZGF0YS52ZXJ0aWNlcyA9IEZsb2F0MzJBcnJheS5mcm9tKHJhd1ZlcnRpY2VzKTsKICAgIGlmICghdGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgIGNvbnN0IHN0cm9rZUNvbG9yID0gZ2V0UGRmQ29sb3JBcnJheSh0aGlzLmNvbG9yLCBbMCwgMCwgMF0pOwogICAgICBjb25zdCBzdHJva2VBbHBoYSA9IGRpY3QuZ2V0KCJDQSIpOwogICAgICBsZXQgZmlsbENvbG9yID0gZ2V0UmdiQ29sb3IoZGljdC5nZXRBcnJheSgiSUMiKSwgbnVsbCk7CiAgICAgIGlmIChmaWxsQ29sb3IpIHsKICAgICAgICBmaWxsQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KGZpbGxDb2xvcik7CiAgICAgIH0KICAgICAgbGV0IG9wZXJhdG9yOwogICAgICBpZiAoZmlsbENvbG9yKSB7CiAgICAgICAgaWYgKHRoaXMuY29sb3IpIHsKICAgICAgICAgIG9wZXJhdG9yID0gZmlsbENvbG9yLmV2ZXJ5KChjLCBpKSA9PiBjID09PSBzdHJva2VDb2xvcltpXSkgPyAiZiIgOiAiQiI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG9wZXJhdG9yID0gImYiOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBvcGVyYXRvciA9ICJTIjsKICAgICAgfQogICAgICBjb25zdCBib3JkZXJXaWR0aCA9IHRoaXMuYm9yZGVyU3R5bGUud2lkdGggfHwgMSwKICAgICAgICBib3JkZXJBZGp1c3QgPSAyICogYm9yZGVyV2lkdGg7CiAgICAgIGNvbnN0IGJib3ggPSBbSW5maW5pdHksIEluZmluaXR5LCAtSW5maW5pdHksIC1JbmZpbml0eV07CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHZlcnRpY2VzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICBVdGlsLnJlY3RCb3VuZGluZ0JveCh2ZXJ0aWNlc1tpXSAtIGJvcmRlckFkanVzdCwgdmVydGljZXNbaSArIDFdIC0gYm9yZGVyQWRqdXN0LCB2ZXJ0aWNlc1tpXSArIGJvcmRlckFkanVzdCwgdmVydGljZXNbaSArIDFdICsgYm9yZGVyQWRqdXN0LCBiYm94KTsKICAgICAgfQogICAgICBpZiAoIVV0aWwuaW50ZXJzZWN0KHRoaXMucmVjdGFuZ2xlLCBiYm94KSkgewogICAgICAgIHRoaXMucmVjdGFuZ2xlID0gYmJveDsKICAgICAgfQogICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgeHJlZiwKICAgICAgICBleHRyYTogYCR7Ym9yZGVyV2lkdGh9IHdgLAogICAgICAgIHN0cm9rZUNvbG9yLAogICAgICAgIHN0cm9rZUFscGhhLAogICAgICAgIGZpbGxDb2xvciwKICAgICAgICBmaWxsQWxwaGE6IGZpbGxDb2xvciA/IHN0cm9rZUFscGhhIDogbnVsbCwKICAgICAgICBwb2ludHNDYWxsYmFjazogKGJ1ZmZlciwgcG9pbnRzKSA9PiB7CiAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB2ZXJ0aWNlcy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKGAke3ZlcnRpY2VzW2ldfSAke3ZlcnRpY2VzW2kgKyAxXX0gJHtpID09PSAwID8gIm0iIDogImwifWApOwogICAgICAgICAgfQogICAgICAgICAgYnVmZmVyLnB1c2gob3BlcmF0b3IpOwogICAgICAgICAgcmV0dXJuIFtwb2ludHNbMF0sIHBvaW50c1s3XSwgcG9pbnRzWzJdLCBwb2ludHNbM11dOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfQp9CmNsYXNzIFBvbHlnb25Bbm5vdGF0aW9uIGV4dGVuZHMgUG9seWxpbmVBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5QT0xZR09OOwogIH0KfQpjbGFzcyBDYXJldEFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5DQVJFVDsKICB9Cn0KY2xhc3MgSW5rQW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEubm9Sb3RhdGU7CiAgICB0aGlzLmRhdGEubm9IVE1MID0gZmFsc2U7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5JTks7CiAgICB0aGlzLmRhdGEuaW5rTGlzdHMgPSBbXTsKICAgIHRoaXMuZGF0YS5pc0VkaXRhYmxlID0gIXRoaXMuZGF0YS5ub0hUTUw7CiAgICB0aGlzLmRhdGEubm9IVE1MID0gZmFsc2U7CiAgICB0aGlzLmRhdGEub3BhY2l0eSA9IGRpY3QuZ2V0KCJDQSIpIHx8IDE7CiAgICBjb25zdCByYXdJbmtMaXN0cyA9IGRpY3QuZ2V0QXJyYXkoIklua0xpc3QiKTsKICAgIGlmICghQXJyYXkuaXNBcnJheShyYXdJbmtMaXN0cykpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gcmF3SW5rTGlzdHMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICBpZiAoIUFycmF5LmlzQXJyYXkocmF3SW5rTGlzdHNbaV0pKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgaW5rTGlzdCA9IG5ldyBGbG9hdDMyQXJyYXkocmF3SW5rTGlzdHNbaV0ubGVuZ3RoKTsKICAgICAgdGhpcy5kYXRhLmlua0xpc3RzLnB1c2goaW5rTGlzdCk7CiAgICAgIGZvciAobGV0IGogPSAwLCBqaiA9IHJhd0lua0xpc3RzW2ldLmxlbmd0aDsgaiA8IGpqOyBqICs9IDIpIHsKICAgICAgICBjb25zdCB4ID0geHJlZi5mZXRjaElmUmVmKHJhd0lua0xpc3RzW2ldW2pdKSwKICAgICAgICAgIHkgPSB4cmVmLmZldGNoSWZSZWYocmF3SW5rTGlzdHNbaV1baiArIDFdKTsKICAgICAgICBpZiAodHlwZW9mIHggPT09ICJudW1iZXIiICYmIHR5cGVvZiB5ID09PSAibnVtYmVyIikgewogICAgICAgICAgaW5rTGlzdFtqXSA9IHg7CiAgICAgICAgICBpbmtMaXN0W2ogKyAxXSA9IHk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSkgewogICAgICBjb25zdCBzdHJva2VDb2xvciA9IGdldFBkZkNvbG9yQXJyYXkodGhpcy5jb2xvciwgWzAsIDAsIDBdKTsKICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBkaWN0LmdldCgiQ0EiKTsKICAgICAgY29uc3QgYm9yZGVyV2lkdGggPSB0aGlzLmJvcmRlclN0eWxlLndpZHRoIHx8IDEsCiAgICAgICAgYm9yZGVyQWRqdXN0ID0gMiAqIGJvcmRlcldpZHRoOwogICAgICBjb25zdCBiYm94ID0gW0luZmluaXR5LCBJbmZpbml0eSwgLUluZmluaXR5LCAtSW5maW5pdHldOwogICAgICBmb3IgKGNvbnN0IGlua0xpc3Qgb2YgdGhpcy5kYXRhLmlua0xpc3RzKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gaW5rTGlzdC5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgICAgICBVdGlsLnJlY3RCb3VuZGluZ0JveChpbmtMaXN0W2ldIC0gYm9yZGVyQWRqdXN0LCBpbmtMaXN0W2kgKyAxXSAtIGJvcmRlckFkanVzdCwgaW5rTGlzdFtpXSArIGJvcmRlckFkanVzdCwgaW5rTGlzdFtpICsgMV0gKyBib3JkZXJBZGp1c3QsIGJib3gpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIVV0aWwuaW50ZXJzZWN0KHRoaXMucmVjdGFuZ2xlLCBiYm94KSkgewogICAgICAgIHRoaXMucmVjdGFuZ2xlID0gYmJveDsKICAgICAgfQogICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgeHJlZiwKICAgICAgICBleHRyYTogYCR7Ym9yZGVyV2lkdGh9IHdgLAogICAgICAgIHN0cm9rZUNvbG9yLAogICAgICAgIHN0cm9rZUFscGhhLAogICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgIGZvciAoY29uc3QgaW5rTGlzdCBvZiB0aGlzLmRhdGEuaW5rTGlzdHMpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gaW5rTGlzdC5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgICAgICAgICAgYnVmZmVyLnB1c2goYCR7aW5rTGlzdFtpXX0gJHtpbmtMaXN0W2kgKyAxXX0gJHtpID09PSAwID8gIm0iIDogImwifWApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCJTIik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gW3BvaW50c1swXSwgcG9pbnRzWzddLCBwb2ludHNbMl0sIHBvaW50c1szXV07CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9CiAgc3RhdGljIGNyZWF0ZU5ld0RpY3QoYW5ub3RhdGlvbiwgeHJlZiwgewogICAgYXBSZWYsCiAgICBhcAogIH0pIHsKICAgIGNvbnN0IHsKICAgICAgb2xkQW5ub3RhdGlvbiwKICAgICAgY29sb3IsCiAgICAgIGRhdGUsCiAgICAgIG9wYWNpdHksCiAgICAgIHBhdGhzLAogICAgICBvdXRsaW5lcywKICAgICAgcmVjdCwKICAgICAgcm90YXRpb24sCiAgICAgIHRoaWNrbmVzcywKICAgICAgdXNlcgogICAgfSA9IGFubm90YXRpb247CiAgICBjb25zdCBpbmsgPSBvbGRBbm5vdGF0aW9uIHx8IG5ldyBEaWN0KHhyZWYpOwogICAgaW5rLnNldElmTm90RXhpc3RzKCJUeXBlIiwgTmFtZS5nZXQoIkFubm90IikpOwogICAgaW5rLnNldElmTm90RXhpc3RzKCJTdWJ0eXBlIiwgTmFtZS5nZXQoIkluayIpKTsKICAgIGluay5zZXQob2xkQW5ub3RhdGlvbiA/ICJNIiA6ICJDcmVhdGlvbkRhdGUiLCBgRDoke2dldE1vZGlmaWNhdGlvbkRhdGUoZGF0ZSl9YCk7CiAgICBpbmsuc2V0SWZBcnJheSgiUmVjdCIsIHJlY3QpOwogICAgaW5rLnNldElmQXJyYXkoIklua0xpc3QiLCBvdXRsaW5lcz8ucG9pbnRzIHx8IHBhdGhzPy5wb2ludHMpOwogICAgaW5rLnNldElmTm90RXhpc3RzKCJGIiwgNCk7CiAgICBpbmsuc2V0SWZOdW1iZXIoIlJvdGF0ZSIsIHJvdGF0aW9uKTsKICAgIGluay5zZXRJZkRlZmluZWQoIlQiLCBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKHVzZXIpKTsKICAgIGlmIChvdXRsaW5lcykgewogICAgICBpbmsuc2V0SWZOYW1lKCJJVCIsICJJbmtIaWdobGlnaHQiKTsKICAgIH0KICAgIGlmICh0aGlja25lc3MgPiAwKSB7CiAgICAgIGNvbnN0IGJzID0gbmV3IERpY3QoeHJlZik7CiAgICAgIGluay5zZXQoIkJTIiwgYnMpOwogICAgICBicy5zZXQoIlciLCB0aGlja25lc3MpOwogICAgfQogICAgaW5rLnNldElmQXJyYXkoIkMiLCBnZXRQZGZDb2xvckFycmF5KGNvbG9yKSk7CiAgICBpbmsuc2V0SWZOdW1iZXIoIkNBIiwgb3BhY2l0eSk7CiAgICBpZiAoYXAgfHwgYXBSZWYpIHsKICAgICAgY29uc3QgbiA9IG5ldyBEaWN0KHhyZWYpOwogICAgICBpbmsuc2V0KCJBUCIsIG4pOwogICAgICBuLnNldCgiTiIsIGFwUmVmIHx8IGFwKTsKICAgIH0KICAgIHJldHVybiBpbms7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVOZXdBcHBlYXJhbmNlU3RyZWFtKGFubm90YXRpb24sIHhyZWYsIHBhcmFtcykgewogICAgaWYgKGFubm90YXRpb24ub3V0bGluZXMpIHsKICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlTmV3QXBwZWFyYW5jZVN0cmVhbUZvckhpZ2hsaWdodChhbm5vdGF0aW9uLCB4cmVmLCBwYXJhbXMpOwogICAgfQogICAgY29uc3QgewogICAgICBjb2xvciwKICAgICAgcmVjdCwKICAgICAgcGF0aHMsCiAgICAgIHRoaWNrbmVzcywKICAgICAgb3BhY2l0eQogICAgfSA9IGFubm90YXRpb247CiAgICBpZiAoIWNvbG9yKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgYXBwZWFyYW5jZUJ1ZmZlciA9IFtgJHt0aGlja25lc3N9IHcgMSBKIDEgamAsIGAke2dldFBkZkNvbG9yKGNvbG9yLCBmYWxzZSl9YF07CiAgICBpZiAob3BhY2l0eSAhPT0gMSkgewogICAgICBhcHBlYXJhbmNlQnVmZmVyLnB1c2goIi9SMCBncyIpOwogICAgfQogICAgZm9yIChjb25zdCBvdXRsaW5lIG9mIHBhdGhzLmxpbmVzKSB7CiAgICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaChgJHtudW1iZXJUb1N0cmluZyhvdXRsaW5lWzRdKX0gJHtudW1iZXJUb1N0cmluZyhvdXRsaW5lWzVdKX0gbWApOwogICAgICBmb3IgKGxldCBpID0gNiwgaWkgPSBvdXRsaW5lLmxlbmd0aDsgaSA8IGlpOyBpICs9IDYpIHsKICAgICAgICBpZiAoaXNOYU4ob3V0bGluZVtpXSkpIHsKICAgICAgICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaChgJHtudW1iZXJUb1N0cmluZyhvdXRsaW5lW2kgKyA0XSl9ICR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVtpICsgNV0pfSBsYCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IFtjMXgsIGMxeSwgYzJ4LCBjMnksIHgsIHldID0gb3V0bGluZS5zbGljZShpLCBpICsgNik7CiAgICAgICAgICBhcHBlYXJhbmNlQnVmZmVyLnB1c2goW2MxeCwgYzF5LCBjMngsIGMyeSwgeCwgeV0ubWFwKG51bWJlclRvU3RyaW5nKS5qb2luKCIgIikgKyAiIGMiKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKG91dGxpbmUubGVuZ3RoID09PSA2KSB7CiAgICAgICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKGAke251bWJlclRvU3RyaW5nKG91dGxpbmVbNF0pfSAke251bWJlclRvU3RyaW5nKG91dGxpbmVbNV0pfSBsYCk7CiAgICAgIH0KICAgIH0KICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaCgiUyIpOwogICAgY29uc3QgYXBwZWFyYW5jZSA9IGFwcGVhcmFuY2VCdWZmZXIuam9pbigiXG4iKTsKICAgIGNvbnN0IGFwcGVhcmFuY2VTdHJlYW1EaWN0ID0gbmV3IERpY3QoeHJlZik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkZvcm1UeXBlIiwgMSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlN1YnR5cGUiLCAiRm9ybSIpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0SWZOYW1lKCJUeXBlIiwgIlhPYmplY3QiKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiQkJveCIsIHJlY3QpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJMZW5ndGgiLCBhcHBlYXJhbmNlLmxlbmd0aCk7CiAgICBpZiAob3BhY2l0eSAhPT0gMSkgewogICAgICBjb25zdCByZXNvdXJjZXMgPSBuZXcgRGljdCh4cmVmKTsKICAgICAgY29uc3QgZXh0R1N0YXRlID0gbmV3IERpY3QoeHJlZik7CiAgICAgIGNvbnN0IHIwID0gbmV3IERpY3QoeHJlZik7CiAgICAgIHIwLnNldCgiQ0EiLCBvcGFjaXR5KTsKICAgICAgcjAuc2V0SWZOYW1lKCJUeXBlIiwgIkV4dEdTdGF0ZSIpOwogICAgICBleHRHU3RhdGUuc2V0KCJSMCIsIHIwKTsKICAgICAgcmVzb3VyY2VzLnNldCgiRXh0R1N0YXRlIiwgZXh0R1N0YXRlKTsKICAgICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJSZXNvdXJjZXMiLCByZXNvdXJjZXMpOwogICAgfQogICAgY29uc3QgYXAgPSBuZXcgU3RyaW5nU3RyZWFtKGFwcGVhcmFuY2UpOwogICAgYXAuZGljdCA9IGFwcGVhcmFuY2VTdHJlYW1EaWN0OwogICAgcmV0dXJuIGFwOwogIH0KICBzdGF0aWMgYXN5bmMgY3JlYXRlTmV3QXBwZWFyYW5jZVN0cmVhbUZvckhpZ2hsaWdodChhbm5vdGF0aW9uLCB4cmVmLCBwYXJhbXMpIHsKICAgIGNvbnN0IHsKICAgICAgY29sb3IsCiAgICAgIHJlY3QsCiAgICAgIG91dGxpbmVzOiB7CiAgICAgICAgb3V0bGluZQogICAgICB9LAogICAgICBvcGFjaXR5CiAgICB9ID0gYW5ub3RhdGlvbjsKICAgIGlmICghY29sb3IpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBhcHBlYXJhbmNlQnVmZmVyID0gW2Ake2dldFBkZkNvbG9yKGNvbG9yLCB0cnVlKX1gLCAiL1IwIGdzIl07CiAgICBhcHBlYXJhbmNlQnVmZmVyLnB1c2goYCR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVs0XSl9ICR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVs1XSl9IG1gKTsKICAgIGZvciAobGV0IGkgPSA2LCBpaSA9IG91dGxpbmUubGVuZ3RoOyBpIDwgaWk7IGkgKz0gNikgewogICAgICBpZiAoaXNOYU4ob3V0bGluZVtpXSkpIHsKICAgICAgICBhcHBlYXJhbmNlQnVmZmVyLnB1c2goYCR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVtpICsgNF0pfSAke251bWJlclRvU3RyaW5nKG91dGxpbmVbaSArIDVdKX0gbGApOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IFtjMXgsIGMxeSwgYzJ4LCBjMnksIHgsIHldID0gb3V0bGluZS5zbGljZShpLCBpICsgNik7CiAgICAgICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKFtjMXgsIGMxeSwgYzJ4LCBjMnksIHgsIHldLm1hcChudW1iZXJUb1N0cmluZykuam9pbigiICIpICsgIiBjIik7CiAgICAgIH0KICAgIH0KICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaCgiaCBmIik7CiAgICBjb25zdCBhcHBlYXJhbmNlID0gYXBwZWFyYW5jZUJ1ZmZlci5qb2luKCJcbiIpOwogICAgY29uc3QgYXBwZWFyYW5jZVN0cmVhbURpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiRm9ybVR5cGUiLCAxKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiU3VidHlwZSIsICJGb3JtIik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiWE9iamVjdCIpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJCQm94IiwgcmVjdCk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkxlbmd0aCIsIGFwcGVhcmFuY2UubGVuZ3RoKTsKICAgIGNvbnN0IHJlc291cmNlcyA9IG5ldyBEaWN0KHhyZWYpOwogICAgY29uc3QgZXh0R1N0YXRlID0gbmV3IERpY3QoeHJlZik7CiAgICByZXNvdXJjZXMuc2V0KCJFeHRHU3RhdGUiLCBleHRHU3RhdGUpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJSZXNvdXJjZXMiLCByZXNvdXJjZXMpOwogICAgY29uc3QgcjAgPSBuZXcgRGljdCh4cmVmKTsKICAgIGV4dEdTdGF0ZS5zZXQoIlIwIiwgcjApOwogICAgcjAuc2V0SWZOYW1lKCJCTSIsICJNdWx0aXBseSIpOwogICAgaWYgKG9wYWNpdHkgIT09IDEpIHsKICAgICAgcjAuc2V0KCJjYSIsIG9wYWNpdHkpOwogICAgICByMC5zZXRJZk5hbWUoIlR5cGUiLCAiRXh0R1N0YXRlIik7CiAgICB9CiAgICBjb25zdCBhcCA9IG5ldyBTdHJpbmdTdHJlYW0oYXBwZWFyYW5jZSk7CiAgICBhcC5kaWN0ID0gYXBwZWFyYW5jZVN0cmVhbURpY3Q7CiAgICByZXR1cm4gYXA7CiAgfQp9CmNsYXNzIEhpZ2hsaWdodEFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBBbm5vdGF0aW9uVHlwZS5ISUdITElHSFQ7CiAgICB0aGlzLmRhdGEuaXNFZGl0YWJsZSA9ICF0aGlzLmRhdGEubm9IVE1MOwogICAgdGhpcy5kYXRhLm5vSFRNTCA9IGZhbHNlOwogICAgdGhpcy5kYXRhLm9wYWNpdHkgPSBkaWN0LmdldCgiQ0EiKSB8fCAxOwogICAgY29uc3QgcXVhZFBvaW50cyA9IHRoaXMuZGF0YS5xdWFkUG9pbnRzID0gZ2V0UXVhZFBvaW50cyhkaWN0LCBudWxsKTsKICAgIGlmIChxdWFkUG9pbnRzKSB7CiAgICAgIGNvbnN0IHJlc291cmNlcyA9IHRoaXMuYXBwZWFyYW5jZT8uZGljdC5nZXQoIlJlc291cmNlcyIpOwogICAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSB8fCAhcmVzb3VyY2VzPy5oYXMoIkV4dEdTdGF0ZSIpKSB7CiAgICAgICAgaWYgKHRoaXMuYXBwZWFyYW5jZSkgewogICAgICAgICAgd2FybigiSGlnaGxpZ2h0QW5ub3RhdGlvbiAtIGlnbm9yaW5nIGJ1aWx0LWluIGFwcGVhcmFuY2Ugc3RyZWFtLiIpOwogICAgICAgIH0KICAgICAgICBjb25zdCBmaWxsQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KHRoaXMuY29sb3IsIFsxLCAxLCAwXSk7CiAgICAgICAgY29uc3QgZmlsbEFscGhhID0gZGljdC5nZXQoIkNBIik7CiAgICAgICAgdGhpcy5fc2V0RGVmYXVsdEFwcGVhcmFuY2UoewogICAgICAgICAgeHJlZiwKICAgICAgICAgIGZpbGxDb2xvciwKICAgICAgICAgIGJsZW5kTW9kZTogIk11bHRpcGx5IiwKICAgICAgICAgIGZpbGxBbHBoYSwKICAgICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgICAgYnVmZmVyLnB1c2goYCR7cG9pbnRzWzBdfSAke3BvaW50c1sxXX0gbWAsIGAke3BvaW50c1syXX0gJHtwb2ludHNbM119IGxgLCBgJHtwb2ludHNbNl19ICR7cG9pbnRzWzddfSBsYCwgYCR7cG9pbnRzWzRdfSAke3BvaW50c1s1XX0gbGAsICJmIik7CiAgICAgICAgICAgIHJldHVybiBbcG9pbnRzWzBdLCBwb2ludHNbN10sIHBvaW50c1syXSwgcG9pbnRzWzNdXTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kYXRhLnBvcHVwUmVmID0gbnVsbDsKICAgIH0KICB9CiAgZ2V0IG92ZXJsYXlzVGV4dENvbnRlbnQoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgc3RhdGljIGNyZWF0ZU5ld0RpY3QoYW5ub3RhdGlvbiwgeHJlZiwgewogICAgYXBSZWYsCiAgICBhcAogIH0pIHsKICAgIGNvbnN0IHsKICAgICAgY29sb3IsCiAgICAgIGRhdGUsCiAgICAgIG9sZEFubm90YXRpb24sCiAgICAgIG9wYWNpdHksCiAgICAgIHJlY3QsCiAgICAgIHJvdGF0aW9uLAogICAgICB1c2VyLAogICAgICBxdWFkUG9pbnRzCiAgICB9ID0gYW5ub3RhdGlvbjsKICAgIGNvbnN0IGhpZ2hsaWdodCA9IG9sZEFubm90YXRpb24gfHwgbmV3IERpY3QoeHJlZik7CiAgICBoaWdobGlnaHQuc2V0SWZOb3RFeGlzdHMoIlR5cGUiLCBOYW1lLmdldCgiQW5ub3QiKSk7CiAgICBoaWdobGlnaHQuc2V0SWZOb3RFeGlzdHMoIlN1YnR5cGUiLCBOYW1lLmdldCgiSGlnaGxpZ2h0IikpOwogICAgaGlnaGxpZ2h0LnNldChvbGRBbm5vdGF0aW9uID8gIk0iIDogIkNyZWF0aW9uRGF0ZSIsIGBEOiR7Z2V0TW9kaWZpY2F0aW9uRGF0ZShkYXRlKX1gKTsKICAgIGhpZ2hsaWdodC5zZXRJZkFycmF5KCJSZWN0IiwgcmVjdCk7CiAgICBoaWdobGlnaHQuc2V0SWZOb3RFeGlzdHMoIkYiLCA0KTsKICAgIGhpZ2hsaWdodC5zZXRJZk5vdEV4aXN0cygiQm9yZGVyIiwgWzAsIDAsIDBdKTsKICAgIGhpZ2hsaWdodC5zZXRJZk51bWJlcigiUm90YXRlIiwgcm90YXRpb24pOwogICAgaGlnaGxpZ2h0LnNldElmQXJyYXkoIlF1YWRQb2ludHMiLCBxdWFkUG9pbnRzKTsKICAgIGhpZ2hsaWdodC5zZXRJZkFycmF5KCJDIiwgZ2V0UGRmQ29sb3JBcnJheShjb2xvcikpOwogICAgaGlnaGxpZ2h0LnNldElmTnVtYmVyKCJDQSIsIG9wYWNpdHkpOwogICAgaGlnaGxpZ2h0LnNldElmRGVmaW5lZCgiVCIsIHN0cmluZ1RvQXNjaWlPclVURjE2QkUodXNlcikpOwogICAgaWYgKGFwUmVmIHx8IGFwKSB7CiAgICAgIGNvbnN0IG4gPSBuZXcgRGljdCh4cmVmKTsKICAgICAgaGlnaGxpZ2h0LnNldCgiQVAiLCBuKTsKICAgICAgbi5zZXQoIk4iLCBhcFJlZiB8fCBhcCk7CiAgICB9CiAgICByZXR1cm4gaGlnaGxpZ2h0OwogIH0KICBzdGF0aWMgYXN5bmMgY3JlYXRlTmV3QXBwZWFyYW5jZVN0cmVhbShhbm5vdGF0aW9uLCB4cmVmLCBwYXJhbXMpIHsKICAgIGNvbnN0IHsKICAgICAgY29sb3IsCiAgICAgIHJlY3QsCiAgICAgIG91dGxpbmVzLAogICAgICBvcGFjaXR5CiAgICB9ID0gYW5ub3RhdGlvbjsKICAgIGlmICghY29sb3IpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBhcHBlYXJhbmNlQnVmZmVyID0gW2Ake2dldFBkZkNvbG9yKGNvbG9yLCB0cnVlKX1gLCAiL1IwIGdzIl07CiAgICBjb25zdCBidWZmZXIgPSBbXTsKICAgIGZvciAoY29uc3Qgb3V0bGluZSBvZiBvdXRsaW5lcykgewogICAgICBidWZmZXIubGVuZ3RoID0gMDsKICAgICAgYnVmZmVyLnB1c2goYCR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVswXSl9ICR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVsxXSl9IG1gKTsKICAgICAgZm9yIChsZXQgaSA9IDIsIGlpID0gb3V0bGluZS5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgICAgYnVmZmVyLnB1c2goYCR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVtpXSl9ICR7bnVtYmVyVG9TdHJpbmcob3V0bGluZVtpICsgMV0pfSBsYCk7CiAgICAgIH0KICAgICAgYnVmZmVyLnB1c2goImgiKTsKICAgICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKGJ1ZmZlci5qb2luKCJcbiIpKTsKICAgIH0KICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaCgiZioiKTsKICAgIGNvbnN0IGFwcGVhcmFuY2UgPSBhcHBlYXJhbmNlQnVmZmVyLmpvaW4oIlxuIik7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJGb3JtVHlwZSIsIDEpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIkZvcm0iKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiVHlwZSIsICJYT2JqZWN0Iik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkJCb3giLCByZWN0KTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiTGVuZ3RoIiwgYXBwZWFyYW5jZS5sZW5ndGgpOwogICAgY29uc3QgcmVzb3VyY2VzID0gbmV3IERpY3QoeHJlZik7CiAgICBjb25zdCBleHRHU3RhdGUgPSBuZXcgRGljdCh4cmVmKTsKICAgIHJlc291cmNlcy5zZXQoIkV4dEdTdGF0ZSIsIGV4dEdTdGF0ZSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIlJlc291cmNlcyIsIHJlc291cmNlcyk7CiAgICBjb25zdCByMCA9IG5ldyBEaWN0KHhyZWYpOwogICAgZXh0R1N0YXRlLnNldCgiUjAiLCByMCk7CiAgICByMC5zZXRJZk5hbWUoIkJNIiwgIk11bHRpcGx5Iik7CiAgICBpZiAob3BhY2l0eSAhPT0gMSkgewogICAgICByMC5zZXQoImNhIiwgb3BhY2l0eSk7CiAgICAgIHIwLnNldElmTmFtZSgiVHlwZSIsICJFeHRHU3RhdGUiKTsKICAgIH0KICAgIGNvbnN0IGFwID0gbmV3IFN0cmluZ1N0cmVhbShhcHBlYXJhbmNlKTsKICAgIGFwLmRpY3QgPSBhcHBlYXJhbmNlU3RyZWFtRGljdDsKICAgIHJldHVybiBhcDsKICB9Cn0KY2xhc3MgVW5kZXJsaW5lQW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLlVOREVSTElORTsKICAgIGNvbnN0IHF1YWRQb2ludHMgPSB0aGlzLmRhdGEucXVhZFBvaW50cyA9IGdldFF1YWRQb2ludHMoZGljdCwgbnVsbCk7CiAgICBpZiAocXVhZFBvaW50cykgewogICAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSkgewogICAgICAgIGNvbnN0IHN0cm9rZUNvbG9yID0gZ2V0UGRmQ29sb3JBcnJheSh0aGlzLmNvbG9yLCBbMCwgMCwgMF0pOwogICAgICAgIGNvbnN0IHN0cm9rZUFscGhhID0gZGljdC5nZXQoIkNBIik7CiAgICAgICAgdGhpcy5fc2V0RGVmYXVsdEFwcGVhcmFuY2UoewogICAgICAgICAgeHJlZiwKICAgICAgICAgIGV4dHJhOiAiW10gMCBkIDAuNTcxIHciLAogICAgICAgICAgc3Ryb2tlQ29sb3IsCiAgICAgICAgICBzdHJva2VBbHBoYSwKICAgICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgICAgYnVmZmVyLnB1c2goYCR7cG9pbnRzWzRdfSAke3BvaW50c1s1XSArIDEuM30gbWAsIGAke3BvaW50c1s2XX0gJHtwb2ludHNbN10gKyAxLjN9IGxgLCAiUyIpOwogICAgICAgICAgICByZXR1cm4gW3BvaW50c1swXSwgcG9pbnRzWzddLCBwb2ludHNbMl0sIHBvaW50c1szXV07CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGF0YS5wb3B1cFJlZiA9IG51bGw7CiAgICB9CiAgfQogIGdldCBvdmVybGF5c1RleHRDb250ZW50KCkgewogICAgcmV0dXJuIHRydWU7CiAgfQp9CmNsYXNzIFNxdWlnZ2x5QW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLlNRVUlHR0xZOwogICAgY29uc3QgcXVhZFBvaW50cyA9IHRoaXMuZGF0YS5xdWFkUG9pbnRzID0gZ2V0UXVhZFBvaW50cyhkaWN0LCBudWxsKTsKICAgIGlmIChxdWFkUG9pbnRzKSB7CiAgICAgIGlmICghdGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgICAgY29uc3Qgc3Ryb2tlQ29sb3IgPSBnZXRQZGZDb2xvckFycmF5KHRoaXMuY29sb3IsIFswLCAwLCAwXSk7CiAgICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBkaWN0LmdldCgiQ0EiKTsKICAgICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgICB4cmVmLAogICAgICAgICAgZXh0cmE6ICJbXSAwIGQgMSB3IiwKICAgICAgICAgIHN0cm9rZUNvbG9yLAogICAgICAgICAgc3Ryb2tlQWxwaGEsCiAgICAgICAgICBwb2ludHNDYWxsYmFjazogKGJ1ZmZlciwgcG9pbnRzKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGR5ID0gKHBvaW50c1sxXSAtIHBvaW50c1s1XSkgLyA2OwogICAgICAgICAgICBsZXQgc2hpZnQgPSBkeTsKICAgICAgICAgICAgbGV0IHggPSBwb2ludHNbNF07CiAgICAgICAgICAgIGNvbnN0IHkgPSBwb2ludHNbNV07CiAgICAgICAgICAgIGNvbnN0IHhFbmQgPSBwb2ludHNbNl07CiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKGAke3h9ICR7eSArIHNoaWZ0fSBtYCk7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICB4ICs9IDI7CiAgICAgICAgICAgICAgc2hpZnQgPSBzaGlmdCA9PT0gMCA/IGR5IDogMDsKICAgICAgICAgICAgICBidWZmZXIucHVzaChgJHt4fSAke3kgKyBzaGlmdH0gbGApOwogICAgICAgICAgICB9IHdoaWxlICh4IDwgeEVuZCk7CiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCJTIik7CiAgICAgICAgICAgIHJldHVybiBbcG9pbnRzWzRdLCB5IC0gMiAqIGR5LCB4RW5kLCB5ICsgMiAqIGR5XTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kYXRhLnBvcHVwUmVmID0gbnVsbDsKICAgIH0KICB9CiAgZ2V0IG92ZXJsYXlzVGV4dENvbnRlbnQoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KY2xhc3MgU3RyaWtlT3V0QW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLlNUUklLRU9VVDsKICAgIGNvbnN0IHF1YWRQb2ludHMgPSB0aGlzLmRhdGEucXVhZFBvaW50cyA9IGdldFF1YWRQb2ludHMoZGljdCwgbnVsbCk7CiAgICBpZiAocXVhZFBvaW50cykgewogICAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSkgewogICAgICAgIGNvbnN0IHN0cm9rZUNvbG9yID0gZ2V0UGRmQ29sb3JBcnJheSh0aGlzLmNvbG9yLCBbMCwgMCwgMF0pOwogICAgICAgIGNvbnN0IHN0cm9rZUFscGhhID0gZGljdC5nZXQoIkNBIik7CiAgICAgICAgdGhpcy5fc2V0RGVmYXVsdEFwcGVhcmFuY2UoewogICAgICAgICAgeHJlZiwKICAgICAgICAgIGV4dHJhOiAiW10gMCBkIDEgdyIsCiAgICAgICAgICBzdHJva2VDb2xvciwKICAgICAgICAgIHN0cm9rZUFscGhhLAogICAgICAgICAgcG9pbnRzQ2FsbGJhY2s6IChidWZmZXIsIHBvaW50cykgPT4gewogICAgICAgICAgICBidWZmZXIucHVzaChgJHsocG9pbnRzWzBdICsgcG9pbnRzWzRdKSAvIDJ9IGAgKyBgJHsocG9pbnRzWzFdICsgcG9pbnRzWzVdKSAvIDJ9IG1gLCBgJHsocG9pbnRzWzJdICsgcG9pbnRzWzZdKSAvIDJ9IGAgKyBgJHsocG9pbnRzWzNdICsgcG9pbnRzWzddKSAvIDJ9IGxgLCAiUyIpOwogICAgICAgICAgICByZXR1cm4gW3BvaW50c1swXSwgcG9pbnRzWzddLCBwb2ludHNbMl0sIHBvaW50c1szXV07CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGF0YS5wb3B1cFJlZiA9IG51bGw7CiAgICB9CiAgfQogIGdldCBvdmVybGF5c1RleHRDb250ZW50KCkgewogICAgcmV0dXJuIHRydWU7CiAgfQp9CmNsYXNzIFN0YW1wQW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogICNzYXZlZEhhc093bkNhbnZhcyA9IG51bGw7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gQW5ub3RhdGlvblR5cGUuU1RBTVA7CiAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdGhpcy5kYXRhLm5vUm90YXRlOwogICAgdGhpcy5kYXRhLmlzRWRpdGFibGUgPSAhdGhpcy5kYXRhLm5vSFRNTDsKICAgIHRoaXMuZGF0YS5ub0hUTUwgPSBmYWxzZTsKICB9CiAgbXVzdEJlVmlld2VkV2hlbkVkaXRpbmcoaXNFZGl0aW5nLCBtb2RpZmllZElkcyA9IG51bGwpIHsKICAgIGlmIChpc0VkaXRpbmcpIHsKICAgICAgaWYgKCF0aGlzLmRhdGEuaXNFZGl0YWJsZSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHRoaXMuI3NhdmVkSGFzT3duQ2FudmFzID8/PSB0aGlzLmRhdGEuaGFzT3duQ2FudmFzOwogICAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdHJ1ZTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAodGhpcy4jc2F2ZWRIYXNPd25DYW52YXMgIT09IG51bGwpIHsKICAgICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IHRoaXMuI3NhdmVkSGFzT3duQ2FudmFzOwogICAgICB0aGlzLiNzYXZlZEhhc093bkNhbnZhcyA9IG51bGw7CiAgICB9CiAgICByZXR1cm4gIW1vZGlmaWVkSWRzPy5oYXModGhpcy5kYXRhLmlkKTsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZUltYWdlKGJpdG1hcCwgeHJlZikgewogICAgY29uc3QgewogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0CiAgICB9ID0gYml0bWFwOwogICAgY29uc3QgY2FudmFzID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsKICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIsIHsKICAgICAgYWxwaGE6IHRydWUKICAgIH0pOwogICAgY3R4LmRyYXdJbWFnZShiaXRtYXAsIDAsIDApOwogICAgY29uc3QgZGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgd2lkdGgsIGhlaWdodCkuZGF0YTsKICAgIGNvbnN0IGJ1ZjMyID0gbmV3IFVpbnQzMkFycmF5KGRhdGEuYnVmZmVyKTsKICAgIGNvbnN0IGhhc0FscGhhID0gYnVmMzIuc29tZShGZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbiA/IHggPT4geCA+Pj4gMjQgIT09IDB4ZmYgOiB4ID0+ICh4ICYgMHhmZikgIT09IDB4ZmYpOwogICAgaWYgKGhhc0FscGhhKSB7CiAgICAgIGN0eC5maWxsU3R5bGUgPSAid2hpdGUiOwogICAgICBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwKTsKICAgIH0KICAgIGNvbnN0IGpwZWdCdWZmZXJQcm9taXNlID0gY2FudmFzLmNvbnZlcnRUb0Jsb2IoewogICAgICB0eXBlOiAiaW1hZ2UvanBlZyIsCiAgICAgIHF1YWxpdHk6IDEKICAgIH0pLnRoZW4oYmxvYiA9PiBibG9iLmFycmF5QnVmZmVyKCkpOwogICAgY29uc3QgeG9iamVjdE5hbWUgPSBOYW1lLmdldCgiWE9iamVjdCIpOwogICAgY29uc3QgaW1hZ2VOYW1lID0gTmFtZS5nZXQoIkltYWdlIik7CiAgICBjb25zdCBpbWFnZSA9IG5ldyBEaWN0KHhyZWYpOwogICAgaW1hZ2Uuc2V0KCJUeXBlIiwgeG9iamVjdE5hbWUpOwogICAgaW1hZ2Uuc2V0KCJTdWJ0eXBlIiwgaW1hZ2VOYW1lKTsKICAgIGltYWdlLnNldCgiQml0c1BlckNvbXBvbmVudCIsIDgpOwogICAgaW1hZ2Uuc2V0SWZOYW1lKCJDb2xvclNwYWNlIiwgIkRldmljZVJHQiIpOwogICAgaW1hZ2Uuc2V0SWZOYW1lKCJGaWx0ZXIiLCAiRENURGVjb2RlIik7CiAgICBpbWFnZS5zZXQoIkJCb3giLCBbMCwgMCwgd2lkdGgsIGhlaWdodF0pOwogICAgaW1hZ2Uuc2V0KCJXaWR0aCIsIHdpZHRoKTsKICAgIGltYWdlLnNldCgiSGVpZ2h0IiwgaGVpZ2h0KTsKICAgIGxldCBzbWFza1N0cmVhbSA9IG51bGw7CiAgICBpZiAoaGFzQWxwaGEpIHsKICAgICAgY29uc3QgYWxwaGFCdWZmZXIgPSBuZXcgVWludDhBcnJheShidWYzMi5sZW5ndGgpOwogICAgICBpZiAoRmVhdHVyZVRlc3QuaXNMaXR0bGVFbmRpYW4pIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBidWYzMi5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICBhbHBoYUJ1ZmZlcltpXSA9IGJ1ZjMyW2ldID4+PiAyNDsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gYnVmMzIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgYWxwaGFCdWZmZXJbaV0gPSBidWYzMltpXSAmIDB4ZmY7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHNtYXNrID0gbmV3IERpY3QoeHJlZik7CiAgICAgIHNtYXNrLnNldCgiVHlwZSIsIHhvYmplY3ROYW1lKTsKICAgICAgc21hc2suc2V0KCJTdWJ0eXBlIiwgaW1hZ2VOYW1lKTsKICAgICAgc21hc2suc2V0KCJCaXRzUGVyQ29tcG9uZW50IiwgOCk7CiAgICAgIHNtYXNrLnNldElmTmFtZSgiQ29sb3JTcGFjZSIsICJEZXZpY2VHcmF5Iik7CiAgICAgIHNtYXNrLnNldCgiV2lkdGgiLCB3aWR0aCk7CiAgICAgIHNtYXNrLnNldCgiSGVpZ2h0IiwgaGVpZ2h0KTsKICAgICAgc21hc2tTdHJlYW0gPSBuZXcgU3RyZWFtKGFscGhhQnVmZmVyLCAwLCAwLCBzbWFzayk7CiAgICB9CiAgICBjb25zdCBpbWFnZVN0cmVhbSA9IG5ldyBTdHJlYW0oYXdhaXQganBlZ0J1ZmZlclByb21pc2UsIDAsIDAsIGltYWdlKTsKICAgIHJldHVybiB7CiAgICAgIGltYWdlU3RyZWFtLAogICAgICBzbWFza1N0cmVhbSwKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodAogICAgfTsKICB9CiAgc3RhdGljIGNyZWF0ZU5ld0RpY3QoYW5ub3RhdGlvbiwgeHJlZiwgewogICAgYXBSZWYsCiAgICBhcAogIH0pIHsKICAgIGNvbnN0IHsKICAgICAgZGF0ZSwKICAgICAgb2xkQW5ub3RhdGlvbiwKICAgICAgcmVjdCwKICAgICAgcm90YXRpb24sCiAgICAgIHVzZXIKICAgIH0gPSBhbm5vdGF0aW9uOwogICAgY29uc3Qgc3RhbXAgPSBvbGRBbm5vdGF0aW9uIHx8IG5ldyBEaWN0KHhyZWYpOwogICAgc3RhbXAuc2V0SWZOb3RFeGlzdHMoIlR5cGUiLCBOYW1lLmdldCgiQW5ub3QiKSk7CiAgICBzdGFtcC5zZXRJZk5vdEV4aXN0cygiU3VidHlwZSIsIE5hbWUuZ2V0KCJTdGFtcCIpKTsKICAgIHN0YW1wLnNldChvbGRBbm5vdGF0aW9uID8gIk0iIDogIkNyZWF0aW9uRGF0ZSIsIGBEOiR7Z2V0TW9kaWZpY2F0aW9uRGF0ZShkYXRlKX1gKTsKICAgIHN0YW1wLnNldElmQXJyYXkoIlJlY3QiLCByZWN0KTsKICAgIHN0YW1wLnNldElmTm90RXhpc3RzKCJGIiwgNCk7CiAgICBzdGFtcC5zZXRJZk5vdEV4aXN0cygiQm9yZGVyIiwgWzAsIDAsIDBdKTsKICAgIHN0YW1wLnNldElmTnVtYmVyKCJSb3RhdGUiLCByb3RhdGlvbik7CiAgICBzdGFtcC5zZXRJZkRlZmluZWQoIlQiLCBzdHJpbmdUb0FzY2lpT3JVVEYxNkJFKHVzZXIpKTsKICAgIGlmIChhcFJlZiB8fCBhcCkgewogICAgICBjb25zdCBuID0gbmV3IERpY3QoeHJlZik7CiAgICAgIHN0YW1wLnNldCgiQVAiLCBuKTsKICAgICAgbi5zZXQoIk4iLCBhcFJlZiB8fCBhcCk7CiAgICB9CiAgICByZXR1cm4gc3RhbXA7CiAgfQogIHN0YXRpYyBhc3luYyAjY3JlYXRlTmV3QXBwZWFyYW5jZVN0cmVhbUZvckRyYXdpbmcoYW5ub3RhdGlvbiwgeHJlZikgewogICAgY29uc3QgewogICAgICBhcmVDb250b3VycywKICAgICAgY29sb3IsCiAgICAgIHJlY3QsCiAgICAgIGxpbmVzLAogICAgICB0aGlja25lc3MKICAgIH0gPSBhbm5vdGF0aW9uOwogICAgaWYgKCFjb2xvcikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IGFwcGVhcmFuY2VCdWZmZXIgPSBbYCR7dGhpY2tuZXNzfSB3IDEgSiAxIGpgLCBgJHtnZXRQZGZDb2xvcihjb2xvciwgYXJlQ29udG91cnMpfWBdOwogICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7CiAgICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaChgJHtudW1iZXJUb1N0cmluZyhsaW5lWzRdKX0gJHtudW1iZXJUb1N0cmluZyhsaW5lWzVdKX0gbWApOwogICAgICBmb3IgKGxldCBpID0gNiwgaWkgPSBsaW5lLmxlbmd0aDsgaSA8IGlpOyBpICs9IDYpIHsKICAgICAgICBpZiAoaXNOYU4obGluZVtpXSkpIHsKICAgICAgICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaChgJHtudW1iZXJUb1N0cmluZyhsaW5lW2kgKyA0XSl9ICR7bnVtYmVyVG9TdHJpbmcobGluZVtpICsgNV0pfSBsYCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IFtjMXgsIGMxeSwgYzJ4LCBjMnksIHgsIHldID0gbGluZS5zbGljZShpLCBpICsgNik7CiAgICAgICAgICBhcHBlYXJhbmNlQnVmZmVyLnB1c2goW2MxeCwgYzF5LCBjMngsIGMyeSwgeCwgeV0ubWFwKG51bWJlclRvU3RyaW5nKS5qb2luKCIgIikgKyAiIGMiKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGxpbmUubGVuZ3RoID09PSA2KSB7CiAgICAgICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKGAke251bWJlclRvU3RyaW5nKGxpbmVbNF0pfSAke251bWJlclRvU3RyaW5nKGxpbmVbNV0pfSBsYCk7CiAgICAgIH0KICAgIH0KICAgIGFwcGVhcmFuY2VCdWZmZXIucHVzaChhcmVDb250b3VycyA/ICJGIiA6ICJTIik7CiAgICBjb25zdCBhcHBlYXJhbmNlID0gYXBwZWFyYW5jZUJ1ZmZlci5qb2luKCJcbiIpOwogICAgY29uc3QgYXBwZWFyYW5jZVN0cmVhbURpY3QgPSBuZXcgRGljdCh4cmVmKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiRm9ybVR5cGUiLCAxKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiU3VidHlwZSIsICJGb3JtIik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiWE9iamVjdCIpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJCQm94IiwgcmVjdCk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkxlbmd0aCIsIGFwcGVhcmFuY2UubGVuZ3RoKTsKICAgIGNvbnN0IGFwID0gbmV3IFN0cmluZ1N0cmVhbShhcHBlYXJhbmNlKTsKICAgIGFwLmRpY3QgPSBhcHBlYXJhbmNlU3RyZWFtRGljdDsKICAgIHJldHVybiBhcDsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZU5ld0FwcGVhcmFuY2VTdHJlYW0oYW5ub3RhdGlvbiwgeHJlZiwgcGFyYW1zKSB7CiAgICBpZiAoYW5ub3RhdGlvbi5vbGRBbm5vdGF0aW9uKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKGFubm90YXRpb24uaXNTaWduYXR1cmUpIHsKICAgICAgcmV0dXJuIHRoaXMuI2NyZWF0ZU5ld0FwcGVhcmFuY2VTdHJlYW1Gb3JEcmF3aW5nKGFubm90YXRpb24sIHhyZWYpOwogICAgfQogICAgY29uc3QgewogICAgICByb3RhdGlvbgogICAgfSA9IGFubm90YXRpb247CiAgICBjb25zdCB7CiAgICAgIGltYWdlUmVmLAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0CiAgICB9ID0gcGFyYW1zLmltYWdlOwogICAgY29uc3QgcmVzb3VyY2VzID0gbmV3IERpY3QoeHJlZik7CiAgICBjb25zdCB4b2JqZWN0ID0gbmV3IERpY3QoeHJlZik7CiAgICByZXNvdXJjZXMuc2V0KCJYT2JqZWN0IiwgeG9iamVjdCk7CiAgICB4b2JqZWN0LnNldCgiSW0wIiwgaW1hZ2VSZWYpOwogICAgY29uc3QgYXBwZWFyYW5jZSA9IGBxICR7d2lkdGh9IDAgMCAke2hlaWdodH0gMCAwIGNtIC9JbTAgRG8gUWA7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJGb3JtVHlwZSIsIDEpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0SWZOYW1lKCJTdWJ0eXBlIiwgIkZvcm0iKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldElmTmFtZSgiVHlwZSIsICJYT2JqZWN0Iik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkJCb3giLCBbMCwgMCwgd2lkdGgsIGhlaWdodF0pOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJSZXNvdXJjZXMiLCByZXNvdXJjZXMpOwogICAgaWYgKHJvdGF0aW9uKSB7CiAgICAgIGNvbnN0IG1hdHJpeCA9IGdldFJvdGF0aW9uTWF0cml4KHJvdGF0aW9uLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJNYXRyaXgiLCBtYXRyaXgpOwogICAgfQogICAgY29uc3QgYXAgPSBuZXcgU3RyaW5nU3RyZWFtKGFwcGVhcmFuY2UpOwogICAgYXAuZGljdCA9IGFwcGVhcmFuY2VTdHJlYW1EaWN0OwogICAgcmV0dXJuIGFwOwogIH0KfQpjbGFzcyBGaWxlQXR0YWNobWVudEFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICBjb25zdCBmaWxlID0gbmV3IEZpbGVTcGVjKGRpY3QuZ2V0KCJGUyIpLCB4cmVmKTsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IEFubm90YXRpb25UeXBlLkZJTEVBVFRBQ0hNRU5UOwogICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IHRoaXMuZGF0YS5ub1JvdGF0ZTsKICAgIHRoaXMuZGF0YS5ub0hUTUwgPSBmYWxzZTsKICAgIHRoaXMuZGF0YS5maWxlID0gZmlsZS5zZXJpYWxpemFibGU7CiAgICBjb25zdCBuYW1lID0gZGljdC5nZXQoIk5hbWUiKTsKICAgIHRoaXMuZGF0YS5uYW1lID0gbmFtZSBpbnN0YW5jZW9mIE5hbWUgPyBzdHJpbmdUb1BERlN0cmluZyhuYW1lLm5hbWUpIDogIlB1c2hQaW4iOwogICAgY29uc3QgZmlsbEFscGhhID0gZGljdC5nZXQoImNhIik7CiAgICB0aGlzLmRhdGEuZmlsbEFscGhhID0gdHlwZW9mIGZpbGxBbHBoYSA9PT0gIm51bWJlciIgJiYgZmlsbEFscGhhID49IDAgJiYgZmlsbEFscGhhIDw9IDEgPyBmaWxsQWxwaGEgOiBudWxsOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvY2FsY3VsYXRlX21kNS5qcwoKY29uc3QgUEFSQU1TID0gewogIGdldCByKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiciIsIG5ldyBVaW50OEFycmF5KFs3LCAxMiwgMTcsIDIyLCA3LCAxMiwgMTcsIDIyLCA3LCAxMiwgMTcsIDIyLCA3LCAxMiwgMTcsIDIyLCA1LCA5LCAxNCwgMjAsIDUsIDksIDE0LCAyMCwgNSwgOSwgMTQsIDIwLCA1LCA5LCAxNCwgMjAsIDQsIDExLCAxNiwgMjMsIDQsIDExLCAxNiwgMjMsIDQsIDExLCAxNiwgMjMsIDQsIDExLCAxNiwgMjMsIDYsIDEwLCAxNSwgMjEsIDYsIDEwLCAxNSwgMjEsIDYsIDEwLCAxNSwgMjEsIDYsIDEwLCAxNSwgMjFdKSk7CiAgfSwKICBnZXQgaygpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImsiLCBuZXcgSW50MzJBcnJheShbLTY4MDg3NjkzNiwgLTM4OTU2NDU4NiwgNjA2MTA1ODE5LCAtMTA0NDUyNTMzMCwgLTE3NjQxODg5NywgMTIwMDA4MDQyNiwgLTE0NzMyMzEzNDEsIC00NTcwNTk4MywgMTc3MDAzNTQxNiwgLTE5NTg0MTQ0MTcsIC00MjA2MywgLTE5OTA0MDQxNjIsIDE4MDQ2MDM2ODIsIC00MDM0MTEwMSwgLTE1MDIwMDIyOTAsIDEyMzY1MzUzMjksIC0xNjU3OTY1MTAsIC0xMDY5NTAxNjMyLCA2NDM3MTc3MTMsIC0zNzM4OTczMDIsIC03MDE1NTg2OTEsIDM4MDE2MDgzLCAtNjYwNDc4MzM1LCAtNDA1NTM3ODQ4LCA1Njg0NDY0MzgsIC0xMDE5ODAzNjkwLCAtMTg3MzYzOTYxLCAxMTYzNTMxNTAxLCAtMTQ0NDY4MTQ2NywgLTUxNDAzNzg0LCAxNzM1MzI4NDczLCAtMTkyNjYwNzczNCwgLTM3ODU1OCwgLTIwMjI1NzQ0NjMsIDE4MzkwMzA1NjIsIC0zNTMwOTU1NiwgLTE1MzA5OTIwNjAsIDEyNzI4OTMzNTMsIC0xNTU0OTc2MzIsIC0xMDk0NzMwNjQwLCA2ODEyNzkxNzQsIC0zNTg1MzcyMjIsIC03MjI1MjE5NzksIDc2MDI5MTg5LCAtNjQwMzY0NDg3LCAtNDIxODE1ODM1LCA1MzA3NDI1MjAsIC05OTUzMzg2NTEsIC0xOTg2MzA4NDQsIDExMjY4OTE0MTUsIC0xNDE2MzU0OTA1LCAtNTc0MzQwNTUsIDE3MDA0ODU1NzEsIC0xODk0OTg2NjA2LCAtMTA1MTUyMywgLTIwNTQ5MjI3OTksIDE4NzMzMTMzNTksIC0zMDYxMTc0NCwgLTE1NjAxOTgzODAsIDEzMDkxNTE2NDksIC0xNDU1MjMwNzAsIC0xMTIwMjEwMzc5LCA3MTg3ODcyNTksIC0zNDM0ODU1NTFdKSk7CiAgfQp9OwpmdW5jdGlvbiBjYWxjdWxhdGVNRDUoZGF0YSwgb2Zmc2V0LCBsZW5ndGgpIHsKICBsZXQgaDAgPSAxNzMyNTg0MTkzLAogICAgaDEgPSAtMjcxNzMzODc5LAogICAgaDIgPSAtMTczMjU4NDE5NCwKICAgIGgzID0gMjcxNzMzODc4OwogIGNvbnN0IHBhZGRlZExlbmd0aCA9IGxlbmd0aCArIDcyICYgfjYzOwogIGNvbnN0IHBhZGRlZCA9IG5ldyBVaW50OEFycmF5KHBhZGRlZExlbmd0aCk7CiAgbGV0IGksIGo7CiAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICBwYWRkZWRbaV0gPSBkYXRhW29mZnNldCsrXTsKICB9CiAgcGFkZGVkW2krK10gPSAweDgwOwogIGNvbnN0IG4gPSBwYWRkZWRMZW5ndGggLSA4OwogIGlmIChpIDwgbikgewogICAgaSA9IG47CiAgfQogIHBhZGRlZFtpKytdID0gbGVuZ3RoIDw8IDMgJiAweGZmOwogIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDUgJiAweGZmOwogIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDEzICYgMHhmZjsKICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+PiAyMSAmIDB4ZmY7CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4+IDI5ICYgMHhmZjsKICBpICs9IDM7CiAgY29uc3QgdyA9IG5ldyBJbnQzMkFycmF5KDE2KTsKICBjb25zdCB7CiAgICBrLAogICAgcgogIH0gPSBQQVJBTVM7CiAgZm9yIChpID0gMDsgaSA8IHBhZGRlZExlbmd0aDspIHsKICAgIGZvciAoaiA9IDA7IGogPCAxNjsgKytqLCBpICs9IDQpIHsKICAgICAgd1tqXSA9IHBhZGRlZFtpXSB8IHBhZGRlZFtpICsgMV0gPDwgOCB8IHBhZGRlZFtpICsgMl0gPDwgMTYgfCBwYWRkZWRbaSArIDNdIDw8IDI0OwogICAgfQogICAgbGV0IGEgPSBoMCwKICAgICAgYiA9IGgxLAogICAgICBjID0gaDIsCiAgICAgIGQgPSBoMywKICAgICAgZiwKICAgICAgZzsKICAgIGZvciAoaiA9IDA7IGogPCA2NDsgKytqKSB7CiAgICAgIGlmIChqIDwgMTYpIHsKICAgICAgICBmID0gYiAmIGMgfCB+YiAmIGQ7CiAgICAgICAgZyA9IGo7CiAgICAgIH0gZWxzZSBpZiAoaiA8IDMyKSB7CiAgICAgICAgZiA9IGQgJiBiIHwgfmQgJiBjOwogICAgICAgIGcgPSA1ICogaiArIDEgJiAxNTsKICAgICAgfSBlbHNlIGlmIChqIDwgNDgpIHsKICAgICAgICBmID0gYiBeIGMgXiBkOwogICAgICAgIGcgPSAzICogaiArIDUgJiAxNTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmID0gYyBeIChiIHwgfmQpOwogICAgICAgIGcgPSA3ICogaiAmIDE1OwogICAgICB9CiAgICAgIGNvbnN0IHRtcCA9IGQsCiAgICAgICAgcm90YXRlQXJnID0gYSArIGYgKyBrW2pdICsgd1tnXSB8IDAsCiAgICAgICAgcm90YXRlID0gcltqXTsKICAgICAgZCA9IGM7CiAgICAgIGMgPSBiOwogICAgICBiID0gYiArIChyb3RhdGVBcmcgPDwgcm90YXRlIHwgcm90YXRlQXJnID4+PiAzMiAtIHJvdGF0ZSkgfCAwOwogICAgICBhID0gdG1wOwogICAgfQogICAgaDAgPSBoMCArIGEgfCAwOwogICAgaDEgPSBoMSArIGIgfCAwOwogICAgaDIgPSBoMiArIGMgfCAwOwogICAgaDMgPSBoMyArIGQgfCAwOwogIH0KICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoW2gwICYgMHhGRiwgaDAgPj4gOCAmIDB4RkYsIGgwID4+IDE2ICYgMHhGRiwgaDAgPj4+IDI0ICYgMHhGRiwgaDEgJiAweEZGLCBoMSA+PiA4ICYgMHhGRiwgaDEgPj4gMTYgJiAweEZGLCBoMSA+Pj4gMjQgJiAweEZGLCBoMiAmIDB4RkYsIGgyID4+IDggJiAweEZGLCBoMiA+PiAxNiAmIDB4RkYsIGgyID4+PiAyNCAmIDB4RkYsIGgzICYgMHhGRiwgaDMgPj4gOCAmIDB4RkYsIGgzID4+IDE2ICYgMHhGRiwgaDMgPj4+IDI0ICYgMHhGRl0pOwp9Cgo7Ly8gLi9zcmMvY29yZS9kYXRhc2V0X3JlYWRlci5qcwoKCgpmdW5jdGlvbiBkZWNvZGVTdHJpbmcoc3RyKSB7CiAgdHJ5IHsKICAgIHJldHVybiBzdHJpbmdUb1VURjhTdHJpbmcoc3RyKTsKICB9IGNhdGNoIChleCkgewogICAgd2FybihgVVRGLTggZGVjb2RpbmcgZmFpbGVkOiAiJHtleH0iLmApOwogICAgcmV0dXJuIHN0cjsKICB9Cn0KY2xhc3MgRGF0YXNldFhNTFBhcnNlciBleHRlbmRzIFNpbXBsZVhNTFBhcnNlciB7CiAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgc3VwZXIob3B0aW9ucyk7CiAgICB0aGlzLm5vZGUgPSBudWxsOwogIH0KICBvbkVuZEVsZW1lbnQobmFtZSkgewogICAgY29uc3Qgbm9kZSA9IHN1cGVyLm9uRW5kRWxlbWVudChuYW1lKTsKICAgIGlmIChub2RlICYmIG5hbWUgPT09ICJ4ZmE6ZGF0YXNldHMiKSB7CiAgICAgIHRoaXMubm9kZSA9IG5vZGU7CiAgICAgIHRocm93IG5ldyBFcnJvcigiQWJvcnRpbmcgRGF0YXNldFhNTFBhcnNlci4iKTsKICAgIH0KICB9Cn0KY2xhc3MgRGF0YXNldFJlYWRlciB7CiAgY29uc3RydWN0b3IoZGF0YSkgewogICAgaWYgKGRhdGEuZGF0YXNldHMpIHsKICAgICAgdGhpcy5ub2RlID0gbmV3IFNpbXBsZVhNTFBhcnNlcih7CiAgICAgICAgaGFzQXR0cmlidXRlczogdHJ1ZQogICAgICB9KS5wYXJzZUZyb21TdHJpbmcoZGF0YS5kYXRhc2V0cykuZG9jdW1lbnRFbGVtZW50OwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgcGFyc2VyID0gbmV3IERhdGFzZXRYTUxQYXJzZXIoewogICAgICAgIGhhc0F0dHJpYnV0ZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRyeSB7CiAgICAgICAgcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhkYXRhWyJ4ZHA6eGRwIl0pOwogICAgICB9IGNhdGNoIHt9CiAgICAgIHRoaXMubm9kZSA9IHBhcnNlci5ub2RlOwogICAgfQogIH0KICBnZXRWYWx1ZShwYXRoKSB7CiAgICBpZiAoIXRoaXMubm9kZSB8fCAhcGF0aCkgewogICAgICByZXR1cm4gIiI7CiAgICB9CiAgICBjb25zdCBub2RlID0gdGhpcy5ub2RlLnNlYXJjaE5vZGUocGFyc2VYRkFQYXRoKHBhdGgpLCAwKTsKICAgIGlmICghbm9kZSkgewogICAgICByZXR1cm4gIiI7CiAgICB9CiAgICBjb25zdCBmaXJzdCA9IG5vZGUuZmlyc3RDaGlsZDsKICAgIGlmIChmaXJzdD8ubm9kZU5hbWUgPT09ICJ2YWx1ZSIpIHsKICAgICAgcmV0dXJuIG5vZGUuY2hpbGRyZW4ubWFwKGNoaWxkID0+IGRlY29kZVN0cmluZyhjaGlsZC50ZXh0Q29udGVudCkpOwogICAgfQogICAgcmV0dXJuIGRlY29kZVN0cmluZyhub2RlLnRleHRDb250ZW50KTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2ludGVyc2VjdG9yLmpzCmNsYXNzIFNpbmdsZUludGVyc2VjdG9yIHsKICAjYW5ub3RhdGlvbjsKICAjbWluWCA9IEluZmluaXR5OwogICNtaW5ZID0gSW5maW5pdHk7CiAgI21heFggPSAtSW5maW5pdHk7CiAgI21heFkgPSAtSW5maW5pdHk7CiAgI3F1YWRQb2ludHMgPSBudWxsOwogICN0ZXh0ID0gW107CiAgI2V4dHJhQ2hhcnMgPSBbXTsKICAjbGFzdEludGVyc2VjdGluZ1F1YWRJbmRleCA9IC0xOwogICNjYW5UYWtlRXh0cmFDaGFycyA9IGZhbHNlOwogIGNvbnN0cnVjdG9yKGFubm90YXRpb24pIHsKICAgIHRoaXMuI2Fubm90YXRpb24gPSBhbm5vdGF0aW9uOwogICAgY29uc3QgcXVhZFBvaW50cyA9IGFubm90YXRpb24uZGF0YS5xdWFkUG9pbnRzOwogICAgaWYgKCFxdWFkUG9pbnRzKSB7CiAgICAgIFt0aGlzLiNtaW5YLCB0aGlzLiNtaW5ZLCB0aGlzLiNtYXhYLCB0aGlzLiNtYXhZXSA9IGFubm90YXRpb24uZGF0YS5yZWN0OwogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBxdWFkUG9pbnRzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDgpIHsKICAgICAgdGhpcy4jbWluWCA9IE1hdGgubWluKHRoaXMuI21pblgsIHF1YWRQb2ludHNbaV0pOwogICAgICB0aGlzLiNtYXhYID0gTWF0aC5tYXgodGhpcy4jbWF4WCwgcXVhZFBvaW50c1tpICsgMl0pOwogICAgICB0aGlzLiNtaW5ZID0gTWF0aC5taW4odGhpcy4jbWluWSwgcXVhZFBvaW50c1tpICsgNV0pOwogICAgICB0aGlzLiNtYXhZID0gTWF0aC5tYXgodGhpcy4jbWF4WSwgcXVhZFBvaW50c1tpICsgMV0pOwogICAgfQogICAgaWYgKHF1YWRQb2ludHMubGVuZ3RoID4gOCkgewogICAgICB0aGlzLiNxdWFkUG9pbnRzID0gcXVhZFBvaW50czsKICAgIH0KICB9CiAgb3ZlcmxhcHMob3RoZXIpIHsKICAgIHJldHVybiAhKHRoaXMuI21pblggPj0gb3RoZXIuI21heFggfHwgdGhpcy4jbWF4WCA8PSBvdGhlci4jbWluWCB8fCB0aGlzLiNtaW5ZID49IG90aGVyLiNtYXhZIHx8IHRoaXMuI21heFkgPD0gb3RoZXIuI21pblkpOwogIH0KICAjaW50ZXJzZWN0cyh4LCB5KSB7CiAgICBpZiAodGhpcy4jbWluWCA+PSB4IHx8IHRoaXMuI21heFggPD0geCB8fCB0aGlzLiNtaW5ZID49IHkgfHwgdGhpcy4jbWF4WSA8PSB5KSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGNvbnN0IHF1YWRQb2ludHMgPSB0aGlzLiNxdWFkUG9pbnRzOwogICAgaWYgKCFxdWFkUG9pbnRzKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKHRoaXMuI2xhc3RJbnRlcnNlY3RpbmdRdWFkSW5kZXggPj0gMCkgewogICAgICBjb25zdCBpID0gdGhpcy4jbGFzdEludGVyc2VjdGluZ1F1YWRJbmRleDsKICAgICAgaWYgKCEocXVhZFBvaW50c1tpXSA+PSB4IHx8IHF1YWRQb2ludHNbaSArIDJdIDw9IHggfHwgcXVhZFBvaW50c1tpICsgNV0gPj0geSB8fCBxdWFkUG9pbnRzW2kgKyAxXSA8PSB5KSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHRoaXMuI2xhc3RJbnRlcnNlY3RpbmdRdWFkSW5kZXggPSAtMTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHF1YWRQb2ludHMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gOCkgewogICAgICBpZiAoIShxdWFkUG9pbnRzW2ldID49IHggfHwgcXVhZFBvaW50c1tpICsgMl0gPD0geCB8fCBxdWFkUG9pbnRzW2kgKyA1XSA+PSB5IHx8IHF1YWRQb2ludHNbaSArIDFdIDw9IHkpKSB7CiAgICAgICAgdGhpcy4jbGFzdEludGVyc2VjdGluZ1F1YWRJbmRleCA9IGk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgYWRkR2x5cGgoeCwgeSwgZ2x5cGgpIHsKICAgIGlmICghdGhpcy4jaW50ZXJzZWN0cyh4LCB5KSkgewogICAgICB0aGlzLmRpc2FibGVFeHRyYUNoYXJzKCk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzLiNleHRyYUNoYXJzLmxlbmd0aCA+IDApIHsKICAgICAgdGhpcy4jdGV4dC5wdXNoKHRoaXMuI2V4dHJhQ2hhcnMuam9pbigiIikpOwogICAgICB0aGlzLiNleHRyYUNoYXJzLmxlbmd0aCA9IDA7CiAgICB9CiAgICB0aGlzLiN0ZXh0LnB1c2goZ2x5cGgpOwogICAgdGhpcy4jY2FuVGFrZUV4dHJhQ2hhcnMgPSB0cnVlOwogICAgcmV0dXJuIHRydWU7CiAgfQogIGFkZEV4dHJhQ2hhcihjaGFyKSB7CiAgICBpZiAodGhpcy4jY2FuVGFrZUV4dHJhQ2hhcnMpIHsKICAgICAgdGhpcy4jZXh0cmFDaGFycy5wdXNoKGNoYXIpOwogICAgfQogIH0KICBkaXNhYmxlRXh0cmFDaGFycygpIHsKICAgIGlmICghdGhpcy4jY2FuVGFrZUV4dHJhQ2hhcnMpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy4jY2FuVGFrZUV4dHJhQ2hhcnMgPSBmYWxzZTsKICAgIHRoaXMuI2V4dHJhQ2hhcnMubGVuZ3RoID0gMDsKICB9CiAgc2V0VGV4dCgpIHsKICAgIHRoaXMuI2Fubm90YXRpb24uZGF0YS5vdmVybGFpZFRleHQgPSB0aGlzLiN0ZXh0LmpvaW4oIiIpOwogIH0KfQpjbGFzcyBJbnRlcnNlY3RvciB7CiAgI2ludGVyc2VjdG9ycyA9IG5ldyBNYXAoKTsKICBjb25zdHJ1Y3Rvcihhbm5vdGF0aW9ucykgewogICAgZm9yIChjb25zdCBhbm5vdGF0aW9uIG9mIGFubm90YXRpb25zKSB7CiAgICAgIGlmICghYW5ub3RhdGlvbi5kYXRhLnF1YWRQb2ludHMgJiYgIWFubm90YXRpb24uZGF0YS5yZWN0KSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgaW50ZXJzZWN0b3IgPSBuZXcgU2luZ2xlSW50ZXJzZWN0b3IoYW5ub3RhdGlvbik7CiAgICAgIGZvciAoY29uc3QgW290aGVySW50ZXJzZWN0b3IsIG92ZXJsYXBwaW5nXSBvZiB0aGlzLiNpbnRlcnNlY3RvcnMpIHsKICAgICAgICBpZiAob3RoZXJJbnRlcnNlY3Rvci5vdmVybGFwcyhpbnRlcnNlY3RvcikpIHsKICAgICAgICAgIGlmICghb3ZlcmxhcHBpbmcpIHsKICAgICAgICAgICAgdGhpcy4jaW50ZXJzZWN0b3JzLnNldChvdGhlckludGVyc2VjdG9yLCBuZXcgU2V0KFtpbnRlcnNlY3Rvcl0pKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG92ZXJsYXBwaW5nLmFkZChpbnRlcnNlY3Rvcik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuI2ludGVyc2VjdG9ycy5zZXQoaW50ZXJzZWN0b3IsIG51bGwpOwogICAgfQogIH0KICBhZGRHbHlwaCh0cmFuc2Zvcm0sIHdpZHRoLCBoZWlnaHQsIGdseXBoKSB7CiAgICBjb25zdCB4ID0gdHJhbnNmb3JtWzRdICsgd2lkdGggLyAyOwogICAgY29uc3QgeSA9IHRyYW5zZm9ybVs1XSArIGhlaWdodCAvIDI7CiAgICBsZXQgb3ZlcmxhcHBpbmdJbnRlcnNlY3RvcnM7CiAgICBmb3IgKGNvbnN0IFtpbnRlcnNlY3Rvciwgb3ZlcmxhcHBpbmddIG9mIHRoaXMuI2ludGVyc2VjdG9ycykgewogICAgICBpZiAob3ZlcmxhcHBpbmdJbnRlcnNlY3RvcnMpIHsKICAgICAgICBpZiAob3ZlcmxhcHBpbmdJbnRlcnNlY3RvcnMuaGFzKGludGVyc2VjdG9yKSkgewogICAgICAgICAgaW50ZXJzZWN0b3IuYWRkR2x5cGgoeCwgeSwgZ2x5cGgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpbnRlcnNlY3Rvci5kaXNhYmxlRXh0cmFDaGFycygpOwogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIWludGVyc2VjdG9yLmFkZEdseXBoKHgsIHksIGdseXBoKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIG92ZXJsYXBwaW5nSW50ZXJzZWN0b3JzID0gb3ZlcmxhcHBpbmc7CiAgICB9CiAgfQogIGFkZEV4dHJhQ2hhcihjaGFyKSB7CiAgICBmb3IgKGNvbnN0IGludGVyc2VjdG9yIG9mIHRoaXMuI2ludGVyc2VjdG9ycy5rZXlzKCkpIHsKICAgICAgaW50ZXJzZWN0b3IuYWRkRXh0cmFDaGFyKGNoYXIpOwogICAgfQogIH0KICBzZXRUZXh0KCkgewogICAgZm9yIChjb25zdCBpbnRlcnNlY3RvciBvZiB0aGlzLiNpbnRlcnNlY3RvcnMua2V5cygpKSB7CiAgICAgIGludGVyc2VjdG9yLnNldFRleHQoKTsKICAgIH0KICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2NhbGN1bGF0ZV9zaGFfb3RoZXIuanMKCmNsYXNzIFdvcmQ2NCB7CiAgY29uc3RydWN0b3IoaGlnaEludGVnZXIsIGxvd0ludGVnZXIpIHsKICAgIHRoaXMuaGlnaCA9IGhpZ2hJbnRlZ2VyIHwgMDsKICAgIHRoaXMubG93ID0gbG93SW50ZWdlciB8IDA7CiAgfQogIGFuZCh3b3JkKSB7CiAgICB0aGlzLmhpZ2ggJj0gd29yZC5oaWdoOwogICAgdGhpcy5sb3cgJj0gd29yZC5sb3c7CiAgfQogIHhvcih3b3JkKSB7CiAgICB0aGlzLmhpZ2ggXj0gd29yZC5oaWdoOwogICAgdGhpcy5sb3cgXj0gd29yZC5sb3c7CiAgfQogIHNoaWZ0UmlnaHQocGxhY2VzKSB7CiAgICBpZiAocGxhY2VzID49IDMyKSB7CiAgICAgIHRoaXMubG93ID0gdGhpcy5oaWdoID4+PiBwbGFjZXMgLSAzMiB8IDA7CiAgICAgIHRoaXMuaGlnaCA9IDA7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmxvdyA9IHRoaXMubG93ID4+PiBwbGFjZXMgfCB0aGlzLmhpZ2ggPDwgMzIgLSBwbGFjZXM7CiAgICAgIHRoaXMuaGlnaCA9IHRoaXMuaGlnaCA+Pj4gcGxhY2VzIHwgMDsKICAgIH0KICB9CiAgcm90YXRlUmlnaHQocGxhY2VzKSB7CiAgICBsZXQgbG93LCBoaWdoOwogICAgaWYgKHBsYWNlcyAmIDMyKSB7CiAgICAgIGhpZ2ggPSB0aGlzLmxvdzsKICAgICAgbG93ID0gdGhpcy5oaWdoOwogICAgfSBlbHNlIHsKICAgICAgbG93ID0gdGhpcy5sb3c7CiAgICAgIGhpZ2ggPSB0aGlzLmhpZ2g7CiAgICB9CiAgICBwbGFjZXMgJj0gMzE7CiAgICB0aGlzLmxvdyA9IGxvdyA+Pj4gcGxhY2VzIHwgaGlnaCA8PCAzMiAtIHBsYWNlczsKICAgIHRoaXMuaGlnaCA9IGhpZ2ggPj4+IHBsYWNlcyB8IGxvdyA8PCAzMiAtIHBsYWNlczsKICB9CiAgbm90KCkgewogICAgdGhpcy5oaWdoID0gfnRoaXMuaGlnaDsKICAgIHRoaXMubG93ID0gfnRoaXMubG93OwogIH0KICBhZGQod29yZCkgewogICAgY29uc3QgbG93QWRkID0gKHRoaXMubG93ID4+PiAwKSArICh3b3JkLmxvdyA+Pj4gMCk7CiAgICBsZXQgaGlnaEFkZCA9ICh0aGlzLmhpZ2ggPj4+IDApICsgKHdvcmQuaGlnaCA+Pj4gMCk7CiAgICBpZiAobG93QWRkID4gMHhmZmZmZmZmZikgewogICAgICBoaWdoQWRkICs9IDE7CiAgICB9CiAgICB0aGlzLmxvdyA9IGxvd0FkZCB8IDA7CiAgICB0aGlzLmhpZ2ggPSBoaWdoQWRkIHwgMDsKICB9CiAgY29weVRvKGJ5dGVzLCBvZmZzZXQpIHsKICAgIGJ5dGVzW29mZnNldF0gPSB0aGlzLmhpZ2ggPj4+IDI0ICYgMHhmZjsKICAgIGJ5dGVzW29mZnNldCArIDFdID0gdGhpcy5oaWdoID4+IDE2ICYgMHhmZjsKICAgIGJ5dGVzW29mZnNldCArIDJdID0gdGhpcy5oaWdoID4+IDggJiAweGZmOwogICAgYnl0ZXNbb2Zmc2V0ICsgM10gPSB0aGlzLmhpZ2ggJiAweGZmOwogICAgYnl0ZXNbb2Zmc2V0ICsgNF0gPSB0aGlzLmxvdyA+Pj4gMjQgJiAweGZmOwogICAgYnl0ZXNbb2Zmc2V0ICsgNV0gPSB0aGlzLmxvdyA+PiAxNiAmIDB4ZmY7CiAgICBieXRlc1tvZmZzZXQgKyA2XSA9IHRoaXMubG93ID4+IDggJiAweGZmOwogICAgYnl0ZXNbb2Zmc2V0ICsgN10gPSB0aGlzLmxvdyAmIDB4ZmY7CiAgfQogIGFzc2lnbih3b3JkKSB7CiAgICB0aGlzLmhpZ2ggPSB3b3JkLmhpZ2g7CiAgICB0aGlzLmxvdyA9IHdvcmQubG93OwogIH0KfQpjb25zdCBjYWxjdWxhdGVfc2hhX290aGVyX1BBUkFNUyA9IHsKICBnZXQgaygpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImsiLCBbbmV3IFdvcmQ2NCgweDQyOGEyZjk4LCAweGQ3MjhhZTIyKSwgbmV3IFdvcmQ2NCgweDcxMzc0NDkxLCAweDIzZWY2NWNkKSwgbmV3IFdvcmQ2NCgweGI1YzBmYmNmLCAweGVjNGQzYjJmKSwgbmV3IFdvcmQ2NCgweGU5YjVkYmE1LCAweDgxODlkYmJjKSwgbmV3IFdvcmQ2NCgweDM5NTZjMjViLCAweGYzNDhiNTM4KSwgbmV3IFdvcmQ2NCgweDU5ZjExMWYxLCAweGI2MDVkMDE5KSwgbmV3IFdvcmQ2NCgweDkyM2Y4MmE0LCAweGFmMTk0ZjliKSwgbmV3IFdvcmQ2NCgweGFiMWM1ZWQ1LCAweGRhNmQ4MTE4KSwgbmV3IFdvcmQ2NCgweGQ4MDdhYTk4LCAweGEzMDMwMjQyKSwgbmV3IFdvcmQ2NCgweDEyODM1YjAxLCAweDQ1NzA2ZmJlKSwgbmV3IFdvcmQ2NCgweDI0MzE4NWJlLCAweDRlZTRiMjhjKSwgbmV3IFdvcmQ2NCgweDU1MGM3ZGMzLCAweGQ1ZmZiNGUyKSwgbmV3IFdvcmQ2NCgweDcyYmU1ZDc0LCAweGYyN2I4OTZmKSwgbmV3IFdvcmQ2NCgweDgwZGViMWZlLCAweDNiMTY5NmIxKSwgbmV3IFdvcmQ2NCgweDliZGMwNmE3LCAweDI1YzcxMjM1KSwgbmV3IFdvcmQ2NCgweGMxOWJmMTc0LCAweGNmNjkyNjk0KSwgbmV3IFdvcmQ2NCgweGU0OWI2OWMxLCAweDllZjE0YWQyKSwgbmV3IFdvcmQ2NCgweGVmYmU0Nzg2LCAweDM4NGYyNWUzKSwgbmV3IFdvcmQ2NCgweDBmYzE5ZGM2LCAweDhiOGNkNWI1KSwgbmV3IFdvcmQ2NCgweDI0MGNhMWNjLCAweDc3YWM5YzY1KSwgbmV3IFdvcmQ2NCgweDJkZTkyYzZmLCAweDU5MmIwMjc1KSwgbmV3IFdvcmQ2NCgweDRhNzQ4NGFhLCAweDZlYTZlNDgzKSwgbmV3IFdvcmQ2NCgweDVjYjBhOWRjLCAweGJkNDFmYmQ0KSwgbmV3IFdvcmQ2NCgweDc2Zjk4OGRhLCAweDgzMTE1M2I1KSwgbmV3IFdvcmQ2NCgweDk4M2U1MTUyLCAweGVlNjZkZmFiKSwgbmV3IFdvcmQ2NCgweGE4MzFjNjZkLCAweDJkYjQzMjEwKSwgbmV3IFdvcmQ2NCgweGIwMDMyN2M4LCAweDk4ZmIyMTNmKSwgbmV3IFdvcmQ2NCgweGJmNTk3ZmM3LCAweGJlZWYwZWU0KSwgbmV3IFdvcmQ2NCgweGM2ZTAwYmYzLCAweDNkYTg4ZmMyKSwgbmV3IFdvcmQ2NCgweGQ1YTc5MTQ3LCAweDkzMGFhNzI1KSwgbmV3IFdvcmQ2NCgweDA2Y2E2MzUxLCAweGUwMDM4MjZmKSwgbmV3IFdvcmQ2NCgweDE0MjkyOTY3LCAweDBhMGU2ZTcwKSwgbmV3IFdvcmQ2NCgweDI3YjcwYTg1LCAweDQ2ZDIyZmZjKSwgbmV3IFdvcmQ2NCgweDJlMWIyMTM4LCAweDVjMjZjOTI2KSwgbmV3IFdvcmQ2NCgweDRkMmM2ZGZjLCAweDVhYzQyYWVkKSwgbmV3IFdvcmQ2NCgweDUzMzgwZDEzLCAweDlkOTViM2RmKSwgbmV3IFdvcmQ2NCgweDY1MGE3MzU0LCAweDhiYWY2M2RlKSwgbmV3IFdvcmQ2NCgweDc2NmEwYWJiLCAweDNjNzdiMmE4KSwgbmV3IFdvcmQ2NCgweDgxYzJjOTJlLCAweDQ3ZWRhZWU2KSwgbmV3IFdvcmQ2NCgweDkyNzIyYzg1LCAweDE0ODIzNTNiKSwgbmV3IFdvcmQ2NCgweGEyYmZlOGExLCAweDRjZjEwMzY0KSwgbmV3IFdvcmQ2NCgweGE4MWE2NjRiLCAweGJjNDIzMDAxKSwgbmV3IFdvcmQ2NCgweGMyNGI4YjcwLCAweGQwZjg5NzkxKSwgbmV3IFdvcmQ2NCgweGM3NmM1MWEzLCAweDA2NTRiZTMwKSwgbmV3IFdvcmQ2NCgweGQxOTJlODE5LCAweGQ2ZWY1MjE4KSwgbmV3IFdvcmQ2NCgweGQ2OTkwNjI0LCAweDU1NjVhOTEwKSwgbmV3IFdvcmQ2NCgweGY0MGUzNTg1LCAweDU3NzEyMDJhKSwgbmV3IFdvcmQ2NCgweDEwNmFhMDcwLCAweDMyYmJkMWI4KSwgbmV3IFdvcmQ2NCgweDE5YTRjMTE2LCAweGI4ZDJkMGM4KSwgbmV3IFdvcmQ2NCgweDFlMzc2YzA4LCAweDUxNDFhYjUzKSwgbmV3IFdvcmQ2NCgweDI3NDg3NzRjLCAweGRmOGVlYjk5KSwgbmV3IFdvcmQ2NCgweDM0YjBiY2I1LCAweGUxOWI0OGE4KSwgbmV3IFdvcmQ2NCgweDM5MWMwY2IzLCAweGM1Yzk1YTYzKSwgbmV3IFdvcmQ2NCgweDRlZDhhYTRhLCAweGUzNDE4YWNiKSwgbmV3IFdvcmQ2NCgweDViOWNjYTRmLCAweDc3NjNlMzczKSwgbmV3IFdvcmQ2NCgweDY4MmU2ZmYzLCAweGQ2YjJiOGEzKSwgbmV3IFdvcmQ2NCgweDc0OGY4MmVlLCAweDVkZWZiMmZjKSwgbmV3IFdvcmQ2NCgweDc4YTU2MzZmLCAweDQzMTcyZjYwKSwgbmV3IFdvcmQ2NCgweDg0Yzg3ODE0LCAweGExZjBhYjcyKSwgbmV3IFdvcmQ2NCgweDhjYzcwMjA4LCAweDFhNjQzOWVjKSwgbmV3IFdvcmQ2NCgweDkwYmVmZmZhLCAweDIzNjMxZTI4KSwgbmV3IFdvcmQ2NCgweGE0NTA2Y2ViLCAweGRlODJiZGU5KSwgbmV3IFdvcmQ2NCgweGJlZjlhM2Y3LCAweGIyYzY3OTE1KSwgbmV3IFdvcmQ2NCgweGM2NzE3OGYyLCAweGUzNzI1MzJiKSwgbmV3IFdvcmQ2NCgweGNhMjczZWNlLCAweGVhMjY2MTljKSwgbmV3IFdvcmQ2NCgweGQxODZiOGM3LCAweDIxYzBjMjA3KSwgbmV3IFdvcmQ2NCgweGVhZGE3ZGQ2LCAweGNkZTBlYjFlKSwgbmV3IFdvcmQ2NCgweGY1N2Q0ZjdmLCAweGVlNmVkMTc4KSwgbmV3IFdvcmQ2NCgweDA2ZjA2N2FhLCAweDcyMTc2ZmJhKSwgbmV3IFdvcmQ2NCgweDBhNjM3ZGM1LCAweGEyYzg5OGE2KSwgbmV3IFdvcmQ2NCgweDExM2Y5ODA0LCAweGJlZjkwZGFlKSwgbmV3IFdvcmQ2NCgweDFiNzEwYjM1LCAweDEzMWM0NzFiKSwgbmV3IFdvcmQ2NCgweDI4ZGI3N2Y1LCAweDIzMDQ3ZDg0KSwgbmV3IFdvcmQ2NCgweDMyY2FhYjdiLCAweDQwYzcyNDkzKSwgbmV3IFdvcmQ2NCgweDNjOWViZTBhLCAweDE1YzliZWJjKSwgbmV3IFdvcmQ2NCgweDQzMWQ2N2M0LCAweDljMTAwZDRjKSwgbmV3IFdvcmQ2NCgweDRjYzVkNGJlLCAweGNiM2U0MmI2KSwgbmV3IFdvcmQ2NCgweDU5N2YyOTljLCAweGZjNjU3ZTJhKSwgbmV3IFdvcmQ2NCgweDVmY2I2ZmFiLCAweDNhZDZmYWVjKSwgbmV3IFdvcmQ2NCgweDZjNDQxOThjLCAweDRhNDc1ODE3KV0pOwogIH0KfTsKZnVuY3Rpb24gY2gocmVzdWx0LCB4LCB5LCB6LCB0bXApIHsKICByZXN1bHQuYXNzaWduKHgpOwogIHJlc3VsdC5hbmQoeSk7CiAgdG1wLmFzc2lnbih4KTsKICB0bXAubm90KCk7CiAgdG1wLmFuZCh6KTsKICByZXN1bHQueG9yKHRtcCk7Cn0KZnVuY3Rpb24gbWFqKHJlc3VsdCwgeCwgeSwgeiwgdG1wKSB7CiAgcmVzdWx0LmFzc2lnbih4KTsKICByZXN1bHQuYW5kKHkpOwogIHRtcC5hc3NpZ24oeCk7CiAgdG1wLmFuZCh6KTsKICByZXN1bHQueG9yKHRtcCk7CiAgdG1wLmFzc2lnbih5KTsKICB0bXAuYW5kKHopOwogIHJlc3VsdC54b3IodG1wKTsKfQpmdW5jdGlvbiBzaWdtYShyZXN1bHQsIHgsIHRtcCkgewogIHJlc3VsdC5hc3NpZ24oeCk7CiAgcmVzdWx0LnJvdGF0ZVJpZ2h0KDI4KTsKICB0bXAuYXNzaWduKHgpOwogIHRtcC5yb3RhdGVSaWdodCgzNCk7CiAgcmVzdWx0Lnhvcih0bXApOwogIHRtcC5hc3NpZ24oeCk7CiAgdG1wLnJvdGF0ZVJpZ2h0KDM5KTsKICByZXN1bHQueG9yKHRtcCk7Cn0KZnVuY3Rpb24gc2lnbWFQcmltZShyZXN1bHQsIHgsIHRtcCkgewogIHJlc3VsdC5hc3NpZ24oeCk7CiAgcmVzdWx0LnJvdGF0ZVJpZ2h0KDE0KTsKICB0bXAuYXNzaWduKHgpOwogIHRtcC5yb3RhdGVSaWdodCgxOCk7CiAgcmVzdWx0Lnhvcih0bXApOwogIHRtcC5hc3NpZ24oeCk7CiAgdG1wLnJvdGF0ZVJpZ2h0KDQxKTsKICByZXN1bHQueG9yKHRtcCk7Cn0KZnVuY3Rpb24gbGl0dGxlU2lnbWEocmVzdWx0LCB4LCB0bXApIHsKICByZXN1bHQuYXNzaWduKHgpOwogIHJlc3VsdC5yb3RhdGVSaWdodCgxKTsKICB0bXAuYXNzaWduKHgpOwogIHRtcC5yb3RhdGVSaWdodCg4KTsKICByZXN1bHQueG9yKHRtcCk7CiAgdG1wLmFzc2lnbih4KTsKICB0bXAuc2hpZnRSaWdodCg3KTsKICByZXN1bHQueG9yKHRtcCk7Cn0KZnVuY3Rpb24gbGl0dGxlU2lnbWFQcmltZShyZXN1bHQsIHgsIHRtcCkgewogIHJlc3VsdC5hc3NpZ24oeCk7CiAgcmVzdWx0LnJvdGF0ZVJpZ2h0KDE5KTsKICB0bXAuYXNzaWduKHgpOwogIHRtcC5yb3RhdGVSaWdodCg2MSk7CiAgcmVzdWx0Lnhvcih0bXApOwogIHRtcC5hc3NpZ24oeCk7CiAgdG1wLnNoaWZ0UmlnaHQoNik7CiAgcmVzdWx0Lnhvcih0bXApOwp9CmZ1bmN0aW9uIGNhbGN1bGF0ZVNIQTUxMihkYXRhLCBvZmZzZXQsIGxlbmd0aCwgbW9kZTM4NCA9IGZhbHNlKSB7CiAgbGV0IGgwLCBoMSwgaDIsIGgzLCBoNCwgaDUsIGg2LCBoNzsKICBpZiAoIW1vZGUzODQpIHsKICAgIGgwID0gbmV3IFdvcmQ2NCgweDZhMDllNjY3LCAweGYzYmNjOTA4KTsKICAgIGgxID0gbmV3IFdvcmQ2NCgweGJiNjdhZTg1LCAweDg0Y2FhNzNiKTsKICAgIGgyID0gbmV3IFdvcmQ2NCgweDNjNmVmMzcyLCAweGZlOTRmODJiKTsKICAgIGgzID0gbmV3IFdvcmQ2NCgweGE1NGZmNTNhLCAweDVmMWQzNmYxKTsKICAgIGg0ID0gbmV3IFdvcmQ2NCgweDUxMGU1MjdmLCAweGFkZTY4MmQxKTsKICAgIGg1ID0gbmV3IFdvcmQ2NCgweDliMDU2ODhjLCAweDJiM2U2YzFmKTsKICAgIGg2ID0gbmV3IFdvcmQ2NCgweDFmODNkOWFiLCAweGZiNDFiZDZiKTsKICAgIGg3ID0gbmV3IFdvcmQ2NCgweDViZTBjZDE5LCAweDEzN2UyMTc5KTsKICB9IGVsc2UgewogICAgaDAgPSBuZXcgV29yZDY0KDB4Y2JiYjlkNWQsIDB4YzEwNTllZDgpOwogICAgaDEgPSBuZXcgV29yZDY0KDB4NjI5YTI5MmEsIDB4MzY3Y2Q1MDcpOwogICAgaDIgPSBuZXcgV29yZDY0KDB4OTE1OTAxNWEsIDB4MzA3MGRkMTcpOwogICAgaDMgPSBuZXcgV29yZDY0KDB4MTUyZmVjZDgsIDB4ZjcwZTU5MzkpOwogICAgaDQgPSBuZXcgV29yZDY0KDB4NjczMzI2NjcsIDB4ZmZjMDBiMzEpOwogICAgaDUgPSBuZXcgV29yZDY0KDB4OGViNDRhODcsIDB4Njg1ODE1MTEpOwogICAgaDYgPSBuZXcgV29yZDY0KDB4ZGIwYzJlMGQsIDB4NjRmOThmYTcpOwogICAgaDcgPSBuZXcgV29yZDY0KDB4NDdiNTQ4MWQsIDB4YmVmYTRmYTQpOwogIH0KICBjb25zdCBwYWRkZWRMZW5ndGggPSBNYXRoLmNlaWwoKGxlbmd0aCArIDE3KSAvIDEyOCkgKiAxMjg7CiAgY29uc3QgcGFkZGVkID0gbmV3IFVpbnQ4QXJyYXkocGFkZGVkTGVuZ3RoKTsKICBsZXQgaSwgajsKICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgIHBhZGRlZFtpXSA9IGRhdGFbb2Zmc2V0KytdOwogIH0KICBwYWRkZWRbaSsrXSA9IDB4ODA7CiAgY29uc3QgbiA9IHBhZGRlZExlbmd0aCAtIDE2OwogIGlmIChpIDwgbikgewogICAgaSA9IG47CiAgfQogIGkgKz0gMTE7CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4+IDI5ICYgMHhmZjsKICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+PiAyMSAmIDB4ZmY7CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4gMTMgJiAweGZmOwogIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDUgJiAweGZmOwogIHBhZGRlZFtpKytdID0gbGVuZ3RoIDw8IDMgJiAweGZmOwogIGNvbnN0IHcgPSBuZXcgQXJyYXkoODApOwogIGZvciAoaSA9IDA7IGkgPCA4MDsgaSsrKSB7CiAgICB3W2ldID0gbmV3IFdvcmQ2NCgwLCAwKTsKICB9CiAgY29uc3QgewogICAgawogIH0gPSBjYWxjdWxhdGVfc2hhX290aGVyX1BBUkFNUzsKICBsZXQgYSA9IG5ldyBXb3JkNjQoMCwgMCksCiAgICBiID0gbmV3IFdvcmQ2NCgwLCAwKSwKICAgIGMgPSBuZXcgV29yZDY0KDAsIDApOwogIGxldCBkID0gbmV3IFdvcmQ2NCgwLCAwKSwKICAgIGUgPSBuZXcgV29yZDY0KDAsIDApLAogICAgZiA9IG5ldyBXb3JkNjQoMCwgMCk7CiAgbGV0IGcgPSBuZXcgV29yZDY0KDAsIDApLAogICAgaCA9IG5ldyBXb3JkNjQoMCwgMCk7CiAgY29uc3QgdDEgPSBuZXcgV29yZDY0KDAsIDApLAogICAgdDIgPSBuZXcgV29yZDY0KDAsIDApOwogIGNvbnN0IHRtcDEgPSBuZXcgV29yZDY0KDAsIDApLAogICAgdG1wMiA9IG5ldyBXb3JkNjQoMCwgMCk7CiAgbGV0IHRtcDM7CiAgZm9yIChpID0gMDsgaSA8IHBhZGRlZExlbmd0aDspIHsKICAgIGZvciAoaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgIHdbal0uaGlnaCA9IHBhZGRlZFtpXSA8PCAyNCB8IHBhZGRlZFtpICsgMV0gPDwgMTYgfCBwYWRkZWRbaSArIDJdIDw8IDggfCBwYWRkZWRbaSArIDNdOwogICAgICB3W2pdLmxvdyA9IHBhZGRlZFtpICsgNF0gPDwgMjQgfCBwYWRkZWRbaSArIDVdIDw8IDE2IHwgcGFkZGVkW2kgKyA2XSA8PCA4IHwgcGFkZGVkW2kgKyA3XTsKICAgICAgaSArPSA4OwogICAgfQogICAgZm9yIChqID0gMTY7IGogPCA4MDsgKytqKSB7CiAgICAgIHRtcDMgPSB3W2pdOwogICAgICBsaXR0bGVTaWdtYVByaW1lKHRtcDMsIHdbaiAtIDJdLCB0bXAyKTsKICAgICAgdG1wMy5hZGQod1tqIC0gN10pOwogICAgICBsaXR0bGVTaWdtYSh0bXAxLCB3W2ogLSAxNV0sIHRtcDIpOwogICAgICB0bXAzLmFkZCh0bXAxKTsKICAgICAgdG1wMy5hZGQod1tqIC0gMTZdKTsKICAgIH0KICAgIGEuYXNzaWduKGgwKTsKICAgIGIuYXNzaWduKGgxKTsKICAgIGMuYXNzaWduKGgyKTsKICAgIGQuYXNzaWduKGgzKTsKICAgIGUuYXNzaWduKGg0KTsKICAgIGYuYXNzaWduKGg1KTsKICAgIGcuYXNzaWduKGg2KTsKICAgIGguYXNzaWduKGg3KTsKICAgIGZvciAoaiA9IDA7IGogPCA4MDsgKytqKSB7CiAgICAgIHQxLmFzc2lnbihoKTsKICAgICAgc2lnbWFQcmltZSh0bXAxLCBlLCB0bXAyKTsKICAgICAgdDEuYWRkKHRtcDEpOwogICAgICBjaCh0bXAxLCBlLCBmLCBnLCB0bXAyKTsKICAgICAgdDEuYWRkKHRtcDEpOwogICAgICB0MS5hZGQoa1tqXSk7CiAgICAgIHQxLmFkZCh3W2pdKTsKICAgICAgc2lnbWEodDIsIGEsIHRtcDIpOwogICAgICBtYWoodG1wMSwgYSwgYiwgYywgdG1wMik7CiAgICAgIHQyLmFkZCh0bXAxKTsKICAgICAgdG1wMyA9IGg7CiAgICAgIGggPSBnOwogICAgICBnID0gZjsKICAgICAgZiA9IGU7CiAgICAgIGQuYWRkKHQxKTsKICAgICAgZSA9IGQ7CiAgICAgIGQgPSBjOwogICAgICBjID0gYjsKICAgICAgYiA9IGE7CiAgICAgIHRtcDMuYXNzaWduKHQxKTsKICAgICAgdG1wMy5hZGQodDIpOwogICAgICBhID0gdG1wMzsKICAgIH0KICAgIGgwLmFkZChhKTsKICAgIGgxLmFkZChiKTsKICAgIGgyLmFkZChjKTsKICAgIGgzLmFkZChkKTsKICAgIGg0LmFkZChlKTsKICAgIGg1LmFkZChmKTsKICAgIGg2LmFkZChnKTsKICAgIGg3LmFkZChoKTsKICB9CiAgbGV0IHJlc3VsdDsKICBpZiAoIW1vZGUzODQpIHsKICAgIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KDY0KTsKICAgIGgwLmNvcHlUbyhyZXN1bHQsIDApOwogICAgaDEuY29weVRvKHJlc3VsdCwgOCk7CiAgICBoMi5jb3B5VG8ocmVzdWx0LCAxNik7CiAgICBoMy5jb3B5VG8ocmVzdWx0LCAyNCk7CiAgICBoNC5jb3B5VG8ocmVzdWx0LCAzMik7CiAgICBoNS5jb3B5VG8ocmVzdWx0LCA0MCk7CiAgICBoNi5jb3B5VG8ocmVzdWx0LCA0OCk7CiAgICBoNy5jb3B5VG8ocmVzdWx0LCA1Nik7CiAgfSBlbHNlIHsKICAgIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KDQ4KTsKICAgIGgwLmNvcHlUbyhyZXN1bHQsIDApOwogICAgaDEuY29weVRvKHJlc3VsdCwgOCk7CiAgICBoMi5jb3B5VG8ocmVzdWx0LCAxNik7CiAgICBoMy5jb3B5VG8ocmVzdWx0LCAyNCk7CiAgICBoNC5jb3B5VG8ocmVzdWx0LCAzMik7CiAgICBoNS5jb3B5VG8ocmVzdWx0LCA0MCk7CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KZnVuY3Rpb24gY2FsY3VsYXRlU0hBMzg0KGRhdGEsIG9mZnNldCwgbGVuZ3RoKSB7CiAgcmV0dXJuIGNhbGN1bGF0ZVNIQTUxMihkYXRhLCBvZmZzZXQsIGxlbmd0aCwgdHJ1ZSk7Cn0KCjsvLyAuL3NyYy9jb3JlL2NhbGN1bGF0ZV9zaGEyNTYuanMKCmNvbnN0IGNhbGN1bGF0ZV9zaGEyNTZfUEFSQU1TID0gewogIGdldCBrKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiayIsIFsweDQyOGEyZjk4LCAweDcxMzc0NDkxLCAweGI1YzBmYmNmLCAweGU5YjVkYmE1LCAweDM5NTZjMjViLCAweDU5ZjExMWYxLCAweDkyM2Y4MmE0LCAweGFiMWM1ZWQ1LCAweGQ4MDdhYTk4LCAweDEyODM1YjAxLCAweDI0MzE4NWJlLCAweDU1MGM3ZGMzLCAweDcyYmU1ZDc0LCAweDgwZGViMWZlLCAweDliZGMwNmE3LCAweGMxOWJmMTc0LCAweGU0OWI2OWMxLCAweGVmYmU0Nzg2LCAweDBmYzE5ZGM2LCAweDI0MGNhMWNjLCAweDJkZTkyYzZmLCAweDRhNzQ4NGFhLCAweDVjYjBhOWRjLCAweDc2Zjk4OGRhLCAweDk4M2U1MTUyLCAweGE4MzFjNjZkLCAweGIwMDMyN2M4LCAweGJmNTk3ZmM3LCAweGM2ZTAwYmYzLCAweGQ1YTc5MTQ3LCAweDA2Y2E2MzUxLCAweDE0MjkyOTY3LCAweDI3YjcwYTg1LCAweDJlMWIyMTM4LCAweDRkMmM2ZGZjLCAweDUzMzgwZDEzLCAweDY1MGE3MzU0LCAweDc2NmEwYWJiLCAweDgxYzJjOTJlLCAweDkyNzIyYzg1LCAweGEyYmZlOGExLCAweGE4MWE2NjRiLCAweGMyNGI4YjcwLCAweGM3NmM1MWEzLCAweGQxOTJlODE5LCAweGQ2OTkwNjI0LCAweGY0MGUzNTg1LCAweDEwNmFhMDcwLCAweDE5YTRjMTE2LCAweDFlMzc2YzA4LCAweDI3NDg3NzRjLCAweDM0YjBiY2I1LCAweDM5MWMwY2IzLCAweDRlZDhhYTRhLCAweDViOWNjYTRmLCAweDY4MmU2ZmYzLCAweDc0OGY4MmVlLCAweDc4YTU2MzZmLCAweDg0Yzg3ODE0LCAweDhjYzcwMjA4LCAweDkwYmVmZmZhLCAweGE0NTA2Y2ViLCAweGJlZjlhM2Y3LCAweGM2NzE3OGYyXSk7CiAgfQp9OwpmdW5jdGlvbiByb3RyKHgsIG4pIHsKICByZXR1cm4geCA+Pj4gbiB8IHggPDwgMzIgLSBuOwp9CmZ1bmN0aW9uIGNhbGN1bGF0ZV9zaGEyNTZfY2goeCwgeSwgeikgewogIHJldHVybiB4ICYgeSBeIH54ICYgejsKfQpmdW5jdGlvbiBjYWxjdWxhdGVfc2hhMjU2X21haih4LCB5LCB6KSB7CiAgcmV0dXJuIHggJiB5IF4geCAmIHogXiB5ICYgejsKfQpmdW5jdGlvbiBjYWxjdWxhdGVfc2hhMjU2X3NpZ21hKHgpIHsKICByZXR1cm4gcm90cih4LCAyKSBeIHJvdHIoeCwgMTMpIF4gcm90cih4LCAyMik7Cn0KZnVuY3Rpb24gY2FsY3VsYXRlX3NoYTI1Nl9zaWdtYVByaW1lKHgpIHsKICByZXR1cm4gcm90cih4LCA2KSBeIHJvdHIoeCwgMTEpIF4gcm90cih4LCAyNSk7Cn0KZnVuY3Rpb24gY2FsY3VsYXRlX3NoYTI1Nl9saXR0bGVTaWdtYSh4KSB7CiAgcmV0dXJuIHJvdHIoeCwgNykgXiByb3RyKHgsIDE4KSBeIHggPj4+IDM7Cn0KZnVuY3Rpb24gY2FsY3VsYXRlX3NoYTI1Nl9saXR0bGVTaWdtYVByaW1lKHgpIHsKICByZXR1cm4gcm90cih4LCAxNykgXiByb3RyKHgsIDE5KSBeIHggPj4+IDEwOwp9CmZ1bmN0aW9uIGNhbGN1bGF0ZVNIQTI1NihkYXRhLCBvZmZzZXQsIGxlbmd0aCkgewogIGxldCBoMCA9IDB4NmEwOWU2NjcsCiAgICBoMSA9IDB4YmI2N2FlODUsCiAgICBoMiA9IDB4M2M2ZWYzNzIsCiAgICBoMyA9IDB4YTU0ZmY1M2EsCiAgICBoNCA9IDB4NTEwZTUyN2YsCiAgICBoNSA9IDB4OWIwNTY4OGMsCiAgICBoNiA9IDB4MWY4M2Q5YWIsCiAgICBoNyA9IDB4NWJlMGNkMTk7CiAgY29uc3QgcGFkZGVkTGVuZ3RoID0gTWF0aC5jZWlsKChsZW5ndGggKyA5KSAvIDY0KSAqIDY0OwogIGNvbnN0IHBhZGRlZCA9IG5ldyBVaW50OEFycmF5KHBhZGRlZExlbmd0aCk7CiAgbGV0IGksIGo7CiAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICBwYWRkZWRbaV0gPSBkYXRhW29mZnNldCsrXTsKICB9CiAgcGFkZGVkW2krK10gPSAweDgwOwogIGNvbnN0IG4gPSBwYWRkZWRMZW5ndGggLSA4OwogIGlmIChpIDwgbikgewogICAgaSA9IG47CiAgfQogIGkgKz0gMzsKICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+Pj4gMjkgJiAweGZmOwogIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDIxICYgMHhmZjsKICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+PiAxMyAmIDB4ZmY7CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4gNSAmIDB4ZmY7CiAgcGFkZGVkW2krK10gPSBsZW5ndGggPDwgMyAmIDB4ZmY7CiAgY29uc3QgdyA9IG5ldyBVaW50MzJBcnJheSg2NCk7CiAgY29uc3QgewogICAgawogIH0gPSBjYWxjdWxhdGVfc2hhMjU2X1BBUkFNUzsKICBmb3IgKGkgPSAwOyBpIDwgcGFkZGVkTGVuZ3RoOykgewogICAgZm9yIChqID0gMDsgaiA8IDE2OyArK2opIHsKICAgICAgd1tqXSA9IHBhZGRlZFtpXSA8PCAyNCB8IHBhZGRlZFtpICsgMV0gPDwgMTYgfCBwYWRkZWRbaSArIDJdIDw8IDggfCBwYWRkZWRbaSArIDNdOwogICAgICBpICs9IDQ7CiAgICB9CiAgICBmb3IgKGogPSAxNjsgaiA8IDY0OyArK2opIHsKICAgICAgd1tqXSA9IGNhbGN1bGF0ZV9zaGEyNTZfbGl0dGxlU2lnbWFQcmltZSh3W2ogLSAyXSkgKyB3W2ogLSA3XSArIGNhbGN1bGF0ZV9zaGEyNTZfbGl0dGxlU2lnbWEod1tqIC0gMTVdKSArIHdbaiAtIDE2XSB8IDA7CiAgICB9CiAgICBsZXQgYSA9IGgwLAogICAgICBiID0gaDEsCiAgICAgIGMgPSBoMiwKICAgICAgZCA9IGgzLAogICAgICBlID0gaDQsCiAgICAgIGYgPSBoNSwKICAgICAgZyA9IGg2LAogICAgICBoID0gaDcsCiAgICAgIHQxLAogICAgICB0MjsKICAgIGZvciAoaiA9IDA7IGogPCA2NDsgKytqKSB7CiAgICAgIHQxID0gaCArIGNhbGN1bGF0ZV9zaGEyNTZfc2lnbWFQcmltZShlKSArIGNhbGN1bGF0ZV9zaGEyNTZfY2goZSwgZiwgZykgKyBrW2pdICsgd1tqXTsKICAgICAgdDIgPSBjYWxjdWxhdGVfc2hhMjU2X3NpZ21hKGEpICsgY2FsY3VsYXRlX3NoYTI1Nl9tYWooYSwgYiwgYyk7CiAgICAgIGggPSBnOwogICAgICBnID0gZjsKICAgICAgZiA9IGU7CiAgICAgIGUgPSBkICsgdDEgfCAwOwogICAgICBkID0gYzsKICAgICAgYyA9IGI7CiAgICAgIGIgPSBhOwogICAgICBhID0gdDEgKyB0MiB8IDA7CiAgICB9CiAgICBoMCA9IGgwICsgYSB8IDA7CiAgICBoMSA9IGgxICsgYiB8IDA7CiAgICBoMiA9IGgyICsgYyB8IDA7CiAgICBoMyA9IGgzICsgZCB8IDA7CiAgICBoNCA9IGg0ICsgZSB8IDA7CiAgICBoNSA9IGg1ICsgZiB8IDA7CiAgICBoNiA9IGg2ICsgZyB8IDA7CiAgICBoNyA9IGg3ICsgaCB8IDA7CiAgfQogIHJldHVybiBuZXcgVWludDhBcnJheShbaDAgPj4gMjQgJiAweEZGLCBoMCA+PiAxNiAmIDB4RkYsIGgwID4+IDggJiAweEZGLCBoMCAmIDB4RkYsIGgxID4+IDI0ICYgMHhGRiwgaDEgPj4gMTYgJiAweEZGLCBoMSA+PiA4ICYgMHhGRiwgaDEgJiAweEZGLCBoMiA+PiAyNCAmIDB4RkYsIGgyID4+IDE2ICYgMHhGRiwgaDIgPj4gOCAmIDB4RkYsIGgyICYgMHhGRiwgaDMgPj4gMjQgJiAweEZGLCBoMyA+PiAxNiAmIDB4RkYsIGgzID4+IDggJiAweEZGLCBoMyAmIDB4RkYsIGg0ID4+IDI0ICYgMHhGRiwgaDQgPj4gMTYgJiAweEZGLCBoNCA+PiA4ICYgMHhGRiwgaDQgJiAweEZGLCBoNSA+PiAyNCAmIDB4RkYsIGg1ID4+IDE2ICYgMHhGRiwgaDUgPj4gOCAmIDB4RkYsIGg1ICYgMHhGRiwgaDYgPj4gMjQgJiAweEZGLCBoNiA+PiAxNiAmIDB4RkYsIGg2ID4+IDggJiAweEZGLCBoNiAmIDB4RkYsIGg3ID4+IDI0ICYgMHhGRiwgaDcgPj4gMTYgJiAweEZGLCBoNyA+PiA4ICYgMHhGRiwgaDcgJiAweEZGXSk7Cn0KCjsvLyAuL3NyYy9jb3JlL2RlY3J5cHRfc3RyZWFtLmpzCgpjb25zdCBjaHVua1NpemUgPSA1MTI7CmNsYXNzIERlY3J5cHRTdHJlYW0gZXh0ZW5kcyBEZWNvZGVTdHJlYW0gewogIGNvbnN0cnVjdG9yKHN0ciwgbWF5YmVMZW5ndGgsIGRlY3J5cHQpIHsKICAgIHN1cGVyKG1heWJlTGVuZ3RoKTsKICAgIHRoaXMuc3RyID0gc3RyOwogICAgdGhpcy5kaWN0ID0gc3RyLmRpY3Q7CiAgICB0aGlzLmRlY3J5cHQgPSBkZWNyeXB0OwogICAgdGhpcy5uZXh0Q2h1bmsgPSBudWxsOwogICAgdGhpcy5pbml0aWFsaXplZCA9IGZhbHNlOwogIH0KICByZWFkQmxvY2soKSB7CiAgICBsZXQgY2h1bms7CiAgICBpZiAodGhpcy5pbml0aWFsaXplZCkgewogICAgICBjaHVuayA9IHRoaXMubmV4dENodW5rOwogICAgfSBlbHNlIHsKICAgICAgY2h1bmsgPSB0aGlzLnN0ci5nZXRCeXRlcyhjaHVua1NpemUpOwogICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTsKICAgIH0KICAgIGlmICghY2h1bms/Lmxlbmd0aCkgewogICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMubmV4dENodW5rID0gdGhpcy5zdHIuZ2V0Qnl0ZXMoY2h1bmtTaXplKTsKICAgIGNvbnN0IGhhc01vcmVEYXRhID0gdGhpcy5uZXh0Q2h1bms/Lmxlbmd0aCA+IDA7CiAgICBjb25zdCBkZWNyeXB0ID0gdGhpcy5kZWNyeXB0OwogICAgY2h1bmsgPSBkZWNyeXB0KGNodW5rLCAhaGFzTW9yZURhdGEpOwogICAgY29uc3QgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJMZW5ndGgsCiAgICAgIG5ld0xlbmd0aCA9IGJ1ZmZlckxlbmd0aCArIGNodW5rLmxlbmd0aCwKICAgICAgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIobmV3TGVuZ3RoKTsKICAgIGJ1ZmZlci5zZXQoY2h1bmssIGJ1ZmZlckxlbmd0aCk7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IG5ld0xlbmd0aDsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL2NyeXB0by5qcwoKCgoKCgpjbGFzcyBBUkNGb3VyQ2lwaGVyIHsKICBjb25zdHJ1Y3RvcihrZXkpIHsKICAgIHRoaXMuYSA9IDA7CiAgICB0aGlzLmIgPSAwOwogICAgY29uc3QgcyA9IG5ldyBVaW50OEFycmF5KDI1Nik7CiAgICBjb25zdCBrZXlMZW5ndGggPSBrZXkubGVuZ3RoOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7ICsraSkgewogICAgICBzW2ldID0gaTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwLCBqID0gMDsgaSA8IDI1NjsgKytpKSB7CiAgICAgIGNvbnN0IHRtcCA9IHNbaV07CiAgICAgIGogPSBqICsgdG1wICsga2V5W2kgJSBrZXlMZW5ndGhdICYgMHhmZjsKICAgICAgc1tpXSA9IHNbal07CiAgICAgIHNbal0gPSB0bXA7CiAgICB9CiAgICB0aGlzLnMgPSBzOwogIH0KICBlbmNyeXB0QmxvY2soZGF0YSkgewogICAgbGV0IGEgPSB0aGlzLmEsCiAgICAgIGIgPSB0aGlzLmI7CiAgICBjb25zdCBzID0gdGhpcy5zOwogICAgY29uc3QgbiA9IGRhdGEubGVuZ3RoOwogICAgY29uc3Qgb3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkobik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG47ICsraSkgewogICAgICBhID0gYSArIDEgJiAweGZmOwogICAgICBjb25zdCB0bXAgPSBzW2FdOwogICAgICBiID0gYiArIHRtcCAmIDB4ZmY7CiAgICAgIGNvbnN0IHRtcDIgPSBzW2JdOwogICAgICBzW2FdID0gdG1wMjsKICAgICAgc1tiXSA9IHRtcDsKICAgICAgb3V0cHV0W2ldID0gZGF0YVtpXSBeIHNbdG1wICsgdG1wMiAmIDB4ZmZdOwogICAgfQogICAgdGhpcy5hID0gYTsKICAgIHRoaXMuYiA9IGI7CiAgICByZXR1cm4gb3V0cHV0OwogIH0KICBkZWNyeXB0QmxvY2soZGF0YSkgewogICAgcmV0dXJuIHRoaXMuZW5jcnlwdEJsb2NrKGRhdGEpOwogIH0KICBlbmNyeXB0KGRhdGEpIHsKICAgIHJldHVybiB0aGlzLmVuY3J5cHRCbG9jayhkYXRhKTsKICB9Cn0KY2xhc3MgTnVsbENpcGhlciB7CiAgZGVjcnlwdEJsb2NrKGRhdGEpIHsKICAgIHJldHVybiBkYXRhOwogIH0KICBlbmNyeXB0KGRhdGEpIHsKICAgIHJldHVybiBkYXRhOwogIH0KfQpjbGFzcyBBRVNCYXNlQ2lwaGVyIHsKICBfcyA9IG5ldyBVaW50OEFycmF5KFsweDYzLCAweDdjLCAweDc3LCAweDdiLCAweGYyLCAweDZiLCAweDZmLCAweGM1LCAweDMwLCAweDAxLCAweDY3LCAweDJiLCAweGZlLCAweGQ3LCAweGFiLCAweDc2LCAweGNhLCAweDgyLCAweGM5LCAweDdkLCAweGZhLCAweDU5LCAweDQ3LCAweGYwLCAweGFkLCAweGQ0LCAweGEyLCAweGFmLCAweDljLCAweGE0LCAweDcyLCAweGMwLCAweGI3LCAweGZkLCAweDkzLCAweDI2LCAweDM2LCAweDNmLCAweGY3LCAweGNjLCAweDM0LCAweGE1LCAweGU1LCAweGYxLCAweDcxLCAweGQ4LCAweDMxLCAweDE1LCAweDA0LCAweGM3LCAweDIzLCAweGMzLCAweDE4LCAweDk2LCAweDA1LCAweDlhLCAweDA3LCAweDEyLCAweDgwLCAweGUyLCAweGViLCAweDI3LCAweGIyLCAweDc1LCAweDA5LCAweDgzLCAweDJjLCAweDFhLCAweDFiLCAweDZlLCAweDVhLCAweGEwLCAweDUyLCAweDNiLCAweGQ2LCAweGIzLCAweDI5LCAweGUzLCAweDJmLCAweDg0LCAweDUzLCAweGQxLCAweDAwLCAweGVkLCAweDIwLCAweGZjLCAweGIxLCAweDViLCAweDZhLCAweGNiLCAweGJlLCAweDM5LCAweDRhLCAweDRjLCAweDU4LCAweGNmLCAweGQwLCAweGVmLCAweGFhLCAweGZiLCAweDQzLCAweDRkLCAweDMzLCAweDg1LCAweDQ1LCAweGY5LCAweDAyLCAweDdmLCAweDUwLCAweDNjLCAweDlmLCAweGE4LCAweDUxLCAweGEzLCAweDQwLCAweDhmLCAweDkyLCAweDlkLCAweDM4LCAweGY1LCAweGJjLCAweGI2LCAweGRhLCAweDIxLCAweDEwLCAweGZmLCAweGYzLCAweGQyLCAweGNkLCAweDBjLCAweDEzLCAweGVjLCAweDVmLCAweDk3LCAweDQ0LCAweDE3LCAweGM0LCAweGE3LCAweDdlLCAweDNkLCAweDY0LCAweDVkLCAweDE5LCAweDczLCAweDYwLCAweDgxLCAweDRmLCAweGRjLCAweDIyLCAweDJhLCAweDkwLCAweDg4LCAweDQ2LCAweGVlLCAweGI4LCAweDE0LCAweGRlLCAweDVlLCAweDBiLCAweGRiLCAweGUwLCAweDMyLCAweDNhLCAweDBhLCAweDQ5LCAweDA2LCAweDI0LCAweDVjLCAweGMyLCAweGQzLCAweGFjLCAweDYyLCAweDkxLCAweDk1LCAweGU0LCAweDc5LCAweGU3LCAweGM4LCAweDM3LCAweDZkLCAweDhkLCAweGQ1LCAweDRlLCAweGE5LCAweDZjLCAweDU2LCAweGY0LCAweGVhLCAweDY1LCAweDdhLCAweGFlLCAweDA4LCAweGJhLCAweDc4LCAweDI1LCAweDJlLCAweDFjLCAweGE2LCAweGI0LCAweGM2LCAweGU4LCAweGRkLCAweDc0LCAweDFmLCAweDRiLCAweGJkLCAweDhiLCAweDhhLCAweDcwLCAweDNlLCAweGI1LCAweDY2LCAweDQ4LCAweDAzLCAweGY2LCAweDBlLCAweDYxLCAweDM1LCAweDU3LCAweGI5LCAweDg2LCAweGMxLCAweDFkLCAweDllLCAweGUxLCAweGY4LCAweDk4LCAweDExLCAweDY5LCAweGQ5LCAweDhlLCAweDk0LCAweDliLCAweDFlLCAweDg3LCAweGU5LCAweGNlLCAweDU1LCAweDI4LCAweGRmLCAweDhjLCAweGExLCAweDg5LCAweDBkLCAweGJmLCAweGU2LCAweDQyLCAweDY4LCAweDQxLCAweDk5LCAweDJkLCAweDBmLCAweGIwLCAweDU0LCAweGJiLCAweDE2XSk7CiAgX2ludl9zID0gbmV3IFVpbnQ4QXJyYXkoWzB4NTIsIDB4MDksIDB4NmEsIDB4ZDUsIDB4MzAsIDB4MzYsIDB4YTUsIDB4MzgsIDB4YmYsIDB4NDAsIDB4YTMsIDB4OWUsIDB4ODEsIDB4ZjMsIDB4ZDcsIDB4ZmIsIDB4N2MsIDB4ZTMsIDB4MzksIDB4ODIsIDB4OWIsIDB4MmYsIDB4ZmYsIDB4ODcsIDB4MzQsIDB4OGUsIDB4NDMsIDB4NDQsIDB4YzQsIDB4ZGUsIDB4ZTksIDB4Y2IsIDB4NTQsIDB4N2IsIDB4OTQsIDB4MzIsIDB4YTYsIDB4YzIsIDB4MjMsIDB4M2QsIDB4ZWUsIDB4NGMsIDB4OTUsIDB4MGIsIDB4NDIsIDB4ZmEsIDB4YzMsIDB4NGUsIDB4MDgsIDB4MmUsIDB4YTEsIDB4NjYsIDB4MjgsIDB4ZDksIDB4MjQsIDB4YjIsIDB4NzYsIDB4NWIsIDB4YTIsIDB4NDksIDB4NmQsIDB4OGIsIDB4ZDEsIDB4MjUsIDB4NzIsIDB4ZjgsIDB4ZjYsIDB4NjQsIDB4ODYsIDB4NjgsIDB4OTgsIDB4MTYsIDB4ZDQsIDB4YTQsIDB4NWMsIDB4Y2MsIDB4NWQsIDB4NjUsIDB4YjYsIDB4OTIsIDB4NmMsIDB4NzAsIDB4NDgsIDB4NTAsIDB4ZmQsIDB4ZWQsIDB4YjksIDB4ZGEsIDB4NWUsIDB4MTUsIDB4NDYsIDB4NTcsIDB4YTcsIDB4OGQsIDB4OWQsIDB4ODQsIDB4OTAsIDB4ZDgsIDB4YWIsIDB4MDAsIDB4OGMsIDB4YmMsIDB4ZDMsIDB4MGEsIDB4ZjcsIDB4ZTQsIDB4NTgsIDB4MDUsIDB4YjgsIDB4YjMsIDB4NDUsIDB4MDYsIDB4ZDAsIDB4MmMsIDB4MWUsIDB4OGYsIDB4Y2EsIDB4M2YsIDB4MGYsIDB4MDIsIDB4YzEsIDB4YWYsIDB4YmQsIDB4MDMsIDB4MDEsIDB4MTMsIDB4OGEsIDB4NmIsIDB4M2EsIDB4OTEsIDB4MTEsIDB4NDEsIDB4NGYsIDB4NjcsIDB4ZGMsIDB4ZWEsIDB4OTcsIDB4ZjIsIDB4Y2YsIDB4Y2UsIDB4ZjAsIDB4YjQsIDB4ZTYsIDB4NzMsIDB4OTYsIDB4YWMsIDB4NzQsIDB4MjIsIDB4ZTcsIDB4YWQsIDB4MzUsIDB4ODUsIDB4ZTIsIDB4ZjksIDB4MzcsIDB4ZTgsIDB4MWMsIDB4NzUsIDB4ZGYsIDB4NmUsIDB4NDcsIDB4ZjEsIDB4MWEsIDB4NzEsIDB4MWQsIDB4MjksIDB4YzUsIDB4ODksIDB4NmYsIDB4YjcsIDB4NjIsIDB4MGUsIDB4YWEsIDB4MTgsIDB4YmUsIDB4MWIsIDB4ZmMsIDB4NTYsIDB4M2UsIDB4NGIsIDB4YzYsIDB4ZDIsIDB4NzksIDB4MjAsIDB4OWEsIDB4ZGIsIDB4YzAsIDB4ZmUsIDB4NzgsIDB4Y2QsIDB4NWEsIDB4ZjQsIDB4MWYsIDB4ZGQsIDB4YTgsIDB4MzMsIDB4ODgsIDB4MDcsIDB4YzcsIDB4MzEsIDB4YjEsIDB4MTIsIDB4MTAsIDB4NTksIDB4MjcsIDB4ODAsIDB4ZWMsIDB4NWYsIDB4NjAsIDB4NTEsIDB4N2YsIDB4YTksIDB4MTksIDB4YjUsIDB4NGEsIDB4MGQsIDB4MmQsIDB4ZTUsIDB4N2EsIDB4OWYsIDB4OTMsIDB4YzksIDB4OWMsIDB4ZWYsIDB4YTAsIDB4ZTAsIDB4M2IsIDB4NGQsIDB4YWUsIDB4MmEsIDB4ZjUsIDB4YjAsIDB4YzgsIDB4ZWIsIDB4YmIsIDB4M2MsIDB4ODMsIDB4NTMsIDB4OTksIDB4NjEsIDB4MTcsIDB4MmIsIDB4MDQsIDB4N2UsIDB4YmEsIDB4NzcsIDB4ZDYsIDB4MjYsIDB4ZTEsIDB4NjksIDB4MTQsIDB4NjMsIDB4NTUsIDB4MjEsIDB4MGMsIDB4N2RdKTsKICBfbWl4ID0gbmV3IFVpbnQzMkFycmF5KFsweDAwMDAwMDAwLCAweDBlMDkwZDBiLCAweDFjMTIxYTE2LCAweDEyMWIxNzFkLCAweDM4MjQzNDJjLCAweDM2MmQzOTI3LCAweDI0MzYyZTNhLCAweDJhM2YyMzMxLCAweDcwNDg2ODU4LCAweDdlNDE2NTUzLCAweDZjNWE3MjRlLCAweDYyNTM3ZjQ1LCAweDQ4NmM1Yzc0LCAweDQ2NjU1MTdmLCAweDU0N2U0NjYyLCAweDVhNzc0YjY5LCAweGUwOTBkMGIwLCAweGVlOTlkZGJiLCAweGZjODJjYWE2LCAweGYyOGJjN2FkLCAweGQ4YjRlNDljLCAweGQ2YmRlOTk3LCAweGM0YTZmZThhLCAweGNhYWZmMzgxLCAweDkwZDhiOGU4LCAweDllZDFiNWUzLCAweDhjY2FhMmZlLCAweDgyYzNhZmY1LCAweGE4ZmM4Y2M0LCAweGE2ZjU4MWNmLCAweGI0ZWU5NmQyLCAweGJhZTc5YmQ5LCAweGRiM2JiYjdiLCAweGQ1MzJiNjcwLCAweGM3MjlhMTZkLCAweGM5MjBhYzY2LCAweGUzMWY4ZjU3LCAweGVkMTY4MjVjLCAweGZmMGQ5NTQxLCAweGYxMDQ5ODRhLCAweGFiNzNkMzIzLCAweGE1N2FkZTI4LCAweGI3NjFjOTM1LCAweGI5NjhjNDNlLCAweDkzNTdlNzBmLCAweDlkNWVlYTA0LCAweDhmNDVmZDE5LCAweDgxNGNmMDEyLCAweDNiYWI2YmNiLCAweDM1YTI2NmMwLCAweDI3Yjk3MWRkLCAweDI5YjA3Y2Q2LCAweDAzOGY1ZmU3LCAweDBkODY1MmVjLCAweDFmOWQ0NWYxLCAweDExOTQ0OGZhLCAweDRiZTMwMzkzLCAweDQ1ZWEwZTk4LCAweDU3ZjExOTg1LCAweDU5ZjgxNDhlLCAweDczYzczN2JmLCAweDdkY2UzYWI0LCAweDZmZDUyZGE5LCAweDYxZGMyMGEyLCAweGFkNzY2ZGY2LCAweGEzN2Y2MGZkLCAweGIxNjQ3N2UwLCAweGJmNmQ3YWViLCAweDk1NTI1OWRhLCAweDliNWI1NGQxLCAweDg5NDA0M2NjLCAweDg3NDk0ZWM3LCAweGRkM2UwNWFlLCAweGQzMzcwOGE1LCAweGMxMmMxZmI4LCAweGNmMjUxMmIzLCAweGU1MWEzMTgyLCAweGViMTMzYzg5LCAweGY5MDgyYjk0LCAweGY3MDEyNjlmLCAweDRkZTZiZDQ2LCAweDQzZWZiMDRkLCAweDUxZjRhNzUwLCAweDVmZmRhYTViLCAweDc1YzI4OTZhLCAweDdiY2I4NDYxLCAweDY5ZDA5MzdjLCAweDY3ZDk5ZTc3LCAweDNkYWVkNTFlLCAweDMzYTdkODE1LCAweDIxYmNjZjA4LCAweDJmYjVjMjAzLCAweDA1OGFlMTMyLCAweDBiODNlYzM5LCAweDE5OThmYjI0LCAweDE3OTFmNjJmLCAweDc2NGRkNjhkLCAweDc4NDRkYjg2LCAweDZhNWZjYzliLCAweDY0NTZjMTkwLCAweDRlNjllMmExLCAweDQwNjBlZmFhLCAweDUyN2JmOGI3LCAweDVjNzJmNWJjLCAweDA2MDViZWQ1LCAweDA4MGNiM2RlLCAweDFhMTdhNGMzLCAweDE0MWVhOWM4LCAweDNlMjE4YWY5LCAweDMwMjg4N2YyLCAweDIyMzM5MGVmLCAweDJjM2E5ZGU0LCAweDk2ZGQwNjNkLCAweDk4ZDQwYjM2LCAweDhhY2YxYzJiLCAweDg0YzYxMTIwLCAweGFlZjkzMjExLCAweGEwZjAzZjFhLCAweGIyZWIyODA3LCAweGJjZTIyNTBjLCAweGU2OTU2ZTY1LCAweGU4OWM2MzZlLCAweGZhODc3NDczLCAweGY0OGU3OTc4LCAweGRlYjE1YTQ5LCAweGQwYjg1NzQyLCAweGMyYTM0MDVmLCAweGNjYWE0ZDU0LCAweDQxZWNkYWY3LCAweDRmZTVkN2ZjLCAweDVkZmVjMGUxLCAweDUzZjdjZGVhLCAweDc5YzhlZWRiLCAweDc3YzFlM2QwLCAweDY1ZGFmNGNkLCAweDZiZDNmOWM2LCAweDMxYTRiMmFmLCAweDNmYWRiZmE0LCAweDJkYjZhOGI5LCAweDIzYmZhNWIyLCAweDA5ODA4NjgzLCAweDA3ODk4Yjg4LCAweDE1OTI5Yzk1LCAweDFiOWI5MTllLCAweGExN2MwYTQ3LCAweGFmNzUwNzRjLCAweGJkNmUxMDUxLCAweGIzNjcxZDVhLCAweDk5NTgzZTZiLCAweDk3NTEzMzYwLCAweDg1NGEyNDdkLCAweDhiNDMyOTc2LCAweGQxMzQ2MjFmLCAweGRmM2Q2ZjE0LCAweGNkMjY3ODA5LCAweGMzMmY3NTAyLCAweGU5MTA1NjMzLCAweGU3MTk1YjM4LCAweGY1MDI0YzI1LCAweGZiMGI0MTJlLCAweDlhZDc2MThjLCAweDk0ZGU2Yzg3LCAweDg2YzU3YjlhLCAweDg4Y2M3NjkxLCAweGEyZjM1NWEwLCAweGFjZmE1OGFiLCAweGJlZTE0ZmI2LCAweGIwZTg0MmJkLCAweGVhOWYwOWQ0LCAweGU0OTYwNGRmLCAweGY2OGQxM2MyLCAweGY4ODQxZWM5LCAweGQyYmIzZGY4LCAweGRjYjIzMGYzLCAweGNlYTkyN2VlLCAweGMwYTAyYWU1LCAweDdhNDdiMTNjLCAweDc0NGViYzM3LCAweDY2NTVhYjJhLCAweDY4NWNhNjIxLCAweDQyNjM4NTEwLCAweDRjNmE4ODFiLCAweDVlNzE5ZjA2LCAweDUwNzg5MjBkLCAweDBhMGZkOTY0LCAweDA0MDZkNDZmLCAweDE2MWRjMzcyLCAweDE4MTRjZTc5LCAweDMyMmJlZDQ4LCAweDNjMjJlMDQzLCAweDJlMzlmNzVlLCAweDIwMzBmYTU1LCAweGVjOWFiNzAxLCAweGUyOTNiYTBhLCAweGYwODhhZDE3LCAweGZlODFhMDFjLCAweGQ0YmU4MzJkLCAweGRhYjc4ZTI2LCAweGM4YWM5OTNiLCAweGM2YTU5NDMwLCAweDljZDJkZjU5LCAweDkyZGJkMjUyLCAweDgwYzBjNTRmLCAweDhlYzljODQ0LCAweGE0ZjZlYjc1LCAweGFhZmZlNjdlLCAweGI4ZTRmMTYzLCAweGI2ZWRmYzY4LCAweDBjMGE2N2IxLCAweDAyMDM2YWJhLCAweDEwMTg3ZGE3LCAweDFlMTE3MGFjLCAweDM0MmU1MzlkLCAweDNhMjc1ZTk2LCAweDI4M2M0OThiLCAweDI2MzU0NDgwLCAweDdjNDIwZmU5LCAweDcyNGIwMmUyLCAweDYwNTAxNWZmLCAweDZlNTkxOGY0LCAweDQ0NjYzYmM1LCAweDRhNmYzNmNlLCAweDU4NzQyMWQzLCAweDU2N2QyY2Q4LCAweDM3YTEwYzdhLCAweDM5YTgwMTcxLCAweDJiYjMxNjZjLCAweDI1YmExYjY3LCAweDBmODUzODU2LCAweDAxOGMzNTVkLCAweDEzOTcyMjQwLCAweDFkOWUyZjRiLCAweDQ3ZTk2NDIyLCAweDQ5ZTA2OTI5LCAweDViZmI3ZTM0LCAweDU1ZjI3MzNmLCAweDdmY2Q1MDBlLCAweDcxYzQ1ZDA1LCAweDYzZGY0YTE4LCAweDZkZDY0NzEzLCAweGQ3MzFkY2NhLCAweGQ5MzhkMWMxLCAweGNiMjNjNmRjLCAweGM1MmFjYmQ3LCAweGVmMTVlOGU2LCAweGUxMWNlNWVkLCAweGYzMDdmMmYwLCAweGZkMGVmZmZiLCAweGE3NzliNDkyLCAweGE5NzBiOTk5LCAweGJiNmJhZTg0LCAweGI1NjJhMzhmLCAweDlmNWQ4MGJlLCAweDkxNTQ4ZGI1LCAweDgzNGY5YWE4LCAweDhkNDY5N2EzXSk7CiAgX21peENvbCA9IG5ldyBVaW50OEFycmF5KDI1NikubWFwKChfLCBpKSA9PiBpIDwgMTI4ID8gaSA8PCAxIDogaSA8PCAxIF4gMHgxYik7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLmJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgIHRoaXMuYnVmZmVyUG9zaXRpb24gPSAwOwogIH0KICBfZXhwYW5kS2V5KGNpcGhlcktleSkgewogICAgdW5yZWFjaGFibGUoIkNhbm5vdCBjYWxsIGBfZXhwYW5kS2V5YCBvbiB0aGUgYmFzZSBjbGFzcyIpOwogIH0KICBfZGVjcnlwdChpbnB1dCwga2V5KSB7CiAgICBsZXQgdCwgdSwgdjsKICAgIGNvbnN0IHN0YXRlID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgc3RhdGUuc2V0KGlucHV0KTsKICAgIGZvciAobGV0IGogPSAwLCBrID0gdGhpcy5fa2V5U2l6ZTsgaiA8IDE2OyArK2osICsraykgewogICAgICBzdGF0ZVtqXSBePSBrZXlba107CiAgICB9CiAgICBmb3IgKGxldCBpID0gdGhpcy5fY3ljbGVzT2ZSZXBldGl0aW9uIC0gMTsgaSA+PSAxOyAtLWkpIHsKICAgICAgdCA9IHN0YXRlWzEzXTsKICAgICAgc3RhdGVbMTNdID0gc3RhdGVbOV07CiAgICAgIHN0YXRlWzldID0gc3RhdGVbNV07CiAgICAgIHN0YXRlWzVdID0gc3RhdGVbMV07CiAgICAgIHN0YXRlWzFdID0gdDsKICAgICAgdCA9IHN0YXRlWzE0XTsKICAgICAgdSA9IHN0YXRlWzEwXTsKICAgICAgc3RhdGVbMTRdID0gc3RhdGVbNl07CiAgICAgIHN0YXRlWzEwXSA9IHN0YXRlWzJdOwogICAgICBzdGF0ZVs2XSA9IHQ7CiAgICAgIHN0YXRlWzJdID0gdTsKICAgICAgdCA9IHN0YXRlWzE1XTsKICAgICAgdSA9IHN0YXRlWzExXTsKICAgICAgdiA9IHN0YXRlWzddOwogICAgICBzdGF0ZVsxNV0gPSBzdGF0ZVszXTsKICAgICAgc3RhdGVbMTFdID0gdDsKICAgICAgc3RhdGVbN10gPSB1OwogICAgICBzdGF0ZVszXSA9IHY7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTY7ICsraikgewogICAgICAgIHN0YXRlW2pdID0gdGhpcy5faW52X3Nbc3RhdGVbal1dOwogICAgICB9CiAgICAgIGZvciAobGV0IGogPSAwLCBrID0gaSAqIDE2OyBqIDwgMTY7ICsraiwgKytrKSB7CiAgICAgICAgc3RhdGVbal0gXj0ga2V5W2tdOwogICAgICB9CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTY7IGogKz0gNCkgewogICAgICAgIGNvbnN0IHMwID0gdGhpcy5fbWl4W3N0YXRlW2pdXTsKICAgICAgICBjb25zdCBzMSA9IHRoaXMuX21peFtzdGF0ZVtqICsgMV1dOwogICAgICAgIGNvbnN0IHMyID0gdGhpcy5fbWl4W3N0YXRlW2ogKyAyXV07CiAgICAgICAgY29uc3QgczMgPSB0aGlzLl9taXhbc3RhdGVbaiArIDNdXTsKICAgICAgICB0ID0gczAgXiBzMSA+Pj4gOCBeIHMxIDw8IDI0IF4gczIgPj4+IDE2IF4gczIgPDwgMTYgXiBzMyA+Pj4gMjQgXiBzMyA8PCA4OwogICAgICAgIHN0YXRlW2pdID0gdCA+Pj4gMjQgJiAweGZmOwogICAgICAgIHN0YXRlW2ogKyAxXSA9IHQgPj4gMTYgJiAweGZmOwogICAgICAgIHN0YXRlW2ogKyAyXSA9IHQgPj4gOCAmIDB4ZmY7CiAgICAgICAgc3RhdGVbaiArIDNdID0gdCAmIDB4ZmY7CiAgICAgIH0KICAgIH0KICAgIHQgPSBzdGF0ZVsxM107CiAgICBzdGF0ZVsxM10gPSBzdGF0ZVs5XTsKICAgIHN0YXRlWzldID0gc3RhdGVbNV07CiAgICBzdGF0ZVs1XSA9IHN0YXRlWzFdOwogICAgc3RhdGVbMV0gPSB0OwogICAgdCA9IHN0YXRlWzE0XTsKICAgIHUgPSBzdGF0ZVsxMF07CiAgICBzdGF0ZVsxNF0gPSBzdGF0ZVs2XTsKICAgIHN0YXRlWzEwXSA9IHN0YXRlWzJdOwogICAgc3RhdGVbNl0gPSB0OwogICAgc3RhdGVbMl0gPSB1OwogICAgdCA9IHN0YXRlWzE1XTsKICAgIHUgPSBzdGF0ZVsxMV07CiAgICB2ID0gc3RhdGVbN107CiAgICBzdGF0ZVsxNV0gPSBzdGF0ZVszXTsKICAgIHN0YXRlWzExXSA9IHQ7CiAgICBzdGF0ZVs3XSA9IHU7CiAgICBzdGF0ZVszXSA9IHY7CiAgICBmb3IgKGxldCBqID0gMDsgaiA8IDE2OyArK2opIHsKICAgICAgc3RhdGVbal0gPSB0aGlzLl9pbnZfc1tzdGF0ZVtqXV07CiAgICAgIHN0YXRlW2pdIF49IGtleVtqXTsKICAgIH0KICAgIHJldHVybiBzdGF0ZTsKICB9CiAgX2VuY3J5cHQoaW5wdXQsIGtleSkgewogICAgY29uc3QgcyA9IHRoaXMuX3M7CiAgICBsZXQgdCwgdSwgdjsKICAgIGNvbnN0IHN0YXRlID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgc3RhdGUuc2V0KGlucHV0KTsKICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTY7ICsraikgewogICAgICBzdGF0ZVtqXSBePSBrZXlbal07CiAgICB9CiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMuX2N5Y2xlc09mUmVwZXRpdGlvbjsgaSsrKSB7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTY7ICsraikgewogICAgICAgIHN0YXRlW2pdID0gc1tzdGF0ZVtqXV07CiAgICAgIH0KICAgICAgdiA9IHN0YXRlWzFdOwogICAgICBzdGF0ZVsxXSA9IHN0YXRlWzVdOwogICAgICBzdGF0ZVs1XSA9IHN0YXRlWzldOwogICAgICBzdGF0ZVs5XSA9IHN0YXRlWzEzXTsKICAgICAgc3RhdGVbMTNdID0gdjsKICAgICAgdiA9IHN0YXRlWzJdOwogICAgICB1ID0gc3RhdGVbNl07CiAgICAgIHN0YXRlWzJdID0gc3RhdGVbMTBdOwogICAgICBzdGF0ZVs2XSA9IHN0YXRlWzE0XTsKICAgICAgc3RhdGVbMTBdID0gdjsKICAgICAgc3RhdGVbMTRdID0gdTsKICAgICAgdiA9IHN0YXRlWzNdOwogICAgICB1ID0gc3RhdGVbN107CiAgICAgIHQgPSBzdGF0ZVsxMV07CiAgICAgIHN0YXRlWzNdID0gc3RhdGVbMTVdOwogICAgICBzdGF0ZVs3XSA9IHY7CiAgICAgIHN0YXRlWzExXSA9IHU7CiAgICAgIHN0YXRlWzE1XSA9IHQ7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTY7IGogKz0gNCkgewogICAgICAgIGNvbnN0IHMwID0gc3RhdGVbal07CiAgICAgICAgY29uc3QgczEgPSBzdGF0ZVtqICsgMV07CiAgICAgICAgY29uc3QgczIgPSBzdGF0ZVtqICsgMl07CiAgICAgICAgY29uc3QgczMgPSBzdGF0ZVtqICsgM107CiAgICAgICAgdCA9IHMwIF4gczEgXiBzMiBeIHMzOwogICAgICAgIHN0YXRlW2pdIF49IHQgXiB0aGlzLl9taXhDb2xbczAgXiBzMV07CiAgICAgICAgc3RhdGVbaiArIDFdIF49IHQgXiB0aGlzLl9taXhDb2xbczEgXiBzMl07CiAgICAgICAgc3RhdGVbaiArIDJdIF49IHQgXiB0aGlzLl9taXhDb2xbczIgXiBzM107CiAgICAgICAgc3RhdGVbaiArIDNdIF49IHQgXiB0aGlzLl9taXhDb2xbczMgXiBzMF07CiAgICAgIH0KICAgICAgZm9yIChsZXQgaiA9IDAsIGsgPSBpICogMTY7IGogPCAxNjsgKytqLCArK2spIHsKICAgICAgICBzdGF0ZVtqXSBePSBrZXlba107CiAgICAgIH0KICAgIH0KICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTY7ICsraikgewogICAgICBzdGF0ZVtqXSA9IHNbc3RhdGVbal1dOwogICAgfQogICAgdiA9IHN0YXRlWzFdOwogICAgc3RhdGVbMV0gPSBzdGF0ZVs1XTsKICAgIHN0YXRlWzVdID0gc3RhdGVbOV07CiAgICBzdGF0ZVs5XSA9IHN0YXRlWzEzXTsKICAgIHN0YXRlWzEzXSA9IHY7CiAgICB2ID0gc3RhdGVbMl07CiAgICB1ID0gc3RhdGVbNl07CiAgICBzdGF0ZVsyXSA9IHN0YXRlWzEwXTsKICAgIHN0YXRlWzZdID0gc3RhdGVbMTRdOwogICAgc3RhdGVbMTBdID0gdjsKICAgIHN0YXRlWzE0XSA9IHU7CiAgICB2ID0gc3RhdGVbM107CiAgICB1ID0gc3RhdGVbN107CiAgICB0ID0gc3RhdGVbMTFdOwogICAgc3RhdGVbM10gPSBzdGF0ZVsxNV07CiAgICBzdGF0ZVs3XSA9IHY7CiAgICBzdGF0ZVsxMV0gPSB1OwogICAgc3RhdGVbMTVdID0gdDsKICAgIGZvciAobGV0IGogPSAwLCBrID0gdGhpcy5fa2V5U2l6ZTsgaiA8IDE2OyArK2osICsraykgewogICAgICBzdGF0ZVtqXSBePSBrZXlba107CiAgICB9CiAgICByZXR1cm4gc3RhdGU7CiAgfQogIF9kZWNyeXB0QmxvY2syKGRhdGEsIGZpbmFsaXplKSB7CiAgICBjb25zdCBzb3VyY2VMZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgIGxldCBidWZmZXIgPSB0aGlzLmJ1ZmZlciwKICAgICAgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJQb3NpdGlvbjsKICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgbGV0IGl2ID0gdGhpcy5pdjsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc291cmNlTGVuZ3RoOyArK2kpIHsKICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aF0gPSBkYXRhW2ldOwogICAgICArK2J1ZmZlckxlbmd0aDsKICAgICAgaWYgKGJ1ZmZlckxlbmd0aCA8IDE2KSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgcGxhaW4gPSB0aGlzLl9kZWNyeXB0KGJ1ZmZlciwgdGhpcy5fa2V5KTsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgICAgcGxhaW5bal0gXj0gaXZbal07CiAgICAgIH0KICAgICAgaXYgPSBidWZmZXI7CiAgICAgIHJlc3VsdC5wdXNoKHBsYWluKTsKICAgICAgYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgICBidWZmZXJMZW5ndGggPSAwOwogICAgfQogICAgdGhpcy5idWZmZXIgPSBidWZmZXI7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IGJ1ZmZlckxlbmd0aDsKICAgIHRoaXMuaXYgPSBpdjsKICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSgwKTsKICAgIH0KICAgIGxldCBvdXRwdXRMZW5ndGggPSAxNiAqIHJlc3VsdC5sZW5ndGg7CiAgICBpZiAoZmluYWxpemUpIHsKICAgICAgY29uc3QgbGFzdEJsb2NrID0gcmVzdWx0LmF0KC0xKTsKICAgICAgbGV0IHBzTGVuID0gbGFzdEJsb2NrWzE1XTsKICAgICAgaWYgKHBzTGVuIDw9IDE2KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE1LCBpaSA9IDE2IC0gcHNMZW47IGkgPj0gaWk7IC0taSkgewogICAgICAgICAgaWYgKGxhc3RCbG9ja1tpXSAhPT0gcHNMZW4pIHsKICAgICAgICAgICAgcHNMZW4gPSAwOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgb3V0cHV0TGVuZ3RoIC09IHBzTGVuOwogICAgICAgIHJlc3VsdFtyZXN1bHQubGVuZ3RoIC0gMV0gPSBsYXN0QmxvY2suc3ViYXJyYXkoMCwgMTYgLSBwc0xlbik7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IG91dHB1dCA9IG5ldyBVaW50OEFycmF5KG91dHB1dExlbmd0aCk7CiAgICBmb3IgKGxldCBpID0gMCwgaiA9IDAsIGlpID0gcmVzdWx0Lmxlbmd0aDsgaSA8IGlpOyArK2ksIGogKz0gMTYpIHsKICAgICAgb3V0cHV0LnNldChyZXN1bHRbaV0sIGopOwogICAgfQogICAgcmV0dXJuIG91dHB1dDsKICB9CiAgZGVjcnlwdEJsb2NrKGRhdGEsIGZpbmFsaXplLCBpdiA9IG51bGwpIHsKICAgIGNvbnN0IHNvdXJjZUxlbmd0aCA9IGRhdGEubGVuZ3RoOwogICAgY29uc3QgYnVmZmVyID0gdGhpcy5idWZmZXI7CiAgICBsZXQgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJQb3NpdGlvbjsKICAgIGlmIChpdikgewogICAgICB0aGlzLml2ID0gaXY7CiAgICB9IGVsc2UgewogICAgICBmb3IgKGxldCBpID0gMDsgYnVmZmVyTGVuZ3RoIDwgMTYgJiYgaSA8IHNvdXJjZUxlbmd0aDsgKytpLCArK2J1ZmZlckxlbmd0aCkgewogICAgICAgIGJ1ZmZlcltidWZmZXJMZW5ndGhdID0gZGF0YVtpXTsKICAgICAgfQogICAgICBpZiAoYnVmZmVyTGVuZ3RoIDwgMTYpIHsKICAgICAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IGJ1ZmZlckxlbmd0aDsKICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoMCk7CiAgICAgIH0KICAgICAgdGhpcy5pdiA9IGJ1ZmZlcjsKICAgICAgZGF0YSA9IGRhdGEuc3ViYXJyYXkoMTYpOwogICAgfQogICAgdGhpcy5idWZmZXIgPSBuZXcgVWludDhBcnJheSgxNik7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IDA7CiAgICB0aGlzLmRlY3J5cHRCbG9jayA9IHRoaXMuX2RlY3J5cHRCbG9jazI7CiAgICByZXR1cm4gdGhpcy5kZWNyeXB0QmxvY2soZGF0YSwgZmluYWxpemUpOwogIH0KICBlbmNyeXB0KGRhdGEsIGl2KSB7CiAgICBjb25zdCBzb3VyY2VMZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgIGxldCBidWZmZXIgPSB0aGlzLmJ1ZmZlciwKICAgICAgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJQb3NpdGlvbjsKICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgaXYgfHw9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc291cmNlTGVuZ3RoOyArK2kpIHsKICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aF0gPSBkYXRhW2ldOwogICAgICArK2J1ZmZlckxlbmd0aDsKICAgICAgaWYgKGJ1ZmZlckxlbmd0aCA8IDE2KSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgICAgYnVmZmVyW2pdIF49IGl2W2pdOwogICAgICB9CiAgICAgIGNvbnN0IGNpcGhlciA9IHRoaXMuX2VuY3J5cHQoYnVmZmVyLCB0aGlzLl9rZXkpOwogICAgICBpdiA9IGNpcGhlcjsKICAgICAgcmVzdWx0LnB1c2goY2lwaGVyKTsKICAgICAgYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgICBidWZmZXJMZW5ndGggPSAwOwogICAgfQogICAgdGhpcy5idWZmZXIgPSBidWZmZXI7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IGJ1ZmZlckxlbmd0aDsKICAgIHRoaXMuaXYgPSBpdjsKICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSgwKTsKICAgIH0KICAgIGNvbnN0IG91dHB1dExlbmd0aCA9IDE2ICogcmVzdWx0Lmxlbmd0aDsKICAgIGNvbnN0IG91dHB1dCA9IG5ldyBVaW50OEFycmF5KG91dHB1dExlbmd0aCk7CiAgICBmb3IgKGxldCBpID0gMCwgaiA9IDAsIGlpID0gcmVzdWx0Lmxlbmd0aDsgaSA8IGlpOyArK2ksIGogKz0gMTYpIHsKICAgICAgb3V0cHV0LnNldChyZXN1bHRbaV0sIGopOwogICAgfQogICAgcmV0dXJuIG91dHB1dDsKICB9Cn0KY2xhc3MgQUVTMTI4Q2lwaGVyIGV4dGVuZHMgQUVTQmFzZUNpcGhlciB7CiAgX3Jjb24gPSBuZXcgVWludDhBcnJheShbMHg4ZCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNiwgMHg2YywgMHhkOCwgMHhhYiwgMHg0ZCwgMHg5YSwgMHgyZiwgMHg1ZSwgMHhiYywgMHg2MywgMHhjNiwgMHg5NywgMHgzNSwgMHg2YSwgMHhkNCwgMHhiMywgMHg3ZCwgMHhmYSwgMHhlZiwgMHhjNSwgMHg5MSwgMHgzOSwgMHg3MiwgMHhlNCwgMHhkMywgMHhiZCwgMHg2MSwgMHhjMiwgMHg5ZiwgMHgyNSwgMHg0YSwgMHg5NCwgMHgzMywgMHg2NiwgMHhjYywgMHg4MywgMHgxZCwgMHgzYSwgMHg3NCwgMHhlOCwgMHhjYiwgMHg4ZF0pOwogIGNvbnN0cnVjdG9yKGtleSkgewogICAgc3VwZXIoKTsKICAgIHRoaXMuX2N5Y2xlc09mUmVwZXRpdGlvbiA9IDEwOwogICAgdGhpcy5fa2V5U2l6ZSA9IDE2MDsKICAgIHRoaXMuX2tleSA9IHRoaXMuX2V4cGFuZEtleShrZXkpOwogIH0KICBfZXhwYW5kS2V5KGNpcGhlcktleSkgewogICAgY29uc3QgYiA9IDE3NjsKICAgIGNvbnN0IHMgPSB0aGlzLl9zOwogICAgY29uc3QgcmNvbiA9IHRoaXMuX3Jjb247CiAgICBjb25zdCByZXN1bHQgPSBuZXcgVWludDhBcnJheShiKTsKICAgIHJlc3VsdC5zZXQoY2lwaGVyS2V5KTsKICAgIGZvciAobGV0IGogPSAxNiwgaSA9IDE7IGogPCBiOyArK2kpIHsKICAgICAgbGV0IHQxID0gcmVzdWx0W2ogLSAzXTsKICAgICAgbGV0IHQyID0gcmVzdWx0W2ogLSAyXTsKICAgICAgbGV0IHQzID0gcmVzdWx0W2ogLSAxXTsKICAgICAgbGV0IHQ0ID0gcmVzdWx0W2ogLSA0XTsKICAgICAgdDEgPSBzW3QxXTsKICAgICAgdDIgPSBzW3QyXTsKICAgICAgdDMgPSBzW3QzXTsKICAgICAgdDQgPSBzW3Q0XTsKICAgICAgdDEgXj0gcmNvbltpXTsKICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCA0OyArK24pIHsKICAgICAgICByZXN1bHRbal0gPSB0MSBePSByZXN1bHRbaiAtIDE2XTsKICAgICAgICBqKys7CiAgICAgICAgcmVzdWx0W2pdID0gdDIgXj0gcmVzdWx0W2ogLSAxNl07CiAgICAgICAgaisrOwogICAgICAgIHJlc3VsdFtqXSA9IHQzIF49IHJlc3VsdFtqIC0gMTZdOwogICAgICAgIGorKzsKICAgICAgICByZXN1bHRbal0gPSB0NCBePSByZXN1bHRbaiAtIDE2XTsKICAgICAgICBqKys7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQp9CmNsYXNzIEFFUzI1NkNpcGhlciBleHRlbmRzIEFFU0Jhc2VDaXBoZXIgewogIGNvbnN0cnVjdG9yKGtleSkgewogICAgc3VwZXIoKTsKICAgIHRoaXMuX2N5Y2xlc09mUmVwZXRpdGlvbiA9IDE0OwogICAgdGhpcy5fa2V5U2l6ZSA9IDIyNDsKICAgIHRoaXMuX2tleSA9IHRoaXMuX2V4cGFuZEtleShrZXkpOwogIH0KICBfZXhwYW5kS2V5KGNpcGhlcktleSkgewogICAgY29uc3QgYiA9IDI0MDsKICAgIGNvbnN0IHMgPSB0aGlzLl9zOwogICAgY29uc3QgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkoYik7CiAgICByZXN1bHQuc2V0KGNpcGhlcktleSk7CiAgICBsZXQgciA9IDE7CiAgICBsZXQgdDEsIHQyLCB0MywgdDQ7CiAgICBmb3IgKGxldCBqID0gMzIsIGkgPSAxOyBqIDwgYjsgKytpKSB7CiAgICAgIGlmIChqICUgMzIgPT09IDE2KSB7CiAgICAgICAgdDEgPSBzW3QxXTsKICAgICAgICB0MiA9IHNbdDJdOwogICAgICAgIHQzID0gc1t0M107CiAgICAgICAgdDQgPSBzW3Q0XTsKICAgICAgfSBlbHNlIGlmIChqICUgMzIgPT09IDApIHsKICAgICAgICB0MSA9IHJlc3VsdFtqIC0gM107CiAgICAgICAgdDIgPSByZXN1bHRbaiAtIDJdOwogICAgICAgIHQzID0gcmVzdWx0W2ogLSAxXTsKICAgICAgICB0NCA9IHJlc3VsdFtqIC0gNF07CiAgICAgICAgdDEgPSBzW3QxXTsKICAgICAgICB0MiA9IHNbdDJdOwogICAgICAgIHQzID0gc1t0M107CiAgICAgICAgdDQgPSBzW3Q0XTsKICAgICAgICB0MSBePSByOwogICAgICAgIGlmICgociA8PD0gMSkgPj0gMjU2KSB7CiAgICAgICAgICByID0gKHIgXiAweDFiKSAmIDB4ZmY7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgNDsgKytuKSB7CiAgICAgICAgcmVzdWx0W2pdID0gdDEgXj0gcmVzdWx0W2ogLSAzMl07CiAgICAgICAgaisrOwogICAgICAgIHJlc3VsdFtqXSA9IHQyIF49IHJlc3VsdFtqIC0gMzJdOwogICAgICAgIGorKzsKICAgICAgICByZXN1bHRbal0gPSB0MyBePSByZXN1bHRbaiAtIDMyXTsKICAgICAgICBqKys7CiAgICAgICAgcmVzdWx0W2pdID0gdDQgXj0gcmVzdWx0W2ogLSAzMl07CiAgICAgICAgaisrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KfQpjbGFzcyBQREZCYXNlIHsKICBfaGFzaChwYXNzd29yZCwgaW5wdXQsIHVzZXJCeXRlcykgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgX2hhc2hgIGNhbGxlZCIpOwogIH0KICBjaGVja093bmVyUGFzc3dvcmQocGFzc3dvcmQsIG93bmVyVmFsaWRhdGlvblNhbHQsIHVzZXJCeXRlcywgb3duZXJQYXNzd29yZCkgewogICAgY29uc3QgaGFzaERhdGEgPSBuZXcgVWludDhBcnJheShwYXNzd29yZC5sZW5ndGggKyA1Nik7CiAgICBoYXNoRGF0YS5zZXQocGFzc3dvcmQsIDApOwogICAgaGFzaERhdGEuc2V0KG93bmVyVmFsaWRhdGlvblNhbHQsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICBoYXNoRGF0YS5zZXQodXNlckJ5dGVzLCBwYXNzd29yZC5sZW5ndGggKyBvd25lclZhbGlkYXRpb25TYWx0Lmxlbmd0aCk7CiAgICBjb25zdCByZXN1bHQgPSB0aGlzLl9oYXNoKHBhc3N3b3JkLCBoYXNoRGF0YSwgdXNlckJ5dGVzKTsKICAgIHJldHVybiBpc0FycmF5RXF1YWwocmVzdWx0LCBvd25lclBhc3N3b3JkKTsKICB9CiAgY2hlY2tVc2VyUGFzc3dvcmQocGFzc3dvcmQsIHVzZXJWYWxpZGF0aW9uU2FsdCwgdXNlclBhc3N3b3JkKSB7CiAgICBjb25zdCBoYXNoRGF0YSA9IG5ldyBVaW50OEFycmF5KHBhc3N3b3JkLmxlbmd0aCArIDgpOwogICAgaGFzaERhdGEuc2V0KHBhc3N3b3JkLCAwKTsKICAgIGhhc2hEYXRhLnNldCh1c2VyVmFsaWRhdGlvblNhbHQsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICBjb25zdCByZXN1bHQgPSB0aGlzLl9oYXNoKHBhc3N3b3JkLCBoYXNoRGF0YSwgW10pOwogICAgcmV0dXJuIGlzQXJyYXlFcXVhbChyZXN1bHQsIHVzZXJQYXNzd29yZCk7CiAgfQogIGdldE93bmVyS2V5KHBhc3N3b3JkLCBvd25lcktleVNhbHQsIHVzZXJCeXRlcywgb3duZXJFbmNyeXB0aW9uKSB7CiAgICBjb25zdCBoYXNoRGF0YSA9IG5ldyBVaW50OEFycmF5KHBhc3N3b3JkLmxlbmd0aCArIDU2KTsKICAgIGhhc2hEYXRhLnNldChwYXNzd29yZCwgMCk7CiAgICBoYXNoRGF0YS5zZXQob3duZXJLZXlTYWx0LCBwYXNzd29yZC5sZW5ndGgpOwogICAgaGFzaERhdGEuc2V0KHVzZXJCeXRlcywgcGFzc3dvcmQubGVuZ3RoICsgb3duZXJLZXlTYWx0Lmxlbmd0aCk7CiAgICBjb25zdCBrZXkgPSB0aGlzLl9oYXNoKHBhc3N3b3JkLCBoYXNoRGF0YSwgdXNlckJ5dGVzKTsKICAgIGNvbnN0IGNpcGhlciA9IG5ldyBBRVMyNTZDaXBoZXIoa2V5KTsKICAgIHJldHVybiBjaXBoZXIuZGVjcnlwdEJsb2NrKG93bmVyRW5jcnlwdGlvbiwgZmFsc2UsIG5ldyBVaW50OEFycmF5KDE2KSk7CiAgfQogIGdldFVzZXJLZXkocGFzc3dvcmQsIHVzZXJLZXlTYWx0LCB1c2VyRW5jcnlwdGlvbikgewogICAgY29uc3QgaGFzaERhdGEgPSBuZXcgVWludDhBcnJheShwYXNzd29yZC5sZW5ndGggKyA4KTsKICAgIGhhc2hEYXRhLnNldChwYXNzd29yZCwgMCk7CiAgICBoYXNoRGF0YS5zZXQodXNlcktleVNhbHQsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICBjb25zdCBrZXkgPSB0aGlzLl9oYXNoKHBhc3N3b3JkLCBoYXNoRGF0YSwgW10pOwogICAgY29uc3QgY2lwaGVyID0gbmV3IEFFUzI1NkNpcGhlcihrZXkpOwogICAgcmV0dXJuIGNpcGhlci5kZWNyeXB0QmxvY2sodXNlckVuY3J5cHRpb24sIGZhbHNlLCBuZXcgVWludDhBcnJheSgxNikpOwogIH0KfQpjbGFzcyBQREYxNyBleHRlbmRzIFBERkJhc2UgewogIF9oYXNoKHBhc3N3b3JkLCBpbnB1dCwgdXNlckJ5dGVzKSB7CiAgICByZXR1cm4gY2FsY3VsYXRlU0hBMjU2KGlucHV0LCAwLCBpbnB1dC5sZW5ndGgpOwogIH0KfQpjbGFzcyBQREYyMCBleHRlbmRzIFBERkJhc2UgewogIF9oYXNoKHBhc3N3b3JkLCBpbnB1dCwgdXNlckJ5dGVzKSB7CiAgICBsZXQgayA9IGNhbGN1bGF0ZVNIQTI1NihpbnB1dCwgMCwgaW5wdXQubGVuZ3RoKS5zdWJhcnJheSgwLCAzMik7CiAgICBsZXQgZSA9IFswXTsKICAgIGxldCBpID0gMDsKICAgIHdoaWxlIChpIDwgNjQgfHwgZS5hdCgtMSkgPiBpIC0gMzIpIHsKICAgICAgY29uc3QgY29tYmluZWRMZW5ndGggPSBwYXNzd29yZC5sZW5ndGggKyBrLmxlbmd0aCArIHVzZXJCeXRlcy5sZW5ndGgsCiAgICAgICAgY29tYmluZWRBcnJheSA9IG5ldyBVaW50OEFycmF5KGNvbWJpbmVkTGVuZ3RoKTsKICAgICAgbGV0IHdyaXRlT2Zmc2V0ID0gMDsKICAgICAgY29tYmluZWRBcnJheS5zZXQocGFzc3dvcmQsIHdyaXRlT2Zmc2V0KTsKICAgICAgd3JpdGVPZmZzZXQgKz0gcGFzc3dvcmQubGVuZ3RoOwogICAgICBjb21iaW5lZEFycmF5LnNldChrLCB3cml0ZU9mZnNldCk7CiAgICAgIHdyaXRlT2Zmc2V0ICs9IGsubGVuZ3RoOwogICAgICBjb21iaW5lZEFycmF5LnNldCh1c2VyQnl0ZXMsIHdyaXRlT2Zmc2V0KTsKICAgICAgY29uc3QgazEgPSBuZXcgVWludDhBcnJheShjb21iaW5lZExlbmd0aCAqIDY0KTsKICAgICAgZm9yIChsZXQgaiA9IDAsIHBvcyA9IDA7IGogPCA2NDsgaisrLCBwb3MgKz0gY29tYmluZWRMZW5ndGgpIHsKICAgICAgICBrMS5zZXQoY29tYmluZWRBcnJheSwgcG9zKTsKICAgICAgfQogICAgICBjb25zdCBjaXBoZXIgPSBuZXcgQUVTMTI4Q2lwaGVyKGsuc3ViYXJyYXkoMCwgMTYpKTsKICAgICAgZSA9IGNpcGhlci5lbmNyeXB0KGsxLCBrLnN1YmFycmF5KDE2LCAzMikpOwogICAgICBjb25zdCByZW1haW5kZXIgPSBNYXRoLnN1bVByZWNpc2UoZS5zbGljZSgwLCAxNikpICUgMzsKICAgICAgaWYgKHJlbWFpbmRlciA9PT0gMCkgewogICAgICAgIGsgPSBjYWxjdWxhdGVTSEEyNTYoZSwgMCwgZS5sZW5ndGgpOwogICAgICB9IGVsc2UgaWYgKHJlbWFpbmRlciA9PT0gMSkgewogICAgICAgIGsgPSBjYWxjdWxhdGVTSEEzODQoZSwgMCwgZS5sZW5ndGgpOwogICAgICB9IGVsc2UgaWYgKHJlbWFpbmRlciA9PT0gMikgewogICAgICAgIGsgPSBjYWxjdWxhdGVTSEE1MTIoZSwgMCwgZS5sZW5ndGgpOwogICAgICB9CiAgICAgIGkrKzsKICAgIH0KICAgIHJldHVybiBrLnN1YmFycmF5KDAsIDMyKTsKICB9Cn0KY2xhc3MgQ2lwaGVyVHJhbnNmb3JtIHsKICBjb25zdHJ1Y3RvcihzdHJpbmdDaXBoZXJDb25zdHJ1Y3Rvciwgc3RyZWFtQ2lwaGVyQ29uc3RydWN0b3IpIHsKICAgIHRoaXMuU3RyaW5nQ2lwaGVyQ29uc3RydWN0b3IgPSBzdHJpbmdDaXBoZXJDb25zdHJ1Y3RvcjsKICAgIHRoaXMuU3RyZWFtQ2lwaGVyQ29uc3RydWN0b3IgPSBzdHJlYW1DaXBoZXJDb25zdHJ1Y3RvcjsKICB9CiAgY3JlYXRlU3RyZWFtKHN0cmVhbSwgbGVuZ3RoKSB7CiAgICBjb25zdCBjaXBoZXIgPSBuZXcgdGhpcy5TdHJlYW1DaXBoZXJDb25zdHJ1Y3RvcigpOwogICAgcmV0dXJuIG5ldyBEZWNyeXB0U3RyZWFtKHN0cmVhbSwgbGVuZ3RoLCBmdW5jdGlvbiBjaXBoZXJUcmFuc2Zvcm1EZWNyeXB0U3RyZWFtKGRhdGEsIGZpbmFsaXplKSB7CiAgICAgIHJldHVybiBjaXBoZXIuZGVjcnlwdEJsb2NrKGRhdGEsIGZpbmFsaXplKTsKICAgIH0pOwogIH0KICBkZWNyeXB0U3RyaW5nKHMpIHsKICAgIGNvbnN0IGNpcGhlciA9IG5ldyB0aGlzLlN0cmluZ0NpcGhlckNvbnN0cnVjdG9yKCk7CiAgICBsZXQgZGF0YSA9IHN0cmluZ1RvQnl0ZXMocyk7CiAgICBkYXRhID0gY2lwaGVyLmRlY3J5cHRCbG9jayhkYXRhLCB0cnVlKTsKICAgIHJldHVybiBieXRlc1RvU3RyaW5nKGRhdGEpOwogIH0KICBlbmNyeXB0U3RyaW5nKHMpIHsKICAgIGNvbnN0IGNpcGhlciA9IG5ldyB0aGlzLlN0cmluZ0NpcGhlckNvbnN0cnVjdG9yKCk7CiAgICBpZiAoY2lwaGVyIGluc3RhbmNlb2YgQUVTQmFzZUNpcGhlcikgewogICAgICBjb25zdCBzdHJMZW4gPSBzLmxlbmd0aDsKICAgICAgY29uc3QgcGFkID0gMTYgLSBzdHJMZW4gJSAxNjsKICAgICAgcyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHBhZCkucmVwZWF0KHBhZCk7CiAgICAgIGNvbnN0IGl2ID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgICBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKGl2KTsKICAgICAgbGV0IGRhdGEgPSBzdHJpbmdUb0J5dGVzKHMpOwogICAgICBkYXRhID0gY2lwaGVyLmVuY3J5cHQoZGF0YSwgaXYpOwogICAgICBjb25zdCBidWYgPSBuZXcgVWludDhBcnJheSgxNiArIGRhdGEubGVuZ3RoKTsKICAgICAgYnVmLnNldChpdik7CiAgICAgIGJ1Zi5zZXQoZGF0YSwgMTYpOwogICAgICByZXR1cm4gYnl0ZXNUb1N0cmluZyhidWYpOwogICAgfQogICAgbGV0IGRhdGEgPSBzdHJpbmdUb0J5dGVzKHMpOwogICAgZGF0YSA9IGNpcGhlci5lbmNyeXB0KGRhdGEpOwogICAgcmV0dXJuIGJ5dGVzVG9TdHJpbmcoZGF0YSk7CiAgfQp9CmNsYXNzIENpcGhlclRyYW5zZm9ybUZhY3RvcnkgewogIHN0YXRpYyBnZXQgX2RlZmF1bHRQYXNzd29yZEJ5dGVzKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiX2RlZmF1bHRQYXNzd29yZEJ5dGVzIiwgbmV3IFVpbnQ4QXJyYXkoWzB4MjgsIDB4YmYsIDB4NGUsIDB4NWUsIDB4NGUsIDB4NzUsIDB4OGEsIDB4NDEsIDB4NjQsIDB4MDAsIDB4NGUsIDB4NTYsIDB4ZmYsIDB4ZmEsIDB4MDEsIDB4MDgsIDB4MmUsIDB4MmUsIDB4MDAsIDB4YjYsIDB4ZDAsIDB4NjgsIDB4M2UsIDB4ODAsIDB4MmYsIDB4MGMsIDB4YTksIDB4ZmUsIDB4NjQsIDB4NTMsIDB4NjksIDB4N2FdKSk7CiAgfQogICNjcmVhdGVFbmNyeXB0aW9uS2V5MjAocmV2aXNpb24sIHBhc3N3b3JkLCBvd25lclBhc3N3b3JkLCBvd25lclZhbGlkYXRpb25TYWx0LCBvd25lcktleVNhbHQsIHVCeXRlcywgdXNlclBhc3N3b3JkLCB1c2VyVmFsaWRhdGlvblNhbHQsIHVzZXJLZXlTYWx0LCBvd25lckVuY3J5cHRpb24sIHVzZXJFbmNyeXB0aW9uLCBwZXJtcykgewogICAgaWYgKHBhc3N3b3JkKSB7CiAgICAgIGNvbnN0IHBhc3N3b3JkTGVuZ3RoID0gTWF0aC5taW4oMTI3LCBwYXNzd29yZC5sZW5ndGgpOwogICAgICBwYXNzd29yZCA9IHBhc3N3b3JkLnN1YmFycmF5KDAsIHBhc3N3b3JkTGVuZ3RoKTsKICAgIH0gZWxzZSB7CiAgICAgIHBhc3N3b3JkID0gW107CiAgICB9CiAgICBjb25zdCBwZGZBbGdvcml0aG0gPSByZXZpc2lvbiA9PT0gNiA/IG5ldyBQREYyMCgpIDogbmV3IFBERjE3KCk7CiAgICBpZiAocGRmQWxnb3JpdGhtLmNoZWNrVXNlclBhc3N3b3JkKHBhc3N3b3JkLCB1c2VyVmFsaWRhdGlvblNhbHQsIHVzZXJQYXNzd29yZCkpIHsKICAgICAgcmV0dXJuIHBkZkFsZ29yaXRobS5nZXRVc2VyS2V5KHBhc3N3b3JkLCB1c2VyS2V5U2FsdCwgdXNlckVuY3J5cHRpb24pOwogICAgfSBlbHNlIGlmIChwYXNzd29yZC5sZW5ndGggJiYgcGRmQWxnb3JpdGhtLmNoZWNrT3duZXJQYXNzd29yZChwYXNzd29yZCwgb3duZXJWYWxpZGF0aW9uU2FsdCwgdUJ5dGVzLCBvd25lclBhc3N3b3JkKSkgewogICAgICByZXR1cm4gcGRmQWxnb3JpdGhtLmdldE93bmVyS2V5KHBhc3N3b3JkLCBvd25lcktleVNhbHQsIHVCeXRlcywgb3duZXJFbmNyeXB0aW9uKTsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICAjcHJlcGFyZUtleURhdGEoZmlsZUlkLCBwYXNzd29yZCwgb3duZXJQYXNzd29yZCwgdXNlclBhc3N3b3JkLCBmbGFncywgcmV2aXNpb24sIGtleUxlbmd0aCwgZW5jcnlwdE1ldGFkYXRhKSB7CiAgICBjb25zdCBoYXNoRGF0YVNpemUgPSA0MCArIG93bmVyUGFzc3dvcmQubGVuZ3RoICsgZmlsZUlkLmxlbmd0aDsKICAgIGNvbnN0IGhhc2hEYXRhID0gbmV3IFVpbnQ4QXJyYXkoaGFzaERhdGFTaXplKTsKICAgIGxldCBpID0gMCwKICAgICAgaiwKICAgICAgbjsKICAgIGlmIChwYXNzd29yZCkgewogICAgICBuID0gTWF0aC5taW4oMzIsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICAgIGZvciAoOyBpIDwgbjsgKytpKSB7CiAgICAgICAgaGFzaERhdGFbaV0gPSBwYXNzd29yZFtpXTsKICAgICAgfQogICAgfQogICAgaiA9IDA7CiAgICB3aGlsZSAoaSA8IDMyKSB7CiAgICAgIGhhc2hEYXRhW2krK10gPSBDaXBoZXJUcmFuc2Zvcm1GYWN0b3J5Ll9kZWZhdWx0UGFzc3dvcmRCeXRlc1tqKytdOwogICAgfQogICAgaGFzaERhdGEuc2V0KG93bmVyUGFzc3dvcmQsIGkpOwogICAgaSArPSBvd25lclBhc3N3b3JkLmxlbmd0aDsKICAgIGhhc2hEYXRhW2krK10gPSBmbGFncyAmIDB4ZmY7CiAgICBoYXNoRGF0YVtpKytdID0gZmxhZ3MgPj4gOCAmIDB4ZmY7CiAgICBoYXNoRGF0YVtpKytdID0gZmxhZ3MgPj4gMTYgJiAweGZmOwogICAgaGFzaERhdGFbaSsrXSA9IGZsYWdzID4+PiAyNCAmIDB4ZmY7CiAgICBoYXNoRGF0YS5zZXQoZmlsZUlkLCBpKTsKICAgIGkgKz0gZmlsZUlkLmxlbmd0aDsKICAgIGlmIChyZXZpc2lvbiA+PSA0ICYmICFlbmNyeXB0TWV0YWRhdGEpIHsKICAgICAgaGFzaERhdGEuZmlsbCgweGZmLCBpLCBpICsgNCk7CiAgICAgIGkgKz0gNDsKICAgIH0KICAgIGxldCBoYXNoID0gY2FsY3VsYXRlTUQ1KGhhc2hEYXRhLCAwLCBpKTsKICAgIGNvbnN0IGtleUxlbmd0aEluQnl0ZXMgPSBrZXlMZW5ndGggPj4gMzsKICAgIGlmIChyZXZpc2lvbiA+PSAzKSB7CiAgICAgIGZvciAoaiA9IDA7IGogPCA1MDsgKytqKSB7CiAgICAgICAgaGFzaCA9IGNhbGN1bGF0ZU1ENShoYXNoLCAwLCBrZXlMZW5ndGhJbkJ5dGVzKTsKICAgICAgfQogICAgfQogICAgY29uc3QgZW5jcnlwdGlvbktleSA9IGhhc2guc3ViYXJyYXkoMCwga2V5TGVuZ3RoSW5CeXRlcyk7CiAgICBsZXQgY2lwaGVyLCBjaGVja0RhdGE7CiAgICBpZiAocmV2aXNpb24gPj0gMykgewogICAgICBpID0gMDsKICAgICAgaGFzaERhdGEuc2V0KENpcGhlclRyYW5zZm9ybUZhY3RvcnkuX2RlZmF1bHRQYXNzd29yZEJ5dGVzLCBpKTsKICAgICAgaSArPSAzMjsKICAgICAgaGFzaERhdGEuc2V0KGZpbGVJZCwgaSk7CiAgICAgIGkgKz0gZmlsZUlkLmxlbmd0aDsKICAgICAgY2lwaGVyID0gbmV3IEFSQ0ZvdXJDaXBoZXIoZW5jcnlwdGlvbktleSk7CiAgICAgIGNoZWNrRGF0YSA9IGNpcGhlci5lbmNyeXB0QmxvY2soY2FsY3VsYXRlTUQ1KGhhc2hEYXRhLCAwLCBpKSk7CiAgICAgIG4gPSBlbmNyeXB0aW9uS2V5Lmxlbmd0aDsKICAgICAgY29uc3QgZGVyaXZlZEtleSA9IG5ldyBVaW50OEFycmF5KG4pOwogICAgICBmb3IgKGogPSAxOyBqIDw9IDE5OyArK2opIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IG47ICsraykgewogICAgICAgICAgZGVyaXZlZEtleVtrXSA9IGVuY3J5cHRpb25LZXlba10gXiBqOwogICAgICAgIH0KICAgICAgICBjaXBoZXIgPSBuZXcgQVJDRm91ckNpcGhlcihkZXJpdmVkS2V5KTsKICAgICAgICBjaGVja0RhdGEgPSBjaXBoZXIuZW5jcnlwdEJsb2NrKGNoZWNrRGF0YSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNpcGhlciA9IG5ldyBBUkNGb3VyQ2lwaGVyKGVuY3J5cHRpb25LZXkpOwogICAgICBjaGVja0RhdGEgPSBjaXBoZXIuZW5jcnlwdEJsb2NrKENpcGhlclRyYW5zZm9ybUZhY3RvcnkuX2RlZmF1bHRQYXNzd29yZEJ5dGVzKTsKICAgIH0KICAgIHJldHVybiBjaGVja0RhdGEuZXZlcnkoKGRhdGEsIGspID0+IHVzZXJQYXNzd29yZFtrXSA9PT0gZGF0YSkgPyBlbmNyeXB0aW9uS2V5IDogbnVsbDsKICB9CiAgI2RlY29kZVVzZXJQYXNzd29yZChwYXNzd29yZCwgb3duZXJQYXNzd29yZCwgcmV2aXNpb24sIGtleUxlbmd0aCkgewogICAgY29uc3QgaGFzaERhdGEgPSBuZXcgVWludDhBcnJheSgzMik7CiAgICBsZXQgaSA9IDA7CiAgICBjb25zdCBuID0gTWF0aC5taW4oMzIsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICBmb3IgKDsgaSA8IG47ICsraSkgewogICAgICBoYXNoRGF0YVtpXSA9IHBhc3N3b3JkW2ldOwogICAgfQogICAgbGV0IGogPSAwOwogICAgd2hpbGUgKGkgPCAzMikgewogICAgICBoYXNoRGF0YVtpKytdID0gQ2lwaGVyVHJhbnNmb3JtRmFjdG9yeS5fZGVmYXVsdFBhc3N3b3JkQnl0ZXNbaisrXTsKICAgIH0KICAgIGxldCBoYXNoID0gY2FsY3VsYXRlTUQ1KGhhc2hEYXRhLCAwLCBpKTsKICAgIGNvbnN0IGtleUxlbmd0aEluQnl0ZXMgPSBrZXlMZW5ndGggPj4gMzsKICAgIGlmIChyZXZpc2lvbiA+PSAzKSB7CiAgICAgIGZvciAoaiA9IDA7IGogPCA1MDsgKytqKSB7CiAgICAgICAgaGFzaCA9IGNhbGN1bGF0ZU1ENShoYXNoLCAwLCBoYXNoLmxlbmd0aCk7CiAgICAgIH0KICAgIH0KICAgIGxldCBjaXBoZXIsIHVzZXJQYXNzd29yZDsKICAgIGlmIChyZXZpc2lvbiA+PSAzKSB7CiAgICAgIHVzZXJQYXNzd29yZCA9IG93bmVyUGFzc3dvcmQ7CiAgICAgIGNvbnN0IGRlcml2ZWRLZXkgPSBuZXcgVWludDhBcnJheShrZXlMZW5ndGhJbkJ5dGVzKTsKICAgICAgZm9yIChqID0gMTk7IGogPj0gMDsgai0tKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBrZXlMZW5ndGhJbkJ5dGVzOyArK2spIHsKICAgICAgICAgIGRlcml2ZWRLZXlba10gPSBoYXNoW2tdIF4gajsKICAgICAgICB9CiAgICAgICAgY2lwaGVyID0gbmV3IEFSQ0ZvdXJDaXBoZXIoZGVyaXZlZEtleSk7CiAgICAgICAgdXNlclBhc3N3b3JkID0gY2lwaGVyLmVuY3J5cHRCbG9jayh1c2VyUGFzc3dvcmQpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjaXBoZXIgPSBuZXcgQVJDRm91ckNpcGhlcihoYXNoLnN1YmFycmF5KDAsIGtleUxlbmd0aEluQnl0ZXMpKTsKICAgICAgdXNlclBhc3N3b3JkID0gY2lwaGVyLmVuY3J5cHRCbG9jayhvd25lclBhc3N3b3JkKTsKICAgIH0KICAgIHJldHVybiB1c2VyUGFzc3dvcmQ7CiAgfQogICNidWlsZE9iamVjdEtleShudW0sIGdlbiwgZW5jcnlwdGlvbktleSwgaXNBZXMgPSBmYWxzZSkgewogICAgY29uc3QgbiA9IGVuY3J5cHRpb25LZXkubGVuZ3RoOwogICAgY29uc3Qga2V5ID0gbmV3IFVpbnQ4QXJyYXkobiArIDkpOwogICAga2V5LnNldChlbmNyeXB0aW9uS2V5KTsKICAgIGxldCBpID0gbjsKICAgIGtleVtpKytdID0gbnVtICYgMHhmZjsKICAgIGtleVtpKytdID0gbnVtID4+IDggJiAweGZmOwogICAga2V5W2krK10gPSBudW0gPj4gMTYgJiAweGZmOwogICAga2V5W2krK10gPSBnZW4gJiAweGZmOwogICAga2V5W2krK10gPSBnZW4gPj4gOCAmIDB4ZmY7CiAgICBpZiAoaXNBZXMpIHsKICAgICAga2V5W2krK10gPSAweDczOwogICAgICBrZXlbaSsrXSA9IDB4NDE7CiAgICAgIGtleVtpKytdID0gMHg2YzsKICAgICAga2V5W2krK10gPSAweDU0OwogICAgfQogICAgY29uc3QgaGFzaCA9IGNhbGN1bGF0ZU1ENShrZXksIDAsIGkpOwogICAgcmV0dXJuIGhhc2guc3ViYXJyYXkoMCwgTWF0aC5taW4obiArIDUsIDE2KSk7CiAgfQogICNidWlsZENpcGhlckNvbnN0cnVjdG9yKGNmLCBuYW1lLCBudW0sIGdlbiwga2V5KSB7CiAgICBpZiAoIShuYW1lIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJJbnZhbGlkIGNyeXB0IGZpbHRlciBuYW1lLiIpOwogICAgfQogICAgY29uc3Qgc2VsZiA9IHRoaXM7CiAgICBjb25zdCBjcnlwdEZpbHRlciA9IGNmLmdldChuYW1lLm5hbWUpOwogICAgY29uc3QgY2ZtID0gY3J5cHRGaWx0ZXI/LmdldCgiQ0ZNIik7CiAgICBpZiAoIWNmbSB8fCBjZm0ubmFtZSA9PT0gIk5vbmUiKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBOdWxsQ2lwaGVyKCk7CiAgICAgIH07CiAgICB9CiAgICBpZiAoY2ZtLm5hbWUgPT09ICJWMiIpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IEFSQ0ZvdXJDaXBoZXIoc2VsZi4jYnVpbGRPYmplY3RLZXkobnVtLCBnZW4sIGtleSwgZmFsc2UpKTsKICAgICAgfTsKICAgIH0KICAgIGlmIChjZm0ubmFtZSA9PT0gIkFFU1YyIikgewogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgQUVTMTI4Q2lwaGVyKHNlbGYuI2J1aWxkT2JqZWN0S2V5KG51bSwgZ2VuLCBrZXksIHRydWUpKTsKICAgICAgfTsKICAgIH0KICAgIGlmIChjZm0ubmFtZSA9PT0gIkFFU1YzIikgewogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgQUVTMjU2Q2lwaGVyKGtleSk7CiAgICAgIH07CiAgICB9CiAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlVua25vd24gY3J5cHRvIG1ldGhvZCIpOwogIH0KICBjb25zdHJ1Y3RvcihkaWN0LCBmaWxlSWQsIHBhc3N3b3JkKSB7CiAgICBjb25zdCBmaWx0ZXIgPSBkaWN0LmdldCgiRmlsdGVyIik7CiAgICBpZiAoIWlzTmFtZShmaWx0ZXIsICJTdGFuZGFyZCIpKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigidW5rbm93biBlbmNyeXB0aW9uIG1ldGhvZCIpOwogICAgfQogICAgdGhpcy5maWx0ZXJOYW1lID0gZmlsdGVyLm5hbWU7CiAgICB0aGlzLmRpY3QgPSBkaWN0OwogICAgY29uc3QgYWxnb3JpdGhtID0gZGljdC5nZXQoIlYiKTsKICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihhbGdvcml0aG0pIHx8IGFsZ29yaXRobSAhPT0gMSAmJiBhbGdvcml0aG0gIT09IDIgJiYgYWxnb3JpdGhtICE9PSA0ICYmIGFsZ29yaXRobSAhPT0gNSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoInVuc3VwcG9ydGVkIGVuY3J5cHRpb24gYWxnb3JpdGhtIik7CiAgICB9CiAgICB0aGlzLmFsZ29yaXRobSA9IGFsZ29yaXRobTsKICAgIGxldCBrZXlMZW5ndGggPSBkaWN0LmdldCgiTGVuZ3RoIik7CiAgICBpZiAoIWtleUxlbmd0aCkgewogICAgICBpZiAoYWxnb3JpdGhtIDw9IDMpIHsKICAgICAgICBrZXlMZW5ndGggPSA0MDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBjZkRpY3QgPSBkaWN0LmdldCgiQ0YiKTsKICAgICAgICBjb25zdCBzdHJlYW1DcnlwdG9OYW1lID0gZGljdC5nZXQoIlN0bUYiKTsKICAgICAgICBpZiAoY2ZEaWN0IGluc3RhbmNlb2YgRGljdCAmJiBzdHJlYW1DcnlwdG9OYW1lIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgY2ZEaWN0LnN1cHByZXNzRW5jcnlwdGlvbiA9IHRydWU7CiAgICAgICAgICBjb25zdCBoYW5kbGVyRGljdCA9IGNmRGljdC5nZXQoc3RyZWFtQ3J5cHRvTmFtZS5uYW1lKTsKICAgICAgICAgIGtleUxlbmd0aCA9IGhhbmRsZXJEaWN0Py5nZXQoIkxlbmd0aCIpIHx8IDEyODsKICAgICAgICAgIGlmIChrZXlMZW5ndGggPCA0MCkgewogICAgICAgICAgICBrZXlMZW5ndGggPDw9IDM7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoa2V5TGVuZ3RoKSB8fCBrZXlMZW5ndGggPCA0MCB8fCBrZXlMZW5ndGggJSA4ICE9PSAwKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiaW52YWxpZCBrZXkgbGVuZ3RoIik7CiAgICB9CiAgICBjb25zdCBvd25lckJ5dGVzID0gc3RyaW5nVG9CeXRlcyhkaWN0LmdldCgiTyIpKSwKICAgICAgdXNlckJ5dGVzID0gc3RyaW5nVG9CeXRlcyhkaWN0LmdldCgiVSIpKTsKICAgIGNvbnN0IG93bmVyUGFzc3dvcmQgPSBvd25lckJ5dGVzLnN1YmFycmF5KDAsIDMyKTsKICAgIGNvbnN0IHVzZXJQYXNzd29yZCA9IHVzZXJCeXRlcy5zdWJhcnJheSgwLCAzMik7CiAgICBjb25zdCBmbGFncyA9IGRpY3QuZ2V0KCJQIik7CiAgICBjb25zdCByZXZpc2lvbiA9IGRpY3QuZ2V0KCJSIik7CiAgICBjb25zdCBlbmNyeXB0TWV0YWRhdGEgPSAoYWxnb3JpdGhtID09PSA0IHx8IGFsZ29yaXRobSA9PT0gNSkgJiYgZGljdC5nZXQoIkVuY3J5cHRNZXRhZGF0YSIpICE9PSBmYWxzZTsKICAgIHRoaXMuZW5jcnlwdE1ldGFkYXRhID0gZW5jcnlwdE1ldGFkYXRhOwogICAgY29uc3QgZmlsZUlkQnl0ZXMgPSBzdHJpbmdUb0J5dGVzKGZpbGVJZCk7CiAgICBsZXQgcGFzc3dvcmRCeXRlczsKICAgIGlmIChwYXNzd29yZCkgewogICAgICBpZiAocmV2aXNpb24gPT09IDYpIHsKICAgICAgICB0cnkgewogICAgICAgICAgcGFzc3dvcmQgPSB1dGY4U3RyaW5nVG9TdHJpbmcocGFzc3dvcmQpOwogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgd2FybigiQ2lwaGVyVHJhbnNmb3JtRmFjdG9yeTogVW5hYmxlIHRvIGNvbnZlcnQgVVRGOCBlbmNvZGVkIHBhc3N3b3JkLiIpOwogICAgICAgIH0KICAgICAgfQogICAgICBwYXNzd29yZEJ5dGVzID0gc3RyaW5nVG9CeXRlcyhwYXNzd29yZCk7CiAgICB9CiAgICBsZXQgZW5jcnlwdGlvbktleTsKICAgIGlmIChhbGdvcml0aG0gIT09IDUpIHsKICAgICAgZW5jcnlwdGlvbktleSA9IHRoaXMuI3ByZXBhcmVLZXlEYXRhKGZpbGVJZEJ5dGVzLCBwYXNzd29yZEJ5dGVzLCBvd25lclBhc3N3b3JkLCB1c2VyUGFzc3dvcmQsIGZsYWdzLCByZXZpc2lvbiwga2V5TGVuZ3RoLCBlbmNyeXB0TWV0YWRhdGEpOwogICAgfSBlbHNlIHsKICAgICAgY29uc3Qgb3duZXJWYWxpZGF0aW9uU2FsdCA9IG93bmVyQnl0ZXMuc3ViYXJyYXkoMzIsIDQwKTsKICAgICAgY29uc3Qgb3duZXJLZXlTYWx0ID0gb3duZXJCeXRlcy5zdWJhcnJheSg0MCwgNDgpOwogICAgICBjb25zdCB1Qnl0ZXMgPSB1c2VyQnl0ZXMuc3ViYXJyYXkoMCwgNDgpOwogICAgICBjb25zdCB1c2VyVmFsaWRhdGlvblNhbHQgPSB1c2VyQnl0ZXMuc3ViYXJyYXkoMzIsIDQwKTsKICAgICAgY29uc3QgdXNlcktleVNhbHQgPSB1c2VyQnl0ZXMuc3ViYXJyYXkoNDAsIDQ4KTsKICAgICAgY29uc3Qgb3duZXJFbmNyeXB0aW9uID0gc3RyaW5nVG9CeXRlcyhkaWN0LmdldCgiT0UiKSk7CiAgICAgIGNvbnN0IHVzZXJFbmNyeXB0aW9uID0gc3RyaW5nVG9CeXRlcyhkaWN0LmdldCgiVUUiKSk7CiAgICAgIGNvbnN0IHBlcm1zID0gc3RyaW5nVG9CeXRlcyhkaWN0LmdldCgiUGVybXMiKSk7CiAgICAgIGVuY3J5cHRpb25LZXkgPSB0aGlzLiNjcmVhdGVFbmNyeXB0aW9uS2V5MjAocmV2aXNpb24sIHBhc3N3b3JkQnl0ZXMsIG93bmVyUGFzc3dvcmQsIG93bmVyVmFsaWRhdGlvblNhbHQsIG93bmVyS2V5U2FsdCwgdUJ5dGVzLCB1c2VyUGFzc3dvcmQsIHVzZXJWYWxpZGF0aW9uU2FsdCwgdXNlcktleVNhbHQsIG93bmVyRW5jcnlwdGlvbiwgdXNlckVuY3J5cHRpb24sIHBlcm1zKTsKICAgIH0KICAgIGlmICghZW5jcnlwdGlvbktleSkgewogICAgICBpZiAoIXBhc3N3b3JkKSB7CiAgICAgICAgdGhyb3cgbmV3IFBhc3N3b3JkRXhjZXB0aW9uKCJObyBwYXNzd29yZCBnaXZlbiIsIFBhc3N3b3JkUmVzcG9uc2VzLk5FRURfUEFTU1dPUkQpOwogICAgICB9CiAgICAgIGNvbnN0IGRlY29kZWRQYXNzd29yZCA9IHRoaXMuI2RlY29kZVVzZXJQYXNzd29yZChwYXNzd29yZEJ5dGVzLCBvd25lclBhc3N3b3JkLCByZXZpc2lvbiwga2V5TGVuZ3RoKTsKICAgICAgZW5jcnlwdGlvbktleSA9IHRoaXMuI3ByZXBhcmVLZXlEYXRhKGZpbGVJZEJ5dGVzLCBkZWNvZGVkUGFzc3dvcmQsIG93bmVyUGFzc3dvcmQsIHVzZXJQYXNzd29yZCwgZmxhZ3MsIHJldmlzaW9uLCBrZXlMZW5ndGgsIGVuY3J5cHRNZXRhZGF0YSk7CiAgICB9CiAgICBpZiAoIWVuY3J5cHRpb25LZXkpIHsKICAgICAgdGhyb3cgbmV3IFBhc3N3b3JkRXhjZXB0aW9uKCJJbmNvcnJlY3QgUGFzc3dvcmQiLCBQYXNzd29yZFJlc3BvbnNlcy5JTkNPUlJFQ1RfUEFTU1dPUkQpOwogICAgfQogICAgaWYgKGFsZ29yaXRobSA9PT0gNCAmJiBlbmNyeXB0aW9uS2V5Lmxlbmd0aCA8IDE2KSB7CiAgICAgIHRoaXMuZW5jcnlwdGlvbktleSA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgICAgdGhpcy5lbmNyeXB0aW9uS2V5LnNldChlbmNyeXB0aW9uS2V5KTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZW5jcnlwdGlvbktleSA9IGVuY3J5cHRpb25LZXk7CiAgICB9CiAgICBpZiAoYWxnb3JpdGhtID49IDQpIHsKICAgICAgY29uc3QgY2YgPSBkaWN0LmdldCgiQ0YiKTsKICAgICAgaWYgKGNmIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgIGNmLnN1cHByZXNzRW5jcnlwdGlvbiA9IHRydWU7CiAgICAgIH0KICAgICAgdGhpcy5jZiA9IGNmOwogICAgICB0aGlzLnN0bWYgPSBkaWN0LmdldCgiU3RtRiIpIHx8IE5hbWUuZ2V0KCJJZGVudGl0eSIpOwogICAgICB0aGlzLnN0cmYgPSBkaWN0LmdldCgiU3RyRiIpIHx8IE5hbWUuZ2V0KCJJZGVudGl0eSIpOwogICAgICB0aGlzLmVmZiA9IGRpY3QuZ2V0KCJFRkYiKSB8fCB0aGlzLnN0bWY7CiAgICB9CiAgfQogIGNyZWF0ZUNpcGhlclRyYW5zZm9ybShudW0sIGdlbikgewogICAgaWYgKHRoaXMuYWxnb3JpdGhtID09PSA0IHx8IHRoaXMuYWxnb3JpdGhtID09PSA1KSB7CiAgICAgIHJldHVybiBuZXcgQ2lwaGVyVHJhbnNmb3JtKHRoaXMuI2J1aWxkQ2lwaGVyQ29uc3RydWN0b3IodGhpcy5jZiwgdGhpcy5zdHJmLCBudW0sIGdlbiwgdGhpcy5lbmNyeXB0aW9uS2V5KSwgdGhpcy4jYnVpbGRDaXBoZXJDb25zdHJ1Y3Rvcih0aGlzLmNmLCB0aGlzLnN0bWYsIG51bSwgZ2VuLCB0aGlzLmVuY3J5cHRpb25LZXkpKTsKICAgIH0KICAgIGNvbnN0IGtleSA9IHRoaXMuI2J1aWxkT2JqZWN0S2V5KG51bSwgZ2VuLCB0aGlzLmVuY3J5cHRpb25LZXksIGZhbHNlKTsKICAgIGNvbnN0IGNpcGhlckNvbnN0cnVjdG9yID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gbmV3IEFSQ0ZvdXJDaXBoZXIoa2V5KTsKICAgIH07CiAgICByZXR1cm4gbmV3IENpcGhlclRyYW5zZm9ybShjaXBoZXJDb25zdHJ1Y3RvciwgY2lwaGVyQ29uc3RydWN0b3IpOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUveHJlZi5qcwoKCgoKCgpjbGFzcyBYUmVmIHsKICAjZmlyc3RYUmVmU3RtUG9zID0gbnVsbDsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIHBkZk1hbmFnZXIpIHsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy5wZGZNYW5hZ2VyID0gcGRmTWFuYWdlcjsKICAgIHRoaXMuZW50cmllcyA9IFtdOwogICAgdGhpcy5feHJlZlN0bXMgPSBuZXcgU2V0KCk7CiAgICB0aGlzLl9jYWNoZU1hcCA9IG5ldyBNYXAoKTsKICAgIHRoaXMuX3BlbmRpbmdSZWZzID0gbmV3IFJlZlNldCgpOwogICAgdGhpcy5fbmV3UGVyc2lzdGVudFJlZk51bSA9IG51bGw7CiAgICB0aGlzLl9uZXdUZW1wb3JhcnlSZWZOdW0gPSBudWxsOwogICAgdGhpcy5fcGVyc2lzdGVudFJlZnNDYWNoZSA9IG51bGw7CiAgfQogIGdldE5ld1BlcnNpc3RlbnRSZWYob2JqKSB7CiAgICBpZiAodGhpcy5fbmV3UGVyc2lzdGVudFJlZk51bSA9PT0gbnVsbCkgewogICAgICB0aGlzLl9uZXdQZXJzaXN0ZW50UmVmTnVtID0gdGhpcy5lbnRyaWVzLmxlbmd0aCB8fCAxOwogICAgfQogICAgY29uc3QgbnVtID0gdGhpcy5fbmV3UGVyc2lzdGVudFJlZk51bSsrOwogICAgdGhpcy5fY2FjaGVNYXAuc2V0KG51bSwgb2JqKTsKICAgIHJldHVybiBSZWYuZ2V0KG51bSwgMCk7CiAgfQogIGdldE5ld1RlbXBvcmFyeVJlZigpIHsKICAgIGlmICh0aGlzLl9uZXdUZW1wb3JhcnlSZWZOdW0gPT09IG51bGwpIHsKICAgICAgdGhpcy5fbmV3VGVtcG9yYXJ5UmVmTnVtID0gdGhpcy5lbnRyaWVzLmxlbmd0aCB8fCAxOwogICAgICBpZiAodGhpcy5fbmV3UGVyc2lzdGVudFJlZk51bSkgewogICAgICAgIHRoaXMuX3BlcnNpc3RlbnRSZWZzQ2FjaGUgPSBuZXcgTWFwKCk7CiAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuX25ld1RlbXBvcmFyeVJlZk51bTsgaSA8IHRoaXMuX25ld1BlcnNpc3RlbnRSZWZOdW07IGkrKykgewogICAgICAgICAgdGhpcy5fcGVyc2lzdGVudFJlZnNDYWNoZS5zZXQoaSwgdGhpcy5fY2FjaGVNYXAuZ2V0KGkpKTsKICAgICAgICAgIHRoaXMuX2NhY2hlTWFwLmRlbGV0ZShpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBSZWYuZ2V0KHRoaXMuX25ld1RlbXBvcmFyeVJlZk51bSsrLCAwKTsKICB9CiAgcmVzZXROZXdUZW1wb3JhcnlSZWYoKSB7CiAgICB0aGlzLl9uZXdUZW1wb3JhcnlSZWZOdW0gPSBudWxsOwogICAgaWYgKHRoaXMuX3BlcnNpc3RlbnRSZWZzQ2FjaGUpIHsKICAgICAgZm9yIChjb25zdCBbbnVtLCBvYmpdIG9mIHRoaXMuX3BlcnNpc3RlbnRSZWZzQ2FjaGUpIHsKICAgICAgICB0aGlzLl9jYWNoZU1hcC5zZXQobnVtLCBvYmopOwogICAgICB9CiAgICB9CiAgICB0aGlzLl9wZXJzaXN0ZW50UmVmc0NhY2hlID0gbnVsbDsKICB9CiAgc2V0U3RhcnRYUmVmKHN0YXJ0WFJlZikgewogICAgdGhpcy5zdGFydFhSZWZRdWV1ZSA9IFtzdGFydFhSZWZdOwogIH0KICBwYXJzZShyZWNvdmVyeU1vZGUgPSBmYWxzZSkgewogICAgbGV0IHRyYWlsZXJEaWN0OwogICAgaWYgKCFyZWNvdmVyeU1vZGUpIHsKICAgICAgdHJhaWxlckRpY3QgPSB0aGlzLnJlYWRYUmVmKCk7CiAgICB9IGVsc2UgewogICAgICB3YXJuKCJJbmRleGluZyBhbGwgUERGIG9iamVjdHMiKTsKICAgICAgdHJhaWxlckRpY3QgPSB0aGlzLmluZGV4T2JqZWN0cygpOwogICAgfQogICAgdHJhaWxlckRpY3QuYXNzaWduWHJlZih0aGlzKTsKICAgIHRoaXMudHJhaWxlciA9IHRyYWlsZXJEaWN0OwogICAgbGV0IGVuY3J5cHQ7CiAgICB0cnkgewogICAgICBlbmNyeXB0ID0gdHJhaWxlckRpY3QuZ2V0KCJFbmNyeXB0Iik7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIHdhcm4oYFhSZWYucGFyc2UgLSBJbnZhbGlkICJFbmNyeXB0IiByZWZlcmVuY2U6ICIke2V4fSIuYCk7CiAgICB9CiAgICBpZiAoZW5jcnlwdCBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgY29uc3QgaWRzID0gdHJhaWxlckRpY3QuZ2V0KCJJRCIpOwogICAgICBjb25zdCBmaWxlSWQgPSBpZHM/Lmxlbmd0aCA/IGlkc1swXSA6ICIiOwogICAgICBlbmNyeXB0LnN1cHByZXNzRW5jcnlwdGlvbiA9IHRydWU7CiAgICAgIHRoaXMuZW5jcnlwdCA9IG5ldyBDaXBoZXJUcmFuc2Zvcm1GYWN0b3J5KGVuY3J5cHQsIGZpbGVJZCwgdGhpcy5wZGZNYW5hZ2VyLnBhc3N3b3JkKTsKICAgIH0KICAgIGxldCByb290OwogICAgdHJ5IHsKICAgICAgcm9vdCA9IHRyYWlsZXJEaWN0LmdldCgiUm9vdCIpOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICB3YXJuKGBYUmVmLnBhcnNlIC0gSW52YWxpZCAiUm9vdCIgcmVmZXJlbmNlOiAiJHtleH0iLmApOwogICAgfQogICAgaWYgKHJvb3QgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcGFnZXMgPSByb290LmdldCgiUGFnZXMiKTsKICAgICAgICBpZiAocGFnZXMgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICAgICAgICB0aGlzLnJvb3QgPSByb290OwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICBpZiAoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgICAgdGhyb3cgZXg7CiAgICAgICAgfQogICAgICAgIHdhcm4oYFhSZWYucGFyc2UgLSBJbnZhbGlkICJQYWdlcyIgcmVmZXJlbmNlOiAiJHtleH0iLmApOwogICAgICB9CiAgICB9CiAgICBpZiAoIXJlY292ZXJ5TW9kZSkgewogICAgICB0aHJvdyBuZXcgWFJlZlBhcnNlRXhjZXB0aW9uKCk7CiAgICB9CiAgICB0aHJvdyBuZXcgSW52YWxpZFBERkV4Y2VwdGlvbigiSW52YWxpZCBSb290IHJlZmVyZW5jZS4iKTsKICB9CiAgcHJvY2Vzc1hSZWZUYWJsZShwYXJzZXIpIHsKICAgIGlmICghKCJ0YWJsZVN0YXRlIiBpbiB0aGlzKSkgewogICAgICB0aGlzLnRhYmxlU3RhdGUgPSB7CiAgICAgICAgZW50cnlOdW06IDAsCiAgICAgICAgc3RyZWFtUG9zOiBwYXJzZXIubGV4ZXIuc3RyZWFtLnBvcywKICAgICAgICBwYXJzZXJCdWYxOiBwYXJzZXIuYnVmMSwKICAgICAgICBwYXJzZXJCdWYyOiBwYXJzZXIuYnVmMgogICAgICB9OwogICAgfQogICAgY29uc3Qgb2JqID0gdGhpcy5yZWFkWFJlZlRhYmxlKHBhcnNlcik7CiAgICBpZiAoIWlzQ21kKG9iaiwgInRyYWlsZXIiKSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiB0YWJsZTogY291bGQgbm90IGZpbmQgdHJhaWxlciBkaWN0aW9uYXJ5Iik7CiAgICB9CiAgICBsZXQgZGljdCA9IHBhcnNlci5nZXRPYmooKTsKICAgIGlmICghKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSAmJiBkaWN0LmRpY3QpIHsKICAgICAgZGljdCA9IGRpY3QuZGljdDsKICAgIH0KICAgIGlmICghKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiB0YWJsZTogY291bGQgbm90IHBhcnNlIHRyYWlsZXIgZGljdGlvbmFyeSIpOwogICAgfQogICAgZGVsZXRlIHRoaXMudGFibGVTdGF0ZTsKICAgIHJldHVybiBkaWN0OwogIH0KICByZWFkWFJlZlRhYmxlKHBhcnNlcikgewogICAgY29uc3Qgc3RyZWFtID0gcGFyc2VyLmxleGVyLnN0cmVhbTsKICAgIGNvbnN0IHRhYmxlU3RhdGUgPSB0aGlzLnRhYmxlU3RhdGU7CiAgICBzdHJlYW0ucG9zID0gdGFibGVTdGF0ZS5zdHJlYW1Qb3M7CiAgICBwYXJzZXIuYnVmMSA9IHRhYmxlU3RhdGUucGFyc2VyQnVmMTsKICAgIHBhcnNlci5idWYyID0gdGFibGVTdGF0ZS5wYXJzZXJCdWYyOwogICAgbGV0IG9iajsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGlmICghKCJmaXJzdEVudHJ5TnVtIiBpbiB0YWJsZVN0YXRlKSB8fCAhKCJlbnRyeUNvdW50IiBpbiB0YWJsZVN0YXRlKSkgewogICAgICAgIGlmIChpc0NtZChvYmogPSBwYXJzZXIuZ2V0T2JqKCksICJ0cmFpbGVyIikpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICB0YWJsZVN0YXRlLmZpcnN0RW50cnlOdW0gPSBvYmo7CiAgICAgICAgdGFibGVTdGF0ZS5lbnRyeUNvdW50ID0gcGFyc2VyLmdldE9iaigpOwogICAgICB9CiAgICAgIGxldCBmaXJzdCA9IHRhYmxlU3RhdGUuZmlyc3RFbnRyeU51bTsKICAgICAgY29uc3QgY291bnQgPSB0YWJsZVN0YXRlLmVudHJ5Q291bnQ7CiAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihmaXJzdCkgfHwgIU51bWJlci5pc0ludGVnZXIoY291bnQpKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJJbnZhbGlkIFhSZWYgdGFibGU6IHdyb25nIHR5cGVzIGluIHN1YnNlY3Rpb24gaGVhZGVyIik7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IHRhYmxlU3RhdGUuZW50cnlOdW07IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgICAgdGFibGVTdGF0ZS5zdHJlYW1Qb3MgPSBzdHJlYW0ucG9zOwogICAgICAgIHRhYmxlU3RhdGUuZW50cnlOdW0gPSBpOwogICAgICAgIHRhYmxlU3RhdGUucGFyc2VyQnVmMSA9IHBhcnNlci5idWYxOwogICAgICAgIHRhYmxlU3RhdGUucGFyc2VyQnVmMiA9IHBhcnNlci5idWYyOwogICAgICAgIGNvbnN0IGVudHJ5ID0ge307CiAgICAgICAgZW50cnkub2Zmc2V0ID0gcGFyc2VyLmdldE9iaigpOwogICAgICAgIGVudHJ5LmdlbiA9IHBhcnNlci5nZXRPYmooKTsKICAgICAgICBjb25zdCB0eXBlID0gcGFyc2VyLmdldE9iaigpOwogICAgICAgIGlmICh0eXBlIGluc3RhbmNlb2YgQ21kKSB7CiAgICAgICAgICBzd2l0Y2ggKHR5cGUuY21kKSB7CiAgICAgICAgICAgIGNhc2UgImYiOgogICAgICAgICAgICAgIGVudHJ5LmZyZWUgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJuIjoKICAgICAgICAgICAgICBlbnRyeS51bmNvbXByZXNzZWQgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoZW50cnkub2Zmc2V0KSB8fCAhTnVtYmVyLmlzSW50ZWdlcihlbnRyeS5nZW4pIHx8ICEoZW50cnkuZnJlZSB8fCBlbnRyeS51bmNvbXByZXNzZWQpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgZW50cnkgaW4gWFJlZiBzdWJzZWN0aW9uOiAke2ZpcnN0fSwgJHtjb3VudH1gKTsKICAgICAgICB9CiAgICAgICAgaWYgKGkgPT09IDAgJiYgZW50cnkuZnJlZSAmJiBmaXJzdCA9PT0gMSkgewogICAgICAgICAgZmlyc3QgPSAwOwogICAgICAgIH0KICAgICAgICBpZiAoIXRoaXMuZW50cmllc1tpICsgZmlyc3RdKSB7CiAgICAgICAgICB0aGlzLmVudHJpZXNbaSArIGZpcnN0XSA9IGVudHJ5OwogICAgICAgIH0KICAgICAgfQogICAgICB0YWJsZVN0YXRlLmVudHJ5TnVtID0gMDsKICAgICAgdGFibGVTdGF0ZS5zdHJlYW1Qb3MgPSBzdHJlYW0ucG9zOwogICAgICB0YWJsZVN0YXRlLnBhcnNlckJ1ZjEgPSBwYXJzZXIuYnVmMTsKICAgICAgdGFibGVTdGF0ZS5wYXJzZXJCdWYyID0gcGFyc2VyLmJ1ZjI7CiAgICAgIGRlbGV0ZSB0YWJsZVN0YXRlLmZpcnN0RW50cnlOdW07CiAgICAgIGRlbGV0ZSB0YWJsZVN0YXRlLmVudHJ5Q291bnQ7CiAgICB9CiAgICBpZiAodGhpcy5lbnRyaWVzWzBdICYmICF0aGlzLmVudHJpZXNbMF0uZnJlZSkgewogICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiB0YWJsZTogdW5leHBlY3RlZCBmaXJzdCBvYmplY3QiKTsKICAgIH0KICAgIHJldHVybiBvYmo7CiAgfQogIHByb2Nlc3NYUmVmU3RyZWFtKHN0cmVhbSkgewogICAgaWYgKCEoInN0cmVhbVN0YXRlIiBpbiB0aGlzKSkgewogICAgICBjb25zdCB7CiAgICAgICAgZGljdCwKICAgICAgICBwb3MKICAgICAgfSA9IHN0cmVhbTsKICAgICAgY29uc3QgYnl0ZVdpZHRocyA9IGRpY3QuZ2V0KCJXIik7CiAgICAgIGNvbnN0IHJhbmdlID0gZGljdC5nZXQoIkluZGV4IikgfHwgWzAsIGRpY3QuZ2V0KCJTaXplIildOwogICAgICB0aGlzLnN0cmVhbVN0YXRlID0gewogICAgICAgIGVudHJ5UmFuZ2VzOiByYW5nZSwKICAgICAgICBieXRlV2lkdGhzLAogICAgICAgIGVudHJ5TnVtOiAwLAogICAgICAgIHN0cmVhbVBvczogcG9zCiAgICAgIH07CiAgICB9CiAgICB0aGlzLnJlYWRYUmVmU3RyZWFtKHN0cmVhbSk7CiAgICBkZWxldGUgdGhpcy5zdHJlYW1TdGF0ZTsKICAgIHJldHVybiBzdHJlYW0uZGljdDsKICB9CiAgcmVhZFhSZWZTdHJlYW0oc3RyZWFtKSB7CiAgICBjb25zdCBzdHJlYW1TdGF0ZSA9IHRoaXMuc3RyZWFtU3RhdGU7CiAgICBzdHJlYW0ucG9zID0gc3RyZWFtU3RhdGUuc3RyZWFtUG9zOwogICAgY29uc3QgW3R5cGVGaWVsZFdpZHRoLCBvZmZzZXRGaWVsZFdpZHRoLCBnZW5lcmF0aW9uRmllbGRXaWR0aF0gPSBzdHJlYW1TdGF0ZS5ieXRlV2lkdGhzOwogICAgY29uc3QgZW50cnlSYW5nZXMgPSBzdHJlYW1TdGF0ZS5lbnRyeVJhbmdlczsKICAgIHdoaWxlIChlbnRyeVJhbmdlcy5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IFtmaXJzdCwgbl0gPSBlbnRyeVJhbmdlczsKICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGZpcnN0KSB8fCAhTnVtYmVyLmlzSW50ZWdlcihuKSkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBYUmVmIHJhbmdlIGZpZWxkczogJHtmaXJzdH0sICR7bn1gKTsKICAgICAgfQogICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIodHlwZUZpZWxkV2lkdGgpIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKG9mZnNldEZpZWxkV2lkdGgpIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKGdlbmVyYXRpb25GaWVsZFdpZHRoKSkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgSW52YWxpZCBYUmVmIGVudHJ5IGZpZWxkcyBsZW5ndGg6ICR7Zmlyc3R9LCAke259YCk7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IHN0cmVhbVN0YXRlLmVudHJ5TnVtOyBpIDwgbjsgKytpKSB7CiAgICAgICAgc3RyZWFtU3RhdGUuZW50cnlOdW0gPSBpOwogICAgICAgIHN0cmVhbVN0YXRlLnN0cmVhbVBvcyA9IHN0cmVhbS5wb3M7CiAgICAgICAgbGV0IHR5cGUgPSAwLAogICAgICAgICAgb2Zmc2V0ID0gMCwKICAgICAgICAgIGdlbmVyYXRpb24gPSAwOwogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdHlwZUZpZWxkV2lkdGg7ICsraikgewogICAgICAgICAgY29uc3QgdHlwZUJ5dGUgPSBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICAgICAgaWYgKHR5cGVCeXRlID09PSAtMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiBieXRlV2lkdGhzICd0eXBlJy4iKTsKICAgICAgICAgIH0KICAgICAgICAgIHR5cGUgPSB0eXBlIDw8IDggfCB0eXBlQnl0ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVGaWVsZFdpZHRoID09PSAwKSB7CiAgICAgICAgICB0eXBlID0gMTsKICAgICAgICB9CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBvZmZzZXRGaWVsZFdpZHRoOyArK2opIHsKICAgICAgICAgIGNvbnN0IG9mZnNldEJ5dGUgPSBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICAgICAgaWYgKG9mZnNldEJ5dGUgPT09IC0xKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBYUmVmIGJ5dGVXaWR0aHMgJ29mZnNldCcuIik7CiAgICAgICAgICB9CiAgICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPDwgOCB8IG9mZnNldEJ5dGU7CiAgICAgICAgfQogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZ2VuZXJhdGlvbkZpZWxkV2lkdGg7ICsraikgewogICAgICAgICAgY29uc3QgZ2VuZXJhdGlvbkJ5dGUgPSBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICAgICAgaWYgKGdlbmVyYXRpb25CeXRlID09PSAtMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiBieXRlV2lkdGhzICdnZW5lcmF0aW9uJy4iKTsKICAgICAgICAgIH0KICAgICAgICAgIGdlbmVyYXRpb24gPSBnZW5lcmF0aW9uIDw8IDggfCBnZW5lcmF0aW9uQnl0ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgZW50cnkgPSB7fTsKICAgICAgICBlbnRyeS5vZmZzZXQgPSBvZmZzZXQ7CiAgICAgICAgZW50cnkuZ2VuID0gZ2VuZXJhdGlvbjsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgZW50cnkuZnJlZSA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBlbnRyeS51bmNvbXByZXNzZWQgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoYEludmFsaWQgWFJlZiBlbnRyeSB0eXBlOiAke3R5cGV9YCk7CiAgICAgICAgfQogICAgICAgIGlmICghdGhpcy5lbnRyaWVzW2ZpcnN0ICsgaV0pIHsKICAgICAgICAgIHRoaXMuZW50cmllc1tmaXJzdCArIGldID0gZW50cnk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHN0cmVhbVN0YXRlLmVudHJ5TnVtID0gMDsKICAgICAgc3RyZWFtU3RhdGUuc3RyZWFtUG9zID0gc3RyZWFtLnBvczsKICAgICAgZW50cnlSYW5nZXMuc3BsaWNlKDAsIDIpOwogICAgfQogIH0KICBpbmRleE9iamVjdHMoKSB7CiAgICBjb25zdCBUQUIgPSAweDksCiAgICAgIExGID0gMHhhLAogICAgICBDUiA9IDB4ZCwKICAgICAgU1BBQ0UgPSAweDIwOwogICAgY29uc3QgUEVSQ0VOVCA9IDB4MjUsCiAgICAgIExUID0gMHgzYzsKICAgIGZ1bmN0aW9uIHJlYWRUb2tlbihkYXRhLCBvZmZzZXQpIHsKICAgICAgbGV0IHRva2VuID0gIiIsCiAgICAgICAgY2ggPSBkYXRhW29mZnNldF07CiAgICAgIHdoaWxlIChjaCAhPT0gTEYgJiYgY2ggIT09IENSICYmIGNoICE9PSBMVCkgewogICAgICAgIGlmICgrK29mZnNldCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHRva2VuICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgICAgIGNoID0gZGF0YVtvZmZzZXRdOwogICAgICB9CiAgICAgIHJldHVybiB0b2tlbjsKICAgIH0KICAgIGZ1bmN0aW9uIHNraXBVbnRpbChkYXRhLCBvZmZzZXQsIHdoYXQpIHsKICAgICAgY29uc3QgbGVuZ3RoID0gd2hhdC5sZW5ndGgsCiAgICAgICAgZGF0YUxlbmd0aCA9IGRhdGEubGVuZ3RoOwogICAgICBsZXQgc2tpcHBlZCA9IDA7CiAgICAgIHdoaWxlIChvZmZzZXQgPCBkYXRhTGVuZ3RoKSB7CiAgICAgICAgbGV0IGkgPSAwOwogICAgICAgIHdoaWxlIChpIDwgbGVuZ3RoICYmIGRhdGFbb2Zmc2V0ICsgaV0gPT09IHdoYXRbaV0pIHsKICAgICAgICAgICsraTsKICAgICAgICB9CiAgICAgICAgaWYgKGkgPj0gbGVuZ3RoKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgc2tpcHBlZCsrOwogICAgICB9CiAgICAgIHJldHVybiBza2lwcGVkOwogICAgfQogICAgY29uc3QgZ0VuZG9ialJlZ0V4cCA9IC9cYihlbmRvYmp8XGQrXHMrXGQrXHMrb2JqfHhyZWZ8dHJhaWxlclxzKjw8KVxiL2c7CiAgICBjb25zdCBnU3RhcnR4cmVmUmVnRXhwID0gL1xiKHN0YXJ0eHJlZnxcZCtccytcZCtccytvYmopXGIvZzsKICAgIGNvbnN0IG9ialJlZ0V4cCA9IC9eKFxkKylccysoXGQrKVxzK29ialxiLzsKICAgIGNvbnN0IHRyYWlsZXJCeXRlcyA9IG5ldyBVaW50OEFycmF5KFsxMTYsIDExNCwgOTcsIDEwNSwgMTA4LCAxMDEsIDExNF0pOwogICAgY29uc3Qgc3RhcnR4cmVmQnl0ZXMgPSBuZXcgVWludDhBcnJheShbMTE1LCAxMTYsIDk3LCAxMTQsIDExNiwgMTIwLCAxMTQsIDEwMSwgMTAyXSk7CiAgICBjb25zdCB4cmVmQnl0ZXMgPSBuZXcgVWludDhBcnJheShbNDcsIDg4LCA4MiwgMTAxLCAxMDJdKTsKICAgIHRoaXMuZW50cmllcy5sZW5ndGggPSAwOwogICAgdGhpcy5fY2FjaGVNYXAuY2xlYXIoKTsKICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuc3RyZWFtOwogICAgc3RyZWFtLnBvcyA9IDA7CiAgICBjb25zdCBidWZmZXIgPSBzdHJlYW0uZ2V0Qnl0ZXMoKSwKICAgICAgYnVmZmVyU3RyID0gYnl0ZXNUb1N0cmluZyhidWZmZXIpLAogICAgICBsZW5ndGggPSBidWZmZXIubGVuZ3RoOwogICAgbGV0IHBvc2l0aW9uID0gc3RyZWFtLnN0YXJ0OwogICAgY29uc3QgdHJhaWxlcnMgPSBbXSwKICAgICAgeHJlZlN0bXMgPSBbXTsKICAgIHdoaWxlIChwb3NpdGlvbiA8IGxlbmd0aCkgewogICAgICBsZXQgY2ggPSBidWZmZXJbcG9zaXRpb25dOwogICAgICBpZiAoY2ggPT09IFRBQiB8fCBjaCA9PT0gTEYgfHwgY2ggPT09IENSIHx8IGNoID09PSBTUEFDRSkgewogICAgICAgICsrcG9zaXRpb247CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGNoID09PSBQRVJDRU5UKSB7CiAgICAgICAgZG8gewogICAgICAgICAgKytwb3NpdGlvbjsKICAgICAgICAgIGlmIChwb3NpdGlvbiA+PSBsZW5ndGgpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBjaCA9IGJ1ZmZlcltwb3NpdGlvbl07CiAgICAgICAgfSB3aGlsZSAoY2ggIT09IExGICYmIGNoICE9PSBDUik7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgdG9rZW4gPSByZWFkVG9rZW4oYnVmZmVyLCBwb3NpdGlvbik7CiAgICAgIGxldCBtOwogICAgICBpZiAodG9rZW4uc3RhcnRzV2l0aCgieHJlZiIpICYmICh0b2tlbi5sZW5ndGggPT09IDQgfHwgL1xzLy50ZXN0KHRva2VuWzRdKSkpIHsKICAgICAgICBwb3NpdGlvbiArPSBza2lwVW50aWwoYnVmZmVyLCBwb3NpdGlvbiwgdHJhaWxlckJ5dGVzKTsKICAgICAgICB0cmFpbGVycy5wdXNoKHBvc2l0aW9uKTsKICAgICAgICBwb3NpdGlvbiArPSBza2lwVW50aWwoYnVmZmVyLCBwb3NpdGlvbiwgc3RhcnR4cmVmQnl0ZXMpOwogICAgICB9IGVsc2UgaWYgKG0gPSBvYmpSZWdFeHAuZXhlYyh0b2tlbikpIHsKICAgICAgICBjb25zdCBudW0gPSBtWzFdIHwgMCwKICAgICAgICAgIGdlbiA9IG1bMl0gfCAwOwogICAgICAgIGNvbnN0IHN0YXJ0UG9zID0gcG9zaXRpb24gKyB0b2tlbi5sZW5ndGg7CiAgICAgICAgbGV0IGNvbnRlbnRMZW5ndGgsCiAgICAgICAgICB1cGRhdGVFbnRyaWVzID0gZmFsc2U7CiAgICAgICAgaWYgKCF0aGlzLmVudHJpZXNbbnVtXSkgewogICAgICAgICAgdXBkYXRlRW50cmllcyA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVudHJpZXNbbnVtXS5nZW4gPT09IGdlbikgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcGFyc2VyID0gbmV3IFBhcnNlcih7CiAgICAgICAgICAgICAgbGV4ZXI6IG5ldyBMZXhlcihzdHJlYW0ubWFrZVN1YlN0cmVhbShzdGFydFBvcykpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgICAgICAgIHVwZGF0ZUVudHJpZXMgPSB0cnVlOwogICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgaWYgKGV4IGluc3RhbmNlb2YgUGFyc2VyRU9GRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgd2FybihgaW5kZXhPYmplY3RzIC0tIGNoZWNraW5nIG9iamVjdCAoJHt0b2tlbn0pOiAiJHtleH0iLmApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHVwZGF0ZUVudHJpZXMgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh1cGRhdGVFbnRyaWVzKSB7CiAgICAgICAgICB0aGlzLmVudHJpZXNbbnVtXSA9IHsKICAgICAgICAgICAgb2Zmc2V0OiBwb3NpdGlvbiAtIHN0cmVhbS5zdGFydCwKICAgICAgICAgICAgZ2VuLAogICAgICAgICAgICB1bmNvbXByZXNzZWQ6IHRydWUKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGdFbmRvYmpSZWdFeHAubGFzdEluZGV4ID0gc3RhcnRQb3M7CiAgICAgICAgY29uc3QgbWF0Y2ggPSBnRW5kb2JqUmVnRXhwLmV4ZWMoYnVmZmVyU3RyKTsKICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgIGNvbnN0IGVuZFBvcyA9IGdFbmRvYmpSZWdFeHAubGFzdEluZGV4ICsgMTsKICAgICAgICAgIGNvbnRlbnRMZW5ndGggPSBlbmRQb3MgLSBwb3NpdGlvbjsKICAgICAgICAgIGlmIChtYXRjaFsxXSAhPT0gImVuZG9iaiIpIHsKICAgICAgICAgICAgd2FybihgaW5kZXhPYmplY3RzOiBGb3VuZCAiJHttYXRjaFsxXX0iIGluc2lkZSBvZiBhbm90aGVyICJvYmoiLCBgICsgJ2NhdXNlZCBieSBtaXNzaW5nICJlbmRvYmoiIC0tIHRyeWluZyB0byByZWNvdmVyLicpOwogICAgICAgICAgICBjb250ZW50TGVuZ3RoIC09IG1hdGNoWzFdLmxlbmd0aCArIDE7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnRlbnRMZW5ndGggPSBsZW5ndGggLSBwb3NpdGlvbjsKICAgICAgICB9CiAgICAgICAgY29uc3QgY29udGVudCA9IGJ1ZmZlci5zdWJhcnJheShwb3NpdGlvbiwgcG9zaXRpb24gKyBjb250ZW50TGVuZ3RoKTsKICAgICAgICBjb25zdCB4cmVmVGFnT2Zmc2V0ID0gc2tpcFVudGlsKGNvbnRlbnQsIDAsIHhyZWZCeXRlcyk7CiAgICAgICAgaWYgKHhyZWZUYWdPZmZzZXQgPCBjb250ZW50TGVuZ3RoICYmIGNvbnRlbnRbeHJlZlRhZ09mZnNldCArIDVdIDwgNjQpIHsKICAgICAgICAgIHhyZWZTdG1zLnB1c2gocG9zaXRpb24gLSBzdHJlYW0uc3RhcnQpOwogICAgICAgICAgdGhpcy5feHJlZlN0bXMuYWRkKHBvc2l0aW9uIC0gc3RyZWFtLnN0YXJ0KTsKICAgICAgICB9CiAgICAgICAgcG9zaXRpb24gKz0gY29udGVudExlbmd0aDsKICAgICAgfSBlbHNlIGlmICh0b2tlbi5zdGFydHNXaXRoKCJ0cmFpbGVyIikgJiYgKHRva2VuLmxlbmd0aCA9PT0gNyB8fCAvXHMvLnRlc3QodG9rZW5bN10pKSkgewogICAgICAgIHRyYWlsZXJzLnB1c2gocG9zaXRpb24pOwogICAgICAgIGNvbnN0IHN0YXJ0UG9zID0gcG9zaXRpb24gKyB0b2tlbi5sZW5ndGg7CiAgICAgICAgbGV0IGNvbnRlbnRMZW5ndGg7CiAgICAgICAgZ1N0YXJ0eHJlZlJlZ0V4cC5sYXN0SW5kZXggPSBzdGFydFBvczsKICAgICAgICBjb25zdCBtYXRjaCA9IGdTdGFydHhyZWZSZWdFeHAuZXhlYyhidWZmZXJTdHIpOwogICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgY29uc3QgZW5kUG9zID0gZ1N0YXJ0eHJlZlJlZ0V4cC5sYXN0SW5kZXggKyAxOwogICAgICAgICAgY29udGVudExlbmd0aCA9IGVuZFBvcyAtIHBvc2l0aW9uOwogICAgICAgICAgaWYgKG1hdGNoWzFdICE9PSAic3RhcnR4cmVmIikgewogICAgICAgICAgICB3YXJuKGBpbmRleE9iamVjdHM6IEZvdW5kICIke21hdGNoWzFdfSIgYWZ0ZXIgInRyYWlsZXIiLCBgICsgJ2NhdXNlZCBieSBtaXNzaW5nICJzdGFydHhyZWYiIC0tIHRyeWluZyB0byByZWNvdmVyLicpOwogICAgICAgICAgICBjb250ZW50TGVuZ3RoIC09IG1hdGNoWzFdLmxlbmd0aCArIDE7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnRlbnRMZW5ndGggPSBsZW5ndGggLSBwb3NpdGlvbjsKICAgICAgICB9CiAgICAgICAgcG9zaXRpb24gKz0gY29udGVudExlbmd0aDsKICAgICAgfSBlbHNlIHsKICAgICAgICBwb3NpdGlvbiArPSB0b2tlbi5sZW5ndGggKyAxOwogICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IHhyZWZTdG0gb2YgeHJlZlN0bXMpIHsKICAgICAgdGhpcy5zdGFydFhSZWZRdWV1ZS5wdXNoKHhyZWZTdG0pOwogICAgICB0aGlzLnJlYWRYUmVmKHRydWUpOwogICAgfQogICAgY29uc3QgdHJhaWxlckRpY3RzID0gW107CiAgICBsZXQgaXNFbmNyeXB0ZWQgPSBmYWxzZTsKICAgIGZvciAoY29uc3QgdHJhaWxlciBvZiB0cmFpbGVycykgewogICAgICBzdHJlYW0ucG9zID0gdHJhaWxlcjsKICAgICAgY29uc3QgcGFyc2VyID0gbmV3IFBhcnNlcih7CiAgICAgICAgbGV4ZXI6IG5ldyBMZXhlcihzdHJlYW0pLAogICAgICAgIHhyZWY6IHRoaXMsCiAgICAgICAgYWxsb3dTdHJlYW1zOiB0cnVlLAogICAgICAgIHJlY292ZXJ5TW9kZTogdHJ1ZQogICAgICB9KTsKICAgICAgY29uc3Qgb2JqID0gcGFyc2VyLmdldE9iaigpOwogICAgICBpZiAoIWlzQ21kKG9iaiwgInRyYWlsZXIiKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGRpY3QgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgIGlmICghKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHRyYWlsZXJEaWN0cy5wdXNoKGRpY3QpOwogICAgICBpZiAoZGljdC5oYXMoIkVuY3J5cHQiKSkgewogICAgICAgIGlzRW5jcnlwdGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgbGV0IHRyYWlsZXJEaWN0LCB0cmFpbGVyRXJyb3I7CiAgICBmb3IgKGNvbnN0IGRpY3Qgb2YgWy4uLnRyYWlsZXJEaWN0cywgImdlbkZhbGxiYWNrIiwgLi4udHJhaWxlckRpY3RzXSkgewogICAgICBpZiAoZGljdCA9PT0gImdlbkZhbGxiYWNrIikgewogICAgICAgIGlmICghdHJhaWxlckVycm9yKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgdGhpcy5fZ2VuZXJhdGlvbkZhbGxiYWNrID0gdHJ1ZTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBsZXQgdmFsaWRQYWdlc0RpY3QgPSBmYWxzZTsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByb290RGljdCA9IGRpY3QuZ2V0KCJSb290Iik7CiAgICAgICAgaWYgKCEocm9vdERpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHBhZ2VzRGljdCA9IHJvb3REaWN0LmdldCgiUGFnZXMiKTsKICAgICAgICBpZiAoIShwYWdlc0RpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHBhZ2VzQ291bnQgPSBwYWdlc0RpY3QuZ2V0KCJDb3VudCIpOwogICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKHBhZ2VzQ291bnQpKSB7CiAgICAgICAgICB2YWxpZFBhZ2VzRGljdCA9IHRydWU7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIHRyYWlsZXJFcnJvciA9IGV4OwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICh2YWxpZFBhZ2VzRGljdCAmJiAoIWlzRW5jcnlwdGVkIHx8IGRpY3QuaGFzKCJFbmNyeXB0IikpICYmIGRpY3QuaGFzKCJJRCIpKSB7CiAgICAgICAgcmV0dXJuIGRpY3Q7CiAgICAgIH0KICAgICAgdHJhaWxlckRpY3QgPSBkaWN0OwogICAgfQogICAgaWYgKHRyYWlsZXJEaWN0KSB7CiAgICAgIHJldHVybiB0cmFpbGVyRGljdDsKICAgIH0KICAgIGlmICh0aGlzLnRvcERpY3QpIHsKICAgICAgcmV0dXJuIHRoaXMudG9wRGljdDsKICAgIH0KICAgIGlmICghdHJhaWxlckRpY3RzLmxlbmd0aCkgewogICAgICBmb3IgKGNvbnN0IFtudW0sIGVudHJ5XSBvZiB0aGlzLmVudHJpZXMuZW50cmllcygpKSB7CiAgICAgICAgaWYgKCFlbnRyeSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHJlZiA9IFJlZi5nZXQobnVtLCBlbnRyeS5nZW4pOwogICAgICAgIGxldCBvYmo7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIG9iaiA9IHRoaXMuZmV0Y2gocmVmKTsKICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgICAgb2JqID0gb2JqLmRpY3Q7CiAgICAgICAgfQogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBEaWN0ICYmIG9iai5oYXMoIlJvb3QiKSkgewogICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRocm93IG5ldyBJbnZhbGlkUERGRXhjZXB0aW9uKCJJbnZhbGlkIFBERiBzdHJ1Y3R1cmUuIik7CiAgfQogIHJlYWRYUmVmKHJlY292ZXJ5TW9kZSA9IGZhbHNlKSB7CiAgICBjb25zdCBzdHJlYW0gPSB0aGlzLnN0cmVhbTsKICAgIGNvbnN0IHN0YXJ0WFJlZlBhcnNlZENhY2hlID0gbmV3IFNldCgpOwogICAgd2hpbGUgKHRoaXMuc3RhcnRYUmVmUXVldWUubGVuZ3RoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3Qgc3RhcnRYUmVmID0gdGhpcy5zdGFydFhSZWZRdWV1ZVswXTsKICAgICAgICBpZiAoc3RhcnRYUmVmUGFyc2VkQ2FjaGUuaGFzKHN0YXJ0WFJlZikpIHsKICAgICAgICAgIHdhcm4oInJlYWRYUmVmIC0gc2tpcHBpbmcgWFJlZiB0YWJsZSBzaW5jZSBpdCB3YXMgYWxyZWFkeSBwYXJzZWQuIik7CiAgICAgICAgICB0aGlzLnN0YXJ0WFJlZlF1ZXVlLnNoaWZ0KCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgc3RhcnRYUmVmUGFyc2VkQ2FjaGUuYWRkKHN0YXJ0WFJlZik7CiAgICAgICAgc3RyZWFtLnBvcyA9IHN0YXJ0WFJlZiArIHN0cmVhbS5zdGFydDsKICAgICAgICBjb25zdCBwYXJzZXIgPSBuZXcgUGFyc2VyKHsKICAgICAgICAgIGxleGVyOiBuZXcgTGV4ZXIoc3RyZWFtKSwKICAgICAgICAgIHhyZWY6IHRoaXMsCiAgICAgICAgICBhbGxvd1N0cmVhbXM6IHRydWUKICAgICAgICB9KTsKICAgICAgICBsZXQgb2JqID0gcGFyc2VyLmdldE9iaigpOwogICAgICAgIGxldCBkaWN0OwogICAgICAgIGlmIChpc0NtZChvYmosICJ4cmVmIikpIHsKICAgICAgICAgIGRpY3QgPSB0aGlzLnByb2Nlc3NYUmVmVGFibGUocGFyc2VyKTsKICAgICAgICAgIGlmICghdGhpcy50b3BEaWN0KSB7CiAgICAgICAgICAgIHRoaXMudG9wRGljdCA9IGRpY3Q7CiAgICAgICAgICB9CiAgICAgICAgICBvYmogPSBkaWN0LmdldCgiWFJlZlN0bSIpOwogICAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIob2JqKSAmJiAhdGhpcy5feHJlZlN0bXMuaGFzKG9iaikpIHsKICAgICAgICAgICAgdGhpcy5feHJlZlN0bXMuYWRkKG9iaik7CiAgICAgICAgICAgIHRoaXMuc3RhcnRYUmVmUXVldWUucHVzaChvYmopOwogICAgICAgICAgICB0aGlzLiNmaXJzdFhSZWZTdG1Qb3MgPz89IG9iajsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKE51bWJlci5pc0ludGVnZXIob2JqKSkgewogICAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKHBhcnNlci5nZXRPYmooKSkgfHwgIWlzQ21kKHBhcnNlci5nZXRPYmooKSwgIm9iaiIpIHx8ICEoKG9iaiA9IHBhcnNlci5nZXRPYmooKSkgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiBzdHJlYW0iKTsKICAgICAgICAgIH0KICAgICAgICAgIGRpY3QgPSB0aGlzLnByb2Nlc3NYUmVmU3RyZWFtKG9iaik7CiAgICAgICAgICBpZiAoIXRoaXMudG9wRGljdCkgewogICAgICAgICAgICB0aGlzLnRvcERpY3QgPSBkaWN0OwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFkaWN0KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiRmFpbGVkIHRvIHJlYWQgWFJlZiBzdHJlYW0iKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJJbnZhbGlkIFhSZWYgc3RyZWFtIGhlYWRlciIpOwogICAgICAgIH0KICAgICAgICBvYmogPSBkaWN0LmdldCgiUHJldiIpOwogICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG9iaikpIHsKICAgICAgICAgIHRoaXMuc3RhcnRYUmVmUXVldWUucHVzaChvYmopOwogICAgICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgICB0aGlzLnN0YXJ0WFJlZlF1ZXVlLnB1c2gob2JqLm51bSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICAgICAgaW5mbygiKHdoaWxlIHJlYWRpbmcgWFJlZik6ICIgKyBlKTsKICAgICAgfQogICAgICB0aGlzLnN0YXJ0WFJlZlF1ZXVlLnNoaWZ0KCk7CiAgICB9CiAgICBpZiAodGhpcy50b3BEaWN0KSB7CiAgICAgIHJldHVybiB0aGlzLnRvcERpY3Q7CiAgICB9CiAgICBpZiAocmVjb3ZlcnlNb2RlKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICB0aHJvdyBuZXcgWFJlZlBhcnNlRXhjZXB0aW9uKCk7CiAgfQogIGdldCBsYXN0WFJlZlN0cmVhbVBvcygpIHsKICAgIHJldHVybiB0aGlzLiNmaXJzdFhSZWZTdG1Qb3MgPz8gKHRoaXMuX3hyZWZTdG1zLnNpemUgPiAwID8gTWF0aC5tYXgoLi4udGhpcy5feHJlZlN0bXMpIDogbnVsbCk7CiAgfQogIGdldEVudHJ5KGkpIHsKICAgIGNvbnN0IHhyZWZFbnRyeSA9IHRoaXMuZW50cmllc1tpXTsKICAgIGlmICh4cmVmRW50cnkgJiYgIXhyZWZFbnRyeS5mcmVlICYmIHhyZWZFbnRyeS5vZmZzZXQpIHsKICAgICAgcmV0dXJuIHhyZWZFbnRyeTsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICBmZXRjaElmUmVmKG9iaiwgc3VwcHJlc3NFbmNyeXB0aW9uID0gZmFsc2UpIHsKICAgIGlmIChvYmogaW5zdGFuY2VvZiBSZWYpIHsKICAgICAgcmV0dXJuIHRoaXMuZmV0Y2gob2JqLCBzdXBwcmVzc0VuY3J5cHRpb24pOwogICAgfQogICAgcmV0dXJuIG9iajsKICB9CiAgZmV0Y2gocmVmLCBzdXBwcmVzc0VuY3J5cHRpb24gPSBmYWxzZSkgewogICAgaWYgKCEocmVmIGluc3RhbmNlb2YgUmVmKSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoInJlZiBvYmplY3QgaXMgbm90IGEgcmVmZXJlbmNlIik7CiAgICB9CiAgICBjb25zdCBudW0gPSByZWYubnVtOwogICAgY29uc3QgY2FjaGVFbnRyeSA9IHRoaXMuX2NhY2hlTWFwLmdldChudW0pOwogICAgaWYgKGNhY2hlRW50cnkgIT09IHVuZGVmaW5lZCkgewogICAgICBpZiAoY2FjaGVFbnRyeSBpbnN0YW5jZW9mIERpY3QgJiYgIWNhY2hlRW50cnkub2JqSWQpIHsKICAgICAgICBjYWNoZUVudHJ5Lm9iaklkID0gcmVmLnRvU3RyaW5nKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNhY2hlRW50cnk7CiAgICB9CiAgICBsZXQgeHJlZkVudHJ5ID0gdGhpcy5nZXRFbnRyeShudW0pOwogICAgaWYgKHhyZWZFbnRyeSA9PT0gbnVsbCkgewogICAgICByZXR1cm4geHJlZkVudHJ5OwogICAgfQogICAgaWYgKHRoaXMuX3BlbmRpbmdSZWZzLmhhcyhyZWYpKSB7CiAgICAgIHRoaXMuX3BlbmRpbmdSZWZzLnJlbW92ZShyZWYpOwogICAgICB3YXJuKGBJZ25vcmluZyBjaXJjdWxhciByZWZlcmVuY2U6ICR7cmVmfS5gKTsKICAgICAgcmV0dXJuIENJUkNVTEFSX1JFRjsKICAgIH0KICAgIHRoaXMuX3BlbmRpbmdSZWZzLnB1dChyZWYpOwogICAgdHJ5IHsKICAgICAgeHJlZkVudHJ5ID0geHJlZkVudHJ5LnVuY29tcHJlc3NlZCA/IHRoaXMuZmV0Y2hVbmNvbXByZXNzZWQocmVmLCB4cmVmRW50cnksIHN1cHByZXNzRW5jcnlwdGlvbikgOiB0aGlzLmZldGNoQ29tcHJlc3NlZChyZWYsIHhyZWZFbnRyeSwgc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgICAgdGhpcy5fcGVuZGluZ1JlZnMucmVtb3ZlKHJlZik7CiAgICB9IGNhdGNoIChleCkgewogICAgICB0aGlzLl9wZW5kaW5nUmVmcy5yZW1vdmUocmVmKTsKICAgICAgdGhyb3cgZXg7CiAgICB9CiAgICBpZiAoeHJlZkVudHJ5IGluc3RhbmNlb2YgRGljdCkgewogICAgICB4cmVmRW50cnkub2JqSWQgPSByZWYudG9TdHJpbmcoKTsKICAgIH0gZWxzZSBpZiAoeHJlZkVudHJ5IGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICB4cmVmRW50cnkuZGljdC5vYmpJZCA9IHJlZi50b1N0cmluZygpOwogICAgfQogICAgcmV0dXJuIHhyZWZFbnRyeTsKICB9CiAgZmV0Y2hVbmNvbXByZXNzZWQocmVmLCB4cmVmRW50cnksIHN1cHByZXNzRW5jcnlwdGlvbiA9IGZhbHNlKSB7CiAgICBjb25zdCBnZW4gPSByZWYuZ2VuOwogICAgbGV0IG51bSA9IHJlZi5udW07CiAgICBpZiAoeHJlZkVudHJ5LmdlbiAhPT0gZ2VuKSB7CiAgICAgIGNvbnN0IG1zZyA9IGBJbmNvbnNpc3RlbnQgZ2VuZXJhdGlvbiBpbiBYUmVmOiAke3JlZn1gOwogICAgICBpZiAodGhpcy5fZ2VuZXJhdGlvbkZhbGxiYWNrICYmIHhyZWZFbnRyeS5nZW4gPCBnZW4pIHsKICAgICAgICB3YXJuKG1zZyk7CiAgICAgICAgcmV0dXJuIHRoaXMuZmV0Y2hVbmNvbXByZXNzZWQoUmVmLmdldChudW0sIHhyZWZFbnRyeS5nZW4pLCB4cmVmRW50cnksIHN1cHByZXNzRW5jcnlwdGlvbik7CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IFhSZWZFbnRyeUV4Y2VwdGlvbihtc2cpOwogICAgfQogICAgY29uc3Qgc3RyZWFtID0gdGhpcy5zdHJlYW0ubWFrZVN1YlN0cmVhbSh4cmVmRW50cnkub2Zmc2V0ICsgdGhpcy5zdHJlYW0uc3RhcnQpOwogICAgY29uc3QgcGFyc2VyID0gbmV3IFBhcnNlcih7CiAgICAgIGxleGVyOiBuZXcgTGV4ZXIoc3RyZWFtKSwKICAgICAgeHJlZjogdGhpcywKICAgICAgYWxsb3dTdHJlYW1zOiB0cnVlCiAgICB9KTsKICAgIGNvbnN0IG9iajEgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICBjb25zdCBvYmoyID0gcGFyc2VyLmdldE9iaigpOwogICAgY29uc3Qgb2JqMyA9IHBhcnNlci5nZXRPYmooKTsKICAgIGlmIChvYmoxICE9PSBudW0gfHwgb2JqMiAhPT0gZ2VuIHx8ICEob2JqMyBpbnN0YW5jZW9mIENtZCkpIHsKICAgICAgdGhyb3cgbmV3IFhSZWZFbnRyeUV4Y2VwdGlvbihgQmFkICh1bmNvbXByZXNzZWQpIFhSZWYgZW50cnk6ICR7cmVmfWApOwogICAgfQogICAgaWYgKG9iajMuY21kICE9PSAib2JqIikgewogICAgICBpZiAob2JqMy5jbWQuc3RhcnRzV2l0aCgib2JqIikpIHsKICAgICAgICBudW0gPSBwYXJzZUludChvYmozLmNtZC5zdWJzdHJpbmcoMyksIDEwKTsKICAgICAgICBpZiAoIU51bWJlci5pc05hTihudW0pKSB7CiAgICAgICAgICByZXR1cm4gbnVtOwogICAgICAgIH0KICAgICAgfQogICAgICB0aHJvdyBuZXcgWFJlZkVudHJ5RXhjZXB0aW9uKGBCYWQgKHVuY29tcHJlc3NlZCkgWFJlZiBlbnRyeTogJHtyZWZ9YCk7CiAgICB9CiAgICB4cmVmRW50cnkgPSB0aGlzLmVuY3J5cHQgJiYgIXN1cHByZXNzRW5jcnlwdGlvbiA/IHBhcnNlci5nZXRPYmoodGhpcy5lbmNyeXB0LmNyZWF0ZUNpcGhlclRyYW5zZm9ybShudW0sIGdlbikpIDogcGFyc2VyLmdldE9iaigpOwogICAgaWYgKCEoeHJlZkVudHJ5IGluc3RhbmNlb2YgQmFzZVN0cmVhbSkpIHsKICAgICAgdGhpcy5fY2FjaGVNYXAuc2V0KG51bSwgeHJlZkVudHJ5KTsKICAgIH0KICAgIHJldHVybiB4cmVmRW50cnk7CiAgfQogIGZldGNoQ29tcHJlc3NlZChyZWYsIHhyZWZFbnRyeSwgc3VwcHJlc3NFbmNyeXB0aW9uID0gZmFsc2UpIHsKICAgIGNvbnN0IHRhYmxlT2Zmc2V0ID0geHJlZkVudHJ5Lm9mZnNldDsKICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuZmV0Y2goUmVmLmdldCh0YWJsZU9mZnNldCwgMCkpOwogICAgaWYgKCEoc3RyZWFtIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkpIHsKICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJiYWQgT2JqU3RtIHN0cmVhbSIpOwogICAgfQogICAgY29uc3QgZmlyc3QgPSBzdHJlYW0uZGljdC5nZXQoIkZpcnN0Iik7CiAgICBjb25zdCBuID0gc3RyZWFtLmRpY3QuZ2V0KCJOIik7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoZmlyc3QpIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKG4pKSB7CiAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiaW52YWxpZCBmaXJzdCBhbmQgbiBwYXJhbWV0ZXJzIGZvciBPYmpTdG0gc3RyZWFtIik7CiAgICB9CiAgICBsZXQgcGFyc2VyID0gbmV3IFBhcnNlcih7CiAgICAgIGxleGVyOiBuZXcgTGV4ZXIoc3RyZWFtKSwKICAgICAgeHJlZjogdGhpcywKICAgICAgYWxsb3dTdHJlYW1zOiB0cnVlCiAgICB9KTsKICAgIGNvbnN0IG51bXMgPSBuZXcgQXJyYXkobik7CiAgICBjb25zdCBvZmZzZXRzID0gbmV3IEFycmF5KG4pOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgY29uc3QgbnVtID0gcGFyc2VyLmdldE9iaigpOwogICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIobnVtKSkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcihgaW52YWxpZCBvYmplY3QgbnVtYmVyIGluIHRoZSBPYmpTdG0gc3RyZWFtOiAke251bX1gKTsKICAgICAgfQogICAgICBjb25zdCBvZmZzZXQgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihvZmZzZXQpKSB7CiAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKGBpbnZhbGlkIG9iamVjdCBvZmZzZXQgaW4gdGhlIE9ialN0bSBzdHJlYW06ICR7b2Zmc2V0fWApOwogICAgICB9CiAgICAgIG51bXNbaV0gPSBudW07CiAgICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5nZXRFbnRyeShudW0pOwogICAgICBpZiAoZW50cnk/Lm9mZnNldCA9PT0gdGFibGVPZmZzZXQgJiYgZW50cnkuZ2VuICE9PSBpKSB7CiAgICAgICAgZW50cnkuZ2VuID0gaTsKICAgICAgfQogICAgICBvZmZzZXRzW2ldID0gb2Zmc2V0OwogICAgfQogICAgY29uc3Qgc3RhcnQgPSAoc3RyZWFtLnN0YXJ0IHx8IDApICsgZmlyc3Q7CiAgICBjb25zdCBlbnRyaWVzID0gbmV3IEFycmF5KG4pOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgY29uc3QgbGVuZ3RoID0gaSA8IG4gLSAxID8gb2Zmc2V0c1tpICsgMV0gLSBvZmZzZXRzW2ldIDogdW5kZWZpbmVkOwogICAgICBpZiAobGVuZ3RoIDwgMCkgewogICAgICAgIHRocm93IG5ldyBGb3JtYXRFcnJvcigiSW52YWxpZCBvZmZzZXQgaW4gdGhlIE9ialN0bSBzdHJlYW0uIik7CiAgICAgIH0KICAgICAgcGFyc2VyID0gbmV3IFBhcnNlcih7CiAgICAgICAgbGV4ZXI6IG5ldyBMZXhlcihzdHJlYW0ubWFrZVN1YlN0cmVhbShzdGFydCArIG9mZnNldHNbaV0sIGxlbmd0aCwgc3RyZWFtLmRpY3QpKSwKICAgICAgICB4cmVmOiB0aGlzLAogICAgICAgIGFsbG93U3RyZWFtczogdHJ1ZQogICAgICB9KTsKICAgICAgY29uc3Qgb2JqID0gcGFyc2VyLmdldE9iaigpOwogICAgICBlbnRyaWVzW2ldID0gb2JqOwogICAgICBpZiAob2JqIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IG51bSA9IG51bXNbaV0sCiAgICAgICAgZW50cnkgPSB0aGlzLmVudHJpZXNbbnVtXTsKICAgICAgaWYgKGVudHJ5ICYmIGVudHJ5Lm9mZnNldCA9PT0gdGFibGVPZmZzZXQgJiYgZW50cnkuZ2VuID09PSBpKSB7CiAgICAgICAgdGhpcy5fY2FjaGVNYXAuc2V0KG51bSwgb2JqKTsKICAgICAgfQogICAgfQogICAgeHJlZkVudHJ5ID0gZW50cmllc1t4cmVmRW50cnkuZ2VuXTsKICAgIGlmICh4cmVmRW50cnkgPT09IHVuZGVmaW5lZCkgewogICAgICB0aHJvdyBuZXcgWFJlZkVudHJ5RXhjZXB0aW9uKGBCYWQgKGNvbXByZXNzZWQpIFhSZWYgZW50cnk6ICR7cmVmfWApOwogICAgfQogICAgcmV0dXJuIHhyZWZFbnRyeTsKICB9CiAgYXN5bmMgZmV0Y2hJZlJlZkFzeW5jKG9iaiwgc3VwcHJlc3NFbmNyeXB0aW9uKSB7CiAgICBpZiAob2JqIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgIHJldHVybiB0aGlzLmZldGNoQXN5bmMob2JqLCBzdXBwcmVzc0VuY3J5cHRpb24pOwogICAgfQogICAgcmV0dXJuIG9iajsKICB9CiAgYXN5bmMgZmV0Y2hBc3luYyhyZWYsIHN1cHByZXNzRW5jcnlwdGlvbikgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIHRoaXMuZmV0Y2gocmVmLCBzdXBwcmVzc0VuY3J5cHRpb24pOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKCEoZXggaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikpIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICBhd2FpdCB0aGlzLnBkZk1hbmFnZXIucmVxdWVzdFJhbmdlKGV4LmJlZ2luLCBleC5lbmQpOwogICAgICByZXR1cm4gdGhpcy5mZXRjaEFzeW5jKHJlZiwgc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgIH0KICB9CiAgZ2V0Q2F0YWxvZ09iaigpIHsKICAgIHJldHVybiB0aGlzLnJvb3Q7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS9kb2N1bWVudC5qcwoKCgoKCgoKCgoKCgoKCgoKCgoKCmNvbnN0IExFVFRFUl9TSVpFX01FRElBQk9YID0gWzAsIDAsIDYxMiwgNzkyXTsKY2xhc3MgUGFnZSB7CiAgI3Jlc291cmNlc1Byb21pc2UgPSBudWxsOwogIGNvbnN0cnVjdG9yKHsKICAgIHBkZk1hbmFnZXIsCiAgICB4cmVmLAogICAgcGFnZUluZGV4LAogICAgcGFnZURpY3QsCiAgICByZWYsCiAgICBnbG9iYWxJZEZhY3RvcnksCiAgICBmb250Q2FjaGUsCiAgICBidWlsdEluQ01hcENhY2hlLAogICAgc3RhbmRhcmRGb250RGF0YUNhY2hlLAogICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgZ2xvYmFsSW1hZ2VDYWNoZSwKICAgIHN5c3RlbUZvbnRDYWNoZSwKICAgIG5vbkJsZW5kTW9kZXNTZXQsCiAgICB4ZmFGYWN0b3J5CiAgfSkgewogICAgdGhpcy5wZGZNYW5hZ2VyID0gcGRmTWFuYWdlcjsKICAgIHRoaXMucGFnZUluZGV4ID0gcGFnZUluZGV4OwogICAgdGhpcy5wYWdlRGljdCA9IHBhZ2VEaWN0OwogICAgdGhpcy54cmVmID0geHJlZjsKICAgIHRoaXMucmVmID0gcmVmOwogICAgdGhpcy5mb250Q2FjaGUgPSBmb250Q2FjaGU7CiAgICB0aGlzLmJ1aWx0SW5DTWFwQ2FjaGUgPSBidWlsdEluQ01hcENhY2hlOwogICAgdGhpcy5zdGFuZGFyZEZvbnREYXRhQ2FjaGUgPSBzdGFuZGFyZEZvbnREYXRhQ2FjaGU7CiAgICB0aGlzLmdsb2JhbENvbG9yU3BhY2VDYWNoZSA9IGdsb2JhbENvbG9yU3BhY2VDYWNoZTsKICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZSA9IGdsb2JhbEltYWdlQ2FjaGU7CiAgICB0aGlzLnN5c3RlbUZvbnRDYWNoZSA9IHN5c3RlbUZvbnRDYWNoZTsKICAgIHRoaXMubm9uQmxlbmRNb2Rlc1NldCA9IG5vbkJsZW5kTW9kZXNTZXQ7CiAgICB0aGlzLmV2YWx1YXRvck9wdGlvbnMgPSBwZGZNYW5hZ2VyLmV2YWx1YXRvck9wdGlvbnM7CiAgICB0aGlzLnhmYUZhY3RvcnkgPSB4ZmFGYWN0b3J5OwogICAgY29uc3QgaWRDb3VudGVycyA9IHsKICAgICAgb2JqOiAwCiAgICB9OwogICAgdGhpcy5fbG9jYWxJZEZhY3RvcnkgPSBjbGFzcyBleHRlbmRzIGdsb2JhbElkRmFjdG9yeSB7CiAgICAgIHN0YXRpYyBjcmVhdGVPYmpJZCgpIHsKICAgICAgICByZXR1cm4gYHAke3BhZ2VJbmRleH1fJHsrK2lkQ291bnRlcnMub2JqfWA7CiAgICAgIH0KICAgICAgc3RhdGljIGdldFBhZ2VPYmpJZCgpIHsKICAgICAgICByZXR1cm4gYHAke3JlZi50b1N0cmluZygpfWA7CiAgICAgIH0KICAgIH07CiAgfQogICNjcmVhdGVQYXJ0aWFsRXZhbHVhdG9yKGhhbmRsZXIpIHsKICAgIHJldHVybiBuZXcgUGFydGlhbEV2YWx1YXRvcih7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgaGFuZGxlciwKICAgICAgcGFnZUluZGV4OiB0aGlzLnBhZ2VJbmRleCwKICAgICAgaWRGYWN0b3J5OiB0aGlzLl9sb2NhbElkRmFjdG9yeSwKICAgICAgZm9udENhY2hlOiB0aGlzLmZvbnRDYWNoZSwKICAgICAgYnVpbHRJbkNNYXBDYWNoZTogdGhpcy5idWlsdEluQ01hcENhY2hlLAogICAgICBzdGFuZGFyZEZvbnREYXRhQ2FjaGU6IHRoaXMuc3RhbmRhcmRGb250RGF0YUNhY2hlLAogICAgICBnbG9iYWxDb2xvclNwYWNlQ2FjaGU6IHRoaXMuZ2xvYmFsQ29sb3JTcGFjZUNhY2hlLAogICAgICBnbG9iYWxJbWFnZUNhY2hlOiB0aGlzLmdsb2JhbEltYWdlQ2FjaGUsCiAgICAgIHN5c3RlbUZvbnRDYWNoZTogdGhpcy5zeXN0ZW1Gb250Q2FjaGUsCiAgICAgIG9wdGlvbnM6IHRoaXMuZXZhbHVhdG9yT3B0aW9ucwogICAgfSk7CiAgfQogICNnZXRJbmhlcml0YWJsZVByb3BlcnR5KGtleSwgZ2V0QXJyYXkgPSBmYWxzZSkgewogICAgY29uc3QgdmFsdWUgPSBnZXRJbmhlcml0YWJsZVByb3BlcnR5KHsKICAgICAgZGljdDogdGhpcy5wYWdlRGljdCwKICAgICAga2V5LAogICAgICBnZXRBcnJheSwKICAgICAgc3RvcFdoZW5Gb3VuZDogZmFsc2UKICAgIH0pOwogICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICBpZiAodmFsdWUubGVuZ3RoID09PSAxIHx8ICEodmFsdWVbMF0gaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm4gdmFsdWVbMF07CiAgICB9CiAgICByZXR1cm4gRGljdC5tZXJnZSh7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgZGljdEFycmF5OiB2YWx1ZQogICAgfSk7CiAgfQogIGdldCBjb250ZW50KCkgewogICAgcmV0dXJuIHRoaXMucGFnZURpY3QuZ2V0QXJyYXkoIkNvbnRlbnRzIik7CiAgfQogIGdldCByZXNvdXJjZXMoKSB7CiAgICBjb25zdCByZXNvdXJjZXMgPSB0aGlzLiNnZXRJbmhlcml0YWJsZVByb3BlcnR5KCJSZXNvdXJjZXMiKTsKICAgIHJldHVybiBzaGFkb3codGhpcywgInJlc291cmNlcyIsIHJlc291cmNlcyBpbnN0YW5jZW9mIERpY3QgPyByZXNvdXJjZXMgOiBEaWN0LmVtcHR5KTsKICB9CiAgI2dldEJvdW5kaW5nQm94KG5hbWUpIHsKICAgIGlmICh0aGlzLnhmYURhdGEpIHsKICAgICAgcmV0dXJuIHRoaXMueGZhRGF0YS5iYm94OwogICAgfQogICAgY29uc3QgYm94ID0gbG9va3VwTm9ybWFsUmVjdCh0aGlzLiNnZXRJbmhlcml0YWJsZVByb3BlcnR5KG5hbWUsIHRydWUpLCBudWxsKTsKICAgIGlmIChib3gpIHsKICAgICAgaWYgKGJveFsyXSAtIGJveFswXSA+IDAgJiYgYm94WzNdIC0gYm94WzFdID4gMCkgewogICAgICAgIHJldHVybiBib3g7CiAgICAgIH0KICAgICAgd2FybihgRW1wdHksIG9yIGludmFsaWQsIC8ke25hbWV9IGVudHJ5LmApOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIGdldCBtZWRpYUJveCgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgIm1lZGlhQm94IiwgdGhpcy4jZ2V0Qm91bmRpbmdCb3goIk1lZGlhQm94IikgfHwgTEVUVEVSX1NJWkVfTUVESUFCT1gpOwogIH0KICBnZXQgY3JvcEJveCgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImNyb3BCb3giLCB0aGlzLiNnZXRCb3VuZGluZ0JveCgiQ3JvcEJveCIpIHx8IHRoaXMubWVkaWFCb3gpOwogIH0KICBnZXQgdXNlclVuaXQoKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLnBhZ2VEaWN0LmdldCgiVXNlclVuaXQiKTsKICAgIHJldHVybiBzaGFkb3codGhpcywgInVzZXJVbml0IiwgdHlwZW9mIG9iaiA9PT0gIm51bWJlciIgJiYgb2JqID4gMCA/IG9iaiA6IDEuMCk7CiAgfQogIGdldCB2aWV3KCkgewogICAgY29uc3QgewogICAgICBjcm9wQm94LAogICAgICBtZWRpYUJveAogICAgfSA9IHRoaXM7CiAgICBpZiAoY3JvcEJveCAhPT0gbWVkaWFCb3ggJiYgIWlzQXJyYXlFcXVhbChjcm9wQm94LCBtZWRpYUJveCkpIHsKICAgICAgY29uc3QgYm94ID0gVXRpbC5pbnRlcnNlY3QoY3JvcEJveCwgbWVkaWFCb3gpOwogICAgICBpZiAoYm94ICYmIGJveFsyXSAtIGJveFswXSA+IDAgJiYgYm94WzNdIC0gYm94WzFdID4gMCkgewogICAgICAgIHJldHVybiBzaGFkb3codGhpcywgInZpZXciLCBib3gpOwogICAgICB9CiAgICAgIHdhcm4oIkVtcHR5IC9Dcm9wQm94IGFuZCAvTWVkaWFCb3ggaW50ZXJzZWN0aW9uLiIpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAidmlldyIsIG1lZGlhQm94KTsKICB9CiAgZ2V0IHJvdGF0ZSgpIHsKICAgIGxldCByb3RhdGUgPSB0aGlzLiNnZXRJbmhlcml0YWJsZVByb3BlcnR5KCJSb3RhdGUiKSB8fCAwOwogICAgaWYgKHJvdGF0ZSAlIDkwICE9PSAwKSB7CiAgICAgIHJvdGF0ZSA9IDA7CiAgICB9IGVsc2UgaWYgKHJvdGF0ZSA+PSAzNjApIHsKICAgICAgcm90YXRlICU9IDM2MDsKICAgIH0gZWxzZSBpZiAocm90YXRlIDwgMCkgewogICAgICByb3RhdGUgPSAocm90YXRlICUgMzYwICsgMzYwKSAlIDM2MDsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInJvdGF0ZSIsIHJvdGF0ZSk7CiAgfQogICNvblN1YlN0cmVhbUVycm9yKHJlYXNvbiwgb2JqSWQpIHsKICAgIGlmICh0aGlzLmV2YWx1YXRvck9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgIHdhcm4oYGdldENvbnRlbnRTdHJlYW0gLSBpZ25vcmluZyBzdWItc3RyZWFtICgke29iaklkfSk6ICIke3JlYXNvbn0iLmApOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aHJvdyByZWFzb247CiAgfQogIGFzeW5jIGdldENvbnRlbnRTdHJlYW0oKSB7CiAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZSh0aGlzLCAiY29udGVudCIpOwogICAgaWYgKGNvbnRlbnQgaW5zdGFuY2VvZiBCYXNlU3RyZWFtKSB7CiAgICAgIHJldHVybiBjb250ZW50OwogICAgfQogICAgaWYgKEFycmF5LmlzQXJyYXkoY29udGVudCkpIHsKICAgICAgcmV0dXJuIG5ldyBTdHJlYW1zU2VxdWVuY2VTdHJlYW0oY29udGVudCwgdGhpcy4jb25TdWJTdHJlYW1FcnJvci5iaW5kKHRoaXMpKTsKICAgIH0KICAgIHJldHVybiBuZXcgTnVsbFN0cmVhbSgpOwogIH0KICBnZXQgeGZhRGF0YSgpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgInhmYURhdGEiLCB0aGlzLnhmYUZhY3RvcnkgPyB7CiAgICAgIGJib3g6IHRoaXMueGZhRmFjdG9yeS5nZXRCb3VuZGluZ0JveCh0aGlzLnBhZ2VJbmRleCkKICAgIH0gOiBudWxsKTsKICB9CiAgYXN5bmMgI3JlcGxhY2VJZEJ5UmVmKGFubm90YXRpb25zLCBkZWxldGVkQW5ub3RhdGlvbnMsIGV4aXN0aW5nQW5ub3RhdGlvbnMpIHsKICAgIGNvbnN0IHByb21pc2VzID0gW107CiAgICBmb3IgKGNvbnN0IGFubm90YXRpb24gb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgaWYgKGFubm90YXRpb24uaWQpIHsKICAgICAgICBjb25zdCByZWYgPSBSZWYuZnJvbVN0cmluZyhhbm5vdGF0aW9uLmlkKTsKICAgICAgICBpZiAoIXJlZikgewogICAgICAgICAgd2FybihgQSBub24tbGlua2VkIGFubm90YXRpb24gY2Fubm90IGJlIG1vZGlmaWVkOiAke2Fubm90YXRpb24uaWR9YCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGFubm90YXRpb24uZGVsZXRlZCkgewogICAgICAgICAgZGVsZXRlZEFubm90YXRpb25zLnB1dChyZWYsIHJlZik7CiAgICAgICAgICBpZiAoYW5ub3RhdGlvbi5wb3B1cFJlZikgewogICAgICAgICAgICBjb25zdCBwb3B1cFJlZiA9IFJlZi5mcm9tU3RyaW5nKGFubm90YXRpb24ucG9wdXBSZWYpOwogICAgICAgICAgICBpZiAocG9wdXBSZWYpIHsKICAgICAgICAgICAgICBkZWxldGVkQW5ub3RhdGlvbnMucHV0KHBvcHVwUmVmLCBwb3B1cFJlZik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoYW5ub3RhdGlvbi5wb3B1cD8uZGVsZXRlZCkgewogICAgICAgICAgY29uc3QgcG9wdXBSZWYgPSBSZWYuZnJvbVN0cmluZyhhbm5vdGF0aW9uLnBvcHVwUmVmKTsKICAgICAgICAgIGlmIChwb3B1cFJlZikgewogICAgICAgICAgICBkZWxldGVkQW5ub3RhdGlvbnMucHV0KHBvcHVwUmVmLCBwb3B1cFJlZik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGV4aXN0aW5nQW5ub3RhdGlvbnM/LnB1dChyZWYpOwogICAgICAgIGFubm90YXRpb24ucmVmID0gcmVmOwogICAgICAgIHByb21pc2VzLnB1c2godGhpcy54cmVmLmZldGNoQXN5bmMocmVmKS50aGVuKG9iaiA9PiB7CiAgICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgRGljdCkgewogICAgICAgICAgICBhbm5vdGF0aW9uLm9sZEFubm90YXRpb24gPSBvYmouY2xvbmUoKTsKICAgICAgICAgIH0KICAgICAgICB9LCAoKSA9PiB7CiAgICAgICAgICB3YXJuKGBDYW5ub3QgZmV0Y2ggXGBvbGRBbm5vdGF0aW9uXGAgZm9yOiAke3JlZn0uYCk7CiAgICAgICAgfSkpOwogICAgICAgIGRlbGV0ZSBhbm5vdGF0aW9uLmlkOwogICAgICB9CiAgICB9CiAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7CiAgfQogIGFzeW5jIHNhdmVOZXdBbm5vdGF0aW9ucyhoYW5kbGVyLCB0YXNrLCBhbm5vdGF0aW9ucywgaW1hZ2VQcm9taXNlcywgY2hhbmdlcykgewogICAgaWYgKHRoaXMueGZhRmFjdG9yeSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlhGQTogQ2Fubm90IHNhdmUgbmV3IGFubm90YXRpb25zLiIpOwogICAgfQogICAgY29uc3QgcGFydGlhbEV2YWx1YXRvciA9IHRoaXMuI2NyZWF0ZVBhcnRpYWxFdmFsdWF0b3IoaGFuZGxlcik7CiAgICBjb25zdCBkZWxldGVkQW5ub3RhdGlvbnMgPSBuZXcgUmVmU2V0Q2FjaGUoKTsKICAgIGNvbnN0IGV4aXN0aW5nQW5ub3RhdGlvbnMgPSBuZXcgUmVmU2V0KCk7CiAgICBhd2FpdCB0aGlzLiNyZXBsYWNlSWRCeVJlZihhbm5vdGF0aW9ucywgZGVsZXRlZEFubm90YXRpb25zLCBleGlzdGluZ0Fubm90YXRpb25zKTsKICAgIGNvbnN0IHBhZ2VEaWN0ID0gdGhpcy5wYWdlRGljdDsKICAgIGNvbnN0IGFubm90YXRpb25zQXJyYXkgPSB0aGlzLmFubm90YXRpb25zLmZpbHRlcihhID0+ICEoYSBpbnN0YW5jZW9mIFJlZiAmJiBkZWxldGVkQW5ub3RhdGlvbnMuaGFzKGEpKSk7CiAgICBjb25zdCBuZXdEYXRhID0gYXdhaXQgQW5ub3RhdGlvbkZhY3Rvcnkuc2F2ZU5ld0Fubm90YXRpb25zKHBhcnRpYWxFdmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25zLCBpbWFnZVByb21pc2VzLCBjaGFuZ2VzKTsKICAgIGZvciAoY29uc3QgewogICAgICByZWYKICAgIH0gb2YgbmV3RGF0YS5hbm5vdGF0aW9ucykgewogICAgICBpZiAocmVmIGluc3RhbmNlb2YgUmVmICYmICFleGlzdGluZ0Fubm90YXRpb25zLmhhcyhyZWYpKSB7CiAgICAgICAgYW5ub3RhdGlvbnNBcnJheS5wdXNoKHJlZik7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGRpY3QgPSBwYWdlRGljdC5jbG9uZSgpOwogICAgZGljdC5zZXQoIkFubm90cyIsIGFubm90YXRpb25zQXJyYXkpOwogICAgY2hhbmdlcy5wdXQodGhpcy5yZWYsIHsKICAgICAgZGF0YTogZGljdAogICAgfSk7CiAgICBmb3IgKGNvbnN0IGRlbGV0ZWRSZWYgb2YgZGVsZXRlZEFubm90YXRpb25zKSB7CiAgICAgIGNoYW5nZXMucHV0KGRlbGV0ZWRSZWYsIHsKICAgICAgICBkYXRhOiBudWxsCiAgICAgIH0pOwogICAgfQogIH0KICBhc3luYyBzYXZlKGhhbmRsZXIsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlLCBjaGFuZ2VzKSB7CiAgICBjb25zdCBwYXJ0aWFsRXZhbHVhdG9yID0gdGhpcy4jY3JlYXRlUGFydGlhbEV2YWx1YXRvcihoYW5kbGVyKTsKICAgIGNvbnN0IGFubm90YXRpb25zID0gYXdhaXQgdGhpcy5fcGFyc2VkQW5ub3RhdGlvbnM7CiAgICBjb25zdCBwcm9taXNlcyA9IFtdOwogICAgZm9yIChjb25zdCBhbm5vdGF0aW9uIG9mIGFubm90YXRpb25zKSB7CiAgICAgIHByb21pc2VzLnB1c2goYW5ub3RhdGlvbi5zYXZlKHBhcnRpYWxFdmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlLCBjaGFuZ2VzKS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgd2Fybigic2F2ZSAtIGlnbm9yaW5nIGFubm90YXRpb24gZGF0YSBkdXJpbmcgIiArIGAiJHt0YXNrLm5hbWV9IiB0YXNrOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfSkpOwogICAgfQogICAgcmV0dXJuIFByb21pc2UuYWxsKHByb21pc2VzKTsKICB9CiAgYXN5bmMgbG9hZFJlc291cmNlcyhrZXlzKSB7CiAgICBhd2FpdCAodGhpcy4jcmVzb3VyY2VzUHJvbWlzZSA/Pz0gdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZSh0aGlzLCAicmVzb3VyY2VzIikpOwogICAgYXdhaXQgT2JqZWN0TG9hZGVyLmxvYWQodGhpcy5yZXNvdXJjZXMsIGtleXMsIHRoaXMueHJlZik7CiAgfQogIGFzeW5jICNnZXRNZXJnZWRSZXNvdXJjZXMoc3RyZWFtRGljdCwga2V5cykgewogICAgY29uc3QgbG9jYWxSZXNvdXJjZXMgPSBzdHJlYW1EaWN0Py5nZXQoIlJlc291cmNlcyIpOwogICAgaWYgKCEobG9jYWxSZXNvdXJjZXMgaW5zdGFuY2VvZiBEaWN0ICYmIGxvY2FsUmVzb3VyY2VzLnNpemUpKSB7CiAgICAgIHJldHVybiB0aGlzLnJlc291cmNlczsKICAgIH0KICAgIGF3YWl0IE9iamVjdExvYWRlci5sb2FkKGxvY2FsUmVzb3VyY2VzLCBrZXlzLCB0aGlzLnhyZWYpOwogICAgcmV0dXJuIERpY3QubWVyZ2UoewogICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgIGRpY3RBcnJheTogW2xvY2FsUmVzb3VyY2VzLCB0aGlzLnJlc291cmNlc10sCiAgICAgIG1lcmdlU3ViRGljdHM6IHRydWUKICAgIH0pOwogIH0KICBhc3luYyBnZXRPcGVyYXRvckxpc3QoewogICAgaGFuZGxlciwKICAgIHNpbmssCiAgICB0YXNrLAogICAgaW50ZW50LAogICAgY2FjaGVLZXksCiAgICBhbm5vdGF0aW9uU3RvcmFnZSA9IG51bGwsCiAgICBtb2RpZmllZElkcyA9IG51bGwKICB9KSB7CiAgICBjb25zdCBjb250ZW50U3RyZWFtUHJvbWlzZSA9IHRoaXMuZ2V0Q29udGVudFN0cmVhbSgpOwogICAgY29uc3QgcmVzb3VyY2VzUHJvbWlzZSA9IHRoaXMubG9hZFJlc291cmNlcyhSRVNPVVJDRVNfS0VZU19PUEVSQVRPUl9MSVNUKTsKICAgIGNvbnN0IHBhcnRpYWxFdmFsdWF0b3IgPSB0aGlzLiNjcmVhdGVQYXJ0aWFsRXZhbHVhdG9yKGhhbmRsZXIpOwogICAgY29uc3QgbmV3QW5ub3RzQnlQYWdlID0gIXRoaXMueGZhRmFjdG9yeSA/IGdldE5ld0Fubm90YXRpb25zTWFwKGFubm90YXRpb25TdG9yYWdlKSA6IG51bGw7CiAgICBjb25zdCBuZXdBbm5vdHMgPSBuZXdBbm5vdHNCeVBhZ2U/LmdldCh0aGlzLnBhZ2VJbmRleCk7CiAgICBsZXQgbmV3QW5ub3RhdGlvbnNQcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKG51bGwpOwogICAgbGV0IGRlbGV0ZWRBbm5vdGF0aW9ucyA9IG51bGw7CiAgICBpZiAobmV3QW5ub3RzKSB7CiAgICAgIGNvbnN0IGFubm90YXRpb25HbG9iYWxzUHJvbWlzZSA9IHRoaXMucGRmTWFuYWdlci5lbnN1cmVEb2MoImFubm90YXRpb25HbG9iYWxzIik7CiAgICAgIGxldCBpbWFnZVByb21pc2VzOwogICAgICBjb25zdCBtaXNzaW5nQml0bWFwcyA9IG5ldyBTZXQoKTsKICAgICAgZm9yIChjb25zdCB7CiAgICAgICAgYml0bWFwSWQsCiAgICAgICAgYml0bWFwCiAgICAgIH0gb2YgbmV3QW5ub3RzKSB7CiAgICAgICAgaWYgKGJpdG1hcElkICYmICFiaXRtYXAgJiYgIW1pc3NpbmdCaXRtYXBzLmhhcyhiaXRtYXBJZCkpIHsKICAgICAgICAgIG1pc3NpbmdCaXRtYXBzLmFkZChiaXRtYXBJZCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHsKICAgICAgICBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZAogICAgICB9ID0gdGhpcy5ldmFsdWF0b3JPcHRpb25zOwogICAgICBpZiAobWlzc2luZ0JpdG1hcHMuc2l6ZSA+IDApIHsKICAgICAgICBjb25zdCBhbm5vdGF0aW9uV2l0aEJpdG1hcHMgPSBuZXdBbm5vdHMuc2xpY2UoKTsKICAgICAgICBmb3IgKGNvbnN0IFtrZXksIGFubm90YXRpb25dIG9mIGFubm90YXRpb25TdG9yYWdlKSB7CiAgICAgICAgICBpZiAoIWtleS5zdGFydHNXaXRoKEFubm90YXRpb25FZGl0b3JQcmVmaXgpKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGFubm90YXRpb24uYml0bWFwICYmIG1pc3NpbmdCaXRtYXBzLmhhcyhhbm5vdGF0aW9uLmJpdG1hcElkKSkgewogICAgICAgICAgICBhbm5vdGF0aW9uV2l0aEJpdG1hcHMucHVzaChhbm5vdGF0aW9uKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaW1hZ2VQcm9taXNlcyA9IEFubm90YXRpb25GYWN0b3J5LmdlbmVyYXRlSW1hZ2VzKGFubm90YXRpb25XaXRoQml0bWFwcywgdGhpcy54cmVmLCBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaW1hZ2VQcm9taXNlcyA9IEFubm90YXRpb25GYWN0b3J5LmdlbmVyYXRlSW1hZ2VzKG5ld0Fubm90cywgdGhpcy54cmVmLCBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCk7CiAgICAgIH0KICAgICAgZGVsZXRlZEFubm90YXRpb25zID0gbmV3IFJlZlNldCgpOwogICAgICBuZXdBbm5vdGF0aW9uc1Byb21pc2UgPSBQcm9taXNlLmFsbChbYW5ub3RhdGlvbkdsb2JhbHNQcm9taXNlLCB0aGlzLiNyZXBsYWNlSWRCeVJlZihuZXdBbm5vdHMsIGRlbGV0ZWRBbm5vdGF0aW9ucywgbnVsbCldKS50aGVuKChbYW5ub3RhdGlvbkdsb2JhbHNdKSA9PiB7CiAgICAgICAgaWYgKCFhbm5vdGF0aW9uR2xvYmFscykgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBBbm5vdGF0aW9uRmFjdG9yeS5wcmludE5ld0Fubm90YXRpb25zKGFubm90YXRpb25HbG9iYWxzLCBwYXJ0aWFsRXZhbHVhdG9yLCB0YXNrLCBuZXdBbm5vdHMsIGltYWdlUHJvbWlzZXMpOwogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHBhZ2VMaXN0UHJvbWlzZSA9IFByb21pc2UuYWxsKFtjb250ZW50U3RyZWFtUHJvbWlzZSwgcmVzb3VyY2VzUHJvbWlzZV0pLnRoZW4oYXN5bmMgKFtjb250ZW50U3RyZWFtXSkgPT4gewogICAgICBjb25zdCByZXNvdXJjZXMgPSBhd2FpdCB0aGlzLiNnZXRNZXJnZWRSZXNvdXJjZXMoY29udGVudFN0cmVhbS5kaWN0LCBSRVNPVVJDRVNfS0VZU19PUEVSQVRPUl9MSVNUKTsKICAgICAgY29uc3Qgb3BMaXN0ID0gbmV3IE9wZXJhdG9yTGlzdChpbnRlbnQsIHNpbmspOwogICAgICBoYW5kbGVyLnNlbmQoIlN0YXJ0UmVuZGVyUGFnZSIsIHsKICAgICAgICB0cmFuc3BhcmVuY3k6IHBhcnRpYWxFdmFsdWF0b3IuaGFzQmxlbmRNb2RlcyhyZXNvdXJjZXMsIHRoaXMubm9uQmxlbmRNb2Rlc1NldCksCiAgICAgICAgcGFnZUluZGV4OiB0aGlzLnBhZ2VJbmRleCwKICAgICAgICBjYWNoZUtleQogICAgICB9KTsKICAgICAgYXdhaXQgcGFydGlhbEV2YWx1YXRvci5nZXRPcGVyYXRvckxpc3QoewogICAgICAgIHN0cmVhbTogY29udGVudFN0cmVhbSwKICAgICAgICB0YXNrLAogICAgICAgIHJlc291cmNlcywKICAgICAgICBvcGVyYXRvckxpc3Q6IG9wTGlzdAogICAgICB9KTsKICAgICAgcmV0dXJuIG9wTGlzdDsKICAgIH0pOwogICAgbGV0IFtwYWdlT3BMaXN0LCBhbm5vdGF0aW9ucywgbmV3QW5ub3RhdGlvbnNdID0gYXdhaXQgUHJvbWlzZS5hbGwoW3BhZ2VMaXN0UHJvbWlzZSwgdGhpcy5fcGFyc2VkQW5ub3RhdGlvbnMsIG5ld0Fubm90YXRpb25zUHJvbWlzZV0pOwogICAgaWYgKG5ld0Fubm90YXRpb25zKSB7CiAgICAgIGFubm90YXRpb25zID0gYW5ub3RhdGlvbnMuZmlsdGVyKGEgPT4gIShhLnJlZiAmJiBkZWxldGVkQW5ub3RhdGlvbnMuaGFzKGEucmVmKSkpOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBuZXdBbm5vdGF0aW9ucy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgbmV3QW5ub3RhdGlvbiA9IG5ld0Fubm90YXRpb25zW2ldOwogICAgICAgIGlmIChuZXdBbm5vdGF0aW9uLnJlZlRvUmVwbGFjZSkgewogICAgICAgICAgY29uc3QgaiA9IGFubm90YXRpb25zLmZpbmRJbmRleChhID0+IGEucmVmICYmIGlzUmVmc0VxdWFsKGEucmVmLCBuZXdBbm5vdGF0aW9uLnJlZlRvUmVwbGFjZSkpOwogICAgICAgICAgaWYgKGogPj0gMCkgewogICAgICAgICAgICBhbm5vdGF0aW9ucy5zcGxpY2UoaiwgMSwgbmV3QW5ub3RhdGlvbik7CiAgICAgICAgICAgIG5ld0Fubm90YXRpb25zLnNwbGljZShpLS0sIDEpOwogICAgICAgICAgICBpaS0tOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBhbm5vdGF0aW9ucyA9IGFubm90YXRpb25zLmNvbmNhdChuZXdBbm5vdGF0aW9ucyk7CiAgICB9CiAgICBpZiAoYW5ub3RhdGlvbnMubGVuZ3RoID09PSAwIHx8IGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuQU5OT1RBVElPTlNfRElTQUJMRSkgewogICAgICBwYWdlT3BMaXN0LmZsdXNoKHRydWUpOwogICAgICByZXR1cm4gewogICAgICAgIGxlbmd0aDogcGFnZU9wTGlzdC50b3RhbExlbmd0aAogICAgICB9OwogICAgfQogICAgY29uc3QgcmVuZGVyRm9ybXMgPSAhIShpbnRlbnQgJiBSZW5kZXJpbmdJbnRlbnRGbGFnLkFOTk9UQVRJT05TX0ZPUk1TKSwKICAgICAgaXNFZGl0aW5nID0gISEoaW50ZW50ICYgUmVuZGVyaW5nSW50ZW50RmxhZy5JU19FRElUSU5HKSwKICAgICAgaW50ZW50QW55ID0gISEoaW50ZW50ICYgUmVuZGVyaW5nSW50ZW50RmxhZy5BTlkpLAogICAgICBpbnRlbnREaXNwbGF5ID0gISEoaW50ZW50ICYgUmVuZGVyaW5nSW50ZW50RmxhZy5ESVNQTEFZKSwKICAgICAgaW50ZW50UHJpbnQgPSAhIShpbnRlbnQgJiBSZW5kZXJpbmdJbnRlbnRGbGFnLlBSSU5UKTsKICAgIGNvbnN0IG9wTGlzdFByb21pc2VzID0gW107CiAgICBmb3IgKGNvbnN0IGFubm90YXRpb24gb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgaWYgKGludGVudEFueSB8fCBpbnRlbnREaXNwbGF5ICYmIGFubm90YXRpb24ubXVzdEJlVmlld2VkKGFubm90YXRpb25TdG9yYWdlLCByZW5kZXJGb3JtcykgJiYgYW5ub3RhdGlvbi5tdXN0QmVWaWV3ZWRXaGVuRWRpdGluZyhpc0VkaXRpbmcsIG1vZGlmaWVkSWRzKSB8fCBpbnRlbnRQcmludCAmJiBhbm5vdGF0aW9uLm11c3RCZVByaW50ZWQoYW5ub3RhdGlvblN0b3JhZ2UpKSB7CiAgICAgICAgb3BMaXN0UHJvbWlzZXMucHVzaChhbm5vdGF0aW9uLmdldE9wZXJhdG9yTGlzdChwYXJ0aWFsRXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICB3YXJuKCJnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBhbm5vdGF0aW9uIGRhdGEgZHVyaW5nICIgKyBgIiR7dGFzay5uYW1lfSIgdGFzazogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvcExpc3Q6IG51bGwsCiAgICAgICAgICAgIHNlcGFyYXRlRm9ybTogZmFsc2UsCiAgICAgICAgICAgIHNlcGFyYXRlQ2FudmFzOiBmYWxzZQogICAgICAgICAgfTsKICAgICAgICB9KSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IG9wTGlzdHMgPSBhd2FpdCBQcm9taXNlLmFsbChvcExpc3RQcm9taXNlcyk7CiAgICBsZXQgZm9ybSA9IGZhbHNlLAogICAgICBjYW52YXMgPSBmYWxzZTsKICAgIGZvciAoY29uc3QgewogICAgICBvcExpc3QsCiAgICAgIHNlcGFyYXRlRm9ybSwKICAgICAgc2VwYXJhdGVDYW52YXMKICAgIH0gb2Ygb3BMaXN0cykgewogICAgICBwYWdlT3BMaXN0LmFkZE9wTGlzdChvcExpc3QpOwogICAgICBmb3JtIHx8PSBzZXBhcmF0ZUZvcm07CiAgICAgIGNhbnZhcyB8fD0gc2VwYXJhdGVDYW52YXM7CiAgICB9CiAgICBwYWdlT3BMaXN0LmZsdXNoKHRydWUsIHsKICAgICAgZm9ybSwKICAgICAgY2FudmFzCiAgICB9KTsKICAgIHJldHVybiB7CiAgICAgIGxlbmd0aDogcGFnZU9wTGlzdC50b3RhbExlbmd0aAogICAgfTsKICB9CiAgYXN5bmMgZXh0cmFjdFRleHRDb250ZW50KHsKICAgIGhhbmRsZXIsCiAgICB0YXNrLAogICAgaW5jbHVkZU1hcmtlZENvbnRlbnQsCiAgICBkaXNhYmxlTm9ybWFsaXphdGlvbiwKICAgIHNpbmssCiAgICBpbnRlcnNlY3RvciA9IG51bGwKICB9KSB7CiAgICBjb25zdCBjb250ZW50U3RyZWFtUHJvbWlzZSA9IHRoaXMuZ2V0Q29udGVudFN0cmVhbSgpOwogICAgY29uc3QgcmVzb3VyY2VzUHJvbWlzZSA9IHRoaXMubG9hZFJlc291cmNlcyhSRVNPVVJDRVNfS0VZU19URVhUX0NPTlRFTlQpOwogICAgY29uc3QgbGFuZ1Byb21pc2UgPSB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygibGFuZyIpOwogICAgY29uc3QgW2NvbnRlbnRTdHJlYW0sLCBsYW5nXSA9IGF3YWl0IFByb21pc2UuYWxsKFtjb250ZW50U3RyZWFtUHJvbWlzZSwgcmVzb3VyY2VzUHJvbWlzZSwgbGFuZ1Byb21pc2VdKTsKICAgIGNvbnN0IHJlc291cmNlcyA9IGF3YWl0IHRoaXMuI2dldE1lcmdlZFJlc291cmNlcyhjb250ZW50U3RyZWFtLmRpY3QsIFJFU09VUkNFU19LRVlTX1RFWFRfQ09OVEVOVCk7CiAgICBjb25zdCBwYXJ0aWFsRXZhbHVhdG9yID0gdGhpcy4jY3JlYXRlUGFydGlhbEV2YWx1YXRvcihoYW5kbGVyKTsKICAgIHJldHVybiBwYXJ0aWFsRXZhbHVhdG9yLmdldFRleHRDb250ZW50KHsKICAgICAgc3RyZWFtOiBjb250ZW50U3RyZWFtLAogICAgICB0YXNrLAogICAgICByZXNvdXJjZXMsCiAgICAgIGluY2x1ZGVNYXJrZWRDb250ZW50LAogICAgICBkaXNhYmxlTm9ybWFsaXphdGlvbiwKICAgICAgc2luaywKICAgICAgdmlld0JveDogdGhpcy52aWV3LAogICAgICBsYW5nLAogICAgICBpbnRlcnNlY3RvcgogICAgfSk7CiAgfQogIGFzeW5jIGdldFN0cnVjdFRyZWUoKSB7CiAgICBjb25zdCBzdHJ1Y3RUcmVlUm9vdCA9IGF3YWl0IHRoaXMucGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJzdHJ1Y3RUcmVlUm9vdCIpOwogICAgaWYgKCFzdHJ1Y3RUcmVlUm9vdCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGF3YWl0IHRoaXMuX3BhcnNlZEFubm90YXRpb25zOwogICAgdHJ5IHsKICAgICAgY29uc3Qgc3RydWN0VHJlZSA9IGF3YWl0IHRoaXMucGRmTWFuYWdlci5lbnN1cmUodGhpcywgIl9wYXJzZVN0cnVjdFRyZWUiLCBbc3RydWN0VHJlZVJvb3RdKTsKICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMucGRmTWFuYWdlci5lbnN1cmUoc3RydWN0VHJlZSwgInNlcmlhbGl6YWJsZSIpOwogICAgICByZXR1cm4gZGF0YTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIHdhcm4oYGdldFN0cnVjdFRyZWU6ICIke2V4fSIuYCk7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0KICBfcGFyc2VTdHJ1Y3RUcmVlKHN0cnVjdFRyZWVSb290KSB7CiAgICBjb25zdCB0cmVlID0gbmV3IFN0cnVjdFRyZWVQYWdlKHN0cnVjdFRyZWVSb290LCB0aGlzLnBhZ2VEaWN0KTsKICAgIHRyZWUucGFyc2UodGhpcy5yZWYpOwogICAgcmV0dXJuIHRyZWU7CiAgfQogIGFzeW5jIGdldEFubm90YXRpb25zRGF0YShoYW5kbGVyLCB0YXNrLCBpbnRlbnQpIHsKICAgIGNvbnN0IGFubm90YXRpb25zID0gYXdhaXQgdGhpcy5fcGFyc2VkQW5ub3RhdGlvbnM7CiAgICBpZiAoYW5ub3RhdGlvbnMubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBhbm5vdGF0aW9uczsKICAgIH0KICAgIGNvbnN0IGFubm90YXRpb25zRGF0YSA9IFtdLAogICAgICB0ZXh0Q29udGVudFByb21pc2VzID0gW107CiAgICBsZXQgcGFydGlhbEV2YWx1YXRvcjsKICAgIGNvbnN0IGludGVudEFueSA9ICEhKGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuQU5ZKSwKICAgICAgaW50ZW50RGlzcGxheSA9ICEhKGludGVudCAmIFJlbmRlcmluZ0ludGVudEZsYWcuRElTUExBWSksCiAgICAgIGludGVudFByaW50ID0gISEoaW50ZW50ICYgUmVuZGVyaW5nSW50ZW50RmxhZy5QUklOVCk7CiAgICBjb25zdCBoaWdobGlnaHRlZEFubm90YXRpb25zID0gW107CiAgICBmb3IgKGNvbnN0IGFubm90YXRpb24gb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgY29uc3QgaXNWaXNpYmxlID0gaW50ZW50QW55IHx8IGludGVudERpc3BsYXkgJiYgYW5ub3RhdGlvbi52aWV3YWJsZTsKICAgICAgaWYgKGlzVmlzaWJsZSB8fCBpbnRlbnRQcmludCAmJiBhbm5vdGF0aW9uLnByaW50YWJsZSkgewogICAgICAgIGFubm90YXRpb25zRGF0YS5wdXNoKGFubm90YXRpb24uZGF0YSk7CiAgICAgIH0KICAgICAgaWYgKGFubm90YXRpb24uaGFzVGV4dENvbnRlbnQgJiYgaXNWaXNpYmxlKSB7CiAgICAgICAgcGFydGlhbEV2YWx1YXRvciA/Pz0gdGhpcy4jY3JlYXRlUGFydGlhbEV2YWx1YXRvcihoYW5kbGVyKTsKICAgICAgICB0ZXh0Q29udGVudFByb21pc2VzLnB1c2goYW5ub3RhdGlvbi5leHRyYWN0VGV4dENvbnRlbnQocGFydGlhbEV2YWx1YXRvciwgdGFzaywgWy1JbmZpbml0eSwgLUluZmluaXR5LCBJbmZpbml0eSwgSW5maW5pdHldKS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICB3YXJuKGBnZXRBbm5vdGF0aW9uc0RhdGEgLSBpZ25vcmluZyB0ZXh0Q29udGVudCBkdXJpbmcgIiR7dGFzay5uYW1lfSIgdGFzazogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgfSkpOwogICAgICB9IGVsc2UgaWYgKGFubm90YXRpb24ub3ZlcmxheXNUZXh0Q29udGVudCAmJiBpc1Zpc2libGUpIHsKICAgICAgICBoaWdobGlnaHRlZEFubm90YXRpb25zLnB1c2goYW5ub3RhdGlvbik7CiAgICAgIH0KICAgIH0KICAgIGlmIChoaWdobGlnaHRlZEFubm90YXRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgaW50ZXJzZWN0b3IgPSBuZXcgSW50ZXJzZWN0b3IoaGlnaGxpZ2h0ZWRBbm5vdGF0aW9ucyk7CiAgICAgIHRleHRDb250ZW50UHJvbWlzZXMucHVzaCh0aGlzLmV4dHJhY3RUZXh0Q29udGVudCh7CiAgICAgICAgaGFuZGxlciwKICAgICAgICB0YXNrLAogICAgICAgIGluY2x1ZGVNYXJrZWRDb250ZW50OiBmYWxzZSwKICAgICAgICBkaXNhYmxlTm9ybWFsaXphdGlvbjogZmFsc2UsCiAgICAgICAgc2luazogbnVsbCwKICAgICAgICB2aWV3Qm94OiB0aGlzLnZpZXcsCiAgICAgICAgbGFuZzogbnVsbCwKICAgICAgICBpbnRlcnNlY3RvcgogICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICBpbnRlcnNlY3Rvci5zZXRUZXh0KCk7CiAgICAgIH0pKTsKICAgIH0KICAgIGF3YWl0IFByb21pc2UuYWxsKHRleHRDb250ZW50UHJvbWlzZXMpOwogICAgcmV0dXJuIGFubm90YXRpb25zRGF0YTsKICB9CiAgZ2V0IGFubm90YXRpb25zKCkgewogICAgY29uc3QgYW5ub3RzID0gdGhpcy4jZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSgiQW5ub3RzIik7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJhbm5vdGF0aW9ucyIsIEFycmF5LmlzQXJyYXkoYW5ub3RzKSA/IGFubm90cyA6IFtdKTsKICB9CiAgZ2V0IF9wYXJzZWRBbm5vdGF0aW9ucygpIHsKICAgIGNvbnN0IHByb21pc2UgPSB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlKHRoaXMsICJhbm5vdGF0aW9ucyIpLnRoZW4oYXN5bmMgYW5ub3RzID0+IHsKICAgICAgaWYgKGFubm90cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gYW5ub3RzOwogICAgICB9CiAgICAgIGNvbnN0IFthbm5vdGF0aW9uR2xvYmFscywgZmllbGRPYmplY3RzXSA9IGF3YWl0IFByb21pc2UuYWxsKFt0aGlzLnBkZk1hbmFnZXIuZW5zdXJlRG9jKCJhbm5vdGF0aW9uR2xvYmFscyIpLCB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlRG9jKCJmaWVsZE9iamVjdHMiKV0pOwogICAgICBpZiAoIWFubm90YXRpb25HbG9iYWxzKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICAgIGNvbnN0IG9ycGhhbkZpZWxkcyA9IGZpZWxkT2JqZWN0cz8ub3JwaGFuRmllbGRzOwogICAgICBjb25zdCBhbm5vdGF0aW9uUHJvbWlzZXMgPSBbXTsKICAgICAgZm9yIChjb25zdCBhbm5vdGF0aW9uUmVmIG9mIGFubm90cykgewogICAgICAgIGFubm90YXRpb25Qcm9taXNlcy5wdXNoKEFubm90YXRpb25GYWN0b3J5LmNyZWF0ZSh0aGlzLnhyZWYsIGFubm90YXRpb25SZWYsIGFubm90YXRpb25HbG9iYWxzLCB0aGlzLl9sb2NhbElkRmFjdG9yeSwgZmFsc2UsIG9ycGhhbkZpZWxkcywgdGhpcy5yZWYpLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIHdhcm4oYF9wYXJzZWRBbm5vdGF0aW9uczogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9KSk7CiAgICAgIH0KICAgICAgY29uc3Qgc29ydGVkQW5ub3RhdGlvbnMgPSBbXTsKICAgICAgbGV0IHBvcHVwQW5ub3RhdGlvbnMsIHdpZGdldEFubm90YXRpb25zOwogICAgICBmb3IgKGNvbnN0IGFubm90YXRpb24gb2YgYXdhaXQgUHJvbWlzZS5hbGwoYW5ub3RhdGlvblByb21pc2VzKSkgewogICAgICAgIGlmICghYW5ub3RhdGlvbikgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmIChhbm5vdGF0aW9uIGluc3RhbmNlb2YgV2lkZ2V0QW5ub3RhdGlvbikgewogICAgICAgICAgKHdpZGdldEFubm90YXRpb25zIHx8PSBbXSkucHVzaChhbm5vdGF0aW9uKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoYW5ub3RhdGlvbiBpbnN0YW5jZW9mIFBvcHVwQW5ub3RhdGlvbikgewogICAgICAgICAgKHBvcHVwQW5ub3RhdGlvbnMgfHw9IFtdKS5wdXNoKGFubm90YXRpb24pOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHNvcnRlZEFubm90YXRpb25zLnB1c2goYW5ub3RhdGlvbik7CiAgICAgIH0KICAgICAgaWYgKHdpZGdldEFubm90YXRpb25zKSB7CiAgICAgICAgc29ydGVkQW5ub3RhdGlvbnMucHVzaCguLi53aWRnZXRBbm5vdGF0aW9ucyk7CiAgICAgIH0KICAgICAgaWYgKHBvcHVwQW5ub3RhdGlvbnMpIHsKICAgICAgICBzb3J0ZWRBbm5vdGF0aW9ucy5wdXNoKC4uLnBvcHVwQW5ub3RhdGlvbnMpOwogICAgICB9CiAgICAgIHJldHVybiBzb3J0ZWRBbm5vdGF0aW9uczsKICAgIH0pOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiX3BhcnNlZEFubm90YXRpb25zIiwgcHJvbWlzZSk7CiAgfQogIGdldCBqc0FjdGlvbnMoKSB7CiAgICBjb25zdCBhY3Rpb25zID0gY29sbGVjdEFjdGlvbnModGhpcy54cmVmLCB0aGlzLnBhZ2VEaWN0LCBQYWdlQWN0aW9uRXZlbnRUeXBlKTsKICAgIHJldHVybiBzaGFkb3codGhpcywgImpzQWN0aW9ucyIsIGFjdGlvbnMpOwogIH0KfQpjb25zdCBQREZfSEVBREVSX1NJR05BVFVSRSA9IG5ldyBVaW50OEFycmF5KFsweDI1LCAweDUwLCAweDQ0LCAweDQ2LCAweDJkXSk7CmNvbnN0IFNUQVJUWFJFRl9TSUdOQVRVUkUgPSBuZXcgVWludDhBcnJheShbMHg3MywgMHg3NCwgMHg2MSwgMHg3MiwgMHg3NCwgMHg3OCwgMHg3MiwgMHg2NSwgMHg2Nl0pOwpjb25zdCBFTkRPQkpfU0lHTkFUVVJFID0gbmV3IFVpbnQ4QXJyYXkoWzB4NjUsIDB4NmUsIDB4NjQsIDB4NmYsIDB4NjIsIDB4NmFdKTsKZnVuY3Rpb24gZmluZChzdHJlYW0sIHNpZ25hdHVyZSwgbGltaXQgPSAxMDI0LCBiYWNrd2FyZHMgPSBmYWxzZSkgewogIGNvbnN0IHNpZ25hdHVyZUxlbmd0aCA9IHNpZ25hdHVyZS5sZW5ndGg7CiAgY29uc3Qgc2NhbkJ5dGVzID0gc3RyZWFtLnBlZWtCeXRlcyhsaW1pdCk7CiAgY29uc3Qgc2Nhbkxlbmd0aCA9IHNjYW5CeXRlcy5sZW5ndGggLSBzaWduYXR1cmVMZW5ndGg7CiAgaWYgKHNjYW5MZW5ndGggPD0gMCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBpZiAoYmFja3dhcmRzKSB7CiAgICBjb25zdCBzaWduYXR1cmVFbmQgPSBzaWduYXR1cmVMZW5ndGggLSAxOwogICAgbGV0IHBvcyA9IHNjYW5CeXRlcy5sZW5ndGggLSAxOwogICAgd2hpbGUgKHBvcyA+PSBzaWduYXR1cmVFbmQpIHsKICAgICAgbGV0IGogPSAwOwogICAgICB3aGlsZSAoaiA8IHNpZ25hdHVyZUxlbmd0aCAmJiBzY2FuQnl0ZXNbcG9zIC0gal0gPT09IHNpZ25hdHVyZVtzaWduYXR1cmVFbmQgLSBqXSkgewogICAgICAgIGorKzsKICAgICAgfQogICAgICBpZiAoaiA+PSBzaWduYXR1cmVMZW5ndGgpIHsKICAgICAgICBzdHJlYW0ucG9zICs9IHBvcyAtIHNpZ25hdHVyZUVuZDsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBwb3MtLTsKICAgIH0KICB9IGVsc2UgewogICAgbGV0IHBvcyA9IDA7CiAgICB3aGlsZSAocG9zIDw9IHNjYW5MZW5ndGgpIHsKICAgICAgbGV0IGogPSAwOwogICAgICB3aGlsZSAoaiA8IHNpZ25hdHVyZUxlbmd0aCAmJiBzY2FuQnl0ZXNbcG9zICsgal0gPT09IHNpZ25hdHVyZVtqXSkgewogICAgICAgIGorKzsKICAgICAgfQogICAgICBpZiAoaiA+PSBzaWduYXR1cmVMZW5ndGgpIHsKICAgICAgICBzdHJlYW0ucG9zICs9IHBvczsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBwb3MrKzsKICAgIH0KICB9CiAgcmV0dXJuIGZhbHNlOwp9CmNsYXNzIFBERkRvY3VtZW50IHsKICAjcGFnZVByb21pc2VzID0gbmV3IE1hcCgpOwogICN2ZXJzaW9uID0gbnVsbDsKICBjb25zdHJ1Y3RvcihwZGZNYW5hZ2VyLCBzdHJlYW0pIHsKICAgIGlmIChzdHJlYW0ubGVuZ3RoIDw9IDApIHsKICAgICAgdGhyb3cgbmV3IEludmFsaWRQREZFeGNlcHRpb24oIlRoZSBQREYgZmlsZSBpcyBlbXB0eSwgaS5lLiBpdHMgc2l6ZSBpcyB6ZXJvIGJ5dGVzLiIpOwogICAgfQogICAgdGhpcy5wZGZNYW5hZ2VyID0gcGRmTWFuYWdlcjsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy54cmVmID0gbmV3IFhSZWYoc3RyZWFtLCBwZGZNYW5hZ2VyKTsKICAgIGNvbnN0IGlkQ291bnRlcnMgPSB7CiAgICAgIGZvbnQ6IDAKICAgIH07CiAgICB0aGlzLl9nbG9iYWxJZEZhY3RvcnkgPSBjbGFzcyB7CiAgICAgIHN0YXRpYyBnZXREb2NJZCgpIHsKICAgICAgICByZXR1cm4gYGdfJHtwZGZNYW5hZ2VyLmRvY0lkfWA7CiAgICAgIH0KICAgICAgc3RhdGljIGNyZWF0ZUZvbnRJZCgpIHsKICAgICAgICByZXR1cm4gYGYkeysraWRDb3VudGVycy5mb250fWA7CiAgICAgIH0KICAgICAgc3RhdGljIGNyZWF0ZU9iaklkKCkgewogICAgICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYGNyZWF0ZU9iaklkYCBjYWxsZWQuIik7CiAgICAgIH0KICAgICAgc3RhdGljIGdldFBhZ2VPYmpJZCgpIHsKICAgICAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBnZXRQYWdlT2JqSWRgIGNhbGxlZC4iKTsKICAgICAgfQogICAgfTsKICB9CiAgcGFyc2UocmVjb3ZlcnlNb2RlKSB7CiAgICB0aGlzLnhyZWYucGFyc2UocmVjb3ZlcnlNb2RlKTsKICAgIHRoaXMuY2F0YWxvZyA9IG5ldyBDYXRhbG9nKHRoaXMucGRmTWFuYWdlciwgdGhpcy54cmVmKTsKICB9CiAgZ2V0IGxpbmVhcml6YXRpb24oKSB7CiAgICBsZXQgbGluZWFyaXphdGlvbiA9IG51bGw7CiAgICB0cnkgewogICAgICBsaW5lYXJpemF0aW9uID0gTGluZWFyaXphdGlvbi5jcmVhdGUodGhpcy5zdHJlYW0pOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBNaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGVycjsKICAgICAgfQogICAgICBpbmZvKGVycik7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJsaW5lYXJpemF0aW9uIiwgbGluZWFyaXphdGlvbik7CiAgfQogIGdldCBzdGFydFhSZWYoKSB7CiAgICBjb25zdCBzdHJlYW0gPSB0aGlzLnN0cmVhbTsKICAgIGxldCBzdGFydFhSZWYgPSAwOwogICAgaWYgKHRoaXMubGluZWFyaXphdGlvbikgewogICAgICBzdHJlYW0ucmVzZXQoKTsKICAgICAgaWYgKGZpbmQoc3RyZWFtLCBFTkRPQkpfU0lHTkFUVVJFKSkgewogICAgICAgIHN0cmVhbS5za2lwKDYpOwogICAgICAgIGxldCBjaCA9IHN0cmVhbS5wZWVrQnl0ZSgpOwogICAgICAgIHdoaWxlIChpc1doaXRlU3BhY2UoY2gpKSB7CiAgICAgICAgICBzdHJlYW0ucG9zKys7CiAgICAgICAgICBjaCA9IHN0cmVhbS5wZWVrQnl0ZSgpOwogICAgICAgIH0KICAgICAgICBzdGFydFhSZWYgPSBzdHJlYW0ucG9zIC0gc3RyZWFtLnN0YXJ0OwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb25zdCBzdGVwID0gMTAyNDsKICAgICAgY29uc3Qgc3RhcnRYUmVmTGVuZ3RoID0gU1RBUlRYUkVGX1NJR05BVFVSRS5sZW5ndGg7CiAgICAgIGxldCBmb3VuZCA9IGZhbHNlLAogICAgICAgIHBvcyA9IHN0cmVhbS5lbmQ7CiAgICAgIHdoaWxlICghZm91bmQgJiYgcG9zID4gMCkgewogICAgICAgIHBvcyAtPSBzdGVwIC0gc3RhcnRYUmVmTGVuZ3RoOwogICAgICAgIGlmIChwb3MgPCAwKSB7CiAgICAgICAgICBwb3MgPSAwOwogICAgICAgIH0KICAgICAgICBzdHJlYW0ucG9zID0gcG9zOwogICAgICAgIGZvdW5kID0gZmluZChzdHJlYW0sIFNUQVJUWFJFRl9TSUdOQVRVUkUsIHN0ZXAsIHRydWUpOwogICAgICB9CiAgICAgIGlmIChmb3VuZCkgewogICAgICAgIHN0cmVhbS5za2lwKDkpOwogICAgICAgIGxldCBjaDsKICAgICAgICBkbyB7CiAgICAgICAgICBjaCA9IHN0cmVhbS5nZXRCeXRlKCk7CiAgICAgICAgfSB3aGlsZSAoaXNXaGl0ZVNwYWNlKGNoKSk7CiAgICAgICAgbGV0IHN0ciA9ICIiOwogICAgICAgIHdoaWxlIChjaCA+PSAweDIwICYmIGNoIDw9IDB4MzkpIHsKICAgICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTsKICAgICAgICAgIGNoID0gc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgICB9CiAgICAgICAgc3RhcnRYUmVmID0gcGFyc2VJbnQoc3RyLCAxMCk7CiAgICAgICAgaWYgKGlzTmFOKHN0YXJ0WFJlZikpIHsKICAgICAgICAgIHN0YXJ0WFJlZiA9IDA7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJzdGFydFhSZWYiLCBzdGFydFhSZWYpOwogIH0KICBjaGVja0hlYWRlcigpIHsKICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuc3RyZWFtOwogICAgc3RyZWFtLnJlc2V0KCk7CiAgICBpZiAoIWZpbmQoc3RyZWFtLCBQREZfSEVBREVSX1NJR05BVFVSRSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3RyZWFtLm1vdmVTdGFydCgpOwogICAgc3RyZWFtLnNraXAoUERGX0hFQURFUl9TSUdOQVRVUkUubGVuZ3RoKTsKICAgIGxldCB2ZXJzaW9uID0gIiIsCiAgICAgIGNoOwogICAgd2hpbGUgKChjaCA9IHN0cmVhbS5nZXRCeXRlKCkpID4gMHgyMCAmJiB2ZXJzaW9uLmxlbmd0aCA8IDcpIHsKICAgICAgdmVyc2lvbiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTsKICAgIH0KICAgIGlmIChQREZfVkVSU0lPTl9SRUdFWFAudGVzdCh2ZXJzaW9uKSkgewogICAgICB0aGlzLiN2ZXJzaW9uID0gdmVyc2lvbjsKICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oYEludmFsaWQgUERGIGhlYWRlciB2ZXJzaW9uOiAke3ZlcnNpb259YCk7CiAgICB9CiAgfQogIHBhcnNlU3RhcnRYUmVmKCkgewogICAgdGhpcy54cmVmLnNldFN0YXJ0WFJlZih0aGlzLnN0YXJ0WFJlZik7CiAgfQogIGdldCBudW1QYWdlcygpIHsKICAgIGxldCBudW0gPSAwOwogICAgaWYgKHRoaXMuY2F0YWxvZy5oYXNBY3R1YWxOdW1QYWdlcykgewogICAgICBudW0gPSB0aGlzLmNhdGFsb2cubnVtUGFnZXM7CiAgICB9IGVsc2UgaWYgKHRoaXMueGZhRmFjdG9yeSkgewogICAgICBudW0gPSB0aGlzLnhmYUZhY3RvcnkuZ2V0TnVtUGFnZXMoKTsKICAgIH0gZWxzZSBpZiAodGhpcy5saW5lYXJpemF0aW9uKSB7CiAgICAgIG51bSA9IHRoaXMubGluZWFyaXphdGlvbi5udW1QYWdlczsKICAgIH0gZWxzZSB7CiAgICAgIG51bSA9IHRoaXMuY2F0YWxvZy5udW1QYWdlczsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgIm51bVBhZ2VzIiwgbnVtKTsKICB9CiAgI2hhc09ubHlEb2N1bWVudFNpZ25hdHVyZXMoZmllbGRzLCByZWN1cnNpb25EZXB0aCA9IDApIHsKICAgIGNvbnN0IFJFQ1VSU0lPTl9MSU1JVCA9IDEwOwogICAgaWYgKCFBcnJheS5pc0FycmF5KGZpZWxkcykpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIGZpZWxkcy5ldmVyeShmaWVsZCA9PiB7CiAgICAgIGZpZWxkID0gdGhpcy54cmVmLmZldGNoSWZSZWYoZmllbGQpOwogICAgICBpZiAoIShmaWVsZCBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmIChmaWVsZC5oYXMoIktpZHMiKSkgewogICAgICAgIGlmICgrK3JlY3Vyc2lvbkRlcHRoID4gUkVDVVJTSU9OX0xJTUlUKSB7CiAgICAgICAgICB3YXJuKCIjaGFzT25seURvY3VtZW50U2lnbmF0dXJlczogbWF4aW11bSByZWN1cnNpb24gZGVwdGggcmVhY2hlZCIpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy4jaGFzT25seURvY3VtZW50U2lnbmF0dXJlcyhmaWVsZC5nZXQoIktpZHMiKSwgcmVjdXJzaW9uRGVwdGgpOwogICAgICB9CiAgICAgIGNvbnN0IGlzU2lnbmF0dXJlID0gaXNOYW1lKGZpZWxkLmdldCgiRlQiKSwgIlNpZyIpOwogICAgICBjb25zdCByZWN0YW5nbGUgPSBmaWVsZC5nZXQoIlJlY3QiKTsKICAgICAgY29uc3QgaXNJbnZpc2libGUgPSBBcnJheS5pc0FycmF5KHJlY3RhbmdsZSkgJiYgcmVjdGFuZ2xlLmV2ZXJ5KHZhbHVlID0+IHZhbHVlID09PSAwKTsKICAgICAgcmV0dXJuIGlzU2lnbmF0dXJlICYmIGlzSW52aXNpYmxlOwogICAgfSk7CiAgfQogICNjb2xsZWN0U2lnbmF0dXJlQ2VydGlmaWNhdGVzKGZpZWxkcywgY29sbGVjdGVkU2lnbmF0dXJlQ2VydGlmaWNhdGVzLCB2aXNpdGVkID0gbmV3IFJlZlNldCgpKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZmllbGRzKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGxldCBmaWVsZCBvZiBmaWVsZHMpIHsKICAgICAgaWYgKGZpZWxkIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgaWYgKHZpc2l0ZWQuaGFzKGZpZWxkKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHZpc2l0ZWQucHV0KGZpZWxkKTsKICAgICAgfQogICAgICBmaWVsZCA9IHRoaXMueHJlZi5mZXRjaElmUmVmKGZpZWxkKTsKICAgICAgaWYgKCEoZmllbGQgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChmaWVsZC5oYXMoIktpZHMiKSkgewogICAgICAgIHRoaXMuI2NvbGxlY3RTaWduYXR1cmVDZXJ0aWZpY2F0ZXMoZmllbGQuZ2V0KCJLaWRzIiksIGNvbGxlY3RlZFNpZ25hdHVyZUNlcnRpZmljYXRlcywgdmlzaXRlZCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgaXNTaWduYXR1cmUgPSBpc05hbWUoZmllbGQuZ2V0KCJGVCIpLCAiU2lnIik7CiAgICAgIGlmICghaXNTaWduYXR1cmUpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCB2YWx1ZSA9IGZpZWxkLmdldCgiViIpOwogICAgICBpZiAoISh2YWx1ZSBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3Qgc3ViRmlsdGVyID0gdmFsdWUuZ2V0KCJTdWJGaWx0ZXIiKTsKICAgICAgaWYgKCEoc3ViRmlsdGVyIGluc3RhbmNlb2YgTmFtZSkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb2xsZWN0ZWRTaWduYXR1cmVDZXJ0aWZpY2F0ZXMuYWRkKHN1YkZpbHRlci5uYW1lKTsKICAgIH0KICB9CiAgZ2V0IF94ZmFTdHJlYW1zKCkgewogICAgY29uc3QgewogICAgICBhY3JvRm9ybQogICAgfSA9IHRoaXMuY2F0YWxvZzsKICAgIGlmICghYWNyb0Zvcm0pIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCB4ZmEgPSBhY3JvRm9ybS5nZXQoIlhGQSIpOwogICAgY29uc3QgZW50cmllcyA9IG5ldyBNYXAoWyJ4ZHA6eGRwIiwgInRlbXBsYXRlIiwgImRhdGFzZXRzIiwgImNvbmZpZyIsICJjb25uZWN0aW9uU2V0IiwgImxvY2FsZVNldCIsICJzdHlsZXNoZWV0IiwgIi94ZHA6eGRwIl0ubWFwKGUgPT4gW2UsIG51bGxdKSk7CiAgICBpZiAoeGZhIGluc3RhbmNlb2YgQmFzZVN0cmVhbSAmJiAheGZhLmlzRW1wdHkpIHsKICAgICAgZW50cmllcy5zZXQoInhkcDp4ZHAiLCB4ZmEpOwogICAgICByZXR1cm4gZW50cmllczsKICAgIH0KICAgIGlmICghQXJyYXkuaXNBcnJheSh4ZmEpIHx8IHhmYS5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB4ZmEubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICBsZXQgbmFtZTsKICAgICAgaWYgKGkgPT09IDApIHsKICAgICAgICBuYW1lID0gInhkcDp4ZHAiOwogICAgICB9IGVsc2UgaWYgKGkgPT09IGlpIC0gMikgewogICAgICAgIG5hbWUgPSAiL3hkcDp4ZHAiOwogICAgICB9IGVsc2UgewogICAgICAgIG5hbWUgPSB4ZmFbaV07CiAgICAgIH0KICAgICAgaWYgKCFlbnRyaWVzLmhhcyhuYW1lKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZih4ZmFbaSArIDFdKTsKICAgICAgaWYgKCEoZGF0YSBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHx8IGRhdGEuaXNFbXB0eSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGVudHJpZXMuc2V0KG5hbWUsIGRhdGEpOwogICAgfQogICAgcmV0dXJuIGVudHJpZXM7CiAgfQogIGdldCB4ZmFEYXRhc2V0cygpIHsKICAgIGNvbnN0IHN0cmVhbXMgPSB0aGlzLl94ZmFTdHJlYW1zOwogICAgaWYgKCFzdHJlYW1zKSB7CiAgICAgIHJldHVybiBzaGFkb3codGhpcywgInhmYURhdGFzZXRzIiwgbnVsbCk7CiAgICB9CiAgICBmb3IgKGNvbnN0IGtleSBvZiBbImRhdGFzZXRzIiwgInhkcDp4ZHAiXSkgewogICAgICBjb25zdCBzdHJlYW0gPSBzdHJlYW1zLmdldChrZXkpOwogICAgICBpZiAoIXN0cmVhbSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3Qgc3RyID0gc3RyaW5nVG9VVEY4U3RyaW5nKHN0cmVhbS5nZXRTdHJpbmcoKSk7CiAgICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICAgIFtrZXldOiBzdHIKICAgICAgICB9OwogICAgICAgIHJldHVybiBzaGFkb3codGhpcywgInhmYURhdGFzZXRzIiwgbmV3IERhdGFzZXRSZWFkZXIoZGF0YSkpOwogICAgICB9IGNhdGNoIHsKICAgICAgICB3YXJuKCJYRkEgLSBJbnZhbGlkIHV0Zi04IHN0cmluZy4iKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAieGZhRGF0YXNldHMiLCBudWxsKTsKICB9CiAgZ2V0IHhmYURhdGEoKSB7CiAgICBjb25zdCBzdHJlYW1zID0gdGhpcy5feGZhU3RyZWFtczsKICAgIGlmICghc3RyZWFtcykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IGRhdGEgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgZm9yIChjb25zdCBba2V5LCBzdHJlYW1dIG9mIHN0cmVhbXMpIHsKICAgICAgaWYgKCFzdHJlYW0pIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIGRhdGFba2V5XSA9IHN0cmluZ1RvVVRGOFN0cmluZyhzdHJlYW0uZ2V0U3RyaW5nKCkpOwogICAgICB9IGNhdGNoIHsKICAgICAgICB3YXJuKCJYRkEgLSBJbnZhbGlkIHV0Zi04IHN0cmluZy4iKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7CiAgfQogIGdldCB4ZmFGYWN0b3J5KCkgewogICAgbGV0IGRhdGE7CiAgICBpZiAodGhpcy5wZGZNYW5hZ2VyLmVuYWJsZVhmYSAmJiB0aGlzLmNhdGFsb2cubmVlZHNSZW5kZXJpbmcgJiYgdGhpcy5mb3JtSW5mby5oYXNYZmEgJiYgIXRoaXMuZm9ybUluZm8uaGFzQWNyb0Zvcm0pIHsKICAgICAgZGF0YSA9IHRoaXMueGZhRGF0YTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInhmYUZhY3RvcnkiLCBkYXRhID8gbmV3IFhGQUZhY3RvcnkoZGF0YSkgOiBudWxsKTsKICB9CiAgZ2V0IGlzUHVyZVhmYSgpIHsKICAgIHJldHVybiB0aGlzLnhmYUZhY3RvcnkgPyB0aGlzLnhmYUZhY3RvcnkuaXNWYWxpZCgpIDogZmFsc2U7CiAgfQogIGdldCBodG1sRm9yWGZhKCkgewogICAgcmV0dXJuIHRoaXMueGZhRmFjdG9yeSA/IHRoaXMueGZhRmFjdG9yeS5nZXRQYWdlcygpIDogbnVsbDsKICB9CiAgYXN5bmMgI2xvYWRYZmFJbWFnZXMoKSB7CiAgICBjb25zdCB4ZmFJbWFnZXMgPSBhd2FpdCB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygieGZhSW1hZ2VzIik7CiAgICBpZiAoIXhmYUltYWdlcykgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnhmYUZhY3Rvcnkuc2V0SW1hZ2VzKHhmYUltYWdlcyk7CiAgfQogIGFzeW5jICNsb2FkWGZhRm9udHMoaGFuZGxlciwgdGFzaykgewogICAgY29uc3QgYWNyb0Zvcm0gPSBhd2FpdCB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiYWNyb0Zvcm0iKTsKICAgIGlmICghYWNyb0Zvcm0pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcmVzb3VyY2VzID0gYXdhaXQgYWNyb0Zvcm0uZ2V0QXN5bmMoIkRSIik7CiAgICBpZiAoIShyZXNvdXJjZXMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBhd2FpdCBPYmplY3RMb2FkZXIubG9hZChyZXNvdXJjZXMsIFsiRm9udCJdLCB0aGlzLnhyZWYpOwogICAgY29uc3QgZm9udFJlcyA9IHJlc291cmNlcy5nZXQoIkZvbnQiKTsKICAgIGlmICghKGZvbnRSZXMgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbihPYmplY3QuY3JlYXRlKG51bGwpLCB0aGlzLnBkZk1hbmFnZXIuZXZhbHVhdG9yT3B0aW9ucywgewogICAgICB1c2VTeXN0ZW1Gb250czogZmFsc2UKICAgIH0pOwogICAgY29uc3QgewogICAgICBidWlsdEluQ01hcENhY2hlLAogICAgICBmb250Q2FjaGUsCiAgICAgIHN0YW5kYXJkRm9udERhdGFDYWNoZQogICAgfSA9IHRoaXMuY2F0YWxvZzsKICAgIGNvbnN0IHBhcnRpYWxFdmFsdWF0b3IgPSBuZXcgUGFydGlhbEV2YWx1YXRvcih7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgaGFuZGxlciwKICAgICAgcGFnZUluZGV4OiAtMSwKICAgICAgaWRGYWN0b3J5OiB0aGlzLl9nbG9iYWxJZEZhY3RvcnksCiAgICAgIGZvbnRDYWNoZSwKICAgICAgYnVpbHRJbkNNYXBDYWNoZSwKICAgICAgc3RhbmRhcmRGb250RGF0YUNhY2hlLAogICAgICBvcHRpb25zCiAgICB9KTsKICAgIGNvbnN0IG9wZXJhdG9yTGlzdCA9IG5ldyBPcGVyYXRvckxpc3QoKTsKICAgIGNvbnN0IHBkZkZvbnRzID0gW107CiAgICBjb25zdCBpbml0aWFsU3RhdGUgPSB7CiAgICAgIGdldCBmb250KCkgewogICAgICAgIHJldHVybiBwZGZGb250cy5hdCgtMSk7CiAgICAgIH0sCiAgICAgIHNldCBmb250KGZvbnQpIHsKICAgICAgICBwZGZGb250cy5wdXNoKGZvbnQpOwogICAgICB9LAogICAgICBjbG9uZSgpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IHBhcnNlRm9udCA9IChmb250TmFtZSwgZmFsbGJhY2tGb250RGljdCwgY3NzRm9udEluZm8pID0+IHBhcnRpYWxFdmFsdWF0b3IuaGFuZGxlU2V0Rm9udChyZXNvdXJjZXMsIFtOYW1lLmdldChmb250TmFtZSksIDFdLCBudWxsLCBvcGVyYXRvckxpc3QsIHRhc2ssIGluaXRpYWxTdGF0ZSwgZmFsbGJhY2tGb250RGljdCwgY3NzRm9udEluZm8pLmNhdGNoKHJlYXNvbiA9PiB7CiAgICAgIHdhcm4oYGxvYWRYZmFGb250czogIiR7cmVhc29ufSIuYCk7CiAgICAgIHJldHVybiBudWxsOwogICAgfSk7CiAgICBjb25zdCBwcm9taXNlcyA9IFtdOwogICAgZm9yIChjb25zdCBbZm9udE5hbWUsIGZvbnRdIG9mIGZvbnRSZXMpIHsKICAgICAgY29uc3QgZGVzY3JpcHRvciA9IGZvbnQuZ2V0KCJGb250RGVzY3JpcHRvciIpOwogICAgICBpZiAoIShkZXNjcmlwdG9yIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBsZXQgZm9udEZhbWlseSA9IGRlc2NyaXB0b3IuZ2V0KCJGb250RmFtaWx5Iik7CiAgICAgIGZvbnRGYW1pbHkgPSBmb250RmFtaWx5LnJlcGxhY2VBbGwoL1sgXSsoXGQpL2csICIkMSIpOwogICAgICBjb25zdCBmb250V2VpZ2h0ID0gZGVzY3JpcHRvci5nZXQoIkZvbnRXZWlnaHQiKTsKICAgICAgY29uc3QgaXRhbGljQW5nbGUgPSAtZGVzY3JpcHRvci5nZXQoIkl0YWxpY0FuZ2xlIik7CiAgICAgIGNvbnN0IGNzc0ZvbnRJbmZvID0gewogICAgICAgIGZvbnRGYW1pbHksCiAgICAgICAgZm9udFdlaWdodCwKICAgICAgICBpdGFsaWNBbmdsZQogICAgICB9OwogICAgICBpZiAoIXZhbGlkYXRlQ1NTRm9udChjc3NGb250SW5mbykpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBwcm9taXNlcy5wdXNoKHBhcnNlRm9udChmb250TmFtZSwgbnVsbCwgY3NzRm9udEluZm8pKTsKICAgIH0KICAgIGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTsKICAgIGNvbnN0IG1pc3NpbmdGb250cyA9IHRoaXMueGZhRmFjdG9yeS5zZXRGb250cyhwZGZGb250cyk7CiAgICBpZiAoIW1pc3NpbmdGb250cykgewogICAgICByZXR1cm47CiAgICB9CiAgICBvcHRpb25zLmlnbm9yZUVycm9ycyA9IHRydWU7CiAgICBwcm9taXNlcy5sZW5ndGggPSAwOwogICAgcGRmRm9udHMubGVuZ3RoID0gMDsKICAgIGNvbnN0IHJlYWxseU1pc3NpbmdGb250cyA9IG5ldyBTZXQoKTsKICAgIGZvciAoY29uc3QgbWlzc2luZyBvZiBtaXNzaW5nRm9udHMpIHsKICAgICAgaWYgKCFnZXRYZmFGb250TmFtZShgJHttaXNzaW5nfS1SZWd1bGFyYCkpIHsKICAgICAgICByZWFsbHlNaXNzaW5nRm9udHMuYWRkKG1pc3NpbmcpOwogICAgICB9CiAgICB9CiAgICBpZiAocmVhbGx5TWlzc2luZ0ZvbnRzLnNpemUpIHsKICAgICAgbWlzc2luZ0ZvbnRzLnB1c2goIlBkZkpTLUZhbGxiYWNrIik7CiAgICB9CiAgICBmb3IgKGNvbnN0IG1pc3Npbmcgb2YgbWlzc2luZ0ZvbnRzKSB7CiAgICAgIGlmIChyZWFsbHlNaXNzaW5nRm9udHMuaGFzKG1pc3NpbmcpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBmb250SW5mbyBvZiBbewogICAgICAgIG5hbWU6ICJSZWd1bGFyIiwKICAgICAgICBmb250V2VpZ2h0OiA0MDAsCiAgICAgICAgaXRhbGljQW5nbGU6IDAKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJCb2xkIiwKICAgICAgICBmb250V2VpZ2h0OiA3MDAsCiAgICAgICAgaXRhbGljQW5nbGU6IDAKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJJdGFsaWMiLAogICAgICAgIGZvbnRXZWlnaHQ6IDQwMCwKICAgICAgICBpdGFsaWNBbmdsZTogMTIKICAgICAgfSwgewogICAgICAgIG5hbWU6ICJCb2xkSXRhbGljIiwKICAgICAgICBmb250V2VpZ2h0OiA3MDAsCiAgICAgICAgaXRhbGljQW5nbGU6IDEyCiAgICAgIH1dKSB7CiAgICAgICAgY29uc3QgbmFtZSA9IGAke21pc3Npbmd9LSR7Zm9udEluZm8ubmFtZX1gOwogICAgICAgIHByb21pc2VzLnB1c2gocGFyc2VGb250KG5hbWUsIGdldFhmYUZvbnREaWN0KG5hbWUpLCB7CiAgICAgICAgICBmb250RmFtaWx5OiBtaXNzaW5nLAogICAgICAgICAgZm9udFdlaWdodDogZm9udEluZm8uZm9udFdlaWdodCwKICAgICAgICAgIGl0YWxpY0FuZ2xlOiBmb250SW5mby5pdGFsaWNBbmdsZQogICAgICAgIH0pKTsKICAgICAgfQogICAgfQogICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogICAgdGhpcy54ZmFGYWN0b3J5LmFwcGVuZEZvbnRzKHBkZkZvbnRzLCByZWFsbHlNaXNzaW5nRm9udHMpOwogIH0KICBsb2FkWGZhUmVzb3VyY2VzKGhhbmRsZXIsIHRhc2spIHsKICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy4jbG9hZFhmYUZvbnRzKGhhbmRsZXIsIHRhc2spLmNhdGNoKCgpID0+IHt9KSwgdGhpcy4jbG9hZFhmYUltYWdlcygpXSk7CiAgfQogIHNlcmlhbGl6ZVhmYURhdGEoYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIHJldHVybiB0aGlzLnhmYUZhY3RvcnkgPyB0aGlzLnhmYUZhY3Rvcnkuc2VyaWFsaXplRGF0YShhbm5vdGF0aW9uU3RvcmFnZSkgOiBudWxsOwogIH0KICBnZXQgdmVyc2lvbigpIHsKICAgIHJldHVybiB0aGlzLmNhdGFsb2cudmVyc2lvbiB8fCB0aGlzLiN2ZXJzaW9uOwogIH0KICBnZXQgZm9ybUluZm8oKSB7CiAgICBjb25zdCBmb3JtSW5mbyA9IHsKICAgICAgaGFzRmllbGRzOiBmYWxzZSwKICAgICAgaGFzQWNyb0Zvcm06IGZhbHNlLAogICAgICBoYXNYZmE6IGZhbHNlLAogICAgICBoYXNTaWduYXR1cmVzOiBmYWxzZQogICAgfTsKICAgIGNvbnN0IHsKICAgICAgYWNyb0Zvcm0KICAgIH0gPSB0aGlzLmNhdGFsb2c7CiAgICBpZiAoIWFjcm9Gb3JtKSB7CiAgICAgIHJldHVybiBzaGFkb3codGhpcywgImZvcm1JbmZvIiwgZm9ybUluZm8pOwogICAgfQogICAgdHJ5IHsKICAgICAgY29uc3QgZmllbGRzID0gYWNyb0Zvcm0uZ2V0KCJGaWVsZHMiKTsKICAgICAgY29uc3QgaGFzRmllbGRzID0gQXJyYXkuaXNBcnJheShmaWVsZHMpICYmIGZpZWxkcy5sZW5ndGggPiAwOwogICAgICBmb3JtSW5mby5oYXNGaWVsZHMgPSBoYXNGaWVsZHM7CiAgICAgIGNvbnN0IHhmYSA9IGFjcm9Gb3JtLmdldCgiWEZBIik7CiAgICAgIGZvcm1JbmZvLmhhc1hmYSA9IEFycmF5LmlzQXJyYXkoeGZhKSAmJiB4ZmEubGVuZ3RoID4gMCB8fCB4ZmEgaW5zdGFuY2VvZiBCYXNlU3RyZWFtICYmICF4ZmEuaXNFbXB0eTsKICAgICAgY29uc3Qgc2lnRmxhZ3MgPSBhY3JvRm9ybS5nZXQoIlNpZ0ZsYWdzIik7CiAgICAgIGNvbnN0IGhhc1NpZ25hdHVyZXMgPSAhIShzaWdGbGFncyAmIDB4MSk7CiAgICAgIGNvbnN0IGhhc09ubHlEb2N1bWVudFNpZ25hdHVyZXMgPSBoYXNTaWduYXR1cmVzICYmIHRoaXMuI2hhc09ubHlEb2N1bWVudFNpZ25hdHVyZXMoZmllbGRzKTsKICAgICAgZm9ybUluZm8uaGFzQWNyb0Zvcm0gPSBoYXNGaWVsZHMgJiYgIWhhc09ubHlEb2N1bWVudFNpZ25hdHVyZXM7CiAgICAgIGZvcm1JbmZvLmhhc1NpZ25hdHVyZXMgPSBoYXNTaWduYXR1cmVzOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICB3YXJuKGBDYW5ub3QgZmV0Y2ggZm9ybSBpbmZvcm1hdGlvbjogIiR7ZXh9Ii5gKTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImZvcm1JbmZvIiwgZm9ybUluZm8pOwogIH0KICBnZXQgZG9jdW1lbnRJbmZvKCkgewogICAgY29uc3QgewogICAgICBjYXRhbG9nLAogICAgICBmb3JtSW5mbywKICAgICAgeHJlZgogICAgfSA9IHRoaXM7CiAgICBjb25zdCBkb2NJbmZvID0gewogICAgICBQREZGb3JtYXRWZXJzaW9uOiB0aGlzLnZlcnNpb24sCiAgICAgIExhbmd1YWdlOiBjYXRhbG9nLmxhbmcsCiAgICAgIEVuY3J5cHRGaWx0ZXJOYW1lOiB4cmVmLmVuY3J5cHQ/LmZpbHRlck5hbWUgPz8gbnVsbCwKICAgICAgSXNMaW5lYXJpemVkOiAhIXRoaXMubGluZWFyaXphdGlvbiwKICAgICAgSXNBY3JvRm9ybVByZXNlbnQ6IGZvcm1JbmZvLmhhc0Fjcm9Gb3JtLAogICAgICBJc1hGQVByZXNlbnQ6IGZvcm1JbmZvLmhhc1hmYSwKICAgICAgSXNDb2xsZWN0aW9uUHJlc2VudDogISFjYXRhbG9nLmNvbGxlY3Rpb24sCiAgICAgIElzU2lnbmF0dXJlc1ByZXNlbnQ6IGZvcm1JbmZvLmhhc1NpZ25hdHVyZXMKICAgIH07CiAgICBsZXQgaW5mb0RpY3Q7CiAgICB0cnkgewogICAgICBpbmZvRGljdCA9IHhyZWYudHJhaWxlci5nZXQoIkluZm8iKTsKICAgIH0gY2F0Y2ggKGVycikgewogICAgICBpZiAoZXJyIGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBlcnI7CiAgICAgIH0KICAgICAgaW5mbygiVGhlIGRvY3VtZW50IGluZm9ybWF0aW9uIGRpY3Rpb25hcnkgaXMgaW52YWxpZC4iKTsKICAgIH0KICAgIGlmICghKGluZm9EaWN0IGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZG9jdW1lbnRJbmZvIiwgZG9jSW5mbyk7CiAgICB9CiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBpbmZvRGljdCkgewogICAgICBzd2l0Y2ggKGtleSkgewogICAgICAgIGNhc2UgIlRpdGxlIjoKICAgICAgICBjYXNlICJBdXRob3IiOgogICAgICAgIGNhc2UgIlN1YmplY3QiOgogICAgICAgIGNhc2UgIktleXdvcmRzIjoKICAgICAgICBjYXNlICJDcmVhdG9yIjoKICAgICAgICBjYXNlICJQcm9kdWNlciI6CiAgICAgICAgY2FzZSAiQ3JlYXRpb25EYXRlIjoKICAgICAgICBjYXNlICJNb2REYXRlIjoKICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGRvY0luZm9ba2V5XSA9IHN0cmluZ1RvUERGU3RyaW5nKHZhbHVlKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJUcmFwcGVkIjoKICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgICAgICAgICAgZG9jSW5mb1trZXldID0gdmFsdWU7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGxldCBjdXN0b21WYWx1ZTsKICAgICAgICAgIHN3aXRjaCAodHlwZW9mIHZhbHVlKSB7CiAgICAgICAgICAgIGNhc2UgInN0cmluZyI6CiAgICAgICAgICAgICAgY3VzdG9tVmFsdWUgPSBzdHJpbmdUb1BERlN0cmluZyh2YWx1ZSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICAgIGNhc2UgImJvb2xlYW4iOgogICAgICAgICAgICAgIGN1c3RvbVZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTmFtZSkgewogICAgICAgICAgICAgICAgY3VzdG9tVmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY3VzdG9tVmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB3YXJuKGBCYWQgdmFsdWUsIGZvciBjdXN0b20ga2V5ICIke2tleX0iLCBpbiBJbmZvOiAke3ZhbHVlfS5gKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBkb2NJbmZvLkN1c3RvbSA/Pz0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgIGRvY0luZm8uQ3VzdG9tW2tleV0gPSBjdXN0b21WYWx1ZTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHdhcm4oYEJhZCB2YWx1ZSwgZm9yIGtleSAiJHtrZXl9IiwgaW4gSW5mbzogJHt2YWx1ZX0uYCk7CiAgICB9CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJkb2N1bWVudEluZm8iLCBkb2NJbmZvKTsKICB9CiAgZ2V0IGZpbmdlcnByaW50cygpIHsKICAgIGNvbnN0IEZJTkdFUlBSSU5UX0ZJUlNUX0JZVEVTID0gMTAyNDsKICAgIGNvbnN0IEVNUFRZX0ZJTkdFUlBSSU5UID0gIlx4MDAiLnJlcGVhdCgxNik7CiAgICBmdW5jdGlvbiB2YWxpZGF0ZShkYXRhKSB7CiAgICAgIHJldHVybiB0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIgJiYgZGF0YS5sZW5ndGggPT09IDE2ICYmIGRhdGEgIT09IEVNUFRZX0ZJTkdFUlBSSU5UOwogICAgfQogICAgY29uc3QgaWQgPSB0aGlzLnhyZWYudHJhaWxlci5nZXQoIklEIik7CiAgICBsZXQgaGFzaE9yaWdpbmFsLCBoYXNoTW9kaWZpZWQ7CiAgICBpZiAoQXJyYXkuaXNBcnJheShpZCkgJiYgdmFsaWRhdGUoaWRbMF0pKSB7CiAgICAgIGhhc2hPcmlnaW5hbCA9IHN0cmluZ1RvQnl0ZXMoaWRbMF0pOwogICAgICBpZiAoaWRbMV0gIT09IGlkWzBdICYmIHZhbGlkYXRlKGlkWzFdKSkgewogICAgICAgIGhhc2hNb2RpZmllZCA9IHN0cmluZ1RvQnl0ZXMoaWRbMV0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBoYXNoT3JpZ2luYWwgPSBjYWxjdWxhdGVNRDUodGhpcy5zdHJlYW0uZ2V0Qnl0ZVJhbmdlKDAsIEZJTkdFUlBSSU5UX0ZJUlNUX0JZVEVTKSwgMCwgRklOR0VSUFJJTlRfRklSU1RfQllURVMpOwogICAgfQogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiZmluZ2VycHJpbnRzIiwgW3RvSGV4VXRpbChoYXNoT3JpZ2luYWwpLCBoYXNoTW9kaWZpZWQgPyB0b0hleFV0aWwoaGFzaE1vZGlmaWVkKSA6IG51bGxdKTsKICB9CiAgYXN5bmMgI2dldExpbmVhcml6YXRpb25QYWdlKHBhZ2VJbmRleCkgewogICAgY29uc3QgewogICAgICBjYXRhbG9nLAogICAgICBsaW5lYXJpemF0aW9uLAogICAgICB4cmVmCiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHJlZiA9IFJlZi5nZXQobGluZWFyaXphdGlvbi5vYmplY3ROdW1iZXJGaXJzdCwgMCk7CiAgICB0cnkgewogICAgICBjb25zdCBvYmogPSBhd2FpdCB4cmVmLmZldGNoQXN5bmMocmVmKTsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICBsZXQgdHlwZSA9IG9iai5nZXRSYXcoIlR5cGUiKTsKICAgICAgICBpZiAodHlwZSBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgdHlwZSA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyh0eXBlKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzTmFtZSh0eXBlLCAiUGFnZSIpIHx8ICFvYmouaGFzKCJUeXBlIikgJiYgIW9iai5oYXMoIktpZHMiKSAmJiBvYmouaGFzKCJDb250ZW50cyIpKSB7CiAgICAgICAgICBpZiAoIWNhdGFsb2cucGFnZUtpZHNDb3VudENhY2hlLmhhcyhyZWYpKSB7CiAgICAgICAgICAgIGNhdGFsb2cucGFnZUtpZHNDb3VudENhY2hlLnB1dChyZWYsIDEpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFjYXRhbG9nLnBhZ2VJbmRleENhY2hlLmhhcyhyZWYpKSB7CiAgICAgICAgICAgIGNhdGFsb2cucGFnZUluZGV4Q2FjaGUucHV0KHJlZiwgMCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gW29iaiwgcmVmXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IEZvcm1hdEVycm9yKCJUaGUgTGluZWFyaXphdGlvbiBkaWN0aW9uYXJ5IGRvZXNuJ3QgcG9pbnQgdG8gYSB2YWxpZCBQYWdlIGRpY3Rpb25hcnkuIik7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgd2FybihgX2dldExpbmVhcml6YXRpb25QYWdlOiAiJHtyZWFzb24ubWVzc2FnZX0iLmApOwogICAgICByZXR1cm4gY2F0YWxvZy5nZXRQYWdlRGljdChwYWdlSW5kZXgpOwogICAgfQogIH0KICBnZXRQYWdlKHBhZ2VJbmRleCkgewogICAgY29uc3QgY2FjaGVkUHJvbWlzZSA9IHRoaXMuI3BhZ2VQcm9taXNlcy5nZXQocGFnZUluZGV4KTsKICAgIGlmIChjYWNoZWRQcm9taXNlKSB7CiAgICAgIHJldHVybiBjYWNoZWRQcm9taXNlOwogICAgfQogICAgY29uc3QgewogICAgICBjYXRhbG9nLAogICAgICBsaW5lYXJpemF0aW9uLAogICAgICB4ZmFGYWN0b3J5CiAgICB9ID0gdGhpczsKICAgIGxldCBwcm9taXNlOwogICAgaWYgKHhmYUZhY3RvcnkpIHsKICAgICAgcHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZShbRGljdC5lbXB0eSwgbnVsbF0pOwogICAgfSBlbHNlIGlmIChsaW5lYXJpemF0aW9uPy5wYWdlRmlyc3QgPT09IHBhZ2VJbmRleCkgewogICAgICBwcm9taXNlID0gdGhpcy4jZ2V0TGluZWFyaXphdGlvblBhZ2UocGFnZUluZGV4KTsKICAgIH0gZWxzZSB7CiAgICAgIHByb21pc2UgPSBjYXRhbG9nLmdldFBhZ2VEaWN0KHBhZ2VJbmRleCk7CiAgICB9CiAgICBwcm9taXNlID0gcHJvbWlzZS50aGVuKChbcGFnZURpY3QsIHJlZl0pID0+IG5ldyBQYWdlKHsKICAgICAgcGRmTWFuYWdlcjogdGhpcy5wZGZNYW5hZ2VyLAogICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgIHBhZ2VJbmRleCwKICAgICAgcGFnZURpY3QsCiAgICAgIHJlZiwKICAgICAgZ2xvYmFsSWRGYWN0b3J5OiB0aGlzLl9nbG9iYWxJZEZhY3RvcnksCiAgICAgIGZvbnRDYWNoZTogY2F0YWxvZy5mb250Q2FjaGUsCiAgICAgIGJ1aWx0SW5DTWFwQ2FjaGU6IGNhdGFsb2cuYnVpbHRJbkNNYXBDYWNoZSwKICAgICAgc3RhbmRhcmRGb250RGF0YUNhY2hlOiBjYXRhbG9nLnN0YW5kYXJkRm9udERhdGFDYWNoZSwKICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlOiBjYXRhbG9nLmdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgZ2xvYmFsSW1hZ2VDYWNoZTogY2F0YWxvZy5nbG9iYWxJbWFnZUNhY2hlLAogICAgICBzeXN0ZW1Gb250Q2FjaGU6IGNhdGFsb2cuc3lzdGVtRm9udENhY2hlLAogICAgICBub25CbGVuZE1vZGVzU2V0OiBjYXRhbG9nLm5vbkJsZW5kTW9kZXNTZXQsCiAgICAgIHhmYUZhY3RvcnkKICAgIH0pKTsKICAgIHRoaXMuI3BhZ2VQcm9taXNlcy5zZXQocGFnZUluZGV4LCBwcm9taXNlKTsKICAgIHJldHVybiBwcm9taXNlOwogIH0KICBhc3luYyBjaGVja0ZpcnN0UGFnZShyZWNvdmVyeU1vZGUgPSBmYWxzZSkgewogICAgaWYgKHJlY292ZXJ5TW9kZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0cnkgewogICAgICBhd2FpdCB0aGlzLmdldFBhZ2UoMCk7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIFhSZWZFbnRyeUV4Y2VwdGlvbikgewogICAgICAgIHRoaXMuI3BhZ2VQcm9taXNlcy5kZWxldGUoMCk7CiAgICAgICAgYXdhaXQgdGhpcy5jbGVhbnVwKCk7CiAgICAgICAgdGhyb3cgbmV3IFhSZWZQYXJzZUV4Y2VwdGlvbigpOwogICAgICB9CiAgICB9CiAgfQogIGFzeW5jIGNoZWNrTGFzdFBhZ2UocmVjb3ZlcnlNb2RlID0gZmFsc2UpIHsKICAgIGNvbnN0IHsKICAgICAgY2F0YWxvZywKICAgICAgcGRmTWFuYWdlcgogICAgfSA9IHRoaXM7CiAgICBjYXRhbG9nLnNldEFjdHVhbE51bVBhZ2VzKCk7CiAgICBsZXQgbnVtUGFnZXM7CiAgICB0cnkgewogICAgICBhd2FpdCBQcm9taXNlLmFsbChbcGRmTWFuYWdlci5lbnN1cmVEb2MoInhmYUZhY3RvcnkiKSwgcGRmTWFuYWdlci5lbnN1cmVEb2MoImxpbmVhcml6YXRpb24iKSwgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJudW1QYWdlcyIpXSk7CiAgICAgIGlmICh0aGlzLnhmYUZhY3RvcnkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAodGhpcy5saW5lYXJpemF0aW9uKSB7CiAgICAgICAgbnVtUGFnZXMgPSB0aGlzLmxpbmVhcml6YXRpb24ubnVtUGFnZXM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbnVtUGFnZXMgPSBjYXRhbG9nLm51bVBhZ2VzOwogICAgICB9CiAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihudW1QYWdlcykpIHsKICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXJyb3IoIlBhZ2UgY291bnQgaXMgbm90IGFuIGludGVnZXIuIik7CiAgICAgIH0gZWxzZSBpZiAobnVtUGFnZXMgPD0gMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBhd2FpdCB0aGlzLmdldFBhZ2UobnVtUGFnZXMgLSAxKTsKICAgIH0gY2F0Y2ggKHJlYXNvbikgewogICAgICB0aGlzLiNwYWdlUHJvbWlzZXMuZGVsZXRlKG51bVBhZ2VzIC0gMSk7CiAgICAgIGF3YWl0IHRoaXMuY2xlYW51cCgpOwogICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgWFJlZkVudHJ5RXhjZXB0aW9uICYmICFyZWNvdmVyeU1vZGUpIHsKICAgICAgICB0aHJvdyBuZXcgWFJlZlBhcnNlRXhjZXB0aW9uKCk7CiAgICAgIH0KICAgICAgd2FybihgY2hlY2tMYXN0UGFnZSAtIGludmFsaWQgL1BhZ2VzIHRyZWUgL0NvdW50OiAke251bVBhZ2VzfS5gKTsKICAgICAgbGV0IHBhZ2VzVHJlZTsKICAgICAgdHJ5IHsKICAgICAgICBwYWdlc1RyZWUgPSBhd2FpdCBjYXRhbG9nLmdldEFsbFBhZ2VEaWN0cyhyZWNvdmVyeU1vZGUpOwogICAgICB9IGNhdGNoIChyZWFzb25BbGwpIHsKICAgICAgICBpZiAocmVhc29uQWxsIGluc3RhbmNlb2YgWFJlZkVudHJ5RXhjZXB0aW9uICYmICFyZWNvdmVyeU1vZGUpIHsKICAgICAgICAgIHRocm93IG5ldyBYUmVmUGFyc2VFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgY2F0YWxvZy5zZXRBY3R1YWxOdW1QYWdlcygxKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBbcGFnZUluZGV4LCBbcGFnZURpY3QsIHJlZl1dIG9mIHBhZ2VzVHJlZSkgewogICAgICAgIGxldCBwcm9taXNlOwogICAgICAgIGlmIChwYWdlRGljdCBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgICBwcm9taXNlID0gUHJvbWlzZS5yZWplY3QocGFnZURpY3QpOwogICAgICAgICAgcHJvbWlzZS5jYXRjaCgoKSA9PiB7fSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUobmV3IFBhZ2UoewogICAgICAgICAgICBwZGZNYW5hZ2VyLAogICAgICAgICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgICAgICAgIHBhZ2VJbmRleCwKICAgICAgICAgICAgcGFnZURpY3QsCiAgICAgICAgICAgIHJlZiwKICAgICAgICAgICAgZ2xvYmFsSWRGYWN0b3J5OiB0aGlzLl9nbG9iYWxJZEZhY3RvcnksCiAgICAgICAgICAgIGZvbnRDYWNoZTogY2F0YWxvZy5mb250Q2FjaGUsCiAgICAgICAgICAgIGJ1aWx0SW5DTWFwQ2FjaGU6IGNhdGFsb2cuYnVpbHRJbkNNYXBDYWNoZSwKICAgICAgICAgICAgc3RhbmRhcmRGb250RGF0YUNhY2hlOiBjYXRhbG9nLnN0YW5kYXJkRm9udERhdGFDYWNoZSwKICAgICAgICAgICAgZ2xvYmFsQ29sb3JTcGFjZUNhY2hlOiB0aGlzLmdsb2JhbENvbG9yU3BhY2VDYWNoZSwKICAgICAgICAgICAgZ2xvYmFsSW1hZ2VDYWNoZTogY2F0YWxvZy5nbG9iYWxJbWFnZUNhY2hlLAogICAgICAgICAgICBzeXN0ZW1Gb250Q2FjaGU6IGNhdGFsb2cuc3lzdGVtRm9udENhY2hlLAogICAgICAgICAgICBub25CbGVuZE1vZGVzU2V0OiBjYXRhbG9nLm5vbkJsZW5kTW9kZXNTZXQsCiAgICAgICAgICAgIHhmYUZhY3Rvcnk6IG51bGwKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgICAgdGhpcy4jcGFnZVByb21pc2VzLnNldChwYWdlSW5kZXgsIHByb21pc2UpOwogICAgICB9CiAgICAgIGNhdGFsb2cuc2V0QWN0dWFsTnVtUGFnZXMocGFnZXNUcmVlLnNpemUpOwogICAgfQogIH0KICBhc3luYyBmb250RmFsbGJhY2soaWQsIGhhbmRsZXIpIHsKICAgIGNvbnN0IHsKICAgICAgY2F0YWxvZywKICAgICAgcGRmTWFuYWdlcgogICAgfSA9IHRoaXM7CiAgICBmb3IgKGNvbnN0IHRyYW5zbGF0ZWRGb250IG9mIGF3YWl0IFByb21pc2UuYWxsKGNhdGFsb2cuZm9udENhY2hlKSkgewogICAgICBpZiAodHJhbnNsYXRlZEZvbnQubG9hZGVkTmFtZSA9PT0gaWQpIHsKICAgICAgICB0cmFuc2xhdGVkRm9udC5mYWxsYmFjayhoYW5kbGVyLCBwZGZNYW5hZ2VyLmV2YWx1YXRvck9wdGlvbnMpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogIH0KICBhc3luYyBjbGVhbnVwKG1hbnVhbGx5VHJpZ2dlcmVkID0gZmFsc2UpIHsKICAgIHJldHVybiB0aGlzLmNhdGFsb2cgPyB0aGlzLmNhdGFsb2cuY2xlYW51cChtYW51YWxseVRyaWdnZXJlZCkgOiBjbGVhckdsb2JhbENhY2hlcygpOwogIH0KICBhc3luYyAjY29sbGVjdEZpZWxkT2JqZWN0cyhuYW1lLCBwYXJlbnRSZWYsIGZpZWxkUmVmLCBwcm9taXNlcywgYW5ub3RhdGlvbkdsb2JhbHMsIHZpc2l0ZWRSZWZzLCBvcnBoYW5GaWVsZHMpIHsKICAgIGNvbnN0IHsKICAgICAgeHJlZgogICAgfSA9IHRoaXM7CiAgICBpZiAoIShmaWVsZFJlZiBpbnN0YW5jZW9mIFJlZikgfHwgdmlzaXRlZFJlZnMuaGFzKGZpZWxkUmVmKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB2aXNpdGVkUmVmcy5wdXQoZmllbGRSZWYpOwogICAgY29uc3QgZmllbGQgPSBhd2FpdCB4cmVmLmZldGNoQXN5bmMoZmllbGRSZWYpOwogICAgaWYgKCEoZmllbGQgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgc3VidHlwZSA9IGF3YWl0IGZpZWxkLmdldEFzeW5jKCJTdWJ0eXBlIik7CiAgICBzdWJ0eXBlID0gc3VidHlwZSBpbnN0YW5jZW9mIE5hbWUgPyBzdWJ0eXBlLm5hbWUgOiBudWxsOwogICAgc3dpdGNoIChzdWJ0eXBlKSB7CiAgICAgIGNhc2UgIkxpbmsiOgogICAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChmaWVsZC5oYXMoIlQiKSkgewogICAgICBjb25zdCBwYXJ0TmFtZSA9IHN0cmluZ1RvUERGU3RyaW5nKGF3YWl0IGZpZWxkLmdldEFzeW5jKCJUIikpOwogICAgICBuYW1lID0gbmFtZSA9PT0gIiIgPyBwYXJ0TmFtZSA6IGAke25hbWV9LiR7cGFydE5hbWV9YDsKICAgIH0gZWxzZSB7CiAgICAgIGxldCBvYmogPSBmaWVsZDsKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICBvYmogPSBvYmouZ2V0UmF3KCJQYXJlbnQiKSB8fCBwYXJlbnRSZWY7CiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIFJlZikgewogICAgICAgICAgaWYgKHZpc2l0ZWRSZWZzLmhhcyhvYmopKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgb2JqID0gYXdhaXQgeHJlZi5mZXRjaEFzeW5jKG9iaik7CiAgICAgICAgfQogICAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIERpY3QpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKG9iai5oYXMoIlQiKSkgewogICAgICAgICAgY29uc3QgcGFydE5hbWUgPSBzdHJpbmdUb1BERlN0cmluZyhhd2FpdCBvYmouZ2V0QXN5bmMoIlQiKSk7CiAgICAgICAgICBuYW1lID0gbmFtZSA9PT0gIiIgPyBwYXJ0TmFtZSA6IGAke25hbWV9LiR7cGFydE5hbWV9YDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKHBhcmVudFJlZiAmJiAhZmllbGQuaGFzKCJQYXJlbnQiKSAmJiBpc05hbWUoZmllbGQuZ2V0KCJTdWJ0eXBlIiksICJXaWRnZXQiKSkgewogICAgICBvcnBoYW5GaWVsZHMucHV0KGZpZWxkUmVmLCBwYXJlbnRSZWYpOwogICAgfQogICAgaWYgKCFwcm9taXNlcy5oYXMobmFtZSkpIHsKICAgICAgcHJvbWlzZXMuc2V0KG5hbWUsIFtdKTsKICAgIH0KICAgIHByb21pc2VzLmdldChuYW1lKS5wdXNoKEFubm90YXRpb25GYWN0b3J5LmNyZWF0ZSh4cmVmLCBmaWVsZFJlZiwgYW5ub3RhdGlvbkdsb2JhbHMsIG51bGwsIHRydWUsIG9ycGhhbkZpZWxkcywgbnVsbCkudGhlbihhbm5vdGF0aW9uID0+IGFubm90YXRpb24/LmdldEZpZWxkT2JqZWN0KCkpLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgd2FybihgI2NvbGxlY3RGaWVsZE9iamVjdHM6ICIke3JlYXNvbn0iLmApOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0pKTsKICAgIGlmICghZmllbGQuaGFzKCJLaWRzIikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qga2lkcyA9IGF3YWl0IGZpZWxkLmdldEFzeW5jKCJLaWRzIik7CiAgICBpZiAoQXJyYXkuaXNBcnJheShraWRzKSkgewogICAgICBmb3IgKGNvbnN0IGtpZCBvZiBraWRzKSB7CiAgICAgICAgYXdhaXQgdGhpcy4jY29sbGVjdEZpZWxkT2JqZWN0cyhuYW1lLCBmaWVsZFJlZiwga2lkLCBwcm9taXNlcywgYW5ub3RhdGlvbkdsb2JhbHMsIHZpc2l0ZWRSZWZzLCBvcnBoYW5GaWVsZHMpOwogICAgICB9CiAgICB9CiAgfQogIGdldCBmaWVsZE9iamVjdHMoKSB7CiAgICBjb25zdCBwcm9taXNlID0gdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZURvYygiZm9ybUluZm8iKS50aGVuKGFzeW5jIGZvcm1JbmZvID0+IHsKICAgICAgaWYgKCFmb3JtSW5mby5oYXNGaWVsZHMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBhbm5vdGF0aW9uR2xvYmFscyA9IGF3YWl0IHRoaXMuYW5ub3RhdGlvbkdsb2JhbHM7CiAgICAgIGlmICghYW5ub3RhdGlvbkdsb2JhbHMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCB7CiAgICAgICAgYWNyb0Zvcm0KICAgICAgfSA9IGFubm90YXRpb25HbG9iYWxzOwogICAgICBjb25zdCB2aXNpdGVkUmVmcyA9IG5ldyBSZWZTZXQoKTsKICAgICAgY29uc3QgYWxsRmllbGRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgY29uc3QgZmllbGRQcm9taXNlcyA9IG5ldyBNYXAoKTsKICAgICAgY29uc3Qgb3JwaGFuRmllbGRzID0gbmV3IFJlZlNldENhY2hlKCk7CiAgICAgIGZvciAoY29uc3QgZmllbGRSZWYgb2YgYWNyb0Zvcm0uZ2V0KCJGaWVsZHMiKSkgewogICAgICAgIGF3YWl0IHRoaXMuI2NvbGxlY3RGaWVsZE9iamVjdHMoIiIsIG51bGwsIGZpZWxkUmVmLCBmaWVsZFByb21pc2VzLCBhbm5vdGF0aW9uR2xvYmFscywgdmlzaXRlZFJlZnMsIG9ycGhhbkZpZWxkcyk7CiAgICAgIH0KICAgICAgY29uc3QgYWxsUHJvbWlzZXMgPSBbXTsKICAgICAgZm9yIChjb25zdCBbbmFtZSwgcHJvbWlzZXNdIG9mIGZpZWxkUHJvbWlzZXMpIHsKICAgICAgICBhbGxQcm9taXNlcy5wdXNoKFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKGZpZWxkcyA9PiB7CiAgICAgICAgICBmaWVsZHMgPSBmaWVsZHMuZmlsdGVyKGZpZWxkID0+ICEhZmllbGQpOwogICAgICAgICAgaWYgKGZpZWxkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGFsbEZpZWxkc1tuYW1lXSA9IGZpZWxkczsKICAgICAgICAgIH0KICAgICAgICB9KSk7CiAgICAgIH0KICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoYWxsUHJvbWlzZXMpOwogICAgICByZXR1cm4gewogICAgICAgIGFsbEZpZWxkczogb2JqZWN0U2l6ZShhbGxGaWVsZHMpID4gMCA/IGFsbEZpZWxkcyA6IG51bGwsCiAgICAgICAgb3JwaGFuRmllbGRzCiAgICAgIH07CiAgICB9KTsKICAgIHJldHVybiBzaGFkb3codGhpcywgImZpZWxkT2JqZWN0cyIsIHByb21pc2UpOwogIH0KICBnZXQgaGFzSlNBY3Rpb25zKCkgewogICAgY29uc3QgcHJvbWlzZSA9IHRoaXMucGRmTWFuYWdlci5lbnN1cmVEb2MoIl9wYXJzZUhhc0pTQWN0aW9ucyIpOwogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaGFzSlNBY3Rpb25zIiwgcHJvbWlzZSk7CiAgfQogIGFzeW5jIF9wYXJzZUhhc0pTQWN0aW9ucygpIHsKICAgIGNvbnN0IFtjYXRhbG9nSnNBY3Rpb25zLCBmaWVsZE9iamVjdHNdID0gYXdhaXQgUHJvbWlzZS5hbGwoW3RoaXMucGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJqc0FjdGlvbnMiKSwgdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZURvYygiZmllbGRPYmplY3RzIildKTsKICAgIGlmIChjYXRhbG9nSnNBY3Rpb25zKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKGZpZWxkT2JqZWN0cz8uYWxsRmllbGRzKSB7CiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKGZpZWxkT2JqZWN0cy5hbGxGaWVsZHMpLnNvbWUoZmllbGRPYmplY3QgPT4gZmllbGRPYmplY3Quc29tZShvYmplY3QgPT4gb2JqZWN0LmFjdGlvbnMgIT09IG51bGwpKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgZ2V0IGNhbGN1bGF0aW9uT3JkZXJJZHMoKSB7CiAgICBjb25zdCBjYWxjdWxhdGlvbk9yZGVyID0gdGhpcy5jYXRhbG9nLmFjcm9Gb3JtPy5nZXQoIkNPIik7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoY2FsY3VsYXRpb25PcmRlcikgfHwgY2FsY3VsYXRpb25PcmRlci5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiY2FsY3VsYXRpb25PcmRlcklkcyIsIG51bGwpOwogICAgfQogICAgY29uc3QgaWRzID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIGNhbGN1bGF0aW9uT3JkZXIpIHsKICAgICAgaWYgKGlkIGluc3RhbmNlb2YgUmVmKSB7CiAgICAgICAgaWRzLnB1c2goaWQudG9TdHJpbmcoKSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgImNhbGN1bGF0aW9uT3JkZXJJZHMiLCBpZHMubGVuZ3RoID8gaWRzIDogbnVsbCk7CiAgfQogIGdldCBhbm5vdGF0aW9uR2xvYmFscygpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImFubm90YXRpb25HbG9iYWxzIiwgQW5ub3RhdGlvbkZhY3RvcnkuY3JlYXRlR2xvYmFscyh0aGlzLnBkZk1hbmFnZXIpKTsKICB9Cn0KCjsvLyAuL3NyYy9jb3JlL3BkZl9tYW5hZ2VyLmpzCgoKCgoKCgoKCgpmdW5jdGlvbiBwYXJzZURvY0Jhc2VVcmwodXJsKSB7CiAgaWYgKHVybCkgewogICAgY29uc3QgYWJzb2x1dGVVcmwgPSBjcmVhdGVWYWxpZEFic29sdXRlVXJsKHVybCk7CiAgICBpZiAoYWJzb2x1dGVVcmwpIHsKICAgICAgcmV0dXJuIGFic29sdXRlVXJsLmhyZWY7CiAgICB9CiAgICB3YXJuKGBJbnZhbGlkIGFic29sdXRlIGRvY0Jhc2VVcmw6ICIke3VybH0iLmApOwogIH0KICByZXR1cm4gbnVsbDsKfQpjbGFzcyBCYXNlUGRmTWFuYWdlciB7CiAgY29uc3RydWN0b3IoewogICAgZG9jQmFzZVVybCwKICAgIGRvY0lkLAogICAgZW5hYmxlWGZhLAogICAgZXZhbHVhdG9yT3B0aW9ucywKICAgIGhhbmRsZXIsCiAgICBwYXNzd29yZAogIH0pIHsKICAgIHRoaXMuX2RvY0Jhc2VVcmwgPSBwYXJzZURvY0Jhc2VVcmwoZG9jQmFzZVVybCk7CiAgICB0aGlzLl9kb2NJZCA9IGRvY0lkOwogICAgdGhpcy5fcGFzc3dvcmQgPSBwYXNzd29yZDsKICAgIHRoaXMuZW5hYmxlWGZhID0gZW5hYmxlWGZhOwogICAgZXZhbHVhdG9yT3B0aW9ucy5pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCAmJj0gRmVhdHVyZVRlc3QuaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQ7CiAgICBldmFsdWF0b3JPcHRpb25zLmlzSW1hZ2VEZWNvZGVyU3VwcG9ydGVkICYmPSBGZWF0dXJlVGVzdC5pc0ltYWdlRGVjb2RlclN1cHBvcnRlZDsKICAgIHRoaXMuZXZhbHVhdG9yT3B0aW9ucyA9IE9iamVjdC5mcmVlemUoZXZhbHVhdG9yT3B0aW9ucyk7CiAgICBJbWFnZVJlc2l6ZXIuc2V0T3B0aW9ucyhldmFsdWF0b3JPcHRpb25zKTsKICAgIEpwZWdTdHJlYW0uc2V0T3B0aW9ucyhldmFsdWF0b3JPcHRpb25zKTsKICAgIE9wZXJhdG9yTGlzdC5zZXRPcHRpb25zKGV2YWx1YXRvck9wdGlvbnMpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgLi4uZXZhbHVhdG9yT3B0aW9ucywKICAgICAgaGFuZGxlcgogICAgfTsKICAgIEpweEltYWdlLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgICBJY2NDb2xvclNwYWNlLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgICBDbXlrSUNDQmFzZWRDUy5zZXRPcHRpb25zKG9wdGlvbnMpOwogIH0KICBnZXQgZG9jSWQoKSB7CiAgICByZXR1cm4gdGhpcy5fZG9jSWQ7CiAgfQogIGdldCBwYXNzd29yZCgpIHsKICAgIHJldHVybiB0aGlzLl9wYXNzd29yZDsKICB9CiAgZ2V0IGRvY0Jhc2VVcmwoKSB7CiAgICByZXR1cm4gdGhpcy5fZG9jQmFzZVVybDsKICB9CiAgZW5zdXJlRG9jKHByb3AsIGFyZ3MpIHsKICAgIHJldHVybiB0aGlzLmVuc3VyZSh0aGlzLnBkZkRvY3VtZW50LCBwcm9wLCBhcmdzKTsKICB9CiAgZW5zdXJlWFJlZihwcm9wLCBhcmdzKSB7CiAgICByZXR1cm4gdGhpcy5lbnN1cmUodGhpcy5wZGZEb2N1bWVudC54cmVmLCBwcm9wLCBhcmdzKTsKICB9CiAgZW5zdXJlQ2F0YWxvZyhwcm9wLCBhcmdzKSB7CiAgICByZXR1cm4gdGhpcy5lbnN1cmUodGhpcy5wZGZEb2N1bWVudC5jYXRhbG9nLCBwcm9wLCBhcmdzKTsKICB9CiAgZ2V0UGFnZShwYWdlSW5kZXgpIHsKICAgIHJldHVybiB0aGlzLnBkZkRvY3VtZW50LmdldFBhZ2UocGFnZUluZGV4KTsKICB9CiAgZm9udEZhbGxiYWNrKGlkLCBoYW5kbGVyKSB7CiAgICByZXR1cm4gdGhpcy5wZGZEb2N1bWVudC5mb250RmFsbGJhY2soaWQsIGhhbmRsZXIpOwogIH0KICBjbGVhbnVwKG1hbnVhbGx5VHJpZ2dlcmVkID0gZmFsc2UpIHsKICAgIHJldHVybiB0aGlzLnBkZkRvY3VtZW50LmNsZWFudXAobWFudWFsbHlUcmlnZ2VyZWQpOwogIH0KICBhc3luYyBlbnN1cmUob2JqLCBwcm9wLCBhcmdzKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBlbnN1cmVgIGNhbGxlZCIpOwogIH0KICByZXF1ZXN0UmFuZ2UoYmVnaW4sIGVuZCkgewogICAgdW5yZWFjaGFibGUoIkFic3RyYWN0IG1ldGhvZCBgcmVxdWVzdFJhbmdlYCBjYWxsZWQiKTsKICB9CiAgcmVxdWVzdExvYWRlZFN0cmVhbShub0ZldGNoID0gZmFsc2UpIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYHJlcXVlc3RMb2FkZWRTdHJlYW1gIGNhbGxlZCIpOwogIH0KICBzZW5kUHJvZ3Jlc3NpdmVEYXRhKGNodW5rKSB7CiAgICB1bnJlYWNoYWJsZSgiQWJzdHJhY3QgbWV0aG9kIGBzZW5kUHJvZ3Jlc3NpdmVEYXRhYCBjYWxsZWQiKTsKICB9CiAgdXBkYXRlUGFzc3dvcmQocGFzc3dvcmQpIHsKICAgIHRoaXMuX3Bhc3N3b3JkID0gcGFzc3dvcmQ7CiAgfQogIHRlcm1pbmF0ZShyZWFzb24pIHsKICAgIHVucmVhY2hhYmxlKCJBYnN0cmFjdCBtZXRob2QgYHRlcm1pbmF0ZWAgY2FsbGVkIik7CiAgfQp9CmNsYXNzIExvY2FsUGRmTWFuYWdlciBleHRlbmRzIEJhc2VQZGZNYW5hZ2VyIHsKICBjb25zdHJ1Y3RvcihhcmdzKSB7CiAgICBzdXBlcihhcmdzKTsKICAgIGNvbnN0IHN0cmVhbSA9IG5ldyBTdHJlYW0oYXJncy5zb3VyY2UpOwogICAgdGhpcy5wZGZEb2N1bWVudCA9IG5ldyBQREZEb2N1bWVudCh0aGlzLCBzdHJlYW0pOwogICAgdGhpcy5fbG9hZGVkU3RyZWFtUHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZShzdHJlYW0pOwogIH0KICBhc3luYyBlbnN1cmUob2JqLCBwcm9wLCBhcmdzKSB7CiAgICBjb25zdCB2YWx1ZSA9IG9ialtwcm9wXTsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgcmV0dXJuIHZhbHVlLmFwcGx5KG9iaiwgYXJncyk7CiAgICB9CiAgICByZXR1cm4gdmFsdWU7CiAgfQogIHJlcXVlc3RSYW5nZShiZWdpbiwgZW5kKSB7CiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgfQogIHJlcXVlc3RMb2FkZWRTdHJlYW0obm9GZXRjaCA9IGZhbHNlKSB7CiAgICByZXR1cm4gdGhpcy5fbG9hZGVkU3RyZWFtUHJvbWlzZTsKICB9CiAgdGVybWluYXRlKHJlYXNvbikge30KfQpjbGFzcyBOZXR3b3JrUGRmTWFuYWdlciBleHRlbmRzIEJhc2VQZGZNYW5hZ2VyIHsKICBjb25zdHJ1Y3RvcihhcmdzKSB7CiAgICBzdXBlcihhcmdzKTsKICAgIHRoaXMuc3RyZWFtTWFuYWdlciA9IG5ldyBDaHVua2VkU3RyZWFtTWFuYWdlcihhcmdzLnNvdXJjZSwgewogICAgICBtc2dIYW5kbGVyOiBhcmdzLmhhbmRsZXIsCiAgICAgIGxlbmd0aDogYXJncy5sZW5ndGgsCiAgICAgIGRpc2FibGVBdXRvRmV0Y2g6IGFyZ3MuZGlzYWJsZUF1dG9GZXRjaCwKICAgICAgcmFuZ2VDaHVua1NpemU6IGFyZ3MucmFuZ2VDaHVua1NpemUKICAgIH0pOwogICAgdGhpcy5wZGZEb2N1bWVudCA9IG5ldyBQREZEb2N1bWVudCh0aGlzLCB0aGlzLnN0cmVhbU1hbmFnZXIuZ2V0U3RyZWFtKCkpOwogIH0KICBhc3luYyBlbnN1cmUob2JqLCBwcm9wLCBhcmdzKSB7CiAgICB0cnkgewogICAgICBjb25zdCB2YWx1ZSA9IG9ialtwcm9wXTsKICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIHJldHVybiB2YWx1ZS5hcHBseShvYmosIGFyZ3MpOwogICAgICB9CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmICghKGV4IGluc3RhbmNlb2YgTWlzc2luZ0RhdGFFeGNlcHRpb24pKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgYXdhaXQgdGhpcy5yZXF1ZXN0UmFuZ2UoZXguYmVnaW4sIGV4LmVuZCk7CiAgICAgIHJldHVybiB0aGlzLmVuc3VyZShvYmosIHByb3AsIGFyZ3MpOwogICAgfQogIH0KICByZXF1ZXN0UmFuZ2UoYmVnaW4sIGVuZCkgewogICAgcmV0dXJuIHRoaXMuc3RyZWFtTWFuYWdlci5yZXF1ZXN0UmFuZ2UoYmVnaW4sIGVuZCk7CiAgfQogIHJlcXVlc3RMb2FkZWRTdHJlYW0obm9GZXRjaCA9IGZhbHNlKSB7CiAgICByZXR1cm4gdGhpcy5zdHJlYW1NYW5hZ2VyLnJlcXVlc3RBbGxDaHVua3Mobm9GZXRjaCk7CiAgfQogIHNlbmRQcm9ncmVzc2l2ZURhdGEoY2h1bmspIHsKICAgIHRoaXMuc3RyZWFtTWFuYWdlci5vblJlY2VpdmVEYXRhKHsKICAgICAgY2h1bmsKICAgIH0pOwogIH0KICB0ZXJtaW5hdGUocmVhc29uKSB7CiAgICB0aGlzLnN0cmVhbU1hbmFnZXIuYWJvcnQocmVhc29uKTsKICB9Cn0KCjsvLyAuL3NyYy9zaGFyZWQvbWVzc2FnZV9oYW5kbGVyLmpzCgpjb25zdCBDYWxsYmFja0tpbmQgPSB7CiAgREFUQTogMSwKICBFUlJPUjogMgp9Owpjb25zdCBTdHJlYW1LaW5kID0gewogIENBTkNFTDogMSwKICBDQU5DRUxfQ09NUExFVEU6IDIsCiAgQ0xPU0U6IDMsCiAgRU5RVUVVRTogNCwKICBFUlJPUjogNSwKICBQVUxMOiA2LAogIFBVTExfQ09NUExFVEU6IDcsCiAgU1RBUlRfQ09NUExFVEU6IDgKfTsKZnVuY3Rpb24gb25GbigpIHt9CmZ1bmN0aW9uIHdyYXBSZWFzb24oZXgpIHsKICBpZiAoZXggaW5zdGFuY2VvZiBBYm9ydEV4Y2VwdGlvbiB8fCBleCBpbnN0YW5jZW9mIEludmFsaWRQREZFeGNlcHRpb24gfHwgZXggaW5zdGFuY2VvZiBQYXNzd29yZEV4Y2VwdGlvbiB8fCBleCBpbnN0YW5jZW9mIFJlc3BvbnNlRXhjZXB0aW9uIHx8IGV4IGluc3RhbmNlb2YgVW5rbm93bkVycm9yRXhjZXB0aW9uKSB7CiAgICByZXR1cm4gZXg7CiAgfQogIGlmICghKGV4IGluc3RhbmNlb2YgRXJyb3IgfHwgdHlwZW9mIGV4ID09PSAib2JqZWN0IiAmJiBleCAhPT0gbnVsbCkpIHsKICAgIHVucmVhY2hhYmxlKCd3cmFwUmVhc29uOiBFeHBlY3RlZCAicmVhc29uIiB0byBiZSBhIChwb3NzaWJseSBjbG9uZWQpIEVycm9yLicpOwogIH0KICBzd2l0Y2ggKGV4Lm5hbWUpIHsKICAgIGNhc2UgIkFib3J0RXhjZXB0aW9uIjoKICAgICAgcmV0dXJuIG5ldyBBYm9ydEV4Y2VwdGlvbihleC5tZXNzYWdlKTsKICAgIGNhc2UgIkludmFsaWRQREZFeGNlcHRpb24iOgogICAgICByZXR1cm4gbmV3IEludmFsaWRQREZFeGNlcHRpb24oZXgubWVzc2FnZSk7CiAgICBjYXNlICJQYXNzd29yZEV4Y2VwdGlvbiI6CiAgICAgIHJldHVybiBuZXcgUGFzc3dvcmRFeGNlcHRpb24oZXgubWVzc2FnZSwgZXguY29kZSk7CiAgICBjYXNlICJSZXNwb25zZUV4Y2VwdGlvbiI6CiAgICAgIHJldHVybiBuZXcgUmVzcG9uc2VFeGNlcHRpb24oZXgubWVzc2FnZSwgZXguc3RhdHVzLCBleC5taXNzaW5nKTsKICAgIGNhc2UgIlVua25vd25FcnJvckV4Y2VwdGlvbiI6CiAgICAgIHJldHVybiBuZXcgVW5rbm93bkVycm9yRXhjZXB0aW9uKGV4Lm1lc3NhZ2UsIGV4LmRldGFpbHMpOwogIH0KICByZXR1cm4gbmV3IFVua25vd25FcnJvckV4Y2VwdGlvbihleC5tZXNzYWdlLCBleC50b1N0cmluZygpKTsKfQpjbGFzcyBNZXNzYWdlSGFuZGxlciB7CiAgI21lc3NhZ2VBQyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICBjb25zdHJ1Y3Rvcihzb3VyY2VOYW1lLCB0YXJnZXROYW1lLCBjb21PYmopIHsKICAgIHRoaXMuc291cmNlTmFtZSA9IHNvdXJjZU5hbWU7CiAgICB0aGlzLnRhcmdldE5hbWUgPSB0YXJnZXROYW1lOwogICAgdGhpcy5jb21PYmogPSBjb21PYmo7CiAgICB0aGlzLmNhbGxiYWNrSWQgPSAxOwogICAgdGhpcy5zdHJlYW1JZCA9IDE7CiAgICB0aGlzLnN0cmVhbVNpbmtzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHRoaXMuc3RyZWFtQ29udHJvbGxlcnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgdGhpcy5jYWxsYmFja0NhcGFiaWxpdGllcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB0aGlzLmFjdGlvbkhhbmRsZXIgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgY29tT2JqLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCB0aGlzLiNvbk1lc3NhZ2UuYmluZCh0aGlzKSwgewogICAgICBzaWduYWw6IHRoaXMuI21lc3NhZ2VBQy5zaWduYWwKICAgIH0pOwogIH0KICAjb25NZXNzYWdlKHsKICAgIGRhdGEKICB9KSB7CiAgICBpZiAoZGF0YS50YXJnZXROYW1lICE9PSB0aGlzLnNvdXJjZU5hbWUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGRhdGEuc3RyZWFtKSB7CiAgICAgIHRoaXMuI3Byb2Nlc3NTdHJlYW1NZXNzYWdlKGRhdGEpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoZGF0YS5jYWxsYmFjaykgewogICAgICBjb25zdCBjYWxsYmFja0lkID0gZGF0YS5jYWxsYmFja0lkOwogICAgICBjb25zdCBjYXBhYmlsaXR5ID0gdGhpcy5jYWxsYmFja0NhcGFiaWxpdGllc1tjYWxsYmFja0lkXTsKICAgICAgaWYgKCFjYXBhYmlsaXR5KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgcmVzb2x2ZSBjYWxsYmFjayAke2NhbGxiYWNrSWR9YCk7CiAgICAgIH0KICAgICAgZGVsZXRlIHRoaXMuY2FsbGJhY2tDYXBhYmlsaXRpZXNbY2FsbGJhY2tJZF07CiAgICAgIGlmIChkYXRhLmNhbGxiYWNrID09PSBDYWxsYmFja0tpbmQuREFUQSkgewogICAgICAgIGNhcGFiaWxpdHkucmVzb2x2ZShkYXRhLmRhdGEpOwogICAgICB9IGVsc2UgaWYgKGRhdGEuY2FsbGJhY2sgPT09IENhbGxiYWNrS2luZC5FUlJPUikgewogICAgICAgIGNhcGFiaWxpdHkucmVqZWN0KHdyYXBSZWFzb24oZGF0YS5yZWFzb24pKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVuZXhwZWN0ZWQgY2FsbGJhY2sgY2FzZSIpOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGFjdGlvbiA9IHRoaXMuYWN0aW9uSGFuZGxlcltkYXRhLmFjdGlvbl07CiAgICBpZiAoIWFjdGlvbikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gYWN0aW9uIGZyb20gd29ya2VyOiAke2RhdGEuYWN0aW9ufWApOwogICAgfQogICAgaWYgKGRhdGEuY2FsbGJhY2tJZCkgewogICAgICBjb25zdCBzb3VyY2VOYW1lID0gdGhpcy5zb3VyY2VOYW1lLAogICAgICAgIHRhcmdldE5hbWUgPSBkYXRhLnNvdXJjZU5hbWUsCiAgICAgICAgY29tT2JqID0gdGhpcy5jb21PYmo7CiAgICAgIFByb21pc2UudHJ5KGFjdGlvbiwgZGF0YS5kYXRhKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICBjYWxsYmFjazogQ2FsbGJhY2tLaW5kLkRBVEEsCiAgICAgICAgICBjYWxsYmFja0lkOiBkYXRhLmNhbGxiYWNrSWQsCiAgICAgICAgICBkYXRhOiByZXN1bHQKICAgICAgICB9KTsKICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIGNhbGxiYWNrOiBDYWxsYmFja0tpbmQuRVJST1IsCiAgICAgICAgICBjYWxsYmFja0lkOiBkYXRhLmNhbGxiYWNrSWQsCiAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGRhdGEuc3RyZWFtSWQpIHsKICAgICAgdGhpcy4jY3JlYXRlU3RyZWFtU2luayhkYXRhKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgYWN0aW9uKGRhdGEuZGF0YSk7CiAgfQogIG9uKGFjdGlvbk5hbWUsIGhhbmRsZXIpIHsKICAgIGNvbnN0IGFoID0gdGhpcy5hY3Rpb25IYW5kbGVyOwogICAgaWYgKGFoW2FjdGlvbk5hbWVdKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlcmUgaXMgYWxyZWFkeSBhbiBhY3Rpb25OYW1lIGNhbGxlZCAiJHthY3Rpb25OYW1lfSJgKTsKICAgIH0KICAgIGFoW2FjdGlvbk5hbWVdID0gaGFuZGxlcjsKICB9CiAgc2VuZChhY3Rpb25OYW1lLCBkYXRhLCB0cmFuc2ZlcnMpIHsKICAgIHRoaXMuY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgc291cmNlTmFtZTogdGhpcy5zb3VyY2VOYW1lLAogICAgICB0YXJnZXROYW1lOiB0aGlzLnRhcmdldE5hbWUsCiAgICAgIGFjdGlvbjogYWN0aW9uTmFtZSwKICAgICAgZGF0YQogICAgfSwgdHJhbnNmZXJzKTsKICB9CiAgc2VuZFdpdGhQcm9taXNlKGFjdGlvbk5hbWUsIGRhdGEsIHRyYW5zZmVycykgewogICAgY29uc3QgY2FsbGJhY2tJZCA9IHRoaXMuY2FsbGJhY2tJZCsrOwogICAgY29uc3QgY2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgdGhpcy5jYWxsYmFja0NhcGFiaWxpdGllc1tjYWxsYmFja0lkXSA9IGNhcGFiaWxpdHk7CiAgICB0cnkgewogICAgICB0aGlzLmNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgc291cmNlTmFtZTogdGhpcy5zb3VyY2VOYW1lLAogICAgICAgIHRhcmdldE5hbWU6IHRoaXMudGFyZ2V0TmFtZSwKICAgICAgICBhY3Rpb246IGFjdGlvbk5hbWUsCiAgICAgICAgY2FsbGJhY2tJZCwKICAgICAgICBkYXRhCiAgICAgIH0sIHRyYW5zZmVycyk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBjYXBhYmlsaXR5LnJlamVjdChleCk7CiAgICB9CiAgICByZXR1cm4gY2FwYWJpbGl0eS5wcm9taXNlOwogIH0KICBzZW5kV2l0aFN0cmVhbShhY3Rpb25OYW1lLCBkYXRhLCBxdWV1ZWluZ1N0cmF0ZWd5LCB0cmFuc2ZlcnMpIHsKICAgIGNvbnN0IHN0cmVhbUlkID0gdGhpcy5zdHJlYW1JZCsrLAogICAgICBzb3VyY2VOYW1lID0gdGhpcy5zb3VyY2VOYW1lLAogICAgICB0YXJnZXROYW1lID0gdGhpcy50YXJnZXROYW1lLAogICAgICBjb21PYmogPSB0aGlzLmNvbU9iajsKICAgIHJldHVybiBuZXcgUmVhZGFibGVTdHJlYW0oewogICAgICBzdGFydDogY29udHJvbGxlciA9PiB7CiAgICAgICAgY29uc3Qgc3RhcnRDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0gPSB7CiAgICAgICAgICBjb250cm9sbGVyLAogICAgICAgICAgc3RhcnRDYWxsOiBzdGFydENhcGFiaWxpdHksCiAgICAgICAgICBwdWxsQ2FsbDogbnVsbCwKICAgICAgICAgIGNhbmNlbENhbGw6IG51bGwsCiAgICAgICAgICBpc0Nsb3NlZDogZmFsc2UKICAgICAgICB9OwogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIGFjdGlvbjogYWN0aW9uTmFtZSwKICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgZGF0YSwKICAgICAgICAgIGRlc2lyZWRTaXplOiBjb250cm9sbGVyLmRlc2lyZWRTaXplCiAgICAgICAgfSwgdHJhbnNmZXJzKTsKICAgICAgICByZXR1cm4gc3RhcnRDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgIH0sCiAgICAgIHB1bGw6IGNvbnRyb2xsZXIgPT4gewogICAgICAgIGNvbnN0IHB1bGxDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0ucHVsbENhbGwgPSBwdWxsQ2FwYWJpbGl0eTsKICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuUFVMTCwKICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgZGVzaXJlZFNpemU6IGNvbnRyb2xsZXIuZGVzaXJlZFNpemUKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcHVsbENhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgfSwKICAgICAgY2FuY2VsOiByZWFzb24gPT4gewogICAgICAgIGFzc2VydChyZWFzb24gaW5zdGFuY2VvZiBFcnJvciwgImNhbmNlbCBtdXN0IGhhdmUgYSB2YWxpZCByZWFzb24iKTsKICAgICAgICBjb25zdCBjYW5jZWxDYXBhYmlsaXR5ID0gUHJvbWlzZS53aXRoUmVzb2x2ZXJzKCk7CiAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uY2FuY2VsQ2FsbCA9IGNhbmNlbENhcGFiaWxpdHk7CiAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0uaXNDbG9zZWQgPSB0cnVlOwogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5DQU5DRUwsCiAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgIHJlYXNvbjogd3JhcFJlYXNvbihyZWFzb24pCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGNhbmNlbENhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgfQogICAgfSwgcXVldWVpbmdTdHJhdGVneSk7CiAgfQogICNjcmVhdGVTdHJlYW1TaW5rKGRhdGEpIHsKICAgIGNvbnN0IHN0cmVhbUlkID0gZGF0YS5zdHJlYW1JZCwKICAgICAgc291cmNlTmFtZSA9IHRoaXMuc291cmNlTmFtZSwKICAgICAgdGFyZ2V0TmFtZSA9IGRhdGEuc291cmNlTmFtZSwKICAgICAgY29tT2JqID0gdGhpcy5jb21PYmo7CiAgICBjb25zdCBzZWxmID0gdGhpcywKICAgICAgYWN0aW9uID0gdGhpcy5hY3Rpb25IYW5kbGVyW2RhdGEuYWN0aW9uXTsKICAgIGNvbnN0IHN0cmVhbVNpbmsgPSB7CiAgICAgIGVucXVldWUoY2h1bmssIHNpemUgPSAxLCB0cmFuc2ZlcnMpIHsKICAgICAgICBpZiAodGhpcy5pc0NhbmNlbGxlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBsYXN0RGVzaXJlZFNpemUgPSB0aGlzLmRlc2lyZWRTaXplOwogICAgICAgIHRoaXMuZGVzaXJlZFNpemUgLT0gc2l6ZTsKICAgICAgICBpZiAobGFzdERlc2lyZWRTaXplID4gMCAmJiB0aGlzLmRlc2lyZWRTaXplIDw9IDApIHsKICAgICAgICAgIHRoaXMuc2lua0NhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICAgICAgICAgIHRoaXMucmVhZHkgPSB0aGlzLnNpbmtDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgICAgfQogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5FTlFVRVVFLAogICAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgICBjaHVuawogICAgICAgIH0sIHRyYW5zZmVycyk7CiAgICAgIH0sCiAgICAgIGNsb3NlKCkgewogICAgICAgIGlmICh0aGlzLmlzQ2FuY2VsbGVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuaXNDYW5jZWxsZWQgPSB0cnVlOwogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5DTE9TRSwKICAgICAgICAgIHN0cmVhbUlkCiAgICAgICAgfSk7CiAgICAgICAgZGVsZXRlIHNlbGYuc3RyZWFtU2lua3Nbc3RyZWFtSWRdOwogICAgICB9LAogICAgICBlcnJvcihyZWFzb24pIHsKICAgICAgICBhc3NlcnQocmVhc29uIGluc3RhbmNlb2YgRXJyb3IsICJlcnJvciBtdXN0IGhhdmUgYSB2YWxpZCByZWFzb24iKTsKICAgICAgICBpZiAodGhpcy5pc0NhbmNlbGxlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmlzQ2FuY2VsbGVkID0gdHJ1ZTsKICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuRVJST1IsCiAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgIHJlYXNvbjogd3JhcFJlYXNvbihyZWFzb24pCiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHNpbmtDYXBhYmlsaXR5OiBQcm9taXNlLndpdGhSZXNvbHZlcnMoKSwKICAgICAgb25QdWxsOiBudWxsLAogICAgICBvbkNhbmNlbDogbnVsbCwKICAgICAgaXNDYW5jZWxsZWQ6IGZhbHNlLAogICAgICBkZXNpcmVkU2l6ZTogZGF0YS5kZXNpcmVkU2l6ZSwKICAgICAgcmVhZHk6IG51bGwKICAgIH07CiAgICBzdHJlYW1TaW5rLnNpbmtDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgIHN0cmVhbVNpbmsucmVhZHkgPSBzdHJlYW1TaW5rLnNpbmtDYXBhYmlsaXR5LnByb21pc2U7CiAgICB0aGlzLnN0cmVhbVNpbmtzW3N0cmVhbUlkXSA9IHN0cmVhbVNpbms7CiAgICBQcm9taXNlLnRyeShhY3Rpb24sIGRhdGEuZGF0YSwgc3RyZWFtU2luaykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgc291cmNlTmFtZSwKICAgICAgICB0YXJnZXROYW1lLAogICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5TVEFSVF9DT01QTEVURSwKICAgICAgICBzdHJlYW1JZCwKICAgICAgICBzdWNjZXNzOiB0cnVlCiAgICAgIH0pOwogICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuU1RBUlRfQ09NUExFVEUsCiAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgcmVhc29uOiB3cmFwUmVhc29uKHJlYXNvbikKICAgICAgfSk7CiAgICB9KTsKICB9CiAgI3Byb2Nlc3NTdHJlYW1NZXNzYWdlKGRhdGEpIHsKICAgIGNvbnN0IHN0cmVhbUlkID0gZGF0YS5zdHJlYW1JZCwKICAgICAgc291cmNlTmFtZSA9IHRoaXMuc291cmNlTmFtZSwKICAgICAgdGFyZ2V0TmFtZSA9IGRhdGEuc291cmNlTmFtZSwKICAgICAgY29tT2JqID0gdGhpcy5jb21PYmo7CiAgICBjb25zdCBzdHJlYW1Db250cm9sbGVyID0gdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0sCiAgICAgIHN0cmVhbVNpbmsgPSB0aGlzLnN0cmVhbVNpbmtzW3N0cmVhbUlkXTsKICAgIHN3aXRjaCAoZGF0YS5zdHJlYW0pIHsKICAgICAgY2FzZSBTdHJlYW1LaW5kLlNUQVJUX0NPTVBMRVRFOgogICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHsKICAgICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuc3RhcnRDYWxsLnJlc29sdmUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtQ29udHJvbGxlci5zdGFydENhbGwucmVqZWN0KHdyYXBSZWFzb24oZGF0YS5yZWFzb24pKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgU3RyZWFtS2luZC5QVUxMX0NPTVBMRVRFOgogICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHsKICAgICAgICAgIHN0cmVhbUNvbnRyb2xsZXIucHVsbENhbGwucmVzb2x2ZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJlYW1Db250cm9sbGVyLnB1bGxDYWxsLnJlamVjdCh3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFN0cmVhbUtpbmQuUFVMTDoKICAgICAgICBpZiAoIXN0cmVhbVNpbmspIHsKICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5QVUxMX0NPTVBMRVRFLAogICAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgICAgc3VjY2VzczogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cmVhbVNpbmsuZGVzaXJlZFNpemUgPD0gMCAmJiBkYXRhLmRlc2lyZWRTaXplID4gMCkgewogICAgICAgICAgc3RyZWFtU2luay5zaW5rQ2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgICAgICAgfQogICAgICAgIHN0cmVhbVNpbmsuZGVzaXJlZFNpemUgPSBkYXRhLmRlc2lyZWRTaXplOwogICAgICAgIFByb21pc2UudHJ5KHN0cmVhbVNpbmsub25QdWxsIHx8IG9uRm4pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLlBVTExfQ09NUExFVEUsCiAgICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgICBzdWNjZXNzOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgICB0YXJnZXROYW1lLAogICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuUFVMTF9DT01QTEVURSwKICAgICAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgICAgIHJlYXNvbjogd3JhcFJlYXNvbihyZWFzb24pCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTdHJlYW1LaW5kLkVOUVVFVUU6CiAgICAgICAgYXNzZXJ0KHN0cmVhbUNvbnRyb2xsZXIsICJlbnF1ZXVlIHNob3VsZCBoYXZlIHN0cmVhbSBjb250cm9sbGVyIik7CiAgICAgICAgaWYgKHN0cmVhbUNvbnRyb2xsZXIuaXNDbG9zZWQpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBzdHJlYW1Db250cm9sbGVyLmNvbnRyb2xsZXIuZW5xdWV1ZShkYXRhLmNodW5rKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTdHJlYW1LaW5kLkNMT1NFOgogICAgICAgIGFzc2VydChzdHJlYW1Db250cm9sbGVyLCAiY2xvc2Ugc2hvdWxkIGhhdmUgc3RyZWFtIGNvbnRyb2xsZXIiKTsKICAgICAgICBpZiAoc3RyZWFtQ29udHJvbGxlci5pc0Nsb3NlZCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuaXNDbG9zZWQgPSB0cnVlOwogICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuY29udHJvbGxlci5jbG9zZSgpOwogICAgICAgIHRoaXMuI2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIoc3RyZWFtQ29udHJvbGxlciwgc3RyZWFtSWQpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFN0cmVhbUtpbmQuRVJST1I6CiAgICAgICAgYXNzZXJ0KHN0cmVhbUNvbnRyb2xsZXIsICJlcnJvciBzaG91bGQgaGF2ZSBzdHJlYW0gY29udHJvbGxlciIpOwogICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuY29udHJvbGxlci5lcnJvcih3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CiAgICAgICAgdGhpcy4jZGVsZXRlU3RyZWFtQ29udHJvbGxlcihzdHJlYW1Db250cm9sbGVyLCBzdHJlYW1JZCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgU3RyZWFtS2luZC5DQU5DRUxfQ09NUExFVEU6CiAgICAgICAgaWYgKGRhdGEuc3VjY2VzcykgewogICAgICAgICAgc3RyZWFtQ29udHJvbGxlci5jYW5jZWxDYWxsLnJlc29sdmUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtQ29udHJvbGxlci5jYW5jZWxDYWxsLnJlamVjdCh3cmFwUmVhc29uKGRhdGEucmVhc29uKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuI2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIoc3RyZWFtQ29udHJvbGxlciwgc3RyZWFtSWQpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFN0cmVhbUtpbmQuQ0FOQ0VMOgogICAgICAgIGlmICghc3RyZWFtU2luaykgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGRhdGFSZWFzb24gPSB3cmFwUmVhc29uKGRhdGEucmVhc29uKTsKICAgICAgICBQcm9taXNlLnRyeShzdHJlYW1TaW5rLm9uQ2FuY2VsIHx8IG9uRm4sIGRhdGFSZWFzb24pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLkNBTkNFTF9DT01QTEVURSwKICAgICAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5DQU5DRUxfQ09NUExFVEUsCiAgICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgc3RyZWFtU2luay5zaW5rQ2FwYWJpbGl0eS5yZWplY3QoZGF0YVJlYXNvbik7CiAgICAgICAgc3RyZWFtU2luay5pc0NhbmNlbGxlZCA9IHRydWU7CiAgICAgICAgZGVsZXRlIHRoaXMuc3RyZWFtU2lua3Nbc3RyZWFtSWRdOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBzdHJlYW0gY2FzZSIpOwogICAgfQogIH0KICBhc3luYyAjZGVsZXRlU3RyZWFtQ29udHJvbGxlcihzdHJlYW1Db250cm9sbGVyLCBzdHJlYW1JZCkgewogICAgYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKFtzdHJlYW1Db250cm9sbGVyLnN0YXJ0Q2FsbD8ucHJvbWlzZSwgc3RyZWFtQ29udHJvbGxlci5wdWxsQ2FsbD8ucHJvbWlzZSwgc3RyZWFtQ29udHJvbGxlci5jYW5jZWxDYWxsPy5wcm9taXNlXSk7CiAgICBkZWxldGUgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF07CiAgfQogIGRlc3Ryb3koKSB7CiAgICB0aGlzLiNtZXNzYWdlQUM/LmFib3J0KCk7CiAgICB0aGlzLiNtZXNzYWdlQUMgPSBudWxsOwogIH0KfQoKOy8vIC4vc3JjL2NvcmUvd3JpdGVyLmpzCgoKCgoKCgphc3luYyBmdW5jdGlvbiB3cml0ZU9iamVjdChyZWYsIG9iaiwgYnVmZmVyLCB7CiAgZW5jcnlwdCA9IG51bGwKfSkgewogIGNvbnN0IHRyYW5zZm9ybSA9IGVuY3J5cHQ/LmNyZWF0ZUNpcGhlclRyYW5zZm9ybShyZWYubnVtLCByZWYuZ2VuKTsKICBidWZmZXIucHVzaChgJHtyZWYubnVtfSAke3JlZi5nZW59IG9ialxuYCk7CiAgaWYgKG9iaiBpbnN0YW5jZW9mIERpY3QpIHsKICAgIGF3YWl0IHdyaXRlRGljdChvYmosIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9IGVsc2UgaWYgKG9iaiBpbnN0YW5jZW9mIEJhc2VTdHJlYW0pIHsKICAgIGF3YWl0IHdyaXRlU3RyZWFtKG9iaiwgYnVmZmVyLCB0cmFuc2Zvcm0pOwogIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopIHx8IEFycmF5QnVmZmVyLmlzVmlldyhvYmopKSB7CiAgICBhd2FpdCB3cml0ZUFycmF5KG9iaiwgYnVmZmVyLCB0cmFuc2Zvcm0pOwogIH0KICBidWZmZXIucHVzaCgiXG5lbmRvYmpcbiIpOwp9CmFzeW5jIGZ1bmN0aW9uIHdyaXRlRGljdChkaWN0LCBidWZmZXIsIHRyYW5zZm9ybSkgewogIGJ1ZmZlci5wdXNoKCI8PCIpOwogIGZvciAoY29uc3Qga2V5IG9mIGRpY3QuZ2V0S2V5cygpKSB7CiAgICBidWZmZXIucHVzaChgIC8ke2VzY2FwZVBERk5hbWUoa2V5KX0gYCk7CiAgICBhd2FpdCB3cml0ZVZhbHVlKGRpY3QuZ2V0UmF3KGtleSksIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9CiAgYnVmZmVyLnB1c2goIj4+Iik7Cn0KYXN5bmMgZnVuY3Rpb24gd3JpdGVTdHJlYW0oc3RyZWFtLCBidWZmZXIsIHRyYW5zZm9ybSkgewogIGxldCBieXRlcyA9IHN0cmVhbS5nZXRCeXRlcygpOwogIGNvbnN0IHsKICAgIGRpY3QKICB9ID0gc3RyZWFtOwogIGNvbnN0IFtmaWx0ZXIsIHBhcmFtc10gPSBhd2FpdCBQcm9taXNlLmFsbChbZGljdC5nZXRBc3luYygiRmlsdGVyIiksIGRpY3QuZ2V0QXN5bmMoIkRlY29kZVBhcm1zIildKTsKICBjb25zdCBmaWx0ZXJaZXJvID0gQXJyYXkuaXNBcnJheShmaWx0ZXIpID8gYXdhaXQgZGljdC54cmVmLmZldGNoSWZSZWZBc3luYyhmaWx0ZXJbMF0pIDogZmlsdGVyOwogIGNvbnN0IGlzRmlsdGVyWmVyb0ZsYXRlRGVjb2RlID0gaXNOYW1lKGZpbHRlclplcm8sICJGbGF0ZURlY29kZSIpOwogIGNvbnN0IE1JTl9MRU5HVEhfRk9SX0NPTVBSRVNTSU5HID0gMjU2OwogIGlmIChieXRlcy5sZW5ndGggPj0gTUlOX0xFTkdUSF9GT1JfQ09NUFJFU1NJTkcgfHwgaXNGaWx0ZXJaZXJvRmxhdGVEZWNvZGUpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IGNzID0gbmV3IENvbXByZXNzaW9uU3RyZWFtKCJkZWZsYXRlIik7CiAgICAgIGNvbnN0IHdyaXRlciA9IGNzLndyaXRhYmxlLmdldFdyaXRlcigpOwogICAgICBhd2FpdCB3cml0ZXIucmVhZHk7CiAgICAgIHdyaXRlci53cml0ZShieXRlcykudGhlbihhc3luYyAoKSA9PiB7CiAgICAgICAgYXdhaXQgd3JpdGVyLnJlYWR5OwogICAgICAgIGF3YWl0IHdyaXRlci5jbG9zZSgpOwogICAgICB9KS5jYXRjaCgoKSA9PiB7fSk7CiAgICAgIGNvbnN0IGJ1ZiA9IGF3YWl0IG5ldyBSZXNwb25zZShjcy5yZWFkYWJsZSkuYXJyYXlCdWZmZXIoKTsKICAgICAgYnl0ZXMgPSBuZXcgVWludDhBcnJheShidWYpOwogICAgICBsZXQgbmV3RmlsdGVyLCBuZXdQYXJhbXM7CiAgICAgIGlmICghZmlsdGVyKSB7CiAgICAgICAgbmV3RmlsdGVyID0gTmFtZS5nZXQoIkZsYXRlRGVjb2RlIik7CiAgICAgIH0gZWxzZSBpZiAoIWlzRmlsdGVyWmVyb0ZsYXRlRGVjb2RlKSB7CiAgICAgICAgbmV3RmlsdGVyID0gQXJyYXkuaXNBcnJheShmaWx0ZXIpID8gW05hbWUuZ2V0KCJGbGF0ZURlY29kZSIpLCAuLi5maWx0ZXJdIDogW05hbWUuZ2V0KCJGbGF0ZURlY29kZSIpLCBmaWx0ZXJdOwogICAgICAgIGlmIChwYXJhbXMpIHsKICAgICAgICAgIG5ld1BhcmFtcyA9IEFycmF5LmlzQXJyYXkocGFyYW1zKSA/IFtudWxsLCAuLi5wYXJhbXNdIDogW251bGwsIHBhcmFtc107CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChuZXdGaWx0ZXIpIHsKICAgICAgICBkaWN0LnNldCgiRmlsdGVyIiwgbmV3RmlsdGVyKTsKICAgICAgfQogICAgICBpZiAobmV3UGFyYW1zKSB7CiAgICAgICAgZGljdC5zZXQoIkRlY29kZVBhcm1zIiwgbmV3UGFyYW1zKTsKICAgICAgfQogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaW5mbyhgd3JpdGVTdHJlYW0gLSBjYW5ub3QgY29tcHJlc3MgZGF0YTogIiR7ZXh9Ii5gKTsKICAgIH0KICB9CiAgbGV0IHN0cmluZyA9IGJ5dGVzVG9TdHJpbmcoYnl0ZXMpOwogIGlmICh0cmFuc2Zvcm0pIHsKICAgIHN0cmluZyA9IHRyYW5zZm9ybS5lbmNyeXB0U3RyaW5nKHN0cmluZyk7CiAgfQogIGRpY3Quc2V0KCJMZW5ndGgiLCBzdHJpbmcubGVuZ3RoKTsKICBhd2FpdCB3cml0ZURpY3QoZGljdCwgYnVmZmVyLCB0cmFuc2Zvcm0pOwogIGJ1ZmZlci5wdXNoKCIgc3RyZWFtXG4iLCBzdHJpbmcsICJcbmVuZHN0cmVhbSIpOwp9CmFzeW5jIGZ1bmN0aW9uIHdyaXRlQXJyYXkoYXJyYXksIGJ1ZmZlciwgdHJhbnNmb3JtKSB7CiAgYnVmZmVyLnB1c2goIlsiKTsKICBsZXQgZmlyc3QgPSB0cnVlOwogIGZvciAoY29uc3QgdmFsIG9mIGFycmF5KSB7CiAgICBpZiAoIWZpcnN0KSB7CiAgICAgIGJ1ZmZlci5wdXNoKCIgIik7CiAgICB9IGVsc2UgewogICAgICBmaXJzdCA9IGZhbHNlOwogICAgfQogICAgYXdhaXQgd3JpdGVWYWx1ZSh2YWwsIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9CiAgYnVmZmVyLnB1c2goIl0iKTsKfQphc3luYyBmdW5jdGlvbiB3cml0ZVZhbHVlKHZhbHVlLCBidWZmZXIsIHRyYW5zZm9ybSkgewogIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE5hbWUpIHsKICAgIGJ1ZmZlci5wdXNoKGAvJHtlc2NhcGVQREZOYW1lKHZhbHVlLm5hbWUpfWApOwogIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBSZWYpIHsKICAgIGJ1ZmZlci5wdXNoKGAke3ZhbHVlLm51bX0gJHt2YWx1ZS5nZW59IFJgKTsKICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpIHx8IEFycmF5QnVmZmVyLmlzVmlldyh2YWx1ZSkpIHsKICAgIGF3YWl0IHdyaXRlQXJyYXkodmFsdWUsIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIpIHsKICAgIGlmICh0cmFuc2Zvcm0pIHsKICAgICAgdmFsdWUgPSB0cmFuc2Zvcm0uZW5jcnlwdFN0cmluZyh2YWx1ZSk7CiAgICB9CiAgICBidWZmZXIucHVzaChgKCR7ZXNjYXBlU3RyaW5nKHZhbHVlKX0pYCk7CiAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICJudW1iZXIiKSB7CiAgICBidWZmZXIucHVzaChudW1iZXJUb1N0cmluZyh2YWx1ZSkpOwogIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAiYm9vbGVhbiIpIHsKICAgIGJ1ZmZlci5wdXNoKHZhbHVlLnRvU3RyaW5nKCkpOwogIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBEaWN0KSB7CiAgICBhd2FpdCB3cml0ZURpY3QodmFsdWUsIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgQmFzZVN0cmVhbSkgewogICAgYXdhaXQgd3JpdGVTdHJlYW0odmFsdWUsIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9IGVsc2UgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICBidWZmZXIucHVzaCgibnVsbCIpOwogIH0gZWxzZSB7CiAgICB3YXJuKGBVbmhhbmRsZWQgdmFsdWUgaW4gd3JpdGVyOiAke3R5cGVvZiB2YWx1ZX0sIHBsZWFzZSBmaWxlIGEgYnVnLmApOwogIH0KfQpmdW5jdGlvbiB3cml0ZUludChudW1iZXIsIHNpemUsIG9mZnNldCwgYnVmZmVyKSB7CiAgZm9yIChsZXQgaSA9IHNpemUgKyBvZmZzZXQgLSAxOyBpID4gb2Zmc2V0IC0gMTsgaS0tKSB7CiAgICBidWZmZXJbaV0gPSBudW1iZXIgJiAweGZmOwogICAgbnVtYmVyID4+PSA4OwogIH0KICByZXR1cm4gb2Zmc2V0ICsgc2l6ZTsKfQpmdW5jdGlvbiB3cml0ZVN0cmluZyhzdHJpbmcsIG9mZnNldCwgYnVmZmVyKSB7CiAgY29uc3QgaWkgPSBzdHJpbmcubGVuZ3RoOwogIGZvciAobGV0IGkgPSAwOyBpIDwgaWk7IGkrKykgewogICAgYnVmZmVyW29mZnNldCArIGldID0gc3RyaW5nLmNoYXJDb2RlQXQoaSkgJiAweGZmOwogIH0KICByZXR1cm4gb2Zmc2V0ICsgaWk7Cn0KZnVuY3Rpb24gY29tcHV0ZU1ENShmaWxlc2l6ZSwgeHJlZkluZm8pIHsKICBjb25zdCB0aW1lID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCk7CiAgY29uc3QgZmlsZW5hbWUgPSB4cmVmSW5mby5maWxlbmFtZSB8fCAiIjsKICBjb25zdCBtZDVCdWZmZXIgPSBbdGltZS50b1N0cmluZygpLCBmaWxlbmFtZSwgZmlsZXNpemUudG9TdHJpbmcoKSwgLi4ueHJlZkluZm8uaW5mb01hcC52YWx1ZXMoKV07CiAgY29uc3QgbWQ1QnVmZmVyTGVuID0gTWF0aC5zdW1QcmVjaXNlKG1kNUJ1ZmZlci5tYXAoc3RyID0+IHN0ci5sZW5ndGgpKTsKICBjb25zdCBhcnJheSA9IG5ldyBVaW50OEFycmF5KG1kNUJ1ZmZlckxlbik7CiAgbGV0IG9mZnNldCA9IDA7CiAgZm9yIChjb25zdCBzdHIgb2YgbWQ1QnVmZmVyKSB7CiAgICBvZmZzZXQgPSB3cml0ZVN0cmluZyhzdHIsIG9mZnNldCwgYXJyYXkpOwogIH0KICByZXR1cm4gYnl0ZXNUb1N0cmluZyhjYWxjdWxhdGVNRDUoYXJyYXksIDAsIGFycmF5Lmxlbmd0aCkpOwp9CmZ1bmN0aW9uIHdyaXRlWEZBRGF0YUZvckFjcm9mb3JtKHN0ciwgY2hhbmdlcykgewogIGNvbnN0IHhtbCA9IG5ldyBTaW1wbGVYTUxQYXJzZXIoewogICAgaGFzQXR0cmlidXRlczogdHJ1ZQogIH0pLnBhcnNlRnJvbVN0cmluZyhzdHIpOwogIGZvciAoY29uc3QgewogICAgeGZhCiAgfSBvZiBjaGFuZ2VzKSB7CiAgICBpZiAoIXhmYSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IHsKICAgICAgcGF0aCwKICAgICAgdmFsdWUKICAgIH0gPSB4ZmE7CiAgICBpZiAoIXBhdGgpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBjb25zdCBub2RlUGF0aCA9IHBhcnNlWEZBUGF0aChwYXRoKTsKICAgIGxldCBub2RlID0geG1sLmRvY3VtZW50RWxlbWVudC5zZWFyY2hOb2RlKG5vZGVQYXRoLCAwKTsKICAgIGlmICghbm9kZSAmJiBub2RlUGF0aC5sZW5ndGggPiAxKSB7CiAgICAgIG5vZGUgPSB4bWwuZG9jdW1lbnRFbGVtZW50LnNlYXJjaE5vZGUoW25vZGVQYXRoLmF0KC0xKV0sIDApOwogICAgfQogICAgaWYgKG5vZGUpIHsKICAgICAgbm9kZS5jaGlsZE5vZGVzID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5tYXAodmFsID0+IG5ldyBTaW1wbGVET01Ob2RlKCJ2YWx1ZSIsIHZhbCkpIDogW25ldyBTaW1wbGVET01Ob2RlKCIjdGV4dCIsIHZhbHVlKV07CiAgICB9IGVsc2UgewogICAgICB3YXJuKGBOb2RlIG5vdCBmb3VuZCBmb3IgcGF0aDogJHtwYXRofWApOwogICAgfQogIH0KICBjb25zdCBidWZmZXIgPSBbXTsKICB4bWwuZG9jdW1lbnRFbGVtZW50LmR1bXAoYnVmZmVyKTsKICByZXR1cm4gYnVmZmVyLmpvaW4oIiIpOwp9CmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUFjcm9mb3JtKHsKICB4cmVmLAogIGFjcm9Gb3JtLAogIGFjcm9Gb3JtUmVmLAogIGhhc1hmYSwKICBoYXNYZmFEYXRhc2V0c0VudHJ5LAogIHhmYURhdGFzZXRzUmVmLAogIG5lZWRBcHBlYXJhbmNlcywKICBjaGFuZ2VzCn0pIHsKICBpZiAoaGFzWGZhICYmICFoYXNYZmFEYXRhc2V0c0VudHJ5ICYmICF4ZmFEYXRhc2V0c1JlZikgewogICAgd2FybigiWEZBIC0gQ2Fubm90IHNhdmUgaXQiKTsKICB9CiAgaWYgKCFuZWVkQXBwZWFyYW5jZXMgJiYgKCFoYXNYZmEgfHwgIXhmYURhdGFzZXRzUmVmIHx8IGhhc1hmYURhdGFzZXRzRW50cnkpKSB7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IGRpY3QgPSBhY3JvRm9ybS5jbG9uZSgpOwogIGlmIChoYXNYZmEgJiYgIWhhc1hmYURhdGFzZXRzRW50cnkpIHsKICAgIGNvbnN0IG5ld1hmYSA9IGFjcm9Gb3JtLmdldCgiWEZBIikuc2xpY2UoKTsKICAgIG5ld1hmYS5zcGxpY2UoMiwgMCwgImRhdGFzZXRzIik7CiAgICBuZXdYZmEuc3BsaWNlKDMsIDAsIHhmYURhdGFzZXRzUmVmKTsKICAgIGRpY3Quc2V0KCJYRkEiLCBuZXdYZmEpOwogIH0KICBpZiAobmVlZEFwcGVhcmFuY2VzKSB7CiAgICBkaWN0LnNldCgiTmVlZEFwcGVhcmFuY2VzIiwgdHJ1ZSk7CiAgfQogIGNoYW5nZXMucHV0KGFjcm9Gb3JtUmVmLCB7CiAgICBkYXRhOiBkaWN0CiAgfSk7Cn0KZnVuY3Rpb24gdXBkYXRlWEZBKHsKICB4ZmFEYXRhLAogIHhmYURhdGFzZXRzUmVmLAogIGNoYW5nZXMsCiAgeHJlZgp9KSB7CiAgaWYgKHhmYURhdGEgPT09IG51bGwpIHsKICAgIGNvbnN0IGRhdGFzZXRzID0geHJlZi5mZXRjaElmUmVmKHhmYURhdGFzZXRzUmVmKTsKICAgIHhmYURhdGEgPSB3cml0ZVhGQURhdGFGb3JBY3JvZm9ybShkYXRhc2V0cy5nZXRTdHJpbmcoKSwgY2hhbmdlcyk7CiAgfQogIGNvbnN0IHhmYURhdGFTdHJlYW0gPSBuZXcgU3RyaW5nU3RyZWFtKHhmYURhdGEpOwogIHhmYURhdGFTdHJlYW0uZGljdCA9IG5ldyBEaWN0KHhyZWYpOwogIHhmYURhdGFTdHJlYW0uZGljdC5zZXRJZk5hbWUoIlR5cGUiLCAiRW1iZWRkZWRGaWxlIik7CiAgY2hhbmdlcy5wdXQoeGZhRGF0YXNldHNSZWYsIHsKICAgIGRhdGE6IHhmYURhdGFTdHJlYW0KICB9KTsKfQphc3luYyBmdW5jdGlvbiBnZXRYUmVmVGFibGUoeHJlZkluZm8sIGJhc2VPZmZzZXQsIG5ld1JlZnMsIG5ld1hyZWYsIGJ1ZmZlcikgewogIGJ1ZmZlci5wdXNoKCJ4cmVmXG4iKTsKICBjb25zdCBpbmRleGVzID0gZ2V0SW5kZXhlcyhuZXdSZWZzKTsKICBsZXQgaW5kZXhlc1Bvc2l0aW9uID0gMDsKICBmb3IgKGNvbnN0IHsKICAgIHJlZiwKICAgIGRhdGEKICB9IG9mIG5ld1JlZnMpIHsKICAgIGlmIChyZWYubnVtID09PSBpbmRleGVzW2luZGV4ZXNQb3NpdGlvbl0pIHsKICAgICAgYnVmZmVyLnB1c2goYCR7aW5kZXhlc1tpbmRleGVzUG9zaXRpb25dfSAke2luZGV4ZXNbaW5kZXhlc1Bvc2l0aW9uICsgMV19XG5gKTsKICAgICAgaW5kZXhlc1Bvc2l0aW9uICs9IDI7CiAgICB9CiAgICBpZiAoZGF0YSAhPT0gbnVsbCkgewogICAgICBidWZmZXIucHVzaChgJHtiYXNlT2Zmc2V0LnRvU3RyaW5nKCkucGFkU3RhcnQoMTAsICIwIil9ICR7TWF0aC5taW4ocmVmLmdlbiwgMHhmZmZmKS50b1N0cmluZygpLnBhZFN0YXJ0KDUsICIwIil9IG5cclxuYCk7CiAgICAgIGJhc2VPZmZzZXQgKz0gZGF0YS5sZW5ndGg7CiAgICB9IGVsc2UgewogICAgICBidWZmZXIucHVzaChgMDAwMDAwMDAwMCAke01hdGgubWluKHJlZi5nZW4gKyAxLCAweGZmZmYpLnRvU3RyaW5nKCkucGFkU3RhcnQoNSwgIjAiKX0gZlxyXG5gKTsKICAgIH0KICB9CiAgY29tcHV0ZUlEcyhiYXNlT2Zmc2V0LCB4cmVmSW5mbywgbmV3WHJlZik7CiAgYnVmZmVyLnB1c2goInRyYWlsZXJcbiIpOwogIGF3YWl0IHdyaXRlRGljdChuZXdYcmVmLCBidWZmZXIpOwogIGJ1ZmZlci5wdXNoKCJcbnN0YXJ0eHJlZlxuIiwgYmFzZU9mZnNldC50b1N0cmluZygpLCAiXG4lJUVPRlxuIik7Cn0KZnVuY3Rpb24gZ2V0SW5kZXhlcyhuZXdSZWZzKSB7CiAgY29uc3QgaW5kZXhlcyA9IFtdOwogIGZvciAoY29uc3QgewogICAgcmVmCiAgfSBvZiBuZXdSZWZzKSB7CiAgICBpZiAocmVmLm51bSA9PT0gaW5kZXhlcy5hdCgtMikgKyBpbmRleGVzLmF0KC0xKSkgewogICAgICBpbmRleGVzW2luZGV4ZXMubGVuZ3RoIC0gMV0gKz0gMTsKICAgIH0gZWxzZSB7CiAgICAgIGluZGV4ZXMucHVzaChyZWYubnVtLCAxKTsKICAgIH0KICB9CiAgcmV0dXJuIGluZGV4ZXM7Cn0KYXN5bmMgZnVuY3Rpb24gZ2V0WFJlZlN0cmVhbVRhYmxlKHhyZWZJbmZvLCBiYXNlT2Zmc2V0LCBuZXdSZWZzLCBuZXdYcmVmLCBidWZmZXIpIHsKICBjb25zdCB4cmVmVGFibGVEYXRhID0gW107CiAgbGV0IG1heE9mZnNldCA9IDA7CiAgbGV0IG1heEdlbiA9IDA7CiAgZm9yIChjb25zdCB7CiAgICByZWYsCiAgICBkYXRhCiAgfSBvZiBuZXdSZWZzKSB7CiAgICBsZXQgZ2VuOwogICAgbWF4T2Zmc2V0ID0gTWF0aC5tYXgobWF4T2Zmc2V0LCBiYXNlT2Zmc2V0KTsKICAgIGlmIChkYXRhICE9PSBudWxsKSB7CiAgICAgIGdlbiA9IE1hdGgubWluKHJlZi5nZW4sIDB4ZmZmZik7CiAgICAgIHhyZWZUYWJsZURhdGEucHVzaChbMSwgYmFzZU9mZnNldCwgZ2VuXSk7CiAgICAgIGJhc2VPZmZzZXQgKz0gZGF0YS5sZW5ndGg7CiAgICB9IGVsc2UgewogICAgICBnZW4gPSBNYXRoLm1pbihyZWYuZ2VuICsgMSwgMHhmZmZmKTsKICAgICAgeHJlZlRhYmxlRGF0YS5wdXNoKFswLCAwLCBnZW5dKTsKICAgIH0KICAgIG1heEdlbiA9IE1hdGgubWF4KG1heEdlbiwgZ2VuKTsKICB9CiAgbmV3WHJlZi5zZXQoIkluZGV4IiwgZ2V0SW5kZXhlcyhuZXdSZWZzKSk7CiAgY29uc3Qgb2Zmc2V0U2l6ZSA9IGdldFNpemVJbkJ5dGVzKG1heE9mZnNldCk7CiAgY29uc3QgbWF4R2VuU2l6ZSA9IGdldFNpemVJbkJ5dGVzKG1heEdlbik7CiAgY29uc3Qgc2l6ZXMgPSBbMSwgb2Zmc2V0U2l6ZSwgbWF4R2VuU2l6ZV07CiAgbmV3WHJlZi5zZXQoIlciLCBzaXplcyk7CiAgY29tcHV0ZUlEcyhiYXNlT2Zmc2V0LCB4cmVmSW5mbywgbmV3WHJlZik7CiAgY29uc3Qgc3RydWN0U2l6ZSA9IE1hdGguc3VtUHJlY2lzZShzaXplcyk7CiAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KHN0cnVjdFNpemUgKiB4cmVmVGFibGVEYXRhLmxlbmd0aCk7CiAgY29uc3Qgc3RyZWFtID0gbmV3IFN0cmVhbShkYXRhKTsKICBzdHJlYW0uZGljdCA9IG5ld1hyZWY7CiAgbGV0IG9mZnNldCA9IDA7CiAgZm9yIChjb25zdCBbdHlwZSwgb2JqT2Zmc2V0LCBnZW5dIG9mIHhyZWZUYWJsZURhdGEpIHsKICAgIG9mZnNldCA9IHdyaXRlSW50KHR5cGUsIHNpemVzWzBdLCBvZmZzZXQsIGRhdGEpOwogICAgb2Zmc2V0ID0gd3JpdGVJbnQob2JqT2Zmc2V0LCBzaXplc1sxXSwgb2Zmc2V0LCBkYXRhKTsKICAgIG9mZnNldCA9IHdyaXRlSW50KGdlbiwgc2l6ZXNbMl0sIG9mZnNldCwgZGF0YSk7CiAgfQogIGF3YWl0IHdyaXRlT2JqZWN0KHhyZWZJbmZvLm5ld1JlZiwgc3RyZWFtLCBidWZmZXIsIHt9KTsKICBidWZmZXIucHVzaCgic3RhcnR4cmVmXG4iLCBiYXNlT2Zmc2V0LnRvU3RyaW5nKCksICJcbiUlRU9GXG4iKTsKfQpmdW5jdGlvbiBjb21wdXRlSURzKGJhc2VPZmZzZXQsIHhyZWZJbmZvLCBuZXdYcmVmKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoeHJlZkluZm8uZmlsZUlkcykgJiYgeHJlZkluZm8uZmlsZUlkcy5sZW5ndGggPiAwKSB7CiAgICBjb25zdCBtZDUgPSBjb21wdXRlTUQ1KGJhc2VPZmZzZXQsIHhyZWZJbmZvKTsKICAgIG5ld1hyZWYuc2V0KCJJRCIsIFt4cmVmSW5mby5maWxlSWRzWzBdLCBtZDVdKTsKICB9Cn0KZnVuY3Rpb24gZ2V0VHJhaWxlckRpY3QoeHJlZkluZm8sIGNoYW5nZXMsIHVzZVhyZWZTdHJlYW0pIHsKICBjb25zdCBuZXdYcmVmID0gbmV3IERpY3QobnVsbCk7CiAgbmV3WHJlZi5zZXQoIlByZXYiLCB4cmVmSW5mby5zdGFydFhSZWYpOwogIGNvbnN0IHJlZkZvclhyZWZUYWJsZSA9IHhyZWZJbmZvLm5ld1JlZjsKICBpZiAodXNlWHJlZlN0cmVhbSkgewogICAgY2hhbmdlcy5wdXQocmVmRm9yWHJlZlRhYmxlLCB7CiAgICAgIGRhdGE6ICIiCiAgICB9KTsKICAgIG5ld1hyZWYuc2V0KCJTaXplIiwgcmVmRm9yWHJlZlRhYmxlLm51bSArIDEpOwogICAgbmV3WHJlZi5zZXRJZk5hbWUoIlR5cGUiLCAiWFJlZiIpOwogIH0gZWxzZSB7CiAgICBuZXdYcmVmLnNldCgiU2l6ZSIsIHJlZkZvclhyZWZUYWJsZS5udW0pOwogIH0KICBpZiAoeHJlZkluZm8ucm9vdFJlZiAhPT0gbnVsbCkgewogICAgbmV3WHJlZi5zZXQoIlJvb3QiLCB4cmVmSW5mby5yb290UmVmKTsKICB9CiAgaWYgKHhyZWZJbmZvLmluZm9SZWYgIT09IG51bGwpIHsKICAgIG5ld1hyZWYuc2V0KCJJbmZvIiwgeHJlZkluZm8uaW5mb1JlZik7CiAgfQogIGlmICh4cmVmSW5mby5lbmNyeXB0UmVmICE9PSBudWxsKSB7CiAgICBuZXdYcmVmLnNldCgiRW5jcnlwdCIsIHhyZWZJbmZvLmVuY3J5cHRSZWYpOwogIH0KICByZXR1cm4gbmV3WHJlZjsKfQphc3luYyBmdW5jdGlvbiB3cml0ZUNoYW5nZXMoY2hhbmdlcywgeHJlZiwgYnVmZmVyID0gW10pIHsKICBjb25zdCBuZXdSZWZzID0gW107CiAgZm9yIChjb25zdCBbcmVmLCB7CiAgICBkYXRhCiAgfV0gb2YgY2hhbmdlcy5pdGVtcygpKSB7CiAgICBpZiAoZGF0YSA9PT0gbnVsbCB8fCB0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIpIHsKICAgICAgbmV3UmVmcy5wdXNoKHsKICAgICAgICByZWYsCiAgICAgICAgZGF0YQogICAgICB9KTsKICAgICAgY29udGludWU7CiAgICB9CiAgICBhd2FpdCB3cml0ZU9iamVjdChyZWYsIGRhdGEsIGJ1ZmZlciwgeHJlZik7CiAgICBuZXdSZWZzLnB1c2goewogICAgICByZWYsCiAgICAgIGRhdGE6IGJ1ZmZlci5qb2luKCIiKQogICAgfSk7CiAgICBidWZmZXIubGVuZ3RoID0gMDsKICB9CiAgcmV0dXJuIG5ld1JlZnMuc29ydCgoYSwgYikgPT4gYS5yZWYubnVtIC0gYi5yZWYubnVtKTsKfQphc3luYyBmdW5jdGlvbiBpbmNyZW1lbnRhbFVwZGF0ZSh7CiAgb3JpZ2luYWxEYXRhLAogIHhyZWZJbmZvLAogIGNoYW5nZXMsCiAgeHJlZiA9IG51bGwsCiAgaGFzWGZhID0gZmFsc2UsCiAgeGZhRGF0YXNldHNSZWYgPSBudWxsLAogIGhhc1hmYURhdGFzZXRzRW50cnkgPSBmYWxzZSwKICBuZWVkQXBwZWFyYW5jZXMsCiAgYWNyb0Zvcm1SZWYgPSBudWxsLAogIGFjcm9Gb3JtID0gbnVsbCwKICB4ZmFEYXRhID0gbnVsbCwKICB1c2VYcmVmU3RyZWFtID0gZmFsc2UKfSkgewogIGF3YWl0IHVwZGF0ZUFjcm9mb3JtKHsKICAgIHhyZWYsCiAgICBhY3JvRm9ybSwKICAgIGFjcm9Gb3JtUmVmLAogICAgaGFzWGZhLAogICAgaGFzWGZhRGF0YXNldHNFbnRyeSwKICAgIHhmYURhdGFzZXRzUmVmLAogICAgbmVlZEFwcGVhcmFuY2VzLAogICAgY2hhbmdlcwogIH0pOwogIGlmIChoYXNYZmEpIHsKICAgIHVwZGF0ZVhGQSh7CiAgICAgIHhmYURhdGEsCiAgICAgIHhmYURhdGFzZXRzUmVmLAogICAgICBjaGFuZ2VzLAogICAgICB4cmVmCiAgICB9KTsKICB9CiAgY29uc3QgbmV3WHJlZiA9IGdldFRyYWlsZXJEaWN0KHhyZWZJbmZvLCBjaGFuZ2VzLCB1c2VYcmVmU3RyZWFtKTsKICBjb25zdCBidWZmZXIgPSBbXTsKICBjb25zdCBuZXdSZWZzID0gYXdhaXQgd3JpdGVDaGFuZ2VzKGNoYW5nZXMsIHhyZWYsIGJ1ZmZlcik7CiAgbGV0IGJhc2VPZmZzZXQgPSBvcmlnaW5hbERhdGEubGVuZ3RoOwogIGNvbnN0IGxhc3RCeXRlID0gb3JpZ2luYWxEYXRhLmF0KC0xKTsKICBpZiAobGFzdEJ5dGUgIT09IDB4MGEgJiYgbGFzdEJ5dGUgIT09IDB4MGQpIHsKICAgIGJ1ZmZlci5wdXNoKCJcbiIpOwogICAgYmFzZU9mZnNldCArPSAxOwogIH0KICBmb3IgKGNvbnN0IHsKICAgIGRhdGEKICB9IG9mIG5ld1JlZnMpIHsKICAgIGlmIChkYXRhICE9PSBudWxsKSB7CiAgICAgIGJ1ZmZlci5wdXNoKGRhdGEpOwogICAgfQogIH0KICBhd2FpdCAodXNlWHJlZlN0cmVhbSA/IGdldFhSZWZTdHJlYW1UYWJsZSh4cmVmSW5mbywgYmFzZU9mZnNldCwgbmV3UmVmcywgbmV3WHJlZiwgYnVmZmVyKSA6IGdldFhSZWZUYWJsZSh4cmVmSW5mbywgYmFzZU9mZnNldCwgbmV3UmVmcywgbmV3WHJlZiwgYnVmZmVyKSk7CiAgY29uc3QgdG90YWxMZW5ndGggPSBvcmlnaW5hbERhdGEubGVuZ3RoICsgTWF0aC5zdW1QcmVjaXNlKGJ1ZmZlci5tYXAoc3RyID0+IHN0ci5sZW5ndGgpKTsKICBjb25zdCBhcnJheSA9IG5ldyBVaW50OEFycmF5KHRvdGFsTGVuZ3RoKTsKICBhcnJheS5zZXQob3JpZ2luYWxEYXRhKTsKICBsZXQgb2Zmc2V0ID0gb3JpZ2luYWxEYXRhLmxlbmd0aDsKICBmb3IgKGNvbnN0IHN0ciBvZiBidWZmZXIpIHsKICAgIG9mZnNldCA9IHdyaXRlU3RyaW5nKHN0ciwgb2Zmc2V0LCBhcnJheSk7CiAgfQogIHJldHVybiBhcnJheTsKfQoKOy8vIC4vc3JjL2NvcmUvd29ya2VyX3N0cmVhbS5qcwoKY2xhc3MgUERGV29ya2VyU3RyZWFtIHsKICBjb25zdHJ1Y3Rvcihtc2dIYW5kbGVyKSB7CiAgICB0aGlzLl9tc2dIYW5kbGVyID0gbXNnSGFuZGxlcjsKICAgIHRoaXMuX2NvbnRlbnRMZW5ndGggPSBudWxsOwogICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIgPSBudWxsOwogICAgdGhpcy5fcmFuZ2VSZXF1ZXN0UmVhZGVycyA9IFtdOwogIH0KICBnZXRGdWxsUmVhZGVyKCkgewogICAgYXNzZXJ0KCF0aGlzLl9mdWxsUmVxdWVzdFJlYWRlciwgIlBERldvcmtlclN0cmVhbS5nZXRGdWxsUmVhZGVyIGNhbiBvbmx5IGJlIGNhbGxlZCBvbmNlLiIpOwogICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIgPSBuZXcgUERGV29ya2VyU3RyZWFtUmVhZGVyKHRoaXMuX21zZ0hhbmRsZXIpOwogICAgcmV0dXJuIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyOwogIH0KICBnZXRSYW5nZVJlYWRlcihiZWdpbiwgZW5kKSB7CiAgICBjb25zdCByZWFkZXIgPSBuZXcgUERGV29ya2VyU3RyZWFtUmFuZ2VSZWFkZXIoYmVnaW4sIGVuZCwgdGhpcy5fbXNnSGFuZGxlcik7CiAgICB0aGlzLl9yYW5nZVJlcXVlc3RSZWFkZXJzLnB1c2gocmVhZGVyKTsKICAgIHJldHVybiByZWFkZXI7CiAgfQogIGNhbmNlbEFsbFJlcXVlc3RzKHJlYXNvbikgewogICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXI/LmNhbmNlbChyZWFzb24pOwogICAgZm9yIChjb25zdCByZWFkZXIgb2YgdGhpcy5fcmFuZ2VSZXF1ZXN0UmVhZGVycy5zbGljZSgwKSkgewogICAgICByZWFkZXIuY2FuY2VsKHJlYXNvbik7CiAgICB9CiAgfQp9CmNsYXNzIFBERldvcmtlclN0cmVhbVJlYWRlciB7CiAgY29uc3RydWN0b3IobXNnSGFuZGxlcikgewogICAgdGhpcy5fbXNnSGFuZGxlciA9IG1zZ0hhbmRsZXI7CiAgICB0aGlzLm9uUHJvZ3Jlc3MgPSBudWxsOwogICAgdGhpcy5fY29udGVudExlbmd0aCA9IG51bGw7CiAgICB0aGlzLl9pc1JhbmdlU3VwcG9ydGVkID0gZmFsc2U7CiAgICB0aGlzLl9pc1N0cmVhbWluZ1N1cHBvcnRlZCA9IGZhbHNlOwogICAgY29uc3QgcmVhZGFibGVTdHJlYW0gPSB0aGlzLl9tc2dIYW5kbGVyLnNlbmRXaXRoU3RyZWFtKCJHZXRSZWFkZXIiKTsKICAgIHRoaXMuX3JlYWRlciA9IHJlYWRhYmxlU3RyZWFtLmdldFJlYWRlcigpOwogICAgdGhpcy5faGVhZGVyc1JlYWR5ID0gdGhpcy5fbXNnSGFuZGxlci5zZW5kV2l0aFByb21pc2UoIlJlYWRlckhlYWRlcnNSZWFkeSIpLnRoZW4oZGF0YSA9PiB7CiAgICAgIHRoaXMuX2lzU3RyZWFtaW5nU3VwcG9ydGVkID0gZGF0YS5pc1N0cmVhbWluZ1N1cHBvcnRlZDsKICAgICAgdGhpcy5faXNSYW5nZVN1cHBvcnRlZCA9IGRhdGEuaXNSYW5nZVN1cHBvcnRlZDsKICAgICAgdGhpcy5fY29udGVudExlbmd0aCA9IGRhdGEuY29udGVudExlbmd0aDsKICAgIH0pOwogIH0KICBnZXQgaGVhZGVyc1JlYWR5KCkgewogICAgcmV0dXJuIHRoaXMuX2hlYWRlcnNSZWFkeTsKICB9CiAgZ2V0IGNvbnRlbnRMZW5ndGgoKSB7CiAgICByZXR1cm4gdGhpcy5fY29udGVudExlbmd0aDsKICB9CiAgZ2V0IGlzU3RyZWFtaW5nU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHRoaXMuX2lzU3RyZWFtaW5nU3VwcG9ydGVkOwogIH0KICBnZXQgaXNSYW5nZVN1cHBvcnRlZCgpIHsKICAgIHJldHVybiB0aGlzLl9pc1JhbmdlU3VwcG9ydGVkOwogIH0KICBhc3luYyByZWFkKCkgewogICAgY29uc3QgewogICAgICB2YWx1ZSwKICAgICAgZG9uZQogICAgfSA9IGF3YWl0IHRoaXMuX3JlYWRlci5yZWFkKCk7CiAgICBpZiAoZG9uZSkgewogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiB1bmRlZmluZWQsCiAgICAgICAgZG9uZTogdHJ1ZQogICAgICB9OwogICAgfQogICAgcmV0dXJuIHsKICAgICAgdmFsdWU6IHZhbHVlLmJ1ZmZlciwKICAgICAgZG9uZTogZmFsc2UKICAgIH07CiAgfQogIGNhbmNlbChyZWFzb24pIHsKICAgIHRoaXMuX3JlYWRlci5jYW5jZWwocmVhc29uKTsKICB9Cn0KY2xhc3MgUERGV29ya2VyU3RyZWFtUmFuZ2VSZWFkZXIgewogIGNvbnN0cnVjdG9yKGJlZ2luLCBlbmQsIG1zZ0hhbmRsZXIpIHsKICAgIHRoaXMuX21zZ0hhbmRsZXIgPSBtc2dIYW5kbGVyOwogICAgdGhpcy5vblByb2dyZXNzID0gbnVsbDsKICAgIGNvbnN0IHJlYWRhYmxlU3RyZWFtID0gdGhpcy5fbXNnSGFuZGxlci5zZW5kV2l0aFN0cmVhbSgiR2V0UmFuZ2VSZWFkZXIiLCB7CiAgICAgIGJlZ2luLAogICAgICBlbmQKICAgIH0pOwogICAgdGhpcy5fcmVhZGVyID0gcmVhZGFibGVTdHJlYW0uZ2V0UmVhZGVyKCk7CiAgfQogIGdldCBpc1N0cmVhbWluZ1N1cHBvcnRlZCgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgYXN5bmMgcmVhZCgpIHsKICAgIGNvbnN0IHsKICAgICAgdmFsdWUsCiAgICAgIGRvbmUKICAgIH0gPSBhd2FpdCB0aGlzLl9yZWFkZXIucmVhZCgpOwogICAgaWYgKGRvbmUpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgIGRvbmU6IHRydWUKICAgICAgfTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIHZhbHVlOiB2YWx1ZS5idWZmZXIsCiAgICAgIGRvbmU6IGZhbHNlCiAgICB9OwogIH0KICBjYW5jZWwocmVhc29uKSB7CiAgICB0aGlzLl9yZWFkZXIuY2FuY2VsKHJlYXNvbik7CiAgfQp9Cgo7Ly8gLi9zcmMvY29yZS93b3JrZXIuanMKCgoKCgoKCgoKCmNsYXNzIFdvcmtlclRhc2sgewogIGNvbnN0cnVjdG9yKG5hbWUpIHsKICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICB0aGlzLnRlcm1pbmF0ZWQgPSBmYWxzZTsKICAgIHRoaXMuX2NhcGFiaWxpdHkgPSBQcm9taXNlLndpdGhSZXNvbHZlcnMoKTsKICB9CiAgZ2V0IGZpbmlzaGVkKCkgewogICAgcmV0dXJuIHRoaXMuX2NhcGFiaWxpdHkucHJvbWlzZTsKICB9CiAgZmluaXNoKCkgewogICAgdGhpcy5fY2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgfQogIHRlcm1pbmF0ZSgpIHsKICAgIHRoaXMudGVybWluYXRlZCA9IHRydWU7CiAgfQogIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKSB7CiAgICBpZiAodGhpcy50ZXJtaW5hdGVkKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV29ya2VyIHRhc2sgd2FzIHRlcm1pbmF0ZWQiKTsKICAgIH0KICB9Cn0KY2xhc3MgV29ya2VyTWVzc2FnZUhhbmRsZXIgewogIHN0YXRpYyB7CiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gInVuZGVmaW5lZCIgJiYgIWlzTm9kZUpTICYmIHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Ygc2VsZi5wb3N0TWVzc2FnZSA9PT0gImZ1bmN0aW9uIiAmJiAib25tZXNzYWdlIiBpbiBzZWxmKSB7CiAgICAgIHRoaXMuaW5pdGlhbGl6ZUZyb21Qb3J0KHNlbGYpOwogICAgfQogIH0KICBzdGF0aWMgc2V0dXAoaGFuZGxlciwgcG9ydCkgewogICAgbGV0IHRlc3RNZXNzYWdlUHJvY2Vzc2VkID0gZmFsc2U7CiAgICBoYW5kbGVyLm9uKCJ0ZXN0IiwgZGF0YSA9PiB7CiAgICAgIGlmICh0ZXN0TWVzc2FnZVByb2Nlc3NlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0ZXN0TWVzc2FnZVByb2Nlc3NlZCA9IHRydWU7CiAgICAgIGhhbmRsZXIuc2VuZCgidGVzdCIsIGRhdGEgaW5zdGFuY2VvZiBVaW50OEFycmF5KTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiY29uZmlndXJlIiwgZGF0YSA9PiB7CiAgICAgIHNldFZlcmJvc2l0eUxldmVsKGRhdGEudmVyYm9zaXR5KTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0RG9jUmVxdWVzdCIsIGRhdGEgPT4gdGhpcy5jcmVhdGVEb2N1bWVudEhhbmRsZXIoZGF0YSwgcG9ydCkpOwogIH0KICBzdGF0aWMgY3JlYXRlRG9jdW1lbnRIYW5kbGVyKGRvY1BhcmFtcywgcG9ydCkgewogICAgbGV0IHBkZk1hbmFnZXI7CiAgICBsZXQgdGVybWluYXRlZCA9IGZhbHNlOwogICAgbGV0IGNhbmNlbFhIUnMgPSBudWxsOwogICAgY29uc3QgV29ya2VyVGFza3MgPSBuZXcgU2V0KCk7CiAgICBjb25zdCB2ZXJib3NpdHkgPSBnZXRWZXJib3NpdHlMZXZlbCgpOwogICAgY29uc3QgewogICAgICBkb2NJZCwKICAgICAgYXBpVmVyc2lvbgogICAgfSA9IGRvY1BhcmFtczsKICAgIGNvbnN0IHdvcmtlclZlcnNpb24gPSAiNS40LjU0IjsKICAgIGlmIChhcGlWZXJzaW9uICE9PSB3b3JrZXJWZXJzaW9uKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIEFQSSB2ZXJzaW9uICIke2FwaVZlcnNpb259IiBkb2VzIG5vdCBtYXRjaCBgICsgYHRoZSBXb3JrZXIgdmVyc2lvbiAiJHt3b3JrZXJWZXJzaW9ufSIuYCk7CiAgICB9CiAgICBjb25zdCBidWlsZE1zZyA9ICh0eXBlLCBwcm9wKSA9PiBgVGhlIFxgJHt0eXBlfS5wcm90b3R5cGVcYCBjb250YWlucyB1bmV4cGVjdGVkIGVudW1lcmFibGUgcHJvcGVydHkgYCArIGAiJHtwcm9wfSIsIHRodXMgYnJlYWtpbmcgZS5nLiBcYGZvci4uLmluXGAgaXRlcmF0aW9uIG9mICR7dHlwZX1zLmA7CiAgICBmb3IgKGNvbnN0IHByb3AgaW4ge30pIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGJ1aWxkTXNnKCJPYmplY3QiLCBwcm9wKSk7CiAgICB9CiAgICBmb3IgKGNvbnN0IHByb3AgaW4gW10pIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGJ1aWxkTXNnKCJBcnJheSIsIHByb3ApKTsKICAgIH0KICAgIGNvbnN0IHdvcmtlckhhbmRsZXJOYW1lID0gZG9jSWQgKyAiX3dvcmtlciI7CiAgICBsZXQgaGFuZGxlciA9IG5ldyBNZXNzYWdlSGFuZGxlcih3b3JrZXJIYW5kbGVyTmFtZSwgZG9jSWQsIHBvcnQpOwogICAgZnVuY3Rpb24gZW5zdXJlTm90VGVybWluYXRlZCgpIHsKICAgICAgaWYgKHRlcm1pbmF0ZWQpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIldvcmtlciB3YXMgdGVybWluYXRlZCIpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBzdGFydFdvcmtlclRhc2sodGFzaykgewogICAgICBXb3JrZXJUYXNrcy5hZGQodGFzayk7CiAgICB9CiAgICBmdW5jdGlvbiBmaW5pc2hXb3JrZXJUYXNrKHRhc2spIHsKICAgICAgdGFzay5maW5pc2goKTsKICAgICAgV29ya2VyVGFza3MuZGVsZXRlKHRhc2spOwogICAgfQogICAgYXN5bmMgZnVuY3Rpb24gbG9hZERvY3VtZW50KHJlY292ZXJ5TW9kZSkgewogICAgICBhd2FpdCBwZGZNYW5hZ2VyLmVuc3VyZURvYygiY2hlY2tIZWFkZXIiKTsKICAgICAgYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVEb2MoInBhcnNlU3RhcnRYUmVmIik7CiAgICAgIGF3YWl0IHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJwYXJzZSIsIFtyZWNvdmVyeU1vZGVdKTsKICAgICAgYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVEb2MoImNoZWNrRmlyc3RQYWdlIiwgW3JlY292ZXJ5TW9kZV0pOwogICAgICBhd2FpdCBwZGZNYW5hZ2VyLmVuc3VyZURvYygiY2hlY2tMYXN0UGFnZSIsIFtyZWNvdmVyeU1vZGVdKTsKICAgICAgY29uc3QgaXNQdXJlWGZhID0gYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVEb2MoImlzUHVyZVhmYSIpOwogICAgICBpZiAoaXNQdXJlWGZhKSB7CiAgICAgICAgY29uc3QgdGFzayA9IG5ldyBXb3JrZXJUYXNrKCJsb2FkWGZhUmVzb3VyY2VzIik7CiAgICAgICAgc3RhcnRXb3JrZXJUYXNrKHRhc2spOwogICAgICAgIGF3YWl0IHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJsb2FkWGZhUmVzb3VyY2VzIiwgW2hhbmRsZXIsIHRhc2tdKTsKICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICB9CiAgICAgIGNvbnN0IFtudW1QYWdlcywgZmluZ2VycHJpbnRzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtwZGZNYW5hZ2VyLmVuc3VyZURvYygibnVtUGFnZXMiKSwgcGRmTWFuYWdlci5lbnN1cmVEb2MoImZpbmdlcnByaW50cyIpXSk7CiAgICAgIGNvbnN0IGh0bWxGb3JYZmEgPSBpc1B1cmVYZmEgPyBhd2FpdCBwZGZNYW5hZ2VyLmVuc3VyZURvYygiaHRtbEZvclhmYSIpIDogbnVsbDsKICAgICAgcmV0dXJuIHsKICAgICAgICBudW1QYWdlcywKICAgICAgICBmaW5nZXJwcmludHMsCiAgICAgICAgaHRtbEZvclhmYQogICAgICB9OwogICAgfQogICAgYXN5bmMgZnVuY3Rpb24gZ2V0UGRmTWFuYWdlcih7CiAgICAgIGRhdGEsCiAgICAgIHBhc3N3b3JkLAogICAgICBkaXNhYmxlQXV0b0ZldGNoLAogICAgICByYW5nZUNodW5rU2l6ZSwKICAgICAgbGVuZ3RoLAogICAgICBkb2NCYXNlVXJsLAogICAgICBlbmFibGVYZmEsCiAgICAgIGV2YWx1YXRvck9wdGlvbnMKICAgIH0pIHsKICAgICAgY29uc3QgcGRmTWFuYWdlckFyZ3MgPSB7CiAgICAgICAgc291cmNlOiBudWxsLAogICAgICAgIGRpc2FibGVBdXRvRmV0Y2gsCiAgICAgICAgZG9jQmFzZVVybCwKICAgICAgICBkb2NJZCwKICAgICAgICBlbmFibGVYZmEsCiAgICAgICAgZXZhbHVhdG9yT3B0aW9ucywKICAgICAgICBoYW5kbGVyLAogICAgICAgIGxlbmd0aCwKICAgICAgICBwYXNzd29yZCwKICAgICAgICByYW5nZUNodW5rU2l6ZQogICAgICB9OwogICAgICBpZiAoZGF0YSkgewogICAgICAgIHBkZk1hbmFnZXJBcmdzLnNvdXJjZSA9IGRhdGE7CiAgICAgICAgcmV0dXJuIG5ldyBMb2NhbFBkZk1hbmFnZXIocGRmTWFuYWdlckFyZ3MpOwogICAgICB9CiAgICAgIGNvbnN0IHBkZlN0cmVhbSA9IG5ldyBQREZXb3JrZXJTdHJlYW0oaGFuZGxlciksCiAgICAgICAgZnVsbFJlcXVlc3QgPSBwZGZTdHJlYW0uZ2V0RnVsbFJlYWRlcigpOwogICAgICBjb25zdCBwZGZNYW5hZ2VyQ2FwYWJpbGl0eSA9IFByb21pc2Uud2l0aFJlc29sdmVycygpOwogICAgICBsZXQgbmV3UGRmTWFuYWdlciwKICAgICAgICBjYWNoZWRDaHVua3MgPSBbXSwKICAgICAgICBsb2FkZWQgPSAwOwogICAgICBmdWxsUmVxdWVzdC5oZWFkZXJzUmVhZHkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCFmdWxsUmVxdWVzdC5pc1JhbmdlU3VwcG9ydGVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHBkZk1hbmFnZXJBcmdzLnNvdXJjZSA9IHBkZlN0cmVhbTsKICAgICAgICBwZGZNYW5hZ2VyQXJncy5sZW5ndGggPSBmdWxsUmVxdWVzdC5jb250ZW50TGVuZ3RoOwogICAgICAgIHBkZk1hbmFnZXJBcmdzLmRpc2FibGVBdXRvRmV0Y2ggfHw9IGZ1bGxSZXF1ZXN0LmlzU3RyZWFtaW5nU3VwcG9ydGVkOwogICAgICAgIG5ld1BkZk1hbmFnZXIgPSBuZXcgTmV0d29ya1BkZk1hbmFnZXIocGRmTWFuYWdlckFyZ3MpOwogICAgICAgIGZvciAoY29uc3QgY2h1bmsgb2YgY2FjaGVkQ2h1bmtzKSB7CiAgICAgICAgICBuZXdQZGZNYW5hZ2VyLnNlbmRQcm9ncmVzc2l2ZURhdGEoY2h1bmspOwogICAgICAgIH0KICAgICAgICBjYWNoZWRDaHVua3MgPSBbXTsKICAgICAgICBwZGZNYW5hZ2VyQ2FwYWJpbGl0eS5yZXNvbHZlKG5ld1BkZk1hbmFnZXIpOwogICAgICAgIGNhbmNlbFhIUnMgPSBudWxsOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgcGRmTWFuYWdlckNhcGFiaWxpdHkucmVqZWN0KHJlYXNvbik7CiAgICAgICAgY2FuY2VsWEhScyA9IG51bGw7CiAgICAgIH0pOwogICAgICBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgY29uc3QgcmVhZENodW5rID0gZnVuY3Rpb24gKHsKICAgICAgICAgIHZhbHVlLAogICAgICAgICAgZG9uZQogICAgICAgIH0pIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgICAgICAgaWYgKGRvbmUpIHsKICAgICAgICAgICAgICBpZiAoIW5ld1BkZk1hbmFnZXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBkZkZpbGUgPSBhcnJheUJ1ZmZlcnNUb0J5dGVzKGNhY2hlZENodW5rcyk7CiAgICAgICAgICAgICAgICBjYWNoZWRDaHVua3MgPSBbXTsKICAgICAgICAgICAgICAgIGlmIChsZW5ndGggJiYgcGRmRmlsZS5sZW5ndGggIT09IGxlbmd0aCkgewogICAgICAgICAgICAgICAgICB3YXJuKCJyZXBvcnRlZCBIVFRQIGxlbmd0aCBpcyBkaWZmZXJlbnQgZnJvbSBhY3R1YWwiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHBkZk1hbmFnZXJBcmdzLnNvdXJjZSA9IHBkZkZpbGU7CiAgICAgICAgICAgICAgICBuZXdQZGZNYW5hZ2VyID0gbmV3IExvY2FsUGRmTWFuYWdlcihwZGZNYW5hZ2VyQXJncyk7CiAgICAgICAgICAgICAgICBwZGZNYW5hZ2VyQ2FwYWJpbGl0eS5yZXNvbHZlKG5ld1BkZk1hbmFnZXIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYW5jZWxYSFJzID0gbnVsbDsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbG9hZGVkICs9IHZhbHVlLmJ5dGVMZW5ndGg7CiAgICAgICAgICAgIGlmICghZnVsbFJlcXVlc3QuaXNTdHJlYW1pbmdTdXBwb3J0ZWQpIHsKICAgICAgICAgICAgICBoYW5kbGVyLnNlbmQoIkRvY1Byb2dyZXNzIiwgewogICAgICAgICAgICAgICAgbG9hZGVkLAogICAgICAgICAgICAgICAgdG90YWw6IE1hdGgubWF4KGxvYWRlZCwgZnVsbFJlcXVlc3QuY29udGVudExlbmd0aCB8fCAwKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChuZXdQZGZNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgbmV3UGRmTWFuYWdlci5zZW5kUHJvZ3Jlc3NpdmVEYXRhKHZhbHVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjYWNoZWRDaHVua3MucHVzaCh2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVsbFJlcXVlc3QucmVhZCgpLnRoZW4ocmVhZENodW5rLCByZWplY3QpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBmdWxsUmVxdWVzdC5yZWFkKCkudGhlbihyZWFkQ2h1bmssIHJlamVjdCk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcGRmTWFuYWdlckNhcGFiaWxpdHkucmVqZWN0KGUpOwogICAgICAgIGNhbmNlbFhIUnMgPSBudWxsOwogICAgICB9KTsKICAgICAgY2FuY2VsWEhScyA9IHJlYXNvbiA9PiB7CiAgICAgICAgcGRmU3RyZWFtLmNhbmNlbEFsbFJlcXVlc3RzKHJlYXNvbik7CiAgICAgIH07CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgfQogICAgZnVuY3Rpb24gc2V0dXBEb2MoZGF0YSkgewogICAgICBmdW5jdGlvbiBvblN1Y2Nlc3MoZG9jKSB7CiAgICAgICAgZW5zdXJlTm90VGVybWluYXRlZCgpOwogICAgICAgIGhhbmRsZXIuc2VuZCgiR2V0RG9jIiwgewogICAgICAgICAgcGRmSW5mbzogZG9jCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gb25GYWlsdXJlKGV4KSB7CiAgICAgICAgZW5zdXJlTm90VGVybWluYXRlZCgpOwogICAgICAgIGlmIChleCBpbnN0YW5jZW9mIFBhc3N3b3JkRXhjZXB0aW9uKSB7CiAgICAgICAgICBjb25zdCB0YXNrID0gbmV3IFdvcmtlclRhc2soYFBhc3N3b3JkRXhjZXB0aW9uOiByZXNwb25zZSAke2V4LmNvZGV9YCk7CiAgICAgICAgICBzdGFydFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICBoYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiUGFzc3dvcmRSZXF1ZXN0IiwgZXgpLnRoZW4oZnVuY3Rpb24gKHsKICAgICAgICAgICAgcGFzc3dvcmQKICAgICAgICAgIH0pIHsKICAgICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgICAgcGRmTWFuYWdlci51cGRhdGVQYXNzd29yZChwYXNzd29yZCk7CiAgICAgICAgICAgIHBkZk1hbmFnZXJSZWFkeSgpOwogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgICBoYW5kbGVyLnNlbmQoIkRvY0V4Y2VwdGlvbiIsIGV4KTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBoYW5kbGVyLnNlbmQoIkRvY0V4Y2VwdGlvbiIsIHdyYXBSZWFzb24oZXgpKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcGRmTWFuYWdlclJlYWR5KCkgewogICAgICAgIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgICBsb2FkRG9jdW1lbnQoZmFsc2UpLnRoZW4ob25TdWNjZXNzLCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBlbnN1cmVOb3RUZXJtaW5hdGVkKCk7CiAgICAgICAgICBpZiAoIShyZWFzb24gaW5zdGFuY2VvZiBYUmVmUGFyc2VFeGNlcHRpb24pKSB7CiAgICAgICAgICAgIG9uRmFpbHVyZShyZWFzb24pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBwZGZNYW5hZ2VyLnJlcXVlc3RMb2FkZWRTdHJlYW0oKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZW5zdXJlTm90VGVybWluYXRlZCgpOwogICAgICAgICAgICBsb2FkRG9jdW1lbnQodHJ1ZSkudGhlbihvblN1Y2Nlc3MsIG9uRmFpbHVyZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBlbnN1cmVOb3RUZXJtaW5hdGVkKCk7CiAgICAgIGdldFBkZk1hbmFnZXIoZGF0YSkudGhlbihmdW5jdGlvbiAobmV3UGRmTWFuYWdlcikgewogICAgICAgIGlmICh0ZXJtaW5hdGVkKSB7CiAgICAgICAgICBuZXdQZGZNYW5hZ2VyLnRlcm1pbmF0ZShuZXcgQWJvcnRFeGNlcHRpb24oIldvcmtlciB3YXMgdGVybWluYXRlZC4iKSk7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIldvcmtlciB3YXMgdGVybWluYXRlZCIpOwogICAgICAgIH0KICAgICAgICBwZGZNYW5hZ2VyID0gbmV3UGRmTWFuYWdlcjsKICAgICAgICBwZGZNYW5hZ2VyLnJlcXVlc3RMb2FkZWRTdHJlYW0odHJ1ZSkudGhlbihzdHJlYW0gPT4gewogICAgICAgICAgaGFuZGxlci5zZW5kKCJEYXRhTG9hZGVkIiwgewogICAgICAgICAgICBsZW5ndGg6IHN0cmVhbS5ieXRlcy5ieXRlTGVuZ3RoCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSkudGhlbihwZGZNYW5hZ2VyUmVhZHksIG9uRmFpbHVyZSk7CiAgICB9CiAgICBoYW5kbGVyLm9uKCJHZXRQYWdlIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZ2V0UGFnZShkYXRhLnBhZ2VJbmRleCkudGhlbihmdW5jdGlvbiAocGFnZSkgewogICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbcGRmTWFuYWdlci5lbnN1cmUocGFnZSwgInJvdGF0ZSIpLCBwZGZNYW5hZ2VyLmVuc3VyZShwYWdlLCAicmVmIiksIHBkZk1hbmFnZXIuZW5zdXJlKHBhZ2UsICJ1c2VyVW5pdCIpLCBwZGZNYW5hZ2VyLmVuc3VyZShwYWdlLCAidmlldyIpXSkudGhlbihmdW5jdGlvbiAoW3JvdGF0ZSwgcmVmLCB1c2VyVW5pdCwgdmlld10pIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHJvdGF0ZSwKICAgICAgICAgICAgcmVmLAogICAgICAgICAgICByZWZTdHI6IHJlZj8udG9TdHJpbmcoKSA/PyBudWxsLAogICAgICAgICAgICB1c2VyVW5pdCwKICAgICAgICAgICAgdmlldwogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldFBhZ2VJbmRleCIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIGNvbnN0IHBhZ2VSZWYgPSBSZWYuZ2V0KGRhdGEubnVtLCBkYXRhLmdlbik7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImdldFBhZ2VJbmRleCIsIFtwYWdlUmVmXSk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldERlc3RpbmF0aW9ucyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImRlc3RpbmF0aW9ucyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXREZXN0aW5hdGlvbiIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImdldERlc3RpbmF0aW9uIiwgW2RhdGEuaWRdKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0UGFnZUxhYmVscyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coInBhZ2VMYWJlbHMiKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0UGFnZUxheW91dCIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coInBhZ2VMYXlvdXQiKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0UGFnZU1vZGUiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJwYWdlTW9kZSIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRWaWV3ZXJQcmVmZXJlbmNlcyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coInZpZXdlclByZWZlcmVuY2VzIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldE9wZW5BY3Rpb24iLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJvcGVuQWN0aW9uIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldEF0dGFjaG1lbnRzIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiYXR0YWNobWVudHMiKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0RG9jSlNBY3Rpb25zIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygianNBY3Rpb25zIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldFBhZ2VKU0FjdGlvbnMiLCBmdW5jdGlvbiAoewogICAgICBwYWdlSW5kZXgKICAgIH0pIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpLnRoZW4ocGFnZSA9PiBwZGZNYW5hZ2VyLmVuc3VyZShwYWdlLCAianNBY3Rpb25zIikpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRPdXRsaW5lIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiZG9jdW1lbnRPdXRsaW5lIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldE9wdGlvbmFsQ29udGVudENvbmZpZyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coIm9wdGlvbmFsQ29udGVudENvbmZpZyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRQZXJtaXNzaW9ucyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coInBlcm1pc3Npb25zIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldE1ldGFkYXRhIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFtwZGZNYW5hZ2VyLmVuc3VyZURvYygiZG9jdW1lbnRJbmZvIiksIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygibWV0YWRhdGEiKV0pOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRNYXJrSW5mbyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coIm1hcmtJbmZvIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldERhdGEiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5yZXF1ZXN0TG9hZGVkU3RyZWFtKCkudGhlbihzdHJlYW0gPT4gc3RyZWFtLmJ5dGVzKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0QW5ub3RhdGlvbnMiLCBmdW5jdGlvbiAoewogICAgICBwYWdlSW5kZXgsCiAgICAgIGludGVudAogICAgfSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5nZXRQYWdlKHBhZ2VJbmRleCkudGhlbihmdW5jdGlvbiAocGFnZSkgewogICAgICAgIGNvbnN0IHRhc2sgPSBuZXcgV29ya2VyVGFzayhgR2V0QW5ub3RhdGlvbnM6IHBhZ2UgJHtwYWdlSW5kZXh9YCk7CiAgICAgICAgc3RhcnRXb3JrZXJUYXNrKHRhc2spOwogICAgICAgIHJldHVybiBwYWdlLmdldEFubm90YXRpb25zRGF0YShoYW5kbGVyLCB0YXNrLCBpbnRlbnQpLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgfSwgcmVhc29uID0+IHsKICAgICAgICAgIGZpbmlzaFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRGaWVsZE9iamVjdHMiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVEb2MoImZpZWxkT2JqZWN0cyIpLnRoZW4oZmllbGRPYmplY3RzID0+IGZpZWxkT2JqZWN0cz8uYWxsRmllbGRzIHx8IG51bGwpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJIYXNKU0FjdGlvbnMiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVEb2MoImhhc0pTQWN0aW9ucyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRDYWxjdWxhdGlvbk9yZGVySWRzIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJjYWxjdWxhdGlvbk9yZGVySWRzIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIlNhdmVEb2N1bWVudCIsIGFzeW5jIGZ1bmN0aW9uICh7CiAgICAgIGlzUHVyZVhmYSwKICAgICAgbnVtUGFnZXMsCiAgICAgIGFubm90YXRpb25TdG9yYWdlLAogICAgICBmaWxlbmFtZQogICAgfSkgewogICAgICBjb25zdCBnbG9iYWxQcm9taXNlcyA9IFtwZGZNYW5hZ2VyLnJlcXVlc3RMb2FkZWRTdHJlYW0oKSwgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJhY3JvRm9ybSIpLCBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImFjcm9Gb3JtUmVmIiksIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJzdGFydFhSZWYiKSwgcGRmTWFuYWdlci5lbnN1cmVEb2MoInhyZWYiKSwgcGRmTWFuYWdlci5lbnN1cmVEb2MoImxpbmVhcml6YXRpb24iKSwgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJzdHJ1Y3RUcmVlUm9vdCIpXTsKICAgICAgY29uc3QgY2hhbmdlcyA9IG5ldyBSZWZTZXRDYWNoZSgpOwogICAgICBjb25zdCBwcm9taXNlcyA9IFtdOwogICAgICBjb25zdCBuZXdBbm5vdGF0aW9uc0J5UGFnZSA9ICFpc1B1cmVYZmEgPyBnZXROZXdBbm5vdGF0aW9uc01hcChhbm5vdGF0aW9uU3RvcmFnZSkgOiBudWxsOwogICAgICBjb25zdCBbc3RyZWFtLCBhY3JvRm9ybSwgYWNyb0Zvcm1SZWYsIHN0YXJ0WFJlZiwgeHJlZiwgbGluZWFyaXphdGlvbiwgX3N0cnVjdFRyZWVSb290XSA9IGF3YWl0IFByb21pc2UuYWxsKGdsb2JhbFByb21pc2VzKTsKICAgICAgY29uc3QgY2F0YWxvZ1JlZiA9IHhyZWYudHJhaWxlci5nZXRSYXcoIlJvb3QiKSB8fCBudWxsOwogICAgICBsZXQgc3RydWN0VHJlZVJvb3Q7CiAgICAgIGlmIChuZXdBbm5vdGF0aW9uc0J5UGFnZSkgewogICAgICAgIGlmICghX3N0cnVjdFRyZWVSb290KSB7CiAgICAgICAgICBpZiAoYXdhaXQgU3RydWN0VHJlZVJvb3QuY2FuQ3JlYXRlU3RydWN0dXJlVHJlZSh7CiAgICAgICAgICAgIGNhdGFsb2dSZWYsCiAgICAgICAgICAgIHBkZk1hbmFnZXIsCiAgICAgICAgICAgIG5ld0Fubm90YXRpb25zQnlQYWdlCiAgICAgICAgICB9KSkgewogICAgICAgICAgICBzdHJ1Y3RUcmVlUm9vdCA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChhd2FpdCBfc3RydWN0VHJlZVJvb3QuY2FuVXBkYXRlU3RydWN0VHJlZSh7CiAgICAgICAgICBwZGZNYW5hZ2VyLAogICAgICAgICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2UKICAgICAgICB9KSkgewogICAgICAgICAgc3RydWN0VHJlZVJvb3QgPSBfc3RydWN0VHJlZVJvb3Q7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGltYWdlUHJvbWlzZXMgPSBBbm5vdGF0aW9uRmFjdG9yeS5nZW5lcmF0ZUltYWdlcyhhbm5vdGF0aW9uU3RvcmFnZS52YWx1ZXMoKSwgeHJlZiwgcGRmTWFuYWdlci5ldmFsdWF0b3JPcHRpb25zLmlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKTsKICAgICAgICBjb25zdCBuZXdBbm5vdGF0aW9uUHJvbWlzZXMgPSBzdHJ1Y3RUcmVlUm9vdCA9PT0gdW5kZWZpbmVkID8gcHJvbWlzZXMgOiBbXTsKICAgICAgICBmb3IgKGNvbnN0IFtwYWdlSW5kZXgsIGFubm90YXRpb25zXSBvZiBuZXdBbm5vdGF0aW9uc0J5UGFnZSkgewogICAgICAgICAgbmV3QW5ub3RhdGlvblByb21pc2VzLnB1c2gocGRmTWFuYWdlci5nZXRQYWdlKHBhZ2VJbmRleCkudGhlbihwYWdlID0+IHsKICAgICAgICAgICAgY29uc3QgdGFzayA9IG5ldyBXb3JrZXJUYXNrKGBTYXZlIChlZGl0b3IpOiBwYWdlICR7cGFnZUluZGV4fWApOwogICAgICAgICAgICBzdGFydFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICAgIHJldHVybiBwYWdlLnNhdmVOZXdBbm5vdGF0aW9ucyhoYW5kbGVyLCB0YXNrLCBhbm5vdGF0aW9ucywgaW1hZ2VQcm9taXNlcywgY2hhbmdlcykuZmluYWxseShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgICAgIGlmIChzdHJ1Y3RUcmVlUm9vdCA9PT0gbnVsbCkgewogICAgICAgICAgcHJvbWlzZXMucHVzaChQcm9taXNlLmFsbChuZXdBbm5vdGF0aW9uUHJvbWlzZXMpLnRoZW4oYXN5bmMgKCkgPT4gewogICAgICAgICAgICBhd2FpdCBTdHJ1Y3RUcmVlUm9vdC5jcmVhdGVTdHJ1Y3R1cmVUcmVlKHsKICAgICAgICAgICAgICBuZXdBbm5vdGF0aW9uc0J5UGFnZSwKICAgICAgICAgICAgICB4cmVmLAogICAgICAgICAgICAgIGNhdGFsb2dSZWYsCiAgICAgICAgICAgICAgcGRmTWFuYWdlciwKICAgICAgICAgICAgICBjaGFuZ2VzCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkpOwogICAgICAgIH0gZWxzZSBpZiAoc3RydWN0VHJlZVJvb3QpIHsKICAgICAgICAgIHByb21pc2VzLnB1c2goUHJvbWlzZS5hbGwobmV3QW5ub3RhdGlvblByb21pc2VzKS50aGVuKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgYXdhaXQgc3RydWN0VHJlZVJvb3QudXBkYXRlU3RydWN0dXJlVHJlZSh7CiAgICAgICAgICAgICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2UsCiAgICAgICAgICAgICAgcGRmTWFuYWdlciwKICAgICAgICAgICAgICBjaGFuZ2VzCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoaXNQdXJlWGZhKSB7CiAgICAgICAgcHJvbWlzZXMucHVzaChwZGZNYW5hZ2VyLmVuc3VyZURvYygic2VyaWFsaXplWGZhRGF0YSIsIFthbm5vdGF0aW9uU3RvcmFnZV0pKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKGxldCBwYWdlSW5kZXggPSAwOyBwYWdlSW5kZXggPCBudW1QYWdlczsgcGFnZUluZGV4KyspIHsKICAgICAgICAgIHByb21pc2VzLnB1c2gocGRmTWFuYWdlci5nZXRQYWdlKHBhZ2VJbmRleCkudGhlbihmdW5jdGlvbiAocGFnZSkgewogICAgICAgICAgICBjb25zdCB0YXNrID0gbmV3IFdvcmtlclRhc2soYFNhdmU6IHBhZ2UgJHtwYWdlSW5kZXh9YCk7CiAgICAgICAgICAgIHN0YXJ0V29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgICAgcmV0dXJuIHBhZ2Uuc2F2ZShoYW5kbGVyLCB0YXNrLCBhbm5vdGF0aW9uU3RvcmFnZSwgY2hhbmdlcykuZmluYWxseShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IHJlZnMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7CiAgICAgIGxldCB4ZmFEYXRhID0gbnVsbDsKICAgICAgaWYgKGlzUHVyZVhmYSkgewogICAgICAgIHhmYURhdGEgPSByZWZzWzBdOwogICAgICAgIGlmICgheGZhRGF0YSkgewogICAgICAgICAgcmV0dXJuIHN0cmVhbS5ieXRlczsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoY2hhbmdlcy5zaXplID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHN0cmVhbS5ieXRlczsKICAgICAgfQogICAgICBjb25zdCBuZWVkQXBwZWFyYW5jZXMgPSBhY3JvRm9ybVJlZiAmJiBhY3JvRm9ybSBpbnN0YW5jZW9mIERpY3QgJiYgY2hhbmdlcy52YWx1ZXMoKS5zb21lKHJlZiA9PiByZWYubmVlZEFwcGVhcmFuY2VzKTsKICAgICAgY29uc3QgeGZhID0gYWNyb0Zvcm0gaW5zdGFuY2VvZiBEaWN0ICYmIGFjcm9Gb3JtLmdldCgiWEZBIikgfHwgbnVsbDsKICAgICAgbGV0IHhmYURhdGFzZXRzUmVmID0gbnVsbDsKICAgICAgbGV0IGhhc1hmYURhdGFzZXRzRW50cnkgPSBmYWxzZTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoeGZhKSkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHhmYS5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgICAgICBpZiAoeGZhW2ldID09PSAiZGF0YXNldHMiKSB7CiAgICAgICAgICAgIHhmYURhdGFzZXRzUmVmID0geGZhW2kgKyAxXTsKICAgICAgICAgICAgaGFzWGZhRGF0YXNldHNFbnRyeSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh4ZmFEYXRhc2V0c1JlZiA9PT0gbnVsbCkgewogICAgICAgICAgeGZhRGF0YXNldHNSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh4ZmEpIHsKICAgICAgICB3YXJuKCJVbnN1cHBvcnRlZCBYRkEgdHlwZS4iKTsKICAgICAgfQogICAgICBsZXQgbmV3WHJlZkluZm8gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBpZiAoeHJlZi50cmFpbGVyKSB7CiAgICAgICAgY29uc3QgaW5mb01hcCA9IG5ldyBNYXAoKTsKICAgICAgICBjb25zdCB4cmVmSW5mbyA9IHhyZWYudHJhaWxlci5nZXQoIkluZm8iKSB8fCBudWxsOwogICAgICAgIGlmICh4cmVmSW5mbyBpbnN0YW5jZW9mIERpY3QpIHsKICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHhyZWZJbmZvKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgaW5mb01hcC5zZXQoa2V5LCBzdHJpbmdUb1BERlN0cmluZyh2YWx1ZSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG5ld1hyZWZJbmZvID0gewogICAgICAgICAgcm9vdFJlZjogY2F0YWxvZ1JlZiwKICAgICAgICAgIGVuY3J5cHRSZWY6IHhyZWYudHJhaWxlci5nZXRSYXcoIkVuY3J5cHQiKSB8fCBudWxsLAogICAgICAgICAgbmV3UmVmOiB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpLAogICAgICAgICAgaW5mb1JlZjogeHJlZi50cmFpbGVyLmdldFJhdygiSW5mbyIpIHx8IG51bGwsCiAgICAgICAgICBpbmZvTWFwLAogICAgICAgICAgZmlsZUlkczogeHJlZi50cmFpbGVyLmdldCgiSUQiKSB8fCBudWxsLAogICAgICAgICAgc3RhcnRYUmVmOiBsaW5lYXJpemF0aW9uID8gc3RhcnRYUmVmIDogeHJlZi5sYXN0WFJlZlN0cmVhbVBvcyA/PyBzdGFydFhSZWYsCiAgICAgICAgICBmaWxlbmFtZQogICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIGluY3JlbWVudGFsVXBkYXRlKHsKICAgICAgICBvcmlnaW5hbERhdGE6IHN0cmVhbS5ieXRlcywKICAgICAgICB4cmVmSW5mbzogbmV3WHJlZkluZm8sCiAgICAgICAgY2hhbmdlcywKICAgICAgICB4cmVmLAogICAgICAgIGhhc1hmYTogISF4ZmEsCiAgICAgICAgeGZhRGF0YXNldHNSZWYsCiAgICAgICAgaGFzWGZhRGF0YXNldHNFbnRyeSwKICAgICAgICBuZWVkQXBwZWFyYW5jZXMsCiAgICAgICAgYWNyb0Zvcm1SZWYsCiAgICAgICAgYWNyb0Zvcm0sCiAgICAgICAgeGZhRGF0YSwKICAgICAgICB1c2VYcmVmU3RyZWFtOiBpc0RpY3QoeHJlZi50b3BEaWN0LCAiWFJlZiIpCiAgICAgIH0pLmZpbmFsbHkoKCkgPT4gewogICAgICAgIHhyZWYucmVzZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgICAgfSk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldE9wZXJhdG9yTGlzdCIsIGZ1bmN0aW9uIChkYXRhLCBzaW5rKSB7CiAgICAgIGNvbnN0IHBhZ2VJbmRleCA9IGRhdGEucGFnZUluZGV4OwogICAgICBwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KS50aGVuKGZ1bmN0aW9uIChwYWdlKSB7CiAgICAgICAgY29uc3QgdGFzayA9IG5ldyBXb3JrZXJUYXNrKGBHZXRPcGVyYXRvckxpc3Q6IHBhZ2UgJHtwYWdlSW5kZXh9YCk7CiAgICAgICAgc3RhcnRXb3JrZXJUYXNrKHRhc2spOwogICAgICAgIGNvbnN0IHN0YXJ0ID0gdmVyYm9zaXR5ID49IFZlcmJvc2l0eUxldmVsLklORk9TID8gRGF0ZS5ub3coKSA6IDA7CiAgICAgICAgcGFnZS5nZXRPcGVyYXRvckxpc3QoewogICAgICAgICAgaGFuZGxlciwKICAgICAgICAgIHNpbmssCiAgICAgICAgICB0YXNrLAogICAgICAgICAgaW50ZW50OiBkYXRhLmludGVudCwKICAgICAgICAgIGNhY2hlS2V5OiBkYXRhLmNhY2hlS2V5LAogICAgICAgICAgYW5ub3RhdGlvblN0b3JhZ2U6IGRhdGEuYW5ub3RhdGlvblN0b3JhZ2UsCiAgICAgICAgICBtb2RpZmllZElkczogZGF0YS5tb2RpZmllZElkcwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKG9wZXJhdG9yTGlzdEluZm8pIHsKICAgICAgICAgIGZpbmlzaFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICBpZiAoc3RhcnQpIHsKICAgICAgICAgICAgaW5mbyhgcGFnZT0ke3BhZ2VJbmRleCArIDF9IC0gZ2V0T3BlcmF0b3JMaXN0OiB0aW1lPWAgKyBgJHtEYXRlLm5vdygpIC0gc3RhcnR9bXMsIGxlbj0ke29wZXJhdG9yTGlzdEluZm8ubGVuZ3RofWApOwogICAgICAgICAgfQogICAgICAgICAgc2luay5jbG9zZSgpOwogICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGZpbmlzaFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICBpZiAodGFzay50ZXJtaW5hdGVkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHNpbmsuZXJyb3IocmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldFRleHRDb250ZW50IiwgZnVuY3Rpb24gKGRhdGEsIHNpbmspIHsKICAgICAgY29uc3QgewogICAgICAgIHBhZ2VJbmRleCwKICAgICAgICBpbmNsdWRlTWFya2VkQ29udGVudCwKICAgICAgICBkaXNhYmxlTm9ybWFsaXphdGlvbgogICAgICB9ID0gZGF0YTsKICAgICAgcGRmTWFuYWdlci5nZXRQYWdlKHBhZ2VJbmRleCkudGhlbihmdW5jdGlvbiAocGFnZSkgewogICAgICAgIGNvbnN0IHRhc2sgPSBuZXcgV29ya2VyVGFzaygiR2V0VGV4dENvbnRlbnQ6IHBhZ2UgIiArIHBhZ2VJbmRleCk7CiAgICAgICAgc3RhcnRXb3JrZXJUYXNrKHRhc2spOwogICAgICAgIGNvbnN0IHN0YXJ0ID0gdmVyYm9zaXR5ID49IFZlcmJvc2l0eUxldmVsLklORk9TID8gRGF0ZS5ub3coKSA6IDA7CiAgICAgICAgcGFnZS5leHRyYWN0VGV4dENvbnRlbnQoewogICAgICAgICAgaGFuZGxlciwKICAgICAgICAgIHRhc2ssCiAgICAgICAgICBzaW5rLAogICAgICAgICAgaW5jbHVkZU1hcmtlZENvbnRlbnQsCiAgICAgICAgICBkaXNhYmxlTm9ybWFsaXphdGlvbgogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgIGlmIChzdGFydCkgewogICAgICAgICAgICBpbmZvKGBwYWdlPSR7cGFnZUluZGV4ICsgMX0gLSBnZXRUZXh0Q29udGVudDogdGltZT1gICsgYCR7RGF0ZS5ub3coKSAtIHN0YXJ0fW1zYCk7CiAgICAgICAgICB9CiAgICAgICAgICBzaW5rLmNsb3NlKCk7CiAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgIGlmICh0YXNrLnRlcm1pbmF0ZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgc2luay5lcnJvcihyZWFzb24pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0U3RydWN0VHJlZSIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmdldFBhZ2UoZGF0YS5wYWdlSW5kZXgpLnRoZW4ocGFnZSA9PiBwZGZNYW5hZ2VyLmVuc3VyZShwYWdlLCAiZ2V0U3RydWN0VHJlZSIpKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiRm9udEZhbGxiYWNrIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZm9udEZhbGxiYWNrKGRhdGEuaWQsIGhhbmRsZXIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJDbGVhbnVwIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuY2xlYW51cCh0cnVlKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiVGVybWluYXRlIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgdGVybWluYXRlZCA9IHRydWU7CiAgICAgIGNvbnN0IHdhaXRPbiA9IFtdOwogICAgICBpZiAocGRmTWFuYWdlcikgewogICAgICAgIHBkZk1hbmFnZXIudGVybWluYXRlKG5ldyBBYm9ydEV4Y2VwdGlvbigiV29ya2VyIHdhcyB0ZXJtaW5hdGVkLiIpKTsKICAgICAgICBjb25zdCBjbGVhbnVwUHJvbWlzZSA9IHBkZk1hbmFnZXIuY2xlYW51cCgpOwogICAgICAgIHdhaXRPbi5wdXNoKGNsZWFudXBQcm9taXNlKTsKICAgICAgICBwZGZNYW5hZ2VyID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjbGVhckdsb2JhbENhY2hlcygpOwogICAgICB9CiAgICAgIGNhbmNlbFhIUnM/LihuZXcgQWJvcnRFeGNlcHRpb24oIldvcmtlciB3YXMgdGVybWluYXRlZC4iKSk7CiAgICAgIGZvciAoY29uc3QgdGFzayBvZiBXb3JrZXJUYXNrcykgewogICAgICAgIHdhaXRPbi5wdXNoKHRhc2suZmluaXNoZWQpOwogICAgICAgIHRhc2sudGVybWluYXRlKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHdhaXRPbikudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgaGFuZGxlci5kZXN0cm95KCk7CiAgICAgICAgaGFuZGxlciA9IG51bGw7CiAgICAgIH0pOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJSZWFkeSIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHNldHVwRG9jKGRvY1BhcmFtcyk7CiAgICAgIGRvY1BhcmFtcyA9IG51bGw7CiAgICB9KTsKICAgIHJldHVybiB3b3JrZXJIYW5kbGVyTmFtZTsKICB9CiAgc3RhdGljIGluaXRpYWxpemVGcm9tUG9ydChwb3J0KSB7CiAgICBjb25zdCBoYW5kbGVyID0gbmV3IE1lc3NhZ2VIYW5kbGVyKCJ3b3JrZXIiLCAibWFpbiIsIHBvcnQpOwogICAgdGhpcy5zZXR1cChoYW5kbGVyLCBwb3J0KTsKICAgIGhhbmRsZXIuc2VuZCgicmVhZHkiLCBudWxsKTsKICB9Cn0KCjsvLyAuL3NyYy9wZGYud29ya2VyLmpzCgpnbG9iYWxUaGlzLnBkZmpzV29ya2VyID0gewogIFdvcmtlck1lc3NhZ2VIYW5kbGVyOiBXb3JrZXJNZXNzYWdlSGFuZGxlcgp9OwoKZXhwb3J0IHsgV29ya2VyTWVzc2FnZUhhbmRsZXIgfTsKCi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBkZi53b3JrZXIubWpzLm1hcA==",MZ={class:"vue-pdf-signer"},uZ={class:"pdf-signer-toolbar"},tZ={class:"toolbar-group"},eZ={class:"btn btn-secondary"},DZ={class:"btn btn-primary"},KZ={key:0,class:"toolbar-group"},SZ={class:"pdf-viewport"},tA=((c,I)=>{const g=c.__vccOpts||c;for(const[C,A]of I)g[C]=A;return g})(z.defineComponent({__name:"PdfSigner",props:{pdfData:{},signatureData:{},isDownload:{type:Boolean},translations:{},enableZoom:{type:Boolean}},emits:["finish"],setup(c){Ig.workerSrc=HZ;const I=c,g=z.computed(()=>({updateSignature:I.translations?.updateSignature||"Update Signature",save:I.translations?.save||"Save"})),C=z.ref(null);return z.watchEffect(async()=>{if(!(!I.pdfData||!C.value)){C.value.innerHTML="";try{const A=atob(I.pdfData),l=new Uint8Array(A.length);for(let d=0;d<A.length;d++)l[d]=A.charCodeAt(d);const i=await wA({data:l}).promise;for(let d=1;d<=i.numPages;d++){const s=await i.getPage(d),G=s.getViewport({scale:1}),m=C.value.clientWidth*.95/G.width,B=s.getViewport({scale:m}),o=document.createElement("canvas");o.style.display="block",o.style.marginBottom="1rem";const W=o.getContext("2d");o.height=B.height,o.width=B.width,C.value.appendChild(o);const Y={canvasContext:W,viewport:B,canvas:o};await s.render(Y).promise}}catch(A){console.error("Failed to render PDF:",A),C.value.innerHTML='<p style="color: red;">Error: Failed to load PDF.</p>'}}}),(A,l)=>(z.openBlock(),z.createElementBlock("div",MZ,[z.createElementVNode("div",uZ,[z.createElementVNode("div",tZ,[z.createElementVNode("button",eZ,z.toDisplayString(g.value.updateSignature),1),z.createElementVNode("button",DZ,z.toDisplayString(g.value.save),1)]),I.enableZoom?(z.openBlock(),z.createElementBlock("div",KZ,l[0]||(l[0]=[z.createElementVNode("button",{class:"btn btn-icon"},"-",-1),z.createElementVNode("span",{class:"zoom-level"},"100%",-1),z.createElementVNode("button",{class:"btn btn-icon"},"+",-1)]))):z.createCommentVNode("",!0)]),z.createElementVNode("div",SZ,[z.createElementVNode("div",{ref_key:"pdfContainer",ref:C,class:"pdf-render-view"},null,512)])]))}}),[["__scopeId","data-v-edc4e6d4"]]),pZ={install(c){c.component("PdfSigner",tA)}};Q.PdfSigner=tA,Q.default=pZ,Object.defineProperties(Q,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
